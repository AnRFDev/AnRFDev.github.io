{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"about/","title":"\u5173\u4e8e","text":""},{"location":"about/#_2","title":"\u5173\u4e8e\u672c\u7ad9","text":"<p>\u672c\u7ad9\u5185\u5bb9\u5305\u62ec</p> <ul> <li>Android\u5f00\u53d1\u57fa\u7840</li> <li>Java\u57fa\u7840</li> <li>Python\u7684\u4f7f\u7528\u7b14\u8bb0</li> <li>NestJS\u7b14\u8bb0</li> <li>WebRTC\u7684\u6559\u7a0b\u4ee5\u53ca\u793a\u4f8b</li> </ul> <p>\u66f4\u591a\u5185\u5bb9\uff0c\u53ef\u53c2\u8003TAGS</p> <p>\u6536\u96c6\u4e86\u5f88\u591a\u5b9e\u7528\u7684\u6280\u672f\u7ec6\u8282\uff0c\u4fbf\u4e8e\u67e5\u7f3a\u8865\u6f0f\u3002</p>"},{"location":"about/#android","title":"\u5173\u4e8eAndroid\u6559\u7a0b","text":"<p>\u4e3a\u65b9\u4fbf\u670b\u53cb\u5165\u95e8\u5b89\u5353\u5e94\u7528\u5f00\u53d1\uff0c\u6574\u7406\u7684Android\u65b0\u624b\u6559\u7a0b\u3002\u7a81\u51fa\u4e00\u4e2a\u7b80\u5355\u660e\u4e86\uff0c\u4e0a\u624b\u5feb\u3002</p> <p>\u4ece\u5b9e\u7528\u6027\u51fa\u53d1\uff0c\u5feb\u901f\u638c\u63e1Android\u5f00\u53d1\u57fa\u672c\u6280\u80fd\u3002</p> <p>\u672c\u6559\u7a0b\u7edd\u5927\u591a\u6570\u4f8b\u5b50\u662f\u7528Java\u5199\u7684\uff0c\u9700\u8981\u8bfb\u8005\u6709\u4e00\u5b9a\u7684Java\u57fa\u7840\u3002</p> <p>\u6559\u7a0b\u76ee\u6807</p> <p>\u8bfb\u8005\u53ef\u4ee5\u81ea\u5df1\u505a\u51fa\u4e00\u4e2a\u4e2a\u65b9\u4fbf\u5de5\u4f5c\u751f\u6d3b\u7684\u5c0f\u5de5\u5177\u6765\u3002</p> <p>\u672c\u7ad9\u8fd0\u7ef4</p> <p>\u5982\u679c\u9875\u9762\u7a81\u7136\u8bbf\u95ee\u4e0d\u4e86\uff0c\u53ef\u80fd\u662f\u6b63\u5728\u66f4\u65b0\u7f51\u9875\u3002\u7a0d\u7b49\u4e00\u4e24\u5206\u949f\u518d\u5237\u65b0\u4e00\u6b21\u8bd5\u8bd5\u5373\u53ef\u3002</p> <p>\u5982\u679c\u8fd8\u662f\u8bbf\u95ee\u4e0d\u4e86\uff0c\u8bf7\u4e0e\u6211\u8054\u7cfb rf.cs@foxmail.com</p> \u5173\u4e8e\u5e7f\u544a <p>\u8feb\u4e8e\u751f\u8ba1\uff0c\u6295\u653e\u4e00\u4e9b\u5e7f\u544a\u4ee5\u7ef4\u6301\u8fd0\u884c</p> <p>\u5982\u679c\u89c9\u5f97\u5185\u5bb9\u5bf9\u5b66\u4e60\u3001\u5de5\u4f5c\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u6253\u8d4f\u4f5c\u8005</p>"},{"location":"about/#rustfisher","title":"\u5173\u4e8e\u4f5c\u8005RustFisher","text":"<p>\u591a\u5e74\u8f6f\u4ef6\u5de5\u7a0b\u5e08\u3002\u4e3b\u8981\u4ece\u4e8bAndroid App\u5f00\u53d1\u5de5\u4f5c\u3002\u4e3b\u8981\u5f00\u53d1\u8bed\u8a00\u662fJava\u3002</p> <p>\u505a\u8fc7\u86ee\u591a\u5c0f\u4e1c\u897f\u3002\u7528NestJS\u5f00\u53d1\u8fc7\u540e\u53f0\uff0c\u7528flutter\u505a\u8fc7App\uff0c\u719f\u6089\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u5f00\u53d1\u3002</p> <p>\u4f1a\u7528python\u5199\u811a\u672c\uff0c\u719f\u6089Nginx\u3002</p> <p>\u9700\u8981\u7528\u4ec0\u4e48\uff0c\u5c31\u53bb\u5b66\u4ec0\u4e48\u3002</p>"},{"location":"about/#_3","title":"\u8054\u7cfb\u6211","text":"<p>\u6211\u5728\u6398\u91d1 \u6211\u5728cnblog \u6211\u5728\u77e5\u4e4e \u672c\u7ad9@\u7ebf\u5708</p> <p>\ud83d\udcec \u53cd\u9988 \ud83d\udcd8 \u793a\u4f8b\u4ee3\u7801 \ud83d\ude4c \u652f\u6301\u4f5c\u8005 \ud83d\udd17 \u53cb\u94fe</p>"},{"location":"recent-post/","title":"\u6700\u8fd1\u66f4\u65b0|\u94c1\u624b\u6e14\u592b","text":"<p>adb install \u6307\u5b9a\u8bbe\u5907\u5b89\u88c5apk</p> <p>\u66f4\u65b0\u65e5\u671f: 2024-01-11</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>ViewModel\u5b9e\u4f8b\u4ec0\u4e48\u65f6\u5019\u88ab\u56de\u6536\uff08TechMix\uff0c\u6398\u91d1\uff09</p> <p>\u66f4\u65b0\u65e5\u671f: 2024-01-05</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>Android Studio \u6a21\u5757\u7f16\u8bd1\u6253\u5305\u51fajar</p> <p>Android Studio \u6a21\u5757\u6253\u5305\u6210jar\uff0c\u5408\u5e76\u7b2c\u4e09\u65b9jar\u62101\u4e2ajar\u5305</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-11-23</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>Linux\u4f7f\u7528netstat\u67e5\u770b\u7f51\u7edc\u72b6\u6001</p> <p>\u4f7f\u7528netstat\u67e5\u770b\u7f51\u7edc\u72b6\u6001\u3002\u663e\u793a\u7cfb\u7edf\u7aef\u53e3\u4f7f\u7528\u60c5\u51b5\u3002UDP\u7c7b\u578b\u7684\u7aef\u53e3\u3002TCP\u7c7b\u578b\u7684\u7aef\u53e3\u3002\u53ea\u663e\u793a\u6240\u6709\u76d1\u542c\u7aef\u53e3\u3002\u53ea\u663e\u793a\u6240\u6709\u76d1\u542ctcp\u7aef\u53e3\u3002</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-08-08</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>\u97f3\u89c6\u9891\u7684\u4e00\u4e9b\u5f00\u6e90\u9879\u76ee</p> <p>\u97f3\u89c6\u9891\u7f16\u89e3\u7801\u7c7b\u3001\u89c6\u9891\u524d\u540e\u5904\u7406\u3001\u670d\u52a1\u7aef\u7c7b\u7b49\u3002</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-08-03</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>Android\u76d1\u542cactivity\u751f\u547d\u5468\u671f</p> <p>Android Application\u4e2d\u4f7f\u7528registerActivityLifecycleCallbacks\uff0c\u76d1\u542cactivity\u7684\u751f\u547d\u5468\u671f\u3002\u53ef\u4ee5\u7528\u6765\u5224\u65adApp\u5f53\u524d\u662f\u5426\u5728\u524d\u53f0\u3002</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-07-10</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>Android\u4e2d\u4f7f\u7528base64</p> <p>Android\u4e2d\u4f7f\u7528base64\uff0c\u7f16\u7801\u548c\u89e3\u7801\u3002Base64.encodeToString\uff0cBase64.decode</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-07-10</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>\u5f00\u59cb\u4f7f\u7528Room</p> <p>Android Room \u5728 SQLite \u4e0a\u63d0\u4f9b\u4e86\u4e00\u4e2a\u62bd\u8c61\u5c42\u3002\u672c\u6587\u4ecb\u7ecdRoom\u7684\u7528\u6cd5\u3002\u5f15\u5165Room\uff1b\u51c6\u5907\u6570\u636e\uff0c\u8bbe\u8ba1\u7ed3\u6784\uff1b\u6570\u636e\u5e93\u64cd\u4f5c\u3002\u4ecb\u7ecd\u5e38\u89c1\u7684\u5d29\u6e83\u60c5\u51b5\u3002</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-06-19</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>Android Activity Result Launcher \u8fd4\u56de\u65f6\u643a\u5e26\u53c2\u6570</p> <p>Android Activity \u8fd4\u56de\u65f6\u643a\u5e26\u53c2\u6570\u3002\u4f7f\u7528ActivityResultLauncher\u5b9e\u73b0\u3002</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-06-01</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>\u6c49\u5b57\u8f6c\u62fc\u97f3\u5e93 TinyPinyin</p> <p>tinypinyin \u591a\u97f3\u5b57\uff0c\u6c49\u5b57\u8f6c\u62fc\u97f3\u5e93 TinyPinyin\u3002</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-05-18</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>\u6295\u5582\u4f5c\u8005RustFisher</p> <p>\u652f\u6301\u4f5c\u8005\u3002\u5185\u5bb9\u4f9d\u65e7\u5728\u6269\u5145\u4e2d\u3002\u5982\u679c\u89c9\u5f97\u7f51\u7ad9\u5185\u5bb9\u5bf9\u60a8\u6709\u5e2e\u52a9\uff0c\u53ef\u4ee5\u8bf7\u4f5c\u8005\u559d\u676f\u5496\u5561\uff08\u6216\u725b\u5976\uff09\u3002</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-05-04</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>Gradle\u663e\u793a\u6240\u6709\u7684\u4efb\u52a1\uff0c\u6a21\u5757\u6253\u5305aar</p> <p>Android Studio 2022.1.1\uff0c \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cgradle\u4e2d\u770b\u4e0d\u5230assemble\u9009\u9879\u3002\u5728\u8bbe\u7f6e\u4e2d\u53d6\u6d88\uff0c\u7136\u540e\u91cd\u65b0\u5237\u65b0\u4e00\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230assemble\u9009\u9879\u3002\u8c03\u7528\u53ef\u6253\u5305\u51fa\u6a21\u5757\u7684aar\u6587\u4ef6\u3002</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-04-20</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>Android WebView\u5404\u9879\u4f7f\u7528\u8bf4\u660e</p> <p>Android WebView\u5404\u9879\u4f7f\u7528\u8bf4\u660e\u3002\u7981\u6b62webview\u5904\u7406\u957f\u6309\u4e8b\u4ef6\u3002\u6539\u53d8\u5b57\u4f53\u5927\u5c0f\u3002webview\u6253\u5f00URL\uff0c\u8df3\u53bb\u4e86\u7cfb\u7edf\u81ea\u5e26\u7684\u6d4f\u89c8\u5668\u3002</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-03-30</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>Android SPP\u8fde\u63a5\u84dd\u7259\u8bbe\u5907\u6ce8\u610f\u4e8b\u9879</p> <p>Android SPP\u8fde\u63a5\u84dd\u7259\u8bbe\u5907\u6ce8\u610f\u4e8b\u9879\u3002\u5c1d\u8bd5\u8fde\u63a5\u84dd\u7259\u8bbe\u5907\u65f6\uff0c\u6700\u597d\u65b0\u5f00\u4e00\u4e2a\u7ebf\u7a0b\u3002\u7136\u540e\u7528\u8fdc\u7a0b\u8bbe\u5907\u7684MAC\u5730\u5740\u6765\u91cd\u542f\u83b7\u53d6\u4e00\u4e0b\u3002</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-03-27</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>Android HttpURLConnection POST \u4e0a\u4f20\u6587\u4ef6</p> <p>Android HttpURLConnection \u4e0a\u4f20\u6587\u4ef6\uff0cPOST\u4e0a\u4f20\u6587\u4ef6\u3002\u4e0a\u4f20\u6587\u4ef6\u7684\u65f6\u5019\u5e26\u53c2\u6570\u3002</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-03-23</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>SIP\u9519\u8bef\u7801\u53c2\u8003</p> <p>SIP\uff08Session Initiation Protocol\uff0c\u4f1a\u8bdd\u521d\u59cb\u534f\u8bae\uff09\u7684\u72b6\u6001\u7801\u5171\u67096\u7c7b\uff0c\u5206\u522b\u662f1xx\u30012xx\u30013xx\u30014xx\u30015xx\u548c6xx\u3002\u6bcf\u4e2a\u72b6\u6001\u7801\u8868\u793a\u4e86\u5bf9SIP\u8bf7\u6c42\u7684\u5904\u7406\u7ed3\u679c\u3002\u672c\u6587\u4e3aSIP\u9519\u8bef\u7801\u53c2\u8003\uff0c\u4e2d\u6587\u89e3\u91ca\u4e0e\u82f1\u6587\u89e3\u91ca\u3002100 Trying\uff0c180 Ringing\uff0c200 OK\uff0c403 Forbidden\uff0c408 Request timeout</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-03-23</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>SIP\u4e0eSDP</p> <p>SIP\uff08Session Initiation Protocol\uff09\u662f\u4e00\u79cd\u7528\u4e8e\u5efa\u7acb\u3001\u4fee\u6539\u548c\u7ec8\u6b62\u591a\u5a92\u4f53\u4f1a\u8bdd\u7684\u534f\u8bae\uff0c\u800cSDP\uff08Session Description Protocol\uff09\u5219\u662f\u4e00\u79cd\u7528\u4e8e\u63cf\u8ff0\u591a\u5a92\u4f53\u4f1a\u8bdd\u7684\u534f\u8bae\u3002\u5728SIP\u4e2d\uff0cSDP\u901a\u5e38\u88ab\u7528\u6765\u4f20\u9012\u5173\u4e8e\u5a92\u4f53\u6d41\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u7f16\u89e3\u7801\u5668\u7c7b\u578b\u3001\u4f20\u8f93\u534f\u8bae\u3001\u7aef\u53e3\u53f7\u7b49\u7b49\u3002\u5f53\u4e00\u4e2aSIP\u8bf7\u6c42\u6216\u54cd\u5e94\u9700\u8981\u643a\u5e26SDP\u4fe1\u606f\u65f6\uff0c\u5b83\u4eec\u901a\u5e38\u4f1a\u5c06SDP\u6570\u636e\u4f5c\u4e3a\u8d1f\u8f7d\u653e\u5728\u6d88\u606f\u4f53\u4e2d\uff0c\u4ee5\u4fbf\u8ba9\u5bf9\u65b9\u4e86\u89e3\u5173\u4e8e\u8be5\u4f1a\u8bdd\u7684\u5404\u79cd\u5a92\u4f53\u76f8\u5173\u7ec6\u8282\u3002\u56e0\u6b64\uff0c\u53ef\u4ee5\u8bf4SIP\u548cSDP\u662f\u5bc6\u5207\u76f8\u5173\u7684\u4e24\u4e2a\u534f\u8bae\uff0c\u5b83\u4eec\u5171\u540c\u7ec4\u6210\u4e86\u4e00\u5957\u5b8c\u6574\u7684\u591a\u5a92\u4f53\u4f1a\u8bdd\u5efa\u7acb\u548c\u4f20\u8f93\u673a\u5236\u3002</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-03-23</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>MongoDB\u548cMySQL\u7684\u5bf9\u6bd4</p> <p>MongoDB\u548cMySQL\u90fd\u662f\u6d41\u884c\u7684\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u5b83\u4eec\u5404\u6709\u4f18\u7f3a\u70b9\u3002</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-03-17</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>WebRTC\u7684\u4e00\u4e9b\u53c2\u8003</p> <p>\u5173\u4e8eWebRTC\u7684\u4e00\u4e9b\u53c2\u8003\u8d44\u6599\u3002WebRTC for the Curious\u3002pion/turn\u3002Getting Started With WebRTC\u3002WebRTC Tutorials - 36 Essential Learning Resources</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-03-17</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>adb \u5f55\u5c4f\u547d\u4ee4</p> <p>adb \u5f55\u5c4f\u5de5\u5177:screenrecord\u3002\u4f7f\u7528as\u7684\u5f55\u5c4f\u5de5\u5177\uff0c\u6216\u8005\u76f4\u63a5\u7528adb\u547d\u4ee4\u3002screenrecord inaccessible or not found\u3002Encoder failed (err=-38)</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-03-16</p> <p>\u5f00\u59cb\u9605\u8bfb</p> <p>Android\u81ea\u5b9a\u4e49View\u4e4b\u661f\u7403\u8fd0\u52a8</p> <p>\u5728dribbble\u95f2\u901b\u7684\u65f6\u5019\u53d1\u73b0\u7684\u4e00\u4e2a\u6709\u610f\u601d\u7684\u661f\u7403\u8fd0\u52a8\u7684\u52a8\u753b,\u521a\u597d\u6700\u8fd1\u65f6\u95f4\u5c1a\u53ef,\u5c31\u7b80\u5355\u5b9e\u73b0\u4e86\u4e00\u4e0b\u4e2d\u95f4\u8fd0\u52a8\u7684\u90e8\u5206,\u53c8\u662f\u56e0\u4e3a\u65f6\u95f4\u7684\u539f\u56e0,\u5f00\u5934\u4f4d\u79fb\u7684\u90e8\u5206\u6ca1\u6709\u5b8c\u6210.</p> <p>\u66f4\u65b0\u65e5\u671f: 2023-03-13</p> <p>\u5f00\u59cb\u9605\u8bfb</p>"},{"location":"tags/","title":"\u672c\u7ad9\u6807\u7b7e","text":""},{"location":"tags/#android-activity","title":"Android Activity","text":"<ul> <li>Android Activity \u751f\u547d\u5468\u671f\uff08Activity\u751f\u547d\u5468\u671f\uff09</li> <li>Android Activity Result Launcher \u8fd4\u56de\u65f6\u643a\u5e26\u53c2\u6570</li> <li>Android Activity\u8fc7\u573a\u52a8\u753b\u6548\u679c\uff08Activity\u8fc7\u573a\u52a8\u753b\uff09</li> <li>Android \u60ac\u6d6e\u7a97 Activity</li> <li>Android Activity \u542f\u52a8\u6a21\u5f0f\uff0c\u4efb\u52a1\u548c\u8fd4\u56de\u6808\uff08\u542f\u52a8\u6a21\u5f0f\u6709\u51e0\u79cd\uff1f\uff09</li> <li>Android Activity \u4f20\u9012Parcelable\u5bf9\u8c61</li> <li>Android Activity\u7efc\u8ff0</li> <li>Android Activity \u542f\u52a8\uff0c\u643a\u5e26\u53c2\u6570\u542f\u52a8</li> <li>Android Activity \u8fd4\u56de\u65f6\u643a\u5e26\u53c2\u6570</li> </ul>"},{"location":"tags/#android-camera","title":"Android Camera","text":"<ul> <li>Android Camera2 get size and fps info</li> <li>Android Camera2\u83b7\u53d6\u9884\u89c8\u5c3a\u5bf8\u548cfps\u8303\u56f4</li> </ul>"},{"location":"tags/#android-launcher","title":"Android Launcher","text":"<ul> <li>Android \u7b80\u6613launcher</li> </ul>"},{"location":"tags/#android-media","title":"Android Media","text":"<ul> <li>Android\u97f3\u9891PCM\u6570\u636e\u7684\u91c7\u96c6\u548c\u64ad\u653e\uff0c\u8bfb\u5199\u97f3\u9891wav\u6587\u4ef6</li> <li>Android\u4f7f\u7528SurfaceView\u548cTextureView\u9884\u89c8Camera\uff0c\u83b7\u53d6NV21\u6570\u636e</li> <li>Android \u4f7f\u7528 Android Camera API \u5b8c\u6210\u97f3\u89c6\u9891\u7684\u91c7\u96c6\u3001\u7f16\u7801\u3001\u5c01\u5305\u6210 mp4 \u8f93\u51fa</li> <li>Android MediaCodec \u7f16\u89e3\u7801\u4f7f\u7528\u65b9\u5f0f</li> <li>Android \u4f7f\u7528 MediaExtractor \u548c MediaMuxer \u89e3\u6790\u548c\u5c01\u88c5 mp4 \u6587\u4ef6</li> <li>Android MediaPlayer \u57fa\u7840\u7b80\u4ecb</li> <li>Android MediaPlayer \u64ad\u653e\u97f3\u9891</li> <li>Android MediaPlayer \u97f3\u9891\u500d\u901f\u64ad\u653e\uff0c\u8c03\u6574\u64ad\u653e\u901f\u5ea6</li> <li>WebRTC\u62bd\u53d6AGC\u589e\u76ca\u4e0eANS\u566a\u58f0\u6291\u5236\u6a21\u5757\u7ed9Android</li> </ul>"},{"location":"tags/#android-packagemanager","title":"Android PackageManager","text":"<ul> <li>Android \u5378\u8f7dapp</li> <li>Android \u81ea\u5b9a\u4e49 permission</li> <li>PackageManager\u7684\u4e00\u4e9b\u57fa\u7840\u7528\u6cd5</li> <li>Android \u4ee3\u7801\u91cd\u542fapp\u7684\u65b9\u6cd5</li> </ul>"},{"location":"tags/#android-studio","title":"Android Studio","text":"<ul> <li>Android Studio \u6a21\u5757\u7f16\u8bd1\u6253\u5305\u51fajar</li> </ul>"},{"location":"tags/#android-view","title":"Android View","text":"<ul> <li>Android addOnGlobalLayoutListener</li> </ul>"},{"location":"tags/#android","title":"Android\u52a8\u753b","text":"<ul> <li>Android Activity\u8fc7\u573a\u52a8\u753b\u6548\u679c\uff08Activity\u8fc7\u573a\u52a8\u753b\uff09</li> </ul>"},{"location":"tags/#cocos-creator","title":"Cocos Creator","text":"<ul> <li>Cocos Creator \u62d6\u52a8\u6548\u679c</li> <li>Cocos Creator \u62d6\u52a8\u53bb\u6307\u5b9a\u533a\u57df</li> <li>Cocos Creator \u5750\u6807\u4e0e\u8f6c\u6362</li> <li>Cocos Creator \u89e6\u6478\u4e8b\u4ef6\u7a7f\u900f</li> </ul>"},{"location":"tags/#ffmpeg","title":"FFmpeg","text":"<ul> <li>Python \u4f7f\u7528FFmpeg\u64cd\u4f5cmp4</li> </ul>"},{"location":"tags/#java","title":"Java","text":"<ul> <li>\u72b6\u6001\u6a21\u5f0f State Pattern</li> <li>\u7b56\u7565\u6a21\u5f0f Strategy Pattern</li> <li>\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f Template Method Pattern</li> <li>\u8bbf\u95ee\u8005\u6a21\u5f0f Visitor Pattern</li> </ul>"},{"location":"tags/#linux","title":"Linux","text":"<ul> <li>Shell for \u5faa\u73af\u8bed\u53e5</li> <li>Linux awk\u547d\u4ee4\u7684\u4f7f\u7528\uff0c\u9010\u884c\u5904\u7406\u6587\u672c\uff0c\u641c\u7d22\u7edf\u8ba1\u5355\u8bcd\u4e2a\u6570</li> <li>Linux curl \u4f7f\u7528</li> <li>find\u7684\u4f7f\u7528\uff0c\u5bfb\u627e\u7279\u5b9a\u6587\u4ef6</li> <li>grep \u641c\u7d22\u5b57\u7b26\u4e32</li> <li>ls \u547d\u4ee4</li> <li>Linux mkdir \u521b\u5efa\u76ee\u5f55</li> <li>Linux\u4f7f\u7528netstat\u67e5\u770b\u7f51\u7edc\u72b6\u6001</li> </ul>"},{"location":"tags/#lua","title":"Lua","text":"<ul> <li>Lua \u57fa\u7840\u64cd\u4f5c</li> <li>Lua Mac\u7f16\u8bd1\u5b89\u88c5</li> </ul>"},{"location":"tags/#mongodb","title":"MongoDB","text":"<ul> <li>MongoDB\u548cMySQL\u7684\u5bf9\u6bd4</li> </ul>"},{"location":"tags/#mysql","title":"MySQL","text":"<ul> <li>MongoDB\u548cMySQL\u7684\u5bf9\u6bd4</li> <li>docker MySQL \u4fee\u6539\u5bc6\u7801</li> <li>Python \u64cd\u4f5c MySQL</li> </ul>"},{"location":"tags/#nestjs","title":"NestJS","text":"<ul> <li>\u72b6\u6001\u7801\u9020\u6210\u5fae\u4fe1\u516c\u4f17\u53f7\u201c\u8be5\u516c\u4f17\u53f7\u63d0\u4f9b\u7684\u670d\u52a1\u51fa\u73b0\u6545\u969c\u201d</li> <li>NestJS \u90e8\u7f72\u4e0e\u7ef4\u62a4</li> <li>NestJS \u9759\u6001\u6587\u4ef6</li> <li>NestJS WebSocket \u5f00\u59cb\u4f7f\u7528</li> <li>Ubuntu Nginx \u914d\u7f6e\u4f7f\u7528WSS</li> <li>NestJS Simple Chat \u65b0\u5efa\u5de5\u7a0b</li> <li>NestJS Simple Chat - \u90e8\u7f72\u670d\u52a1</li> <li>NestJS Simple Chat - \u5206\u623f\u53d1\u9001\u6d88\u606f</li> <li>NestJS Simple Chat - \u672c\u5730\u670d\u52a1\u6d88\u606f\u8f6c\u53d1</li> <li>NestJS Simple Chat - Web\u5efa\u7acbwebsocket\u8fde\u63a5</li> </ul>"},{"location":"tags/#nginx","title":"Nginx","text":"<ul> <li>Ubuntu Nginx \u914d\u7f6e\u4f7f\u7528WSS</li> <li>\u5e38\u89c1\u7684nginx\u914d\u7f6e\uff0c\u670d\u52a1\u914d\u7f6e\uff0c\u8d1f\u8f7d\u5747\u8861\uff0cssl\uff1b\u8bb0\u5f55\u4e00\u4e9b\u5e38\u7528\u7684\u914d\u7f6e</li> </ul>"},{"location":"tags/#parcelable","title":"Parcelable","text":"<ul> <li>Android Activity \u4f20\u9012Parcelable\u5bf9\u8c61</li> </ul>"},{"location":"tags/#pyqt","title":"PyQt","text":"<ul> <li>\u5b89\u88c5PyQt5</li> <li>\u5b89\u88c5\u548c\u914d\u7f6ePyCharm</li> <li>PyQt QFileDialog \u6587\u4ef6\u9009\u62e9\u5f39\u7a97</li> <li>PyQt QMainWindow \u7b80\u5355\u4f7f\u7528</li> <li>PyQt \u7ebf\u7a0b\u7c7b QThread</li> <li>PyQt \u9002\u914d\u4e0d\u540c\u5c4f\u5e55\u5206\u8fa8\u7387</li> <li>PyQt \u62d6\u5165</li> <li>PyQt \u591a\u8bed\u8a00</li> <li>PyQt \u6253\u5305\u6210exe\u6587\u4ef6</li> <li>PyQt \u521b\u5efa\u81ea\u5b9a\u4e49QWidget</li> <li>PyQt5 \u5b89\u88c5\u5546\u4e1a\u7248</li> </ul>"},{"location":"tags/#python","title":"Python","text":"<ul> <li>Python3 Dictionary\u4e0eJSON</li> <li>Python \u83b7\u53d6\u5f53\u524d\u8def\u5f84\u7684\u65b9\u6cd5</li> <li>pip \u76f8\u5173</li> <li>Python \u8bfb\u5199csv\u6587\u4ef6\u4e2d\u7684\u6570\u5b57</li> <li>Python \u67e5\u770b\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6</li> <li>Python\u56fe\u8868\u5e93Matplotlib \u7ec4\u6210\u90e8\u5206\u4ecb\u7ecd</li> <li>\u7ed8\u5236\u56fe\u8868Matplotlib\u5feb\u901f\u5165\u95e8</li> <li>Python \u64cd\u4f5c MySQL</li> <li>\u3010\u8fd0\u8425\u7684Python\u6307\u5357\u3011\u7ed8\u5236\u6f0f\u6597\u56fe</li> <li>\u3010\u8fd0\u8425\u7684Python\u6307\u5357\u3011Python Excel \u7ed8\u5236\u67f1\u5f62\u56fe</li> <li>\u3010\u8fd0\u8425\u7684Python\u6307\u5357\u3011Python \u64cd\u4f5cExcel</li> <li>Python openpyxl Excel\u7ed8\u5236\u67f1\u5f62\u56fe</li> <li>Python openpyxl \u5904\u7406Excel\u4f7f\u7528\u6307\u5357</li> <li>Python \u8c03\u7528adb\u547d\u4ee4</li> <li>Python \u4f7f\u7528FFmpeg\u64cd\u4f5cmp4</li> <li>python3 \u53d1\u9001\u90ae\u4ef6\u529f\u80fd</li> <li>Python\u6293\u53d6\u535a\u5ba2\u8bb0\u5f55\uff0c\u83b7\u53d6\u6807\u9898\u4e0eurl</li> </ul>"},{"location":"tags/#simple-chat","title":"Simple Chat","text":"<ul> <li>NestJS Simple Chat \u65b0\u5efa\u5de5\u7a0b</li> <li>NestJS Simple Chat - \u90e8\u7f72\u670d\u52a1</li> <li>NestJS Simple Chat - \u5206\u623f\u53d1\u9001\u6d88\u606f</li> <li>NestJS Simple Chat - \u672c\u5730\u670d\u52a1\u6d88\u606f\u8f6c\u53d1</li> <li>NestJS Simple Chat - Web\u5efa\u7acbwebsocket\u8fde\u63a5</li> </ul>"},{"location":"tags/#webrtc","title":"WebRTC","text":"<ul> <li>WebRTC\u7684\u4e00\u4e9b\u53c2\u8003</li> <li>WebRTC\u62bd\u53d6AGC\u589e\u76ca\u4e0eANS\u566a\u58f0\u6291\u5236\u6a21\u5757\u7ed9Android</li> <li>WebRTC\u6a21\u62df\u4f20\u8f93\u89c6\u9891\u6d41\uff0cvideo\u901a\u8fc7\u672c\u5730\u8282\u70b9peer\u4f20\u8f93\u89c6\u9891\u6d41</li> <li>WebRTC\u6982\u5ff5\u7b80\u4ecb</li> <li>WebRTC\u4e0b\u8f7d\u4e0e\u7f16\u8bd1 Mac</li> <li>Web\u524d\u7aefWebRTC\u653b\u7565-\u5a92\u4f53\u534f\u5546\u4e0eSDP\u7b80\u6790</li> <li>WebRTC\u672c\u5730\u9009\u62e9codec</li> <li>WebRTC\u672c\u5730\u63d2\u5165\u591a\u4e2a\u8f6c\u53d1\u8282\u70b9\uff0c\u6a21\u62df\u591a\u8282\u70b9\u8f6c\u53d1\uff0c\u9020\u6210\u5ef6\u8fdf</li> <li>WebRTC\u97f3\u9891\u901a\u8bdd\u5347\u7ea7\u4e3a\u89c6\u9891\u901a\u8bdd</li> <li>Ubuntu\u4e0b\u8f7d\u5b89\u88c5coturn\uff0c\u542f\u52a8TURN\u670d\u52a1</li> <li>WebRTC\u97f3\u9891\u97f3\u91cf</li> <li>WebRTC\u4ece\u6444\u50cf\u5934\u83b7\u53d6\u56fe\u7247\u4f20\u5165canvas</li> <li>WebRTC\u4e0eCSS\u6ee4\u955c\uff08CSS filter\uff09</li> <li>WebRTC\u6253\u5f00\u672c\u5730\u6444\u50cf\u5934</li> <li>WebRTC\u672c\u5730\u5206\u4eab\u5c4f\u5e55\uff0c\u5f55\u5236\u5c4f\u5e55</li> <li>WebRTC\u7f51\u9875\u6253\u5f00\u6444\u50cf\u5934\u5e76\u5f55\u5236\u89c6\u9891</li> <li>WebRTC\u89c6\u9891\u5206\u8fa8\u7387\u8bbe\u7f6e</li> </ul>"},{"location":"tags/#xcode","title":"Xcode","text":"<ul> <li>Xcode \u57fa\u672c\u64cd\u4f5c</li> </ul>"},{"location":"tags/#adb","title":"adb","text":"<ul> <li>Python \u8c03\u7528adb\u547d\u4ee4</li> </ul>"},{"location":"tags/#fun","title":"fun","text":"<ul> <li>\u7f16\u7a0b\u7b11\u8bdd</li> <li>\u7a0b\u5e8f\u5458\u6bb5\u5b50</li> <li>\u7a0b\u5e8f\u5458\u6bb5\u5b503</li> <li>\u7a0b\u5e8f\u5458\u6bb5\u5b504</li> <li>\u7a0b\u5e8f\u7b11\u8bdd\uff0c\u6c99\u96d5\u56fe5</li> </ul>"},{"location":"tags/#http","title":"http","text":"<ul> <li>HTTP\u72b6\u6001\u7801</li> </ul>"},{"location":"tags/#ios","title":"iOS","text":"<ul> <li>\u9093\u767d\u6c0f\u7f16\u53f7\u7533\u8bf7 DUNS</li> <li>iOS\u9875\u9762\u8df3\u8f6c\u7684\u51e0\u79cd\u65b9\u5f0f</li> <li>.a is missing one or more architectures required by this target</li> <li>iOS TableView Storyboard\u793a\u4f8b \u663e\u793a\u5217\u8868</li> <li>iOS TableView \u663e\u793a\u8be6\u60c5\uff0c\u4f7f\u7528Storyboard</li> <li>iOS TableView Storyboard\u793a\u4f8b \u5217\u8868\u9875\u4f7f\u7528UITableViewDataSource</li> <li>iOS TableView Storyboard\u793a\u4f8b\uff0c\u8be6\u60c5\u9875DataSource</li> <li>iOS TableView Storyboard\u793a\u4f8b\uff0c\u7f16\u8f91\u8be6\u60c5</li> <li>Xcode \u57fa\u672c\u64cd\u4f5c</li> </ul>"},{"location":"tags/#sip","title":"sip","text":"<ul> <li>SIP\u4e0eSDP</li> <li>SIP\u9519\u8bef\u7801\u53c2\u8003</li> </ul>"},{"location":"tags/#ws","title":"ws","text":"<ul> <li>NestJS WebSocket \u5f00\u59cb\u4f7f\u7528</li> </ul>"},{"location":"tags/#_2","title":"\u5d4c\u5165\u5f0f","text":"<ul> <li>float\u7c7b\u578b\u4e2dNaN\u548cInf\u662f\u4ec0\u4e48\uff1f</li> <li>\u5d4c\u5165\u5f0f\u9879\u76ee\u4e2d\u6253\u9020\u81ea\u5df1\u7684utils\u5e93-\u4e8c\u8fdb\u5236\u8f6c\u6362</li> <li>\u5d4c\u5165\u5f0f\u9879\u76ee\u4e2d\u6253\u9020\u81ea\u5df1\u7684utils\u5e93-ENUM\u8f6c\u5b57\u7b26\u4e32</li> <li>\u5d4c\u5165\u5f0f\u9879\u76ee\u4e2d\u6253\u9020\u81ea\u5df1\u7684utils\u5e93-\u4e0d\u540c\u82af\u7247\u7684\u57fa\u7840\u65f6\u7a7a\u5f00\u9500\u8ba1\u7b97</li> <li>ESP8266 Bootloader\u5f00\u6e90\u4ee3\u7801\u89e3\u6790\u4e4brboot\uff08\u4e00\uff09</li> <li>ESP8266 Bootloader\u5f00\u6e90\u4ee3\u7801\u89e3\u6790\u4e4brboot\uff08\u4e8c\uff09</li> <li>ESP8266\u67b6\u6784\u63a2\u7d22-\u8fd0\u884c\u7684\u8d77\u59cb</li> </ul>"},{"location":"tags/#_3","title":"\u60ac\u6d6e\u7a97","text":"<ul> <li>Android \u60ac\u6d6e\u7a97 Activity</li> </ul>"},{"location":"tags/#_4","title":"\u8bbe\u8ba1\u6a21\u5f0f","text":"<ul> <li>\u9002\u914d\u5668\u6a21\u5f0f Adapter Pattern - Java\u5b9e\u73b0</li> <li>\u6865\u63a5\u6a21\u5f0f Bridge Pattern</li> <li>\u5efa\u9020\u8005\u6a21\u5f0f Builder Pattern</li> <li>\u547d\u4ee4\u6a21\u5f0f</li> <li>\u88c5\u9970\u8005\u6a21\u5f0f</li> <li>\u95e8\u9762\u6a21\u5f0f Facade Pattern</li> <li>\u5de5\u5382\u65b9\u6cd5 Java\u5b9e\u73b0</li> <li>\u4eab\u5143\u6a21\u5f0f Flyweight Pattern</li> <li>\u8fed\u4ee3\u5668 Iterator</li> <li>\u76d1\u542c\u8005\u6a21\u5f0f - \u5728Java\u4e0eAndroid\u4e2d\u7684\u4f7f\u7528</li> <li>\u4e2d\u4ecb\u8005\u6a21\u5f0f Mediator Pattern</li> <li>\u5907\u5fd8\u5f55\u6a21\u5f0f Memento Pattern</li> <li>\u539f\u578b\u6a21\u5f0f Prototype Pattern</li> <li>\u4ee3\u7406\u6a21\u5f0f Proxy Pattern</li> <li>\u8d23\u4efb\u94fe\u6a21\u5f0f Responsibility Chain Pattern</li> <li>\u72b6\u6001\u6a21\u5f0f State Pattern</li> <li>\u7b56\u7565\u6a21\u5f0f Strategy Pattern</li> <li>\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f Template Method Pattern</li> <li>\u8bbf\u95ee\u8005\u6a21\u5f0f Visitor Pattern</li> </ul>"},{"location":"tags/#_5","title":"\u97f3\u89c6\u9891","text":"<ul> <li>Android\u97f3\u9891PCM\u6570\u636e\u7684\u91c7\u96c6\u548c\u64ad\u653e\uff0c\u8bfb\u5199\u97f3\u9891wav\u6587\u4ef6</li> <li>Android\u4f7f\u7528SurfaceView\u548cTextureView\u9884\u89c8Camera\uff0c\u83b7\u53d6NV21\u6570\u636e</li> <li>Android \u4f7f\u7528 Android Camera API \u5b8c\u6210\u97f3\u89c6\u9891\u7684\u91c7\u96c6\u3001\u7f16\u7801\u3001\u5c01\u5305\u6210 mp4 \u8f93\u51fa</li> <li>Android MediaCodec \u7f16\u89e3\u7801\u4f7f\u7528\u65b9\u5f0f</li> <li>Android \u4f7f\u7528 MediaExtractor \u548c MediaMuxer \u89e3\u6790\u548c\u5c01\u88c5 mp4 \u6587\u4ef6</li> <li>\u5e38\u89c1\u97f3\u89c6\u9891\u7f16\u7801\u683c\u5f0f</li> <li>YUV\u7b80\u4ecb</li> <li>YUV\u5b58\u50a8\u65b9\u5f0f</li> </ul>"},{"location":"tech-note-index/","title":"\u6280\u672f\u8bb0\u5f55","text":"<p>\u6280\u672f\u7684\u6295\u5165\u662f\u65e0\u6b62\u5883\u7684</p> <p>\u4e00\u8d77\u5728\u77e5\u8bc6\u7684\u6d77\u6d0b\u91cc\u545b\u6c34\u5427</p> <p>\u672c\u7ad9\u4e3b\u8981\u5185\u5bb9\u662f\u5b89\u5353\u5e94\u7528\u5f00\u53d1\u3002\u7a81\u51fa\u4e00\u4e2a\u7b80\u5355\u660e\u4e86\uff0c\u4e0a\u624b\u5feb\u3002\u964d\u4f4e\u4e0a\u624b\u96be\u5ea6\uff0c\u7ed9\u65b0\u624b\u4e00\u4e2a\u66f4\u597d\u7684\u542f\u52a8\u6761\u4ef6\u3002</p> <p>\u65e0\u8bba\u662f\u5728\u6821\u5b66\u751f\uff0c\u7f16\u7a0b\u7231\u597d\u8005\uff0c\u8f6f\u4ef6\u5f00\u53d1\u8005\uff0c\u90fd\u80fd\u8fc5\u901f\u7684\u5f00\u542fAndroid\u5e94\u7528\u7f16\u7a0b\u4e4b\u65c5\u3002</p> <p>\u9664\u4e86Android\uff0c\u8fd8\u6709Java\uff0cPython\uff0cNestJS\uff0cWebRTC\u7684\u5185\u5bb9\uff0c\u4f9b\u8bfb\u8005\u53c2\u8003\u3002</p> <p>\u6700\u8fd1\u66f4\u65b0\u7684\u5185\u5bb9\u5728 \ud83d\udd25\u6700\u8fd1\u66f4\u65b0</p>"},{"location":"tech-note-index/#android","title":"Android \u65b0\u624b","text":"<p>\u7b14\u8005\u9ed8\u8ba4\u8bfb\u8005\u6709\u4e00\u5b9a\u7684Java\u57fa\u7840\u6216\u8005Kotlin\u57fa\u7840\uff0c\u4eceAndroid\u5e94\u7528\u5f00\u53d1\u6700\u57fa\u7840\u7684\u5165\u624b\u3002\u5efa\u8bae\u7684\u89c2\u770b\u8def\u5f84\u5982\u4e0b:</p> \u94fe\u63a5 \u7c7b\u522b Hello World\uff0c\u65b0\u5efaAndroid App\u5de5\u7a0b \u5f00\u59cbAndroid\u4e4b\u65c5 \u8ba4\u8bc6\u754c\u9762\uff0c\u8ba4\u8bc6Activity \u754c\u9762\u5165\u95e8 \u5728\u754c\u9762\u4e0a\u663e\u793a\u6587\u5b57\uff0cTextView\u662f\u7528\u6765\u663e\u793a\u6587\u5b57\u7684ui\u63a7\u4ef6 \u57fa\u7840\u63a7\u4ef6\uff0c\u663e\u793a\u6587\u5b57 \u5bf9\u7528\u6237\u7684\u70b9\u51fb\u505a\u51fa\u53cd\u5e94\uff0c\u4f7f\u7528\u6309\u94aeButton \u57fa\u7840\u63a7\u4ef6\uff0c\u6309\u94ae \u5982\u4f55\u6392\u5e03\u5f88\u591a\u4e2aui\u63a7\u4ef6\uff1f\u6a2a\u7740\u6392\u6216\u8005\u7ad6\u7740\u6392\uff0c\u7ebf\u6027\u5e03\u5c40LinearLayout \u63a7\u4ef6\u7684\u5e03\u5c40 \u627e\u4e2a\u53c2\u7167\u7269\uff0c\u653e\u5728\u53c2\u7167\u7269\u7684\u4e0a\u9762\u4e0b\u9762\u5de6\u8fb9\u53f3\u8fb9\uff0c\u76f8\u5bf9\u5e03\u5c40RelativeLayout \u63a7\u4ef6\u7684\u5e03\u5c40 \u6709\u4ec0\u4e48\u5e03\u5c40\u80fd\u540c\u65f6\u6709\u7ebf\u6027\u548c\u76f8\u5bf9\u7684\u529f\u80fd\uff1f\u81ea\u9002\u5e94\u7684ConstraintLayout \u63a7\u4ef6\u7684\u5e03\u5c40 \u53ea\u6709\u6587\u5b57\u592a\u5355\u8c03\u4e86\uff0c\u7528\u56fe\u7247\u6765\u589e\u6dfb\u8272\u5f69\uff0cImageView\u663e\u793a\u56fe\u7247 \u663e\u793a\u56fe\u7247 \u505a\u4e2a\u5217\u8868\uff0c\u4e00\u5927\u4e32\u4fe1\u606f - RecyclerView \u5217\u8868 \u63a5\u6536\u7528\u6237\u8f93\u5165\u7684\u4fe1\u606f\uff0c\u4f7f\u7528EditText \u8f93\u5165\u6587\u5b57 <p>\u81f3\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u505a\u4e00\u4e2a\u7b80\u5355\u7684\u80fd\u5c55\u793a\u4fe1\u606f\u7684app\u4e86</p>"},{"location":"tech-note-index/#_2","title":"\u8001\u624b","text":"<p>\u672c\u7ad9\u5185\u5bb9\u662f\u7b14\u8005\u5de5\u4f5c\u5b66\u4e60\u4e2d\u7684\u6280\u672f\u8bb0\u5f55\u3002\u8bfb\u8005\u8bf7\u6839\u636e\u81ea\u5df1\u9700\u8981\u9605\u8bfb\u3002</p> <p>\u6269\u5c55\u91cc\u9762\u6709WebRTC\uff0ciOS\uff0cCocos Creator\u7684\u4e00\u4e9b\u5185\u5bb9</p> \u6587\u7ae0\u5927\u7eb2 <p>\u9010\u6b65\u52a0\u5165\u65b0\u7684\u5185\u5bb9\uff0c\u4e0d\u9650\u4e8eAndroid\uff0c\u4e5f\u6709WebRTC\u76f8\u5173\u6587\u7ae0</p> \u6559\u7a0b \u7b80\u4ecb Android\u65b0\u5efa\u5de5\u7a0b Hello world! \u5f00\u59cb\u7684\u5f00\u59cb\uff0c\u4f7f\u7528Android Studio\u3002 Android\u591a\u7ebf\u7a0b \u4ecb\u7ecdAndroid\u5e94\u7528\u5f00\u53d1\u4e2d\u7684\u591a\u7ebf\u7a0b\u3002\u6d89\u53ca\u5230\u7684\u7c7b\u6709Thread\u3001Handler\u3001\u7ebf\u7a0b\u6c60\u3001WorkManager\u7b49\u3002 Activity \u7cbe\u5f69\u7eb7\u5448\u7684\u754c\u9762\uff0c\u7528\u6237\u770b\u5f97\u89c1\u6478\u7684\u7740\u7684\u4e1c\u897f\u3002Activity\u627f\u8f7d\u7740\u7528\u6237\u4ea4\u4e92\u7684\u529f\u80fd\u3002 TextView \u6587\u5b57\uff0c\u662f\u6211\u4eec\u4f20\u8fbe\u4fe1\u606f\u7684\u4e00\u79cd\u5e38\u89c1\u65b9\u5f0f\u3002\u5728Android App\u4e0a\u663e\u793a\u6587\u5b57\uff0c\u6211\u4eec\u901a\u5e38\u4f7f\u7528TextView\u3002 res\u7b80\u4ecb \u8d44\u6e90\u662f\u6307\u4ee3\u7801\u4f7f\u7528\u7684\u9644\u52a0\u6587\u4ef6\u548c\u9759\u6001\u5185\u5bb9\uff0c\u4f8b\u5982\u4f4d\u56fe\u3001\u5e03\u5c40\u5b9a\u4e49\u3001\u754c\u9762\u5b57\u7b26\u4e32\u3001\u52a8\u753b\u8bf4\u660e\u7b49\u3002 RecyclerView \u5217\u8868\u7684\u8868\u73b0\u5f62\u5f0f\u3002Android\u5f00\u53d1\u4e2d\u7528RecyclerView\u6765\u5b9e\u73b0\u5217\u8868\u6548\u679c\u3002 Fragment Fragment\uff0c\u76f4\u8bd1\u4e3a\u201c\u788e\u7247\u201d\uff0c\u201c\u7247\u6bb5\u201d\u3002Fragment \u8868\u793a FragmentActivity \u4e2d\u7684\u884c\u4e3a\u6216\u754c\u9762\u7684\u4e00\u90e8\u5206\u3002 Broadcast \u901a\u8fc7\u5e7f\u64ad\u4ece\u7cfb\u7edf\u6216\u5176\u4ed6App\u63a5\u6536\u6216\u53d1\u9001\u6d88\u606f\u3002\u7c7b\u4f3c\u4e8e\u8ba2\u9605-\u53d1\u5e03\u8bbe\u8ba1\u6a21\u5f0f\u3002\u5f53\u67d0\u4e9b\u4e8b\u4ef6\u53d1\u751f\u65f6\uff0c\u53ef\u4ee5\u53d1\u51fa\u5e7f\u64ad\u3002\u7cfb\u7edf\u5728\u67d0\u4e9b\u72b6\u6001\u6539\u53d8\u65f6\u4f1a\u53d1\u51fa\u5e7f\u64ad\uff0c\u4f8b\u5982\u5f00\u673a\u3001\u5145\u7535\u3002 Handler \u4ece\u6e90\u7801\u89d2\u5ea6\u5206\u6790Handler\u3002\u6709\u5229\u4e8e\u4f7f\u7528Handler\u548c\u5206\u6790Handler\u7684\u76f8\u5173\u95ee\u9898\u3002\u8ba4\u8bc6Looper\u4e0eHandler\u7684\u5173\u7cfb\u3002 \u6570\u636e\u5e93 \u4f7f\u7528room\u64cd\u4f5c\u6570\u636e\u5e93 io/\u8bfb\u5199\u6587\u4ef6 \u8bfb\u5199csv\uff0chex\uff0cjson\u6587\u4ef6 MappedByteBuffer \u4e00\u79cd\u5185\u5b58\u6620\u5c04\u6587\u4ef6\u7684\u65b9\u6cd5\uff08memory-mapped\uff09\uff0c\u5373\u5c06\u4e00\u4e2a\u6587\u4ef6\u6216\u8005\u5176\u5b83\u5bf9\u8c61\u6620\u5c04\u5230\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u5b9e\u73b0\u6587\u4ef6\u78c1\u76d8\u5730\u5740\u548c\u8fdb\u7a0b\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u4e00\u6bb5\u865a\u62df\u5730\u5740\u7684\u4e00\u4e00\u5bf9\u6620\u5173\u7cfb\u3002 databinding \u66f4\u8f7b\u677e\u5730\u7f16\u5199\u53ef\u4e0e\u89c6\u56fe\u4ea4\u4e92\u7684\u4ee3\u7801 \u81ea\u5b9a\u4e49View \u4e30\u5bcc\u591a\u5f69\u7684\u81ea\u5b9a\u4e49\u63a7\u4ef6 WebView \u5728app\u4e2d\u76f4\u63a5\u663e\u793a\u7f51\u9875\u3002 MediaPlayer MediaPlayer\u7684\u57fa\u672c\u6982\u5ff5\uff0c\u72b6\u6001\uff0c\u5e38\u7528\u7684\u65b9\u6cd5\u4e0e\u76d1\u542c\u5668\u3002 NDK \u7528C++\u6765\u7f16\u5199app\u7684\u529f\u80fd\uff1f\u64cd\u4f5c\u57fa\u672c\u7c7b\u578b\uff0cString\uff0c\u8bfb\u5199\u6587\u4ef6 adb \u8c03\u8bd5Android\u8bbe\u5907 Java Java\u57fa\u7840\u3002\u5f00\u53d1Android App\u9700\u8981\u7528\u5230\u7684Java\u77e5\u8bc6 \u8bbe\u8ba1\u6a21\u5f0f \u8ba9\u7f16\u5199\u4ee3\u7801\u53d8\u5f97\u66f4\u6709\u6548 <p>\u6587\u7ae0\u4ecd\u5728\u6574\u7406\u4e2d\u3002\u5982\u679c\u6709\u610f\u89c1\u548c\u5efa\u8bae\uff0c\u6b22\u8fce\u8054\u7cfb\u6211\u3002</p>"},{"location":"tech-note-index/#_3","title":"\u5176\u4ed6\u5185\u5bb9","text":"<ul> <li>SimpleChat NestJS\u5b9e\u73b0\u7684\u5b9e\u65f6\u804a\u5929\u4f8b\u5b50</li> <li>  WebRTC   WebRTC\u7684\u6982\u5ff5\u7b80\u4ecb\u548c\u7f51\u9875\u793a\u4f8b</li> </ul> \u8054\u7cfb\u65b9\u5f0f <p>\u94c1\u624b\u6e14\u592b AnRFDev - Android RustFisher Developer \u5176\u4ed6\u5e73\u53f0:  </p> <p>\u4e34\u6cb3\u800c\u7fa1\u9c7c\uff0c\u4e0d\u5982\u5f52\u5bb6\u7ed3\u7f51\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801 \u7b14\u8bb0\u94fe\u63a5\u5708\u5708</p>"},{"location":"about/fr/","title":"\u53cb\u94fe","text":"<p>RustFisher cnblogs</p> <p>RustFisher-cnblogs</p> <p>\ud83d\udd27 \u8bb0\u5f55\u4e86\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u5b66\u5230\u7684\u4e00\u4e9b\u4e1c\u897f\u548c\u9047\u5230\u7684\u4e00\u4e9b\u95ee\u9898\u3002</p> <p>\u7f16\u7a0b\u5999\u5999\u5c4b</p> <p>\u7f16\u7a0b\u5999\u5999\u5c4b</p> <p>\u521b\u7ad9\u76ee\u6807\u4e3a\u77e5\u8bc6\u5206\u4eab\uff0c\u4ee5\u7f16\u7a0b\u76f8\u5173\u6280\u672f\u4e3a\u4e3b\u3002\u5e0c\u671b\u80fd\u591f\u5728\u63d0\u5347\u81ea\u5df1\u6280\u672f\u3001\u5de9\u56fa\u81ea\u5df1\u529f\u529b\u7684\u540c\u65f6\u5e2e\u52a9\u4ed6\u4eba\u3002</p> <p>\u7ad9\u957f\u4e25\u683c\u575a\u6301\u535a\u5ba2\u7ad9\u7684\u6838\u5fc3\u5b88\u5219: \u5185\u5bb9\u4e3a\u738b\u3001\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u6298\u817e\uff0c\u4ee5\u6700\u5c0f\u7684\u4ee3\u4ef7\u8f93\u51fa\u6700\u591a\u6700\u4f18\u8d28\u7684\u5185\u5bb9\u3002</p> <p>Ponkan's Blog</p> <p>Ponkan's Blog</p> <p>Android\u5de5\u7a0b\u5e08\uff0c\u79fb\u52a8\u7aef\uff0c\u524d\u7aef\u3002</p> <p>Cyber &amp; Robot</p> <p>Cyber &amp; Robot</p> <p>\ud83c\udf89 \u5d4c\u5165\u5f0f\u65b9\u9762\u7684\u6280\u672f\u535a\u5ba2\u3002</p>"},{"location":"about/site-dev-note/","title":"\u672c\u7ad9\u5f00\u53d1\u7ef4\u62a4\u8bb0\u5f55","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2023-1-18 <ul> <li>2023-1-18 \u6dfb\u52a0\u8bc4\u8bba\u529f\u80fd</li> <li>2023-1-17 \u8f6c\u79fb\u5230github.io</li> <li>2022-7-20 \u66f4\u65b0<code>image_url</code>\u8bf4\u660e</li> <li>2022-7-13 \u66f4\u65b0\u8bf4\u660e</li> <li>2022-7-8 \u66f4\u65b0\u8bf4\u660e</li> <li>2019-11-7 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u8bb0\u5f55\u672c\u7ad9\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u7528\u5230\u7684\u4e1c\u897f\u3002\u4f8b\u5982\u8bbe\u7f6e\u4ee3\u7801\u5757\u6e32\u67d3\uff0c\u7ed9\u9996\u9875\u589e\u52a0\u6ce2\u7eb9\u6548\u679c\u3002\u589e\u52a0header\u7684\u914d\u7f6e\u3002nginx\u7684\u914d\u7f6e\u7b49\u7b49\u3002</p>"},{"location":"about/site-dev-note/#_2","title":"\u8bc4\u8bba\u529f\u80fd","text":"<p>\u6dfb\u52a0\u8bc4\u8bba\u529f\u80fd\u3002\u5148\u5728\u5b98\u7f51\u627e\u5230\u5f15\u5bfc\u3002</p> <p>\u7136\u540e\u5728\u81ea\u5df1\u7684 main.html \u91cc\u628a comments.html \u52a0\u4e0a</p> <p></p> <p>\u9700\u8981\u52a0\u8bc4\u8bba\u7684\u6587\u7ae0\uff0c\u6587\u7ae0\u5f00\u5934\u914d\u7f6e\u91cc\u5199 <pre><code>comments: true\n</code></pre></p>"},{"location":"about/site-dev-note/#_3","title":"\u4ee3\u7801\u5757\u6e32\u67d3","text":"<p>mkdocs\u652f\u6301\u7684\u4ee3\u7801\u5757\u79cd\u7c7b\u8981\u67e5\u770b pygments.org - lexers</p> <p>\u6bd4\u5982\u914d\u7f6e\u6587\u4ef6\uff0c\u8981\u7528 <code>aconf</code> \u800c\u4e0d\u662f conf</p>"},{"location":"about/site-dev-note/#home","title":"home\u5e95\u90e8\u6ce2\u7eb9\u6548\u679c","text":"<p>\u6548\u679c\u53c2\u8003\u7684\u662f\uff1ahttp://www.htmleaf.com/css3/css3donghua/201804045056.html</p> <p>\u5728home\u9875\u5e95\u90e8\u6dfb\u52a0\u4e00\u70b9\u6ce2\u7eb9\u7684\u52a8\u6001\u6548\u679c\u3002</p> <p>\u56fe\u7247\u653e\u5165\u76ee\u5f55 <code>about/_media/home</code></p> <p>overrides/home.html \u6dfb\u52a0\u5185\u5bb9\u5230footer\u4e2d</p> home.html home.html\u6dfb\u52a0\u7684\u90e8\u5206<pre><code>&lt;!-- Application footer --&gt;\n\n&lt;style&gt;\n@keyframes move_wave {\n    0% {\n        transform: translateX(0) translateZ(0) scaleY(1)\n    }\n    50% {\n        transform: translateX(-25%) translateZ(0) scaleY(0.55)\n    }\n    100% {\n        transform: translateX(-50%) translateZ(0) scaleY(1)\n    }\n}\n.waveWrapper {\n    overflow: hidden;\n    position: absolute;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    height: 120px;\n    margin: auto;\n}\n.waveWrapperInner {\n    position: absolute;\n    width: 100%;\n    overflow: hidden;\n    height: 120px;\n    bottom: -1px;\n    /* background-image: linear-gradient(to top, #86377b 20%, #27273c 80%); */\n}\n.bgTop {\n    z-index: 15;\n    opacity: 0.5;\n}\n.bgMiddle {\n    z-index: 10;\n    opacity: 0.75;\n}\n.bgBottom {\n    z-index: 5;\n}\n.wave {\n    position: absolute;\n    left: 0;\n    width: 200%;\n    height: 120px;\n    background-repeat: repeat no-repeat;\n    background-position: 0 bottom;\n    transform-origin: center bottom;\n}\n.waveTop {\n    background-size: 50% 100px;\n}\n.waveAnimation .waveTop {\nanimation: move-wave 3s;\n-webkit-animation: move-wave 3s;\n-webkit-animation-delay: 1s;\nanimation-delay: 1s;\n}\n.waveMiddle {\n    background-size: 50% 120px;\n}\n.waveAnimation .waveMiddle {\n    animation: move_wave 10s linear infinite;\n}\n.waveBottom {\n    background-size: 50% 100px;\n}\n.waveAnimation .waveBottom {\n    animation: move_wave 15s linear infinite;\n}\n&lt;/style&gt;\n&lt;div class=\"waveWrapper waveAnimation\"&gt;\n&lt;div class=\"waveWrapperInner bgTop\"&gt;\n    &lt;div class=\"wave waveTop\" style=\"background-image: url('about/_media/home/wave-top.png')\"&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;div class=\"waveWrapperInner bgMiddle\"&gt;\n    &lt;div class=\"wave waveMiddle\" style=\"background-image: url('about/_media/home/wave-mid.png')\"&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;div class=\"waveWrapperInner bgBottom\"&gt;\n    &lt;div class=\"wave waveBottom\" style=\"background-image: url('about/_media/home/wave-bot.png')\"&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;/div&gt;\n</code></pre>"},{"location":"about/site-dev-note/#_4","title":"\u5de6\u8fb9\u5bfc\u822a\u680f\u81ea\u52a8\u5b9a\u4f4d","text":"<p>\u6a21\u677f\u91cc\u6dfb\u52a0jquery\u3002\u9700\u8981\u5ef6\u8fdf\u6267\u884c<code>scrollIntoView</code>\uff0c\u8fd8\u9700\u8981\u8c03\u6574\u4e00\u4e0b\u6574\u4e2awindow\u7684Y\u8f74\u6eda\u52a8</p> html <pre><code>&lt;script src=\"https://cdn.staticfile.org/jquery/1.10.0/jquery.min.js\" charset=\"utf-8\"&gt; &lt;/script&gt;\n\n&lt;script&gt;\n// Scroll active item in table of contents into view\n$.fn.isInViewport = function () {\n    var elementTop = $(this).offset().top;\n    var elementBottom = elementTop + $(this).outerHeight();\n    var viewportTop = $(window).scrollTop();\n    var viewportBottom = viewportTop + $(window).height();\n    return elementBottom &gt; viewportTop &amp;&amp; elementTop &lt; viewportBottom;\n};\nsetTimeout(() =&gt; {\nvar activeLink = $(\"a.md-nav__link--active\");\nif (!activeLink.isInViewport()) {\n    activeLink[0].scrollIntoView(true);\n    if(window.scrollY &gt; 10) {\n        window.scrollBy(0, -window.scrollY);\n    }\n    //console.log('scroll link into view');\n    }\n}, 300)\n</code></pre>"},{"location":"about/site-dev-note/#emoji","title":"emoji","text":""},{"location":"about/site-dev-note/#githubhtml","title":"github\u56fe\u8868\u7684html","text":"<pre><code>&lt;span class=\"twemoji\"&gt;&lt;svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\"&gt;&lt;path fill-rule=\"evenodd\" d=\"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z\"&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/span&gt;\n</code></pre>"},{"location":"about/site-dev-note/#gitee","title":"gitee","text":"<p> <pre><code>&lt;span class=\"twemoji\"&gt;&lt;img src=\"https://raw.githubusercontent.com/squidfunk/mkdocs-material/master/material/.icons/simple/gitee.svg\"&gt;&lt;/span&gt;\n</code></pre></p>"},{"location":"about/site-dev-note/#webrtc","title":"WebRTC\u7cfb\u5217","text":"<ul> <li>WebRTC\u6982\u5ff5\u7b80\u4ecb</li> <li>WebRTC\u6253\u5f00\u6444\u50cf\u5934</li> <li>WebRTC\u89c6\u9891\u5206\u8fa8\u7387</li> <li>WebRTC\u622a\u53d6\u672c\u5730\u89c6\u9891\u5e27</li> <li>WebRTC\u4e0ecss\u6ee4\u955c</li> <li>WebRTC\u4e0e\u5f55\u5236\u89c6\u9891</li> <li>WebRTC\u672c\u5730\u5206\u4eab\u5c4f\u5e55\uff0c\u5f55\u5236\u5c4f\u5e55</li> </ul>"},{"location":"about/site-dev-note/#_5","title":"\u7f51\u9875\u7684\u6807\u7b7e","text":"<pre><code>&lt;!-- Open Graph data --&gt;\n&lt;meta property=\"og:title\" content=\"Title\" /&gt;\n&lt;meta property=\"og:type\" content=\"article\" /&gt;\n&lt;meta property=\"og:url\" content=\"http://www.example.com/\" /&gt;\n&lt;meta property=\"og:image\" content=\"http://example.com/image.jpg\" /&gt;\n&lt;meta property=\"og:description\" content=\"Description\" /&gt;\n&lt;meta property=\"og:site_name\" content=\"Site Name\" /&gt;\n\n&lt;meta property=\"article:published_time\" content=\"2015-11-11T19:08:47+01:00\" /&gt;\n&lt;meta property=\"article:modified_time\" content=\"2015-11-11T19:08:47+01:00\" /&gt;\n&lt;meta property=\"article:section\" content=\"Article Section\" /&gt;\n&lt;meta property=\"article:tag\" content=\"Article Tag\" /&gt;\n</code></pre>"},{"location":"about/site-dev-note/#_6","title":"\u7f51\u9875\u7684\u56fe\u7247\u6807\u7b7e","text":"<p>md\u6587\u4ef6\u91cc\uff0c\u5934\u90e8\u52a0\u4e0a <code>image_url: about/_media/cover/nginx-green-512-m.png</code></p> <p>main.html \u91cc\u8bfb\u53d6\u8fd9\u4e2a<code>image_url</code></p> <p></p>"},{"location":"about/site-dev-note/#adsence","title":"adsence\u5e7f\u544a","text":"<p>\u5728overrides/main.html\u91cc\u52a0\u4e0a</p> <pre><code>&lt;script async src=\"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\"&gt;&lt;/script&gt;\n  &lt;!-- android-wiki-ad-1 --&gt;\n  &lt;ins class=\"adsbygoogle\" style=\"display:block\" data-ad-client=\"ca-pub-7286632197002340\" data-ad-slot=\"1962135890\"\n      data-ad-format=\"auto\" data-full-width-responsive=\"true\"&gt;&lt;/ins&gt;\n  &lt;script&gt;\n      (adsbygoogle = window.adsbygoogle || []).push({});\n  &lt;/script&gt;\n</code></pre>"},{"location":"about/site-dev-note/#nginx","title":"nginx\u914d\u7f6e\u5907\u4efd","text":"conf <pre><code># static Android wiki site\n# update 2022-1-30\n# redirect to www \n\nserver {\n    listen 80;\n    server_name an.rustfisher.com www.an.rustfisher.com;\n    rewrite ^/(.*) https://www.an.rustfisher.com/$1 permanent;\n}\n\nserver {\n    listen 443 ssl;\n    ssl on;\n    ssl_session_timeout 5m;\n    ssl_certificate /home/ubuntu/server/ssl/1_an.rustfisher.com_bundle.crt;\n    ssl_certificate_key /home/ubuntu/server/ssl/2_an.rustfisher.com.key;        \n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2; #\u6309\u7167\u8fd9\u4e2a\u534f\u8bae\u914d\u7f6e\n    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;##\u6309\u7167\u8fd9\u4e2a\u5957\u4ef6\u914d\u7f6e\n    ssl_prefer_server_ciphers on;\n\n    server_name an.rustfisher.com;\n    rewrite ^/(.*) https://www.an.rustfisher.com/$1 permanent;\n#    location / {\n#        root /home/ubuntu/server/wiki-site/an-rf-wiki;\n#        index index.html index.htm;\n#    }\n}\n\nserver {\n    listen 443 ssl;\n    ssl on;\n    ssl_session_timeout 5m;\n    ssl_certificate /home/ubuntu/server/ssl/1_www.an.rustfisher.com_bundle.crt;\n    ssl_certificate_key /home/ubuntu/server/ssl/2_www.an.rustfisher.com.key;        \n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2; #\u6309\u7167\u8fd9\u4e2a\u534f\u8bae\u914d\u7f6e\n    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;##\u6309\u7167\u8fd9\u4e2a\u5957\u4ef6\u914d\u7f6e\n    ssl_prefer_server_ciphers on;\n\n    server_name www.an.rustfisher.com;\n\n    location / {\n        root /home/ubuntu/server/wiki-site/an-rf-wiki;\n        index index.html index.htm;\n    }\n}\n</code></pre>"},{"location":"about/site-dev-note/#_7","title":"\u6258\u7ba1","text":"<p>\u7f51\u7ad9\u8d44\u6e90\u8f6c\u79fb\u5230github.io\u8fdb\u884c\u6258\u7ba1\u3002</p> <p>\u56fe\u7247\u3001js\u7b49\u9759\u6001\u8d44\u6e90\uff0c\u653e\u5165<code>about</code>\u76ee\u5f55\u4e2d\u3002</p> <p>\u7f16\u8bd1\u51fa\u6765\u7684\u9759\u6001\u8d44\u6e90\u5b58\u653e\u5728 anrfdev-github-io.pages.dev </p>"},{"location":"about/sponsor-author/","title":"\u6295\u5582\u4f5c\u8005RustFisher","text":"<p>\u5185\u5bb9\u4f9d\u65e7\u5728\u6269\u5145\u4e2d\u3002\u5982\u679c\u89c9\u5f97\u7f51\u7ad9\u5185\u5bb9\u5bf9\u60a8\u6709\u5e2e\u52a9\uff0c\u53ef\u4ee5\u8bf7\u4f5c\u8005\u559d\u676f\u5496\u5561\uff08\u6216\u725b\u5976\uff09\u3002</p> \u652f\u4ed8\u5b9d <p>\u975e\u5e38\u611f\u8c22\u60a8\u80fd\u6253\u5f00\u8fd9\u4e2a\u9875\u9762</p> <p></p> \u5fae\u4fe1 <p>\u975e\u5e38\u611f\u8c22\u60a8\u80fd\u6253\u5f00\u8fd9\u4e2a\u9875\u9762</p> <p></p> <p>~</p> \u611f\u8c22\u652f\u6301 <p>\u975e\u5e38\u611f\u8c22\u4ee5\u4e0b\u8bfb\u8005\u7684\u6295\u5582\ud83e\udd5b\uff0c\u6709\u4e86\u4f60\u4eec\u7684\u652f\u6301\uff0cRustFisher\u7684\u7f51\u7ad9\u4f1a\u8d8a\u505a\u8d8a\u597d</p> \u65e5\u671f \u6635\u79f0 \u91d1\u989d \u7559\u8a00 2023/5/3 *\u6d0b 10 2023/4/26 \u4f9d\u7136\u8303\u7279\u897f 1 \u6559\u7a0b\u5f88\u68d2 2022/10/22 w*h 3 2022/8/10 h*r 3 \u4e09\u514b\u6cb9 for Android 2022/1/22 s*u 1 \u5b89\u5353\u6559\u7a0b\u5199\u7684\u5f88\u597d 2021/12/14 *\u5668 1 \u611f\u8c22\u5927\u4f6c"},{"location":"android/android-part-index/","title":"Android\u603b\u89c8","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2022-6-6 <ul> <li>2022-6-6\uff1a \u66f4\u65b0\u6587\u6863</li> </ul> <p>Android\u65b0\u624b\u6559\u7a0b\u3002\u7a81\u51fa\u4e00\u4e2a\u7b80\u5355\u660e\u4e86\uff0c\u4e0a\u624b\u5feb\u3002</p> <p>\u4ece\u5b9e\u7528\u6027\u51fa\u53d1\uff0c\u5feb\u901f\u638c\u63e1Android\u5f00\u53d1\u57fa\u672c\u6280\u80fd\u3002</p> <p>\u5f00\u59cb</p> <p>\u4e0b\u8f7dAndroid Studio\uff0c\u65b0\u5efaAndroid app\u5de5\u7a0b\u3002\u5c1d\u8bd5\u4f7f\u7528Kotlin\uff08\u53ef\u9009\uff09</p> <p>\u65b0\u5efaAndroid App\u5de5\u7a0b \u4f7f\u7528Kotlin</p> <p>Activity</p> <p>Activity\u662fAndroid\u5e94\u7528\u5f00\u53d1\u4e2d\u5e38\u89c1\u7684\u7ec4\u4ef6\u3002</p> <p>App\u4e2d\u4e0e\u7528\u6237\u4ea4\u4e92\u7684\u5927\u4efb\u7531Activity\u6765\u627f\u62c5\u3002\u5f53\u7528\u6237\u624b\u6307\u70b9\u51fb\u624b\u673a\u5c4f\u5e55\u65f6\uff0cAndroid\u7cfb\u7edf\u68c0\u6d4b\u5230\u5c4f\u5e55\u53d1\u751f\u7684\u4e8b\u60c5\uff0c\u5c06\u8fd9\u4e00\u4e8b\u4ef6\u5206\u53d1\u5bf9\u5e94\u7684App\u5904\u7406\u3002</p> <p>Activity\u7efc\u8ff0 Activity\u542f\u52a8\u6a21\u5f0f \u5236\u4f5c\u7b80\u5355\u7684launcher</p> <p>Service</p> <p>Service\u662f\u4e00\u79cd\u53ef\u5728\u540e\u53f0\u6267\u884c\u957f\u65f6\u95f4\u8fd0\u884c\u64cd\u4f5c\u800c\u4e0d\u63d0\u4f9b\u754c\u9762\u7684\u5e94\u7528\u7ec4\u4ef6\u3002</p> <p>\u670d\u52a1\u53ef\u7531\u5176\u4ed6\u5e94\u7528\u7ec4\u4ef6\u542f\u52a8\uff0c\u800c\u4e14\u5373\u4f7f\u7528\u6237\u5207\u6362\u5230\u5176\u4ed6\u5e94\u7528\uff0c\u670d\u52a1\u4ecd\u5c06\u5728\u540e\u53f0\u7ee7\u7eed\u8fd0\u884c\u3002</p> <p>Service\u7efc\u8ff0 \u542f\u52a8\u524d\u53f0\u670d\u52a1 \u540e\u53f0\u670d\u52a1</p> <p>Broadcast</p> <p>Android\u5e94\u7528\u53ef\u4ee5\u901a\u8fc7\u5e7f\u64ad\u4ece\u7cfb\u7edf\u6216\u5176\u4ed6App\u63a5\u6536\u6216\u53d1\u9001\u6d88\u606f\u3002\u7c7b\u4f3c\u4e8e\u8ba2\u9605-\u53d1\u5e03\u8bbe\u8ba1\u6a21\u5f0f\u3002\u5f53\u67d0\u4e9b\u4e8b\u4ef6\u53d1\u751f\u65f6\uff0c\u53ef\u4ee5\u53d1\u51fa\u5e7f\u64ad\u3002</p> <p>\u7cfb\u7edf\u5728\u67d0\u4e9b\u72b6\u6001\u6539\u53d8\u65f6\u4f1a\u53d1\u51fa\u5e7f\u64ad\uff0c\u4f8b\u5982\u5f00\u673a\u3001\u5145\u7535\u3002App\u4e5f\u53ef\u53d1\u9001\u81ea\u5b9a\u4e49\u5e7f\u64ad\u3002\u5e7f\u64ad\u53ef\u7528\u4e8e\u5e94\u7528\u95f4\u7684\u901a\u8baf\uff0c\u662fIPC\u7684\u4e00\u79cd\u65b9\u5f0f\u3002</p> <p>\u5e7f\u64ad\u673a\u5236Broadcast\u4ecb\u7ecd\u4e0e\u4f7f\u7528 \u76d1\u542c\u5c4f\u5e55\u4eae\u706d</p> <p>Fragment</p> <p>Fragment\uff0c\u76f4\u8bd1\u4e3a\u201c\u788e\u7247\u201d\uff0c\u201c\u7247\u6bb5\u201d\u3002</p> <p>\u53ef\u4ee5\u5c06\u7247\u6bb5\u89c6\u4e3a Activity \u7684\u6a21\u5757\u5316\u7ec4\u6210\u90e8\u5206\uff0c\u5b83\u5177\u6709\u81ea\u5df1\u7684\u751f\u547d\u5468\u671f\uff0c\u80fd\u63a5\u6536\u81ea\u5df1\u7684\u8f93\u5165\u4e8b\u4ef6\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728 Activity \u8fd0\u884c\u65f6\u6dfb\u52a0\u6216\u79fb\u9664\u7247\u6bb5\u3002</p> <p>Fragment\u4ecb\u7ecd DialogFragment\u7684\u4e00\u4e9b\u5c5e\u6027</p> <p>NDK</p> <p>Android NDK \u662f\u4e00\u4e2a\u5de5\u5177\u96c6\uff0c\u53ef\u4f7f\u7528 C \u548c C++ \u7b49\u8bed\u8a00\u4ee5\u539f\u751f\u4ee3\u7801\u5b9e\u73b0\u5e94\u7528\u7684\u5404\u4e2a\u90e8\u5206\u3002</p> <p>\u8fdb\u4e00\u6b65\u63d0\u5347\u8bbe\u5907\u6027\u80fd\uff0c\u4ee5\u964d\u4f4e\u5ef6\u8fdf\u6216\u8fd0\u884c\u6e38\u620f\u6216\u7269\u7406\u6a21\u62df\u7b49\u8ba1\u7b97\u5bc6\u96c6\u578b\u5e94\u7528\u3002</p> <p>\u91cd\u590d\u4f7f\u7528 C \u6216 C++ \u5e93\u3002 </p> <p>NDK\u73af\u5883\u8bbe\u7f6e \u65b0\u5efa\u652f\u6301C/C++\u7684\u5de5\u7a0b \u9879\u76ee\u6dfb\u52a0C/C++\u652f\u6301</p>"},{"location":"android/activity/act_lifecycle/","title":"Activity \u751f\u547d\u5468\u671f","text":"\u66f4\u65b0\u65e5\u671f 2021-9-1 <ul> <li>2021-9-1 \u4fee\u6539\u683c\u5f0f</li> <li>2020-8-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u524d\u9762\u6211\u4eec\u770b\u4e86Activity\u7684\u7efc\u8ff0\u3002\u672c\u6587\u6211\u4eec\u6765\u770b\u5b83\u7684\u751f\u547d\u5468\u671f\u3002</p> <p>Android\u5b98\u65b9\u6587\u6863\u4ecb\u7ecd\u7684\u5f88\u8be6\u7ec6\u3002 \u8fd9\u91cc\u6211\u4eec\u6253\u4e00\u4e9blog\u4ed4\u7ec6\u89c2\u5bdf\u4e00\u4e0b\u751f\u547d\u5468\u671f\u7684\u53d8\u5316\u3002</p> \u751f\u547d\u5468\u671f\u56fe\u793a <p></p>","tags":["Android Activity"]},{"location":"android/activity/act_lifecycle/#_1","title":"\u751f\u547d\u5468\u671f\u53d8\u5316","text":"<p>\u6267\u884c\u4e00\u4e9b\u5e38\u89c1\u7684\u64cd\u4f5c\uff0c\u6253log\u770b\u4e00\u4e0b\u751f\u547d\u5468\u671f\u7684\u53d8\u5316\u3002\u6d4b\u8bd5\u673a\u578b\uff1aRedMi\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/act_lifecycle/#_2","title":"\u542f\u52a8\u7136\u540e\u9000\u51fa","text":"\u542f\u52a8\u7136\u540e\u9000\u51fa <pre><code>onCreate\nonStart\nonResume\nonWindowFocusChanged: hasFocus: true\n\nonWindowFocusChanged: hasFocus: false\nonPause\nonStop\nonDestroy\n</code></pre>","tags":["Android Activity"]},{"location":"android/activity/act_lifecycle/#home","title":"\u542f\u52a8\u540e\u6309home\u952e","text":"\u542f\u52a8\u540e\u6309home\u952e <pre><code>Act1: onCreate\nAct1: onStart\nAct1: onResume\nAct1: onWindowFocusChanged: hasFocus: true\n\n// \u6309home\u952e\nAct1: onWindowFocusChanged: hasFocus: false\nAct1: onPause\nAct1: onStop\n\n// \u518d\u56de\u6765\nAct1: onRestart\nAct1: onStart\nAct1: onResume\nAct1: onWindowFocusChanged: hasFocus: true\n\n// \u6309\u8fd4\u56de\u952e\u9000\u51faact\nAct1: onWindowFocusChanged: hasFocus: false\nAct1: onPause\nAct1: onStop\nAct1: onDestroy\n</code></pre>","tags":["Android Activity"]},{"location":"android/activity/act_lifecycle/#_3","title":"\u65cb\u8f6c\u624b\u673a","text":"\u65cb\u8f6c\u624b\u673a <p>activity\u5728\u5207\u6362\u6a2a\u7ad6\u5c4f\u7684\u65f6\u5019\u7684\u751f\u547d\u5468\u671f\u3002</p> <p><pre><code>[Life]: onCreate\n[Life]: onStart\n[Life]: onResume\n[Life]: onWindowFocusChanged: hasFocus: true\n\n// \u6a2a\u5c4f\n[Life]: onPause\n[Life]: onStop\n[Life]: onDestroy\n[Life]: onCreate\n[Life]: onStart\n[Life]: onResume\n[Life]: onWindowFocusChanged: hasFocus: true\n\n// \u7ad6\u5c4f\n[Life]: onPause\n[Life]: onStop\n[Life]: onDestroy\n[Life]: onCreate\n[Life]: onStart\n[Life]: onResume\n[Life]: onWindowFocusChanged: hasFocus: true\n\n// \u8fd4\u56de\n[Life]: onWindowFocusChanged: hasFocus: false\n[Life]: onPause\n[Life]: onStop\n[Life]: onDestroy\n</code></pre> \u6574\u4e2a\u8fc7\u7a0b\u5e76\u6ca1\u6709\u8d70onRestart\u65b9\u6cd5\u3002\u66f4\u50cf\u662f\u91cd\u65b0\u542f\u52a8activity\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/act_lifecycle/#_4","title":"\u6765\u56de\u5207\u6362","text":"\u6765\u56de\u5207\u6362\u7684\u751f\u547d\u5468\u671f\u53d8\u5316 <p>\u4ee52\u4e2aActivity\u542f\u52a8\u4e3a\u4f8b\u3002 <pre><code>Act1: onCreate\nAct1: onStart\nAct1: onResume\nAct1: onWindowFocusChanged: hasFocus: true\nAct1: onPause\nAct1: onWindowFocusChanged: hasFocus: false\nAct2: onCreate\nAct2: onStart\nAct2: onResume\nAct2: onWindowFocusChanged: hasFocus: true\nAct1: onStop\nAct2: onWindowFocusChanged: hasFocus: false\nAct2: onPause\nAct1: onRestart\nAct1: onStart\nAct1: onResume\nAct1: onWindowFocusChanged: hasFocus: true\nAct2: onStop\nAct2: onDestroy\nAct1: onWindowFocusChanged: hasFocus: false\nAct1: onPause\nAct1: onStop\nAct1: onDestroy\n</code></pre> \u53ef\u4ee5\u770b\u5230\uff0c\u542f\u52a8act2\u7684\u65f6\u5019\uff0cact1\u663e\u793a\u5931\u53bb\u4e86\u5c4f\u5e55\u7126\u70b9\uff0c\u7136\u540e\u8fdb\u5165onPause\uff1b Act2\u542f\u52a8\u5e76\u53ef\u89c1\u540e\uff0cact1\u6765\u5230onStop\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/act_lifecycle/#alertdialog","title":"\u5f39\u51faAlertDialog","text":"\u5f39\u51faAlertDialog <p>\u70b9\u51fb\u6309\u94ae\u5f39\u51fa\u4e00\u4e2a<code>AlertDialog</code>\u3002\u89c2\u5bdf\u53d1\u73b0\u8c03\u7528\u4e86<code>onWindowFocusChanged</code>\u3002</p> <pre><code>onWindowFocusChanged: hasFocus: false\nonWindowFocusChanged: hasFocus: true\n</code></pre> <p>\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u7528DialogFragment\u6765\u505a\u6d4b\u8bd5\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/act_lifecycle/#recreate","title":"recreate","text":"\u8c03\u7528 recreate() \u65b9\u6cd5 <p><pre><code>[Life]: onCreate\n[Life]: onStart\n[Life]: onResume\n[Life]: onWindowFocusChanged: hasFocus: true\n[Life]: click [recreate]\n[Life]: onPause\n[Life]: onStop\n[Life]: onDestroy\n[Life]: onCreate\n[Life]: onStart\n[Life]: onResume\n</code></pre> \u53ef\u4ee5\u770b\u5230\uff0c\u8c03\u7528<code>recreate()</code>\u65b9\u6cd5\u540e\u5e76\u6ca1\u6709\u8d70<code>onWindowFocusChanged</code>\u56de\u8c03\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/act_lifecycle/#oncreateonstart","title":"onCreate\u548conStart\u7684\u533a\u522b","text":"<p>activity\u7684\u72b6\u6001\u533a\u522b</p> <ul> <li><code>onCreate</code>\u5728\u7cfb\u7edf\u9996\u6b21\u521b\u5efa Activity \u65f6\u89e6\u53d1\u3002Activity\u4f1a\u5728\u521b\u5efa\u540e\u8fdb\u5165\u5df2\u521b\u5efa\u72b6\u6001\u3002</li> <li>\u5f53 Activity \u8fdb\u5165\u201c\u5df2\u5f00\u59cb\u201d\u72b6\u6001\u65f6\uff0c\u7cfb\u7edf\u4f1a\u8c03\u7528\u6b64\u56de\u8c03\u3002<code>onStart()</code> \u8c03\u7528\u4f7f Activity \u5bf9\u7528\u6237\u53ef\u89c1\uff0c\u56e0\u4e3a\u5e94\u7528\u4f1a\u4e3a Activity \u8fdb\u5165\u524d\u53f0\u5e76\u652f\u6301\u4ea4\u4e92\u505a\u51c6\u5907\u3002</li> </ul> <p><code>onStart()</code> \u65b9\u6cd5\u4f1a\u975e\u5e38\u5feb\u901f\u5730\u5b8c\u6210\uff0c\u5e76\u4e14\u4e0e\u201c\u5df2\u521b\u5efa\u201d\u72b6\u6001\u4e00\u6837\uff0cActivity \u4e0d\u4f1a\u4e00\u76f4\u5904\u4e8e\u201c\u5df2\u5f00\u59cb\u201d\u72b6\u6001\u3002\u4e00\u65e6\u6b64\u56de\u8c03\u7ed3\u675f\uff0cActivity \u4fbf\u4f1a\u8fdb\u5165\u5df2\u6062\u590d\u72b6\u6001\uff0c\u7cfb\u7edf\u5c06\u8c03\u7528 <code>onResume()</code> \u65b9\u6cd5\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/act_lifecycle/#onpauseonstop","title":"onPause\u548conStop\u7684\u533a\u522b","text":"<p><code>onPause()</code> \u6267\u884c\u975e\u5e38\u7b80\u5355\uff0c\u800c\u4e14\u4e0d\u4e00\u5b9a\u8981\u6709\u8db3\u591f\u7684\u65f6\u95f4\u6765\u6267\u884c\u4fdd\u5b58\u64cd\u4f5c\u3002 \u56e0\u6b64\uff0c\u60a8\u4e0d\u5e94\u4f7f\u7528 <code>onPause()</code> \u6765\u4fdd\u5b58\u5e94\u7528\u6216\u7528\u6237\u6570\u636e\u3001\u8fdb\u884c\u7f51\u7edc\u8c03\u7528\uff0c\u6216\u6267\u884c\u6570\u636e\u5e93\u4e8b\u52a1\u3002\u56e0\u4e3a\u5728\u8be5\u65b9\u6cd5\u5b8c\u6210\u4e4b\u524d\uff0c\u6b64\u7c7b\u5de5\u4f5c\u53ef\u80fd\u65e0\u6cd5\u5b8c\u6210\u3002</p> <p>\u5df2\u8fdb\u5165\u5df2\u505c\u6b62\u72b6\u6001\uff0c\u56e0\u6b64\u7cfb\u7edf\u5c06\u8c03\u7528 <code>onStop()</code> \u56de\u8c03\u3002\u4e3e\u4f8b\u800c\u8a00\uff0c\u5982\u679c\u65b0\u542f\u52a8\u7684 Activity \u8986\u76d6\u6574\u4e2a\u5c4f\u5e55\uff0c\u5c31\u53ef\u80fd\u4f1a\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u3002</p> <p>\u5728 <code>onStop()</code> \u65b9\u6cd5\u4e2d\uff0c\u5e94\u7528\u5e94\u91ca\u653e\u6216\u8c03\u6574\u5e94\u7528\u5bf9\u7528\u6237\u4e0d\u53ef\u89c1\u65f6\u7684\u65e0\u7528\u8d44\u6e90\u3002\u4f8b\u5982\uff0c\u5e94\u7528\u53ef\u4ee5\u6682\u505c\u52a8\u753b\u6548\u679c\uff0c\u6216\u4ece\u7ec6\u7c92\u5ea6\u4f4d\u7f6e\u66f4\u65b0\u5207\u6362\u5230\u7c97\u7c92\u5ea6\u4f4d\u7f6e\u66f4\u65b0\u3002 \u4f7f\u7528 <code>onStop()</code> \u800c\u975e <code>onPause()</code> \u53ef\u786e\u4fdd\u4e0e\u754c\u9762\u76f8\u5173\u7684\u5de5\u4f5c\u7ee7\u7eed\u8fdb\u884c\uff0c\u5373\u4f7f\u7528\u6237\u5728\u591a\u7a97\u53e3\u6a21\u5f0f\u4e0b\u67e5\u770b\u60a8\u7684 Activity \u4e5f\u80fd\u5982\u6b64\u3002 \u60a8\u8fd8\u5e94\u8be5\u4f7f\u7528 <code>onStop()</code> \u6267\u884c CPU \u76f8\u5bf9\u5bc6\u96c6\u7684\u5173\u95ed\u64cd\u4f5c\u3002</p> <p>\ud83e\uddd1\ud83c\udffb\u200d\ud83d\udcbb \u793a\u4f8b\u4ee3\u7801</p>","tags":["Android Activity"]},{"location":"android/activity/activity-result-launcher/","title":"Android Activity Result Launcher","text":"\u66f4\u65b0\u65e5\u671f 2023-06-01 <ul> <li>2023-06-01 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u542f\u52a8activity\u7684\u65f6\u5019\u53ef\u4ee5\u4f20\u9012\u4e00\u4e9b\u53c2\u6570\u3002\u90a3\u4e48\u5728\u5173\u95edactivity\u65f6\uff0c\u80fd\u4e0d\u80fd\u5c06\u4e00\u4e9b\u6570\u636e\u4f20\u56de\u4e0a\u4e00\u4e2aactivity\u5462\uff1f</p> <p>\u672c\u6587\u7ed9\u51fa1\u4e2a\u4f8b\u5b50\uff0c\u5b9e\u73b0\u5173\u95edactivity\u65f6\uff0c\u5c06\u4e00\u4e9b\u6570\u636e\u4f20\u56de\u7ed9\u4e0a\u4e00\u4e2aactivity\u3002</p> <p>\u4f8b\u5b50\u4e2d\u4f1a\u67092\u4e2aActivity\u6765\u505a\u793a\u8303\uff0c<code>ForResultResultLauncher1Act</code>\u548c<code>ForResultSecondAct</code>\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/activity-result-launcher/#_1","title":"\u4f7f\u7528\u793a\u4f8b","text":"","tags":["Android Activity"]},{"location":"android/activity/activity-result-launcher/#activity","title":"\u542f\u52a8\u65b0\u7684Activity","text":"<p><code>ForResultResultLauncher1Act</code>\u662f\u7b2c\u4e00\u4e2aActivity\u3002</p> <pre><code>import android.content.Intent;\nimport android.os.Bundle;\nimport android.util.Log;\nimport android.widget.TextView;\nimport android.widget.Toast;\n\nimport androidx.activity.result.ActivityResultLauncher;\nimport androidx.activity.result.contract.ActivityResultContracts;\n\nimport com.rustfisher.baselib.AbsActivity;\n\n/**\n * \u6f14\u793a\u8fd4\u56de\u662f\u4f20\u9012\u53c2\u6570\n */\npublic class ForResultResultLauncher1Act extends AbsActivity {\n    private TextView mTitleTv;\n    private TextView mSubTitleTv;\n\n    private ActivityResultLauncher&lt;Intent&gt; mEditInfoLauncher;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        TAG += \"1\";\n        setContentView(R.layout.act_for_res_first);\n        mTitleTv = findViewById(R.id.tv1);\n        mSubTitleTv = findViewById(R.id.tv2);\n\n        findViewById(R.id.edit_btn).setOnClickListener(v -&gt; mEditInfoLauncher.launch(new Intent(getApplicationContext(), ForResultSecondAct.class)));\n\n        mEditInfoLauncher = registerForActivityResult(new ActivityResultContracts.StartActivityForResult(), result -&gt; {\n            Log.i(TAG, \"\u4fee\u6539\u6635\u79f0\u8fd4\u56de\uff1a \" + result);\n            if (result.getResultCode() == RESULT_OK) {\n                mTitleTv.setText(result.getData().getStringExtra(ForResultSecondAct.K_TITLE));\n                mSubTitleTv.setText(result.getData().getStringExtra(ForResultSecondAct.K_SUB_TITLE));\n            } else {\n                Toast.makeText(getApplicationContext(), \"\u672a\u4fdd\u5b58\u4fee\u6539\", Toast.LENGTH_SHORT).show();\n            }\n        });\n    }\n}\n</code></pre> <p>\u542f\u52a8\u7b2c\u4e8c\u4e2aActivity\u65f6\uff0c\u7528\u5230\u4e86ActivityResultLauncher\u3002</p> <p>\u8c03\u7528<code>registerForActivityResult</code>\u65b9\u6cd5\u6ce8\u518c\u8fd4\u56de\u65f6\u7684\u7ed3\u679c\u4e8b\u4ef6\u3002\u56de\u4f20\u7684\u6570\u636e\u5728<code>result</code>\u4e2d\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/activity-result-launcher/#_2","title":"\u88c5\u8f7d\u56de\u4f20\u6570\u636e","text":"<p><code>ForResultSecondAct</code>\u662f\u7b2c\u4e8c\u4e2aactivity\u3002\u5b83\u53ef\u4ee5\u8bbe\u7f6e\u8fd4\u56de\u65f6\u643a\u5e26\u7684\u6570\u636e\u3002 <pre><code>Intent resultIntent = new Intent();\nresultIntent.putExtra(K_TITLE, mTitleEt.getText().toString());\nresultIntent.putExtra(K_SUB_TITLE, mSubTitleEt.getText().toString());\nsetResult(RESULT_OK, resultIntent);\nfinish();\n</code></pre></p> <p><code>RESULT_OK</code>\u662fActivity\u7c7b\u7684\u9759\u6001\u5e38\u91cf\u3002\u53ef\u7528\u4e8e\u4ee3\u8868\u64cd\u4f5c\u7684\u7ed3\u679c\u3002 <pre><code>/** Standard activity result: operation canceled. */\npublic static final int RESULT_CANCELED    = 0;\n/** Standard activity result: operation succeeded. */\npublic static final int RESULT_OK           = -1;\n/** Start of user-defined activity results. */\npublic static final int RESULT_FIRST_USER   = 1;\n</code></pre></p>","tags":["Android Activity"]},{"location":"android/activity/activity-result-launcher/#_3","title":"\u53c2\u8003","text":"<ul> <li>Android Activity \u8fd4\u56de\u65f6\u643a\u5e26\u53c2\u6570</li> </ul>","tags":["Android Activity"]},{"location":"android/activity/activity-tran-animation/","title":"Activity\u8fc7\u573a\u52a8\u753b\u6548\u679c","text":"\u66f4\u65b0\u65e5\u671f 2022-2-3 <ul> <li>2022-2-3 \u521b\u5efa\u6587\u6863</li> </ul> <p>Activity\u5207\u6362\u7684\u65f6\u5019\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e9b\u8fc7\u573a\u52a8\u753b\u3002\u4f8b\u5982\u6307\u5b9a\u5165\u573a\u548c\u9000\u573a\u7684\u6ed1\u52a8\u65b9\u5411\u3002</p>","tags":["Android Activity","Android\u52a8\u753b"]},{"location":"android/activity/activity-tran-animation/#_1","title":"\u5b9a\u4e49\u52a8\u753b","text":"<p>\u6211\u4eec\u5148\u5b9a\u4e49\u4e00\u4e9b\u52a8\u753bxml\u5728<code>drawable</code>\u76ee\u5f55\u4e2d</p>","tags":["Android Activity","Android\u52a8\u753b"]},{"location":"android/activity/activity-tran-animation/#_2","title":"\u4ece\u5de6\u5230\u53f3\u5165\u573a","text":"<p><code>enter_from_left_to_right.xml</code>\uff0c\u4ece\u5de6\u5230\u53f3\u5165\u573a <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;translate xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:duration=\"@android:integer/config_shortAnimTime\"\n    android:fromXDelta=\"-100%p\"\n    android:toXDelta=\"0%p\" /&gt;\n</code></pre></p> <p>\u53ef\u4ee5\u770b\u51fax\u8f74\u65b9\u5411\u4e0a\u7684\u52a8\u753b\u4f7f\u7528\u7684\u662f<code>fromXDelta</code>\u548c<code>toXDelta</code>\u5c5e\u6027\u3002</p>","tags":["Android Activity","Android\u52a8\u753b"]},{"location":"android/activity/activity-tran-animation/#_3","title":"\u53f3\u5230\u5de6\u5165\u573a","text":"<p><code>enter_from_right_to_left.xml</code>\uff0c\u53f3\u5230\u5de6\u5165\u573a <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;translate xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:duration=\"@android:integer/config_shortAnimTime\"\n    android:fromXDelta=\"100%p\"\n    android:toXDelta=\"0%p\" /&gt;\n</code></pre></p>","tags":["Android Activity","Android\u52a8\u753b"]},{"location":"android/activity/activity-tran-animation/#_4","title":"\u4ece\u5de6\u8fb9\u9000\u573a","text":"<p><code>exit_to_left.xml</code>\uff0c\u4ece\u5de6\u8fb9\u9000\u573a <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;translate xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:duration=\"@android:integer/config_shortAnimTime\"\n    android:fromXDelta=\"0%p\"\n    android:toXDelta=\"-100%p\" /&gt;\n</code></pre></p>","tags":["Android Activity","Android\u52a8\u753b"]},{"location":"android/activity/activity-tran-animation/#_5","title":"\u4ece\u53f3\u8fb9\u9000\u573a","text":"<p><code>exit_to_right.xml</code>\uff0c\u4ece\u53f3\u8fb9\u9000\u573a <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;translate xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:duration=\"@android:integer/config_shortAnimTime\"\n    android:fromXDelta=\"0%p\"\n    android:toXDelta=\"100%p\" /&gt;\n</code></pre></p>","tags":["Android Activity","Android\u52a8\u753b"]},{"location":"android/activity/activity-tran-animation/#_6","title":"\u4f7f\u7528\u52a8\u753b","text":"<p>\u7136\u540e\u5728<code>styles.xml</code>\u4e2d\u5b9a\u4e49\u4f7f\u7528\u7684\u52a8\u753b\u6548\u679c\u3002</p> <pre><code>&lt;style name=\"AppMainTheme\" parent=\"Theme.AppCompat.NoActionBar\"&gt;\n    &lt;item name=\"android:windowAnimationStyle\"&gt;@style/DefActivityAnimation&lt;/item&gt;\n&lt;/style&gt;\n\n&lt;!-- \u6307\u5b9a\u8fc7\u573a\u52a8\u753b --&gt;\n&lt;style name=\"DefActivityAnimation\"&gt;\n    &lt;item name=\"android:activityOpenExitAnimation\"&gt;@anim/exit_to_left&lt;/item&gt;\n    &lt;item name=\"android:activityOpenEnterAnimation\"&gt;@anim/enter_from_right_to_left&lt;/item&gt;\n    &lt;item name=\"android:activityCloseExitAnimation\"&gt;@anim/exit_to_right&lt;/item&gt;\n    &lt;item name=\"android:activityCloseEnterAnimation\"&gt;@anim/enter_from_left_to_right&lt;/item&gt;\n&lt;/style&gt;\n</code></pre> <p>\u53c2\u8003</p> <ul> <li>res\u76ee\u5f55\u7b80\u4ecb</li> <li>Android\u52a8\u753b</li> </ul>","tags":["Android Activity","Android\u52a8\u753b"]},{"location":"android/activity/floating-scale-act/","title":"Android \u5e94\u7528\u5185\u60ac\u6d6e\u7a97 Activity","text":"\u66f4\u65b0\u65e5\u671f: 2022-5-17 <ul> <li>2022-5-17 \u589e\u52a0\u6269\u5c55\u9605\u8bfb</li> <li>2022-1-4 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u60ac\u6d6e\u7a97\u662f\u4e00\u79cd\u6bd4\u8f83\u5e38\u89c1\u7684\u9700\u6c42\u3002\u4f8b\u5982\u628a\u89c6\u9891\u901a\u8bdd\u754c\u9762\u7f29\u5c0f\u6210\u4e00\u4e2a\u60ac\u6d6e\u7a97\uff0c\u7136\u540e\u7528\u6237\u53ef\u4ee5\u5728\u5176\u4ed6\u754c\u9762\u4e0a\u5904\u7406\u4e8b\u60c5\u3002</p> <p>\u672c\u6587\u7ed9\u51fa\u4e00\u4e2a\u7b80\u5355\u7684\u5e94\u7528\u5185\u60ac\u6d6e\u7a97\u5b9e\u73b0\u3002\u53ef\u7f29\u5c0factivity\u548c\u8fd8\u539f\u5927\u5c0f\u3002\u53ef\u60ac\u6d6e\u5728\u540c\u4e00\u4e2aapp\u7684\u5176\u4ed6activity\u4e0a\u3002\u4f7f\u7528TouchListener\u76d1\u542c\u89e6\u6478\u4e8b\u4ef6\uff0c\u62d6\u52a8\u60ac\u6d6e\u7a97\u3002</p> <p>\u672c\u6587\u94fe\u63a5</p>","tags":["Android Activity","\u60ac\u6d6e\u7a97"]},{"location":"android/activity/floating-scale-act/#_1","title":"\u7f29\u653e\u65b9\u6cd5","text":"<p>\u7f29\u653eactivity\u9700\u8981\u4f7f\u7528WindowManager.LayoutParams\uff0c\u63a7\u5236window\u7684\u5bbd\u9ad8</p> <p>\u5728activity\u4e2d\u8c03\u7528 <pre><code>android.view.WindowManager.LayoutParams p = getWindow().getAttributes();\np.height = 480; // \u9ad8\u5ea6\np.width = 360;  // \u5bbd\u5ea6\np.dimAmount = 0.0f; // \u4e0d\u8ba9\u4e0b\u9762\u7684\u754c\u9762\u53d8\u6697 (1)\ngetWindow().setAttributes(p);\n</code></pre></p> <ol> <li>dim: adj. \u6697\u6de1\u7684; \u660f\u6697\u7684; \u5fae\u5f31\u7684; \u4e0d\u660e\u4eae\u7684; \u5149\u7ebf\u6697\u6de1\u7684; v.(\u4f7f)\u53d8\u6697\u6de1\uff0c\u53d8\u5fae\u5f31\uff0c\u53d8\u660f\u6697; (\u4f7f)\u51cf\u5f31\uff0c\u53d8\u6de1\u6f20\uff0c\u5931\u53bb\u5149\u6cfd;</li> </ol> <p>\u4fee\u6539\u4e86WindowManager.LayoutParams\u7684\u5bbd\u9ad8\uff0cactivity\u7684window\u5927\u5c0f\u4f1a\u53d1\u751f\u53d8\u5316\u3002</p> <p>\u8981\u53d8\u56de\u9ed8\u8ba4\u5927\u5c0f\uff0c\u5728activity\u4e2d\u8c03\u7528 <pre><code>getWindow().setLayout(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);\n</code></pre></p> <p>\u5982\u679c\u7f29\u5c0f\u65f6\u6539\u53d8\u4e86\u4f4d\u7f6e\uff0c\u9700\u8981\u628awindow\u7684\u4f4d\u7f6e\u7f6e\u4e3a0 <pre><code>WindowManager.LayoutParams lp = getWindow().getAttributes();\nlp.x = 0;\nlp.y = 0;\ngetWindow().setAttributes(lp);\n</code></pre></p> <p>activity\u53d8\u5c0f\u65f6\uff0c\u540e\u9762\u53ef\u80fd\u662f\u9ed1\u8272\u7684\u80cc\u666f\u3002\u8fd9\u9700\u8981\u8fdb\u884c\u4e0b\u9762\u7684\u64cd\u4f5c\u3002</p>","tags":["Android Activity","\u60ac\u6d6e\u7a97"]},{"location":"android/activity/floating-scale-act/#_2","title":"\u60ac\u6d6e\u6837\u5f0f","text":"<p>\u5728<code>styles.xml</code>\u91cc\u65b0\u5efa\u4e00\u4e2a<code>MeTranslucentAct</code>\u3002 styles.xml<pre><code>&lt;resources&gt;\n    &lt;!-- Base application theme. --&gt;\n    &lt;style name=\"AppTheme\" parent=\"Theme.AppCompat.Light.DarkActionBar\"&gt;\n        &lt;!-- Customize your theme here. --&gt;\n        &lt;item name=\"colorPrimary\"&gt;@color/colorPrimary&lt;/item&gt;\n        &lt;item name=\"colorPrimaryDark\"&gt;@color/colorPrimaryDark&lt;/item&gt;\n        &lt;item name=\"colorAccent\"&gt;@color/colorAccent&lt;/item&gt;\n        &lt;item name=\"windowNoTitle\"&gt;true&lt;/item&gt;\n    &lt;/style&gt;\n\n    &lt;style name=\"TranslucentAct\" parent=\"AppTheme\"&gt;\n        &lt;item name=\"android:windowBackground\"&gt;#80000000&lt;/item&gt;\n        &lt;item name=\"android:windowIsTranslucent\"&gt;true&lt;/item&gt;\n        &lt;item name=\"android:windowAnimationStyle\"&gt;@android:style/Animation.Translucent&lt;/item&gt;\n    &lt;/style&gt;\n&lt;/resources&gt;\n</code></pre> \u4e3b\u8981style\u662fAppCompat\u7684\u3002</p> <p>\u6307\u5b9a\u4e00\u4e2awindow\u7684\u80cc\u666f<code>android:windowBackground</code> \u4f7f\u7528\u7684Activity\u7ee7\u627f\u81ea<code>androidx.appcompat.app.AppCompatActivity</code></p> <p>activity\u7f29\u5c0f\u540e\uff0c\u80cc\u666f\u662f\u900f\u660e\u7684\uff0c\u53ef\u4ee5\u770b\u5230\u540e\u9762\u7684\u5176\u4ed6\u9875\u9762</p>","tags":["Android Activity","\u60ac\u6d6e\u7a97"]},{"location":"android/activity/floating-scale-act/#_3","title":"\u70b9\u51fb\u7a7f\u900f\u7a7a\u767d","text":"<p>activity\u7f29\u5c0f\u540e\uff0c\u70b9\u51fb\u65c1\u8fb9\u7a7a\u767d\u5904\uff0c\u5176\u4ed6\u7ec4\u4ef6\u80fd\u63a5\u5230\u70b9\u51fb\u4e8b\u4ef6</p> <p>\u5728<code>onCreate</code>\u65b9\u6cd5\u7684<code>setContentView</code>\u4e4b\u524d\uff0c\u7ed9WindowManager.LayoutParams\u6dfb\u52a0\u6807\u8bb0<code>FLAG_LAYOUT_NO_LIMITS</code>\u548c<code>FLAG_NOT_TOUCH_MODAL</code> <pre><code>WindowManager.LayoutParams layoutParams = getWindow().getAttributes();\nlayoutParams.flags = WindowManager.LayoutParams.FLAG_LAYOUT_NO_LIMITS |\n        WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL;\n\nmBinding = DataBindingUtil.setContentView(this, R.layout.act_float_scale);\n</code></pre></p>","tags":["Android Activity","\u60ac\u6d6e\u7a97"]},{"location":"android/activity/floating-scale-act/#_4","title":"\u79fb\u52a8\u60ac\u6d6e\u7a97","text":"<p>\u76d1\u542c\u89e6\u6478\u4e8b\u4ef6\uff0c\u8ba1\u7b97\u51fa\u624b\u6307\u79fb\u52a8\u7684\u8ddd\u79bb\uff0c\u7136\u540e\u79fb\u52a8\u60ac\u6d6e\u7a97\u3002</p> <p>activity<pre><code>private boolean mIsSmall = false; // \u5f53\u524d\u662f\u5426\u5c0f\u7a97\u53e3\nprivate float mLastTx = 0; // \u624b\u6307\u7684\u4e0a\u4e00\u4e2a\u4f4d\u7f6ex\nprivate float mLastTy = 0;\n// ....\n\n    mBinding.root.setOnTouchListener((v, event) -&gt; {\n        switch (event.getAction()) {\n            case MotionEvent.ACTION_DOWN:\n                Log.d(TAG, \"down \" + event);\n                mLastTx = event.getRawX();\n                mLastTy = event.getRawY();\n                return true;\n            case MotionEvent.ACTION_MOVE:\n                Log.d(TAG, \"move \" + event);\n                float dx = event.getRawX() - mLastTx;\n                float dy = event.getRawY() - mLastTy;\n                mLastTx = event.getRawX();\n                mLastTy = event.getRawY();\n                Log.d(TAG, \"  dx: \" + dx + \", dy: \" + dy);\n                if (mIsSmall) {\n                    WindowManager.LayoutParams lp = getWindow().getAttributes();\n                    lp.x += dx;\n                    lp.y += dy;\n                    getWindow().setAttributes(lp);\n                }\n\n                break;\n            case MotionEvent.ACTION_UP:\n                Log.d(TAG, \"up \" + event);\n                return true;\n            case MotionEvent.ACTION_CANCEL:\n                Log.d(TAG, \"cancel \" + event);\n                return true;\n        }\n        return false;\n    });\n</code></pre> <code>mIsSmall</code>\u7528\u6765\u8bb0\u5f55\u5f53\u524dactivity\u662f\u5426\u53d8\u5c0f\uff08\u60ac\u6d6e\uff09\u3002</p> <p>\u5728\u89e6\u6478\u76d1\u542c\u5668\u4e2d\u8fd4\u56detrue\uff0c\u8868\u793a\u6d88\u8d39\u8fd9\u4e2a\u89e6\u6478\u4e8b\u4ef6\u3002</p> <p><code>event.getX()</code>\u548c<code>event.getY()</code>\u83b7\u53d6\u5230\u7684\u662f\u5f53\u524dView\u7684\u89e6\u6478\u5750\u6807\u3002 <code>event.getRawX()</code>\u548c<code>event.getRawY()</code>\u83b7\u53d6\u5230\u7684\u662f\u5c4f\u5e55\u7684\u89e6\u6478\u5750\u6807\u3002\u5373\u89e6\u6478\u70b9\u5728\u5c4f\u5e55\u4e0a\u7684\u4f4d\u7f6e\u3002</p>","tags":["Android Activity","\u60ac\u6d6e\u7a97"]},{"location":"android/activity/floating-scale-act/#_5","title":"\u4f8b\u5b50\u7684\u5b8c\u6574\u4ee3\u7801","text":"<p>\u542f\u7528\u4e86databinding <pre><code>android {\n    dataBinding {\n        enabled = true\n    }\n}\n</code></pre></p>","tags":["Android Activity","\u60ac\u6d6e\u7a97"]},{"location":"android/activity/floating-scale-act/#stylesxml","title":"styles.xml","text":"<p>\u65b0\u5efa\u4e00\u4e2a\u6837\u5f0f styles.xml<pre><code>    &lt;style name=\"TranslucentAct\" parent=\"AppTheme\"&gt;\n        &lt;item name=\"android:windowBackground\"&gt;#80000000&lt;/item&gt;\n        &lt;item name=\"android:windowIsTranslucent\"&gt;true&lt;/item&gt;\n        &lt;item name=\"android:windowAnimationStyle\"&gt;@android:style/Animation.Translucent&lt;/item&gt;\n    &lt;/style&gt;\n</code></pre></p>","tags":["Android Activity","\u60ac\u6d6e\u7a97"]},{"location":"android/activity/floating-scale-act/#layout","title":"layout","text":"<p>act_float_scale.xml\u91cc\u9762\u653e\u4e00\u4e9b\u6309\u94ae\uff0c\u63a7\u5236\u653e\u5927\u548c\u7f29\u5c0f\u3002 ConstraintLayout\u62ff\u6765\u76d1\u542c\u89e6\u6478\u4e8b\u4ef6\u3002 act_float_scale.xml<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"&gt;\n\n    &lt;androidx.constraintlayout.widget.ConstraintLayout\n        android:id=\"@+id/root\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:background=\"#555555\"&gt;\n\n        &lt;LinearLayout\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:gravity=\"center\"\n            android:orientation=\"vertical\"\n            app:layout_constraintTop_toTopOf=\"parent\"&gt;\n\n            &lt;Button\n                android:id=\"@+id/to_small\"\n                style=\"@style/NormalBtn\"\n                android:layout_width=\"wrap_content\"\n                android:layout_height=\"wrap_content\"\n                android:text=\"\u53d8\u5c0f\" /&gt;\n\n            &lt;Button\n                android:id=\"@+id/to_reset\"\n                style=\"@style/NormalBtn\"\n                android:layout_width=\"wrap_content\"\n                android:layout_height=\"wrap_content\"\n                android:layout_marginTop=\"12dp\"\n                android:text=\"\u8fd8\u539f\" /&gt;\n        &lt;/LinearLayout&gt;\n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n&lt;/layout&gt;\n</code></pre></p>","tags":["Android Activity","\u60ac\u6d6e\u7a97"]},{"location":"android/activity/floating-scale-act/#activity","title":"activity","text":"<p>FloatingScaleAct FloatingScaleAct<pre><code>import android.os.Bundle;\nimport android.util.Log;\nimport android.view.Display;\nimport android.view.MotionEvent;\nimport android.view.ViewGroup;\nimport android.view.WindowManager;\n\nimport androidx.appcompat.app.AppCompatActivity;\nimport androidx.databinding.DataBindingUtil;\n\nimport com.rustfisher.tutorial2020.R;\nimport com.rustfisher.tutorial2020.databinding.ActFloatScaleBinding;\n\npublic class FloatingScaleAct extends AppCompatActivity {\n    private static final String TAG = \"rfDevFloatingAct\";\n\n    ActFloatScaleBinding mBinding;\n\n    private boolean mIsSmall = false; // \u5f53\u524d\u662f\u5426\u5c0f\u7a97\u53e3\n    private float mLastTx = 0; // \u624b\u6307\u7684\u4e0a\u4e00\u4e2a\u4f4d\u7f6e\n    private float mLastTy = 0;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n\n        WindowManager.LayoutParams layoutParams = getWindow().getAttributes();\n        layoutParams.flags = WindowManager.LayoutParams.FLAG_LAYOUT_NO_LIMITS |\n                WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL;\n\n        mBinding = DataBindingUtil.setContentView(this, R.layout.act_float_scale);\n\n        mBinding.toSmall.setOnClickListener(v -&gt; toSmall());\n        mBinding.toReset.setOnClickListener(v -&gt; {\n            WindowManager.LayoutParams lp = getWindow().getAttributes();\n            lp.x = 0;\n            lp.y = 0;\n            getWindow().setAttributes(lp);\n            getWindow().setLayout(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);\n            mIsSmall = false;\n        });\n\n        mBinding.root.setOnTouchListener((v, event) -&gt; {\n            switch (event.getAction()) {\n                case MotionEvent.ACTION_DOWN:\n                    Log.d(TAG, \"down \" + event);\n                    mLastTx = event.getRawX();\n                    mLastTy = event.getRawY();\n                    return true;\n                case MotionEvent.ACTION_MOVE:\n                    Log.d(TAG, \"move \" + event);\n                    float dx = event.getRawX() - mLastTx;\n                    float dy = event.getRawY() - mLastTy;\n                    mLastTx = event.getRawX();\n                    mLastTy = event.getRawY();\n                    Log.d(TAG, \"  dx: \" + dx + \", dy: \" + dy);\n                    if (mIsSmall) {\n                        WindowManager.LayoutParams lp = getWindow().getAttributes();\n                        lp.x += dx;\n                        lp.y += dy;\n                        getWindow().setAttributes(lp);\n                    }\n\n                    break;\n                case MotionEvent.ACTION_UP:\n                    Log.d(TAG, \"up \" + event);\n                    return true;\n                case MotionEvent.ACTION_CANCEL:\n                    Log.d(TAG, \"cancel \" + event);\n                    return true;\n            }\n            return false;\n        });\n    }\n\n    private void toSmall() {\n        mIsSmall = true;\n\n        WindowManager m = getWindowManager();\n        Display d = m.getDefaultDisplay();\n        WindowManager.LayoutParams p = getWindow().getAttributes();\n        p.height = (int) (d.getHeight() * 0.35);\n        p.width = (int) (d.getWidth() * 0.4);\n        p.dimAmount = 0.0f;\n        getWindow().setAttributes(p);\n    }\n}\n</code></pre></p> <p>manifest\u91cc\u6ce8\u518c\u8fd9\u4e2aactivity <pre><code>&lt;activity\n    android:name=\".act.FloatingScaleAct\"\n    android:theme=\"@style/TranslucentAct\" /&gt;\n</code></pre></p>","tags":["Android Activity","\u60ac\u6d6e\u7a97"]},{"location":"android/activity/floating-scale-act/#_6","title":"\u8fd0\u884c\u6548\u679c","text":"<p>\u5728\u7ea2\u7c739A\uff08Android 10\uff0cMIUI 12.5.1 \u7a33\u5b9a\u7248\uff09\u548c\u8363\u8000\uff08Android 5.1\uff09\u4e0a\u8fd0\u884cOK</p> \u60ac\u6d6e\u7a97\u6548\u679c-\u7ea2\u7c739A <p></p>","tags":["Android Activity","\u60ac\u6d6e\u7a97"]},{"location":"android/activity/floating-scale-act/#_7","title":"\u5c0f\u7ed3","text":"<p>\u4e3a\u5b9e\u73b0\u60ac\u6d6e\u7a97\u6548\u679c\uff0c\u601d\u8def\u662f\u6539\u53d8activity\u5927\u5c0f\uff0c\u5c06activity\u6240\u5728window\u7684\u80cc\u666f\u8bbe\u7f6e\u900f\u660e\uff0c\u76d1\u542c\u89e6\u6478\u4e8b\u4ef6\u6539\u53d8window\u7684\u4f4d\u7f6e\u3002 \u4e3b\u8981\u4f7f\u7528\u7684\u7c7b WindowManager.LayoutParams</p> <p>\u60ac\u6d6e\u7a97\u6548\u679c</p> <p>\u672c\u6587\u5c55\u793a\u7684\u662f\u5e94\u7528\u5185\u7684\u60ac\u6d6eActivity\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5229\u7528SYSTEM_ALERT_WINDOW\u5b9e\u73b0\u80fd\u5728\u5176\u4ed6App\u4e0a\u51fa\u73b0\u7684\u60ac\u6d6e\u7a97\u6548\u679c</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a cnblog \u6398\u91d1 oschina csdn</p>","tags":["Android Activity","\u60ac\u6d6e\u7a97"]},{"location":"android/activity/launch-mode-task-stack/","title":"Android Activity \u542f\u52a8\u6a21\u5f0f\uff0c\u4efb\u52a1\u548c\u8fd4\u56de\u6808","text":"\u66f4\u65b0\u65e5\u671f 2020-4-20 <ul> <li>2020-4-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4ecb\u7ecdActivity\u76844\u79cd\u542f\u52a8\u6a21\u5f0f\u548c\u4efb\u52a1\uff08task\uff09\uff0c\u8fd4\u56de\u6808\uff08back stack\uff09\u6982\u5ff5\u3002</p> <p>Android\u6559\u7a0b</p> <p>\u524d\u9762\u6211\u4eec\u77e5\u9053\uff0cActivity \u662f\u4e00\u4e2a\u5e94\u7528\u7ec4\u4ef6\uff0c\u7528\u6237\u53ef\u4e0e\u5176\u63d0\u4f9b\u7684\u5c4f\u5e55\u8fdb\u884c\u4ea4\u4e92\uff0c\u4ee5\u6267\u884c\u62e8\u6253\u7535\u8bdd\u3001\u62cd\u6444\u7167\u7247\u3001\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u6216\u67e5\u770b\u5730\u56fe\u7b49\u64cd\u4f5c\u3002\u6bcf\u4e2a Activity \u90fd\u4f1a\u83b7\u5f97\u4e00\u4e2a\u7528\u4e8e\u7ed8\u5236\u5176\u7528\u6237\u754c\u9762\u7684\u7a97\u53e3\u3002\u7a97\u53e3\u901a\u5e38\u4f1a\u5145\u6ee1\u5c4f\u5e55\uff0c\u4f46\u4e5f\u53ef\u5c0f\u4e8e\u5c4f\u5e55\u5e76\u6d6e\u52a8\u5728\u5176\u4ed6\u7a97\u53e3\u4e4b\u4e0a\u3002</p> <p>\u672c\u6587\u4ecb\u7ecdActivity\u76844\u79cd\u542f\u52a8\u6a21\u5f0f\u3002\u4ecb\u7ecd\u4efb\u52a1\uff08task\uff09\uff0c\u8fd4\u56de\u6808\uff08back stack\uff09\u7684\u6982\u5ff5\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/launch-mode-task-stack/#taskback-stack","title":"\u4efb\u52a1\uff08task\uff09\uff0c\u8fd4\u56de\u6808\uff08back stack\uff09","text":"<p>\u4efb\u52a1\u662f\u6307\u5728\u6267\u884c\u7279\u5b9a\u4f5c\u4e1a\u65f6\u4e0e\u7528\u6237\u4ea4\u4e92\u7684\u4e00\u7cfb\u5217 Activity\u3002  \u8fd9\u4e9b Activity \u6309\u7167\u5404\u81ea\u7684\u6253\u5f00\u987a\u5e8f\u6392\u5217\u5728\u5806\u6808\uff08\u5373\u8fd4\u56de\u6808\uff09\u4e2d\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/launch-mode-task-stack/#activity4","title":"Activity\u76844\u79cd\u542f\u52a8\u6a21\u5f0f","text":"\u6a21\u5f0f \u8bf4\u660e standard \u591a\u4e2a\u5b9e\u4f8b\uff0c\u53ef\u53e0\u52a0 singleTask task\u4e2d\u552f\u4e00\u5b9e\u4f8b\uff0c\u53ef\u4ee5\u628a\u5728\u5b83\u4e0a\u9762\u7684activity\u5e72\u6389\u518d\u8d70onNewIntent singleTop \u591a\u5b9e\u4f8b\uff0c\u4e0d\u80fd\u53e0\u52a0\uff0c\u6808\u9876\u7684\u4f1a\u8d70onNewIntent singleInstance \u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u5e76\u4e14\u8fd9\u4e2a\u5b9e\u4f8b\u8fd0\u884c\u57281\u4e2a\u72ec\u7acbtask\u4e2d\u3002\u8fd9\u4e2atask\u4e0d\u5141\u8bb8\u5176\u4ed6\u5b9e\u4f8b\u5b58\u5728 <p>Manifest\u4e2d\u7684 launchMode \u5c5e\u6027\u6307\u5b9a\u6709\u5173\u5e94\u5982\u4f55\u5c06 Activity \u542f\u52a8\u5230\u4efb\u52a1\u4e2d\u7684\u6307\u4ee4\u3002\u60a8\u53ef\u4ee5\u5206\u914d\u7ed9 launchMode \u5c5e\u6027\u7684\u542f\u52a8\u6a21\u5f0f\u5171\u6709\u56db\u79cd\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/launch-mode-task-stack/#standard","title":"\"standard\"\uff08\u9ed8\u8ba4\u6a21\u5f0f\uff09","text":"<p>\u9ed8\u8ba4\u6a21\u5f0f\u3002\u5982\u679c\u4e0d\u6307\u5b9a\u542f\u52a8\u6a21\u5f0f\uff0c\u5219\u4f1a\u4f7f\u7528\u8fd9\u4e2a\u6a21\u5f0f\u3002 \u7cfb\u7edf\u5728\u542f\u52a8 Activity \u7684\u4efb\u52a1\u4e2d\u521b\u5efa Activity \u7684\u65b0\u5b9e\u4f8b\u5e76\u5411\u5176\u4f20\u9001 Intent\u3002Activity \u53ef\u4ee5\u591a\u6b21\u5b9e\u4f8b\u5316\uff0c\u800c\u6bcf\u4e2a\u5b9e\u4f8b\u5747\u53ef\u5c5e\u4e8e\u4e0d\u540c\u7684\u4efb\u52a1\uff0c\u5e76\u4e14\u4e00\u4e2a\u4efb\u52a1\u53ef\u4ee5\u62e5\u6709\u591a\u4e2a\u5b9e\u4f8b\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/launch-mode-task-stack/#singletop","title":"\"singleTop\"","text":"<p>\u53ef\u4ee5\u6709\u591a\u4e2a\u5b9e\u4f8b\uff0c\u4f46\u662f\u4e0d\u5141\u8bb8\u591a\u4e2a\u76f8\u540cActivity\u53e0\u52a0\u3002\u5373\uff0c\u5982\u679cActivity\u5728\u6808\u9876\u7684\u65f6\u5019\uff0c\u542f\u52a8\u76f8\u540c\u7684Activity\uff0c\u4e0d\u4f1a\u521b\u5efa\u65b0\u7684\u5b9e\u4f8b\uff0c\u800c\u4f1a\u8c03\u7528\u5176onNewIntent\u65b9\u6cd5\u3002</p> <p>\u76ee\u6807\u4f5c\u7528\u662f\u5728\u6808\u9876\u6dfb\u52a0activity\u5b9e\u4f8b\u6216\u8d70\u6808\u9876activity\u7684<code>onNewIntent()</code> \u65b9\u6cd5\u3002\u82e5\u76ee\u6807activity\u5df2\u5728\u6808\u9876\uff0c\u5219\u4e0d\u4f1a\u65b0\u5efa\u5b9e\u4f8b\u3002</p> <p>\u5982\u679c\u5f53\u524d\u4efb\u52a1\u7684\u9876\u90e8\u5df2\u5b58\u5728 Activity \u7684\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u5219\u7cfb\u7edf\u4f1a\u901a\u8fc7\u8c03\u7528\u8be5\u5b9e\u4f8b\u7684 onNewIntent() \u65b9\u6cd5\u5411\u5176\u4f20\u9001 Intent\uff0c\u800c\u4e0d\u662f\u521b\u5efa Activity \u7684\u65b0\u5b9e\u4f8b\u3002Activity \u53ef\u4ee5\u591a\u6b21\u5b9e\u4f8b\u5316\uff0c\u800c\u6bcf\u4e2a\u5b9e\u4f8b\u5747\u53ef\u5c5e\u4e8e\u4e0d\u540c\u7684\u4efb\u52a1\uff0c\u5e76\u4e14\u4e00\u4e2a\u4efb\u52a1\u53ef\u4ee5\u62e5\u6709\u591a\u4e2a\u5b9e\u4f8b\uff08\u4f46\u524d\u63d0\u662f\u4f4d\u4e8e\u8fd4\u56de\u6808\u9876\u90e8\u7684 Activity \u5e76\u4e0d\u662f Activity \u7684\u73b0\u6709\u5b9e\u4f8b\uff09\u3002</p> <p>\u4f8b\u5982\uff0c\u5047\u8bbe\u4efb\u52a1\u7684\u8fd4\u56de\u6808\u5305\u542b\u6839 Activity A \u4ee5\u53ca Activity B\u3001C \u548c\u4f4d\u4e8e\u9876\u90e8\u7684 D\uff08\u5806\u6808\u662f A-B-C-D\uff1bD \u4f4d\u4e8e\u9876\u90e8\uff09\u3002\u6536\u5230\u9488\u5bf9 D \u7c7b Activity \u7684 Intent\u3002\u5982\u679c D \u5177\u6709\u9ed8\u8ba4\u7684 \"standard\" \u542f\u52a8\u6a21\u5f0f\uff0c\u5219\u4f1a\u542f\u52a8\u8be5\u7c7b\u7684\u65b0\u5b9e\u4f8b\uff0c\u4e14\u5806\u6808\u4f1a\u53d8\u6210 A-B-C-D-D\u3002\u4f46\u662f\uff0c\u5982\u679c D \u7684\u542f\u52a8\u6a21\u5f0f\u662f \"singleTop\"\uff0c\u5219 D \u7684\u73b0\u6709\u5b9e\u4f8b\u4f1a\u901a\u8fc7 onNewIntent() \u63a5\u6536 Intent\uff0c\u56e0\u4e3a\u5b83\u4f4d\u4e8e\u5806\u6808\u7684\u9876\u90e8\uff1b\u800c\u5806\u6808\u4ecd\u4e3a A-B-C-D\u3002\u4f46\u662f\uff0c\u5982\u679c\u6536\u5230\u9488\u5bf9 B \u7c7b Activity \u7684 Intent\uff0c\u5219\u4f1a\u5411\u5806\u6808\u6dfb\u52a0 B \u7684\u65b0\u5b9e\u4f8b\uff0c\u5373\u4fbf\u5176\u542f\u52a8\u6a21\u5f0f\u4e3a \"singleTop\" \u4e5f\u662f\u5982\u6b64\u3002</p> <p>\u6ce8\uff1a\u4e3a\u67d0\u4e2a Activity \u521b\u5efa\u65b0\u5b9e\u4f8b\u65f6\uff0c\u7528\u6237\u53ef\u4ee5\u6309\u201c\u8fd4\u56de\u201d\u6309\u94ae\u8fd4\u56de\u5230\u524d\u4e00\u4e2a Activity\u3002 \u4f46\u662f\uff0c\u5f53 Activity \u7684\u73b0\u6709\u5b9e\u4f8b\u5904\u7406\u65b0 Intent \u65f6\uff0c\u5219\u5728\u65b0 Intent \u5230\u8fbe onNewIntent() \u4e4b\u524d\uff0c\u7528\u6237\u65e0\u6cd5\u6309\u201c\u8fd4\u56de\u201d\u6309\u94ae\u8fd4\u56de\u5230 Activity \u7684\u72b6\u6001\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/launch-mode-task-stack/#singletask","title":"\"singleTask\"","text":"<p>\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\u3002\u5728\u540c\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4e2d\u542f\u52a8\u4ed6\u7684\u65f6\u5019\uff0c\u82e5Activity\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u5728\u5f53\u524dtask\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5b9e\u4f8b\uff0c\u82e5\u5b58\u5728\uff0c\u5219\u4f1a\u628atask\u4e2d\u5728\u5176\u4e4b\u4e0a\u7684\u5176\u5b83Activity destory\u6389\u5e76\u8c03\u7528\u5b83\u7684onNewIntent\u65b9\u6cd5\u3002</p> <p>\u82e5\u76ee\u6807activity\u5df2\u5728\u6808\u4e2d\uff0c\u5219\u4f1a\u9500\u6bc1\u5728\u76ee\u6807activity\u4e4b\u4e0a\u7684\u5176\u4ed6\u5b9e\u4f8b\uff0c\u6b64\u65f6\u76ee\u6807activity\u6765\u5230\u6808\u9876\u3002  </p> <p>\u82e5\u76ee\u6807activity\u662f \u201cMAIN\u201d activity\uff0c\u80fd\u88abLauncher\u542f\u52a8\u3002\u90a3\u4e48\u6309home\u952e\u5c06App\u9000\u5230\u540e\u53f0\uff0c\u5728\u684c\u9762\u4e0a\u70b9\u51fbApp\u56fe\u6807\u3002\u76ee\u6807activity\u4e4b\u4e0a\u7684\u9875\u9762\u90fd\u4f1a\u88ab\u9500\u6bc1\u6389\uff0c\u5e76\u8c03\u7528\u76ee\u6807activity\u7684<code>onNewIntent()</code>\u65b9\u6cd5\u3002</p> <p>\u7cfb\u7edf\u521b\u5efa\u65b0\u4efb\u52a1\u5e76\u5b9e\u4f8b\u5316\u4f4d\u4e8e\u65b0\u4efb\u52a1\u5e95\u90e8\u7684 Activity\u3002\u4f46\u662f\uff0c\u5982\u679c\u8be5 Activity \u7684\u4e00\u4e2a\u5b9e\u4f8b\u5df2\u5b58\u5728\u4e8e\u4e00\u4e2a\u5355\u72ec\u7684\u4efb\u52a1\u4e2d\uff0c\u5219\u7cfb\u7edf\u4f1a\u901a\u8fc7\u8c03\u7528\u73b0\u6709\u5b9e\u4f8b\u7684 onNewIntent() \u65b9\u6cd5\u5411\u5176\u4f20\u9001 Intent\uff0c\u800c\u4e0d\u662f\u521b\u5efa\u65b0\u5b9e\u4f8b\u3002\u4e00\u6b21\u53ea\u80fd\u5b58\u5728 Activity \u7684\u4e00\u4e2a\u5b9e\u4f8b\u3002</p> <p>\u6ce8\uff1a\u5c3d\u7ba1 Activity \u5728\u65b0\u4efb\u52a1\u4e2d\u542f\u52a8\uff0c\u4f46\u662f\u7528\u6237\u6309\u201c\u8fd4\u56de\u201d\u6309\u94ae\u4ecd\u4f1a\u8fd4\u56de\u5230\u524d\u4e00\u4e2a Activity\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/launch-mode-task-stack/#singleinstance","title":"\"singleInstance\"","text":"<p>\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u5e76\u4e14\u8fd9\u4e2a\u5b9e\u4f8b\u72ec\u7acb\u8fd0\u884c\u5728\u4e00\u4e2atask\u4e2d\uff0c\u8fd9\u4e2atask\u53ea\u6709\u8fd9\u4e2a\u5b9e\u4f8b\uff0c\u4e0d\u5141\u8bb8\u6709\u522b\u7684Activity\u5b58\u5728\u3002</p> <p>\u4e0e \"singleTask\" \u76f8\u540c\uff0c\u53ea\u662f\u7cfb\u7edf\u4e0d\u4f1a\u5c06\u4efb\u4f55\u5176\u4ed6 Activity \u542f\u52a8\u5230\u5305\u542b\u5b9e\u4f8b\u7684\u4efb\u52a1\u4e2d\u3002\u8be5 Activity \u59cb\u7ec8\u662f\u5176\u4efb\u52a1\u552f\u4e00\u4ec5\u6709\u7684\u6210\u5458\uff1b\u7531\u6b64 Activity \u542f\u52a8\u7684\u4efb\u4f55 Activity \u5747\u5728\u5355\u72ec\u7684\u4efb\u52a1\u4e2d\u6253\u5f00\u3002</p> <p>\u4f8b\u5982\uff0cA\uff0cB\uff0cC 3\u4e2aActivity\uff0c\u53ea\u6709B\u662f\u4ee5singleInstance\u6a21\u5f0f\u542f\u52a8\uff0c\u5176\u4ed6\u662f\u9ed8\u8ba4\u6a21\u5f0f\u3002 \u9875\u9762\u542f\u52a8\u987a\u5e8f\u662f A -&gt; B -&gt; C\uff0cB\u4f1a\u81ea\u5df1\u5728\u4e00\u4e2atask\u4e2d\uff1b\u6808\u60c5\u51b5\u5982\u4e0b\uff08\u65b9\u62ec\u53f7\u8868\u793a\u5728\u524d\u53f0\uff09\uff1a <pre><code>stack    |   | =&gt; |   | |   | =&gt; |   | |   | \n         |   |    |   | |   |    | C | |   | \n         | A |    | A | | B |    | A | | B | \ntask id: [1082]   1082  [1083]   [1082] 1083\n</code></pre> \u6b64\u65f6\u5c4f\u5e55\u4e0a\u663e\u793a\u662fC\u7684\u754c\u9762\uff0c\u6309\u8fd4\u56de\u952e\uff0cC\u88ab\u9500\u6bc1\uff0c\u663e\u793a\u7684\u662fA\u7684\u754c\u9762\uff1b\u518d\u8fd4\u56de\uff0cA\u88ab\u9500\u6bc1\uff0c\u539fA\u548cC\u6240\u5728\u7684task\u7ed3\u675f\u3002\u6b64\u65f6\u663e\u793aB\u7684\u754c\u9762\u3002</p> <p>\u6309\u8fd4\u56de\u952e\u7684\u53d8\u5316\u60c5\u51b5 <pre><code>stack    |   |  |   | =&gt; |   |  |   | =&gt; |   | \n         | C |  |   |    |   |  |   |    |   | \n         | A |  | B |    | A |  | B |    | B | \ntask id: [1082] 1083     [1082] 1083     [1083]\n</code></pre></p> <p>\u5982\u679c\u5728\u53ea\u5269\u4e0bB\u7684\u65f6\u5019\uff0c\u53bb\u542f\u52a8C\uff1b\u7531\u4e8eB\u662fsingleInstance\u6a21\u5f0f\uff0cB\u6240\u5728\u7684\u6808\u53ea\u80fd\u6709\u4e00\u4e2aactivity\uff0c\u5219\u4f1a\u65b0\u5efa\u4e00\u4e2atask\u6765\u5b58\u653eC <pre><code>stack     |   | =&gt; |   | |   | \n          |   |    |   | |   | \n          | B |    | B | | C | \ntask id:  [1083]   1083  [1084]  \n</code></pre></p>","tags":["Android Activity"]},{"location":"android/activity/launch-mode-task-stack/#_1","title":"\u5c0f\u7ed3","text":"<p>\u8fd94\u79cd\u542f\u52a8\u6a21\u5f0f\u5404\u6709\u7279\u70b9\u3002\u5728\u5f00\u53d1\u4e2d\u6211\u4eec\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u9009\u62e9\u4e0d\u540c\u7684\u542f\u52a8\u6a21\u5f0f\u3002 \u4f8b\u5982\u201c\u6839\u9875\u9762\u201d\u53ef\u4ee5\u8003\u8651\u7528singleTask\u7684\u6a21\u5f0f\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/launch-send-parcelable/","title":"Android Activity \u4f20\u9012Parcelable\u5bf9\u8c61","text":"\u66f4\u65b0\u65e5\u671f 2021-9-18 <ul> <li>2021-9-18 \u66f4\u65b0\u683c\u5f0f</li> <li>2020-4-20 \u521b\u5efa</li> </ul> <p>\u524d\u9762\u6211\u4eec\u77e5\u9053\u4e86\u542f\u52a8activity\u7684\u65f6\u5019\u53ef\u4ee5\u4f20\u9012\u4e00\u4e9b\u53c2\u6570\u3002Activity\u7684\u8df3\u8f6c\u65f6\u53ef\u4ee5\u4f20\u9012Parcelable\u5bf9\u8c61\u3002</p> <p>Parcelable\u5bf9\u8c61\u548cSerializable\u4e0d\u4e00\u6837\u3002\u5b9e\u73b0\u4e86Parcelable\u63a5\u53e3\u7684\u7c7b\u5e76\u4e0d\u4f1a\u88ab\u7cfb\u7edf\u5e8f\u5217\u5316\u3002 \u63a5\u4e0b\u6765\u6211\u4eec\u7528\u4e00\u4e2a\u4f8b\u5b50\u770b\u770b\u5982\u4f55\u4f7f\u7528\u8fd9\u4e00\u63a5\u53e3\u3002</p>","tags":["Android Activity","Parcelable"]},{"location":"android/activity/launch-send-parcelable/#_1","title":"\u4f7f\u7528\u4f8b\u5b50","text":"<p>\u5148\u51c6\u5907\u6570\u636e\uff0c\u7136\u540e\u4f20\u9001Parcelable\u5bf9\u8c61\u3002</p>","tags":["Android Activity","Parcelable"]},{"location":"android/activity/launch-send-parcelable/#_2","title":"\u6570\u636e\u51c6\u5907","text":"<p>\u5148\u8bbe\u8ba1\u4e00\u4e2a\u7c7b\u5b9e\u73b0Parcelable\u63a5\u53e3\u3002\u524d\u9762\u6211\u4eec\u4f7f\u7528Serializable\u7684\u65f6\u5019\uff0c\u7c7b\u53ea\u8981\u5b9e\u73b0Serializable\u63a5\u53e3\u5373\u53ef\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u64cd\u4f5c\u3002\u4f46\u7528Parcelable\u63a5\u53e3\u4f1a\u9700\u8981\u5f00\u53d1\u8005\u591a\u505a\u4e00\u4e9b\u5de5\u4f5c\u3002</p> <p>Parcelable\u63a5\u53e3\u5728<code>android.os</code>\u5305\u91cc\uff0c\u4e0eSerializable\u4e0d\u540c\u3002\u6211\u4eec\u5fc5\u987b\u660e\u786e\u8ba4\u8bc6\u8fd9\u4e00\u70b9\u3002 \u5b98\u65b9\u7ed9\u51fa\u7684\u4e00\u4e2a\u4f7f\u7528\u4f8b\u5b50\u3002 <pre><code>public class MyParcelable implements Parcelable {\n      private int mData;\n\n      public int describeContents() {\n          return 0;\n      }\n\n      public void writeToParcel(Parcel out, int flags) {\n          out.writeInt(mData);\n      }\n\n      public static final Parcelable.Creator&lt;MyParcelable&gt; CREATOR\n              = new Parcelable.Creator&lt;MyParcelable&gt;() {\n          public MyParcelable createFromParcel(Parcel in) {\n              return new MyParcelable(in);\n          }\n\n          public MyParcelable[] newArray(int size) {\n              return new MyParcelable[size];\n          }\n      };\n\n      private MyParcelable(Parcel in) {\n          mData = in.readInt();\n      }\n}\n</code></pre> \u53ef\u4ee5\u770b\u5230\uff0c\u5f3a\u5236\u4f7f\u7528\u4e86\u4e00\u4e2a<code>Parcelable.Creator</code>\u5bf9\u8c61\u3002\u91cc\u9762\u7684\u65b9\u6cd5\u6211\u4eec\u6682\u65f6\u4e0d\u7ba1\u4e5f\u4e0d\u4fee\u6539\u3002 \u91cd\u70b9\u5173\u6ce8\u79c1\u6709\u6784\u9020\u5668<code>MyParcelable(Parcel in</code>\u548c<code>writeToParcel</code>\u65b9\u6cd5\u3002</p> <p>\u5b98\u65b9\u4f8b\u5b50\u4e2d\uff0c\u79c1\u6709\u6784\u9020\u5668\u63a5\u6536\u4e00\u4e2aParcel\u5bf9\u8c61\uff0c\u7136\u540e\u4ece\u4e2d\u8bfb\u51fa\u4e00\u4e2aint\u3002\u800c<code>writeToParcel</code>\u65b9\u6cd5\u4e2d\uff0c\u628amData\u5199\u5165Parcel\u5bf9\u8c61\u4e2d\u3002 \u8fd9\u5199\u5165\u548c\u8bfb\u51fa\u64cd\u4f5c\u5c31\u662f\u6211\u4eec\u5f00\u53d1\u8005\u9700\u8981\u7279\u522b\u5173\u5fc3\u7684\u5730\u65b9\u3002</p> <p>\u4e4b\u524d\u4f7f\u7528intent.putExtra\u65b9\u6cd5\u7684\u65f6\u5019\u4f1a\u4f20\u5165\u4e00\u4e2aString\u7c7b\u578b\u7684key\uff08\u952e\uff09\uff0c\u7528\u4e8e\u6807\u793a\u4f20\u5165\u7684\u6570\u636e\u3002 \u4f46\u5728\u5b98\u65b9\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u53ea\u770b\u5230\u4e86\u4e00\u4e2aint\u3002\u800cwriteInt\u65b9\u6cd5\u4e5f\u6ca1\u6709\u6307\u5b9akey\u3002\u7cfb\u7edf\u5982\u4f55\u533a\u5206\u51fa\u5404\u4e2a\u53c2\u6570\u5462\uff1f</p> <p>\u6211\u4eec\u81ea\u5b9a\u4e49\u4e00\u4e2a\u7c7b<code>DataParcel</code>\uff0c\u5b9e\u73b0<code>Parcelable</code>\u63a5\u53e3\u3002as\u81ea\u52a8\u5728\u91cc\u9762\u751f\u6210\u4e86CREATOR\u3002 <pre><code>import android.os.Parcel;\nimport android.os.Parcelable;\n\npublic class DataParcel implements Parcelable {\n    private int number;\n    private String str1;\n    private String str2;\n    private String noSave = \"[\u4e0d\u4f20\u9001\u7684\u5b57\u7b26\u4e32]\";\n\n    // getter setter ...\n\n    public String info() {\n        return \"number: \"+number+\", str1: \"+str1+\", str2: \"+str2+\", noSave: \"+noSave;\n    }\n\n    protected DataParcel(Parcel in) {\n        number = in.readInt();\n        str1 = in.readString();\n        str2 = in.readString();\n    }\n\n    public DataParcel(int number, String str1, String str2, String noSave) {\n        this.number = number;\n        this.str1 = str1;\n        this.str2 = str2;\n        this.noSave = noSave;\n    }\n\n    public static final Creator&lt;DataParcel&gt; CREATOR = new Creator&lt;DataParcel&gt;() {\n        @Override\n        public DataParcel createFromParcel(Parcel in) {\n            return new DataParcel(in);\n        }\n\n        @Override\n        public DataParcel[] newArray(int size) {\n            return new DataParcel[size];\n        }\n\n    };\n\n    @Override\n    public int describeContents() {\n        return 0;\n    }\n\n    @Override\n    public void writeToParcel(Parcel dest, int flags) {\n        dest.writeInt(number);\n        dest.writeString(str1);\n        dest.writeString(str2);\n    }\n}\n</code></pre> \u53ef\u4ee5\u770b\u5230\u6211\u4eec\u67091\u4e2aint\u548c3\u4e2aString\u3002\u516c\u5f00\u6784\u9020\u5668\u9700\u8981\u4f20\u5165\u8fd94\u4e2a\u5c5e\u6027\u3002</p> <p><code>writeToParcel</code>\u65b9\u6cd5\u4e2d\uff0c\u6309\u987a\u5e8f\u5199\u5165\u4e86int\u548c2\u4e2aString\u3002\u79c1\u6709\u6784\u9020\u5668\u4e2d\uff0c\u6309\u987a\u5e8f\u8bfb\u51fa\u4e86int\u548c2\u4e2aString\u3002</p> <p><code>noSave</code>\u5e76\u6ca1\u6709\u88ab\u5199\u5165\u548c\u8bfb\u51fa\u3002\u62ff\u6765\u505a\u5bf9\u6bd4\u3002<code>info()</code>\u65b9\u6cd5\u662f\u62ff\u6765\u6253\u5370\u4fe1\u606f\u7684\u3002</p>","tags":["Android Activity","Parcelable"]},{"location":"android/activity/launch-send-parcelable/#parcelable","title":"\u4f20\u9001Parcelable\u5bf9\u8c61","text":"<p>\u73b0\u5728\u6211\u4eec\u7684\u7c7b\u5df2\u7ecf\u8bbe\u8ba1\u597d\u4e86\uff0c\u4f20\u9001\u5bf9\u8c61\u8bd5\u8bd5\u3002</p> <p>\u628aDataParcel\u5bf9\u8c61\u4ea4\u7ed9intent\u3002 <pre><code>DataParcel dataParcel = new DataParcel(100, \"s1\", \"s2\", \"\u6539\u53d8\u8fd9\u4e2a\u5b57\u7b26\u4e32\u770b\u770b\u80fd\u5426\u88ab\u4f20\u9012\");\nintent.putExtra(SendParamsDemo.K_PARCEL, dataParcel);\n</code></pre></p> <p>\u88ab\u6253\u5f00\u7684Activity\u63a5\u6536\u4f20\u5165\u7684\u5bf9\u8c61\u3002 <pre><code>DataParcel dataParcel = intent.getParcelableExtra(K_PARCEL);\n</code></pre></p> <p>log\u4e2d\u6253\u5370\u51fa\u53d1\u9001\u548c\u4f20\u5165\u7684\u5bf9\u8c61\u4fe1\u606f\u3002 <pre><code>D/rustAppMainActivity: goSendParamsDemo: parcel obj: com.rustfisher.tutorial2020.act.DataParcel@d8ce985\nD/rustAppMainActivity: goSendParamsDemo: parcel obj: number: 100, str1: s1, str2: s2, noSave: \u6539\u53d8\u8fd9\u4e2a\u5b57\u7b26\u4e32\u770b\u770b\u80fd\u5426\u88ab\u4f20\u9012\n\nD/rustAppSendParamsDemo: gotInput: parcel obj: com.rustfisher.tutorial2020.act.DataParcel@d90a3a6\nD/rustAppSendParamsDemo: gotInput: number: 100, str1: s1, str2: s2, noSave: [\u4e0d\u4f20\u9001\u7684\u5b57\u7b26\u4e32]\n</code></pre> \u4ecelog\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0c\u53d1\u9001\u7684\u5bf9\u8c61\u548c\u63a5\u6536\u5230\u7684\u5bf9\u8c61\u5e76\u4e0d\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61\u3002\u4f46\u6211\u4eec\u6307\u5b9a\u7684\u90a33\u4e2a\u5c5e\u6027\u662f\u76f8\u540c\u7684\u3002</p>","tags":["Android Activity","Parcelable"]},{"location":"android/activity/launch-send-parcelable/#_3","title":"\u603b\u7ed3","text":"<p>\u81f3\u6b64\uff0c\u6211\u4eec\u4e86\u89e3\u4e86\u5982\u4f55\u4f7f\u7528Parcelable\u8fd9\u4e2a\u63a5\u53e3\u3002 Parcel\u548cParcelable\u662fAndroid IPC\u4e2d\u4f7f\u7528\u5230\u7684\u5bb9\u5668\u548c\u5de5\u5177\u3002\u5927\u5bb6\u53ef\u4ee5\u4e86\u89e3\u4e00\u4e0bBinder\u673a\u5236\u3002</p> <p>\ud83d\udcd6 Binder\u673a\u5236</p> <p>\u4e00\u822c\u8ba4\u4e3a\uff0c\u666e\u901a\u60c5\u51b5\u4e0bParcelable\u6027\u80fd\u4e0a\u4f1a\u4f18\u4e8eSerializable\u3002 Serializable\u6d89\u53ca\u5230\u5e8f\u5217\u5316\uff0c\u7cfb\u7edf\u4f1a\u901a\u8fc7\u53cd\u5c04\u7684\u65b9\u6cd5\u6765\u83b7\u53d6\u4fe1\u606f\u3002\u76f8\u5bf9\u800c\u8a00\u6bd4\u8f83\u8017\u8d44\u6e90\u3002 Parcel\u5e76\u4e0d\u6d89\u53ca\u5e8f\u5217\u5316\u673a\u5236\u3002\u5b83\u662f\u4e3a\u4e86\u9ad8\u6027\u80fdIPC\u4f20\u8f93\u8bbe\u8ba1\u7684\u3002\u56e0\u6b64\uff0cParcel\u5e76\u4e0d\u9002\u5408\u7528\u6765\u6c38\u4e45\u5316\u5b58\u50a8\u6570\u636e\u3002</p> <p>\u5b9e\u9645\u5de5\u4f5c\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u4e1a\u52a1\u9700\u8981\uff0c\u7efc\u5408\u5f00\u53d1\u65f6\u95f4\u6210\u672c\u548c\u5e94\u7528\u6027\u80fd\u8981\u6c42\uff0c\u6765\u9009\u62e9\u4f7f\u7528Parcelable\u6216\u8005Serializable\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a</p>","tags":["Android Activity","Parcelable"]},{"location":"android/activity/overview/","title":"Android Activity\u7efc\u8ff0","text":"\u66f4\u65b0\u65e5\u671f 2021-12-8 <ul> <li>2021-12-8 \u589e\u52a0Android12\u7684\u8bf4\u660e</li> <li>2021-9-1 \u4fee\u6539\u683c\u5f0f</li> <li>2020-8-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u7528\u6237\u770b\u5f97\u89c1\u6478\u7684\u7740\u7684\u662f\u624b\u673a\u5c4f\u5e55\u3002\u6211\u4eec\u8981\u5728\u624b\u673a\u5c4f\u5e55\u4e0a\u663e\u793a\u6587\u5b57\u56fe\u50cf\u7b49\u4fe1\u606f\uff0c\u5e76\u5bf9\u7528\u6237\u7684\u70b9\u51fb\u6ed1\u52a8\u7b49\u7b49\u64cd\u4f5c\u4f5c\u51fa\u4e0d\u540c\u7684\u53cd\u5e94\u3002 App\u4e2d\u4e0e\u7528\u6237\u4ea4\u4e92\u7684\u5927\u4efb\u7531Activity\u6765\u627f\u62c5\u3002\u5f53\u7528\u6237\u624b\u6307\u70b9\u51fb\u624b\u673a\u5c4f\u5e55\u65f6\uff0cAndroid\u7cfb\u7edf\u68c0\u6d4b\u5230\u5c4f\u5e55\u53d1\u751f\u7684\u4e8b\u60c5\uff0c\u5c06\u8fd9\u4e00\u4e8b\u4ef6\u5206\u53d1\u5bf9\u5e94\u7684App\u5904\u7406\u3002 \u8fd9\u91cc\u8981\u6ce8\u610f\uff0cactivity\u63a5\u6536\u5230\u7684\u662f\u7cfb\u7edf\u7ed9\u7684\u4fe1\u606f\u3002\u7cfb\u7edf\u4f1a\u5224\u65ad\u8fd9\u4e9b\u4ea4\u4e92\u6d88\u606f\u8be5\u7ed9\u54ea\u4e2aapp\u6765\u5904\u7406\u3002</p> <p>\u6216\u8005\u6362\u4e2a\u8bf4\u6cd5</p> \u7b80\u4ecb <p>Activity \u662f\u4e00\u4e2a\u5e94\u7528\u7ec4\u4ef6\uff0c\u7528\u6237\u53ef\u4e0e\u5176\u63d0\u4f9b\u7684\u5c4f\u5e55\u8fdb\u884c\u4ea4\u4e92\uff0c\u4ee5\u6267\u884c\u62e8\u6253\u7535\u8bdd\u3001\u62cd\u6444\u7167\u7247\u3001\u53d1\u9001\u7535\u5b50\u90ae\u4ef6\u6216\u67e5\u770b\u5730\u56fe\u7b49\u64cd\u4f5c\u3002 \u6bcf\u4e2a Activity \u90fd\u4f1a\u83b7\u5f97\u4e00\u4e2a\u7528\u4e8e\u7ed8\u5236\u5176\u7528\u6237\u754c\u9762\u7684\u7a97\u53e3\u3002\u7a97\u53e3\u901a\u5e38\u4f1a\u5145\u6ee1\u5c4f\u5e55\uff0c\u4f46\u4e5f\u53ef\u5c0f\u4e8e\u5c4f\u5e55\u5e76\u6d6e\u52a8\u5728\u5176\u4ed6\u7a97\u53e3\u4e4b\u4e0a\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/overview/#activity","title":"Activity\u600e\u4e48\u7528","text":"<p>\u6211\u4eec\u65b0\u5efa\u7684\u5de5\u7a0b\u4e2d\u5e26\u6709\u4e00\u4e2a\u57fa\u7840activity\u3002\u628a\u5b83\u6539\u6539\u5c31\u80fd\u7528\u3002</p> <p>\u65b0\u5efa\u5de5\u7a0b\u4e2d\uff0c\u9700\u8981\u6ce8\u610f3\u4e2a\u6587\u4ef6\u3002</p> <ul> <li>MainActivity.java \u5728src/main/java\u91cc\uff0c\u5bf9\u5e94\u7684\u5305\u540d\u76ee\u5f55\u4e0b\u3002</li> <li>activity_main.xml \u5728res/layout\u91cc\u3002</li> <li>AndroidManifest.xml \u5728src/main\u91cc\u3002\u8fd9\u91cc\u53eb\u505a\u201c\u6e05\u5355\u6587\u4ef6\u201d\u3002\u4e0b\u6587\u4f1a\u4ecb\u7ecd\u3002</li> </ul> <p>\u8fd93\u4e2a\u6587\u4ef6\u5206\u5e03\u5728\u4e0d\u540c\u7684\u5730\u65b9\u3002\u7b80\u5355\u6765\u8bf4\uff0cjava\u6587\u4ef6\u53ef\u4ee5\u63a7\u5236\u754c\u9762\u903b\u8f91\u3002</p> <p>layout\u6587\u4ef6\uff08\u8fd9\u91cc\u6307\u7684\u662factivity_main.xml\uff09\u9884\u8bbe\u4e86UI\u5982\u4f55\u6446\u653e\u3002</p> <p>\u6e05\u5355\u6587\u4ef6\u544a\u8bc9\u7cfb\u7edf\uff0c\u6211\u8fd9\u4e2aapp\u6709\u54ea\u4e9b\u7ec4\u4ef6\uff0c\u7533\u8bf7\u4e86\u4ec0\u4e48\u6743\u9650\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/overview/#layout-","title":"layout - \u754c\u9762\u5e03\u5c40","text":"<p>\u65b0\u5efa\u7684layout\u4e2d\uff0cas\u4e00\u822c\u4f1a\u9ed8\u8ba4\u7ed9\u4e00\u4e2a<code>ConstraintLayout</code>\u3002\u6bd4\u5982activity_main.xml\u3002</p> activity_main.xml <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\"&gt;\n\n    &lt;!-- \u7701\u7565\u9ed8\u8ba4\u7684TextView --&gt;\n\n&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre> <p>\u8fd9\u91cc\u4e3a\u4e86\u7528\u8d77\u6765\u65b9\u4fbf\uff0c\u6211\u4eec\u628a\u5b83\u6362\u6210LinearLayout\u3002</p> <p>\u6709\u7684\u670b\u53cb\u4f1a\u95ee\uff0c\u90fd2021\u5e74\u4e86\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u7528ConstraintLayout\uff1f</p> <p>\u73b0\u5728\u4e0d\u505a\u4ec0\u4e48\u529f\u80fd\uff0c\u5148\u7528LinearLayout\uff0c\u5c31\u662f\u4e3a\u4e86\u65b9\u4fbf\u3002 \u6362\u6210LinearLayout\u540e\uff0clayout\u6587\u4ef6\u957f\u8fd9\u6837\u3002</p> \u6362\u6210LinearLayout\u540e\u7684activity_main.xml <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\"&gt;\n\n    &lt;!-- \u7701\u7565\u9ed8\u8ba4\u7684TextView --&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6807\u7b7e\u7684\u5f00\u5934\u548c\u7ed3\u5c3e\u90fd\u6362\u6210\u4e86<code>LinearLayout</code>\u3002\u5176\u4ed6\u5730\u65b9\u6682\u65f6\u4e0d\u4fee\u6539\u3002</p> <p>as\u529f\u80fd\u5f3a\u5927\uff0c\u975e\u5e38\u4fbf\u5229\u3002\u6211\u4eec\u53ef\u4ee5\u7528\u9f20\u6807\u9009\u4e2d\u6807\u7b7e\u5f00\u59cb\u7684<code>androidx...Layout</code>\uff0c\u7136\u540e\u76f4\u63a5\u952e\u76d8\u8f93\u5165<code>LinearLayout</code>\u7684\u524d\u51e0\u4f4d\u5b57\u6bcd\u3002</p> <p>as\u4f1a\u81ea\u52a8\u5f39\u51fa\u9009\u62e9\u6846\uff0c\u5728\u91cc\u9762\u53cc\u51fb\u9009\u62e9<code>LinearLayout</code>\u6216\u8005\u56de\u8f66\u9009\u62e9\uff0c\u6807\u7b7e\u5c31\u66ff\u6362\u5b8c\u6210\u4e86\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/overview/#javakotlin-","title":"Java/Kotlin - \u63a7\u5236\u754c\u9762","text":"<p>layout\u6587\u4ef6\u8bbe\u8ba1\u7684\u662f\u754c\u9762\u7684\u521d\u59cb\u5e03\u5c40\u3002\u5b83\u51b3\u5b9a\u4e86\u521d\u59cb\u754c\u9762\u4e0a\u653e\u7740\u4ec0\u4e48UI\u7ec4\u4ef6\u4ee5\u53ca\u7ec4\u4ef6\u662f\u600e\u4e48\u7ec4\u7ec7\u5b89\u6392\u7684\u3002</p> <p>\u8fd9\u91cc\u6211\u4eec\u8bf4\u7684\u662f\u300c\u521d\u59cb\u754c\u9762\u300d\u6216\u8005\u300c\u521d\u59cb\u5e03\u5c40\u300d\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u63a7\u5236\u754c\u9762\u4e0a\u7684UI\u5143\u7d20\u3002</p> <p>\u5148\u770b\u9ed8\u8ba4\u7684 MainActivity.java\u3002\u5728<code>onCreate</code>\u65b9\u6cd5\u91cc\uff0c<code>R.layout.activity_main</code>\u6307\u7684\u5c31\u662factivity_main.xml\u3002</p> <p>\u73b0\u5728layout\u4e2d\u6709\u4e00\u4e2aTextView\uff0c\u5b83\u53ef\u4ee5\u7528\u6765\u663e\u793a\u6587\u5b57\u3002\u6211\u4eec\u60f3\u5728<code>MainActivity</code>\u4e2d\u63a7\u5236\u5b83\uff0c\u8be5\u600e\u4e48\u505a\u5462\uff1f</p> <p>\u73b0\u5728\u6539\u4e00\u4e0b\u8fd9\u4e2aTextView\u3002\u5220\u6389\u539f\u6765ConstraintLayout\u7528\u5230\u7684\u90a3\u4e9b\u5c5e\u6027\u3002</p> <p>\u7ed9\u5b83\u6dfb\u52a0\u4e00\u4e2aid\u3002\u8fd9\u4e2aid\u5728\u8fd9\u4e2alayout\u6587\u4ef6\u4e2d\u5fc5\u987b\u662f\u72ec\u4e00\u65e0\u4e8c\u7684\u3002\u7ed9\u5b83\u5206\u914d\u4e00\u4e2aid\u53eb\u505a<code>tv1</code>\uff0c\u5c31\u50cf\u4e0b\u9762\u3002 <pre><code>&lt;TextView\n    android:id=\"@+id/tv1\"\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"\n    android:text=\"Hello World!\" /&gt;\n</code></pre> \u73b0\u5728TextView\u6709\u4e86\u300c\u8eab\u4efd\u8bc1\u300d\uff0c\u6211\u4eec\u5728activity\u4e2d\u5c31\u53ef\u4ee5\u627e\u5230\u5b83\u3002\u7528\u7684\u662f<code>findViewById</code>\u65b9\u6cd5\u3002 <pre><code>TextView tv1 = findViewById(R.id.tv1);\n</code></pre> \u73b0\u5728\u6211\u4eec\u5c31\u62ff\u5230\u4e86\u754c\u9762\u4e0a\u7684\u8fd9\u4e2aTextView\u5bf9\u8c61\u3002\u53ef\u4ee5\u5bf9\u5b83\u8fdb\u884c\u64cd\u4f5c\u4e86\u3002</p> <p>\u6bd4\u5982\u6539\u53d8\u5b83\u663e\u793a\u7684\u6587\u5b57\u3002 <pre><code>TextView tv1 = findViewById(R.id.tv1); // \u62ff\u5230textView\u7684\u5bf9\u8c61\ntv1.setText(\"Today is a good day.\");   // \u6539\u53d8\u6587\u5b57\n</code></pre></p>","tags":["Android Activity"]},{"location":"android/activity/overview/#androidmanifestxml-","title":"AndroidManifest.xml - \u6e05\u5355\u6587\u4ef6","text":"<p>\u4e5f\u53ef\u4ee5\u7b80\u79f0\u4e3a\u300cmanifest\u6587\u4ef6\u300d\u3002\u6e05\u5355\u6587\u4ef6\u975e\u5e38\u91cd\u8981\uff0c\u5b83\u544a\u8bc9\u7cfb\u7edf\u6211\u4eec\u7684app\u6709\u54ea\u4e9bactivity\uff0c\u7528\u5230\u4e86\u4ec0\u4e48\u6743\u9650\u7b49\u7b49\u4fe1\u606f\u3002</p> <p>\u5982\u679c\u8981\u65b0\u5efaactivity\uff0c\u9700\u8981\u5728\u6e05\u5355\u4e2d\u6ce8\u518c\u3002</p> AndroidManifest.xml <pre><code>&lt;application\n    android:allowBackup=\"true\"\n    android:icon=\"@mipmap/ic_launcher\"\n    android:label=\"@string/app_name\"\n    android:roundIcon=\"@mipmap/ic_launcher_round\"\n    android:supportsRtl=\"true\"\n    android:theme=\"@style/AppTheme\"&gt;\n    &lt;activity \n        android:name=\".MainActivity\"\n        android:exported=\"true\"&gt;\n        &lt;intent-filter&gt;\n            &lt;action android:name=\"android.intent.action.MAIN\" /&gt;\n\n            &lt;category android:name=\"android.intent.category.LAUNCHER\" /&gt;\n        &lt;/intent-filter&gt;\n    &lt;/activity&gt;\n&lt;/application&gt;\n</code></pre> <p>\u4ece\u8fd9\u4e2a\u9ed8\u8ba4\u7684\u6e05\u5355\u6587\u4ef6\u4e2d\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5\uff0cactivity\u662f\u5c5e\u4e8eapplication\u7684\u3002application\u5c31\u662f\u6211\u4eec\u7684\u5e94\u7528\u3002</p> <p>application\u6807\u7b7e\u4e2d\u4e5f\u6307\u5b9a\u4e86\u5404\u79cd\u5143\u7d20\uff0c\u4f8b\u5982\u5e94\u7528\u7684\u56fe\u6807\uff0c\u540d\u5b57\uff0c\u4e3b\u9898\u7b49\u7b49\u3002</p> <p>MainActivity\u662f\u5e94\u7528\u542f\u52a8\u7684\u7b2c\u4e00\u4e2aactivity\u3002\u53ef\u4ee5\u89c2\u5bdf\u5230\u5b83\u8bbe\u7f6e\u4e86action\u548ccategory\u5c5e\u6027\u3002</p> <ul> <li><code>android.intent.action.MAIN</code>\u51b3\u5b9a\u5e94\u7528\u7a0b\u5e8f\u6700\u5148\u542f\u52a8\u7684Activity\u3002</li> <li><code>android.intent.category.LAUNCHER</code> \u8868\u793a\u53ef\u4ee5\u5728\u624b\u673a\u201c\u684c\u9762\u201d\u4e0a\u770b\u5230\u5e94\u7528\u56fe\u6807\u3002</li> </ul> <p>\u8bbe\u7f6e\u4e86\u8fd92\u4e2a\u6807\u7b7e\uff0c\u51b3\u5b9a\u4e86\u8fd9\u4e2aactivity\u662f\u7528\u6237\u70b9\u51fb\u5e94\u7528\u56fe\u6807\u65f6\u300c\u7b2c\u4e00\u4e2a\u542f\u52a8\u7684\u754c\u9762\u300d\u3002</p> <p>Android 12\u5fc5\u987b\u8bbe\u7f6e android:exported</p> <p>Android 12\u4e2d\uff0c\u5fc5\u987b\u8bbe\u7f6e<code>android:exported</code>\u5c5e\u6027\u6765\u51b3\u5b9a\u8fd9\u4e2aactivity\u662f\u5426\u5bf9\u5176\u4ed6app\u53ef\u7528\u3002</p> <p>\u5bf9\u4e8e\u7531launcher\u542f\u52a8\u7684activity\u6765\u8bf4\uff0c\u8fd9\u4e2a\u503c\u5fc5\u987b\u8bbe\u7f6e\u4e3atrue\u3002\u53c2\u8003\u94fe\u63a5</p>","tags":["Android Activity"]},{"location":"android/activity/overview/#activity_1","title":"activity\u603b\u89c8\u5c0f\u7ed3","text":"<p>\u81f3\u6b64\uff0c\u6211\u4eec\u77e5\u9053\u4e86\u4e00\u4e2aactivity\u901a\u5e38\u9700\u8981\u4e00\u4e2ajava\u6587\u4ef6\uff0c\u4e00\u4e2alayout\u6587\u4ef6\uff0c\u5e76\u4e14\u8981\u5728\u6e05\u5355\u4e2d\u6ce8\u518c\u3002</p> <p>\u4e0e\u7f51\u9875\u5f00\u53d1\u7c7b\u6bd4\u7684\u8bdd\uff0clayout\u6587\u4ef6\u5c31\u50cfhtml\uff0cJava\u548cjs\u6709\u7c7b\u4f3c\u7684\u4f5c\u7528\u3002style\uff08\u6837\u5f0f\uff09\u53ef\u4ee5\u8d77\u5230css\u7684\u4f5c\u7528\u3002</p> <p>activity\u662f\u5e94\u7528\u91cd\u8981\u7684\u7ec4\u4ef6\u4e4b\u4e00\u3002\u7eb7\u7e41\u590d\u6742\u7684\u5185\u5bb9\u9700\u8981activity\u6765\u627f\u8f7d\u3002</p> <p>\u4e4b\u540e\u6211\u4eec\u4f1a\u5728activity\u4e2d\u63a7\u5236\u5404\u79cd\u5404\u6837\u7684UI\u7ec4\u4ef6\uff0c\u5904\u7406\u7528\u6237\u7684\u64cd\u4f5c\uff0c\u7533\u8bf7\u6743\u9650\u7b49\u7b49\u3002\u8fd8\u8981\u4e86\u89e3activity\u7684\u751f\u547d\u5468\u671f\uff0c\u542f\u52a8\u65b9\u5f0f\u548c\u8df3\u8f6c\u65b9\u6cd5\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a</p>","tags":["Android Activity"]},{"location":"android/activity/simple_launcher/","title":"\u7b80\u6613launcher","text":"\u66f4\u65b0\u65e5\u671f 2020-4-20 <ul> <li>2020-4-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>launcher\uff0c\u5373\u6211\u4eec\u5e38\u8bf4\u7684\u201c\u684c\u9762\u201d\u3002\u6309home\u952e\u4f1a\u56de\u5230\u7684\u90a3\u4e2aapp\u3002launcher\u4e5f\u662f\u4e00\u4e2aapp\u3002 \u5982\u679c\u8bbe\u5907\u4e0a\u6709\u591a\u4e2alauncher\uff0c\u7cfb\u7edf\u4f1a\u5f39\u7a97\u8be2\u95ee\u4f7f\u7528\u54ea\u4e00\u4e2alauncher\uff0c\u6216\u8005\u80fd\u76f4\u63a5\u8bbe\u7f6e\u9ed8\u8ba4launcher\u3002</p> <p>launcher\u4e5f\u662f\u4e00\u4e2aapp\u3002\u6211\u4eec\u53ef\u4ee5\u81ea\u5236\u4e00\u4e2a\u7b80\u6613launcher\u5728\u8bbe\u5907\u4e0a\u8fd0\u884c\uff0c\u5e76\u9009\u5b9a\u5b83\u4e3a\u9ed8\u8ba4launcher\u3002</p>","tags":["Android Launcher"]},{"location":"android/activity/simple_launcher/#manifest","title":"manifest\u8bbe\u7f6e","text":"<p>\u5728<code>AndroidManifest.xml</code>\u4e2d\uff0c\u7ed9\u4e3bactivity\u7684<code>&lt;intent-filter&gt;</code>\u6dfb\u52a0<code>category</code>\u3002</p> <p>\u6dfb\u52a0\u7684\u662f</p> <ul> <li>\"android.intent.category.HOME\"</li> <li>\"android.intent.category.DEFAULT\"</li> </ul> <p><code>AndroidManifest.xml</code> \u5982\u4e0b\uff1a <pre><code>&lt;activity\n    android:name=\".MainActivity\"&gt;\n    &lt;intent-filter&gt;\n        &lt;action android:name=\"android.intent.action.MAIN\" /&gt;\n\n        &lt;category android:name=\"android.intent.category.LAUNCHER\" /&gt;\n        &lt;category android:name=\"android.intent.category.HOME\" /&gt;\n        &lt;category android:name=\"android.intent.category.DEFAULT\" /&gt;\n\n    &lt;/intent-filter&gt;\n&lt;/activity&gt;\n</code></pre></p> <p>\u8fd0\u884capp\u5230\u624b\u673a\u4e0a\u540e\uff0c\u5728\u624b\u673a\u7684\u8bbe\u7f6e-\u684c\u9762-\u9ed8\u8ba4\u684c\u9762\u4e2d\uff0c\u9009\u62e9\u8fd9\u4e2aapp\u4f5c\u4e3a\u9ed8\u8ba4\u684c\u9762\u3002 \u6b64\u65f6\u70b9\u51fbhome\u952e\uff0c\u4f1a\u53d1\u73b0\u8df3\u56de\u4e86\u8fd9\u4e2aapp\u3002</p> <p>\u6b64\u65f6\u8fd9\u4e2a\u7b80\u6613launcher\u5df2\u7ecf\u914d\u7f6e\u597d\u4e86\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u5199\u4e00\u4e9blauncher\u53ef\u80fd\u4f1a\u7528\u5230\u7684\u529f\u80fd\u3002</p>","tags":["Android Launcher"]},{"location":"android/activity/simple_launcher/#launcherapp","title":"\u83b7\u53d6\u624b\u673a\u4e0a\u80fd\u88ablauncher\u542f\u52a8\u7684app\u4fe1\u606f","text":"<p>\u8bf4\u5230launcher\uff08\u6216\u8005\u53eb\u201d\u684c\u9762\u201c\uff09\uff0c\u6211\u4eec\u7b2c\u4e00\u53cd\u5e94\u53ef\u80fd\u662f\u80fd\u901a\u8fc7\u5b83\u6253\u5f00\u5176\u4ed6\u7684app\u3002 \u6253\u5f00\u5176\u4ed6app\uff0c\u7b2c\u4e00\u6b65\u8981\u77e5\u9053\u8bbe\u5907\u4e0a\u6709\u54ea\u4e9bapp\u53ef\u4ee5\u88ablauncher\u6253\u5f00\u3002\u7b2c\u4e8c\u6b65\u662f\u6253\u5f00\u7528\u6237\u6307\u5b9a\u7684app\u3002</p> <p>\u8981\u83b7\u53d6\u624b\u673a\u4e0aapp\u7684\u4fe1\u606f\uff0c\u79bb\u4e0d\u5f00<code>PackageManager</code>\u3002\u6211\u4eec\u81ea\u5236launcher\u4e2d\u7684\u5f88\u591a\u529f\u80fd\u90fd\u4f9d\u9760<code>PackageManager</code>\u6765\u5b9e\u73b0\u3002</p>","tags":["Android Launcher"]},{"location":"android/activity/simple_launcher/#resolveinfo","title":"\u83b7\u53d6ResolveInfo","text":"<p>\u83b7\u53d6\u624b\u673a\u4e0a\u80fd\u88ablauncher\u542f\u52a8\u7684app\u7684\u4fe1\u606f\u5217\u8868\u3002</p> <p>ResolveInfo\u5b58\u50a8\u7740\u4e00\u7cfb\u5217\u5e94\u7528\u76f8\u5173\u7684\u4fe1\u606f\u3002</p> <p>\u4f7f\u7528PackageManager\u7684<code>queryIntentActivities(intent, flags)</code>\u65b9\u6cd5\uff0c\u83b7\u53d6\u673a\u5668\u4e0a\u7684app\u7684<code>AndroidManifest.xml</code>\u7684\u4fe1\u606f\u3002 \u6211\u4eec\u5173\u6ce8\u7684\u662f\u80fd\u88ablauncher\u542f\u52a8\u7684app\u3002 <pre><code>private List&lt;ResolveInfo&gt; scanApp() {\n    Intent mainIntent = new Intent(Intent.ACTION_MAIN, null);\n    mainIntent.addCategory(Intent.CATEGORY_LAUNCHER);\n    List&lt;ResolveInfo&gt; list = new ArrayList&lt;&gt;();\n    for (ResolveInfo info : getPackageManager().queryIntentActivities(mainIntent, 0)) {\n        if (info.activityInfo.packageName.equals(getPackageName())) {\n            continue; // \u8df3\u8fc7\u81ea\u5df1\n        }\n        if (info.activityInfo.packageName.matches(\"com.abc.*\")) {\n            list.add(info);\n        }\n    }\n    return list;\n}\n</code></pre></p>","tags":["Android Launcher"]},{"location":"android/activity/simple_launcher/#packageinfo","title":"\u83b7\u53d6PackageInfo","text":"<p>\u83b7\u53d6\u624b\u673a\u4e0a\u5df2\u5b89\u88c5\u7684app\u5217\u8868\u3002\u4f7f\u7528<code>PackageManager.getInstalledPackages</code>\u65b9\u6cd5\u3002 <pre><code>private List&lt;PackageInfo&gt; getAvaAppList() {\n    List&lt;PackageInfo&gt; res = new ArrayList&lt;&gt;();\n    PackageManager pm = getPackageManager();\n    List&lt;PackageInfo&gt; packages = pm.getInstalledPackages(0);\n    for (PackageInfo packageInfo : packages) {\n//            Log.d(TAG, \"[app] \" + packageInfo);\n        if (packageInfo.packageName.equals(getPackageName())) {\n            continue; // \u8df3\u8fc7\u81ea\u5df1\n        }\n        if (packageInfo.packageName.matches(\"com.iNTGO.*\")) {\n            res.add(packageInfo);\n        }\n\n        if ((packageInfo.applicationInfo.flags &amp; ApplicationInfo.FLAG_SYSTEM) == 0) {\n            // \u975e\u7cfb\u7edf\u5e94\u7528\n\n        } else {\n            // \u7cfb\u7edf\u5e94\u7528\n        }\n    }\n    return res;\n}\n</code></pre></p>","tags":["Android Launcher"]},{"location":"android/activity/simple_launcher/#_1","title":"\u5c4f\u853d\u8fd4\u56de\u952e","text":"<p>launcher\u4f5c\u4e3a\u201c\u684c\u9762\u201d\uff0c\u4e0d\u8ba9\u5b83\u81ea\u5df1\u9000\u51fa\u3002\u5728\u6700\u4e3b\u8981\u7684activity\u4e0a\u590d\u5199<code>onBackPressed</code> <pre><code>@Override\npublic void onBackPressed() {\n// \u4e0d\u5904\u7406\u8fd4\u56de\u952e\n}\n</code></pre></p>","tags":["Android Launcher"]},{"location":"android/activity/simple_launcher/#app","title":"\u542f\u52a8\u53e6\u4e00\u4e2aapp","text":"<p>\u83b7\u53d6\u5230\u5176\u4ed6app\u4fe1\u606f\u540e\uff0c\u53ef\u4ee5\u542f\u52a8\u5b83\u4eec\u3002 \u83b7\u53d6\u5230ResolveInfo\uff0clauncher\u542f\u52a8\u5bf9\u5e94\u7684app\u3002 <pre><code>Intent intent = getPackageManager().getLaunchIntentForPackage(info.activityInfo.packageName);\nstartActivity(intent);\n</code></pre></p>","tags":["Android Launcher"]},{"location":"android/activity/simple_launcher/#_2","title":"\u663e\u793a\u58c1\u7eb8","text":"<p>\u4f7f\u7528\u5b89\u5353\u673a\u5668\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8bbe\u7f6e\u4e2d\u66f4\u6362\u58c1\u7eb8\u3002 \u81ea\u5236launcher\u4e5f\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u8bbe\u7f6e\u7684\u58c1\u7eb8\u3002\u9700\u8981\u5bf9\u80cc\u666f\u505a\u4e00\u4e9b\u5904\u7406\u3002 \u6211\u4eec\u5904\u7406\u7684\u662flauncher\u4e2dactivity\u7684\u80cc\u666f\uff0c\u8ba9\u80cc\u666f\u900f\u660e\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u770b\u5230\u5b89\u5353\u7684\u58c1\u7eb8\u3002</p> <p>\u9996\u5148\u662factivity\u7684\u80cc\u666f\u989c\u8272\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u6210\u900f\u660e\u3002 <pre><code>android:background=\"@android:color/transparent\"\n</code></pre></p> <p>\u7136\u540e\u5728activity\u7684<code>onCreate</code>\u65b9\u6cd5\u4e2d\uff0c\u8bbe\u7f6e\u58c1\u7eb8\u6807\u8bb0\u3002 <pre><code>@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    // ...\n    getWindow().addFlags(WindowManager.LayoutParams.FLAG_SHOW_WALLPAPER);\n    super.onCreate(savedInstanceState);\n    // ...\n}\n</code></pre></p> <p>\u8fd9\u4e2a\u8bbe\u7f6e\u5bf9\u9759\u6001\u58c1\u7eb8\u548c\u52a8\u6001\u58c1\u7eb8\u90fd\u6709\u6548\u3002</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a</p>","tags":["Android Launcher"]},{"location":"android/activity/start-activity-and-send-params/","title":"Android Activity \u542f\u52a8\uff0c\u643a\u5e26\u53c2\u6570\u542f\u52a8","text":"\u66f4\u65b0\u65e5\u671f 2021-11-12 <ul> <li>2021-11-12 \u6dfb\u52a0<code>CALL_PHONE</code></li> <li>2021-9-1 \u4fee\u6539\u683c\u5f0f</li> <li>2020-8-24 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u524d\u9762\u6211\u4eec\u5927\u81f4\u4e86\u89e3\u4e86Activity\u662f\u4e00\u4e2a\u5e94\u7528\u7ec4\u4ef6\uff0c\u80fd\u4e3a\u7528\u6237\u63d0\u4f9b\u4e00\u4e2a\u754c\u9762\u3002\u4ee5\u53ca\u5982\u4f55\u65b0\u589eactivity\u3002 \u4e00\u4e2aApp\u4e2d\uff0c\u901a\u5e38\u6709\u591a\u4e2a\u754c\u9762\u3002\u5047\u8bbe\u6bcf\u4e00\u4e2a\u754c\u9762\u5bf9\u5e94\u4e00\u4e2aactivity\uff0c\u4e0d\u540c\u754c\u9762\u4e4b\u95f4\u600e\u4e48\u8df3\u8f6c\u5462\uff1f</p>","tags":["Android Activity"]},{"location":"android/activity/start-activity-and-send-params/#intent","title":"Intent","text":"<p>\u901a\u5e38activity\u4e4b\u95f4\u7684\u8df3\u8f6c\u79bb\u4e0d\u5f00Intent\u8fd9\u4e2a\u7c7b\u3002 Intent\uff0c\u76f4\u8bd1\u4e3a\u201c\u610f\u56fe\u201d\u3002\u6211\u4eec\u628a\u4fe1\u606f\u5305\u88f9\u5728intent\u5bf9\u8c61\u4e2d\uff0c\u7136\u540e\u6267\u884c\u3002 \u6bd4\u5982\u542f\u52a8<code>RelativeLayoutGuideAct</code>\u8fd9\u4e2aactivity\u3002 <pre><code>startActivity(new Intent(getApplicationContext(), RelativeLayoutGuideAct.class));\n</code></pre></p> <p>\u8fd9\u91cc\u7528\u5230\u4e00\u4e2a\u5f88\u5e38\u89c1\u7684\u65b9\u6cd5<code>startActivity (Intent intent)</code>\u3002 <code>startActivity</code>\u5c5e\u4e8eContext\u7c7b\uff0cActivity\u662fContext\u7684\u5b50\u7c7b\u3002</p> <pre><code>java.lang.Object\n   \u21b3    android.content.Context\n       \u21b3    android.content.ContextWrapper\n           \u21b3    android.view.ContextThemeWrapper\n               \u21b3    android.app.Activity\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u77e5\u9053\u4e86\uff0c\u542f\u52a8activity\u9700\u8981\u4f7f\u7528Intent\uff0c\u8c03\u7528<code>startActivity</code>\u65b9\u6cd5\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/start-activity-and-send-params/#_1","title":"\u5e26\u53c2\u6570\u7684\u8df3\u8f6c","text":"<p>\u5728\u8df3\u8f6c\u53bb\u4e0b\u4e00\u4e2a\u9875\u9762\u65f6\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u60f3\u643a\u5e26\u4e00\u4e9b\u4fe1\u606f\u5230\u4e0b\u4e00\u4e2a\u754c\u9762\u53bb\u3002\u4f8b\u5982\u643a\u5e26\u4e00\u4e9b\u6587\u672c\uff0c\u6570\u5b57\u7b49\u7b49\u3002 \u6216\u8005\u662f\u4e00\u4e2a\u5bf9\u8c61\u3002 \u8fd9\u4e9b\u4fe1\u606f\u6211\u4eec\u53ef\u4ee5\u4ea4\u7ed9Intent\uff0c\u4f20\u9012\u5230\u4e0b\u4e00\u4e2aactivity\u53bb\u3002\u4e0b\u4e00\u4e2aactivity\u4e2d\u62ff\u5230\u6211\u4eec\u4f20\u5165\u7684Intent\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/start-activity-and-send-params/#string","title":"\u643a\u5e26\u57fa\u672c\u7c7b\u578b\u548cString","text":"<p>\u6211\u4eec\u76f4\u63a5\u770bintent\u7684\u65b9\u6cd5\u3002 <pre><code>Intent intent = new Intent(getApplicationContext(), SendParamsDemo.class);\nintent.putExtra(SendParamsDemo.K_INT, 100);\nintent.putExtra(SendParamsDemo.K_BOOL, true);\nintent.putExtra(SendParamsDemo.K_STR, \"Input string\");\nstartActivity(intent);\n</code></pre> intent\u7684<code>putExtra</code>\u65b9\u6cd5\uff0c\u53ef\u4ee5\u4f20\u5165\u53c2\u6570\u3002\u5b83\u63a5\u53d71\u4e2aString\u4f5c\u4e3akey\uff0c\u7136\u540e\u662f\u5177\u4f53\u53c2\u6570\u3002 \u4f8b\u5b50\u4e2d\u6211\u4eec\u8df3\u8f6c\u53bb\u4e86SendParamsDemo\u3002 <pre><code>public class SendParamsDemo extends AbsActivity {\n\n    public static final String K_INT = \"k_int\";\n    public static final String K_BOOL = \"k_bool\";\n    public static final String K_STR = \"k_str\";\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        gotInput();\n    }\n\n    private void gotInput() {\n        Intent intent = getIntent();\n        if (intent != null) {\n            int i = intent.getIntExtra(K_INT, -1);\n            boolean b = intent.getBooleanExtra(K_BOOL, false);\n            String str = intent.getStringExtra(K_STR);\n            Log.d(TAG, \"gotInput: i:\" + i + \", b: \" + b + \", str: \" + str);\n        } else {\n            Log.d(TAG, \"gotInput: input null.\");\n        }\n    }\n}\n// log:\n// com.rustfisher.tutorial2020 D/rustAppSendParamsDemo: gotInput: i:100, b: true, str: Input string\n</code></pre> \u5728\u8fd9\u4e2aactivity\u4e2d\u6211\u4eec\u63a5\u6536\u5230\u4e86\u4f20\u5165\u7684\u53c2\u6570\u3002</p> <p>\u89c2\u5bdfintent\u7684<code>putExtra</code>\u65b9\u6cd5\uff0c\u6211\u4eec\u53d1\u73b0\u5b83\u652f\u6301\u4f20\u5165\u5f88\u591a\u79cd\u53c2\u6570\u3002</p> <p>int\uff0cbyte, char, float, double, long, boolean\uff0cstring\uff0cCharSequence\u6216\u662f\u5b83\u4eec\u7684\u6570\u7ec4\u3002 \u4e5f\u53ef\u4ee5\u4f20\u5165Parcelable\uff0cSerializable\u5bf9\u8c61\u6216\u662f\u5bf9\u8c61\u6570\u7ec4\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/start-activity-and-send-params/#serializable","title":"\u4f20\u5165Serializable\u5bf9\u8c61","text":"<p>\u9664\u4e86\u57fa\u672c\u7c7b\u578b\u548cString\uff0c\u53ef\u4ee5\u4f20\u9001\u5bf9\u8c61\u5417\uff1f \u7b54\u6848\u662f\u80af\u5b9a\u7684\u3002Intent\u53ef\u4ee5\u643a\u5e26<code>Serializable</code>\u5bf9\u8c61\u3002 <code>Serializable</code>\u672c\u8eab\u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u81ea\u5b9a\u4e49\u7684\u5bf9\u8c61\u5b9e\u73b0\u8fd9\u4e2a\u63a5\u53e3\u540e\uff0c\u5c31\u53ef\u4ee5\u88abIntent\u643a\u5e26\u3002 \u6bd4\u5982\u6211\u4eec\u6539\u9020\u4e00\u4e0bDataTest\u7c7b\uff0c\u8ba9\u5b83\u5b9e\u73b0<code>Serializable</code>\u63a5\u53e3\u3002 <pre><code>public class DataTest implements Serializable { // \u5b9e\u73b0\u63a5\u53e3\n</code></pre></p> <p>\u7136\u540e\u5c06\u5bf9\u8c61\u9001\u7ed9intent\uff0c\u518d\u542f\u52a8activity\u3002 <pre><code>Intent intent = new Intent(getApplicationContext(), RecyclerViewDemo2Act.class);\nDataTest out = new DataTest(\"input time\", 233, 666, 999);\nLog.d(TAG, \"startInputData: sending object: \" + out);\nintent.putExtra(RecyclerViewDemo2Act.K_INPUT_DATA, out);\nstartActivity(intent);\n</code></pre></p> <p>\u88ab\u542f\u52a8\u7684activity\u63a5\u53d7\u4f20\u5165\u7684intent\u5e76\u53d6\u51fa\u5bf9\u8c61\u3002 <pre><code>Intent intent = getIntent();\nif (intent != null) {\n    DataTest d = (DataTest) intent.getSerializableExtra(K_INPUT_DATA);\n    // \u53d6\u51fa\u4e86\u5bf9\u8c61\uff0c\u62ff\u53bb\u663e\u793a\n}\n</code></pre></p> <p><code>Serializable</code>\u63a5\u53e3\u4e0d\u542b\u4efb\u4f55\u65b9\u6cd5\u3002\u5b9e\u73b0\u4e86\u8fd9\u4e2a\u63a5\u53e3\u7684\u7c7b\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u5c06\u5176\u5e8f\u5217\u5316\u3002</p> <p>\u6211\u4eec\u6253\u5370\u51fa\u53d1\u9001\u548c\u63a5\u6536\u5230\u7684\u5bf9\u8c61\u3002 <pre><code>startInputData: sending object: com.rustfisher.tutorial2020.recycler.data.DataTest@fb43df5\ngetInputData: input data object: com.rustfisher.tutorial2020.recycler.data.DataTest@a588b5c\n</code></pre> \u53ef\u4ee5\u53d1\u73b0\u8fd92\u4e2a\u5bf9\u8c61\u5e76\u4e0d\u662f\u540c\u4e00\u4e2a\u5f15\u7528\u3002\u4f46\u5b83\u4eec\u7684\u201c\u5185\u5bb9\u201d\u662f\u4e00\u6837\u7684\u3002\u5bf9\u8c61\u7ecf\u5386\u4e86\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u7684\u8fc7\u7a0b\u3002</p> <p>\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0cIntent\u80fd\u643a\u5e26\u7684\u5bf9\u8c61\u5927\u5c0f\u5e76\u4e0d\u662f\u65e0\u9650\u5236\u7684\u3002\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u9700\u8981\u5f00\u53d1\u8005\u81ea\u5df1\u9884\u4f30\u4f20\u8f93\u7684\u6570\u636e\u5927\u5c0f\u3002</p> <p>\u4f20\u9001Parcelable\u5bf9\u8c61\u548c\u4f20\u9001Serializable\u5bf9\u8c61\u7c7b\u4f3c\uff0c\u7528\u540c\u6837\u7684\u5b58\u5165\u548c\u53d6\u51fa\u64cd\u4f5c\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/start-activity-and-send-params/#_2","title":"\u6253\u7535\u8bdd","text":"<p>\u9700\u8981\u7533\u8bf7\u52a8\u6001\u6743\u9650<code>CALL_PHONE</code> <pre><code>&lt;uses-permission android:name=\"android.permission.CALL_PHONE\" /&gt;\n</code></pre></p> <p>\u4f7f\u7528<code>Intent.ACTION_CALL</code>\u662f\u76f4\u63a5\u6253\u51fa\u53bb <pre><code>Intent intent = new Intent(Intent.ACTION_CALL, Uri.parse(\"tel:\" + phonenumber));\nintent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\nstartActivity(intent);\n</code></pre></p> <p>\u4f7f\u7528<code>Intent.ACTION_DIAL</code>\u4f1a\u505c\u7559\u5728\u62e8\u53f7\u754c\u9762 <pre><code>Intent intent = new Intent(Intent.ACTION_DIAL, Uri.parse(\"tel:\" + phonenumber));\nintent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\nstartActivity(intent);\n</code></pre></p> <p>\u793a\u4f8b\u4ee3\u7801</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a</p>","tags":["Android Activity"]},{"location":"android/activity/start-activity-for-result/","title":"Android Activity \u8fd4\u56de\u65f6\u643a\u5e26\u53c2\u6570","text":"\u66f4\u65b0\u65e5\u671f 2023-5-19 <ul> <li>2023-5-19 \u521b\u5efa\u6587\u6863</li> <li>2020-4-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>deprecation</p> <p><code>startActivityForResult</code> \u5df2\u4e0d\u518d\u63a8\u8350\u4f7f\u7528</p> <p>\u8bf7\u53c2\u8003 Activity Result Launcher</p> <p>\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u542f\u52a8activity\u7684\u65f6\u5019\u53ef\u4ee5\u4f20\u9012\u4e00\u4e9b\u53c2\u6570\u3002\u90a3\u4e48\u5728\u5173\u95edactivity\u65f6\uff0c\u80fd\u4e0d\u80fd\u5c06\u4e00\u4e9b\u6570\u636e\u4f20\u56de\u4e0a\u4e00\u4e2aactivity\u5462\uff1f</p> <p>\u672c\u6587\u7ed9\u51fa1\u4e2a\u4f8b\u5b50\uff0c\u5b9e\u73b0\u5173\u95edactivity\u65f6\uff0c\u5c06\u4e00\u4e9b\u6570\u636e\u4f20\u56de\u7ed9\u4e0a\u4e00\u4e2aactivity\u3002</p> <p>\u4f8b\u5b50\u4e2d\u4f1a\u67092\u4e2aActivity\u6765\u505a\u793a\u8303\uff0c<code>ForResultFirstAct</code>\u548c<code>ForResultSecondAct</code>\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/start-activity-for-result/#activity","title":"\u542f\u52a8\u65b0\u7684Activity","text":"<p><code>ForResultFirstAct</code>\u662f\u7b2c\u4e00\u4e2aActivity\u3002\u542f\u52a8\u7b2c\u4e8c\u4e2aactivity\u65f6\uff0c\u8981\u8c03\u7528<code>startActivityForResult</code>\u65b9\u6cd5\u3002 <pre><code>private static final int REQ_CODE = 10;\n\nstartActivityForResult(new Intent(getApplicationContext(), ForResultSecondAct.class), REQ_CODE);\n</code></pre> \u76f8\u5f53\u4e8e\u7ed9\u8fd9\u6b21\u542f\u52a8\u52a0\u4e0a\u4e86\u4e00\u4e2a\u6807\u793a\u3002</p>","tags":["Android Activity"]},{"location":"android/activity/start-activity-for-result/#_1","title":"\u88c5\u8f7d\u56de\u4f20\u6570\u636e","text":"<p><code>ForResultSecondAct</code>\u662f\u7b2c\u4e8c\u4e2aactivity\u3002\u5b83\u53ef\u4ee5\u8bbe\u7f6e\u8fd4\u56de\u65f6\u643a\u5e26\u7684\u6570\u636e\u3002 <pre><code>Intent resultIntent = new Intent();\nresultIntent.putExtra(K_TITLE, mTitleEt.getText().toString());\nresultIntent.putExtra(K_SUB_TITLE, mSubTitleEt.getText().toString());\nsetResult(RESULT_OK, resultIntent);\nfinish();\n</code></pre></p> <p><code>RESULT_OK</code>\u662fActivity\u7c7b\u7684\u9759\u6001\u5e38\u91cf\u3002\u53ef\u7528\u4e8e\u4ee3\u8868\u64cd\u4f5c\u7684\u7ed3\u679c\u3002 <pre><code>/** Standard activity result: operation canceled. */\npublic static final int RESULT_CANCELED    = 0;\n/** Standard activity result: operation succeeded. */\npublic static final int RESULT_OK           = -1;\n/** Start of user-defined activity results. */\npublic static final int RESULT_FIRST_USER   = 1;\n</code></pre></p>","tags":["Android Activity"]},{"location":"android/activity/start-activity-for-result/#_2","title":"\u83b7\u53d6\u56de\u4f20\u6570\u636e","text":"<p><code>ForResultFirstAct</code>\u4e2d\u9700\u8981\u590d\u5199\u65b9\u6cd5\uff0c\u83b7\u53d6\u8fd4\u56de\u7684\u6570\u636e\u3002 <pre><code>@Override\nprotected void onActivityResult(int requestCode, int resultCode, Intent data) {\n    super.onActivityResult(requestCode, resultCode, data);\n    switch (requestCode) {\n        case REQ_CODE:\n            if (resultCode == RESULT_OK) {\n                if (data != null) {\n                    mTitleTv.setText(data.getStringExtra(ForResultSecondAct.K_TITLE));\n                    mSubTitleTv.setText(data.getStringExtra(ForResultSecondAct.K_SUB_TITLE));\n                }\n            } else {\n                Toast.makeText(getApplicationContext(), \"\u672a\u4fdd\u5b58\u4fee\u6539\", Toast.LENGTH_SHORT).show();\n            }\n            break;\n    }\n}\n</code></pre> \u4ee5\u4e0a\u662factivity\u56de\u4f20\u6570\u636e\u7684\u4e00\u4e2a\u4f8b\u5b50\u3002 \u6211\u4eec\u7740\u91cd\u6ce8\u610f</p> <ul> <li><code>startActivityForResult</code>\u65b9\u6cd5\uff0c\u542f\u52a8\u4e0b\u4e00\u4e2aactivity\u3002</li> <li><code>setResult</code>\u65b9\u6cd5\uff0c\u88c5\u8f7d\u56de\u4f20\u6570\u636e\u3002</li> <li><code>onActivityResult</code>\u65b9\u6cd5\uff0c\u83b7\u53d6\u56de\u4f20\u7ed3\u679c\u3002</li> </ul>","tags":["Android Activity"]},{"location":"android/activity/start-activity-for-result/#requestcode","title":"requestCode\u7684\u9650\u5236","text":"<p><code>startActivityForResult(Intent intent, int requestCode)</code> requestCode \u6709\u9650\u5236\uff1b \u4ee5\u4e0b\u662f\u62a5\u9519log <pre><code>com.rustfisher.toturial E/CrashReport: java.lang.IllegalArgumentException: Can only use lower 16 bits for requestCode\n        at android.support.v4.app.FragmentActivity.checkForValidRequestCode(FragmentActivity.java:806)\n        at android.support.v4.app.FragmentActivity.startActivityForResult(FragmentActivity.java:751)\n        at com.rustfisher.toturial.app.MainActivity.onClick(MainActivity.java:942)\n        at android.view.View.performClick(View.java:6312)\n        at android.view.View$PerformClick.run(View.java:24811)\n        at android.os.Handler.handleCallback(Handler.java:794)\n        at android.os.Handler.dispatchMessage(Handler.java:99)\n        at android.os.Looper.loop(Looper.java:176)\n        at android.app.ActivityThread.main(ActivityThread.java:6651)\n        at java.lang.reflect.Method.invoke(Native Method)\n        at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:547)\n        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:824)\n</code></pre></p> <p>\u62a5\u51fa\u7684<code>AndroidRuntimeException</code>\u544a\u8bc9\u6211\u4eec\uff0c\u53ef\u4ee5\u8003\u8651\u542f\u52a8\u4e00\u4e2a\u65b0\u7684task</p> <p>\u5373\u8bbe\u7f6enew task\u6807\u8bb0 <code>intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</code> <pre><code>android.util.AndroidRuntimeException: Calling startActivity() from outside of an Activity  context requires the FLAG_ACTIVITY_NEW_TASK flag. Is this really what you want?\n    at android.app.ContextImpl.startActivity(ContextImpl.java:765)\n    at android.app.ContextImpl.startActivity(ContextImpl.java:745)\n    at android.content.ContextWrapper.startActivity(ContextWrapper.java:331)\n</code></pre></p>","tags":["Android Activity"]},{"location":"android/activity/uninstall-app/","title":"Android \u5378\u8f7dapp","text":"\u66f4\u65b0\u65e5\u671f 2020-4-20 <ul> <li>2020-4-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>Android\u4ee3\u7801\u4e2d\u5378\u8f7dApp\u3002\u4f7f\u7528Intent\u3002</p> <p>\u5df2\u77e5\u76ee\u6807app\u7684\u5305\u540d\uff0c\u53ef\u4ee5\u7533\u8bf7\u5378\u8f7d\u6b64app\u3002\u4f7f\u7528<code>Intent.ACTION_DELETE</code>\u3002</p> <p><pre><code>public static void uninstallAppByPkg(Context context, String pkg) {\n    try {\n        Intent intent = new Intent(Intent.ACTION_DELETE, Uri.fromParts(\"package\", pkg, null));\n        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n        context.startActivity(intent);\n    } catch (Exception e) {\n        Log.e(TAG, \"uninstallAppByPkg: \" + pkg, e);\n    }\n}\n</code></pre> \u6267\u884c\u540e\u4f1a\u5f39\u51fa\u5378\u8f7d\u786e\u8ba4\u754c\u9762\uff0c\u8ba9\u7528\u6237\u9009\u62e9\u662f\u5426\u5378\u8f7d\u3002</p>","tags":["Android PackageManager"]},{"location":"android/activity/view-global-layout-listen/","title":"Android addOnGlobalLayoutListener","text":"\u66f4\u65b0\u65e5\u671f 2022-10-11 <ul> <li>2022-10-11 \u66f4\u65b0\u8bf4\u660e</li> <li>2020-4-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4e3b\u8981\u5229\u7528<code>View.getViewTreeObserver().addOnGlobalLayoutListener()</code>\u3002</p> <p>\u8bb0\u5f55decorView\u7684\u9ad8\u5ea6\u3002\u5728decorView\u9ad8\u5ea6\u53d8\u5316\u65f6\uff0c\u53ef\u5bf9\u5176\u5b50\u89c6\u56fe\u505a\u4e00\u4e9b\u64cd\u4f5c\u3002</p> <p>\u5e03\u5c40\u6587\u4ef6 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:id=\"@+id/root\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:layout_marginBottom=\"@dimen/health_plan_info_root_margin_bottom\"\n    android:layout_marginTop=\"63dp\"&gt;\n  &lt;!-- \u5176\u4ed6\u4e1c\u897f --&gt;\n&lt;/RelativeLayout&gt;\n</code></pre></p> <p>\u4e00\u4e2a\u4f2a\u88c5\u6210dialog\u7684activity\uff0c\u76d1\u542c\u8f6f\u952e\u76d8\u5f39\u51fa\u65f6\u5b83\u7684\u9ad8\u5ea6\u53d8\u5316\u3002 \u8f6f\u952e\u76d8\u5f39\u51fa\u65f6\uff0c\u4f1a\u628aactivity\u9876\u4e0a\u53bb\u3002\u6b64\u65f6\u53ef\u4ee5\u52a8\u6001\u6539\u53d8activity\u7684marginBottom\u3002</p> <pre><code>private View mRootLayout;        // layout\u4e2d\u7684\u5e95layout\nprivate int mRootViewHeight = 0; // \u6839\u89c6\u56fe\u7684\u9ad8\u5ea6\n\nprivate void initSoftKeyboardController() {\n    final View decorView = getWindow().getDecorView();\n    decorView.getViewTreeObserver().addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() {\n        @Override\n        public void onGlobalLayout() {\n            Rect r = new Rect();\n            decorView.getWindowVisibleDisplayFrame(r);\n            int visibleHeight = r.height();\n            if (mRootViewHeight == 0) {\n                mRootViewHeight = visibleHeight; // \u8bb0\u5f55\u6839\u89c6\u56fe\u9ad8\u5ea6\n                return;\n            }\n            if (mRootViewHeight == visibleHeight) {\n                FrameLayout.LayoutParams params = (FrameLayout.LayoutParams) mRootLayout.getLayoutParams();\n                params.bottomMargin = getResources().getDimensionPixelOffset(R.dimen.health_plan_info_root_margin_bottom);\n                mRootLayout.setLayoutParams(params);\n                return;\n            }\n            if (mRootViewHeight - visibleHeight &gt; 200) { // \u8d85\u8fc7\u8fd9\u4e2a\u503c\u5219\u628a\u5e95\u90e8\u95f4\u9694\u8bbe\u4e3a0\n                FrameLayout.LayoutParams params = (FrameLayout.LayoutParams) mRootLayout.getLayoutParams();\n                params.bottomMargin = 0;\n                mRootLayout.setLayoutParams(params);\n            }\n        }\n    });\n}\n</code></pre> <p><code>decorView</code>\u662f\u4e00\u4e2a<code>FrameLayout</code>\u3002\u83b7\u53d6<code>LayoutParams</code>\u65f6\u8981\u6ce8\u610f\u3002</p> <p>\u8fd9\u4e2adialog\u6837\u5f0f\u7684activity\u7684style <pre><code>    &lt;style name=\"dialog_style\" parent=\"@style/Theme.AppCompat.Light.NoActionBar\"&gt;\n        &lt;!--\u8bbe\u7f6edialog\u7684\u80cc\u666f--&gt;\n        &lt;item name=\"android:windowBackground\"&gt;@android:color/transparent&lt;/item&gt;\n        &lt;!--\u8bbe\u7f6eDialog\u7684windowFrame\u6846\u4e3a\u65e0--&gt;\n        &lt;item name=\"android:windowFrame\"&gt;@null&lt;/item&gt;\n        &lt;!--\u8bbe\u7f6e\u65e0\u6807\u9898--&gt;\n        &lt;item name=\"android:windowNoTitle\"&gt;true&lt;/item&gt;\n        &lt;!--\u662f\u5426\u6d6e\u73b0\u5728activity\u4e4b\u4e0a--&gt;\n        &lt;item name=\"android:windowIsFloating\"&gt;true&lt;/item&gt;\n        &lt;!--\u662f\u5426\u534a\u900f\u660e--&gt;\n        &lt;item name=\"android:windowIsTranslucent\"&gt;true&lt;/item&gt;\n        &lt;!--\u8bbe\u7f6e\u7a97\u53e3\u5185\u5bb9\u4e0d\u8986\u76d6--&gt;\n        &lt;item name=\"android:windowContentOverlay\"&gt;@null&lt;/item&gt;\n        &lt;!--\u8bbe\u7f6e\u52a8\u753b\uff0c\u5728\u8fd9\u91cc\u4f7f\u7528\u8ba9\u5b83\u7ee7\u627f\u7cfb\u7edf\u7684Animation.Dialog--&gt;\n        &lt;item name=\"android:windowAnimationStyle\"&gt;@android:style/Animation.Dialog&lt;/item&gt;\n        &lt;!--\u80cc\u666f\u662f\u5426\u6a21\u7cca\u663e\u793a--&gt;\n        &lt;item name=\"android:backgroundDimEnabled\"&gt;true&lt;/item&gt;\n    &lt;/style&gt;\n</code></pre></p>","tags":["Android View"]},{"location":"android/adb/adb-pm-use/","title":"pm","text":"<p>pm\uff1a\u5305\u7ba1\u7406\u5668 pakcage manager</p> <p>\u67e5\u770b\u673a\u5668\u4e0a\u7684\u5e94\u7528 <pre><code>adb shell pm list packages\n</code></pre></p> <p>\u8f93\u51fa <pre><code>package:com.android.nfc\npackage:com.android.stk\npackage:com.android.launcher3\n...\n</code></pre></p> <p>\u67e5\u770b\u5e94\u7528\u7684\u8def\u5f84 <pre><code>adb shell pm path com.xx.xx\n</code></pre></p> <p>\u4f8b\u5982\u67d0mtk\u673a\u5668\uff0c\u7cfb\u7edflauncher\u5b58\u653e\u8def\u5f84 /system/priv-app/MtkLauncher3QuickStep/MtkLauncher3QuickStep.apk</p> <p>\u6d4f\u89c8\u5668 /system/app/MtkBrowser/MtkBrowser.apk</p> <p>\u5728root\u7684\u673a\u5668\u4e0a\uff0c\u5220\u9664\u7cfb\u7edf\u5e94\u7528\u3002\u5220\u9664\u540e\u8981\u91cd\u542f\u673a\u5668\u3002 <pre><code>adb remount\nadb shell rm /system/app/OldDriver/OldDriver.apk\nadb reboot\n</code></pre></p>"},{"location":"android/adb/adb-s-install/","title":"adb install \u6307\u5b9a\u8bbe\u5907\u5b89\u88c5apk","text":"\u66f4\u65b0\u65e5\u671f 2024-01-11 <ul> <li>2024-01-11 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u5f53\u7535\u8111\u8fde\u63a5\u4e86\u591a\u4e2a\u5b89\u5353\u8bbe\u5907\u65f6\uff0c\u76f4\u63a5<code>adb install</code>\u4f1a\u5f39\u51fa\u5b89\u88c5\u9519\u8bef</p> <pre><code>~ $ adb devices\nList of devices attached\nxxx1250 device\nxxx1853 device\n\n~ $ adb install /Users/rustfisher/Downloads/v7av8a-1.apk \nerror: more than one device/emulator\nerror: more than one device/emulator\nPerforming Streamed Install\nadb: connect error for write: more than one device/emulator\n</code></pre> <p>\u56e0\u6b64\u53ef\u6307\u5b9a\u67d0\u4e2a\u8bbe\u5907\uff0c\u4f7f\u7528<code>-s</code>\u52a0\u8bbe\u5907\u53f7\u5373\u53ef</p> <pre><code>~ $ adb -s xxx1853 install /Users/rustfisher/Downloads/v7av8a-1.apk\n</code></pre>"},{"location":"android/adb/adb-screenrecord-use/","title":"adb \u5f55\u5c4f\u5de5\u5177","text":"\u66f4\u65b0\u65e5\u671f 2023-3-16 <ul> <li>2023-3-16 \u66f4\u65b0\u7528\u4f8b</li> <li>2022-9-30 \u66f4\u65b0\u8bf4\u660e</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528as\u7684\u5f55\u5c4f\u5de5\u5177\uff0c\u6216\u8005\u76f4\u63a5\u7528adb\u547d\u4ee4\u3002</p> <p>adb shell\u8fdb\u5165\u673a\u5668\uff0c\u67e5\u770b\u5f55\u5c4f\u547d\u4ee4\u7684\u5e2e\u52a9</p> \u67e5\u770b\u547d\u4ee4 <pre><code>$ screenrecord --help\nUsage: screenrecord [options] &lt;filename&gt;\n\nAndroid screenrecord v1.2.  Records the device's display to a .mp4 file.\n\nOptions:\n--size WIDTHxHEIGHT\n    Set the video size, e.g. \"1280x720\".  Default is the device's main\n    display resolution (if supported), 1280x720 if not.  For best results,\n    use a size supported by the AVC encoder.\n--bit-rate RATE\n    Set the video bit rate, in bits per second.  Value may be specified as\n    bits or megabits, e.g. '4000000' is equivalent to '4M'.  Default 20Mbps.\n--bugreport\n    Add additional information, such as a timestamp overlay, that is helpful\n    in videos captured to illustrate bugs.\n--time-limit TIME\n    Set the maximum recording time, in seconds.  Default / maximum is 180.\n--verbose\n    Display interesting information on stdout.\n--help\n    Show this message.\n\nRecording continues until Ctrl-C is hit or the time limit is reached.\n</code></pre>"},{"location":"android/adb/adb-screenrecord-use/#_1","title":"\u542f\u52a8\u5f55\u5c4f","text":"<p>\u4f7f\u7528\u547d\u4ee4\u542f\u52a8\u5f55\u5c4f\uff0c\u6307\u5b9a\u4e86mp4\u6587\u4ef6\u7684\u4f4d\u7f6e <pre><code>adb shell screenrecord /sdcard/demo.mp4\n</code></pre></p> <p>\u5f55\u5c4f\u7ed3\u675f\u540e<code>Ctrl + C</code>\u505c\u6b62\u3002\u5728\u624b\u673a\u4e0a\u53ef\u627e\u5230\u5f55\u5c4f\u6587\u4ef6\u3002</p>"},{"location":"android/adb/adb-screenrecord-use/#_2","title":"\u62a5\u9519\u60c5\u51b5","text":""},{"location":"android/adb/adb-screenrecord-use/#screenrecord-inaccessible-or-not-found","title":"\u62a5\u9519 screenrecord: inaccessible or not found","text":"<p>\u5982\u679c\u8fd0\u884c<code>adb shell screenrecord</code>\u547d\u4ee4\u65f6\u6536\u5230\u201cscreenrecord: inaccessible or not found\u201d\u9519\u8bef\u6d88\u606f\uff0c\u53ef\u80fd\u662f\u56e0\u4e3a\u8bbe\u5907\u672a\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\uff1a</p> <ul> <li>\u8bbe\u5907\u5fc5\u987b\u8fd0\u884cAndroid 4.4\u6216\u66f4\u9ad8\u7248\u672c\u3002</li> <li>\u5fc5\u987b\u5df2\u7ecf\u542f\u7528\u4e86USB\u8c03\u8bd5\u6a21\u5f0f\u3002\u53ef\u4ee5\u5728\u8bbe\u5907\u8bbe\u7f6e\u4e2d\u7684\u201c\u5f00\u53d1\u8005\u9009\u9879\u201d\u4e2d\u542f\u7528\u5b83\u3002</li> <li>\u5fc5\u987b\u4f7f\u7528\u6700\u65b0\u7248\u672c\u7684ADB\u5de5\u5177\u3002\u53ef\u4ee5\u901a\u8fc7\u66f4\u65b0Android SDK\u6765\u83b7\u53d6\u6700\u65b0\u7248\u672c\u7684ADB\u5de5\u5177\u3002</li> </ul> <p>\u5982\u679c\u8bbe\u5907\u7b26\u5408\u4e0a\u8ff0\u8981\u6c42\uff0c\u4f46\u4ecd\u65e0\u6cd5\u627e\u5230\u201cscreenrecord\u201d\uff0c\u5219\u53ef\u80fd\u662f\u7531\u4e8e\u8bbe\u5907\u5236\u9020\u5546\u7981\u7528\u4e86\u8be5\u529f\u80fd\u3002</p> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528\u7b2c\u4e09\u65b9\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u5c4f\u5e55\u5f55\u5236</p>"},{"location":"android/adb/adb-screenrecord-use/#encoder-failed-err-38","title":"\u62a5\u9519 Encoder failed (err=-38)","text":"<p>\u9047\u5230\u8fd9\u4e2a\u9519\u8bef\uff0c\u6211\u4eec\u9700\u8981\u6307\u5b9a <code>--size WIDTHxHEIGHT</code> \u624d\u884c</p> <p>\u53c2\u8003\uff1a</p> <p>https://android.stackexchange.com/questions/168944/unable-to-get-output-buffers-err-38-when-attempting-to-screen-record-emulator</p>"},{"location":"android/adb/adb-wm-use/","title":"wm - window manager","text":"<p>\u4f7f\u7528wm\u547d\u4ee4\uff0c\u53ef\u4ee5\u67e5\u770b\u6216\u4fee\u6539\u5c4f\u5e55\u914d\u7f6e\u3002</p>"},{"location":"android/adb/adb-wm-use/#_1","title":"\u67e5\u770b\u5c4f\u5e55\u4fe1\u606f","text":"<p>\u4f7f\u7528\u547d\u4ee4<code>wm size</code>\u67e5\u770b\u5c4f\u5e55\u4fe1\u606f</p> <pre><code>$ adb shell wm size\nPhysical size: 1200x1920\n</code></pre> <p>\u6709\u4e9b\u65f6\u5019\uff0c\u53ef\u80fd\u5f97\u5230\u66f4\u591a\u7684\u67e5\u8be2\u7ed3\u679c <pre><code>$ adb shell wm size\nPhysical size: 1200x1920\nOverride size: 1080x1440\n</code></pre> Physical size \u662f\u5c4f\u5e55\u5b9e\u9645\u5927\u5c0f\uff0c\u5373\u7269\u7406\u610f\u4e49\u4e0a\u7684\u6709\u591a\u5c11\u4e2a\u50cf\u7d20\u3002</p> <p>Override size \u662f\u673a\u5668\u201c\u8ba4\u4e3a\u201d\u7684\u5c3a\u5bf8\uff0c\u4e5f\u662f\u673a\u5668\u73b0\u5728\u6b63\u5728\u7528\u7684\u5c3a\u5bf8\u3002</p> <p>\u5f53Physical size\u4e0eOverride size\u76f8\u540c\u7684\u65f6\u5019\uff0c\u53ea\u8fd4\u56dePhysical size\u4fe1\u606f\u3002</p>"},{"location":"android/adb/adb-wm-use/#_2","title":"\u4fee\u6539\u5c4f\u5e55\u914d\u7f6e","text":"<p>\u6211\u4eec\u9700\u8981\u4e00\u53f0root\u6743\u9650\u7684\u673a\u5668\u3002\u7528<code>wm size</code>\u547d\u4ee4\u4fee\u6539Override size\u3002</p> <p>\u4f8b\u5982 <pre><code>$ adb shell wm size 1080x1440\n</code></pre> \u6267\u884c\u547d\u4ee4\u540e\uff0c\u673a\u5668\u5c4f\u5e55\u4e00\u95ea\uff0c\u53ef\u4ee5\u770b\u5230\u533a\u522b\u3002</p> <pre><code>java.lang.SecurityException: Must hold permission android.permission.WRITE_SECURE_SETTINGS\n</code></pre>"},{"location":"android/adb/adb-wm-use/#_3","title":"\u4fee\u6539\u793a\u4f8b","text":"<pre><code>adb shell wm density 240\n</code></pre> <p>\u7cfb\u7edf\u8bbe\u7f6e-\u663e\u793a-\u9ad8\u7ea7-\u663e\u793a\u5927\u5c0f\uff0c\u53ef\u4ee5\u4fee\u6539density\u503c\u3002</p>"},{"location":"android/adb/intro/","title":"adb \u4ecb\u7ecd","text":"<p>adb\u53ef\u7528\u4e8eAndroid\u8c03\u8bd5\u5de5\u4f5c\u3002</p>"},{"location":"android/adb/intro/#_1","title":"\u7f51\u7edc\u8c03\u8bd5","text":"<p>1+5\u624b\u673a Android10\uff0c\u624b\u673a\u548c\u7535\u8111\u8fde\u63a5\u5230\u540c\u4e00\u4e2a\u7f51\u7edc\u3002\u67e5\u770b\u624b\u673a\u7684ip\u5730\u5740\u662f192.168.0.106\u3002</p> <pre><code>$ adb tcpip 5555 # \u8bbe\u7f6e\u7aef\u53e3\n\n$ adb connect 192.168.0.106\nconnected to 192.168.0.106:5555\n\n$ adb devices\nList of devices attached\n192.168.0.106:5555  device\n</code></pre> <p>\u4e4b\u540e\u5c31\u53ef\u4ee5\u4e0d\u63d2usb\u7ebf\u76f4\u63a5\u8fdb\u884c\u8c03\u8bd5\u4e86\u3002</p>"},{"location":"android/adb/intro/#abi","title":"\u83b7\u53d6\u8bbe\u5907abi\u4fe1\u606f","text":"<pre><code>adb shell getprop ro.product.cpu.abi\n\narm64-v8a\n</code></pre>"},{"location":"android/adb/intro/#app","title":"\u5b89\u88c5\u4e0e\u5220\u9664app","text":"<p>adb uninstall \u5305\u540d</p> <p>adb install apk\u8def\u5f84</p>"},{"location":"android/adb/intro/#cpu","title":"\u67e5\u770bcpu\u4fe1\u606f","text":"<pre><code>shell@xx:/ $ cat /proc/cpuinfo\n</code></pre> <p>\u4f8b\u5982 <pre><code>$ adb shell cat /proc/cpuinfo\nProcessor   : AArch64 Processor rev 4 (aarch64)\nprocessor   : 0\nBogoMIPS    : 38.40\nFeatures    : fp asimd evtstrm aes pmull sha1 sha2 crc32\nCPU implementer : 0x51\nCPU architecture: 8\nCPU variant : 0xa\nCPU part    : 0x801\nCPU revision    : 4\n\nprocessor   : 1\nBogoMIPS    : 38.40\nFeatures    : fp asimd evtstrm aes pmull sha1 sha2 crc32\nCPU implementer : 0x51\nCPU architecture: 8\nCPU variant : 0xa\nCPU part    : 0x801\nCPU revision    : 4\n\nprocessor   : 2\nBogoMIPS    : 38.40\nFeatures    : fp asimd evtstrm aes pmull sha1 sha2 crc32\nCPU implementer : 0x51\nCPU architecture: 8\nCPU variant : 0xa\nCPU part    : 0x801\nCPU revision    : 4\n\nprocessor   : 3\nBogoMIPS    : 38.40\nFeatures    : fp asimd evtstrm aes pmull sha1 sha2 crc32\nCPU implementer : 0x51\nCPU architecture: 8\nCPU variant : 0xa\nCPU part    : 0x801\nCPU revision    : 4\n\nprocessor   : 4\nBogoMIPS    : 38.40\nFeatures    : fp asimd evtstrm aes pmull sha1 sha2 crc32\nCPU implementer : 0x51\nCPU architecture: 8\nCPU variant : 0xa\nCPU part    : 0x800\nCPU revision    : 1\n\nprocessor   : 5\nBogoMIPS    : 38.40\nFeatures    : fp asimd evtstrm aes pmull sha1 sha2 crc32\nCPU implementer : 0x51\nCPU architecture: 8\nCPU variant : 0xa\nCPU part    : 0x800\nCPU revision    : 1\n\nprocessor   : 6\nBogoMIPS    : 38.40\nFeatures    : fp asimd evtstrm aes pmull sha1 sha2 crc32\nCPU implementer : 0x51\nCPU architecture: 8\nCPU variant : 0xa\nCPU part    : 0x800\nCPU revision    : 1\n\nprocessor   : 7\nBogoMIPS    : 38.40\nFeatures    : fp asimd evtstrm aes pmull sha1 sha2 crc32\nCPU implementer : 0x51\nCPU architecture: 8\nCPU variant : 0xa\nCPU part    : 0x800\nCPU revision    : 1\n\nHardware    : Qualcomm Technologies, Inc MSM8998\n</code></pre> \u53ef\u4ee5\u770b\u5230MSM8998\u7684\u4e00\u4e9b\u57fa\u672c\u4fe1\u606f</p>"},{"location":"android/adb/intro/#buildprop","title":"\u67e5\u770b\u8bbe\u5907\u4fe1\u606fbuild.prop","text":"<pre><code>root@dior:/data # cat /system/build.prop | grep \"product\"\ncat /system/build.prop | grep \"product\"\nro.product.model=HM NOTE 1LTE\nro.product.brand=Xiaomi\nro.product.name=dior\nro.product.device=dior\nro.product.board=MSM8226\nro.product.cpu.abi=armeabi-v7a\nro.product.cpu.abi2=armeabi\nro.product.locale.language=zh\nro.product.locale.region=CN\n# ro.build.product is obsolete; use ro.product.device\nro.build.product=dior\nro.product.manufacturer=Xiaomi\nro.product.cuptsm=XIAOMI|ESE|02|01\n</code></pre>"},{"location":"android/adb/intro/#_2","title":"\u4e32\u53e3\u7ed3\u70b9","text":"<p>adb shell \u67e5\u770b\u8def\u5f84 /dev ttyHS0  \u4e32\u53e3 ttyHS1 ttyHSL0</p> <p>SELINUX \u6709[disabled]\u3001[permissive]\u3001[enforcing]3\u79cd\u9009\u62e9\u3002</p> <ul> <li>disabled\uff1a\u4e0d\u542f\u7528SELINUX\u529f\u80fd</li> <li>permissive\uff1aSELINUX\u6709\u6548\uff0c\u4f46\u662f\u5373\u4f7f\u4f60\u8fdd\u53cd\u4e86\u7b56\u7565\uff0c\u5b83\u8ba9\u4f60\u7ee7\u7eed\u64cd\u4f5c\uff0c\u4f46\u662f\u628a\u4f60\u7684\u8fdd\u53cd\u7684\u5185\u5bb9\u8bb0\u5f55\u4e0b\u6765\u3002\u5728\u6211\u4eec\u5f00\u53d1\u7b56\u7565\u7684\u65f6\u5019\u975e\u5e38\u7684\u6709\u7528\u3002\u76f8\u5f53\u4e8eDebug\u6a21\u5f0f\u3002</li> <li>enforcing\uff1a\u5f53\u4f60\u8fdd\u53cd\u4e86\u7b56\u7565\uff0c\u4f60\u5c31\u65e0\u6cd5\u7ee7\u7eed\u64cd\u4f5c\u4e0b\u53bb\u3002</li> </ul> <pre><code>root@device0001:/ # getenforce\nEnforcing\nroot@device0001:/ # setenforce 0\nroot@device0001:/ # getenforce\nPermissive\nroot@device0001:/ # setenforce 1\nroot@device0001:/ # getenforce\nEnforcing\n</code></pre>"},{"location":"android/adb/intro/#_3","title":"\u67e5\u770b\u5c4f\u5e55\u4fe1\u606f","text":"<p>adb shell dumpsys window displays</p> <pre><code>Dump time : 2020-03-26 11:20:00.686\nWINDOW MANAGER DISPLAY CONTENTS (dumpsys window displays)\n  Display: mDisplayId=0\n    init=1200x1920 240dpi cur=1200x1920 app=1200x1848 rng=1200x1092-1920x1812\n    deferred=false mLayoutNeeded=true mTouchExcludeRegion=SkRegion((0,0,1200,1920))\n...\n</code></pre>"},{"location":"android/adb/intro/#_4","title":"\u77ed\u4fe1","text":"<p>\u67e5\u77ed\u4fe1 <pre><code>adb shell content query --uri content://sms/\n</code></pre></p>"},{"location":"android/adb/intro/#app_1","title":"\u67e5\u770bapp\u4fe1\u606f","text":"<p>\u67e5\u770b\u7248\u672c\u4fe1\u606f <pre><code>adb shell dumpsys package [pkg name] | grep version\n</code></pre></p> <p>\u4f8b\u5982\u67e5\u770b\u5305\u540d\u4e3a<code>com.tencent.mm</code>\u7684\u7248\u672c\u4fe1\u606f\u3002\u5728mac\u4e2d\u6267\u884c <pre><code>adb shell dumpsys package com.tencent.mm | grep version\n    versionCode=1740 minSdk=21 targetSdk=28\n    versionName=7.0.18\n    signatures=PackageSignatures{91e147 version:1, signatures:[962f5b7], past signatures:[]}\n</code></pre></p>"},{"location":"android/adb/intro/#app_2","title":"\u67e5\u770b\u5f53\u524dapp","text":"<p>\u5f53\u524d\u53ef\u89c1\u7684app\u7684\u5305\u540d <pre><code>adb shell dumpsys window w | grep -n mCurrentFocus\n</code></pre></p>"},{"location":"android/adb/monkey-test-use/","title":"Monkey Test","text":""},{"location":"android/adb/monkey-test-use/#cmd","title":"cmd\u542f\u52a8\u6d4b\u8bd5","text":"<p>\u53ea\u6d4b\u8bd5launcher3\uff1a adb shell monkey -p com.cyanogenmod.trebuchet -v 10000 &gt; mtr11271352.txt</p> <p>Launcher3\u7684\u5305\u540d\u88ab\u6539\u5199\u4e3acom.cyanogenmod.trebuchet LOCAL_AAPT_FLAGS += --rename-manifest-package com.cyanogenmod.trebuchet</p>"},{"location":"android/adb/monkey-test-use/#monkey","title":"\u5173\u4e8eMonkey\u6d4b\u8bd5\u7684\u505c\u6b62\u6761\u4ef6","text":"<p>Monkey Test\u6267\u884c\u8fc7\u7a0b\u4e2d\u5728\u4e0b\u5217\u4e09\u79cd\u60c5\u51b5\u4e0b\u4f1a\u81ea\u52a8\u505c\u6b62\uff1a</p> <p>1\u3001\u5982\u679c\u9650\u5b9a\u4e86Monkey\u8fd0\u884c\u5728\u4e00\u4e2a\u6216\u51e0\u4e2a\u7279\u5b9a\u7684\u5305\u4e0a\uff0c\u90a3\u4e48\u5b83\u4f1a\u76d1\u6d4b\u8bd5\u56fe\u8f6c\u5230\u5176\u5b83\u5305\u7684\u64cd\u4f5c\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c\u963b\u6b62\u3002</p> <p>2\u3001\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u5d29\u6e83\u6216\u63a5\u6536\u5230\u4efb\u4f55\u5931\u63a7\u5f02\u5e38\uff0cMonkey\u5c06\u505c\u6b62\u5e76\u62a5\u9519\u3002</p> <p>3\u3001\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u4ea7\u751f\u4e86\u5e94\u7528\u7a0b\u5e8f\u4e0d\u54cd\u5e94\uff08application not responding\uff09\u7684\u9519\u8bef\uff0cMonkey\u5c06\u4f1a\u505c\u6b62\u5e76\u62a5\u9519\u3002</p> <p>\u4f8b\u5982\u67d0\u4e2a\u6d4b\u8bd5\u8bb0\u5f55\u4e2d\uff1a ANR in com.cyanogenmod.trebuchet (com.cyanogenmod.trebuchet/com.android.launcher3.Launcher)</p>"},{"location":"android/adb/monkey-test-use/#monkey-test","title":"\u53ef\u4ee5\u7528\u811a\u672c\u542f\u52a8 Monkey test","text":"<p>\u6bd4\u5982\u5bf9Launcher3\u8fdb\u884cMonkey test\uff1a</p> <pre><code>#!/bin/sh\n\necho \"***************************************\"\necho \"*****      Monkey run !!!!!!     ******\"\necho \"***************************************\"\nRECORD_FOLDER=`date +%Y%m%d`\nFOLDER_TIME=`date +%H%M%S`\nmkdir testRecord-$RECORD_FOLDER-$FOLDER_TIME\ncd testRecord-$RECORD_FOLDER-$FOLDER_TIME\nfor i in {1..10}\n    do\n    adb shell input keyevent 3\n    START_TIME=`date +%H%M%S`\n    echo \"Now run the NO.$i test - start time : $START_TIME\"\n    adb shell monkey -p com.cyanogenmod.trebuchet -v 10000 &gt; mtr_$i-$START_TIME.log\ndone\ngrep -nr \"System appears to have crashed\" --exclude=*.txt &gt; crashRecord.txt\necho \"*********     Finish!     *************\"\n</code></pre>"},{"location":"android/adb/monkey-test-use/#_1","title":"\u9644\u5f55","text":"<p>\u547d\u4ee4\u884c\u8f93\u5165HOME\u952e\uff1a adb shell input keyevent 3</p> <p>keycode\u5728 KeyEvent.java (frameworks/base/core/java/android/view)</p>"},{"location":"android/aidl/intro_use/","title":"Android AIDL \u4e86\u89e3\u4e0e\u4f7f\u7528","text":""},{"location":"android/aidl/intro_use/#aidl","title":"AIDL\u7b80\u4ecb","text":"<p>AIDL\uff08Android Interface Definition Language, Android \u63a5\u53e3\u5b9a\u4e49\u8bed\u8a00\uff09 \u7528\u4e8e\u5b9a\u4e49C/S\u4f53\u7cfb\u7ed3\u6784\u4e2dServer\u7aef\u53ef\u4ee5\u63d0\u4f9b\u7684\u670d\u52a1\u8c03\u7528\u63a5\u53e3\uff0c\u6846\u67b6\u5c42\u63d0\u4f9b\u7684Java\u7cfb\u7edf\u670d\u52a1\u63a5\u53e3\u5927\u591a\u7531AIDL\u8bed\u8a00\u5b9a\u4e49\u3002 Android\u63d0\u4f9b\u4e86AIDL\u5de5\u5177\uff0c\u53ef\u5c06AIDL\u6587\u4ef6\u7f16\u8bd1\u6210Java\u6587\u4ef6\u3002\u63d0\u9ad8\u670d\u52a1\u5f00\u53d1\u7684\u6548\u7387</p> <p>\u7a0b\u5e8f\u5458\u53ef\u4ee5\u5229\u7528AIDL\u81ea\u5b9a\u4e49\u7f16\u7a0b\u63a5\u53e3\uff0c\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u4e4b\u95f4\u5b9e\u73b0\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff08IPC\uff09\u3002 \u5728Android\u5e73\u53f0\u4e0a\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u901a\u5e38\u4e0d\u80fd\u8bbf\u95ee\u53e6\u5916\u4e00\u4e2a\u8fdb\u7a0b\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u56e0\u6b64\uff0cAndroid\u5e73\u53f0\u5c06\u8fd9\u4e9b\u8de8\u8fdb\u7a0b\u8bbf\u95ee\u7684\u5bf9\u8c61\u5206\u89e3\u6210\u64cd\u4f5c\u7cfb\u7edf\u80fd\u591f\u8bc6\u522b\u7684\u7b80\u5355\u5bf9\u8c61\u3002 \u5e76\u4e3a\u8de8\u5e94\u7528\u8bbf\u95ee\u800c\u7279\u6b8a\u7f16\u6392\u548c\u6574\u7406\u8fd9\u4e9b\u5bf9\u8c61\u3002\u7528\u4e8e\u7f16\u6392\u548c\u6574\u7406\u8fd9\u4e9b\u5bf9\u8c61\u7684\u4ee3\u7801\u7f16\u5199\u8d77\u6765\u5341\u5206\u5197\u957f\uff0c\u6240\u4ee5Android\u7684AIDL\u63d0\u4f9b\u4e86\u76f8\u5173\u5de5\u5177\u6765\u81ea\u52a8\u751f\u6210\u8fd9\u4e9b\u4ee3\u7801\u3002</p> <p>\u5f00\u53d1\u4eba\u5458\u53ea\u9700\u8981\u5728AIDL\u6587\u4ef6\u4e2d\u5b9a\u4e49Server\u7aef\u53ef\u4ee5\u63d0\u4f9b\u7684\u670d\u52a1\u65b9\u6cd5\uff0cAIDL\u5de5\u5177\u4fbf\u53ef\u5c06\u5176\u8f6c\u5316\u4e3aJava\u6587\u4ef6\u3002\u8f6c\u5316\u540e\u7684Java\u6587\u4ef6\u5305\u542bC/S\u4f53\u7cfb\u7ed3\u6784\u7684\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <ul> <li>\u670d\u52a1\u63a5\u53e3 \uff08IPowerManager\uff09</li> <li>\u670d\u52a1\u5728Client\u7aef\u7684\u4ee3\u7406\uff08Proxy\uff09</li> <li>\u670d\u52a1\u5b58\u6839\uff08Stub\uff09</li> <li>Binder\u7c7b\u578b\u4e0eIIterface\u7c7b\u578b\u7684\u8f6c\u6362\u63a5\u53e3\uff08asInterface \u548c asBinder \u65b9\u6cd5\uff09</li> <li>\u670d\u52a1\u65b9\u6cd5\u8bf7\u6c42\u7801</li> </ul>"},{"location":"android/aidl/intro_use/#aidl_1","title":"AIDL\u610f\u4e49","text":"<p>AIDL\u5de5\u5177\u5efa\u7acb\u4e86\u57fa\u4e8eBinder\u7684C/S\u4f53\u7cfb\u7ed3\u6784\u7684\u901a\u7528\u7ec4\u4ef6\uff1b\u5f00\u53d1\u8005\u53ef\u4ee5\u4e13\u6ce8\u4e8e\u5f00\u53d1\u670d\u52a1\u7684\u529f\u80fd\uff0c\u800c\u4e0d\u9700\u7406\u4f1a\u5177\u4f53\u7684\u901a\u4fe1\u7ed3\u6784\uff0c\u63d0\u9ad8\u6548\u7387\u3002</p>"},{"location":"android/aidl/intro_use/#_1","title":"\u5e94\u7528\u793a\u4f8b","text":"<p>\u6839\u636e\u4e0a\u6587\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u6211\u4eec\u521b\u5efa\u4e24\u4e2aapk\uff0c\u4e00\u4e2a\u4f5c\u4e3a\u670d\u52a1\u63d0\u4f9b\u65b9\uff0c\u4e00\u4e2a\u4f5c\u4e3aAIDL\u670d\u52a1\u8c03\u7528\u65b9\u3002</p>"},{"location":"android/aidl/intro_use/#aidl_2","title":"AIDL\u670d\u52a1\u63d0\u4f9b\u65b9\u4ee3\u7801","text":"<p>\u9996\u5148\u662fAIDL\u670d\u52a1\u63d0\u4f9b\u65b9\u4e3b\u8981\u6587\u4ef6\u76ee\u5f55 <pre><code>main/aidl/\n`-- com\n    `-- rustfisher\n        `-- ndkproj\n            `-- ITomInterface.aidl // AIDL\u4ee3\u7801\n\nmain/java\n`-- com\n    `-- rustfisher\n        |-- tom\n        |   `-- TomService.java // \u5bf9\u5e94\u7684Service\n\nbuild/generated/source/aidl/\n`-- debug\n    `-- com\n        `-- rustfisher\n            `-- ndkproj\n                `-- ITomInterface.java // \u5de5\u7a0b\u7f16\u8bd1\u540eAIDL\u751f\u6210\u7684Java\u6587\u4ef6 \u63d0\u4f9b\u7ed9\u8c03\u7528\u65b9\n</code></pre></p>"},{"location":"android/aidl/intro_use/#aidl_3","title":"\u65b0\u5efaAIDL\u6587\u4ef6\u5e76\u5199\u597d\u63a5\u53e3","text":"<p>\u8fdb\u5165\u670d\u52a1\u65b9\u7684\u5de5\u7a0b\uff0c\u53f3\u952e\u65b0\u5efaAIDL\u6587\u4ef6<code>ITomInterface.aidl</code>\u3002 \u6587\u4ef6\u4f1a\u9ed8\u8ba4\u751f\u6210\u5728<code>main/aidl/com/rustfisher/ndkproj</code>\u4e0b <pre><code>// ITomInterface.aidl\npackage com.rustfisher.ndkproj;\n\n// \u6587\u4ef6\u540d\u5e94\u8be5\u548c\u63a5\u53e3\u540d\u76f8\u540c\n// \u7f16\u5199\u597dAIDL\u6587\u4ef6\u540e\u53ef\u4ee5\u5148\u7f16\u8bd1\u4e00\u6b21\ninterface ITomInterface {\n    void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat,\n            double aDouble, String aString);\n    String helloAIDL(String name); // \u6b64\u6b21\u4f7f\u7528\u7684\u65b9\u6cd5\n}\n</code></pre></p>"},{"location":"android/aidl/intro_use/#_2","title":"\u7f16\u5199\u670d\u52a1\u65b9\u7684\u63a5\u53e3\u5b9e\u73b0\u4ee3\u7801","text":"<p>\u5728<code>com.rustfisher.tom</code>\u5305\u5185\u521b\u5efa<code>TomService.java</code>\u6587\u4ef6\uff1b\u5efa\u7acb\u5185\u90e8\u7c7b<code>TomServiceImpl</code>\u5b9e\u73b0\u63a5\u53e3\u7684\u529f\u80fd <pre><code>import com.rustfisher.ndkproj.ITomInterface;\n\npublic class TomService extends Service {\n    private static final String TAG = \"rustApp\";\n\n    public class TomServiceImpl extends ITomInterface.Stub {\n\n        @Override\n        public void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat, double aDouble, String aString) throws RemoteException {\n\n        }\n\n        @Override\n        public String helloAIDL(String name) throws RemoteException {\n            Log.d(TAG, name + \" requires helloAIDL()\");\n            return \"Hello \" + name + \", nice to meet you!\";\n        }\n    }\n\n    @Nullable\n    @Override\n    public IBinder onBind(Intent intent) {\n        return new TomServiceImpl(); // \u7ed1\u5b9a\u670d\u52a1\u5219\u8fd4\u56de TomServiceImpl \u5b9e\u4f8b\n    }\n}\n</code></pre></p>"},{"location":"android/aidl/intro_use/#androidmanifestxml","title":"\u670d\u52a1\u65b9\u5728<code>AndroidManifest.xml</code>\u6587\u4ef6\u4e2d\u914d\u7f6e","text":"<p>\u5b9e\u73b0\u4e86<code>TomService</code>\u7c7b\u540e\uff0c\u5bf9\u6b64AIDL\u670d\u52a1\u8fdb\u884c\u914d\u7f6e\uff1b\u5728<code>AndroidManifest.xml</code>\u6587\u4ef6\u4e2d\u914d\u7f6e <pre><code>        &lt;service android:name=\"com.rustfisher.tom.TomService\"&gt;\n            &lt;intent-filter&gt;\n                &lt;action android:name=\"com.rustfisher.ndkproj.ITomInterface\" /&gt;\n            &lt;/intent-filter&gt;\n        &lt;/service&gt;\n</code></pre> action\u91cc\u9762\u5199\u4e0aAIDL\u6587\u4ef6</p>"},{"location":"android/aidl/intro_use/#apk","title":"\u5b89\u88c5\u8fd0\u884c\u6b64apk\u5230\u624b\u673a\u4e0a","text":"<p>\u8ba9\u670d\u52a1\u65b9\u8fd0\u884c\u8d77\u6765</p>"},{"location":"android/aidl/intro_use/#aidl_4","title":"AIDL\u8c03\u7528\u65b9\u4ee3\u7801\uff08\u5ba2\u6237\u7aef\uff09","text":"<p>\u5efa\u7acb\uff08\u6216\u8fdb\u5165\uff09AIDL\u8c03\u7528\u65b9\u7684\u5de5\u7a0b\uff0c\u8fd9\u91cc\u662faidlcaller\u5de5\u7a0b\u3002</p> <p>\u4e3b\u8981\u6587\u4ef6\u76ee\u5f55 <pre><code>java/\n`-- com\n    |-- rust\n    |   `-- aidlcaller\n    |       `-- MainActivity.java // \u6f14\u793a\u7528\u7684\n    `-- rustfisher\n        `-- ndkproj // \u8fd9\u4e2a\u8def\u5f84\u5c3d\u91cf\u4fdd\u6301\u4e0e\u670d\u52a1\u63d0\u4f9b\u65b9\u90a3\u91cc\u7684\u4e00\u81f4\n            `-- ITomInterface.java // \u4ece\u670d\u52a1\u65b9\u90a3\u91cccopy\u6765\u7684\n</code></pre></p> <p>\u6709\u5982\u4e0b3\u4e2a\u6b65\u9aa4\uff1a * 1.\u5c06AIDL\u670d\u52a1\u7aef\u751f\u6210\u7684Java\u6587\u4ef6\u590d\u5236\u5230\u8c03\u7528\u65b9\u5de5\u7a0b\u91cc\uff0c\u5c3d\u91cf\u4fdd\u6301\u8fd9\u4e2aJava\u6587\u4ef6\u7684\u8def\u5f84\u4e0e\u670d\u52a1\u7aef\u7684\u4e00\u81f4\uff0c\u4fbf\u4e8e\u8bc6\u522b * 2.\u5199\u4ee3\u7801\u7ed1\u5b9a\u670d\u52a1\uff0c\u83b7\u53d6AIDL\u670d\u52a1\u5bf9\u8c61 * 3.\u901a\u8fc7AIDL\u670d\u52a1\u5bf9\u8c61\u5b8c\u6210AIDL\u63a5\u53e3\u8c03\u7528</p> <p>\u7f16\u5199\u8c03\u7528\u65b9<code>MainActivity.java</code>\u4ee3\u7801 <pre><code>import com.rustfisher.ndkproj.ITomInterface;\n\npublic class MainActivity extends AppCompatActivity {\n\n    private static final String TAG = \"rustApp\";\n    ITomInterface mTomService; // AIDL \u670d\u52a1\n    TextView mTv1;\n\n    private ServiceConnection serviceConnection = new ServiceConnection() {\n        @Override\n        public void onServiceConnected(ComponentName name, IBinder service) {\n            mTomService = ITomInterface.Stub.asInterface(service);// \u83b7\u53d6\u670d\u52a1\u5bf9\u8c61\n            mTv1.setClickable(true); // \u9700\u8981\u7b49\u670d\u52a1\u7ed1\u5b9a\u597d  \u518d\u5141\u8bb8\u70b9\u51fb\n            Log.d(TAG, \"[aidlcaller] onServiceConnected\");\n        }\n\n        @Override\n        public void onServiceDisconnected(ComponentName name) {\n            Log.d(TAG, \"onServiceDisconnected \" + name);\n        }\n    };\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        initAIDLService();\n        initUI();\n    }\n\n    private void initUI() {\n        mTv1 = (TextView) findViewById(R.id.tv1);\n        mTv1.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                try {\n                    String hello = mTomService.helloAIDL(\"Jerry\");\n                    Log.d(TAG, hello);\n                } catch (Exception e) {\n                    Log.e(TAG, \"mTomService initAIDLService: Fail \", e);\n                    e.printStackTrace();\n                }\n            }\n        });\n    }\n\n    private void initAIDLService() {\n        // \u8fd9\u4e2a\u662f\u670d\u52a1\u63d0\u4f9b\u65b9\u7684AndroidManifest action\n        Intent intent = new Intent(\"com.rustfisher.ndkproj.ITomInterface\");\n        intent.setPackage(\"com.rustfisher.ndkproj\"); // \u670d\u52a1\u63d0\u4f9b\u8005\u7684\u5305\u540d\n        bindService(intent, serviceConnection, Context.BIND_AUTO_CREATE);\n    }\n}\n</code></pre></p>"},{"location":"android/aidl/intro_use/#_3","title":"\u6d4b\u8bd5\u548c\u6548\u679c","text":"<p>\u70b9\u51fb\u8c03\u7528\u7aef\u7684View\uff0c\u6253\u51falog <code>Hello Jerry, nice to meet you!</code> \u670d\u52a1\u7aefapk\u6253\u5370log\uff1a<code>Jerry requires helloAIDL()</code></p> <p>\u5982\u679c\u8c03\u7528\u5931\u8d25\u5219\u629b\u51fa <code>android.os.DeadObjectException</code></p> <p>\u5f53\u670d\u52a1\u63d0\u4f9b\u65b9App\u6ca1\u6709\u5728\u8fd0\u884c\u65f6\uff0c\u8c03\u7528\u65b9\u53bb\u8bf7\u6c42\u670d\u52a1\u4f1a\u5931\u8d25\u3002</p> <p>\u670d\u52a1\u7aef\u66f4\u65b0\u540e\uff0c\u5982\u679caidl\u6587\u4ef6\u6ca1\u6539\u52a8\uff0c\u4e0d\u9700\u8981\u66f4\u65b0\u751f\u6210\u7684Java\u6587\u4ef6 \u5982\u679c\u670d\u52a1\u7aefapk\u88ab\u5378\u8f7d\uff0c\u8c03\u7528\u7aef\u4f7f\u7528\u6b64\u670d\u52a1\u65f6\u4f1a\u51fa\u9519</p>"},{"location":"android/aidl/intro_use/#_4","title":"\u53c2\u8003\u8d44\u6599","text":"<p>Android Binder \u673a\u5236\u4ecb\u7ecd</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u7b80\u4e66</p>"},{"location":"android/androidx/viewModel/when-viewmodel-release-juejin/","title":"ViewModel\u5b9e\u4f8b\u4ec0\u4e48\u65f6\u5019\u88ab\u56de\u6536","text":"\u66f4\u65b0\u65e5\u671f 2024-01-05 <ul> <li>2024-01-05 \u5f15\u5165\u6587\u6863</li> </ul> <p>\u5f15\u7528\u6765\u6e90</p> <p>\u4f5c\u8005\uff1aTechMix</p> <p>\u94fe\u63a5\uff1ahttps://juejin.cn/post/7257085326471069751</p> <p>\u6765\u6e90\uff1a\u7a00\u571f\u6398\u91d1</p>"},{"location":"android/androidx/viewModel/when-viewmodel-release-juejin/#viewmodel_1","title":"\u4e00\u3001ViewModel\u5b58\u5728\u7684\u610f\u4e49\uff1f","text":"<p>ViewModel\u4f5c\u4e3aJetPack\uff08AndroidX\uff09\u4e2d\u91cd\u8981\u7684\u7ec4\u4ef6\uff0c\u7ffb\u8bd1\u6210\u4e2d\u6587\u5c31\u662f\u201c\u89c6\u56fe\u6a21\u578b\u201d\uff0c\u6839\u636e\u5206\u79bb\u5173\u6ce8\u70b9\u539f\u5219\uff0cViewModel\u7684\u51fa\u73b0\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u5206\u62c5Activity\u4e2d\u7684\u804c\u8d23\uff0c\u4e13\u95e8\u7528\u4e8e\u5b58\u653e\u548c\u754c\u9762\u76f8\u5173\u7684\u6570\u636e\u3002\u53ea\u8981\u662f\u5728\u754c\u9762\u4e0a\u80fd\u770b\u5230\u7684\u6570\u636e\uff0c\u5b83\u7684\u76f8\u5173\u53d8\u91cf\u90fd\u5e94\u8be5\u5b58\u653e\u5728ViewModel\u4e2d\uff0c\u800c\u4e0d\u662fActivity\u4e2d\u3002</p> <p>\u5982\u679cViewModel\u4f5c\u7528\u53ea\u662f\u5c06\u539f\u672c\u5b58\u653e\u5728Activity/Fragment\u4e2d\u7684\u6570\u636e\u62c6\u5206\u51fa\u53bb\uff0c\u90a3\u5c82\u4e0d\u662f\u8ddf\u666e\u901a\u7684Java\u7c7b\u6ca1\u5565\u4e24\u6837\uff1f</p> <p>\u5176\u5b9eViewModel\u66f4\u91cd\u8981\u7684\u662f\uff1a</p> <ul> <li>\u5b9e\u73b0\u6570\u636e\u5171\u4eab\u548c\u8de8\u6a21\u5757\u901a\u4fe1\uff0cViewModel\u7684\u5b58\u50a8\u662f\u4ee5Activity\u7684class\u4e3akey\u5b58\u653e\u7684\uff0c\u5c31\u53ef\u5728\u6709Activity\u4e0a\u4e0b\u6587\u7684\u4e0d\u540c\u5b50\u6a21\u5757\u83b7\u53d6\u5171\u4eab\u7684ViewModel\u5bf9\u8c61\uff1b</li> <li>Configuration\u6539\u53d8\u540eActivity\u91cd\u5efa\u540e\u5c06\u9500\u6bc1\u524d\u7684\u6570\u636e\u518dattach\u5230\u89c6\u56fe\u4e2d\uff1b</li> <li>ViewModel\u4e2d\u63d0\u4f9b\u4e86\u751f\u547d\u5468\u671f\u611f\u77e5\uff08LiveData+Lifecycle\uff09\u548c\u534f\u7a0b\uff08ViewModel\u672c\u8eab\u5b9a\u4e49\u4e86ViewModelScope\u534f\u7a0b\u4f5c\u7528\u57df\uff09\u7684\u652f\u6301\uff1b</li> </ul>"},{"location":"android/androidx/viewModel/when-viewmodel-release-juejin/#_1","title":"\u4e8c\u3001\u600e\u4e48\u521b\u5efa\uff1f","text":""},{"location":"android/androidx/viewModel/when-viewmodel-release-juejin/#viewmodelprovidersofget","title":"\u7b2c\u4e00\u79cd\u65b9\u6cd5\uff08\u5df2\u5f03\u7528\uff0c\u4e0d\u5efa\u8bae\u4f7f\u7528\uff09\uff1aViewModelProviders.of().get()","text":"<pre><code>val viewModel1 = ViewModelProviders.of(this).get(TestClearViewModel::class.java)\n</code></pre> <p>\u8be5\u65b9\u5f0f\u5df2\u7ecf\u88ab\u5b98\u65b9\u5f03\u7528\uff0c\u4e0d\u518d\u5efa\u8bae\u4f7f\u7528\uff0c\u5176\u5b9e\u8ddf\u8e2aViewModelProviders.of()\u65b9\u6cd5\u5b9e\u73b0\uff0c\u5185\u90e8\u5c31\u662fnew\u4e86\u4e00\u4e2aViewModelProvider\u5bf9\u8c61\u3002</p> <p></p>"},{"location":"android/androidx/viewModel/when-viewmodel-release-juejin/#viewmodelprovidergetviewmodelclass","title":"\u7b2c\u4e8c\u79cd\u65b9\u6cd5\uff08\u7b2c\u4e00\u79cd\u65b9\u6848\u884d\u751f\u51fa\u6765\u7684\uff09\uff1a\u81ea\u5df1\u521b\u5efaViewModelProvider\u5b9e\u4f8b\uff0c\u8c03\u7528\u5176get()\u65b9\u6cd5\uff0c\u4f20\u5165ViewModel\u7684class\u5bf9\u8c61","text":"<p>\u83b7\u53d6\u4ee3\u7801</p> <pre><code>val viewModel = ViewModelProvider(this).get(TestClearViewModel::class.java)\n</code></pre> <p>\u5f0a\u7aef</p> <p>\u5728\u540c\u4e00\u4e2aActivity\u7684\u4e0a\u4e0b\u6587\uff0c\u5728\u4e0d\u540c\u7684\u6a21\u5757\uff08\u7c7b\uff0c\u5373\u4f7f\u540c\u4e00\u4e2a\u529f\u80fd\u6a21\u5757\u4e5f\u4f1a\u6309\u5355\u4e00\u804c\u8d23\u62c6\u5206\u4ee3\u7801\uff09\u4e2d\uff0c\u60f3\u8981\u83b7\u53d6\u5171\u4eab\u7684ViewModel\u5b9e\u4f8b\u4f1anew\u591a\u4e2aViewModelProvider()\u5bf9\u8c61\u3002 </p>"},{"location":"android/androidx/viewModel/when-viewmodel-release-juejin/#kt","title":"\u7b2c\u4e09\u79cd\u65b9\u6cd5\uff08kt\u59d4\u6258\uff09","text":"<pre><code>val viewModel3 by viewModels&lt;TestClearViewModel&gt;()\n</code></pre> <p>\u4f7f\u7528\u8be5\u65b9\u6cd5\u83b7\u53d6ViewModel\u5b9e\u4f8b\uff0c\u9700\u8981\u6dfb\u52a0\u4ee5\u4e0b\u4f9d\u8d56\uff1a</p> <pre><code>// ps: \u7248\u672c\u9009\u53d6\u9002\u5408\u81ea\u5df1\u9879\u76ee\u7684\nimplementation 'androidx.activity:activity-ktx:1.6.0'\n</code></pre> <p>\u5b9e\u73b0\u4ee3\u7801\uff1a <pre><code>@MainThread\npublic inline fun &lt;reified VM : ViewModel&gt; ComponentActivity.viewModels(\n    noinline extrasProducer: (() -&gt; CreationExtras)? = null,\n    noinline factoryProducer: (() -&gt; Factory)? = null\n): Lazy&lt;VM&gt; {\n    val factoryPromise = factoryProducer ?: {\n        defaultViewModelProviderFactory\n    }\n\n    return ViewModelLazy(\n        VM::class,\n        { viewModelStore },\n        factoryPromise,\n        { extrasProducer?.invoke() ?: this.defaultViewModelCreationExtras }\n    )\n}\n</code></pre></p> <p>\u6700\u7ec8\u5b9e\u73b0\u8fd8\u662f\u901a\u8fc7new\u4e00\u4e2aViewModelProvider\u4f20\u5165ViewModelProvider.Factory\u5bf9\u8c61\u7684\u65b9\u5f0f\u521b\u5efa\u7684ViewModel\u5bf9\u8c61\uff0c\u4e0d\u540c\u7684\u662f\u901a\u8fc7kt\u7684Lazy\u673a\u5236\uff0c\u5b9e\u73b0\u4e86\u4e00\u5c42\u7f13\u5b58\u903b\u8f91\uff1b</p> <pre><code>public class ViewModelLazy&lt;VM : ViewModel&gt; @JvmOverloads constructor(\n    private val viewModelClass: KClass&lt;VM&gt;,\n    private val storeProducer: () -&gt; ViewModelStore, // \u7531Activity\u3001Fragment\u5b9e\u73b0ViewModelStoreOwner\u63a5\u53e3\u540e\u63d0\u4f9b\n    private val factoryProducer: () -&gt; ViewModelProvider.Factory,\n    private val extrasProducer: () -&gt; CreationExtras = { CreationExtras.Empty }\n) : Lazy&lt;VM&gt; {\n    private var cached: VM? = null\n\n    override val value: VM\n        get() {\n            // \u5176\u5b9e\u5728ViewModelStore\u4e2d\u5df2\u7ecf\u6709\u4e00\u5c42HashMap\u5b9e\u73b0\u7684\u7f13\u5b58\u4e86\uff0c\u8fd9\u91cc\u53c8\u589e\u52a0\u4e00\u5c42\u7f13\u5b58\u3002\n            val viewModel = cached\n            return if (viewModel == null) {\n                val factory = factoryProducer()\n                val store = storeProducer()\n                // \u6838\u5fc3\u5b9e\u73b0\u8fd8\u662fViewModelProvider\u6784\u9020\u65b9\u6cd5\u4e2d\u4f20\u5165ViewModelProvider.Factory\u5bf9\u8c61\n                ViewModelProvider(\n                    store,\n                    factory,\n                    extrasProducer()\n                ).get(viewModelClass.java).also {\n                    cached = it\n                }\n            } else {\n                viewModel\n            }\n        }\n\n    override fun isInitialized(): Boolean = cached != null\n}\n</code></pre> <ul> <li>\u4ece\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\u770b\u5230viewModels()\u65b9\u6cd5\u662f\u505a\u4e3aComponentActivity\u7684\u62d3\u5c55\u65b9\u6cd5\u5b9e\u73b0\u7684\uff1b</li> <li>\u61d2\u52a0\u8f7d\u6309\u9700\u521b\u5efaViewModel\u5b9e\u4f8b</li> <li>ViewModelProvider.Factory\u4f7f\u7528\u7684\u662fComponentActivity\u4e2d\u7684\u9ed8\u8ba4\u5b9e\u73b0defaultViewModelProviderFactory</li> </ul>"},{"location":"android/androidx/viewModel/when-viewmodel-release-juejin/#_2","title":"\u4e09\u3001\u751f\u547d\u5468\u671f\uff1f\u4ec0\u4e48\u65f6\u5019\u88ab\u9500\u6bc1\uff1f","text":"<p>\u7f51\u4e0a\u5f88\u591a\u5173\u4e8eViewModel\u7684\u8bf4\u6cd5\uff0c\u6709\u7c7b\u4f3c\u201cViewModel\u7684\u751f\u547d\u5468\u671f\u662f\u957f\u4e8eActivity\u7684\u201d\u8fd9\u6837\u7684\u8bf4\u6cd5\uff0c\u5176\u5b9e\u662f\u5bb9\u6613\u8ba9\u4eba\u4ea7\u751f\u8bef\u89e3\u7684\u3002 \u4e0b\u9762\u8fdb\u884c\u6d4b\u8bd5\u9a8c\u8bc1\u4e00\u4e0b\uff0c\u7406\u89e3\u4e00\u4e0bViewModel\u7684\u5b58\u6d3b\u5468\u671f\u3002 \u6d4b\u8bd5\u4ee3\u7801\u5f88\u7b80\u5355\uff0c\u5728Activity\u4e2d\u521b\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684ViewModel</p> <pre><code>// TestClearViewModel.kt\u7684\u5b9e\u73b0\uff1a\nclass TestClearViewModel : ViewModel() {\n    var userId = MutableLiveData&lt;String&gt;()\n\n    override fun onCleared() {\n        super.onCleared()\n        Log.d(MainActivity2.TAG, \"onCleared: $this\")\n    }\n}\n\n// MainActivity2.kt\u7684\u5b9e\u73b0\u4ee3\u7801\uff1a\nclass MainActivity2 : AppCompatActivity() {\n    companion object {\n        const val TAG = \"MainActivity_TAG\"\n    }\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main2)\n\n        val viewModel by viewModels&lt;TestClearViewModel&gt;()\n        Log.d(TAG, \"onCreate viewModel: $viewModel\")\n    }\n\n    override fun onConfigurationChanged(newConfig: Configuration) {\n        super.onConfigurationChanged(newConfig)\n        Log.d(TAG, \"onConfigurationChanged: \")\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        Log.d(TAG, \"onDestroy: \")\n    }\n}\n</code></pre> <p>case1 : \u6b63\u5e38\u7684\u6309back\u952efinish\u6389Activity\uff0c\u518d\u91cd\u5efaActivity:</p> <pre><code>// \u6309back\u952e\u4e4b\u540e\u7684log:\ncom.yanggui.mvvmdemo2 D/MainActivity_TAG: onCreate viewModel: com.yanggui.mvvmdemo2.TestClearViewModel@86439b1\ncom.yanggui.mvvmdemo2 D/MainActivity_TAG: onCleared: com.yanggui.mvvmdemo2.TestClearViewModel@86439b1\ncom.yanggui.mvvmdemo2 D/MainActivity_TAG: onDestroy: \n\n// \u91cd\u73b0\u70b9\u51fb\u684c\u9762\u56fe\u6807\uff0c\u91cd\u542fActivity\u4e4b\u540e\u7684log:\ncom.yanggui.mvvmdemo2 D/MainActivity_TAG: onCreate viewModel: com.yanggui.mvvmdemo2.TestClearViewModel@8e96463\n</code></pre> <p>\u4ece\u4e0a\u9762\u7684log\u53ef\u4ee5\u770b\u5230\uff0cViewModel\u662f\u8ddf\u968fActivity\u7684\u9500\u6bc1\u800c\u9500\u6bc1\u7684\uff0cActivity\u91cd\u542f\u4e4b\u540eViewModel\u4e5f\u4f1a\u65b0\u5efa\u4e00\u4e2a\u5b9e\u4f8b\u3002</p> <p>case2 : \u65cb\u8f6c\u5c4f\u5e55\u4e4b\u540efinish\u6389Activity\uff0c\u5f15\u8d77\u7684Activity\u91cd\u5efa:</p> <pre><code>// Activity\u5728\u70b9\u51fb\u684c\u9762\u56fe\u6807\uff0c\u5e94\u7528\u542f\u52a8\u65f6\u521b\u5efa\u7684ViewModel\u5b9e\u4f8b\uff1a\ncom.yanggui.mvvmdemo2 D/MainActivity_TAG: onCreate viewModel: com.yanggui.mvvmdemo2.TestClearViewModel@c26ae96\n\n// \u7b2c\u4e00\u6b21\u65cb\u8f6c\u5c4f\u5e55\u5f15\u8d77Activity\u91cd\u5efa\uff1a\ncom.yanggui.mvvmdemo2 D/MainActivity_TAG: onDestroy: \ncom.yanggui.mvvmdemo2 D/MainActivity_TAG: onCreate viewModel: com.yanggui.mvvmdemo2.TestClearViewModel@c26ae96\n\n// \u7b2c\u4e8c\u6b21\u65cb\u8f6c\u5c4f\u5e55\u5f15\u8d77Activity\u91cd\u5efa\uff1a\ncom.yanggui.mvvmdemo2 D/MainActivity_TAG: onDestroy: \ncom.yanggui.mvvmdemo2 D/MainActivity_TAG: onCreate viewModel: com.yanggui.mvvmdemo2.TestClearViewModel@c26ae96\n</code></pre> <p>\u901a\u8fc7\u4e0a\u8ff0\u5b9e\u9645\u9a8c\u8bc1\uff0c\u65cb\u8f6c\u5c4f\u5e55\u5176\u5b9eViewModel\u4e0d\u4f1a\u91cd\u5efa\u3002</p> <p>\u6839\u636e\u4e0a\u8ff0\u5b9e\u9645\u4ee3\u7801\u9a8c\u8bc1\uff0c\u4e5f\u80fd\u8bf4\u660egoogle\u5b98\u65b9\u8fd9\u5f20\u6d41\u7a0b\u56fe\uff1a</p> <p></p> <ul> <li>\u6b63\u5e38\u60c5\u51b5\u7684onDestroy\uff0cViewModel\u4f1a\u8ddf\u968fActivity\u9500\u6bc1\u800c\u9500\u6bc1\uff1b</li> <li>\u5f02\u5e38\u60c5\u51b5\u4e0b\u7684onDestroy\uff0cViewModel\u4e0d\u4f1a\u8ddf\u968fActivity\u9500\u6bc1\u800c\u9500\u6bc1\uff0c\u56e0\u4e3a\u8981\u5728Activity\u5f02\u5e38\u9500\u6bc1\u4e4b\u540e\u91cd\u5efa\u65f6\u7528\u6765\u6839\u636eViewModel\u7684\u6570\u636e\u6062\u590d\u754c\u9762\uff1b</li> </ul>"},{"location":"android/androidx/viewModel/when-viewmodel-release-juejin/#31-viewmodel","title":"3.1 \u65cb\u8f6c\u5c4f\u5e55\u4e4b\u540eViewModel\u4e3a\u4ec0\u4e48\u4e0d\u4f1a\u91cd\u5efa\uff1f","text":"<p>ViewModel\u662f\u7531ViewModelStore\u7c7b\u7ba1\u7406\u7684\uff0c\u5728\u5176\u5185\u90e8\u7ef4\u62a4\u4e86\u4e00\u4e2aHashMap\uff0ckey\u662fandroidx.lifecycle.ViewModelProvider.DefaultKey\uff1a+ ViewModel\u7684Class\u5bf9\u8c61\u7684canonicalName\u62fc\u63a5\u800c\u6210\u7684\uff0cvalue\u5c31\u662fViewModel\u5bf9\u8c61\u3002</p> ViewModelStore.java\uff1a<pre><code>// ViewModelStore.java\uff1a\npublic class ViewModelStore {\n    // ViewModelStore\u5b58\u50a8\u591a\u4e2aViewModel\u5b9e\u4f8b\uff0c\u7528HashMap\u5b58\u653e\n    private final HashMap&lt;String, ViewModel&gt; mMap = new HashMap&lt;&gt;();\n\n    final void put(String key, ViewModel viewModel) {\n        ViewModel oldViewModel = mMap.put(key, viewModel);\n        if (oldViewModel != null) {\n            oldViewModel.onCleared();\n        }\n    }\n\n    final ViewModel get(String key) {\n        return mMap.get(key);\n    }\n\n    Set&lt;String&gt; keys() {\n        return new HashSet&lt;&gt;(mMap.keySet());\n    }\n\n    /**\n     *  Clears internal storage and notifies ViewModels that they are no longer used.\n     */\n    public final void clear() {\n        for (ViewModel vm : mMap.values()) {\n            vm.clear();\n        }\n        mMap.clear();\n    }\n}\n</code></pre> <p>ViewModelStore\u548cViewModelStoreOwner\u7684\u5173\u7cfb ViewModelStoreOwner\u5176\u5b9e\u5c31\u662f\u5e38\u89c1\u7684Fragment\u3001ComponentActivity\uff08\u5b9e\u73b0\u4e86ViewModelStoreOwner\uff09</p> <p></p> <p>ComponentActivity#getViewModelStore(): <pre><code>@NonNull\n@Override\npublic ViewModelStore getViewModelStore() {\n    if (getApplication() == null) {\n        throw new IllegalStateException(\"Your activity is not yet attached to the \"\n                + \"Application instance. You can't request ViewModel before onCreate call.\");\n    }\n    if (mViewModelStore == null) {\n        //\uff081\uff09\n        NonConfigurationInstances nc =\n                (NonConfigurationInstances) getLastNonConfigurationInstance();\n        if (nc != null) {\n            //\uff082\uff09\n            // Restore the ViewModelStore from NonConfigurationInstances\n            mViewModelStore = nc.viewModelStore;\n        }\n        //\uff083\uff09\n        // \u76f4\u63a5new\u4e86\u4e00\u4e2aViewModelStore\u7528\u6237\u7ba1\u7406\u4e00\u4e2aViewModel Map\u96c6\u5408\n        if (mViewModelStore == null) {\n            mViewModelStore = new ViewModelStore();\n        }\n    }\n    return mViewModelStore;\n}\n</code></pre></p> <p>\uff081\uff09\u8fd9\u4e00\u6b65\u5f88\u5173\u952e\uff0cmViewModelStore\u7528\u6765\u7ba1\u7406ViewModel\u7684map\u96c6\u5408\uff0c\u4f46\u662f\u5982\u679cmViewModelStore\u53ea\u662f\u4f5c\u4e3aComponentActivity\u7684\u4e00\u4e2a\u6210\u5458\u53d8\u91cf\uff0c\u90a3Activity\u9500\u6bc1\u91cd\u5efa\u540e\uff0cmViewModelStore\u4e5f\u4e00\u5b9a\u4f1a\u9500\u6bc1\u91cd\u5efa\u3002\u5728\uff083\uff09\u4e0b\u9762\u7684\u4ee3\u7801\u4e2d\u4e5f\u53ef\u4ee5\u770b\u5230mViewModelStore\u662f\u5728getViewModelStore()\u4e2d\u76f4\u63a5new\u51fa\u6765\u7684\u3002</p> <p>Fragment#getViewModelStore(): \u8f6c\u8c03FragmentManager#getViewModelStore()\uff0c\u6700\u7ec8\u5728FragmentManagerViewModel\u4e2d\u7ef4\u62a4\u4e86\u4e00\u4e2a<code>Map&lt;String, ViewModelStore&gt;</code>,\u7528\u4e8e\u5b58\u653e\u591a\u4e2aFragemnt\u5bf9\u5e94\u7684ViewModel\u5b9e\u4f8b\uff0c\u4ee5who\u53d8\u91cf\u4e3akey\u53bb\u83b7\u53d6ViweModel\u5b9e\u4f8b\uff1b</p> <pre><code>    @NonNull\n    @Override\n    public ViewModelStore getViewModelStore() {\n        if (mFragmentManager == null) {\n            throw new IllegalStateException(\"Can't access ViewModels from detached fragment\");\n        }\n        return mFragmentManager.getViewModelStore(this);\n    }\n</code></pre> <p>\u5f53ViewModel\u88ab\u9500\u6bc1\u65f6\u4f1a\u56de\u8c03\u5176onCleared()\u65b9\u6cd5\uff0c\u76f4\u63a5\u8ddf\u8fdb\u8c03\u7528\u70b9\u53d1\u73b0\uff0c\u5728ComponentActivity\u7684\u65e0\u53c2\u6784\u9020\u65b9\u6cd5\u4e2d\u6709\u5982\u4e0b\u4ee3\u7801\uff1a</p> <pre><code>    public ComponentActivity() {\n        // ... \n        getLifecycle().addObserver(new LifecycleEventObserver() {\n            @Override\n            public void onStateChanged(@NonNull LifecycleOwner source,\n                    @NonNull Lifecycle.Event event) {\n                if (event == Lifecycle.Event.ON_DESTROY) {\n                    // Clear out the available context\n                    mContextAwareHelper.clearAvailableContext();\n                    // \u5728\u8fd9\u91cc\u505aViewModel\u7684\u9500\u6bc1\u903b\u8f91\n                    if (!isChangingConfigurations()) {\n                        getViewModelStore().clear();\n                    }\n                }\n            }\n        });\n    // ...\n}\n</code></pre> <p>\u4ece\u5982\u4e0a\u4ee3\u7801\u53ef\u4ee5\u5f97\u51fa\u7ed3\u8bba\uff1a \u975e\u5f02\u5e38\u60c5\u51b5(\u6539\u53d8Configuration\u7b49)\u4e0b\u7684Activity\u9500\u6bc1\uff0cViewModel\u662f\u5728Activity\u7684onDestroy\u751f\u547d\u5468\u671f\u65f6\u9500\u6bc1\u3002</p>"},{"location":"android/androidx/viewModel/when-viewmodel-release-juejin/#32-ischangingconfigurations","title":"3.2 isChangingConfigurations()\u7684\u5b9a\u4e49","text":"<pre><code>// \u4ee5\u4e0b\u4ee3\u7801\u662f\u5728Activity.java\u4e2d\u5b9a\u4e49\u7684\uff1a\nboolean mChangingConfigurations = false;\npublic boolean isChangingConfigurations() {\n    return mChangingConfigurations;\n}\n</code></pre> <p>\u5728Activity\u548cActivity\u7684\u5b50\u7c7b\u4e2d\u90fd\u6ca1\u6709\u627e\u5230\u6709\u8d4b\u503c\u7684\u5730\u65b9\uff0c\u56e0\u4e3a\u4fee\u9970\u7b26\u662fpackage\u7684\uff0c\u4e8e\u662f\u5728\u5176\u76f8\u540c\u5305\u540d\u4e0b\uff0c\u901a\u8fc7Find in files\u67e5\u627e\u5230\u662f\u5728ActivityThread.java\u7684handleRelaunchActivity()\u4e2d\u8d4b\u503c\u4e3atrue\u7684\u3002</p> <pre><code>    // ActivityThread.java\uff0csdk 33\n    @Override\n    public void handleRelaunchActivity(ActivityClientRecord tmp, PendingTransactionActions pendingActions) {\n        // ...\n        r.activity.mConfigChangeFlags |= configChanges;\n        r.mPreserveWindow = tmp.mPreserveWindow;\n        // \u8fd9\u91cc\u4f1a\u5728\u5c4f\u5e55\u65cb\u8f6cActivity\u91cd\u5efa\u65f6\u6267\u884c\uff0c\u5c06activity.mChangingConfigurations\u8d4b\u503c\u4e3atrue\n        r.activity.mChangingConfigurations = true;\n        // ...\n     }\n</code></pre> <p></p> <p>\u4ee5\u4e0a\u53ea\u662f\u9a8c\u8bc1\u4e86Activity.isChangingConfigurations()==true\u7684\u65b9\u5f0f\u4e0d\u4f1a\u8c03\u7528 getViewModelStore().clear() \u53bb\u6e05\u7406\u5f53\u524dActivity\u5173\u8054\u7684ViewModel\u5b9e\u4f8b\u7684HashMap\u96c6\u5408\u3002</p> <p>\u5c4f\u5e55\u65cb\u8f6cActivity\u4f1a\u53d1\u751fonDestroy()-&gt;onCreate\u91cd\u5efa\u7684\u60c5\u51b5\uff0c\u91cd\u5efa\u7684Activity\u662f\u8fd9\u4e48\u5173\u8054\u5230\u4e4b\u524d\u7684ViewModel\u7684Map\u96c6\u5408\u7684\uff1f</p>"},{"location":"android/androidx/viewModel/when-viewmodel-release-juejin/#33","title":"3.3 \u7ed3\u8bba","text":"<p>1\u3001\u624b\u673a\u65cb\u8f6c\u5c4f\u5e55\u65f6Activity\u4f1a\u88ab\u91cd\u5efa\uff0c\u4f46\u662fViewModel\u5b9e\u4f8b\u4e0d\u4f1a\u91cd\u65b0\u521b\u5efa\uff0c\u7531\u6b64\u53ef\u89c1ViewModel\u7684\u751f\u547d\u5468\u671f\u662f\u957f\u4e8eActivity\u7684\u4ec5\u5728\u975e\u6b63\u5e38\u9000\u51fa\u7684\u60c5\u51b5\u6210\u7acb\uff1b</p> <p>ps\uff1a\u4e0a\u8ff0\u73b0\u8c61\u662f\u6e05\u5355\u6587\u4ef6\u4e2dActivity\u8282\u70b9\u4e0d\u914d\u7f6eandroid:configChanges=\"orientation|screenSize\"\u5c5e\u6027\u7684\u60c5\u51b5\u4e0b\u4f1a\u8d70onDestroy-&gt;onCreate\u6d41\u7a0b\uff0cActivity\u88ab\u91cd\u5efa\u3002</p> <pre><code>&lt;activity\n    android:name=\".MainActivity2\"\n    android:exported=\"true\"\n    android:configChanges=\"orientation|screenSize\"&gt; // \u6ce8\uff1a\u4e24\u4e2a\u5c5e\u6027\u90fd\u8981\u5199\u4e0a\u624d\u4f1a\u4e0d\u8d70\u91cd\u5efaActivity\n    &lt;intent-filter&gt;\n        &lt;action android:name=\"android.intent.action.MAIN\" /&gt;\n        &lt;category android:name=\"android.intent.category.LAUNCHER\" /&gt;\n    &lt;/intent-filter&gt;\n&lt;/activity&gt;\n</code></pre> <p>2\u3001\u53ea\u6709\u5f53Activity\u6b63\u5e38\u9000\u51fa\u65f6\u624d\u4f1a\u8ddf\u7740Activity\u4e00\u8d77\u9500\u6bc1\uff1b \u6b63\u5e38\u9000\u51fa\uff1a\u975eConfigurationChange\u9020\u6210\u7684Activity\u91cd\u5efa\u3002</p>"},{"location":"android/app/app-lang-setting/","title":"App\u5185\u8bed\u8a00\u8bbe\u7f6e","text":"<p>App\u4f7f\u7528\u7684\u8bed\u8a00\u53ef\u4ee5\u4e0d\u8ddf\u968f\u7cfb\u7edf\u8bbe\u5b9a\u3002</p>"},{"location":"android/app/app-lang-setting/#_1","title":"\u65b9\u6cd5\u7c7b","text":"<pre><code>    // App\u4f7f\u7528\u7684\u8bed\u8a00\u7c7b\u522b\n    private static final String K_APP_LOCALE_LANGUAGE = \"key_app_locale_language\";\n\n    public static Locale appLocale = Locale.ENGLISH; // app\u5f53\u524d\u4f7f\u7528\u7684locale\n\n    // App\u652f\u6301\u7684\u8bed\u8a00\u7c7b\u578b\n    public static class SupportLanguage {\n        public static final String EN = \"en\";\n        public static final String ZH_CN = \"zh-CN\";\n    }\n\n    // App\u652f\u6301\u7684\u8bed\u8a00\n    public enum SupportLocale {\n        EN(SupportLanguage.EN), ZH_CN(SupportLanguage.ZH_CN);\n        String localeDesc;\n\n        SupportLocale(String localeDesc) {\n            this.localeDesc = localeDesc;\n        }\n    }\n\n    // App\u542f\u52a8\uff0c\u68c0\u67e5\u5e76\u5b58\u4e0b\u5f53\u524d\u624b\u673a\u8bed\u8a00\u7c7b\u578b\n    public static void initAppLocale(Context context) {\n        String lang = context.getSharedPreferences(CONTROL_SP_NAME, Context.MODE_PRIVATE).getString(K_APP_LOCALE_LANGUAGE, \"\");\n//        Log.d(TAG, \"\u8bbe\u7f6e\u7684lang: \" + lang);\n        if (TextUtils.isEmpty(lang)) {\n            String phoneLang = getPhoneLocale().getLanguage();\n            if (Locale.ENGLISH.getLanguage().equals(phoneLang)) {\n                saveCurLocaleName(context, SupportLanguage.EN);\n            } else if (Locale.SIMPLIFIED_CHINESE.getLanguage().equals(phoneLang)) {\n                saveCurLocaleName(context, SupportLanguage.ZH_CN);\n            } else {\n                saveCurLocaleName(context, SupportLanguage.EN); // \u4e0d\u5728\u652f\u6301\u5217\u8868\u5185\u5219\u9ed8\u8ba4\u5b58\u82f1\u6587\n            }\n        }\n        lang = context.getSharedPreferences(CONTROL_SP_NAME, Context.MODE_PRIVATE).getString(K_APP_LOCALE_LANGUAGE, \"\");\n        changeAppLocale(lang);\n    }\n\n    private static void changeAppLocale(String lang) {\n        switch (lang) {\n            case SupportLanguage.ZH_CN:\n                appLocale = Locale.SIMPLIFIED_CHINESE;\n                break;\n            case SupportLanguage.EN:\n            default:\n                appLocale = Locale.ENGLISH;\n                break;\n        }\n    }\n\n    // \u5b58\u50a8\u8bed\u8a00\u8bbe\u7f6e\n    private static void saveCurLocaleName(Context context, String localeName) {\n        context.getSharedPreferences(CONTROL_SP_NAME, Context.MODE_PRIVATE).edit()\n                .putString(K_APP_LOCALE_LANGUAGE, localeName)\n                .apply();\n    }\n\n    // \u66f4\u6539app\u5f53\u524d\u8bed\u8a00\n    public static void changeToLocaleName(Context context, String localeName) {\n        saveCurLocaleName(context, localeName);\n        changeAppLocale(localeName);\n    }\n\n    // \u83b7\u53d6\u624b\u673a\u7684\u8bed\u8a00\u8bbe\u7f6e\n    private static Locale getPhoneLocale() {\n        Locale locale;\n        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) {\n            locale = LocaleList.getDefault().get(0);\n        } else {\n            locale = Locale.getDefault();\n        }\n        return locale;\n    }\n\n    // Application\u66f4\u65b0\u8bed\u8a00\u8bbe\u7f6e\n    public static void updateConfig(Application app, Configuration configuration) {\n        if (appLocale != null) {\n            //Wrapping the configuration to avoid Activity endless loop\n            Configuration config = new Configuration(configuration);\n            // We must use the now-deprecated config.locale and res.updateConfiguration here,\n            // because the replacements aren't available till API level 24 and 17 respectively.\n            config.locale = appLocale;\n            Resources res = app.getBaseContext().getResources();\n            res.updateConfiguration(config, res.getDisplayMetrics());\n        }\n    }\n\n    // \u7528\u4e8eActivity\u66f4\u65b0\u8bed\u8a00\u8bbe\u7f6e\n    public static void updateConfig(ContextThemeWrapper wrapper) {\n        if (appLocale != null) {\n            Configuration configuration = new Configuration();\n            configuration.setLocale(appLocale);\n            wrapper.applyOverrideConfiguration(configuration);\n        }\n    }\n</code></pre>"},{"location":"android/app/app-lang-setting/#application","title":"Application\u4e2d\u8bbe\u7f6e","text":"<pre><code>    @Override\n    public void onCreate() {\n        super.onCreate();\n        MyAppControl.initAppLocale(this);\n        MyAppControl.updateConfig(this, getBaseContext().getResources().getConfiguration());\n\n    }\n\n    @Override\n    public void onConfigurationChanged(Configuration newConfig) {\n        super.onConfigurationChanged(newConfig);\n        MyAppControl.updateConfig(this, newConfig);\n    }\n</code></pre>"},{"location":"android/app/app-lang-setting/#activity","title":"Activity\u57fa\u7840\u7c7b","text":"<pre><code>import android.support.v4.app.FragmentActivity;\n\nimport com.rustfisher.util.MyAppControl;\n\n/**\n * \u57fa\u7840\u7c7b\n * Create on 2019-1-7\n */\npublic abstract class AbsBaseActivity extends FragmentActivity {\n\n    public AbsBaseActivity() {\n        MyAppControl.updateConfig(this); // \u8bbe\u7f6e\u8bed\u8a00\n    }\n}\n</code></pre> <p>\u542b\u6709<code>WebView</code>\u7684Activity\u82e5\u8fdb\u884c\u91cd\u8f7d\u8bed\u8a00\u7684\u64cd\u4f5c\uff0c\u52a0\u8f7dlayout\u65f6webView\u4f1a\u62a5\u9519\uff0c <pre><code>Error inflating class android.webkit.WebView\n</code></pre></p>"},{"location":"android/app/application-reg-lifecycle/","title":"Android\u76d1\u542cactivity\u751f\u547d\u5468\u671f","text":"\u66f4\u65b0\u5185\u5bb9: 2023-07-10 <ul> <li>2023-07-10 \u521b\u5efa\u6587\u6863</li> </ul> <p>Application\u91cc\u9762\u6ce8\u518c <code>registerActivityLifecycleCallbacks</code></p> <pre><code>private int mActStartedCount = 0;\n// ------\n\nregisterActivityLifecycleCallbacks(new ActivityLifecycleCallbacks() {\n    @Override\n    public void onActivityCreated(@NonNull Activity activity, @Nullable Bundle savedInstanceState) {\n\n    }\n\n    @Override\n    public void onActivityStarted(@NonNull Activity activity) {\n        mActStartedCount++;\n        if (mActStartedCount == 1) {\n            //APP\u4ece\u540e\u53f0\u5230\u4e86\u524d\u53f0\n        }\n    }\n\n    @Override\n    public void onActivityResumed(@NonNull Activity activity) {\n\n    }\n\n    @Override\n    public void onActivityPaused(@NonNull Activity activity) {\n\n    }\n\n    @Override\n    public void onActivityStopped(@NonNull Activity activity) {\n        mActStartedCount--;\n        if (mActStartedCount == 0) {\n            // APP\u5230\u4e86\u540e\u53f0\n        }\n    }\n\n    @Override\n    public void onActivitySaveInstanceState(@NonNull Activity activity, @NonNull Bundle outState) {\n\n    }\n\n    @Override\n    public void onActivityDestroyed(@NonNull Activity activity) {\n\n    }\n});\n</code></pre>"},{"location":"android/architect/android-proj-module-use/","title":"Android App \u5de5\u7a0b\u4e2d\u7684\u6a21\u5757\u5316","text":"<p>\u5c06\u4e00\u4e2a\u5927\u9879\u76ee\u62c6\u5206\u6210\u4e92\u76f8\u72ec\u7acb\u7684\u6a21\u5757\uff0c\u964d\u4f4e\u5404\u4e2a\u90e8\u5206\u4e4b\u95f4\u7684\u8026\u5408\u6027\u3002 \u80fd\u5927\u5927\u63d0\u9ad8\u4ee3\u7801\u590d\u7528\u80fd\u529b\uff0c\u4e5f\u80fd\u7f15\u6e05\u9879\u76ee\u7684\u67b6\u6784\u3002\u4fbf\u4e8e\u56e2\u961f\u534f\u540c\u5f00\u53d1\u3002 \u6a21\u5757\u5316\u540e\uff0c\u4fbf\u4e8e\u8fdb\u884c\u5355\u6a21\u5757\u8c03\u8bd5\u3002</p> <p>\u5bf9\u4e8e\u5e38\u7528\u529f\u80fd\uff0c\u53ef\u62bd\u51fa\u6765\u4f5c\u4e3a\u57fa\u7840\u6a21\u5757\u3002</p>"},{"location":"android/architect/android-proj-module-use/#_1","title":"\u91cd\u6784\u5de5\u7a0b\uff0c\u6a21\u5757\u5316\u601d\u8def\u548c\u6b65\u9aa4","text":"<ul> <li>\u65b0\u5efa\u6a21\u5757</li> <li>\u79fb\u52a8\u679a\u4e3e\u7c7b\u548c\u63a5\u53e3</li> <li>\u79fb\u52a8\u5de5\u5177\u7c7b</li> <li>\u51cf\u5c11\u5168\u5c40\u53d8\u91cf\uff0c\u5c3d\u53ef\u80fd\u6d88\u9664\u5bf9Application\u7684\u76f4\u63a5\u5f15\u7528</li> <li>\u79fb\u52a8\u6267\u884c\u6700\u5c0f\u64cd\u4f5c\u7684\u7c7b</li> <li>\u589e\u52a0\u56de\u8c03\u63a5\u53e3\uff0c\u589e\u52a0\u901a\u77e5\u65b9\u6cd5\uff0c\u79fb\u52a8\u5176\u4ed6\u7c7b</li> <li>\u8bbe\u8ba1\u5bf9\u5916\u7edf\u4e00\u8bbf\u95ee\u7ba1\u7406\u7684\u7c7b</li> </ul>"},{"location":"android/architect/android-proj-module-use/#android","title":"Android \u84dd\u7259\u7ba1\u7406\u6a21\u5757","text":"<p>Android\u4e2d\u9700\u8981\u8c03\u7528\u84dd\u7259\u8bbe\u5907\u3002</p> <p>\u4e00\u5f00\u59cb\u662f\u5728Service\u4e2d\u7ba1\u7406\u84dd\u7259\u8bbe\u5907\u7684\u8fde\u63a5\u548c\u4e1a\u52a1\u3002\u968f\u7740\u4e1a\u52a1\u4ee3\u7801\u7684\u589e\u957f\uff0c\u84dd\u7259\u7684\u8fde\u63a5\u90e8\u5206\u65e5\u8d8b\u590d\u6742\u548c\u6df7\u4e71\u3002 \u6574\u4e2aService\u7684\u4ee3\u7801\u5728\u53d8\u5927\u3002\u4e1a\u52a1\u8981\u6c42\u9488\u5bf9\u540c\u4e00\u6b3e\u84dd\u7259\u786c\u4ef6\u8bbe\u5907\u5f00\u53d1\u51fa\u4e0d\u540c\u7684App\u3002\u5404\u4e2aApp\u8981\u5b9e\u73b0\u7684\u529f\u80fd\u4e0d\u540c\u3002 \u4e3a\u907f\u514d\u5927\u91cf\u7684\u91cd\u590d\u4ee3\u7801\uff0c\u9700\u8981\u5c06\u8fd9\u4e2a\u84dd\u7259\u8bbe\u5907\u7ba1\u7406\u6a21\u5757\u5316\u3002</p> <p>\u5355\u4f8b\u5316\u4e00\u4e2a<code>BtDevice</code>\uff0c\u76f8\u5173\u4fe1\u606f\u90fd\u5b58\u50a8\u5728\u5355\u4f8b\u4e2d\uff0c\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u3002\u53c2\u7167Google\u793a\u4f8b\uff0c\u5728\u5b50\u7ebf\u7a0b\u4e2d\u8fdb\u884c\u84dd\u7259\u8fde\u63a5\u3002 <code>BtDevice</code>\u6a21\u5757\u4e0eService\u89e3\u8026\u3002\u6dfb\u52a0\u56de\u8c03\u63a5\u53e3\uff0c\u53d1\u9001\u84dd\u7259\u8bbe\u5907\u53d1\u56de\u7684\u6570\u636e\u3002 App\u4e2d\u6709\u591a\u4e2aactivity\uff0c\u5404\u4e2a\u9875\u9762\u751f\u547d\u5468\u671f\u4e0d\u540c\u3002app\u4e3b\u5de5\u7a0b\u4e2d\u589e\u8bbe\u4e00\u4e2a\u6d88\u606f\u7ba1\u7406Service\uff0c\u4e13\u95e8\u7528\u4e8e\u63a5\u53d7BtService\u7684\u6570\u636e\uff0c \u7136\u540e\u518d\u7528\u522b\u7684\u65b9\u6cd5\u53d1\u9001\u51fa\u53bb\uff08EventBus\uff0cBroadcast\u7b49\uff09\u3002</p> <p>\u5728Android Studio\u4e2d\u65b0\u5efa\u4e00\u4e2amodule\uff0c\u628a\u84dd\u7259\u7ba1\u7406\u76f8\u5173\u7684\u4ee3\u7801\u653e\u8fdb\u6a21\u5757\uff0c\u8c03\u6574\u597dAPI\u3002\u7f16\u8bd1\u540e\u4f1a\u6709aar\u6587\u4ef6\u3002 \u65b0\u7684\u5de5\u7a0b\u53ea\u9700\u8981\u5f15\u5165aar\u6587\u4ef6\u5373\u53ef\u3002</p> <p>\u6a21\u5757\u5316\u540e\uff0c\u4ee3\u7801\u5c42\u7ea7\u548c\u903b\u8f91\u66f4\u6e05\u6670\uff0c\u8026\u5408\u5ea6\u4e0b\u964d\uff0c\u66f4\u6613\u7ef4\u62a4\u3002</p>"},{"location":"android/architect/android-proj-module-use/#git-submodule","title":"\u4f7f\u7528git submodule\u7ba1\u7406\u6a21\u5757","text":"<p>git\u5b50\u6a21\u5757\u529f\u80fd\u5141\u8bb8\u5f80git\u7ba1\u7406\u7684\u9879\u76ee\u4e2d\u6dfb\u52a0\u53e6\u4e00\u4e2a\u7531git\u7ba1\u7406\u7684\u5de5\u7a0b\u3002</p> <p>\u4f7f\u7528Android Studio\u521b\u5efaAndroid App\u5de5\u7a0b\u5e76\u7531git\u8fdb\u884c\u7ba1\u7406\u3002\u5de5\u7a0b\u91cc\u53ef\u4ee5\u7528git submodule\u6dfb\u52a0\u5b50\u6a21\u5757\u3002</p> <p>\u53ef\u4ee5\u5728as\u4e2d\u65b0\u5efa\u6a21\u5757\uff0c\u7136\u540e\u628a\u6574\u4e2a\u6a21\u5757\u590d\u5236\u51fa\u53bb\uff0c\u6a21\u5757\u76ee\u5f55\u4e0bgit init\uff0c\u63d0\u4ea4\u5230\u670d\u52a1\u5668\u3002 \u56de\u5230\u5de5\u7a0b\u4e2d\uff0c<code>git submodule add \u6a21\u5757\u5730\u5740</code>\u3002\u6dfb\u52a0\u540e\u4fee\u6539gradle\u5373\u53ef\u3002</p>"},{"location":"android/architect/android-proj-module-use/#_2","title":"\u95ee\u9898\u4e0e\u65b9\u6cd5","text":""},{"location":"android/architect/android-proj-module-use/#xmlmoduleview","title":"xml\u4e2d\u627e\u4e0d\u5230module\u4e2d\u7684\u81ea\u5b9a\u4e49view","text":"<ul> <li>Android Studio 2.2.3 </li> </ul> <p>\u6a21\u5757\u7684build\u548c\u8c03\u7528\u65b9\u7684build\u7684\u914d\u7f6e\u8981\u4e00\u81f4\uff0c\u6700\u597d\u5168\u90e8\u914d\u7f6e\u6210\u4e00\u6837\u7684\u3002</p> <p>\u6bd4\u5982compileSdkVersion\u7b49\u7b49\u3002\u7136\u540e\u91cd\u65b0make module\u548crebuild project</p>"},{"location":"android/architect/android-proj-module-use/#android-studiomoduleaar","title":"\u4f7f\u7528Android Studio\u6253\u5305module\u5f97\u5230aar\u6587\u4ef6","text":"<p>Android App\u7684\u6a21\u5757\u53ef\u4ee5\u7528aar\u6587\u4ef6\u6765\u8868\u793a\u3002</p> <p>\u5728as\u7684Gradle\u4fa7\u8fb9\u680f\u76f4\u63a5\u8fd0\u884c<code>:mylib</code>-<code>Tasks</code>-<code>build</code>-<code>assembleRelease</code></p> <p>\u53ef\u4ee5\u5728module\u76ee\u5f55\u4e0b<code>project\\mylib\\build\\outputs\\aar</code>\u627e\u5230release\u7248\u7684aar\u6587\u4ef6</p> <p>\u53ef\u4ee5\u5728\u6a21\u5757\u7684Gradle\u4e2d\u52a0\u5165\u91cd\u547d\u540d\u7684\u4efb\u52a1 <pre><code>android {\n    //...\n    libraryVariants.all { variant -&gt;\n        variant.outputs.each { output -&gt;\n            def outputFile = output.outputFile\n            if (outputFile != null &amp;&amp; outputFile.name.endsWith('.aar')) {\n                def fileName = \"${archivesBaseName}-${defaultConfig.versionName}-${variant.buildType.name}.aar\"\n                output.outputFile = new File(outputFile.parent, fileName)\n            }\n        }\n    }\n}\n</code></pre></p> <p>gradle 3\u4ee5\u540e\uff0c\u4e0d\u80fd\u4f7f\u7528<code>outputFile</code>\u5c5e\u6027\uff0c\u62a5\u9519\uff1a <pre><code>Cannot set the value of read-only property 'outputFile' for object of type com.android.build.gradle.internal.api.LibraryVariantOutputImpl\n</code></pre></p> <p>\u4fee\u6539gradle\u65b9\u6cd5\uff0c\u6dfb\u52a0\u4e00\u4e2a<code>getTime</code>\u65b9\u6cd5 <pre><code>// \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\nstatic def getTime() {\n    String timeNow = new Date().format('YYYYMMdd-HHmmss')\n    return timeNow\n}\n\nandroid {\n    // ...\n    libraryVariants.all { variant -&gt;\n        variant.outputs.all { output -&gt;\n            def outputFile = output.outputFile\n            if (outputFile != null &amp;&amp; outputFile.name.endsWith('.aar')) {\n                outputFileName = \"${archivesBaseName}-${defaultConfig.versionName}-${variant.buildType.name}_${getTime()}.aar\"\n            }\n        }\n    }\n}\n</code></pre></p> <p>\u6267\u884cassembleRelease\u540e\u5f97\u5230aar\u6587\u4ef6\uff0c<code>mylib-1.0.0.0-release_20180914-091348.aar</code>\u3002</p>"},{"location":"android/architect/android-proj-module-use/#gradle","title":"gradle\u91cd\u590d\u5f15\u7528","text":"<p>\u5b50\u6a21\u5757<code>mylib</code>\u548c\u4e3bapp\u5de5\u7a0b\u4e2d\u5f15\u7528\u4e86\u76f8\u540c\u7684jar\u5305\u3002\u5047\u8bbe\u662f<code>commons-net-3.0.1.jar</code>\u3002 \u7f16\u8bd1\u65f6\u62a5\u9519<code>Multiple dex files define Lxxx/xxx/xxx;</code>\u3002</p> <p>app gradle\u5f15\u7528\u5b50\u6a21\u5757\u65f6\u7533\u660e<code>transitive false</code>\u3002 <pre><code>    implementation (project(':mylib')) {\n        transitive false\n    }\n</code></pre> \u5f0a\u7aef\u662f\uff0c\u5f53app\u4e3b\u5de5\u7a0b\u4e2d\u6ca1\u6709\u5b50\u6a21\u5757\u9700\u8981\u7684\u4f9d\u8d56\u5305\u65f6\uff0c\u5b50\u6a21\u5757\u4f1a\u627e\u4e0d\u5230\u4f9d\u8d56\u9879\u800c\u62a5\u9519\u3002</p> <p>\u6392\u9664\u4e00\u4e9b\u4f20\u9012\u6027\u4f9d\u8d56\u4e2d\u7684\u67d0\u4e2a\u6a21\u5757\uff0c\u6b64\u65f6\u4fbf\u4e0d\u80fd\u9760\u5355\u7eaf\u7684\u5173\u95ed\u4f9d\u8d56\u4f20\u9012\u7279\u6027\u6765\u89e3\u51b3\u4e86\u3002</p>"},{"location":"android/architect/android-proj-module-use/#fileprovider","title":"\u5b50\u6a21\u5757\u4e2d\u7684FileProvider\u95ee\u9898","text":"<ul> <li>gradle 3.1.4</li> <li>compileSdkVersion 27</li> </ul> <p>\u5047\u8bbe\u6709\u5b50\u6a21\u5757<code>mylib</code>\u548c<code>app</code>\u6a21\u5757\u3002</p> <p>\u5b50\u6a21\u5757\u4e2d\u8981\u4f7f\u7528<code>FileProvider</code>\uff0c\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ul> <li>\u65b0\u5efa\u7c7b\u7ee7\u627f<code>android.support.v4.content.FileProvider</code></li> <li>\u7f16\u5199path\u4fe1\u606f</li> <li>\u6a21\u5757<code>AndroidManifest.xml</code>\u4e2d\u58f0\u660eprovider</li> <li>\u5b9a\u4e49\u80fd\u4fee\u6539<code>authorities</code>\u7684\u65b9\u6cd5</li> </ul> <p>\u65b0\u5efa\u7c7b<code>RustFileProvider</code>\uff0c\u4e0d\u590d\u5199\u5176\u4ed6\u65b9\u6cd5\u3002 <pre><code>import android.support.v4.content.FileProvider;\n\npublic class RustFileProvider extends FileProvider {\n\n}\n</code></pre></p> <p>\u6a21\u5757\u4e2d\u65b0\u5efa\u6587\u4ef6<code>res/xml/rust_provider_paths.xml</code> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;paths xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n    &lt;external-path\n        name=\"external_files\"\n        path=\".\" /&gt;\n&lt;/paths&gt;\n</code></pre></p> <p>\u6a21\u5757<code>AndroidManifest.xml</code>\u4e2d\u58f0\u660eprovider <pre><code>    &lt;application&gt;\n\n        &lt;provider\n            android:name=\".RustFileProvider\"\n            android:authorities=\"${applicationId}.file_provider\"\n            android:exported=\"false\"\n            android:grantUriPermissions=\"true\"&gt;\n            &lt;meta-data\n                android:name=\"android.support.FILE_PROVIDER_PATHS\"\n                android:resource=\"@xml/rust_provider_paths\" /&gt;\n        &lt;/provider&gt;\n\n    &lt;/application&gt;\n</code></pre></p> <p>\u5b9a\u4e49\u4e00\u4e2a\u6a21\u5757\u7684\u914d\u7f6e\u6587\u4ef6 <pre><code>/**\n * \u5168\u5c40\u914d\u7f6e\u6587\u4ef6\n */\npublic class DFConfig {\n\n    // \u6587\u4ef6\u63d0\u4f9b\u5668\u540d\u5b57\u524d\u7f00  \u8981\u6839\u636eappID\u800c\u6539\u53d8\n    private static String fileProviderAuthoritiesPrefix = \"applicationId\";\n\n    public static String getFileProviderAuthoritiesPrefix() {\n        return fileProviderAuthoritiesPrefix;\n    }\n\n    /**\n     * @param fileProviderAuthoritiesPrefix \u4f20\u5165app\u7684applicationId\n     */\n    public static void setFileProviderAuthoritiesPrefix(String fileProviderAuthoritiesPrefix) {\n        DFConfig.fileProviderAuthoritiesPrefix = fileProviderAuthoritiesPrefix;\n    }\n}\n</code></pre></p> <p>app\u6a21\u5757\u4ee3\u7801\u4e2d\u8981\u9884\u5148\u5c06\u81ea\u5df1\u7684applicationId\u8bbe\u7f6e\u8fdb\u53bb\u3002 <pre><code>DFConfig.setFileProviderAuthoritiesPrefix(BuildConfig.APPLICATION_ID); // \u8bbe\u7f6efileProvider\u6743\u9650\n</code></pre></p> <p>\u5728\u6a21\u5757\u4e2d\u7684Activity\u8c03\u7528\u5206\u4eab\u529f\u80fd\u3002 <pre><code>    private void shareOneFile(File sFile, String title) {\n        if (null != sFile &amp;&amp; sFile.exists()) {\n            String sPath = sFile.getPath().toLowerCase();\n            Intent shareIntent = new Intent();\n            shareIntent.setAction(Intent.ACTION_SEND);\n            Uri uri = RustFileProvider.getUriForFile(this,\n                    DFConfig.getFileProviderAuthoritiesPrefix() + \".file_provider\", sFile);\n            shareIntent.putExtra(Intent.EXTRA_STREAM, uri);\n            if (sPath.endsWith(\"jpg\") || sPath.endsWith(\"jpeg\")) {\n                shareIntent.setType(\"image/jpeg\");\n            } else if (sPath.endsWith(\"mp4\")) {\n                shareIntent.setType(\"video/*\");\n            } else {\n                shareIntent.setType(\"*/*\");\n            }\n            startActivity(Intent.createChooser(shareIntent, title));\n        }\n    }\n</code></pre></p>"},{"location":"android/as/build-module-ouput-jar/","title":"Android Studio \u6a21\u5757\u7f16\u8bd1\u6253\u5305\u51fajar","text":"\u66f4\u65b0\u65e5\u671f\uff1a 2023-11-23 <ul> <li>2023-11-23 \u5408\u5e76jar\u7684\u65b9\u6cd5</li> <li>2023-10-17 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883 <ul> <li>Android Studio Electric Eel | 2022.1.1 Patch 2</li> </ul>","tags":["Android Studio"]},{"location":"android/as/build-module-ouput-jar/#android-studio-jar_1","title":"Android Studio \u6a21\u5757\u6253\u5305\u51fajar","text":"<p>\u9664\u4e86\u6253\u5305\u6210aar\uff0cAndroid Studio\u4e5f\u53ef\u4ee5\u6253\u5305\u51fajar\u3002</p> <p>\u9700\u8981\u6211\u4eec\u5728gradle\u4e2d\u65b0\u589e\u4e00\u4e2a\u6253jar\u5305\u4efb\u52a1\uff08task\uff09</p> <p>\u4ee5\u4e0b\u662f\u6a21\u5757\u5b8c\u6574\u7684gradle <pre><code>plugins {\n    id 'com.android.library'\n}\n\nandroid {\n    namespace 'com.rustfisher.rustfisherlib'\n    compileSdk 33\n\n    defaultConfig {\n        minSdk 19\n        targetSdk 33\n\n        testInstrumentationRunner 'androidx.test.runner.AndroidJUnitRunner'\n        consumerProguardFiles \"consumer-rules.pro\"\n    }\n\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n    lint {\n        baseline = file(\"lint-baseline.xml\")\n    }\n}\n\ndependencies {\n\n    implementation 'androidx.appcompat:appcompat:1.0.0'\n    testImplementation 'junit:junit:4.13.2'\n//    androidTestImplementation 'androidx.test.ext:junit:1.1.1'\n//    androidTestImplementation 'androidx.test.espresso:espresso-core:3.1.0'\n}\n\ntask makeJar(type: Copy) {\n    //\u5220\u9664\u5b58\u5728\u7684\n    delete 'build/libs/rustfisherlib.jar'\n    //\u8bbe\u7f6e\u62f7\u8d1d\u7684\u6587\u4ef6\n    from('build/intermediates/aar_main_jar/release/')\n    //\u6253\u8fdbjar\u5305\u540e\u7684\u6587\u4ef6\u76ee\u5f55\n    into('build/libs/')\n    //\u5c06classes.jar\u653e\u5165build/libs/\u76ee\u5f55\u4e0b\n    //include ,exclude\u53c2\u6570\u6765\u8bbe\u7f6e\u8fc7\u6ee4\n    include('classes.jar')\n    //\u91cd\u547d\u540d\n    rename ('classes.jar', 'rustfisherlib.jar')\n}\n\nmakeJar.dependsOn(build)\n</code></pre></p> <p>gradle\u76f8\u5173\u65b9\u6cd5\u8bf4\u660e</p> <p>1\u3001Task \u7c7b\u578b\uff1a(type: Copy) \u8868\u793a\u7ee7\u627f Copy \u8fd9\u4e2a\u7c7b</p> <p>2\u3001from \u548c into \u662f\u590d\u5236\u6587\u4ef6\u4f7f\u7528\u7684\u65b9\u6cd5</p> <p>\u6267\u884c\u8fd9\u4e2agradle\u4efb\u52a1\u5373\u53ef\u770b\u5230\u6548\u679c\u3002</p>","tags":["Android Studio"]},{"location":"android/as/build-module-ouput-jar/#gradle","title":"\u6267\u884cgradle\u4efb\u52a1","text":"<p>\u53ef\u4ee5\u5728Android Studio\u53f3\u8fb9\u7684Gradle\u680f\u76ee\u91cc\u627e\u5230makeJar\u8fd9\u4e2a\u4efb\u52a1\u3002</p> <p>\u4e00\u822c\u5728 libName -&gt; Tasks -&gt; other -&gt; makeJar</p> <p>\u6267\u884c\u8fc7\u4e00\u6b21\u540e\uff0c\u5728\u9876\u90e8\u4efb\u52a1\u680f\u4e2d\u80fd\u627e\u5230\u8fd9\u4e2a\u4efb\u52a1</p>","tags":["Android Studio"]},{"location":"android/as/build-module-ouput-jar/#jar","title":"\u5408\u5e76jar\u5305","text":"<p>\u518dmakeJar\u57fa\u7840\u4e0a\uff0c\u518d\u6dfb\u52a0\u4e00\u4e2a\u4efb\u52a1\u3002\u628a\u6a21\u5757\u91cc\u7684\u7b2c\u4e09\u65b9jar\u5305\u5408\u5e76\u8fdb\u53bb\u3002 <pre><code>task makeJar(type: Copy) {\n    //\u5220\u9664\u5b58\u5728\u7684\n    delete 'build/libs/output1-sdk.jar'\n    //\u8bbe\u7f6e\u62f7\u8d1d\u7684\u6587\u4ef6\n    from('build/intermediates/aar_main_jar/release/')\n    //\u6253\u8fdbjar\u5305\u540e\u7684\u6587\u4ef6\u76ee\u5f55\n    into('build/libs/')\n    //include ,exclude\u53c2\u6570\u6765\u8bbe\u7f6e\u8fc7\u6ee4\n    include('classes.jar')\n    //\u91cd\u547d\u540d\n    rename ('classes.jar', 'output1-sdk.jar')\n}\n\nmakeJar.dependsOn(build)\n\ntask mergeJar(type: Jar, dependsOn: ['compileReleaseJavaWithJavac']) { //  task buildJar(type: Jar, dependsOn: ['build'])\n    delete 'build/libs/all-in1-sdk.jar'\n    //\u5bfc\u51fa\u7684jar\u6587\u4ef6\u7684\u540d\u79f0\n    archiveName = \"all-in1-sdk.jar\"\n    //\u9700\u6253\u5305\u7684\u8d44\u6e90\u6240\u5728\u7684\u8def\u5f84\u96c6\n//    from('build/intermediates/aar_main_jar/release/')\n\n    from (project.zipTree('build/libs/output1-sdk.jar')) //\n    from (project.zipTree('libs/other1-sdk.jar')) //\u7b2c\u4e09\u65b9jar\u5305\n    from (project.zipTree('libs/other2-sdk.jar')) //\u7b2c\u4e09\u65b9jar\u5305\n    destinationDir = file('build/libs')  // //\u5bfc\u51fa\u7684jar\u6587\u4ef6\u7684\u5b58\u653e\u76ee\u5f55\uff08\u672a\u6307\u5b9a\u5219\u9ed8\u8ba4\u5b58\u653e\u5728build/libs\u4e0b\uff09\n\n}\nmergeJar.dependsOn(makeJar, build)\n</code></pre></p> <p>\u4e0a\u9762\u7528\u4e86\u8fc7\u65f6\u7684\u5c5e\u6027 destinationDir archiveName</p>","tags":["Android Studio"]},{"location":"android/as/build-module-ouput-jar/#_1","title":"\u53c2\u8003","text":"<ul> <li>Gradle \u7cfb\u5217 \uff08\u4e8c\uff09\u3001Gradle \u6280\u672f\u63a2\u7d22 - \u6398\u91d1</li> </ul>","tags":["Android Studio"]},{"location":"android/as/suppress-warnings-use/","title":"SuppressWarnings","text":""},{"location":"android/as/suppress-warnings-use/#suppresswarnings","title":"\u4f7f\u7528<code>SuppressWarnings</code>","text":"<p>\u5728AS\u4e2d\u53d6\u6d88\u8b66\u544a\u3002\u5e38\u89c1\u7684\u6709</p> <pre><code>@SuppressWarnings(\"all\")\n@SuppressWarnings(\"unchecked\")\n@SuppressWarnings({\"JavaDoc\"})\n@SuppressWarnings({\"UnusedDeclaration\"})\n@SuppressWarnings({\"UnusedParameters\"})\n@SuppressWarnings({\"FieldCanBeLocal\"})\n@SuppressWarnings(\"StringEquality\")\n</code></pre> <p>\u53c2\u8003\uff1a http://kurrytran.blogspot.com/2014/05/android-studio-list-of-suppress-warning.html</p> <p>Android\u4e2d\u548cEventBus\u7ed3\u5408\u8d77\u6765\u7528</p> <pre><code>// \u7528\u4e8e\u6ce8\u89e3\npublic static final String TAG_UNUSED_DECLARE = \"UnusedDeclaration\"; // declare\n\n/**\n * @param event \u6570\u636e\n */\n@SuppressWarnings({TAG_UNUSED_DECLARE})\n@Subscribe(threadMode = ThreadMode.MAIN)\npublic void onXXXEvent(XXXEvent event) {\n    // ......\n}\n</code></pre>"},{"location":"android/as/update-plugin-from-disk/","title":"\u4ece\u786c\u76d8\u5b89\u88c5\u63d2\u4ef6","text":"<p>\u6709\u65f6\u5019\u7528as\u7684\u5b89\u88c5\u63d2\u4ef6\u529f\u80fd\u592a\u6162\u4e86\u3002\u4ece\u786c\u76d8\u91cc\u5b89\u88c5\uff08\u5347\u7ea7\uff09\u63d2\u4ef6\u3002</p> <p>\u5148\u770b\u4e00\u4e0bAndroid Studio\u7684\u7248\u672c\u53f7\uff0c\u73b0\u5728\u662f 201.8743.* \u7248\u672c </p> <p>\u5230\u8fd9\u91cc\u6765\u4e0b\u8f7d\u4e00\u4e2a\u63d2\u4ef6 https://plugins.jetbrains.com/plugin/6954-kotlin/versions/stable</p> <p>\u6839\u636e\u5f53\u524das\u7684\u7248\u672c\uff0c\u9009\u4e00\u4e2a\u63d2\u4ef6\u7248\u672c </p> <p>\u4e0b\u8f7d\u5f97\u5230\u4e00\u4e2azip</p> <p>\u9009\u62e9\u4ece\u786c\u76d8\u91cc\u5b89\u88c5\u63d2\u4ef6\uff0c\u9009\u4e0b\u8f7d\u597d\u7684zip </p> <p>\u5b89\u88c5\u5b8c\u540e\u91cd\u542fas\uff0c\u7136\u540e\u518d\u68c0\u67e5\u66f4\u65b0\u63d2\u4ef6\u770b\u770b</p> <p></p>"},{"location":"android/as/use-as/","title":"\u4f7f\u7528Android Studio","text":"<p>ubuntu14.04</p> <p>\u7528\u547d\u4ee4\u884c\u6253\u5f00Android Studio</p> <p>\u7f16\u8bd1\u9700\u8981jdk7\uff0c\u7f51\u4e0a\u4e0b\u8f7d\u4e00\u4e2a\uff0c\u89e3\u538b\u3002\u6253\u5f00Android Studio\uff0c\u8bbe\u7f6e\u90a3\u91cc\u627e\u5230jdk7\u7684\u6587\u4ef6\u5939\u5373\u53ef</p> <p>\u6b64\u65f6java -version \u8fd8\u662fopen jdk7   \u4e0d\u5f71\u54cd</p>"},{"location":"android/as/use-as/#android-studio_1","title":"android studio\u5f88\u5361\u89e3\u51b3\u65b9\u6cd5","text":"<p>\u6bcf\u6b21\u5347\u7ea7/\u5b89\u88c5 Android Studio \u4e4b\u540e\u6700\u597d\u90fd\u4fee\u6539\u4e00\u4e0b\u8fd9\u4e2a\u53c2\u6570\uff1a\u5230 Android Studio \u5b89\u88c5\u76ee\u5f55\uff0c\u627e\u5230 bin/studio.vmoptions\uff08\u6587\u4ef6\u540d\u53ef\u80fd\u56e0\u64cd\u4f5c\u7cfb\u7edf\u800c\u4e0d\u540c\uff0c\u4f46\u5927\u540c\u5c0f\u5f02\uff09\uff0c\u7136\u540e\u628a -xmx \u540e\u9762\u7684\u6570\u5b57\u6539\u5927\u4e00\u70b9\uff0c\u6bd4\u5982 2048m \u62164096m\u3002</p> <p>-xmx \u53c2\u6570\u662f Java \u865a\u62df\u673a\u542f\u52a8\u65f6\u7684\u53c2\u6570\uff0c\u7528\u4e8e\u9650\u5236\u6700\u5927\u5806\u5185\u5b58\u3002Android Studio \u542f\u52a8\u65f6\u8bbe\u7f6e\u4e86\u8fd9\u4e2a\u53c2\u6570\uff0c\u5e76\u4e14\u9ed8\u8ba4\u503c\u5f88\u5c0f\uff0c\u6ca1\u8bb0\u9519\u7684\u8bdd\uff0c\u53ea\u6709 768mb\u3002 \u4e00\u65e6\u4f60\u7684\u5de5\u7a0b\u53d8\u5927\uff0cIDE \u8fd0\u884c\u65f6\u95f4\u7a0d\u957f\uff0c\u5185\u5b58\u5c31\u5f00\u59cb\u5403\u7d27\uff0c\u9891\u7e41\u89e6\u53d1 GC\uff0c\u81ea\u7136\u4f1a\u5361\u3002</p> <p>\u4fee\u6539\u4e00\u4e0bbin/studio.vmoptions\u6587\u4ef6 <pre><code>-server\n-Xms512m\n-Xmx2048m\n-XX:MaxPermSize=2048m\n-XX:ReservedCodeCacheSize=1024m\n</code></pre> \u542f\u52a8\u901f\u5ea6\u5feb\u5f88\u591a</p>"},{"location":"android/as/use-as/#_1","title":"\u5feb\u6377\u952e","text":"<p>\u53ef\u4ee5\u81ea\u5df1\u6539\u53d8\u98ce\u683c\uff0c\u5728File-Settings-Keymap\u91cc\u9762\u6709\u4e2a\u4e0b\u62c9\u6846\u9009\u9879</p> <p>\u60f3\u8981\u6b63\u786e\u7684\u63d0\u793a\uff0c\u5fc5\u987b\u533a\u5206\u5927\u5c0f\u5199</p> <p>CodeCompletion \uff08\u4ee3\u7801\u5b8c\u6210\uff09\u5c5e\u6027\u53ef\u4ee5\u5feb\u901f\u5730\u5728\u4ee3\u7801\u4e2d\u5b8c\u6210\u5404\u79cd\u4e0d\u540c\u5730\u8bed\u53e5 \u65b9\u6cd5\u662f\u5148\u952e\u5165\u4e00\u4e2a\u7c7b\u540d\u5730\u524d\u51e0\u4e2a\u5b57\u6bcd\u7136\u540e\u518d\u7528 Ctrl+win+Space \u5b8c\u6210\u5168\u79f0\u3002\u5982\u679c\u6709\u591a\u4e2a\u9009\u9879\uff0c\u5b83\u4eec\u4f1a\u5217\u5728\u901f\u67e5\u5217\u8868\u91cc\u3002</p> <p>\u4ee3\u7801\u81ea\u52a8\u5bf9\u9f50 <code>Ctrl + win + Alt + L</code></p> <p>\u6298\u53e0/\u5c55\u5f00\u4ee3\u7801\u5757\uff08Collapse Expand Code Block\uff09 <code>Cmd + Ctrl + \u201c+\u201d/\u201c-\u201d(Ubuntu)</code></p> <p>\u9690\u85cf\u6240\u6709\u9762\u677f <code>Ctrl + Shift + F12</code></p> <p>\u754c\u9762\u8df3\u8f6c\uff1b\u53ef\u4ee5\u8df3\u8f6c\u5230\u4ee3\u7801\uff0c\u6216\u8005\u5176\u4ed6\u9762\u677f <code>Ctrl + Tab</code></p> <p>\u5217\u9009\u62e9/\u5757\u9009\u62e9\uff08Column Selection\uff09 \u63cf\u8ff0\uff1a\u6b63\u5e38\u9009\u62e9\u65f6\uff0c\u5f53\u4f60\u5411\u4e0b\u9009\u62e9\u65f6\uff0c\u4f1a\u76f4\u63a5\u5c06\u5f53\u524d\u884c\u5230\u884c\u5c3e\u90fd\u9009\u4e2d\uff0c\u800c\u5757\u9009\u62e9\u6a21\u5f0f\u4e0b\uff0c\u5219\u662f\u6839\u636e\u9f20\u6807\u9009\u4e2d\u7684\u77e9\u5f62\u533a\u57df\u6765\u9009\u62e9\u3002 \u8c03\u7528\uff1a\u6309\u4f4fAlt\uff0c\u7136\u540e\u62d6\u52a8\u9f20\u6807\u9009\u62e9\u3002 \u5f00\u542f/\u5173\u95ed\u5757\u9009\u62e9\uff1aMenu \u2192 Edit \u2192 Column Selection Mode \u5feb\u6377\u952e\uff1a\u5207\u6362\u5757\u9009\u62e9\u6a21\u5f0f\uff1a<code>Cmd + Shift + 8(OS X)</code>\u3001<code>Shift + Alt + Insert\ufeff(Windows/Linux)</code></p> <p>\u63d0\u53d6\u65b9\u6cd5\uff08Extract Method\uff09 \u63cf\u8ff0\uff1a\u63d0\u53d6\u4e00\u6bb5\u4ee3\u7801\u5757\uff0c\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u65b9\u6cd5\u3002\u5f53\u4f60\u53d1\u73b0\u67d0\u4e2a\u65b9\u6cd5\u91cc\u9762\u8fc7\u4e8e\u590d\u6742\uff0c\u9700\u8981\u5c06\u67d0\u4e00\u6bb5\u4ee3\u7801\u63d0\u53d6\u6210\u5355\u72ec\u7684\u65b9\u6cd5\u65f6\uff0c\u8be5\u6280\u5de7\u662f\u5f88\u6709\u7528\u7684\u3002 \u8c03\u7528\uff1aMenu \u2192 Refactor \u2192 Extract \u2192 Method \u5feb\u6377\u952e\uff1a<code>Shift + Alt + M(Windows/Linux)</code> \u66f4\u591a\uff1a\u5728\u63d0\u53d6\u4ee3\u7801\u7684\u5bf9\u8bdd\u6846\uff0c\u4f60\u53ef\u4ee5\u66f4\u6539\u65b9\u6cd5\u7684\u4fee\u9970\u7b26\u548c\u53c2\u6570\u7684\u53d8\u91cf\u540d\u3002</p> <p>\u79fb\u52a8\u65b9\u6cd5\uff08Move Methods\uff09 \u63cf\u8ff0\uff1a\u8fd9\u4e2a\u64cd\u4f5c\u548c\u79fb\u52a8\u884c\u64cd\u4f5c\u5f88\u7c7b\u4f3c\uff0c\u4e0d\u8fc7\u8be5\u64cd\u4f5c\u662f\u5e94\u7528\u4e8e\u6574\u4e2a\u65b9\u6cd5\u7684\uff0c\u5728\u4e0d\u9700\u8981\u590d\u5236\u3001\u7c98\u8d34\u7684\u60c5\u51b5\u4e0b\uff0c \u5c31\u53ef\u4ee5\u5c06\u6574\u4e2a\u65b9\u6cd5\u5757\u79fb\u52a8\u5230\u53e6\u4e00\u4e2a\u65b9\u6cd5\u7684\u524d\u9762\u6216\u540e\u9762\u3002\u8be5\u64cd\u4f5c\u7684\u5b9e\u9645\u53eb\u505a\u201c\u79fb\u52a8\u8bed\u53e5\u201d\uff0c\u8fd9\u610f\u5473\u7740\u4f60\u53ef\u4ee5\u79fb\u52a8\u4efb\u4f55\u7c7b\u578b \u7684\u8bed\u53e5\uff0c\u4f60\u53ef\u4ee5\u65b9\u4fbf\u5730\u8c03\u6574\u5b57\u6bb5\u6216\u5185\u90e8\u7c7b\u7684\u987a\u5e8f\u3002 \u5feb\u6377\u952e\uff1a<code>Cmd + Alt + Up/Down</code></p> <p>\u91cd\u547d\u540d <code>Alt + Shift + R</code></p>"},{"location":"android/as/use-as/#proxy","title":"\u8bbe\u7f6e\u4ee3\u7406\u670d\u52a1\u5668\uff08Proxy\uff09","text":"<p>\u6709\u65f6\u5019\u9700\u8981\u4ee3\u7406\u6765\u8fde\u63a5\u670d\u52a1\u5668 \u6253\u5f00 <code>Android SDK Manager</code> -&gt; \u5728<code>Default Settings</code>\u91cc\u9009\u62e9<code>HTTP Proxy</code> \u70b9\u9009 <code>Manual proxy configuration</code> -&gt; \u9009\u62e9<code>HTTP</code>\uff1b\u586b\u5199<code>Host name</code> \u548c <code>Port number</code> \u4ee5\u817e\u8baf\u4ee3\u7406\u670d\u52a1\u5668\u4e3a\u4f8b\uff0c\u586b\u5199\u5982\u4e0b\u8bbe\u7f6e\uff1a <pre><code>android-mirror.bugly.qq.com\n8080\n</code></pre> \u70b9\u51fbOK\u5373\u53ef</p> <p>\u9700\u8981\u6bd4\u5982\u66f4\u65b0sdk\u7684\u65f6\u5019\uff0c\u6253\u5f00\u72ec\u7acb\u7684SDK Manager \u5728\u6700\u4e0a\u65b9\u6709\u6807\u9898\u680f<code>Tools</code> -&gt; <code>Options</code>\uff1b\u586b\u5165\u670d\u52a1\u5668\u5730\u5740\u548c\u7aef\u53e3\uff0c\u75c5\u52fe\u9009<code>Force https://...</code></p> <p>\u5728AboutView\u5de5\u7a0b\u4e2d\uff0c\u8bbe\u7f6e\u5b8c\u4ee3\u7406\u540e\u540e\u5f39\u51fa\u9519\u8bef\uff1aGradle Sync failed while using proxy server \u53d6\u6d88\u4ee3\u7406\uff1a\u5728File-Setting-HTTP Proxy-\u52fe\u9009Auto-detect proxy settings AboutView\u53ef\u6b63\u5e38\u7f16\u8bd1</p>"},{"location":"android/as/use-as/#android-studioso","title":"\u89e3\u51b3Android studio\u4e2d\u627e\u4e0d\u5230so\u6587\u4ef6\u7684\u95ee\u9898","text":"<p>java.lang.UnsatisfiedLinkError</p> <p>\u4e0d\u7f16\u8bd1jni\u4ee3\u7801\uff0c\u76f4\u63a5\u4ecelibs\u91cc\u9762\u590d\u5236so\u5e93 \u6587\u4ef6\u8def\u5f84\uff1a<code>app\\build.gradle</code></p> <pre><code>android {\n    compileSdkVersion 23\n    buildToolsVersion \"23.0.3\"\n    defaultConfig {\n        applicationId \"com.example.rust\"\n        minSdkVersion 21\n        targetSdkVersion 23\n        versionCode 1\n        versionName \"1.0\"\n    }\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n        }\n    }\n    sourceSets {\n        main {\n            jni.srcDirs = []\n            jniLibs.srcDirs = ['libs']// \u8fd9\u662f\u5b9e\u9645\u8def\u5f84\n        }\n    }\n}\n</code></pre>"},{"location":"android/as/use-as/#android-studio21-run-app","title":"Android Studio2.1 Run APP\u65f6\uff0c\u9047\u5230\u9519\u8bef","text":"<p><code>Error: Execution failed for task ':app:clean'. Unable to delete file</code></p> <p>\u5173\u95edAS\uff0ckill\u6389Java\u8fdb\u7a0b\uff0c\u6253\u5f00\u8d44\u6e90\u7ba1\u7406\u5668\u627e\u5230\u76f8\u5e94\u6587\u4ef6\uff0c\u4ecd\u65e7\u65e0\u6cd5\u5220\u9664\u8fd9\u4e2a\u6587\u4ef6\u3002\u4e0b\u8f7d\u5b89\u88c5lockhunter\uff0c\u53d1\u73b0\u662f\u91d1\u5c71\u6740\u6bd2\u8f6f\u4ef6\u5360\u7528\u7740\u3002 \u5173\u95ed\u91d1\u5c71\u6bd2\u9738\u4ecd\u65e7\u65e0\u6cd5\u5220\u9664\u6587\u4ef6\uff0c\u5378\u8f7d\u91d1\u5c71\u6bd2\u9738\u540e\uff0c\u53ef\u4ee5\u5220\u9664\u6587\u4ef6\u3002\u5e76\u80fd\u6b63\u5e38Run APP\u3002</p>"},{"location":"android/as/use-as/#android-studio_2","title":"Android Studio \u81ea\u5e26\u7684\u622a\u5c4f\u548c\u5f55\u5c4f\u5de5\u5177","text":"<p>\u5f55\u5c4f\u540e\u914d\u5408\u8fc5\u96f7\u5f71\u97f3\u7684\u751f\u6210GIF\u529f\u80fd\uff0c\u5c31\u80fd\u5f88\u65b9\u4fbf\u5730\u5f97\u5230GIF\u56fe</p>"},{"location":"android/as/use-as/#android-studio-build-project-info","title":"\u5904\u7406 android studio \u5361\u5728 build project info.. \u7684\u65b9\u6cd5","text":"<p>win7\uff0c Android Studio 2.3 \u5361\u5728\u8fd9\u4e00\u6b65\uff0c\u4e00\u822c\u662f\u4e0b\u8f7dgradle\u592a\u6162\u3002\u90a3\u4e48\u6211\u4eec\u53bb\u4e0b\u8f7dgradle\u7684\u79bb\u7ebf\u5305\u3002\u5148\u5173\u95edAS\u3002 \u6253\u5f00<code>C:\\Users\\Administrator\\.gradle\\wrapper\\dists</code>\uff0c\u53ef\u4ee5\u770b\u5230\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684gradle\u7248\u672c \u5047\u8bbe\u6b63\u5728\u4f7f\u7528<code>gradle-3.3-all</code>\uff0c\u8fdb\u5165\u8fd9\u4e2a\u76ee\u5f55\u53ef\u4ee5\u770b\u5230\u4e00\u4e2a\u6587\u4ef6\u5939\uff0c\u5c06\u4e0b\u8f7d\u597d\u7684<code>gradle-3.3-all.zip</code> \u653e\u8fdb\u53bb\u3002\u542f\u52a8AS\u5373\u53ef\u3002</p>"},{"location":"android/as/use-as/#gradle","title":"gradle\u672c\u5730\u7f13\u5b58\u7684\u914d\u7f6e","text":"<p>win7\u4e2d\uff0cgradle\u9ed8\u8ba4\u7f13\u5b58\u5728C\u76d8\u5f53\u524d\u7528\u6237\u7684\u76ee\u5f55\u4e2d\uff0c\u4f8b\u5982<code>C:\\Users\\Administrator\\.gradle</code> \u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u7cfb\u7edf\u53d8\u91cf\uff0c\u6765\u6539\u53d8\u7f13\u5b58\u4f4d\u7f6e \u5982\u679c\u5f53\u524d.gradle\u6587\u4ef6\u5939\u5df2\u7ecf\u5728C\u76d8\uff0c\u53ef\u4ee5\u5c06\u5b83\u590d\u5236\u5230\u76ee\u6807\u8def\u5f84\uff0c\u4f8b\u5982<code>G:\\gradleRepo\\.gradle</code> \u5728\u7cfb\u7edf\u53d8\u91cf\u4e2d\u589e\u52a0<code>GRADLE_USER_HOME</code>=<code>G:\\gradleRepo\\.gradle</code></p> <p>\u7a33\u59a5\u8d77\u89c1\u91cd\u542f\u8ba1\u7b97\u673a\u5373\u53ef</p>"},{"location":"android/as/use-as/#sampledata","title":"\u4f7f\u7528<code>sampledata</code>\u529f\u80fd","text":"<p>Android Studio 3\uff0c\u5bf9\u7740app\u9879\u76ee\u53f3\u952e\uff0c<code>New</code> -&gt; <code>Sample Data Directory</code> \u5f97\u5230<code>app/sampledata</code>\u76ee\u5f55\u3002</p> <p>\u5728<code>app/sampledata</code>\u76ee\u5f55\u4e0b\u521b\u5efa<code>wifi_infos.json</code>\u6587\u4ef6\u3002 <pre><code>{\n    \"scan_results\": [{\n        \"ssid\": \"WiFi-1\",\n        \"note\": \"This the 1st wifi\"\n        }\n    ]\n}\n</code></pre> build\u4e00\u4e0b\u5de5\u7a0b\u3002</p> <p>\u4fee\u6539\u5217\u8868\u7684\u5b50\u9879layout <code>w_item_wifi.xml</code>\uff0c\u6dfb\u52a0<code>tools:text</code>\u4fe1\u606f\u3002 <pre><code>&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"42dp\"\n    android:gravity=\"center_vertical\"\n    android:orientation=\"horizontal\"&gt;\n\n    &lt;TextView\n        android:id=\"@+id/ssid_tv\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:textSize=\"12sp\"\n        tools:text=\"@sample/wifi_infos.json/scan_results/ssid\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/note_tv\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:textSize=\"12sp\"\n        tools:text=\"@sample/wifi_infos.json/scan_results/note\" /&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre></p> <p>RecyclerView\u4e2d\u6dfb\u52a0<code>tools:listitem</code> <pre><code>    &lt;android.support.v7.widget.RecyclerView\n        android:id=\"@+id/wifi_rv\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_above=\"@id/bottom_layout\"\n        android:layout_below=\"@id/prefix_setting_layout\"\n        tools:listitem=\"@layout/w_item_wifi\" /&gt;\n</code></pre></p> <p>\u53ef\u4ee5\u5728as\u7684\u9884\u89c8\u7a97\u91cc\u770b\u5230\u6548\u679c\u3002</p>"},{"location":"android/as/use-as/#_2","title":"\u4f7f\u7528\u4ee3\u7801\u6a21\u677f","text":"<p>Android Studio\u4e2d\u6709\u4e00\u4e9b\u9884\u7f6e\u7684\u4ee3\u7801\u8f93\u5165\u5feb\u6377\u65b9\u5f0f\u3002 \u6bd4\u5982\u8f93\u5165logd\uff0c\u53ef\u4ee5\u9009\u62e9\u63d2\u5165 Log.d(TAG, );</p> <p>\u5bf9\u4e8eWindows\u7684AS\uff0c\u8bbe\u7f6e\u4f4d\u7f6e\u5728 File - Settings - Editor - Live Templates</p> <p>\u6bd4\u5982\u6dfb\u52a0\u4e00\u4e2a Live Templates</p> <pre><code>Abbreviation: lld, Descripton: LL.d(TAG, String)\n\nTemplate text:\nLL.d(TAG, \"$METHOD_NAME$: $content$\");\n</code></pre> <p>\u5199\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u8f93\u5165lld\u5c31\u53ef\u4ee5\u9009\u62e9\u81ea\u52a8\u586b\u5145 <code>LL.d(TAG, \"\");</code> \u4e86</p>"},{"location":"android/binder/Binder_mechanism_intro/","title":"Android Binder \u673a\u5236\u4ecb\u7ecd","text":"<p>\u4ecb\u7ecdBinder\u673a\u5236\u7684\u7ec4\u6210\u7ed3\u6784\uff0c\u89e3\u6790Binder\u7684\u8bbe\u8ba1\u3002</p>"},{"location":"android/binder/Binder_mechanism_intro/#ipc-binder","title":"\u9762\u5411\u5bf9\u8c61\u7684IPC - Binder","text":"<p>c/s\u67b6\u6784\uff0c\u5ba2\u6237\u7aef\u8981\u627e\u5f97\u5230\u670d\u52a1\u7aef\u3002 Binder\u4f7f\u7528Client-Server\u901a\u4fe1\u65b9\u5f0f\uff1a\u4e00\u4e2a\u8fdb\u7a0b\u4f5c\u4e3aServer\u63d0\u4f9b\u8bf8\u5982\u89c6\u9891/\u97f3\u9891\u89e3\u7801\uff0c\u89c6\u9891\u6355\u83b7\uff0c\u5730\u5740\u672c\u67e5\u8be2\uff0c\u7f51\u7edc\u8fde\u63a5\u7b49\u670d\u52a1\uff1b\u591a\u4e2a\u8fdb\u7a0b\u4f5c\u4e3aClient\u5411Server\u53d1\u8d77\u670d\u52a1\u8bf7\u6c42\uff0c\u83b7\u5f97\u6240\u9700\u8981\u7684\u670d\u52a1\u3002\u8981\u60f3\u5b9e\u73b0Client-Server\u901a\u4fe1\u636e\u5fc5\u987b\u5b9e\u73b0\u4ee5\u4e0b\u4e24\u70b9\uff1a\u4e00\u662fserver\u5fc5\u987b\u6709\u786e\u5b9a\u7684\u8bbf\u95ee\u63a5\u5165\u70b9\u6216\u8005\u8bf4\u5730\u5740\u6765\u63a5\u53d7Client\u7684\u8bf7\u6c42\uff0c\u5e76\u4e14Client\u53ef\u4ee5\u901a\u8fc7\u67d0\u79cd\u9014\u5f84\u83b7\u77e5Server\u7684\u5730\u5740\uff1b\u4e8c\u662f\u5236\u5b9aCommand-Reply\u534f\u8bae\u6765\u4f20\u8f93\u6570\u636e\u3002\u4f8b\u5982\u5728\u7f51\u7edc\u901a\u4fe1\u4e2dServer\u7684\u8bbf\u95ee\u63a5\u5165\u70b9\u5c31\u662fServer\u4e3b\u673a\u7684IP\u5730\u5740+\u7aef\u53e3\u53f7\uff0c\u4f20\u8f93\u534f\u8bae\u4e3aTCP\u534f\u8bae\u3002\u5bf9Binder\u800c\u8a00\uff0cBinder\u53ef\u4ee5\u770b\u6210Server\u63d0\u4f9b\u7684\u5b9e\u73b0\u67d0\u4e2a\u7279\u5b9a\u670d\u52a1\u7684\u8bbf\u95ee\u63a5\u5165\u70b9\uff0c Client\u901a\u8fc7\u8fd9\u4e2a\u2018\u5730\u5740\u2019\u5411Server\u53d1\u9001\u8bf7\u6c42\u6765\u4f7f\u7528\u8be5\u670d\u52a1\uff1b\u5bf9Client\u800c\u8a00\uff0cBinder\u53ef\u4ee5\u770b\u6210\u662f\u901a\u5411Server\u7684\u7ba1\u9053\u5165\u53e3\uff0c\u8981\u60f3\u548c\u67d0\u4e2aServer\u901a\u4fe1\u9996\u5148\u5fc5\u987b\u5efa\u7acb\u8fd9\u4e2a\u7ba1\u9053\u5e76\u83b7\u5f97\u7ba1\u9053\u5165\u53e3\u3002</p> <p>\u4e0e\u5176\u5b83IPC\u4e0d\u540c\uff0cBinder\u4f7f\u7528\u4e86\u9762\u5411\u5bf9\u8c61\u7684\u601d\u60f3\u6765\u63cf\u8ff0\u4f5c\u4e3a\u8bbf\u95ee\u63a5\u5165\u70b9\u7684Binder\u53ca\u5176\u5728Client\u4e2d\u7684\u5165\u53e3\u3002Binder\u662f\u4e00\u4e2a\u5b9e\u4f53\u4f4d\u4e8eServer\u4e2d\u7684\u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u63d0\u4f9b\u4e86\u4e00\u5957\u65b9\u6cd5\u7528\u4ee5\u5b9e\u73b0\u5bf9\u670d\u52a1\u7684\u8bf7\u6c42\uff0c\u5c31\u8c61\u7c7b\u7684\u6210\u5458\u51fd\u6570\u3002\u904d\u5e03\u4e8eclient\u4e2d\u7684\u5165\u53e3\u53ef\u4ee5\u770b\u6210\u6307\u5411\u8fd9\u4e2abinder\u5bf9\u8c61\u7684\u2018\u6307\u9488\u2019\uff0c\u4e00\u65e6\u83b7\u5f97\u4e86\u8fd9\u4e2a\u2018\u6307\u9488\u2019\u5c31\u53ef\u4ee5\u8c03\u7528\u8be5\u5bf9\u8c61\u7684\u65b9\u6cd5\u8bbf\u95eeserver\u3002\u5728Client\u770b\u6765\uff0c\u901a\u8fc7Binder\u2018\u6307\u9488\u2019\u8c03\u7528\u5176\u63d0\u4f9b\u7684\u65b9\u6cd5\u548c\u901a\u8fc7\u6307\u9488\u8c03\u7528\u5176\u5b83\u4efb\u4f55\u672c\u5730\u5bf9\u8c61\u7684\u65b9\u6cd5\u5e76\u65e0\u533a\u522b\uff0c\u5c3d\u7ba1\u524d\u8005\u7684\u5b9e\u4f53\u4f4d\u4e8e\u8fdc\u7aefServer\u4e2d\uff0c\u800c\u540e\u8005\u5b9e\u4f53\u4f4d\u4e8e\u672c\u5730\u5185\u5b58\u4e2d\u3002\u2018\u6307\u9488\u2019\u662fC++\u7684\u672f\u8bed\uff0c\u800c\u66f4\u901a\u5e38\u7684\u8bf4\u6cd5\u662f\u5f15\u7528\uff0c\u5373Client\u901a\u8fc7Binder\u7684\u5f15\u7528\u8bbf\u95eeServer\u3002\u800c\u8f6f\u4ef6\u9886\u57df\u53e6\u4e00\u4e2a\u672f\u8bed\u2018\u53e5\u67c4\u2019\u4e5f\u53ef\u4ee5\u7528\u6765\u8868\u8ff0Binder\u5728Client\u4e2d\u7684\u5b58\u5728\u65b9\u5f0f\u3002\u4ece\u901a\u4fe1\u7684\u89d2\u5ea6\u770b\uff0cClient\u4e2d\u7684Binder\u4e5f\u53ef\u4ee5\u770b\u4f5c\u662fServer Binder\u7684\u2018\u4ee3\u7406\u2019\uff0c\u5728\u672c\u5730\u4ee3\u8868\u8fdc\u7aefServer\u4e3aClient\u63d0\u4f9b\u670d\u52a1\u3002\u672c\u6587\u4e2d\u4f1a\u4f7f\u7528\u2018\u5f15\u7528\u2019\u6216\u2018\u53e5\u67c4\u2019\u8fd9\u4e2a\u4e24\u5e7f\u6cdb\u4f7f\u7528\u7684\u672f\u8bed\u3002</p> <p>Binder\u5bf9\u8c61\u662f\u4e00\u4e2a\u53ef\u4ee5\u8de8\u8fdb\u7a0b\u5f15\u7528\u7684\u5bf9\u8c61\uff0c\u5b83\u7684\u5b9e\u4f53\u4f4d\u4e8e\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\uff0c\u800c\u5b83\u7684\u5f15\u7528\u5374\u904d\u5e03\u4e8e\u7cfb\u7edf\u7684\u5404\u4e2a\u8fdb\u7a0b\u4e4b\u4e2d\u3002</p> <p>\u9762\u5411\u5bf9\u8c61\u601d\u60f3\u7684\u5f15\u5165\u5c06\u8fdb\u7a0b\u95f4\u901a\u4fe1\u8f6c\u5316\u4e3a\u901a\u8fc7\u5bf9\u67d0\u4e2aBinder\u5bf9\u8c61\u7684\u5f15\u7528\u8c03\u7528\u8be5\u5bf9\u8c61\u7684\u65b9\u6cd5\uff0c\u800c\u5176\u72ec\u7279\u4e4b\u5904\u5728\u4e8eBinder\u5bf9\u8c61\u662f\u4e00\u4e2a\u53ef\u4ee5\u8de8\u8fdb\u7a0b\u5f15\u7528\u7684\u5bf9\u8c61\uff0c\u5b83\u7684\u5b9e\u4f53\u4f4d\u4e8e\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\uff0c\u800c\u5b83\u7684\u5f15\u7528\u5374\u904d\u5e03\u4e8e\u7cfb\u7edf\u7684\u5404\u4e2a\u8fdb\u7a0b\u4e4b\u4e2d\u3002\u6700\u8bf1\u4eba\u7684\u662f\uff0c\u8fd9\u4e2a\u5f15\u7528\u548cjava\u91cc\u5f15\u7528\u4e00\u6837\u65e2\u53ef\u4ee5\u662f\u5f3a\u7c7b\u578b\uff0c\u4e5f\u53ef\u4ee5\u662f\u5f31\u7c7b\u578b\uff0c\u800c\u4e14\u53ef\u4ee5\u4ece\u4e00\u4e2a\u8fdb\u7a0b\u4f20\u7ed9\u5176\u5b83\u8fdb\u7a0b\uff0c\u8ba9\u5927\u5bb6\u90fd\u80fd\u8bbf\u95ee\u540c\u4e00Server\uff0c\u5c31\u8c61\u5c06\u4e00\u4e2a\u5bf9\u8c61\u6216\u5f15\u7528\u8d4b\u503c\u7ed9\u53e6\u4e00\u4e2a\u5f15\u7528\u4e00\u6837\u3002Binder\u6a21\u7cca\u4e86\u8fdb\u7a0b\u8fb9\u754c\uff0c\u6de1\u5316\u4e86\u8fdb\u7a0b\u95f4\u901a\u4fe1\u8fc7\u7a0b\uff0c\u6574\u4e2a\u7cfb\u7edf\u4eff\u4f5b\u8fd0\u884c\u4e8e\u540c\u4e00\u4e2a\u9762\u5411\u5bf9\u8c61\u7684\u7a0b\u5e8f\u4e4b\u4e2d\u3002\u5f62\u5f62\u8272\u8272\u7684Binder\u5bf9\u8c61\u4ee5\u53ca\u661f\u7f57\u68cb\u5e03\u7684\u5f15\u7528\u4eff\u4f5b\u7c98\u63a5\u5404\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u80f6\u6c34\uff0c\u8fd9\u4e5f\u662fBinder\u5728\u82f1\u6587\u91cc\u7684\u539f\u610f\u3002</p> <p>\u5f53\u7136\u9762\u5411\u5bf9\u8c61\u53ea\u662f\u9488\u5bf9\u5e94\u7528\u7a0b\u5e8f\u800c\u8a00\uff0c\u5bf9\u4e8eBinder\u9a71\u52a8\u548c\u5185\u6838\u5176\u5b83\u6a21\u5757\u4e00\u6837\u4f7f\u7528C\u8bed\u8a00\u5b9e\u73b0\uff0c\u6ca1\u6709\u7c7b\u548c\u5bf9\u8c61\u7684\u6982\u5ff5\u3002Binder\u9a71\u52a8\u4e3a\u9762\u5411\u5bf9\u8c61\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u63d0\u4f9b\u5e95\u5c42\u652f\u6301\u3002</p>"},{"location":"android/binder/Binder_mechanism_intro/#binder","title":"Binder \u901a\u4fe1\u6a21\u578b","text":"<p>Binder\u6846\u67b6\u5b9a\u4e49\u4e86\u56db\u4e2a\u89d2\u8272\uff1aServer\uff0cClient\uff0cServiceManager\uff08\u4ee5\u540e\u7b80\u79f0SMgr\uff09\u4ee5\u53caBinder\u9a71\u52a8\u3002\u5176\u4e2dServer\uff0cClient\uff0cSMgr\u8fd0\u884c\u4e8e\u7528\u6237\u7a7a\u95f4\uff0c\u9a71\u52a8\u8fd0\u884c\u4e8e\u5185\u6838\u7a7a\u95f4\u3002\u8fd9\u56db\u4e2a\u89d2\u8272\u7684\u5173\u7cfb\u548c\u4e92\u8054\u7f51\u7c7b\u4f3c\uff1aServer\u662f\u670d\u52a1\u5668\uff0cClient\u662f\u5ba2\u6237\u7ec8\u7aef\uff0cSMgr\u662f\u57df\u540d\u670d\u52a1\u5668\uff08DNS\uff09\uff0c\u9a71\u52a8\u662f\u8def\u7531\u5668\u3002</p>"},{"location":"android/binder/Binder_mechanism_intro/#binder_1","title":"Binder \u9a71\u52a8","text":"<p>\u548c\u8def\u7531\u5668\u4e00\u6837\uff0cBinder\u9a71\u52a8\u867d\u7136\u9ed8\u9ed8\u65e0\u95fb\uff0c\u5374\u662f\u901a\u4fe1\u7684\u6838\u5fc3\u3002\u5c3d\u7ba1\u540d\u53eb\u2018\u9a71\u52a8\u2019\uff0c\u5b9e\u9645\u4e0a\u548c\u786c\u4ef6\u8bbe\u5907\u6ca1\u6709\u4efb\u4f55\u5173\u7cfb\uff0c\u53ea\u662f\u5b9e\u73b0\u65b9\u5f0f\u548c\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u662f\u4e00\u6837\u7684\uff1a\u5b83\u5de5\u4f5c\u4e8e\u5185\u6838\u6001\uff0c\u63d0\u4f9bopen()\uff0cmmap()\uff0cpoll()\uff0cioctl()\u7b49\u6807\u51c6\u6587\u4ef6\u64cd\u4f5c\uff0c\u4ee5\u5b57\u7b26\u9a71\u52a8\u8bbe\u5907\u4e2d\u7684misc\u8bbe\u5907\u6ce8\u518c\u5728\u8bbe\u5907\u76ee\u5f55/dev\u4e0b\uff0c\u7528\u6237\u901a\u8fc7/dev/binder\u8bbf\u95ee\u8be5\u5b83\u3002\u9a71\u52a8\u8d1f\u8d23\u8fdb\u7a0b\u4e4b\u95f4Binder\u901a\u4fe1\u7684\u5efa\u7acb\uff0cBinder\u5728\u8fdb\u7a0b\u4e4b\u95f4\u7684\u4f20\u9012\uff0cBinder\u5f15\u7528\u8ba1\u6570\u7ba1\u7406\uff0c\u6570\u636e\u5305\u5728\u8fdb\u7a0b\u4e4b\u95f4\u7684\u4f20\u9012\u548c\u4ea4\u4e92\u7b49\u4e00\u7cfb\u5217\u5e95\u5c42\u652f\u6301\u3002\u9a71\u52a8\u548c\u5e94\u7528\u7a0b\u5e8f\u4e4b\u95f4\u5b9a\u4e49\u4e86\u4e00\u5957\u63a5\u53e3\u534f\u8bae\uff0c\u4e3b\u8981\u529f\u80fd\u7531ioctl()\u63a5\u53e3\u5b9e\u73b0\uff0c\u4e0d\u63d0\u4f9bread()\uff0cwrite()\u63a5\u53e3\uff0c\u56e0\u4e3aioctl()\u7075\u6d3b\u65b9\u4fbf\uff0c\u4e14\u80fd\u591f\u4e00\u6b21\u8c03\u7528\u5b9e\u73b0\u5148\u5199\u540e\u8bfb\u4ee5\u6ee1\u8db3\u540c\u6b65\u4ea4\u4e92\uff0c\u800c\u4e0d\u5fc5\u5206\u522b\u8c03\u7528write()\u548cread()\u3002Binder\u9a71\u52a8\u7684\u4ee3\u7801\u4f4d\u4e8elinux\u76ee\u5f55\u7684drivers/misc/binder.c\u4e2d\u3002</p>"},{"location":"android/binder/Binder_mechanism_intro/#servicemanager-binder","title":"ServiceManager \u4e0e\u5b9e\u540dBinder","text":"<p>\u548cDNS\u7c7b\u4f3c\uff0cSMgr\u7684\u4f5c\u7528\u662f\u5c06\u5b57\u7b26\u5f62\u5f0f\u7684Binder\u540d\u5b57\u8f6c\u5316\u6210Client\u4e2d\u5bf9\u8be5Binder\u7684\u5f15\u7528\uff0c\u4f7f\u5f97Client\u80fd\u591f\u901a\u8fc7Binder\u540d\u5b57\u83b7\u5f97\u5bf9Server\u4e2dBinder\u5b9e\u4f53\u7684\u5f15\u7528\u3002\u6ce8\u518c\u4e86\u540d\u5b57\u7684Binder\u53eb\u5b9e\u540dBinder\uff0c\u5c31\u8c61\u6bcf\u4e2a\u7f51\u7ad9\u9664\u4e86\u6709IP\u5730\u5740\u5916\u8fd8\u6709\u81ea\u5df1\u7684\u7f51\u5740\u3002Server\u521b\u5efa\u4e86Binder\u5b9e\u4f53\uff0c\u4e3a\u5176\u53d6\u4e00\u4e2a\u5b57\u7b26\u5f62\u5f0f\uff0c\u53ef\u8bfb\u6613\u8bb0\u7684\u540d\u5b57\uff0c\u5c06\u8fd9\u4e2aBinder\u8fde\u540c\u540d\u5b57\u4ee5\u6570\u636e\u5305\u7684\u5f62\u5f0f\u901a\u8fc7Binder\u9a71\u52a8\u53d1\u9001\u7ed9SMgr\uff0c\u901a\u77e5SMgr\u6ce8\u518c\u4e00\u4e2a\u540d\u53eb\u5f20\u4e09\u7684Binder\uff0c\u5b83\u4f4d\u4e8e\u67d0\u4e2aServer\u4e2d\u3002\u9a71\u52a8\u4e3a\u8fd9\u4e2a\u7a7f\u8fc7\u8fdb\u7a0b\u8fb9\u754c\u7684Binder\u521b\u5efa\u4f4d\u4e8e\u5185\u6838\u4e2d\u7684\u5b9e\u4f53\u8282\u70b9\u4ee5\u53caSMgr\u5bf9\u5b9e\u4f53\u7684\u5f15\u7528\uff0c\u5c06\u540d\u5b57\u53ca\u65b0\u5efa\u7684\u5f15\u7528\u6253\u5305\u4f20\u9012\u7ed9SMgr\u3002SMgr\u6536\u6570\u636e\u5305\u540e\uff0c\u4ece\u4e2d\u53d6\u51fa\u540d\u5b57\u548c\u5f15\u7528\u586b\u5165\u4e00\u5f20\u67e5\u627e\u8868\u4e2d\u3002</p>"},{"location":"android/binder/Binder_mechanism_intro/#servicemanager","title":"ServiceManager\u4ec0\u4e48\u65f6\u5019\u6ce8\u518c\u7684","text":"<p>\u7ec6\u5fc3\u7684\u8bfb\u8005\u53ef\u80fd\u4f1a\u53d1\u73b0\u5176\u4e2d\u7684\u8e4a\u8df7\uff1aSMgr\u662f\u4e00\u4e2a\u8fdb\u7a0b\uff0cServer\u662f\u53e6\u4e00\u4e2a\u8fdb\u7a0b\uff0cServer\u5411SMgr\u6ce8\u518cBinder\u5fc5\u7136\u4f1a\u6d89\u53ca\u8fdb\u7a0b\u95f4\u901a\u4fe1\u3002\u5f53\u524d\u5b9e\u73b0\u7684\u662f\u8fdb\u7a0b\u95f4\u901a\u4fe1\u5374\u53c8\u8981\u7528\u5230\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u8fd9\u5c31\u597d\u8c61\u86cb\u53ef\u4ee5\u5b75\u51fa\u9e21\u524d\u63d0\u5374\u662f\u8981\u627e\u53ea\u9e21\u6765\u5b75\u86cb\u3002Binder\u7684\u5b9e\u73b0\u6bd4\u8f83\u5de7\u5999\uff1a\u9884\u5148\u521b\u9020\u4e00\u53ea\u9e21\u6765\u5b75\u86cb\uff1aSMgr\u548c\u5176\u5b83\u8fdb\u7a0b\u540c\u6837\u91c7\u7528Binder\u901a\u4fe1\uff0cSMgr\u662fServer\u7aef\uff0c\u6709\u81ea\u5df1\u7684Binder\u5bf9\u8c61\uff08\u5b9e\u4f53\uff09\uff0c\u5176\u5b83\u8fdb\u7a0b\u90fd\u662fClient\uff0c\u9700\u8981\u901a\u8fc7\u8fd9\u4e2aBinder\u7684\u5f15\u7528\u6765\u5b9e\u73b0Binder\u7684\u6ce8\u518c\uff0c\u67e5\u8be2\u548c\u83b7\u53d6\u3002SMgr\u63d0\u4f9b\u7684Binder\u6bd4\u8f83\u7279\u6b8a\uff0c\u5b83\u6ca1\u6709\u540d\u5b57\u4e5f\u4e0d\u9700\u8981\u6ce8\u518c\uff0c\u5f53\u4e00\u4e2a\u8fdb\u7a0b\u4f7f\u7528BINDER_SET_CONTEXT_MGR\u547d\u4ee4\u5c06\u81ea\u5df1\u6ce8\u518c\u6210SMgr\u65f6Binder\u9a71\u52a8\u4f1a\u81ea\u52a8\u4e3a\u5b83\u521b\u5efaBinder\u5b9e\u4f53\uff08\u8fd9\u5c31\u662f\u90a3\u53ea\u9884\u5148\u9020\u597d\u7684\u9e21\uff09\u3002\u5176\u6b21\u8fd9\u4e2aBinder\u7684\u5f15\u7528\u5728\u6240\u6709Client\u4e2d\u90fd\u56fa\u5b9a\u4e3a0\u800c\u65e0\u987b\u901a\u8fc7\u5176\u5b83\u624b\u6bb5\u83b7\u5f97\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u4e2aServer\u82e5\u8981\u5411SMgr\u6ce8\u518c\u81ea\u5df1Binder\u5c31\u5fc5\u9700\u901a\u8fc70\u8fd9\u4e2a\u5f15\u7528\u53f7\u548cSMgr\u7684Binder\u901a\u4fe1\u3002\u7c7b\u6bd4\u7f51\u7edc\u901a\u4fe1\uff0c0\u53f7\u5f15\u7528\u5c31\u597d\u6bd4\u57df\u540d\u670d\u52a1\u5668\u7684\u5730\u5740\uff0c\u4f60\u5fc5\u987b\u9884\u5148\u624b\u5de5\u6216\u52a8\u6001\u914d\u7f6e\u597d\u3002\u8981\u6ce8\u610f\u8fd9\u91cc\u8bf4\u7684Client\u662f\u76f8\u5bf9SMgr\u800c\u8a00\u7684\uff0c\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u662f\u4e2a\u63d0\u4f9b\u670d\u52a1\u7684Server\uff0c\u4f46\u5bf9SMgr\u6765\u8bf4\u5b83\u4ecd\u7136\u662f\u4e2aClient\u3002</p>"},{"location":"android/binder/Binder_mechanism_intro/#client-binder","title":"Client \u83b7\u5f97\u5b9e\u540dBinder\u7684\u5f15\u7528","text":"<p>Server\u5411SMgr\u6ce8\u518c\u4e86Binder\u5b9e\u4f53\u53ca\u5176\u540d\u5b57\u540e\uff0cClient\u5c31\u53ef\u4ee5\u901a\u8fc7\u540d\u5b57\u83b7\u5f97\u8be5Binder\u7684\u5f15\u7528\u4e86\u3002Client\u4e5f\u5229\u7528\u4fdd\u7559\u76840\u53f7\u5f15\u7528\u5411SMgr\u8bf7\u6c42\u8bbf\u95ee\u67d0\u4e2aBinder\uff1a\u6211\u7533\u8bf7\u83b7\u5f97\u540d\u5b57\u53eb\u5f20\u4e09\u7684Binder\u7684\u5f15\u7528\u3002SMgr\u6536\u5230\u8fd9\u4e2a\u8fde\u63a5\u8bf7\u6c42\uff0c\u4ece\u8bf7\u6c42\u6570\u636e\u5305\u91cc\u83b7\u5f97Binder\u7684\u540d\u5b57\uff0c\u5728\u67e5\u627e\u8868\u91cc\u627e\u5230\u8be5\u540d\u5b57\u5bf9\u5e94\u7684\u6761\u76ee\uff0c\u4ece\u6761\u76ee\u4e2d\u53d6\u51faBinder\u7684\u5f15\u7528\uff0c\u5c06\u8be5\u5f15\u7528\u4f5c\u4e3a\u56de\u590d\u53d1\u9001\u7ed9\u53d1\u8d77\u8bf7\u6c42\u7684Client\u3002\u4ece\u9762\u5411\u5bf9\u8c61\u7684\u89d2\u5ea6\uff0c\u8fd9\u4e2aBinder\u5bf9\u8c61\u73b0\u5728\u6709\u4e86\u4e24\u4e2a\u5f15\u7528\uff1a\u4e00\u4e2a\u4f4d\u4e8eSMgr\u4e2d\uff0c\u4e00\u4e2a\u4f4d\u4e8e\u53d1\u8d77\u8bf7\u6c42\u7684Client\u4e2d\u3002\u5982\u679c\u63a5\u4e0b\u6765\u6709\u66f4\u591a\u7684Client\u8bf7\u6c42\u8be5Binder\uff0c\u7cfb\u7edf\u4e2d\u5c31\u4f1a\u6709\u66f4\u591a\u7684\u5f15\u7528\u6307\u5411\u8be5Binder\uff0c\u5c31\u8c61java\u91cc\u4e00\u4e2a\u5bf9\u8c61\u5b58\u5728\u591a\u4e2a\u5f15\u7528\u4e00\u6837\u3002\u800c\u4e14\u7c7b\u4f3c\u7684\u8fd9\u4e9b\u6307\u5411Binder\u7684\u5f15\u7528\u662f\u5f3a\u7c7b\u578b\uff0c\u4ece\u800c\u786e\u4fdd\u53ea\u8981\u6709\u5f15\u7528Binder\u5b9e\u4f53\u5c31\u4e0d\u4f1a\u88ab\u91ca\u653e\u6389\u3002\u901a\u8fc7\u4ee5\u4e0a\u8fc7\u7a0b\u53ef\u4ee5\u770b\u51fa\uff0cSMgr\u8c61\u4e2a\u706b\u8f66\u7968\u4ee3\u552e\u70b9\uff0c\u6536\u96c6\u4e86\u6240\u6709\u706b\u8f66\u7684\u8f66\u7968\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b83\u8d2d\u4e70\u5230\u4e58\u5750\u5404\u8d9f\u706b\u8f66\u7684\u7968-\u5f97\u5230\u67d0\u4e2aBinder\u7684\u5f15\u7528\u3002</p>"},{"location":"android/binder/Binder_mechanism_intro/#binder_2","title":"\u533f\u540d Binder","text":"<p>\u5e76\u4e0d\u662f\u6240\u6709Binder\u90fd\u9700\u8981\u6ce8\u518c\u7ed9SMgr\u5e7f\u800c\u544a\u4e4b\u7684\u3002Server\u7aef\u53ef\u4ee5\u901a\u8fc7\u5df2\u7ecf\u5efa\u7acb\u7684Binder\u8fde\u63a5\u5c06\u521b\u5efa\u7684Binder\u5b9e\u4f53\u4f20\u7ed9Client\uff0c\u5f53\u7136\u8fd9\u6761\u5df2\u7ecf\u5efa\u7acb\u7684Binder\u8fde\u63a5\u5fc5\u987b\u662f\u901a\u8fc7\u5b9e\u540dBinder\u5b9e\u73b0\u3002\u7531\u4e8e\u8fd9\u4e2aBinder\u6ca1\u6709\u5411SMgr\u6ce8\u518c\u540d\u5b57\uff0c\u6240\u4ee5\u662f\u4e2a\u533f\u540dBinder\u3002Client\u5c06\u4f1a\u6536\u5230\u8fd9\u4e2a\u533f\u540dBinder\u7684\u5f15\u7528\uff0c\u901a\u8fc7\u8fd9\u4e2a\u5f15\u7528\u5411\u4f4d\u4e8eServer\u4e2d\u7684\u5b9e\u4f53\u53d1\u9001\u8bf7\u6c42\u3002\u533f\u540dBinder\u4e3a\u901a\u4fe1\u53cc\u65b9\u5efa\u7acb\u4e00\u6761\u79c1\u5bc6\u901a\u9053\uff0c\u53ea\u8981Server\u6ca1\u6709\u628a\u533f\u540dBinder\u53d1\u7ed9\u522b\u7684\u8fdb\u7a0b\uff0c\u522b\u7684\u8fdb\u7a0b\u5c31\u65e0\u6cd5\u901a\u8fc7\u7a77\u4e3e\u6216\u731c\u6d4b\u7b49\u4efb\u4f55\u65b9\u5f0f\u83b7\u5f97\u8be5Binder\u7684\u5f15\u7528\uff0c\u5411\u8be5Binder\u53d1\u9001\u8bf7\u6c42\u3002</p> <p>\u4e0b\u56fe\u5c55\u793a\u4e86\u53c2\u4e0eBinder\u901a\u4fe1\u7684\u6240\u6709\u89d2\u8272\uff0c\u5c06\u5728\u540e\u9762\u7684\u5185\u5bb9\u4e2d\u4e00\u4e00\u63d0\u5230\u3002</p> <p></p>"},{"location":"android/binder/Binder_mechanism_intro/#binder_3","title":"Binder \u5185\u5b58\u6620\u5c04\u548c\u63a5\u6536\u7f13\u5b58\u533a\u7ba1\u7406","text":"<p>\u6682\u4e14\u6487\u5f00Binder\uff0c\u8003\u8651\u4e00\u4e0b\u4f20\u7edf\u7684IPC\u65b9\u5f0f\u4e2d\uff0c\u6570\u636e\u662f\u600e\u6837\u4ece\u53d1\u9001\u7aef\u5230\u8fbe\u63a5\u6536\u7aef\u7684\u5462\uff1f\u901a\u5e38\u7684\u505a\u6cd5\u662f\uff0c\u53d1\u9001\u65b9\u5c06\u51c6\u5907\u597d\u7684\u6570\u636e\u5b58\u653e\u5728\u7f13\u5b58\u533a\u4e2d\uff0c\u8c03\u7528API\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u8fdb\u5165\u5185\u6838\u4e2d\u3002\u5185\u6838\u670d\u52a1\u7a0b\u5e8f\u5728\u5185\u6838\u7a7a\u95f4\u5206\u914d\u5185\u5b58\uff0c\u5c06\u6570\u636e\u4ece\u53d1\u9001\u65b9\u7f13\u5b58\u533a\u590d\u5236\u5230\u5185\u6838\u7f13\u5b58\u533a\u4e2d\u3002\u63a5\u6536\u65b9\u8bfb\u6570\u636e\u65f6\u4e5f\u8981\u63d0\u4f9b\u4e00\u5757\u7f13\u5b58\u533a\uff0c\u5185\u6838\u5c06\u6570\u636e\u4ece\u5185\u6838\u7f13\u5b58\u533a\u62f7\u8d1d\u5230\u63a5\u6536\u65b9\u63d0\u4f9b\u7684\u7f13\u5b58\u533a\u4e2d\u5e76\u5524\u9192\u63a5\u6536\u7ebf\u7a0b\uff0c\u5b8c\u6210\u4e00\u6b21\u6570\u636e\u53d1\u9001\u3002\u8fd9\u79cd\u5b58\u50a8-\u8f6c\u53d1\u673a\u5236\u6709\u4e24\u4e2a\u7f3a\u9677\uff1a\u9996\u5148\u662f\u6548\u7387\u4f4e\u4e0b\uff0c\u9700\u8981\u505a\u4e24\u6b21\u62f7\u8d1d\uff1a\u7528\u6237\u7a7a\u95f4-&gt;\u5185\u6838\u7a7a\u95f4-&gt;\u7528\u6237\u7a7a\u95f4\u3002Linux\u4f7f\u7528copy_from_user()\u548ccopy_to_user()\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u8de8\u7a7a\u95f4\u62f7\u8d1d\uff0c\u5728\u6b64\u8fc7\u7a0b\u4e2d\u5982\u679c\u4f7f\u7528\u4e86\u9ad8\u7aef\u5185\u5b58\uff08high memory\uff09\uff0c\u8fd9\u79cd\u62f7\u8d1d\u9700\u8981\u4e34\u65f6\u5efa\u7acb/\u53d6\u6d88\u9875\u9762\u6620\u5c04\uff0c\u9020\u6210\u6027\u80fd\u635f\u5931\u3002\u5176\u6b21\u662f\u63a5\u6536\u6570\u636e\u7684\u7f13\u5b58\u8981\u7531\u63a5\u6536\u65b9\u63d0\u4f9b\uff0c\u53ef\u63a5\u6536\u65b9\u4e0d\u77e5\u9053\u5230\u5e95\u8981\u591a\u5927\u7684\u7f13\u5b58\u624d\u591f\u7528\uff0c\u53ea\u80fd\u5f00\u8f9f\u5c3d\u91cf\u5927\u7684\u7a7a\u95f4\u6216\u5148\u8c03\u7528API\u63a5\u6536\u6d88\u606f\u5934\u83b7\u5f97\u6d88\u606f\u4f53\u5927\u5c0f\uff0c\u518d\u5f00\u8f9f\u9002\u5f53\u7684\u7a7a\u95f4\u63a5\u6536\u6d88\u606f\u4f53\u3002\u4e24\u79cd\u505a\u6cd5\u90fd\u6709\u4e0d\u8db3\uff0c\u4e0d\u662f\u6d6a\u8d39\u7a7a\u95f4\u5c31\u662f\u6d6a\u8d39\u65f6\u95f4\u3002</p> <p>Binder\u91c7\u7528\u4e00\u79cd\u5168\u65b0\u7b56\u7565\uff1a\u7531Binder\u9a71\u52a8\u8d1f\u8d23\u7ba1\u7406\u6570\u636e\u63a5\u6536\u7f13\u5b58\u3002\u6211\u4eec\u6ce8\u610f\u5230Binder\u9a71\u52a8\u5b9e\u73b0\u4e86mmap()\u7cfb\u7edf\u8c03\u7528\uff0c\u8fd9\u5bf9\u5b57\u7b26\u8bbe\u5907\u662f\u6bd4\u8f83\u7279\u6b8a\u7684\uff0c\u56e0\u4e3ammap()\u901a\u5e38\u7528\u5728\u6709\u7269\u7406\u5b58\u50a8\u4ecb\u8d28\u7684\u6587\u4ef6\u7cfb\u7edf\u4e0a\uff0c\u800c\u8c61Binder\u8fd9\u6837\u6ca1\u6709\u7269\u7406\u4ecb\u8d28\uff0c\u7eaf\u7cb9\u7528\u6765\u901a\u4fe1\u7684\u5b57\u7b26\u8bbe\u5907\u6ca1\u5fc5\u8981\u652f\u6301mmap()\u3002Binder\u9a71\u52a8\u5f53\u7136\u4e0d\u662f\u4e3a\u4e86\u5728\u7269\u7406\u4ecb\u8d28\u548c\u7528\u6237\u7a7a\u95f4\u505a\u6620\u5c04\uff0c\u800c\u662f\u7528\u6765\u521b\u5efa\u6570\u636e\u63a5\u6536\u7684\u7f13\u5b58\u7a7a\u95f4\u3002\u5148\u770bmmap()\u662f\u5982\u4f55\u4f7f\u7528\u7684\uff1a</p> <p>fd = open(\"/dev/binder\", O_RDWR);</p> <p>mmap(NULL, MAP_SIZE, PROT_READ, MAP_PRIVATE, fd, 0);</p> <p>\u8fd9\u6837Binder\u7684\u63a5\u6536\u65b9\u5c31\u6709\u4e86\u4e00\u7247\u5927\u5c0f\u4e3aMAP_SIZE\u7684\u63a5\u6536\u7f13\u5b58\u533a\u3002mmap()\u7684\u8fd4\u56de\u503c\u662f\u5185\u5b58\u6620\u5c04\u5728\u7528\u6237\u7a7a\u95f4\u7684\u5730\u5740\uff0c\u4e0d\u8fc7\u8fd9\u6bb5\u7a7a\u95f4\u662f\u7531\u9a71\u52a8\u7ba1\u7406\uff0c\u7528\u6237\u4e0d\u5fc5\u4e5f\u4e0d\u80fd\u76f4\u63a5\u8bbf\u95ee\uff08\u6620\u5c04\u7c7b\u578b\u4e3aPROT_READ\uff0c\u53ea\u8bfb\u6620\u5c04\uff09\u3002</p> <p>\u63a5\u6536\u7f13\u5b58\u533a\u6620\u5c04\u597d\u540e\u5c31\u53ef\u4ee5\u505a\u4e3a\u7f13\u5b58\u6c60\u63a5\u6536\u548c\u5b58\u653e\u6570\u636e\u4e86\u3002\u524d\u9762\u8bf4\u8fc7\uff0c\u63a5\u6536\u6570\u636e\u5305\u7684\u7ed3\u6784\u4e3abinder_transaction_data\uff0c\u4f46\u8fd9\u53ea\u662f\u6d88\u606f\u5934\uff0c\u771f\u6b63\u7684\u6709\u6548\u8d1f\u8377\u4f4d\u4e8edata.buffer\u6240\u6307\u5411\u7684\u5185\u5b58\u4e2d\u3002\u8fd9\u7247\u5185\u5b58\u4e0d\u9700\u8981\u63a5\u6536\u65b9\u63d0\u4f9b\uff0c\u6070\u6070\u662f\u6765\u81eammap()\u6620\u5c04\u7684\u8fd9\u7247\u7f13\u5b58\u6c60\u3002\u5728\u6570\u636e\u4ece\u53d1\u9001\u65b9\u5411\u63a5\u6536\u65b9\u62f7\u8d1d\u65f6\uff0c\u9a71\u52a8\u4f1a\u6839\u636e\u53d1\u9001\u6570\u636e\u5305\u7684\u5927\u5c0f\uff0c\u4f7f\u7528\u6700\u4f73\u5339\u914d\u7b97\u6cd5\u4ece\u7f13\u5b58\u6c60\u4e2d\u627e\u5230\u4e00\u5757\u5927\u5c0f\u5408\u9002\u7684\u7a7a\u95f4\uff0c\u5c06\u6570\u636e\u4ece\u53d1\u9001\u7f13\u5b58\u533a\u590d\u5236\u8fc7\u6765\u3002\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5b58\u653ebinder_transaction_data\u7ed3\u6784\u672c\u8eab\u4ee5\u53ca\u88684\u4e2d\u6240\u6709\u6d88\u606f\u7684\u5185\u5b58\u7a7a\u95f4\u8fd8\u662f\u5f97\u7531\u63a5\u6536\u8005\u63d0\u4f9b\uff0c\u4f46\u8fd9\u4e9b\u6570\u636e\u5927\u5c0f\u56fa\u5b9a\uff0c\u6570\u91cf\u4e5f\u4e0d\u591a\uff0c\u4e0d\u4f1a\u7ed9\u63a5\u6536\u65b9\u9020\u6210\u4e0d\u4fbf\u3002\u6620\u5c04\u7684\u7f13\u5b58\u6c60\u8981\u8db3\u591f\u5927\uff0c\u56e0\u4e3a\u63a5\u6536\u65b9\u7684\u7ebf\u7a0b\u6c60\u53ef\u80fd\u4f1a\u540c\u65f6\u5904\u7406\u591a\u6761\u5e76\u53d1\u7684\u4ea4\u4e92\uff0c\u6bcf\u6761\u4ea4\u4e92\u90fd\u9700\u8981\u4ece\u7f13\u5b58\u6c60\u4e2d\u83b7\u53d6\u76ee\u7684\u5b58\u50a8\u533a\uff0c\u4e00\u65e6\u7f13\u5b58\u6c60\u8017\u7aed\u5c06\u4ea7\u751f\u5bfc\u81f4\u65e0\u6cd5\u9884\u671f\u7684\u540e\u679c\u3002</p> <p>\u6709\u5206\u914d\u5fc5\u7136\u6709\u91ca\u653e\u3002\u63a5\u6536\u65b9\u5728\u5904\u7406\u5b8c\u6570\u636e\u5305\u540e\uff0c\u5c31\u8981\u901a\u77e5\u9a71\u52a8\u91ca\u653edata.buffer\u6240\u6307\u5411\u7684\u5185\u5b58\u533a\u3002\u5728\u4ecb\u7ecdBinder\u534f\u8bae\u65f6\u5df2\u7ecf\u63d0\u5230\uff0c\u8fd9\u662f\u7531\u547d\u4ee4BC_FREE_BUFFER\u5b8c\u6210\u7684\u3002</p> <p>\u901a\u8fc7\u4e0a\u9762\u4ecb\u7ecd\u53ef\u4ee5\u770b\u5230\uff0c\u9a71\u52a8\u4e3a\u63a5\u6536\u65b9\u5206\u62c5\u4e86\u6700\u4e3a\u7e41\u7410\u7684\u4efb\u52a1\uff1a\u5206\u914d/\u91ca\u653e\u5927\u5c0f\u4e0d\u7b49\uff0c\u96be\u4ee5\u9884\u6d4b\u7684\u6709\u6548\u8d1f\u8377\u7f13\u5b58\u533a\uff0c\u800c\u63a5\u6536\u65b9\u53ea\u9700\u8981\u63d0\u4f9b\u7f13\u5b58\u6765\u5b58\u653e\u5927\u5c0f\u56fa\u5b9a\uff0c\u6700\u5927\u7a7a\u95f4\u53ef\u4ee5\u9884\u6d4b\u7684\u6d88\u606f\u5934\u5373\u53ef\u3002\u5728\u6548\u7387\u4e0a\uff0c\u7531\u4e8emmap()\u5206\u914d\u7684\u5185\u5b58\u662f\u6620\u5c04\u5728\u63a5\u6536\u65b9\u7528\u6237\u7a7a\u95f4\u91cc\u7684\uff0c\u6240\u6709\u603b\u4f53\u6548\u679c\u5c31\u76f8\u5f53\u4e8e\u5bf9\u6709\u6548\u8d1f\u8377\u6570\u636e\u505a\u4e86\u4e00\u6b21\u4ece\u53d1\u9001\u65b9\u7528\u6237\u7a7a\u95f4\u5230\u63a5\u6536\u65b9\u7528\u6237\u7a7a\u95f4\u7684\u76f4\u63a5\u6570\u636e\u62f7\u8d1d\uff0c\u7701\u53bb\u4e86\u5185\u6838\u4e2d\u6682\u5b58\u8fd9\u4e2a\u6b65\u9aa4\uff0c\u63d0\u5347\u4e86\u4e00\u500d\u7684\u6027\u80fd\u3002\u987a\u4fbf\u518d\u63d0\u4e00\u70b9\uff0cLinux\u5185\u6838\u5b9e\u9645\u4e0a\u6ca1\u6709\u4ece\u4e00\u4e2a\u7528\u6237\u7a7a\u95f4\u5230\u53e6\u4e00\u4e2a\u7528\u6237\u7a7a\u95f4\u76f4\u63a5\u62f7\u8d1d\u7684\u51fd\u6570\uff0c\u9700\u8981\u5148\u7528copy_from_user()\u62f7\u8d1d\u5230\u5185\u6838\u7a7a\u95f4\uff0c\u518d\u7528copy_to_user()\u62f7\u8d1d\u5230\u53e6\u4e00\u4e2a\u7528\u6237\u7a7a\u95f4\u3002\u4e3a\u4e86\u5b9e\u73b0\u7528\u6237\u7a7a\u95f4\u5230\u7528\u6237\u7a7a\u95f4\u7684\u62f7\u8d1d\uff0cmmap()\u5206\u914d\u7684\u5185\u5b58\u9664\u4e86\u6620\u5c04\u8fdb\u4e86\u63a5\u6536\u65b9\u8fdb\u7a0b\u91cc\uff0c\u8fd8\u6620\u5c04\u8fdb\u4e86\u5185\u6838\u7a7a\u95f4\u3002\u6240\u4ee5\u8c03\u7528copy_from_user()\u5c06\u6570\u636e\u62f7\u8d1d\u8fdb\u5185\u6838\u7a7a\u95f4\u4e5f\u76f8\u5f53\u4e8e\u62f7\u8d1d\u8fdb\u4e86\u63a5\u6536\u65b9\u7684\u7528\u6237\u7a7a\u95f4\uff0c\u8fd9\u5c31\u662fBinder\u53ea\u9700\u4e00\u6b21\u62f7\u8d1d\u7684\u2018\u79d8\u5bc6\u2019\u3002</p>"},{"location":"android/binder/Binder_mechanism_intro/#_1","title":"\u53c2\u8003","text":"<p>universus\u7684\u4e13\u680f - Android Binder\u8bbe\u8ba1\u4e0e\u5b9e\u73b0 - \u8bbe\u8ba1\u7bc7 Android AIDL\u7b80\u4ecb\u4e0e\u4f7f\u7528</p>"},{"location":"android/binder/Intent_extra_size_limit/","title":"Android Intent \u4f20\u9012\u6570\u636e\u5927\u5c0f\u9650\u5236","text":"<p>Intent\u4f20\u9012\u6570\u636e\u65f6\uff0c\u5982\u679c\u6570\u636e\u592a\u5927\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u5f02\u5e38\u3002</p> <p>\u5728<code>sendBroadcast</code>\uff0c<code>startActivity</code>\u65f6\uff0c\u6211\u4eec\u4f1a\u7528\u5230Intent\u3002</p> <p>Intent\u53ef\u4ee5\u643a\u5e26\u4e00\u4e9b\u6570\u636e\uff0c\u6bd4\u5982\u57fa\u672c\u7c7b\u578b\u6570\u636eint\u3001Boolean\uff0c\u6216\u662fString\uff0c\u6216\u662f\u5e8f\u5217\u5316\u5bf9\u8c61\uff0cParcelable\u4e0eSerializable\u3002</p> <p>Intent\u4f20\u9012\u6570\u636e\u65f6\uff0c\u5982\u679c\u6570\u636e\u592a\u5927\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u5f02\u5e38\u3002\u6bd4\u5982App\u95ea\u9000\uff0c\u6216\u662fIntent\u53d1\u9001\u4e0d\u6210\u529f\uff0clogcat\u62a5\u9519\u7b49\u7b49\u3002</p> <p>\u8fd9\u5c31\u7275\u6d89\u5230\u4e00\u4e2a\u95ee\u9898\uff1aIntent \u4f20\u9012\u6570\u636e\u5927\u5c0f\u9650\u5236\u3002</p> <p>Intent\u5230\u5e95\u80fd\u591f\u643a\u5e26\u591a\u5c11\u6570\u636e\u5462\uff1f</p>"},{"location":"android/binder/Intent_extra_size_limit/#intent","title":"\u4f7f\u7528Intent\u4f20\u9001\u6570\u636e\u65f6\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u5f02\u5e38","text":"<p>\u5728Intent\u4e2d\u4f20\u5165\u4e00\u4e2aParcelable\u5bf9\u8c61\uff1b\u4f8b\u5982\u4f20\u5165\u4e00\u4e2abitmap\u5bf9\u8c61\u3002</p> <p>\u4ee3\u7801\u53c2\u8003\uff1a https://github.com/AnRFDev/android-Basic4 <pre><code>    Bitmap b1 = Bitmap.createScaledBitmap(srcBmp, dstWid, dstHeight, false);\n    Intent intent = new Intent(MSG_INTENT);\n    intent.putExtra(K_PIC, b1);\n</code></pre> \u9009\u62e9bitmap\u7684\u539f\u56e0\u662f\uff0cBitmap\u5b9e\u73b0\u4e86<code>Parcelable</code>\u63a5\u53e3\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7<code>getByteCount()</code>\u5f97\u77e5\u6240\u5360\u5185\u5b58\u5927\u5c0f\u3002</p> <p><code>sendBroadcast</code>\u65f6\uff0c\u62a5\u51fa\u5982\u4e0b\u4fe1\u606f <pre><code> V/ActivityManager: Broadcast: Intent { act=intent_bi flg=0x10 (has extras) } ordered=false userid=0 callerApp=ProcessRecord{27aeaaf5 31217:com.rustfisher.basic4/u0a113}\n E/JavaBinder: !!! FAILED BINDER TRANSACTION !!!\n W/BroadcastQueue: Failure sending broadcast Intent { act=intent_bi flg=0x10 (has extras) }\n        android.os.TransactionTooLargeException\n            at android.os.BinderProxy.transactNative(Native Method)\n            at android.os.BinderProxy.transact(Binder.java:504)\n            at android.app.ApplicationThreadProxy.scheduleRegisteredReceiver(ApplicationThreadNative.java:1170)\n            at com.android.server.am.BroadcastQueue.performReceiveLocked(BroadcastQueue.java:576)\n            at com.android.server.am.BroadcastQueue.deliverToRegisteredReceiverLocked(BroadcastQueue.java:848)\n            at com.android.server.am.BroadcastQueue.processNextBroadcast(BroadcastQueue.java:917)\n            at com.android.server.am.BroadcastQueue$BroadcastHandler.handleMessage(BroadcastQueue.java:254)\n            at android.os.Handler.dispatchMessage(Handler.java:111)\n            at android.os.Looper.loop(Looper.java:194)\n            at android.os.HandlerThread.run(HandlerThread.java:61)\n            at com.android.server.ServiceThread.run(ServiceThread.java:46)\n</code></pre></p> <p>\u67e5\u770b\u5f02\u5e38\u7c7b<code>TransactionTooLargeException</code>\uff0c\u5b83\u7ee7\u627f\u4e86<code>RemoteException</code> <pre><code>package android.os;\npublic class TransactionTooLargeException extends RemoteException {\n    public TransactionTooLargeException() {\n        super();\n    }\n\n    public TransactionTooLargeException(String msg) {\n        super(msg);\n    }\n}\n</code></pre></p> <p>\u4ece\u62a5\u9519\u4fe1\u606f<code>FAILED BINDER TRANSACTION</code>\u53ef\u4ee5\u770b\u51fa\uff0cbinder\u4f20\u9001\u6570\u636e\u5931\u8d25\u4e86\u3002 \u8ffd\u8e2a\u5230<code>Binder</code>\uff0c\u5b83\u7684<code>transactNative</code>\u65b9\u6cd5\u62a5\u51fa<code>RemoteException</code> <pre><code>public native boolean transactNative(int code, Parcel data, Parcel reply,\n            int flags) throws RemoteException;\n</code></pre> \u629b\u51fa\u7684\u5f02\u5e38\u4e0eBinder\u6709\u5173\u3002</p>"},{"location":"android/binder/Intent_extra_size_limit/#intentbinder","title":"Intent\u643a\u5e26\u4fe1\u606f\u7684\u5927\u5c0f\u53d7Binder\u9650\u5236","text":"<p>Intent\u643a\u5e26\u4fe1\u606f\u7684\u5927\u5c0f\u5176\u5b9e\u662f\u53d7Binder\u9650\u5236\u3002\u672c\u6587\u6807\u9898\u4e5f\u53ef\u4ee5\u6539\u4e3a\u201cBinder\u4f20\u9012\u6570\u636e\u5927\u5c0f\u9650\u5236\u201d\u3002</p> <p>\u6570\u636e\u4ee5<code>Parcel</code>\u5bf9\u8c61\u7684\u5f62\u5f0f\u5b58\u653e\u5728Binder\u4f20\u9012\u7f13\u5b58\u4e2d\u3002 \u5982\u679c\u6570\u636e\u6216\u8fd4\u56de\u503c\u6bd4\u4f20\u9012buffer\u5927\uff0c\u5219\u6b64\u6b21\u4f20\u9012\u8c03\u7528\u5931\u8d25\u5e76\u629b\u51fa<code>TransactionTooLargeException</code>\u5f02\u5e38\u3002</p> <p>Binder\u4f20\u9012\u7f13\u5b58\u6709\u4e00\u4e2a\u9650\u5b9a\u5927\u5c0f\uff0c\u901a\u5e38\u662f1Mb\u3002\u4f46\u540c\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u6240\u6709\u7684\u4f20\u8f93\u5171\u4eab\u7f13\u5b58\u7a7a\u95f4\u3002</p> <p>\u591a\u4e2a\u5730\u65b9\u5728\u8fdb\u884c\u4f20\u8f93\u65f6\uff0c\u5373\u65f6\u5b83\u4eec\u5404\u81ea\u4f20\u8f93\u7684\u6570\u636e\u4e0d\u8d85\u51fa\u5927\u5c0f\u9650\u5236\uff0c<code>TransactionTooLargeException</code>\u5f02\u5e38\u4e5f\u53ef\u80fd\u4f1a\u88ab\u629b\u51fa\u3002</p> <p>\u5728\u4f7f\u7528Intent\u4f20\u9012\u6570\u636e\u65f6\uff0c1Mb\u5e76\u4e0d\u662f\u5b89\u5168\u4e0a\u9650\u3002\u56e0\u4e3aBinder\u4e2d\u53ef\u80fd\u6b63\u5728\u5904\u7406\u5176\u5b83\u7684\u4f20\u8f93\u5de5\u4f5c\u3002 \u4e0d\u540c\u7684\u673a\u578b\u548c\u7cfb\u7edf\u7248\u672c\uff0c\u8fd9\u4e2a\u4e0a\u9650\u503c\u4e5f\u53ef\u80fd\u4f1a\u4e0d\u540c\u3002</p> <p>Binder \u4e8b\u52a1\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u56fa\u5b9a\u6709\u9650\uff0c\u76ee\u524d\u4e3a 1MB\uff0c\u7531\u8fdb\u7a0b\u4e2d\u6b63\u5728\u5904\u7406\u7684\u6240\u6709\u4e8b\u52a1\u5171\u4eab\u3002\u7531\u4e8e\u6b64\u9650\u5236\u662f\u8fdb\u7a0b\u7ea7\u522b\u800c\u4e0d\u662f Activity \u7ea7\u522b\u7684\u9650\u5236\uff0c\u56e0\u6b64\u8fd9\u4e9b\u4e8b\u52a1\u5305\u62ec\u5e94\u7528\u4e2d\u7684\u6240\u6709 binder \u4e8b\u52a1\uff0c\u4f8b\u5982 onSaveInstanceState\uff0cstartActivity \u4ee5\u53ca\u4e0e\u7cfb\u7edf\u7684\u4efb\u4f55\u4e92\u52a8\u3002\u8d85\u8fc7\u5927\u5c0f\u9650\u5236\u65f6\uff0c\u5c06\u5f15\u53d1 TransactionTooLargeException\u3002</p> <p>\u5728\u5176\u5b83\u5730\u65b9\uff0c\u4f8b\u5982<code>onSaveInstanceState(@NonNull Bundle outState)</code>\uff0c\u4e5f\u53ef\u80fd\u4f1a\u9047\u5230\u4e0eBinder\u6709\u5173\u7684\u7c7b\u4f3c\u95ee\u9898\u3002</p> <p>\u5bf9\u4e8e savedInstanceState \u7684\u5177\u4f53\u60c5\u51b5\uff0c\u5e94\u5c06\u6570\u636e\u91cf\u4fdd\u6301\u5728\u8f83\u5c0f\u7684\u89c4\u6a21\uff0c\u56e0\u4e3a\u53ea\u8981\u7528\u6237\u53ef\u4ee5\u8fd4\u56de\u5230\u8be5 Activity\uff0c\u7cfb\u7edf\u8fdb\u7a0b\u5c31\u9700\u8981\u4fdd\u7559\u6240\u63d0\u4f9b\u7684\u6570\u636e\uff08\u5373\u4f7f Activity \u7684\u8fdb\u7a0b\u5df2\u7ec8\u6b62\uff09\u3002\u6211\u4eec\u5efa\u8bae\u60a8\u5c06\u4fdd\u5b58\u7684\u72b6\u6001\u4fdd\u6301\u5728 50k \u6570\u636e\u4ee5\u4e0b\u3002</p> <p>\u4f20\u8f93\u5927\u91cf\u6570\u636e\uff0c\u53ef\u4ee5\u8003\u8651URL\u4e4b\u7c7b\u7684\u65b9\u6cd5\u3002</p> <p>\u53c2\u8003 * https://stackoverflow.com/questions/8434423/android-remote-method-data-limit * https://developer.android.com/reference/android/os/TransactionTooLargeException</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u6398\u91d1</p>"},{"location":"android/broadcast/intro_use/","title":"Android \u5e7f\u64ad\u673a\u5236Broadcast\u4ecb\u7ecd\u4e0e\u4f7f\u7528","text":"<p>Android\u5e94\u7528\u53ef\u4ee5\u901a\u8fc7\u5e7f\u64ad\u4ece\u7cfb\u7edf\u6216\u5176\u4ed6App\u63a5\u6536\u6216\u53d1\u9001\u6d88\u606f\u3002\u7c7b\u4f3c\u4e8e\u8ba2\u9605-\u53d1\u5e03\u8bbe\u8ba1\u6a21\u5f0f\u3002\u5f53\u67d0\u4e9b\u4e8b\u4ef6\u53d1\u751f\u65f6\uff0c\u53ef\u4ee5\u53d1\u51fa\u5e7f\u64ad\u3002 \u7cfb\u7edf\u5728\u67d0\u4e9b\u72b6\u6001\u6539\u53d8\u65f6\u4f1a\u53d1\u51fa\u5e7f\u64ad\uff0c\u4f8b\u5982\u5f00\u673a\u3001\u5145\u7535\u3002App\u4e5f\u53ef\u53d1\u9001\u81ea\u5b9a\u4e49\u5e7f\u64ad\u3002\u5e7f\u64ad\u53ef\u7528\u4e8e\u5e94\u7528\u95f4\u7684\u901a\u8baf\uff0c\u662fIPC\u7684\u4e00\u79cd\u65b9\u5f0f\u3002</p>"},{"location":"android/broadcast/intro_use/#_1","title":"\u5e7f\u64ad\u7684\u79cd\u7c7b","text":"<p>\u5e7f\u64ad\u7684\u79cd\u7c7b\u4e5f\u53ef\u4ee5\u770b\u6210\u662f\u5e7f\u64ad\u7684\u5c5e\u6027\u3002</p>"},{"location":"android/broadcast/intro_use/#normal-broadcasts","title":"\u6807\u51c6\u5e7f\u64ad\uff08Normal Broadcasts\uff09","text":"<p>\u5b8c\u5168\u5f02\u6b65\u7684\u5e7f\u64ad\u3002\u5e7f\u64ad\u53d1\u51fa\u540e\uff0c\u6240\u6709\u7684\u5e7f\u64ad\u63a5\u6536\u5668\u51e0\u4e4e\u540c\u65f6\u63a5\u6536\u5230\u8fd9\u6761\u5e7f\u64ad\u3002 \u4e0d\u540c\u7684App\u53ef\u4ee5\u6ce8\u518c\u5e76\u63a5\u5230\u6807\u51c6\u5e7f\u64ad\u3002\u4f8b\u5982\u7cfb\u7edf\u5e7f\u64ad\u3002</p>"},{"location":"android/broadcast/intro_use/#ordered-broadcasts","title":"\u6709\u5e8f\u5e7f\u64ad\uff08Ordered Broadcasts\uff09","text":"<p>\u540c\u6b65\u5e7f\u64ad\u3002\u540c\u4e00\u65f6\u523b\u53ea\u6709\u4e00\u4e2a\u5e7f\u64ad\u63a5\u6536\u5668\u80fd\u63a5\u6536\u5230\u8fd9\u6761\u5e7f\u64ad\u3002\u8fd9\u4e2a\u63a5\u6536\u5668\u5904\u7406\u5b8c\u540e\uff0c\u5e7f\u64ad\u624d\u4f1a\u7ee7\u7eed\u4f20\u9012\u3002 \u6709\u5e8f\u5e7f\u64ad\u662f\u5168\u5c40\u7684\u5e7f\u64ad\u3002</p>"},{"location":"android/broadcast/intro_use/#local-broaddcasts","title":"\u672c\u5730\u5e7f\u64ad\uff08Local Broaddcasts\uff09","text":"<p>\u53ea\u5728\u672cApp\u53d1\u9001\u548c\u63a5\u6536\u7684\u5e7f\u64ad\u3002\u6ce8\u518c\u4e3a\u672c\u5730\u5e7f\u64ad\u7684\u63a5\u6536\u5668\u65e0\u6cd5\u6536\u5230\u6807\u51c6\u5e7f\u64ad\u3002</p>"},{"location":"android/broadcast/intro_use/#_2","title":"\u5e26\u6743\u9650\u7684\u5e7f\u64ad","text":"<p>\u53d1\u9001\u5e7f\u64ad\u65f6\u53ef\u4ee5\u5e26\u4e0a\u76f8\u5173\u6743\u9650\uff0c\u7533\u8bf7\u4e86\u6743\u9650\u7684App\u6216\u5e7f\u64ad\u63a5\u6536\u5668\u624d\u80fd\u6536\u5230\u76f8\u5e94\u7684\u5e26\u6743\u9650\u7684\u5e7f\u64ad\u3002 \u5982\u679c\u5728manifest\u4e2d\u7533\u8bf7\u4e86\u76f8\u5e94\u6743\u9650\uff0c\u63a5\u6536\u5668\u53ef\u4ee5\u4e0d\u7528\u518d\u7533\u8bf7\u4e00\u6b21\u6743\u9650\u5373\u53ef\u63a5\u5230\u76f8\u5e94\u5e7f\u64ad\u3002</p>"},{"location":"android/broadcast/intro_use/#_3","title":"\u63a5\u6536\u5e7f\u64ad","text":"<p>\u521b\u5efa\u5e7f\u64ad\u63a5\u6536\u5668\uff0c\u8c03\u7528<code>onReceive()</code>\u65b9\u6cd5\uff0c\u9700\u8981\u4e00\u4e2a\u7ee7\u627fBroadcastReceiver\u7684\u7c7b\u3002</p>"},{"location":"android/broadcast/intro_use/#_4","title":"\u6ce8\u518c\u5e7f\u64ad","text":"<p>\u4ee3\u7801\u4e2d\u6ce8\u518c\u79f0\u4e3a\u52a8\u6001\u6ce8\u518c\u3002\u5728AndroidManifest.xml\u4e2d\u6ce8\u518c\u79f0\u4e3a\u9759\u6001\u6ce8\u518c\u3002\u52a8\u6001\u6ce8\u518c\u7684\u521a\u6ce2\u63a5\u6536\u5668\u4e00\u5b9a\u8981\u53d6\u6d88\u6ce8\u518c\u3002\u5728<code>onDestroy()</code>\u65b9\u6cd5\u4e2d\u8c03\u7528<code>unregisterReceiver()</code>\u65b9\u6cd5\u6765\u53d6\u6d88\u6ce8\u518c\u3002</p> <p>\u4e0d\u8981\u5728<code>onReceive()</code>\u65b9\u6cd5\u4e2d\u6dfb\u52a0\u8fc7\u591a\u7684\u903b\u8f91\u64cd\u4f5c\u6216\u8017\u65f6\u7684\u64cd\u4f5c\u3002\u56e0\u4e3a\u5728\u5e7f\u64ad\u63a5\u6536\u5668\u4e2d\u4e0d\u5141\u8bb8\u5f00\u542f\u7ebf\u7a0b\uff0c\u5f53<code>onReceive()</code>\u65b9\u6cd5\u8fd0\u884c\u8f83\u957f\u65f6\u95f4\u800c\u6ca1\u7ed3\u675f\u65f6\uff0c\u7a0b\u5e8f\u4f1a\u62a5\u9519\u3002\u56e0\u6b64\u5e7f\u64ad\u63a5\u6536\u5668\u4e00\u822c\u7528\u6765\u6253\u5f00\u5176\u4ed6\u7ec4\u4ef6\uff0c\u6bd4\u5982\u521b\u5efa\u4e00\u6761\u72b6\u6001\u680f\u901a\u77e5\u6216\u542f\u52a8\u4e00\u4e2a\u670d\u52a1\u3002</p> <p>\u65b0\u5efa\u4e00\u4e2aMyExampleReceiver\u7ee7\u627f\u81eaBroadcastReceiver\u3002 <pre><code>public class MyExampleReceiver extends BroadcastReceiver {\n    @Override\n    public void onReceive(Context context, Intent intent) {\n        Toast.makeText(context,\"Got it\",Toast.LENGTH_SHORT).show();\n        //abortBroadcast();\n    }\n}\n</code></pre> <code>abortBroadcast()</code>\u53ef\u4ee5\u622a\u65ad\u6709\u5e8f\u5e7f\u64ad</p> <p>\u5728<code>AndroidManifest.xml</code>\u4e2d\u6ce8\u518c\u5e7f\u64ad\u63a5\u6536\u5668\uff1b<code>android:name</code>\u91cc\u586b\u63a5\u6536\u5668\u7684\u540d\u5b57\u3002 \u53ef\u4ee5\u8bbe\u7f6e\u5e7f\u64ad\u63a5\u6536\u5668\u4f18\u5148\u7ea7\uff1a <pre><code>&lt;intent-filter android:priority=\"100\"&gt;\n\n&lt;receiver android:name=\".MyExampleReceiver\"&gt;\n    &lt;intent-filter&gt;\n        &lt;action android:name=\"com.rust.broadcasttest.MY_BROADCAST\"/&gt;\n    &lt;/intent-filter&gt;\n&lt;/receiver&gt;\n</code></pre></p> <p>\u8ba9\u63a5\u6536\u5668\u63a5\u6536\u5230\u4e00\u6761<code>\"com.rust.broadcasttest.MY_BROADCAST\"</code>\u5e7f\u64ad\u3002 \u53d1\u9001\u81ea\u5b9a\u4e49\u5e7f\u64ad\uff08\u6807\u51c6\u5e7f\u64ad\uff09\u65f6\uff0c\u8981\u4f20\u9001\u8fd9\u4e2a\u503c\u3002\u4f8b\u5982\uff1a <pre><code>Intent intent = new Intent(\"com.rust.broadcasttest.MY_BROADCAST\");\nsendBroadcast(intent);\n</code></pre></p> <p>\u53d1\u9001\u6709\u5e8f\u5e7f\u64ad\uff0c\u5e94\u5f53\u8c03\u7528<code>sendOrderedBroadcast()</code> <pre><code>Intent intent = new Intent(\"com.rust.broadcasttest.MY_BROADCAST\");\nsendOrderedBroadcast(intent\uff0cnull);\n</code></pre></p>"},{"location":"android/broadcast/intro_use/#_5","title":"\u53d1\u9001\u5e7f\u64ad","text":"<p>App\u67093\u79cd\u53d1\u9001\u5e7f\u64ad\u7684\u65b9\u5f0f\u3002\u53d1\u9001\u5e7f\u64ad\u9700\u8981\u4f7f\u7528Intent\u7c7b\u3002</p>"},{"location":"android/broadcast/intro_use/#sendorderedbroadcastintent-string","title":"sendOrderedBroadcast(Intent, String)","text":"<p>\u53d1\u9001\u6709\u5e8f\u5e7f\u64ad\u3002\u6bcf\u6b21\u53ea\u67091\u4e2a\u5e7f\u64ad\u63a5\u6536\u5668\u80fd\u63a5\u5230\u5e7f\u64ad\u3002 \u63a5\u6536\u5668\u63a5\u5230\u6709\u5e8f\u5e7f\u64ad\u540e\uff0c\u53ef\u4ee5\u5b8c\u5168\u5730\u622a\u65ad\u5e7f\u64ad\uff0c\u6216\u8005\u4f20\u9012\u4e00\u4e9b\u4fe1\u606f\u7ed9\u4e0b\u4e00\u4e2a\u63a5\u6536\u5668\u3002 \u6709\u5e8f\u5e7f\u64ad\u7684\u987a\u5e8f\u53ef\u53d7<code>android:priority</code>\u6807\u7b7e\u5f71\u54cd\u3002\u540c\u7b49\u7ea7\u7684\u63a5\u6536\u5668\u6536\u5230\u5e7f\u64ad\u7684\u987a\u5e8f\u662f\u968f\u673a\u7684\u3002</p>"},{"location":"android/broadcast/intro_use/#sendbroadcastintent","title":"sendBroadcast(Intent)","text":"<p>\u4ee5\u4e00\u4e2a\u672a\u5b9a\u4e49\u7684\u987a\u5e8f\u5411\u6240\u6709\u63a5\u6536\u5668\u53d1\u9001\u5e7f\u64ad\u3002\u4e5f\u79f0\u4f5c\u666e\u901a\u5e7f\u64ad\u3002 \u8fd9\u79cd\u65b9\u5f0f\u66f4\u9ad8\u6548\uff0c\u4f46\u662f\u63a5\u6536\u5668\u4e0d\u80fd\u7ed9\u4e0b\u4e00\u4e2a\u63a5\u6536\u5668\u4f20\u9012\u6d88\u606f\u3002\u8fd9\u7c7b\u5e7f\u64ad\u4e5f\u65e0\u6cd5\u622a\u65ad\u3002</p>"},{"location":"android/broadcast/intro_use/#localbroadcastmanagersendbroadcast","title":"LocalBroadcastManager.sendBroadcast","text":"<p>\u5e7f\u64ad\u53ea\u80fd\u5728\u5e94\u7528\u7a0b\u5e8f\u5185\u90e8\u8fdb\u884c\u4f20\u9012\uff0c\u5e76\u4e14\u5e7f\u64ad\u63a5\u6536\u5668\u4e5f\u53ea\u80fd\u63a5\u6536\u5230\u6765\u81ea\u672c\u5e94\u7528\u7a0b\u5e8f\u53d1\u51fa\u7684\u5e7f\u64ad\u3002 \u8fd9\u4e2a\u65b9\u6cd5\u6bd4\u5168\u5c40\u5e7f\u64ad\u66f4\u9ad8\u6548\uff08\u4e0d\u9700\u8981Interprocess communication\uff0cIPC\uff09\uff0c\u800c\u4e14\u4e0d\u9700\u8981\u62c5\u5fc3\u5176\u5b83App\u4f1a\u6536\u5230\u4f60\u7684\u5e7f\u64ad\u4ee5\u53ca\u5176\u4ed6\u5b89\u5168\u95ee\u9898\u3002</p>"},{"location":"android/broadcast/intro_use/#_6","title":"\u5e7f\u64ad\u4e0e\u6743\u9650","text":""},{"location":"android/broadcast/intro_use/#_7","title":"\u53d1\u9001\u5e26\u7740\u6743\u9650\u7684\u5e7f\u64ad","text":"<p>\u5f53\u4f60\u8c03\u7528<code>sendBroadcast(Intent, String)</code>\u6216<code>sendOrderedBroadcast(Intent, String, BroadcastReceiver, Handler, int, String, Bundle)</code>\u65f6\uff0c\u4f60\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u6743\u9650\u3002 \u63a5\u6536\u5668\u5728manifest\u4e2d\u7533\u8bf7\u4e86\u76f8\u5e94\u6743\u9650\u65f6\u624d\u80fd\u6536\u5230\u8fd9\u4e2a\u5e7f\u64ad\u3002</p> <p>\u4f8b\u5982\u53d1\u9001\u4e00\u4e2a\u5e26\u7740\u6743\u9650\u7684\u5e7f\u64ad <pre><code>sendBroadcast(new Intent(\"com.example.NOTIFY\"), Manifest.permission.SEND_SMS);\n</code></pre></p> <p>\u63a5\u6536\u5e7f\u64ad\u7684app\u5fc5\u987b\u6ce8\u518c\u76f8\u5e94\u7684\u6743\u9650 <pre><code>&lt;uses-permission android:name=\"android.permission.SEND_SMS\"/&gt;\n</code></pre></p> <p>\u5f53\u7136\u4e5f\u53ef\u4ee5\u4f7f\u7528\u81ea\u5b9a\u4e49permission\u3002\u5728manifest\u4e2d\u4f7f\u7528permission\u6807\u7b7e <pre><code>&lt;permission android:name=\"custom_permission\" /&gt;\n</code></pre> \u6dfb\u52a0\u540e\u7f16\u8bd1\u4e00\u4e0b\u3002\u5373\u53ef\u8c03\u7528<code>Manifest.permission.custom_permission</code></p>"},{"location":"android/broadcast/intro_use/#_8","title":"\u63a5\u6536\u5e26\u6743\u9650\u7684\u5e7f\u64ad","text":"<p>\u82e5\u6ce8\u518c\u5e7f\u64ad\u63a5\u6536\u5668\u65f6\u7533\u660e\u4e86\u6743\u9650\uff0c\u90a3\u4e48\u53ea\u4f1a\u63a5\u6536\u5230\u5e26\u7740\u76f8\u5e94\u6743\u9650\u7684\u5e7f\u64ad\u3002</p> <p>\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u58f0\u660e\u6743\u9650\uff0c\u7a0b\u5e8f\u624d\u80fd\u8bbf\u95ee\u4e00\u4e9b\u5173\u952e\u4fe1\u606f\u3002 \u4f8b\u5982\u5141\u8bb8\u67e5\u8be2\u7cfb\u7edf\u7f51\u7edc\u72b6\u6001\u3002 <pre><code>&lt;uses-permission android:name=\"android.permission.ACCESS_NETWORK_STATE\"/&gt;\n\n&lt;!-- \u673a\u5668\u5f00\u673a\u5e7f\u64ad --&gt;\n&lt;uses-permission android:name=\"android.permission.BOOT_COMPLETED\"&gt;\n</code></pre> \u5982\u679c\u6ca1\u6709\u7533\u8bf7\u6743\u9650\uff0c\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u610f\u5916\u5173\u95ed\u3002</p>"},{"location":"android/broadcast/intro_use/#_9","title":"\u4f7f\u7528\u793a\u4f8b","text":"<p>\u53d1\u9001\u548c\u63a5\u6536\u5e7f\u64ad\u3002\u5206\u4e3a\u53d1\u9001\u548c\u63a5\u6536\u65b92\u4e2aApp\u3002</p> <p>\u4f7f\u7528\u5e26\u6743\u9650\u7684\u5e7f\u64ad\u3002\u7cfb\u7edf\u6743\u9650\u4e0e\u81ea\u5b9a\u4e49\u6743\u9650\u3002 \u4f7f\u7528\u6743\u9650\u9700\u8981\u5728AndroidManifest.xml\u4e2d\u58f0\u660e\u3002\u5982\u679c\u662f\u81ea\u5b9a\u4e49\u6743\u9650\uff0c\u9700\u8981\u5148\u6dfb\u52a0\u81ea\u5b9a\u4e49\u6743\u9650\u3002 <pre><code>&lt;!-- \u81ea\u5b9a\u4e49\u7684\u6743\u9650  \u7ed9\u5e7f\u64ad\u7528 --&gt;\n&lt;permission android:name=\"com.rust.permission_rust_1\" /&gt;\n&lt;uses-permission android:name=\"com.rust.permission_rust_1\" /&gt;\n</code></pre></p> <p>\u53d1\u9001\u5e7f\u64ad\u65f6\u5e26\u4e0a\u6743\u9650\u58f0\u660e\u3002\u63a5\u6536\u65b9\uff08\u4e0d\u8bba\u662f\u5426\u5df1\u65b9App\uff09\u9700\u8981\u5728<code>AndroidManifest.xml</code>\u4e2d\u7533\u8bf7\u6743\u9650\u3002 \u6ce8\u518c\u63a5\u6536\u5668\u65f6\u4e5f\u9700\u8981\u58f0\u660e\u6743\u9650\u3002</p> <p>\u53d1\u9001\u4e0d\u5e26\u6743\u9650\u7684\u6709\u5e8f\u5e7f\u64ad <pre><code>Intent intent = new Intent(MSG_PHONE);\nsendOrderedBroadcast(intent, null);\nLog.d(TAG, \"[RustFisher-App1] \u53d1\u9001\u4e0d\u5e26\u6743\u9650\u7684\u6709\u5e8f\u5e7f\u64ad, \" + intent.getAction());\n</code></pre></p> <p>\u53d1\u9001\u65b9App1\u4ee3\u7801 <pre><code>    private static final String TAG = \"rustApp\";\n    public static final String MSG_PHONE = \"msg_phone\";\n    public static final String PERMISSION_RUST_1 = \"com.rust.permission_rust_1\";\n\n        // onCreate\u6ce8\u518c\u5e7f\u64ad\u63a5\u6536\u5668\n        registerReceiver(mStandardReceiver1, makeIF());\n        registerReceiver(mStandardReceiver2, makeIF());\n        registerReceiver(mStandardReceiver3, makeIF());\n\n        registerReceiver(mStandardReceiverWithPermission, makeIF(),\n                Manifest.permission.permission_rust_1, null);  // \u5e26\u4e0a\u6743\u9650\n\n        LocalBroadcastManager.getInstance(getApplicationContext())\n                .registerReceiver(mLocalReceiver1, makeIF());\n        LocalBroadcastManager.getInstance(getApplicationContext())\n                .registerReceiver(mLocalReceiver2, makeIF());\n        LocalBroadcastManager.getInstance(getApplicationContext())\n                .registerReceiver(mLocalReceiver3, makeIF());\n\n        // \u89e3\u9664\u63a5\u6536\u5668\n        unregisterReceiver(mStandardReceiver1);\n        unregisterReceiver(mStandardReceiver2);\n        unregisterReceiver(mStandardReceiver3);\n\n        unregisterReceiver(mStandardReceiverWithPermission);\n\n        LocalBroadcastManager.getInstance(getApplicationContext())\n                .unregisterReceiver(mLocalReceiver1);\n        LocalBroadcastManager.getInstance(getApplicationContext())\n                .unregisterReceiver(mLocalReceiver2);\n        LocalBroadcastManager.getInstance(getApplicationContext())\n                .unregisterReceiver(mLocalReceiver3);\n\n\n    // \u53d1\u9001\u6807\u51c6\u5e7f\u64ad\n    private void sendStandardBroadcast() {\n        Intent intent = new Intent(MSG_PHONE);\n        sendBroadcast(intent);\n        Log.d(TAG, \"[RustFisher-App1] Dispatcher \u53d1\u9001\u6807\u51c6\u5e7f\u64ad\");\n    }\n\n    // \u53d1\u9001\u5e26\u6743\u9650\u7684\u6807\u51c6\u5e7f\u64ad\n    private void sendStandardBroadcastWithPermission() {\n        Intent intent = new Intent(MSG_PHONE);\n        sendBroadcast(intent, PERMISSION_RUST_1);\n        Log.d(TAG, \"[RustFisher-App1] Dispatcher \u53d1\u9001\u5e26\u6743\u9650\u7684\u6807\u51c6\u5e7f\u64ad\");\n    }\n\n    // \u53d1\u9001\u672c\u5730\u5e7f\u64ad\n    private void sendAppLocalBroadcast() {\n        Intent intent = new Intent(MSG_PHONE);\n        LocalBroadcastManager.getInstance(getApplicationContext()).sendBroadcast(intent);\n        Log.d(TAG, \"[RustFisher-App1] Dispatcher \u53d1\u9001\u672c\u5730\u5e7f\u64ad\");\n    }\n\n    private IntentFilter makeIF() {\n        IntentFilter intentFilter = new IntentFilter(MSG_PHONE);\n        intentFilter.addAction(Intent.ACTION_TIME_TICK);\n        intentFilter.addAction(Intent.ACTION_TIME_CHANGED);\n        return intentFilter;\n    }\n\n    // \u6807\u51c6\u63a5\u6536\u5668  \u7528context\u6765\u6ce8\u518c\n    private BroadcastReceiver mStandardReceiver1 = new BroadcastReceiver() {\n        @Override\n        public void onReceive(Context context, Intent intent) {\n            Log.d(TAG, \"[RustFisher-App1] \u6807\u51c6\u63a5\u6536\u56681 \u6536\u5230: \" + intent.getAction());\n        }\n    };\n\n    // \u6807\u51c6\u63a5\u6536\u5668  \u7528context\u6765\u6ce8\u518c\n    private BroadcastReceiver mStandardReceiver2 = new BroadcastReceiver() {\n        @Override\n        public void onReceive(Context context, Intent intent) {\n            Log.d(TAG, \"[RustFisher-App1] \u6807\u51c6\u63a5\u6536\u56682 \u6536\u5230: \" + intent.getAction());\n            if (intent.getAction().endsWith(MSG_PHONE)) {\n                abortBroadcast(); // \u622a\u65ad\u6709\u5e8f\u5e7f\u64ad\n                Log.d(TAG, \"[RustFisher-App1] \u6807\u51c6\u63a5\u6536\u56682\u622a\u65ad\u6709\u5e8f\u5e7f\u64ad \" + intent.getAction());\n            }\n        }\n    };\n\n    // \u6807\u51c6\u63a5\u6536\u5668  \u7528context\u6765\u6ce8\u518c\n    private BroadcastReceiver mStandardReceiver3 = new BroadcastReceiver() {\n        @Override\n        public void onReceive(Context context, Intent intent) {\n            Log.d(TAG, \"[RustFisher-App1] \u6807\u51c6\u63a5\u6536\u56683 \u6536\u5230: \" + intent.getAction());\n        }\n    };\n\n    // \u6ce8\u518c\u7684\u65f6\u5019\u7ed9\u5b83\u5e26\u6743\u9650  \u6807\u51c6\u63a5\u6536\u5668\n    private BroadcastReceiver mStandardReceiverWithPermission = new BroadcastReceiver() {\n        @Override\n        public void onReceive(Context context, Intent intent) {\n            Log.d(TAG, \"[RustFisher-App1] \u5e26\u6743\u9650\u7684\u6807\u51c6\u63a5\u6536\u5668\u6536\u5230: \" + intent.getAction());\n        }\n    };\n\n    /**\n     * \u7528LocalBroadcastManager\u6765\u6ce8\u518c\u6210\u4e3a\u672c\u5730\u63a5\u6536\u5668\n     * \u6536\u4e0d\u5230\u6807\u51c6\u5e7f\u64ad - \u4e0d\u8bba\u662f\u672capp\u53d1\u51fa\u7684\u8fd8\u662f\u522b\u7684\u5730\u65b9\u53d1\u51fa\u6765\u7684\n     */\n    private BroadcastReceiver mLocalReceiver1 = new BroadcastReceiver() {\n        @Override\n        public void onReceive(Context context, Intent intent) {\n            Log.d(TAG, \"[RustFisher-App1] \u672c\u5730\u63a5\u6536\u56681 \u6536\u5230: \" + intent.getAction());\n        }\n    };\n\n    private BroadcastReceiver mLocalReceiver2 = new BroadcastReceiver() {\n        @Override\n        public void onReceive(Context context, Intent intent) {\n            Log.d(TAG, \"[RustFisher-App1] \u672c\u5730\u63a5\u6536\u56682 \u6536\u5230: \" + intent.getAction());\n        }\n    };\n\n    private BroadcastReceiver mLocalReceiver3 = new BroadcastReceiver() {\n        @Override\n        public void onReceive(Context context, Intent intent) {\n            Log.d(TAG, \"[RustFisher-App1] \u672c\u5730\u63a5\u6536\u56683 \u6536\u5230: \" + intent.getAction());\n        }\n    };\n</code></pre></p> <p>\u63a5\u6536\u65b9App2\u4ee3\u7801 <pre><code>&lt;!-- \u81ea\u5b9a\u4e49\u7684\u6743\u9650  \u7ed9\u5e7f\u64ad\u7528 --&gt;\n&lt;permission android:name=\"com.rust.permission_rust_1\" /&gt;\n&lt;uses-permission android:name=\"com.rust.permission_rust_1\" /&gt;\n</code></pre></p> <pre><code>public static final String MSG_PHONE = \"msg_phone\";\n\n    // onCreate\u91cc\u6ce8\u518c\u63a5\u6536\u5668\n    registerReceiver(mDefaultReceiver, makeIF());\n    LocalBroadcastManager.getInstance(getApplicationContext())\n            .registerReceiver(mLocalReceiver, makeIF());\n\n    unregisterReceiver(mDefaultReceiver);\n    LocalBroadcastManager.getInstance(getApplicationContext())\n            .unregisterReceiver(mLocalReceiver);\n\n\n    private BroadcastReceiver mDefaultReceiver = new BroadcastReceiver() {\n        @Override\n        public void onReceive(Context context, Intent intent) {\n            Log.d(TAG, \"[App2] standard receive: \" + intent.getAction());\n        }\n    };\n\n    private BroadcastReceiver mLocalReceiver = new BroadcastReceiver() {\n        @Override\n        public void onReceive(Context context, Intent intent) {\n            Log.d(TAG, \"[App2] local receive: \" + intent.getAction());\n        }\n    };\n\n    private IntentFilter makeIF() {\n        IntentFilter intentFilter = new IntentFilter(MSG_PHONE);\n        intentFilter.addAction(Intent.ACTION_TIME_TICK);\n        intentFilter.addAction(Intent.ACTION_TIME_CHANGED);\n        return intentFilter;\n    }\n</code></pre> <p>\u4f7f\u7528<code>LocalBroadcastManager</code>\u53d1\u51fa\u7684\u672c\u5730\u5e7f\u64ad\uff0c\u53e6\u4e00\u4e2aApp\u662f\u63a5\u6536\u4e0d\u5230\u7684\u3002 \u8981\u6536\u5230\u672c\u5730\u5e7f\u64ad\uff0c\u540c\u6837\u9700\u8981<code>LocalBroadcastManager</code>\u6765\u6ce8\u518c\u63a5\u6536\u5668\u3002</p> <p>\u53ef\u4ee5\u628a\u672c\u5730\u5e7f\u64ad\u770b\u6210\u662f\u4e00\u4e2a\u5c40\u90e8\u7684\uff0cApp\u5185\u7684\u5e7f\u64ad\u4f53\u7cfb\u3002</p> <p>\u5b9e\u9a8c\u4e2d\u6211\u4eec\u6ce8\u610f\u5230\uff0c<code>Intent.ACTION_TIME_TICK</code>\u5e7f\u64ad\u662f\u53ef\u4ee5\u622a\u65ad\u7684\u3002</p>"},{"location":"android/broadcast/intro_use/#_10","title":"\u53c2\u8003","text":"<ul> <li>Activity\u7efc\u8ff0 https://an.rustfisher.com/android/activity/overview/</li> <li>Service\u4ecb\u7ecd https://an.rustfisher.com/android/service/service-intro/</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a </p>"},{"location":"android/broadcast/screen-on-broadcast/","title":"Android \u76d1\u542c\u5c4f\u5e55\u4eae\u706d","text":"<p>\u4f7f\u7528\u5e7f\u64ad\u76d1\u542c\u8bbe\u5907\u5c4f\u5e55\u4eae\u706d\u72b6\u6001\u3002\u8fd9\u4e2a\u662f\u7cfb\u7edf\u53d1\u51fa\u6765\u7684\u5e7f\u64ad\u3002</p> <p>\u4f7f\u7528\u7684<code>action</code>\u662f</p> <ul> <li><code>Intent.ACTION_SCREEN_ON</code>  \u4eae\u5c4f</li> <li><code>Intent.ACTION_SCREEN_OFF</code> \u706d\u5c4f</li> </ul> <pre><code>    private void registerScreenListener() {\n        IntentFilter filter = new IntentFilter();\n        filter.addAction(Intent.ACTION_SCREEN_ON);\n        filter.addAction(Intent.ACTION_SCREEN_OFF);\n        registerReceiver(mScreenReceiver, filter);\n    }\n\n    private BroadcastReceiver mScreenReceiver = new BroadcastReceiver() {\n        @Override\n        public void onReceive(Context context, Intent intent) {\n            final String action = intent.getAction();\n            if (Intent.ACTION_SCREEN_ON.equals(action)) {\n                // \u5c4f\u5e55\u4eae\n            } else if (Intent.ACTION_SCREEN_OFF.equals(action)) {\n                // \u5c4f\u5e55\u706d\n            }\n        }\n    };\n</code></pre>"},{"location":"android/concurrent/thread-pool-use-intro/","title":"Android\u7ebf\u7a0b\u6c60\u4f7f\u7528\u4ecb\u7ecd","text":"\u66f4\u65b0\u65e5\u671f: 2021-9-11 <ul> <li>2021-9-11 \u66f4\u65b0</li> <li>2021-9-10 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u672c\u6587\u4e3b\u8981\u4f7f\u7528kotlin\uff0c\u8ba8\u8bbaAndroid\u5f00\u53d1\u4e2d\u7684\u7ebf\u7a0b\u6c60\u7528\u6cd5\u3002</p> <p>\u6211\u4eec\u60f3\u4f7f\u7528\u7ebf\u7a0b\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u76f4\u63a5\u521b\u5efa\u5b50\u7ebf\u7a0b\u5e76\u542f\u52a8 <pre><code>Thread { Log.d(\"rfDev\", \"rustfisher said: hello\") }.start()\n</code></pre></p> <p></p> \u4e0d\u60f3\u6bcf\u6b21\u90fd\u521b\u5efa\u65b0\u7684\u5b50\u7ebf\u7a0b <p>\u5982\u679c\u6709\u5927\u91cf\u7684\u5f02\u6b65\u4efb\u52a1\uff0c\u4e0d\u60f3\u6bcf\u6b21\u90fd\u521b\u5efa\u5b50\u7ebf\u7a0b\u3002\u6709\u6ca1\u6709\u4ec0\u4e48\u628a\u5b50\u7ebf\u7a0b\u7edf\u4e00\u7ba1\u7406\u7684\u65b9\u6cd5\uff1f</p> <p>\u9047\u5230\u8fd9\u6837\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u7ebf\u7a0b\u6c60\u3002\u7ebf\u7a0b\u6c60\u89e3\u51b3\u4e24\u4e2a\u95ee\u9898\uff1a\u9700\u8981\u6267\u884c\u5927\u91cf\u5f02\u6b65\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u51cf\u8f7b\u6bcf\u4e2a\u5f02\u6b65\u4efb\u52a1\u7684\u8c03\u7528\u5f00\u9500\uff0c\u63d0\u9ad8\u6027\u80fd\u3002\u53e6\u5916\u5b83\u8fd8\u80fd\u591f\u9650\u5236\u548c\u7ba1\u7406\u5b50\u7ebf\u7a0b\u3002\u6bcf\u4e2aThreadPoolExecutor\u90fd\u7ef4\u62a4\u4e86\u4e00\u4e9b\u7edf\u8ba1\u6570\u636e\uff0c\u4f8b\u5982\u5df2\u6267\u884c\u7684\u4efb\u52a1\u6570\u91cf\u3002</p> <p>\u6709\u5927\u91cf\u5f02\u6b65\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u7ebf\u7a0b\u6c60\u3002</p>"},{"location":"android/concurrent/thread-pool-use-intro/#_1","title":"\u9884\u7f6e\u7ebf\u7a0b\u6c60","text":"<p>Android API 29</p> <p>\u4ee3\u7801\u53c2\u8003 Android API 29</p> <p>ThreadPoolExecutor\u63d0\u4f9b\u4e86\u5f88\u591a\u53c2\u6570\uff0c\u65b9\u4fbf\u5f00\u53d1\u8005\u8c03\u63a7\u3002\u7ebf\u7a0b\u6c60\u7684\u8bbe\u8ba1\u8005\u5efa\u8bae\u5f00\u53d1\u8005\u4f7f\u7528\u4ee5\u4e0b\u51e0\u4e2a\u5de5\u5382\u65b9\u6cd5\uff0cAndroid\u4e2d\u4e3b\u8981\u67095\u79cd</p> <ul> <li><code>newCachedThreadPool()</code> \u4e0d\u9650\u5236\u6570\u91cf\u7684\u7ebf\u7a0b\u6c60\uff0c\u80fd\u81ea\u52a8\u56de\u6536\u7ebf\u7a0b</li> <li><code>newFixedThreadPool(int nThreads)</code> \u56fa\u5b9a\u6570\u91cf\u7684\u7ebf\u7a0b\u6c60</li> <li><code>newSingleThreadExecutor()</code> \u5355\u4e00\u7684\u5b50\u7ebf\u7a0b</li> <li><code>newScheduledThreadPool(int corePoolSize)</code> \u80fd\u6267\u884c\u5ef6\u65f6\u4efb\u52a1\u6216\u8005\u5468\u671f\u6027\u4efb\u52a1</li> <li><code>newWorkStealingPool()</code> \u5de5\u4f5c\u7a83\u53d6\u7ebf\u7a0b\u6c60</li> </ul> <p>\u5b9e\u9645\u4e0a\u6211\u4eec\u5728Android Studio\u91cc\u8f93\u5165<code>Executors.new</code>\u7684\u65f6\u5019\uff0c\u4f1a\u8df3\u51fa\u5f88\u591a\u4e2a\u63d0\u793a\u9009\u9879\u3002</p> Executors.new \u7684\u667a\u80fd\u63d0\u793a <p></p>"},{"location":"android/concurrent/thread-pool-use-intro/#_2","title":"\u53ef\u7f13\u5b58\u7ebf\u7a0b\u6c60","text":"<p>\u7528<code>Executors.newCachedThreadPool</code>\u83b7\u5f97\u4e00\u4e2a\u53ef\u7f13\u5b58\u7ebf\u7a0b\u6c60\u5bf9\u8c61\uff0c\u7136\u540e\u8ba9\u5b83\u6267\u884c\u4efb\u52a1\u3002 <pre><code>val tp: ExecutorService = Executors.newCachedThreadPool()\ntp.submit { Log.d(TAG, \"rustfisher: cached\u7ebf\u7a0b\u6c60\u6267\u884c\u4efb\u52a1 3\") }\n</code></pre></p> <p>\u53ef\u7f13\u5b58\u7ebf\u7a0b\u6c60\u4f1a\u5728\u9700\u8981\u7684\u65f6\u5019\u521b\u5efa\u65b0\u7684\u5b50\u7ebf\u7a0b\u3002\u5f53\u539f\u6709\u7684\u7ebf\u7a0b\u53ef\u7528\u7684\u65f6\u5019\uff0c\u4f1a\u590d\u7528\u73b0\u6709\u7ebf\u7a0b\u3002 \u8fd9\u4e2a\u673a\u5236\u9002\u7528\u4e8e\u6267\u884c\u591a\u4e2a\u77ed\u671f\u5f02\u6b65\u4efb\u52a1\u3002\u4efb\u52a1\u6bd4\u8f83\u5c0f\uff0c\u4f46\u662f\u6570\u91cf\u5927\u3002</p> <p>\u8c03\u7528<code>execute</code>\u65b9\u6cd5\u4f1a\u5148\u5c1d\u8bd5\u590d\u7528\u5df2\u6709\u7684\u53ef\u7528\u7ebf\u7a0b\u3002\u5982\u679c\u5f53\u524d\u6ca1\u6709\u7ebf\u7a0b\uff0c\u4f1a\u65b0\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u5e76\u628a\u5b83\u6dfb\u52a0\u5230\u6c60\u91cc\u3002 \u8d85\u8fc760\u79d2\u6ca1\u6709\u4f7f\u7528\u7684\u7ebf\u7a0b\u4f1a\u88ab\u505c\u6b62\u5e76\u79fb\u9664\u3002\u56e0\u6b64\u5373\u4fbf\u957f\u65f6\u95f4\u4e0d\u7528\u8fd9\u4e2a\u7ebf\u7a0b\u6c60\uff0c\u4e5f\u4e0d\u4f1a\u9020\u6210\u591a\u5927\u7684\u5f00\u9500\u3002</p>"},{"location":"android/concurrent/thread-pool-use-intro/#_3","title":"\u5b9a\u957f\u7ebf\u7a0b\u6c60","text":"<p>\u4f7f\u7528<code>newFixedThreadPool(int nThreads)</code>\u793a\u4f8b <pre><code>val fixedTp: ExecutorService = Executors.newFixedThreadPool(4)\nfixedTp.submit { Log.d(TAG, \"rustfisher \u5b9a\u957f\u7ebf\u7a0b\u6c60\u6267\u884c\u4efb\u52a1\") }\n</code></pre></p> <p>\u9759\u6001\u65b9\u6cd5\u91cc\u4f20\u5165\u4e86\u4e00\u4e2aint\u53c2\u6570<code>nThreads</code>\uff0c\u8868\u793a\u6700\u5927\u7ebf\u7a0b\u6570\u91cf\u3002 \u5982\u679c\u5f53\u524d\u6240\u6709\u7ebf\u7a0b\u90fd\u5728\u5fd9\uff0c\u53c8\u6709\u65b0\u7684\u4efb\u52a1\u6dfb\u52a0\u8fdb\u6765\u3002\u90a3\u4e48\u4efb\u52a1\u4f1a\u5728\u961f\u5217\u4e2d\u7b49\u5f85\uff0c\u76f4\u5230\u6709\u53ef\u7528\u7684\u7ebf\u7a0b\u6765\u5904\u7406\u4efb\u52a1\u3002</p> <p>\u5982\u679c\u6709\u7684\u7ebf\u7a0b\u9047\u5230\u9519\u8bef\u800c\u505c\u6b62\u4e86\uff0c\u8981\u6267\u884c\u4efb\u52a1\u7684\u8bdd\uff0c\u4f1a\u521b\u5efa\u65b0\u7684\u7ebf\u7a0b\u8865\u4e0a\u4f4d\u7f6e\u3002</p> <p>\u6c60\u91cc\u7684\u7ebf\u7a0b\u4f1a\u4e00\u76f4\u5b58\u6d3b\uff0c\u76f4\u5230\u7ebf\u7a0b\u6c60\u505c\u6b62\uff08<code>ExecutorService#shutdown</code>\uff09\u3002</p>"},{"location":"android/concurrent/thread-pool-use-intro/#_4","title":"\u5355\u4e00\u7ebf\u7a0b\u6c60","text":"<pre><code>val singleTp: ExecutorService = Executors.newSingleThreadExecutor()\nsingleTp.submit { Log.d(TAG, \"\u5355\u4e00\u7ebf\u7a0b\u6c60\u6267\u884c\u4efb\u52a1\") }\n</code></pre> <p>\u53ea\u62e5\u67091\u4e2a\u5b50\u7ebf\u7a0b\u3002\u4efb\u52a1\u961f\u5217\u4e0d\u9650\u5236\u4efb\u52a1\u6570\u91cf\u3002\u5982\u679c\u7ebf\u7a0b\u9047\u5230\u95ee\u9898\u505c\u6b62\u4e86\uff0c\u63a5\u4e0b\u6765\u53c8\u8981\u5904\u7406\u4efb\u52a1\u65f6\uff0c\u4f1a\u65b0\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u6765\u5904\u7406\u3002</p> <p>\u5b83\u80fd\u4fdd\u8bc1\u4efb\u52a1\u4f1a\u6309\u987a\u5e8f\u5904\u7406\uff0c\u540c\u4e00\u65f6\u95f4\u53ea\u80fd\u5904\u74061\u4e2a\u4efb\u52a1\u3002</p> <p>\u5355\u4e00\u7ebf\u7a0b\u6c60\u521b\u5efa\u540e\uff0c\u4e0d\u80fd\u52a8\u6001\u4fee\u6539\u7ebf\u7a0b\u6570\u91cf\u3002\u4e0d\u50cf<code>newFixedThreadPool(1)</code>\u7684\u5b9a\u957f\u7ebf\u7a0b\u6c60\u53ef\u4ee5\u4fee\u6539\u7ebf\u7a0b\u6570\u3002</p>"},{"location":"android/concurrent/thread-pool-use-intro/#_5","title":"\u8ba1\u5212\u4efb\u52a1\u7ebf\u7a0b\u6c60","text":"<p><pre><code>val scheduleTp: ScheduledExecutorService = Executors.newScheduledThreadPool(3)\n</code></pre> \u8ba1\u5212\u4efb\u52a1\u7ebf\u7a0b\u6c60\u80fd\u591f\u6267\u884c\u5ef6\u8fdf\u4efb\u52a1\u548c\u5468\u671f\u4efb\u52a1\u3002</p>"},{"location":"android/concurrent/thread-pool-use-intro/#_6","title":"\u5ef6\u8fdf\u4efb\u52a1","text":"<p>\u9700\u8981\u8bbe\u5b9a\u5ef6\u65f6\u4e0e\u65f6\u95f4\u5355\u4f4d <pre><code>scheduleTp.schedule({ Log.d(TAG, \"\u8ba1\u5212\u4efb\u52a11 runnable\") }, 300, TimeUnit.MILLISECONDS)\nscheduleTp.schedule(Callable { Log.d(TAG, \"\u8ba1\u5212\u4efb\u52a12 callable\") }, 400, TimeUnit.MILLISECONDS)\n</code></pre></p>"},{"location":"android/concurrent/thread-pool-use-intro/#_7","title":"\u5468\u671f\u4efb\u52a1","text":"<p>\u4e3b\u8981\u6d89\u53ca\u52302\u4e2a\u65b9\u6cd5<code>scheduleAtFixedRate</code>\u548c<code>scheduleWithFixedDelay</code>\u3002</p> <p>\u5047\u8bbe\u4efb\u52a1\u65f6\u95f4\u5c0f\u4e8e\u5468\u671f\u65f6\u95f4\uff0c\u5219\u6309\u7ed9\u5b9a\u5468\u671f\u65f6\u95f4\u6765\u8fdb\u884c\u3002\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u8868\u73b0\u4e00\u81f4\u3002</p> <p>\u5047\u8bbe\u4efb\u52a1\u6267\u884c\u65f6\u95f4\u5927\u4e8e\u5468\u671f\u65f6\u95f4\uff0c\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u6709\u70b9\u4e0d\u540c</p> <ul> <li><code>scheduleAtFixedRate</code>\u6267\u884c\u5b8c\u4e0a\u4e00\u4e2a\u4efb\u52a1\u540e\uff0c\u7528\u65f6\u8d85\u8fc7\u4e86\u5468\u671f\u65f6\u95f4\uff0c\u4f1a\u7acb\u523b\u6267\u884c\u4e0b\u4e00\u4e2a\u4efb\u52a1\u3002</li> <li><code>scheduleWithFixedDelay</code>\u5728\u4e0a\u4e00\u4e2a\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u8fd8\u4f1a\u7b49\u5f85\u5468\u671f\u65f6\u95f4\uff0c\u518d\u53bb\u6267\u884c\u4e0b\u4e00\u4e2a\u4efb\u52a1\u3002</li> </ul>"},{"location":"android/concurrent/thread-pool-use-intro/#_8","title":"\u5de5\u4f5c\u7a83\u53d6\u7ebf\u7a0b\u6c60","text":"<p>Android SDK \u5927\u4e8e\u7b49\u4e8e24\uff0c\u6709\u4e00\u79cd\u65b0\u7684\u7ebf\u7a0b\u6c60\uff0c\u6682\u4e14\u79f0\u4e3a\u201c\u5de5\u4f5c\u7a83\u53d6\u7ebf\u7a0b\u6c60\u201d\uff0c\u6216\u8005\u53eb\u201c\u7075\u6d3b\u8c03\u5ea6\u7ebf\u7a0b\u6c60\u201d\u3002 <pre><code>if (android.os.Build.VERSION.SDK_INT &gt;= android.os.Build.VERSION_CODES.N) {\n    Executors.newWorkStealingPool()\n}\n</code></pre> \u7ebf\u7a0b\u6c60\u7ef4\u62a4\u8db3\u591f\u7684\u7ebf\u7a0b\u6765\u652f\u6301\u7ed9\u5b9a\u7684\u5e76\u884c\u5ea6\uff08parallelism level\uff09\uff0c\u53ef\u80fd\u4f1a\u7528\u591a\u4e2a\u961f\u5217\u6765\u51cf\u5c11\u4e89\u7528\u3002 \u5e76\u884c\u5ea6\u5bf9\u5e94\u7684\u662f\u6d3b\u8dc3\u7684\u7ebf\u7a0b\u6700\u5927\u6570\uff0c\u6216\u8005\u80fd\u5904\u7406\u4efb\u52a1\u7684\u7ebf\u7a0b\u6700\u5927\u6570\u3002</p> <p>\u7ebf\u7a0b\u7684\u5b9e\u9645\u6570\u91cf\u53ef\u80fd\u4f1a\u52a8\u6001\u589e\u51cf\u3002\u5de5\u4f5c\u7a83\u53d6\u7ebf\u7a0b\u6c60\u4e0d\u4fdd\u8bc1\u6309\u63d0\u4ea4\u987a\u5e8f\u6765\u5904\u7406\u4efb\u52a1\u3002</p>"},{"location":"android/concurrent/thread-pool-use-intro/#_9","title":"\u6267\u884c\u4efb\u52a1","text":"<p>\u6267\u884c\u4efb\u52a1\u7684\u65f6\u5019\u53ef\u4ee5\u4f20\u5165Runnable\u548cCallable\uff0c\u524d\u9762\u7528\u7684\u90fd\u662fRunnable\u3002</p> <p>\u7528Callable\u7684\u4f8b\u5b50 <pre><code>tp.submit(Callable { \"OK\" })\n</code></pre></p>"},{"location":"android/concurrent/thread-pool-use-intro/#_10","title":"\u65e0\u8fd4\u56de\u503c\u4efb\u52a1\u7684\u8c03\u7528","text":"<p>\u65e0\u8fd4\u56de\u503c\u4efb\u52a1\u7528Callable\u548cRunnable\u90fd\u884c\u3002</p> <pre><code>val tp: ExecutorService = Executors.newCachedThreadPool()\ntp.submit { Log.d(TAG, \"rustfisher: cached\u7ebf\u7a0b\u6c60submit runnable\") }\ntp.execute { Log.d(TAG, \"rustfisher: cached\u7ebf\u7a0b\u6c60execute runnable\") }\ntp.submit(Callable { Log.d(TAG, \"rustfisher: cached\u7ebf\u7a0b\u6c60submit callable\") })\n\ntp.shutdown() // \u6700\u540e\u8bb0\u5f97\u7528\u5b8c\u540e\u505c\u6389\u7ebf\u7a0b\u6c60\n</code></pre>"},{"location":"android/concurrent/thread-pool-use-intro/#_11","title":"\u6709\u8fd4\u56de\u503c\u4efb\u52a1\u7684\u8c03\u7528","text":"<p>\u6709\u8fd4\u56de\u503c\u7684\u4efb\u52a1\u9700\u8981Callable\u63a5\u53e3\u3002</p>"},{"location":"android/concurrent/thread-pool-use-intro/#submit","title":"submit","text":"<p>\u8c03\u7528<code>submit</code>\u65b9\u6cd5\u65f6\u4f1a\u8fd4\u56de\u4e00\u4e2aFuture\u5bf9\u8c61\u3002\u901a\u8fc7Future\u7684<code>get()</code>\u65b9\u6cd5\u53ef\u62ff\u5230\u8fd4\u56de\u503c\u3002\u8fd9\u91cc\u9700\u8981\u6ce8\u610f<code>get()</code>\u662f\u963b\u585e\u7684\uff0c\u5b8c\u6210\u4efb\u52a1\u540e\uff0c\u80fd\u62ff\u5230\u8fd4\u56de\u503c\u3002</p> <pre><code>val tp: ExecutorService = Executors.newCachedThreadPool()\nval future = tp.submit(Callable {\n    return@Callable \"callable\u7684\u8fd4\u56de\u503c\"\n})\nLog.d(TAG, \"future get\u4e4b\u524d isDone: ${future.isDone}, isCancelled: ${future.isCancelled}\")\nval res = future.get()\nLog.d(TAG, \"future get\u4e4b\u540e isDone: ${future.isDone}, isCancelled: ${future.isCancelled}\")\nLog.d(TAG, \"future get: $res\")\n</code></pre> <p>\u8fd0\u884clog <pre><code>future get\u4e4b\u524d isDone: false, isCancelled: false\nfuture get\u4e4b\u540e isDone: true, isCancelled: false\nfuture get: callable\u7684\u8fd4\u56de\u503c\n</code></pre></p>"},{"location":"android/concurrent/thread-pool-use-intro/#invokeall","title":"invokeAll","text":"<p>\u5bf9\u4e8e\u5217\u8868\u91cc\u7684\u4efb\u52a1\uff0c\u53ef\u4ee5\u4f7f\u7528<code>invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</code>\uff0c\u8fd4\u56de\u4e00\u4e2aFuture\u7684\u5217\u8868\u3002 \u4f5c\u4e3a\u5bf9\u6bd4\uff0c\u7ed9\u5176\u4e2d\u4e00\u4e2a\u4efb\u52a1\u52a0\u4e0a\u5ef6\u65f6\u3002</p> invokeAll\u793a\u4f8b <pre><code>val tp: ExecutorService = Executors.newFixedThreadPool(5)\nval callList = arrayListOf&lt;Callable&lt;String&gt;&gt;(\n        Callable {\n            Log.d(TAG, \"task1 ${Thread.currentThread()}\")\n            return@Callable \"rust\"\n        },\n        Callable {\n            Log.d(TAG, \"task2 ${Thread.currentThread()}\")\n            Thread.sleep(1500) // \u52a0\u4e0a\u5ef6\u65f6\n            return@Callable \"fisher\"\n        },\n        Callable {\n            Log.d(TAG, \"task3 ${Thread.currentThread()}\")\n            return@Callable \"\u5217\u8868\u91cc\u9762\u7684\u4efb\u52a1\"\n        },\n)\nLog.d(TAG, \"invokeAll \u51c6\u5907\u63d0\u4ea4\u4efb\u52a1\")\nval futureList = tp.invokeAll(callList)\nLog.d(TAG, \"invokeAll \u5df2\u63d0\u4ea4\u4efb\u52a1\")\nfutureList.forEach { f -&gt;\n    Log.d(TAG, \"\u4efb\u52a1\u5217\u8868\u6267\u884c\u7ed3\u679c ${f.get()}\") // \u8fd9\u91cc\u4f1a\u963b\u585e \u522b\u5728ui\u7ebf\u7a0b\u91ccget\n}\n</code></pre> <p>\u8fd0\u884clog\uff0c\u53ef\u4ee5\u770b\u5230\u63d0\u4ea4\u4efb\u52a1\u540e\uff0c\u7ecf\u8fc7\u5ef6\u65f6\uff0c\u62ff\u5230\u4e86\u8fd0\u884c\u7ed3\u679c\u3002\u6ce8\u610f\u770b<code>invokeAll</code>\u524d\u540e\u7684\u65f6\u95f4\u3002<code>invokeAll</code>\u4f1a\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\u3002\u4f7f\u7528\u7684\u65f6\u5019\u5fc5\u987b\u5c0f\u5fc3\uff0c\u4e0d\u8981\u5728ui\u7ebf\u7a0b\u4e2d\u8c03\u7528\u3002 <pre><code>2021-09-11 14:40:07.062 16914-16914/com.rustfisher.tutorial2020 D/rfDevTp: invokeAll \u51c6\u5907\u63d0\u4ea4\u4efb\u52a1\n2021-09-11 14:40:07.063 16914-19230/com.rustfisher.tutorial2020 D/rfDevTp: task1 Thread[pool-4-thread-1,5,main]\n2021-09-11 14:40:07.063 16914-19231/com.rustfisher.tutorial2020 D/rfDevTp: task2 Thread[pool-4-thread-2,5,main]\n2021-09-11 14:40:07.063 16914-19232/com.rustfisher.tutorial2020 D/rfDevTp: task3 Thread[pool-4-thread-3,5,main]\n2021-09-11 14:40:08.563 16914-16914/com.rustfisher.tutorial2020 D/rfDevTp: invokeAll \u5df2\u63d0\u4ea4\u4efb\u52a1\n2021-09-11 14:40:08.563 16914-16914/com.rustfisher.tutorial2020 D/rfDevTp: \u4efb\u52a1\u5217\u8868\u6267\u884c\u7ed3\u679c rust\n2021-09-11 14:40:08.563 16914-16914/com.rustfisher.tutorial2020 D/rfDevTp: \u4efb\u52a1\u5217\u8868\u6267\u884c\u7ed3\u679c fisher\n2021-09-11 14:40:08.563 16914-16914/com.rustfisher.tutorial2020 D/rfDevTp: \u4efb\u52a1\u5217\u8868\u6267\u884c\u7ed3\u679c \u5217\u8868\u91cc\u9762\u7684\u4efb\u52a1\n</code></pre> \u63d0\u4ea4\u4e863\u4e2a\u4efb\u52a1\uff0c\u57283\u4e2a\u4e0d\u540c\u7684\u5b50\u7ebf\u7a0b\u4e2d\u6267\u884c\u3002</p>"},{"location":"android/concurrent/thread-pool-use-intro/#invokeany","title":"invokeAny","text":"<p><code>invokeAny(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</code>\u4e5f\u662f\u63a5\u6536Callable\u96c6\u5408\u3002 \u7136\u540e\u8fd4\u56de\u6700\u5148\u6267\u884c\u7ed3\u675f\u7684\u4efb\u52a1\u7684\u503c\uff0c\u5176\u5b83\u672a\u5b8c\u6210\u7684\u4efb\u52a1\u5c06\u88ab\u6b63\u5e38\u53d6\u6d88\u6389\u4e0d\u4f1a\u6709\u5f02\u5e38\u3002</p> invokeAny\u793a\u4f8b <pre><code>val tp: ExecutorService = Executors.newCachedThreadPool()\nval callList = arrayListOf&lt;Callable&lt;String&gt;&gt;(\n        Callable {\n            Thread.sleep(1000) // \u8bbe\u8ba1\u5ef6\u65f6\n            return@Callable \"rust\"\n        },\n        Callable {\n            Thread.sleep(400)\n            return@Callable \"fisher\"\n        },\n        Callable {\n            Thread.sleep(2000)\n            return@Callable \"\u5217\u8868\u91cc\u9762\u7684\u4efb\u52a1\"\n        },\n)\nLog.d(TAG, \"invokeAny \u63d0\u4ea4\u4efb\u52a1\")\nval res = tp.invokeAny(callList)\nLog.d(TAG, \"\u6267\u884c\u7ed3\u679c $res\")\n</code></pre> <pre><code>2021-09-11 14:04:55.253 14066-14066/com.rustfisher.tutorial2020 D/rfDevTp: invokeAny \u63d0\u4ea4\u4efb\u52a1\n2021-09-11 14:04:55.654 14066-14066/com.rustfisher.tutorial2020 D/rfDevTp: \u6267\u884c\u7ed3\u679c fisher\n</code></pre> <p>\u89c2\u5bdflog\u53ef\u4ee5\u770b\u5230\uff0c\u6700\u540e\u6267\u884c\u7684\u662f\u201cfisher\u201d\u8fd9\u4e2a\u4efb\u52a1\u3002</p>"},{"location":"android/concurrent/thread-pool-use-intro/#_12","title":"\u505c\u6b62\u7ebf\u7a0b\u6c60","text":"<p>\u4f7f\u7528\u5b8c\u6bd5\u540e\uff0c\u8bb0\u5f97\u7ec8\u6b62\u7ebf\u7a0b\u6c60 <pre><code>/*ExecutorService*/ shutdown()\nshutdownNow()\n</code></pre></p> <p><code>shutdown()</code>\u5728\u5df2\u63d0\u4ea4\u7684\u4efb\u52a1\u540e\u9762\u521b\u5efa\u4e00\u4e2a\u505c\u6b62\u547d\u4ee4\uff0c\u5e76\u4e14\u4e0d\u518d\u63a5\u53d7\u65b0\u7684\u4efb\u52a1\u3002\u5982\u679c\u7ebf\u7a0b\u6c60\u5df2\u7ecf\u505c\u6b62\u4e86\uff0c\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u5c06\u4e0d\u751f\u6548\u3002</p> <p><code>shutdownNow()</code>\u65b9\u6cd5\u5c1d\u8bd5\u505c\u6b62\u6240\u6709\u6267\u884c\u4e2d\u7684\u4efb\u52a1\uff0c\u505c\u4e0b\u7b49\u5f85\u4e2d\u7684\u4efb\u52a1\u3002\u5e76\u4e14\u8fd4\u56de\u7b49\u5f85\u6267\u884c\u7684\u4efb\u52a1\u5217\u8868<code>List&lt;Runnable&gt;</code>\u3002</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u534e\u4e3a\u4e91\u793e\u533a \u6398\u91d1</p>"},{"location":"android/connectivity/bluetooth/Bluetooth2_use_sample/","title":"Android Bluetooth \u84dd\u72592.0\u4f7f\u7528\u65b9\u5f0f","text":"2023-03-27 \u66f4\u65b0\u6587\u6863 <ul> <li>2023-03-27 \u66f4\u65b0\u6587\u6863</li> </ul> <p>\u4ee3\u7801\u57fa\u4e8e Android L</p> <p>\u83b7\u53d6BluetoothAdapter\uff0c\u641c\u7d22\u84dd\u7259\u8bbe\u5907\uff0c\u53d1\u8d77socket\u8fde\u63a5\uff0c\u4ece\u5916\u56f4\u84dd\u7259\u8bbe\u5907\u4e2d\u83b7\u53d6\u5230\u6570\u636e\u3002</p>"},{"location":"android/connectivity/bluetooth/Bluetooth2_use_sample/#_1","title":"\u5e38\u7528\u7c7b\u8bf4\u660e","text":""},{"location":"android/connectivity/bluetooth/Bluetooth2_use_sample/#bluetoothadapter","title":"BluetoothAdapter","text":"<p>\u9996\u5148\u8c03\u7528\u9759\u6001\u65b9\u6cd5getDefaultAdapter()\u83b7\u53d6\u84dd\u7259\u9002\u914d\u5668bluetoothadapter\uff0c \u5982\u679c\u8fd4\u56de\u4e3a\u7a7a\uff0c\u5219\u8868\u660e\u6b64\u8bbe\u5907\u4e0d\u652f\u6301\u84dd\u7259\u3002</p> <p>\u4ee3\u8868\u672c\u5730\u84dd\u7259\u9002\u914d\u5668\u3002BluetoothAdapter \u8ba9\u4f60\u8fdb\u884c\u57fa\u7840\u7684\u84dd\u7259\u64cd\u4f5c\uff0c\u6bd4\u5982\u521d\u59cb\u5316\u641c\u7d22\u8bbe\u5907\uff0c\u5bf9\u5df2\u914d\u5bf9\u8bbe\u5907\u8fdb\u884c\u68c0\u7d22\uff0c\u6839\u636e\u4e00\u76f4MAC\u5730\u5740 \u5b9e\u4f8b\u5316\u4e00\u4e2a BluetoothDevice\uff0c\u5efa\u7acb\u4e00\u4e2a\u76d1\u542c\u5176\u4ed6\u8bbe\u5907\u8fde\u63a5\u8bf7\u6c42\u7684 BluetoothServerSocket\uff0c\u542f\u52a8\u5bf9\u84dd\u7259LE\u8bbe\u5907\u7684\u641c\u7d22\u3002</p> <p>\u8fd9\u662f\u4f7f\u7528\u84dd\u7259\u7684\u8d77\u70b9\u3002\u83b7\u5f97\u4e86\u672c\u5730\u9002\u914d\u5668\u540e\uff0c\u53ef\u4ee5\u8c03\u7528<code>getBondedDevices()</code>\u83b7\u5f97\u4ee3\u8868\u914d\u5bf9\u8bbe\u5907\u7684 BluetoothDevice \u5bf9\u8c61 <code>startDiscovery()</code>\u542f\u52a8\u641c\u7d22\u84dd\u7259\u8bbe\u5907\u3002\u6216\u8005\u5efa\u7acb\u4e00\u4e2aBluetoothServerSocket \uff0c \u8c03\u7528<code>listenUsingRfcommWithServiceRecord(String, UUID)</code>\u6765\u76d1\u542c\u63a5\u5165\u8bf7\u6c42 <code>startLeScan(LeScanCallback)</code> \u641c\u7d22Bluetooth LE \u8bbe\u5907</p> <p>\u76f8\u5e94\u7684\u6e90\u7801 BluetoothAdapter.java (frameworks/base/core/java/android/bluetooth) <pre><code>    /**\n     * Get a handle to the default local Bluetooth adapter.\n     * &lt;p&gt;Currently Android only supports one Bluetooth adapter, but the API\n     * could be extended to support more. This will always return the default\n     * adapter.\n     * @return the default local adapter, or null if Bluetooth is not supported\n     *         on this hardware platform\n     */\n    public static synchronized BluetoothAdapter getDefaultAdapter() {\n        if (sAdapter == null) {\n            IBinder b = ServiceManager.getService(BLUETOOTH_MANAGER_SERVICE);\n            if (b != null) {\n                IBluetoothManager managerService = IBluetoothManager.Stub.asInterface(b);\n                sAdapter = new BluetoothAdapter(managerService);\n            } else {\n                Log.e(TAG, \"Bluetooth binder is null\");\n            }\n        }\n        return sAdapter;\n    }\n</code></pre></p>"},{"location":"android/connectivity/bluetooth/Bluetooth2_use_sample/#bluetoothsocket","title":"BluetoothSocket","text":"<p>\u4e00\u4e2a\u8fde\u63a5\u4e0a\u6216\u8fde\u63a5\u4e2d\u7684socket \u4f7f\u7528BluetoothServerSocket\u6765\u521b\u5efa\u4e00\u4e2a\u76d1\u542c\u7684\u670d\u52a1socket\u3002 \u5bf9\u4e8e\u670d\u52a1\u7aef\uff0c\u5f53BluetoothServerSocket\u63a5\u6536\u4e86\u4e00\u4e2a\u8fde\u63a5\uff0c\u4f1a\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684BluetoothSocket\u6765\u7ba1\u7406\u8fd9\u4e2a\u8fde\u63a5\u3002 \u5bf9\u4e8e\u5ba2\u6237\u7aef\uff0c\u4f7f\u7528\u4e00\u4e2a\u5355\u72ec\u7684BluetoothSocket\u6765\u521d\u59cb\u5316\u4e00\u4e2a\u53d1\u9001\u8fde\u63a5\u5e76\u7ba1\u7406\u8fd9\u4e2a\u8fde\u63a5\u3002 \u84dd\u7259socket\u6700\u666e\u901a\u7684\u6a21\u5f0f\u662fRFCOMM\uff0c\u8fd9\u662fAndroid API\u652f\u6301\u7684\u6a21\u5f0f\u3002 RFCOMM\u9762\u5411\u8fde\u63a5\uff0c\u4f7f\u7528\u6d41\u4f20\u8f93\u3002\u4e5f\u79f0\u4e3aSerial Port Profile (SPP)</p> <p>\u5efa\u7acb\u4e00\u4e2a\u5230\u5df2\u77e5\u84dd\u7259\u8bbe\u5907\u7684BluetoothSocket\uff0c\u4f7f\u7528<code>BluetoothDevice.createRfcommSocketToServiceRecord()</code> \u7136\u540e\u8c03\u7528<code>connect()</code>\u6765\u8fde\u63a5\u8fd9\u4e2a\u8fdc\u7a0b\u8bbe\u5907\u3002\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u963b\u585e\u7a0b\u5e8f\u76f4\u5230\u5efa\u7acb\u8fde\u63a5\u6216\u8005\u8fde\u63a5\u5931\u8d25\u3002 \u4e00\u65e6socket\u8fde\u63a5\u4e0a\uff0c\u4e0d\u8bba\u521d\u59cb\u5316\u4e3a\u5ba2\u6237\u7aef\u6216\u8005\u670d\u52a1\u7aef\uff0c\u8c03\u7528<code>getInputStream()</code>\u548c<code>getOutputStream()</code>\u6253\u5f00IO\u6d41\u6765\u5206\u522b\u63a5\u6536 \u8f93\u5165\u6d41\u548c\u8f93\u51fa\u6d41\u5bf9\u8c61\u3002\u6d41\u5bf9\u8c61\u81ea\u52a8\u8fde\u63a5\u5230socket</p> <p>BluetoothSocket\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002\u7279\u522b\u7684\u662f\uff0c<code>close()</code>\u4f1a\u7acb\u523b\u5173\u95ed\u8fdb\u884c\u4e2d\u7684\u64cd\u4f5c\u5e76\u5173\u95edsocket\u3002</p> <p>\u9700\u8981 BLUETOOTH \u76f8\u5173\u6743\u9650</p>"},{"location":"android/connectivity/bluetooth/Bluetooth2_use_sample/#bluetoothserversocket","title":"BluetoothServerSocket","text":"<p>\u4e00\u4e2a\u76d1\u542c\u7684\u84dd\u7259socket \u5728\u670d\u52a1\u7aef\uff0c\u4f7f\u7528BluetoothServerSocket\u6765\u5efa\u7acb\u4e00\u4e2a\u76d1\u542c\u7684\u670d\u52a1socket\u3002</p> <p>\u4f7f\u7528<code>BluetoothAdapter.listenUsingRfcommWithServiceRecord()</code>\u6765\u5efa\u7acb\u4e00\u4e2a\u76d1\u542c\u63a5\u5165\u8fde\u63a5\u7684BluetoothServerSocket \u7136\u540e\u8c03\u7528<code>accept()</code>\u76d1\u542c\u8fde\u63a5\u8bf7\u6c42\u3002\u8fd9\u4e2a\u8c03\u7528\u4f1a\u963b\u585e\uff0c\u76f4\u5230\u5efa\u7acb\u8fde\u63a5\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a\u7ba1\u7406\u8fde\u63a5\u7684BluetoothSocket \u83b7\u5f97\u4e86 BluetoothSocket\uff0c\u5e76\u4e14\u4e0d\u518d\u9700\u8981\u8fde\u63a5\uff0c\u53ef\u4ee5\u8c03\u7528<code>close()</code>\u6765\u5173\u95ed\u6389 BluetoothServerSocket \u5173\u95ed BluetoothServerSocket \u5e76\u4e0d\u4f1a\u5173\u95ed\u8fd4\u56de\u7684 BluetoothSocket</p> <p>BluetoothServerSocket \u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u7279\u522b\u7684\u662f\uff0c<code>close()</code>\u4f1a\u7acb\u523b\u5173\u95ed\u8fdb\u884c\u4e2d\u7684\u64cd\u4f5c\u5e76\u5173\u95ed\u670d\u52a1 socket\u3002</p>"},{"location":"android/connectivity/bluetooth/Bluetooth2_use_sample/#bluetoothdevice","title":"BluetoothDevice","text":"<p>\u4ee3\u8868\u4e00\u4e2a\u8fdc\u7a0b\u84dd\u7259\u8bbe\u5907\u3002BluetoothDevice \u80fd\u8ba9\u4f60\u4e0e\u5176\u4ed6\u8bbe\u5907\u5efa\u7acb\u8fde\u63a5\uff0c\u6216\u8005\u67e5\u8be2\u8bbe\u5907\u4fe1\u606f\uff0c\u6bd4\u5982\u540d\u79f0\uff0c\u5730\u5740\uff0c\u7c7b\u522b\u548c\u8fde\u63a5\u72b6\u6001\u7b49\u3002 \u8fd9\u662f\u84dd\u7259\u786c\u4ef6\u5730\u5740\u7684\u7b80\u5355\u5305\u88c5\u7c7b\u3002\u627e\u4e2a\u7c7b\u7684\u5bf9\u8c61\u90fd\u8bf4\u4e0d\u53ef\u53d8\u7684\u3002\u8fd9\u4e2a\u7c7b\u7684\u64cd\u4f5c\u4f1a\u5728\u8fdc\u7a0b\u84dd\u7259\u786c\u4ef6\u5730\u5740\u4e0a\u4f53\u73b0\u3002</p> <p>\u901a\u8fc7\u4e00\u4e2a\u5df2\u77e5\u7684MAC\u5730\u5740\uff08\u53ef\u7528BluetoothDevice\u6765\u53d1\u73b0\uff09\uff0c\u6216\u662f\u901a\u8fc7<code>BluetoothAdapter.getBondedDevices()</code>\u8fd4\u56de\u7684\u5df2\u8fde\u63a5\u8bbe\u5907 \u8c03\u7528<code>BluetoothAdapter.getRemoteDevice(String)</code>\u6765\u83b7\u5f97\u4e00\u4e2a BluetoothDevice\u3002 \u7136\u540e\u5c31\u53ef\u4ee5\u6253\u5f00 BluetoothSocket \u6765\u4e0e\u8fdc\u7a0b\u8bbe\u5907\u5efa\u7acb\u8fde\u63a5\uff0c\u8c03\u7528<code>createRfcommSocketToServiceRecord(UUID)</code></p>"},{"location":"android/connectivity/bluetooth/Bluetooth2_use_sample/#api","title":"API \u8bf4\u660e","text":"<ul> <li>\u641c\u7d22\u5176\u4ed6\u84dd\u7259\u8bbe\u5907</li> <li>\u68c0\u7d22\u5339\u914d\u5230\u7684\u84dd\u7259\u8bbe\u5907</li> <li>\u5efa\u7acbRFCOMM\u9891\u9053</li> <li>\u901a\u8fc7\u53d1\u73b0\u670d\u52a1\u6765\u8fde\u63a5\u5176\u4ed6\u8bbe\u5907</li> <li>\u7ba1\u7406\u591a\u4e2a\u8fde\u63a5</li> </ul>"},{"location":"android/connectivity/bluetooth/Bluetooth2_use_sample/#setting-up-bluetooth","title":"Setting Up Bluetooth \u8bbe\u7f6e\u84dd\u7259","text":"<p>\u4f7f\u7528\u84dd\u7259\u901a\u4fe1\u524d\uff0c\u786e\u5b9a\u8bbe\u5907\u652f\u6301\u84dd\u7259\uff0c\u5e76\u5c06\u84dd\u7259\u6253\u5f00</p> <p>1.\u83b7\u53d6 BluetoothAdapter \u4f7f\u7528\u9759\u6001\u65b9\u6cd5<code>BluetoothAdapter.getDefaultAdapter()</code>\u83b7\u53d6\u673a\u5668\u7684\u84dd\u7259\u9002\u914d\u5668\uff1b\u82e5\u8fd4\u56denull\uff0c\u5219\u8868\u793a\u673a\u5668\u4e0d\u652f\u6301\u84dd\u7259 <pre><code>BluetoothAdapter mBluetoothAdapter = BluetoothAdapter.getDefaultAdapter();\nif (mBluetoothAdapter == null) {\n    // Device does not support Bluetooth\n}\n</code></pre> 2.\u6fc0\u6d3b\u84dd\u7259 \u68c0\u67e5\u84dd\u7259\u662f\u5426\u5df2\u7ecf\u6253\u5f00\uff1b\u82e5\u6ca1\u6253\u5f00\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u65b9\u6cd5\u6253\u5f00\u84dd\u7259 <pre><code>if (!mBluetoothAdapter.isEnabled()) {\n    Intent enableBtIntent = new Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);\n    startActivityForResult(enableBtIntent, REQUEST_ENABLE_BT);\n}\n</code></pre> \u4f1a\u5f39\u51fa\u4e00\u4e2a\u5bf9\u8bdd\u6846\uff0c\u8bf7\u6c42\u7528\u6237\u6253\u5f00\u84dd\u7259\u3002\u5982\u679c\u6210\u529f\u6253\u5f00\uff0cactivity \u7684 onActivityResult() \u4f1a\u6536\u5230 RESULT_OK \uff0c \u5982\u679c\u672a\u6253\u5f00\uff0c \u5219\u6536\u5230 RESULT_CANCELED</p> <p>\u53ef\u4ee5\u8ba9\u5e94\u7528\u76d1\u542c ACTION_STATE_CHANGED \uff0c\u5f53\u84dd\u7259\u72b6\u6001\u6539\u53d8\u65f6\u4f1a\u53d1\u51fa\u8fd9\u4e2a\u5e7f\u64ad\u3002\u8fd9\u4e2a\u5e7f\u64ad\u5305\u62ec\u84dd\u7259\u539f\u5148\u72b6\u6001\u548c\u73b0\u5728\u72b6\u6001\uff0c\u5206\u522b\u88c5\u5728 EXTRA_PREVIOUS_STATE \u548c EXTRA_STATE \u91cc\u3002 \u72b6\u6001\u53ef\u80fd\u662f STATE_TURNING_ON\uff0c STATE_ON\uff0c STATE_TURNING_OFF\uff0c \u548c STATE_OFF</p>"},{"location":"android/connectivity/bluetooth/Bluetooth2_use_sample/#finding-devices","title":"Finding Devices \u5bfb\u627e\u8bbe\u5907","text":"<p>\u4f7f\u7528 BluetoothAdapter\uff0c\u53ef\u4ee5\u5bfb\u627e\u8fdc\u7a0b\u84dd\u7259\u8bbe\u5907\u6216\u68c0\u7d22\u5339\u914d\u8bbe\u5907</p> <p>\u641c\u7d22\u8bbe\u5907\u662f\u641c\u7d22\u672c\u5730\u533a\u57df\u5df2\u5f00\u542f\u7684\u84dd\u7259\u8bbe\u5907\u7a0b\u5e8f\u3002\u84dd\u7259\u8bbe\u5907\u6709\u53ef\u89c1\u6a21\u5f0f\u548c\u4e0d\u53ef\u89c1\u6a21\u5f0f\u3002\u5982\u679c\u4e00\u4e2a\u8bbe\u5907\u662f\u53ef\u53d1\u73b0\u7684\uff0c\u5b83\u4f1a\u76f8\u5e94\u641c\u7d22\u8bf7\u6c42\u5e76 \u8fd4\u56de\u4e00\u4e9b\u4fe1\u606f\uff0c\u6bd4\u5982\u8bbe\u5907\u540d\uff0c\u7c7b\u522b\uff0c\u72ec\u7acb\u7684MAC\u5730\u5740\u3002\u5229\u7528\u8fd9\u4e9b\u4fe1\u606f\uff0c\u8bbe\u5907\u53ef\u4ee5\u521d\u59cb\u5316\u4e00\u4e2a\u5230\u88ab\u53d1\u73b0\u8bbe\u5907\u7684\u8fde\u63a5\u3002</p> <p>\u7b2c\u4e00\u6b21\u4e0e\u5176\u4ed6\u8bbe\u5907\u8fde\u63a5\u5efa\u7acb\uff0c\u4f1a\u81ea\u52a8\u5f39\u51fa\u4e00\u4e2a\u914d\u5bf9\u8bf7\u6c42\u7ed9\u7528\u6237\u3002\u6210\u529f\u914d\u5bf9\u540e\uff0c\u8bbe\u5907\u7684\u57fa\u672c\u4fe1\u606f\u4f1a\u88ab\u4fdd\u5b58\u4e0b\u6765\uff0c\u5e76\u4e14\u53ef\u4ee5\u88ab\u84dd\u7259API\u8c03\u7528\u3002 \u4f7f\u7528\u5df2\u77e5\u7684\u8fdc\u7a0b\u8bbe\u5907\u7684MAC\u5730\u5740\uff0c\u53ef\u4ee5\u5728\u4e0d\u641c\u7d22\u8bbe\u5907\u7684\u60c5\u51b5\u4e0b\u5efa\u7acb\u8fde\u63a5\u3002</p> <p>\u914d\u5bf9\u548c\u8fde\u63a5\u662f\u4e0d\u540c\u7684\u3002\u914d\u5bf9\u8868\u793a\u4e24\u4e2a\u8bbe\u5907\u77e5\u9053\u5bf9\u65b9\u7684\u5b58\u5728\uff0c\u6709\u76f8\u4e92\u8ba4\u8bc1\u7684key\uff0c\u80fd\u591f\u4e0e\u5bf9\u65b9\u5efa\u7acb\u52a0\u5bc6\u7684\u8fde\u63a5\u3002 \u8fde\u63a5\u610f\u5473\u7740\u8bbe\u5907\u76ee\u524d\u5171\u4eab\u4e00\u4e2aRFCOMM\u9891\u9053\uff0c\u5e76\u80fd\u76f8\u4e92\u53d1\u9001\u6570\u636e\u3002\u76ee\u524dandroid\u84dd\u7259API\u8981\u6c42\u8bbe\u5907\u5148\u914d\u5bf9\uff0c\u518d\u8fdb\u884c\u8fde\u63a5\u3002</p> <p>\u6ce8\u610f\uff1aAndroid\u8bbe\u5907\u5e76\u4e0d\u662f\u9ed8\u8ba4\u84dd\u7259\u53ef\u89c1\u7684\u3002\u7528\u6237\u53ef\u4ee5\u5728\u7cfb\u7edf\u8bbe\u7f6e\u4e2d\u8ba9\u8bbe\u5907\u84dd\u7259\u53ef\u88ab\u641c\u7d22\u5230\u3002</p>"},{"location":"android/connectivity/bluetooth/Bluetooth2_use_sample/#querying-paired-devices","title":"Querying paired devices \u68c0\u7d22\u5df2\u914d\u5bf9\u7684\u8bbe\u5907","text":"<p>\u641c\u7d22\u8bbe\u5907\u524d\uff0c\u53ef\u4ee5\u8c03\u7528<code>getBondedDevices()</code>\u68c0\u7d22\u4e00\u4e0b\u5df2\u914d\u5bf9\u7684\u8bbe\u5907\u3002\u8fd9\u4f1a\u8fd4\u56de\u914d\u5bf9\u8bbe\u5907\u7684BluetoothDevices\u96c6\u5408\u3002 \u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u68c0\u7d22\u914d\u5bf9\u8bbe\u5907\u5e76\u628a\u6bcf\u4e2a\u8bbe\u5907\u4fe1\u606f\u5b58\u5165 ArrayAdapter \uff1a <pre><code>Set&lt;BluetoothDevice&gt; pairedDevices = mBluetoothAdapter.getBondedDevices();\n// If there are paired devices\nif (pairedDevices.size() &gt; 0) {\n    // Loop through paired devices\n    for (BluetoothDevice device : pairedDevices) {\n        // Add the name and address to an array adapter to show in a ListView\n        mArrayAdapter.add(device.getName() + \"\\n\" + device.getAddress());\n    }\n}\n</code></pre> \u53ea\u9700\u8981MAC\u5730\u5740\uff0c\u5c31\u80fd\u591f\u7528BluetoothDevice\u5bf9\u8c61\u5efa\u7acb\u8fde\u63a5\u3002</p>"},{"location":"android/connectivity/bluetooth/Bluetooth2_use_sample/#discovering-devices","title":"Discovering devices \u641c\u7d22\u8bbe\u5907","text":"<p>\u8c03\u7528<code>startDiscovery()</code>\u641c\u7d22\u8bbe\u5907\u3002\u8fd9\u4e2a\u5f02\u6b65\u8fdb\u7a0b\u4f1a\u7acb\u523b\u8fd4\u56de\u662f\u5426\u542f\u52a8\u6210\u529f\u7684boolean\u503c\u3002\u641c\u7d22\u8fdb\u7a0b\u901a\u5e38\u662finquiry scan\u8fdb\u884c12\u79d2\uff0c \u63a5\u4e0b\u6765\u662f\u6bcf\u4e2a\u53d1\u73b0\u8bbe\u5907\u7684 page scan \u3002</p> <p>\u4f60\u7684\u5e94\u7528\u5fc5\u987b\u6ce8\u518c\u4e00\u4e2a\u5e7f\u64ad\u63a5\u6536\u5668\u6765\u76d1\u542c ACTION_FOUND \uff0c\u63a5\u6536\u53d1\u73b0\u7684\u6bcf\u4e2a\u8bbe\u5907\u7684\u4fe1\u606f\u3002\u6bcf\u53d1\u73b0\u4e00\u4e2a\u8bbe\u5907\uff0c\u7cfb\u7edf\u4f1a\u53d1\u9001 ACTION_FOUND \u8fd9\u4e2a Intent \u5e26\u6709 EXTRA_DEVICE \u548c EXTRA_CLASS\uff0c\u91cc\u9762\u5206\u522b\u5305\u542b BluetoothDevice \u548c\u4e00\u4e2a BluetoothClass \u4f8b\u5982\uff0c\u6ce8\u518c\u4e00\u4e2a\u5e7f\u64ad\u63a5\u6536\u5668\u6765\u76d1\u542c\u88ab\u53d1\u73b0\u8bbe\u5907\uff1a</p> <pre><code>// Create a BroadcastReceiver for ACTION_FOUND\nprivate final BroadcastReceiver mReceiver = new BroadcastReceiver() {\n    public void onReceive(Context context, Intent intent) {\n        String action = intent.getAction();\n        // When discovery finds a device\n        if (BluetoothDevice.ACTION_FOUND.equals(action)) {\n            // Get the BluetoothDevice object from the Intent\n            BluetoothDevice device = intent.getParcelableExtra(BluetoothDevice.EXTRA_DEVICE);\n            // Add the name and address to an array adapter to show in a ListView\n            mArrayAdapter.add(device.getName() + \"\\n\" + device.getAddress());\n        }\n    }\n};\n// Register the BroadcastReceiver\nIntentFilter filter = new IntentFilter(BluetoothDevice.ACTION_FOUND);\nregisterReceiver(mReceiver, filter); // Don't forget to unregister during onDestroy\n</code></pre> <p>\u8b66\u544a\uff1a\u641c\u7d22\u8bbe\u5907\u5bf9\u4e8e\u84dd\u7259\u9002\u914d\u5668\u6765\u8bf4\u662f\u4e00\u4e2a\u8017\u8d39\u8d44\u6e90\u7684\u8fdb\u7a0b\u3002\u53d1\u73b0\u76ee\u6807\u8bbe\u5907\u540e\uff0c\u4e00\u5b9a\u8981\u5728\u8fde\u63a5\u524d\u8c03\u7528<code>cancelDiscovery()</code>\u505c\u6b62\u641c\u7d22\u3002 \u4e0d\u8981\u5728\u4e0e\u8bbe\u5907\u8fde\u63a5\u65f6\u542f\u52a8\u641c\u7d22\u3002\u641c\u7d22\u8bbe\u5907\u4f1a\u51cf\u5c0f\u8fde\u63a5\u7684\u5e26\u5bbd\u3002</p>"},{"location":"android/connectivity/bluetooth/Bluetooth2_use_sample/#enabling-discoverability","title":"Enabling discoverability \u6fc0\u6d3b\u8bbe\u5907\u84dd\u7259\u53ef\u89c1","text":"<p>\u5982\u679c\u60f3\u8ba9\u672c\u5730\u8bbe\u5907\u5bf9\u5176\u4ed6\u8bbe\u5907\u84dd\u7259\u53ef\u89c1\uff0c\u8c03\u7528<code>startActivityForResult(Intent, int)</code>\uff0c\u4f20\u5165ACTION_REQUEST_DISCOVERABLE \u8fd9\u4f1a\u8bf7\u6c42\u6fc0\u6d3b\u7cfb\u7edf\u8bbe\u7f6e\u3002\u9ed8\u8ba4\u6fc0\u6d3b120\u79d2\u3002\u53ef\u4ee5\u7528EXTRA_DISCOVERABLE_DURATION\u6765\u8bf7\u6c42\u522b\u7684\u65f6\u95f4\u3002\u5e94\u7528\u53ef\u8bbe\u6700\u957f\u65f6\u95f4\u662f3600\u79d2\u3002 0\u8868\u793a\u8bbe\u5907\u6c38\u8fdc\u53ef\u89c1\u3002\u57280~3600\u5916\u7684\u6570\u5b57\u4f1a\u88ab\u8bbe\u7f6e\u4e3a120\u79d2\u3002\u6bd4\u5982\uff0c\u5c06\u65f6\u95f4\u8bbe\u7f6e\u4e3a300\u79d2\uff1a <pre><code>Intent discoverableIntent = new Intent(BluetoothAdapter.ACTION_REQUEST_DISCOVERABLE);\ndiscoverableIntent.putExtra(BluetoothAdapter.EXTRA_DISCOVERABLE_DURATION, 300);\nstartActivity(discoverableIntent);\n</code></pre> \u4f1a\u663e\u793a\u4e00\u4e2a\u5bf9\u8bdd\u6846\u6765\u8bf7\u6c42\u7528\u6237\u3002\u5982\u679c\u7528\u6237\u70b9\u51fb\u201cYes\u201d\uff0c\u8bbe\u5907\u4f1a\u53d8\u5f97\u84dd\u7259\u53ef\u89c1\u3002activity\u4f1a\u6536\u5230<code>onActivityResult()</code>\u56de\u8c03\uff0c\u5e76\u4f20\u56de \u8bbe\u7f6e\u84dd\u7259\u53ef\u89c1\u65f6\u95f4\u7684\u6570\u503c\u3002\u5982\u679c\u7528\u6237\u70b9\u51fb\u201cNo\u201d\u6216\u51fa\u73b0\u9519\u8bef\uff0c\u8fd4\u56de\u4ee3\u7801\u4f1a\u662f RESULT_CANCELED \u3002</p> <p>\u6ce8\u610f\uff1a\u5982\u679c\u8bbe\u5907\u672a\u5f00\u542f\u84dd\u7259\uff0c\u5c06\u8bbe\u5907\u84dd\u7259\u8bbe\u4e3a\u53ef\u89c1\u4f1a\u81ea\u52a8\u6253\u5f00\u84dd\u7259</p> <p>\u8bbe\u5907\u4f1a\u5728\u5141\u8bb8\u65f6\u95f4\u5185\u4fdd\u6301\u6c89\u9ed8\u3002\u53ef\u4ee5\u6ce8\u518c\u5e7f\u64ad\u63a5\u6536\u5668\u6765\u76d1\u542c ACTION_SCAN_MODE_CHANGED \u3002\u8fd9\u4e2aIntent\u4f1a\u5e26\u7740 EXTRA_SCAN_MODE \u548c EXTRA_PREVIOUS_SCAN_MODE\uff0c\u5206\u522b\u662f\u65b0\u7684\u548c\u65e7\u7684\u72b6\u6001\u3002\u53ef\u80fd\u7684\u72b6\u6001\u503c\u4f1a\u662f\uff1a SCAN_MODE_CONNECTABLE_DISCOVERABLE\uff0c SCAN_MODE_CONNECTABLE\uff0c \u6216 SCAN_MODE_NONE</p> <p>\u5982\u679c\u8981\u4e0e\u8fdc\u7a0b\u8bbe\u5907\u8fde\u63a5\uff0c\u53ef\u4ee5\u4e0d\u6fc0\u6d3b\u8bbe\u5907\u53ef\u89c1\u3002\u5f53\u5e94\u7528\u60f3\u8981\u5efa\u7acb\u670d\u52a1socket\u83b7\u53d6\u63a5\u5165\u65f6\uff0c\u5fc5\u987b\u6253\u5f00\u8bbe\u5907\u53ef\u89c1\u3002\u56e0\u4e3a\u8fdc\u7a0b\u8bbe\u5907\u5fc5\u987b\u8981\u53d1\u73b0 \u672c\u5730\u8bbe\u5907\u6765\u5efa\u7acb\u8fde\u63a5\u3002</p>"},{"location":"android/connectivity/bluetooth/Bluetooth2_use_sample/#connecting-devices","title":"Connecting Devices \u8fde\u63a5\u8bbe\u5907","text":"<p>\u670d\u52a1\u7aef\u8bbe\u5907\u548c\u5ba2\u6237\u7aef\u8bbe\u5907\u4ee5\u4e0d\u540c\u7684\u65b9\u5f0f\u83b7\u53d6 BluetoothSocket\u3002\u8fde\u63a5\u5efa\u7acb\u65f6\uff0c\u670d\u52a1\u7aef\u83b7\u53d6\u4e00\u4e2a BluetoothSocket\u3002 \u5ba2\u6237\u7aef\u6253\u5f00\u4e00\u4e2aRFCOMM\u65f6\u4f1a\u5f97\u5230 BluetoothSocket \u3002</p>"},{"location":"android/connectivity/bluetooth/Bluetooth2_use_sample/#connecting-as-a-server","title":"Connecting as a server \u5728\u8fde\u63a5\u4e2d\u4f5c\u4e3a\u670d\u52a1\u7aef","text":"<p>\u5f53\u4f60\u8981\u8fde\u63a52\u4e2a\u8bbe\u5907\uff0c\u5176\u4e2d\u4e00\u4e2a\u5fc5\u987b\u4f5c\u4e3a\u670d\u52a1\u5668\u5e76\u6301\u6709\u4e00\u4e2a\u6253\u5f00\u7684 BluetoothServerSocket \u3002\u670d\u52a1socket\u7684\u76ee\u7684\u662f\u83b7\u53d6\u63a5\u5165\u8bf7\u6c42\u5e76 \u7ed9\u5df2\u8fde\u4e0a\u8bbe\u5907\u4e00\u4e2a BluetoothSocket \u3002\u5f53\u4ece BluetoothServerSocket \u83b7\u53d6\u5230 BluetoothSocket\uff0cBluetoothServerSocket \u53ef\u4ee5\u5173\u95ed\u6389\uff0c\u9664\u975e\u4f60\u60f3\u63a5\u5165\u66f4\u591a\u8fde\u63a5\u3002 1. \u8c03\u7528<code>listenUsingRfcommWithServiceRecord(String, UUID)</code>\u6765\u83b7\u5f97\u4e00\u4e2a <code>BluetoothServerSocket</code> 2. \u8c03\u7528<code>accept()</code> \u6765\u76d1\u542c\u63a5\u5165\u8bf7\u6c42 3. \u5982\u679c\u4e0d\u9700\u8981\u63a5\u5165\u66f4\u591a\u8fde\u63a5\uff0c\u8c03\u7528<code>close()</code></p> <p><code>accept()</code>\u4e0d\u5e94\u8be5\u5728UI\u7ebf\u7a0b\u4e2d\u8c03\u7528\uff0c\u56e0\u4e3a\u5b83\u662f\u963b\u585e\u5f0f\u7684\u3002\u901a\u5e38\u5728\u5e94\u7528\u4e2d\u542f\u52a8\u65b0\u7684\u7ebf\u7a0b\u6765\u64cd\u4f5cBluetoothServerSocket \u6216 BluetoothSocket \u5728\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528BluetoothServerSocket \uff08\u6216 BluetoothSocket\uff09\u7684<code>close()</code>\u80fd\u8df3\u51fa\u963b\u585e\uff0c\u5e76\u7acb\u523b\u8fd4\u56de</p> <p>\u4f8b\u5b50\uff1a <pre><code>private class AcceptThread extends Thread {\n   private final BluetoothServerSocket mmServerSocket;\n   public AcceptThread() {\n       // Use a temporary object that is later assigned to mmServerSocket,\n       // because mmServerSocket is final\n       BluetoothServerSocket tmp = null;\n       try {\n           // MY_UUID is the app's UUID string, also used by the client code\n           tmp = mBluetoothAdapter.listenUsingRfcommWithServiceRecord(NAME, MY_UUID);\n       } catch (IOException e) { }\n       mmServerSocket = tmp;\n   }\n   public void run() {\n       BluetoothSocket socket = null;\n       // Keep listening until exception occurs or a socket is returned\n       while (true) {\n           try {\n               socket = mmServerSocket.accept();\n           } catch (IOException e) {\n               break;\n           }\n           // If a connection was accepted\n           if (socket != null) {\n               // Do work to manage the connection (in a separate thread)\n               manageConnectedSocket(socket);\n               mmServerSocket.close();\n               break;\n           }\n       }\n   }\n   /** Will cancel the listening socket, and cause the thread to finish */\n   public void cancel() {\n       try {\n           mmServerSocket.close();\n       } catch (IOException e) { }\n   }\n}\n</code></pre> \u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u53ea\u9700\u8981\u4e00\u4e2a\u63a5\u5165\u8fde\u63a5\u3002\u8fde\u63a5\u5efa\u7acb\u5e76\u83b7\u5f97 BluetoothSocket \u540e\uff0c\u5e94\u7528\u5c06\u8fd9\u4e2a BluetoothSocket \u53d1\u7ed9\u5355\u72ec\u7684\u7ebf\u7a0b\u6765\u5904\u7406 \u5e76\u5173\u95ed BluetoothServerSocket \u7ed3\u675f\u5faa\u73af\u3002</p> <p>\u5f53<code>accept()</code>\u8fd4\u56de BluetoothSocket\uff0c\u8fd9\u4e2asocket\u5df2\u7ecf\u662f\u8fde\u63a5\u4e0a\u7684\u4e86\u3002\u56e0\u6b64\u4e0d\u5fc5\u8c03\u7528<code>connect()</code>\uff08\u5ba2\u6237\u7aef\u4e5f\u4e00\u6837\uff09</p> <p><code>manageConnectedSocket()</code>\u662f\u4e00\u4e2a\u865a\u6784\u7684\u65b9\u6cd5\uff0c\u7528\u6765\u521d\u59cb\u5316\u4f20\u8f93\u6570\u636e\u7684\u7ebf\u7a0b\uff0c\u5728\u8fde\u63a5\u7ba1\u7406\u4e2d\u6765\u8ba8\u8bba\u5b83</p> <p>\u76d1\u542c\u63a5\u5165\u8fde\u63a5\u7ed3\u675f\u540e\u901a\u5e38\u8981\u7acb\u523b\u5173\u95ed BluetoothServerSocket \u3002\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u83b7\u53d6 BluetoothSocket \u540e\u7acb\u523b\u8c03\u7528\u4e86<code>close()</code>\u3002 \u53ef\u4ee5\u5728\u7ebf\u7a0b\u4e2d\u5199\u4e00\u4e2a\u516c\u5171\u65b9\u6cd5\u6765\u5173\u95ed\u79c1\u6709\u7684 BluetoothSocket \u3002\u5f53\u9700\u8981\u505c\u6b62\u76d1\u542c\u670d\u52a1socket\u65f6\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u65b9\u6cd5\u3002</p>"},{"location":"android/connectivity/bluetooth/Bluetooth2_use_sample/#connecting-as-a-client","title":"Connecting as a client \u5728\u8fde\u63a5\u4e2d\u4f5c\u4e3a\u5ba2\u6237\u7aef","text":"<p>\u4e0e\u8fdc\u7a0b\u8bbe\u5907\uff08\u670d\u52a1\u7aef\uff09\u5efa\u7acb\u8fde\u63a5\uff0c\u5148\u83b7\u53d6\u4e00\u4e2a\u4ee3\u8868\u8fdc\u7a0b\u8bbe\u5907\u7684 BluetoothDevice \u5bf9\u8c61\u3002\u5fc5\u987b\u4f7f\u7528 BluetoothDevice \u6765\u83b7\u53d6 BluetoothSocket \u5e76\u521d\u59cb\u5316\u8fde\u63a5\u3002</p> <p>\u57fa\u672c\u6d41\u7a0b\uff1a 1. \u8c03\u7528BluetoothDevice\u7684<code>createRfcommSocketToServiceRecord(UUID)</code>\u83b7\u53d6BluetoothSocket 2. \u8c03\u7528<code>connect()</code>\u6765\u521d\u59cb\u5316\u8fde\u63a5</p> <p>\u6ce8\u610f\uff1a\u5728\u8c03\u7528<code>connect()</code>\u65f6\u5fc5\u987b\u786e\u4fdd\u8bbe\u5907\u4e0d\u5728\u641c\u7d22\u8fdb\u884c\u4e2d\u3002\u5728\u641c\u7d22\u8bbe\u5907\u65f6\uff0c\u8fde\u63a5\u5c1d\u8bd5\u4f1a\u53d8\u6162\u5e76\u4e14\u5f88\u5bb9\u6613\u5931\u8d25\u3002</p> <p><pre><code>private class ConnectThread extends Thread {\n   private final BluetoothSocket mmSocket;\n   private final BluetoothDevice mmDevice;\n   public ConnectThread(BluetoothDevice device) {\n       // Use a temporary object that is later assigned to mmSocket,\n       // because mmSocket is final\n       BluetoothSocket tmp = null;\n       mmDevice = device;\n       // Get a BluetoothSocket to connect with the given BluetoothDevice\n       try {\n           // MY_UUID is the app's UUID string, also used by the server code\n           tmp = device.createRfcommSocketToServiceRecord(MY_UUID);\n       } catch (IOException e) { }\n       mmSocket = tmp;\n   }\n   public void run() {\n       // Cancel discovery because it will slow down the connection\n       mBluetoothAdapter.cancelDiscovery();\n       try {\n           // Connect the device through the socket. This will block\n           // until it succeeds or throws an exception\n           mmSocket.connect();\n       } catch (IOException connectException) {\n           // Unable to connect; close the socket and get out\n           try {\n               mmSocket.close();\n           } catch (IOException closeException) { }\n           return;\n       }\n       // Do work to manage the connection (in a separate thread)\n       manageConnectedSocket(mmSocket);\n   }\n   /** Will cancel an in-progress connection, and close the socket */\n   public void cancel() {\n       try {\n           mmSocket.close();\n       } catch (IOException e) { }\n   }\n}\n</code></pre> \u5efa\u7acb\u8fde\u63a5\u524d\uff0c\u8c03\u7528<code>cancelDiscovery()</code>\u3002</p> <p><code>manageConnectedSocket()</code>\u662f\u4e00\u4e2a\u865a\u6784\u7684\u65b9\u6cd5\uff0c\u5728\u8fde\u63a5\u7ba1\u7406\u4e2d\u8ba8\u8bba\u5b83\u3002 \u4f7f\u7528\u5b8c<code>BluetoothSocket</code>\uff0c\u4e00\u5b9a\u8981\u8c03\u7528<code>close()</code>\u6765\u7ed3\u675f</p>"},{"location":"android/connectivity/bluetooth/Bluetooth2_use_sample/#managing-a-connection","title":"Managing a Connection","text":"<p>\u6210\u529f\u8fde\u63a52\u4e2a\u6216\u66f4\u591a\u7684\u8bbe\u5907\u540e\uff0c\u6bcf\u4e2a\u8bbe\u5907\u6709\u4e00\u4e2a BluetoothSocket \u3002\u8bbe\u5907\u76f4\u63a5\u53ef\u4ee5\u5171\u4eab\u6570\u636e\u3002\u4f7f\u7528BluetoothSocket\u4f20\u8f93\u4efb\u610f\u6570\u636e</p> <p>\u83b7\u53d6\u5904\u7406\u4f20\u8f93\u7684 InputStream \u548c OutputStream\uff0c\u5206\u522b\u8c03\u7528 <code>getInputStream()</code> \u548c <code>getOutputStream()</code> \u8c03\u7528<code>read(byte[])</code> \u548c <code>write(byte[])</code> \u6765\u8bfb\u5199\u6570\u636e</p> <p>\u7ebf\u7a0b\u7684\u4e3b\u5faa\u73af\u4e2d\u5e94\u8be5\u7528\u4e8e\u4e13\u95e8\u4eceInputStream\u4e2d\u8bfb\u6570\u636e\u3002\u7ebf\u7a0b\u4e2d\u8981\u6709\u4e13\u95e8\u7684public\u65b9\u6cd5\u6765\u5199\u6570\u636e\u5230OutputStream</p> <p><pre><code>private class ConnectedThread extends Thread {\n    private final BluetoothSocket mmSocket;\n    private final InputStream mmInStream;\n    private final OutputStream mmOutStream;\n    public ConnectedThread(BluetoothSocket socket) {\n        mmSocket = socket;\n        InputStream tmpIn = null;\n        OutputStream tmpOut = null;\n        // Get the input and output streams, using temp objects because\n        // member streams are final\n        try {\n            tmpIn = socket.getInputStream();\n            tmpOut = socket.getOutputStream();\n        } catch (IOException e) { }\n        mmInStream = tmpIn;\n        mmOutStream = tmpOut;\n    }\n    public void run() {\n        byte[] buffer = new byte[1024];  // buffer store for the stream\n        int bytes; // bytes returned from read()\n        // Keep listening to the InputStream until an exception occurs\n        while (true) {\n            try {\n                // Read from the InputStream\n                bytes = mmInStream.read(buffer);\n                // Send the obtained bytes to the UI activity\n                mHandler.obtainMessage(MESSAGE_READ, bytes, -1, buffer)\n                        .sendToTarget();\n            } catch (IOException e) {\n                break;\n            }\n        }\n    }\n    /* Call this from the main activity to send data to the remote device */\n    public void write(byte[] bytes) {\n        try {\n            mmOutStream.write(bytes);\n        } catch (IOException e) { }\n    }\n    /* Call this from the main activity to shutdown the connection */\n    public void cancel() {\n        try {\n            mmSocket.close();\n        } catch (IOException e) { }\n    }\n}\n</code></pre> \u6784\u9020\u65b9\u6cd5\u9700\u8981\u6570\u636e\u6d41\uff0c\u4e00\u65e6\u6267\u884c\uff0c\u7ebf\u7a0b\u4f1a\u7b49InputStream\u4e2d\u4f20\u6765\u7684\u6570\u636e\u3002\u5f53<code>read(byte[])</code>\u8fd4\u56de\u6570\u636e\u6d41\uff0c\u901a\u8fc7handler\u5c06\u6570\u636e\u9001\u5f80 \u4e3bactivity\u3002\u7136\u540e\u7b49\u5f85\u6570\u636e\u6d41\u4e2d\u66f4\u591a\u7684\u5b57\u8282</p> <p>\u5411\u5916\u53d1\u9001\u6570\u636e\u8c03\u7528<code>write()</code></p> <p>\u7ebf\u7a0b\u7684<code>cancel()</code>\u65b9\u6cd5\u5f88\u91cd\u8981\u3002\u5b8c\u6210\u4e86\u84dd\u7259\u8fde\u63a5\u7684\u6240\u6709\u64cd\u4f5c\u540e\uff0c\u5e94\u5f53cancel\u6389</p>"},{"location":"android/connectivity/bluetooth/Bluetooth2_use_sample/#_2","title":"\u53c2\u8003","text":"<p>Android SPP\u8fde\u63a5\u84dd\u7259\u8bbe\u5907\u6ce8\u610f\u4e8b\u9879 :material-bluetooth:</p>"},{"location":"android/connectivity/bluetooth/bluetooth-spp-connection-note/","title":"Android SPP\u8fde\u63a5\u84dd\u7259\u8bbe\u5907\u6ce8\u610f\u4e8b\u9879","text":"2023-03-27 \u66f4\u65b0\u6587\u6863 <ul> <li>2023-03-27 \u66f4\u65b0\u6587\u6863</li> </ul> <p>\u672c\u6587\u4e3aAndroid Bluetooth \u84dd\u72592.0\u4f7f\u7528\u65b9\u5f0f :material-bluetooth:\u7684\u8865\u5145\u6587\u6863</p> <p>\u4f7f\u7528SPP\u534f\u8bae</p> <p>\u5c1d\u8bd5\u8fde\u63a5\u84dd\u7259\u8bbe\u5907\u65f6\uff0c\u6700\u597d\u65b0\u5f00\u4e00\u4e2a\u7ebf\u7a0b\u3002\u7136\u540e\u7528\u8fdc\u7a0b\u8bbe\u5907\u7684MAC\u5730\u5740\u6765\u91cd\u542f\u83b7\u53d6\u4e00\u4e0b\u3002</p> <pre><code>public ConnectThread(BluetoothDevice device) {\n    mmDevice = mAdapter.getRemoteDevice(device.getAddress());// get this device again\n    // ......\n}\n</code></pre> <p>\u8fde\u63a5\u53e6\u4e00\u53f0\u84dd\u7259\u8bbe\u5907\u4e4b\u524d\uff0c\u5148\u65ad\u5f00\u524d\u4e00\u4e2a\u8bbe\u5907\u7684socket \u5982\u679c\u5f53\u524d\u8fde\u63a5\u610f\u5916\u65ad\u5f00\uff0c\u53ef\u4ee5\u4e0d\u5173\u95ed\u5f53\u524dsocket <pre><code>/**\n * Stop all bluetooth threads\n */\npublic synchronized void stopAllBtThreads(boolean closeSocket) {\n    if (BTConstants.isDebug) Log.d(TAG, \"stop all Bt threads\");\n    if (mConnectThread != null) {\n        if (closeSocket) {\n            mConnectThread.cancel();\n        }\n        mConnectThread.interrupt();\n        mConnectThread = null;\n    }\n    if (mConnectedThread != null) {\n        if (closeSocket) {\n            mConnectedThread.cancel();\n        }\n        mConnectedThread.interrupt();\n        mConnectedThread = null;\n    }\n    recordBtStateAndPost(BTConstants.BLUETOOTH_STATE_NONE);\n}\n</code></pre></p> <p>\u6ce8\u610f\uff1a\u5982\u679c\u4e0d\u65ad\u5f00\u5f53\u524dsocket\u800c\u53bb\u8fde\u63a5\u53e6\u4e00\u53f0\u84dd\u7259\u8bbe\u5907\uff0c\u662f\u6709\u53ef\u80fd\u540c\u65f6\u63a5\u6536\u5230\u591a\u4e2a\u84dd\u7259\u8bbe\u5907\u7684\u6570\u636e \u4f20\u8f93\u7684\u3002\u53ea\u8981\u5b83\u4eec\u8dd1\u5728\u4e0d\u540c\u7684\u7ebf\u7a0b\u4e2d\u3002</p> <p>\u5728\u6700\u8fd1\u7684\u771f\u673a\u5b9e\u9a8c\u4e2d\uff082016-12-29\uff09\uff0c\u540c\u4e00\u53f0\u624b\u673a\u540c\u65f6\u80fdSPP\u8fde\u63a57\u4e2a\u84dd\u7259\u8bbe\u5907\u3002 7\u4e2a\u662f\u7cfb\u7edf\u89c4\u5b9a\u7684\u8fde\u63a5\u4e0a\u9650\u3002</p>"},{"location":"android/connectivity/wifi/WiFi_scan_and_connect/","title":"Android \u626b\u63cfWiFi\uff0c\u8fde\u63a5WiFi","text":"<ul> <li>win7</li> <li>Android Studio 3.0.1</li> </ul>"},{"location":"android/connectivity/wifi/WiFi_scan_and_connect/#_1","title":"\u6982\u8ff0","text":"<p>\u5728Android\u5e94\u7528\u4e2d\u626b\u63cfWiFi\u70ed\u70b9\u3002\u5e76\u628a\u641c\u7d22\u5230\u7684WiFi\u70ed\u70b9\u4fe1\u606f\u663e\u793a\u51fa\u6765\u3002 \u8fde\u63a5\u3001\u5207\u6362\u5230\u6307\u5b9a\u7684WiFi\u3002</p>"},{"location":"android/connectivity/wifi/WiFi_scan_and_connect/#_2","title":"\u7533\u8bf7\u6743\u9650","text":"<p>\u7533\u8bf7\u7f51\u7edc\u548cWiFi\u76f8\u5173\u7684\u6743\u9650 <pre><code>    &lt;uses-permission android:name=\"android.permission.CHANGE_NETWORK_STATE\"/&gt;\n    &lt;uses-permission android:name=\"android.permission.CHANGE_WIFI_STATE\"/&gt;\n    &lt;uses-permission android:name=\"android.permission.ACCESS_NETWORK_STATE\"/&gt;\n    &lt;uses-permission android:name=\"android.permission.ACCESS_WIFI_STATE\"/&gt;\n    &lt;uses-permission android:name=\"android.permission.ACCESS_COARSE_LOCATION\"/&gt;\n</code></pre> \u9700\u8981\u52a8\u6001\u7533\u8bf7\u5b9a\u4f4d\u6743\u9650\uff0c\u5426\u5219\u83b7\u53d6\u4e0d\u5230WiFi\u7684\u641c\u7d22\u7ed3\u679c</p>"},{"location":"android/connectivity/wifi/WiFi_scan_and_connect/#wifi","title":"WiFi\u4fe1\u606f\u626b\u63cf","text":"<p>\u4f7f\u7528<code>WifiManager.startScan()</code>\u65b9\u6cd5\u5f00\u59cb\u641c\u7d22WiFi\u4fe1\u606f\u3002 \u6536\u53d6\u5e7f\u64ad<code>WifiManager.SCAN_RESULTS_AVAILABLE_ACTION</code>\u83b7\u5f97\u641c\u7d22\u7ed3\u679c\u3002\u641c\u7d22\u7ed3\u679c\u662f<code>ScanResult</code>\u7c7b\u3002 <pre><code>private WifiManager mWifiManager;\n\n// \u5728Fragment\u4e2d\u83b7\u53d6WifiManager\nmWifiManager = (WifiManager) getActivity().getApplication().getApplicationContext().getSystemService(Context.WIFI_SERVICE);\n\n// \u542f\u52a8\u641c\u7d22\nif (!mWifiManager.isWifiEnabled()) {\n    mWifiManager.setWifiEnabled(true);\n}\nmWifiManager.startScan();\n</code></pre></p> <p>\u6ce8\u518c\u5e7f\u64ad\uff0c\u83b7\u53d6WiFi\u641c\u7d22\u7ed3\u679c <pre><code>    private BroadcastReceiver mBroadcastReceiver = new BroadcastReceiver() {\n        @Override\n        public void onReceive(Context context, Intent intent) {\n            String action = intent.getAction();\n            if (WifiManager.SCAN_RESULTS_AVAILABLE_ACTION.equals(action)) {\n                List&lt;ScanResult&gt; scanResults = mWifiManager.getScanResults();\n                // \u83b7\u53d6\u5230\u7ed3\u679c\u540e\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c...\n            }\n        }\n    };\n</code></pre></p>"},{"location":"android/connectivity/wifi/WiFi_scan_and_connect/#wifi_1","title":"\u5c06WiFi\u641c\u7d22\u7ed3\u679c\u663e\u793a\u51fa\u6765","text":"<p>\u4f7f\u7528<code>RecyclerView</code>\u663e\u793a\u641c\u7d22\u5230\u7684\u7ed3\u679c\u3002\u63d0\u4f9b\u9009\u62e9\u529f\u80fd\u3002 <pre><code>/**\n * WiFi\u641c\u7d22\n * Created by Rust on 2018/5/18.\n */\npublic class WiFiScanFragment extends Fragment {\n    private static final String TAG = \"WiFiScanFragment\";\n    public static final String F_TAG = \"f_tag_WiFiScanFragment\";\n    private View mTipLayout;\n    private Button mRefreshWiFiBtn;\n    private EditText mWiFiPrefixEt;\n    private String mWiFiPrefix = \"\";\n    private WifiManager mWifiManager;\n    private WiFiReAdapter mWiFiReAdapter;\n    private TextView mChosenInfoTv;\n\n    public static WiFiScanFragment newFrag() {\n        return new WiFiScanFragment();\n    }\n\n    @Override\n    public void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        mWifiManager = (WifiManager) getActivity().getApplication().getApplicationContext().getSystemService(Context.WIFI_SERVICE);\n        getActivity().registerReceiver(mBroadcastReceiver, new IntentFilter(WifiManager.SCAN_RESULTS_AVAILABLE_ACTION));\n        Log.d(TAG, \"onCreate: \u6ce8\u518c\u5e7f\u64ad\");\n    }\n\n    @Nullable\n    @Override\n    public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, Bundle savedInstanceState) {\n        return inflater.inflate(R.layout.frag_numbers_upgrade, container, false);\n    }\n\n    @Override\n    public void onViewCreated(View view, @Nullable Bundle savedInstanceState) {\n        super.onViewCreated(view, savedInstanceState);\n        mTipLayout = view.findViewById(R.id.tip_layout);\n        mRefreshWiFiBtn = view.findViewById(R.id.refresh_wifi_btn);\n        mWiFiPrefixEt = view.findViewById(R.id.wifi_prefix_et);\n        mChosenInfoTv = view.findViewById(R.id.chosen_info_tv);\n        view.findViewById(R.id.top_back_iv).setOnClickListener(mOnClickListener);\n        view.findViewById(R.id.top_end_iv).setOnClickListener(mOnClickListener);\n        view.findViewById(R.id.choose_all_btn).setOnClickListener(mOnClickListener);\n        view.findViewById(R.id.choose_none_btn).setOnClickListener(mOnClickListener);\n        view.findViewById(R.id.choose_revert_btn).setOnClickListener(mOnClickListener);\n\n        mRefreshWiFiBtn.setOnClickListener(mOnClickListener);\n        RecyclerView wifiRv = view.findViewById(R.id.wifi_rv);\n        mWiFiReAdapter = new WiFiReAdapter();\n        wifiRv.setAdapter(mWiFiReAdapter);\n        wifiRv.setLayoutManager(new GridLayoutManager(getActivity(), 3));\n        mWiFiReAdapter.setOnItemClickListener(mOnItemClickListener);\n        mWiFiPrefixEt.addTextChangedListener(new TextWatcher() {\n            @Override\n            public void beforeTextChanged(CharSequence s, int start, int count, int after) {\n\n            }\n\n            @Override\n            public void onTextChanged(CharSequence s, int start, int before, int count) {\n\n            }\n\n            @Override\n            public void afterTextChanged(Editable s) {\n                mWiFiPrefix = s.toString();\n            }\n        });\n    }\n\n    @Override\n    public void onDestroy() {\n        super.onDestroy();\n        getActivity().unregisterReceiver(mBroadcastReceiver);\n        Log.d(TAG, \"onDestroy: \u9500\u6bc1\u5e7f\u64ad\");\n    }\n\n    private View.OnClickListener mOnClickListener = new View.OnClickListener() {\n        @Override\n        public void onClick(View v) {\n            switch (v.getId()) {\n                case R.id.top_back_iv:\n                    getActivity().finish();\n                    break;\n                case R.id.top_end_iv:\n                    if (mTipLayout.getVisibility() != View.VISIBLE) {\n                        mTipLayout.setVisibility(View.VISIBLE);\n                    } else {\n                        mTipLayout.setVisibility(View.GONE);\n                    }\n                    break;\n                case R.id.refresh_wifi_btn:\n                    if (!mWifiManager.isWifiEnabled()) {\n                        mWifiManager.setWifiEnabled(true);\n                    }\n                    mWifiManager.startScan();\n                    mRefreshWiFiBtn.setText(\"\u626b\u63cf\u4e2d..\");\n                    ToastUtil.showShort(getActivity(), \"\u5f00\u59cb\u626b\u63cf\");\n                    break;\n                case R.id.choose_all_btn:\n                    mWiFiReAdapter.chooseAll();\n                    updateChosenNoteUI();\n                    break;\n                case R.id.choose_none_btn:\n                    mWiFiReAdapter.chooseNone();\n                    updateChosenNoteUI();\n                    break;\n                case R.id.choose_revert_btn:\n                    mWiFiReAdapter.chooseRevert();\n                    updateChosenNoteUI();\n                    break;\n            }\n        }\n    };\n\n    private BroadcastReceiver mBroadcastReceiver = new BroadcastReceiver() {\n        @Override\n        public void onReceive(Context context, Intent intent) {\n            String action = intent.getAction();\n            if (WifiManager.SCAN_RESULTS_AVAILABLE_ACTION.equals(action)) {\n                List&lt;ScanResult&gt; scanResults = mWifiManager.getScanResults();\n                mWiFiReAdapter.clearList();\n                String lowerPrefix = mWiFiPrefix.toLowerCase();\n                ToastUtil.showShort(getActivity(), \"\u626b\u63cf\u7ed3\u675f\");\n                mRefreshWiFiBtn.setText(\"\u5237\u65b0\");\n                for (ScanResult s : scanResults) {\n//                    Log.d(TAG, \"onReceive: \" + s);\n                    if (!TextUtils.isEmpty(s.SSID) &amp;&amp; s.SSID.toLowerCase().startsWith(lowerPrefix)) {\n                        mWiFiReAdapter.addOrUpdateWiFiScanResult(s);\n                    }\n                }\n                mWiFiReAdapter.notifyDataSetChanged();\n                updateChosenNoteUI();\n            }\n        }\n    };\n\n    public void updateChosenNoteUI() {\n        mChosenInfoTv.setText(String.format(Locale.CHINA, \"\u5df2\u9009:%d\", mWiFiReAdapter.getChosenWiFi().size()));\n    }\n\n    private WiFiAdapterOnItemClickListener mOnItemClickListener = new WiFiAdapterOnItemClickListener() {\n        @Override\n        public void onItemClick(int pos) {\n            mWiFiReAdapter.revertChosen(pos);\n            updateChosenNoteUI();\n        }\n    };\n\n    private class WiFiReAdapter extends RecyclerView.Adapter&lt;WVH&gt; {\n        private WiFiAdapterOnItemClickListener onItemClickListener;\n        private List&lt;WiFiItem&gt; wifiList;\n\n        WiFiReAdapter() {\n            wifiList = new ArrayList&lt;&gt;(20);\n        }\n\n        void setOnItemClickListener(WiFiAdapterOnItemClickListener listener) {\n            this.onItemClickListener = listener;\n        }\n\n        void clearList() {\n            wifiList.clear();\n        }\n\n        void addOrUpdateWiFiScanResult(ScanResult scanResult) {\n            boolean has = false;\n            for (WiFiItem item : wifiList) {\n                if (item.scanResult.SSID.equals(scanResult.SSID)) {\n                    has = true;\n                    item.scanResult = scanResult;\n                }\n            }\n            if (!has) {\n                wifiList.add(new WiFiItem(scanResult));\n            }\n        }\n\n        void chooseAll() {\n            for (WiFiItem i : wifiList) {\n                i.chosen = true;\n            }\n            notifyDataSetChanged();\n        }\n\n        void chooseNone() {\n            for (WiFiItem i : wifiList) {\n                i.chosen = false;\n            }\n            notifyDataSetChanged();\n        }\n\n        void chooseRevert() {\n            for (WiFiItem i : wifiList) {\n                i.chosen = !i.chosen;\n            }\n            notifyDataSetChanged();\n        }\n\n        void revertChosen(final int pos) {\n            WiFiItem item = wifiList.get(pos);\n            item.chosen = !item.chosen;\n            notifyItemChanged(pos);\n        }\n\n        List&lt;ScanResult&gt; getChosenWiFi() {\n            List&lt;ScanResult&gt; res = new ArrayList&lt;&gt;();\n            for (WiFiItem item : wifiList) {\n                if (item.chosen) {\n                    res.add(item.scanResult);\n                }\n            }\n            return res;\n        }\n\n        @Override\n        public WVH onCreateViewHolder(ViewGroup parent, int viewType) {\n            return new WVH(LayoutInflater.from(parent.getContext()).inflate(R.layout.item_wifi, parent, false));\n        }\n\n        @Override\n        public void onBindViewHolder(WVH holder, final int position) {\n            final int pos = position;\n            WiFiItem item = wifiList.get(pos);\n            holder.ssidTv.setText(item.scanResult.SSID);\n            holder.chosenCb.setChecked(item.chosen);\n            holder.itemRoot.setOnClickListener(new View.OnClickListener() {\n                @Override\n                public void onClick(View v) {\n                    if (null != onItemClickListener) {\n                        onItemClickListener.onItemClick(pos);\n                    }\n                }\n            });\n        }\n\n        @Override\n        public int getItemCount() {\n            return wifiList.size();\n        }\n    }\n\n    static class WiFiItem {\n        boolean chosen = false;\n        ScanResult scanResult;\n\n        WiFiItem(ScanResult s) {\n            scanResult = s;\n        }\n    }\n\n    static class WVH extends RecyclerView.ViewHolder {\n        View itemRoot;\n        CheckBox chosenCb;\n        TextView ssidTv;\n        TextView noteTv;\n\n        WVH(View itemView) {\n            super(itemView);\n            itemRoot = itemView;\n            chosenCb = itemView.findViewById(R.id.chosen_cb);\n            ssidTv = itemView.findViewById(R.id.ssid_tv);\n            noteTv = itemView.findViewById(R.id.note_tv);\n        }\n    }\n\n    public interface WiFiAdapterOnItemClickListener {\n        void onItemClick(final int pos);\n    }\n}\n</code></pre></p>"},{"location":"android/connectivity/wifi/WiFi_scan_and_connect/#wifi_2","title":"\u8fde\u63a5WiFi","text":"<p>\u521b\u5efa\u8fde\u63a5WiFi\u7684\u5e2e\u52a9\u7c7b\uff1b\u8fde\u63a5WiFi\u9700\u8981<code>WifiManager</code></p> <p>\u68c0\u67e5\u76ee\u6807SSID\u662f\u5426\u5df2\u7ecf\u88ab\u4fdd\u5b58 <pre><code>    private static WifiConfiguration getExistsCfg(String SSID, final WifiManager wifiManager) {\n        List&lt;WifiConfiguration&gt; existingConfigs = wifiManager.getConfiguredNetworks();\n        for (WifiConfiguration existingConfig : existingConfigs) {\n            if (existingConfig.SSID.equals(\"\\\"\" + SSID + \"\\\"\")) {\n                return existingConfig;\n            }\n        }\n        return null;\n    }\n</code></pre></p> <p>\u521b\u5efawpa\u52a0\u5bc6\u7684WiFi\u914d\u7f6e\uff0c\u63a5\u4e0b\u6765\u8fde\u63a5\u5230\u8fd9\u4e2aWiFi\u9700\u8981\u8fd9\u4e9b\u4fe1\u606f <pre><code>    private static WifiConfiguration createWpaWifiInfo(String SSID, String password) {\n        WifiConfiguration config = new WifiConfiguration();\n        config.allowedAuthAlgorithms.clear();\n        config.allowedGroupCiphers.clear();\n        config.allowedKeyManagement.clear();\n        config.allowedPairwiseCiphers.clear();\n        config.allowedProtocols.clear();\n        config.SSID = \"\\\"\" + SSID + \"\\\"\";\n        config.preSharedKey = \"\\\"\" + password + \"\\\"\";\n        config.hiddenSSID = true;\n        config.allowedAuthAlgorithms.set(WifiConfiguration.AuthAlgorithm.OPEN);\n        config.allowedGroupCiphers.set(WifiConfiguration.GroupCipher.TKIP);\n        config.allowedKeyManagement.set(WifiConfiguration.KeyMgmt.WPA_PSK);\n        config.allowedPairwiseCiphers.set(WifiConfiguration.PairwiseCipher.TKIP);\n        // \u6b64\u5904\u9700\u8981\u4fee\u6539\u5426\u5219\u4e0d\u80fd\u81ea\u52a8\u91cd\u8054\n        // config.allowedProtocols.set(WifiConfiguration.Protocol.WPA);\n        config.allowedGroupCiphers.set(WifiConfiguration.GroupCipher.CCMP);\n        config.allowedPairwiseCiphers.set(WifiConfiguration.PairwiseCipher.CCMP);\n        config.status = WifiConfiguration.Status.ENABLED;\n        return config;\n    }\n</code></pre></p> <p>\u8fde\u63a5\u5230\u6307\u5b9aWiFi<code>WifiConfiguration</code>\uff1b\u5982\u679c<code>wifiManager.addNetwork</code>\u8fd4\u56de\u503c\u662f-1\uff0c\u8868\u793a\u64cd\u4f5c\u5931\u8d25</p> <p>\u5982\u679c\u5207\u6362WiFi\u6210\u529f\uff0c\u4f1a\u5728\u5e7f\u64ad\u4e2d\u6536\u5230<code>WifiManager.NETWORK_STATE_CHANGED_ACTION</code> <pre><code>    private static void connectToWiFi(WifiConfiguration config, final WifiManager wifiManager) {\n        int wcgID = wifiManager.addNetwork(config);\n        android.util.Log.d(TAG, LOG_PRE + \"connectToWiFi: \" + config.SSID + \";  res==\" + wcgID);\n        if (wcgID == -1) {\n            android.util.Log.d(TAG, LOG_PRE + \"\u64cd\u4f5c\u5931\u8d25\");\n        }\n        boolean enRes = wifiManager.enableNetwork(wcgID, true);\n        Log.d(TAG, LOG_PRE + \"\u5207\u6362\u5230WiFi: \" + config.SSID + \"; enable \" + enRes);\n    }\n</code></pre></p> <p>\u64cd\u4f5cWiFi\u65f6\uff0c\u5c31\u50cf\u64cd\u4f5c\u84dd\u7259\u4e00\u6837\uff0c\u53ef\u80fd\u4f1a\u9700\u8981\u81ea\u5b9a\u4e49\u4e00\u4e9b\u5ef6\u65f6\uff0c\u7ed9\u7cfb\u7edf\u8c03\u7528\u786c\u4ef6\u8bbe\u5907\u4e00\u4e9b\u65f6\u95f4\u3002 <pre><code>public class NUHelper {\n    private static final String TAG = \"NU\";\n    private static final String LOG_PRE = \"Helper - \";\n    private static final String DEF_WIFI_PWD = \"88888888\";\n    public static int mSwitchWiFiWaitMM = 3000; // \u5207\u6362WiFi\u65f6\u7b49\u5f85\u7684\u6700\u5c0f\u65f6\u95f4\n\n    /**\n     * \u5f53\u524d\u6b63\u5728\u5904\u7406\u7684WiFi\n     */\n    public static String mCurrSSID = \"\"; // \u6ca1\u6709\u53cc\u5f15\u53f7\u5305\u56f4\n\n    /**\n     * \u8fde\u63a5\u7b49\u5f85\u6c60\u4e2d\u7684\u4e0b\u4e00\u4e2aWiFi\n     */\n    public synchronized static void connectToNext(final ScanResult scanResult, final WifiManager wifiManager) {\n        mCurrSSID = scanResult.SSID;\n        new Thread(new Runnable() {\n            @Override\n            public void run() {\n                try {\n                    Thread.sleep(mSwitchWiFiWaitMM); // \u7b49\u5f85WiFi\u64cd\u4f5c\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                android.util.Log.d(TAG, LOG_PRE + \"\u5f00\u59cb\u5904\u7406 \" + mCurrSSID);\n                WifiInfo wifiInfo = wifiManager.getConnectionInfo();\n                android.util.Log.d(TAG, LOG_PRE + \"\u5f53\u524dWiFi: \" + wifiInfo.getSSID());\n                if (wifiInfo.getSSID().equals(\"\\\"\" + mCurrSSID + \"\\\"\")) {\n                    android.util.Log.d(TAG, LOG_PRE + \"\u662f\u5f53\u524d\u8fde\u63a5\u7684WiFi \" + mCurrSSID);\n                    // \u5f53\u524d\u5df2\u7ecf\u8fde\u63a5\u4e0a\u4e86\u8fd9\u4e2a\u76ee\u6807WiFi\n                } else {\n                    WifiConfiguration cfg = getExistsCfg(mCurrSSID, wifiManager);\n                    if (null == cfg) {\n                        android.util.Log.d(TAG, LOG_PRE + \"\u6ca1\u6709\u8fde\u63a5\u8fc7\u8fd9\u4e2aWiFi - \" + mCurrSSID);\n                        cfg = createWpaWifiInfo(mCurrSSID, DEF_WIFI_PWD);\n                    } else {\n                        android.util.Log.d(TAG, LOG_PRE + \"\u4e4b\u524d\u8fde\u63a5\u8fc7\u8fd9\u4e2aWiFi - \" + mCurrSSID);\n                    }\n                    connectToWiFi(cfg, wifiManager);\n                }\n            }\n        }).start();\n    }\n}\n</code></pre></p>"},{"location":"android/connectivity/wifi/WiFi_scan_and_connect/#_3","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>Android - ScanResult</li> </ul>"},{"location":"android/content/clip/use-clip/","title":"Use clip","text":"<p>Android\u590d\u5236\u5230\u526a\u8d34\u677f</p> <pre><code>import android.content.ClipData;\nimport android.content.ClipboardManager;\n</code></pre>"},{"location":"android/content/sharedpreferences/intro1/","title":"SharedPreferences \u7b80\u4ecb","text":"<p>\u6709\u65f6\u5019\u6211\u4eec\u60f3\u5728\u5e94\u7528\u4e2d\u5b58\u50a8\u4e00\u4e9b\u6570\u636e\u3002\u6bd4\u5982\u4e00\u4e9b\u914d\u7f6e\u4fe1\u606f\u3002 \u4f8b\u5982\u5b58\u50a8int\uff0cfloat\uff0cboolean\uff0c\u5b57\u7b26\u4e32\u8fd9\u7c7b\u7684\u6570\u636e\u3002</p> <p>\u5199\u6587\u4ef6\u53ef\u80fd\u4f1a\u6bd4\u8f83\u7e41\u7410\u3002\u9700\u8981\u81ea\u5df1\u5b9e\u73b0\u6587\u4ef6\u8bfb\u5199\u64cd\u4f5c\uff0c\u5b9a\u4e49\u6570\u636e\u5b58\u653e\u7ed3\u6784\u3002 \u5bf9\u4e8e\u8fd9\u4e9b\u7b80\u5355\u7684\u6570\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u7528SharedPreferences\uff08\u4e0b\u6587\u6216\u7b80\u79f0\u300csp\u300d\uff09\u6765\u8fdb\u884c\u5b58\u50a8\u3002</p> <p>sp\u4f7f\u7528\u7684\u662fkey-value\u7c7b\u578b\u7684\u6570\u636e\u7ed3\u6784\u3002\u4e4b\u524d\u63a5\u89e6\u5230\u7684json\u683c\u5f0f\u4e5f\u662fkey-value\u7c7b\u578b\u7684\u3002</p>"},{"location":"android/content/sharedpreferences/intro1/#_1","title":"\u5b58\u6570\u636e","text":"<p>\u7b2c\u4e00\u6b65\u662f\u83b7\u53d6\u5230\u4e00\u4e2aSharedPreferences\u5bf9\u8c61\u3002\u5728Activity\u4e2d\uff0c\u53ef\u4ee5\u8c03\u7528<code>getSharedPreferences(String name, int mode)</code>\u65b9\u6cd5\u3002\u9700\u8981\u4f20\u5165\u8fd9\u4e2asp\u7684\u540d\u5b57\u3002 <pre><code>private static final String SP_1 = \"sp_1\";\n\ngetSharedPreferences(SP_1, Context.MODE_PRIVATE)\n</code></pre></p> <p>\u5b58\u5165\u5404\u9879\u6570\u636e\u3002int\u6709\u5bf9\u5e94\u7684<code>putInt</code>\u65b9\u6cd5\u3002\u540c\u7406\uff0cboolean\u3001float\u3001long\u3001String\u3001StringSet\u90fd\u6709\u5bf9\u5e94\u7684put\u65b9\u6cd5\u3002 \u4e5f\u7b80\u5199\u4e3a<code>putXxx</code>\u65b9\u6cd5\u3002 <pre><code>private void saveParams() {\n    Set&lt;String&gt; set = new HashSet&lt;&gt;();\n    set.add(\"R\");\n    set.add(\"u\");\n    set.add(\"s\");\n    set.add(\"t\");\n    getSharedPreferences(SP_1, Context.MODE_PRIVATE).edit()\n            .putInt(K_1, 1000)\n            .putBoolean(K_2, true)\n            .putFloat(K_3, 3.14159f)\n            .putLong(K_4, System.currentTimeMillis())\n            .putString(K_5, \"RustFisher\")\n            .putStringSet(K_6, set)\n            .apply();\n}\n</code></pre> \u6700\u540e\u8c03\u7528<code>apply()</code>\u65b9\u6cd5\uff0c\u628a\u6570\u636e\u5199\u5165\u3002 \u6ce8\u610f<code>apply()</code>\u65b9\u6cd5\uff0c\u5b83\u5e76\u4e0d\u4fdd\u8bc1\u7acb\u523b\u628a\u6570\u636e\u5199\u5165\u3002\u5b83\u662f\u4e00\u4e2a\u5f02\u6b65\u7684\u65b9\u6cd5\u3002</p> <p>\u800c<code>commit()</code>\u662f\u4e00\u4e2a\u540c\u6b65\u65b9\u6cd5\u3002\u5b83\u4f1a\u5728\u5f53\u524d\u7ebf\u7a0b\u7acb\u523b\u6267\u884c\u3002</p> <p>\u5b98\u65b9\u63a8\u8350\u4f7f\u7528<code>apply()</code>\u6765\u4fdd\u5b58\u4fe1\u606f\u3002</p> <p>\u8fd0\u884c\u5230\u673a\u5668\u4e0a\u3002\u5982\u679c\u6570\u636e\u4fdd\u5b58\u6210\u529f\uff0c\u5728as\u7684Device File Explorer\u9762\u677f\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u627e\u5230\u6587\u4ef6<code>/data/data/com.rustfisher.tutorial2020/shared_prefs/sp_1.xml</code>\u3002</p> <p>\u4f7f\u7528sp\uff0c\u4f1a\u5728\u5e94\u7528\u5185\u90e8\u7684<code>shared_prefs</code>\u76ee\u5f55\u521b\u5efaxml\u6587\u4ef6\u3002</p> <p>\u8fd0\u884c\u793a\u4f8b\u5de5\u7a0b\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230<code>shared_prefs</code>\u76ee\u5f55\u6709\u522b\u7684\u5e93\u521b\u5efa\u7684sp\u6587\u4ef6\u3002 \u4f8b\u5982<code>BuglySdkInfos.xml</code>\u6216<code>x5_proxy_setting.xml</code>\u7b49\u7b49\u3002</p> <p><pre><code>&lt;?xml version='1.0' encoding='utf-8' standalone='yes' ?&gt;\n&lt;map&gt;\n    &lt;int name=\"k1\" value=\"1000\" /&gt;\n    &lt;boolean name=\"k2\" value=\"true\" /&gt;\n    &lt;float name=\"k3\" value=\"3.14159\" /&gt;\n    &lt;long name=\"k4\" value=\"1605628186953\" /&gt;\n    &lt;string name=\"k5\"&gt;RustFisher&lt;/string&gt;\n    &lt;set name=\"k6\"&gt;\n        &lt;string&gt;R&lt;/string&gt;\n        &lt;string&gt;s&lt;/string&gt;\n        &lt;string&gt;t&lt;/string&gt;\n        &lt;string&gt;u&lt;/string&gt;\n    &lt;/set&gt;\n&lt;/map&gt;\n</code></pre> \u53ef\u770b\u51fa\u5b83\u5b58\u50a8\u4f7f\u7528\u7684\u662fxml\u6587\u4ef6\uff0c\u5916\u56f4\u6807\u7b7e\u662f<code>&lt;map&gt;</code>\u3002</p>"},{"location":"android/content/sharedpreferences/intro1/#_2","title":"\u8bfb\u6570\u636e","text":"<p>\u5b58\u5165\u6570\u636e\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u6570\u636e\u8bfb\u51fa\u6765\u3002\u548c<code>putXxx</code>\u65b9\u6cd5\u7c7b\u4f3c\uff0csp\u63d0\u4f9b\u4e86<code>getXxx</code>\u65b9\u6cd5\u3002</p> <p>\u4f8b\u5982<code>int getInt(String key, int defValue);</code>\u65b9\u6cd5\u3002 \u540e\u9762\u7684defValue\u662f\u9ed8\u8ba4\u503c\u3002\u5982\u679c\u8fd9\u4e2akey\u6ca1\u6709\u5bf9\u5e94\u7684int\uff0c\u5219\u8fd4\u56de\u9ed8\u8ba4\u503cdefValue\u3002</p> <ul> <li>getInt</li> <li>getBoolean</li> <li>getFloat</li> <li>getLong</li> <li>getString</li> <li>getStringSet</li> </ul> <p>\u4e0b\u9762\u4ee3\u7801\u662f\u628a\u6570\u636e\u8bfb\u51fa\uff0c\u5e76\u4e14\u663e\u793a\u51fa\u6765\u3002 <pre><code>private void readParams() {\n    SharedPreferences sp = getSharedPreferences(SP_1, Context.MODE_PRIVATE);\n    StringBuilder sb = new StringBuilder();\n    sb.append(K_1).append(\": \").append(sp.getInt(K_1, -1));\n    sb.append(\"\\n\").append(K_2).append(\": \").append(sp.getBoolean(K_2, false));\n    sb.append(\"\\n\").append(K_3).append(\": \").append(sp.getFloat(K_3, -1));\n    sb.append(\"\\n\").append(K_4).append(\": \").append(sp.getLong(K_4, -1));\n    sb.append(\"\\n\").append(K_5).append(\": \").append(sp.getString(K_5, \"none\"));\n    sb.append(\"\\n\").append(K_6).append(\": \").append(sp.getStringSet(K_6, null));\n    mTv1.setText(sb.toString());\n}\n</code></pre></p>"},{"location":"android/coroutines/intro1/","title":"Android Kotlin\u534f\u7a0b\u5165\u95e8","text":"\u66f4\u65b0\u65e5\u671f 2021-9-26 <ul> <li>2021-9-26 \u521b\u5efa</li> </ul> <p>Android\u5b98\u65b9\u63a8\u8350\u4f7f\u7528\u534f\u7a0b\u6765\u5904\u7406\u5f02\u6b65\u95ee\u9898\u3002\u4ee5\u4e0b\u662f\u534f\u7a0b\u7684\u7279\u70b9\uff1a</p> <ul> <li>\u8f7b\u91cf\uff1a\u5355\u4e2a\u7ebf\u7a0b\u4e0a\u53ef\u8fd0\u884c\u591a\u4e2a\u534f\u7a0b\u3002\u534f\u7a0b\u652f\u6301\u6302\u8d77\uff0c\u4e0d\u4f1a\u4f7f\u6b63\u5728\u8fd0\u884c\u534f\u7a0b\u7684\u7ebf\u7a0b\u963b\u585e\u3002\u6302\u8d77\u6bd4\u963b\u585e\u8282\u7701\u5185\u5b58\uff0c\u4e14\u652f\u6301\u591a\u4e2a\u5e76\u884c\u64cd\u4f5c\u3002</li> <li>\u5185\u5b58\u6cc4\u6f0f\u66f4\u5c11\uff1a\u4f7f\u7528\u7ed3\u6784\u5316\u5e76\u53d1\u673a\u5236\u5728\u4e00\u4e2a\u4f5c\u7528\u57df\u5185\u6267\u884c\u591a\u9879\u64cd\u4f5c\u3002</li> <li>\u5185\u7f6e\u53d6\u6d88\u652f\u6301\uff1a\u53d6\u6d88\u64cd\u4f5c\u4f1a\u81ea\u52a8\u5728\u8fd0\u884c\u4e2d\u7684\u6574\u4e2a\u534f\u7a0b\u5c42\u6b21\u7ed3\u6784\u5185\u4f20\u64ad\u3002</li> <li>Jetpack\u96c6\u6210\uff1a\u8bb8\u591aJetpack\u5e93\u90fd\u5305\u542b\u63d0\u4f9b\u5168\u9762\u534f\u7a0b\u652f\u6301\u7684\u6269\u5c55\u3002\u67d0\u4e9b\u5e93\u8fd8\u63d0\u4f9b\u81ea\u5df1\u7684\u534f\u7a0b\u4f5c\u7528\u57df\uff0c\u53ef\u7528\u4e8e\u7ed3\u6784\u5316\u5e76\u53d1\u3002</li> </ul>"},{"location":"android/coroutines/intro1/#_1","title":"\u793a\u4f8b","text":"<p>\u9996\u5148\u5de5\u7a0b\u4e2d\u9700\u8981\u5f15\u5165Kotlin\u4e0e\u534f\u7a0b\u3002\u7136\u540e\u518d\u4f7f\u7528\u534f\u7a0b\u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42\u3002</p>"},{"location":"android/coroutines/intro1/#_2","title":"\u5f15\u5165","text":"<p>Android\u5de5\u7a0b\u4e2d\u5f15\u5165Kotlin\uff0c\u53c2\u8003 Android\u9879\u76ee\u4f7f\u7528kotlin</p> <p>\u6709\u4e86Kt\u540e\uff0c\u5f15\u5165\u534f\u7a0b <pre><code>dependencies {\n    implementation \"org.jetbrains.kotlinx:kotlinx-coroutines-android:1.3.9\" // \u534f\u7a0b\n}\n</code></pre></p>"},{"location":"android/coroutines/intro1/#_3","title":"\u542f\u52a8\u534f\u7a0b","text":"<p>\u4e0d\u540c\u4e8eKotlin\u5de5\u7a0b\u76f4\u63a5\u4f7f\u7528GlobalScope\uff0c\u8fd9\u4e2a\u793a\u4f8b\u5728ViewModel\u4e2d\u4f7f\u7528\u534f\u7a0b\u3002\u9700\u8981\u4f7f\u7528<code>viewModelScope</code>\u3002</p> <p>\u4e0b\u9762\u7684CorVm1\u7ee7\u627f\u4e86ViewModel\u3002 <pre><code>import androidx.lifecycle.ViewModel\nimport androidx.lifecycle.viewModelScope // \u5f15\u5165\nimport kotlinx.coroutines.Dispatchers\nimport kotlinx.coroutines.launch\n\nclass CorVm1 : ViewModel() {\n\n    companion object {\n        const val TAG = \"rfDevCorVm1\"\n    }\n\n    fun cor1() {\n        viewModelScope.launch { Log.d(TAG, \"\u4e0d\u6307\u5b9adispatcher ${Thread.currentThread()}\") }\n    }\n}\n</code></pre></p> <p>\u5728\u6309\u94ae\u7684\u70b9\u51fb\u76d1\u542c\u5668\u4e2d\u8c03\u7528<code>cor1()</code>\u65b9\u6cd5\uff0c\u53ef\u4ee5\u770b\u5230\u534f\u7a0b\u662f\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u7684\u3002 <pre><code>\u4e0d\u6307\u5b9adispatcher Thread[main,5,main]\n</code></pre></p> <p>\u7531\u4e8e\u6b64\u534f\u7a0b\u901a\u8fc7<code>viewModelScope</code>\u542f\u52a8\uff0c\u56e0\u6b64\u5728ViewModel\u7684\u4f5c\u7528\u57df\u5185\u6267\u884c\u3002\u5982\u679cViewModel\u56e0\u7528\u6237\u79bb\u5f00\u5c4f\u5e55\u800c\u88ab\u9500\u6bc1\uff0c\u5219<code>viewModelScope</code>\u4f1a\u81ea\u52a8\u53d6\u6d88\uff0c\u4e14\u6240\u6709\u8fd0\u884c\u7684\u534f\u7a0b\u4e5f\u4f1a\u88ab\u53d6\u6d88\u3002</p> <p><code>launch()</code>\u65b9\u6cd5\u53ef\u4ee5\u6307\u5b9a\u8fd0\u884c\u7684\u7ebf\u7a0b\u3002\u53ef\u4ee5\u4f20\u5165<code>Dispatchers</code>\u6765\u6307\u5b9a\u8fd0\u884c\u7684\u7ebf\u7a0b\u3002</p> <p>\u5148\u7b80\u5355\u770b\u4e00\u4e0b<code>kotlinx.coroutines</code>\u5305\u91cc\u7684Dispatchers\uff0c\u5b83\u67094\u4e2a\u5c5e\u6027\uff1a</p> <ul> <li><code>Default</code>\uff0c\u9ed8\u8ba4</li> <li><code>Main</code>\uff0cAndroid\u4e2d\u6307\u5b9a\u7684\u662f\u4e3b\u7ebf\u7a0b</li> <li><code>Unconfined</code>\uff0c\u4e0d\u6307\u5b9a\u7ebf\u7a0b</li> <li><code>IO</code>\uff0c\u6307\u5b9aIO\u7ebf\u7a0b</li> </ul> <p>\u90fd\u901a\u8fc7\u70b9\u51fb\u4e8b\u4ef6\u6765\u542f\u52a8 <pre><code>// CorVm1.kt\n\nfun ioCor() {\n    viewModelScope.launch(Dispatchers.IO) {\n        Log.d(TAG, \"IO \u534f\u7a0b ${Thread.currentThread()}\")\n    }\n}\n\nfun defaultCor() {\n    viewModelScope.launch(Dispatchers.Default) {\n        Log.d(TAG, \"Default \u534f\u7a0b ${Thread.currentThread()}\")\n    }\n}\n\nfun mainCor() {\n    viewModelScope.launch(Dispatchers.Main) { Log.d(TAG, \"Main \u534f\u7a0b ${Thread.currentThread()}\") }\n}\n\nfun unconfinedCor() {\n    viewModelScope.launch(Dispatchers.Unconfined) {\n        Log.d(TAG, \"Unconfined \u534f\u7a0b ${Thread.currentThread()}\")\n    }\n}\n</code></pre></p> <p>\u8fd0\u884clog <pre><code>IO \u534f\u7a0b Thread[DefaultDispatcher-worker-1,5,main]\nMain \u534f\u7a0b Thread[main,5,main]\nDefault \u534f\u7a0b Thread[DefaultDispatcher-worker-1,5,main]\nUnconfined \u534f\u7a0b Thread[main,5,main]\n</code></pre></p> <p>\u4ece\u4e0a\u9762\u7684\u6bd4\u8f83\u53ef\u4ee5\u770b\u51fa\uff0c\u5982\u679c\u60f3\u5229\u7528\u540e\u53f0\u7ebf\u7a0b\uff0c\u53ef\u4ee5\u8003\u8651<code>Dispatchers.IO</code>\u3002<code>Default</code>\u7528\u7684\u4e5f\u662f<code>DefaultDispatcher-worker-1</code>\u7ebf\u7a0b\u3002</p>"},{"location":"android/coroutines/intro1/#_4","title":"\u6a21\u62df\u7f51\u7edc\u8bf7\u6c42","text":"<p>\u4e3b\u7ebf\u7a0b\u4e2d\u4e0d\u80fd\u8fdb\u884c\u7f51\u7edc\u8bf7\u6c42\uff0c\u6211\u4eec\u628a\u8bf7\u6c42\u653e\u5230\u4e3aIO\u64cd\u4f5c\u9884\u7559\u7684\u7ebf\u7a0b\u4e0a\u6267\u884c\u3002\u4e00\u4e9b\u4fe1\u606f\u7528MutableLiveData\u53d1\u51fa\u53bb\u3002</p> <p><pre><code>// CorVm1.kt\nval info1LiveData: MutableLiveData&lt;String&gt; = MutableLiveData()\n\nprivate fun reqGet() {\n    info1LiveData.value = \"\u53d1\u8d77\u8bf7\u6c42\"\n    viewModelScope.launch(Dispatchers.IO) {\n        val url = URL(\"https://www.baidu.com/s?wd=abc\")\n        try {\n            val conn = url.openConnection() as HttpURLConnection\n            conn.requestMethod = \"GET\"\n            conn.connectTimeout = 10 * 1000\n            conn.setRequestProperty(\"Cache-Control\", \"max-age=0\")\n            conn.doOutput = true\n            val code = conn.responseCode\n            if (code == 200) {\n                val baos = ByteArrayOutputStream()\n                val inputStream: InputStream = conn.inputStream\n                val inputS = ByteArray(1024)\n                var len: Int\n                while (inputStream.read(inputS).also { len = it } &gt; -1) {\n                    baos.write(inputS, 0, len)\n                }\n                val content = String(baos.toByteArray())\n                baos.close()\n                inputStream.close()\n                conn.disconnect()\n                info1LiveData.postValue(content)\n                Log.d(TAG, \"net1: $content\")\n            } else {\n                info1LiveData.postValue(\"\u7f51\u7edc\u8bf7\u6c42\u51fa\u9519 $conn\")\n                Log.e(TAG, \"net1: \u7f51\u7edc\u8bf7\u6c42\u51fa\u9519 $conn\")\n            }\n        } catch (e: Exception) {\n            Log.e(TAG, \"reqGet: \", e)\n        }\n    }\n}\n</code></pre> \u770b\u4e00\u4e0b\u8fd9\u4e2a\u7f51\u7edc\u8bf7\u6c42\u7684\u6d41\u7a0b</p> <ol> <li>\u4ece\u4e3b\u7ebf\u7a0b\u8c03\u7528<code>reqGet()</code>\u51fd\u6570</li> <li><code>viewModelScope.launch(Dispatchers.IO)</code>\u5728\u534f\u7a0b\u4e0a\u53d1\u51fa\u7f51\u7edc\u8bf7\u6c42</li> <li>\u5728\u534f\u7a0b\u4e2d\u8fdb\u884c\u7f51\u7edc\u64cd\u4f5c\u3002\u628a\u7ed3\u679c\u53d1\u9001\u51fa\u53bb\u3002</li> </ol>"},{"location":"android/coroutines/intro1/#_5","title":"\u53c2\u8003","text":"<ul> <li>Android\u9879\u76ee\u4f7f\u7528kotlin</li> <li>MutableLiveData</li> <li>Kotlin\u534f\u7a0b\u4ecb\u7ecd</li> </ul> <p>??? note '\u672c\u6587\u4e5f\u53d1\u5e03\u5728'</p> <pre><code>[cnblog](https://www.cnblogs.com/rustfisher/p/15339044.html){.md-botton}\n[\u6398\u91d1](https://juejin.cn/post/7012167390926635038){.md-botton}\n[\u534e\u4e3a\u4e91](https://bbs.huaweicloud.com/blogs/329232){.md-botton}\n</code></pre>"},{"location":"android/drawable/selector/","title":"Android Button\uff0cTextView\u80cc\u666f\u589e\u6dfb\u52a8\u611f","text":"<p>\u524d\u9762\u6211\u4eec\u77e5\u9053\u4e86\u5982\u4f55\u653e\u7f6e\u4e00\u4e2aButton\u6309\u94ae\uff0c\u4e5f\u77e5\u9053\u4e86\u5982\u4f55\u7ed9Button\u8bbe\u7f6e\u80cc\u666f\u3002\u73b0\u5728\u6211\u4eec\u770b\u770b\u5982\u4f55\u7ed9\u6309\u94ae\u589e\u52a0\u52a8\u611f\u3002\u7ed9Button\uff0cTextView\u7684\u80cc\u666f\u548c\u5b57\u4f53\u989c\u8272\u3002</p> <p>Button\u6709\u6309\u4e0b(pressed)\u548c\u672a\u6309\u4e0b\u4e4b\u5206\uff0c\u6211\u4eec\u53ef\u7ed9\u8fd92\u79cd\u72b6\u6001\u4e0d\u540c\u7684\u80cc\u666f\u989c\u8272\u548c\u6587\u5b57\u989c\u8272\u3002 \u672c\u6587\u8981\u4ecb\u7ecd\u7684\u662f<code>selector</code>\uff0c\u5373\u72b6\u6001\u5217\u8868\u3002 \u548c\u524d\u9762\u7684shape\u7c7b\u4f3c\uff0c<code>selector</code>\u4e5f\u662f\u4e00\u4e2axml\u6587\u4ef6\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;selector xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n\n&lt;/selector&gt;\n</code></pre></p>"},{"location":"android/drawable/selector/#button","title":"\u8bbe\u7f6eButton\u80cc\u666f","text":""},{"location":"android/drawable/selector/#shape","title":"\u51c6\u5907shape\u6587\u4ef6","text":"<p>\u5148\u51c6\u5907shape\u6587\u4ef6\u3002\u8fd9\u91cc\u51c6\u59073\u4e2ashape\u3002\u5206\u522b\u4ee3\u88683\u4e2a\u4e0d\u540c\u7684\u72b6\u6001\u3002</p> <p><code>shape_btn_1_normal.xml</code> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;shape xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:shape=\"rectangle\"&gt;\n    &lt;solid android:color=\"#6CB3DD\" /&gt;\n    &lt;corners android:radius=\"2dp\" /&gt;\n&lt;/shape&gt;\n</code></pre></p> <p><code>shape_btn_1_pressed.xml</code> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;shape xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:shape=\"rectangle\"&gt;\n    &lt;solid android:color=\"#1E6283\" /&gt;\n    &lt;corners android:radius=\"4dp\" /&gt;\n&lt;/shape&gt;\n</code></pre></p> <p><code>shape_btn_disable.xml</code> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;shape xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:shape=\"rectangle\"&gt;\n    &lt;solid android:color=\"#6D6D6D\" /&gt;\n&lt;/shape&gt;\n</code></pre></p>"},{"location":"android/drawable/selector/#selector","title":"\u65b0\u5efaselector\u6587\u4ef6","text":"<p>\u65b0\u5efadrawable\u6587\u4ef6<code>bg_1.xml</code> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;selector xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n    &lt;item android:drawable=\"@drawable/shape_btn_disable\" android:state_enabled=\"false\" /&gt;\n    &lt;item android:drawable=\"@drawable/shape_btn_1_normal\" android:state_enabled=\"true\" android:state_pressed=\"false\" /&gt;\n    &lt;item android:drawable=\"@drawable/shape_btn_1_pressed\" android:state_enabled=\"true\" android:state_pressed=\"true\" /&gt;\n&lt;/selector&gt;\n</code></pre></p>"},{"location":"android/drawable/selector/#button_1","title":"\u8bbe\u7f6eButton\u80cc\u666f","text":"<p>\u5728layout\u4e2d\u8bbe\u7f6e\u80cc\u666f\u3002 <pre><code>    &lt;Button\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:background=\"@drawable/bg_1\"\n        android:text=\"RFDev btn 1\" /&gt;\n\n    &lt;Button\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginTop=\"12dp\"\n        android:background=\"@drawable/bg_1\"\n        android:enabled=\"false\"\n        android:text=\"RFDev btn 2\" /&gt;\n</code></pre></p> <p>\u8fd0\u884c\u4e00\u4e0b\u770b\u770b\u6548\u679c\u3002\u6309\u4e0b\u6309\u94ae\u548c\u6ca1\u6309\u4e0b\u7684\u65f6\u5019\uff0c\u6309\u94ae\u7684\u80cc\u666f\u989c\u8272\u662f\u4e0d\u540c\u7684\u3002</p>"},{"location":"android/drawable/selector/#selector_1","title":"selector\u4ecb\u7ecd","text":"<p>StateListDrawable \u662f\u5728 XML \u6587\u4ef6\u4e2d\u5b9a\u4e49\u7684\u53ef\u7ed8\u5236\u5bf9\u8c61\uff0c\u5b83\u4f1a\u6839\u636e\u5bf9\u8c61\u72b6\u6001\uff0c\u4f7f\u7528\u591a\u4e2a\u4e0d\u540c\u7684\u56fe\u50cf\u6765\u8868\u793a\u540c\u4e00\u4e2a\u56fe\u5f62\u3002\u4f8b\u5982\uff0cButton \u5fae\u4ef6\u53ef\u4ee5\u662f\u591a\u79cd\u4e0d\u540c\u72b6\u6001\uff08\u6309\u4e0b\u3001\u805a\u7126\u6216\u8fd9\u4e24\u79cd\u72b6\u6001\u90fd\u4e0d\u662f\uff09\u4e2d\u7684\u5176\u4e2d\u4e00\u79cd\uff0c\u5e76\u4e14\u60a8\u53ef\u5229\u7528\u72b6\u6001\u5217\u8868\u53ef\u7ed8\u5236\u5bf9\u8c61\uff0c\u4e3a\u6bcf\u79cd\u72b6\u6001\u63d0\u4f9b\u4e0d\u540c\u7684\u80cc\u666f\u56fe\u7247\u3002 \u60a8\u53ef\u4ee5\u5728 XML \u6587\u4ef6\u4e2d\u63cf\u8ff0\u72b6\u6001\u5217\u8868\u3002\u6bcf\u4e2a\u56fe\u5f62\u7531\u5355\u4e00 <code>&lt;selector&gt;</code> \u5143\u7d20\u5185\u7684 <code>&lt;item&gt;</code> \u5143\u7d20\u8868\u793a\u3002\u6bcf\u4e2a <code>&lt;item&gt;</code> \u5747\u4f7f\u7528\u5404\u79cd\u5c5e\u6027\u6765\u63cf\u8ff0\u5e94\u7528\u4f5c\u53ef\u7ed8\u5236\u5bf9\u8c61\u7684\u56fe\u5f62\u7684\u72b6\u6001\u3002 \u5728\u6bcf\u4e2a\u72b6\u6001\u53d8\u66f4\u671f\u95f4\uff0c\u5c06\u4ece\u4e0a\u5230\u4e0b\u904d\u5386\u72b6\u6001\u5217\u8868\uff0c\u5e76\u4f7f\u7528\u7b2c\u4e00\u4e2a\u4e0e\u5f53\u524d\u72b6\u6001\u5339\u914d\u7684\u9879\u76ee \u2014 \u6b64\u9009\u62e9\u5e76\u975e\u57fa\u4e8e\u201c\u6700\u4f73\u5339\u914d\u201d\uff0c\u800c\u662f\u9009\u62e9\u7b26\u5408\u72b6\u6001\u6700\u4f4e\u6761\u4ef6\u7684\u7b2c\u4e00\u4e2a\u9879\u76ee\u3002 selector\u6307\u5411\u7684\u662fStateListDrawable\uff0c\u8fd9\u91cc\u6211\u4eec\u4e0d\u5173\u6ce8StateListDrawable\uff0c\u53ea\u5173\u6ce8xml\u3002</p>"},{"location":"android/drawable/selector/#_1","title":"\u8bed\u6cd5","text":"<p>\u53c2\u8003\u5982\u4e0b\u8bed\u6cd5\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;selector xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:constantSize=[\"true\" | \"false\"]\n    android:dither=[\"true\" | \"false\"]\n    android:variablePadding=[\"true\" | \"false\"] &gt;\n    &lt;item\n        android:drawable=\"@[package:]drawable/drawable_resource\"\n        android:state_pressed=[\"true\" | \"false\"]\n        android:state_focused=[\"true\" | \"false\"]\n        android:state_hovered=[\"true\" | \"false\"]\n        android:state_selected=[\"true\" | \"false\"]\n        android:state_checkable=[\"true\" | \"false\"]\n        android:state_checked=[\"true\" | \"false\"]\n        android:state_enabled=[\"true\" | \"false\"]\n        android:state_activated=[\"true\" | \"false\"]\n        android:state_window_focused=[\"true\" | \"false\"] /&gt;\n&lt;/selector&gt;\n</code></pre></p> <p>\u66f4\u591a\u8bf7\u53c2\u8003 https://developer.android.google.cn/guide/topics/resources/drawable-resource#StateList</p>"},{"location":"android/drawable/selector/#_2","title":"\u4f7f\u7528\u6ce8\u610f\u4e8b\u9879","text":"<p>\u6211\u4eec\u53ef\u4ee5\u7ed9Button\u8bbe\u7f6e\u80cc\u666f\uff0c\u4e5f\u53ef\u4ee5\u7ed9TextView\u8bbe\u7f6e\u540c\u6837\u7684\u80cc\u666f\u3002 <pre><code>    &lt;TextView\n        android:id=\"@+id/tv1\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"50dp\"\n        android:layout_marginTop=\"12dp\"\n        android:background=\"@drawable/bg_1\"\n        android:gravity=\"center\"\n        android:text=\"RFDev text view 1\" /&gt;\n</code></pre></p> <p><code>bg_1</code>\u4e2d\u8bbe\u7f6e\u4e86<code>state_pressed</code>\u7684\u3002 \u5982\u679cTextView\u6ca1\u6709\u8bbe\u7f6e\u70b9\u51fb\u4e8b\u4ef6\uff0c\u7528\u6237\u70b9\u51fb\u6216\u6309\u7740\u8fd9\u4e2aTextView\u662f\u4e0d\u4f1a\u53d1\u751f\u80cc\u666f\u53d8\u5316\u7684\u3002 \u7ed9TextView\u8bbe\u7f6e\u70b9\u51fb\u4e8b\u4ef6\u540e\uff0c\u518d\u70b9\u51fb\u5c31\u53ef\u4ee5\u770b\u5230\u80cc\u666f\u53d8\u5316\u4e86\u3002</p> <p>\u672c\u6587\u6211\u4eec\u7528Button\u548cTextView\u6765\u505a\u4f8b\u5b50\u3002\u5b9e\u9645\u4e0aView\u7684\u5176\u5b83\u5b50\u7c7b\uff0c\u6bd4\u5982ImageView\uff0cLinearLayout\u90fd\u53ef\u4ee5\u7528\u8fd9\u79cd\u65b9\u5f0f\u8bbe\u7f6e\u80cc\u666f\u3002</p> <p>\u5de5\u7a0b\u653e\u8fd9\u91cc\uff1a https://gitee.com/rustfisher/AndroidTutorial</p>"},{"location":"android/drawable/shape/","title":"shape\u7684\u7ed8\u5236\u548c\u4f7f\u7528","text":"<p>\u5de5\u7a0b\u76ee\u5f55\u4e2d\u6709\u4e00\u4e2a<code>drawable</code>\u6587\u4ef6\u5939\uff0c\u91cc\u9762\u5b58\u653e\u7684\u662f\u4e00\u4e9b\u9759\u6001\u7684\u56fe\u7247\u8d44\u6e90\u6587\u4ef6\u3002 \u6bd4\u5982\u4f4d\u56fe\u6587\u4ef6\uff08.png\u3001.9.png\u3001.jpg\u3001.gif\uff09\uff1b\u6216\u4e00\u4e9b\u53ef\u7ed8\u5236\u5bf9\u8c61\u8d44\u6e90\u5b50\u7c7b\u578b\u7684 XML \u6587\u4ef6\uff08\u672c\u6587\u79f0\u4e3adrawable\u6587\u4ef6\uff09\u3002</p> <p>\u5f53\u6211\u4eec\u60f3\u7ed9button\u6216\u8005TextView\u8bbe\u5b9a\u80cc\u666f\u65f6\uff0c\u6211\u4eec\u4f1a\u60f3\u5230\u7eaf\u8272\u80cc\u666f\u3002\u5982\u679c\u8981\u6c42\u5706\u89d2\u80cc\u666f\uff0c\u6216\u662f\u6e10\u53d8\u8272\u80cc\u666f\uff0c\u6211\u4eec\u8be5\u5982\u4f55\u5b9e\u73b0\u5462\uff1f \u4e00\u79cd\u529e\u6cd5\u662f\u5236\u4f5c\u76f8\u5e94\u7684\u7f8e\u672f\u7d20\u6750\uff0c\u4e5f\u5c31\u662f\u5207\u56fe\u3002\u53e6\u4e00\u79cd\u529e\u6cd5\u662f\u4f7f\u7528xml\u683c\u5f0f\u7684\u8d44\u6e90\u6587\u4ef6\u3002 \u672c\u6587\u8981\u4ecb\u7ecd\u7684\u662f<code>shape</code>\u3002\u4f7f\u7528\u8fd9\u7c7b\u8d44\u6e90\uff0c\u53ef\u4ee5\u5b8c\u6210\u4e00\u4e9b\u6bd4\u8f83\u7b80\u5355\u7684\u7f8e\u672f\u8bbe\u8ba1\u3002</p>"},{"location":"android/drawable/shape/#_1","title":"\u4e00\u4e2a\u5c0f\u6817\u5b50\ud83c\udf30","text":"<p>\u63a5\u4e0b\u6765\u6211\u4eec\u65b0\u5efa\u4e00\u4e2ashape\u8bd5\u8bd5\uff0c\u8981\u6c42\u5e26\u6709\u5916\u56f4\u8fb9\u6846\uff0c\u6709\u5706\u89d2\uff0c\u91cc\u9762\u7528\u6e10\u53d8\u8272\u586b\u5145\u3002 \u5728<code>res/drawable/</code>\u76ee\u5f55\u4e2d\uff0c\u53f3\u952e\u65b0\u5efa\u4e00\u4e2aDrawable Resource file\u6587\u4ef6\uff0c\u8d77\u540d<code>shape_rect_gradient_red.xml</code>\u3002 root element\u9009\u62e9<code>shape</code>\u3002\u5b8c\u6574\u4ee3\u7801\u5199\u6210\u4e0b\u9762\u7684\u6837\u5b50\uff1a <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;shape xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:shape=\"rectangle\"&gt;\n    &lt;stroke\n        android:width=\"2dp\"\n        android:color=\"#0E30B1\" /&gt;\n    &lt;corners android:radius=\"6dp\" /&gt;\n    &lt;gradient\n        android:centerColor=\"#F55353\"\n        android:endColor=\"#F71515\"\n        android:startColor=\"#FD7575\" /&gt;\n&lt;/shape&gt;\n</code></pre> as\u7684\u53f3\u8fb9\u53ef\u4ee5\u6253\u5f00\u9884\u89c8\uff0c\u770b\u770b\u6548\u679c\u3002 \u5176\u4e2d<code>android:shape=\"rectangle\"</code>\u8868\u793a\u7684\u662f\u9009\u62e9\u957f\u65b9\u5f62\u7684\u5f62\u72b6\u3002 stroke\u6807\u7b7e\u4ee3\u8868\u7684\u662f\u8fb9\u6846\u3002\u91cc\u9762\u8bbe\u5b9a\u8fb9\u6846\u5bbd\u5ea6\u662f2dp\uff0c\u8fb9\u6846\u989c\u8272\u662f#0E30B1\u3002 corners\u6807\u7b7e\u4ee3\u8868\u7684\u662f\u5706\u89d2\u3002\u5982\u679c\u4e0d\u8bbe\u7f6e\uff0c\u5219\u9ed8\u8ba4\u4e3a\u76f4\u89d2\u3002\u8fd9\u91cc\u6211\u4eec\u8bbe\u5b9a\u5706\u89d2\u7684\u534a\u5f84\u4e3a6dp\u3002 gradient\u8868\u793a\u6e10\u53d8\u8272\u3002\u5206\u522b\u53ef\u4ee5\u8bbe\u7f6e\u8d77\u59cb\uff0c\u4e2d\u95f4\u548c\u7ed3\u675f\u7684\u989c\u8272\u503c\u3002</p> <p>\u5728layout\u4e2d\uff0c\u7ed9Button\u7684background\u8bbe\u7f6e\u4f7f\u7528\u8fd9\u4e2ashape\u3002xml\u7684\u6587\u4ef6\u540d\u5c31\u662f\u5b83\u7684\u8d44\u6e90\u540d\u79f0\u3002 <pre><code>    &lt;Button\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:background=\"@drawable/shape_rect_gradient_red\" /&gt;\n</code></pre> \u518d\u7a0d\u5fae\u5b8c\u5584\u4e00\u4e0b\u8fd9\u4e2aButton\u3002 <pre><code>    &lt;Button\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:background=\"@drawable/shape_rect_gradient_red\"\n        android:text=\"RFDev btn 1\"\n        android:textAllCaps=\"false\"\n        android:textColor=\"#ffffff\" /&gt;\n</code></pre></p> <p>\u8fd0\u884c\u4e00\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230\u6548\u679c\u3002 </p>"},{"location":"android/drawable/shape/#shape_1","title":"shape\u4ecb\u7ecd","text":"<p>shape\u53c8\u79f0\u4e3a\u201c\u5f62\u72b6\u53ef\u7ed8\u5236\u5bf9\u8c61\u201d\u3002\u4e3a\u4e86\u7b80\u4fbf\uff0c\u4ee5\u4e0b\u90fd\u79f0\u4f5cshape\u6216\u8005\u201cshape\u6587\u4ef6\u201d\u3002 shape\u662f\u4e00\u79cd\u5728 XML \u6587\u4ef6\u4e2d\u5b9a\u4e49\u7684\u901a\u7528\u5f62\u72b6\u3002\u7ecf\u8fc7\u7f16\u8bd1\u540e\uff0c\u53ef\u4ee5\u5f97\u5230GradientDrawable\u5bf9\u8c61\u3002</p>"},{"location":"android/drawable/shape/#_2","title":"\u8d44\u6e90\u5f15\u7528","text":"<p>\u5728 Java \u4e2d\uff1aR.drawable.filename</p> <p>\u5728 XML \u4e2d\uff1a@[package:]drawable/filename</p>"},{"location":"android/drawable/shape/#_3","title":"\u8bed\u6cd5","text":"<p>\u4e0a\u9762\u90a3\u4e2a\u6817\u5b50\u6211\u4eec\u8ba4\u8bc6\u4e86\u51e0\u4e2a\u5143\u7d20\uff0cgradient\uff0ccorners\u548cstroke\u3002\u4e0b\u9762\u662f\u8bed\u6cd5\u7684\u8be6\u7ec6\u4ecb\u7ecd\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;shape\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:shape=[\"rectangle\" | \"oval\" | \"line\" | \"ring\"] &gt;\n    &lt;corners\n        android:radius=\"integer\"\n        android:topLeftRadius=\"integer\"\n        android:topRightRadius=\"integer\"\n        android:bottomLeftRadius=\"integer\"\n        android:bottomRightRadius=\"integer\" /&gt;\n    &lt;gradient\n        android:angle=\"integer\"\n        android:centerX=\"float\"\n        android:centerY=\"float\"\n        android:centerColor=\"integer\"\n        android:endColor=\"color\"\n        android:gradientRadius=\"integer\"\n        android:startColor=\"color\"\n        android:type=[\"linear\" | \"radial\" | \"sweep\"]\n        android:useLevel=[\"true\" | \"false\"] /&gt;\n    &lt;padding\n        android:left=\"integer\"\n        android:top=\"integer\"\n        android:right=\"integer\"\n        android:bottom=\"integer\" /&gt;\n    &lt;size\n        android:width=\"integer\"\n        android:height=\"integer\" /&gt;\n    &lt;solid\n        android:color=\"color\" /&gt;\n    &lt;stroke\n        android:width=\"integer\"\n        android:color=\"color\"\n        android:dashWidth=\"integer\"\n        android:dashGap=\"integer\" /&gt;\n&lt;/shape&gt;\n</code></pre></p> <p>\u8be6\u7ec6\u5143\u7d20\u4ecb\u7ecd\u8bf7\u53c2\u89c1 https://developer.android.google.cn/guide/topics/resources/drawable-resource.html#Shape</p>"},{"location":"android/drawable/shape/#_4","title":"\u5706\u89d2\u80cc\u666f\u7684\u6817\u5b50\ud83c\udf30","text":"<p>\u4e0a\u6587\u4ecb\u7ecd\u4e86corners\u7684\u7528\u6cd5\u3002\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u5706\u89d2\u80cc\u666f\u7684\u5b9e\u73b0\u65b9\u6cd5\u3002 \u65b0\u5efa\u6587\u4ef6<code>shape_btn_2_normal.xml</code> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;shape xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:shape=\"rectangle\"&gt;\n    &lt;solid android:color=\"#6CB3DD\" /&gt;\n    &lt;corners android:radius=\"25dp\" /&gt;\n&lt;/shape&gt;\n</code></pre></p> <p>\u5728layout\u4e2d\u7ed9TextView\u4f7f\u7528\u8fd9\u4e2a\u80cc\u666f\u3002 <pre><code>    &lt;TextView\n        android:id=\"@+id/tv1\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"50dp\"\n        android:background=\"@drawable/shape_btn_2_normal\"\n        android:gravity=\"center\"\n        android:text=\"RFDev \u5706\u89d2\u80cc\u666fTextView 1\"\n        android:textColor=\"#ffffff\" /&gt;\n</code></pre> TextView\u7684\u9ad8\u5ea6\u8bbe\u7f6e\u6210\u4e8650dp\uff0c\u800c\u80cc\u666f\u7684\u5706\u89d2\u534a\u5f84\u8bbe\u7f6e\u6210\u4e8625dp\u3002 \u8fd0\u884c\u53ef\u4ee5\u770b\u5230\u6548\u679c\u3002</p> <p></p> <p>\u5982\u679c\u60f3\u8981\u6e10\u53d8\u8272\uff0c\u518d\u589e\u52a0gradient\u7684\u8bbe\u7f6e\u5c31\u597d\u3002</p>"},{"location":"android/drawable/shape/#_5","title":"\u4ee3\u7801\u4e2d\u4f7f\u7528\u8d44\u6e90","text":"<p>\u5728java\u4ee3\u7801\u4e2d\u4f7f\u7528\u8d44\u6e90\uff0c\u6bd4\u5982\u5728activity\u4e2d\u8bbe\u7f6e\u80cc\u666f\u3002 <pre><code>Resources res = getResources();\nDrawable shape = ResourcesCompat.getDrawable(res, R.drawable.shape_btn_2_normal, getTheme());\n\nTextView tv = (TextView)findViewById(R.id.tv1);\ntv.setBackground(shape);\n</code></pre></p> <p>\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e9b\u7b80\u5355\u7684\u6309\u94ae\u6548\u679c\u3002\u66f4\u590d\u6742\u7684\u989c\u8272\u548c\u6548\u679c\uff0c\u9700\u8981\u7f8e\u672f\u8bbe\u8ba1\u5e08\u7684\u652f\u6301\u3002</p> <p>\u5de5\u7a0b\u653e\u8fd9\u91cc\uff1a https://gitee.com/rustfisher/AndroidTutorial</p>"},{"location":"android/drawable/shape/#_6","title":"\u73af\u5f62\u7684\u6817\u5b50\ud83c\udf30","text":"<p>\u5c3a\u5bf8\u548c\u957f\u5ea6\u81ea\u5df1\u8bbe\u5b9a\u3002</p> <p>\u73af\u5f62 <code>thumb_round_1.xml</code>\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;shape xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:shape=\"oval\"&gt;\n    &lt;solid android:color=\"#ffffff\" /&gt;\n    &lt;stroke\n        android:width=\"@dimen/audio_seek_bar_thumb_ring_width\"\n        android:color=\"#7095fc\" /&gt;\n    &lt;size\n        android:width=\"@dimen/audio_seek_bar_thumb_size\"\n        android:height=\"@dimen/audio_seek_bar_thumb_size\" /&gt;\n&lt;/shape&gt;\n</code></pre></p> <p>\u5e26\u6e10\u53d8\u7684\u73af\u5f62 <code>thumb_round_progress_1.xml</code>\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layer-list xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n    &lt;item&gt;\n        &lt;shape android:shape=\"oval\"&gt;\n            &lt;size\n                android:width=\"@dimen/audio_seek_bar_thumb_size\"\n                android:height=\"@dimen/audio_seek_bar_thumb_size\" /&gt;\n            &lt;solid android:color=\"#ffffff\" /&gt;\n        &lt;/shape&gt;\n    &lt;/item&gt;\n    &lt;item&gt;\n        &lt;shape\n            android:innerRadius=\"4dp\"\n            android:thicknessRatio=\"6\"\n            android:shape=\"ring\"\n            android:useLevel=\"false\"&gt;\n            &lt;gradient\n                android:endColor=\"#ffffff\"\n                android:startColor=\"#7095fc\"\n                android:type=\"sweep\" /&gt;\n            &lt;size\n                android:width=\"@dimen/audio_seek_bar_thumb_size\"\n                android:height=\"@dimen/audio_seek_bar_thumb_size\" /&gt;\n        &lt;/shape&gt;\n    &lt;/item&gt;\n&lt;/layer-list&gt;\n</code></pre></p> <p>\u5de5\u7a0b\u653e\u8fd9\u91cc\uff1a https://gitee.com/rustfisher/AndroidTutorial</p>"},{"location":"android/fragment/fragment-intro/","title":"Fragment \u57fa\u7840\u6982\u5ff5","text":"<p>\u672c\u6587\u4ecb\u7ecdFragment\u7684\u4e00\u4e9b\u57fa\u672c\u6982\u5ff5\u3002\u4f8b\u5982\u751f\u547d\u5468\u671f\uff0c\u52a0\u8f7d\u65b9\u5f0f\u7b49\u3002</p>"},{"location":"android/fragment/fragment-intro/#fragment_1","title":"\u4ec0\u4e48\u662fFragment","text":"<p>Fragment\uff0c\u76f4\u8bd1\u4e3a\u201c\u788e\u7247\u201d\uff0c\u201c\u7247\u6bb5\u201d\u3002 Fragment \u8868\u793a FragmentActivity \u4e2d\u7684\u884c\u4e3a\u6216\u754c\u9762\u7684\u4e00\u90e8\u5206\u3002\u60a8\u53ef\u4ee5\u5728\u4e00\u4e2a Activity \u4e2d\u7ec4\u5408\u591a\u4e2a\u7247\u6bb5\uff0c\u4ece\u800c\u6784\u5efa\u591a\u7a97\u683c\u754c\u9762\uff0c\u5e76\u5728\u591a\u4e2a Activity \u4e2d\u91cd\u590d\u4f7f\u7528\u67d0\u4e2a\u7247\u6bb5\u3002\u60a8\u53ef\u4ee5\u5c06\u7247\u6bb5\u89c6\u4e3a Activity \u7684\u6a21\u5757\u5316\u7ec4\u6210\u90e8\u5206\uff0c\u5b83\u5177\u6709\u81ea\u5df1\u7684\u751f\u547d\u5468\u671f\uff0c\u80fd\u63a5\u6536\u81ea\u5df1\u7684\u8f93\u5165\u4e8b\u4ef6\uff0c\u5e76\u4e14\u60a8\u53ef\u4ee5\u5728 Activity \u8fd0\u884c\u65f6\u6dfb\u52a0\u6216\u79fb\u9664\u7247\u6bb5\uff08\u8fd9\u6709\u70b9\u50cf\u53ef\u4ee5\u5728\u4e0d\u540c Activity \u4e2d\u91cd\u590d\u4f7f\u7528\u7684\u201c\u5b50 Activity\u201d\uff09\u3002</p> <p>\u7247\u6bb5\u5fc5\u987b\u59cb\u7ec8\u6258\u7ba1\u5728 Activity \u4e2d\uff0c\u5176\u751f\u547d\u5468\u671f\u76f4\u63a5\u53d7\u5bbf\u4e3b Activity \u751f\u547d\u5468\u671f\u7684\u5f71\u54cd\u3002\u4f8b\u5982\uff0c\u5f53 Activity \u6682\u505c\u65f6\uff0cActivity \u7684\u6240\u6709\u7247\u6bb5\u4e5f\u4f1a\u6682\u505c\uff1b\u5f53 Activity \u88ab\u9500\u6bc1\u65f6\uff0c\u6240\u6709\u7247\u6bb5\u4e5f\u4f1a\u88ab\u9500\u6bc1\u3002\u4e0d\u8fc7\uff0c\u5f53 Activity \u6b63\u5728\u8fd0\u884c\uff08\u5904\u4e8e\u5df2\u6062\u590d\u751f\u547d\u5468\u671f\u72b6\u6001\uff09\u65f6\uff0c\u60a8\u53ef\u4ee5\u72ec\u7acb\u64cd\u7eb5\u6bcf\u4e2a\u7247\u6bb5\uff0c\u5982\u6dfb\u52a0\u6216\u79fb\u9664\u7247\u6bb5\u3002\u5f53\u6267\u884c\u6b64\u7c7b\u7247\u6bb5\u4e8b\u52a1\u65f6\uff0c\u60a8\u4e5f\u53ef\u5c06\u5176\u6dfb\u52a0\u5230\u7531 Activity \u7ba1\u7406\u7684\u8fd4\u56de\u6808 \u2014 Activity \u4e2d\u7684\u6bcf\u4e2a\u8fd4\u56de\u6808\u6761\u76ee\u90fd\u662f\u4e00\u6761\u5df2\u53d1\u751f\u7247\u6bb5\u4e8b\u52a1\u7684\u8bb0\u5f55\u3002\u501f\u52a9\u8fd4\u56de\u6808\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u6309\u8fd4\u56de\u6309\u94ae\u64a4\u6d88\u7247\u6bb5\u4e8b\u52a1\uff08\u540e\u9000\uff09\u3002</p> <p>\u5f53\u60a8\u5c06\u7247\u6bb5\u4f5c\u4e3a Activity \u5e03\u5c40\u7684\u4e00\u90e8\u5206\u6dfb\u52a0\u65f6\uff0c\u5176\u4f4d\u4e8e Activity \u89c6\u56fe\u5c42\u6b21\u7ed3\u6784\u7684\u67d0\u4e2a ViewGroup \u4e2d\uff0c\u5e76\u4e14\u7247\u6bb5\u4f1a\u5b9a\u4e49\u5176\u81ea\u5df1\u7684\u89c6\u56fe\u5e03\u5c40\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u5728 Activity \u7684\u5e03\u5c40\u6587\u4ef6\u4e2d\u58f0\u660e\u7247\u6bb5\uff0c\u5c06\u5176\u4f5c\u4e3a  \u5143\u7d20\u63d2\u5165\u60a8\u7684 Activity \u5e03\u5c40\uff0c\u6216\u8005\u901a\u8fc7\u5c06\u5176\u6dfb\u52a0\u5230\u67d0\u4e2a\u73b0\u6709\u7684 ViewGroup\uff0c\u5229\u7528\u5e94\u7528\u4ee3\u7801\u5c06\u5176\u63d2\u5165\u5e03\u5c40\u3002 <p>\u672c\u6587\u4ecb\u7ecd\u5982\u4f55\u5728\u5f00\u53d1\u5e94\u7528\u65f6\u4f7f\u7528\u7247\u6bb5\uff0c\u5305\u62ec\u5982\u4f55\u5728\u5c06\u7247\u6bb5\u6dfb\u52a0\u5230 Activity \u8fd4\u56de\u6808\u65f6\u4fdd\u6301\u5176\u72b6\u6001\u3001\u5982\u4f55\u4e0e Activity \u53ca Activity \u4e2d\u7684\u5176\u4ed6\u7247\u6bb5\u5171\u4eab\u4e8b\u4ef6\u3001\u5982\u4f55\u4e3a Activity \u7684\u5e94\u7528\u680f\u53d1\u6325\u4f5c\u7528\u7b49\u7b49\u3002</p>"},{"location":"android/fragment/fragment-intro/#fragment_2","title":"Fragment\u7684\u4f18\u70b9","text":"<ul> <li>Fragment\u52a0\u8f7d\u7075\u6d3b\uff0c\u66ff\u6362\u65b9\u4fbf\u3002\u5b9a\u5236\u4f60\u7684UI\uff0c\u5728\u4e0d\u540c\u5c3a\u5bf8\u7684\u5c4f\u5e55\u4e0a\u521b\u5efa\u5408\u9002\u7684UI\uff0c\u63d0\u9ad8\u7528\u6237\u4f53\u9a8c\u3002</li> <li>\u53ef\u590d\u7528\uff0c\u9875\u9762\u5e03\u5c40\u53ef\u4ee5\u4f7f\u7528\u591a\u4e2aFragment\uff0c\u4e0d\u540c\u7684\u63a7\u4ef6\u548c\u5185\u5bb9\u53ef\u4ee5\u5206\u5e03\u5728\u4e0d\u540c\u7684Fragment\u4e0a\u3002</li> <li>\u4f7f\u7528Fragment\uff0c\u53ef\u4ee5\u5c11\u7528\u4e00\u4e9bActivity\u3002\u4e00\u4e2aActivity\u53ef\u4ee5\u7ba1\u8f96\u591a\u4e2aFragment\u3002</li> </ul>"},{"location":"android/fragment/fragment-intro/#fragment_3","title":"Fragment\u751f\u547d\u5468\u671f","text":"<p>Fragment \u7c7b\u7684\u4ee3\u7801\u4e0e Activity \u975e\u5e38\u76f8\u4f3c\u3002\u5b83\u5305\u542b\u4e0e Activity \u7c7b\u4f3c\u7684\u56de\u8c03\u65b9\u6cd5\uff0c\u5982 onCreate()\u3001onStart()\u3001onPause() \u548c onStop()\u3002\u5b9e\u9645\u4e0a\uff0c\u5982\u679c\u60a8\u8981\u5c06\u73b0\u6709 Android \u5e94\u7528\u8f6c\u6362\u4e3a\u4f7f\u7528\u7247\u6bb5\uff0c\u53ef\u80fd\u53ea\u9700\u5c06\u4ee3\u7801\u4ece Activity \u7684\u56de\u8c03\u65b9\u6cd5\u79fb\u5165\u7247\u6bb5\u76f8\u5e94\u7684\u56de\u8c03\u65b9\u6cd5\u4e2d\u3002</p> <p>\u901a\u5e38\uff0c\u60a8\u81f3\u5c11\u5e94\u5b9e\u73b0\u4ee5\u4e0b\u751f\u547d\u5468\u671f\u65b9\u6cd5\uff1a - <code>onCreate()</code> \u7cfb\u7edf\u4f1a\u5728\u521b\u5efa\u7247\u6bb5\u65f6\u8c03\u7528\u6b64\u65b9\u6cd5\u3002\u5f53\u7247\u6bb5\u7ecf\u5386\u6682\u505c\u6216\u505c\u6b62\u72b6\u6001\u7ee7\u800c\u6062\u590d\u540e\uff0c\u5982\u679c\u60a8\u5e0c\u671b\u4fdd\u7559\u6b64\u7247\u6bb5\u7684\u57fa\u672c\u7ec4\u4ef6\uff0c\u5219\u5e94\u5728\u60a8\u7684\u5b9e\u73b0\u4e2d\u5c06\u5176\u521d\u59cb\u5316\u3002 - <code>onCreateView()</code> \u7cfb\u7edf\u4f1a\u5728\u7247\u6bb5\u9996\u6b21\u7ed8\u5236\u5176\u754c\u9762\u65f6\u8c03\u7528\u6b64\u65b9\u6cd5\u3002\u5982\u8981\u4e3a\u60a8\u7684\u7247\u6bb5\u7ed8\u5236\u754c\u9762\uff0c\u60a8\u4ece\u6b64\u65b9\u6cd5\u4e2d\u8fd4\u56de\u7684 View \u5fc5\u987b\u662f\u7247\u6bb5\u5e03\u5c40\u7684\u6839\u89c6\u56fe\u3002\u5982\u679c\u7247\u6bb5\u672a\u63d0\u4f9b\u754c\u9762\uff0c\u60a8\u53ef\u4ee5\u8fd4\u56de null\u3002 - <code>onPause()</code> \u7cfb\u7edf\u4f1a\u5c06\u6b64\u65b9\u6cd5\u4f5c\u4e3a\u7528\u6237\u79bb\u5f00\u7247\u6bb5\u7684\u7b2c\u4e00\u4e2a\u4fe1\u53f7\uff08\u4f46\u5e76\u4e0d\u603b\u662f\u610f\u5473\u7740\u6b64\u7247\u6bb5\u4f1a\u88ab\u9500\u6bc1\uff09\u8fdb\u884c\u8c03\u7528\u3002\u901a\u5e38\uff0c\u60a8\u5e94\u5728\u6b64\u65b9\u6cd5\u5185\u786e\u8ba4\u5728\u5f53\u524d\u7528\u6237\u4f1a\u8bdd\u7ed3\u675f\u540e\u4ecd\u7136\u6709\u6548\u7684\u4efb\u4f55\u66f4\u6539\uff08\u56e0\u4e3a\u7528\u6237\u53ef\u80fd\u4e0d\u4f1a\u8fd4\u56de\uff09\u3002</p> <p>\u60a8\u53ef\u80fd\u8fd8\u60f3\u6269\u5c55\u51e0\u4e2a\u5b50\u7c7b\uff0c\u800c\u975e Fragment \u57fa\u7c7b\uff1a</p> <ul> <li><code>DialogFragment</code> \u663e\u793a\u6d6e\u52a8\u5bf9\u8bdd\u6846\u3002\u4f7f\u7528\u6b64\u7c7b\u521b\u5efa\u5bf9\u8bdd\u6846\u53ef\u6709\u6548\u4ee3\u66ff\u4f7f\u7528 Activity \u7c7b\u4e2d\u7684\u5bf9\u8bdd\u6846\u8f85\u52a9\u65b9\u6cd5\uff0c\u56e0\u4e3a\u60a8\u53ef\u4ee5\u5c06\u7247\u6bb5\u5bf9\u8bdd\u6846\u7eb3\u5165\u7531 Activity \u7ba1\u7406\u7684\u7247\u6bb5\u8fd4\u56de\u6808\uff0c\u4ece\u800c\u4f7f\u7528\u6237\u80fd\u591f\u8fd4\u56de\u6e05\u9664\u7684\u7247\u6bb5\u3002</li> <li><code>ListFragment</code> \u663e\u793a\u7531\u9002\u914d\u5668\uff08\u5982 SimpleCursorAdapter\uff09\u7ba1\u7406\u7684\u4e00\u7cfb\u5217\u9879\u76ee\uff0c\u7c7b\u4f3c\u4e8e ListActivity\u3002\u8be5\u7c7b\u63d0\u4f9b\u51e0\u79cd\u7ba1\u7406\u5217\u8868\u89c6\u56fe\u7684\u65b9\u6cd5\uff0c\u5982\u7528\u4e8e\u5904\u7406\u70b9\u51fb\u4e8b\u4ef6\u7684 onListItemClick() \u56de\u8c03\u3002\uff08\u8bf7\u6ce8\u610f\uff0c\u663e\u793a\u5217\u8868\u7684\u9996\u9009\u65b9\u6cd5\u662f\u4f7f\u7528 RecyclerView\uff0c\u800c\u975e ListView\u3002\u5728\u6b64\u60c5\u51b5\u4e0b\uff0c\u60a8\u9700\u5728\u5217\u8868\u5e03\u5c40\u4e2d\u521b\u5efa\u5305\u542b RecyclerView \u7684\u7247\u6bb5\u3002\u5982\u9700\u4e86\u89e3\u5177\u4f53\u64cd\u4f5c\u65b9\u6cd5\uff0c\u8bf7\u53c2\u9605\u4f7f\u7528 RecyclerView \u521b\u5efa\u5217\u8868\uff09</li> <li><code>PreferenceFragmentCompat</code> \u4ee5\u5217\u8868\u5f62\u5f0f\u663e\u793a Preference \u5bf9\u8c61\u7684\u5c42\u6b21\u7ed3\u6784\u3002\u6b64\u7c7b\u7528\u4e8e\u4e3a\u60a8\u7684\u5e94\u7528\u521b\u5efa\u8bbe\u7f6e\u5c4f\u5e55\u3002</li> </ul>"},{"location":"android/fragment/fragment-intro/#fragment_4","title":"\u521b\u5efaFragment\uff0c\u4f7f\u7528\u81ea\u5b9a\u4e49\u754c\u9762","text":"<p>\u7247\u6bb5\u901a\u5e38\u7528\u4f5c Activity \u754c\u9762\u7684\u4e00\u90e8\u5206\uff0c\u5e76\u4e14\u4f1a\u5c06\u5176\u81ea\u5df1\u7684\u5e03\u5c40\u878d\u5165 Activity\u3002</p> <p>\u5982\u8981\u4e3a\u7247\u6bb5\u63d0\u4f9b\u5e03\u5c40\uff0c\u60a8\u5fc5\u987b\u5b9e\u73b0 <code>onCreateView()</code> \u56de\u8c03\u65b9\u6cd5\uff0cAndroid \u7cfb\u7edf\u4f1a\u5728\u7247\u6bb5\u9700\u8981\u7ed8\u5236\u5176\u5e03\u5c40\u65f6\u8c03\u7528\u8be5\u65b9\u6cd5\u3002\u6b64\u65b9\u6cd5\u7684\u5b9e\u73b0\u6240\u8fd4\u56de\u7684 View \u5fc5\u987b\u662f\u7247\u6bb5\u5e03\u5c40\u7684\u6839\u89c6\u56fe\u3002</p> <p>\u5982\u8981\u4ece onCreateView() \u8fd4\u56de\u5e03\u5c40\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7 XML \u4e2d\u5b9a\u4e49\u7684\u5e03\u5c40\u8d44\u6e90\u6765\u6269\u5c55\u5e03\u5c40\u3002\u4e3a\u5e2e\u52a9\u60a8\u6267\u884c\u6b64\u64cd\u4f5c\uff0conCreateView() \u63d0\u4f9b\u4e86\u4e00\u4e2a LayoutInflater \u5bf9\u8c61\u3002</p> <p>\u4f8b\u5982\uff0c\u4ee5\u4e0b\u8fd9\u4e2a Fragment \u5b50\u7c7b\u4ece <code>example_fragment.xml</code> \u6587\u4ef6\u52a0\u8f7d\u5e03\u5c40\uff1a <pre><code>public static class ExampleFragment extends Fragment {\n    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\n                             Bundle savedInstanceState) {\n        // Inflate the layout for this fragment\n        return inflater.inflate(R.layout.example_fragment, container, false);\n    }\n}\n</code></pre> \u4f20\u9012\u81f3 <code>onCreateView()</code> \u7684 container \u53c2\u6570\u662f\u60a8\u7684\u7247\u6bb5\u5e03\u5c40\u5c06\u63d2\u5165\u5230\u7684\u7236\u7ea7 ViewGroup\uff08\u6765\u81ea Activity \u7684\u5e03\u5c40\uff09\u3002savedInstanceState \u53c2\u6570\u662f\u5728\u6062\u590d\u7247\u6bb5\u65f6\uff0c\u63d0\u4f9b\u4e0a\u4e00\u7247\u6bb5\u5b9e\u4f8b\u76f8\u5173\u6570\u636e\u7684 Bundle\uff08\u5904\u7406\u7247\u6bb5\u751f\u547d\u5468\u671f\u90e8\u5206\u5bf9\u6062\u590d\u72b6\u6001\u505a\u4e86\u8be6\u7ec6\u9610\u8ff0\uff09\u3002</p> <p>inflate() \u65b9\u6cd5\u5e26\u6709\u4e09\u4e2a\u53c2\u6570\uff1a * \u60a8\u60f3\u8981\u6269\u5c55\u7684\u5e03\u5c40\u7684\u8d44\u6e90 ID\u3002 * \u5c06\u4f5c\u4e3a\u6269\u5c55\u5e03\u5c40\u7236\u9879\u7684 ViewGroup\u3002\u4f20\u9012 container \u5bf9\u7cfb\u7edf\u5411\u6269\u5c55\u5e03\u5c40\u7684\u6839\u89c6\u56fe\uff08\u7531\u5176\u6240\u5c5e\u7684\u7236\u89c6\u56fe\u6307\u5b9a\uff09\u5e94\u7528\u5e03\u5c40\u53c2\u6570\u5177\u6709\u91cd\u8981\u610f\u4e49\u3002 * \u6307\u793a\u662f\u5426\u5e94\u5728\u6269\u5c55\u671f\u95f4\u5c06\u6269\u5c55\u5e03\u5c40\u9644\u52a0\u81f3 ViewGroup\uff08\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff09\u7684\u5e03\u5c14\u503c\u3002\uff08\u5728\u672c\u4f8b\u4e2d\uff0c\u6b64\u503c\u4e3a false\uff0c\u56e0\u4e3a\u7cfb\u7edf\u5df2\u5c06\u6269\u5c55\u5e03\u5c40\u63d2\u5165 container\uff0c\u800c\u4f20\u9012 true \u503c\u4f1a\u5728\u6700\u7ec8\u5e03\u5c40\u4e2d\u521b\u5efa\u4e00\u4e2a\u591a\u4f59\u7684\u89c6\u56fe\u7ec4\u3002\uff09</p> <p>\u73b0\u5728\uff0c\u60a8\u5df2\u4e86\u89e3\u5982\u4f55\u521b\u5efa\u63d0\u4f9b\u5e03\u5c40\u7684\u7247\u6bb5\u3002\u63a5\u4e0b\u6765\uff0c\u60a8\u9700\u5c06\u8be5\u7247\u6bb5\u6dfb\u52a0\u5230\u60a8\u7684 Activity \u4e2d\u3002</p>"},{"location":"android/fragment/fragment-intro/#activityfragment","title":"\u5411Activity\u6dfb\u52a0Fragment","text":"<p>\u901a\u5e38\uff0c\u7247\u6bb5\u4f1a\u5411\u5bbf\u4e3b Activity \u8d21\u732e\u4e00\u90e8\u5206\u754c\u9762\uff0c\u4f5c\u4e3a Activity \u6574\u4f53\u89c6\u56fe\u5c42\u6b21\u7ed3\u6784\u7684\u4e00\u90e8\u5206\u5d4c\u5165\u5230 Activity \u4e2d\u3002\u53ef\u4ee5\u901a\u8fc7\u4e24\u79cd\u65b9\u5f0f\u5411 Activity \u5e03\u5c40\u6dfb\u52a0\u7247\u6bb5\uff08\u4ee5\u4e0b\u4e3a\u4ee3\u7801\u7247\u6bb5\uff0c\u5e76\u975e\u5b8c\u6574\u4ee3\u7801\uff09\u3002</p>"},{"location":"android/fragment/fragment-intro/#_1","title":"\u9759\u6001\u65b9\u5f0f","text":"<p>\u5728 Activity \u7684\u5e03\u5c40\u6587\u4ef6\u5185\u58f0\u660e\u7247\u6bb5\u3002 \u5728\u672c\u4f8b\u4e2d\uff0c\u60a8\u53ef\u4ee5\u5c06\u7247\u6bb5\u5f53\u4f5c\u89c6\u56fe\u6765\u4e3a\u5176\u6307\u5b9a\u5e03\u5c40\u5c5e\u6027\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u662f\u62e5\u6709\u4e24\u4e2a\u7247\u6bb5\u7684 Activity \u7684\u5e03\u5c40\u6587\u4ef6\uff1a <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:orientation=\"horizontal\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"&gt;\n    &lt;fragment android:name=\"com.example.news.ArticleListFragment\"\n            android:id=\"@+id/list\"\n            android:layout_weight=\"1\"\n            android:layout_width=\"0dp\"\n            android:layout_height=\"match_parent\" /&gt;\n    &lt;fragment android:name=\"com.example.news.ArticleReaderFragment\"\n            android:id=\"@+id/viewer\"\n            android:layout_weight=\"2\"\n            android:layout_width=\"0dp\"\n            android:layout_height=\"match_parent\" /&gt;\n&lt;/LinearLayout&gt;\n</code></pre> <code>&lt;fragment&gt;</code> \u4e2d\u7684 <code>android:name</code> \u5c5e\u6027\u6307\u5b9a\u8981\u5728\u5e03\u5c40\u4e2d\u8fdb\u884c\u5b9e\u4f8b\u5316\u7684 Fragment \u7c7b\u3002</p> <p>\u521b\u5efa\u6b64 Activity \u5e03\u5c40\u65f6\uff0c\u7cfb\u7edf\u4f1a\u5c06\u5e03\u5c40\u4e2d\u6307\u5b9a\u7684\u6bcf\u4e2a\u7247\u6bb5\u5b9e\u4f8b\u5316\uff0c\u5e76\u4e3a\u6bcf\u4e2a\u7247\u6bb5\u8c03\u7528 <code>onCreateView()</code> \u65b9\u6cd5\uff0c\u4ee5\u68c0\u7d22\u6bcf\u4e2a\u7247\u6bb5\u7684\u5e03\u5c40\u3002\u7cfb\u7edf\u4f1a\u76f4\u63a5\u63d2\u5165\u7247\u6bb5\u8fd4\u56de\u7684 View\uff0c\u4ece\u800c\u4ee3\u66ff <code>&lt;fragment&gt;</code> \u5143\u7d20\u3002</p> <p>\u6ce8\u610f\uff1a\u6bcf\u4e2a\u7247\u6bb5\u90fd\u9700\u8981\u552f\u4e00\u6807\u8bc6\u7b26\uff0c\u91cd\u542f Activity \u65f6\uff0c\u7cfb\u7edf\u53ef\u4f7f\u7528\u8be5\u6807\u8bc6\u7b26\u6765\u6062\u590d\u7247\u6bb5\uff08\u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528\u8be5\u6807\u8bc6\u7b26\u6765\u6355\u83b7\u7247\u6bb5\uff0c\u4ece\u800c\u6267\u884c\u67d0\u4e9b\u4e8b\u52a1\uff0c\u5982\u5c06\u5176\u79fb\u9664\uff09\u3002\u53ef\u4ee5\u901a\u8fc7\u4e24\u79cd\u65b9\u5f0f\u4e3a\u7247\u6bb5\u63d0\u4f9b ID\uff1a \u4e3a android:id \u5c5e\u6027\u63d0\u4f9b\u552f\u4e00 ID\u3002 \u4e3a android:tag \u5c5e\u6027\u63d0\u4f9b\u552f\u4e00\u5b57\u7b26\u4e32\u3002</p>"},{"location":"android/fragment/fragment-intro/#javafragment","title":"Java\u4ee3\u7801\u52a0\u8f7dFragment","text":"<p>\u6216\u8005\uff0c\u901a\u8fc7\u7f16\u7a0b\u65b9\u5f0f\u5c06\u7247\u6bb5\u6dfb\u52a0\u5230\u67d0\u4e2a\u73b0\u6709 ViewGroup\u3002 \u5728 Activity \u8fd0\u884c\u671f\u95f4\uff0c\u60a8\u53ef\u4ee5\u968f\u65f6\u5c06\u7247\u6bb5\u6dfb\u52a0\u5230 Activity \u5e03\u5c40\u4e2d\u3002\u60a8\u53ea\u9700\u6307\u5b9a\u8981\u5c06\u7247\u6bb5\u653e\u5165\u54ea\u4e2a ViewGroup\u3002</p> <p>\u5982\u8981\u5728\u60a8\u7684 Activity \u4e2d\u6267\u884c\u7247\u6bb5\u4e8b\u52a1\uff08\u5982\u6dfb\u52a0\u3001\u79fb\u9664\u6216\u66ff\u6362\u7247\u6bb5\uff09\uff0c\u5219\u5fc5\u987b\u4f7f\u7528 FragmentTransaction \u4e2d\u7684 API\u3002\u5982\u4e0b\u6240\u793a\uff0c\u60a8\u53ef\u4ee5\u4ece FragmentActivity \u83b7\u53d6\u4e00\u4e2a FragmentTransaction \u5b9e\u4f8b\uff1a <pre><code>FragmentManager fragmentManager = getSupportFragmentManager();\nFragmentTransaction fragmentTransaction = fragmentManager.beginTransaction();\n</code></pre> \u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>add()</code> \u65b9\u6cd5\u6dfb\u52a0\u4e00\u4e2a\u7247\u6bb5\uff0c\u6307\u5b9a\u8981\u6dfb\u52a0\u7684\u7247\u6bb5\u4ee5\u53ca\u5c06\u5176\u63d2\u5165\u54ea\u4e2a\u89c6\u56fe\u3002\u4f8b\u5982\uff1a <pre><code>ExampleFragment fragment = new ExampleFragment();\nfragmentTransaction.add(R.id.fragment_container, fragment);\nfragmentTransaction.commit();\n</code></pre> \u4f20\u9012\u5230 <code>add()</code> \u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f ViewGroup\uff0c\u5373\u5e94\u653e\u7f6e\u7247\u6bb5\u7684\u4f4d\u7f6e\uff0c\u7531\u8d44\u6e90 ID \u6307\u5b9a\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f\u8981\u6dfb\u52a0\u7684\u7247\u6bb5\u3002 \u4e00\u65e6\u60a8\u901a\u8fc7 FragmentTransaction \u505a\u51fa\u4e86\u66f4\u6539\uff0c\u5c31\u5fc5\u987b\u8c03\u7528 <code>commit()</code> \u4ee5\u4f7f\u66f4\u6539\u751f\u6548\u3002</p>"},{"location":"android/fragment/fragment-intro/#fragment_5","title":"\u7ba1\u7406Fragment","text":"<p>\u5982\u8981\u7ba1\u7406 Activity \u4e2d\u7684\u7247\u6bb5\uff0c\u60a8\u9700\u4f7f\u7528 FragmentManager\u3002\u5982\u8981\u83b7\u53d6\u5b83\uff0c\u8bf7\u4ece\u60a8\u7684 Activity \u8c03\u7528 <code>getSupportFragmentManager()</code>\u3002</p> <p>\u53ef\u4f7f\u7528 FragmentManager \u6267\u884c\u7684\u64cd\u4f5c\u5305\u62ec\uff1a * \u901a\u8fc7 <code>findFragmentById()</code>\uff08\u9488\u5bf9\u5728 Activity \u5e03\u5c40\u4e2d\u63d0\u4f9b\u754c\u9762\u7684\u7247\u6bb5\uff09\u6216 findFragmentByTag()\uff08\u9488\u5bf9\u63d0\u4f9b\u6216\u4e0d\u63d0\u4f9b\u754c\u9762\u7684\u7247\u6bb5\uff09\u83b7\u53d6 Activity \u4e2d\u5b58\u5728\u7684\u7247\u6bb5\u3002 * \u901a\u8fc7 <code>popBackStack()</code>\uff08\u6a21\u62df\u7528\u6237\u53d1\u51fa\u7684\u8fd4\u56de\u547d\u4ee4\uff09\u4f7f\u7247\u6bb5\u4ece\u8fd4\u56de\u6808\u4e2d\u5f39\u51fa\u3002 * \u901a\u8fc7 <code>addOnBackStackChangedListener()</code> \u6ce8\u518c\u4fa6\u542c\u8fd4\u56de\u6808\u53d8\u5316\u7684\u4fa6\u542c\u5668\u3002</p> <p>\u5982\u4e0a\u6587\u6240\u8ff0\uff0c\u60a8\u4e5f\u53ef\u4f7f\u7528 FragmentManager \u6253\u5f00\u4e00\u4e2a FragmentTransaction\uff0c\u901a\u8fc7\u5b83\u6765\u6267\u884c\u67d0\u4e9b\u4e8b\u52a1\uff0c\u5982\u6dfb\u52a0\u548c\u79fb\u9664\u7247\u6bb5\u3002</p>"},{"location":"android/fragment/fragment-intro/#fragment_6","title":"\u6267\u884cFragment\u4e8b\u52a1","text":"<p>\u5728 Activity \u4e2d\u4f7f\u7528\u7247\u6bb5\u7684\u4e00\u5927\u4f18\u70b9\u662f\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u7247\u6bb5\u6267\u884c\u6dfb\u52a0\u3001\u79fb\u9664\u3001\u66ff\u6362\u4ee5\u53ca\u5176\u4ed6\u64cd\u4f5c\uff0c\u4ece\u800c\u54cd\u5e94\u7528\u6237\u4ea4\u4e92\u3002\u63d0\u4ea4\u7ed9 Activity \u7684\u6bcf\u7ec4\u66f4\u6539\u5747\u79f0\u4e3a\u4e8b\u52a1\uff0c\u5e76\u4e14\u60a8\u53ef\u4f7f\u7528 FragmentTransaction \u4e2d\u7684 API \u6765\u6267\u884c\u4e00\u9879\u4e8b\u52a1\u3002\u60a8\u4e5f\u53ef\u5c06\u6bcf\u4e2a\u4e8b\u52a1\u4fdd\u5b58\u5230\u7531 Activity \u7ba1\u7406\u7684\u8fd4\u56de\u6808\u5185\uff0c\u4ece\u800c\u8ba9\u7528\u6237\u80fd\u591f\u56de\u9000\u7247\u6bb5\u66f4\u6539\uff08\u7c7b\u4f3c\u4e8e\u56de\u9000 Activity\uff09\u3002</p> <p>\u5982\u4e0b\u6240\u793a\uff0c\u60a8\u53ef\u4ee5\u4ece FragmentManager \u83b7\u53d6\u4e00\u4e2a FragmentTransaction \u5b9e\u4f8b\uff1a <pre><code>FragmentManager fragmentManager = getSupportFragmentManager();\nFragmentTransaction fragmentTransaction = fragmentManager.beginTransaction();\n</code></pre> \u6bcf\u4e2a\u4e8b\u52a1\u90fd\u662f\u60a8\u60f3\u8981\u540c\u65f6\u6267\u884c\u7684\u4e00\u7ec4\u66f4\u6539\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 add()\u3001remove() \u548c replace() \u7b49\u65b9\u6cd5\uff0c\u4e3a\u7ed9\u5b9a\u4e8b\u52a1\u8bbe\u7f6e\u60a8\u60f3\u8981\u6267\u884c\u7684\u6240\u6709\u66f4\u6539\u3002\u7136\u540e\uff0c\u5982\u8981\u5c06\u4e8b\u52a1\u5e94\u7528\u5230 Activity\uff0c\u60a8\u5fc5\u987b\u8c03\u7528 commit()\u3002</p> <p>\u4e0d\u8fc7\uff0c\u5728\u8c03\u7528 commit() \u4e4b\u524d\uff0c\u60a8\u53ef\u80fd\u5e0c\u671b\u8c03\u7528 addToBackStack()\uff0c\u4ee5\u5c06\u4e8b\u52a1\u6dfb\u52a0\u5230\u7247\u6bb5\u4e8b\u52a1\u8fd4\u56de\u6808\u3002\u8be5\u8fd4\u56de\u6808\u7531 Activity \u7ba1\u7406\uff0c\u5141\u8bb8\u7528\u6237\u901a\u8fc7\u6309\u8fd4\u56de\u6309\u94ae\u8fd4\u56de\u4e0a\u4e00\u7247\u6bb5\u72b6\u6001\u3002</p> <p>\u4f8b\u5982\uff0c\u4ee5\u4e0b\u793a\u4f8b\u8bf4\u660e\u5982\u4f55\u5c06\u4e00\u4e2a\u7247\u6bb5\u66ff\u6362\u4e3a\u53e6\u4e00\u4e2a\u7247\u6bb5\uff0c\u4ee5\u53ca\u5982\u4f55\u5728\u8fd4\u56de\u6808\u4e2d\u4fdd\u7559\u5148\u524d\u7684\u72b6\u6001\uff1a <pre><code>// Create new fragment and transaction\nFragment newFragment = new ExampleFragment();\nFragmentTransaction transaction = getSupportFragmentManager().beginTransaction();\n\n// Replace whatever is in the fragment_container view with this fragment,\n// and add the transaction to the back stack\ntransaction.replace(R.id.fragment_container, newFragment);\ntransaction.addToBackStack(null);\n\n// Commit the transaction\ntransaction.commit();\n</code></pre> \u5728\u672c\u4f8b\u4e2d\uff0cnewFragment \u4f1a\u66ff\u6362\u76ee\u524d\u5728 R.id.fragment_container ID \u6240\u6807\u8bc6\u7684\u5e03\u5c40\u5bb9\u5668\u4e2d\u7684\u4efb\u4f55\u7247\u6bb5\uff08\u5982\u6709\uff09\u3002\u901a\u8fc7\u8c03\u7528 addToBackStack()\uff0c\u60a8\u53ef\u4ee5\u5c06\u66ff\u6362\u4e8b\u52a1\u4fdd\u5b58\u5230\u8fd4\u56de\u6808\uff0c\u4ee5\u4fbf\u7528\u6237\u80fd\u591f\u901a\u8fc7\u6309\u8fd4\u56de\u6309\u94ae\u64a4\u6d88\u4e8b\u52a1\u5e76\u56de\u9000\u5230\u4e0a\u4e00\u7247\u6bb5\u3002</p> <p>\u7136\u540e\uff0cFragmentActivity \u4f1a\u81ea\u52a8\u901a\u8fc7 onBackPressed() \u4ece\u8fd4\u56de\u6808\u68c0\u7d22\u7247\u6bb5\u3002</p> <p>\u5982\u679c\u60a8\u5411\u4e8b\u52a1\u6dfb\u52a0\u591a\u4e2a\u66f4\u6539\uff08\u5982\u53c8\u4e00\u4e2a add() \u6216 remove()\uff09\uff0c\u5e76\u8c03\u7528 addToBackStack()\uff0c\u5219\u8c03\u7528 commit() \u524d\u5e94\u7528\u7684\u6240\u6709\u66f4\u6539\u90fd\u5c06\u4f5c\u4e3a\u5355\u4e00\u4e8b\u52a1\u6dfb\u52a0\u5230\u8fd4\u56de\u6808\uff0c\u5e76\u4e14\u8fd4\u56de\u6309\u94ae\u4f1a\u5c06\u5b83\u4eec\u4e00\u5e76\u64a4\u6d88\u3002</p> <p>\u5411 FragmentTransaction \u6dfb\u52a0\u66f4\u6539\u7684\u987a\u5e8f\u65e0\u5173\u7d27\u8981\uff0c\u4e0d\u8fc7\uff1a</p> <p>\u60a8\u5fc5\u987b\u6700\u540e\u8c03\u7528 commit()\u3002 \u5982\u679c\u60a8\u8981\u5411\u540c\u4e00\u5bb9\u5668\u6dfb\u52a0\u591a\u4e2a\u7247\u6bb5\uff0c\u5219\u60a8\u6dfb\u52a0\u7247\u6bb5\u7684\u987a\u5e8f\u5c06\u51b3\u5b9a\u5b83\u4eec\u5728\u89c6\u56fe\u5c42\u6b21\u7ed3\u6784\u4e2d\u51fa\u73b0\u7684\u987a\u5e8f\u3002 \u5982\u679c\u60a8\u6ca1\u6709\u5728\u6267\u884c\u5220\u9664\u7247\u6bb5\u7684\u4e8b\u52a1\u65f6\u8c03\u7528 addToBackStack()\uff0c\u5219\u4e8b\u52a1\u63d0\u4ea4\u65f6\u8be5\u7247\u6bb5\u4f1a\u88ab\u9500\u6bc1\uff0c\u7528\u6237\u5c06\u65e0\u6cd5\u56de\u9000\u5230\u8be5\u7247\u6bb5\u3002\u4e0d\u8fc7\uff0c\u5982\u679c\u60a8\u5728\u5220\u9664\u7247\u6bb5\u65f6\u8c03\u7528 addToBackStack()\uff0c\u5219\u7cfb\u7edf\u4f1a\u505c\u6b62\u8be5\u7247\u6bb5\uff0c\u5e76\u968f\u540e\u5728\u7528\u6237\u56de\u9000\u65f6\u5c06\u5176\u6062\u590d\u3002</p> <p>\u8c03\u7528 commit() \u4e0d\u4f1a\u7acb\u5373\u6267\u884c\u4e8b\u52a1\uff0c\u800c\u662f\u5728 Activity \u7684\u754c\u9762\u7ebf\u7a0b\uff08\u201c\u4e3b\u201d\u7ebf\u7a0b\uff09\u53ef\u6267\u884c\u8be5\u64cd\u4f5c\u65f6\uff0c\u518d\u5b89\u6392\u8be5\u4e8b\u52a1\u5728\u7ebf\u7a0b\u4e0a\u8fd0\u884c\u3002\u4e0d\u8fc7\uff0c\u5982\u6709\u5fc5\u8981\uff0c\u60a8\u4e5f\u53ef\u4ee5\u4ece\u754c\u9762\u7ebf\u7a0b\u8c03\u7528 executePendingTransactions()\uff0c\u4ee5\u7acb\u5373\u6267\u884c commit() \u63d0\u4ea4\u7684\u4e8b\u52a1\u3002\u901a\u5e38\u4e0d\u5fc5\u8fd9\u6837\u505a\uff0c\u9664\u975e\u5176\u4ed6\u7ebf\u7a0b\u4e2d\u7684\u4f5c\u4e1a\u4f9d\u8d56\u8be5\u4e8b\u52a1\u3002</p> <p>\u6ce8\u610f\uff1a\u60a8\u53ea\u80fd\u5728 Activity \u4fdd\u5b58\u5176\u72b6\u6001\uff08\u5f53\u7528\u6237\u79bb\u5f00 Activity\uff09\u4e4b\u524d\u4f7f\u7528 commit() \u63d0\u4ea4\u4e8b\u52a1\u3002\u5982\u679c\u60a8\u8bd5\u56fe\u5728\u8be5\u65f6\u95f4\u70b9\u540e\u63d0\u4ea4\uff0c\u5219\u4f1a\u5f15\u53d1\u5f02\u5e38\u3002\u8fd9\u662f\u56e0\u4e3a\u5982\u9700\u6062\u590d Activity\uff0c\u5219\u63d0\u4ea4\u540e\u7684\u72b6\u6001\u53ef\u80fd\u4f1a\u4e22\u5931\u3002\u5bf9\u4e8e\u4e22\u5931\u63d0\u4ea4\u65e0\u5173\u7d27\u8981\u7684\u60c5\u51b5\uff0c\u8bf7\u4f7f\u7528 <code>commitAllowingStateLoss()</code>\u3002</p>"},{"location":"android/fragment/fragment-intro/#_2","title":"\u751f\u547d\u5468\u671f\u53d8\u5316","text":""},{"location":"android/fragment/fragment-intro/#fragment_7","title":"Fragment\u88ab\u521b\u5efa\u7684\u65f6\u5019","text":"<p>\u5b83\u4f1a\u7ecf\u5386\u4ee5\u4e0b\u72b6\u6001 <pre><code>onAttach()\nonCreate()\nonCreateView()\nonActivityCreated()\n</code></pre></p>"},{"location":"android/fragment/fragment-intro/#fragment_8","title":"Fragment\u5bf9\u7528\u6237\u53ef\u89c1\u7684\u65f6\u5019","text":"<p>\u5b83\u4f1a\u7ecf\u5386\u4ee5\u4e0b\u72b6\u6001 <pre><code>onStart()\nonResume()\n</code></pre></p>"},{"location":"android/fragment/fragment-intro/#fragment_9","title":"Fragment\u8fdb\u5165\u201c\u540e\u53f0\u6a21\u5f0f\u201d\u7684\u65f6\u5019","text":"<p>\u5b83\u4f1a\u7ecf\u5386\u4ee5\u4e0b\u72b6\u6001 <pre><code>onPause()\nonStop()\n</code></pre></p>"},{"location":"android/fragment/fragment-intro/#fragmentactivity","title":"Fragment\u88ab\u9500\u6bc1\u4e86\uff08\u6216\u8005\u6301\u6709\u5b83\u7684activity\u88ab\u9500\u6bc1\u4e86\uff09","text":"<p>\u5b83\u4f1a\u7ecf\u5386\u4ee5\u4e0b\u72b6\u6001 <pre><code>onPause()\nonStop()\nonDestroyView()\nonDestroy()\nonDetach()\n</code></pre></p>"},{"location":"android/fragment/fragment-intro/#fragmentactivity_1","title":"Fragment\u4e0eActivity\u4e0d\u540c\u7684\u751f\u547d\u5468\u671f","text":"<p>Fragment\u7684\u5927\u90e8\u5206\u72b6\u6001\u90fd\u548cActivity\u5f88\u76f8\u4f3c\uff0c\u4f46fragment\u6709\u4e00\u4e9b\u65b0\u7684\u72b6\u6001\u3002</p> <p>Fragment\u4e0d\u540c\u4e8eActivity\u7684\u751f\u547d\u5468\u671f - <code>onAttached()</code> \u2014\u2014 \u5f53fragment\u88ab\u52a0\u5165\u5230activity\u65f6\u8c03\u7528\uff08\u5728\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\u53ef\u4ee5\u83b7\u5f97\u6240\u5728\u7684activity\uff09\u3002 - <code>onCreateView()</code> \u2014\u2014 \u5f53activity\u8981\u5f97\u5230fragment\u7684layout\u65f6\uff0c\u8c03\u7528\u6b64\u65b9\u6cd5\uff0cfragment\u5728\u5176\u4e2d\u521b\u5efa\u81ea\u5df1\u7684layout(\u754c\u9762)\u3002 - <code>onActivityCreated()</code> \u2014\u2014 \u5f53activity\u7684onCreated()\u65b9\u6cd5\u8fd4\u56de\u540e\u8c03\u7528\u6b64\u65b9\u6cd5 - <code>onDestroyView()</code> \u2014\u2014 \u5f53fragment\u4e2d\u7684\u89c6\u56fe\u88ab\u79fb\u9664\u7684\u65f6\u5019\uff0c\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u3002 - <code>onDetach()</code> \u2014\u2014 \u5f53fragment\u548cactivity\u5206\u79bb\u7684\u65f6\u5019\uff0c\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u3002</p> <p>\u4e00\u65e6activity\u8fdb\u5165resumed\u72b6\u6001\uff08\u4e5f\u5c31\u662frunning\u72b6\u6001\uff09\uff0c\u4f60\u5c31\u53ef\u4ee5\u81ea\u7531\u5730\u6dfb\u52a0\u548c\u5220\u9664fragment\u4e86\u3002\u56e0\u6b64\uff0c\u53ea\u6709\u5f53activity\u5728resumed\u72b6\u6001\u65f6\uff0cfragment\u7684\u751f\u547d\u5468\u671f\u624d\u80fd\u72ec\u7acb\u7684\u8fd0\u8f6c\uff0c\u5176\u5b83\u65f6\u5019\u662f\u4f9d\u8d56\u4e8eactivity\u7684\u751f\u547d\u5468\u671f\u53d8\u5316\u7684\u3002</p>"},{"location":"android/fragment/fragment-intro/#fragment_10","title":"\u5904\u7406Fragment\u751f\u547d\u5468\u671f","text":"<p>\u7ba1\u7406\u7247\u6bb5\u751f\u547d\u5468\u671f\u4e0e\u7ba1\u7406 Activity \u751f\u547d\u5468\u671f\u5f88\u76f8\u4f3c\u3002\u548c Activity \u4e00\u6837\uff0c\u7247\u6bb5\u4e5f\u4ee5\u4e09\u79cd\u72b6\u6001\u5b58\u5728\uff1a - \u5df2\u6062\u590d\uff1a\u7247\u6bb5\u5728\u8fd0\u884c\u4e2d\u7684 Activity \u4e2d\u53ef\u89c1\u3002 - \u5df2\u6682\u505c\uff1a\u53e6\u4e00\u4e2a Activity \u4f4d\u4e8e\u524d\u53f0\u5e76\u5177\u6709\u7126\u70b9\uff0c\u4f46\u6b64\u7247\u6bb5\u6240\u5728\u7684 Activity \u4ecd\u7136\u53ef\u89c1\uff08\u524d\u53f0 Activity \u90e8\u5206\u900f\u660e\uff0c\u6216\u672a\u8986\u76d6\u6574\u4e2a\u5c4f\u5e55\uff09\u3002 - \u5df2\u505c\u6b62\uff1a\u7247\u6bb5\u4e0d\u53ef\u89c1\u3002\u5bbf\u4e3b Activity \u5df2\u505c\u6b62\uff0c\u6216\u7247\u6bb5\u5df2\u4ece Activity \u4e2d\u79fb\u9664\uff0c\u4f46\u5df2\u6dfb\u52a0\u5230\u8fd4\u56de\u6808\u3002\u5df2\u505c\u6b62\u7684\u7247\u6bb5\u4ecd\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\uff08\u7cfb\u7edf\u4f1a\u4fdd\u7559\u6240\u6709\u72b6\u6001\u548c\u6210\u5458\u4fe1\u606f\uff09\u3002\u4e0d\u8fc7\uff0c\u5b83\u5bf9\u7528\u6237\u4e0d\u518d\u53ef\u89c1\uff0c\u5e76\u968f Activity \u7684\u7ec8\u6b62\u800c\u7ec8\u6b62\u3002 \u4e0e Activity \u4e00\u6837\uff0c\u60a8\u4e5f\u53ef\u4f7f\u7528 onSaveInstanceState(Bundle)\u3001ViewModel \u548c\u6301\u4e45\u5316\u672c\u5730\u5b58\u50a8\u7684\u7ec4\u5408\uff0c\u5728\u914d\u7f6e\u53d8\u66f4\u548c\u8fdb\u7a0b\u7ec8\u6b62\u540e\u4fdd\u7559\u7247\u6bb5\u7684\u754c\u9762\u72b6\u6001\u3002\u5982\u8981\u4e86\u89e3\u4fdd\u7559\u754c\u9762\u72b6\u6001\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u4fdd\u5b58\u754c\u9762\u72b6\u6001\u3002</p> <p>\u5bf9\u4e8e Activity \u751f\u547d\u5468\u671f\u4e0e\u7247\u6bb5\u751f\u547d\u5468\u671f\u800c\u8a00\uff0c\u4e8c\u8005\u6700\u663e\u8457\u7684\u5dee\u5f02\u662f\u5728\u5176\u5404\u81ea\u8fd4\u56de\u6808\u4e2d\u7684\u5b58\u50a8\u65b9\u5f0f\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cActivity \u505c\u6b62\u65f6\u4f1a\u88ab\u653e\u5165\u7531\u7cfb\u7edf\u7ba1\u7406\u7684 Activity \u8fd4\u56de\u6808\u4e2d\uff08\u4ee5\u4fbf\u7528\u6237\u901a\u8fc7\u8fd4\u56de\u6309\u94ae\u56de\u9000\u5230 Activity\uff0c\u8be6\u7ec6\u4ecb\u7ecd\u8bf7\u53c2\u9605\u4efb\u52a1\u548c\u8fd4\u56de\u6808\uff09\u3002\u4e0d\u8fc7\uff0c\u53ea\u6709\u5f53\u60a8\u5728\u79fb\u9664\u7247\u6bb5\u7684\u4e8b\u52a1\u6267\u884c\u671f\u95f4\u901a\u8fc7\u8c03\u7528 addToBackStack() \u663e\u5f0f\u8bf7\u6c42\u4fdd\u5b58\u5b9e\u4f8b\u65f6\uff0c\u7cfb\u7edf\u624d\u4f1a\u5c06\u7247\u6bb5\u653e\u5165\u7531\u5bbf\u4e3b Activity \u7ba1\u7406\u7684\u8fd4\u56de\u6808\u3002</p> <p>\u5728\u5176\u4ed6\u65b9\u9762\uff0c\u7ba1\u7406\u7247\u6bb5\u751f\u547d\u5468\u671f\u4e0e\u7ba1\u7406 Activity \u751f\u547d\u5468\u671f\u975e\u5e38\u76f8\u4f3c\uff1b\u5bf9\u6b64\uff0c\u60a8\u53ef\u91c7\u53d6\u76f8\u540c\u7684\u505a\u6cd5\u3002\u8bf7\u53c2\u9605 Activity \u751f\u547d\u5468\u671f\u6307\u5357\u548c\u4f7f\u7528\u5177\u6709\u751f\u547d\u5468\u671f\u611f\u77e5\u80fd\u529b\u7684\u7ec4\u4ef6\u5904\u7406\u751f\u547d\u5468\u671f\uff0c\u4e86\u89e3\u6709\u5173 Activity \u751f\u547d\u5468\u671f\u53ca\u5176\u7ba1\u7406\u63aa\u65bd\u7684\u8be6\u60c5\u3002</p> <p></p> <p>\u6ce8\u610f\uff1a\u5982\u679c\u60a8\u7684 Fragment \u4e2d\u9700\u8981 Context \u5bf9\u8c61\uff0c\u5219\u53ef\u4ee5\u8c03\u7528 <code>getContext()</code>\u3002\u4f46\u8bf7\u6ce8\u610f\uff0c\u53ea\u6709\u5728\u8be5\u7247\u6bb5\u9644\u52a0\u5230 Activity \u65f6\u624d\u9700\u8c03\u7528 <code>getContext()</code>\u3002\u5982\u679c\u5c1a\u672a\u9644\u52a0\u8be5\u7247\u6bb5\uff0c\u6216\u8005\u5176\u5728\u751f\u547d\u5468\u671f\u7ed3\u675f\u671f\u95f4\u5df2\u5206\u79bb\uff0c\u5219 <code>getContext()</code> \u8fd4\u56de null\u3002</p>"},{"location":"android/fragment/fragments-contact/","title":"Fragment \u95f4\u7684\u901a\u4fe1","text":"<p>\u5728Fragment\u7684java\u6587\u4ef6\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528<code>getActivity()</code>\u6765\u83b7\u5f97\u8c03\u7528\u5b83\u7684activity\uff0c\u7136\u540e\u518d\u627e\u5230\u53e6\u4e00\u4e2aFragment\uff0c\u8fdb\u884c\u901a\u4fe1</p> <p><code>getActivity().getFragmentManager().findFragmentById(R.id.fragment_list);</code> \u4f46\u8fd9\u6837\u505a\u8026\u5408\u5ea6\u592a\u9ad8\uff0c\u4e0d\u65b9\u4fbf\u540e\u7eed\u7684\u4fee\u6539\u64cd\u4f5c</p> <p>Fragment\u4e0e\u5176\u9644\u7740\u7684Activity\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u90fd\u5e94\u8be5\u7531Activity\u6765\u5b8c\u6210\uff1b\u4e0d\u80fd\u662f\u591a\u4e2aFragment\u4e4b\u95f4\u76f4\u63a5\u901a\u4fe1</p>"},{"location":"android/fragment/fragments-contact/#fragmentactivity","title":"Fragment\u4e0e\u5176\u9644\u7740\u7684Activity\u4e4b\u95f4\u901a\u4fe1\u65b9\u5f0f\uff1a","text":"<ul> <li> <p>1.\u5728\u53d1\u8d77\u4e8b\u4ef6\u7684Fragment\u4e2d\u5b9a\u4e49\u4e00\u4e2a\u63a5\u53e3\uff0c\u63a5\u53e3\u4e2d\u58f0\u660e\u4f60\u7684\u65b9\u6cd5</p> </li> <li> <p>2.\u5728onAttach\u65b9\u6cd5\u4e2d\u8981\u6c42Activity\u5b9e\u73b0\u8be5\u63a5\u53e3</p> </li> <li> <p>3.\u5728Activity\u4e2d\u5b9e\u73b0\u8be5\u65b9\u6cd5</p> </li> </ul> <p>\u4f8b\u5982\u4e00\u4e2aactivity\u4e2d\u5e03\u7f6e\u4e862\u4e2aFragment\uff0c\u5b83\u4eec\u4e4b\u95f4\u7684\u901a\u4fe1\u8981\u4f9d\u9760activity\u6765\u5b8c\u6210</p> <p>\u4ee3\u7801\uff1a<code>ListStoreActivity.java</code> <code>NewItemFragment.java</code> <code>ListStoreFragment.java</code> \u5e03\u5c40\u6587\u4ef6\u4e3a\uff1a<code>liststore.xml</code> <code>new_item_fragment.xml</code></p>"},{"location":"android/fragment/fragments-contact/#_1","title":"\u51c6\u5907\u5e03\u5c40\u6587\u4ef6\uff1a","text":"<p>liststore.xml\u7528LinearLayout\u4e2d\u653e\u7f6e\u4e862\u4e2afragment\uff0c\u5206\u522b\u6307\u54112\u4e2aFragment\u6587\u4ef6 new_item_fragment.xml \u4e2d\u5e76\u6392\u653e\u7f6e\u4e00\u4e2aEditText\u548c\u4e00\u4e2a\u6309\u94ae</p> <p><code>ListStoreFragment.java</code> \u4f7f\u7528\u524d\u9762\u5b9a\u4e49\u7684\u754c\u9762</p> <p><pre><code>public class ListStoreFragment extends ListFragment{\n/// \u7ee7\u627f\u81eaListFragment\uff0c\u5df2\u7ecf\u5c01\u88c5\u597d\u4e86listview\n/// \u4e0d\u9700\u8981\u81ea\u5df1\u5199ListView\u4e86\n}\n</code></pre> NewItemFragment.java <pre><code>    /**\n     * \u58f0\u660e\u4e00\u4e2a\u63a5\u53e3\uff0c\u5b9a\u4e49\u5411activity\u4f20\u9012\u7684\u65b9\u6cd5\n     * \u7ed1\u5b9a\u7684activity\u5fc5\u987b\u5b9e\u73b0\u8fd9\u4e2a\u65b9\u6cd5\n     */\n    public interface OnNewItemAddedListener {\n        public void newItemAdded(String content);\n    }\n    private OnNewItemAddedListener onNewItemAddedListener;\n    private Button btnAddItem;\n    /*\u590d\u5199onAttach\u65b9\u6cd5*/\n    @Override\n    public void onAttach(Activity activity) {\n        super.onAttach(activity);\n        try {\n            onNewItemAddedListener = (OnNewItemAddedListener) activity;\n        } catch (ClassCastException e){\n            throw new ClassCastException(activity.toString() + \"must implement OnNewItemAddedListener\");\n        }\n    }\n</code></pre> ListStoreActivity.java \u52a0\u8f7d\u4e3b\u89c6\u56fe<code>liststore.xml</code>;</p> <p>\u4e24\u4e2aFragment\u901a\u8fc7<code>ListStoreActivity</code>\u6765\u901a\u4fe1</p> <p>\u5728onCreate\u65b9\u6cd5\u4e2d\u83b7\u53d6ListStoreFragment\u7684\u5b9e\u4f8b\uff1b\u5e76\u4e14\u590d\u5199newItemAdded\u65b9\u6cd5\uff0c\u5728\u91cc\u9762\u52a0\u4e0a\u4e1a\u52a1\u903b\u8f91 <pre><code>public class ListStoreActivity extends Activity implements OnNewItemAddedListener{\n\n    private ArrayList&lt;String&gt; data;\n    private ArrayAdapter&lt;String&gt; adapter;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.liststore);\n        data = new ArrayList&lt;String&gt;();\n        // \u628adata\u88c5\u5165adapter\u4e2d\n        adapter = new ArrayAdapter&lt;String&gt;(this, android.R.layout.simple_list_item_1, data);\n        // ListFragment\u5e76\u4e0d\u9700\u8981\u518d\u5b9a\u4e49\u4e00\u4e2alistview        \n        ListStoreFragment listStoreFragment = (ListStoreFragment) getFragmentManager().findFragmentById(R.id.fragment_listview);\n        listStoreFragment.setListAdapter(adapter);\n    }\n\n    @Override\n    public void newItemAdded(String content) {\n        //  \u590d\u5199\u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5\uff0c\u4e1a\u52a1\u4ee3\u7801\u5728\u8fd9\u91cc\u5b9e\u73b0\n        if(!content.equals(\"\")) {\n            data.add(content);\n            adapter.notifyDataSetChanged();\n        }\n    }\n}\n</code></pre> \u8fd9\u6837\u505a\u7684\u7f3a\u70b9\u662f\u8026\u5408\u5ea6\u5f88\u9ad8</p>"},{"location":"android/fragment/fragments-contact/#fragmentactivity_1","title":"Fragment\u8ddfActivity\u7684\u51e0\u79cd\u901a\u4fe1\u65b9\u5f0f","text":"<ul> <li>Activity\u628a\u81ea\u5df1\u7684handler\u4ea4\u7ed9Fragment</li> <li>\u5e7f\u64ad</li> <li>EventBus</li> <li>\u5b9a\u4e49\u63a5\u53e3</li> </ul> <p>\u9664\u4e86\u4e0a\u9762\u63d0\u5230\u7684\u51e0\u79cd\u65b9\u6cd5\uff0c\u4e5f\u53ef\u4ee5\u7528Activity\u548cFragment\u5171\u7528ViewModel\u7684\u65b9\u5f0f\u5b9e\u73b0\u901a\u4fe1\u3002</p>"},{"location":"android/fragment/load-fragment/","title":"Fragment \u52a0\u8f7d\u65b9\u6cd5","text":"<p>\u52a0\u8f7d\u65b9\u6cd5\u6709\u4e24\u79cd\uff0c\u5728xml\u6587\u4ef6\u4e2d\u6ce8\u518c\uff0c\u6216\u8005\u662f\u5728Java\u4ee3\u7801\u4e2d\u52a0\u8f7d\u3002</p>"},{"location":"android/fragment/load-fragment/#xml","title":"xml\u4e2d\u6ce8\u518c","text":"<p>\u4f8b\u5982\u5728fragment_demo.xml\u4e2d\u5b9a\u4e49 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:orientation=\"vertical\" &gt;\n    &lt;fragment\n        android:id=\"@+id/main_fragment_up\"\n        android:name=\"com.rust.fragment.FirstFragment\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"0dp\"\n        android:layout_weight=\"1\" /&gt;\n\n    &lt;fragment\n        android:id=\"@+id/main_fragment_bottom\"\n        android:name=\"com.rust.fragment.SecondFragment\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"0dp\"\n        android:layout_weight=\"1\" /&gt;\n&lt;/LinearLayout&gt;\n</code></pre> com.rust.fragment.SecondFragment \u5c31\u662fFragment\u5b50\u7c7b</p> <p>\u5728SecondFragment.java\u91cc\u590d\u5199onCreateView\u65b9\u6cd5\uff0c\u5e76\u8fd4\u56de\u5b9a\u4e49\u597d\u7684view</p> <p>activity\u4e2d\u76f4\u63a5\u52a0\u8f7d\u5373\u53ef</p> <p>setContentView(R.layout.fragment_demo);</p>"},{"location":"android/fragment/load-fragment/#java","title":"Java\u4ee3\u7801\u4e2d\u52a0\u8f7d","text":"<p>\u2460\u51c6\u5907\u597dFragment xml\u5e03\u5c40\u6587\u4ef6</p> <p>\u2461\u65b0\u5efa\u4e00\u4e2a\u7c7b\uff0c\u7ee7\u627f\u81eaFragment\uff1b\u5728\u8fd9\u4e2a\u7c7b\u4e2d\u627e\u5230Fragment\u5e03\u5c40\u6587\u4ef6</p> <p>\u2462\u5728Activity\u4e2d\u4f7f\u7528FragmentManager\u6765\u64cd\u4f5cFragment</p> <p>\u2463\u522b\u5fd8\u4e86commit</p> <p>\u5148\u81ea\u5b9a\u4e49\u4e00\u4e2a\u5e03\u5c40\u6587\u4ef6<code>fragment_first.xml</code></p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:orientation=\"vertical\"\n    android:background=\"#0011ff\" &gt;\n&lt;!-- &lt;Button\n    android:id=\"@+id/btn_fragment1_1\"\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"\n    android:text=\"@string/btn_fragment1\"\n    android:textSize=\"16sp\"\n       /&gt;\n&lt;EditText\n    /&gt; --&gt;\n&lt;/LinearLayout&gt;\n</code></pre> <p>\u65b0\u5efa\u4e00\u4e2a\u7c7bFirstFragment.java\uff0c\u7ee7\u627f\u81eaFragment\u3002\u590d\u5199onCreateView\u65b9\u6cd5\u3002\u5728onCreateView\u65b9\u6cd5\u4e2d\uff0c\u53ef\u4ee5\u64cd\u4f5cFragment\u4e0a\u7684\u63a7\u4ef6\u3002 <pre><code>    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container,\n            Bundle savedInstanceState) {\n        View rootView = inflater.inflate(R.layout.fragment_first, container,false);\n//    fragment_first\u662f\u81ea\u5b9a\u4e49\u597d\u7684\u5e03\u5c40\n//    \u5982\u679c\u6b64Fragment\u4e0a\u653e\u4e86\u63a7\u4ef6\uff0c\u6bd4\u5982Button\uff0cEdittext\u7b49\u3002\u53ef\u4ee5\u5728\u8fd9\u91cc\u5b9a\u4e49\u52a8\u4f5c\n  btn_fragment1_send = (Button) rootView.findViewById(R.id.btn_fragment1_1);\n//...\n        return rootView;\n    }\n</code></pre></p> <p>\u51c6\u5907\u4e00\u4e2a\u4f4d\u7f6e\u7ed9Fragment\uff0c\u6bd4\u5982\u5728activity_main.xml\u4e2d\u7528Framelayout\u6765\u5360\u4f4d\u3002 <pre><code>    &lt;FrameLayout\n        android:id=\"@+id/layout_container1\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"0dp\"\n        android:layout_weight=\"4\" &gt;\n    &lt;/FrameLayout&gt;\n</code></pre></p> <p>\u5728MainActivity.java\u91cc\uff0c\u5148\u83b7\u5f97FragmentManager\uff0c\u5f97\u5230FragmentTransaction\u3002Fragment\u7684\u6dfb\u52a0\u5220\u9664\u7b49\u64cd\u4f5c\u7531FragmentTransaction\u6765\u5b8c\u6210\u3002 <pre><code>f1 = new FirstFragment();    //    \u83b7\u53d6\u5b9e\u4f8b\nf2 = new SecondFragment();    //\nFragmentTransaction fragmentTransaction = getFragmentManager().beginTransaction();\nfragmentTransaction.add(R.id.layout_container1,f1);    //    \u6dfb\u52a0\nfragmentTransaction.replace(R.id.layout_container1,f1);    //    \u66ff\u6362\n// \u6216\u8005\u4e5f\u53ef\u4ee5\u5199\u6210\nfragmentTransaction.replace(R.id.layout_container1,new FirstFragment());\n//              fragmentTransaction.addToBackStack(null);   //\u6dfb\u52a0\u5230\u8fd4\u56de\u6808\uff0c\u8fd9\u6837\u6309\u8fd4\u56de\u952e\u7684\u65f6\u5019\u80fd\u8fd4\u56de\u5df2\u6dfb\u52a0\u7684fragment\nfragmentTransaction.commit();    //\u522b\u5fd8\u4e86commit\n//    \u79fb\u9664\u64cd\u4f5c getFragmentManager().beginTransaction().remove(f1).commit();\n</code></pre></p> <p>\u76f8\u6bd4\u4e0exml\u4e2d\u6ce8\u518c\uff0c\u4ee3\u7801\u52a0\u8f7d\u66f4\u4e3a\u7075\u6d3b\u4e00\u4e9b\u3002\u4e2a\u4eba\u8f83\u4e3a\u559c\u6b22\u52a8\u6001\u52a0\u8f7d\u3002</p>"},{"location":"android/fragment/load-fragment/#fragment-activity","title":"Fragment \u4e0e Activity \u4e4b\u95f4\u7684\u914d\u5408","text":"<p>Activity \u5148\u6267\u884c<code>onResume</code> \u7136\u540e\u5f53\u524dFragment\u6267\u884c<code>onResume</code> \u5f53\u524dFragment\u88abreplace\u6389\uff0c\u518d\u6b21replace\u56de\u6765\u65f6\uff0c\u6709\u4e9b\u72b6\u6001\u5e76\u672a\u91cd\u65b0\u521d\u59cb\u5316\u3002 \u6267\u884creplace\u65f6\u4f1a\u628aFragment\u7684\u58f0\u660e\u5468\u671f\u518d\u8dd1\u4e00\u904d\u3002\u7a33\u59a5\u7684\u505a\u6cd5\u662f\uff0c\u5728<code>onCreateView</code>\u4e2d\u521d\u59cb\u5316\u5fc5\u8981\u7684\u53d8\u91cf\u3002\u6bd4\u5982\u91cd\u7f6e\u4e00\u4e9b\u72b6\u6001\u503c\u3002\u5728\u591a\u4e2aFragment\u4e2d\u5207\u6362\u65f6\u9700\u8981\u7279\u522b\u6ce8\u610f\u3002</p>"},{"location":"android/fragment/dialogFragment/custom_width_height/","title":"Android DialogFragment \u81ea\u5b9a\u4e49","text":"<p>\u6709\u4e9b\u65f6\u5019\u6211\u4eec\u9700\u8981\u81ea\u5b9a\u4e49\u5f39\u7a97\u7684\u5927\u5c0f\u3002\u7cfb\u7edf\u9ed8\u8ba4\u7684\u5c3a\u5bf8\u53ef\u80fd\u4e0d\u7b26\u5408\u6211\u4eec\u5b9a\u5236\u5316\u7684\u9700\u6c42\u3002 \u5927\u4f53\u601d\u8def\u662f\u83b7\u5f97\u5f53\u524dwindow\u7684\u5bbd\u9ad8\uff0c\u5c06window\u5bbd\u9ad8\u8bbe\u7f6e\u6210\u7f29\u653e\u540e\u7684\u5c3a\u5bf8\u3002 \u5728DialogFragment\u7684<code>onStart</code>\u4e2d\u83b7\u53d6\u5e76\u8c03\u6574\u5bbd\u9ad8\u53c2\u6570\u3002</p> <p>\u8fd9\u91cc\u7ed9\u51fa\u4e86\u51e0\u4e2a\u5e38\u7528\u81ea\u5b9a\u4e49DialogFragment\u7684\u4f8b\u5b50</p>"},{"location":"android/fragment/dialogFragment/custom_width_height/#dialogfragment","title":"DialogFragment \u81ea\u5b9a\u4e49\u80cc\u666f\u548c\u5bbd\u9ad8","text":"<p>\u5148\u7533\u8bf7\u65e0\u6807\u9898\u680f</p> <pre><code>    @Nullable\n    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n        getDialog().getWindow().requestFeature(Window.FEATURE_NO_TITLE);\n    // ......\n    }\n</code></pre> <p>\u7136\u540e\u5728onStart\u65b9\u6cd5\u91cc\u91cd\u65b0\u6307\u5b9a\u5bbd\u9ad8</p> <p>\u5148\u8bbe\u7f6e\u900f\u660e\u80cc\u666f\uff0c\u7136\u540e\u901a\u8fc7<code>DisplayMetrics</code>\u8bbe\u7f6e\u5bbd\u9ad8\u3002 <pre><code>    private int mDialogWid  = -1;\n    private int mDialogHeight = -1;\n\n    @Override\n    public void onStart() {\n        Log.d(TAG, \"onStart\");\n        super.onStart();\n        Window window = getDialog().getWindow();\n        if (null != window) {\n            WindowManager.LayoutParams windowParams = window.getAttributes();\n            windowParams.dimAmount = 0.0f;\n            window.setAttributes(windowParams);\n            DisplayMetrics dm = new DisplayMetrics();\n            getActivity().getWindowManager().getDefaultDisplay().getMetrics(dm);\n            if (mDialogHeight &lt; 0) {\n                mDialogHeight = (int) (dm.heightPixels * 0.7);\n                mDialogWid = (int) (dm.widthPixels * 0.5);\n            }\n            window.setLayout(mDialogWid, mDialogHeight);\n        }\n    }\n</code></pre> \u9ed8\u8ba4\u6a2a\u5c4f\u60c5\u51b5\u4e0b\uff0cdialogFragment\u663e\u793a\u51fa\u6765\uff0c\u9501\u5c4f\u518d\u89e3\u9501\u540e\uff0c\u624b\u673a\u89e3\u9501\u540e\u53ef\u80fd\u4f1a\u6709\u4ece\u7ad6\u5c4f\u8f6c\u6362\u5230\u6a2a\u5c4f\u7684\u52a8\u4f5c\uff0cdialog\u5bbd\u9ad8\u5f88\u53ef\u80fd\u663e\u793a\u4e0d\u6b63\u5e38\u3002 \u53ef\u4ee5\u521b\u5efadialog\u5bbd\u9ad8\u5c5e\u6027mDialogWid\uff0cmDialogHeight\u9ed8\u8ba4\u4e3a\u8d1f\u503c\uff1bonStart\u4e2d\u5224\u65ad\u4e00\u4e0b\u662f\u5426\u4f7f\u7528\u8bb0\u5f55\u4e2d\u7684\u5bbd\u9ad8\u3002</p> <p>DialogFragment\u751f\u547d\u5468\u671f\uff0c\u521b\u5efa\uff0c\u663e\u793a\u6700\u540e\u9500\u6bc1 <pre><code>onAttach\nonCreate\nonCreateDialog\nonCreateView\nonViewStateRestored\nonStart\nonPause\nonDestroy\n</code></pre></p> <p>\u521b\u5efa\uff0c\u663e\u793a\uff0c\u9501\u5c4f\uff0c\u89e3\u9501\uff0c\u6700\u540e\u9500\u6bc1\uff1b\u4ee5\u4e0b\u662f\u4e09\u661f\u624b\u673alog <pre><code>onAttach\nonCreate\nonCreateDialog\nonCreateView\nonViewStateRestored\nonStart\nonPause // \u9501\u5c4f\nonSaveInstanceState\nonStart // \u4eae\u5c4f\u4f46\u8fd8\u6ca1\u89e3\u9501\nonPause\nonSaveInstanceState\nonStart // \u89e3\u9501\nonPause\nonDestroy\n</code></pre></p>"},{"location":"android/fragment/dialogFragment/custom_width_height/#fragmentdialog","title":"\u81ea\u5b9a\u4e49FragmentDialog","text":"<p>\u81ea\u5b9a\u4e49FragmentDialog</p> <p>\u4f7f\u7528\u7684\u6837\u5f0f <pre><code>    &lt;style name=\"TranslucentStyle\"&gt;\n        &lt;item name=\"android:windowNoTitle\"&gt;true&lt;/item&gt;\n        &lt;!--windowBackground\u662f\u8bbe\u7f6e\u4f60\u7684xml\u663e\u793a\u7684root\u7684\u80cc\u666f--&gt;\n        &lt;item name=\"android:windowBackground\"&gt;@color/transparent&lt;/item&gt;\n    &lt;/style&gt;\n</code></pre></p> <p><code>BlackRedConfirmDialog.java</code> <pre><code>import android.os.Bundle;\nimport android.util.DisplayMetrics;\nimport android.view.LayoutInflater;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.view.Window;\nimport android.view.WindowManager;\nimport android.widget.TextView;\n\nimport com.rustfisher.demo.R;\n\n/**\n * \u786e\u8ba4\u548c\u53d6\u6d88 \u7ea2\u4e0e\u9ed1\n * Created by Rust on 2018/04/28.\n */\npublic class BlackRedConfirmDialog extends android.support.v4.app.DialogFragment {\n    public static final String F_TAG = \"f_tag_confirm_dialog\";\n    private int mDialogWid = -1;\n    private int mDialogHeight = -1;\n\n    private String mContent = \"\";\n    private String mTitle = \"\";\n    private String mCancelText = \"Cancel\";\n    private String mConfirmText = \"Confirm\";\n\n    private OnItemClickListener onItemClickListener;\n\n    public void setOnItemClickListener(OnItemClickListener onItemClickListener) {\n        this.onItemClickListener = onItemClickListener;\n    }\n\n    public static BlackRedConfirmDialog build(String title, String content, String cancelText, String confirmText) {\n        BlackRedConfirmDialog d = new BlackRedConfirmDialog();\n        d.setConfirmText(confirmText);\n        d.setContent(content);\n        d.setTitle(title);\n        d.setCancelText(cancelText);\n        return d;\n    }\n\n    @Override\n    public void onStart() {\n        super.onStart();\n        Window window = getDialog().getWindow();\n        if (null != window) {\n            WindowManager.LayoutParams windowParams = window.getAttributes();\n            windowParams.dimAmount = 0.0f;\n            window.setAttributes(windowParams);\n            DisplayMetrics dm = new DisplayMetrics();\n            getActivity().getWindowManager().getDefaultDisplay().getMetrics(dm);\n            if (mDialogWid &lt; 0) {\n                mDialogHeight = (int) (dm.heightPixels * 0.55);\n                mDialogWid = (int) (dm.widthPixels * 0.5);\n            }\n            window.setLayout(mDialogWid, mDialogHeight);\n        }\n    }\n\n    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n        Window window = getDialog().getWindow();\n        if (null != window) {\n            window.requestFeature(Window.FEATURE_NO_TITLE);\n        }\n        View root = inflater.inflate(R.layout.dialog_yes_no, container, false);\n        TextView confirmTv = root.findViewById(R.id.confirm_tv);\n        TextView cancelTv = root.findViewById(R.id.cancel_tv);\n        TextView titleTv = root.findViewById(R.id.title_tv);\n        TextView contentTv = root.findViewById(R.id.content_tv);\n        titleTv.setText(mTitle);\n        contentTv.setText(mContent);\n        cancelTv.setText(mCancelText);\n        confirmTv.setText(mConfirmText);\n        confirmTv.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                if (null != onItemClickListener) {\n                    onItemClickListener.onConfirm();\n                }\n            }\n        });\n        cancelTv.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                if (null != onItemClickListener) {\n                    onItemClickListener.onCancel();\n                }\n            }\n        });\n\n        return root;\n    }\n\n    public void setContent(String mContent) {\n        this.mContent = mContent;\n    }\n\n    public void setTitle(String mTitle) {\n        this.mTitle = mTitle;\n    }\n\n    public void setCancelText(String mCancelText) {\n        this.mCancelText = mCancelText;\n    }\n\n    public void setConfirmText(String mConfirmText) {\n        this.mConfirmText = mConfirmText;\n    }\n\n    public interface OnItemClickListener {\n        void onCancel();\n\n        void onConfirm();\n    }\n}\n</code></pre></p> <p><code>dialog_yes_no.xml</code> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:background=\"#24292f\"&gt;\n\n    &lt;View\n        android:id=\"@+id/header_view\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"40dp\"\n        android:background=\"@drawable/shape_dialog_header_bg\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/title_tv\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_below=\"@id/header_view\"\n        android:layout_centerHorizontal=\"true\"\n        android:layout_marginTop=\"4dp\"\n        android:textColor=\"#ffffff\"\n        android:textSize=\"18sp\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/content_tv\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_below=\"@id/title_tv\"\n        android:layout_centerHorizontal=\"true\"\n        android:layout_marginTop=\"12dp\"\n        android:textColor=\"#818181\"\n        android:textSize=\"15sp\" /&gt;\n\n    &lt;LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"42dp\"\n        android:layout_alignParentBottom=\"true\"\n        android:layout_marginTop=\"24dp\"\n        android:orientation=\"horizontal\"&gt;\n\n        &lt;TextView\n            android:id=\"@+id/cancel_tv\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\"\n            android:layout_weight=\"1\"\n            android:background=\"#373b40\"\n            android:gravity=\"center\"\n            android:text=\"cancel\"\n            android:textColor=\"#ffffff\"\n            android:textSize=\"16sp\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/confirm_tv\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\"\n            android:layout_weight=\"1\"\n            android:background=\"#e34e15\"\n            android:gravity=\"center\"\n            android:text=\"yes\"\n            android:textColor=\"#ffffff\"\n            android:textSize=\"16sp\" /&gt;\n\n    &lt;/LinearLayout&gt;\n\n&lt;/RelativeLayout&gt;\n</code></pre></p> <p><code>shape_dialog_header_bg.xml</code> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;shape xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n\n    &lt;gradient\n        android:angle=\"270\"\n        android:endColor=\"#00252a30\"\n        android:startColor=\"#e8e95c27\" /&gt;\n\n&lt;/shape&gt;\n</code></pre></p>"},{"location":"android/fragment/dialogFragment/custom_width_height/#builderdialogfragment","title":"Builder\u6a21\u5f0f\u7684DialogFragment","text":"<p>\u9700\u8981\u914d\u7f6e\u7684\u5c5e\u6027\u592a\u591a\u4e86\uff0c\u4f7f\u7528Builder\u6a21\u5f0f\u3002 \u8c03\u7528\u7684\u65f6\u5019\u4e00\u4e32\u4ee3\u7801\u5373\u53ef\u641e\u5b9a\uff0c\u4f8b\u5982 <pre><code>    /**\n     * \u663e\u793a\u786e\u8ba4\u5f39\u7a97\n     * \u5f39\u7a97\u6837\u5f0f\u4e3a \u70b9\u51fb\u6309\u94ae\u5219\u6d88\u5931\n     */\n    private void showDefDismissUConfirmDialog(int textResId, final String fTag) {\n        new UConfirmDialog.Builder().create()\n                .setContent(textResId)\n                .hideHeaderIvAndTv().defaultDismiss().setConfirmTextResId(R.string.confirm)\n                .build()\n                .show(getSupportFragmentManager(), fTag);\n    }\n</code></pre></p> <p>\u5f39\u7a97\u4ee3\u7801 <code>UConfirmDialog.java</code> <pre><code>import android.os.Bundle;\nimport android.support.v4.app.DialogFragment;\nimport android.text.TextUtils;\nimport android.util.DisplayMetrics;\nimport android.view.LayoutInflater;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.view.Window;\nimport android.view.WindowManager;\nimport android.widget.ImageView;\nimport android.widget.TextView;\n\nimport com.xxxx.R;\n\n/**\n * \u786e\u8ba4\u5f39\u7a97\n * Created by Rust on 2018/05/04.\n */\npublic class UConfirmDialog extends DialogFragment {\n    public static final String F_TAG = \"f_tag_xxx_confirm_dialog\";\n    private int mDialogWid = -1;\n    private int mDialogHeight = -1;\n\n    private boolean mShowHeadIv = true;\n    private boolean mShowTitleTv = true;\n    private int mHeadIvResId;\n    private int mContentResId = -1;\n    private int mConfirmTextResId = -1;\n    private int mTitleTextResId = -1;\n    private String mContent = \"\";\n    private String mTitle = \"\";\n    private String mConfirmText = \"Confirm\";\n\n    private OnItemClickListener onItemClickListener;\n\n    public void setOnItemClickListener(OnItemClickListener onItemClickListener) {\n        this.onItemClickListener = onItemClickListener;\n    }\n\n    @Override\n    public void onStart() {\n        super.onStart();\n        Window window = getDialog().getWindow();\n        if (null != window) {\n            WindowManager.LayoutParams windowParams = window.getAttributes();\n            windowParams.dimAmount = 0.0f;\n            window.setAttributes(windowParams);\n            DisplayMetrics dm = new DisplayMetrics();\n            getActivity().getWindowManager().getDefaultDisplay().getMetrics(dm);\n            if (mDialogWid &lt; 0) {\n                mDialogHeight = (int) (dm.heightPixels * 0.68);\n                mDialogWid = (int) (dm.widthPixels * 0.65);\n            }\n            window.setLayout(mDialogWid, mDialogHeight);\n        }\n    }\n\n    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n        Window window = getDialog().getWindow();\n        if (null != window) {\n            window.requestFeature(Window.FEATURE_NO_TITLE);\n        }\n        View root = inflater.inflate(R.layout.dialog_u_confirm, container, false);\n        ImageView headIv = root.findViewById(R.id.head_iv);\n        TextView confirmTv = root.findViewById(R.id.confirm_tv);\n        View closeIv = root.findViewById(R.id.close_iv);\n        TextView titleTv = root.findViewById(R.id.title_tv);\n        TextView contentTv = root.findViewById(R.id.content_tv);\n\n        if (mContentResId &gt; 0 &amp;&amp; TextUtils.isEmpty(mContent)) {\n            contentTv.setText(mContentResId);\n        } else {\n            contentTv.setText(mContent);\n        }\n        if (mConfirmTextResId &gt; 0) {\n            confirmTv.setText(mConfirmTextResId);\n        } else {\n            confirmTv.setText(mConfirmText);\n        }\n        confirmTv.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                if (null != onItemClickListener) {\n                    onItemClickListener.onConfirm();\n                }\n            }\n        });\n        closeIv.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                if (null != onItemClickListener) {\n                    onItemClickListener.onCancel();\n                }\n            }\n        });\n        if (mTitleTextResId &gt; 0 &amp;&amp; TextUtils.isEmpty(mTitle)) {\n            titleTv.setText(mTitleTextResId);\n        } else {\n            titleTv.setText(mTitle);\n        }\n\n        titleTv.setVisibility(mShowTitleTv ? View.VISIBLE : View.GONE);\n        if (mShowHeadIv) {\n            headIv.setImageResource(mHeadIvResId);\n            headIv.setVisibility(View.VISIBLE);\n        } else {\n            headIv.setVisibility(View.GONE);\n        }\n        return root;\n    }\n\n    public void setConfirmTextResId(int id) {\n        this.mConfirmTextResId = id;\n    }\n\n    public void setContent(String mContent) {\n        this.mContent = mContent;\n    }\n\n    public void setContent(int resId) {\n        this.mContentResId = resId;\n    }\n\n    public void setContentResId(int mContentResId) {\n        this.mContentResId = mContentResId;\n    }\n\n    public void setTitle(String mTitle) {\n        this.mTitle = mTitle;\n    }\n\n    public void setTitleTextResId(int mTitleTextResId) {\n        this.mTitleTextResId = mTitleTextResId;\n    }\n\n    public void setConfirmText(String mConfirmText) {\n        this.mConfirmText = mConfirmText;\n    }\n\n    public void setShowHeadIv(boolean mShowHeadIv) {\n        this.mShowHeadIv = mShowHeadIv;\n    }\n\n    public void setHeadIvResId(int mHeadIvResId) {\n        this.mHeadIvResId = mHeadIvResId;\n    }\n\n    public void setShowTitleTv(boolean mShowTitleTv) {\n        this.mShowTitleTv = mShowTitleTv;\n    }\n\n    public interface OnItemClickListener {\n        void onCancel();\n\n        void onConfirm();\n    }\n\n    public static class Builder {\n        private UConfirmDialog d;\n\n        public Builder create() {\n            d = new UConfirmDialog();\n            d.setStyle(DialogFragment.STYLE_NORMAL, R.style.TranslucentStyle); // \u8bbe\u5b9a\u900f\u660e\u80cc\u666f\u6837\u5f0f\n            return this;\n        }\n\n        public Builder setTitle(String title) {\n            d.setTitle(title);\n            return this;\n        }\n\n        public Builder setTitle(int resId) {\n            d.setTitleTextResId(resId);\n            return this;\n        }\n\n        public Builder showTitle(boolean showTitle) {\n            d.setShowTitleTv(showTitle);\n            return this;\n        }\n\n        public Builder showHeadIv(boolean show) {\n            d.setShowHeadIv(show);\n            return this;\n        }\n\n        public Builder setHeadIvRes(int resId) {\n            d.setHeadIvResId(resId);\n            return this;\n        }\n\n        public Builder hideHeaderIvAndTv() {\n            d.setShowHeadIv(false);\n            d.setShowTitleTv(false);\n            return this;\n        }\n\n        public Builder setContent(int resId) {\n            d.setContentResId(resId);\n            return this;\n        }\n\n        public Builder setContent(String content) {\n            d.setContent(content);\n            return this;\n        }\n\n        public Builder setConfirmTextResId(int resId) {\n            d.setConfirmTextResId(resId);\n            return this;\n        }\n\n        public Builder defaultDismiss() {\n            d.setOnItemClickListener(new OnItemClickListener() {\n                @Override\n                public void onCancel() {\n                    d.dismiss();\n                }\n\n                @Override\n                public void onConfirm() {\n                    d.dismiss();\n                }\n            });\n            return this;\n        }\n\n        public Builder setOnItemClickListener(OnItemClickListener listener) {\n            d.setOnItemClickListener(listener);\n            return this;\n        }\n\n        public UConfirmDialog build() {\n            return d;\n        }\n\n    }\n}\n</code></pre></p> <p>xml\u6587\u4ef6 <code>dialog_u_confirm.xml</code> \u548c\u76f8\u5bf9\u5e94\u7684\u90e8\u5206\u8d44\u6e90 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:background=\"@drawable/pic_def_dialog_bg\"&gt;\n\n    &lt;ImageView\n        android:id=\"@+id/close_iv\"\n        style=\"@style/UDialogCloseIconStyle\" /&gt;\n\n    &lt;LinearLayout\n        android:id=\"@+id/main_title_layout\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_below=\"@id/header_view\"\n        android:layout_marginTop=\"12dp\"\n        android:gravity=\"center_horizontal\"\n        android:orientation=\"vertical\"&gt;\n\n        &lt;ImageView\n            android:id=\"@+id/head_iv\"\n            android:layout_width=\"42dp\"\n            android:layout_height=\"42dp\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/title_tv\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:layout_marginTop=\"8dp\"\n            android:textColor=\"#ffffff\"\n            android:textSize=\"20sp\" /&gt;\n\n    &lt;/LinearLayout&gt;\n\n    &lt;TextView\n        android:id=\"@+id/confirm_tv\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"42dp\"\n        android:layout_alignParentBottom=\"true\"\n        android:background=\"#e34e15\"\n        android:gravity=\"center\"\n        android:text=\"yes\"\n        android:textColor=\"#ffffff\"\n        android:textSize=\"16sp\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/content_tv\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"match_parent\"\n        android:layout_above=\"@id/confirm_tv\"\n        android:layout_below=\"@id/main_title_layout\"\n        android:layout_centerHorizontal=\"true\"\n        android:layout_marginEnd=\"34dp\"\n        android:layout_marginStart=\"34dp\"\n        android:layout_marginTop=\"-4dp\"\n        android:gravity=\"center\"\n        android:textColor=\"#ffffff\"\n        android:textSize=\"16sp\" /&gt;\n\n&lt;/RelativeLayout&gt;\n</code></pre></p> <p><code>styles.xml</code> <pre><code>    &lt;!-- \u5f39\u7a97\u53f3\u4e0a\u89d2\u7684\u5173\u95ed\u6309\u94ae --&gt;\n    &lt;style name=\"UDialogCloseIconStyle\"&gt;\n        &lt;item name=\"android:layout_height\"&gt;@dimen/u_dialog_close_icon_size&lt;/item&gt;\n        &lt;item name=\"android:layout_width\"&gt;@dimen/u_dialog_close_icon_size&lt;/item&gt;\n        &lt;item name=\"android:layout_alignParentEnd\"&gt;true&lt;/item&gt;\n        &lt;item name=\"android:padding\"&gt;2dp&lt;/item&gt;\n        &lt;item name=\"android:layout_marginEnd\"&gt;8dp&lt;/item&gt;\n        &lt;item name=\"android:layout_marginTop\"&gt;6dp&lt;/item&gt;\n        &lt;item name=\"android:src\"&gt;@drawable/ic_close_dialog&lt;/item&gt;\n    &lt;/style&gt;\n</code></pre></p>"},{"location":"android/fragment/dialogFragment/custom_width_height/#_1","title":"\u81ea\u5b9a\u4e49\u8fdb\u5ea6\u6761\u5f39\u7a97","text":"<p>\u81ea\u5b9a\u4e49\u4e00\u4e2a\u80cc\u666f\u900f\u660e\u7684<code>UProgressDialog</code></p> <p>\u5bf9\u4e8eprogress\uff0c\u5148\u81ea\u5b9a\u4e49\u6837\u5f0f<code>layer_list_u_progress_bar.xml</code> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layer-list xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n    &lt;!--\n      layer-list\u6837\u5f0f\u6309\u7167\u987a\u5e8f\u5806\u53e0\uff0c\u6240\u4ee5\u6700\u4e0a\u5c42\u7684\u653e\u5728\u6700\u540e\u9762\uff0c\u800c\u4e14\u5982\u679c\u8bbe\u7f6e\u4e86progressDrawable\n      \u7684\u5c5e\u6027\uff0c\u518d\u53bb\u8bbe\u7f6eprogressbar\u7684background\u662f\u6ca1\u6709\u6548\u679c\u7684\n      --&gt;\n    &lt;item android:id=\"@android:id/background\"&gt;\n        &lt;shape&gt;\n            &lt;corners android:radius=\"3dp\" /&gt;\n            &lt;solid android:color=\"#ffffff\" /&gt;\n        &lt;/shape&gt;\n    &lt;/item&gt;\n    &lt;item android:id=\"@android:id/progress\"&gt;\n        &lt;clip&gt;\n            &lt;shape&gt;\n                &lt;corners android:radius=\"3dp\" /&gt;\n                &lt;solid android:color=\"#f65212\" /&gt;\n            &lt;/shape&gt;\n        &lt;/clip&gt;\n    &lt;/item&gt;\n&lt;/layer-list&gt;\n</code></pre></p> <p>layout\u6587\u4ef6<code>dialog_u_progress.xml</code>\uff1b\u4e00\u4e2atv\u4e00\u4e2apb <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:background=\"@android:color/transparent\"\n    android:gravity=\"center\"&gt;\n\n    &lt;ProgressBar\n        android:id=\"@+id/d_pb\"\n        style=\"?android:attr/progressBarStyleHorizontal\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"6dp\"\n        android:layout_centerInParent=\"true\"\n        android:layout_margin=\"10dp\"\n        android:maxHeight=\"6dp\"\n        android:progressDrawable=\"@drawable/layer_list_u_progress_bar\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/d_tv\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_above=\"@id/d_pb\"\n        android:gravity=\"center\"\n        android:text=\"Content 10%\"\n        android:textColor=\"#ffffff\"\n        android:textSize=\"16sp\" /&gt;\n&lt;/RelativeLayout&gt;\n</code></pre></p> <p><code>UProgressDialog.java</code> \u6307\u5b9a\u4e86\u5f39\u7a97\u5bbd\u9ad8 <pre><code>import android.os.Bundle;\nimport android.support.v4.app.DialogFragment;\nimport android.util.DisplayMetrics;\nimport android.view.LayoutInflater;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.view.Window;\nimport android.view.WindowManager;\nimport android.widget.ProgressBar;\nimport android.widget.TextView;\n\nimport com.xxx.R;\n\npublic class UProgressDialog extends DialogFragment {\n    private int mDialogWid = -1;\n    private int mDialogHeight = -1;\n\n    private int mPbMax = 100;\n    private TextView mTv;\n    private ProgressBar mPb;\n    private String sText;\n\n    @Override\n    public void onStart() {\n        super.onStart();\n        Window window = getDialog().getWindow();\n        if (null != window) {\n            WindowManager.LayoutParams windowParams = window.getAttributes();\n            windowParams.dimAmount = 0.0f;\n            window.setAttributes(windowParams);\n            DisplayMetrics dm = new DisplayMetrics();\n            getActivity().getWindowManager().getDefaultDisplay().getMetrics(dm);\n            if (mDialogWid &lt; 0) {\n                mDialogHeight = (int) (dm.heightPixels * 0.68);\n                mDialogWid = (int) (dm.widthPixels * 0.45);\n            }\n            window.setLayout(mDialogWid, mDialogHeight);\n        }\n    }\n\n    @Override\n    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\n        View root = inflater.inflate(R.layout.dialog_u_progress, container, false);\n        init(root);\n        return root;\n    }\n\n    public void setContent(String text) {\n        this.sText = text;\n    }\n\n    public void updateContent(String text) {\n        setContent(text);\n        mTv.setText(sText);\n    }\n\n    private void init(View root) {\n        mTv = root.findViewById(R.id.d_tv);\n        mPb = root.findViewById(R.id.d_pb);\n        mPb.setMax(mPbMax);\n    }\n\n    public void setProgressBar(int progress) {\n        if (mPb != null) {\n            mPb.setProgress(progress);\n        }\n    }\n\n}\n</code></pre> \u8c03\u7528\u65f6\u8bbe\u7f6e\u900f\u660e\u80cc\u666f <pre><code>    // \u65b0\u5efaDialogFragment\n    mProgressDialog = new UProgressDialog();\n    mProgressDialog.setStyle(DialogFragment.STYLE_NORMAL, R.style.Translucent_Origin);\n    Fragment fragment = getSupportFragmentManager().findFragmentByTag(fTag);\n    if (null != fragment &amp;&amp; fragment.isAdded()) {\n        getSupportFragmentManager().beginTransaction().remove(fragment).commit();\n    }\n    mProgressDialog.show(getSupportFragmentManager(), fTag);\n\n    // \u8bbe\u7f6e\u8fdb\u5ea6\u548c\u6587\u5b57\n    int progress = 42;\n    if (mProgressDialog != null &amp;&amp; mProgressDialog.isVisible()) {\n        mProgressDialog.setProgressBar(progress);\n        mProgressDialog.updateContent(progress + \"%\");\n        if (progress == 100) {\n            mProgressDialog.dismiss();\n        }\n    }\n</code></pre></p>"},{"location":"android/fragment/dialogFragment/df-dialog-height-changed/","title":"DialogFragment\u81ea\u9002\u5e94\u9ad8\u5ea6","text":"<p>\u6211\u4eec\u7528DialogFragment\u6765\u663e\u793a\u4e00\u4e9b\u4fe1\u606f\u3002 dialog\u7684\u9ad8\u5ea6\u4f1a\u968f\u7740\u663e\u793a\u7684\u4fe1\u606f\u7684\u591a\u5c11\u800c\u53d8\u5316\u3002</p> <p>\u4e0b\u9762\u7ed9\u51fa\u51e0\u4e2a\u4f8b\u5b50</p>"},{"location":"android/fragment/dialogFragment/df-dialog-height-changed/#4layout","title":"4\u4e2alayout","text":"<p>\u5148\u51c6\u5907\u4e00\u4e9b\u6587\u5b57\u8d44\u6e90 <pre><code>&lt;string name=\"sample_text2\"&gt;\u6b22\u8fce\u6765\u770b\u6211\u7684\u5de5\u7a0b&lt;/string&gt;\n</code></pre></p> <p>\u4e0d\u540c\u7684layout\uff0c\u663e\u793a\u540c\u6837\u591a\u7684\u63a7\u4ef6</p>"},{"location":"android/fragment/dialogFragment/df-dialog-height-changed/#constraintlayout","title":"ConstraintLayout","text":"<p><code>show_version_dialog_con.xml</code> \u663e\u793a\u51e0\u4e2aTextView</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:background=\"#fff\"\n    android:minWidth=\"200dp\"\n    android:orientation=\"vertical\"\n    android:paddingStart=\"0dp\"\n    android:paddingEnd=\"0dp\"\n    android:paddingBottom=\"12dp\"&gt;\n\n    &lt;TextView\n        android:id=\"@+id/title_tv\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"50dp\"\n        android:gravity=\"center\"\n        android:text=\"Title\"\n        android:textColor=\"#120101\"\n        android:textSize=\"18sp\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv1\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:gravity=\"center\"\n        android:text=\"\"\n        android:textColor=\"#222222\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@id/title_tv\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv2\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"@string/sample_text2\"\n        android:textColor=\"#222222\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv1\" /&gt;\n\n    &lt;Button\n        android:id=\"@+id/confirm_btn\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginTop=\"20dp\"\n        android:layout_marginBottom=\"20dp\"\n        android:paddingStart=\"12dp\"\n        android:paddingEnd=\"12dp\"\n        android:text=\"OK\"\n        android:textColor=\"#222222\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv2\" /&gt;\n\n&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre> <p></p>"},{"location":"android/fragment/dialogFragment/df-dialog-height-changed/#constraintlayout-button","title":"ConstraintLayout button\u9760\u5e95","text":"<p>\u76f8\u6bd4\u4e8e\u4e0a\u4e00\u4e2a\uff0c\u6211\u4eec\u628aButton\u7684\u4f4d\u7f6e\u6539\u4e3a\u5728\u7236layout\u7684\u5e95\u90e8\u3002 <code>show_version_dialog_con_btn_bot.xml</code> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:background=\"#fff\"\n    android:minWidth=\"200dp\"\n    android:orientation=\"vertical\"\n    android:paddingStart=\"0dp\"\n    android:paddingEnd=\"0dp\"\n    android:paddingBottom=\"12dp\"&gt;\n\n    &lt;TextView\n        android:id=\"@+id/title_tv\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"50dp\"\n        android:gravity=\"center\"\n        android:text=\"Title\"\n        android:textColor=\"#120101\"\n        android:textSize=\"18sp\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv1\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:gravity=\"center\"\n        android:text=\"\"\n        android:textColor=\"#222222\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@id/title_tv\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv2\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"@string/sample_text2\"\n        android:textColor=\"#222222\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@id/tv1\" /&gt;\n\n    &lt;Button\n        android:id=\"@+id/confirm_btn\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginTop=\"20dp\"\n        android:layout_marginBottom=\"20dp\"\n        android:paddingStart=\"12dp\"\n        android:paddingEnd=\"12dp\"\n        android:text=\"OK\"\n        android:textColor=\"#222222\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\" /&gt;\n\n&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre></p> <p>\u6700\u540e\u4e00\u4e2aButton\u8bbe\u7f6e\u4e86<code>app:layout_constraintBottom_toBottomOf=\"parent\"</code></p> <p></p>"},{"location":"android/fragment/dialogFragment/df-dialog-height-changed/#relativelayout","title":"RelativeLayout","text":"<p><code>show_version_dialog_rela.xml</code> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:background=\"#DADADA\"&gt;\n\n    &lt;TextView\n        android:id=\"@+id/title\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:gravity=\"center_horizontal\"\n        android:text=\"\u6211\u662f\u6807\u9898\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv1\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_below=\"@id/title\"\n        android:layout_centerHorizontal=\"true\"\n        android:textColor=\"#007CFF\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv2\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_below=\"@id/tv1\"\n        android:layout_centerHorizontal=\"true\"\n        android:text=\"@string/sample_text2\"\n        android:textColor=\"#007CFF\" /&gt;\n\n    &lt;Button\n        android:id=\"@+id/btn1\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_below=\"@id/tv2\"\n        android:layout_centerHorizontal=\"true\"\n        android:layout_marginEnd=\"20dp\"\n        android:text=\"yes\" /&gt;\n\n&lt;/RelativeLayout&gt;\n</code></pre></p> <p></p>"},{"location":"android/fragment/dialogFragment/df-dialog-height-changed/#relativelayout-button","title":"RelativeLayout button\u9760\u5e95","text":"<p><code>show_version_dialog_rela_btn_bot.xml</code></p> <p><pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:background=\"#DADADA\"&gt;\n\n    &lt;TextView\n        android:id=\"@+id/title\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:gravity=\"center_horizontal\"\n        android:text=\"\u6211\u662f\u6807\u9898\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv1\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_below=\"@id/title\"\n        android:layout_centerHorizontal=\"true\"\n        android:textColor=\"#007CFF\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv2\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_below=\"@id/tv1\"\n        android:layout_centerHorizontal=\"true\"\n        android:text=\"@string/sample_text2\"\n        android:textColor=\"#007CFF\" /&gt;\n\n    &lt;Button\n        android:id=\"@+id/btn1\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_alignParentBottom=\"true\"\n        android:layout_centerHorizontal=\"true\"\n        android:layout_marginEnd=\"20dp\"\n        android:text=\"yes\" /&gt;\n\n&lt;/RelativeLayout&gt;\n</code></pre> \u6700\u540e\u4e00\u4e2aButton\u8bbe\u7f6e\u4e86<code>android:layout_alignParentBottom=\"true\"</code></p> <p></p>"},{"location":"android/fragment/dialogFragment/df-dialog-height-changed/#dialogfragment_1","title":"DialogFragment\u7684\u4ee3\u7801","text":"<p>\u663e\u793a\u4e00\u4e9b\u7cfb\u7edf\u57fa\u7840\u4fe1\u606f\u3002</p> <pre><code>import android.os.Build;\nimport android.os.Bundle;\nimport android.util.Log;\nimport android.view.LayoutInflater;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.widget.TextView;\n\nimport androidx.annotation.NonNull;\nimport androidx.annotation.Nullable;\nimport androidx.fragment.app.DialogFragment;\n\npublic class ShowVersionDialogFrag extends DialogFragment {\n    private static final String TAG = \"rustAppShowVersion\";\n    public int layoutId = R.layout.show_version_dialog_con;\n\n    @Nullable\n    @Override\n    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {\n        Log.d(TAG, \"onCreateView\");\n        return inflater.inflate(layoutId, container, false);\n    }\n\n    @Override\n    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\n        super.onViewCreated(view, savedInstanceState);\n        Log.d(TAG, \"onViewCreated\");\n        TextView tv1 = view.findViewById(R.id.tv1);\n        final String text1 = \"RustFisher \\nSDK_INT: \" + Build.VERSION.SDK_INT +\n                \"\\nBuild.MODEL: \" + Build.MODEL +\n                \"\\nBuild.PRODUCT: \" + Build.PRODUCT +\n                \"\\nBuild.BRAND: \" + Build.BRAND;\n        tv1.setText(text1);\n    }\n}\n</code></pre> <p>\u4f7f\u7528\u7684\u65f6\u5019\u628alayout\u7684id\u4f20\u8fdb\u53bb <pre><code>private void popShowVersionDialog(int layoutId) {\n    ShowVersionDialogFrag dialogFrag = new ShowVersionDialogFrag();\n    dialogFrag.layoutId = layoutId;\n    dialogFrag.show(getSupportFragmentManager(), \"show-dialog-for-bug\");\n}\n</code></pre></p>"},{"location":"android/fragment/dialogFragment/df-dialog-height-changed/#_1","title":"\u8fd0\u884c\u6548\u679c\u56fe\u5bf9\u6bd4","text":"<p>\u53ef\u4ee5\u770b\u51fa\uff0c\u4f7f\u7528RelativeLayout\u65f6\u5019\uff0c\u5982\u679c\u6709\u63a7\u4ef6\u9760\u7740\u5e95\u90e8\uff0c\u4f1a\u628adialog\u62c9\u9ad8\u3002</p>"},{"location":"android/fragment/dialogFragment/dialog-fragment-demo1/","title":"DialogFragment\u4f7f\u7528\u793a\u4f8b1","text":"<p>\u5f39\u7a97\uff0c\u662f\u5e38\u89c1\u7684\u4e00\u79cd\u63d0\u793a\u65b9\u5f0f\u3002\u5e02\u9762\u4e0a\u6709\u591a\u79cd\u591a\u6837\u3001\u4e94\u5f69\u7f24\u7eb7\u7684\u5f39\u7a97\u3002</p> <p></p> <p>\u672c\u6587\u8bb0\u5f55\u5f39\u51fa\u4e00\u4e2a\u7b80\u5355\u7a97\u53e3\u7684\u65b9\u6cd5\u3002</p>"},{"location":"android/fragment/dialogFragment/dialog-fragment-demo1/#ui","title":"\u786e\u5b9aUI\u6837\u5f0f","text":"<p>\u9996\u5148\u6211\u4eec\u5f97\u77e5\u9053\u505a\u6210\u4ec0\u4e48\u6837\u3002\u4e00\u822c\u6765\u8bf4\u7b80\u5355\u7684\u5f39\u7a97\u662f\u4e00\u4e2a\u6807\u9898\uff0c\u4e00\u7aef\u6587\u5b57\u5185\u5bb9\u3002 \u6216\u8005\u5e26\u6709\u4e00\u4e24\u4e2a\u6309\u94ae\u3002</p> <p>\u8fd9\u91cc\u6211\u4eec\u505a\u4e00\u4e2a\u6709\u6807\u9898\u548c\u6587\u5b57\u7684\u7b80\u5355\u5f39\u7a97\u3002</p>"},{"location":"android/fragment/dialogFragment/dialog-fragment-demo1/#layout","title":"layout","text":"<p>\u786e\u5b9a\u597d\u6837\u5f0f\u540e\uff0c\u5148\u628alayout\u5199\u51fa\u6765\u3002</p> <p>dialog_simple.xml <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:padding=\"12dp\"&gt;\n\n    &lt;TextView\n        android:id=\"@+id/title_tv\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:gravity=\"center\"\n        android:textColor=\"#111111\"\n        android:textSize=\"16sp\"\n        android:textStyle=\"bold\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/content_tv\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginTop=\"20dp\"\n        android:gravity=\"center\"\n        android:textColor=\"#111111\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@id/title_tv\" /&gt;\n\n&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre></p>"},{"location":"android/fragment/dialogFragment/dialog-fragment-demo1/#_1","title":"\u65b0\u5efa\u5f39\u7a97\u7c7b","text":"<p>\u65b0\u5efa\u4e00\u4e2a<code>SimpleDialog</code>\u7c7b\u7ee7\u627f<code>DialogFragment</code>\u3002</p> <ul> <li>\u5728<code>onCreate</code>\u65b9\u6cd5\u4e2d\u63a5\u6536\u4f20\u5165\u7684\u6570\u636e\u3002\u4f20\u9012\u6570\u636e\u4f7f\u7528\u4e86Bundle\u3002</li> <li>\u5728<code>onCreateView</code>\u65b9\u6cd5\u4e2d\uff0c\u4f7f\u7528\u4e0a\u6587\u5efa\u7acb\u7684layout\u3002</li> <li>\u5728<code>onViewCreated</code>\u65b9\u6cd5\u4e2d\u8fdb\u884cui\u64cd\u4f5c\u3002</li> </ul> <pre><code>import android.os.Bundle;\nimport android.view.LayoutInflater;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.widget.TextView;\nimport androidx.annotation.NonNull;\nimport androidx.annotation.Nullable;\nimport androidx.fragment.app.DialogFragment;\n\npublic class SimpleDialog extends DialogFragment {\n    public static final String K_TITLE = \"k_title\"; // \u4f20\u8f93\u6570\u636e\u65f6\u7528\u5230\u7684key\n    public static final String K_CONTENT = \"k_content\";\n\n    private String title;\n    private String content;\n\n    @Override\n    public void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        Bundle in = getArguments();\n        if (in != null) {\n            title = in.getString(K_TITLE);\n            content = in.getString(K_CONTENT);\n        }\n    }\n\n    @Nullable\n    @Override\n    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {\n        return inflater.inflate(R.layout.dialog_simple, container, false);\n    }\n\n    @Override\n    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\n        super.onViewCreated(view, savedInstanceState);\n        TextView titleTv = view.findViewById(R.id.title_tv);\n        TextView contentTv = view.findViewById(R.id.content_tv);\n\n        titleTv.setText(title);\n        contentTv.setText(content);\n    }\n}\n</code></pre>"},{"location":"android/fragment/dialogFragment/dialog-fragment-demo1/#_2","title":"\u4f7f\u7528","text":"<p>\u628a\u8fd9\u4e2a\u7a97\u53e3\u5f39\u51fa\u6765\u3002\u6211\u4eec\u4f7f\u7528<code>DialogFragment.show(@NonNull FragmentManager manager, @Nullable String tag)</code>\u65b9\u6cd5\u3002</p> <pre><code>    private void popSimpleDialog1(String title, String content) {\n        SimpleDialog dialog = new SimpleDialog();\n        Bundle bundle = new Bundle();\n        bundle.putString(SimpleDialog.K_TITLE, title);\n        bundle.putString(SimpleDialog.K_CONTENT, content);\n        dialog.setArguments(bundle);\n        dialog.show(getSupportFragmentManager(), \"one-tag\");\n    }\n\n    // \u8c03\u7528\n    popSimpleDialog1(\"\u6b22\u8fce\u8bbf\u95ee\", \"\u6b22\u8fce\u8bbf\u95eehttps://an.rustfisher.com\\n\u5165\u95e8\u7684\u597d\u9009\u62e9\uff5e\");\n</code></pre> <p>\u8fd0\u884c\u5230\u673a\u5668\u4e0a\u53ef\u4ee5\u770b\u5230\u6548\u679c\u3002</p> <p></p>"},{"location":"android/fragment/dialogFragment/dialog-fragment-demo1/#_3","title":"\u5c0f\u7ed3","text":"<p>\u4f7f\u7528<code>DialogFragment</code>\u6765\u5b9e\u73b0\u5f39\u7a97\u3002 \u9700\u8981\u786e\u5b9aui\u6837\u5f0f\uff0c\u5efa\u7acblayout\uff0c\u65b0\u5efa\u7c7b\u7ee7\u627f<code>DialogFragment</code>\uff0c\u4f20\u5165\u6570\u636e\u3002</p> <p>\u66f4\u591a\u5173\u4e8e<code>DialogFragment</code>\u7684\u4fe1\u606f\uff0c\u8bf7\u53c2\u8003\u6539\u53d8DialogFragment\u7684\u663e\u793a\u5c5e\u6027</p>"},{"location":"android/fragment/dialogFragment/dialogFragment-layout-params/","title":"Android \u6539\u53d8DialogFragment\u7684\u663e\u793a\u5c5e\u6027","text":"\u66f4\u65b0\u65e5\u671f: 2021-11-22 <ul> <li>2021-11-22 \u4fee\u6539\u6587\u6863\u683c\u5f0f</li> </ul> <p>\u4f8b\u5982\u6539\u53d8Dialog\u7684\u663e\u793a\u4f4d\u7f6e\uff0c\u5c06\u80cc\u666f\u8bbe\u7f6e\u4e3a\u900f\u660e\uff0c\u53bb\u6389\u9ed8\u8ba4\u9634\u5f71\u7b49\u7b49\u3002</p>"},{"location":"android/fragment/dialogFragment/dialogFragment-layout-params/#_1","title":"\u6539\u53d8\u80cc\u666f\u989c\u8272","text":"<p>Dialog\u4e00\u822c\u90fd\u6709\u5b83\u81ea\u5df1\u7684\u80cc\u666f\u3002\u6211\u4eec\u53ef\u4ee5\u67e5\u770bSDK\u4e2d\u7684\u8d44\u6e90\u6587\u4ef6\uff0c\u627e\u5230<code>Base.V7.ThemeOverlay.AppCompat.Dialog</code>\u4e3b\u9898\u3002 \u770b\u5230<code>android:windowBackground</code>\u6307\u5b9a\u4e3a<code>@drawable/abc_dialog_material_background</code>\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u62ff\u5230dialog\u7684window\uff0c\u518d\u6765\u8bbe\u7f6ewindow\u7684\u80cc\u666f\u3002 <pre><code>    @Nullable\n    @Override\n    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {\n        Window dialogWindow = getDialog().getWindow();\n        if (dialogWindow != null) {\n            dialogWindow.setBackgroundDrawableResource(android.R.color.transparent); // dialog\u80cc\u666f\u8bbe\u7f6e\u4e3a\u900f\u660e\n            // ....\n        }\n    }\n</code></pre> \u6211\u4eec\u53ef\u4ee5\u770b\u6539\u53d8\u80cc\u666f\u989c\u8272\u7684\u524d\u540e\u5bf9\u6bd4\u56fe\u3002\u53ef\u4ee5\u770b\u5230\u9ed8\u8ba4\u7684\u80cc\u666f\u662f\u767d\u8272\u7684\u3002\u53f3\u56fe\u7684\u80cc\u666f\u53d8\u6210\u4e86\u900f\u660e\u7684\u3002</p> <p> <p>\u6539\u53d8\u80cc\u666f\u989c\u8272\u5e76\u4e0d\u662f\u53bb\u6389\u9634\u5f71\u3002</p>"},{"location":"android/fragment/dialogFragment/dialogFragment-layout-params/#_2","title":"\u53bb\u6389\u80cc\u666f\u9634\u5f71","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0bdialog\u4f1a\u6709\u4e00\u5c42\u9634\u5f71\uff0c\u628a\u540e\u9762\u7684\u5185\u5bb9\u906e\u76d6\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u8ba9dialogWindow\u53bb\u6389\u8fd9\u4e2a\u9634\u5f71\u3002 <pre><code>dialogWindow.clearFlags(WindowManager.LayoutParams.FLAG_DIM_BEHIND);\n</code></pre></p> <p></p>"},{"location":"android/fragment/dialogFragment/dialogFragment-layout-params/#dialogfragment","title":"DialogFragment\u81ea\u5b9a\u4e49\u4f4d\u7f6e","text":"<p>\u4f8b\u5982\u8ba9Dialog\u663e\u793a\u5728\u70b9\u51fb\u7684\u4f4d\u7f6e\u4e0a\u3002</p> <p></p> <p>\u8c03\u6574\u663e\u793a\u4f4d\u7f6e\uff0c\u9700\u8981\u6539\u53d8Dialog window\u7684<code>WindowManager.LayoutParams</code>\u3002</p> <p>\u5982\u679c\u8981\u540c\u65f6\u8c03\u6574x\u548cy\u4f4d\u7f6e\uff0c\u9700\u8981\u5148\u8bbe\u7f6egravity <code>dialogWindow.setGravity(Gravity.TOP | Gravity.START)</code>\u3002</p> <p>\u83b7\u53d6\u5230LayoutParams\u540e\uff0c\u4fee\u6539\u5b83\u7684x\u548cy\u503c\u3002</p> <pre><code>public class AdjustLocationDialog extends DialogFragment {\n    private static final String TAG = \"rustAppDialog\";\n    private static final String K_X = \"k_x\";\n    private static final String K_Y = \"k_y\";\n\n    public AdjustLocationDialog() {\n    }\n\n    public static AdjustLocationDialog newDialog(int x, int y) {\n        AdjustLocationDialog dialog = new AdjustLocationDialog();\n        Bundle bundle = new Bundle();\n        bundle.putInt(K_X, x);\n        bundle.putInt(K_Y, y);\n        dialog.setArguments(bundle);\n        return dialog;\n    }\n\n    @Override\n    public void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        Log.d(TAG, \"onCreate: \" + getArguments());\n    }\n\n    @Nullable\n    @Override\n    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {\n        getDialog().requestWindowFeature(Window.FEATURE_NO_TITLE);\n        Window dialogWindow = getDialog().getWindow();\n        if (dialogWindow != null) {\n            WindowManager.LayoutParams lp = dialogWindow.getAttributes();\n            dialogWindow.setGravity(Gravity.TOP | Gravity.START);\n            dialogWindow.setBackgroundDrawableResource(android.R.color.transparent); // dialog\u80cc\u666f\u8bbe\u7f6e\u4e3a\u900f\u660e\n            lp.width = WindowManager.LayoutParams.WRAP_CONTENT;\n\n            Bundle bundle = getArguments();\n            if (bundle != null) {\n                lp.x = bundle.getInt(K_X);\n                lp.y = bundle.getInt(K_Y);\n                Log.d(TAG, \"onCreateView: y == \" + lp.y);\n            } else {\n                Log.w(TAG, \"onCreateView: input bundle is null.\");\n            }\n\n            dialogWindow.setAttributes(lp);\n        }\n        return inflater.inflate(R.layout.dialog_input_text, container, false);\n    }\n}\n</code></pre> <p>layout\u6587\u4ef6<code>dialog_input_text.xml</code>\u3002\u91cc\u9762\u653e\u7f6eTextView\u4e0eEditText\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:layout_marginStart=\"20dp\"\n    android:layout_marginEnd=\"20dp\"\n    android:background=\"#00000000\"\n    android:orientation=\"horizontal\"&gt;\n\n    &lt;LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"@dimen/adjust_dialog_et_height\"\n        android:background=\"@drawable/shape_input_text_popup_bg\"\n        android:gravity=\"center_vertical\"\n        android:orientation=\"horizontal\"\n        android:paddingStart=\"4dp\"\n        android:paddingEnd=\"4dp\"&gt;\n\n        &lt;TextView\n            android:id=\"@+id/note_tv\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:layout_marginStart=\"8dp\"\n            android:text=\"\u8bf7\u8f93\u5165:\"\n            android:textSize=\"12sp\" /&gt;\n\n        &lt;EditText\n            android:id=\"@+id/et\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\"\n            android:layout_marginStart=\"4dp\"\n            android:background=\"@null\"\n            android:focusable=\"true\"\n            android:gravity=\"center_vertical\"\n            android:inputType=\"text\"\n            android:minWidth=\"100dp\"\n            android:textSize=\"14sp\" /&gt;\n    &lt;/LinearLayout&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre></p> <p>\u5c3a\u5bf8\u5b9a\u4e49 <pre><code>&lt;dimen name=\"adjust_dialog_et_height\"&gt;36dp&lt;/dimen&gt;\n</code></pre></p>"},{"location":"android/fragment/dialogFragment/dialogFragment-layout-params/#_3","title":"\u5982\u4f55\u83b7\u53d6\u70b9\u51fb\u4f4d\u7f6e","text":"<p>\u624b\u6307\u89e6\u6478\u5230\u5c4f\u5e55\u4e0a\uff0c\u7cfb\u7edf\u4f1a\u544a\u8bc9app\u70b9\u51fb\u4f4d\u7f6e\u3002\u6211\u4eec\u7528<code>OnTouchListener</code>\u6765\u83b7\u53d6\u70b9\u51fb\u4f4d\u7f6e\u3002</p> <p>\u4e0b\u9762\u662fAdapter\u4e2d\u76d1\u542c\u89e6\u6478\u4e8b\u4ef6\u7684\u76d1\u542c\u5668\u3002\u4ee5\u53ca\u70b9\u51fb\u4e8b\u4ef6\u7684\u76d1\u542c\u5668\u3002 <pre><code>holder.tv.setOnTouchListener(new View.OnTouchListener() {\n    @Override\n    public boolean onTouch(View v, MotionEvent event) {\n        downX = event.getX();\n        downY = event.getY();\n        rawX = event.getRawX();\n        rawY = event.getRawY();\n        return false;\n    }\n});\nholder.tv.setOnClickListener(new View.OnClickListener() {\n    @Override\n    public void onClick(View v) {\n        if (onItemClick != null) {\n            onItemClick.onClick((int) rawX, (int) rawY);\n        }\n    }\n});\n</code></pre> \u5728\u89e6\u6478\u76d1\u542c\u5668\u4e2d\u8fd4\u56defalse\uff0c\u8868\u793a\u6211\u4eec\u4e0d\u5904\u7406\u8fd9\u4e2a\u89e6\u6478\u4e8b\u4ef6\u3002\u70b9\u51fb\u4e8b\u4ef6\u53ef\u4ee5\u6b63\u5e38\u76d1\u542c\u5230\u3002 \u5728<code>onTouch</code>\u4e2d\u628a\u89e6\u6478\u5750\u6807\u8bb0\u5f55\u4e0b\u6765\u3002\u7b49\u5230<code>onClick</code>\u65f6\uff0c\u518d\u5229\u7528\u5750\u6807\u6570\u636e\u3002</p> <p><code>event.getX()</code>\u548c<code>event.getY()</code>\u83b7\u53d6\u5230\u7684\u662f\u5f53\u524dView\u7684\u89e6\u6478\u5750\u6807\u3002 <code>event.getRawX()</code>\u548c<code>event.getRawY()</code>\u83b7\u53d6\u5230\u7684\u662f\u5c4f\u5e55\u7684\u89e6\u6478\u5750\u6807\u3002\u5373\u89e6\u6478\u70b9\u5728\u5c4f\u5e55\u4e0a\u7684\u4f4d\u7f6e\u3002</p>"},{"location":"android/fragment/dialogFragment/dialogFragment-layout-params/#edittext","title":"EditText\u4e0d\u88ab\u8f6f\u952e\u76d8\u906e\u6321","text":"<p>\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0cDialog\u53ef\u5728\u4efb\u610f\u5730\u65b9\u5f39\u51fa\u3002 \u82e5dialog\u5728\u5c4f\u5e55\u4e0b\u65b9\u5f39\u51fa\uff0c\u6b64\u65f6\u6211\u4eec\u8981\u8f93\u5165\u6587\u5b57\u5230\u5f39\u7a97\u7684EditText\uff0c\u5f39\u51fa\u7684\u8f6f\u952e\u76d8\uff08soft keyboard\uff09\u4f1a\u628adialog\u6321\u4f4f\u3002</p> <p>\u6211\u4eec\u5e0c\u671bEditText\u4e0d\u88ab\u8f6f\u952e\u76d8\u906e\u6321\uff0c\u63d0\u9ad8\u7528\u6237\u4f53\u9a8c\u3002\u53ef\u4ee5\u5bf9dialogWindow\u8fdb\u884c\u4e00\u4e9b\u8c03\u6574\u3002</p> <p>\u53ef\u8bbe\u7f6e <code>setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_RESIZE)</code> <pre><code>dialogWindow.setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_RESIZE);\n</code></pre> \u5f39\u51fadialog\u540e\uff0cdialog\u79fb\u52a8\u5230\u8f6f\u952e\u76d8\u7684\u6b63\u4e0a\u65b9\u3002</p> <p></p> <p>\u4ee3\u7801\u5728\u8fd9 https://gitee.com/rustfisher/AndroidTutorial</p>"},{"location":"android/gradle/Gradle_for_android_Basic_Build_Customization/","title":"Gradle \u57fa\u7840\u81ea\u5b9a\u4e49\u6784\u5efa Basic Build Customization","text":"\u4fee\u6539\u65e5\u671f\uff1a2022-2-3 <ul> <li>2022-2-3 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883 <ul> <li>win7</li> <li>Android Studio 2.1.3</li> </ul> <p>\u672c\u7ae0\u76ee\u7684</p> <ul> <li>\u7406\u89e3Gradle\u6587\u4ef6</li> <li>build tasks\u5165\u95e8</li> <li>\u81ea\u5b9a\u4e49\u6784\u5efa</li> </ul>"},{"location":"android/gradle/Gradle_for_android_Basic_Build_Customization/#gradle","title":"\u7406\u89e3Gradle\u6587\u4ef6","text":"<p>\u5728Android Studio\u4e2d\u65b0\u5efa\u4e00\u4e2a\u9879\u76ee\u540e\uff0c\u4f1a\u81ea\u52a8\u521b\u5efa3\u4e2aGradle\u6587\u4ef6\u3002</p> <p><pre><code>MyApp\n\u251c\u2500\u2500 build.gradle\n\u251c\u2500\u2500 settings.gradle\n\u2514\u2500\u2500 app\n    \u2514\u2500\u2500 build.gradle\n</code></pre> \u6bcf\u4e2a\u6587\u4ef6\u90fd\u6709\u81ea\u5df1\u7684\u4f5c\u7528</p>"},{"location":"android/gradle/Gradle_for_android_Basic_Build_Customization/#settingsgradle","title":"settings.gradle\u6587\u4ef6","text":"<p>\u65b0\u5efa\u5de5\u7a0b\u7684settings\u6587\u4ef6\u7c7b\u4f3c\u4e0b\u9762\u8fd9\u6837</p> <pre><code>include ':app'\n</code></pre> <p>Gradle\u4e3a\u6bcf\u4e2asettings\u6587\u4ef6\u521b\u5efa<code>Settings</code>\u5bf9\u8c61\uff0c\u5e76\u8c03\u7528\u5176\u4e2d\u7684\u65b9\u6cd5\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Basic_Build_Customization/#the-top-level-build-file","title":"The top-level build file \u6700\u5916\u5c42\u7684\u6784\u5efa\u6587\u4ef6","text":"<p>\u80fd\u5bf9\u5de5\u7a0b\u4e2d\u6240\u6709\u6a21\u5757\u8fdb\u884c\u914d\u7f6e\u3002\u5982\u4e0b</p> <pre><code>buildscript {\n    repositories {\n        jcenter()\n    }\n    dependencies {\n        classpath 'com.android.tools.build:gradle:2.1.3'\n\n        // NOTE: Do not place your application dependencies here; they belong\n        // in the individual module build.gradle files\n    }\n}\n\nallprojects {\n    repositories {\n        jcenter()\n        maven { url \"https://jitpack.io\" }\n    }\n}\n\ntask clean(type: Delete) {\n    delete rootProject.buildDir\n}\n</code></pre> <p><code>buildscript</code>\u4ee3\u7801\u5757\u662f\u5177\u4f53\u914d\u7f6e\u7684\u5730\u65b9\uff0c\u5f15\u7528JCenter\u4ed3\u5e93\u3002 \u672c\u4f8b\u4e2d\uff0c\u4e00\u4e2a\u4ed3\u5e93\u4ee3\u8868\u7740\u4f9d\u8d56\u5e93\uff0c\u6362\u53e5\u8bdd\u8bf4\u662fapp\u53ef\u4ee5\u4ece\u4e2d\u4e0b\u8f7d\u4f7f\u7528\u5e93\u6587\u4ef6\u3002 JCenter\u662f\u4e00\u4e2a\u6709\u540d\u7684 Maven \u4ed3\u5e93\u3002</p> <p><code>dependencies</code>\u4ee3\u7801\u5757\u7528\u6765\u914d\u7f6e\u4f9d\u8d56\u3002\u4e0a\u9762\u6ce8\u91ca\u8bf4\u660e\u4e86\uff0c\u4e0d\u8981\u5728\u6b64\u6dfb\u52a0\u4f9d\u8d56\uff0c\u800c\u5e94\u8be5\u5230\u72ec\u7acb\u7684\u6a21\u5757 \u4e2d\u53bb\u914d\u7f6e\u4f9d\u8d56\u3002</p> <p><code>allprojects</code>\u80fd\u5bf9\u6240\u6709\u6a21\u5757\u8fdb\u884c\u914d\u7f6e\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Basic_Build_Customization/#build","title":"\u6a21\u5757\u4e2d\u7684build\u6587\u4ef6","text":"<p>\u6a21\u5757\u4e2d\u7684\u72ec\u7acb\u914d\u7f6e\u6587\u4ef6\uff0c\u4f1a\u8986\u76d6\u6389top-level\u7684<code>build.gradle</code>\u6587\u4ef6</p> <pre><code>apply plugin: 'com.android.application'\n\nandroid {\n    compileSdkVersion 25\n    buildToolsVersion \"25.0.2\"\n\n    defaultConfig {\n        applicationId \"com.xxx.rust.newproj\"\n        minSdkVersion 18\n        targetSdkVersion 25\n        versionCode 1\n        versionName \"1.0\"\n    }\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n        }\n    }\n}\n\ndependencies {\n    compile fileTree(dir: 'libs', include: ['*.jar'])\n    testCompile 'junit:junit:4.12'\n    compile 'com.android.support:appcompat-v7:25.1.0'\n}\n</code></pre> <p>\u4e0b\u9762\u6765\u770b3\u4e2a\u4e3b\u8981\u7684\u4ee3\u7801\u5757\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Basic_Build_Customization/#plugin","title":"plugin","text":"<p>\u7b2c\u4e00\u884c\u5e94\u7528\u4e86Android \u5e94\u7528\u63d2\u4ef6\u3002Android\u63d2\u4ef6\u7531Google\u56e2\u961f\u5f00\u53d1\u7ef4\u62a4\u3002\u8be5\u63d2\u4ef6\u63d0\u4f9b\u6784\u5efa\uff0c\u6d4b\u8bd5\uff0c\u6253\u5305\u5e94\u7528\u548c\u6a21\u5757\u9700\u8981\u7684\u6240\u6709\u7684task\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Basic_Build_Customization/#android","title":"android","text":"<p>\u6700\u5927\u7684\u4e00\u4e2a\u533a\u57df\u3002defaultConfig\u533a\u57df\u5bf9app\u6838\u5fc3\u8fdb\u884c\u914d\u7f6e\uff0c\u4f1a\u914d\u7f6e\u8986\u76d6AndroidManifest.xml\u4e2d\u7684\u914d\u7f6e\u3002</p> <p>applicationId\u590d\u5199\u6389manifest\u6587\u4ef6\u4e2d\u7684\u5305\u540d\u3002\u4f46applicationId\u548c\u5305\u540d\u6709\u533a\u522b\u3002 manifest\u4e2d\u7684\u5305\u540d\uff0c\u5728\u6e90\u4ee3\u7801\u548cR\u6587\u4ef6\u4e2d\u4f7f\u7528\u3002\u6240\u4ee5package name\u5728android studio\u4e2d\u7406\u89e3\u4e3a\u4e00\u4e2a\u67e5\u8be2\u7c7b\u7684\u8def\u5f84\u6bd4\u8f83\u5408\u7406\u3002 applicationId\u5728Android\u7cfb\u7edf\u4e2d\u662f\u4f5c\u4e3a\u5e94\u7528\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u5373\u5728\u4e00\u4e2aAndroid\u8bbe\u5907\u4e2d\u6240\u6709\u7684\u5e94\u7528\u7a0b\u5e8f\u7684applicationId\u90fd\u662f\u552f\u4e00\u7684\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Basic_Build_Customization/#dependencies","title":"dependencies","text":"<p>\u662fGradle\u6807\u51c6\u914d\u7f6e\u7684\u4e00\u90e8\u5206\u3002 Android\u4e2d\u7528\u6765\u914d\u7f6e\u4f7f\u7528\u5230\u7684\u5e93\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Basic_Build_Customization/#customizing-the-build","title":"\u5b9a\u5236\u5316\u6784\u5efa Customizing the build","text":""},{"location":"android/gradle/Gradle_for_android_Basic_Build_Customization/#buildconfig-and-resources","title":"BuildConfig and resources","text":"<p>\u81ea\u4eceSDK17\u4ee5\u6765\uff0c\u6784\u5efa\u5de5\u5177\u4f1a\u751f\u6210\u4e00\u4e2aBuildConfig\u7c7b\uff0c\u5305\u542b\u7740\u9759\u6001\u53d8\u91cfDEBUG\u548c\u4e00\u4e9b\u4fe1\u606f\u3002 \u5982\u679c\u4f60\u60f3\u5728\u533a\u5206debug\u548c\u6b63\u5f0f\u7248\uff0c\u6bd4\u5982\u6253log\uff0c\u8fd9\u4e2aBuildConfig\u7c7b\u5f88\u6709\u7528\u3002 \u53ef\u4ee5\u901a\u8fc7Gradle\u6765\u6269\u5c55\u8fd9\u4e2a\u7c7b\uff0c\u8ba9\u5b83\u62e5\u6709\u66f4\u591a\u7684\u9759\u6001\u53d8\u91cf\u3002</p> <p>\u4ee5NewProj\u5de5\u7a0b\u4e3a\u4f8b\uff0c<code>app\\build.gradle</code></p> <pre><code>android {\n    compileSdkVersion 25\n    buildToolsVersion \"25.0.2\"\n\n    defaultConfig {\n        applicationId \"com.xxx.rust.newproj\"\n        minSdkVersion 18\n        targetSdkVersion 25\n        versionCode 1\n        versionName \"1.0\"\n    }\n    buildTypes {\n        debug {\n            buildConfigField(\"String\", \"BASE_URL\", \"\\\"https://rustfisher.com\\\"\")\n            buildConfigField(\"String\", \"A_CONTENT\", \"\\\"debug content\\\"\")\n            resValue(\"string\", \"str_version\", \"debug_ver\")\n        }\n        release {\n            buildConfigField(\"String\", \"BASE_URL\", \"\\\"https://an.rustfisher.com\\\"\")\n            buildConfigField(\"String\", \"A_CONTENT\", \"\\\"release content\\\"\")\n            resValue(\"string\", \"str_version\", \"release_ver\")\n\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n        }\n    }\n}\n</code></pre> <p>\u4e0a\u9762\u7684<code>buildConfigField</code>\u548c<code>resValue</code>\u5728\u7f16\u8bd1\u540e\uff0c\u80fd\u5728\u6e90\u4ee3\u7801\u4e2d\u4f7f\u7528 \u6ce8\u610f\u4e0a\u9762\u90a3\u4e2a\u8f6c\u4e49\u7684\u5206\u53f7\u4e0d\u53ef\u5c11\uff1b\u6ce8\u610f\u91cc\u9762\u7684\u5927\u5c0f\u5199\uff0c\u8fd9\u91cc\u4f20\u5165\u7684\u53c2\u6570\u5c31\u50cf\u662f\u76f4\u63a5\u586b\u5165\u7684\u4ee3\u7801\u4e00\u6837</p> <p>\u4e0b\u9762\u662f\u7f16\u8bd1\u540e\u751f\u6210\u7684BuildConfig\u6587\u4ef6\uff0c\u53ef\u4ee5\u770b\u5230buildConfigField\u7684\u4e1c\u897f\u5df2\u7ecf\u5728\u91cc\u9762\u4e86</p> <pre><code>public final class BuildConfig {\n  public static final boolean DEBUG = Boolean.parseBoolean(\"true\");\n  public static final String APPLICATION_ID = \"com.xxx.rust.newproj\";\n  public static final String BUILD_TYPE = \"debug\";\n  public static final String FLAVOR = \"\";\n  public static final int VERSION_CODE = 1;\n  public static final String VERSION_NAME = \"1.0\";\n  // Fields from build type: debug\n  public static final String A_CONTENT = \"debug content\";\n  public static final String BASE_URL = \"http://www.baidu.com\";\n}\n</code></pre> <p>resValue\u4f1a\u88ab\u6dfb\u52a0\u5230\u8d44\u6e90\u6587\u4ef6\u4e2d</p> <pre><code>mTv2.setText(R.string.str_version);\n</code></pre>"},{"location":"android/gradle/Gradle_for_android_Basic_Build_Customization/#buildgradle-applicationid","title":"\u901a\u8fc7 build.gradle \u589e\u52a0\u83b7\u53d6 applicationId \u7684\u65b9\u5f0f","text":"<p>\u6a21\u5757<code>build.gradle</code>\u4e2d\u6dfb\u52a0\u5c5e\u6027<code>applicationId</code>\uff0c\u4f1a\u88ab\u7f16\u8bd1\u5230BuildConfig\u4e2d <pre><code>project.afterEvaluate {\n    project.android.applicationVariants.all { variant -&gt;\n        def applicationId = [variant.mergedFlavor.applicationId, variant.buildType.applicationIdSuffix].findAll().join()\n    }\n}\n</code></pre></p> <p>\u5728\u4ee3\u7801\u4e2d\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 <pre><code>String appID = BuildConfig.APPLICATION_ID;\n</code></pre></p>"},{"location":"android/gradle/Gradle_for_android_Basic_Build_Customization/#_1","title":"\u83b7\u53d6\u65f6\u95f4\u7684\u65b9\u6cd5","text":"<p>\u6a21\u5757<code>build.gradle</code>\u4e2d\u6dfb\u52a0\u65b9\u6cd5<code>getTime()</code>\uff0c\u5e76\u5728<code>buildTypes</code>\u4e2d\u6dfb\u52a0\u57df\u3002 <pre><code>// \u83b7\u53d6\u5f53\u524d\u65f6\u95f4\nstatic def getTime() {\n    String timeNow = new Date().format('YYYYMMdd-HHmmss')\n    return timeNow\n}\n\nandroid {\n    // ...\n    buildTypes {\n        debug {\n            buildConfigField \"String\", \"BUILD_TIME\", \"\\\"\" + getTime() + \"\\\"\"\n        }\n        release {\n            buildConfigField \"String\", \"BUILD_TIME\", \"\\\"\" + getTime() + \"\\\"\"\n            // ...\n        }\n    }\n}\n</code></pre></p> <p><code>BuildConfig.java</code>\u4e2d\u5f97\u5230\u8fd9\u4e2a\u57df\u3002 <pre><code>  // Fields from build type: debug\n  public static final String BUILD_TIME = \"20180912-100335\";\n</code></pre></p>"},{"location":"android/gradle/Gradle_for_android_Basic_Build_Customization/#release-apk","title":"\u4fee\u6539release apk\u6587\u4ef6\u540d\u7684\u65b9\u6cd5","text":"<p>gradle\u7248\u672c3.1.4\u3002\u4f7f\u7528\u4e86\u4e0a\u9762\u7684\u65b9\u6cd5<code>getTime()</code>\u3002</p> <pre><code>android {\n    // ...\n    // \u4fee\u6539release\u7684apk\u540d\u5b57\n    applicationVariants.all { variant -&gt;\n        variant.outputs.all {\n            if (variant.buildType.name == 'release') {\n                outputFileName = \"xxx_release_${defaultConfig.versionName}_${getTime()}.apk\"\n            }\n        }\n    }\n}\n</code></pre> <p>\u4ee5\u524d\u7684\u65b9\u6cd5\u53ef\u80fd\u4f1a\u9047\u5230\u95ee\u9898\uff1a<code>Cannot set the value of read-only property 'outputFile' for ApkVariantOutputImpl_Decorated</code>\u3002  \u53c2\u8003\uff1ahttps://stackoverflow.com/questions/44239235/android-gradle-3-0-0-alpha2-plugin-cannot-set-the-value-of-read-only-property</p>"},{"location":"android/gradle/Gradle_for_android_Basic_Build_Customization/#_2","title":"\u5de5\u7a0b\u8303\u56f4\u7684\u8bbe\u7f6e","text":"<p>\u5982\u679c\u4e00\u4e2a\u5de5\u7a0b\u4e2d\u6709\u591a\u4e2a\u6a21\u5757\uff0c\u53ef\u4ee5\u5bf9\u6574\u4e2a\u5de5\u7a0b\u5e94\u7528\u8bbe\u7f6e\uff0c\u800c\u4e0d\u7528\u53bb\u4fee\u6539\u6bcf\u4e00\u4e2a\u6a21\u5757\u3002</p> <p><code>NewProj\\build.gradle</code> <pre><code>allprojects {\n    repositories {\n        jcenter()\n    }\n}\n\next {\n    compileSDKVersion = 25\n    local = 'Hello from the top-level build'\n}\n</code></pre></p> <p>\u6bcf\u4e00\u4e2a<code>build.gradle</code>\u6587\u4ef6\u90fd\u80fd\u5b9a\u4e49\u989d\u5916\u7684\u5c5e\u6027\uff0c\u5728ext\u4ee3\u7801\u5757\u4e2d\u3002</p> <p>\u5728\u4e00\u4e2a\u6a21\u5757\u7684<code>libmodule\\build.gradle</code>\u6587\u4ef6\u4e2d\uff0c\u53ef\u4ee5\u5f15\u7528rootProject\u7684ext\u5c5e\u6027</p> <pre><code>android {\n    compileSdkVersion rootProject.ext.compileSDKVersion\n    buildToolsVersion \"25.0.2\"\n    // ....\n}\n</code></pre>"},{"location":"android/gradle/Gradle_for_android_Basic_Build_Customization/#project-properties","title":"\u5de5\u7a0b\u5c5e\u6027 Project properties","text":"<p>\u5b9a\u4e49properties\u7684\u5730\u65b9 * ext\u4ee3\u7801\u5757 * gradle.properties\u6587\u4ef6 * \u547d\u4ee4\u884c -P \u53c2\u6570</p> <p>\u5de5\u7a0b<code>build.gradle</code>\u6587\u4ef6 <pre><code>ext {\n    compileSDKVersion = 25\n    local = 'Hello from the top-level build'\n}\n\n/**\n * Print properties info\n */\ntask aPrintSomeInfo {\n    println(local)\n    println('project dir: ' + projectDir)\n    println(projectPropertiesFileText)\n}\n\ntask aPrintAllProperites() {\n    println('\\nthis is aPrintAllProperites task\\n')\n    Iterator pIt = properties.iterator()\n    while (pIt.hasNext()) {\n        println(pIt.next())\n    }\n}\n</code></pre></p> <p>gradle.properties\u6587\u4ef6\u4e2d\u589e\u52a0 <pre><code>projectPropertiesFileText = Hello there from gradle.properties\n</code></pre></p> <p>\u5728as\u7684Gradle\u680f\u4e0a\u53cc\u51fb\u6267\u884caPrintSomeInfo\uff0c\u4f1a\u8fde\u5e26\u4e0b\u4e00\u4e2atask\u4e5f\u6267\u884c</p> <pre><code>13:08:10: Executing external task 'aPrintSomeInfo'...\nHello from the top-level build\nproject dir: G:\\openSourceProject\\NewProj\nHello there from gradle.properties\n\nthis is aPrintAllProperites task\n......\nBUILD SUCCESSFUL\n\nTotal time: 1.025 secs\n13:08:11: External task execution finished 'aPrintSomeInfo'.\n</code></pre> <p>\u53c2\u8003\uff1aGradle for Android  Kevin Pelgrims</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a \u6398\u91d1</p>"},{"location":"android/gradle/Gradle_for_android_Creating_Build_Variants/","title":"Gradle \u6784\u5efa\u591a\u79cd\u7248\u672c","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-5-25 <ul> <li>2022-5-25 \u66f4\u65b0\u683c\u5f0f</li> <li>2022-2-3 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u672c\u7ae0\u76ee\u7684</p> <ul> <li> Build types \u6784\u5efa\u7c7b\u578b<ul> <li> Product flavors</li> <li> Build variants \u6784\u5efa\u4e0d\u540c\u79cd\u7c7b</li> </ul> </li> <li> Signing configurations</li> </ul> <p>\u5f00\u53d1APP\u65f6\uff0c\u4f1a\u6709\u751f\u6210\u4e0d\u540c\u7248\u672c\u7684\u9700\u6c42\u3002\u6bd4\u5982\u6d4b\u8bd5\u7248\u672c\u548c\u53d1\u5e03\u7248\u672c\u3002\u4e0d\u540c\u7248\u672c\u4e4b\u95f4\u901a\u5e38\u6709\u4e0d\u540c\u7684\u8bbe\u7f6e\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Creating_Build_Variants/#build-types","title":"Build types","text":"<p>\u5b9a\u4e49APP\u6216\u8005\u6a21\u5757\u8be5\u88ab\u5982\u4f55\u6784\u5efa\u3002</p> <p>\u53ef\u4ee5\u7528<code>buildTypes</code>\u6765\u5b9a\u4e49\u6784\u5efa\u7c7b\u578b\u3002\u4f8b\u5982\uff1a <pre><code>buildTypes {\n    release {\n        minifyEnabled false\n        proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n    }\n}\n</code></pre></p> <p>\u9ed8\u8ba4\u7684<code>build.gradle</code>\u6587\u4ef6\u4f1a\u5305\u542b\u4e00\u4e2a<code>release</code>\u6784\u5efa\u7c7b\u578b</p>"},{"location":"android/gradle/Gradle_for_android_Creating_Build_Variants/#_1","title":"\u521b\u5efa\u6784\u5efa\u7c7b\u578b","text":"<p>\u6bd4\u5982\u521b\u5efa\u4e00\u4e2a<code>staging</code>\u6784\u5efa\u7c7b\u578b <pre><code>buildTypes {\n    // staging \u662f\u4e00\u4e2a\u81ea\u5b9a\u4e49\u540d\u5b57\n    // \u751f\u6210signed App\u65f6\u53ef\u4ee5\u9009\u62e9\u8fd9\u4e2a\u7c7b\u578b\n    staging.initWith(buildTypes.debug)\n    staging {\n        applicationIdSuffix \".staging\"\n        versionNameSuffix \"-staging\"\n        buildConfigField(\"String\", \"BASE_URL\", \"\\\"http://www.staging.com\\\"\")\n    }\n}\n</code></pre> \u8fd9\u91cc\u5b9a\u4e49\u4e86<code>applicationIdSuffix</code>\uff0c\u8ba9staging\u7248\u672c\u7684applicationId\u548crelease\u7248\u672c\u7684\u4e0d\u540c\u3002</p> <p><code>initWith()</code>\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6784\u5efa\u7c7b\u578b\u5e76\u590d\u5236\u73b0\u6709\u7684\u6784\u5efa\u7c7b\u578b\u3002\u7528\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u590d\u5199\u5df2\u6709\u7684\u6784\u5efa\u7c7b\u578b\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Creating_Build_Variants/#_2","title":"\u8d44\u6e90\u76ee\u5f55","text":"<p>\u521b\u5efa\u4e86\u65b0\u7684\u6784\u5efa\u7c7b\u578b\u540e\uff0c\u53ef\u4ee5\u5efa\u7acb\u65b0\u7684\u8d44\u6e90\u6587\u4ef6\u3002\u4f8b\u5982\u6211\u4eec\u5df2\u7ecf\u6709\u4e86staging\u6784\u5efa\u7c7b\u578b</p> <pre><code>src\n\u251c\u2500\u2500 androidTest\n\u251c\u2500\u2500 debug\n\u251c\u2500\u2500 greenRelease\n\u251c\u2500\u2500 main\n\u251c\u2500\u2500 redDebug\n\u251c\u2500\u2500 staging// \u53ef\u4ee5\u65b0\u5efa\u8d44\u6e90\u76ee\u5f55\n\u2514\u2500\u2500 test\n</code></pre> <p>\u4e0d\u540c\u8d44\u6e90\u76ee\u5f55\u91cc\u7684\u6587\u4ef6\u53ef\u4ee5\u7528\u76f8\u540c\u7684\u6587\u4ef6\u540d\u3002</p> <p>main\u76ee\u5f55\u91cc\u7684strings.xml <pre><code>&lt;resources&gt;\n    &lt;string name=\"app_name\"&gt;GDemo&lt;/string&gt;\n&lt;/resources&gt;\n</code></pre></p> <pre><code>&lt;resources&gt;\n    &lt;!-- staging strings.xml --&gt;\n    &lt;string name=\"app_name\"&gt;GStaging&lt;/string&gt;\n&lt;/resources&gt;\n</code></pre> <p>\u751f\u6210\u4e0d\u540c\u7248\u672c\u7684app\u65f6\uff0c\u4f1a\u81ea\u52a8\u53bb\u627e\u76f8\u5e94\u7684\u8d44\u6e90\u6587\u4ef6</p>"},{"location":"android/gradle/Gradle_for_android_Creating_Build_Variants/#_3","title":"\u4f9d\u8d56\u5305\u7ba1\u7406","text":"<p>\u6bcf\u4e00\u79cd\u6784\u5efa\u7c7b\u578b\u53ef\u4ee5\u6709\u81ea\u5df1\u7684\u4f9d\u8d56\u3002Gradle\u81ea\u52a8\u4e3a\u6bcf\u4e2a\u7c7b\u578b\u521b\u5efa\u4f9d\u8d56\u914d\u7f6e\u3002 \u4e0b\u9762\u5c31\u662f\u5355\u72ec\u4e3adebug\u7248\u672c\u6dfb\u52a0logging\u6a21\u5757\u7684\u4f9d\u8d56</p> <pre><code>dependencies {\n    compile fileTree(dir: 'libs', include: ['*.jar'])\n    androidTestCompile('com.android.support.test.espresso:espresso-core:2.2.2', {\n        exclude group: 'com.android.support', module: 'support-annotations'\n    })\n    compile 'com.android.support:appcompat-v7:25.1.1'\n    testCompile 'junit:junit:4.12'\n\n    debugCompile 'de.mindpipe.android:android-logging-log4j:1.0.3'\n}\n</code></pre>"},{"location":"android/gradle/Gradle_for_android_Creating_Build_Variants/#product-flavors","title":"Product flavors \u4ea7\u54c1\u7279\u5f81","text":"<p>product flavors\u7528\u4e8e\u521b\u5efa\u540c\u4e00\u4e2aAPP\u7684\u4e0d\u540c\u7248\u672c\u3002\u6700\u76f4\u63a5\u7684\u4f8b\u5b50\u5c31\u662f\u514d\u8d39\u548c\u4ed8\u8d39\u7248APP\u3002</p> <p>\u5f53\u6211\u4eec\u8981\u53d1\u5e03APP\u65f6\uff0c\u53ef\u4ee5\u9009\u62e9release\u6216\u8005staging\uff08\u4e0a\u9762\u7684\u4f8b\u5b50\uff09\u7248\u3002\u4f46\u662f\u5bf9\u540c\u4e00\u4e2a\u6784\u5efa\u7c7b\u578b\uff0c\u6bd4\u5982\u5bf9 \u4e8erelease\u7248\uff0c\u6211\u4eec\u53ef\u4ee5\u7528Product flavors\u6253\u5305\u51fa\u6709\u5404\u81ea\u7279\u5f81\u7684APP\u3002\u6bd4\u5982\uff1a</p> <pre><code>// \u591a\u6e20\u9053\u6253\u5305\u53ef\u4ee5\u7528\u5728\u8fd9\u91cc\u914d\u7f6e\n// \u4e00\u65e6\u914d\u7f6e\u4e86productFlavors\uff0c\u751f\u6210apk\u65f6\u4f1a\u9ed8\u8ba4\u9009\u5176\u4e2d\u4e00\u4e2a\u9009\u9879\nproductFlavors {\n    red {\n        versionName \"1.0-red\"\n    }\n    green {\n        applicationId \"com.rustfisher.gradletest.green\" // \u4f7f\u7528\u53e6\u4e00\u4e2a\u7b7e\u540d\n        versionNameSuffix \"-green\"// \u7248\u672c\u540d\u6dfb\u52a0\u540e\u7f00\n    }\n}\n</code></pre>"},{"location":"android/gradle/Gradle_for_android_Creating_Build_Variants/#_4","title":"\u8d44\u6e90\u6587\u4ef6","text":"<p>\u65b0\u5efa\u4e86productFlavors\u7c7b\u578b\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u65b0\u5efa\u76f8\u5e94\u7684\u8d44\u6e90\u76ee\u5f55\u3002</p> <pre><code>src\n\u251c\u2500\u2500 androidTest\n\u251c\u2500\u2500 debug\n\u251c\u2500\u2500 greenRelease // release\u7248\u672c  \u91c7\u7528green\n\u251c\u2500\u2500 main\n\u251c\u2500\u2500 redDebug // debug\u7248\u672c   \u91c7\u7528red\n\u251c\u2500\u2500 staging\n\u2514\u2500\u2500 test\n</code></pre>"},{"location":"android/gradle/Gradle_for_android_Creating_Build_Variants/#multiflavor-variants","title":"\u591a\u79cd\u7279\u79cd\u7684\u53d8\u91cf Multiflavor variants","text":"<p>\u5728Product flavors\u4e2d\u53ef\u4ee5\u8fdb\u884c\u7ec4\u5408\uff0c\u4f8b\u5982</p> <pre><code>android {\n\n    flavorDimensions(\"color\", \"price\") // \u65b0\u5efa\u4e862\u79cd\u7c7b\u578b\n\n    // \u591a\u6e20\u9053\u6253\u5305\u53ef\u4ee5\u7528\u5728\u8fd9\u91cc\u914d\u7f6e\n    // \u4e00\u65e6\u914d\u7f6e\u4e86productFlavors\uff0cdebug\u65f6\u4f1a\u9ed8\u8ba4\u9009\u4e00\u4e2a\u9009\u9879\n    productFlavors {\n        red {\n            versionName \"1.0-red\"\n            dimension \"color\"\n        }\n        green {\n            applicationId \"com.rustfisher.gradletest.green\" // \u4f7f\u7528\u53e6\u4e00\u4e2a\u7b7e\u540d\n            versionNameSuffix \"-green\"\n            dimension \"color\"\n        }\n        freeApp {\n            dimension \"price\"\n        }\n        paidApp {\n            dimension \"price\"\n        }\n    }\n}\n</code></pre> <p>\u90a3\u4e48\u5728\u6253\u5305apk\u65f6\uff0c\u53ef\u4ee5\u6709\u5982\u4e0b4\u79cd\u7248\u672c  </p> <p><pre><code>green-freeApp \ngreen-paidApp \nred-freeApp \nred-paidApp\n</code></pre> \u4e00\u65e6\u6dfb\u52a0flavorDimensions\uff0c\u5c31\u5fc5\u987b\u4e3a\u6bcf\u4e00\u4e2aflavor\u5236\u5b9adimension\u3002 \u5c31\u50cf\u4e0a\u9762\u7684<code>color</code>\u548c<code>price</code>\u5fc5\u987b\u51fa\u73b0\u5728\u4e0b\u97624\u79cdproductFlavors\u4e4b\u4e2d\u3002\u5426\u5219\u4f1a\u62a5\u9519\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Creating_Build_Variants/#build-variants","title":"Build Variants","text":"<p>Android Studio\u5de6\u4e0b\u89d2\u53ef\u4ee5\u6253\u5f00Build Variants\u7a97\u53e3\u3002\u9009\u62e9\u6a21\u5757\u548c<code>Build Variants</code>\u3002 \u524d\u9762\u914d\u7f6e\u7684\u6784\u5efa\u7c7b\u578b\u90fd\u4f1a\u5728\u8fd9\u4e2a\u5217\u8868\u4e2d\u51fa\u73b0\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Creating_Build_Variants/#tasks","title":"Tasks \u4efb\u52a1","text":"<p>Android plugin for Gradle \u4f1a\u81ea\u52a8\u4e3a\u6bcf\u4e2a\u914d\u7f6e\u7684\u6784\u5efa\u7c7b\u578b\u521b\u5efa\u4efb\u52a1\u3002 \u65b0\u5efa\u9879\u76ee\u65f6\uff0c\u4f1a\u6709\u9ed8\u8ba4\u7684assembleDebug \u548c assembleRelease\u3002 \u7ecf\u8fc7\u4e0a\u9762\u7684\u914d\u7f6e\u4ee5\u540e\uff0c\u4f1a\u6709\u4ea7\u751f\u76f8\u5bf9\u5e94\u7684\u4efb\u52a1 <pre><code>assemble\nassembleAndroidTest\nassembleDebug\nassembleFreeApp\nassembleGreen\nassembleGreenFreeApp\nassembleGreenPaidApp\nassemblePaidApp\nassembleRed\nassembleRedFreeApp\nassembleRedPaidApp\nassembleRelease\nassembleStaging\n</code></pre></p>"},{"location":"android/gradle/Gradle_for_android_Creating_Build_Variants/#resource-and-manifest-merging","title":"Resource and manifest merging","text":"<p>Android\u7684Gradle\u63d2\u4ef6\u4f1a\u5728\u6253\u5305app\u524d\u5c06\u4e3b\u8981\u8d44\u6e90\u548c\u6784\u5efa\u7c7b\u578b\u8d44\u6e90\u5408\u5728\u4e00\u8d77\u3002\u53e6\u5916\uff0clib\u5de5\u7a0b\u4e5f\u53ef\u4ee5\u63d0\u4f9b \u989d\u5916\u53ef\u88ab\u5408\u5e76\u7684\u8d44\u6e90\u6587\u4ef6\u3002manifest\u6587\u4ef6\u4e5f\u53ef\u88ab\u5408\u5e76\u3002\u6bd4\u5982\u5728debug\u7248\u672c\u4e2d\u7533\u8bf7\u6b63\u5f0f\u7248\u4e2d\u4e0d\u9700\u8981\u7684\u6743\u9650\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Creating_Build_Variants/#_5","title":"\u5b9a\u4e49\u6784\u5efa\u53d8\u91cf","text":"<p>\u7ed9productFlavors\u4e2d\u7684\u7c7b\u578b\u6dfb\u52a0\u8d44\u6e90</p> <pre><code>productFlavors {\n    red {\n        versionName \"1.0-red\"\n        dimension \"color\"\n        resValue(\"color\", \"flavor_color\", \"#ff0000\")\n    }\n    green {\n        applicationId \"com.rustfisher.gradletest.green\" // \u4f7f\u7528\u53e6\u4e00\u4e2a\u7b7e\u540d\n        versionNameSuffix \"-green\"\n        resValue(\"color\", \"flavor_color\", \"#00ff00\")\n        dimension \"color\"\n    }\n// ...\n}\n</code></pre> <p>\u4e0a\u9762\u7684<code>flavor_color</code>\u53ef\u4ee5\u5728\u4ee3\u7801\u4e2d\u901a\u8fc7R\u6587\u4ef6\u627e\u5230<code>R.color.flavor_color</code></p>"},{"location":"android/gradle/Gradle_for_android_Creating_Build_Variants/#flavor","title":"\u83b7\u53d6flavor\u540d","text":"<p>\u53ef\u4ee5\u901a\u8fc7<code>variant.getFlavorName()</code>\u62ff\u5230flavor\u540d\u3002 <pre><code>android {\n    // ...\n    applicationVariants.all { variant -&gt;\n        variant.outputs.all {\n            if (variant.getFlavorName() == 'rust-fisher') {\n                outputFileName = \"RustFisher-app_v${defaultConfig.versionName}_${defaultConfig.versionCode}_${getTime()}.apk\"\n            }\n        }\n    }\n}\n</code></pre></p> <p>\u53c2\u8003\uff1aGradle for Android  Kevin Pelgrims</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a \u6398\u91d1</p>"},{"location":"android/gradle/Gradle_for_android_Start/","title":"Gradle for Android\u5f00\u59cb","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-5-25 <ul> <li>2022-5-25 \u66f4\u65b0\u683c\u5f0f</li> <li>2022-2-3 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u672c\u6587\u76ee\u7684</p> <p>\u4ecb\u7ecdAndroid\u4e2dgradle\u7684\u57fa\u672c\u6982\u5ff5\u548c\u7528\u6cd5</p> <p>Google\u5728Gradle\u4e2d\u7684\u76ee\u6807\uff1a\u80fd\u590d\u7528\u4ee3\u7801\uff0c\u521b\u5efa\u6784\u5efa\u53d8\u91cf\uff0c\u80fd\u914d\u7f6e\u548c\u5b9a\u5236\u6784\u5efa\u8fc7\u7a0b\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Start/#gradle","title":"Gradle\u57fa\u7840","text":"<p>Gradle\u6784\u5efa\u811a\u672c\u5e76\u4e0d\u662f\u7528XML\u6765\u5199\u7684\uff0c\u800c\u662f\u57fa\u4e8eGroovy\u7684\u4e00\u79cd\uff08domain-specifc language\uff09 DSL\u8bed\u8a00\u3002\u8fd9\u662f\u4e00\u79cd\u8fd0\u884c\u5728JVM\u4e0a\u7684\u52a8\u6001\u8bed\u8a00\u3002</p> <p>\u5982\u679c\u8981\u6784\u5efa\u65b0\u7684\u4efb\u52a1\u548c\u63d2\u4ef6\uff0c\u6211\u4eec\u9700\u8981\u4e86\u89e3\u8fd9\u95e8\u8bed\u8a00\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Start/#projects-and-tasks","title":"Projects and tasks","text":"<p>\u8fd9\u662fGradle\u79cd\u6700\u91cd\u8981\u7684\u4e24\u4e2a\u6982\u5ff5\u3002\u6bcf\u4e2a\u6784\u5efa\uff08build\uff09\u81f3\u5c11\u5305\u542b\u4e00\u4e2aproject\uff0c\u6bcf\u4e00\u4e2aproject\u5305\u542b \u4e00\u4e2a\u6216\u591a\u4e2atask\u3002\u6bcf\u4e2a<code>build.gradle</code>\u4ee3\u8868\u4e00\u4e2aproject\u3002task\u88ab\u5b9a\u4e49\u5728\u8fd9\u4e2a\u6784\u5efa\u811a\u672c\u4e2d\u3002 \u4e00\u4e2atask\u5bf9\u8c61\u5305\u542b\u4e00\u5217\u9700\u8981\u88ab\u6267\u884c\u7684Action\u5bf9\u8c61\u3002\u4e00\u4e2aAction\u5bf9\u8c61\u5c31\u662f\u4e00\u5757\u88ab\u6267\u884c\u7684\u4ee3\u7801\uff0c\u5c31\u50cf Java\u4e2d\u7684\u65b9\u6cd5\u3002</p> <p>\u5f53\u521d\u59cb\u5316\u6784\u5efa\u8fdb\u7a0b\u65f6\uff0cGradle\u6536\u96c6build\u6587\u4ef6\u4e2d\u7684project\u548ctask\u5bf9\u8c61\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Start/#the-build-lifecycle","title":"\u6784\u5efa\u7684\u751f\u547d\u5468\u671f\uff08The build lifecycle\uff09","text":"<p>\u4e3a\u7b80\u5316\u6784\u5efa\u8fc7\u7a0b\uff0c\u6784\u5efa\u5de5\u5177\u521b\u9020\u4e86\u4e00\u79cd\u5de5\u4f5c\u6d41\u7684\u52a8\u6001\u6a21\u578bDAG\uff08Directed Acyclic Graph\uff09\u3002 \u8fd9\u610f\u5473\u7740\u6240\u6709\u7684\u4efb\u52a1\u4f1a\u4e00\u4e2a\u63a5\u4e00\u4e2a\u5730\u6267\u884c\uff0c\u4e0d\u4f1a\u51fa\u73b0\u5faa\u73af\u7684\u60c5\u51b5\u3002 \u4e00\u4e2a\u4efb\u52a1\u4e00\u65e6\u88ab\u6267\u884c\u5c31\u4e0d\u4f1a\u518d\u88ab\u8c03\u7528\u3002\u6ca1\u6709\u4f9d\u8d56\u7684\u4efb\u52a1\u6c38\u8fdc\u662f\u6700\u4f18\u5148\u6267\u884c\u7684\u3002 \u5728\u914d\u7f6e\u8fc7\u7a0b\u4e2d\u751f\u6210\u4f9d\u8d56\u5173\u7cfb\u3002</p> <p>\u4e00\u4e2aGradle\u6784\u5efa\u8fc7\u7a0b\u67093\u4e2a\u6b65\u9aa4\uff1a * \u521d\u59cb\u5316\uff1a\u5de5\u7a0b\u5b9e\u4f8b\u88ab\u521b\u5efa\u65f6\u521d\u59cb\u5316\u3002\u5982\u679c\u6709\u591a\u4e2a\u6a21\u5757\uff0c\u6bcf\u4e2a\u6a21\u5757\u6709\u81ea\u5df1\u7684<code>build.gradle</code>\u6587\u4ef6\uff0c \u591a\u4e2aproject\u88ab\u521b\u5efa\u3002 * \u914d\u7f6e\uff1a\u8fd9\u4e00\u6b65\u6267\u884cbuild\u811a\u672c\uff0c\u521b\u5efa\u5e76\u914d\u7f6e\u6bcf\u4e2aproject\u7684task\u3002 * \u6267\u884c\uff1aGradle\u51b3\u5b9a\u6267\u884c\u90a3\u4e9b\u4efb\u52a1\u3002\u6839\u636e\u5f53\u524d\u76ee\u5f55\u548c\u4f20\u5165\u53c2\u6570\u6267\u884ctask\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Start/#build","title":"build\u914d\u7f6e\u6587\u4ef6","text":"<p><code>build.gradle</code>\u6587\u4ef6\u3002\u914d\u7f6ebuild\u7684\u5730\u65b9\u3002</p> <pre><code>buildscript {\n    repositories {\n        jcenter()\n    }\n    dependencies {\n        classpath 'com.android.tools.build:gradle:2.2.2'\n    }\n}\n</code></pre> <p>repositories\u5757\u4e2d\uff0c\u6307\u5b9aJCenter\u4f5c\u4e3a\u4f9d\u8d56\u4ed3\u5e93\u3002 \u8fd9\u4e2a\u811a\u672c\u83b7\u53d6\u4e86Android\u6784\u5efa\u5de5\u5177\u3002\u8fd9\u4e2aAndroid\u63d2\u4ef6\u63d0\u4f9b\u4e86\u6784\u5efa\u548c\u6d4b\u8bd5\u5e94\u7528\u6240\u9700\u7684\u529f\u80fd\u3002</p> <p>\u63d2\u4ef6\u88ab\u7528\u6765\u6269\u5c55Gradle\u6784\u5efa\u811a\u672c\u7684\u529f\u80fd\u3002\u5728project\u4e2d\u4f7f\u7528\u63d2\u4ef6\uff0c\u5c31\u53ef\u4ee5\u5b9a\u4e49\u5c5e\u6027\u548c\u4efb\u52a1\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Start/#gradle-wrapper","title":"Gradle Wrapper\u521d\u6b65","text":"<p>Gradle\u662f\u4e00\u4e2a\u5f00\u53d1\u4e2d\u7684\u5de5\u5177\u3002\u4f7f\u7528Gradle Wrapper\u53ef\u4ee5\u907f\u514d\u4e00\u4e9b\u95ee\u9898\uff0c\u786e\u4fdd\u80fd\u6784\u5efa\u987a\u5229\u3002 Gradle\u5728Windows\u7cfb\u7edf\u4e0a\u63d0\u4f9b\u4e86batch\u6587\u4ef6\uff0c\u5728\u5176\u4ed6\u7cfb\u7edf\u4e0a\u63d0\u4f9b\u4e86shell\u811a\u672c\u3002\u8bd5\u56fe\u8fd0\u884c\u811a\u672c\u65f6\uff0c\u4f1a \u81ea\u52a8\u68c0\u67e5\u5e76\u4e0b\u8f7dGradle\u3002\u4f46\u5728\u6211\u4eec\u7684\u7f51\u7edc\u6bd4\u8f83\u4ee4\u4eba\u7740\u6025\u3002\u53ef\u4ee5\u5c1d\u8bd5\u5728\u7f51\u7edc\u4e0a\u627e\u8d44\u6e90\u3002</p> <p>\u6bd4\u5982\u6211\u4e0b\u8f7d\u4e86\u4e00\u4e2a<code>gradle-2.14.1-all.zip</code>\uff0c\u5c06\u5176\u653e\u5230Android\u5de5\u7a0b\u7684gradle/wrapper\u4e0b</p> <pre><code>gradle\n`-- wrapper\n    |-- gradle-2.14.1-all.zip\n    |-- gradle-wrapper.jar\n    `-- gradle-wrapper.properties\n</code></pre> <p>\u7136\u540e\u4fee\u6539<code>gradle-wrapper.properties</code>\u6587\u4ef6\uff0c\u628aUrl\u4fee\u6539\u6210 <code>distributionUrl=gradle-2.14.1-all.zip</code></p> <p>\u5728Android Studio\u63d0\u4f9b\u7684Terminal\u4e2d\u8fd0\u884c<code>grawdlew</code>\uff0c\u5148unzipping\uff0c\u7136\u540e\u5f00\u59cb\u4e0b\u8f7d\u4f9d\u8d56\u6587\u4ef6\u3002 \u8fd9\u4e9b\u6587\u4ef6\u5728windows\u4e2d\u9ed8\u8ba4\u5b58\u653e\u5230 <code>C:\\Users\\UserName\\.gradle\\wrapper\\dists\\gradle-2.14.1-all</code>\uff0c\u8fd8\u662f\u5f88\u5360\u7a7a\u95f4\u7684\u3002 \u6b64\u65f6\u4f60\u53ef\u4ee5\u5728\u9879\u76ee\u4e0b\u7684\u547d\u4ee4\u884c\u4e2d\u4f7f\u7528grawdlew\u547d\u4ee4\u3002\u6bd4\u5982\u67e5\u770b\u7248\u672c\u3002</p> <pre><code>G:\\rust_proj\\NDKProj&gt;gradlew -v\n\n------------------------------------------------------------\nGradle 2.14.1\n------------------------------------------------------------\n\nBuild time:   2016-07-18 06:38:37 UTC\nRevision:     d9e2113d9fb05a5caabba61798bdb8dfdca83719\n\nGroovy:       2.4.4\nAnt:          Apache Ant(TM) version 1.9.6 compiled on June 29 2015\nJVM:          1.8.0_77 (Oracle Corporation 25.77-b03)\nOS:           Windows 7 6.1 amd64\n</code></pre> <p>\u5982\u679c\u5728\u53e6\u4e00\u4e2aAndroid\u9879\u76ee\u4e0b\u540c\u6837\u590d\u5236\u4e86<code>gradle-2.14.1-all.zip</code>\uff0c\u5e76\u4e14\u5c1d\u8bd5\u8fd0\u884cgradlew\uff0c C\u76d8\u91cc\u76f8\u5e94\u76ee\u5f55\u4e0b\u53c8\u4f1a\u591a\u4e00\u4e2a\u6587\u4ef6\u5939\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Start/#gradle-wrapper_1","title":"\u83b7\u53d6Gradle Wrapper","text":"<p>\u6253\u5f00Windows CMD\uff0c\u8fdb\u5165\u524d\u9762\u914d\u7f6e\u597d\u7684Android\u5de5\u7a0b\u76ee\u5f55\uff0c\u540c\u6837\u53ef\u4ee5\u8fd0\u884cgradlew\u3002</p> <p>\u6b64\u65f6\u6211\u4eec\u7684C\u76d8\u91cc\u5df2\u7ecf\u6709<code>gradle-2.14.1-all.zip</code>\u4e86\u3002\u627e\u5230<code>gradle.bat</code>\u7684\u8def\u5f84\uff0c\u5c06\u5176\u6dfb\u52a0\u5230 \u7535\u8111PATH\u4e2d\u3002\u8fd9\u91cc\u6dfb\u52a0\u5230\u7528\u6237\u7684\u73af\u5883\u53d8\u91cf\u4e2d\u3002</p> <p>\u5728G\u76d8\u65b0\u5efa\u4e00\u4e2a\u76ee\u5f55<code>gradleTest</code>\uff0c\u7136\u540e\u521b\u5efa\u4e00\u4e2a<code>build.gradle</code>\u6587\u4ef6\uff1b\u5176\u4e2d\u586b\u5199\u5982\u4e0b\u4ee3\u7801</p> <pre><code>task wrapper(type: Wrapper) {\n    gradleVersion = '2.4'\n}\n</code></pre> <p>\u8fdb\u5165\u521a\u624d\u7684\u76ee\u5f55\uff0c\u5728CMD\u4e2d\u76f4\u63a5\u8fd0\u884cgradle</p> <pre><code>G:\\gradleTest&gt;gradle\n:help\nWelcome to Gradle 2.14.1.\nTo run a build, run gradle &lt;task&gt; ...\nTo see a list of available tasks, run gradle tasks\nTo see a list of command-line options, run gradle --help\nTo see more detail about a task, run gradle help --task &lt;task&gt;\nBUILD SUCCESSFUL\nTotal time: 1.714 secs\n</code></pre> <p>\u6b64\u65f6\u76ee\u5f55\u4e0b\u751f\u6210\u4e86\u4e00\u4e2a<code>.gradle</code>\u76ee\u5f55</p> <p>\u5982\u679c\u5f53\u524d\u76ee\u5f55\u4e0b\u6ca1\u6709<code>build.gradle</code>\u6587\u4ef6\uff0cgradle\u4e5f\u4f1a\u6267\u884c\u5e76\u751f\u6210<code>.gradle</code>\u76ee\u5f55\u3002</p> <p>\u6211\u4eec\u6765\u89c2\u5bdfAndroid\u9879\u76ee\u91ccGradle Wrapper\u7684\u60c5\u51b5 <pre><code>NDKProj/\n\u251c\u2500\u2500 gradlew\n\u251c\u2500\u2500 gradlew.bat\n\u2514\u2500\u2500 gradle/wrapper/\n    \u251c\u2500\u2500 gradle-wrapper.jar\n    \u2514\u2500\u2500 gradle-wrapper.properties\n</code></pre> Gradle Wrapper\u5305\u542b3\u4e2a\u90e8\u5206\uff1a * MS\u53ef\u6267\u884c\u7684gradlew.bat\u548cLinux\uff0c Mac OS X\u53ef\u6267\u884c\u7684gradlew * \u811a\u672c\u9700\u8981\u7684Jar\u6587\u4ef6 * \u4e00\u4e2aproperties\u6587\u4ef6</p> <p>\u5728\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u628aproperties\u6587\u4ef6\u4fee\u6539\u6210\u4e86\u8fd9\u6837\uff1a <pre><code>#Mon Aug 29 19:26:36 CST 2016\ndistributionBase=GRADLE_USER_HOME\ndistributionPath=wrapper/dists\nzipStoreBase=GRADLE_USER_HOME\nzipStorePath=wrapper/dists\ndistributionUrl=gradle-2.14.1-all.zip\n</code></pre></p> <p>\u539fdistributionUrl\u5982\u4e0b\uff1a <pre><code>distributionUrl=https\\://services.gradle.org/distributions/gradle-2.14.1-all.zip\n</code></pre></p> <p>\u8fd9\u610f\u5473\u7740\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684URL\u548cGradle\u3002\u6211\u4eec\u524d\u9762\u5df2\u7ecf\u8fd9\u4e48\u505a\u4e86\u3002</p>"},{"location":"android/gradle/Gradle_for_android_Start/#task","title":"\u8fd0\u884c\u57fa\u672c\u7684\u6784\u5efa\u4efb\u52a1\uff08task\uff09","text":"<p>\u8fdb\u5165Android\u5de5\u7a0b\u76ee\u5f55\u4e0b\uff0c\u7528\u547d\u4ee4\u884c\u6267\u884cgradlew <code>gradlew tasks</code>\u4f1a\u6253\u5370\u51fa\u4efb\u52a1\u5217\u8868\uff1b<code>gradlew tasks --all</code>\u6253\u5370\u51fa\u6240\u6709\u7684\u4efb\u52a1</p> <p><code>gradlew assembleDebug</code>\u7f16\u8bd1\u5f53\u524d\u9879\u76ee\uff0c\u521b\u5efa\u4e00\u4e2adebug\u7248\u672c\u7684apk</p> <p><code>gradlew clean</code>\u6e05\u7406\u5f53\u524d\u9879\u76ee\u7684output</p> <p><code>gradlew check</code>\u8fd0\u884c\u6240\u6709\u7684\u68c0\u67e5\uff0c\u901a\u5e38\u662f\u5728\u771f\u673a\u6216\u8005\u6a21\u62df\u5668\u4e0a\u8fd0\u884c\u6d4b\u8bd5</p> <p><code>gradlew build</code>\u89e6\u53d1assemble \u548c check</p> <p>\u8fd9\u4e9b\u529f\u80fd\u5728Android Studio\u4e0a\u90fd\u6709\u76f8\u5e94\u6309\u952e</p> <p>\u53c2\u8003\uff1aGradle for Android  Kevin Pelgrims</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a</p>"},{"location":"android/gradle/download_too_slow/","title":"Android Studio Gradle \u4e0b\u8f7d\u901f\u5ea6\u6162\u89e3\u51b3\u65b9\u6cd5","text":"\u66f4\u65b0\u65e5\u671f: 2023-3-9 <ul> <li>2023-3-9 Mac\u624b\u52a8\u4e0b\u8f7dgradle\u5b89\u88c5</li> <li>2021-10-22 \u66f4\u65b0\u8bf4\u660e</li> <li>2021-3-26 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u6709\u65f6\u5019gradle\u4e0b\u8f7d\u7684\u65f6\u5019\u5f88\u6162\uff0c\u8981\u7b49\u5f88\u4e45\u3002\u6216\u8005\u63d0\u793a\u4e0b\u8f7d\u5931\u8d25\u3002</p>"},{"location":"android/gradle/download_too_slow/#gradle","title":"gradle\u6362\u6e90","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u963f\u91cc\u4e91\u7684\u6e90\u3002\u4e0d\u4f7f\u7528jcenter\u3002</p> <p>\u4fee\u6539buildscript\u7684repositories\u548callprojects\u4e2d\u7684repositories\u5373\u53ef\u3002</p> <pre><code>// Top-level build file where you can add configuration options common to all sub-projects/modules.\n\nbuildscript {\n    ext.kotlin_version = '1.3.31'\n\n    repositories {\n        maven { url 'http://maven.aliyun.com/nexus/content/groups/public/' }\n        google()\n//        jcenter()\n    }\n    dependencies {\n        classpath 'com.android.tools.build:gradle:3.4.2'\n\n        // NOTE: Do not place your application dependencies here; they belong\n        // in the individual module build.gradle files\n        classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version\"\n    }\n}\n\nallprojects {\n    repositories {\n        google()\n//        jcenter()\n        maven { url 'http://maven.aliyun.com/nexus/content/groups/public/' }\n    }\n}\n\ntask clean(type: Delete) {\n    delete rootProject.buildDir\n}\n</code></pre> <p>\u66f4\u6362\u540e\uff0c\u4e0b\u8f7d\u901f\u5ea6\u5feb\u5f88\u591a\u3002</p>"},{"location":"android/gradle/download_too_slow/#macgradle","title":"Mac\u624b\u52a8\u4e0b\u8f7dgradle\u5b89\u88c5","text":"<p>\u6709\u65f6\u5019\u56e0\u4e3a\u7f51\u7edc\u539f\u56e0\uff0cas\u4e0b\u8f7dgradle\u603b\u662f\u5931\u8d25\u3002\u4f46\u662f\u70b9\u5f00\u94fe\u63a5\uff0c\u53c8\u80fd\u4ece\u6d4f\u89c8\u5668\u4e0b\u8f7d\u5f97\u5230zip\u5305\u3002\u6b64\u65f6\u6211\u4eec\u8003\u8651\u624b\u52a8\u628agradle\u88c5\u8fdb\u53bb\u3002</p> <p>\u4f8b\u5982as\u63d0\u793a\u8bf4\u65e0\u6cd5\u4e0b\u8f7d https://downloads.gradle-dn.com/distributions/gradle-5.6.4-all.zip</p> <p>\u7528\u6d4f\u89c8\u5668\u4e0b\u8f7d\u5f97\u5230gradle-5.6.4-all.zip</p> <p>\u6253\u5f00\u7ec8\u7aef\uff0c\u8fdb\u5165<code>.gradle</code>\u76ee\u5f55\uff0c\u518d\u7528finder\u6253\u5f00 <pre><code>~ $ cd .gradle/\n~/.gradle $ open .\n~/.gradle $ \n</code></pre></p> <p>\u5728 <code>~/.gradle/wrapper/dists/gradle-5.6.4-all</code> \u91cc\u6709\u4e00\u4e2aas\u521b\u5efa\u7684\u76ee\u5f55\uff0c\u6bd4\u5982 <code>ankdp27end7byghfw1q2sw75f</code></p> <p>\u628agradle-5.6.4-all.zip\u653e\u8fdb\u53bb\uff0c\u91cd\u542fas\u5373\u53ef</p>"},{"location":"android/gradle/gradle-read-local-prop/","title":"Android Gradle \u8bfb\u53d6 local.properties","text":"\u4fee\u6539\u65e5\u671f\uff1a2022-5-24 <ul> <li>2022-5-24\uff1a \u521b\u5efa\u6587\u6863</li> </ul> <p>\u672c\u6587\u76ee\u6807</p> <p>\u5c06\u4e00\u4e9b\u4fe1\u606f\u5199\u5728local.properties\u4e2d\uff0cgradle\u8bfb\u53d6\u540e\uff0c\u7f16\u5165BuildConfig</p>"},{"location":"android/gradle/gradle-read-local-prop/#localproperties","title":"\u89c2\u5bdf\u5de5\u7a0b\u7684local.properties","text":"<p>\u65b0\u5efaAndroid App\u5de5\u7a0b\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53d1\u73b0\u5de5\u7a0b\u7684 .gitignore \u91cc\u5199\u6709<code>/local.properties</code>\u3002 \u4e5f\u5c31\u662f\u4e0d\u8ba9git\u8ffd\u8e2a\u8fd9\u4e2a\u6587\u4ef6\u3002</p> <p>\u6253\u5f00local.properties\uff0c\u91cc\u9762\u4e00\u822c\u5199\u7740<code>ndk.dir</code>\u548c<code>sdk.dir</code>\uff0c\u4f8b\u5982 local.properties<pre><code>ndk.dir=/Users/rustfisher/Library/Android/sdk/ndk-bundle\nsdk.dir=/Users/rustfisher/Library/Android/sdk\n</code></pre> \u8fd9\u4e9b\u914d\u7f6e\u56e0\u5f00\u53d1\u73af\u5883\u800c\u5f02\uff0c\u4e0d\u653e\u8fdbgit\u91cc\u4e5f\u662f\u6b63\u5e38</p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u5728local.properties\u6dfb\u52a0\u9700\u8981\u7684\u914d\u7f6e\uff0c\u5e76\u5c06\u5176\u8bfb\u53d6\u51fa\u6765</p>"},{"location":"android/gradle/gradle-read-local-prop/#_1","title":"\u65b0\u589e\u914d\u7f6e","text":"<p>\u73b0\u5728\u6a21\u62df\u4e00\u4e9b\u914d\u7f6e local.properties \u65b0\u589e<pre><code>vappid=rustfisher\nvsid=123\nvtoken=AnRFDev\n</code></pre></p>"},{"location":"android/gradle/gradle-read-local-prop/#_2","title":"\u8bfb\u53d6","text":"<p>\u63a5\u4e0b\u6765\u5728\u5de5\u7a0b\u7684 build.gradle \u4e2d\u589e\u52a0\u8bfb\u53d6\u65b9\u6cd5<code>parseLocalProperties</code> <pre><code>def parseLocalProperties() {\n    File file = rootProject.file('local.properties')\n    if (file.exists()) {\n        InputStream inputStream = rootProject.file('local.properties').newDataInputStream();\n        Properties properties = new Properties()\n        properties.load(inputStream)\n\n        if (properties.containsKey(\"vappid\")) { // (1)\n            ext.vappid = properties.getProperty(\"vappid\") // (2)\n        }\n        if (properties.containsKey(\"vsid\")) {\n            ext.vsid = properties.getProperty(\"vsid\")\n        }\n        if (properties.containsKey(\"vtoken\")) {\n            ext.vtoken = properties.getProperty(\"vtoken\")\n        }\n    }\n}\n</code></pre></p> <ol> <li>\u5148\u68c0\u67e5\u662f\u5426\u6709\u8fd9\u4e2akey\uff0c\u518d\u53bb\u8bfb\u53d6\u503c</li> <li>\u8fd9\u91cc\u6211\u4eec\u5c06\u53c2\u6570\u5b58\u653e\u5728<code>ext</code>\u91cc</li> </ol> <p>\u5728\u5de5\u7a0b build.gradle <code>allprojects</code>\u8c03\u7528\u4e0a\u9762\u7684\u65b9\u6cd5 <pre><code>allprojects {\n    repositories {\n        jcenter()\n        google()\n    }\n    parseLocalProperties() // \u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\n}\n</code></pre></p>"},{"location":"android/gradle/gradle-read-local-prop/#_3","title":"\u7f16\u8bd1","text":"<p>\u63a5\u4e0b\u6765\u5728\u6a21\u5757\uff08\u4f8b\u5982app\u6a21\u5757\uff09\u7684gradle\u914d\u7f6e\u8fdb<code>BuildConfig</code> \u6a21\u5757\u7684gradle<pre><code>    buildTypes {\n        debug {\n            buildConfigField \"String\", \"V_APPID\", \"\\\"\" + project['vappid'] + \"\\\"\"\n            buildConfigField \"String\", \"V_SID\", \"\\\"\" + project['vsid'] + \"\\\"\"\n            buildConfigField \"String\", \"V_TOKEN\", \"\\\"\" + project['vtoken'] + \"\\\"\"\n        }\n        release {\n            buildConfigField \"String\", \"V_APPID\", \"\\\"\" + project['vappid'] + \"\\\"\"\n            buildConfigField \"String\", \"V_SID\", \"\\\"\" + project['vsid'] + \"\\\"\"\n            buildConfigField \"String\", \"V_TOKEN\", \"\\\"\" + project['vtoken'] + \"\\\"\"\n        }\n    }\n</code></pre> \u6070\u597d<code>buildType</code>\u91cc\u6709debug\u548crelease\uff0c\u6211\u4eec\u8fd9\u91cc\u90fd\u7ed9\u5b83\u914d\u7f6e\u4e0a\u3002\u5f53\u7136\u540c\u4e00\u4e2a\u5b57\u6bb5debug\u548crelease\u53ef\u4ee5\u6709\u4e0d\u540c\u7684\u503c\u3002</p> <p>gradle\u540c\u6b65\u4e00\u4e0b\u548c\u7f16\u8bd1\u540e\uff0c\u5728BuildConfig\u91cc\u80fd\u627e\u5230<code>V_APPID</code>\u8fd9\u4e9b\u503c</p> <p>\u505a\u9879\u76ee\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u4e00\u4e9b\u914d\u7f6e\u4fe1\u606f\u5199\u5728local.properties\u91cc\uff0c\u4e0a\u4f20\u4ee3\u7801\u7684\u65f6\u5019\u4e0d\u628a\u8fd9\u4e9b\u4fe1\u606f\u4f20\u4e0a\u53bb\u3002</p>"},{"location":"android/gradle/gradle-read-local-prop/#_4","title":"\u53c2\u8003","text":"<ul> <li>Android Gradle \u57fa\u7840\u81ea\u5b9a\u4e49\u6784\u5efa</li> </ul>"},{"location":"android/gradle/overview/","title":"Android Gradle\u7b80\u4ecb","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-5-25 <ul> <li>2022-5-25 \u66f4\u65b0\u683c\u5f0f</li> <li>2022-2-3 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u672c\u6587\u76ee\u7684</p> <p>\u672c\u6587\u5c06\u4f1a\u4ecb\u7ecd\u5982\u4e0b3\u4e2agradle\u6587\u4ef6 <pre><code>Toturial2020\n\u251c\u2500\u2500 build.gradle\n\u251c\u2500\u2500 settings.gradle\n\u2514\u2500\u2500 app\n    \u2514\u2500\u2500 build.gradle\n</code></pre></p> <p>\u6211\u4eec\u5df2\u7ecf\u65b0\u5efa\u4e86\u4e00\u4e2aAndroid\u5e94\u7528\u5de5\u7a0b\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u6709\u597d\u51e0\u4e2agradle\u6587\u4ef6\u3002\u672c\u6587\u6765\u7b80\u8981\u4ecb\u7ecd\u5de5\u7a0b\u4e2d\u7684gradle\u6587\u4ef6\u3002</p>"},{"location":"android/gradle/overview/#settingsgradle","title":"\u9879\u76ee\u914d\u7f6e\u6587\u4ef6 settings.gradle","text":"<p>\u5bf9\u4e8eToturial2020\u9879\u76ee\u6765\u8bf4\uff0c<code>settings.gradle</code>\u5185\u5bb9\u5982\u4e0b <pre><code>include ':app'\n</code></pre></p> <p>\u8fd9\u91cc\u9762\u7684<code>:app</code>\u5c31\u662f\u6211\u4eec\u6b63\u5728\u7528\u7684App\u6a21\u5757\u3002\u770b\u5230\u8fd9\u91cc\u670b\u53cb\u4e5f\u80fd\u660e\u767d\u4e86\uff0c\u4e00\u4e2a\u5de5\u7a0b\u4e2d\u53ef\u4ee5\u6709\u591a\u4e2a\u6a21\u5757\u3002 \u5982\u679c\u9879\u76ee\u4e2d\u6709\u591a\u4e2a\u6a21\u5757\uff0c<code>settings.gradle</code>\u5185\u5bb9\u5982\u4e0b <pre><code>include ':app', ':FisherView', 'uijoystick'\n</code></pre> \u4e0a\u9762\u662f\u53e6\u4e00\u4e2a\u5de5\u7a0b\u7684<code>settings.gradle</code>\u6587\u4ef6\u3002 \u53ef\u4ee5\u770b\u5230\u91cc\u9762\u67093\u4e2a\u6a21\u5757\u3002</p>"},{"location":"android/gradle/overview/#_1","title":"\u6700\u5916\u5c42\u7684\u6784\u5efa\u6587\u4ef6","text":"<p>\u8fd9\u91cc\u6307\u7684\u662f\u4e0e<code>settings.gradle</code>\u540c\u76ee\u5f55\u7684<code>build.gradle</code>\u6587\u4ef6\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u53eb\u5b83\u201c\u9879\u76eegradle\u6587\u4ef6\u201d\u3002 \u8fd9\u4e2a\u6587\u4ef6\u80fd\u5bf9\u5de5\u7a0b\u4e2d\u6240\u6709\u7684\u6a21\u5757\u8fdb\u884c\u914d\u7f6e\u3002</p> <p>Toturial2020\u7684\u9879\u76eegradle\u6587\u4ef6\u76ee\u524d\u662f\u8fd9\u6837\u7684\u3002 <pre><code>// Top-level build file where you can add configuration options common to all sub-projects/modules.\n\nbuildscript {\n    repositories {\n        google()\n        jcenter()\n\n    }\n    dependencies {\n        classpath 'com.android.tools.build:gradle:3.4.2'\n\n        // NOTE: Do not place your application dependencies here; they belong\n        // in the individual module build.gradle files\n    }\n}\n\nallprojects {\n    repositories {\n        google()\n        jcenter()\n    }\n}\n\ntask clean(type: Delete) {\n    delete rootProject.buildDir\n}\n</code></pre> \u91cc\u9762\u6307\u660e\u4e86\u8fdc\u7a0b\u4ed3\u5e93\u6709google\u548cjcenter\u3002 \u5e76\u4e14\u5b83\u5305\u542b\u4e00\u4e2a\u6e05\u9664\u4efb\u52a1\uff08task\uff09<code>clean</code>\uff0c\u5b9e\u9645\u4e0a\u6267\u884c\u4efb\u52a1\u4f1a\u628a<code>build</code>\u76ee\u5f55\u5220\u9664\u6389\u3002</p> <p>\u672a\u6765\u6211\u4eec\u8981\u7528\u5230\u4e00\u4e9b\u7b2c\u4e09\u65b9\u5e93\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u4fee\u6539\u8fd9\u4e2a\u6587\u4ef6\uff0c\u6dfb\u52a0\u4e00\u4e9b\u914d\u7f6e\u8fdb\u53bb\u3002\u5177\u4f53\u4fee\u6539\u8981\u770b\u7b2c\u4e09\u65b9\u5e93\u7684\u8981\u6c42\u3002 \u6bd4\u5982aboutView\u9879\u76ee\u7684gradle\u6587\u4ef6\u3002 <pre><code>// Top-level build file where you can add configuration options common to all sub-projects/modules.\n\nbuildscript {\n    repositories {\n        jcenter()\n        google()\n    }\n    dependencies {\n        classpath 'com.android.tools.build:gradle:3.4.2'\n        classpath 'com.github.dcendents:android-maven-gradle-plugin:1.5'\n        classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:1.8.0'\n        // NOTE: Do not place your application dependencies here; they belong\n        // in the individual module build.gradle files\n    }\n}\n\nallprojects {\n    repositories {\n        jcenter()\n        maven {\n            url 'https://maven.google.com/'\n            name 'Google'\n        }\n    }\n}\n\ntask clean(type: Delete) {\n    delete rootProject.buildDir\n}\n</code></pre> \u91cc\u9762\u7528\u5230\u4e86\u4e00\u4e2a\u63d2\u4ef6<code>gradle-bintray-plugin</code>\uff0c\u8fd9\u4e2a\u662f\u4e4b\u524d\u7528\u6765\u4e0a\u4f20\u6a21\u5757\u7528\u7684\u3002</p>"},{"location":"android/gradle/overview/#appgradle","title":"app\u7684gradle","text":"<p>app\u7684gradle\u6307\u7684\u662f<code>app/build.gradle</code>\u6587\u4ef6\u3002\u8fd9\u4e2a\u6587\u4ef6\u914d\u7f6e\u4e86app\u6a21\u5757\u7528\u5230\u7684\u4e1c\u897f\u3002</p> <pre><code>apply plugin: 'com.android.application' // (1)\n\nandroid {\n    compileSdkVersion 29 // (2)\n    buildToolsVersion \"29.0.2\"\n    defaultConfig {\n        applicationId \"com.rustfisher.tutorial2020\"\n        minSdkVersion 19\n        targetSdkVersion 29\n        versionCode 1\n        versionName \"1.0.0\"\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n    }\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n}\n\ndependencies {\n    implementation fileTree(dir: 'libs', include: ['*.jar'])\n    implementation 'androidx.appcompat:appcompat:1.1.0'\n    implementation 'androidx.constraintlayout:constraintlayout:1.1.3'\n    testImplementation 'junit:junit:4.12'\n    androidTestImplementation 'androidx.test:runner:1.2.0'\n    androidTestImplementation 'androidx.test.espresso:espresso-core:3.2.0'\n\n    implementation 'androidx.recyclerview:recyclerview:1.1.0'\n}\n</code></pre> <ol> <li>\u5bf9app\u6a21\u5757\u6765\u8bf4\u5fc5\u4e0d\u53ef\u5c11</li> <li>\u4f7f\u7528\u7684\u662f\u7248\u672c\u4e3a29\u7684\u7f16\u8bd1\u5de5\u5177\uff0c\u8fd9\u4e2a\u4f1a\u968f\u7740Google\u7684\u66f4\u65b0\u800c\u53d1\u5c55</li> </ol> <p>\u7b2c\u4e00\u884c<code>apply plugin</code>\u5e94\u7528\u4e86Android\u5e94\u7528\u63d2\u4ef6\u3002 Android\u63d2\u4ef6\u7531Google\u56e2\u961f\u5f00\u53d1\u7ef4\u62a4\u3002\u8be5\u63d2\u4ef6\u63d0\u4f9b\u6784\u5efa\uff0c\u6d4b\u8bd5\uff0c\u6253\u5305\u5e94\u7528\u548c\u6a21\u5757\u9700\u8981\u7684\u6240\u6709\u7684task\u3002</p> <p>compileSdkVersion\u548cbuildToolsVersion\u90fd\u6307\u5b9a\u4e3a29\u3002\u67e5\u770bas\u7684SDK Manager\u53ef\u4ee5\u7ba1\u7406SDK\u5177\u4f53\u7248\u672c\u3002 \u5bf9\u4e8e\u6211\u4eec\u7684\u5c0f\u5de5\u7a0b\u6765\u8bf4\uff0cbuildToolsVersion\u5c3d\u53ef\u80fd\u8ddf\u4e0aGoogle\u53d1\u5e03\u7684\u6700\u65b0\u7248\u672c\u3002</p> <p>\u4e0b\u9762\u662f<code>android</code>\u914d\u7f6e\u533a\u57df\u3002</p>"},{"location":"android/gradle/overview/#defaultconfig","title":"defaultConfig","text":"<p>defaultConfig\u533a\u57df\u5bf9app\u6838\u5fc3\u8fdb\u884c\u914d\u7f6e\uff0c\u4f1a\u8986\u76d6<code>AndroidManifest.xml</code>\u4e2d\u7684\u914d\u7f6e\u3002</p> <p>applicationId\u6307\u5b9a\u4e86app\u7684\u5e94\u7528ID\u3002\u4e00\u822c\u6765\u8bf4\u8fd9\u4e2a\u5b57\u7b26\u4e32\u548c<code>AndroidManifest.xml</code>\u4e2d\u7684<code>package</code>\u4e00\u81f4\u3002 \u5b83\u4eec\u4e5f\u53ef\u4ee5\u4e0d\u4e00\u81f4\uff0c\u7cfb\u7edf\u4f1a\u4ee5gradle\u7684applicationId\u4e3a\u51c6\u3002</p> <p>minSdkVersion\u6307\u7684\u662f\u652f\u6301\u5230\u7684\u6700\u8001\u6700\u65e7\u7684Android API\u7248\u672c\u300219\u5bf9\u5e94\u7684\u662fKitKat\u3002 targetSdkVersion\u6307\u7684\u662f\u5f53\u524d\u7684\u76ee\u6807SDK\u7248\u672c\u3002</p> <p>versionCode\u662f\u7248\u672c\u53f7\u3002\u5927\u7684\u7248\u672c\u53f7\u53ef\u4ee5\u8986\u76d6\u5c0f\u7684\u7248\u672c\u53f7\u3002 versionName\u662f\u7248\u672c\u540d\u3002\u5b83\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u7cfb\u7edf\u5e76\u4e0d\u4f1a\u6839\u636e\u5b83\u6765\u5224\u65ad\u7248\u672c\u7684\u65b0\u65e7\u3002</p> <p>testInstrumentationRunner\u6307\u5b9a\u7684\u662f\u5355\u5143\u6d4b\u8bd5\u7684\u8fd0\u884c\u5668\u3002</p>"},{"location":"android/gradle/overview/#buildtypes","title":"buildTypes","text":"<p>\u7f16\u8bd1\u914d\u7f6e\u533a\u57df\u3002 \u53ef\u4ee5\u770b\u5230\u9ed8\u8ba4\u4f1a\u6709\u4e00\u4e2a<code>release</code>\u533a\u5757\u3002\u5b83\u914d\u7f6e\u7684\u662f\u53d1\u5e03\uff08release\uff09\u7248\u672c\u3002</p> <p>minifyEnabled \u8868\u793a\u6253\u5305\u65f6\u4f1a\u542f\u7528\u4f18\u5316\u529f\u80fd\u3002\u5177\u4f53\u4f7f\u7528\u7684\u662fProGuard\u7684\u6df7\u6dc6\u548c\u4f18\u5316\u529f\u80fd\u3002 \u4f18\u5316\u529f\u80fd\u9700\u8981proguardFiles\u7684\u914d\u5408\u3002\u5b83\u6307\u5b9a\u4e86\u6df7\u6dc6\u7684\u914d\u7f6e\u4fe1\u606f\u3002 \u4e00\u822c\u6765\u8bf4\u53d1\u5e03\u7248\u6211\u4eec\u4f1a\u542f\u7528minifyEnabled\u3002\u5f00\u53d1\u7248\u5219\u4e0d\u542f\u7528\u8fd9\u4e2a\u529f\u80fd\u3002</p> <p>\u8fd9\u91cc\u80fd\u914d\u7f6e\u591a\u79cd\u591a\u6837\u7684\u5b9a\u5236\u6253\u5305\u4fe1\u606f\u3002\u591a\u6e20\u9053\u6253\u5305\u5927\u90fd\u5728\u8fd9\u91cc\u8fdb\u884c\u914d\u7f6e\u3002</p>"},{"location":"android/gradle/overview/#dependencies","title":"dependencies","text":"<p>app\u6a21\u5757\u4f7f\u7528\u5230\u7684\u5e93\uff0c\u6216\u8005\u8bf4\u662f\u201c\u4f9d\u8d56\u201d\u3002</p> <p>implementation\u540e\u9762\u6307\u5b9a\u5e93\u7684\u540d\u79f0\u548c\u7248\u672c\u3002 <pre><code>implementation 'androidx.appcompat:appcompat:1.1.0'\n</code></pre> \u4f7f\u7528\u7248\u672c\u662f<code>1.1.0</code>\u3002</p> <p>\u7528\u5230\u7b2c\u4e09\u65b9\u5e93\u7684\u65f6\u5019\uff0c\u4e00\u822c\u4f1a\u6709\u58f0\u660e\uff0c\u6559\u4f7f\u7528\u8005\u5982\u4f55\u5f15\u5165\u8fd9\u4e2a\u5e93\u3002</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a \u6398\u91d1</p>"},{"location":"android/gradle/show-all-task-as2022/","title":"Gradle\u663e\u793a\u6240\u6709\u7684\u4efb\u52a1\uff0c\u6a21\u5757\u6253\u5305aar","text":"\u66f4\u65b0\u65e5\u671f\uff1a2023-04-20 <ul> <li>2023-04-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>Android Studio\u7248\u672c</p> <p>Android Studio\u7248\u672c Android Studio Electric Eel | 2022.1.1 Patch 2</p> <p>\u60f3\u7ed9\u5de5\u7a0b\u4e2d\u7684\u6a21\u5757\u6253\u5305\u51faaar\uff0c\u800cas\u4e2d\u627e\u4e0d\u5230assemble\u9009\u9879\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cgradle\u4e2d\u770b\u4e0d\u5230assemble\u9009\u9879</p> <p></p> <p>\u53d6\u6d88\u8fd9\u4e2a\u9009\u9879</p> <p></p> <p>\u91cd\u65b0\u5237\u65b0gradle</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u4efb\u52a1\u4e86</p> <p></p> <p>\u6253\u5305\u51fa\u6a21\u5757\u7684aar</p> <p></p> <p>\u8fd9\u662fas\u5b9e\u9a8c\u6027\u7684\u529f\u80fd\uff0c\u4ee5\u540e\u53ef\u80fd\u8fd8\u4f1a\u53d1\u751f\u53d8\u5316\u3002</p>"},{"location":"android/handler/Handler_HandlerThread/","title":"Handler\u548cHandlerThread\u914d\u5408\u4f7f\u7528","text":"<p>\u53c2\u8003Android Camera2Basic Sample\u7684handler\u4f7f\u7528\u65b9\u6cd5 <pre><code>    /**\n     * An additional thread for running tasks that shouldn't block the UI.\n     */\n    private HandlerThread mBackgroundThread;\n\n    /**\n     * A {@link Handler} for running tasks in the background.\n     */\n    private Handler mBackgroundHandler;\n\n    /**\n     * Starts a background thread and its {@link Handler}.\n     */\n    private void startBackgroundThread() {\n        mBackgroundThread = new HandlerThread(\"CameraBackground\");\n        mBackgroundThread.start(); // \u5fc5\u987b\u8c03\u7528start\u65b9\u6cd5\n        mBackgroundHandler = new Handler(mBackgroundThread.getLooper());\n    }\n\n    /**\n     * Stops the background thread and its {@link Handler}.\n     */\n    private void stopBackgroundThread() {\n        mBackgroundThread.quitSafely();\n        try {\n            mBackgroundThread.join();\n            mBackgroundThread = null;\n            mBackgroundHandler = null;\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n</code></pre></p> <p>\u4f7f\u7528<code>HandlerThread</code>\uff0c\u53ef\u4ee5\u76f4\u63a5\u548c<code>Handler</code>\u5173\u8054\u8d77\u6765\uff0c\u4e0d\u7528\u518d\u5b9a\u4e49\u7ebf\u7a0b\u548c<code>Looper</code>\u3002</p>"},{"location":"android/handler/Handler_HandlerThread/#handlerthread","title":"HandlerThread \u6e90\u7801\u89e3\u6790","text":"<p><code>HandlerThread</code>\u6e90\u7801\u5982\u4e0b\uff08Android-27 \u5220\u9664\u4e86\u5b98\u65b9\u7684\u6ce8\u91ca\uff09 <pre><code>package android.os;\n\nimport android.annotation.NonNull;\nimport android.annotation.Nullable;\n\n/**\n * \u4f7f\u7528\u524d\u5fc5\u987b\u8c03\u7528start()\u65b9\u6cd5\n */\npublic class HandlerThread extends Thread {\n    int mPriority;\n    int mTid = -1;\n    Looper mLooper;\n    private @Nullable Handler mHandler;\n\n    public HandlerThread(String name) {\n        super(name);\n        mPriority = Process.THREAD_PRIORITY_DEFAULT;\n    }\n\n    public HandlerThread(String name, int priority) {\n        super(name);\n        mPriority = priority;\n    }\n\n    protected void onLooperPrepared() {\n    }\n\n    @Override\n    public void run() {\n        mTid = Process.myTid();\n        Looper.prepare();\n        synchronized (this) {\n            mLooper = Looper.myLooper();\n            notifyAll();\n        }\n        Process.setThreadPriority(mPriority);\n        onLooperPrepared();\n        Looper.loop();\n        mTid = -1;\n    }\n\n    public Looper getLooper() {\n        if (!isAlive()) {\n            return null;\n        }\n\n        // If the thread has been started, wait until the looper has been created.\n        synchronized (this) {\n            while (isAlive() &amp;&amp; mLooper == null) {\n                try {\n                    wait();\n                } catch (InterruptedException e) {\n                }\n            }\n        }\n        return mLooper;\n    }\n\n    @NonNull\n    public Handler getThreadHandler() {\n        if (mHandler == null) {\n            mHandler = new Handler(getLooper());\n        }\n        return mHandler;\n    }\n\n    public boolean quit() {\n        Looper looper = getLooper();\n        if (looper != null) {\n            looper.quit();\n            return true;\n        }\n        return false;\n    }\n\n    public boolean quitSafely() {\n        Looper looper = getLooper();\n        if (looper != null) {\n            looper.quitSafely();\n            return true;\n        }\n        return false;\n    }\n\n\n    public int getThreadId() {\n        return mTid;\n    }\n}\n</code></pre></p>"},{"location":"android/handler/Handler_src_note/","title":"Android Handler\uff0cLooper\u4e0eMessageQueue\u4f7f\u7528\u4e0e\u5206\u6790","text":"\u66f4\u65b0\u65e5\u671f: 2021-9-14 <ul> <li>2021-9-14 \u66f4\u65b0\u6587\u6863</li> <li>2020-4-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4ece\u6e90\u7801\u89d2\u5ea6\u5206\u6790Handler\u3002\u6709\u5229\u4e8e\u4f7f\u7528Handler\u548c\u5206\u6790Handler\u7684\u76f8\u5173\u95ee\u9898\u3002\u8ba4\u8bc6Looper\u4e0eHandler\u7684\u5173\u7cfb\u3002</p>"},{"location":"android/handler/Handler_src_note/#handler","title":"Handler\u7b80\u4ecb","text":"<p>\u4e00\u4e2aHandler\u5141\u8bb8\u53d1\u9001\u548c\u5904\u7406Message\uff0c\u901a\u8fc7\u5173\u8054\u7ebf\u7a0b\u7684 MessageQueue \u6267\u884c Runnable \u5bf9\u8c61\u3002 \u6bcf\u4e2aHandler\u5b9e\u4f8b\u90fd\u548c\u4e00\u4e2a\u5355\u72ec\u7684\u7ebf\u7a0b\u53ca\u5176\u6d88\u606f\u961f\u5217\u7ed1\u5b9a\u3002 \u53ef\u4ee5\u5c06\u4e00\u4e2a\u4efb\u52a1\u5207\u6362\u5230Handler\u6240\u5728\u7684\u7ebf\u7a0b\u4e2d\u53bb\u6267\u884c\u3002\u4e00\u4e2a\u7528\u6cd5\u5c31\u662f\u5b50\u7ebf\u7a0b\u901a\u8fc7Handler\u66f4\u65b0UI\u3002</p> <p>Handler\u4e3b\u8981\u67092\u79cd\u7528\u6cd5\uff1a</p> <ul> <li>\u505a\u51fa\u8ba1\u5212\uff0c\u5728\u672a\u6765\u67d0\u4e2a\u65f6\u95f4\u70b9\u6267\u884c\u6d88\u606f\u548cRunnable</li> <li>\u7ebf\u7a0b\u8c03\u5ea6\uff0c\u5728\u5176\u4ed6\u7ebf\u7a0b\u89c4\u5212\u5e76\u6267\u884c\u4efb\u52a1</li> </ul> <p>\u8981\u4f7f\u7528\u597dHandler\uff0c\u9700\u8981\u4e86\u89e3\u4e0e\u5176\u76f8\u5173\u7684 <code>MessageQueue</code>\uff0c <code>Message</code>\u548c<code>Looper</code>\uff1b\u4e0d\u80fd\u5b64\u7acb\u7684\u770bHandler\u3002 Handler\u5c31\u50cf\u4e00\u4e2a\u64cd\u4f5c\u8005\uff08\u6216\u8005\u50cf\u4e00\u4e2a\u5bf9\u5f00\u53d1\u8005\u5f00\u653e\u7684\u7a97\u53e3\uff09\uff0c\u5229\u7528<code>MessageQueue</code>\u548c<code>Looper</code>\u6765\u5b9e\u73b0\u4efb\u52a1\u8c03\u5ea6\u548c\u5904\u7406\u3002  </p> <p>Handler\u6301\u6709 Looper \u7684\u5b9e\u4f8b\uff0c\u76f4\u63a5\u6301\u6709looper\u7684\u6d88\u606f\u961f\u5217\u3002</p>"},{"location":"android/handler/Handler_src_note/#_1","title":"\u5c5e\u6027\u4e0e\u6784\u9020\u5668","text":"<p>Handler\u7c7b\u4e2d\u6301\u6709\u7684\u5b9e\u4f8b\uff0c\u6301\u6709looper\uff0cmessageQueue\u7b49\u7b49\u3002 <pre><code>final Looper mLooper; // Handler\u6301\u6709Looper\u5b9e\u4f8b\nfinal MessageQueue mQueue; // Handler\u6301\u6709\u6d88\u606f\u961f\u5217\nfinal Callback mCallback;\n</code></pre></p> <p>\u5728Handler\u7684\u6784\u9020\u5668\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230Handler\u83b7\u53d6\u4e86Looper\u7684\u6d88\u606f\u961f\u5217\u3002 <pre><code>public Handler(Callback callback, boolean async) {\n    // rustfisher \u5904\u7406\u5f02\u5e38\n    mLooper = Looper.myLooper();\n    // rustfisher \u5904\u7406\u7279\u6b8a\u60c5\u51b5...\n    mQueue = mLooper.mQueue; // \u83b7\u53d6\u7684\u662fLooper\u7684\u6d88\u606f\u961f\u5217\n}\n\npublic Handler(Looper looper, Callback callback, boolean async) {\n    mLooper = looper;\n    mQueue = looper.mQueue; // \u83b7\u53d6\u7684\u662fLooper\u7684\u6d88\u606f\u961f\u5217\n    mCallback = callback;\n    mAsynchronous = async;\n}\n</code></pre></p>"},{"location":"android/handler/Handler_src_note/#handler_1","title":"Handler\u4f7f\u7528\u65b9\u6cd5","text":"<p>Handler\u53d1\u9001\u548c\u5904\u7406\u6d88\u606f\u7684\u51e0\u4e2a\u65b9\u6cd5</p> <ul> <li>void handleMessage( Message  msg):\u5904\u7406\u6d88\u606f\u7684\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u901a\u5e38\u88ab\u91cd\u5199\u3002</li> <li>final boolean hasMessage(int  what):\u68c0\u67e5\u6d88\u606f\u961f\u5217\u4e2d\u662f\u5426\u5305\u542b\u6709what\u5c5e\u6027\u4e3a\u6307\u5b9a\u503c\u7684\u6d88\u606f</li> <li>final boolean hasMessage(int what ,Object object) :\u68c0\u67e5\u6d88\u606f\u961f\u5217\u4e2d\u662f\u5426\u5305\u542b\u6709what\u597dobject\u5c5e\u6027\u6307\u5b9a\u503c\u7684\u6d88\u606f</li> <li>sendEmptyMessage(int what):\u53d1\u9001\u7a7a\u6d88\u606f</li> <li>final Boolean send EmptyMessageDelayed(int what ,long delayMillis):\u6307\u5b9a\u591a\u5c11\u6beb\u79d2\u53d1\u9001\u7a7a\u6d88\u606f</li> <li>final  boolean sendMessage(Message msg):\u7acb\u5373\u53d1\u9001\u6d88\u606f</li> <li>final boolean sendMessageDelayed(Message msg,long delayMillis):\u591a\u5c11\u79d2\u4e4b\u540e\u53d1\u9001\u6d88\u606f</li> </ul>"},{"location":"android/handler/Handler_src_note/#handlersendemptymessageint-what","title":"Handler.sendEmptyMessage(int what) \u6d41\u7a0b\u89e3\u6790","text":"<p>\u83b7\u53d6\u4e00\u4e2aMessage\u5b9e\u4f8b\uff0c\u5e76\u7acb\u5373\u5c06Message\u5b9e\u4f8b\u6dfb\u52a0\u5230\u6d88\u606f\u961f\u5217\u4e2d\u53bb\u3002 \u7b80\u8981\u6d41\u7a0b\u5982\u4e0b\uff1a <pre><code>// \u7acb\u523b\u53d1\u9001\u4e00\u4e2aempty\u6d88\u606f\nsendEmptyMessage(int what) \n\n// \u53d1\u9001\u5ef6\u8fdf\u4e3a0\u7684empty\u6d88\u606f  \u8fd9\u4e2a\u65b9\u6cd5\u91cc\u901a\u8fc7Message.obtain()\u83b7\u53d6\u4e00\u4e2aMessage\u5b9e\u4f8b\nsendEmptyMessageDelayed(what, 0) \n\n// \u8ba1\u7b97\u6d88\u606f\u7684\u8ba1\u5212\u6267\u884c\u65f6\u95f4\uff0c\u8fdb\u5165\u4e0b\u4e00\u9636\u6bb5\nsendMessageDelayed(Message msg, long delayMillis)\n\n// \u5728\u8fd9\u91cc\u5224\u65ad\u961f\u5217\u662f\u5426\u4e3anull  \u82e5\u4e3anull\u5219\u76f4\u63a5\u8fd4\u56defalse\nsendMessageAtTime(Message msg, long uptimeMillis)\n\n// \u5c06\u6d88\u606f\u6dfb\u52a0\u5230\u961f\u5217\u4e2d\nenqueueMessage(MessageQueue queue, Message msg, long uptimeMillis)\n\n// \u63a5\u4e0b\u6765\u662fMessageQueue\u6dfb\u52a0\u6d88\u606f\n// MessageQueue.java\nboolean enqueueMessage(Message msg, long when)\n</code></pre> \u53ef\u4ee5\u770b\u5230\uff0c\u6700\u540e\u662f\u628amessage\u6dfb\u52a0\u5230\u4e86messageQueue\u4e2d\u3002</p>"},{"location":"android/handler/Handler_src_note/#handler_2","title":"Handler \u53d6\u6d88\u4efb\u52a1","text":"<p>\u8981\u53d6\u6d88\u4efb\u52a1\u65f6\uff0c\u8c03\u7528\u4e0b\u9762\u8fd9\u4e2a\u65b9\u6cd5<code>removeCallbacksAndMessages(Object token)</code> <pre><code>public final void removeCallbacksAndMessages(Object token) {\n    mQueue.removeCallbacksAndMessages(this, token);\n}\n</code></pre> \u901a\u8fc7\u8c03\u7528<code>Message.recycleUnchecked()</code>\u65b9\u6cd5\uff0c\u53d6\u6d88\u6389\u4e0e\u6b64Handler\u76f8\u5173\u8054\u7684Message\u3002</p> <p>\u76f8\u5173\u7684\u6d88\u606f\u961f\u5217\u4f1a\u6267\u884c\u53d6\u6d88\u6307\u4ee4 <pre><code>void removeCallbacksAndMessages(Handler h, Object object)\n</code></pre></p>"},{"location":"android/handler/Handler_src_note/#handler_3","title":"\u6d88\u606f\u9a71\u52a8\u4e0eHandler","text":"<p>Android\u662f\u6d88\u606f\u9a71\u52a8\u7684\uff0c\u5b9e\u73b0\u6d88\u606f\u9a71\u52a8\u6709\u51e0\u4e2a\u8981\u7d20</p> <ul> <li>\u6d88\u606f\u7684\u8868\u793a\uff1aMessage</li> <li>\u6d88\u606f\u961f\u5217\uff1aMessageQueue</li> <li>\u6d88\u606f\u5faa\u73af\uff0c\u7528\u4e8e\u5faa\u73af\u53d6\u51fa\u6d88\u606f\u8fdb\u884c\u5904\u7406\uff1aLooper</li> <li>\u6d88\u606f\u5904\u7406\uff0c\u6d88\u606f\u5faa\u73af\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u53d6\u51fa\u6d88\u606f\u540e\u8981\u5bf9\u6d88\u606f\u8fdb\u884c\u5904\u7406\uff1aHandler</li> </ul>"},{"location":"android/handler/Handler_src_note/#_2","title":"\u521d\u59cb\u5316\u6d88\u606f\u961f\u5217","text":"<p>\u5728Looper\u6784\u9020\u5668\u4e2d\u5373\u521b\u5efa\u4e86\u4e00\u4e2aMessageQueue\uff0cLooper\u6301\u6709\u6d88\u606f\u961f\u5217\u7684\u5b9e\u4f8b\u3002</p>"},{"location":"android/handler/Handler_src_note/#_3","title":"\u53d1\u9001\u6d88\u606f","text":"<p>\u901a\u8fc7Looper.prepare\u521d\u59cb\u5316\u597d\u6d88\u606f\u961f\u5217\u540e\u5c31\u53ef\u4ee5\u8c03\u7528Looper.loop\u8fdb\u5165\u6d88\u606f\u5faa\u73af\u4e86\uff0c\u7136\u540e\u6211\u4eec\u5c31\u53ef\u4ee5\u5411\u6d88\u606f\u961f\u5217\u53d1\u9001\u6d88\u606f\uff0c \u6d88\u606f\u5faa\u73af\u5c31\u4f1a\u53d6\u51fa\u6d88\u606f\u8fdb\u884c\u5904\u7406\uff0c\u5728\u770b\u6d88\u606f\u5904\u7406\u4e4b\u524d\uff0c\u5148\u770b\u4e00\u4e0b\u6d88\u606f\u662f\u600e\u4e48\u88ab\u6dfb\u52a0\u5230\u6d88\u606f\u961f\u5217\u7684\u3002</p>"},{"location":"android/handler/Handler_src_note/#_4","title":"\u6d88\u606f\u5faa\u73af","text":"<p>Java\u5c42\u7684\u6d88\u606f\u90fd\u4fdd\u5b58\u5728\u4e86Java\u5c42MessageQueue\u7684\u6210\u5458mMessages\u4e2d\uff0cNative\u5c42\u7684\u6d88\u606f\u90fd\u4fdd\u5b58\u5728\u4e86Native Looper\u7684 mMessageEnvelopes\u4e2d\uff0c\u8fd9\u5c31\u53ef\u4ee5\u8bf4\u6709\u4e24\u4e2a\u6d88\u606f\u961f\u5217\uff0c\u800c\u4e14\u90fd\u662f\u6309\u65f6\u95f4\u6392\u5217\u7684\u3002</p>"},{"location":"android/handler/Handler_src_note/#messagemessagequeue","title":"Message\u548cMessageQueue","text":"<p>\u4e0eHandler\u5de5\u4f5c\u7684\u51e0\u4e2a\u7ec4\u4ef6Looper\u3001MessageQueue\u5404\u81ea\u7684\u4f5c\u7528\uff1a</p> <ul> <li>1.Handler\uff1a\u5b83\u628a\u6d88\u606f\u53d1\u9001\u7ed9Looper\u7ba1\u7406\u7684MessageQueue,\u5e76\u8d1f\u8d23\u5904\u7406Looper\u5206\u7ed9\u5b83\u7684\u6d88\u606f</li> <li>2.MessageQueue\uff1a\u7ba1\u7406Message\uff0c\u7531Looper\u7ba1\u7406</li> <li>3.Looper\uff1a\u6bcf\u4e2a\u7ebf\u7a0b\u53ea\u6709\u4e00\u4e2aLooper\uff0c\u6bd4\u5982UI\u7ebf\u7a0b\u4e2d\uff0c\u7cfb\u7edf\u4f1a\u9ed8\u8ba4\u7684\u521d\u59cb\u5316\u4e00\u4e2aLooper\u5bf9\u8c61\uff0c\u5b83\u8d1f\u8d23\u7ba1\u7406MessageQueue\uff0c\u4e0d\u65ad\u7684\u4eceMessageQueue\u4e2d\u53d6\u6d88\u606f\uff0c\u5e76\u5c06\u76f8\u5bf9\u5e94\u7684\u6d88\u606f\u5206\u7ed9Handler\u5904\u7406\u3002</li> </ul>"},{"location":"android/handler/Handler_src_note/#message","title":"Message","text":"<p>Message \u5c5e\u4e8e\u88ab\u4f20\u9012\uff0c\u88ab\u4f7f\u7528\u7684\u89d2\u8272\u3002Message \u662f\u5305\u542b\u63cf\u8ff0\u548c\u4efb\u610f\u6570\u636e\u5bf9\u8c61\u7684\u201c\u6d88\u606f\u201d\uff0c\u80fd\u88ab\u53d1\u9001\u7ed9<code>Handler</code>\u3002Message\u5305\u542b2\u4e2aint\u5c5e\u6027\u548c\u4e00\u4e2a\u989d\u5916\u7684\u5bf9\u8c61\u3002 \u867d\u7136\u6784\u9020\u5668\u662f\u516c\u5f00\u7684\uff0c\u4f46\u83b7\u53d6\u5b9e\u4f8b\u6700\u597d\u7684\u529e\u6cd5\u662f\u8c03\u7528<code>Message.obtain()</code>\u6216<code>Handler.obtainMessage()</code>\u3002\u8fd9\u6837\u53ef\u4ee5\u4ece\u4ed6\u4eec\u7684\u53ef\u56de\u6536\u5bf9\u8c61\u6c60\u4e2d\u83b7\u53d6\u5230\u6d88\u606f\u5b9e\u4f8b\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u6bcf\u4e2aMessage\u5b9e\u4f8b\u6301\u6709\u4e00\u4e2aHandler\u3002</p> <p>Message\u90e8\u5206\u5c5e\u6027\u503c <pre><code>/*package*/ Handler target; // \u6307\u5b9a\u7684Handler\n\n/*package*/ Runnable callback;\n\n// \u53ef\u4ee5\u7ec4\u6210\u94fe\u8868\n// sometimes we store linked lists of these things\n/*package*/ Message next;\n</code></pre> \u4ece\u8fd9\u91cc\u4e5f\u4e0d\u96be\u770b\u51fa\uff0c\u6bcf\u4e2aMessage\u90fd\u6301\u6709Handler\u5b9e\u4f8b\u3002\u5982\u679cHandler\u6301\u6709Activity\u7684\u5f15\u7528\uff0cActivity onDestroy\u540eMessage\u5374\u4ecd\u7136\u5728\u961f\u5217\u4e2d\uff0c\u56e0\u4e3aHandler\u4e0eActivity\u7684\u5f3a\u5173\u8054\uff0c\u4f1a\u9020\u6210Activity\u65e0\u6cd5\u88abGC\u56de\u6536\uff0c\u5bfc\u81f4\u5185\u5b58\u6cc4\u9732\u3002 \u56e0\u6b64\u5728Activity onDestroy \u65f6\uff0c\u4e0eActivity\u5173\u8054\u7684Handler\u5e94\u6e05\u9664\u5b83\u7684\u961f\u5217\u7531Activity\u4ea7\u751f\u7684\u4efb\u52a1\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u9732\u3002</p> <p>\u91cd\u7f6e\u81ea\u8eab\u7684\u65b9\u6cd5\uff0c\u5c06\u5c5e\u6027\u5168\u90e8\u91cd\u7f6e <pre><code>public void recycle()\nvoid recycleUnchecked()\n</code></pre></p> <p>\u83b7\u53d6Message\u5b9e\u4f8b\u7684\u5e38\u7528\u65b9\u6cd5\uff0c\u5f97\u5230\u7684\u5b9e\u4f8b\u4e0e\u4f20\u5165\u7684Handler\u7ed1\u5b9a <pre><code>/**\n * Same as {@link #obtain()}, but sets the value for the &lt;em&gt;target&lt;/em&gt; member on the Message returned.\n * @param h  Handler to assign to the returned Message object's &lt;em&gt;target&lt;/em&gt; member.\n * @return A Message object from the global pool.\n */\npublic static Message obtain(Handler h) {\n    Message m = obtain();\n    m.target = h;\n\n    return m;\n}\n</code></pre></p> <p>\u5c06\u6d88\u606f\u53d1\u9001\u7ed9Handler <pre><code>/**\n * Sends this Message to the Handler specified by {@link #getTarget}.\n * Throws a null pointer exception if this field has not been set.\n */\npublic void sendToTarget() {\n    target.sendMessage(this); // target \u5c31\u662f\u4e0e\u6d88\u606f\u7ed1\u5b9a\u7684Handler\n}\n</code></pre> \u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u540e\uff0cHandler\u4f1a\u5c06\u6d88\u606f\u6dfb\u52a0\u8fdb\u5b83\u7684\u6d88\u606f\u961f\u5217<code>MessageQueue</code>\u4e2d\u3002</p>"},{"location":"android/handler/Handler_src_note/#messagequeue","title":"MessageQueue","text":"<p>\u6301\u6709\u4e00\u5217\u53ef\u4ee5\u88abLooper\u5206\u53d1\u7684Message\u3002\u4e00\u822c\u6765\u8bf4\u7531Handler\u5c06Message\u6dfb\u52a0\u5230MessageQueue\u4e2d\u3002 \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u7684MessageQueue\u65b9\u6cd5\u662f<code>Looper.myQueue()</code>\u3002\u901a\u8fc7<code>Looper.getMainLooper()</code>\u83b7\u53d6\u5230\u4e3b\u7ebf\u7a0b\u7684looper\u3002</p>"},{"location":"android/handler/Handler_src_note/#looper","title":"Looper\u7b80\u4ecb","text":"<p>Looper\u4e0eMessageQueue\u7d27\u5bc6\u5173\u8054\u3002\u5728\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u8fd0\u884c\u7684\u6d88\u606f\u5faa\u73af\u3002\u7ebf\u7a0b\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u6ca1\u6709\u4e0e\u4e4b\u7ba1\u7406\u7684\u6d88\u606f\u5faa\u73af\u7684\u3002 \u8981\u521b\u5efa\u4e00\u4e2a\u6d88\u606f\u5faa\u73af\uff0c\u5728\u7ebf\u7a0b\u4e2d\u8c03\u7528prepare\uff0c\u7136\u540e\u8c03\u7528loop\u3002\u5373\u5f00\u59cb\u5904\u7406\u6d88\u606f\uff0c\u76f4\u5230\u5faa\u73af\u505c\u6b62\u3002\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u901a\u8fc7Handler\u6765\u4e0e\u6d88\u606f\u5faa\u73af\u4e92\u52a8\u3002</p> <p>Handler\u4e0eLooper\u5728\u7ebf\u7a0b\u4e2d\u4ea4\u4e92\u7684\u5178\u578b\u4f8b\u5b50 <pre><code>class LooperThread extends Thread {\n    public Handler mHandler;\n    public void run() {\n        Looper.prepare(); // \u4e3a\u5f53\u524d\u7ebf\u7a0b\u51c6\u5907\u4e00\u4e2aLooper\n        // \u521b\u5efaHandler\u5b9e\u4f8b\uff0cHandler\u4f1a\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u7684Looper\n        // \u5982\u679c\u5b9e\u4f8b\u5316Handler\u65f6\u5f53\u524d\u7ebf\u7a0b\u6ca1\u6709Looper\uff0c\u4f1a\u62a5\u5f02\u5e38 RuntimeException\n        mHandler = new Handler() {\n            public void handleMessage(Message msg) {\n                // process incoming messages here\n            }\n        };\n        Looper.loop(); // Looper\u5f00\u59cb\u8fd0\u884c\n    }\n}\n</code></pre></p> <p>\u8c03\u7528\u4e86<code>Looper.loop()</code>\u4e4b\u540e\uff0clooper\u5f00\u59cb\u8fd0\u884c\u3002\u5f53looper\u7684messageQueue\u4e2d\u6ca1\u6709\u6d88\u606f\u65f6\uff0c\u76f8\u5173\u7684\u7ebf\u7a0b\u5904\u4e8e\u4ec0\u4e48\u72b6\u6001\u5462\uff1f \u67e5\u770blooper\u7684\u6e90\u7801\uff0c\u770b\u5230loop\u65b9\u6cd5\u91cc\u9762\u6709\u4e00\u4e2a\u6b7b\u5faa\u73af\u3002<code>queue.next()</code>\u65b9\u6cd5\u662f\u53ef\u80fd\u4f1a\u963b\u585e\u7ebf\u7a0b\u7684\u3002\u5982\u679c\u4ecequeue\u4e2d\u83b7\u53d6\u5230null\uff0c\u5219\u8868\u660e\u6b64\u6d88\u606f\u961f\u5217\u6b63\u5728\u9000\u51fa\u3002\u6b64\u65f6looper\u7684\u6b7b\u5faa\u73af\u4e5f\u4f1a\u88ab\u8fd4\u56de\u3002 <pre><code>for (;;) {\n    Message msg = queue.next(); // might block\n    if (msg == null) {\n        // No message indicates that the message queue is quitting.\n        return;\n    }\n</code></pre> \u8c03\u7528looper\u7684quit\u65b9\u6cd5\uff0c\u5b9e\u9645\u4e0a\u8c03\u7528\u4e86<code>mQueue.quit(false)</code>\u3002\u6d88\u606f\u961f\u5217\u9000\u51fa\u540e\uff0clooper\u7684loop\u6b7b\u5faa\u73af\u4e5f\u88ab\u9000\u51fa\u4e86\u3002</p> <p>\u8fdb\u5165MessageQueue\u7684<code>next</code>\u65b9\u6cd5\u53bb\u770b\uff0c\u53d1\u73b0\u91cc\u9762\u4e5f\u6709\u4e00\u4e2a\u6b7b\u5faa\u73af\u3002\u6ca1\u6709\u6d88\u606f\u65f6\uff0c\u8fd9\u4e2a\u6b7b\u5faa\u73af\u4f1a\u963b\u585e\u5728<code>nativePollOnce</code>\u8fd9\u4e2a\u65b9\u6cd5\u3002 <pre><code>Message next() {\n    // ...\n    for (;;) {\n        // ...\n        nativePollOnce(ptr, nextPollTimeoutMillis);\n        // \u5904\u7406message\u5bf9\u8c61\n</code></pre></p> <p>\u6211\u4eec\u77e5\u9053Thread\u6709New\uff08\u65b0\u5efa\uff0c\u672a\u8fd0\u884c\uff09\uff0cRUNNABLE\uff08\u53ef\u8fd0\u884c\uff09\uff0cBLOCKED\uff0cWAITING\uff08\u7ebf\u7a0b\u62e5\u6709\u4e86\u67d0\u4e2a\u9501\u4e4b\u540e, \u8c03\u7528\u4e86\u4ed6\u7684wait\u65b9\u6cd5, \u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b/\u9501\u62e5\u6709\u8005\u8c03\u7528 notify / notifyAll\uff09\uff0cTIMED_WAITING\uff0cTERMINATED\uff08\u5df2\u7ecf\u6267\u884c\u5b8c\u6bd5\uff09\u8fd9\u51e0\u79cd\u72b6\u6001\u3002</p> <p>\u6d88\u606f\u961f\u5217\u4e2d\u6ca1\u6709\u6d88\u606f\uff0c\u5728<code>nativePollOnce</code>\u65b9\u6cd5\u4e2d\u201c\u7b49\u5f85\u201d\u3002<code>nativePollOnce</code>\u6548\u679c\u4e0a\u5927\u81f4\u7b49\u540c\u4e8e<code>Object.wait()</code>\uff0c\u4f46\u5b83\u4eec\u7684\u5b9e\u73b0\u5b8c\u5168\u4e0d\u540c\u3002<code>nativePollOnce</code>\u4f7f\u7528 <code>epoll</code>, \u800c <code>Object.wait</code> \u4f7f\u7528 <code>futex</code>\u3002</p> <p>\u201c\u7b49\u5f85\u201d\u65f6\uff0c\u76f8\u5173\u7ebf\u7a0b\u5219\u5904\u4e8e<code>WAITING</code>\u72b6\u6001\u3002</p> <p>\u53c2\u8003\uff1a</p> <ul> <li>https://stackoverflow.com/questions/38818642/android-what-is-message-queue-native-poll-once-in-android</li> <li>Java Thread https://an.rustfisher.com/java/thread/thread-class-intro/</li> </ul>"},{"location":"android/handler/Handler_src_note/#looper_1","title":"Looper\u4e2d\u7684\u5c5e\u6027","text":"<p>Looper\u6301\u6709MessageQueue\uff1b\u552f\u4e00\u7684\u4e3b\u7ebf\u7a0bLooper <code>sMainLooper</code>\uff1bLooper\u5f53\u524d\u7ebf\u7a0b <code>mThread</code>\uff1b \u5b58\u50a8Looper\u7684<code>sThreadLocal</code> <pre><code>// sThreadLocal.get() will return null unless you've called prepare().\nstatic final ThreadLocal&lt;Looper&gt; sThreadLocal = new ThreadLocal&lt;Looper&gt;();\nprivate static Looper sMainLooper;  // guarded by Looper.class\n\nfinal MessageQueue mQueue; // Handler\u4f1a\u83b7\u53d6\u8fd9\u4e2a\u6d88\u606f\u961f\u5217\u5b9e\u4f8b\uff08\u53c2\u8003Handler\u6784\u9020\u5668\uff09\nfinal Thread mThread; // Looper\u5f53\u524d\u7ebf\u7a0b\n</code></pre></p> <p>ThreadLocal\u5e76\u4e0d\u662f\u7ebf\u7a0b\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u53ef\u4ee5\u5728\u6bcf\u4e2a\u7ebf\u7a0b\u4e2d\u5b58\u50a8\u6570\u636e\u3002</p>"},{"location":"android/handler/Handler_src_note/#looper_2","title":"Looper\u65b9\u6cd5","text":"<p>\u51c6\u5907\u65b9\u6cd5\uff0c\u5c06\u5f53\u524d\u7ebf\u7a0b\u521d\u59cb\u5316\u4e3aLooper\u3002\u9000\u51fa\u65f6\u8981\u8c03\u7528quit <pre><code>public static void prepare() {\n    prepare(true);\n}\n\nprivate static void prepare(boolean quitAllowed) {\n    if (sThreadLocal.get() != null) {\n        throw new RuntimeException(\"Only one Looper may be created per thread\");\n    }\n    sThreadLocal.set(new Looper(quitAllowed)); // Looper\u5b9e\u4f8b\u5b58\u5165\u4e86sThreadLocal\n}\n</code></pre></p> <p><code>prepare</code>\u65b9\u6cd5\u65b0\u5efa Looper \u5e76\u5b58\u5165 sThreadLocal <code>sThreadLocal.set(new Looper(quitAllowed))</code> </p> <p><code>ThreadLocal&lt;T&gt;</code>\u7c7b <pre><code>public void set(T value) {\n    Thread t = Thread.currentThread();\n    ThreadLocalMap map = getMap(t);\n    if (map != null)\n        map.set(this, value);\n    else\n        createMap(t, value);\n}\n\npublic T get() {\n    Thread t = Thread.currentThread();\n    ThreadLocalMap map = getMap(t);\n    if (map != null) {\n        ThreadLocalMap.Entry e = map.getEntry(this);\n        if (e != null)\n            return (T)e.value;\n    }\n    return setInitialValue();\n}\n</code></pre></p> <p>\u5f53\u8981\u83b7\u53d6Looper\u5bf9\u8c61\u65f6\uff0c\u4ece<code>sThreadLocal</code>\u83b7\u53d6 <pre><code>// \u83b7\u53d6\u4e0e\u5f53\u524d\u7ebf\u7a0b\u5173\u8054\u7684Looper\uff0c\u8fd4\u56de\u53ef\u4ee5\u4e3anull\npublic static @Nullable Looper myLooper() {\n    return sThreadLocal.get();\n}\n</code></pre></p> <p>\u5728\u5f53\u524d\u7ebf\u7a0b\u8fd0\u884c\u4e00\u4e2a\u6d88\u606f\u961f\u5217\u3002\u7ed3\u675f\u540e\u8981\u8c03\u7528\u9000\u51fa\u65b9\u6cd5<code>quit()</code> <pre><code>public static void loop()\n</code></pre></p> <p>\u51c6\u5907\u4e3b\u7ebf\u7a0bLooper\u3002Android\u73af\u5883\u4f1a\u521b\u5efa\u4e3b\u7ebf\u7a0bLooper\uff0c\u5f00\u53d1\u8005\u4e0d\u5e94\u8be5\u81ea\u5df1\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u3002 UI\u7ebf\u7a0b\uff0c\u5b83\u5c31\u662fActivityThread\uff0cActivityThread\u88ab\u521b\u5efa\u65f6\u5c31\u4f1a\u521d\u59cb\u5316Looper\uff0c\u8fd9\u4e5f\u662f\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u9ed8\u8ba4\u53ef\u4ee5\u4f7f\u7528Handler\u7684\u539f\u56e0\u3002</p> <pre><code>public static void prepareMainLooper() {\n    prepare(false); // \u8fd9\u91cc\u8868\u793a\u4e86\u4e3b\u7ebf\u7a0bLooper\u4e0d\u80fd\u7531\u5f00\u53d1\u8005\u6765\u9000\u51fa\n    synchronized (Looper.class) {\n        if (sMainLooper != null) {\n            throw new IllegalStateException(\"The main Looper has already been prepared.\");\n        }\n        sMainLooper = myLooper();\n    }\n}\n</code></pre> <p>\u83b7\u53d6\u4e3b\u7ebf\u7a0b\u7684Looper\u3002\u6211\u4eec\u5f00\u53d1\u8005\u60f3\u64cd\u4f5c\u4e3b\u7ebf\u7a0b\u65f6\uff0c\u53ef\u8c03\u7528\u6b64\u65b9\u6cd5 <pre><code>public static Looper getMainLooper()\n</code></pre></p>"},{"location":"android/handler/Handler_src_note/#threadhandler","title":"\u540c\u4e00\u4e2aThread\u7684\u4e0d\u540cHandler","text":"<p>\u4e0eUI\u7ebf\u7a0b\u5bf9\u5e94\u7684MainLooper\uff0c\u53ef\u4ee5\u5173\u8054\u591a\u4e2aHandler\u3002 \u591a\u4e2aHandler\u4e4b\u95f4\u7684\u8ba1\u5212\u4efb\u52a1\u4e0d\u4f1a\u4e92\u76f8\u5f71\u54cd\u3002\u6bd4\u5982\u67092\u4e2a\u5173\u8054\u4e86UI\u7ebf\u7a0b\u7684handler\u3002 <pre><code>Handler mMainHandler1;\nHandler mMainHandler2;\n\nprivate void initUtils() {\n    mMainHandler1 = new Handler(Looper.getMainLooper());\n    mMainHandler2 = new Handler(Looper.getMainLooper());\n    Log.d(TAG, \"mMainHandler1 post \u4efb\u52a1\");\n    mMainHandler1.postDelayed(new Runnable() {\n        @Override\n        public void run() {\n            Log.d(TAG, \"mMainHandler1\u7684\u6f14\u793a\u4efb\u52a1\u5df2\u6267\u884c rustfisher\");\n        }\n    }, 1500);\n    mMainHandler2.removeCallbacksAndMessages(null);\n}\n</code></pre> mMainHandler2\u53d6\u6d88\u5b83\u7684\u4efb\u52a1\u5e76\u4e0d\u4f1a\u5f71\u54cdmMainHandler1\u3002</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a \u7b80\u4e66</p>"},{"location":"android/handler/handler-may-leak-memory/","title":"Android Handler \u53ef\u80fd\u4f1a\u9020\u6210\u5185\u5b58\u6cc4\u9732","text":"<p>\u4f7f\u7528Handler\u65f6\uff0c\u76f4\u63a5\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61 <pre><code>private Handler handler = new Handler(){\n    @Override\n    public void handleMessage(Message msg) {\n        super.handleMessage(msg);\n        // handle something\n    }\n};\n</code></pre></p> <p>Android Studio \u5f39\u51fa\u4e86\u8b66\u544a</p> \u5f39\u51fa\u8b66\u544a <p>This Handler class should be static or leaks might occur (null)</p> <p>Since this Handler is declared as an inner class, it may prevent the outer class from being garbage collected. If the Handler is using a Looper or MessageQueue for a thread other than the main thread, then there is no issue. If the Handler is using the Looper or MessageQueue of the main thread, you need to fix your Handler declaration, as follows: Declare the Handler as a static class; In the outer class, instantiate a WeakReference to the outer class and pass this object to your Handler when you instantiate the Handler; Make all references to members of the outer class using the WeakReference object.</p> <p>\u5982\u679c\u8fd9\u4e2aHandler\u7528\u7684\u662f\u4e3b\u7ebf\u7a0b\u5916\u7684Looper\u6216\u8005\u6d88\u606f\u961f\u5217\u5c31\u6ca1\u4e8b\u3002\u82e5\u662f\u5728\u4e3b\u7ebf\u7a0b\u4e2d\uff0cHandler\u7684\u6d88\u606f\u8fd8\u5728\u961f\u5217\u4e2d\u5c1a\u672a\u88ab\u5904\u7406\uff0cGC\u6709\u53ef\u80fd\u65e0\u6cd5\u56de\u6536\u8fd9\u4e2aHandler\uff1b\u4e5f\u5c31\u65e0\u6cd5\u56de\u6536\u4f7f\u7528\u8fd9\u4e2aHandler\u7684\u5916\u90e8\u7c7b\uff08\u5982Activity\u3001Service\uff09\uff0c\u6709\u53ef\u80fd\u5f15\u8d77OOM\u3002 \u6362\u53e5\u8bdd\u8bf4\uff0c\u5f53Activity\u7ed3\u675f\u65f6\uff0c\u5ef6\u8fdf\u7684\u6d88\u606f\u8fd8\u53ef\u80fd\u5728\u6d88\u606f\u961f\u5217\u4e2d\u3002\u6d88\u606f\u5f15\u7528\u8fd9Activity\u7684Handler\uff0cHandler\u6301\u6709\u7740\u5b83\u7684\u5916\u90e8\u7c7b\uff08\u4e5f\u5c31\u662f\u8fd9\u4e2aActivity\uff09\u3002\u8fd9\u4e2a\u5f15\u7528\u4f1a\u6301\u7eed\u5230\u6d88\u606f\u88ab\u5904\u7406\uff0c\u5728\u6b64\u4e4b\u524d\u4e0d\u4f1a\u88abGC\u3002 Java\u4e2d\uff0c\u975e\u9759\u6001\u5185\u90e8\u7c7b\u548c\u533f\u540d\u7c7b\u4f1a\u5f15\u7528\u4e86\u5b83\u4eec\u7684\u5916\u90e8\u7c7b\u3002</p> <p>\u6839\u636e\u4fee\u6539\u5efa\u8bae\uff0c\u6309\u7167\u63d0\u793a\u8fdb\u884c\u4fee\u6539\uff0c\u5c06handler\u58f0\u660e\u4e3astatic\u3002 <pre><code>static class RustHandler extends Handler {\n    private final WeakReference&lt;MySwipeActivity&gt; mActivity;\n\n    RustHandler(MySwipeActivity mySwipeActivity) {\n        mActivity = new WeakReference&lt;MySwipeActivity&gt;(mySwipeActivity);\n    }\n\n    @Override\n    public void handleMessage(Message msg) {\n        MySwipeActivity activity = mActivity.get();\n        if (activity != null) {\n            // la la la la la ...\n        }\n    }\n}\n</code></pre></p> <p>\u9759\u6001\u7c7b RustHandler \u4e2d\u5b9a\u4e49\u4e00\u4e2a WeakReference\uff08\u5f31\u5f15\u7528\uff09\uff1b\u5229\u7528\u8fd9\u4e2a\u82e5\u5f15\u7528\u6765\u5b8c\u6210\u64cd\u4f5c\u3002\u8fd9\u6837\u8b66\u544a\u5c31\u6d88\u5931\u4e86\u3002</p> <p>\u53c2\u8003Android\u6e90\u7801\uff0c\u4e5f\u6709\u8fd9\u79cd\u505a\u6cd5\uff0c\u6ca1\u6709\u4f7f\u7528\u5f31\u5f15\u7528\u7684 <pre><code>static class MyHandler extends Handler {\n    MySwipeActivity handlerSwipeActivity;\n\n    MyHandler(MySwipeActivity mySwipeActivity) {\n        handlerSwipeActivity = mySwipeActivity;\n    }\n\n    @Override\n    public void handleMessage(Message msg) {\n        if (handlerSwipeActivity != null) {\n            // do something\n        }\n    }\n}\n</code></pre> \u540c\u6837\u6d88\u9664\u4e86AS\u7684\u8b66\u544a\uff1bMyHandler \u58f0\u660e\u4e3a static\uff0c\u8fbe\u5230\u4e86\u76ee\u7684</p>"},{"location":"android/handler/handler-may-leak-memory/#java","title":"Java\u4e2d\u7684\u5f15\u7528","text":"<p>java.lang.ref \u7c7b\u5e93\u5305\u542b\u4e86\u4e00\u7ec4\u7c7b\uff0c\u8fd9\u4e9b\u7c7b\u4e3a\u5783\u573e\u56de\u6536\u63d0\u4f9b\u4e86\u66f4\u5927\u7684\u7075\u6d3b\u6027\u3002 SoftReference WeakReference PhantomReference \u7531\u5f3a\u5230\u5f31\uff0c\u5bf9\u5e94\u4e0d\u540c\u7ea7\u522b\u7684\u201c\u53ef\u83b7\u5f97\u6027\u201d\uff1b\u8d8a\u5f31\u8868\u793a\u5bf9\u5783\u573e\u56de\u6536\u5668\u7684\u9650\u5236\u8d8a\u5c11\uff0c\u5bf9\u8c61\u8d8a\u5bb9\u6613\u88ab\u56de\u6536\u3002</p>"},{"location":"android/handler/handler-may-leak-memory/#android-l-handler","title":"Android L Handler","text":"<p>Handler\u53ef\u4ee5\u53d1\u9001\u548c\u8fd0\u884cMessageQueue\u76f8\u5173\u8054\u7684Message\u4e0eRunnable\u5bf9\u8c61\uff1b\u6bcf\u4e2aHandler\u5b9e\u4f8b\u4e0e\u5355\u4e2a\u7ebf\u7a0b\u53ca\u7ebf\u7a0b\u7684\u6d88\u606f\u961f\u5217\u5173\u8054</p> <p>\u521b\u5efa\u4e00\u4e2aHandler\uff0c\u5b83\u4e0e\u7ebf\u7a0b/\u6d88\u606f\u961f\u5217\u5173\u8054\uff1b\u5b83\u80fd\u5206\u53d1\u6d88\u606f\u548crunnables\u7ed9\u6d88\u606f\u961f\u5217\u5e76\u6267\u884c\u5b83\u4eec</p> <p>Handler\u76842\u4e2a\u4e3b\u8981\u7528\u6cd5\uff1a</p> <ul> <li>\u89c4\u5212messages\u548crunnables\u7684\u6267\u884c\u65f6\u673a</li> <li>\u628a\u4e00\u4e2aaction\u6392\u5230\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\uff0c\u5e76\u7531\u90a3\u4e2a\u7ebf\u7a0b\u6267\u884c</li> </ul> <p>\u89c4\u5212messages\u4f7f\u7528\u5230\uff1a post\uff0c\u53c2\u8003<code>postAtTime(Runnable, long)</code></p>"},{"location":"android/handler/handler-may-leak-memory/#_1","title":"\u53c2\u8003","text":"<p>http://stackoverflow.com/questions/11407943/this-handler-class-should-be-static-or-leaks-might-occur-incominghandler</p>"},{"location":"android/hardware/get-angle-by-sensor/","title":"Android \u83b7\u53d6\u624b\u673a\u5f53\u524d\u89d2\u5ea6","text":"\u66f4\u65b0\u65e5\u671f 2022-6-30 <ul> <li>2022-6-30 \u4fee\u6539\u683c\u5f0f</li> </ul> <p>\u6709\u4e00\u4e9bapp\u53ef\u4ee5\u5b9e\u65f6\u663e\u793a\u51fa\u624b\u673a\u5f53\u524d\u7684\u671d\u5411\u3002\u5b9e\u73b0\u4e00\u4e9b\u5f88\u6709\u8da3\u7684\u529f\u80fd\u3002\u4f8b\u5982\u6307\u5357\u9488\u3002</p> <p>\u5728\u4e00\u4e9b\u63a7\u5236\u7c7bapp\u4e2d\uff0c\u503e\u659c\u624b\u673a\u53ef\u4ee5\u63a7\u5236\u8bbe\u5907\uff08\u73a9\u5177\u8f66\uff0c\u6216\u65e0\u4eba\u673a\u4e4b\u7c7b\uff09\u7684\u65b9\u5411\u548c\u901f\u5ea6\u3002\u503e\u659c\u89d2\u5ea6\u8d8a\u5927\uff0c\u52a0\u901f\u5ea6\u8d8a\u5927\u3002</p> <p>\u4e3a\u83b7\u53d6\u624b\u673a\u5f53\u524d\u59ff\u6001\u7684\u89d2\u5ea6\uff0c\u6211\u4eec\u9700\u8981\u8c03\u7528\u52a0\u901f\u5ea6\u4f20\u611f\u5668\u548c\u5730\u78c1\u4f20\u611f\u5668\uff0c\u83b7\u53d6\u4e24\u8005\u7684\u6570\u636e\u540e\u8ba1\u7b97\u51fa\u89d2\u5ea6\u3002</p> <p>\u6d4b\u8bd5\u73af\u5883\uff1aAndroid4.4.2  Android5.1 \u6570\u503c\u8303\u56f4\u7ecf\u8fc7\u624b\u673a\uff08\u8363\u8000\uff0c\u9b45\u65cf\uff09\u5b9e\u6d4b</p>"},{"location":"android/hardware/get-angle-by-sensor/#_1","title":"\u59ff\u6001\u89d2\u5ea6\u4fe1\u606f","text":"<p>\u901a\u8fc7\u52a0\u901f\u5ea6\u4f20\u611f\u5668\u6570\u636e\u548c\u5730\u78c1\u4f20\u611f\u5668\u6570\u636e\u8ba1\u7b97\u5f97\u5230\u7684\u89d2\u5ea6\u4fe1\u606f\u5b58\u50a8\u5728\u4e00\u4e2afloat\u6570\u7ec4\u4e2d\uff0c \u6309\u987a\u5e8f\u5206\u522b\u662f<code>Azimuth</code>\uff0c<code>Pitch</code>\u548c<code>Roll</code></p> \u7c7b\u578b \u8bf4\u660e Azimuth \u56f4\u7ed5z\u8f74\u7684\u504f\u8f6c\u89d2\u5ea6\uff0c[-\u03c0,\u03c0]\uff0c\u5f53\u9762\u5411\u5357\u65b9\u65f6\uff0c\u503c\u4e3a0\u3002 Pitch \u56f4\u7ed5x\u8f74\u7684\u504f\u8f6c\u89d2\u5ea6\uff0c[-\u03c0/2,\u03c0/2]\uff0c\u624b\u673a\u6c34\u5e73\u653e\u7f6e\u65f6\u4e3a0\u3002 Roll \u56f4\u7ed5y\u8f74\u7684\u504f\u8f6c\u89d2\u5ea6\uff0c[-\u03c0,\u03c0]\uff0c\u624b\u673a\u6c34\u5e73\u653e\u7f6e\u65f6\u4e3a0\u3002"},{"location":"android/hardware/get-angle-by-sensor/#_2","title":"\u83b7\u53d6\u59ff\u6001\u89d2\u5ea6\u4fe1\u606f\u7684\u65b9\u6cd5","text":"<p>\u9700\u8981SensorManager\u548cSensor\u3002</p> <p>\u8ba1\u7b97\u7528\u5230\u7684\u65b9\u6cd5\u6709 <pre><code>SensorManager.getRotationMatrix(mRMatrix, null, mAccValues, mMagValues);\nSensorManager.getOrientation(mRMatrix, mPhoneAngleValues);\n</code></pre> <code>mRMatrix</code>\u662f\u5305\u542b9\u4e2a\u5143\u7d20\u7684\u4e00\u7ef4\u6570\u7ec4\u3002<code>SensorManager.getRotationMatrix</code>\u8ba1\u7b97\u540e\u5f97\u5230\u7684\u65cb\u8f6c\u77e9\u9635\u5b58\u5728\u5176\u4e2d\u3002</p> <p>SensorEventListener\u7528\u4e8e\u76d1\u542c\u4f20\u611f\u5668\u7684\u4e8b\u4ef6\u3002</p>"},{"location":"android/hardware/get-angle-by-sensor/#_3","title":"\u83b7\u53d6\u65cb\u8f6c\u77e9\u9635","text":"<p>\u8c03\u7528\u65b9\u6cd5 <pre><code>SensorManager.getRotationMatrix(float[] R, float[] I, float[] gravity, float[] geomagnetic)\n</code></pre></p> <ul> <li><code>R</code>\u5373\u65cb\u8f6c\u77e9\u9635\u7684\u8ba1\u7b97\u7ed3\u679c\uff0c\u4f8b\u5b50\u4e2d\u4e3a<code>mRMatrix</code></li> <li><code>I</code>\u662f\u4e00\u4e2a\u8f6c\u6362\u77e9\u9635\uff0c\u5c06\u78c1\u573a\u6570\u636e\u8f6c\u6362\u8fdb\u5b9e\u9645\u7684\u91cd\u529b\u5750\u6807\u4e2d\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u53ef\u8bbe\u4e3anull</li> <li><code>gravity</code> \u52a0\u901f\u5ea6\u4f20\u611f\u5668\u83b7\u5f97\u7684\u6570\u636e\uff0c\u901a\u8fc7<code>SensorEventListener.onSensorChanged</code>\u83b7\u53d6</li> <li><code>geomagnetic</code> \u5730\u78c1\u4f20\u611f\u5668\u83b7\u5f97\u7684\u6570\u636e\uff0c\u901a\u8fc7<code>SensorEventListener.onSensorChanged</code>\u83b7\u53d6</li> </ul>"},{"location":"android/hardware/get-angle-by-sensor/#_4","title":"\u8ba1\u7b97\u89d2\u5ea6\u6570\u636e","text":"<p>\u6700\u7ec8\u7684\u89d2\u5ea6\u6570\u636e\uff0c\u9700\u8c03\u7528<code>SensorManager.getOrientation(float[] R, float values[])</code>\u3002</p> <ul> <li><code>R</code>\u5373\u65cb\u8f6c\u77e9\u9635\uff0c\u5728\u8fd9\u91cc\u7528\u4e8e\u8ba1\u7b97</li> <li>\u6700\u7ec8\u7684\u624b\u673a\u59ff\u6001\u4fe1\u606f\uff08\u5f27\u5ea6\u503c\uff09</li> </ul> <p>\u4e3b\u8981\u4ee3\u7801 GyroActivity<pre><code>/**\n * \u7528\u4e8e\u76d1\u89c6\u9640\u87ba\u4eea\u7684\u6570\u636e\n */\npublic class GyroActivity extends Activity implements SensorEventListener {\n\n    private static final String TAG = \"rustApp\";\n\n    // UI ......\n\n    private SensorManager mSensorManager;\n    private Sensor mGyroSensor;\n    private Sensor mAccSensor;\n    private Sensor mMagSensor;\n\n    // \u52a0\u901f\u5ea6\u4f20\u611f\u5668\u6570\u636e\n    float mAccValues[] = new float[3];\n    // \u5730\u78c1\u4f20\u611f\u5668\u6570\u636e\n    float mMagValues[] = new float[3];\n    // \u65cb\u8f6c\u77e9\u9635\uff0c\u7528\u6765\u4fdd\u5b58\u78c1\u573a\u548c\u52a0\u901f\u5ea6\u7684\u6570\u636e\n    float mRMatrix[] = new float[9];\n    // \u5b58\u50a8\u65b9\u5411\u4f20\u611f\u5668\u7684\u6570\u636e\uff08\u539f\u59cb\u6570\u636e\u4e3a\u5f27\u5ea6\uff09\n    float mPhoneAngleValues[] = new float[3];\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.act_gyro);\n        initUtils();\n        initPhoneSensors();\n    }\n\n    @Override\n    protected void onDestroy() {\n        super.onDestroy();\n        EventBus.getDefault().unregister(this);\n        mSensorManager.unregisterListener(this, mGyroSensor);\n        mSensorManager.unregisterListener(this, mAccSensor);\n        mSensorManager.unregisterListener(this, mMagSensor);\n    }\n\n    @Override\n    public void onSensorChanged(SensorEvent event) {\n        switch (event.sensor.getType()) {\n            case Sensor.TYPE_ACCELEROMETER:\n                mAccXTv.setText(String.format(Locale.CHINA, \"acc x : %f\", event.values[0]));\n                mAccYTv.setText(String.format(Locale.CHINA, \"acc y : %f\", event.values[1]));\n                mAccZTv.setText(String.format(Locale.CHINA, \"acc z : %f\", event.values[2]));\n                System.arraycopy(event.values, 0, mAccValues, 0, mAccValues.length);// \u83b7\u53d6\u6570\u636e\n                break;\n            case Sensor.TYPE_GYROSCOPE:\n                mPhoneGyroXTv.setText(String.format(Locale.CHINA, \"PhoneGyro x : %f\", event.values[0]));\n                mPhoneGyroYTv.setText(String.format(Locale.CHINA, \"PhoneGyro y : %f\", event.values[1]));\n                mPhoneGyroZTv.setText(String.format(Locale.CHINA, \"PhoneGyro z : %f\", event.values[2]));\n                break;\n            case Sensor.TYPE_MAGNETIC_FIELD:\n                System.arraycopy(event.values, 0, mMagValues, 0, mMagValues.length);// \u83b7\u53d6\u6570\u636e\n                break;\n        }\n        SensorManager.getRotationMatrix(mRMatrix, null, mAccValues, mMagValues);\n        SensorManager.getOrientation(mRMatrix, mPhoneAngleValues);// \u6b64\u65f6\u83b7\u53d6\u5230\u4e86\u624b\u673a\u7684\u89d2\u5ea6\u4fe1\u606f\n        mPhoneAzTv.setText(String.format(Locale.CHINA, \"Azimuth(\u5730\u5e73\u7ecf\u5ea6): %f\", Math.toDegrees(mPhoneAngleValues[0])));\n        mPhonePitchTv.setText(String.format(Locale.CHINA, \"Pitch: %f\", Math.toDegrees(mPhoneAngleValues[1])));\n        mPhoneRollTv.setText(String.format(Locale.CHINA, \"Roll: %f\", Math.toDegrees(mPhoneAngleValues[2])));\n    }\n\n    @Override\n    public void onAccuracyChanged(Sensor sensor, int accuracy) {\n\n    }\n\n    private void initUtils() {\n        ButterKnife.bind(this);\n    }\n\n    private void initPhoneSensors() {\n        mSensorManager = (SensorManager) getSystemService(SENSOR_SERVICE);\n        List&lt;Sensor&gt; sensorList = mSensorManager.getSensorList(Sensor.TYPE_ALL);\n        for (Sensor sensor : sensorList) {\n            Log.d(TAG, String.format(Locale.CHINA, \"[Sensor] name: %s \\tvendor:%s\",\n                    sensor.getName(), sensor.getVendor()));\n        }\n        // \u83b7\u53d6\u4f20\u611f\u5668\n        mGyroSensor = mSensorManager.getDefaultSensor(Sensor.TYPE_GYROSCOPE);\n        mAccSensor = mSensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER);\n        mMagSensor = mSensorManager.getDefaultSensor(Sensor.TYPE_MAGNETIC_FIELD);\n        mSensorManager.registerListener(this, mGyroSensor, SensorManager.SENSOR_DELAY_UI);\n        mSensorManager.registerListener(this, mAccSensor, SensorManager.SENSOR_DELAY_UI);\n        mSensorManager.registerListener(this, mMagSensor, SensorManager.SENSOR_DELAY_UI);\n    }\n}\n</code></pre> \u4e00\u5f00\u59cb\u8981\u6ce8\u518c\u76d1\u542c\u5668<code>mSensorManager.registerListener</code>\u3002 \u9875\u9762\u7ed3\u675f\u65f6\u53d6\u6d88\u76d1\u542c\u5668<code>mSensorManager.unregisterListener</code>\u3002</p>"},{"location":"android/io/file/Read_write_CSV_file/","title":"\u8bfb\u5199 CSV \u6587\u4ef6","text":"<p>CSV: Comma-Separated Values \u9017\u53f7\u5206\u9694\u7684\u6587\u672c\u6587\u4ef6</p> <p>\u8bfb\u5199csv\u6587\u4ef6\u548c\u8bfb\u5199\u666e\u901a\u6587\u4ef6\u7c7b\u4f3c\uff1b\u5199\u7684\u65f6\u5019\u7ed9\u6570\u636e\u4e4b\u95f4\u6dfb\u52a0\u4e0a\u9017\u53f7\u3002</p> <p>\u8bbe\u5b9a\u5b58\u50a8\u8def\u5f84\u548c\u6587\u4ef6\u540d\uff1a <pre><code>private static final String FILE_FOLDER =\n        Environment.getExternalStorageDirectory().getAbsolutePath()\n        + File.separator + \"AboutView\" + File.separator + \"data\";\nprivate static final String FILE_CSV = \"about_data.csv\";\n</code></pre></p> <p>\u83b7\u53d6\u5e94\u7528\u5185\u7684\u5b58\u50a8\u8def\u5f84 <pre><code>    File appDir = getFilesDir();\n    if (appDir.exists()) {\n        Log.d(TAG, \"appDir.exists(): \" + appDir.exists());\n        Log.d(TAG, \"appDir.isDirectory(): \" + appDir.isDirectory());\n        Log.d(TAG, \"getFilesDir().getAbsolutePath(): \" + getFilesDir().getAbsolutePath());\n        for (File c : appDir.listFiles()) {\n            if (c.isDirectory()) {\n                Log.d(TAG, c.getAbsolutePath() + File.separator);\n            } else {\n                Log.d(TAG, c.getAbsolutePath());\n            }\n        }\n    }\n\n// appDir.exists(): true\n// appDir.isDirectory(): true\n// getFilesDir().getAbsolutePath(): /data/data/com.rustfisher.anmediacodec/files\n// /data/data/com.rustfisher.anmediacodec/files/a.log\n// /data/data/com.rustfisher.anmediacodec/files/log_folder/\n</code></pre></p>"},{"location":"android/io/file/Read_write_CSV_file/#csv_1","title":"\u5199CSV\u6587\u4ef6","text":"<p>\u5199\u6587\u672c\u6587\u4ef6\u3002\u4f7f\u7528<code>FileOutputStream</code>\u6765\u5411\u6587\u4ef6\u5c3e\u90e8\u6dfb\u52a0\u6570\u636e <code>FileOutputStream.write(byte[] data)</code>\u5411\u6587\u4ef6\u6d41\u5199\u5165\u5b57\u8282\u6570\u636e\u3002</p> <p><pre><code>class WriteData2CSVThread extends Thread {\n\n        short[] data;\n        String fileName;\n        String folder;\n        StringBuilder sb;\n\n        public WriteData2CSVThread(short[] data, String folder, String fileName) {\n            this.data = data;\n            this.folder = folder;\n            this.fileName = fileName;\n        }\n\n        private void createFolder() {\n            File fileDir = new File(folder);\n            boolean hasDir = fileDir.exists();\n            if (!hasDir) {\n                fileDir.mkdirs();// \u8fd9\u91cc\u521b\u5efa\u7684\u662f\u76ee\u5f55\n            }\n        }\n\n        @Override\n        public void run() {\n            super.run();\n            createFolder();\n            File eFile = new File(folder + File.separator + fileName);\n            if (!eFile.exists()) {\n                try {\n                    boolean newFile = eFile.createNewFile();\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n            }\n            try {\n                FileOutputStream os = new FileOutputStream(eFile, true);\n                sb = new StringBuilder();\n                for (int i = 0; i &lt; data.length; i++) {\n                    sb.append(data[i]).append(\",\");\n                }\n                sb.append(\"\\n\");\n                os.write(sb.toString().getBytes());\n                os.flush();\n                os.close();\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n        }\n    }\n</code></pre> vivo x6 plus\u5199\u542b\u67091382400\u4e2a\u5b57\u8282\u7684\u6570\u7ec4\uff0c\u7528\u4e8611\u5206\u949f\u3002\u53ef\u80fd\u662f\u673a\u5668\u8001\u5316\u7684\u7f18\u6545\u3002</p>"},{"location":"android/io/file/Read_write_CSV_file/#csv_2","title":"\u8bfbCSV\u6587\u4ef6","text":"<p>\u4f7f\u7528<code>BufferedReader</code>\u8bfb\u53d6\u6bcf\u4e00\u884c\u5185\u5bb9\uff1b\u8bfb\u51fa\u6765\u7684\u6570\u636e\u5e26\u6709\u9017\u53f7\u5206\u9694\u7b26</p> <pre><code>class ReadCSVThread extends Thread {\n\n        String fileName;\n        String folder;\n\n        public ReadCSVThread(String folder, String fileName) {\n            this.folder = folder;\n            this.fileName = fileName;\n        }\n\n        @Override\n        public void run() {\n            super.run();\n            File inFile = new File(folder + File.separator + fileName);\n            final StringBuilder cSb = new StringBuilder();\n            String inString;\n            try {\n                BufferedReader reader =\n                    new BufferedReader(new FileReader(inFile));\n                while ((inString = reader.readLine()) != null) {\n                    cSb.append(inString).append(\"\\n\");\n                }\n                reader.close();\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n            runOnUiThread(new Runnable() {\n                @Override\n                public void run() {\n                    mCSVTv.setText(cSb.toString());// \u663e\u793a\n                }\n            });\n        }\n\n    }\n</code></pre>"},{"location":"android/io/file/Read_write_Hex_file/","title":"\u8bfb\u5199\u4e8c\u8fdb\u5236\u6587\u4ef6","text":"<p>\u4ee5\u6d41\u7684\u5f62\u5f0f\u6765\u8bfb\u5199\u6587\u4ef6</p>"},{"location":"android/io/file/Read_write_Hex_file/#_2","title":"\u5199\u6587\u4ef6","text":"<p>\u4e3b\u8981\u4ee3\u7801\uff1a</p> <p><pre><code>DataOutputStream os = new DataOutputStream(new FileOutputStream(file, true));\n</code></pre> \u8fd9\u91cc\u7684true\u8868\u793a\u5728\u6587\u4ef6\u5c3e\u8ffd\u52a0\u6570\u636e\u3002 \u5199\u4e8c\u8fdb\u5236\u6587\u4ef6\u65f6\uff0c\u6587\u4ef6\u8def\u5f84\u548c\u6587\u4ef6\u540d\u5206\u5f00\u4f20\u9012\u3002\u5982\u679c\u8def\u5f84\u4e0d\u5b58\u5728\uff0c\u5219\u7528<code>mkdirs()</code>\u521b\u5efa\uff1b\u82e5 \u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u7528<code>createNewFile()</code>\u6765\u521b\u5efa\u65b0\u6587\u4ef6\u3002</p> <p><code>DataOutputStream</code>\u7684\u5199\u6570\u636e\u65b9\u6cd5\u5404\u6709\u4e0d\u540c(\u4ee5Galaxy Note4\u4e3a\u4f8b)  </p> <ul> <li> <p><code>writeByte</code> \u5199\u51651\u4e2a\u5b57\u8282</p> </li> <li> <p><code>writeInt</code> \u5199\u51654\u4e2a\u5b57\u8282 big-endian</p> </li> <li> <p><code>writeFloat</code> \u5199\u51654\u4e2a\u5b57\u8282 \u4f7f\u7528 Float \u7c7b\u4e2d\u7684 floatToIntBits \u65b9\u6cd5\u5c06 float \u53c2\u6570\u8f6c\u6362 \u4e3a\u4e00\u4e2a int \u503c\uff0c\u7136\u540e\u5c06\u8be5 int \u503c\u4ee5 4-byte \u503c\u5f62\u5f0f\u5199\u5165\u57fa\u7840\u8f93\u51fa\u6d41\u4e2d\uff0c\u5148\u5199\u5165\u9ad8\u5b57\u8282\u3002 \u5982\u679c\u6ca1\u6709\u629b\u51fa\u5f02\u5e38\uff0c\u5219\u8ba1\u6570\u5668 written \u589e\u52a0 4\u3002</p> </li> <li> <p><code>writeDouble</code> \u4f7f\u7528 Double \u7c7b\u4e2d\u7684 doubleToLongBits \u65b9\u6cd5\u5c06 double \u53c2\u6570\u8f6c\u6362\u4e3a\u4e00\u4e2a long \u503c\uff0c\u7136\u540e\u5c06\u8be5 long \u503c\u4ee5 8-byte \u503c\u5f62\u5f0f\u5199\u5165\u57fa\u7840\u8f93\u51fa\u6d41\u4e2d\uff0c\u5148\u5199\u5165\u9ad8\u5b57\u8282\u3002\u5982\u679c\u6ca1\u6709\u629b\u51fa\u5f02\u5e38\uff0c\u5219\u8ba1\u6570\u5668 written \u589e\u52a0 8\u3002</p> </li> </ul> <p>\u5176\u4ed6\u65b9\u6cd5\u53ef\u4ee5\u53c2\u89c1<code>DataOutputStream</code>\u7684API\u6587\u6863</p> <pre><code>class SaveHexFileThread extends Thread {\n    private int mmValue1;\n    private int mmValue2;\n    private int mmValue3;\n    private String mmDir;\n    private String mmName;\n    private HEX_TYPE type;\n\n    // \u6587\u4ef6\u8def\u5f84\u548c\u6587\u4ef6\u540d\u5206\u5f00\u4f20\u9001\n    public SaveHexFileThread(HEX_TYPE type, int v1, int v2, int v3,\n                             String dir, String name) {\n        this.mmValue1 = v1;\n        this.mmValue2 = v2;\n        this.mmValue3 = v3;\n        mmDir = dir;\n        mmName = name;\n        this.type = type;\n    }\n\n    public void saveData() {\n        try {\n            File file = new File(mmDir + File.separator + mmName);\n            if (!file.exists()) {\n                boolean newFile = file.createNewFile();\n                Log.d(TAG, \"\u521b\u5efa\u65b0\u6587\u4ef6 \" + file.getName() + \" \" + newFile);\n            }\n            DataOutputStream os = new DataOutputStream(new FileOutputStream(file, true));\n            switch (type) {\n                case BYTE:\n                    os.writeByte(mmValue1);\n                    os.writeByte(mmValue2);\n                    os.writeByte(mmValue3);\n                    break;\n                case INT:\n                    os.writeInt(mmValue1);\n                    os.writeInt(mmValue2);\n                    os.writeInt(mmValue3);\n                    break;\n                case FLOAT:\n                    os.writeFloat(mmValue1);\n                    os.writeFloat(mmValue2);\n                    os.writeFloat(mmValue3);\n                    break;\n                case DOUBLE:\n                    os.writeDouble(mmValue1);\n                    os.writeDouble(mmValue2);\n                    os.writeDouble(mmValue3);\n                    break;\n            }\n            os.close();\n        } catch (IOException ioe) {\n            Log.e(TAG, \"write data error \", ioe);\n        }\n    }\n\n    private void createFiles() {\n        File fileDir = new File(mmDir);\n        boolean hasDir = fileDir.exists();\n        if (!hasDir) {\n            fileDir.mkdirs();// \u8fd9\u91cc\u521b\u5efa\u7684\u662f\u76ee\u5f55\n        }\n    }\n\n    @Override\n    public void run() {\n        super.run();\n        createFiles();\n        saveData();\n        new ReadAllHexThread(mmDir).start();\n    }\n}\n</code></pre>"},{"location":"android/io/file/Read_write_Hex_file/#_3","title":"\u8bfb\u53d6\u6587\u4ef6","text":"<p>\u4ee5\u4ec0\u4e48\u5f62\u5f0f\u5199\u7684\u6587\u4ef6\uff0c\u5c31\u4ee5\u4ec0\u4e48\u5f62\u5f0f\u8bfb\u53d6\u3002\u4ee5\u514d\u5f04\u9519\u6570\u636e\u3002 \u4f7f\u7528<code>DataInputStream</code>\u6765\u8bfb\u53d6\u6570\u636e\uff0c\u62fc\u63a5\u540e\u663e\u793a\u51fa\u6765\u3002 \u5173\u952e\u4ee3\u7801\uff1a <pre><code>File file = new File(mmDir + File.separator + fileName);\ntry {\n    if (file.exists()) {\n        DataInputStream is = new DataInputStream(new FileInputStream(file));\n        int readRes = is.read(dataBuffer);\n        StringBuilder contentBuilder = new StringBuilder(type.toString());\n        contentBuilder.append(\": \\n\");\n        for (int i = 0; i &lt; readRes; i++) {\n            contentBuilder.append(Integer.toHexString(dataBuffer[i] &amp; 0xff));\n            contentBuilder.append(\", \");\n        }\n        final String finalContent = contentBuilder.toString();\n        runOnUiThread(new Runnable() {\n            @Override\n            public void run() {\n                // update UI\n            }\n        });\n    } else {\n        runOnUiThread(new Runnable() {\n            @Override\n            public void run() {\n                // update UI\n            }\n        });\n    }\n} catch (Exception e) {\n    e.printStackTrace();\n}\n</code></pre></p> <p>\u53ef\u4ee5\u628a\u4e8c\u8fdb\u5236\u6587\u4ef6\u590d\u5236\u5230\u7535\u8111\u4e0a\uff0c\u7528\u8f6f\u4ef6\uff08\u4f8b\u5982Hex Editor Neo\uff09\u6765\u67e5\u770b\u91cc\u9762\u7684\u6570\u636e\u3002</p>"},{"location":"android/io/file/read-write-json-file/","title":"\u8bfb\u5199json\u6587\u4ef6","text":"<p>\u8fd9\u91cc\u8bb2\u7684json\u662f\u6307key-value\u7c7b\u578b\u7684\u6587\u672c\u6587\u4ef6\u3002</p> <p>\u4f8b\u5982 <pre><code>{\n    \"key1\": 1,\n    \"key2\": \"Rust Fisher\"\n}\n</code></pre></p> <p>\u63a5\u4e0b\u6765\u7684\u4f8b\u5b50\u4f1a\u5206\u4e3a\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <ul> <li>\u5b9a\u4e49\u6570\u636e\u7c7b</li> <li>\u5199\u6587\u4ef6</li> <li>\u8bfb\u6587\u4ef6</li> </ul>"},{"location":"android/io/file/read-write-json-file/#_1","title":"\u5b9a\u4e49\u6570\u636e\u7c7b","text":"<p>\u4e3a\u4e86\u66f4\u76f4\u89c2\uff0c\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a\u7c7bInfo1\u6765\u5b58\u653e\u6570\u636e <pre><code>public class Info1 {\n\n    private String name;\n    private long time;\n\n    // \u6784\u9020\u5668\u548cget set\u65b9\u6cd5\u7701\u7565\n\n    @NonNull\n    @Override\n    public String toString() {\n        return name + \", \" + time;\n    }\n}\n</code></pre> \u91cd\u5199\u4e86<code>toString</code>\u65b9\u6cd5\uff0c\u6253log\u7684\u65f6\u5019\u53ef\u4ee5\u66f4\u65b9\u4fbf\u5730\u770b\u5230\u611f\u5174\u8da3\u7684\u4fe1\u606f\u3002</p> <p>\u73b0\u5728\u8fd9\u4e2a\u7c7b\u662f\u7528\u6765\u6a21\u62df\u4e1a\u52a1\u6570\u636e\u7684\u3002\u5b9e\u9645\u5de5\u7a0b\u4e2d\u53ef\u80fd\u662f\u540e\u53f0\u4f20\u56de\u7684\u5177\u4f53\u6570\u636e\u3002</p>"},{"location":"android/io/file/read-write-json-file/#_2","title":"\u5199\u6587\u4ef6","text":"<p>\u4e3a\u4e86\u66f4\u65b9\u4fbf\u64cd\u4f5cjson\uff0c\u6211\u4eec\u4f7f\u7528Google\u7684gson\u5e93\u6765\u64cd\u4f5cjson\u3002 <pre><code>dependencies {\n    implementation 'com.google.code.gson:gson:2.8.5'\n}\n</code></pre></p> <p>\u76ee\u6807\u6587\u4ef6\u5b58\u653e\u5728app\u5185\u90e8\u5b58\u50a8\u4e2d\u3002 <pre><code>mFile1Path = getFilesDir().getAbsolutePath() + File.separator + \"rwFile\"\n        + File.separator + \"jsonFile1.json\";\n</code></pre></p> <p>\u8bfb\u5199\u6587\u4ef6\u7b49io\u64cd\u4f5c\uff0c\u5e94\u8be5\u653e\u5728\u5b50\u7ebf\u7a0b\u5185\u3002\u8fd9\u91cc\u4e3a\u4e86\u6f14\u793a\u65b9\u4fbf\uff0c\u53ea\u7ed9\u51fa\u5173\u952e\u4ee3\u7801\u3002 <pre><code>private void write1(Info1 info1) {\n    Gson gson = new Gson();\n    String jsonText = gson.toJson(info1);\n    Log.d(TAG, \"write1: jsonText: \" + jsonText);\n    File file = new File(mFile1Path);\n    try {\n        if (file.exists()) {\n            boolean d1 = file.delete();\n            Log.d(TAG, \"delete old file: \" + d1);\n        }\n        File dir = file.getParentFile();\n        if (dir != null &amp;&amp; !dir.exists()) {\n            boolean m1 = dir.mkdirs();\n            Log.d(TAG, \"write1: create dir: \" + m1);\n        }\n        boolean c1 = file.createNewFile();\n        Log.d(TAG, \"create new file: \" + c1);\n        OutputStream os = new FileOutputStream(file);\n        os.write(jsonText.getBytes());\n        os.flush();\n        os.close();\n    } catch (IOException e) {\n        e.printStackTrace();\n        Log.e(TAG, \"write1: \", e);\n    }\n}\n</code></pre> \u4f7f\u7528<code>Gson.toJson</code>\u65b9\u6cd5\uff0c\u628a\u4e00\u4e2a\u5bf9\u8c61\u8f6c\u6362\u4e3ajson\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u3002 \u7136\u540e\u7528FileOutputStream\u5199\u5165\u6587\u4ef6\u4e2d\u3002</p> <p>\u6267\u884c\u8fd9\u4e2a\u65b9\u6cd5\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u7528as\u7684<code>Device File Explorer</code>\u9762\u677f\u627e\u5230\u8fd9\u4e2a\u6587\u4ef6\u3002</p> <p>\u672c\u4f8b\u4e2d\uff0c\u6587\u4ef6\u8def\u5f84\u662f<code>/data/data/com.rustfisher.tutorial2020/files/rwFile/jsonFile1.json</code></p> <p>\u7528as\u53cc\u51fb\u5b83\u53ef\u4ee5\u770b\u5230\u5185\u5bb9\u3002\u4f8b\u5982\uff1a <pre><code>{\"name\":\"RustFisher\",\"time\":1605266868256}\n</code></pre></p>"},{"location":"android/io/file/read-write-json-file/#_3","title":"\u8bfb\u6587\u4ef6","text":"<p>\u4ece\u6587\u4ef6\u4e2d\u8bfb\u51fa\u6587\u672c\uff0c\u7136\u540e\u8f6c\u6362\u4e3a\u76f8\u5e94\u7684\u5bf9\u8c61\u3002 <pre><code>private Info1 read1() {\n    File file = new File(mFile1Path);\n    if (file.exists() &amp;&amp; file.isFile()) {\n        try {\n            BufferedReader reader = new BufferedReader(new FileReader(file));\n            String inString;\n            StringBuilder sb = new StringBuilder();\n            while ((inString = reader.readLine()) != null) {\n                sb.append(inString);\n            }\n            Gson gson = new Gson();\n            return gson.fromJson(sb.toString(), Info1.class);\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    } else {\n        Log.d(TAG, \"read1: \u6587\u4ef6\u4e0d\u5b58\u5728 \" + file);\n    }\n    return null;\n}\n</code></pre> \u7528BufferedReader\u8bfb\u51fa\u6587\u4ef6\u7684\u5b57\u7b26\u4e32\u3002 \u7528<code>Gson.fromJson</code>\u65b9\u6cd5\u5c06\u5176\u8f6c\u6362\u6210\u76ee\u6807\u5bf9\u8c61\u3002</p> <p>\u5c0f\u7ed3\u4e00\u4e0b\uff1a</p> <ul> <li>\u9996\u5148\u81ea\u5b9a\u4e49\u4e00\u4e2a\u7c7b\uff0c\u7528\u6765\u6a21\u62df\u4e1a\u52a1\u6570\u636e</li> <li>\u786e\u5b9a\u6587\u4ef6\u5b58\u653e\u8def\u5f84\uff0c\u4f8b\u5982\u5b58\u653e\u5728app\u5185\u90e8\u8def\u5f84<code>Context.getFilesDir()</code></li> <li>\u5c06\u5bf9\u8c61\u8f6c\u6362\u4e3ajson\u683c\u5f0f\u5b57\u7b26\u4e32\uff0c\u4f7f\u7528<code>Gson.toJson</code>\u65b9\u6cd5</li> <li>json\u683c\u5f0f\u5b57\u7b26\u4e32\u8f6c\u4e3a\u5bf9\u8c61\uff0c\u4f7f\u7528<code>Gson.fromJson</code>\u65b9\u6cd5</li> <li>\u6587\u4ef6\u64cd\u4f5c\uff0c\u628a\u6587\u672c\u5199\u5165\u6587\u4ef6FileOutputStream</li> <li>\u8bfb\u53d6\u6587\u4ef6\u4e2d\u7684\u6587\u672c\uff0cBufferedReader</li> </ul>"},{"location":"android/io/mmap/mappedByteBuffer-use-demo1/","title":"Android MappedByteBuffer\u6587\u4ef6\u6620\u5c04\u5185\u5b58\u4f7f\u7528\u793a\u4f8b","text":"<p>\u9891\u7e41\u8bfb\u5199io\u4f1a\u9020\u6210\u6027\u80fd\u95ee\u9898\u3002\u6709\u6ca1\u6709\u53e6\u5916\u4e00\u79cd\u8bfb\u5199\u6587\u4ef6\u7684\u65b9\u5f0f\u5462\uff1f</p> <p>\u4f7f\u7528RandomAccessFile\u6765\u83b7\u53d6MappedByteBuffer\u3002</p> <pre><code>    private static void writeDemo() {\n        System.out.println(\"[writeDemo] start\");\n        String inputStr = \"This write demo. \u7ef4\u591a\u5229\u4e9a\u5973\u738b\u7eaa\u5ff5\u7891\u662f\u4f4d\u4e8e\u82f1\u56fd\u4f26\u6566\u7684\u4e00\u5ea7\u5927\u578b\u7eaa\u5ff5\u7891\u548c\u96d5\u5851\u7ec4\u5408\uff0c\u5efa\u4e8e1911\u5e74\u3002\";\n        byte[] inputBytes = inputStr.getBytes();\n        final int length = inputBytes.length;\n        try {\n            RandomAccessFile randomAccessFile = new RandomAccessFile(\"out/writeDemo.txt\", \"rw\");\n            MappedByteBuffer mappedByteBuffer = randomAccessFile.getChannel().map(FileChannel.MapMode.READ_WRITE, 0, length);\n            mappedByteBuffer.put(inputBytes);\n        } catch (Exception e) {\n            System.out.println(e.getMessage());\n            e.printStackTrace();\n        }\n        System.out.println(\"[writeDemo] end\");\n    }\n</code></pre> <pre><code>    private static void writeAppendDemo() {\n        System.out.println(\"[writeAppendDemo] start\");\n        String appendText = \"\\nThis is append text. \u7eaa\u5ff5\u7891\u7684\u57fa\u5ea7\u75312300\u5428\u6c49\u767d\u7389\u6784\u6210\u3002\";\n        byte[] bytes = appendText.getBytes();\n        final int length = bytes.length;\n        try {\n            RandomAccessFile randomAccessFile = new RandomAccessFile(\"out/writeDemo.txt\", \"rw\");\n            MappedByteBuffer mappedByteBuffer = randomAccessFile.getChannel().map(FileChannel.MapMode.READ_WRITE, randomAccessFile.length(), length);\n            mappedByteBuffer.put(bytes);\n        } catch (Exception e) {\n            System.out.println(e.getMessage());\n            e.printStackTrace();\n        }\n        System.out.println(\"[writeAppendDemo] end\");\n    }\n</code></pre> <p>Android\u4e2d\u4f7f\u7528MappedByteBuffer\u5199\u5165\u6587\u4ef6\u3002\u8bb0\u4f4f\u5f53\u524d\u5199\u6587\u4ef6\u7684\u4f4d\u7f6egCurrentLogPos\uff0c\u5904\u7406\u6587\u4ef6\u589e\u957f\u7684\u95ee\u9898\u3002</p> <pre><code>File dir = new File(logFileDir);\nif (!dir.exists()) {\n    boolean mk = dir.mkdirs();\n    Log.d(defTag, \"make dir \" + mk);\n}\nFile eFile = new File(logFileDir + File.separator + fileName);\nbyte[] strBytes = logContent.getBytes();\ntry {\n    RandomAccessFile randomAccessFile = new RandomAccessFile(eFile, \"rw\");\n    MappedByteBuffer mappedByteBuffer;\n    final int inputLen = strBytes.length;\n    if (!eFile.exists()) {\n        boolean nf = eFile.createNewFile();\n        Log.d(defTag, \"new log file \" + nf);\n        mappedByteBuffer = randomAccessFile.getChannel().map(FileChannel.MapMode.READ_WRITE, gCurrentLogPos, LOG_FILE_GROW_SIZE);\n    } else {\n        mappedByteBuffer = randomAccessFile.getChannel().map(FileChannel.MapMode.READ_WRITE, gCurrentLogPos, inputLen);\n    }\n    if (mappedByteBuffer.remaining() &lt; inputLen) {\n        mappedByteBuffer = randomAccessFile.getChannel().map(FileChannel.MapMode.READ_WRITE, gCurrentLogPos, LOG_FILE_GROW_SIZE + inputLen);\n    }\n    mappedByteBuffer.put(strBytes);\n    gCurrentLogPos += inputLen;\n} catch (Exception e) {\n    Log.e(defTag, \"WriteRunnable run: \", e);\n    if (!eFile.exists()) {\n        boolean nf = eFile.createNewFile();\n        Log.d(defTag, \"new log file \" + nf);\n    }\n    FileOutputStream os = new FileOutputStream(eFile, true);\n    os.write(logContent.getBytes());\n    os.flush();\n    os.close();\n}\n</code></pre>"},{"location":"android/io/mmap/mmap_intro_and_use/","title":"Android mmap \u6587\u4ef6\u6620\u5c04\u5230\u5185\u5b58\u4ecb\u7ecd","text":"<p>Android\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u53ef\u80fd\u9700\u8981\u8bb0\u5f55\u4e00\u4e9b\u6587\u4ef6\u3002\u4f8b\u5982\u8bb0\u5f55log\u6587\u4ef6\u3002\u5982\u679c\u4f7f\u7528\u6d41\u6765\u5199\u6587\u4ef6\uff0c\u9891\u7e41\u64cd\u4f5c\u6587\u4ef6io\u53ef\u80fd\u4f1a\u5f15\u8d77\u6027\u80fd\u95ee\u9898\u3002</p> <p>\u4e3a\u4e86\u964d\u4f4e\u5199\u6587\u4ef6\u7684\u9891\u7387\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u91c7\u7528\u7f13\u5b58\u4e00\u5b9a\u6570\u91cf\u7684log\uff0c\u518d\u4e00\u6b21\u6027\u628a\u5b83\u4eec\u5199\u5230\u6587\u4ef6\u4e2d\u3002\u5982\u679capp\u5f02\u5e38\u9000\u51fa\uff0c\u6211\u4eec\u6709\u53ef\u80fd\u4f1a\u4e22\u5931\u5185\u5b58\u4e2d\u7684log\u4fe1\u606f\u3002</p> <p>\u90a3\u4e48\u6709\u4ec0\u4e48\u6bd4\u8f83\u7a33\u59a5\u7684\u5199\u6587\u4ef6\u65b9\u5f0f\uff0c\u65e2\u80fd\u964d\u4f4eio\uff0c\u53c8\u80fd\u5c3d\u53ef\u80fd\u5730\u4fdd\u8bc1\u6570\u636e\u88ab\u5199\u5165\u6587\u4ef6\u5462\uff1f</p>"},{"location":"android/io/mmap/mmap_intro_and_use/#mmap","title":"mmap\u7b80\u4ecb","text":""},{"location":"android/io/mmap/mmap_intro_and_use/#mmap_1","title":"mmap\u6982\u5ff5","text":"<p>mmap\u662f\u4e00\u79cd\u5185\u5b58\u6620\u5c04\u6587\u4ef6\u7684\u65b9\u6cd5\uff08memory-mapped\uff09\uff0c\u5373\u5c06\u4e00\u4e2a\u6587\u4ef6\u6216\u8005\u5176\u5b83\u5bf9\u8c61\u6620\u5c04\u5230\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u5b9e\u73b0\u6587\u4ef6\u78c1\u76d8\u5730\u5740\u548c\u8fdb\u7a0b\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u4e00\u6bb5\u865a\u62df\u5730\u5740\u7684\u4e00\u4e00\u5bf9\u6620\u5173\u7cfb\u3002 </p> <p>\u7279\u70b9\uff1a\u5b9e\u73b0\u8fd9\u6837\u7684\u6620\u5c04\u5173\u7cfb\u540e\uff0c\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u91c7\u7528\u6307\u9488\u7684\u65b9\u5f0f\u8bfb\u5199\u64cd\u4f5c\u8fd9\u4e00\u6bb5\u5185\u5b58\uff0c\u800c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u56de\u5199\u810f\u9875\u9762\u5230\u5bf9\u5e94\u7684\u6587\u4ef6\u78c1\u76d8\u4e0a\uff0c\u5373\u5b8c\u6210\u4e86\u5bf9\u6587\u4ef6\u7684\u64cd\u4f5c\u800c\u4e0d\u5fc5\u518d\u8c03\u7528read,write\u7b49\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u3002\u76f8\u53cd\uff0c\u5185\u6838\u7a7a\u95f4\u5bf9\u8fd9\u6bb5\u533a\u57df\u7684\u4fee\u6539\u4e5f\u76f4\u63a5\u53cd\u6620\u7528\u6237\u7a7a\u95f4\uff0c\u4ece\u800c\u53ef\u4ee5\u5b9e\u73b0\u4e0d\u540c\u8fdb\u7a0b\u95f4\u7684\u6587\u4ef6\u5171\u4eab\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a </p> <p></p>"},{"location":"android/io/mmap/mmap_intro_and_use/#mmap_2","title":"mmap\u5185\u5b58\u6620\u5c04\u539f\u7406","text":"<p>mmap\u5185\u5b58\u6620\u5c04\u7684\u5b9e\u73b0\u8fc7\u7a0b\uff0c\u603b\u7684\u6765\u8bf4\u53ef\u4ee5\u5206\u4e3a\u4e09\u4e2a\u9636\u6bb5\uff1a</p> <p>\u5e94\u7528\u8fdb\u7a0b\u542f\u52a8\u6620\u5c04\uff0c\u5728\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\uff0c\u5bfb\u627e\u4e00\u6bb5\u7a7a\u95f2\u7684\u6ee1\u8db3\u8981\u6c42\u7684\u8fde\u7eed\u7684\u865a\u62df\u5730\u5740\u4f5c\u4e3a\u6620\u5c04\u533a\u57df\uff1b \u8c03\u7528\u7cfb\u7edf\u51fd\u6570mmap\uff0c\u5b9e\u73b0\u6587\u4ef6\u7269\u7406\u5730\u5740\u548c\u8fdb\u7a0b\u865a\u62df\u5730\u5740\u7684\u4e00\u4e00\u6620\u5c04\uff1b \u5e94\u7528\u8fdb\u7a0b\u5bf9\u6620\u5c04\u533a\u57df\u8bbf\u95ee\uff0c\u5f15\u53d1\u7f3a\u9875\u5f02\u5e38\uff0c\u5b9e\u73b0\u6587\u4ef6\u5185\u5bb9\u5230\u7269\u7406\u5185\u5b58\uff08\u4e3b\u5b58\uff09\u7684\u62f7\u8d1d\u3002</p>"},{"location":"android/io/mmap/mmap_intro_and_use/#mmap_3","title":"mmap\u4f18\u7f3a\u70b9","text":"<p>\u53ea\u6709\u4e00\u6b21\u6570\u636e\u62f7\u8d1d\uff1a\u5f53\u53d1\u751f\u7f3a\u9875\u5f02\u5e38\u65f6\uff0c\u76f4\u63a5\u5c06\u6570\u636e\u4ece\u78c1\u76d8\u62f7\u8d1d\u5230\u8fdb\u7a0b\u7684\u7528\u6237\u7a7a\u95f4\uff0c\u8df3\u8fc7\u4e86\u9875\u7f13\u5b58\u3002 \u5b9e\u73b0\u4e86\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4\u7684\u9ad8\u6548\u4ea4\u4e92\u65b9\u5f0f\uff1a\u4e24\u7a7a\u95f4\u7684\u5404\u81ea\u4fee\u6539\u64cd\u4f5c\u53ef\u4ee5\u76f4\u63a5\u53cd\u6620\u5728\u6620\u5c04\u7684\u533a\u57df\u5185\uff0c\u4ece\u800c\u88ab\u5bf9\u65b9\u7a7a\u95f4\u53ca\u65f6\u6355\u6349\u3002 \u63d0\u4f9b\u8fdb\u7a0b\u95f4\u5171\u4eab\u5185\u5b58\u53ca\u76f8\u4e92\u901a\u4fe1\u7684\u65b9\u5f0f\u3002 </p> <p>\u4e0d\u7ba1\u662f\u7236\u5b50\u8fdb\u7a0b\u8fd8\u662f\u65e0\u4eb2\u7f18\u5173\u7cfb\u7684\u8fdb\u7a0b\uff0c\u90fd\u53ef\u4ee5\u5c06\u81ea\u8eab\u7528\u6237\u7a7a\u95f4\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u6587\u4ef6\u6216\u533f\u540d\u6620\u5c04\u5230\u540c\u4e00\u7247\u533a\u57df\u3002\u4ece\u800c\u901a\u8fc7\u5404\u81ea\u5bf9\u6620\u5c04\u533a\u57df\u7684\u6539\u52a8\uff0c\u8fbe\u5230\u8fdb\u7a0b\u95f4\u901a\u4fe1\u548c\u8fdb\u7a0b\u95f4\u5171\u4eab\u7684\u76ee\u7684\u3002 </p> <p>\u540c\u65f6\uff0c\u5982\u679c\u8fdb\u7a0bA\u548c\u8fdb\u7a0bB\u90fd\u6620\u5c04\u4e86\u533a\u57dfC\uff0c\u5f53A\u7b2c\u4e00\u6b21\u8bfb\u53d6C\u65f6\u901a\u8fc7\u7f3a\u9875\u4ece\u78c1\u76d8\u590d\u5236\u6587\u4ef6\u9875\u5230\u5185\u5b58\u4e2d\uff1b\u4f46\u5f53B\u518d\u8bfbC\u7684\u76f8\u540c\u9875\u9762\u65f6\uff0c\u867d\u7136\u4e5f\u4f1a\u4ea7\u751f\u7f3a\u9875\u5f02\u5e38\uff0c\u4f46\u662f\u4e0d\u518d\u9700\u8981\u4ece\u78c1\u76d8\u4e2d\u590d\u5236\u6587\u4ef6\u8fc7\u6765\uff0c\u800c\u53ef\u76f4\u63a5\u4f7f\u7528\u5df2\u7ecf\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u7684\u6587\u4ef6\u6570\u636e\u3002</p>"},{"location":"android/io/mmap/mmap_intro_and_use/#mmap_4","title":"mmap\u6ce8\u610f\u70b9","text":"<p>\u5bf9\u4e8e\u5927\u6587\u4ef6\u800c\u8a00\uff0c\u5185\u5b58\u6620\u5c04\u6bd4\u666e\u901aIO\u6d41\u8981\u5feb\uff0c\u5c0f\u6587\u4ef6\u5219\u672a\u5fc5\uff1b \u4e0d\u8981\u7ecf\u5e38\u8c03\u7528MappedByteBuffer.force()\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5f3a\u5236\u64cd\u4f5c\u7cfb\u7edf\u5c06\u5185\u5b58\u4e2d\u7684\u5185\u5bb9\u5199\u5165\u786c\u76d8\uff0c\u6240\u4ee5\u5982\u679c\u4f60\u5728\u6bcf\u6b21\u5199\u5185\u5b58\u6620\u5c04\u6587\u4ef6\u540e\u90fd\u8c03\u7528force()\u65b9\u6cd5\uff0c\u4f60\u5c31\u4e0d\u80fd\u771f\u6b63\u4ece\u5185\u5b58\u6620\u5c04\u6587\u4ef6\u4e2d\u83b7\u76ca\uff0c\u800c\u662f\u8ddfdisk IO\u5dee\u4e0d\u591a\u3002 \u8bfb\u5199\u5185\u5b58\u6620\u5c04\u6587\u4ef6\u662f\u64cd\u4f5c\u7cfb\u7edf\u6765\u8d1f\u8d23\u7684\uff0c\u56e0\u6b64\uff0c\u5373\u4f7f\u4f60\u7684Java\u7a0b\u5e8f\u5728\u5199\u5165\u5185\u5b58\u540e\u5c31\u6302\u6389\u4e86\uff0c\u53ea\u8981\u64cd\u4f5c\u7cfb\u7edf\u5de5\u4f5c\u6b63\u5e38\uff0c\u6570\u636e\u5c31\u4f1a\u5199\u5165\u78c1\u76d8\u3002 \u5982\u679c\u7535\u6e90\u6545\u969c\u6216\u8005\u4e3b\u673a\u762b\u75ea\uff0c\u6709\u53ef\u80fd\u5185\u5b58\u6620\u5c04\u6587\u4ef6\u8fd8\u6ca1\u6709\u5199\u5165\u78c1\u76d8\uff0c\u610f\u5473\u7740\u53ef\u80fd\u4f1a\u4e22\u5931\u4e00\u4e9b\u5173\u952e\u6570\u636e\u3002</p>"},{"location":"android/io/mmap/mmap_intro_and_use/#_1","title":"\u53c2\u8003","text":"<ul> <li>https://stackoverflow.com/questions/258091/when-should-i-use-mmap-for-file-access</li> <li>https://www.jianshu.com/p/187eada7b900</li> <li>https://juejin.im/post/5c3ec9ebf265da61223a93de#heading-0</li> <li>https://stackoverflow.com/questions/30180268/android-ndk-mmap-call-broken-on-32-bit-devices-after-upgrading-to-lollipop</li> <li>https://stackoverflow.com/questions/33897711/android-mmap-fails-with-out-of-memory</li> </ul> <p>Android\u4e2d\u7684Binder\u4e5f\u5229\u7528\u7684mmap\u3002Binder\u4f20\u9012\u6570\u636e\u65f6\uff0c\u53ea\u9700\u8981\u590d\u5236\u4e00\u6b21\uff0c\u5c31\u80fd\u628a\u6570\u636e\u4f20\u9012\u5230\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u3002\u53c2\u8003Binder\u673a\u5236\u4ecb\u7ecd</p>"},{"location":"android/io/mmap/mmap_intro_and_use/#androidmmap","title":"Android\u4e2d\u4f7f\u7528mmap","text":"<p>Android\u4e2d\u4f7f\u7528mmap\uff0c\u53ef\u4ee5\u901a\u8fc7RandomAccessFile\u4e0eMappedByteBuffer\u6765\u914d\u5408\u3002\u53c2\u8003drone\u5f00\u53d1\u8bb0\u5f55 - log\u8bb0\u5f55\u5de5\u5177</p> <p>\u901a\u8fc7<code>randomAccessFile.getChannel().map</code>\u83b7\u53d6\u5230<code>MappedByteBuffer</code>\u3002\u7136\u540e\u8c03\u7528ByteBuffer\u7684put\u65b9\u6cd5\u6dfb\u52a0\u6570\u636e\u3002</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u6398\u91d1</p>"},{"location":"android/jetpack/entry/","title":"Android Jetpack","text":"\u66f4\u65b0\u65e5\u671f 2021-9-1 <ul> <li>2021-9-1 \u4fee\u6539\u683c\u5f0f</li> <li>2020-7-28 \u521b\u5efa\u6587\u6863</li> </ul> <p>Jetpack \u662f\u4e00\u4e2a\u7531\u591a\u4e2a\u5e93\u7ec4\u6210\u7684\u5957\u4ef6\uff0c\u53ef\u5e2e\u52a9\u5f00\u53d1\u8005\u9075\u5faa\u6700\u4f73\u505a\u6cd5\u3001\u51cf\u5c11\u6837\u677f\u4ee3\u7801\u5e76\u7f16\u5199\u53ef\u5728\u5404\u79cd Android \u7248\u672c\u548c\u8bbe\u5907\u4e2d\u4e00\u81f4\u8fd0\u884c\u7684\u4ee3\u7801\uff0c\u8ba9\u5f00\u53d1\u8005\u53ef\u5c06\u7cbe\u529b\u96c6\u4e2d\u4e8e\u771f\u6b63\u91cd\u8981\u7684\u7f16\u7801\u5de5\u4f5c\u3002</p> <p>\u672c\u7ad9\u63d0\u4f9b\u4e00\u4e9b\u5b9e\u7528\u6027\u7684\u6559\u7a0b\u548c\u4ee3\u7801\u793a\u4f8b\uff0c\u4ecb\u7ecdJetpack\u4e2d\u7684\u4e00\u4e9b\u5e93\u7684\u7528\u6cd5\u3002</p> \u7c7b\u522b \u4ecb\u7ecd databinding \u5f00\u59cb\u4f7f\u7528databinding\u3002\u4ecegradle\u5f15\u5165\u5e93\u5f00\u59cb\u3002 Observable\u53ef\u89c2\u5bdf\u5bf9\u8c61\u3002\u5b9e\u4f53\u7c7b\u7ee7\u627fBaseObservable\uff0c\u754c\u9762\u76d1\u542c\u5b9e\u4f53\u7c7b\u5bf9\u8c61\u5c5e\u6027\u53d8\u5316\u3002 ObservableField\u4f7f\u7528\u53ef\u89c2\u5bdf\u6570\u636e\u5bf9\u8c61\uff0c\u5b9e\u4f53\u7c7b\u4e2d\u6709\u591a\u4e2aObservableField\u5c5e\u6027 \u70b9\u51fb\u4e8b\u4ef6\uff0cvm\u4e2d\u5199\u597d\u65b9\u6cd5\uff0clayout\u4e2d\u8bbe\u7f6e\u5bf9\u70b9\u51fb\u8fdb\u884c\u54cd\u5e94\u3002 layout \u8868\u8fbe\u5f0f\u8bed\u8a00\uff0clayout\u652f\u6301\u4f7f\u7528\u7684\u4e00\u4e9b\u8868\u8fbe\u5f0f\u3002 layout data\uff0c<code>&lt;data&gt;</code>\u91cc\u5f15\u5165\u7c7b\u548c\u5bf9\u8c61 layout include\uff0c<code>&lt;include&gt;</code>\u6807\u7b7e\u53ef\u4ee5\u5b9e\u73b0\u5728\u4e00\u4e2alayout\u4e2d\u5f15\u7528\u53e6\u4e00\u4e2alayout\u7684\u5e03\u5c40\u3002 \u53cc\u5411\u6570\u636e\u7ed1\u5b9a\uff0clayout\u4e2d<code>@={}</code>\u8868\u793a\u6cd5\u63a5\u6536\u5c5e\u6027\u7684\u6570\u636e\u66f4\u6539\u5e76\u540c\u65f6\u76d1\u542c\u7528\u6237\u66f4\u65b0 BindingAdapter \u7ed1\u5b9a\u9002\u914d\u5668\uff0c\u81ea\u5b9a\u4e49\u903b\u8f91 BindingAdapter \u5bf9\u8c61\u8f6c\u6362 LiveData \u4e8b\u4ef6\u4f20\u9001 mutableLiveData\u4e8b\u4ef6\u901a\u77e5 Lifecycle\u7b80\u4ecb ViewModel \u7b80\u4ecb Activity\u4f7f\u7528ViewModel Activity Fragment \u5171\u7528vm \u6570\u636e\u5e93 \u5f00\u59cb\u4f7f\u7528Room \u5b9e\u4f53\u7c7b\u4ecb\u7ecd \u65b0\u589e\u6570\u636e \u66f4\u65b0\u6570\u636e WorkManager \u5165\u95e8\u793a\u4f8b \u4efb\u52a1\u8c03\u5ea6\u529f\u80fd\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u5de5\u4f5c\u8fdb\u884c\u6807\u8bb0\u6216\u547d\u540d\u3002 WorkManager\u5de5\u4f5c\u7ea6\u675f\uff0c\u5ef6\u8fdf\u4e0e\u67e5\u8be2\u5de5\u4f5c <p>\u793a\u4f8b\u5de5\u7a0b AndroidTutorial - gitee</p>"},{"location":"android/jetpack/camerax/image-analysis-use/","title":"Android CameraX ImageAnalysis \u83b7\u53d6\u89c6\u9891\u5e27","text":"\u66f4\u65b0\u65e5\u671f: 2022-2-7 <ul> <li>2022-2-7 \u589e\u52a0\u5927\u7eb2</li> <li>2021-12-10 \u521b\u5efa\u6587\u6863</li> </ul> <p>CameraX\u4f7f\u7528ImageAnalysis\u5206\u6790\u5668\uff0c\u53ef\u4ee5\u8bbf\u95ee\u7f13\u51b2\u533a\u4e2d\u7684\u56fe\u50cf\uff0c\u83b7\u53d6\u89c6\u9891\u5e27\u6570\u636e\u3002 \u4e3a\u4e86\u76f4\u89c2\u770b\u5230\u83b7\u53d6\u5230\u7684\u6570\u636e\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u628a\u67d0\u4e00\u5e27\u7684\u6570\u636e\u5b58\u50a8\u4e0b\u6765\u89c2\u5bdf\u3002</p> <p>\u672c\u6587\u6d89\u53ca\u5230\u7684\u6982\u5ff5</p> <p></p>"},{"location":"android/jetpack/camerax/image-analysis-use/#_1","title":"\u51c6\u5907\u5de5\u4f5c","text":"<p>\u51c6\u5907\u5de5\u4f5c\u5305\u62ecgradle\uff0clayout\uff0c\u52a8\u6001\u7533\u8bf7\u76f8\u673a\u6743\u9650\uff0c\u5916\u90e8\u5b58\u50a8\u6743\u9650\u7b49\u7b49\uff0c\u5927\u90e8\u5206\u8bbe\u7f6e\u4e0eCameraX \u6253\u5f00\u6444\u50cf\u5934\u9884\u89c8\u76f8\u540c\u3002</p>"},{"location":"android/jetpack/camerax/image-analysis-use/#gradle","title":"gradle","text":"<p>\u4e00\u4e9b\u5173\u952e\u914d\u7f6e</p> gradle <pre><code>apply plugin: 'com.android.application'\napply plugin: 'kotlin-android'\napply plugin: 'kotlin-android-extensions'\napply plugin: 'kotlin-kapt'\n\nandroid {\n    compileSdkVersion 31\n    buildToolsVersion \"31.0.0\"\n    defaultConfig {\n        applicationId \"com.rustfisher.tutorial2020\"\n        minSdkVersion 21\n        targetSdkVersion 31\n    }\n    buildFeatures {\n        compose true\n        dataBinding true\n        viewBinding true\n    }\n\n    dataBinding {\n        enabled = true\n    }\n\n    kotlinOptions {\n        jvmTarget = \"1.8\"\n    }\n\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n    composeOptions {\n        kotlinCompilerExtensionVersion '1.0.1'\n    }\n}\n\ndependencies {\n    kapt \"com.android.databinding:compiler:3.0.1\"\n    // \u5176\u4ed6\u4f9d\u8d56...\n\n    implementation \"androidx.camera:camera-core:1.1.0-alpha11\"\n    implementation \"androidx.camera:camera-camera2:1.1.0-alpha11\"\n    implementation \"androidx.camera:camera-lifecycle:1.1.0-alpha11\"\n    implementation \"androidx.camera:camera-view:1.0.0-alpha31\"\n    implementation \"androidx.camera:camera-extensions:1.0.0-alpha31\"\n}\n</code></pre>"},{"location":"android/jetpack/camerax/image-analysis-use/#layout","title":"layout","text":"act_simple_preivew_x.xml <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout&gt;\n\n    &lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"&gt;\n\n        &lt;FrameLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n            android:id=\"@+id/container\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\"&gt;\n\n            &lt;androidx.camera.view.PreviewView\n                android:id=\"@+id/previewView\"\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"match_parent\" /&gt;\n        &lt;/FrameLayout&gt;\n\n        &lt;LinearLayout\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:layout_alignParentBottom=\"true\"\n            android:gravity=\"center\"\n            android:orientation=\"vertical\"\n            android:padding=\"4dp\"&gt;\n\n            &lt;LinearLayout\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"wrap_content\"\n                android:orientation=\"horizontal\"&gt;\n\n                &lt;Button\n                    android:id=\"@+id/start\"\n                    style=\"@style/NormalBtn\"\n                    android:layout_width=\"wrap_content\"\n                    android:layout_height=\"wrap_content\"\n                    android:text=\"\u6253\u5f00\u6444\u50cf\u5934\" /&gt;\n\n                &lt;Button\n                    android:id=\"@+id/end\"\n                    style=\"@style/NormalBtn\"\n                    android:layout_width=\"wrap_content\"\n                    android:layout_height=\"wrap_content\"\n                    android:layout_marginStart=\"4dp\"\n                    android:text=\"\u505c\u6b62\u6444\u50cf\u5934\" /&gt;\n\n            &lt;/LinearLayout&gt;\n\n            &lt;LinearLayout\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"wrap_content\"\n                android:layout_marginTop=\"4dp\"\n                android:orientation=\"horizontal\"&gt;\n\n                &lt;Button\n                    android:id=\"@+id/enable_ana\"\n                    style=\"@style/NormalBtn\"\n                    android:layout_width=\"wrap_content\"\n                    android:layout_height=\"wrap_content\"\n                    android:text=\"setAnalyzer\" /&gt;\n\n                &lt;Button\n                    android:id=\"@+id/clr_ana\"\n                    style=\"@style/NormalBtn\"\n                    android:layout_width=\"wrap_content\"\n                    android:layout_height=\"wrap_content\"\n                    android:layout_marginStart=\"4dp\"\n                    android:text=\"clearAnalyzer\" /&gt;\n\n\n                &lt;Button\n                    android:id=\"@+id/take_one_analyse\"\n                    style=\"@style/NormalBtn\"\n                    android:layout_width=\"wrap_content\"\n                    android:layout_height=\"wrap_content\"\n                    android:layout_marginStart=\"4dp\"\n                    android:text=\"\u622a\u53d6\" /&gt;\n\n            &lt;/LinearLayout&gt;\n        &lt;/LinearLayout&gt;\n\n    &lt;/RelativeLayout&gt;\n&lt;/layout&gt;\n</code></pre>"},{"location":"android/jetpack/camerax/image-analysis-use/#imageanalysis","title":"ImageAnalysis\u83b7\u53d6\u89c6\u9891\u5e27\u5e76\u4fdd\u5b58\u5230\u672c\u5730","text":"<p><code>androidx.camera.core.ImageAnalysis</code></p>"},{"location":"android/jetpack/camerax/image-analysis-use/#_2","title":"\u8bbe\u7f6e\u5206\u6790\u5668","text":"<p>\u5148\u770b\u7b80\u5355\u7684\u793a\u4f8b\uff0c\u5728<code>SimplePreviewXAct.java</code>\u4e2d\u4f7f\u7528ImageAnalysis <pre><code>private boolean mTakeOneYuv = false; // \u83b7\u53d6\u4e00\u5e27 \u5b9e\u9645\u5de5\u7a0b\u4e2d\u4e0d\u8981\u8fd9\u4e48\u505a\n\nprivate final ImageAnalysis mImageAnalysis =\n        new ImageAnalysis.Builder()\n                //.setOutputImageFormat(ImageAnalysis.OUTPUT_IMAGE_FORMAT_RGBA_8888)\n                .setTargetResolution(new Size(720, 1280)) // \u56fe\u7247\u7684\u5efa\u8bae\u5c3a\u5bf8\n                .setOutputImageRotationEnabled(true) // \u662f\u5426\u65cb\u8f6c\u5206\u6790\u5668\u4e2d\u5f97\u5230\u7684\u56fe\u7247\n                .setTargetRotation(Surface.ROTATION_0) // \u5141\u8bb8\u65cb\u8f6c\u540e \u5f97\u5230\u56fe\u7247\u7684\u65cb\u8f6c\u8bbe\u7f6e\n                .setBackpressureStrategy(ImageAnalysis.STRATEGY_KEEP_ONLY_LATEST)\n                .build();\n</code></pre> \u6ce8\u610f\u8fd9\u91cc\u7684<code>setOutputImageRotationEnabled(true)</code>\uff0c\u542f\u7528\u4e86\u65cb\u8f6c\u540e\uff0c\u5206\u6790\u5668\u4f1a\u591a\u82b1\u8d39\u4e00\u4e9b\u65f6\u95f4\uff08\u6beb\u79d2\u7ea7\uff09\u3002 \u542f\u7528\u9009\u62e9\uff0c<code>setTargetRotation</code>\u624d\u6709\u610f\u4e49\u3002</p> <p>\u5728<code>onCreate</code>\u65b9\u6cd5\u91cc\u8bbe\u7f6e<code>setAnalyzer</code> <pre><code>// SimplePreviewXAct onCreate\nfinal ExecutorService executorService = Executors.newFixedThreadPool(2);\nmBinding.enableAna.setOnClickListener(v -&gt; {\n    Toast.makeText(getApplicationContext(), \"\u542f\u7528\u5206\u6790\u5668\", Toast.LENGTH_SHORT).show();\n    mImageAnalysis.setAnalyzer(executorService, imageProxy -&gt; {\n        // \u4e0b\u9762\u5904\u7406\u6570\u636e\n        if (mTakeOneYuv) {\n            mTakeOneYuv = false;\n            Log.d(TAG, \"\u65cb\u8f6c\u89d2\u5ea6: \" + imageProxy.getImageInfo().getRotationDegrees());\n            ImgHelper.useYuvImgSaveFile(imageProxy,  true); // \u5b58\u50a8\u8fd9\u4e00\u5e27\u4e3a\u6587\u4ef6\n            runOnUiThread(() -&gt; Toast.makeText(getApplicationContext(), \"\u622a\u53d6\u4e00\u5e27\", Toast.LENGTH_SHORT).show());\n        }\n        imageProxy.close(); // \u6700\u540e\u8981\u5173\u95ed\u8fd9\u4e2a\n    });\n});\n</code></pre> \u4e3a\u4e86\u66f4\u76f4\u89c2\u7684\u770b\u5230\u5206\u6790\u5668\u4e2d\u7684\u56fe\u7247\uff0c\u6211\u4eec\u60f3\u529e\u6cd5\u628a\u56fe\u7247\u6570\u636e\u4fdd\u5b58\u4e86\u4e0b\u6765\u3002</p> <p>\u7ed1\u5b9a\u751f\u547d\u5468\u671f\uff08\u542f\u52a8\u76f8\u673a\uff09\u7684\u65f6\u5019\uff0c\u628a<code>mImageAnalysis</code>\u4f20\u8fdb\u53bb <pre><code>cameraProvider.bindToLifecycle(this, cameraSelector, preview, mImageAnalysis);\n</code></pre></p> <p>\u76f8\u673a\u8fd0\u884c\u8d77\u6765\uff0c\u5206\u6790\u5668\u4e2d\u53ef\u4ee5\u5f97\u5230\u5e27\u6570\u636e\u3002ImgHelper\u4ee3\u7801\u548cSimplePreviewXAct\u5982\u4e0b\u6587\u3002</p>"},{"location":"android/jetpack/camerax/image-analysis-use/#imghelperjava","title":"ImgHelper.java","text":"<p>\u65b0\u5efa\u4e00\u4e2a\u5de5\u5177\u7c7b\u6765\u5904\u7406\u56fe\u7247\u683c\u5f0f\u95ee\u9898\u3002</p> ImgHelper.java <pre><code>import android.graphics.ImageFormat;\nimport android.graphics.Rect;\nimport android.graphics.YuvImage;\nimport android.os.Environment;\nimport android.util.Log;\n\nimport androidx.camera.core.ImageProxy;\n\nimport java.io.File;\nimport java.io.FileOutputStream;\nimport java.nio.ByteBuffer;\n\npublic class ImgHelper {\n    public static String TAG = \"rfDevImg\";\n\n    // \u83b7\u53d6\u5230YuvImage\u5bf9\u8c61 \u7136\u540e\u5b58\u6587\u4ef6\n    public static void useYuvImgSaveFile(ImageProxy imageProxy, boolean outputYOnly) {\n        final int wid = imageProxy.getWidth();\n        final int height = imageProxy.getHeight();\n        Log.d(TAG, \"\u5bbd\u9ad8: \" + wid + \", \" + height);\n\n        YuvImage yuvImage = ImgHelper.toYuvImage(imageProxy);\n        File file = new File(Environment.getExternalStorageDirectory(), \"z_\" + System.currentTimeMillis() + \".png\");\n        saveYuvToFile(file, wid, height, yuvImage);\n        Log.d(TAG, \"rustfisher.com \u5b58\u50a8\u4e86\" + file);\n\n        if (outputYOnly) { // \u4ec5\u4ec5\u4f5c\u4e3a\u529f\u80fd\u6f14\u793a\n            YuvImage yImg = ImgHelper.toYOnlyYuvImage(imageProxy);\n            File yFile = new File(Environment.getExternalStorageDirectory(), \"y_\" + System.currentTimeMillis() + \".png\");\n            saveYuvToFile(yFile, wid, height, yImg);\n            Log.d(TAG, \"rustfisher.com \u5b58\u50a8\u4e86\" + yFile);\n        }\n    }\n\n    // \u4ec5\u4f5c\u4e3a\u793a\u4f8b\u4f7f\u7528\n    public static YuvImage toYOnlyYuvImage(ImageProxy imageProxy) {\n        if (imageProxy.getFormat() != ImageFormat.YUV_420_888) {\n            throw new IllegalArgumentException(\"Invalid image format\");\n        }\n        int width = imageProxy.getWidth();\n        int height = imageProxy.getHeight();\n        ByteBuffer yBuffer = imageProxy.getPlanes()[0].getBuffer();\n        int numPixels = (int) (width * height * 1.5f);\n        byte[] nv21 = new byte[numPixels];\n        int index = 0;\n        int yRowStride = imageProxy.getPlanes()[0].getRowStride();\n        int yPixelStride = imageProxy.getPlanes()[0].getPixelStride();\n        for (int y = 0; y &lt; height; ++y) {\n            for (int x = 0; x &lt; width; ++x) {\n                nv21[index++] = yBuffer.get(y * yRowStride + x * yPixelStride);\n            }\n        }\n        return new YuvImage(nv21, ImageFormat.NV21, width, height, null);\n    }\n\n    public static YuvImage toYuvImage(ImageProxy image) {\n        if (image.getFormat() != ImageFormat.YUV_420_888) {\n            throw new IllegalArgumentException(\"Invalid image format\");\n        }\n        int width = image.getWidth();\n        int height = image.getHeight();\n\n        // \u62ff\u5230YUV\u6570\u636e\n        ByteBuffer yBuffer = image.getPlanes()[0].getBuffer();\n        ByteBuffer uBuffer = image.getPlanes()[1].getBuffer();\n        ByteBuffer vBuffer = image.getPlanes()[2].getBuffer();\n\n        int numPixels = (int) (width * height * 1.5f);\n        byte[] nv21 = new byte[numPixels]; // \u8f6c\u6362\u540e\u7684\u6570\u636e\n        int index = 0;\n\n        // \u590d\u5236Y\u7684\u6570\u636e\n        int yRowStride = image.getPlanes()[0].getRowStride();\n        int yPixelStride = image.getPlanes()[0].getPixelStride();\n        for (int y = 0; y &lt; height; ++y) {\n            for (int x = 0; x &lt; width; ++x) {\n                nv21[index++] = yBuffer.get(y * yRowStride + x * yPixelStride);\n            }\n        }\n\n        // \u590d\u5236U/V\u6570\u636e\n        int uvRowStride = image.getPlanes()[1].getRowStride();\n        int uvPixelStride = image.getPlanes()[1].getPixelStride();\n        int uvWidth = width / 2;\n        int uvHeight = height / 2;\n\n        for (int y = 0; y &lt; uvHeight; ++y) {\n            for (int x = 0; x &lt; uvWidth; ++x) {\n                int bufferIndex = (y * uvRowStride) + (x * uvPixelStride);\n                nv21[index++] = vBuffer.get(bufferIndex);\n                nv21[index++] = uBuffer.get(bufferIndex);\n            }\n        }\n        return new YuvImage(nv21, ImageFormat.NV21, width, height, null);\n    }\n\n    public static void saveYuvToFile(File file, int wid, int height, YuvImage yuvImage) {\n        try {\n            boolean c = file.createNewFile();\n            Log.d(TAG, file + \" created: \" + c);\n            FileOutputStream fos = new FileOutputStream(file);\n            yuvImage.compressToJpeg(new Rect(0, 0, wid, height), 100, fos);\n            fos.close();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>"},{"location":"android/jetpack/camerax/image-analysis-use/#simplepreviewxactjava","title":"SimplePreviewXAct.java","text":"<p>\u5b8c\u6574\u7684<code>SimplePreviewXAct.java</code>\u4ee3\u7801\u5982\u4e0b</p> SimplePreviewXAct.java <pre><code>import android.os.Bundle;\nimport android.util.Log;\nimport android.util.Size;\nimport android.view.Surface;\nimport android.widget.Toast;\n\nimport androidx.annotation.Nullable;\nimport androidx.appcompat.app.AppCompatActivity;\nimport androidx.camera.core.CameraSelector;\nimport androidx.camera.core.ImageAnalysis;\nimport androidx.camera.core.Preview;\nimport androidx.camera.lifecycle.ProcessCameraProvider;\nimport androidx.core.content.ContextCompat;\nimport androidx.databinding.DataBindingUtil;\n\nimport com.google.common.util.concurrent.ListenableFuture;\nimport com.rustfisher.tutorial2020.R;\nimport com.rustfisher.tutorial2020.databinding.ActSimplePreivewXBinding;\n\nimport java.util.concurrent.ExecutionException;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\n\n\n/**\n* @author an.rustfisher.com\n* @date 2021-12-09 19:53\n*/\npublic class SimplePreviewXAct extends AppCompatActivity {\n    private static final String TAG = \"rfDevX\";\n    private ActSimplePreivewXBinding mBinding;\n    private ListenableFuture&lt;ProcessCameraProvider&gt; mCameraProviderFuture;\n    private ProcessCameraProvider mCameraProvider;\n    private boolean mRunning = false;\n\n    private boolean mTakeOneYuv = false; // \u83b7\u53d6\u4e00\u5e27 \u5b9e\u9645\u5de5\u7a0b\u4e2d\u4e0d\u8981\u8fd9\u4e48\u505a\n\n    private final ImageAnalysis mImageAnalysis =\n            new ImageAnalysis.Builder()\n                    //.setOutputImageFormat(ImageAnalysis.OUTPUT_IMAGE_FORMAT_RGBA_8888)\n                    .setTargetResolution(new Size(720, 1280)) // \u56fe\u7247\u7684\u5efa\u8bae\u5c3a\u5bf8\n                    .setOutputImageRotationEnabled(true) // \u662f\u5426\u65cb\u8f6c\u5206\u6790\u5668\u4e2d\u5f97\u5230\u7684\u56fe\u7247\n                    .setTargetRotation(Surface.ROTATION_0) // \u5141\u8bb8\u65cb\u8f6c\u540e \u5f97\u5230\u56fe\u7247\u7684\u65cb\u8f6c\u8bbe\u7f6e\n                    .setBackpressureStrategy(ImageAnalysis.STRATEGY_KEEP_ONLY_LATEST)\n                    .build();\n\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        mBinding = DataBindingUtil.setContentView(this, R.layout.act_simple_preivew_x);\n        mCameraProviderFuture = ProcessCameraProvider.getInstance(this);\n        mCameraProviderFuture.addListener(() -&gt; {\n            try {\n                mCameraProvider = mCameraProviderFuture.get();\n                Log.d(TAG, \"\u83b7\u53d6\u5230\u4e86 cameraProvider\");\n                bindPreview(mCameraProvider);\n            } catch (ExecutionException | InterruptedException e) {\n                // \u8fd9\u91cc\u4e0d\u7528\u5904\u7406\n            }\n        }, ContextCompat.getMainExecutor(this));\n        mBinding.start.setOnClickListener(v -&gt; {\n            if (mCameraProvider != null &amp;&amp; !mRunning) {\n                bindPreview(mCameraProvider);\n            }\n        });\n        mBinding.end.setOnClickListener(v -&gt; {\n            mCameraProvider.unbindAll();\n            mRunning = false;\n        });\n\n        mBinding.takeOneAnalyse.setOnClickListener(v -&gt; {\n            mTakeOneYuv = true;\n            Log.d(TAG, \"\u83b7\u53d6\u4e00\u5e27, \u8f93\u51fa\u56fe\u7247\u65cb\u8f6c: \" + mImageAnalysis.isOutputImageRotationEnabled());\n        });\n\n        final ExecutorService executorService = Executors.newFixedThreadPool(2);\n        mBinding.enableAna.setOnClickListener(v -&gt; {\n            Toast.makeText(getApplicationContext(), \"\u542f\u7528\u5206\u6790\u5668\", Toast.LENGTH_SHORT).show();\n            mImageAnalysis.setAnalyzer(executorService, imageProxy -&gt; {\n                // \u4e0b\u9762\u5904\u7406\u6570\u636e\n                if (mTakeOneYuv) {\n                    mTakeOneYuv = false;\n                    Log.d(TAG, \"\u65cb\u8f6c\u89d2\u5ea6: \" + imageProxy.getImageInfo().getRotationDegrees());\n                    ImgHelper.useYuvImgSaveFile(imageProxy,  true); // \u5b58\u50a8\u8fd9\u4e00\u5e27\u4e3a\u6587\u4ef6\n                    runOnUiThread(() -&gt; Toast.makeText(getApplicationContext(), \"\u622a\u53d6\u4e00\u5e27\", Toast.LENGTH_SHORT).show());\n                }\n                imageProxy.close(); // \u6700\u540e\u8981\u5173\u95ed\u8fd9\u4e2a\n            });\n        });\n        mBinding.clrAna.setOnClickListener(v -&gt; {\n            mImageAnalysis.clearAnalyzer();\n            Toast.makeText(getApplicationContext(), \"clearAnalyzer\", Toast.LENGTH_SHORT).show();\n        });\n    }\n\n    private void bindPreview(ProcessCameraProvider cameraProvider) {\n        if (cameraProvider == null) {\n            Toast.makeText(getApplicationContext(), \"\u6ca1\u83b7\u53d6\u5230\u76f8\u673a\", Toast.LENGTH_SHORT).show();\n            return;\n        }\n        Toast.makeText(getApplicationContext(), \"\u76f8\u673a\u542f\u52a8\", Toast.LENGTH_SHORT).show();\n        Preview preview = new Preview.Builder().build();\n\n        CameraSelector cameraSelector = new CameraSelector.Builder()\n                .requireLensFacing(CameraSelector.LENS_FACING_BACK)\n                .build();\n\n        preview.setSurfaceProvider(mBinding.previewView.getSurfaceProvider());\n\n        cameraProvider.bindToLifecycle(this, cameraSelector, preview, mImageAnalysis);\n        mRunning = true;\n    }\n\n}\n</code></pre>"},{"location":"android/jetpack/camerax/image-analysis-use/#_3","title":"\u8fd0\u884c\u7ed3\u679c","text":"<p>\u5728\u7ea2\u7c739\u4e0a\u8fd0\u884c\uff0c\u622a\u53d6\u5230\u7684\u56fe\u7247\uff08\u6548\u679c\u793a\u610f\u56fe\uff09</p> \u8fd0\u884c\u6548\u679c \u6b63\u5e38\u56fe\u7247 \u53ea\u6709Y\u5e73\u9762\uff08\u4ec5\u4f5c\u4e3a\u53c2\u8003\uff09"},{"location":"android/jetpack/camerax/image-analysis-use/#_4","title":"\u53d6\u6d88\u5206\u6790\u5668","text":"<pre><code>mImageAnalysis.clearAnalyzer();\n</code></pre>"},{"location":"android/jetpack/camerax/image-analysis-use/#imageanalysis_1","title":"ImageAnalysis\u76f8\u5173","text":"<p>\u901a\u8fc7\u4e0a\u9762\u7684\u793a\u4f8b\uff0c\u6211\u4eec\u638c\u63e1\u4e86ImageAnalysis\u7b80\u5355\u7684\u7528\u6cd5\u3002</p>"},{"location":"android/jetpack/camerax/image-analysis-use/#executors","title":"Executors","text":"<p><code>setAnalyzer</code>\u6211\u4eec\u4f7f\u7528\u7684\u662f<code>java.util.concurrent.Executors</code>\u3002\u4e0a\u9762\u7684\u4f8b\u5b50\u4f20\u5165\u4e86\u4e00\u4e2a\u5b9a\u957f\u7684\u7ebf\u7a0b\u6c60\u3002</p> <p>\u5904\u7406\u56fe\u7247\u7684\u65b9\u6cd5\u4f1a\u8fd0\u884c\u5728\u7ebf\u7a0b\u6c60\u7684\u7ebf\u7a0b\u91cc\u3002\u5f53\u7136\u8fd9\u91cc\u6362\u5176\u4ed6\u7c7b\u578b\u7ebf\u7a0b\u6c60\u4e5f\u53ef\u4ee5\u3002\u4e5f\u53ef\u4ee5\u7528\u4e3b\u7ebf\u7a0b<code>ContextCompat.getMainExecutor(getApplicationContext());</code>\u3002</p>"},{"location":"android/jetpack/camerax/image-analysis-use/#androidxcameracoreimageproxy","title":"androidx.camera.core.ImageProxy","text":"<p>\u5c01\u88c5\u4e86android.media.Image</p>"},{"location":"android/jetpack/camerax/image-analysis-use/#imageanalysisbuilder","title":"ImageAnalysis.Builder","text":"<p>\u7528\u6765\u521b\u5efaImageAnalysis</p> <p>\u9ed8\u8ba4\u8f93\u51fa\u56fe\u7247\u683c\u5f0f\u662f<code>OUTPUT_IMAGE_FORMAT_YUV_420_888</code>\uff0c\u672c\u6587\u793a\u4f8b\u4e2d\u6211\u4eec\u4f7f\u7528\u7684\u662f\u9ed8\u8ba4\u683c\u5f0f\u3002</p>"},{"location":"android/jetpack/camerax/image-analysis-use/#settargetresolution","title":"setTargetResolution","text":"<p>\u793a\u4f8b\u4e2d<code>setTargetResolution(new Size(720, 1280))</code>\u3002\u6211\u4eec\u7528\u7684\u662f\u7ad6\u5c4f\uff0c\u8bbe\u7f6e\u6210\u4e86\u5bbd\u5ea6\u5c0f\u4e8e\u9ad8\u5ea6\u3002</p> <p>\u53ef\u4ee5\u628a\u4f20\u5165\u7684\u53eb\u505a\u201c\u76ee\u6807\u5c3a\u5bf8\u201d\u3002\u6700\u7ec8\u56fe\u7247\u4f1a\u627e\u4e00\u4e2a\u6700\u63a5\u8fd1\u7684\u5c3a\u5bf8\u3002\u5177\u4f53\u7531\u6444\u50cf\u5934\u6765\u51b3\u5b9a\u3002</p> <p>\u6bd4\u5982\u628a\u793a\u4f8b\u91cc\u7684\u8bbe\u7f6e\u6539\u6210<code>setTargetResolution(new Size(1280, 720))</code>\uff0c\u6700\u7ec8\u8f93\u51fa\u7684\u56fe\u7247\u5927\u5c0f\u53ef\u80fd\u662f720x720</p> <p><code>setTargetResolution</code>\u548c<code>setTargetAspectRatio</code>\u53ea\u80fd\u4e8c\u9009\u4e00</p>"},{"location":"android/jetpack/camerax/image-analysis-use/#imageanalysisbuildersetoutputimagerotationenabled","title":"ImageAnalysis.Builder.setOutputImageRotationEnabled","text":"<p><code>setOutputImageRotationEnabled(boolean)</code>\u662f\u5426\u542f\u7528\u8f93\u51fa\u56fe\u7247\u7684\u65cb\u8f6c\u529f\u80fd\u3002\u6ce8\u610f\u8fd9\u662fImageAnalysis.Builder\u7684\u65b9\u6cd5\u3002</p> <p>\u6b64\u529f\u80fd\u9ed8\u8ba4\u5173\u95ed</p> <p>\u8f93\u51fa\u7684\u56fe\u7247\u53ef\u4ee5\u7528<code>ImageInfo.getRotationDegrees()</code>\u83b7\u5f97\u65cb\u8f6c\u7684\u89d2\u5ea6\u3002</p> <p>\u542f\u7528\u540e\uff0c\u5206\u6790\u5668\u4f1a\u65cb\u8f6c\u6bcf\u4e00\u5f20\u56fe\u7247\u3002\u76f8\u5bf9\u800c\u8a00\u4f1a\u591a\u8017\u8d39\u6027\u80fd\u3002</p> <p>\u5bf9\u4e8e640x480\u56fe\u7247\u6765\u8bf4\uff0c\u4e2d\u7b49\u6027\u80fd\u7684\u8bbe\u5907\u5927\u7ea6\u4f1a\u591a\u8017\u8d3910-15ms\u3002</p>"},{"location":"android/jetpack/camerax/image-analysis-use/#settargetrotation","title":"setTargetRotation","text":"<p><code>setOutputImageRotationEnabled(true)</code>\u542f\u7528\u65cb\u8f6c\u540e\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u8f93\u51fa\u56fe\u7247\u7684\u65cb\u8f6c\u89d2\u5ea6\u3002</p> <p><code>setTargetRotation(int)</code>\u63a5\u53d7\u7684\u53c2\u6570\u662f<code>Surface.ROTATION_0, Surface.ROTATION_90, Surface.ROTATION_180, Surface.ROTATION_270</code></p> <p>\u4e0a\u9762\u7684\u793a\u4f8b\u7528\u7684\u662f<code>Surface.ROTATION_0</code></p>"},{"location":"android/jetpack/camerax/image-analysis-use/#setbackpressurestrategy","title":"setBackpressureStrategy","text":"<p>\u5f53\u56fe\u7247\u4ea7\u751f\u7684\u901f\u5ea6\u5927\u4e8e\u56fe\u7247\u5206\u6790\u7684\u901f\u5ea6\u65f6\uff0c\u5206\u6790\u5668\u4f1a\u91c7\u7528\u7684\u5e94\u5bf9\u7b56\u7565\u3002Android\u79f0\u4e4b\u4e3a\u80cc\u538b\u7b56\u7565\u3002</p> <p>\u53ef\u9009\u503c\u5982\u4e0b</p>"},{"location":"android/jetpack/camerax/image-analysis-use/#strategy_keep_only_latest","title":"<code>STRATEGY_KEEP_ONLY_LATEST</code> \uff08\u9ed8\u8ba4\uff09","text":"<p>\u4f7f\u7528\u6700\u65b0\u7684\u56fe\u7247</p>"},{"location":"android/jetpack/camerax/image-analysis-use/#strategy_block_producer","title":"<code>STRATEGY_BLOCK_PRODUCER</code>","text":"<p>\u963b\u6b62\u4ea7\u751f\u65b0\u7684\u56fe\u7247\u3002 \u5f53\u4ea7\u751f\u7684\u56fe\u7247\u8d85\u8fc7\u961f\u5217\u6df1\u5ea6\u65f6\uff0c\u751f\u4ea7\u8005\uff08producer\uff09\u4f1a\u505c\u6b62\u751f\u4ea7\u56fe\u7247\u3002 \u5982\u679c\u4e0a\u4e00\u5f20\u56fe\u7247\u6ca1\u6709\u8c03\u7528<code>ImageProxy.close()</code>\uff0c\u751f\u4ea7\u51fa\u6765\u7684\u56fe\u7247\u4f1a\u53bb\u6392\u961f\uff08queued\uff09\uff0c\u800c\u4e0d\u662f\u4ea4\u7ed9\u5206\u6790\u5668\u3002 \u5982\u679c\u505c\u6b62\u751f\u4ea7\u56fe\u7247\uff08image\uff09\uff0c\u5176\u4ed6\u5730\u65b9\u4e5f\u4f1a\u505c\u6b62\uff0c\u6bd4\u5982\u5b9e\u65f6\u9884\u89c8\u3002</p> <p>\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u53ef\u4ee5\u8bd5\u8bd5\u6ce8\u91ca\u6389<code>imageProxy.close();</code>\uff0c\u4fee\u6539<code>setBackpressureStrategy(ImageAnalysis.STRATEGY_BLOCK_PRODUCER)</code></p> <p>\u8fd9\u4e2a\u7b56\u7565\u914d\u5408<code>ImageAnalysis.Builder.setImageQueueDepth(int)</code>\u4f7f\u7528\u3002\u8bbe\u7f6e\u961f\u5217\u7684\u957f\u5ea6\u3002</p>"},{"location":"android/jetpack/camerax/image-analysis-use/#nv21","title":"\u83b7\u53d6nv21\u6570\u636e","text":"<p>\u4f8b\u5b50\u4e2d\u628aYUV\u6570\u636e\u8f6c\u6362\u6210nv21\u3002</p> <p>\u7136\u540e\u5229\u7528android.graphics.YuvImage\uff0c\u628a\u56fe\u7247\u5b58\u4e0b\u6765\u3002</p>"},{"location":"android/jetpack/camerax/image-analysis-use/#_5","title":"\u53c2\u8003","text":"<ul> <li>camerax analyze - android</li> <li>ImageFormat#YUV_420_888 - android</li> <li>\u5173\u4e8eYUV\u89c6\u9891 - microsoft</li> <li>How to use YUV (YUV_420_888) Image in Android - minhazav.dev</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u7a00\u571f\u6398\u91d1 cnblog \u534e\u4e3a\u4e91\u793e\u533a </p>"},{"location":"android/jetpack/camerax/preview-floating-system-alert-window/","title":"Android \u6444\u50cf\u5934\u9884\u89c8\u60ac\u6d6e\u7a97\uff0c\u53ef\u62d6\u52a8\uff0c\u53ef\u663e\u793a\u5728\u5176\u4ed6app\u4e0a\u65b9","text":"\u66f4\u65b0\u65e5\u671f: 2022-1-7 <ul> <li>2022-1-7 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u5e02\u9762\u4e0a\u5e38\u89c1\u7684\u6444\u50cf\u5934\u60ac\u6d6e\u7a97\uff0c\u5982\u5fae\u4fe1\u3001\u624b\u673aQQ\u7684\u89c6\u9891\u901a\u8bdd\u529f\u80fd\uff0c\u6709\u5982\u4e0b\u7279\u70b9\uff1a</p> <ul> <li>\u6574\u5c4f\u9875\u9762\u80fd\u5207\u6362\u5230\u4e00\u4e2a\u5c0f\u7684\u60ac\u6d6e\u7a97</li> <li>\u60ac\u6d6e\u7a97\u80fd\u8fd0\u884c\u5728\u5176\u4ed6app\u4e0a\u65b9</li> <li>\u60ac\u6d6e\u7a97\u80fd\u8df3\u56de\u6574\u5c4f\u9875\u9762\uff0c\u5e76\u4e14\u60ac\u6d6e\u7a97\u6d88\u5931</li> </ul> <p>\u6211\u4eec\u63a2\u8ba8\u8fc7\u7528CameraX\u6253\u5f00\u6444\u50cf\u5934\u9884\u89c8\uff0c\u7ed3\u5408\u53ef\u6539\u53d8\u5927\u5c0f\u548c\u6d6e\u52a8\u7684activity\uff0c\u5b9e\u73b0\u4e86\u5e94\u7528\u5185\u6444\u50cf\u5934\u9884\u89c8\u60ac\u6d6eActivity\u3002\u8fd9\u4e2a\u60ac\u6d6eActivity\u662f\u5728\u5e94\u7528\u5185\u4f7f\u7528\u7684\u3002\u8981\u8ba9\u60ac\u6d6e\u7a97\u5728\u5176\u4ed6app\u4e0a\uff0c\u9700\u8981\u7ed3\u5408\u60ac\u6d6e\u7a97 System Alert Window\u3002</p> <p>\u672c\u6587\u7528CameraX\u5b9e\u73b0\u6444\u50cf\u5934\u9884\u89c8\u60ac\u6d6e\u7a97\uff0c\u80fd\u663e\u793a\u5728\u5176\u4ed6app\u4e0a\u65b9\uff0c\u53ef\u62d6\u52a8\uff0c\u53ef\u8df3\u56deactivity\u3002</p> <p></p> <p>\u8fd9\u4e2a\u4f8b\u5b50\u7684\u76f8\u5173\u4ee3\u7801\u653e\u8fdb\u4e86\u5355\u72ec\u7684\u6a21\u5757\u3002\u4f7f\u7528\u65f6\u6ce8\u610fgradle\u91cc\u7684\u7ec6\u5fae\u5dee\u522b\u3002</p>"},{"location":"android/jetpack/camerax/preview-floating-system-alert-window/#_1","title":"\u5f15\u5165\u4f9d\u8d56","text":"<p>\u6a21\u5757gradle\u7684\u4e00\u4e9b\u914d\u7f6e\uff0c\u4f7f\u7528\u7684Android SDK\u7248\u672c\u4e3a31\uff0c\u542f\u7528databinding <pre><code>plugins {\n    id 'com.android.library'\n    id 'kotlin-android'\n    id 'kotlin-android-extensions'\n    id 'kotlin-kapt'\n}\n\nandroid {\n    compileSdk 31\n\n    defaultConfig {\n        minSdk 21\n        targetSdk 31\n        versionCode 1\n        versionName \"1.0\"\n\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n        consumerProguardFiles \"consumer-rules.pro\"\n    }\n    dataBinding {\n        enabled = true\n    }\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n}\n\ndependencies {\n    implementation 'androidx.appcompat:appcompat:1.4.0'\n    implementation 'com.google.android.material:material:1.4.0'\n    implementation project(path: ':baselib')\n    testImplementation 'junit:junit:4.+'\n    androidTestImplementation 'androidx.test.ext:junit:1.1.3'\n    androidTestImplementation 'androidx.test.espresso:espresso-core:3.4.0'\n\n    implementation \"androidx.camera:camera-core:1.1.0-alpha11\"\n    implementation \"androidx.camera:camera-camera2:1.1.0-alpha11\"\n    implementation \"androidx.camera:camera-lifecycle:1.1.0-alpha11\"\n    implementation \"androidx.camera:camera-view:1.0.0-alpha31\"\n    implementation \"androidx.camera:camera-extensions:1.0.0-alpha31\"\n}\n</code></pre></p> <p>\u5f15\u5165CameraX\u4f9d\u8d56\uff08CameraX \u6838\u5fc3\u5e93\u662f\u7528camera2\u5b9e\u73b0\u7684\uff09\uff0c\u76ee\u524d\u4e3b\u8981\u7528<code>1.1.0-alpha11</code>\u7248\u672c</p>"},{"location":"android/jetpack/camerax/preview-floating-system-alert-window/#_2","title":"\u6743\u9650","text":"<p>manifest\u4e2d\u7533\u8bf7\u6743\u9650 <pre><code>&lt;uses-permission android:name=\"android.permission.CAMERA\" /&gt;\n&lt;uses-feature android:name=\"android.hardware.camera.any\" /&gt;\n\n&lt;!-- \u60ac\u6d6e\u7a97\u7684\u6743\u9650 --&gt;\n&lt;uses-permission android:name=\"android.permission.SYSTEM_ALERT_WINDOW\" /&gt;\n</code></pre></p> <p>\u52a8\u6001\u7533\u8bf7\u76f8\u673a\u6743\u9650 <code>Manifest.permission.CAMERA</code> <pre><code>private static final int REQ_CAMERA = 2;\n\n    if (PackageManager.PERMISSION_GRANTED != ContextCompat.checkSelfPermission(this, Manifest.permission.CAMERA)) {\n        ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.CAMERA}, REQ_CAMERA);\n    }\n</code></pre></p> <p>\u540e\u9762\u9700\u8981MeFloatingCameraXAct\u4e0eFloatingCameraXService\u914d\u5408\u4f7f\u7528\u3002</p> <p>manifest\u4e2d\u6ce8\u518cActivity\u548cService <pre><code>&lt;activity\n    android:name=\".camera.MeFloatingCameraXAct\"\n    android:exported=\"true\"\n    android:launchMode=\"singleTop\" /&gt;\n\n&lt;service android:name=\".camera.FloatingCameraXService\" /&gt;\n</code></pre></p> <p>\u68c0\u67e5\u60ac\u6d6e\u7a97\u7684\u6743\u9650 <pre><code>Settings.canDrawOverlays(context);\n</code></pre></p>"},{"location":"android/jetpack/camerax/preview-floating-system-alert-window/#mefloatingcameraxact","title":"MeFloatingCameraXAct","text":"<p>\u8fd9\u4e2aactivity\u63d0\u4f9b\u4e00\u4e2a\u7b80\u5355\u7684\u6444\u50cf\u5934\u9884\u89c8\u754c\u9762\uff0c\u5e76\u4e14\u63d0\u4f9b\u5165\u53e3\u542f\u52a8\u60ac\u6d6e\u7a97\u3002</p> <p>MeFloatingCameraXAct\u7684layout\u3002\u5e26\u6709androidx.camera.view.PreviewView\u7528\u6765\u9884\u89c8\uff0c\u518d\u653e\u4e0a\u51e0\u4e2a\u6309\u94ae\u3002</p> me_act_floating_preivew_x.xml <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout&gt;\n\n    &lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"&gt;\n\n        &lt;FrameLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n            android:id=\"@+id/container\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\"&gt;\n\n            &lt;androidx.camera.view.PreviewView\n                android:id=\"@+id/previewView\"\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"match_parent\" /&gt;\n        &lt;/FrameLayout&gt;\n\n        &lt;LinearLayout\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:layout_alignParentBottom=\"true\"\n            android:gravity=\"center\"\n            android:orientation=\"vertical\"\n            android:padding=\"4dp\"&gt;\n\n            &lt;LinearLayout\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"wrap_content\"\n                android:orientation=\"horizontal\"&gt;\n\n                &lt;Button\n                    android:id=\"@+id/start\"\n                    style=\"@style/NormalBtn\"\n                    android:layout_width=\"wrap_content\"\n                    android:layout_height=\"wrap_content\"\n                    android:text=\"\u6253\u5f00\u6444\u50cf\u5934\" /&gt;\n\n                &lt;Button\n                    android:id=\"@+id/end\"\n                    style=\"@style/NormalBtn\"\n                    android:layout_width=\"wrap_content\"\n                    android:layout_height=\"wrap_content\"\n                    android:layout_marginStart=\"4dp\"\n                    android:text=\"\u505c\u6b62\u6444\u50cf\u5934\" /&gt;\n\n                &lt;Button\n                    android:id=\"@+id/go_floating\"\n                    style=\"@style/NormalBtn\"\n                    android:layout_width=\"wrap_content\"\n                    android:layout_height=\"wrap_content\"\n                    android:layout_marginStart=\"4dp\"\n                    android:text=\"\u5207\u6362\u5230\u60ac\u6d6e\u7a97\" /&gt;\n\n                &lt;Button\n                    android:id=\"@+id/close_act\"\n                    style=\"@style/NormalBtn\"\n                    android:layout_width=\"wrap_content\"\n                    android:layout_height=\"wrap_content\"\n                    android:layout_marginStart=\"4dp\"\n                    android:text=\"\u5173\u95ed\" /&gt;\n\n            &lt;/LinearLayout&gt;\n\n        &lt;/LinearLayout&gt;\n\n    &lt;/RelativeLayout&gt;\n&lt;/layout&gt;\n</code></pre> <p>\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b</p> MeFloatingCameraXAct <pre><code>// package com.rustfisher.mediasamples.camera;\nimport android.Manifest;\nimport android.content.Intent;\nimport android.content.pm.PackageManager;\nimport android.os.Bundle;\nimport android.util.Log;\nimport android.widget.Toast;\nimport androidx.annotation.NonNull;\nimport androidx.annotation.Nullable;\nimport androidx.appcompat.app.AppCompatActivity;\nimport androidx.camera.core.CameraSelector;\nimport androidx.camera.core.Preview;\nimport androidx.camera.lifecycle.ProcessCameraProvider;\nimport androidx.core.app.ActivityCompat;\nimport androidx.core.content.ContextCompat;\nimport androidx.databinding.DataBindingUtil;\nimport com.google.common.util.concurrent.ListenableFuture;\nimport com.rustfisher.mediasamples.R;\nimport com.rustfisher.mediasamples.databinding.MeActFloatingPreivewXBinding;\n\nimport java.util.concurrent.ExecutionException;\n\n\n/**\n* @author an.rustfisher.com\n* @date 2022-1-06 23:53\n*/\npublic class MeFloatingCameraXAct extends AppCompatActivity {\n    private static final String TAG = \"rfDevX\";\n    private static final int REQ_CAMERA = 2;\n    public static final String K_START_CAMERA = \"start_camera\"; // \u76f4\u63a5\u542f\u52a8\u6444\u50cf\u5934\n\n    private MeActFloatingPreivewXBinding mBinding;\n    private ListenableFuture&lt;ProcessCameraProvider&gt; mCameraProviderFuture;\n    private ProcessCameraProvider mCameraProvider;\n    private boolean mRunning = false;\n\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        mBinding = DataBindingUtil.setContentView(this, R.layout.me_act_floating_preivew_x);\n        final boolean startNow = getIntent().getBooleanExtra(K_START_CAMERA, false);\n        mCameraProviderFuture = ProcessCameraProvider.getInstance(this);\n        mCameraProviderFuture.addListener(() -&gt; {\n            try {\n                mCameraProvider = mCameraProviderFuture.get();\n                Log.d(TAG, \"\u83b7\u53d6\u5230\u4e86 cameraProvider\");\n                if (startNow) {\n                    bindPreview(mCameraProvider);\n                }\n            } catch (ExecutionException | InterruptedException e) {\n                // \u8fd9\u91cc\u4e0d\u7528\u5904\u7406\n            }\n        }, ContextCompat.getMainExecutor(this));\n        mBinding.start.setOnClickListener(v -&gt; {\n            if (mCameraProvider != null &amp;&amp; !mRunning) {\n                bindPreview(mCameraProvider);\n            }\n        });\n        mBinding.end.setOnClickListener(v -&gt; {\n            mCameraProvider.unbindAll();\n            mRunning = false;\n        });\n        mBinding.goFloating.setOnClickListener(v -&gt; {\n            startService(new Intent(getApplicationContext(), FloatingCameraXService.class));\n            finish();\n        });\n        mBinding.closeAct.setOnClickListener(v -&gt; {\n            Toast.makeText(getApplicationContext(), \"\u5173\u95ed\u6444\u50cf\u5934\u793a\u4f8b\", Toast.LENGTH_SHORT).show();\n            stopService(new Intent(getApplicationContext(), FloatingCameraXService.class));\n            finish();\n        });\n\n        if (PackageManager.PERMISSION_GRANTED != ContextCompat.checkSelfPermission(this, Manifest.permission.CAMERA)) {\n            ActivityCompat.requestPermissions(this, new String[]{Manifest.permission.CAMERA}, REQ_CAMERA);\n        }\n    }\n\n    @Override\n    public void onBackPressed() {\n        Toast.makeText(getApplicationContext(), \"\u8bf7\u70b9\u51fb\u5173\u95ed\u6309\u94ae\", Toast.LENGTH_SHORT).show();\n    }\n\n    @Override\n    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {\n        super.onRequestPermissionsResult(requestCode, permissions, grantResults);\n        if (requestCode == REQ_CAMERA) {\n            if (grantResults[0] != PackageManager.PERMISSION_GRANTED) {\n                Toast.makeText(getApplicationContext(), \"\u8bf7\u5141\u8bb8\u76f8\u673a\u6743\u9650\", Toast.LENGTH_SHORT).show();\n            }\n        }\n    }\n\n    private void bindPreview(ProcessCameraProvider cameraProvider) {\n        if (cameraProvider == null) {\n            Toast.makeText(getApplicationContext(), \"\u6ca1\u83b7\u53d6\u5230\u76f8\u673a\", Toast.LENGTH_SHORT).show();\n            return;\n        }\n        Toast.makeText(getApplicationContext(), \"\u76f8\u673a\u542f\u52a8\", Toast.LENGTH_SHORT).show();\n        Preview preview = new Preview.Builder().build();\n\n        CameraSelector cameraSelector = new CameraSelector.Builder()\n                .requireLensFacing(CameraSelector.LENS_FACING_BACK)\n                .build();\n\n        preview.setSurfaceProvider(mBinding.previewView.getSurfaceProvider());\n\n        cameraProvider.bindToLifecycle(this, cameraSelector, preview);\n        mRunning = true;\n    }\n}\n</code></pre> <p>CameraX\u542f\u52a8\u9884\u89c8\u7684\u4ee3\u7801\u53ef\u4ee5\u53c2\u8003 https://an.rustfisher.com/android/jetpack/camerax/simple-preview/</p> <p>\u542f\u52a8\u60ac\u6d6e\u7a97\u7684\u670d\u52a1\u540e\u81ea\u5df1<code>finish()</code></p>"},{"location":"android/jetpack/camerax/preview-floating-system-alert-window/#_3","title":"\u60ac\u6d6e\u7a97","text":""},{"location":"android/jetpack/camerax/preview-floating-system-alert-window/#layout","title":"layout","text":"<p>\u5148\u7ed9\u60ac\u6d6e\u7a97\u51c6\u5907\u4e00\u4e2alayout</p> \u60ac\u6d6e\u7a97\u7684layout <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:background=\"#000\"&gt;\n\n    &lt;androidx.camera.view.PreviewView\n        android:id=\"@+id/preview_view\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\" /&gt;\n\n    &lt;ImageView\n        android:id=\"@+id/to_big\"\n        android:layout_width=\"40dp\"\n        android:layout_height=\"40dp\"\n        android:padding=\"4dp\"\n        android:src=\"@drawable/me_to_big\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre> <p>\u56fe\u7247\u8bf7\u81ea\u5907</p>"},{"location":"android/jetpack/camerax/preview-floating-system-alert-window/#floatingcameraxservice","title":"FloatingCameraXService","text":"<p>FloatingCameraXService\u5b9e\u73b0LifecycleOwner\u63a5\u53e3\uff0c\u4e3a\u4e86\u65b9\u4fbfCameraX\u7ed1\u5b9a\u751f\u547d\u5468\u671f\u7ec4\u4ef6\u3002</p> FloatingCameraXService <pre><code>// package com.rustfisher.mediasamples.camera;\nimport android.app.Service;\nimport android.content.Intent;\nimport android.graphics.PixelFormat;\nimport android.os.Build;\nimport android.os.IBinder;\nimport android.util.DisplayMetrics;\nimport android.util.Log;\nimport android.view.Gravity;\nimport android.view.LayoutInflater;\nimport android.view.MotionEvent;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.view.WindowManager;\nimport android.widget.Toast;\n\nimport androidx.annotation.NonNull;\nimport androidx.annotation.Nullable;\nimport androidx.camera.core.CameraSelector;\nimport androidx.camera.core.Preview;\nimport androidx.camera.lifecycle.ProcessCameraProvider;\nimport androidx.camera.view.PreviewView;\nimport androidx.core.content.ContextCompat;\nimport androidx.lifecycle.Lifecycle;\nimport androidx.lifecycle.LifecycleOwner;\nimport androidx.lifecycle.LifecycleRegistry;\n\nimport com.google.common.util.concurrent.ListenableFuture;\nimport com.rustfisher.mediasamples.R;\n\nimport java.util.concurrent.ExecutionException;\n\n\n/**\n* \u6444\u50cf\u5934\u9884\u89c8\u60ac\u6d6e\u7a97\u7684\u670d\u52a1\n*\n* @author an.rustfisher.com\n* @date 2022-01-06 23:53\n*/\npublic class FloatingCameraXService extends Service implements LifecycleOwner {\n    private static final String TAG = \"rfDevFloatingCameraX\";\n\n    private WindowManager mWM;\n    private View mFloatView;\n    private LifecycleRegistry mLifecycleRegistry;\n\n    private ListenableFuture&lt;ProcessCameraProvider&gt; mCameraProviderFuture;\n    private ProcessCameraProvider mCameraProvider;\n\n    @Nullable\n    @Override\n    public IBinder onBind(Intent intent) {\n        return null;\n    }\n\n    @Override\n    public void onCreate() {\n        super.onCreate();\n        mLifecycleRegistry = new LifecycleRegistry(this);\n        mLifecycleRegistry.setCurrentState(Lifecycle.State.CREATED);\n    }\n\n    @Override\n    public int onStartCommand(Intent intent, int flags, int startId) {\n        Log.d(TAG, \"onStartCommand , \" + startId);\n        if (mFloatView == null) {\n            Log.d(TAG, \"onStartCommand: \u521b\u5efa\u60ac\u6d6e\u7a97\");\n            initUi();\n        }\n        mLifecycleRegistry.setCurrentState(Lifecycle.State.STARTED);\n        return super.onStartCommand(intent, flags, startId);\n    }\n\n    @Override\n    public void onDestroy() {\n        Log.d(TAG, \"onDestroy\");\n        if (mFloatView != null) {\n            mWM.removeView(mFloatView);\n        }\n        mLifecycleRegistry.setCurrentState(Lifecycle.State.DESTROYED);\n        super.onDestroy();\n    }\n\n    private void initUi() {\n        DisplayMetrics metrics = getApplicationContext().getResources().getDisplayMetrics();\n        int width = metrics.widthPixels;\n        int height = metrics.heightPixels;\n\n        mWM = (WindowManager) getSystemService(WINDOW_SERVICE);\n        LayoutInflater inflater = (LayoutInflater) getBaseContext().getSystemService(LAYOUT_INFLATER_SERVICE);\n        mFloatView = inflater.inflate(R.layout.me_floating_camerax, null);\n\n        int layoutType;\n        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {\n            layoutType = WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY;\n        } else {\n            layoutType = WindowManager.LayoutParams.TYPE_TOAST;\n        }\n\n        WindowManager.LayoutParams floatLp = new WindowManager.LayoutParams(\n                (int) (width * (0.4f)), // \u8fd9\u91cc\u53ef\u4ee5\u5b9a\u5c0f\u4e00\u70b9\n                (int) (height * (0.3f)),// \u4e3a\u65b9\u4fbf\u5c55\u793a \u8fd9\u91cc\u7ed9\u7684\u5c3a\u5bf8\u6bd4\u8f83\u5927\n                layoutType,\n                WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE,\n                PixelFormat.TRANSLUCENT\n        );\n\n        floatLp.gravity = Gravity.CENTER;\n        floatLp.x = 0;\n        floatLp.y = 0;\n\n        mFloatView.findViewById(R.id.to_big).setOnClickListener(v -&gt; {\n            stopSelf();\n            Intent intent = new Intent(getApplicationContext(), MeFloatingCameraXAct.class);\n            intent.putExtra(MeFloatingCameraXAct.K_START_CAMERA, true);\n            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n            startActivity(intent);\n        });\n\n        mWM.addView(mFloatView, floatLp);\n\n        mFloatView.setOnTouchListener(new View.OnTouchListener() {\n            final WindowManager.LayoutParams floatWindowLayoutUpdateParam = floatLp;\n            double x;\n            double y;\n            double px;\n            double py;\n\n            @Override\n            public boolean onTouch(View v, MotionEvent event) {\n                switch (event.getAction()) {\n                    case MotionEvent.ACTION_DOWN:\n                        x = floatWindowLayoutUpdateParam.x;\n                        y = floatWindowLayoutUpdateParam.y;\n                        px = event.getRawX();\n                        py = event.getRawY();\n                        break;\n                    case MotionEvent.ACTION_MOVE:\n                        floatWindowLayoutUpdateParam.x = (int) ((x + event.getRawX()) - px);\n                        floatWindowLayoutUpdateParam.y = (int) ((y + event.getRawY()) - py);\n                        mWM.updateViewLayout(mFloatView, floatWindowLayoutUpdateParam);\n                        break;\n                }\n                return false;\n            }\n        });\n\n        mCameraProviderFuture = ProcessCameraProvider.getInstance(this);\n        mCameraProviderFuture.addListener(() -&gt; {\n            try {\n                mCameraProvider = mCameraProviderFuture.get();\n                Log.d(TAG, \"[service]\u83b7\u53d6\u5230\u4e86cameraProvider\");\n                bindPreview(mCameraProvider, mFloatView.findViewById(R.id.preview_view));\n            } catch (ExecutionException | InterruptedException e) {\n                // \u8fd9\u91cc\u4e0d\u7528\u5904\u7406\n            }\n        }, ContextCompat.getMainExecutor(this));\n    }\n\n    @NonNull\n    @Override\n    public Lifecycle getLifecycle() {\n        return mLifecycleRegistry;\n    }\n\n    private void bindPreview(ProcessCameraProvider cameraProvider, PreviewView previewView) {\n        if (cameraProvider == null) {\n            Toast.makeText(getApplicationContext(), \"\u6ca1\u83b7\u53d6\u5230\u76f8\u673a\", Toast.LENGTH_SHORT).show();\n            return;\n        }\n        Toast.makeText(getApplicationContext(), \"\u76f8\u673a\u542f\u52a8\", Toast.LENGTH_SHORT).show();\n        Preview preview = new Preview.Builder().build();\n        CameraSelector cameraSelector = new CameraSelector.Builder()\n                .requireLensFacing(CameraSelector.LENS_FACING_BACK)\n                .build();\n        preview.setSurfaceProvider(previewView.getSurfaceProvider());\n        cameraProvider.bindToLifecycle(this, cameraSelector, preview);\n    }\n}\n</code></pre> <p>\u8fd9\u91cc\u60ac\u6d6e\u7a97view\u521b\u5efa\u5b8c\u6bd5\u540e\uff0c\u518d\u53bb\u8bf7\u6c42\u6444\u50cf\u5934\u548c\u6253\u5f00\u9884\u89c8\u3002</p>"},{"location":"android/jetpack/camerax/preview-floating-system-alert-window/#lifecycle","title":"LifeCycle","text":"<p>\u751f\u547d\u5468\u671f\u8bf7\u53c2\u8003LifeCycle</p>"},{"location":"android/jetpack/camerax/preview-floating-system-alert-window/#windowmanager","title":"WindowManager","text":"<p>\u521b\u5efa\u60ac\u6d6e\u7a97view\uff0c\u5e76\u4e14\u6dfb\u52a0\u5230\u7a97\u53e3\u4e2d\u3002\u4e3b\u8981\u4f7f\u7528WindowManager\u63d0\u4f9b\u7684\u65b9\u6cd5\u3002</p> <p>\u521b\u5efaWindowManager.LayoutParams\u7684\u65f6\u5019\uff0c\u6307\u5b9a\u5bbd\u9ad8\uff0c\u6839\u636eAPI\u7248\u672c\u9009\u62e9<code>layoutType</code>\u3002</p>"},{"location":"android/jetpack/camerax/preview-floating-system-alert-window/#_4","title":"\u542f\u52a8\u9884\u89c8","text":"<p>\u542f\u52a8\u9884\u89c8\u90e8\u5206<code>bindPreview</code>\u4ee3\u7801\u4e0e\u524d\u9762\u7684\u7c7b\u4f3c\u3002\u7528<code>bindToLifecycle</code>\u65b9\u6cd5\u3002</p>"},{"location":"android/jetpack/camerax/preview-floating-system-alert-window/#_5","title":"\u8fd0\u884c\u6d4b\u8bd5","text":"<p>\u8fd0\u884c\u5230\u624b\u673a\u4e0a\uff0c\u6253\u5f00\u8fd9\u4e2aActivity\u5c31\u53ef\u4ee5\u770b\u5230\u6444\u50cf\u5934\u9884\u89c8\u3002\u56fe\u50cf\u5bbd\u9ad8\u6bd4\u6b63\u5e38\uff0c\u6ca1\u6709\u62c9\u4f38\u73b0\u8c61\u3002 \u7f29\u5c0f\u6210\u60ac\u6d6e\u7a97\u540e\uff0c\u53ef\u4ee5\u62d6\u52a8\u3002\u53ef\u4ece\u60ac\u6d6e\u7a97\u8df3\u56deActivity\u3002</p> <ul> <li>\u8363\u8000 EMUI 3.1 Lite\uff0cAndroid 5.1 \u8fd0\u884c\u6b63\u5e38</li> <li>Redmi 9A\uff0cMIUI 12.5.1\u7a33\u5b9a\u7248\uff0cAndroid 10 \u8fd0\u884c\u6b63\u5e38</li> </ul>"},{"location":"android/jetpack/camerax/preview-floating-system-alert-window/#_6","title":"\u5c0f\u7ed3","text":"<p>\u7ed3\u5408\u60ac\u6d6e\u7a97\u529f\u80fd\u4e0e\u6444\u50cf\u5934\u5f97\u5230\u7684\u9884\u89c8\u60ac\u6d6e\u7a97\uff0c\u53ef\u4ee5\u8fd0\u884c\u5728\u5176\u4ed6app\u4e0a\u65b9\u3002 \u6ce8\u610f\u5f15\u5bfc\u7528\u6237\u5f00\u542f\u60ac\u6d6e\u7a97\u6743\u9650\u548c\u6444\u50cf\u5934\u6743\u9650\u3002</p>"},{"location":"android/jetpack/camerax/preview-floating-system-alert-window/#_7","title":"\u53c2\u8003","text":"<ul> <li>Android \u5e94\u7528\u5185\u60ac\u6d6e\u7a97</li> <li>Android CameraX \u6253\u5f00\u6444\u50cf\u5934\u9884\u89c8</li> <li>\u751f\u547d\u5468\u671f LifeCycle</li> <li>Android \u60ac\u6d6e\u7a97 System Alert Window</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a cnblog \u6398\u91d1 oschina csdn \u77e5\u4e4e</p>"},{"location":"android/jetpack/camerax/preview-floating-window/","title":"Android \u5e94\u7528\u5185\u6444\u50cf\u5934\u9884\u89c8\u60ac\u6d6eActivity","text":"\u66f4\u65b0\u65e5\u671f: 2022-1-6 <ul> <li>2022-1-6 \u4fee\u6539\u6807\u9898\uff1a Android \u5e94\u7528\u5185\u6444\u50cf\u5934\u9884\u89c8\u60ac\u6d6eActivity</li> <li>2022-1-5 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u7528CameraX\u6253\u5f00\u6444\u50cf\u5934\u9884\u89c8\uff0c\u663e\u793a\u5728\u754c\u9762\u4e0a\u3002\u7ed3\u5408\u60ac\u6d6e\u7a97\u7684\u529f\u80fd\u3002\u5b9e\u73b0\u4e00\u4e2a\u53ef\u62d6\u52a8\u60ac\u6d6e\u7a97\uff0c\u5b9e\u65f6\u9884\u89c8\u6444\u50cf\u5934\u7684\u4f8b\u5b50\u3002</p> <p>\u8fd9\u4e2a\u4f8b\u5b50\u653e\u8fdb\u4e86\u5355\u72ec\u7684\u6a21\u5757\u91cc\u3002\u4f7f\u7528\u65f6\u6ce8\u610fgradle\u91cc\u7684\u7ec6\u5fae\u5dee\u522b\u3002</p> <p>\u64cd\u4f5c\u6444\u50cf\u5934\uff0c\u6253\u5f00\u9884\u89c8\u3002\u8fd9\u90e8\u5206\u4ee3\u7801\u4e0eAndroid CameraX \u6253\u5f00\u6444\u50cf\u5934\u9884\u89c8\u76f8\u540c\u3002 \u60ac\u6d6e\u7a97\u76f8\u5173\u4ee3\u7801\u4e0e\u53ef\u62d6\u52a8\u60ac\u6d6e\u7a97\u76f8\u540c\u3002\u5728\u6b64\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u5bf9\u62d6\u52a8\u8303\u56f4\u7684\u9650\u5236\u3002</p>"},{"location":"android/jetpack/camerax/preview-floating-window/#_1","title":"\u5f15\u5165\u4f9d\u8d56","text":"<p>\u6a21\u5757gradle\u7684\u4e00\u4e9b\u914d\u7f6e\uff0c\u4f7f\u7528\u7684Android SDK\u7248\u672c\u4e3a31\uff0c\u542f\u7528databinding <pre><code>plugins {\n    id 'com.android.library'\n    id 'kotlin-android'\n    id 'kotlin-android-extensions'\n    id 'kotlin-kapt'\n}\n\nandroid {\n    compileSdk 31\n\n    defaultConfig {\n        minSdk 21\n        targetSdk 31\n        versionCode 1\n        versionName \"1.0\"\n\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n        consumerProguardFiles \"consumer-rules.pro\"\n    }\n    dataBinding {\n        enabled = true\n    }\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n}\n\ndependencies {\n    implementation 'androidx.appcompat:appcompat:1.4.0'\n    implementation 'com.google.android.material:material:1.4.0'\n    implementation project(path: ':baselib')\n    testImplementation 'junit:junit:4.+'\n    androidTestImplementation 'androidx.test.ext:junit:1.1.3'\n    androidTestImplementation 'androidx.test.espresso:espresso-core:3.4.0'\n\n    implementation \"androidx.camera:camera-core:1.1.0-alpha11\"\n    implementation \"androidx.camera:camera-camera2:1.1.0-alpha11\"\n    implementation \"androidx.camera:camera-lifecycle:1.1.0-alpha11\"\n    implementation \"androidx.camera:camera-view:1.0.0-alpha31\"\n    implementation \"androidx.camera:camera-extensions:1.0.0-alpha31\"\n}\n</code></pre></p> <p>\u5f15\u5165CameraX\u4f9d\u8d56\uff08CameraX \u6838\u5fc3\u5e93\u662f\u7528camera2\u5b9e\u73b0\u7684\uff09\uff0c\u76ee\u524d\u4e3b\u8981\u7528<code>1.1.0-alpha11</code>\u7248\u672c</p>"},{"location":"android/jetpack/camerax/preview-floating-window/#_2","title":"\u6743\u9650","text":"<p>\u9700\u8981\u52a8\u6001\u7533\u8bf7<code>android.permission.CAMERA</code>\u6743\u9650 <pre><code>&lt;uses-permission android:name=\"android.permission.CAMERA\" /&gt;\n</code></pre></p> <p>\u672c\u6587\u7565\u8fc7\u52a8\u6001\u7533\u8bf7\u6743\u9650\u7684\u5730\u65b9</p>"},{"location":"android/jetpack/camerax/preview-floating-window/#layout","title":"layout","text":"<p>CameraX\u63d0\u4f9b\u4e86androidx.camera.view.PreviewView</p> <p>\u628a\u5b83\u653e\u5728\u4e00\u4e2aFrameLayout\u91cc\uff0c\u5982\u4e0b\u7684me_act_simple_preivew_x_scale.xml</p> <p><pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout&gt;\n\n    &lt;RelativeLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n        android:id=\"@+id/root\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:background=\"@android:color/transparent\"&gt;\n\n        &lt;FrameLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n            android:id=\"@+id/container\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\"&gt;\n\n            &lt;androidx.camera.view.PreviewView\n                android:id=\"@+id/previewView\"\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"match_parent\" /&gt;\n        &lt;/FrameLayout&gt;\n\n        &lt;LinearLayout\n            android:id=\"@+id/func_field\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:layout_alignParentBottom=\"true\"\n            android:gravity=\"center\"\n            android:orientation=\"vertical\"\n            android:padding=\"4dp\"&gt;\n\n            &lt;LinearLayout\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"wrap_content\"\n                android:orientation=\"horizontal\"&gt;\n\n                &lt;Button\n                    android:id=\"@+id/start\"\n                    style=\"@style/NormalBtn\"\n                    android:layout_width=\"wrap_content\"\n                    android:layout_height=\"wrap_content\"\n                    android:text=\"\u6253\u5f00\u6444\u50cf\u5934\" /&gt;\n\n                &lt;Button\n                    android:id=\"@+id/end\"\n                    style=\"@style/NormalBtn\"\n                    android:layout_width=\"wrap_content\"\n                    android:layout_height=\"wrap_content\"\n                    android:layout_marginStart=\"4dp\"\n                    android:text=\"\u505c\u6b62\u6444\u50cf\u5934\" /&gt;\n\n            &lt;/LinearLayout&gt;\n\n            &lt;LinearLayout\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"wrap_content\"\n                android:layout_marginTop=\"4dp\"\n                android:orientation=\"horizontal\"&gt;\n\n                &lt;Button\n                    android:id=\"@+id/enable_ana\"\n                    style=\"@style/NormalBtn\"\n                    android:layout_width=\"wrap_content\"\n                    android:layout_height=\"wrap_content\"\n                    android:text=\"setAnalyzer\" /&gt;\n\n                &lt;Button\n                    android:id=\"@+id/clr_ana\"\n                    style=\"@style/NormalBtn\"\n                    android:layout_width=\"wrap_content\"\n                    android:layout_height=\"wrap_content\"\n                    android:layout_marginStart=\"4dp\"\n                    android:text=\"clearAnalyzer\" /&gt;\n\n                &lt;Button\n                    android:id=\"@+id/take_one_analyse\"\n                    style=\"@style/NormalBtn\"\n                    android:layout_width=\"wrap_content\"\n                    android:layout_height=\"wrap_content\"\n                    android:layout_marginStart=\"4dp\"\n                    android:text=\"\u622a\u53d6\" /&gt;\n\n            &lt;/LinearLayout&gt;\n        &lt;/LinearLayout&gt;\n\n        &lt;View\n            android:id=\"@+id/touch_move\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\"\n            android:visibility=\"gone\" /&gt;\n\n        &lt;ImageView\n            android:id=\"@+id/zoom_iv\"\n            android:layout_width=\"40dp\"\n            android:layout_height=\"40dp\"\n            android:layout_margin=\"12dp\"\n            android:src=\"@drawable/me_ic_to_small\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tip\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:layout_alignParentBottom=\"true\"\n            android:layout_centerHorizontal=\"true\"\n            android:text=\"rustfisher.com\" /&gt;\n\n    &lt;/RelativeLayout&gt;\n&lt;/layout&gt;\n</code></pre> <code>func_field</code>\u88c5\u7740\u4e00\u4e9b\u6309\u94ae\u3002\u7f29\u5c0f\u548c\u8fd8\u539f\u754c\u9762\u7528<code>zoom_iv</code></p>"},{"location":"android/jetpack/camerax/preview-floating-window/#style","title":"style","text":"<p>\u51c6\u5907\u4e00\u4e2astyle <pre><code>&lt;style name=\"MeTranslucentAct\" parent=\"AppTheme\"&gt;\n    &lt;item name=\"android:windowBackground\"&gt;#80000000&lt;/item&gt;\n    &lt;item name=\"android:windowIsTranslucent\"&gt;true&lt;/item&gt;\n    &lt;item name=\"android:windowAnimationStyle\"&gt;@android:style/Animation.Translucent&lt;/item&gt;\n&lt;/style&gt;\n</code></pre></p> <p>manifest\u91cc\u6ce8\u518c <pre><code>&lt;activity\n    android:name=\".camera.MeSimplePreviewXFloatingAct\"\n    android:exported=\"true\"\n    android:theme=\"@style/MeTranslucentAct\" /&gt;\n</code></pre></p>"},{"location":"android/jetpack/camerax/preview-floating-window/#activity","title":"activity","text":""},{"location":"android/jetpack/camerax/preview-floating-window/#_3","title":"\u5f00\u542f\u6444\u50cf\u5934","text":"<p>\u65b0\u5efaMeSimplePreviewXFloatingAct\uff0c\u7ee7\u627f<code>androidx.appcompat.app.AppCompatActivity</code> <pre><code>// onCreate\u4e2d\u83b7\u53d6mCameraProvider\nmCameraProviderFuture = ProcessCameraProvider.getInstance(this);\nmCameraProviderFuture.addListener(() -&gt; {\n    try {\n        mCameraProvider = mCameraProviderFuture.get();\n        Log.d(TAG, \"\u83b7\u53d6\u5230\u4e86 cameraProvider\");\n        } catch (ExecutionException | InterruptedException e) {\n        // \u8fd9\u91cc\u4e0d\u7528\u5904\u7406\n    }\n}, ContextCompat.getMainExecutor(this));\n</code></pre> \u4e3a\u4e86\u83b7\u5f97ProcessCameraProvider\uff0c\u7528<code>ProcessCameraProvider.getInstance</code>\u65b9\u6cd5\u62ff\u5230\u4e00\u4e2a<code>cameraProviderFuture</code>\u3002 \u5728<code>cameraProviderFuture</code>\u5b8c\u6210\u540e\u53d6\u51faProcessCameraProvider\uff08<code>cameraProvider</code>\uff09\u3002</p> <p>\u5f00\u542f\u6444\u50cf\u5934\u7684\u65b9\u6cd5<code>bindPreview</code> <pre><code>private void bindPreview(ProcessCameraProvider cameraProvider) {\n    if (cameraProvider == null) {\n        Toast.makeText(getApplicationContext(), \"\u6ca1\u83b7\u53d6\u5230\u76f8\u673a\", Toast.LENGTH_SHORT).show();\n        return;\n    }\n    Toast.makeText(getApplicationContext(), \"\u76f8\u673a\u542f\u52a8\", Toast.LENGTH_SHORT).show();\n    Preview preview = new Preview.Builder().build();\n\n    CameraSelector cameraSelector = new CameraSelector.Builder()\n            .requireLensFacing(CameraSelector.LENS_FACING_BACK)\n            .build();\n\n    preview.setSurfaceProvider(mBinding.previewView.getSurfaceProvider());\n\n    cameraProvider.bindToLifecycle(this, cameraSelector, preview, mImageAnalysis);\n    mRunning = true;\n}\n</code></pre> \u8981\u5f00\u542f\u9884\u89c8\uff0c\u901a\u8fc7<code>Preview.Builder</code>\u6784\u5efa\u4e00\u4e2aPreview\u3002\u7528CameraSelector\u6765\u9009\u62e9\u540e\u7f6e\u6444\u50cf\u5934\u3002 Preview\u7684SurfaceProvider\u7531layout\u4e2d\u7684androidx.camera.view.PreviewView\u63d0\u4f9b\u3002</p> <p><code>cameraProvider.bindToLifecycle</code>\u7ed1\u5b9a\u4e0a\u540e\uff0c\u542f\u52a8\u6444\u50cf\u5934\u9884\u89c8</p>"},{"location":"android/jetpack/camerax/preview-floating-window/#_4","title":"\u60ac\u6d6e\u7a97","text":"<p><code>setContentView</code>\u4e4b\u524d\u8bbe\u7f6e\u4e00\u4e0bwindow\u7684flag <pre><code>WindowManager.LayoutParams layoutParams = getWindow().getAttributes();\nlayoutParams.flags |= WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL;\n</code></pre></p>"},{"location":"android/jetpack/camerax/preview-floating-window/#_5","title":"\u7f29\u5c0f\u548c\u653e\u5927\u7a97\u53e3","text":"<p>\u7f29\u5c0f\u653e\u5927\u7a97\u53e3\u9700\u8981\u7528android.view.WindowManager.LayoutParams <pre><code>private void toSmallWindow() {\n    mBinding.funcField.setVisibility(View.GONE);\n    mIsSmallWindow = true;\n    mBinding.zoomIv.setImageResource(R.drawable.me_to_big);\n\n    android.view.WindowManager.LayoutParams p = getWindow().getAttributes();\n    p.height = 480; // \u60ac\u6d6e\u7a97\u5927\u5c0f\u53ef\u4ee5\u81ea\u5df1\u5b9a\n    p.width = 360;\n    p.dimAmount = 0.0f;\n    getWindow().setAttributes(p);\n}\n\nprivate void toBigWindow() {\n    WindowManager.LayoutParams lp = getWindow().getAttributes();\n    lp.x = 0;\n    lp.y = 0;\n    getWindow().setAttributes(lp);\n\n    getWindow().setLayout(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);\n    mBinding.funcField.setVisibility(View.VISIBLE);\n    mIsSmallWindow = false;\n    mBinding.zoomIv.setImageResource(R.drawable.me_ic_to_small);\n}\n</code></pre></p> <p>\u6309\u94ae\u7684\u56fe\u7247\u8d44\u6e90\u8bf7\u81ea\u5907</p>"},{"location":"android/jetpack/camerax/preview-floating-window/#_6","title":"\u9650\u5236\u62d6\u52a8\u8303\u56f4","text":"<p>\u5148\u62ff\u5230\u4e00\u4e2a\u53c2\u8003\u8303\u56f4 <pre><code>mBinding.container.post(() -&gt; {\n    mBigWid = mBinding.container.getWidth();\n    mBigHeight = mBinding.container.getHeight();\n    Log.d(TAG, \"container size: \" + mBigWid + \", \" + mBigHeight);\n});\n</code></pre></p> <p>\u76f8\u5173\u9605\u8bfb\uff1a\u83b7\u53d6view\u7684\u5bbd\u9ad8</p>"},{"location":"android/jetpack/camerax/preview-floating-window/#activity_1","title":"activity\u5b8c\u6574\u4ee3\u7801","text":"<pre><code>// package com.rustfisher.mediasamples.camera;\nimport android.os.Bundle;\nimport android.util.Log;\nimport android.util.Size;\nimport android.view.MotionEvent;\nimport android.view.Surface;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.view.WindowManager;\nimport android.widget.Toast;\n\nimport androidx.annotation.Nullable;\nimport androidx.appcompat.app.AppCompatActivity;\nimport androidx.camera.core.CameraSelector;\nimport androidx.camera.core.ImageAnalysis;\nimport androidx.camera.core.Preview;\nimport androidx.camera.lifecycle.ProcessCameraProvider;\nimport androidx.core.content.ContextCompat;\nimport androidx.databinding.DataBindingUtil;\n\nimport com.google.common.util.concurrent.ListenableFuture;\nimport com.rustfisher.mediasamples.R;\nimport com.rustfisher.mediasamples.databinding.MeActSimplePreivewXScaleBinding;\n\nimport java.util.concurrent.ExecutionException;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\n\n\n/**\n * \u9884\u89c8\u7167\u76f8\u673a  \u60ac\u6d6e\u7a97\n *\n * @author an.rustfisher.com\n * @date 2021-12-31 15:53\n */\npublic class MeSimplePreviewXFloatingAct extends AppCompatActivity {\n    private static final String TAG = \"rfDevX\";\n    private MeActSimplePreivewXScaleBinding mBinding;\n    private ListenableFuture&lt;ProcessCameraProvider&gt; mCameraProviderFuture;\n    private ProcessCameraProvider mCameraProvider;\n    private boolean mRunning = false;\n\n    private boolean mIsSmallWindow = false;\n    private boolean mLimitArea = true;\n\n    private boolean mTakeOneYuv = false; // \u83b7\u53d6\u4e00\u5e27 \u5b9e\u9645\u5de5\u7a0b\u4e2d\u4e0d\u8981\u8fd9\u4e48\u505a\n\n    private final ImageAnalysis mImageAnalysis =\n            new ImageAnalysis.Builder()\n                    //.setOutputImageFormat(ImageAnalysis.OUTPUT_IMAGE_FORMAT_RGBA_8888)\n                    .setTargetResolution(new Size(720, 1280)) // \u56fe\u7247\u7684\u5efa\u8bae\u5c3a\u5bf8\n                    .setOutputImageRotationEnabled(true) // \u662f\u5426\u65cb\u8f6c\u5206\u6790\u5668\u4e2d\u5f97\u5230\u7684\u56fe\u7247\n                    .setTargetRotation(Surface.ROTATION_0) // \u5141\u8bb8\u65cb\u8f6c\u540e \u5f97\u5230\u56fe\u7247\u7684\u65cb\u8f6c\u8bbe\u7f6e\n                    .setBackpressureStrategy(ImageAnalysis.STRATEGY_BLOCK_PRODUCER)\n                    .build();\n\n    private float mLastTx = 0; // \u624b\u6307\u7684\u4e0a\u4e00\u4e2a\u4f4d\u7f6e\n    private float mLastTy = 0;\n\n    private int mBigHeight = 0;\n    private int mBigWid = 0;\n\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n\n        WindowManager.LayoutParams layoutParams = getWindow().getAttributes();\n        layoutParams.flags |= WindowManager.LayoutParams.FLAG_NOT_TOUCH_MODAL;\n\n        mBinding = DataBindingUtil.setContentView(this, R.layout.me_act_simple_preivew_x_scale);\n        mCameraProviderFuture = ProcessCameraProvider.getInstance(this);\n        mCameraProviderFuture.addListener(() -&gt; {\n            try {\n                mCameraProvider = mCameraProviderFuture.get();\n                Log.d(TAG, \"\u83b7\u53d6\u5230\u4e86 cameraProvider\");\n//                bindPreview(mCameraProvider);\n            } catch (ExecutionException | InterruptedException e) {\n                // \u8fd9\u91cc\u4e0d\u7528\u5904\u7406\n            }\n        }, ContextCompat.getMainExecutor(this));\n        mBinding.start.setOnClickListener(v -&gt; {\n            if (mCameraProvider != null &amp;&amp; !mRunning) {\n                bindPreview(mCameraProvider);\n            }\n        });\n        mBinding.end.setOnClickListener(v -&gt; {\n            mCameraProvider.unbindAll();\n            mRunning = false;\n        });\n\n        mBinding.takeOneAnalyse.setOnClickListener(v -&gt; {\n            mTakeOneYuv = true;\n            Log.d(TAG, \"\u83b7\u53d6\u4e00\u5e27, \u8f93\u51fa\u56fe\u7247\u65cb\u8f6c: \" + mImageAnalysis.isOutputImageRotationEnabled());\n        });\n\n        final ExecutorService executorService = Executors.newFixedThreadPool(2);\n        mBinding.enableAna.setOnClickListener(v -&gt; {\n            Toast.makeText(getApplicationContext(), \"\u542f\u7528\u5206\u6790\u5668\", Toast.LENGTH_SHORT).show();\n            mImageAnalysis.setAnalyzer(executorService, imageProxy -&gt; {\n                // \u4e0b\u9762\u5904\u7406\u6570\u636e\n                if (mTakeOneYuv) {\n                    mTakeOneYuv = false;\n                    Log.d(TAG, \"\u65cb\u8f6c\u89d2\u5ea6: \" + imageProxy.getImageInfo().getRotationDegrees());\n                    ImgHelper.useYuvImgSaveFile(imageProxy, true); // \u5b58\u50a8\u8fd9\u4e00\u5e27\u4e3a\u6587\u4ef6\n                    runOnUiThread(() -&gt; Toast.makeText(getApplicationContext(), \"\u622a\u53d6\u4e00\u5e27\", Toast.LENGTH_SHORT).show());\n                }\n                imageProxy.close(); // \u6700\u540e\u8981\u5173\u95ed\u8fd9\u4e2a\n            });\n        });\n        mBinding.clrAna.setOnClickListener(v -&gt; {\n            mImageAnalysis.clearAnalyzer();\n            Toast.makeText(getApplicationContext(), \"clearAnalyzer\", Toast.LENGTH_SHORT).show();\n        });\n        mBinding.zoomIv.setOnClickListener(v -&gt; {\n            if (mIsSmallWindow) {\n                toBigWindow();\n            } else {\n                toSmallWindow();\n            }\n        });\n\n        mBinding.root.setOnTouchListener((v, event) -&gt; {\n            switch (event.getAction()) {\n                case MotionEvent.ACTION_DOWN:\n                    Log.d(TAG, \"down \" + event);\n                    mLastTx = event.getRawX();\n                    mLastTy = event.getRawY();\n                    return true;\n                case MotionEvent.ACTION_MOVE:\n                    Log.d(TAG, \"move \" + event);\n                    float dx = event.getRawX() - mLastTx;\n                    float dy = event.getRawY() - mLastTy;\n                    mLastTx = event.getRawX();\n                    mLastTy = event.getRawY();\n                    Log.d(TAG, \"  dx: \" + dx + \", dy: \" + dy);\n                    if (mIsSmallWindow) {\n                        WindowManager.LayoutParams lp = getWindow().getAttributes();\n                        int tx = (int) (lp.x + dx);\n                        int ty = (int) (lp.y + dy);\n                        Log.d(TAG, \"move to \" + tx + \", \" + ty);\n                        if (mLimitArea) {\n                            tx = Math.max(lp.width / 2 - mBigWid / 2, tx);\n                            tx = Math.min(mBigWid / 2 - lp.width / 2, tx);\n                            ty = Math.max(lp.height / 2 - mBigHeight / 2, ty);\n                            ty = Math.min(mBigHeight / 2 - lp.height / 2, ty);\n                        }\n                        lp.x = tx;\n                        lp.y = ty;\n                        getWindow().setAttributes(lp);\n                    }\n                    break;\n                case MotionEvent.ACTION_UP:\n                    Log.d(TAG, \"up \" + event);\n                    return true;\n                case MotionEvent.ACTION_CANCEL:\n                    Log.d(TAG, \"cancel \" + event);\n                    return true;\n            }\n            return false;\n        });\n        mBinding.container.post(() -&gt; {\n            mBigWid = mBinding.container.getWidth();\n            mBigHeight = mBinding.container.getHeight();\n            Log.d(TAG, \"container size: \" + mBigWid + \", \" + mBigHeight);\n        });\n    }\n\n    private void bindPreview(ProcessCameraProvider cameraProvider) {\n        if (cameraProvider == null) {\n            Toast.makeText(getApplicationContext(), \"\u6ca1\u83b7\u53d6\u5230\u76f8\u673a\", Toast.LENGTH_SHORT).show();\n            return;\n        }\n        Toast.makeText(getApplicationContext(), \"\u76f8\u673a\u542f\u52a8\", Toast.LENGTH_SHORT).show();\n        Preview preview = new Preview.Builder().build();\n\n        CameraSelector cameraSelector = new CameraSelector.Builder()\n                .requireLensFacing(CameraSelector.LENS_FACING_BACK)\n                .build();\n\n        preview.setSurfaceProvider(mBinding.previewView.getSurfaceProvider());\n\n        cameraProvider.bindToLifecycle(this, cameraSelector, preview, mImageAnalysis);\n        mRunning = true;\n    }\n\n    private void toSmallWindow() {\n        mBinding.funcField.setVisibility(View.GONE);\n        mIsSmallWindow = true;\n        mBinding.zoomIv.setImageResource(R.drawable.me_to_big);\n\n        android.view.WindowManager.LayoutParams p = getWindow().getAttributes();\n        p.height = 480;\n        p.width = 360;\n        p.dimAmount = 0.0f;\n        getWindow().setAttributes(p);\n    }\n\n    private void toBigWindow() {\n        WindowManager.LayoutParams lp = getWindow().getAttributes();\n        lp.x = 0;\n        lp.y = 0;\n        getWindow().setAttributes(lp);\n\n        getWindow().setLayout(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.MATCH_PARENT);\n        mBinding.funcField.setVisibility(View.VISIBLE);\n        mIsSmallWindow = false;\n        mBinding.zoomIv.setImageResource(R.drawable.me_ic_to_small);\n    }\n}\n</code></pre>"},{"location":"android/jetpack/camerax/preview-floating-window/#_7","title":"\u8fd0\u884c\u6d4b\u8bd5","text":"<p>\u8fd0\u884c\u5230\u624b\u673a\u4e0a\uff0c\u6253\u5f00\u8fd9\u4e2aActivity\u5c31\u53ef\u4ee5\u770b\u5230\u6444\u50cf\u5934\u9884\u89c8\u3002\u56fe\u50cf\u5bbd\u9ad8\u6bd4\u6b63\u5e38\uff0c\u6ca1\u6709\u62c9\u4f38\u73b0\u8c61\u3002 \u7f29\u5c0f\u6210\u60ac\u6d6e\u7a97\u540e\uff0c\u53ef\u4ee5\u62d6\u52a8\u3002</p> <ul> <li>\u8363\u8000 EMUI 3.1 Lite\uff0cAndroid 5.1 \u8fd0\u884c\u6b63\u5e38</li> <li>Redmi 9A\uff0cMIUI 12.5.1\u7a33\u5b9a\u7248\uff0cAndroid 10 \u8fd0\u884c\u6b63\u5e38</li> </ul>"},{"location":"android/jetpack/camerax/preview-floating-window/#_8","title":"\u5c0f\u7ed3","text":"<p>\u4ece\u7b80\u5355\u7684\u6253\u5f00\u76f8\u673a\u9884\u89c8\u6765\u770b\uff0cCameraX\u7b80\u5316\u4e86\u5f00\u53d1\u8005\u7684\u5de5\u4f5c\u3002\u63d0\u4f9b\u4e86PreviewView\uff0c\u5f00\u53d1\u8005\u4e0d\u9700\u8981\u81ea\u5b9a\u4e49SurfaceView\u6216\u8005TextureView\u3002\u5b9e\u65f6\u9884\u89c8\u4e2d\uff0c\u76f8\u673a\u80fd\u591f\u81ea\u52a8\u5bf9\u7126\u3002\u53ef\u4ee5\u8bd5\u8bd5\u6309home\u952e\u56de\u684c\u9762\uff0c\u6216\u8005\u9501\u5c4f\uff0c\u7136\u540e\u518d\u56de\u6765\u3002</p>"},{"location":"android/jetpack/camerax/preview-floating-window/#_9","title":"\u53c2\u8003","text":"<ul> <li>Android \u5e94\u7528\u5185\u60ac\u6d6e\u7a97</li> <li>Android CameraX \u6253\u5f00\u6444\u50cf\u5934\u9884\u89c8</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a cnblog \u6398\u91d1 oschina csdn</p>"},{"location":"android/jetpack/camerax/simple-preview/","title":"Android CameraX \u6253\u5f00\u6444\u50cf\u5934\u9884\u89c8","text":"\u66f4\u65b0\u65e5\u671f: 2022-5-25 <ul> <li>2022-5-25 \u66f4\u65b0\u683c\u5f0f</li> <li>2021-12-9 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u76ee\u6807\u5f88\u7b80\u5355\uff0c\u7528CameraX\u6253\u5f00\u6444\u50cf\u5934\u9884\u89c8\uff0c\u5b9e\u65f6\u663e\u793a\u5728\u754c\u9762\u4e0a\u3002\u770b\u770bCameraX\u6709\u6ca1\u6709Google\u8bf4\u7684\u90a3\u4e48\u597d\u7528\u3002\u5148\u6309\u6700\u7b80\u5355\u7684\u6765\uff0c\u628a\u9884\u89c8\u663e\u793a\u51fa\u6765\u3002</p>"},{"location":"android/jetpack/camerax/simple-preview/#_1","title":"\u5f15\u5165\u4f9d\u8d56","text":"<p>\u6a21\u5757gradle\u7684\u4e00\u4e9b\u914d\u7f6e\uff0c\u4f7f\u7528\u7684Android SDK\u7248\u672c\u4e3a31\uff0c\u542f\u7528\u4e86databinding <pre><code>apply plugin: 'com.android.application'\napply plugin: 'kotlin-android'\napply plugin: 'kotlin-android-extensions'\napply plugin: 'kotlin-kapt'\n\nandroid {\n    compileSdkVersion 31\n    buildToolsVersion \"31.0.0\"\n    defaultConfig {\n        minSdkVersion 21\n        targetSdkVersion 31\n    }\n    dataBinding {\n        enabled = true\n    }\n}\n</code></pre></p> <p>\u5f15\u5165CameraX\u4f9d\u8d56\uff08CameraX \u6838\u5fc3\u5e93\u662f\u7528camera2\u5b9e\u73b0\u7684\uff09\uff0c\u76ee\u524d\u4e3b\u8981\u7528<code>1.1.0-alpha11</code>\u7248\u672c <pre><code>dependencies {\n    implementation \"androidx.camera:camera-core:1.1.0-alpha11\"\n    implementation \"androidx.camera:camera-camera2:1.1.0-alpha11\"\n    implementation \"androidx.camera:camera-lifecycle:1.1.0-alpha11\"\n    implementation \"androidx.camera:camera-view:1.0.0-alpha31\"\n    implementation \"androidx.camera:camera-extensions:1.0.0-alpha31\"\n}\n</code></pre></p> <p>\u4f7f\u75281.0.2\u7248\u672c\u7684CameraX\u6838\u5fc3\u5e93\u4f1a\u62a5\u9519\uff0c\u627e\u4e0d\u5230<code>getOrCreateInstance</code>\u65b9\u6cd5\u3002</p> NoSuchMethodError getOrCreateInstance <pre><code>CrashHandler: In thread: Thread[main,5,main]\n    UncaughtException detected: java.lang.NoSuchMethodError: No static method getOrCreateInstance(Landroid/content/Context;)Lcom/google/common/util/concurrent/ListenableFuture; in class Landroidx/camera/core/CameraX; or its super classes (declaration of 'androidx.camera.core.CameraX' appears in /data/app/com.rustfisher.tutorial2020-1/base.apk)\n    at androidx.camera.lifecycle.ProcessCameraProvider.getInstance(ProcessCameraProvider.java:149)\n    at com.rustfisher.tutorial2020.camera.SimplePreviewXAct.onCreate(SimplePreviewXAct.java:36)\n    at android.app.Activity.performCreate(Activity.java:6161)\n    at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1112)\n    at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2507)\n    at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:2640)\n    at android.app.ActivityThread.access$800(ActivityThread.java:182)\n    at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1493)\n    at android.os.Handler.dispatchMessage(Handler.java:111)\n    at android.os.Looper.loop(Looper.java:194)\n    at android.app.ActivityThread.main(ActivityThread.java:5682)\n    at java.lang.reflect.Method.invoke(Native Method)\n    at java.lang.reflect.Method.invoke(Method.java:372)\n    at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:963)\n    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:758)\n</code></pre>"},{"location":"android/jetpack/camerax/simple-preview/#_2","title":"\u6743\u9650","text":"<p>\u9700\u8981\u52a8\u6001\u7533\u8bf7<code>android.permission.CAMERA</code>\u6743\u9650 <pre><code>&lt;uses-permission android:name=\"android.permission.CAMERA\" /&gt;\n</code></pre></p> <p>\u672c\u6587\u7565\u8fc7\u52a8\u6001\u7533\u8bf7\u6743\u9650\u7684\u5730\u65b9</p>"},{"location":"android/jetpack/camerax/simple-preview/#_3","title":"\u754c\u9762","text":"<p>CameraX\u4e3a\u5f00\u53d1\u8005\u8d34\u5fc3\u5730\u51c6\u5907\u4e86androidx.camera.view.PreviewView</p> <p>\u628a\u5b83\u653e\u5728\u4e00\u4e2aFrameLayout\u91cc\uff0c\u5982\u4e0b\u7684act_simple_preivew_x.layout <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout&gt;\n    &lt;FrameLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n        android:id=\"@+id/container\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"&gt;\n\n        &lt;androidx.camera.view.PreviewView\n            android:id=\"@+id/previewView\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\" /&gt;\n\n    &lt;/FrameLayout&gt;\n&lt;/layout&gt;\n</code></pre></p>"},{"location":"android/jetpack/camerax/simple-preview/#_4","title":"\u5f00\u542f\u9884\u89c8","text":"<p>\u5728activity\u4e2d\u5f00\u542f\u76f8\u673a\u9884\u89c8</p> <p>SimplePreviewXAct.java<pre><code>import android.os.Bundle;\n\nimport androidx.annotation.NonNull;\nimport androidx.annotation.Nullable;\nimport androidx.appcompat.app.AppCompatActivity;\nimport androidx.camera.core.Camera;\nimport androidx.camera.core.CameraSelector;\nimport androidx.camera.core.Preview;\nimport androidx.camera.lifecycle.ProcessCameraProvider;\nimport androidx.core.content.ContextCompat;\nimport androidx.databinding.DataBindingUtil;\nimport androidx.lifecycle.LifecycleOwner;\n\nimport com.google.common.util.concurrent.ListenableFuture;\n// import com.rustfisher.tutorial2020.R;\n// import com.rustfisher.tutorial2020.databinding.ActSimplePreivewXBinding;\n\nimport java.util.concurrent.ExecutionException;\n\npublic class SimplePreviewXAct extends AppCompatActivity {\n\n    private ActSimplePreivewXBinding mBinding;\n    private ListenableFuture&lt;ProcessCameraProvider&gt; cameraProviderFuture;\n\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        mBinding = DataBindingUtil.setContentView(this, R.layout.act_simple_preivew_x);\n        cameraProviderFuture = ProcessCameraProvider.getInstance(this);\n        cameraProviderFuture.addListener(() -&gt; {\n            try {\n                ProcessCameraProvider cameraProvider = cameraProviderFuture.get();\n                bindPreview(cameraProvider);\n            } catch (ExecutionException | InterruptedException e) {\n                // \u8fd9\u91cc\u4e0d\u7528\u5904\u7406\n            }\n        }, ContextCompat.getMainExecutor(this));\n    }\n\n    void bindPreview(@NonNull ProcessCameraProvider cameraProvider) {\n        Preview preview = new Preview.Builder().build();\n\n        CameraSelector cameraSelector = new CameraSelector.Builder()\n                .requireLensFacing(CameraSelector.LENS_FACING_BACK)\n                .build();\n\n        preview.setSurfaceProvider(mBinding.previewView.getSurfaceProvider());\n\n        Camera camera = cameraProvider.bindToLifecycle(this, cameraSelector, preview);\n    }\n}\n</code></pre> \u6ce8\u610f\u6211\u4eec\u8fd9\u91cc\u4f7f\u7528\u7684\u662f<code>androidx.appcompat.app.AppCompatActivity</code></p> <p>\u4e3a\u4e86\u83b7\u5f97ProcessCameraProvider\uff0c\u7528<code>ProcessCameraProvider.getInstance</code>\u65b9\u6cd5\u62ff\u5230\u4e00\u4e2a<code>cameraProviderFuture</code>\u3002 \u5728<code>cameraProviderFuture</code>\u5b8c\u6210\u540e\u53d6\u51faProcessCameraProvider\uff08<code>cameraProvider</code>\uff09\u3002</p> <p>\u8981\u5f00\u542f\u9884\u89c8\uff0c\u901a\u8fc7<code>Preview.Builder</code>\u6784\u5efa\u4e00\u4e2aPreview\u3002\u7528CameraSelector\u6765\u9009\u62e9\u540e\u7f6e\u6444\u50cf\u5934\u3002 Preview\u7684SurfaceProvider\u7531layout\u4e2d\u7684androidx.camera.view.PreviewView\u63d0\u4f9b\u3002</p> <p><code>cameraProvider.bindToLifecycle</code>\u7ed1\u5b9a\u4e0a\u540e\uff0c\u542f\u52a8\u6444\u50cf\u5934\u9884\u89c8</p>"},{"location":"android/jetpack/camerax/simple-preview/#_5","title":"\u8fd0\u884c\u6d4b\u8bd5","text":"<p>\u8fd0\u884c\u5230\u624b\u673a\u4e0a\uff0c\u6253\u5f00\u8fd9\u4e2aActivity\u5c31\u53ef\u4ee5\u770b\u5230\u6444\u50cf\u5934\u9884\u89c8\u3002\u56fe\u50cf\u5bbd\u9ad8\u6bd4\u6b63\u5e38\uff0c\u6ca1\u6709\u62c9\u4f38\u73b0\u8c61\u3002</p> <ul> <li>\u8363\u8000 EMUI 3.1 Lite\uff0cAndroid 5.1 \u8fd0\u884c\u6b63\u5e38</li> <li>Redmi 9A\uff0cMIUI 12.5.1\u7a33\u5b9a\u7248\uff0cAndroid 10 \u8fd0\u884c\u6b63\u5e38</li> <li>\u4e00\u52a05\uff0cH2OS 10.0.3\uff0cAndroid 10 \u8fd0\u884c\u6b63\u5e38</li> </ul>"},{"location":"android/jetpack/camerax/simple-preview/#_6","title":"\u589e\u52a0\u5f00\u5173","text":"<p>\u5728layout\u91cc\u52a02\u4e2a\u6309\u94ae\uff0c\u63a7\u5236\u76f8\u673a\u5f00\u5173 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout&gt;\n\n    &lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:orientation=\"vertical\"&gt;\n\n        &lt;LinearLayout\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:background=\"@color/colorPrimaryDark\"\n            android:gravity=\"center\"\n            android:orientation=\"horizontal\"\n            android:padding=\"4dp\"&gt;\n\n            &lt;Button\n                android:id=\"@+id/start\"\n                style=\"@style/NormalBtn\"\n                android:layout_width=\"wrap_content\"\n                android:layout_height=\"wrap_content\"\n                android:text=\"\u6253\u5f00\" /&gt;\n\n            &lt;Button\n                android:id=\"@+id/end\"\n                style=\"@style/NormalBtn\"\n                android:layout_width=\"wrap_content\"\n                android:layout_height=\"wrap_content\"\n                android:layout_marginStart=\"12dp\"\n                android:text=\"\u5173\u95ed\" /&gt;\n        &lt;/LinearLayout&gt;\n\n        &lt;FrameLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n            android:id=\"@+id/container\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\"&gt;\n\n            &lt;androidx.camera.view.PreviewView\n                android:id=\"@+id/previewView\"\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"match_parent\" /&gt;\n        &lt;/FrameLayout&gt;\n\n    &lt;/LinearLayout&gt;\n&lt;/layout&gt;\n</code></pre> \u6839layout\u6362\u6210LinearLayout</p> <p>\u4fee\u6539<code>bindPreview</code>\u65b9\u6cd5\uff0c\u5148\u68c0\u67e5\u4f20\u5165\u7684ProcessCameraProvider\u662f\u5426\u4e3a\u7a7a <pre><code>private void bindPreview(ProcessCameraProvider cameraProvider) {\n    if (cameraProvider == null) {\n        Toast.makeText(getApplicationContext(), \"\u6ca1\u83b7\u53d6\u5230\u76f8\u673a\", Toast.LENGTH_SHORT).show();\n        return;\n    }\n    Preview preview = new Preview.Builder().build();\n\n    CameraSelector cameraSelector = new CameraSelector.Builder()\n            .requireLensFacing(CameraSelector.LENS_FACING_BACK)\n            .build();\n\n    preview.setSurfaceProvider(mBinding.previewView.getSurfaceProvider());\n\n    Camera camera = cameraProvider.bindToLifecycle(this, cameraSelector, preview);\n}\n</code></pre></p> <p>\u4fee\u6539\u540e\u7684activity\u90e8\u5206\u4ee3\u7801 <pre><code>import android.os.Bundle;\nimport android.widget.Toast;\nimport androidx.annotation.Nullable;\nimport androidx.appcompat.app.AppCompatActivity;\nimport androidx.camera.core.Camera;\nimport androidx.camera.core.CameraSelector;\nimport androidx.camera.core.Preview;\nimport androidx.camera.lifecycle.ProcessCameraProvider;\nimport androidx.core.content.ContextCompat;\nimport androidx.databinding.DataBindingUtil;\n\nimport com.google.common.util.concurrent.ListenableFuture;\n// import com.rustfisher.tutorial2020.R;\n// import com.rustfisher.tutorial2020.databinding.ActSimplePreivewXBinding;\n\nimport java.util.concurrent.ExecutionException;\n\npublic class SimplePreviewXAct extends AppCompatActivity {\n\n    private ActSimplePreivewXBinding mBinding;\n    private ListenableFuture&lt;ProcessCameraProvider&gt; mCameraProviderFuture;\n    private ProcessCameraProvider mCameraProvider;\n    private boolean mRunning = false;\n\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        mBinding = DataBindingUtil.setContentView(this, R.layout.act_simple_preivew_x);\n        mCameraProviderFuture = ProcessCameraProvider.getInstance(this);\n        mCameraProviderFuture.addListener(() -&gt; {\n            try {\n                mCameraProvider = mCameraProviderFuture.get();\n            } catch (ExecutionException | InterruptedException e) {\n                // \u8fd9\u91cc\u4e0d\u7528\u5904\u7406\n            }\n        }, ContextCompat.getMainExecutor(this));\n        mBinding.start.setOnClickListener(v -&gt; {\n            if (mCameraProvider != null &amp;&amp; !mRunning) {\n                bindPreview(mCameraProvider);\n            }\n        });\n        mBinding.end.setOnClickListener(v -&gt; {\n            mCameraProvider.unbindAll();\n            mRunning = false;\n        });\n    }\n\n    private void bindPreview(ProcessCameraProvider cameraProvider) {\n        if (cameraProvider == null) {\n            Toast.makeText(getApplicationContext(), \"\u6ca1\u83b7\u53d6\u5230\u76f8\u673a\", Toast.LENGTH_SHORT).show();\n            return;\n        }\n        Preview preview = new Preview.Builder().build();\n\n        CameraSelector cameraSelector = new CameraSelector.Builder()\n                .requireLensFacing(CameraSelector.LENS_FACING_BACK)\n                .build();\n\n        preview.setSurfaceProvider(mBinding.previewView.getSurfaceProvider());\n\n        Camera camera = cameraProvider.bindToLifecycle(this, cameraSelector, preview);\n        mRunning = true;\n    }\n}\n</code></pre> \u62ff\u5230<code>mCameraProvider</code>\u540e\u4e0d\u8981\u7acb\u523b\u7ed1\u5b9a\u751f\u547d\u5468\u671f\u3002</p> <p>\u5982\u679c\u8981\u5f00\u542f\u9884\u89c8\uff0c\u5219\u8c03\u7528<code>bindPreview(mCameraProvider)</code>\u3002\u8bb0\u5f55\u4e00\u4e0b\u73b0\u5728\u76f8\u673a\u5df2\u7ecf\u5f00\u542f\u9884\u89c8<code>mRunning = true</code>\u3002</p> <p>\u5982\u679c\u8981\u505c\u6b62\u9884\u89c8\uff0c\u5219\u89e3\u7ed1\u751f\u547d\u5468\u671f<code>mCameraProvider.unbindAll()</code>\u3002\u8fd9\u4e2a\u65b9\u6cd5\u9700\u8981\u5728\u4e3b\u7ebf\u7a0b\u8c03\u7528\u3002</p> <p>\u8fd0\u884c\u8d77\u6765\u540e\uff0c\u53ef\u4ee5\u7528\u6309\u94ae\u6765\u63a7\u5236\u76f8\u673a\u9884\u89c8\u7684\u5f00\u5173\u3002\u76f8\u6bd4\u4e4b\u524d\uff0cPreviewView\u7684\u9ad8\u5ea6\u53d8\u5c0f\u4e86\u4e00\u70b9\uff08\u8ba9\u4e86\u70b9\u4f4d\u7f6e\u7ed9\u6309\u94ae\uff09\u3002 \u4f46\u89c6\u9891\u5bbd\u9ad8\u6bd4\u4f8b\u6b63\u5e38\uff0c\u6ca1\u6709\u88ab\u62c9\u4f38\u3002\u9ed8\u8ba4\u7684\u914d\u7f6e\u4e0b\uff0c\u8fd8\u6709\u81ea\u52a8\u5bf9\u7126\u7684\u529f\u80fd\u3002</p>"},{"location":"android/jetpack/camerax/simple-preview/#_7","title":"\u5c0f\u7ed3","text":"<p>\u4ece\u7b80\u5355\u7684\u6253\u5f00\u76f8\u673a\u9884\u89c8\u6765\u770b\uff0cCameraX\u7b80\u5316\u4e86\u5f00\u53d1\u8005\u7684\u5de5\u4f5c\u3002\u63d0\u4f9b\u4e86PreviewView\uff0c\u5f00\u53d1\u8005\u4e0d\u9700\u8981\u81ea\u5b9a\u4e49SurfaceView\u6216\u8005TextureView\u3002\u5b9e\u65f6\u9884\u89c8\u4e2d\uff0c\u76f8\u673a\u80fd\u591f\u81ea\u52a8\u5bf9\u7126\u3002\u53ef\u4ee5\u8bd5\u8bd5\u6309home\u952e\u56de\u684c\u9762\uff0c\u6216\u8005\u9501\u5c4f\uff0c\u7136\u540e\u518d\u56de\u6765\u3002</p> <p>\u672c\u6587\u7528\u7684\u662f<code>1.1.0-alpha11</code>\uff0cCameraX\u8fd8\u5728\u53d1\u5c55\u4e4b\u4e2d\u3002</p>"},{"location":"android/jetpack/camerax/simple-preview/#_8","title":"\u53c2\u8003","text":"<ul> <li>camerax\u5b9e\u73b0\u9884\u89c8 - developer.android.com</li> <li>https://developer.android.com/jetpack/androidx/releases/camera</li> <li>NoSuchMethodError - stackoverflow</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u534e\u4e3a\u4e91\u793e\u533a \u6398\u91d1</p>"},{"location":"android/jetpack/compose/compose-sample-proj1/","title":"\u5f15\u5165 Jetpack Compose \u793a\u4f8b\u5de5\u7a0b","text":"\u66f4\u65b0\u65e5\u671f: 2021-11-9 <ul> <li>2021-11-9 \u66f4\u65b0\u76ee\u5f55</li> <li>2021-11-2 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u53bbGitHub\u4e0a\u627e\u5230Compose\u7684\u793a\u4f8b\u5de5\u7a0b https://github.com/android/compose-samples \uff0cclone\u5230\u672c\u5730</p> <p>\u7f51\u7edc\u4e0d\u597d\u7684\u540c\u5b66\u4e5f\u53ef\u4ee5\u53bbgitee\u4e0a\u9762\u641c\u7d22\u300ccompose-samples\u300d\uff0c\u4e5f\u80fd\u627e\u5230\u8fd9\u4e2a\u793a\u4f8b\u5de5\u7a0b\u3002</p> <p>\u6211\u7684AndroidStudio\uff08\u540e\u6587\u7b80\u79f0\u201cas\u201d\uff09\u662f4.1.1\u3002\u793a\u4f8b\u5de5\u7a0b\u8981\u6c42Android Studio Arctic Fox\u3002\u5347\u7ea7\u4e00\u4e0bas\u3002</p> \u7248\u672c\u8bf4\u660e <p>\u5728\u4ee5\u524d\u7684\u7f16\u53f7\u7cfb\u7edf\u4e2d\uff0c\u6b64\u7248\u672c\u5e94\u4e3a Android Studio 4.3 \u6216 4.3.0.1\u3002\u91c7\u7528\u5168\u65b0\u7684\u7f16\u53f7\u7cfb\u7edf\u540e\uff0c\u73b0\u5728\u7248\u672c\u4e3a Android Studio - Arctic Fox | 2020.3.1 \u6216 2020.3.1\u3002</p> \u5347\u7ea7\u5230 Arctic Fox <p></p> <p>\u75284.1.1\u6253\u5f00\u4f1a\u62a5\u9519 <pre><code>This version of the Android Support plugin for IntelliJ IDEA (or Android Studio) cannot open this project,\n please retry with version 2020.3.1 or newer.\n</code></pre></p> \u793a\u4f8b\u5de5\u7a0b\u6548\u679c\u56fe <p></p> <p>\u4ed3\u5e93\u91cc\u6709\u591a\u4e2a\u793a\u4f8b\u5de5\u7a0b\uff0c\u4e0b\u9762\u6211\u4eec\u5148\u770bJetNews\u793a\u4f8b\u3002</p>"},{"location":"android/jetpack/compose/compose-sample-proj1/#jetnews","title":"JetNews","text":"<p>as\u6253\u5f00JetNews\u76ee\u5f55\uff0c\u53ef\u80fd\u4f1a\u4e0b\u8f7dgradle-7.1.1-bin.zip\u6216gradle-7.1.1-all.zip\uff0c\u4f1a\u8017\u8d39\u4e00\u4e9b\u65f6\u95f4\u3002 gradle\u4e0b\u8f7d\u5b8c\u6bd5\u540e\uff0c\u8fd8\u4f1a\u4e0b\u8f7d\u5f88\u591a\u5e93\uff0c\u4e5f\u9700\u8981\u65f6\u95f4\u3002</p> <p>gradle\u8dd1\u5b8c\u540e\uff0c\u8fd0\u884c\u4e00\u4e0b\u62a5\u9519</p> Android Gradle plugin requires Java 11 to run <pre><code>Build file '/Users/rustfisher/Desktop/ws/androidProjects/compose-samples/JetNews/app/build.gradle' line: 18\n\nAn exception occurred applying plugin request [id: 'com.android.application']\n&gt; Failed to apply plugin 'com.android.internal.application'.\n&gt; Android Gradle plugin requires Java 11 to run. You are currently using Java 1.8.\n    You can try some of the following options:\n    - changing the IDE settings.\n    - changing the JAVA_HOME environment variable.\n    - changing `org.gradle.java.home` in `gradle.properties`.\n</code></pre> <p>\u66f4\u6539as\u7684\u8bbe\u7f6e <code>Preferences</code> &gt; <code>Build, Execution, Deployment</code> &gt; <code>Build Tools</code> &gt; <code>Gradle</code> &gt; <code>Gradle JDK</code>\u3002 \u9009\u62e9\u4f7f\u7528as\u5e26\u7684 Java 11</p> Gradle JDK <p></p> <p>\u4fee\u6539\u6210as\u81ea\u5e26\u768411\uff0c\u91cd\u542f\u4e00\u6b21as\u3002\u518d\u5c1d\u8bd5\u8fd0\u884c\u5de5\u7a0b\u3002</p> \u8fd0\u884c\u6548\u679c <p></p> \u6ce8\u610f <p>\u4fee\u6539\u8fd9\u4e2a\u5730\u65b9\u6709\u53ef\u80fd\u9020\u6210\u5176\u4ed6\u65e7\u5de5\u7a0b\u7f16\u8bd1\u51fa\u9519</p>"},{"location":"android/jetpack/compose/compose-sample-proj1/#gradle","title":"gradle","text":"<p>\u89c2\u5bdf\u4e00\u4e0bgradle\u3002</p> <p>\u9879\u76ee\u7684gradle <pre><code>buildscript {\n    ext.kotlin_version = '1.5.31'\n    ext.compose_version = '1.1.0-beta01'\n    ext.coroutines_version = '1.5.2'\n    ext.accompanist_version = '0.21.0-beta'\n}\n</code></pre> \u5b9a\u4e49\u4e86\u591a\u79cd\u5e93\u7684\u7248\u672c</p> <p>\u6a21\u5757gradle <pre><code>plugins {\n    id 'com.android.application'\n    id 'kotlin-android'\n}\n</code></pre> <code>plugins</code>\u4e4b\u524d\u5199\u6210<code>apply plugin: 'com.android.application'</code></p> <p><code>dependencies</code>\u91cc\u4e5f\u5f15\u7528\u4e86\u591a\u4e2a<code>androidx.compose</code>\u7684\u4f9d\u8d56</p>"},{"location":"android/jetpack/compose/compose-sample-proj1/#activity","title":"activity","text":"<p>manifest\u4e2d\u4ec5\u4ec5\u6ce8\u518c\u4e86\u4e00\u4e2aMainActivity <pre><code>class MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        WindowCompat.setDecorFitsSystemWindows(window, false)\n\n        val appContainer = (application as JetnewsApplication).container\n        setContent {\n            val windowSizeClass = rememberWindowSizeClass()\n            JetnewsApp(appContainer, windowSizeClass)\n        }\n    }\n}\n</code></pre> \u8fd9\u91cc\u4f7f\u7528\u5230JetnewsApplication\u4e0eJetnewsApp</p>"},{"location":"android/jetpack/compose/compose-sample-proj1/#appcontainer","title":"AppContainer","text":"<p>\u4ece\u8bbe\u8ba1\u4e0a\u6765\u8bf4\uff0cAppContainer\u7ed9\u5e94\u7528\u63d0\u4f9b\u6570\u636e\u4ed3\u5e93\uff0c\u7edf\u4e00\u4e86\u6570\u636e\u6765\u6e90\u3002 <pre><code>// AppContainerImpl.kt\ninterface AppContainer {\n    val postsRepository: PostsRepository\n    val interestsRepository: InterestsRepository\n}\n</code></pre></p> <p>AppContainerImpl\u662f\u6570\u636e\u5b9e\u73b0\u7c7b\uff0c\u63d0\u4f9b\u4e86\u5177\u4f53\u7684\u6570\u636e\u4ed3\u5e93 <pre><code>class AppContainerImpl(private val applicationContext: Context) : AppContainer {\n\n    override val postsRepository: PostsRepository by lazy {\n        FakePostsRepository() // \u6a21\u62df\u6570\u636e\n    }\n\n    override val interestsRepository: InterestsRepository by lazy {\n        FakeInterestsRepository() // \u6a21\u62df\u6570\u636e\n    }\n}\n</code></pre></p>"},{"location":"android/jetpack/compose/compose-sample-proj1/#jetnewsapp","title":"JetnewsApp","text":"<p><code>JetnewsApp</code>\u662f\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5b9a\u4e49\u5728JetnewsApp.kt\u91cc\u3002\u5b83\u9700\u89812\u4e2a\u53c2\u6570\u3002 <pre><code>@Composable\nfun JetnewsApp(\n    appContainer: AppContainer, // \u6570\u636e\u4ed3\u5e93\n    windowSize: WindowSize // \u5c4f\u5e55\u5c3a\u5bf8\u7c7b\u578b\n)   {\n    JetnewsTheme {\n        ProvideWindowInsets { }\n    }\n}\n</code></pre></p> <p>\u65b9\u6cd5\u4e2d\u8c03\u7528<code>JetnewsTheme</code>\u65b9\u6cd5\uff0c\u5176\u4e2d\u4f7f\u7528\u4e86<code>MaterialTheme</code></p> <p>\u5728<code>ProvideWindowInsets</code>\u4e2d\uff0c\u628a\u4e3b\u754c\u9762\u5b9a\u4e49\u597d\u4e86\uff0c\u5176\u4e2d\u5305\u62ec\u4fa7\u6ed1\u62bd\u5c49</p> <p>\u5982\u6b64\u4e00\u5c42\u5957\u4e00\u5c42\uff0c\u6784\u6210\u4e86app\u7684\u5165\u53e3\u754c\u9762\u3002</p> <p>\u4ee3\u7801\u98ce\u683c\u4e0a\uff0ccompose\uff0cflutter\uff0cswift UI \u8fd9\u4e09\u8005\u975e\u5e38\u63a5\u8fd1\u3002</p>"},{"location":"android/jetpack/compose/compose-sample-proj1/#ui","title":"ui","text":"<p>\u5bf9\u4e8eCompose\uff0c\u53ef\u4ee5\u5728as\u4e2d\u4f7f\u7528\u9884\u89c8\u529f\u80fd</p> \u9884\u89c8 <p></p> <p>\u53f3\u8fb9\u80fd\u9884\u89c8\u4eae\u548c\u6697\u4e24\u79cd\u98ce\u683c</p> <p>\u6ce8\u610f\u5de6\u8fb9\u4ee3\u7801\u4e2d\u7684<code>@Preview</code>\u6ce8\u89e3\uff0c\u63a7\u5236\u7740\u53f3\u8fb9\u7684\u9884\u89c8\u753b\u9762 <pre><code>@Preview(\"Post content\")\n@Preview(\"Post content (dark)\", uiMode = UI_MODE_NIGHT_YES)\n@Composable\nfun PreviewPost() {\n    JetnewsTheme {\n        Surface {\n            PostContent(post = post3)\n        }\n    }\n}\n</code></pre></p> <ul> <li><code>@Preview(\"Post content\")</code>\u91cc\u7684\u5b57\u7b26\u4e32\u662f\u9884\u89c8\u7684\u540d\u5b57\uff0c\u663e\u793a\u5728\u76f8\u5e94\u7684\u9884\u89c8\u4e0a\u65b9</li> <li><code>uiMode</code>\u8bbe\u5b9a\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u662f<code>UI_MODE_TYPE_UNDEFINED</code>\uff0c\u8fd9\u91cc\u662f\u660e\u4eae</li> <li>\u8bbe\u7f6e\u4e3a<code>UI_MODE_NIGHT_YES</code> \u5373\u6697\u8272\u98ce\u683c</li> <li>\u98ce\u683c\u5b9a\u4e49\u5728UiMode\u4e2d</li> <li><code>PostContent</code>\u662f\u5b9e\u9645\u5de5\u4f5c\u7684\u4ee3\u7801\uff0c\u4f20\u5165\u7684<code>post3</code>\u662f\u672c\u5730\u9884\u7f6e\u7684\u6d4b\u8bd5\u5185\u5bb9</li> <li><code>post3</code>\u5728PostsData.kt\u4e2d\uff0c\u91cc\u9762\u8fd8\u6709\u66f4\u591a\u7684\u6a21\u62df\u5185\u5bb9</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u6ce8\u610f\u5230\u5f88\u591a<code>@Composable</code>\u6ce8\u89e3\u3002</p> <p>\u8c03\u7528 Jetpack Compose \u51fd\u6570\u6765\u58f0\u660e\u60f3\u8981\u7684\u5143\u7d20\uff0cCompose \u7f16\u8bd1\u5668\u5373\u4f1a\u5b8c\u6210\u540e\u9762\u7684\u6240\u6709\u5de5\u4f5c\u3002</p>"},{"location":"android/jetpack/compose/compose-sample-proj1/#_1","title":"\u53c2\u8003","text":"<p>android-studio-2020.3.1.24-mac.dmg \u94fe\u63a5: https://pan.baidu.com/s/1yGfUjSn6LcUyJiBb2cEfRQ \u63d0\u53d6\u7801: hcbp </p> <ul> <li>\u5c06 Android Studio \u4e0e Jetpack Compose \u914d\u5408\u4f7f\u7528</li> <li>Android Studio \u7248\u672c\u8bf4\u660e</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u6398\u91d1 \u534e\u4e3a\u4e91\u793e\u533a cnblog</p> <p></p> <p>Compose\u7cfb\u5217</p> <ol> <li>\u5f15\u5165 Jetpack Compose \u793a\u4f8b\u5de5\u7a0b</li> <li>\u73b0\u6709\u5de5\u7a0b\u4f7f\u7528Compose </li> </ol> <p></p>"},{"location":"android/jetpack/compose/use-compose-in-proj/","title":"Android\u73b0\u6709\u5de5\u7a0b\u4f7f\u7528Compose","text":"\u66f4\u65b0\u65e5\u671f 2021-11-9 <ul> <li>2021-11-9 \u66f4\u65b0\u76ee\u5f55</li> <li>2021-11-3 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u770b\u4e86Compose\u7684\u793a\u4f8b\u5de5\u7a0b\u540e\uff0c\u6211\u4eec\u4e5f\u60f3\u4f7f\u7528Compose\u3002\u57fa\u4e8e\u76ee\u524d\u60c5\u51b5\uff0c\u5728\u73b0\u6709\u5de5\u7a0b\u57fa\u7840\u4e0a\u6dfb\u52a0Compose\u529f\u80fd\u3002</p>"},{"location":"android/jetpack/compose/use-compose-in-proj/#compose","title":"\u5f15\u5165Compose","text":"<p>\u9996\u5148\u6211\u4eec\u5b89\u88c5 Android Studio Arctic Fox \u6216\u66f4\u9ad8\u7248\u672c\u3002</p> <p>\u9879\u76ee\u7684\u914d\u7f6e<code>gradle/wrapper/gradle-wrapper.properties</code> <pre><code>distributionUrl=https\\://services.gradle.org/distributions/gradle-7.1.1-bin.zip\n</code></pre></p> <p>\u9879\u76ee\u7684gradle <pre><code>buildscript {\n    ext.kotlin_version = '1.5.21'\n\n    repositories {\n        google()\n        mavenCentral()\n    }\n    dependencies {\n        classpath 'com.android.tools.build:gradle:7.0.3'\n        classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version\"\n    }\n}\n\nallprojects {\n    repositories {\n        google()\n        mavenCentral()\n    }\n}\n</code></pre> \u4f7f\u75287.0.3 Android Gradle \u63d2\u4ef6\u3002kotlin\u7248\u672c1.5.31</p> <p>\u6a21\u5757\u7684gradle\u3002\u6700\u4f4eAPI\u7ea7\u522b\u8bbe\u7f6e\u4e3a21\u6216\u66f4\u9ad8\uff0c\u542f\u7528 Jetpack Compose\u3002\u53e6\u5916\u8fd8\u8981\u8bbe\u7f6e Kotlin \u7f16\u8bd1\u5668\u63d2\u4ef6\u7684\u7248\u672c\u3002 <pre><code>apply plugin: 'kotlin-android' // \u6cbf\u7528\u5f00\u5934\u7684\u8bbe\u7f6e\n\nandroid {\n    compileSdkVersion 30\n    buildToolsVersion \"30.0.2\"\n\n    defaultConfig {\n        minSdkVersion 21\n        // ...\n    }\n    buildFeatures {\n        // \u542f\u7528 Jetpack Compose\n        compose true\n    }\n\n    kotlinOptions {\n        jvmTarget = \"1.8\"\n    }\n\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n\n    composeOptions {\n        kotlinCompilerExtensionVersion '1.0.1'\n    }\n}\n</code></pre></p> <p>\u4f9d\u8d56 <pre><code>    // Integration with activities\n    implementation 'androidx.activity:activity-compose:1.3.1'\n    // Compose Material Design\n    implementation 'androidx.compose.material:material:1.0.1'\n    // Animations\n    implementation 'androidx.compose.animation:animation:1.0.1'\n    // Tooling support (Previews, etc.)\n    implementation 'androidx.compose.ui:ui-tooling:1.0.1'\n    // Integration with ViewModels\n    implementation 'androidx.lifecycle:lifecycle-viewmodel-compose:1.0.0-alpha07'\n    // UI Tests\n    androidTestImplementation 'androidx.compose.ui:ui-test-junit4:1.0.1'\n</code></pre></p> <p>as\u7684 <code>Build. Execution, Deployment</code> - <code>Build Tools</code> - <code>Gradle</code> - <code>Gradle JDk</code> \u9009\u62e9as\u81ea\u5e26\u7684Jre11</p>"},{"location":"android/jetpack/compose/use-compose-in-proj/#compose_1","title":"\u4f7f\u7528Compose","text":""},{"location":"android/jetpack/compose/use-compose-in-proj/#activity","title":"\u65b0Activity","text":"<p>\u524d\u9762\u7684gradle\u8bbe\u7f6e\u5b8c\u6bd5\uff0c\u65b0\u5efa\u4e00\u4e2aactivity\u6765\u8bd5\u4e00\u4e0b\u3002 <pre><code>// ComposeGuideAct.kt\nimport android.os.Bundle\nimport androidx.activity.compose.setContent\nimport androidx.appcompat.app.AppCompatActivity\nimport androidx.compose.foundation.layout.Column\nimport androidx.compose.material.Text\nimport androidx.compose.runtime.Composable\nimport androidx.compose.ui.graphics.Color\nimport androidx.compose.ui.tooling.preview.Preview\n\nclass ComposeGuideAct : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContent {\n            GuidePage()\n        }\n    }\n}\n\n@Composable\nprivate fun GuidePage() {\n    Column {\n        Text(text = \"Compose \u793a\u4f8b\", color = Color.Yellow)\n        Text(text = \"an.rustfisher.com\", color = Color.Yellow)\n        ShowHello(name = \"\u5c0f\u660e\")\n        ShowHello(name = \"\u5c0f\u5f3a\")\n    }\n}\n\n@Composable\nprivate fun ShowHello(name: String) {\n    Text(text = \"Hi $name\", color = Color.Cyan)\n}\n</code></pre> <code>onCreate</code>\u4e2d\u4f7f\u7528<code>setContent</code>\uff0c\u4f20\u5165\u4e00\u4e2a\u5e26\u6709<code>@Composable</code>\u6ce8\u89e3\u7684\u53ef\u7ec4\u5408\u51fd\u6570<code>GuidePage()</code>\u3002 \u800c<code>GuidePage()</code>\u91cc\u9762\u53c8\u4f7f\u7528\u4e86<code>ShowHello</code>\u3001<code>Column</code>\u548c<code>Text</code>\u3002\u5b83\u4eec\u90fd\u662f\u53ef\u7ec4\u5408\u51fd\u6570\u3002</p> <p>\u5bf9\u4e8e<code>GuidePage()</code>\u548c<code>ShowHello</code>\u51fd\u6570\uff0c\u9700\u8981\u6ce8\u610f\uff1a</p> <ul> <li>\u5b83\u4eec\u5e26\u6709<code>@Composable</code>\u6ce8\u89e3\u3002\u6240\u6709\u7684\u53ef\u7ec4\u5408\u51fd\u6570\u90fd\u5fc5\u987b\u5e26\u6709\u6b64\u6ce8\u89e3\u3002\u5b83\u80fd\u544a\u8bc9Compose\u7f16\u8bd1\u5668\uff0c\u628a\u8fd9\u6570\u636e\u8f6c\u6362\u4e3a\u754c\u9762</li> <li>\u53ef\u7ec4\u5408\u51fd\u6570\u53ef\u4ee5\u63a5\u53d7\u4e00\u4e9b\u53c2\u6570\uff0c\u8fd9\u4e9b\u53c2\u6570\u53ef\u8fdb\u884c\u903b\u8f91\u5904\u7406\u3002\u4e0a\u9762\u4ee3\u7801\u91cc\uff0c<code>ShowHello(name: String)</code>\u63a5\u53d7\u4e00\u4e2a <code>name:String</code></li> <li>\u51fd\u6570\u53ef\u4ee5\u5728\u754c\u9762\u4e2d\u663e\u793a\u6587\u672c\u3002\u8c03\u7528 <code>Text()</code> \u53ef\u7ec4\u5408\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u5b9e\u9645\u4e0a\u4f1a\u521b\u5efa\u6587\u672c\u754c\u9762\u5143\u7d20\u3002\u53ef\u7ec4\u5408\u51fd\u6570\u901a\u8fc7\u8c03\u7528\u5176\u4ed6\u53ef\u7ec4\u5408\u51fd\u6570\u6765\u53d1\u51fa\u754c\u9762\u5c42\u6b21\u7ed3\u6784</li> <li>\u51fd\u6570\u4e0d\u4f1a\u8fd4\u56de\u4efb\u4f55\u5185\u5bb9\u3002\u53d1\u51fa\u754c\u9762\u7684 Compose \u51fd\u6570\u4e0d\u9700\u8981\u8fd4\u56de\u4efb\u4f55\u5185\u5bb9\uff0c\u56e0\u4e3a\u5b83\u4eec\u63cf\u8ff0\u6240\u9700\u7684\u5c4f\u5e55\u72b6\u6001\uff0c\u800c\u4e0d\u662f\u6784\u9020\u754c\u9762\u5fae\u4ef6\u3002</li> </ul> <p>\u522b\u5fd8\u4e86\u5728manifest\u91cc\u6ce8\u518c\u8fd9\u4e2aactivity\u3002\u8fd0\u884c\u8d77\u6765\u53ef\u4ee5\u770b\u5230\u6548\u679c\u3002 \u81f3\u6b64\u6211\u4eec\u53ef\u4ee5\u8bf4\u73b0\u6709\u9879\u76ee\u5df2\u7ecf\u5f15\u5165\u4e86Compose\u3002</p>"},{"location":"android/jetpack/compose/use-compose-in-proj/#_1","title":"\u6dfb\u52a0\u9884\u89c8","text":"<p>\u53ef\u4ee5\u7ed9Compose\u6dfb\u52a0\u9884\u89c8\uff0c\u4f7f\u7528\u6ce8\u89e3<code>@Preview</code></p> <p>\u5728\u4e0a\u9762\u7684\u57fa\u7840\u4e0a\uff0c\u6dfb\u52a0\u9884\u89c8\u8bbe\u7f6e <pre><code>@Preview(\"guide\")\n@Preview(\"guide - big\",fontScale = 1.2f)\n@Composable\nfun PreviewPost() {\n    GuidePage()\n}\n</code></pre> \u6dfb\u52a02\u4e2a\u9884\u89c8\uff0c\u5206\u522b\u8d77\u540d\u201cguide\u201d\u548c\u201cguide - big\u201d\u3002\u540e\u8005\u628a\u5b57\u4f53\u8c03\u5927\u4e00\u70b9\u3002</p> <p><code>PreviewPost()</code>\u65b9\u6cd5\u91cc\u4f7f\u7528\u4e86\u6211\u4eec\u4e4b\u524d\u5b9a\u4e49\u7684<code>GuidePage()</code>\u3002<code>GuidePage()</code>\u4e5f\u662f\u5b9e\u9645\u5de5\u4f5c\u4e2d\u7684\u4ee3\u7801\u3002</p> <p>\u9700\u8981\u9884\u89c8\u7684\u65b9\u6cd5\uff0c\u4e5f\u9700\u8981\u6dfb\u52a0<code>@Composable</code>\u6ce8\u89e3</p> Android Studio \u9884\u89c8\u6548\u679c <p></p> <p>\u9884\u89c8\u754c\u9762\u4e5f\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c\u5230\u624b\u673a\u4e0a</p>"},{"location":"android/jetpack/compose/use-compose-in-proj/#_2","title":"\u5c0f\u7ed3","text":"<p>\u8981\u5728\u73b0\u6709\u5de5\u7a0b\u4e2d\u5f15\u5165Compose\uff0c\u9700\u8981\u5bf9gradle\u8fdb\u884c\u8bbe\u7f6e\u3002\u5bf9\u8001\u65e7\u5de5\u7a0b\u6765\u8bf4\uff0c\u53d8\u52a8\u6bd4\u8f83\u5927\u3002\u751a\u81f3\u67d0\u4e9b\u4ee3\u7801\u4e5f\u8981\u8ddf\u7740\u6539\u3002</p> <p>\u53ef\u7ec4\u5408\u51fd\u6570\u4f7f\u7528<code>@Composable</code>\u6ce8\u89e3\u3002\u53ef\u4ee5\u7528as\u76f4\u63a5\u9884\u89c8\u3002</p>"},{"location":"android/jetpack/compose/use-compose-in-proj/#_3","title":"\u53c2\u8003","text":"<ul> <li>Jetpack Compose \u6559\u7a0b - Google</li> <li>\u5c06 Jetpack Compose \u6dfb\u52a0\u5230\u5e94\u7528\u4e2d - Google</li> <li>\u5f15\u5165 Jetpack Compose \u793a\u4f8b\u5de5\u7a0b</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u6398\u91d1 \u534e\u4e3a\u4e91\u793e\u533a cnblog </p> <p></p> <p>Compose\u7cfb\u5217</p> <ol> <li>\u5f15\u5165 Jetpack Compose \u793a\u4f8b\u5de5\u7a0b</li> <li>\u73b0\u6709\u5de5\u7a0b\u4f7f\u7528Compose </li> </ol> <p></p>"},{"location":"android/jetpack/dataBinding/binding_adapters_custom_adapter/","title":"\u7ed1\u5b9a\u9002\u914d\u5668","text":"\u66f4\u65b0\u65e5\u671f 2020-4-20 <ul> <li>2020-4-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u7ed1\u5b9a\u9002\u914d\u5668\u8d1f\u8d23\u53d1\u51fa\u76f8\u5e94\u7684\u6846\u67b6\u8c03\u7528\u6765\u8bbe\u7f6e\u503c\u3002\u4f8b\u5982\uff0c\u8bbe\u7f6e\u5c5e\u6027\u503c\u5c31\u50cf\u8c03\u7528 <code>setText()</code> \u65b9\u6cd5\u4e00\u6837\u3002\u518d\u6bd4\u5982\uff0c\u8bbe\u7f6e\u4e8b\u4ef6\u76d1\u542c\u5668\u5c31\u50cf\u8c03\u7528 <code>setOnClickListener()</code> \u65b9\u6cd5\u3002</p>"},{"location":"android/jetpack/dataBinding/binding_adapters_custom_adapter/#_2","title":"\u63d0\u4f9b\u81ea\u5b9a\u4e49\u903b\u8f91","text":""},{"location":"android/jetpack/dataBinding/binding_adapters_custom_adapter/#_3","title":"\u6846\u67b6\u63d0\u4f9b\u7684\u9002\u914d\u5668","text":"<p>\u67d0\u4e9b\u7279\u6027\u9700\u8981\u81ea\u5b9a\u4e49\u7ed1\u5b9a\u903b\u8f91\u3002\u4f8b\u5982\uff0c<code>android:paddingLeft</code> \u7279\u6027\u6ca1\u6709\u5173\u8054\u7684 setter\uff0c\u800c\u662f\u63d0\u4f9b\u4e86 <code>setPadding(left, top, right, bottom)</code> \u65b9\u6cd5\u3002\u4f7f\u7528 BindingAdapter \u6ce8\u91ca\u7684\u9759\u6001\u7ed1\u5b9a\u9002\u914d\u5668\u65b9\u6cd5\u652f\u6301\u81ea\u5b9a\u4e49\u7279\u6027 setter \u7684\u8c03\u7528\u65b9\u5f0f\u3002</p> <p>Android \u6846\u67b6\u7c7b\u7684\u7279\u6027\u5df2\u7ecf\u521b\u5efa\u4e86 BindingAdapter \u6ce8\u91ca\u3002 \u4f8b\u5982\uff0c\u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u4e86 paddingLeft \u7279\u6027\u7684\u7ed1\u5b9a\u9002\u914d\u5668\uff0c\u5728<code>androidx.databinding.adapters.ViewBindingAdapter</code>\u4e2d <pre><code>    @BindingAdapter({\"android:paddingLeft\"})\n    public static void setPaddingLeft(View view, float paddingFloat) {\n        final int padding = pixelsToDimensionPixelSize(paddingFloat);\n        view.setPadding(padding, view.getPaddingTop(), view.getPaddingRight(),\n                view.getPaddingBottom());\n    }\n</code></pre> \u53c2\u6570\u7c7b\u578b\u975e\u5e38\u91cd\u8981\u3002\u7b2c\u4e00\u4e2a\u53c2\u6570\u7528\u4e8e\u786e\u5b9a\u4e0e\u7279\u6027\u5173\u8054\u7684\u89c6\u56fe\u7c7b\u578b\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7528\u4e8e\u786e\u5b9a\u5728\u7ed9\u5b9a\u7279\u6027\u7684\u7ed1\u5b9a\u8868\u8fbe\u5f0f\u4e2d\u63a5\u53d7\u7684\u7c7b\u578b\u3002</p>"},{"location":"android/jetpack/dataBinding/binding_adapters_custom_adapter/#_4","title":"\u81ea\u5b9a\u4e49\u9002\u914d\u5668","text":"<p>\u65b0\u5efa\u7c7b<code>BindingAdapterUtil</code>\uff0c\u6307\u5b9a<code>@BindingAdapter({\"overPaddingLeft\"})</code>\u3002 <code>overPaddingLeft</code>\u5c31\u662flayout\u4e2d\u53ef\u7528\u7684\u8bbe\u7f6e\u3002 <pre><code>public class BindingAdapterUtil {\n\n    @BindingAdapter({\"overPaddingLeft\"})\n    public static void setOverPaddingLeft(View view, float paddingFloat) {\n        final int padding = pixelsToDimensionPixelSize(paddingFloat) + 20; // fake padding!\n        view.setPadding(padding, view.getPaddingTop(), view.getPaddingRight(),\n                view.getPaddingBottom());\n    }\n\n    private static int pixelsToDimensionPixelSize(float pixels) {\n        final int result = (int) (pixels + 0.5f);\n        if (result != 0) {\n            return result;\n        } else if (pixels == 0) {\n            return 0;\n        } else if (pixels &gt; 0) {\n            return 1;\n        } else {\n            return -1;\n        }\n    }\n}\n</code></pre> \u53c2\u6570\u7c7b\u578b\u975e\u5e38\u91cd\u8981\u3002<code>setOverPaddingLeft(View view, float paddingFloat)</code>\u7b2c\u4e00\u4e2a\u53c2\u6570\u7528\u4e8e\u786e\u5b9a\u4e0e\u7279\u6027\u5173\u8054\u7684\u89c6\u56fe\u7c7b\u578b\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7528\u4e8e\u786e\u5b9a\u5728\u7ed9\u5b9a\u7279\u6027\u7684\u7ed1\u5b9a\u8868\u8fbe\u5f0f\u4e2d\u63a5\u53d7\u7684\u7c7b\u578b\u3002</p> <p>layout\u4e2d\u4f7f\u7528\u8fd9\u4e2aBindingAdapter\uff0c\u6ce8\u610f<code>app:overPaddingLeft=\"@{model.paddingLeft}\"</code>\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"&gt;\n    &lt;data&gt;\n        &lt;variable\n            name=\"model\"\n            type=\"com.rustfisher.tutorial2020.databinding.data.BindingAdapterModel\" /&gt;\n    &lt;/data&gt;\n\n    &lt;LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:orientation=\"vertical\"\n        android:padding=\"16dp\"&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:background=\"#f0f0f0\"\n            android:text=\"Rust Fisher. Padding left sample.\"\n            app:overPaddingLeft=\"@{model.paddingLeft}\" /&gt;\n    &lt;/LinearLayout&gt;\n&lt;/layout&gt;\n</code></pre> \u8fd0\u884c\u8d77\u6765\u53ef\u4ee5\u770b\u5230TextView\u7684paddingLeft\u4f1a\u591a\u4e00\u5c0f\u622a\u3002</p> <p>layout\u4e2d\u5982\u679c\u4e0d\u4f7f\u7528<code>@{}</code>\uff0c\u6bd4\u5982\u586b\u5165\u6570\u5b57\uff0c\u7f16\u8bd1\u65f6\u62a5\u9519<code>Android resource linking failed</code> <pre><code>Android resource linking failed\n/Users/rustfisher/Tutorial2020/app/build/intermediates/incremental/mergeDebugResources/stripped.dir/layout/act_data_binding_adapter_1.xml:15: error: attribute overPaddingLeft (aka com.rustfisher.tutorial2020:overPaddingLeft) not found.\nerror: failed linking file resources.\n</code></pre></p> <p>\u5982\u679c\u60a8\u5e0c\u671b\u5728\u8bbe\u7f6e\u4e86\u4efb\u610f\u7279\u6027\u65f6\u8c03\u7528\u9002\u914d\u5668\uff0c\u5219\u53ef\u4ee5\u5c06\u9002\u914d\u5668\u7684\u53ef\u9009 requireAll \u6807\u8bb0\u8bbe\u7f6e\u4e3a false\u3002 \u4f8b\u5982\u4e0b\u9762ImageView\u7684\u793a\u4f8b\u3002 <pre><code>    @BindingAdapter(value={\"imageUrl\", \"placeholder\"}, requireAll=false)\n    public static void setImageUrl(ImageView imageView, String url, Drawable placeHolder) {\n      if (url == null) {\n        imageView.setImageDrawable(placeholder);\n      } else {\n        MyImageLoader.loadInto(imageView, url, placeholder);\n      }\n    }\n</code></pre></p> <p>\u6ce8\u610f\uff1a\u51fa\u73b0\u51b2\u7a81\u65f6\uff0c\u7ed1\u5b9a\u9002\u914d\u5668\u4f1a\u66ff\u6362\u9ed8\u8ba4\u7684\u6570\u636e\u7ed1\u5b9a\u9002\u914d\u5668\u3002</p>"},{"location":"android/jetpack/dataBinding/binding_adapters_cvt_obj/","title":"\u7ed1\u5b9a\u9002\u914d\u5668","text":"\u66f4\u65b0\u65e5\u671f 2020-4-20 <ul> <li>2020-4-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u7ed1\u5b9a\u9002\u914d\u5668\u8d1f\u8d23\u53d1\u51fa\u76f8\u5e94\u7684\u6846\u67b6\u8c03\u7528\u6765\u8bbe\u7f6e\u503c\u3002\u4f8b\u5982\uff0c\u8bbe\u7f6e\u5c5e\u6027\u503c\u5c31\u50cf\u8c03\u7528 setText() \u65b9\u6cd5\u4e00\u6837\u3002\u518d\u6bd4\u5982\uff0c\u8bbe\u7f6e\u4e8b\u4ef6\u76d1\u542c\u5668\u5c31\u50cf\u8c03\u7528 setOnClickListener() \u65b9\u6cd5\u3002</p>"},{"location":"android/jetpack/dataBinding/binding_adapters_cvt_obj/#_2","title":"\u5bf9\u8c61\u8f6c\u6362","text":""},{"location":"android/jetpack/dataBinding/binding_adapters_cvt_obj/#_3","title":"\u81ea\u52a8\u5bf9\u8c61\u8f6c\u6362","text":"<p>\u5f53\u7ed1\u5b9a\u8868\u8fbe\u5f0f\u8fd4\u56de Object \u65f6\uff0c\u5e93\u4f1a\u9009\u62e9\u7528\u4e8e\u8bbe\u7f6e\u5c5e\u6027\u503c\u7684\u65b9\u6cd5\u3002 Object \u4f1a\u8f6c\u6362\u4e3a\u6240\u9009\u65b9\u6cd5\u7684\u53c2\u6570\u7c7b\u578b\u3002\u5bf9\u4e8e\u4f7f\u7528 ObservableMap \u7c7b\u5b58\u50a8\u6570\u636e\u7684\u5e94\u7528\uff0c\u8fd9\u79cd\u884c\u4e3a\u975e\u5e38\u4fbf\u6377\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a</p> <pre><code>&lt;TextView\n    android:text='@{userMap[\"lastName\"]}'\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\" /&gt;\n</code></pre> <p>\u8fd8\u53ef\u4ee5\u4f7f\u7528 <code>object.key</code> \u8868\u793a\u6cd5\u5f15\u7528\u6620\u5c04\u4e2d\u7684\u503c\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0a\u793a\u4f8b\u4e2d\u7684 <code>@{userMap[\"lastName\"]}</code> \u53ef\u66ff\u6362\u4e3a <code>@{userMap.lastName}</code>\u3002</p> <p>\u8868\u8fbe\u5f0f\u4e2d\u7684 userMap \u5bf9\u8c61\u4f1a\u8fd4\u56de\u4e00\u4e2a\u503c\uff0c\u8be5\u503c\u4f1a\u81ea\u52a8\u8f6c\u6362\u4e3a\u7528\u4e8e\u8bbe\u7f6e <code>android:text</code> \u7279\u6027\u503c\u7684 <code>setText(CharSequence)</code> \u65b9\u6cd5\u4e2d\u7684\u53c2\u6570\u7c7b\u578b\u3002</p> <p>\u5982\u679c\u53c2\u6570\u7c7b\u578b\u4e0d\u660e\u786e\uff0c\u5219\u5fc5\u987b\u5728\u8868\u8fbe\u5f0f\u4e2d\u5f3a\u5236\u8f6c\u6362\u8fd4\u56de\u7c7b\u578b\u3002</p>"},{"location":"android/jetpack/dataBinding/binding_adapters_cvt_obj/#_4","title":"\u81ea\u5b9a\u4e49\u8f6c\u6362","text":"<p>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u9700\u8981\u5728\u7279\u5b9a\u7c7b\u578b\u4e4b\u95f4\u8fdb\u884c\u81ea\u5b9a\u4e49\u8f6c\u6362\u3002\u4f8b\u5982\uff0c\u89c6\u56fe\u7684 android:background \u7279\u6027\u9700\u8981 Drawable\uff0c\u4f46\u6307\u5b9a\u7684 color \u503c\u662f\u6574\u6570\u3002\u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u4e86\u67d0\u4e2a\u7279\u6027\u9700\u8981 Drawable\uff0c\u4f46\u7ed3\u679c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6574\u6570\uff1a <pre><code>&lt;View\n    android:background=\"@{isError ? @color/red : @color/white}\"\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"/&gt;\n</code></pre></p> <p>\u6bcf\u5f53\u9700\u8981 Drawable \u4e14\u8fd4\u56de\u6574\u6570\u65f6\uff0cint \u90fd\u5e94\u8f6c\u6362\u4e3a ColorDrawable\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u5e26\u6709 BindingConversion \u6ce8\u91ca\u7684\u9759\u6001\u65b9\u6cd5\u5b8c\u6210\u8fd9\u4e2a\u8f6c\u6362\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>@BindingConversion\npublic static ColorDrawable convertColorToDrawable(int color) {\n    return new ColorDrawable(color);\n}\n</code></pre> <p>\u4f46\u662f\uff0c\u7ed1\u5b9a\u8868\u8fbe\u5f0f\u4e2d\u63d0\u4f9b\u7684\u503c\u7c7b\u578b\u5fc5\u987b\u4fdd\u6301\u4e00\u81f4\u3002\u60a8\u4e0d\u80fd\u5728\u540c\u4e00\u4e2a\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u4e0d\u540c\u7684\u7c7b\u578b\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a <pre><code>&lt;!-- \u4e0d\u80fd\u8fd9\u4e48\u505a --&gt;\n&lt;View\n    android:background=\"@{isError ? @drawable/error : @color/white}\"\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"/&gt;\n</code></pre></p>"},{"location":"android/jetpack/dataBinding/layout-include/","title":"databinding\u4e2d\u7684layout include","text":"\u66f4\u65b0\u65e5\u671f 2020-4-20 <ul> <li>2020-4-20 \u521b\u5efa\u6587\u6863</li> </ul> <p><code>&lt;include&gt;</code>\u6807\u7b7e\u53ef\u4ee5\u5b9e\u73b0\u5728\u4e00\u4e2alayout\u4e2d\u5f15\u7528\u53e6\u4e00\u4e2alayout\u7684\u5e03\u5c40\u3002 \u5bf9\u4e8e\u6709\u7740\u76f8\u540c\u6a21\u5757\u7684\u591a\u4e2alayout\u6765\u8bf4\uff0c\u53ef\u4ee5\u628a\u901a\u7528\u7684\u90e8\u5206\u62bd\u51fa\u6765\u6210\u4e3a\u4e00\u4e2a\u516c\u5171layout\u3002</p>"},{"location":"android/jetpack/dataBinding/layout-include/#_1","title":"\u4f7f\u7528\u65b9\u6cd5","text":"<p>\u4f7f\u7528databinding\u540e\uff0c\u5728layout\u4e2d\u53ef\u80fd\u4f1a\u6709<code>variable</code>\u3002\u6211\u4eec\u662f\u53ef\u4ee5\u628a\u53d8\u91cf\u4f20\u9012\u8fdb\u53bb\u7684\u3002</p> <p>\u9996\u5148\u6765\u770b\u6211\u4eec\u7684\u516c\u5171layout <code>common.xml</code></p> <p><pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout&gt;\n    &lt;data&gt;\n        &lt;variable\n            name=\"viewModel\"\n            type=\"com.rustfisher.t.vm\" /&gt;\n    &lt;/data&gt;\n\n    &lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n        xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n        xmlns:binding=\"http://schemas.android.com/tools\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"&gt;\n    &lt;!-- \u516c\u5171 --&gt;\n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n&lt;/layout&gt;\n</code></pre> <code>common.xml</code>\u4e2d\u6709\u4e00\u4e2a\u53d8\u91cf<code>viewModel</code>\uff0c\u7c7b\u578b\u662f<code>com.rustfisher.t.vm</code>\u3002</p> <p>\u5728\u5176\u4ed6layout\u4e2dinclude\u8fd9\u4e2alayout\u3002\u9700\u8981\u628a\u5916\u56f4\u7684vm\u53d8\u91cf\u4f20\u9012\u8fdb\u53bb\uff0c\u4f7f\u7528<code>app:viewModel=\"@{viewModel}</code>\u6807\u7b7e\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:binding=\"http://schemas.android.com/tools\"&gt;\n    &lt;data&gt;\n        &lt;variable\n            name=\"viewModel\"\n            type=\"com.rustfisher.t.vm\" /&gt;\n    &lt;/data&gt;\n    &lt;androidx.constraintlayout.widget.ConstraintLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"&gt;\n\n        &lt;include\n            android:id=\"@+id/common_layout\"\n            layout=\"@layout/common\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            app:viewModel=\"@{viewModel}\" /&gt;\n\n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n&lt;/layout&gt;\n</code></pre> \u516c\u5171layout\u548c\u4f7f\u7528\u5b83\u7684layout\uff0c\u6301\u6709\u7684\u662f\u540c\u7c7b\u578b\u7684\u53d8\u91cf\u3002\u8fd9\u6837\u6211\u4eec\u5b9e\u73b0\u4e86layout\u7684\u590d\u7528\u3002</p>"},{"location":"android/jetpack/dataBinding/layout-include/#_2","title":"\u4f7f\u7528\u573a\u666f","text":"<p>\u4f7f\u7528\u573a\u666f\u4e00\u4e2a\u662f\u4e0a\u6587\u63cf\u8ff0\u7684\uff0c\u4e0d\u540clayout\u5f15\u7528\u540c\u4e00\u4e2a\u516c\u5171layout\u3002</p> <p>\u53e6\u5916\u4e00\u4e2a\u573a\u666f\uff0c\u6211\u4eec\u53ef\u57fa\u4e8e\u6b64\u6cd5\u5b9e\u73b0\u5c4f\u5e55\u9002\u914d\u3002</p> <p>\u4f8b\u5982\u5728<code>layout</code>\u76ee\u5f55\u548c<code>layout-w600dp</code>\u76ee\u5f55\u4e2d\u90fd\u6709<code>common.xml</code>\u3002 \u5728\u624b\u673a\u548c\u5e73\u677f\u6211\u4eec\u53ef\u4ee5\u5b9e\u73b0\u4e0d\u540c\u7684\u6392\u7248\u3002</p>"},{"location":"android/jetpack/dataBinding/layout_data_intro/","title":"layout\u4e2d\u7684data","text":"\u66f4\u65b0\u65e5\u671f 2020-4-20 <ul> <li>2020-4-20 \u521b\u5efa\u6587\u6863</li> </ul>"},{"location":"android/jetpack/dataBinding/layout_data_intro/#_1","title":"\u5bfc\u5165\u3001\u53d8\u91cf\u548c\u5305\u542b","text":"<p>\u4e3b\u8981\u4ecb\u7ecd\u76843\u4e2a\u65b9\u9762\uff0c\u90fd\u5728<code>&lt;data&gt;</code>\u5185</p> <ul> <li>\u5bfc\u5165 - import</li> <li>\u53d8\u91cf - variable</li> <li>\u5305\u542b - include</li> </ul> <p>\u6570\u636e\u7ed1\u5b9a\u5e93\u63d0\u4f9b\u4e86\u8bf8\u5982\u5bfc\u5165\u3001\u53d8\u91cf\u548c\u5305\u542b\u7b49\u529f\u80fd\u3002\u901a\u8fc7\u5bfc\u5165\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u8f7b\u677e\u5730\u5728\u5e03\u5c40\u6587\u4ef6\u4e2d\u5f15\u7528\u7c7b\u3002\u901a\u8fc7\u53d8\u91cf\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u63cf\u8ff0\u53ef\u5728\u7ed1\u5b9a\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u7684\u5c5e\u6027\u3002 \u901a\u8fc7\u5305\u542b\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u5728\u6574\u4e2a\u5e94\u7528\u4e2d\u91cd\u590d\u4f7f\u7528\u590d\u6742\u7684\u5e03\u5c40\u3002</p>"},{"location":"android/jetpack/dataBinding/layout_data_intro/#_2","title":"\u5bfc\u5165","text":"<p>\u901a\u8fc7\u5bfc\u5165\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u8f7b\u677e\u5730\u5728\u5e03\u5c40\u6587\u4ef6\u4e2d\u5f15\u7528\u7c7b\uff0c\u5c31\u50cf\u5728\u6258\u7ba1\u4ee3\u7801\u4e2d\u4e00\u6837\u3002\u60a8\u53ef\u4ee5\u5728 data \u5143\u7d20\u4f7f\u7528\u591a\u4e2a import \u5143\u7d20\uff0c\u4e5f\u53ef\u4ee5\u4e0d\u4f7f\u7528\u3002\u4ee5\u4e0b\u4ee3\u7801\u793a\u4f8b\u5c06 View \u7c7b\u5bfc\u5165\u5230\u5e03\u5c40\u6587\u4ef6\u4e2d\uff1a <pre><code>&lt;data&gt;\n    &lt;import type=\"android.view.View\"/&gt;\n&lt;/data&gt;\n</code></pre></p> <p>\u5bfc\u5165 View \u7c7b\u53ef\u8ba9\u60a8\u901a\u8fc7\u7ed1\u5b9a\u8868\u8fbe\u5f0f\u5f15\u7528\u8be5\u7c7b\u3002\u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u5f15\u7528 View \u7c7b\u7684 VISIBLE \u548c GONE \u5e38\u91cf\uff1a <pre><code>&lt;TextView\n       android:text=\"@{user.lastName}\"\n       android:layout_width=\"wrap_content\"\n       android:layout_height=\"wrap_content\"\n       android:visibility=\"@{user.isAdult ? View.VISIBLE : View.GONE}\"/&gt;\n</code></pre></p>"},{"location":"android/jetpack/dataBinding/layout_data_intro/#_3","title":"\u7c7b\u578b\u522b\u540d","text":"<p>\u5f53\u7c7b\u540d\u6709\u51b2\u7a81\u65f6\uff0c\u5176\u4e2d\u4e00\u4e2a\u7c7b\u53ef\u4f7f\u7528\u522b\u540d\u91cd\u547d\u540d\u3002\u4ee5\u4e0b\u793a\u4f8b\u5c06 <code>com.example.real.estate</code> \u8f6f\u4ef6\u5305\u4e2d\u7684 View \u7c7b\u91cd\u547d\u540d\u4e3a <code>Vista</code>\uff1a <pre><code>&lt;import type=\"android.view.View\"/&gt;\n&lt;import type=\"com.example.real.estate.View\"\n        alias=\"Vista\"/&gt;\n</code></pre> \u60a8\u53ef\u4ee5\u5728\u5e03\u5c40\u6587\u4ef6\u4e2d\u4f7f\u7528 Vista \u5f15\u7528 <code>com.example.real.estate.View</code>\uff0c\u4f7f\u7528 View \u5f15\u7528 <code>android.view.View</code>\u3002</p>"},{"location":"android/jetpack/dataBinding/layout_data_intro/#_4","title":"\u5bfc\u5165\u5176\u4ed6\u7c7b","text":"<p>\u5bfc\u5165\u7684\u7c7b\u578b\u53ef\u7528\u4f5c\u53d8\u91cf\u548c\u8868\u8fbe\u5f0f\u4e2d\u7684\u7c7b\u578b\u5f15\u7528\u3002\u4ee5\u4e0b\u793a\u4f8b\u663e\u793a\u4e86\u7528\u4f5c\u53d8\u91cf\u7c7b\u578b\u7684 User \u548c List\uff1a <pre><code>&lt;data&gt;\n    &lt;import type=\"com.example.User\"/&gt;\n    &lt;import type=\"java.util.List\"/&gt;\n    &lt;variable name=\"user\" type=\"User\"/&gt;\n    &lt;variable name=\"userList\" type=\"List&amp;lt;User&gt;\"/&gt;\n&lt;/data&gt;\n</code></pre></p> <p>\u8fd8\u53ef\u4ee5\u4f7f\u7528\u5bfc\u5165\u7684\u7c7b\u578b\u6765\u5bf9\u8868\u8fbe\u5f0f\u7684\u4e00\u90e8\u5206\u8fdb\u884c\u7c7b\u578b\u8f6c\u6362\u3002\u4ee5\u4e0b\u793a\u4f8b\u5c06 connection \u5c5e\u6027\u5f3a\u5236\u8f6c\u6362\u4e3a\u7c7b\u578b User\uff1a <pre><code>&lt;TextView\n    android:text=\"@{((User)(user.connection)).lastName}\"\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"/&gt;\n</code></pre></p> <p>\u5728\u8868\u8fbe\u5f0f\u4e2d\u5f15\u7528\u9759\u6001\u5b57\u6bb5\u548c\u65b9\u6cd5\u65f6\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5bfc\u5165\u7684\u7c7b\u578b\u3002\u4ee5\u4e0b\u4ee3\u7801\u4f1a\u5bfc\u5165 MyStringUtils \u7c7b\uff0c\u5e76\u5f15\u7528\u5176 capitalize \u65b9\u6cd5\uff1a <pre><code>&lt;data&gt;\n    &lt;import type=\"com.example.MyStringUtils\"/&gt;\n    &lt;variable name=\"user\" type=\"com.example.User\"/&gt;\n&lt;/data&gt;\n    \u2026\n    &lt;TextView\n       android:text=\"@{MyStringUtils.capitalize(user.lastName)}\"\n       android:layout_width=\"wrap_content\"\n       android:layout_height=\"wrap_content\"/&gt;\n</code></pre></p> <p>\u5c31\u50cf\u5728\u6258\u7ba1\u4ee3\u7801\u4e2d\u4e00\u6837\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u5bfc\u5165 <code>java.lang.*</code>\u3002</p>"},{"location":"android/jetpack/dataBinding/layout_data_intro/#_5","title":"\u53d8\u91cf","text":"<p>\u60a8\u53ef\u4ee5\u5728 data \u5143\u7d20\u4e2d\u4f7f\u7528\u591a\u4e2a variable \u5143\u7d20\u3002\u6bcf\u4e2a variable \u5143\u7d20\u90fd\u63cf\u8ff0\u4e86\u4e00\u4e2a\u53ef\u4ee5\u5728\u5e03\u5c40\u4e0a\u8bbe\u7f6e\u3001\u5e76\u5c06\u5728\u5e03\u5c40\u6587\u4ef6\u4e2d\u7684\u7ed1\u5b9a\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u7684\u5c5e\u6027\u3002\u4ee5\u4e0b\u793a\u4f8b\u58f0\u660e\u4e86 user\u3001image \u548c note \u53d8\u91cf\uff1a <pre><code>&lt;data&gt;\n    &lt;import type=\"android.graphics.drawable.Drawable\"/&gt;\n    &lt;variable name=\"user\" type=\"com.example.User\"/&gt;\n    &lt;variable name=\"image\" type=\"Drawable\"/&gt;\n    &lt;variable name=\"note\" type=\"String\"/&gt;\n&lt;/data&gt;\n</code></pre></p> <p>\u53d8\u91cf\u7c7b\u578b\u5728\u7f16\u8bd1\u65f6\u8fdb\u884c\u68c0\u67e5\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u53d8\u91cf\u5b9e\u73b0 Observable \u6216\u8005\u662f\u53ef\u89c2\u5bdf\u96c6\u5408\uff0c\u5219\u5e94\u53cd\u6620\u5728\u7c7b\u578b\u4e2d\u3002\u5982\u679c\u8be5\u53d8\u91cf\u662f\u4e0d\u5b9e\u73b0 Observable \u63a5\u53e3\u7684\u57fa\u7c7b\u6216\u63a5\u53e3\uff0c\u5219\u53d8\u91cf\u662f\u201c\u4e0d\u53ef\u89c2\u5bdf\u7684\u201d\u3002</p> <p>\u5982\u679c\u4e0d\u540c\u914d\u7f6e\uff08\u4f8b\u5982\u6a2a\u5411\u6216\u7eb5\u5411\uff09\u6709\u4e0d\u540c\u7684\u5e03\u5c40\u6587\u4ef6\uff0c\u5219\u53d8\u91cf\u4f1a\u5408\u5e76\u5728\u4e00\u8d77\u3002\u8fd9\u4e9b\u5e03\u5c40\u6587\u4ef6\u4e4b\u95f4\u4e0d\u5f97\u5b58\u5728\u6709\u51b2\u7a81\u7684\u53d8\u91cf\u5b9a\u4e49\u3002</p> <p>\u5728\u751f\u6210\u7684\u7ed1\u5b9a\u7c7b\u4e2d\uff0c\u6bcf\u4e2a\u63cf\u8ff0\u7684\u53d8\u91cf\u90fd\u6709\u4e00\u4e2a\u5bf9\u5e94\u7684 setter \u548c getter\u3002\u5728\u8c03\u7528 setter \u4e4b\u524d\uff0c\u8fd9\u4e9b\u53d8\u91cf\u4e00\u76f4\u91c7\u7528\u9ed8\u8ba4\u7684\u6258\u7ba1\u4ee3\u7801\u503c\uff0c\u4f8b\u5982\u5f15\u7528\u7c7b\u578b\u91c7\u7528 null\uff0cint \u91c7\u7528 0\uff0cboolean \u91c7\u7528 false\uff0c\u7b49\u7b49\u3002</p> <p>\u7cfb\u7edf\u4f1a\u6839\u636e\u9700\u8981\u751f\u6210\u540d\u4e3a context \u7684\u7279\u6b8a\u53d8\u91cf\uff0c\u7528\u4e8e\u7ed1\u5b9a\u8868\u8fbe\u5f0f\u3002context \u7684\u503c\u662f\u6839\u89c6\u56fe\u7684 getContext() \u65b9\u6cd5\u4e2d\u7684 Context \u5bf9\u8c61\u3002context \u53d8\u91cf\u4f1a\u88ab\u5177\u6709\u8be5\u540d\u79f0\u7684\u663e\u5f0f\u53d8\u91cf\u58f0\u660e\u66ff\u6362\u3002</p>"},{"location":"android/jetpack/dataBinding/layout_data_intro/#_6","title":"\u5305\u542b","text":"<p>\u901a\u8fc7\u4f7f\u7528\u5e94\u7528\u547d\u540d\u7a7a\u95f4\u548c\u7279\u6027\u4e2d\u7684\u53d8\u91cf\u540d\u79f0\uff0c\u53d8\u91cf\u53ef\u4ee5\u4ece\u5305\u542b\u7684\u5e03\u5c40\u4f20\u9012\u5230\u88ab\u5305\u542b\u5e03\u5c40\u7684\u7ed1\u5b9a\u3002 \u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u4e86\u6765\u81ea name.xml \u548c contact.xml \u5e03\u5c40\u6587\u4ef6\u7684\u88ab\u5305\u542b user \u53d8\u91cf\uff1a <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n        xmlns:bind=\"http://schemas.android.com/apk/res-auto\"&gt;\n    &lt;data&gt;\n        &lt;variable name=\"user\" type=\"com.example.User\"/&gt;\n    &lt;/data&gt;\n    &lt;LinearLayout\n        android:orientation=\"vertical\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"&gt;\n        &lt;include layout=\"@layout/name\"\n            bind:user=\"@{user}\"/&gt;\n        &lt;include layout=\"@layout/contact\"\n            bind:user=\"@{user}\"/&gt;\n    &lt;/LinearLayout&gt;\n&lt;/layout&gt;\n</code></pre></p> <p>\u6570\u636e\u7ed1\u5b9a\u4e0d\u652f\u6301 include \u4f5c\u4e3a merge \u5143\u7d20\u7684\u76f4\u63a5\u5b50\u5143\u7d20\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u5e03\u5c40\u4e0d\u53d7\u652f\u6301\uff1a <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n        xmlns:bind=\"http://schemas.android.com/apk/res-auto\"&gt;\n    &lt;data&gt;\n        &lt;variable name=\"user\" type=\"com.example.User\"/&gt;\n    &lt;/data&gt;\n    &lt;merge&gt;&lt;!-- Doesn't work --&gt;\n        &lt;include layout=\"@layout/name\"\n            bind:user=\"@{user}\"/&gt;\n        &lt;include layout=\"@layout/contact\"\n            bind:user=\"@{user}\"/&gt;\n    &lt;/merge&gt;\n&lt;/layout&gt;\n</code></pre></p>"},{"location":"android/jetpack/dataBinding/layout_op/","title":"\u8868\u8fbe\u5f0f\u8bed\u8a00","text":"\u66f4\u65b0\u65e5\u671f 2020-4-20 <ul> <li>2020-4-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>layout\u652f\u6301\u4f7f\u7528\u7684\u4e00\u4e9b\u8868\u8fbe\u5f0f\u3002</p>"},{"location":"android/jetpack/dataBinding/layout_op/#_2","title":"\u5e38\u89c1\u529f\u80fd","text":"<p>\u53ef\u4ee5\u5728layout\u4e2d\u4f7f\u7528\u7684\u8868\u8fbe\u5f0f\u3002</p> <ul> <li>\u7b97\u672f\u8fd0\u7b97\u7b26 + - / * %</li> <li>\u5b57\u7b26\u4e32\u8fde\u63a5\u8fd0\u7b97\u7b26 +</li> <li>\u903b\u8f91\u8fd0\u7b97\u7b26 &amp;&amp; ||</li> <li>\u4e8c\u5143\u8fd0\u7b97\u7b26 &amp; | ^</li> <li>\u4e00\u5143\u8fd0\u7b97\u7b26 + - ! ~</li> <li>\u79fb\u4f4d\u8fd0\u7b97\u7b26 &gt;&gt; &gt;&gt;&gt; &lt;&lt;</li> <li>\u6bd4\u8f83\u8fd0\u7b97\u7b26 == &gt; &lt; &gt;= &lt;=\uff08\u8bf7\u6ce8\u610f\uff0c&lt; \u9700\u8981\u8f6c\u4e49\u4e3a &lt;\uff09</li> <li>instanceof</li> <li>\u5206\u7ec4\u8fd0\u7b97\u7b26 ()</li> <li>\u5b57\u9762\u91cf\u8fd0\u7b97\u7b26 - \u5b57\u7b26\u3001\u5b57\u7b26\u4e32\u3001\u6570\u5b57\u3001null</li> <li>\u7c7b\u578b\u8f6c\u6362</li> <li>\u65b9\u6cd5\u8c03\u7528</li> <li>\u5b57\u6bb5\u8bbf\u95ee</li> <li>\u6570\u7ec4\u8bbf\u95ee []</li> <li>\u4e09\u5143\u8fd0\u7b97\u7b26 ?:</li> </ul> <p>\u793a\u4f8b <pre><code>android:text=\"@{String.valueOf(index + 1)}\"\nandroid:visibility=\"@{user.age &gt; 13 ? View.GONE : View.VISIBLE}\"\nandroid:transitionName='@{\"image_\" + id}'\n</code></pre> \u793a\u4f8b\u4e2d<code>android:transitionName='@{\"image_\" + id}'</code>\uff0c\u6700\u5916\u56f4\u662f\u5355\u5f15\u53f7\uff0c\u91cc\u9762\u7684\u5b57\u7b26\u4e32\u7528\u53cc\u5f15\u53f7\u3002</p>"},{"location":"android/jetpack/dataBinding/layout_op/#_3","title":"\u7f3a\u5c11\u7684\u8fd0\u7b97\uff08\u4e0d\u652f\u6301\uff09","text":"<p>\u4ee5\u4e0b\u529f\u80fd\u662f\u4e0d\u652f\u6301\u7684\u3002</p> <ul> <li>this</li> <li>super</li> <li>new</li> <li>\u663e\u5f0f\u6cdb\u578b\u8c03\u7528</li> </ul>"},{"location":"android/jetpack/dataBinding/layout_op/#null","title":"Null \u5408\u5e76\u8fd0\u7b97\u7b26","text":"<p>\u5224\u65ad\u662f\u5426\u4e3anull\u7684\u66f4\u7b80\u5355\u7684\u65b9\u6cd5\u3002</p> <p>\u793a\u4f8b <pre><code>android:text=\"@{user.displayName ?? user.lastName}\"\n</code></pre></p> <p>\u5728\u529f\u80fd\u4e0a\u7b49\u6548\u4e8e <pre><code>android:text=\"@{user.displayName != null ? user.displayName : user.lastName}\"\n</code></pre></p>"},{"location":"android/jetpack/dataBinding/layout_op/#_4","title":"\u5c5e\u6027\u5f15\u7528","text":"<p>\u8868\u8fbe\u5f0f\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u683c\u5f0f\u5728\u7c7b\u4e2d\u5f15\u7528\u5c5e\u6027\uff0c\u8fd9\u5bf9\u4e8e\u5b57\u6bb5\u3001getter \u548c ObservableField \u5bf9\u8c61\u90fd\u4e00\u6837\uff1a <pre><code>android:text=\"@{user.lastName}\"\n</code></pre></p>"},{"location":"android/jetpack/dataBinding/layout_op/#null_1","title":"\u907f\u514d\u51fa\u73b0 Null \u6307\u9488\u5f02\u5e38","text":"<p>\u751f\u6210\u7684\u6570\u636e\u7ed1\u5b9a\u4ee3\u7801\u4f1a\u81ea\u52a8\u68c0\u67e5\u6709\u6ca1\u6709 null \u503c\u5e76\u907f\u514d\u51fa\u73b0 Null \u6307\u9488\u5f02\u5e38\u3002 \u4f8b\u5982\uff0c\u5728\u8868\u8fbe\u5f0f @{user.name} \u4e2d\uff0c\u5982\u679c user \u4e3a Null\uff0c\u5219\u4e3a user.name \u5206\u914d\u9ed8\u8ba4\u503c null\u3002\u5982\u679c\u60a8\u5f15\u7528 user.age\uff0c\u5176\u4e2d age \u7684\u7c7b\u578b\u4e3a int\uff0c\u5219\u6570\u636e\u7ed1\u5b9a\u4f7f\u7528\u9ed8\u8ba4\u503c 0\u3002</p>"},{"location":"android/jetpack/dataBinding/layout_op/#_5","title":"\u96c6\u5408","text":"<p>\u4e3a\u65b9\u4fbf\u8d77\u89c1\uff0c\u53ef\u4f7f\u7528 [] \u8fd0\u7b97\u7b26\u8bbf\u95ee\u5e38\u89c1\u96c6\u5408\uff0c\u4f8b\u5982\u6570\u7ec4\u3001\u5217\u8868\u3001\u7a00\u758f\u5217\u8868\u548c\u6620\u5c04\u3002</p> <p><pre><code>&lt;data&gt;\n    &lt;import type=\"android.util.SparseArray\"/&gt;\n    &lt;import type=\"java.util.Map\"/&gt;\n    &lt;import type=\"java.util.List\"/&gt;\n    &lt;variable name=\"list\" type=\"List&amp;lt;String&gt;\"/&gt;\n    &lt;variable name=\"sparse\" type=\"SparseArray&amp;lt;String&gt;\"/&gt;\n    &lt;variable name=\"map\" type=\"Map&amp;lt;String, String&gt;\"/&gt;\n    &lt;variable name=\"index\" type=\"int\"/&gt;\n    &lt;variable name=\"key\" type=\"String\"/&gt;\n&lt;/data&gt;\n</code></pre> \u6216\u8005 <pre><code>    android:text=\"@{list[index]}\"\n\n    android:text=\"@{sparse[index]}\"\n\n    android:text=\"@{map[key]}\"\n</code></pre></p> <p>\u6ce8\u610f\uff1a\u8981\u4f7f XML \u4e0d\u542b\u8bed\u6cd5\u9519\u8bef\uff0c\u60a8\u5fc5\u987b\u8f6c\u4e49 &lt; \u5b57\u7b26\u3002\u4f8b\u5982\uff1a\u4e0d\u8981\u5199\u6210 List \u5f62\u5f0f\uff0c\u800c\u662f\u5fc5\u987b\u5199\u6210 <code>List&amp;lt;String&gt;</code>\u3002 <p>\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528 object.key \u8868\u793a\u6cd5\u5728\u6620\u5c04\u4e2d\u5f15\u7528\u503c\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0a\u793a\u4f8b\u4e2d\u7684 @{map[key]} \u53ef\u66ff\u6362\u4e3a @{map.key}\u3002</p>"},{"location":"android/jetpack/dataBinding/layout_op/#_6","title":"\u5b57\u7b26\u4e32\u5b57\u9762\u91cf","text":"<p>\u60a8\u53ef\u4ee5\u4f7f\u7528\u5355\u5f15\u53f7\u62ec\u4f4f\u7279\u6027\u503c\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u53cc\u5f15\u53f7\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a</p> <p><pre><code>android:text='@{map[\"firstName\"]}'\n</code></pre> \u6ce8\u610f\u4e0a\u9762\u7684\u5355\u5f15\u53f7\u548c\u53cc\u5f15\u53f7\u3002</p> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528\u53cc\u5f15\u53f7\u62ec\u4f4f\u7279\u6027\u503c\u3002\u5982\u679c\u8fd9\u6837\u505a\uff0c\u5219\u8fd8\u5e94\u4f7f\u7528\u53cd\u5355\u5f15\u53f7 ` \u5c06\u5b57\u7b26\u4e32\u5b57\u9762\u91cf\u62ec\u8d77\u6765\uff1a <pre><code>android:text=\"@{map[`firstName`]}\"\n</code></pre></p>"},{"location":"android/jetpack/dataBinding/layout_op/#_7","title":"\u8d44\u6e90","text":"<p>\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u8bed\u6cd5\u8bbf\u95ee\u8868\u8fbe\u5f0f\u4e2d\u7684\u8d44\u6e90\uff1a <pre><code>android:padding=\"@{large? @dimen/largePadding : @dimen/smallPadding}\"\n</code></pre></p> <p>\u683c\u5f0f\u5b57\u7b26\u4e32\u548c\u590d\u6570\u5f62\u5f0f\u53ef\u901a\u8fc7\u63d0\u4f9b\u53c2\u6570\u8fdb\u884c\u6c42\u503c\uff1a <pre><code>android:text=\"@{@string/nameFormat(firstName, lastName)}\"\n\nandroid:text=\"@{@plurals/banana(bananaCount)}\"\n</code></pre></p> <p>\u5f53\u4e00\u4e2a\u590d\u6570\u5e26\u6709\u591a\u4e2a\u53c2\u6570\u65f6\uff0c\u5e94\u4f20\u9012\u6240\u6709\u53c2\u6570\uff1a <pre><code>      Have an orange\n      Have %d oranges\n\n    android:text=\"@{@plurals/orange(orangeCount, orangeCount)}\"\n</code></pre></p> <p>\u67d0\u4e9b\u8d44\u6e90\u9700\u8981\u663e\u5f0f\u7c7b\u578b\u6c42\u503c\uff0c\u5982\u4e0b\u8868\u6240\u793a\uff1a</p> \u7c7b\u578b \u5e38\u89c4\u5f15\u7528 \u8868\u8fbe\u5f0f\u5f15\u7528 String[] @array @stringArray int[] @array @intArray TypedArray @array @typedArray Animator @animator @animator StateListAnimator @animator @stateListAnimator color int @color @color ColorStateList @color @colorStateList"},{"location":"android/jetpack/dataBinding/layout_op/#_8","title":"\u4e8b\u4ef6\u5904\u7406","text":"<p>\u901a\u8fc7\u6570\u636e\u7ed1\u5b9a\uff0c\u60a8\u53ef\u4ee5\u7f16\u5199\u4ece\u89c6\u56fe\u5206\u6d3e\u7684\u8868\u8fbe\u5f0f\u5904\u7406\u4e8b\u4ef6\uff08\u4f8b\u5982\uff0conClick() \u65b9\u6cd5\uff09\u3002\u4e8b\u4ef6\u7279\u6027\u540d\u79f0\u7531\u76d1\u542c\u5668\u65b9\u6cd5\u7684\u540d\u79f0\u786e\u5b9a\uff0c\u4f46\u6709\u4e00\u4e9b\u4f8b\u5916\u60c5\u51b5\u3002\u4f8b\u5982\uff0cView.OnClickListener \u6709\u4e00\u4e2a onClick() \u65b9\u6cd5\uff0c\u6240\u4ee5\u8be5\u4e8b\u4ef6\u7684\u7279\u6027\u4e3a <code>android:onClick</code>\u3002</p> <p>\u6709\u4e00\u4e9b\u4e13\u95e8\u9488\u5bf9\u70b9\u51fb\u4e8b\u4ef6\u7684\u4e8b\u4ef6\u5904\u7406\u811a\u672c\uff0c\u8fd9\u4e9b\u5904\u7406\u811a\u672c\u9700\u8981\u4f7f\u7528\u9664 <code>android:onClick</code> \u4ee5\u5916\u7684\u7279\u6027\u6765\u907f\u514d\u51b2\u7a81\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u7279\u6027\u6765\u907f\u514d\u8fd9\u4e9b\u7c7b\u578b\u7684\u51b2\u7a81\uff1a</p> \u7c7b \u76d1\u542c\u5668 setter \u7279\u6027 SearchView setOnSearchClickListener(View.OnClickListener) android:onSearchClick ZoomControls setOnZoomInClickListener(View.OnClickListener) android:onZoomIn ZoomControls setOnZoomOutClickListener(View.OnClickListener) android:onZoomOut <p>\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u673a\u5236\u5904\u7406\u4e8b\u4ef6\uff1a</p> <ul> <li>\u65b9\u6cd5\u5f15\u7528\uff1a\u5728\u8868\u8fbe\u5f0f\u4e2d\uff0c\u60a8\u53ef\u4ee5\u5f15\u7528\u7b26\u5408\u76d1\u542c\u5668\u65b9\u6cd5\u7b7e\u540d\u7684\u65b9\u6cd5\u3002\u5f53\u8868\u8fbe\u5f0f\u6c42\u503c\u7ed3\u679c\u4e3a\u65b9\u6cd5\u5f15\u7528\u65f6\uff0c\u6570\u636e\u7ed1\u5b9a\u4f1a\u5c06\u65b9\u6cd5\u5f15\u7528\u548c\u6240\u6709\u8005\u5bf9\u8c61\u5c01\u88c5\u5230\u76d1\u542c\u5668\u4e2d\uff0c\u5e76\u5728\u76ee\u6807\u89c6\u56fe\u4e0a\u8bbe\u7f6e\u8be5\u76d1\u542c\u5668\u3002\u5982\u679c\u8868\u8fbe\u5f0f\u7684\u6c42\u503c\u7ed3\u679c\u4e3a null\uff0c\u5219\u6570\u636e\u7ed1\u5b9a\u4e0d\u4f1a\u521b\u5efa\u76d1\u542c\u5668\uff0c\u800c\u662f\u8bbe\u7f6e null \u76d1\u542c\u5668\u3002</li> <li>\u76d1\u542c\u5668\u7ed1\u5b9a\uff1a\u8fd9\u4e9b\u662f\u5728\u4e8b\u4ef6\u53d1\u751f\u65f6\u8fdb\u884c\u6c42\u503c\u7684 lambda \u8868\u8fbe\u5f0f\u3002\u6570\u636e\u7ed1\u5b9a\u59cb\u7ec8\u4f1a\u521b\u5efa\u4e00\u4e2a\u8981\u5728\u89c6\u56fe\u4e0a\u8bbe\u7f6e\u7684\u76d1\u542c\u5668\u3002\u4e8b\u4ef6\u88ab\u5206\u6d3e\u540e\uff0c\u76d1\u542c\u5668\u4f1a\u5bf9 lambda \u8868\u8fbe\u5f0f\u8fdb\u884c\u6c42\u503c\u3002</li> </ul>"},{"location":"android/jetpack/dataBinding/layout_op/#_9","title":"\u65b9\u6cd5\u5f15\u7528","text":"<p>\u4e8b\u4ef6\u53ef\u4ee5\u76f4\u63a5\u7ed1\u5b9a\u5230\u5904\u7406\u811a\u672c\u65b9\u6cd5\uff0c\u7c7b\u4f3c\u4e8e\u4e3a Activity \u4e2d\u7684\u65b9\u6cd5\u6307\u5b9a<code>android:onClick</code> \u7684\u65b9\u5f0f\u3002\u4e0e <code>View onClick</code> \u7279\u6027\u76f8\u6bd4\uff0c\u4e00\u4e2a\u4e3b\u8981\u4f18\u70b9\u662f\u8868\u8fbe\u5f0f\u5728\u7f16\u8bd1\u65f6\u8fdb\u884c\u5904\u7406\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u8be5\u65b9\u6cd5\u4e0d\u5b58\u5728\u6216\u5176\u7b7e\u540d\u4e0d\u6b63\u786e\uff0c\u5219\u4f1a\u6536\u5230\u7f16\u8bd1\u65f6\u9519\u8bef\u3002</p> <p>\u65b9\u6cd5\u5f15\u7528\u548c\u76d1\u542c\u5668\u7ed1\u5b9a\u4e4b\u95f4\u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e\u5b9e\u9645\u76d1\u542c\u5668\u5b9e\u73b0\u662f\u5728\u7ed1\u5b9a\u6570\u636e\u65f6\u521b\u5efa\u7684\uff0c\u800c\u4e0d\u662f\u5728\u4e8b\u4ef6\u89e6\u53d1\u65f6\u521b\u5efa\u7684\u3002\u5982\u679c\u60a8\u5e0c\u671b\u5728\u4e8b\u4ef6\u53d1\u751f\u65f6\u5bf9\u8868\u8fbe\u5f0f\u6c42\u503c\uff0c\u5219\u5e94\u4f7f\u7528\u76d1\u542c\u5668\u7ed1\u5b9a\u3002</p> <p>\u8981\u5c06\u4e8b\u4ef6\u5206\u914d\u7ed9\u5176\u5904\u7406\u811a\u672c\uff0c\u8bf7\u4f7f\u7528\u5e38\u89c4\u7ed1\u5b9a\u8868\u8fbe\u5f0f\uff0c\u5e76\u4ee5\u8981\u8c03\u7528\u7684\u65b9\u6cd5\u540d\u79f0\u4f5c\u4e3a\u503c\u3002\u4f8b\u5982\uff0c\u8bf7\u8003\u8651\u4ee5\u4e0b\u5e03\u5c40\u6570\u636e\u5bf9\u8c61\u793a\u4f8b\uff1a</p> <p><pre><code>public class MyHandlers {\n    public void onClickFriend(View view) { ... }\n}\n</code></pre> \u7ed1\u5b9a\u8868\u8fbe\u5f0f\u53ef\u5c06\u89c6\u56fe\u7684\u70b9\u51fb\u76d1\u542c\u5668\u5206\u914d\u7ed9 onClickFriend() \u65b9\u6cd5\uff0c\u5982\u4e0b\u6240\u793a\uff1a <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n    &lt;layout xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n       &lt;data&gt;\n           &lt;variable name=\"handlers\" type=\"com.example.MyHandlers\"/&gt;\n           &lt;variable name=\"user\" type=\"com.example.User\"/&gt;\n       &lt;/data&gt;\n       &lt;LinearLayout\n           android:orientation=\"vertical\"\n           android:layout_width=\"match_parent\"\n           android:layout_height=\"match_parent\"&gt;\n           &lt;TextView android:layout_width=\"wrap_content\"\n               android:layout_height=\"wrap_content\"\n               android:text=\"@{user.firstName}\"\n               android:onClick=\"@{handlers::onClickFriend}\"/&gt;\n       &lt;/LinearLayout&gt;\n    &lt;/layout&gt;\n</code></pre></p> <p>\u6ce8\u610f\uff1a\u8868\u8fbe\u5f0f\u4e2d\u7684\u65b9\u6cd5\u7b7e\u540d\u5fc5\u987b\u4e0e\u76d1\u542c\u5668\u5bf9\u8c61\u4e2d\u7684\u65b9\u6cd5\u7b7e\u540d\u5b8c\u5168\u4e00\u81f4\u3002</p>"},{"location":"android/jetpack/dataBinding/layout_op/#_10","title":"\u76d1\u542c\u5668\u7ed1\u5b9a","text":"<p>\u76d1\u542c\u5668\u7ed1\u5b9a\u662f\u5728\u4e8b\u4ef6\u53d1\u751f\u65f6\u8fd0\u884c\u7684\u7ed1\u5b9a\u8868\u8fbe\u5f0f\u3002\u5b83\u4eec\u7c7b\u4f3c\u4e8e\u65b9\u6cd5\u5f15\u7528\uff0c\u4f46\u5141\u8bb8\u60a8\u8fd0\u884c\u4efb\u610f\u6570\u636e\u7ed1\u5b9a\u8868\u8fbe\u5f0f\u3002\u6b64\u529f\u80fd\u9002\u7528\u4e8e Gradle 2.0 \u7248\u53ca\u66f4\u9ad8\u7248\u672c\u7684 Android Gradle \u63d2\u4ef6\u3002</p> <p>\u5728\u65b9\u6cd5\u5f15\u7528\u4e2d\uff0c\u65b9\u6cd5\u7684\u53c2\u6570\u5fc5\u987b\u4e0e\u4e8b\u4ef6\u76d1\u542c\u5668\u7684\u53c2\u6570\u5339\u914d\u3002\u5728\u76d1\u542c\u5668\u7ed1\u5b9a\u4e2d\uff0c\u53ea\u6709\u60a8\u7684\u8fd4\u56de\u503c\u5fc5\u987b\u4e0e\u76d1\u542c\u5668\u7684\u9884\u671f\u8fd4\u56de\u503c\u76f8\u5339\u914d\uff08\u9884\u671f\u8fd4\u56de\u503c\u65e0\u6548\u9664\u5916\uff09\u3002\u4f8b\u5982\uff0c\u8bf7\u53c2\u8003\u4ee5\u4e0b\u5177\u6709 onSaveClick() \u65b9\u6cd5\u7684 presenter \u7c7b\uff1a</p> <p><pre><code>public class Presenter {\n    public void onSaveClick(Task task){}\n}\n</code></pre> \u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u5c06\u70b9\u51fb\u4e8b\u4ef6\u7ed1\u5b9a\u5230 onSaveClick() \u65b9\u6cd5\uff0c\u5982\u4e0b\u6240\u793a\uff1a <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n    &lt;layout xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n        &lt;data&gt;\n            &lt;variable name=\"task\" type=\"com.android.example.Task\" /&gt;\n            &lt;variable name=\"presenter\" type=\"com.android.example.Presenter\" /&gt;\n        &lt;/data&gt;\n        &lt;LinearLayout android:layout_width=\"match_parent\" android:layout_height=\"match_parent\"&gt;\n            &lt;Button android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\"\n            android:onClick=\"@{() -&gt; presenter.onSaveClick(task)}\" /&gt;\n        &lt;/LinearLayout&gt;\n    &lt;/layout&gt;\n</code></pre> \u5728\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u56de\u8c03\u65f6\uff0c\u6570\u636e\u7ed1\u5b9a\u4f1a\u81ea\u52a8\u4e3a\u4e8b\u4ef6\u521b\u5efa\u5e76\u6ce8\u518c\u5fc5\u8981\u7684\u76d1\u542c\u5668\u3002\u5f53\u89c6\u56fe\u89e6\u53d1\u4e8b\u4ef6\u65f6\uff0c\u6570\u636e\u7ed1\u5b9a\u4f1a\u5bf9\u7ed9\u5b9a\u8868\u8fbe\u5f0f\u6c42\u503c\u3002\u4e0e\u5e38\u89c4\u7ed1\u5b9a\u8868\u8fbe\u5f0f\u4e00\u6837\uff0c\u5728\u5bf9\u8fd9\u4e9b\u76d1\u542c\u5668\u8868\u8fbe\u5f0f\u6c42\u503c\u65f6\uff0c\u4ecd\u4f1a\u83b7\u5f97\u6570\u636e\u7ed1\u5b9a\u7684 Null \u503c\u548c\u7ebf\u7a0b\u5b89\u5168\u3002</p> <p>\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u5c1a\u672a\u5b9a\u4e49\u4f20\u9012\u7ed9 onClick(View) \u7684 view \u53c2\u6570\u3002\u76d1\u542c\u5668\u7ed1\u5b9a\u63d0\u4f9b\u4e24\u4e2a\u76d1\u542c\u5668\u53c2\u6570\u9009\u9879\uff1a\u60a8\u53ef\u4ee5\u5ffd\u7565\u65b9\u6cd5\u7684\u6240\u6709\u53c2\u6570\uff0c\u4e5f\u53ef\u4ee5\u547d\u540d\u6240\u6709\u53c2\u6570\u3002\u5982\u679c\u60a8\u60f3\u547d\u540d\u53c2\u6570\uff0c\u5219\u53ef\u4ee5\u5728\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u8fd9\u4e9b\u53c2\u6570\u3002\u4f8b\u5982\uff0c\u4e0a\u9762\u7684\u8868\u8fbe\u5f0f\u53ef\u4ee5\u5199\u6210\u5982\u4e0b\u5f62\u5f0f\uff1a <pre><code>android:onClick=\"@{(view) -&gt; presenter.onSaveClick(task)}\"\n</code></pre></p> <p>\u6216\u8005\uff0c\u5982\u679c\u60a8\u60f3\u5728\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u53c2\u6570\uff0c\u5219\u91c7\u7528\u5982\u4e0b\u5f62\u5f0f\uff1a <pre><code>public class Presenter {\n    public void onSaveClick(View view, Task task){}\n}\n</code></pre></p> <pre><code>android:onClick=\"@{(theView) -&gt; presenter.onSaveClick(theView, task)}\"\n</code></pre> <p>\u60a8\u53ef\u4ee5\u5728 lambda \u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u591a\u4e2a\u53c2\u6570\uff1a <pre><code>    public class Presenter {\n        public void onCompletedChanged(Task task, boolean completed){}\n    }\n</code></pre></p> <pre><code>&lt;CheckBox android:layout_width=\"wrap_content\" android:layout_height=\"wrap_content\"\n          android:onCheckedChanged=\"@{(cb, isChecked) -&gt; presenter.completeChanged(task, isChecked)}\" /&gt;\n</code></pre> <p>\u5982\u679c\u60a8\u76d1\u542c\u7684\u4e8b\u4ef6\u8fd4\u56de\u7c7b\u578b\u4e0d\u662f void \u7684\u503c\uff0c\u5219\u60a8\u7684\u8868\u8fbe\u5f0f\u4e5f\u5fc5\u987b\u8fd4\u56de\u76f8\u540c\u7c7b\u578b\u7684\u503c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u8981\u76d1\u542c\u957f\u6309\u4e8b\u4ef6\uff0c\u8868\u8fbe\u5f0f\u5e94\u8fd4\u56de\u4e00\u4e2a\u5e03\u5c14\u503c\u3002</p> <pre><code>    public class Presenter {\n        public boolean onLongClick(View view, Task task) { }\n    }\n</code></pre> <pre><code>android:onLongClick=\"@{(theView) -&gt; presenter.onLongClick(theView, task)}\"\n</code></pre> <p>\u5982\u679c\u7531\u4e8e null \u5bf9\u8c61\u800c\u65e0\u6cd5\u5bf9\u8868\u8fbe\u5f0f\u6c42\u503c\uff0c\u5219\u6570\u636e\u7ed1\u5b9a\u5c06\u8fd4\u56de\u8be5\u7c7b\u578b\u7684\u9ed8\u8ba4\u503c\u3002\u4f8b\u5982\uff0c\u5f15\u7528\u7c7b\u578b\u8fd4\u56de null\uff0cint \u8fd4\u56de 0\uff0cboolean \u8fd4\u56de false\uff0c\u7b49\u7b49\u3002</p> <p>\u5982\u679c\u60a8\u9700\u8981\u5c06\u8868\u8fbe\u5f0f\u4e0e\u8c13\u8bcd\uff08\u4f8b\u5982\uff0c\u4e09\u5143\u8fd0\u7b97\u7b26\uff09\u7ed3\u5408\u4f7f\u7528\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 void \u4f5c\u4e3a\u7b26\u53f7\u3002 <pre><code>android:onClick=\"@{(v) -&gt; v.isVisible() ? doSomething() : void}\"\n</code></pre></p>"},{"location":"android/jetpack/dataBinding/layout_op/#_11","title":"\u907f\u514d\u4f7f\u7528\u590d\u6742\u7684\u76d1\u542c\u5668","text":"<p>\u76d1\u542c\u5668\u8868\u8fbe\u5f0f\u529f\u80fd\u975e\u5e38\u5f3a\u5927\uff0c\u53ef\u4ee5\u4f7f\u60a8\u7684\u4ee3\u7801\u975e\u5e38\u6613\u4e8e\u9605\u8bfb\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u5305\u542b\u590d\u6742\u8868\u8fbe\u5f0f\u7684\u76d1\u542c\u5668\u4f1a\u4f7f\u60a8\u7684\u5e03\u5c40\u96be\u4ee5\u9605\u8bfb\u548c\u7ef4\u62a4\u3002\u8fd9\u4e9b\u8868\u8fbe\u5f0f\u5e94\u8be5\u50cf\u5c06\u53ef\u7528\u6570\u636e\u4ece\u754c\u9762\u4f20\u9012\u5230\u56de\u8c03\u65b9\u6cd5\u4e00\u6837\u7b80\u5355\u3002\u60a8\u5e94\u8be5\u5728\u4ece\u76d1\u542c\u5668\u8868\u8fbe\u5f0f\u8c03\u7528\u7684\u56de\u8c03\u65b9\u6cd5\u4e2d\u5b9e\u73b0\u4efb\u4f55\u4e1a\u52a1\u903b\u8f91\u3002</p>"},{"location":"android/jetpack/dataBinding/set_on_click/","title":"\u70b9\u51fb\u4e8b\u4ef6","text":"\u66f4\u65b0\u65e5\u671f 2021-11-3 <ul> <li>2021-11-3 \u66f4\u65b0\u8bf4\u660e</li> <li>2020-4-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>dataBinding\u4e2d\u5982\u4f55\u8bbe\u7f6e\u76d1\u542c\u70b9\u51fb\u4e8b\u4ef6\uff1f</p>"},{"location":"android/jetpack/dataBinding/set_on_click/#onclick","title":"\u70b9\u51fb\u4e8b\u4ef6 onClick","text":""},{"location":"android/jetpack/dataBinding/set_on_click/#_2","title":"\u51c6\u5907\u76d1\u542c\u65b9\u6cd5","text":"<p>\u4ee5<code>MutableDemoVM</code>\u7c7b\u4e3a\u4f8b <pre><code>public class MutableDemoVM {\n    // ... \n\n    public void onClickBack(View view) {\n        // ...\n    }\n\n    public void onClickAdd(View view) {\n        // ...\n    }\n}\n</code></pre> \u91cc\u9762\u76842\u4e2a\u65b9\u6cd5\uff0c<code>onClickBack(View view)</code>\u548c<code>onClickAdd(View view)</code>\u7528\u6765\u8bbe\u7f6e\u70b9\u51fb\u76d1\u542c\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\u6709\u4e00\u4e2aView\u4f5c\u4e3a\u53c2\u6570\u3002\u8fd9\u662f\u56e0\u4e3a\u8981\u5bf9\u5e94\u4e0aView.OnClickListener\u7684<code>onClick(View v)</code>\u65b9\u6cd5\u3002 <pre><code>    public interface OnClickListener {\n        /**\n         * Called when a view has been clicked.\n         *\n         * @param v The view that was clicked.\n         */\n        void onClick(View v);\n    }\n</code></pre></p>"},{"location":"android/jetpack/dataBinding/set_on_click/#layout","title":"layout\u4e2d\u8bbe\u7f6e\u76d1\u542c\u65b9\u6cd5","text":"<p>layout\u4e2d\uff0c\u8bbe\u7f6e<code>android:onClick</code>\u76d1\u542c <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n\n    &lt;data&gt;\n        &lt;variable\n            name=\"vm\"\n            type=\"com.rustfisher.tutorial2020.databinding.data.MutableDemoVM\" /&gt;\n    &lt;/data&gt;\n\n    &lt;LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:orientation=\"vertical\"&gt;\n\n        &lt;LinearLayout\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"50dp\"\n            android:orientation=\"horizontal\"&gt;\n\n            &lt;ImageView\n                android:layout_width=\"50dp\"\n                android:layout_height=\"50dp\"\n                android:onClick=\"@{vm.onClickBack}\"\n                android:padding=\"10dp\"\n                android:src=\"@drawable/ic_arrow_back_black_24dp\" /&gt;\n\n        &lt;/LinearLayout&gt;\n\n        &lt;LinearLayout\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\"\n            android:orientation=\"vertical\"&gt;\n\n            &lt;Button\n                android:layout_width=\"100dp\"\n                android:layout_height=\"50dp\"\n                android:layout_gravity=\"center_horizontal\"\n                android:layout_marginTop=\"20dp\"\n                android:onClick=\"@{vm::onClickAdd}\"\n                android:text=\"+\" /&gt;\n        &lt;/LinearLayout&gt;\n\n    &lt;/LinearLayout&gt;\n&lt;/layout&gt;\n</code></pre> \u8bbe\u7f6e<code>android:onClick</code>\u65f6\uff0c\u5efa\u8bae\u75282\u4e2a\u5192\u53f7<code>@{vm::onClickAdd}</code>\u6765\u5f15\u7528\u65b9\u6cd5\u90fd\u53ef\u4ee5\u3002</p> <p>\u5e94\u8be5\u4f7f\u7528vm::</p> <p>\u968f\u7740Jetpack\u7684\u5347\u7ea7\uff0c\u540e\u9762\u53ea\u75282\u4e2a\u5192\u53f7\u7684\u5f62\u5f0f</p> <p>\u5728activity\u4e2d\u8bbe\u7f6e\u6570\u636e <pre><code>public class MutableDemo1 extends AppCompatActivity {\n\n    private ActMutableDemo1Binding binding;\n    private MutableDemoVM mVM = new MutableDemoVM();\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n\n        binding = DataBindingUtil.setContentView(this, R.layout.act_mutable_demo1);\n        binding.setVm(mVM);\n        // ...\n    }\n\n}\n</code></pre></p>"},{"location":"android/jetpack/dataBinding/set_on_click/#radiobutton-oncheckedchangelistener","title":"RadioButton OnCheckedChangeListener","text":"<p>\u5728\u7c7b\u4e2d\u5b9a\u4e49\u597d\u9009\u62e9\u7684\u65b9\u6cd5\uff0c\u65b9\u6cd5\u7b7e\u540d\u548c<code>CompoundButton.OnCheckedChangeListener.onCheckedChanged(CompoundButton buttonView, boolean isChecked)</code>\u4e00\u81f4\u3002 <pre><code>    public void choose1(CompoundButton buttonView, boolean isChecked) {\n        // ...\n    }\n\n    public void choose2(CompoundButton buttonView, boolean isChecked) {\n        // ...\n    }\n</code></pre></p> <p>\u5728layout\u4e2d\u8bbe\u7f6e\u4f7f\u7528\u65b9\u6cd5\u3002 <pre><code>&lt;RadioGroup\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"&gt;\n\n    &lt;RadioButton\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:onCheckedChanged=\"@{viewModel.choose1}\"\n        android:text=\"\u9009\u98791\"/&gt;\n\n    &lt;RadioButton\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:onCheckedChanged=\"@{viewModel.choose2}\"\n        android:text=\"\u9009\u98792\" /&gt;\n&lt;/RadioGroup&gt;\n</code></pre></p>"},{"location":"android/jetpack/dataBinding/start/","title":"\u4f7f\u7528databinding","text":"\u66f4\u65b0\u65e5\u671f 2022-8-1 <ul> <li>2022-8-1 \u65b0\u7248\u672c SDK 32 \u7528\u6cd5</li> <li>2020-4-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u901a\u8fc7databinding\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u66f4\u8f7b\u677e\u5730\u7f16\u5199\u53ef\u4e0e\u89c6\u56fe\u4ea4\u4e92\u7684\u4ee3\u7801\u3002\u5728\u6a21\u5757\u4e2d\u542f\u7528databinding\u4e4b\u540e\uff0c\u7cfb\u7edf\u4f1a\u4e3a\u8be5\u6a21\u5757\u4e2d\u7684\u6bcf\u4e2a XML \u5e03\u5c40\u6587\u4ef6\u751f\u6210\u4e00\u4e2a\u7ed1\u5b9a\u7c7b\u3002\u7ed1\u5b9a\u7c7b\u7684\u5b9e\u4f8b\u5305\u542b\u5bf9\u5728\u76f8\u5e94\u5e03\u5c40\u4e2d\u5177\u6709 ID \u7684\u6240\u6709\u89c6\u56fe\u7684\u76f4\u63a5\u5f15\u7528\u3002</p> <p>\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0cdatabinding\u4f1a\u66ff\u4ee3 <code>findViewById</code>\u3002\u5f53\u7136\u5b83\u4e0d\u53ea\u662f\u8fd9\u70b9\u4f5c\u7528\u3002</p>"},{"location":"android/jetpack/dataBinding/start/#databinding_1","title":"\u542f\u7528databinding","text":"<p>\u5728\u4f7f\u7528Android SDK 32\u7684\u65f6\u5019\uff0c\u9879\u76eegradle\u6587\u4ef6\u914d\u7f6e\u5982\u4e0b gradle\u4e3b\u8981\u914d\u7f6e<pre><code>android {\n    compileSdk 32\n    buildFeatures {\n        viewBinding true\n    }\n}\n</code></pre> \u76f8\u5bf9\u4e8e\u4e0a\u9762\u8fd9\u91cc\u4fee\u6539\u4e3a\u4f7f\u7528<code>buildFeatures</code></p> <p>layout\u4e2d\u4e0d\u9700\u8981\u505a\u4ec0\u4e48\u7279\u522b\u5904\u7406\u3002</p>"},{"location":"android/jetpack/dataBinding/start/#_1","title":"\u65e7\u7248\u672c","text":"<p>\u542f\u7528databinding\uff0c\u9700\u8981\u5728\u6a21\u5757\u7684gradle\u6587\u4ef6\u4e2d\u6dfb\u52a0 <pre><code>android {\n    // ....\n    dataBinding {\n        enabled true\n    }\n}\n</code></pre></p> <p>\u5728layout\u4e2d\uff0c\u6dfb\u52a0<code>&lt;layout&gt;</code>\u6807\u7b7e\u3002\u4f8b\u5982<code>act_data_binding_1.xml</code>\u6587\u4ef6\u3002 \u5176\u4e2d\u5305\u542b\u4e86data\u6807\u7b7e\u4e0eview\u6807\u7b7e\uff0cview\u6807\u7b7e\u7684\u5185\u5bb9\u5c31\u662f\u4e0d\u4f7f\u7528DataBinding\u65f6\u7684\u666e\u901a\u5e03\u5c40\u5185\u5bb9 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:binding=\"http://schemas.android.com/tools\"&gt;\n\n    &lt;!-- \u6839\u89c6\u56fe --&gt;\n    &lt;LinearLayout.... /&gt;\n\n&lt;/layout&gt;\n</code></pre></p> <p>\u7cfb\u7edf\u4f1a\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u751f\u6210\u7ed1\u5b9a\u7c7b\u7684\u540d\u79f0\uff1a\u5c06 XML\uff08layout\uff09\u6587\u4ef6\u7684\u540d\u79f0\u8f6c\u6362\u4e3a\u9a7c\u5cf0\u5f0f\u5927\u5c0f\u5199\uff0c\u5e76\u5728\u672b\u5c3e\u6dfb\u52a0\u201cBinding\u201d\u4e00\u8bcd\u3002 \u4e0a\u9762\u7684xml\u4f1a\u751f\u6210<code>ActDataBinding1Binding</code>\u7c7b\u3002\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2a\u7c7b\u3002</p>"},{"location":"android/jetpack/dataBinding/start/#java","title":"Java\u4e2d\u8c03\u7528","text":"<p>\u5728<code>DataBindingAct1</code>\u4e2d\uff0c\u4e5f\u9700\u8981\u8c03\u7528<code>setContentView</code>\u3002 <pre><code>public class DataBindingAct1 extends AbsActivity {\n\n    ActDataBinding1Binding binding;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        binding = ActDataBinding1Binding.inflate(getLayoutInflater());\n        setContentView(binding.getRoot());\n\n        binding.tv1.setText(\"\u73b0\u5728\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528layout\u4e2d\u7684TextView\u4e86\");\n        binding.tv2.setText(\"\u53ef\u4ee5\u4e0d\u7528findViewById\");\n    }\n}\n</code></pre></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u4e0d\u7528\u5199\u90a3\u4e48\u591a<code>findViewById</code>\u4e86\u3002\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528<code>binding</code>\u3002 \u6bcf\u4e2a\u7ed1\u5b9a\u7c7b\u8fd8\u5305\u542b\u4e00\u4e2a<code>getRoot()</code>\u65b9\u6cd5\uff0c\u7528\u4e8e\u4e3a\u76f8\u5e94\u5e03\u5c40\u6587\u4ef6\u7684\u6839\u89c6\u56fe\u63d0\u4f9b\u76f4\u63a5\u5f15\u7528\u3002\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c<code>ActDataBinding1Binding</code>\u7c7b\u4e2d\u7684 <code>getRoot()</code> \u65b9\u6cd5\u4f1a\u8fd4\u56de <code>LinearLayout</code> \u6839\u89c6\u56fe\u3002</p>"},{"location":"android/jetpack/dataBinding/start/#databindingutil","title":"\u4f7f\u7528DataBindingUtil","text":"<p>\u524d\u9762\u5728onCreate\u4e2d\u4f7f\u7528\u4e86<code>ActDataBinding1Binding.inflate(getLayoutInflater())</code>\uff0c \u6211\u4eec\u4e5f\u53ef\u4ee5\u6362\u7528<code>DataBindingUtil.setContentView</code>\u3002 <pre><code>@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    binding = DataBindingUtil.setContentView(this, R.layout.act_data_binding_1);\n    // ...\n}\n</code></pre></p>"},{"location":"android/jetpack/dataBinding/start/#binding-findviewbyid","title":"binding \u4e0e findViewById \u7684\u533a\u522b","text":"<p>\u4e0e\u4f7f\u7528 <code>findViewById</code> \u76f8\u6bd4\uff0c\u89c6\u56fe\u7ed1\u5b9a\u5177\u6709\u4e00\u4e9b\u5f88\u663e\u8457\u7684\u4f18\u70b9\uff1a</p> <ul> <li>Null \u5b89\u5168\uff1a\u7531\u4e8e\u89c6\u56fe\u7ed1\u5b9a\u4f1a\u521b\u5efa\u5bf9\u89c6\u56fe\u7684\u76f4\u63a5\u5f15\u7528\uff0c\u56e0\u6b64\u4e0d\u5b58\u5728\u56e0\u89c6\u56fe ID \u65e0\u6548\u800c\u5f15\u53d1 Null \u6307\u9488\u5f02\u5e38\u7684\u98ce\u9669\u3002\u6b64\u5916\uff0c\u5982\u679c\u89c6\u56fe\u4ec5\u51fa\u73b0\u5728\u5e03\u5c40\u7684\u67d0\u4e9b\u914d\u7f6e\u4e2d\uff0c\u5219\u7ed1\u5b9a\u7c7b\u4e2d\u5305\u542b\u5176\u5f15\u7528\u7684\u5b57\u6bb5\u4f1a\u4f7f\u7528 @Nullable \u6807\u8bb0\u3002</li> <li>\u7c7b\u578b\u5b89\u5168\uff1a\u6bcf\u4e2a\u7ed1\u5b9a\u7c7b\u4e2d\u7684\u5b57\u6bb5\u5747\u5177\u6709\u4e0e\u5b83\u4eec\u5728 XML \u6587\u4ef6\u4e2d\u5f15\u7528\u7684\u89c6\u56fe\u76f8\u5339\u914d\u7684\u7c7b\u578b\u3002\u8fd9\u610f\u5473\u7740\u4e0d\u5b58\u5728\u53d1\u751f\u7c7b\u8f6c\u6362\u5f02\u5e38\u7684\u98ce\u9669\u3002</li> </ul> <p>\u8fd9\u4e9b\u5dee\u5f02\u610f\u5473\u7740\u5e03\u5c40\u548c\u4ee3\u7801\u4e4b\u95f4\u7684\u4e0d\u517c\u5bb9\u6027\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7f16\u8bd1\u7248\u672c\u5728\u7f16\u8bd1\u65f6\uff08\u800c\u975e\u8fd0\u884c\u65f6\uff09\u5931\u8d25\u3002</p>"},{"location":"android/jetpack/dataBinding/start/#activity","title":"\u57fa\u7840Activity\u793a\u4f8b","text":"<p>\u6211\u4eec\u8bbe\u8ba1\u4e00\u4e2a\u62bd\u8c61\u7c7b<code>BaseAct</code>\u5c01\u88c5\u4e00\u4e9b\u5e38\u7528\u64cd\u4f5c\uff0c\u5b83\u6307\u5b9a\u4e86\u7ee7\u627f\u81eaViewDataBinding\u7684\u8303\u578b\u3002 <pre><code>/**\n * activity \u62bd\u8c61\u7c7b\n */\npublic abstract class BaseAct&lt;B extends ViewDataBinding&gt; extends AppCompatActivity {\n\n    protected B binding;\n\n    /**\n     * @return \u754c\u9762\u5bf9\u5e94\u7684layout id\n     */\n    protected abstract int getLayoutId();\n\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        binding = DataBindingUtil.setContentView(this, getLayoutId());\n    }\n}\n</code></pre></p> <p>\u5b9e\u73b0\u7c7b\u7ee7\u627f<code>BaseAct</code>\uff0c\u6307\u5b9aViewDataBinding\u7684\u5b50\u7c7b\u540e\uff0c\u76f4\u63a5\u53ef\u4ee5\u4f7f\u7528binding\u5bf9\u8c61\u4e86\u3002 <pre><code>public class MainActivity extends BaseAct&lt;ActMainBinding&gt; {\n\n    @Override\n    protected int getLayoutId() {\n        return R.layout.act_main;\n    }\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        // \u5177\u4f53\u64cd\u4f5c\n    }\n\n    @Override\n    public void onBackPressed() {\n\n    }\n}\n</code></pre></p> <p>\ud83d\udcd6 Observable \ud83d\udcd6 ObservableField</p>"},{"location":"android/jetpack/dataBinding/two_way/","title":"\u53cc\u5411\u6570\u636e\u7ed1\u5b9a","text":"\u66f4\u65b0\u65e5\u671f 2020-4-20 <ul> <li>2020-4-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u9996\u5148\u65b0\u5efa\u7c7b<code>TwoWay</code>\uff0c\u4ee3\u7801\u5982\u4e0b <pre><code>public class TwoWay {\n    public final ObservableField&lt;Boolean&gt; rememberMe = new ObservableField&lt;&gt;(false);\n    public void rememberMeChanged(CompoundButton buttonView, boolean isChecked) {\n        rememberMe.set(isChecked);\n    }\n}\n</code></pre></p> <p>\u4f7f\u7528\u5355\u5411\u6570\u636e\u7ed1\u5b9a\uff0c\u60a8\u53ef\u4ee5\u4e3a\u7279\u6027\u8bbe\u7f6e\u503c\uff0c\u5e76\u8bbe\u7f6e\u5bf9\u8be5\u7279\u6027\u66f4\u6539\u4f5c\u51fa\u53cd\u5e94\u7684\u76d1\u542c\u5668\uff1a <pre><code>&lt;CheckBox\n    android:id=\"@+id/rememberMeCheckBox\"\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"\n    android:checked=\"@{way.rememberMe}\"\n    android:onCheckedChanged=\"@{way.rememberMeChanged}\"\n    android:text=\"Android 2020\" /&gt;\n</code></pre></p> <p>\u53cc\u5411\u6570\u636e\u7ed1\u5b9a\u4e3a\u6b64\u8fc7\u7a0b\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5feb\u6377\u65b9\u5f0f\uff1a <pre><code>&lt;CheckBox\n    android:id=\"@+id/twoWayCb\"\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"\n    android:checked=\"@={way.rememberMe}\"\n    android:text=\"Android 2020 - two way\" /&gt;\n</code></pre> <code>@={}</code>\u8868\u793a\u6cd5\u63a5\u6536\u5c5e\u6027\u7684\u6570\u636e\u66f4\u6539\u5e76\u540c\u65f6\u76d1\u542c\u7528\u6237\u66f4\u65b0\uff0c\u5176\u4e2d\u91cd\u8981\u7684\u662f\u5305\u542b\u201c=\u201d\u7b26\u53f7\u3002</p>"},{"location":"android/jetpack/dataBinding/use_observable/","title":"\u6570\u636e\u7ed1\u5b9a","text":"\u66f4\u65b0\u65e5\u671f 2022-9-1 <ul> <li>2022-9-1 \u66f4\u65b0\u683c\u5f0f</li> <li>2021-6-26 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u524d\u9762\u8bb2\u8ff0\u4e86\u5982\u4f55\u5f00\u59cb\u4f7f\u7528dataBinding\u3002\u672c\u6587\u8bb2\u8ff0\u6570\u636e\u6539\u53d8UI\uff0c\u52a8\u6001\u66f4\u65b0\u7684\u76f8\u5173\u505a\u6cd5\u3002</p>"},{"location":"android/jetpack/dataBinding/use_observable/#observable","title":"\u4f7f\u7528Observable","text":"<p><code>DataBinding</code>\u63d0\u4f9b\u4e86Observable\u63a5\u53e3\u7528\u4e8e\u76d1\u542c\u5b9e\u4f53\u7c7b\u5bf9\u8c61\u5c5e\u6027\u7684\u53d8\u5316\uff0cObservable\u63a5\u53e3\u6709\u5177\u6709\u6dfb\u52a0\u3001\u5220\u9664\u76d1\u542c\u7684\u529f\u80fd\u3002</p> <p>\u4e3a\u4e86\u7b80\u5316\u5f00\u53d1\uff0c<code>DataBinding</code>\u5df2\u7ecf\u4e3a\u6211\u4eec\u5b9e\u73b0\u4e86\u4e00\u4e2a\u57fa\u672c\u7684\u76d1\u542c\u7c7bBaseObservable\uff0c\u5b9e\u4f53\u7c7b\u53ea\u8981\u7ee7\u627fBaseObservable\uff0c\u7136\u540e\u5728get\u65b9\u6cd5\u4e0a\u52a0\u5165<code>@Bindable</code>\u6ce8\u89e3\uff0cset\u65b9\u6cd5\u4e2d\u8c03\u7528<code>notifyPropertyChanged</code>\u901a\u77e5UI\u66f4\u65b0\u5c31\u53ef\u4ee5\u4e86\u3002</p>"},{"location":"android/jetpack/dataBinding/use_observable/#baseobservable","title":"\u7ee7\u627f<code>BaseObservable</code>\u7c7b","text":"<p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u7c7bSysInfo\uff0c\u4ee3\u8868\u7740\u6211\u4eec\u4e1a\u52a1\u4e0a\u7684\u6570\u636e\u3002\u8fd9\u91cc\u7528\u4e00\u4e9b\u7cfb\u7edf\u4fe1\u606f\u6765\u6f14\u793a\u3002</p> SysInfo.java <pre><code>public class SysInfo {\n    private String info1 = Build.MANUFACTURER;\n    private String timeStr = \"\";\n    private long time;\n    // getter setter\n}\n</code></pre> <p>\u8ba9\u5b83\u7ee7\u627fBaseObservable\u7c7b\uff0c\u5e76\u7ed9get\u65b9\u6cd5\u6dfb\u52a0<code>@Bindable</code>\u6ce8\u89e3\u3002</p> SysInfo\u7ee7\u627fBaseObservable\u7c7b <pre><code>public class SysInfo extends BaseObservable {\n\n    private String info1 = Build.MANUFACTURER;\n    private String timeStr = \"\";\n    private long time;\n\n    @Bindable\n    public String getInfo1() {\n        return info1;\n    }\n\n    public void setInfo1(String info1) {\n        this.info1 = info1;\n        notifyPropertyChanged(BR.info1);\n    }\n\n    @Bindable\n    public String getTimeStr() {\n        return timeStr;\n    }\n\n    public void setTimeStr(String timeStr) {\n        this.timeStr = timeStr;\n        notifyPropertyChanged(BR.timeStr);\n    }\n\n    @Bindable\n    public long getTime() {\n        return time;\n    }\n\n    public void setTime(long time) {\n        this.time = time;\n        notifyPropertyChanged(BR.time);\n    }\n}\n</code></pre> <p>\u6b64\u65f6SysInfo\u7c7b\u5df2\u7ecf\u662f\u201c\u53ef\u88ab\u89c2\u6d4b\u201d\u7684\u4e86\u3002</p> <p>set\u65b9\u6cd5\u91cc\u6211\u4eec\u90fd\u4e3b\u52a8\u8c03\u7528\u4e86<code>notifyPropertyChanged</code>\u3002 \u5728get\u65b9\u6cd5\u4e0a\u52a0\u5165<code>@Bindable</code>\u6ce8\u89e3\u540e\uff0c\u7f16\u8bd1\u4e00\u4e0b\u5de5\u7a0b\uff0c<code>DataBinding</code>\u5c31\u4f1a\u5728<code>BR</code>\u6587\u4ef6\u4e2d\u751f\u6210\u76f8\u5e94\u7684\u5b57\u6bb5\u3002</p> <p><code>BR</code>\u662f\u7f16\u8bd1\u671f\u95f4\u751f\u6210\u7684\u7c7b\uff0c\u7c7b\u4f3c\u4e8eR\u6587\u4ef6\u3002</p> <p>\u5b9a\u4e49\u4e00\u4e2a\u5de5\u5177\u7c7b<code>DataUtils</code>\uff0c\u63d0\u4f9b\u9759\u6001\u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u540e\u9762\u4f1a\u5728layout\u4e2d\u7528\u5230\u3002</p> DataUtils <pre><code>public class DataUtils {\n    private static SimpleDateFormat format = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\", Locale.CHINA);\n\n    public static String formatTime(long time) {\n        return format.format(time);\n    }\n}\n</code></pre>"},{"location":"android/jetpack/dataBinding/use_observable/#layout","title":"layout\u5e03\u5c40","text":"<p>\u5728<code>data</code>\u6807\u7b7e\u4e0b\u53ef\u4ee5\u4f7f\u7528\u591a\u4e2a<code>import</code>\u6807\u7b7e\uff0c\u628a\u9700\u8981\u4f7f\u7528\u7684\u7c7b\u5bfc\u5165\u8fdb\u6765\u3002</p> <ul> <li>\u5f15\u5165\uff08<code>import</code>\uff09\u5de5\u5177\u7c7b<code>DataUtils</code>\u3002</li> <li>\u58f0\u660e\uff08<code>variable</code>\uff09\u4f7f\u7528SysInfo\u5bf9\u8c61\u3002\u53d8\u91cf\u540d\u5b9a\u4e3a<code>info</code>\u3002</li> <li>\u7ed9TextView\u8bbe\u7f6e\u663e\u793a\u7684\u5b57\u7b26 <code>android:text=\"@{info.timeStr}\"</code>\uff0c\u5176\u4e2d\u4f7f\u7528\u7684\u662f<code>@{}</code>\u8868\u8fbe\u65b9\u5f0f\u3002</li> <li>\u4f7f\u7528\u5de5\u5177\u7c7b<code>DataUtils</code>\u7684\u65b9\u6cd5\uff0c\u4f7f\u7528\u7684\u4e5f\u662f<code>@{}</code>\u3002</li> </ul> layout <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n\n    &lt;data&gt;\n\n        &lt;import type=\"com.rustfisher.tutorial2020.databinding.DataUtils\" /&gt;\n\n        &lt;variable\n            name=\"info\"\n            type=\"com.rustfisher.tutorial2020.databinding.data.SysInfo\" /&gt;\n    &lt;/data&gt;\n\n    &lt;LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:orientation=\"vertical\"\n        android:padding=\"16dp\"&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"@{info.info1}\" /&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"@{info.timeStr}\" /&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"@{DataUtils.formatTime(info.time)}\" /&gt;\n    &lt;/LinearLayout&gt;\n&lt;/layout&gt;\n</code></pre> <p>\u9664\u4e86\u76f4\u63a5\u4f7f\u7528\u5bf9\u8c61\u7684\u5c5e\u6027\uff0c\u8fd8\u53ef\u4ee5\u76f4\u63a5\u5728xml\u4e2d\u505a\u4e00\u4e9b\u64cd\u4f5c\uff0c\u4f8b\u5982<code>@{DataUtils.formatTime(info.time)}</code>\u3002</p> <p>\u5982\u679c\u5728xml\u4e2d\u4f7f\u7528\u4e86\u9519\u8bef\u7684\u7c7b\u578b\uff0c\u4f8b\u5982\u7ed9TextView\u7684text\u8bbe\u7f6e\u4e86long\u7c7b\u578b\u7684\u5c5e\u6027\uff0c\u4f1a\u5728\u7f16\u8bd1\u65f6\u62a5\u9519\u3002</p> \u4f7f\u7528\u4e86\u9519\u8bef\u7684\u7c7b\u578b <p>Found data binding errors.</p> <p>data binding error msg:Cannot find the setter for attribute 'android:text' with arameter type long on android.widget.TextView. </p> <p>\u5728\u7f16\u8bd1\u65f6\u62a5\u9519\u80fd\u8ba9\u5f00\u53d1\u8005\u5c3d\u65e9\u53d1\u73b0\u9519\u8bef\u3002</p>"},{"location":"android/jetpack/dataBinding/use_observable/#activity","title":"Activity\u4ee3\u7801","text":"<p>\u4e4b\u524d\u6211\u4eec\u5728layout\u4e2d\u8bbe\u7f6e\u4e86SysInfo\u53d8\u91cf\uff0c<code>binding</code>\u4f1a\u81ea\u52a8\u751f\u6210<code>binding.setInfo()</code>\u65b9\u6cd5\u3002</p> <p>\u5728activity\u4e2d\uff0c\u6211\u4eec\u521b\u5efa\u4e00\u4e2aSysInfo\u5bf9\u8c61\uff0c\u4ea4\u7ed9<code>binding</code>\u3002\u540e\u9762\u8fd9\u4e2a\u5bf9\u8c61\u7684\u6570\u636e\u53d1\u751f\u6539\u53d8\u65f6\uff0c\u754c\u9762\u4f1a\u76f8\u5e94\u5730\u6539\u53d8\u3002</p> <p>\u4e3a\u4e86\u6f14\u793a\u6570\u636e\u53d8\u5316\uff0c\u6211\u4eec\u5f00\u542f\u4e00\u4e2a\u5b9a\u65f6\u5668\u53bb\u66f4\u65b0\u6570\u636e\u3002</p> DataBindingAct1 <pre><code>public class DataBindingAct1 extends AbsActivity {\n\n    private ActDataBinding1Binding binding;\n    private SysInfo mSysInfo = new SysInfo();\n    private Timer mTimer;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n\n        binding = DataBindingUtil.setContentView(this, R.layout.act_data_binding_1);\n        binding.setInfo(mSysInfo);\n\n        mTimer = new Timer();\n        mTimer.schedule(new TimerTask() {\n            @Override\n            public void run() {\n                mSysInfo.setTimeStr(\"Time: \" + System.currentTimeMillis());\n                mSysInfo.setTime(System.currentTimeMillis());\n            }\n        }, 0, 500);\n    }\n\n    @Override\n    protected void onDestroy() {\n        super.onDestroy();\n        mTimer.cancel();\n    }\n}\n</code></pre> <p>\u8fd0\u884c\u540e\u53ef\u4ee5\u53d1\u73b0\uff0c\u6570\u636e\u662f\u52a8\u6001\u53d8\u5316\u7684\u3002</p> <p>\u672c\u6587\u4ecb\u7ecd\u7684\u662f\u754c\u9762\u76d1\u542c\u5b9e\u4f53\u7c7b\u5bf9\u8c61\u5c5e\u6027\u53d8\u5316\u7684\u65b9\u6cd5\u3002</p> <p>\u6709\u5174\u8da3\u7684\u8bfb\u8005\u670b\u53cb\u53ef\u4ee5\u5c1d\u8bd5\u4e00\u4e0b\uff0c<code>binding.setInfo(mSysInfo);</code>\u540e\uff0c\u91cd\u65b0\u521b\u5efa<code>mSysInfo</code>\uff0c\u770b\u770b\u754c\u9762\u8fd8\u4f1a\u4e0d\u4f1a\u52a8\u6001\u53d8\u5316\u3002</p> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0cset\u65b9\u6cd5\u91cc\u8981\u4e3b\u52a8\u8c03\u7528<code>notifyPropertyChanged</code>\u65b9\u6cd5\u3002\u6709\u6ca1\u6709\u66f4\u7b80\u5355\u7684\u65b9\u5f0f\u5462\uff1f</p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u770b\u53ef\u89c2\u5bdf\u6570\u636e\u5bf9\u8c61ObservableField\u7684\u7528\u6cd5\u3002</p> <p>\ud83e\uddd1\ud83c\udffb\u200d\ud83d\udcbb \u793a\u4f8b\u4ee3\u7801</p>"},{"location":"android/jetpack/dataBinding/use_observableField/","title":"\u4f7f\u7528\u53ef\u89c2\u5bdf\u6570\u636e\u5bf9\u8c61ObservableField","text":"\u66f4\u65b0\u65e5\u671f 2021-9-1 <ul> <li>2021-9-1 \u5b8c\u5584Kotlin\u5185\u5bb9</li> <li>2021-6-26 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u53ef\u89c2\u5bdf\u6027\u662f\u6307\u4e00\u4e2a\u5bf9\u8c61\u5c06\u5176\u6570\u636e\u53d8\u5316\u901a\u77e5\u7ed9\u5176\u4ed6\u5bf9\u8c61\u7684\u80fd\u529b\u3002\u901a\u8fc7\u6570\u636e\u7ed1\u5b9a\u5e93\uff0c\u60a8\u53ef\u4ee5\u8ba9\u5bf9\u8c61\u3001\u5b57\u6bb5\u6216\u96c6\u5408\u53d8\u4e3a\u53ef\u89c2\u5bdf\u3002 \u4efb\u4f55 plain-old \u5bf9\u8c61\u90fd\u53ef\u7528\u4e8e\u6570\u636e\u7ed1\u5b9a\uff0c\u4f46\u4fee\u6539\u5bf9\u8c61\u4e0d\u4f1a\u81ea\u52a8\u4f7f\u754c\u9762\u66f4\u65b0\u3002\u901a\u8fc7\u6570\u636e\u7ed1\u5b9a\uff0c\u6570\u636e\u5bf9\u8c61\u53ef\u5728\u5176\u6570\u636e\u53d1\u751f\u66f4\u6539\u65f6\u901a\u77e5\u5176\u4ed6\u5bf9\u8c61\uff0c\u5373\u76d1\u542c\u5668\u3002\u53ef\u89c2\u5bdf\u7c7b\u6709\u4e09\u79cd\u4e0d\u540c\u7c7b\u578b\uff1a\u5bf9\u8c61\u3001\u5b57\u6bb5\u548c\u96c6\u5408\u3002</p> <p>\u5f53\u5176\u4e2d\u4e00\u4e2a\u53ef\u89c2\u5bdf\u6570\u636e\u5bf9\u8c61\u7ed1\u5b9a\u5230\u754c\u9762\u5e76\u4e14\u8be5\u6570\u636e\u5bf9\u8c61\u7684\u5c5e\u6027\u53d1\u751f\u66f4\u6539\u65f6\uff0c\u754c\u9762\u4f1a\u81ea\u52a8\u66f4\u65b0\u3002</p>"},{"location":"android/jetpack/dataBinding/use_observableField/#_1","title":"\u53ef\u89c2\u5bdf\u5b57\u6bb5","text":"<p>\u5728\u521b\u5efa\u5b9e\u73b0 Observable \u63a5\u53e3\u7684\u7c7b\u65f6\u8981\u5b8c\u6210\u4e00\u4e9b\u64cd\u4f5c\uff0c\u4f46\u5982\u679c\u60a8\u7684\u7c7b\u53ea\u6709\u5c11\u6570\u51e0\u4e2a\u5c5e\u6027\uff0c\u5219\u8fd9\u6837\u64cd\u4f5c\u7684\u610f\u4e49\u4e0d\u5927\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u901a\u7528 Observable \u7c7b\u548c\u4ee5\u4e0b\u7279\u5b9a\u4e8e\u57fa\u5143\u7684\u7c7b\uff0c\u5c06\u5b57\u6bb5\u8bbe\u4e3a\u53ef\u89c2\u5bdf\u5b57\u6bb5\uff1a</p> \u53ef\u89c2\u5bdf\u5b57\u6bb5 <ul> <li>ObservableBoolean</li> <li>ObservableByte</li> <li>ObservableChar</li> <li>ObservableShort</li> <li>ObservableInt</li> <li>ObservableLong</li> <li>ObservableFloat</li> <li>ObservableDouble</li> <li>ObservableParcelable</li> </ul> <p>\u53ef\u89c2\u5bdf\u5b57\u6bb5\u662f\u5177\u6709\u5355\u4e2a\u5b57\u6bb5\u7684\u81ea\u5305\u542b\u53ef\u89c2\u5bdf\u5bf9\u8c61\u3002 \u907f\u514d\u5728\u8bbf\u95ee\u64cd\u4f5c\u671f\u95f4\u5c01\u7bb1\u548c\u5f00\u7bb1\u3002\u8981\u4f7f\u7528\u6b64\u673a\u5236\uff0cJava\u4e2d\u4f7f\u7528 <code>public final</code> \u5c5e\u6027\uff0c\u6216\u5728 Kotlin \u4e2d\u521b\u5efa\u53ea\u8bfb\u5c5e\u6027\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a</p> User\u7c7b JavaKotlin <p>User.java</p> <pre><code>import androidx.databinding.ObservableField;\nimport androidx.databinding.ObservableInt;\n\npublic class User {\n    public final ObservableField&lt;String&gt; firstName = new ObservableField&lt;&gt;();\n    public final ObservableField&lt;String&gt; lastName = new ObservableField&lt;&gt;();\n    public final ObservableInt age = new ObservableInt();\n}\n</code></pre> <p>\u8981\u8bbf\u95ee\u5b57\u6bb5\u503c\uff0c\u8bf7\u4f7f\u7528 <code>set()</code> \u548c <code>get()</code> \u8bbf\u95ee\u5668\u65b9\u6cd5\uff0c\u5982\u4e0b\u6240\u793a\uff1a <pre><code>user.firstName.set(\"Google\");\nint age = user.age.get();\n</code></pre></p> <pre><code>import androidx.databinding.ObservableField\nimport androidx.databinding.ObservableInt\n\nclass User {\n    val firstName = ObservableField&lt;String&gt;()\n    val lastName = ObservableField&lt;String&gt;()\n    val age = ObservableInt()\n}\n</code></pre>"},{"location":"android/jetpack/dataBinding/use_observableField/#observablefield_1","title":"\u4f7f\u7528ObservableField","text":"<p>\u4f7f\u7528<code>Observable</code>\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5728\u6bcf\u4e2aset\u65b9\u6cd5\u91cc\uff0c\u90fd\u8c03\u7528<code>notifyPropertyChanged</code>\u53bb\u901a\u77e5ui\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u6362\u7528<code>ObservableField</code>\u6765\u5b9e\u73b0\u52a8\u6001\u66f4\u65b0\u3002</p> <p>\u65b0\u5efa\u7c7b<code>SysInfoObs</code>\uff0c\u91cc\u9762\u4f7f\u7528<code>ObservableField&lt;T&gt;</code>\u3002\u53ef\u4ee5\u5b9a\u4e49\u591a\u4e2a\u5c5e\u6027\u3002</p> \u65b0\u5efa\u7c7b JavaKotlin <p>SysInfoObs.java</p> <pre><code>public class SysInfoObs {\n    public ObservableField&lt;String&gt; info1 = new ObservableField&lt;&gt;(Build.MANUFACTURER);\n    public ObservableField&lt;String&gt; timeStr = new ObservableField&lt;&gt;();\n    public ObservableField&lt;Long&gt; time = new ObservableField&lt;&gt;();\n}\n</code></pre> <p>\u76ee\u524d\u4e00\u4e2a\u5de5\u7a0b\u91cc\u540c\u65f6\u6709Java\u548cKotlin\u7248\u672c\u7684\u793a\u4f8b\u4ee3\u7801\uff0c\u6240\u4ee5\u7ed9\u5b83\u4eec\u8d77\u4e86\u4e0d\u540c\u7684\u7c7b\u540d SysInfoObsKt.kt</p> <pre><code>import android.os.Build\nimport androidx.databinding.ObservableField\n\nclass SysInfoObsKt {\n    val info1 = ObservableField(Build.MANUFACTURER)\n    var timeStr = ObservableField&lt;String&gt;()\n    var time = ObservableField&lt;Long&gt;()\n}\n</code></pre> <p>layout\u548c\u4e4b\u524d\u7684\u5dee\u4e0d\u591a\u3002\u5f15\u5165\u7684<code>variable</code>\u6539\u4e3a\u6211\u4eec\u65b0\u5efa\u7684<code>SysInfoObs</code>\u7c7b\u3002</p> layout\u5f15\u5165variable JavaKotlin <p><code>variable</code>\u91cc\u4f7f\u7528SysInfoObs\uff0c\u90e8\u5206\u5185\u5bb9\u3002</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n\n    &lt;data&gt;\n\n        &lt;import type=\"com.rustfisher.tutorial2020.databinding.DataUtils\" /&gt;\n\n        &lt;variable\n            name=\"info\"\n            type=\"com.rustfisher.tutorial2020.databinding.data.SysInfoObs\" /&gt;\n    &lt;/data&gt;\n\n    &lt;LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:orientation=\"vertical\"\n        android:padding=\"16dp\"&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"@{info.info1}\" /&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"@{info.timeStr}\" /&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"@{DataUtils.formatTime(info.time)}\" /&gt;\n    &lt;/LinearLayout&gt;\n&lt;/layout&gt;\n</code></pre> <p>\u4f7f\u7528SysInfoObsKt\u7684xml\u3002\u90e8\u5206\u5185\u5bb9\u3002</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n\n    &lt;data&gt;\n\n        &lt;import type=\"com.rustfisher.tutorial2020.databinding.DataUtils\" /&gt;\n\n        &lt;variable\n            name=\"info\"\n            type=\"com.rustfisher.tutorial2020.databinding.data.SysInfoObsKt\" /&gt;\n    &lt;/data&gt;\n\n    &lt;LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:orientation=\"vertical\"\n        android:padding=\"16dp\"&gt;\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"@{info.info1}\" /&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"@{info.timeStr}\" /&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"@{DataUtils.formatTime(info.time)}\" /&gt;\n    &lt;/LinearLayout&gt;\n&lt;/layout&gt;\n</code></pre> <p>activity\u4e2d\u4fee\u6539\u4e00\u4e0b\u4f7f\u7528\u65b9\u5f0f\u3002\u65b0\u5efa<code>DataBindingAct2</code>\u7c7b\uff0c\u6301\u6709<code>SysInfoObs</code>\u7684\u5bf9\u8c61\u3002</p> activity JavaKotlin <p>DataBindingAct2.java</p> <pre><code>import android.os.Bundle;\nimport androidx.databinding.DataBindingUtil;\nimport androidx.databinding.ObservableArrayList;\nimport androidx.databinding.ObservableArrayMap;\nimport com.rustfisher.tutorial2020.AbsActivity;\nimport com.rustfisher.tutorial2020.R;\nimport com.rustfisher.tutorial2020.databinding.data.SysInfoObs;\nimport java.util.Timer;\nimport java.util.TimerTask;\n\npublic class DataBindingAct2 extends AbsActivity {\n\n    private ActDataBinding2Binding binding;\n    private SysInfoObs mSysInfo = new SysInfoObs();\n\n    private Timer mTimer;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n\n        binding = DataBindingUtil.setContentView(this, R.layout.act_data_binding_2);\n        binding.setInfo(mSysInfo);\n\n        mTimer = new Timer();\n        mTimer.schedule(new TimerTask() {\n            @Override\n            public void run() {\n                mSysInfo.timeStr.set(\"Time: \" + System.currentTimeMillis());\n                mSysInfo.time.set(System.currentTimeMillis());\n            }\n        }, 0, 500);\n    }\n\n    @Override\n    protected void onDestroy() {\n        super.onDestroy();\n        mTimer.cancel();\n    }\n}\n</code></pre> <p>\u8fd9\u91cc\u662f\u5b8c\u6574\u7684DataBindingAct2Kt\u4ee3\u7801</p> <pre><code>import android.os.Bundle\nimport androidx.databinding.DataBindingUtil\nimport androidx.databinding.ObservableArrayList\nimport androidx.databinding.ObservableArrayMap\nimport com.rustfisher.tutorial2020.AbsActivity\nimport com.rustfisher.tutorial2020.R\nimport com.rustfisher.tutorial2020.databinding.data.SysInfoObsKt\nimport java.util.*\n\n/**\n* \u6f14\u793aObservableFile\u7684kt\u7248\u672c\n*/\nclass DataBindingAct2Kt : AbsActivity() {\n    private val mSysInfo = SysInfoObsKt()\n    private var mTimer: Timer? = null\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        val binding: ActDataBinding2KtBinding =\n                DataBindingUtil.setContentView(this, R.layout.act_data_binding_2_kt)\n        binding.info = mSysInfo\n        mTimer = Timer()\n        mTimer!!.schedule(object : TimerTask() {\n            override fun run() {\n                mSysInfo.timeStr.set(\"Time: \" + System.currentTimeMillis())\n                mSysInfo.time.set(System.currentTimeMillis())\n            }\n        }, 0, 100)\n        val user = ObservableArrayMap&lt;String, Any&gt;()\n        user[\"firstName\"] = \"Rust\"\n        user[\"lastName\"] = \"Fisher\"\n        user[\"age\"] = 20\n        binding.user = user\n        val obList = ObservableArrayList&lt;Any&gt;()\n        obList.add(\"Rust\")\n        obList.add(\"Fisher\")\n        obList.add(\"Android\")\n        obList.add(2020)\n        obList.add(\"Kotlin\")\n        binding.obList = obList\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        mTimer!!.cancel()\n    }\n}\n</code></pre> <p>\u8981\u66f4\u65b0\u6570\u636e\u65f6\uff0c\u9700\u8981\u8c03\u7528ObservableField\u7684<code>set</code>\u65b9\u6cd5\u3002 \u8fd0\u884c\u8d77\u6765\u5c31\u53ef\u4ee5\u770b\u5230\u66f4\u65b0UI\u7684\u6548\u679c\u4e86\u3002</p>"},{"location":"android/jetpack/dataBinding/use_observableField/#_2","title":"\u53ef\u89c2\u5bdf\u96c6\u5408","text":"<p>\u67d0\u4e9b\u5e94\u7528\u4f7f\u7528\u52a8\u6001\u7ed3\u6784\u6765\u4fdd\u5b58\u6570\u636e\u3002\u53ef\u89c2\u5bdf\u96c6\u5408\u5141\u8bb8\u4f7f\u7528\u952e\u8bbf\u95ee\u8fd9\u4e9b\u7ed3\u6784\u3002 \u5f53\u952e\u4e3a\u5f15\u7528\u7c7b\u578b\uff08\u5982 String\uff09\u65f6\uff0c<code>ObservableArrayMap</code> \u7c7b\u975e\u5e38\u6709\u7528\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a</p> ObservableArrayMap\u7684\u4f7f\u7528 JavaKotlin <pre><code>ObservableArrayMap&lt;String, Object&gt; user = new ObservableArrayMap&lt;&gt;();\nuser.put(\"firstName\", \"Rust\");\nuser.put(\"lastName\", \"Fisher\");\nuser.put(\"age\", 18);\nbinding.setUser(user);\n</code></pre> <pre><code>val user = ObservableArrayMap&lt;String, Any&gt;()\nuser[\"firstName\"] = \"Rust\"\nuser[\"lastName\"] = \"Fisher\"\nuser[\"age\"] = 20\nbinding.user = user\n</code></pre> <p>\u5728\u5e03\u5c40\u4e2d\uff0c\u53ef\u4f7f\u7528\u5b57\u7b26\u4e32\u952e\u627e\u5230Map\uff0c\u5982\u4e0b\u6240\u793a\uff1a <pre><code>&lt;data&gt;\n    &lt;import type=\"androidx.databinding.ObservableArrayMap\" /&gt;\n    &lt;variable\n        name=\"user\"\n        type=\"ObservableArrayMap&amp;lt;String, Object&gt;\" /&gt;\n&lt;/data&gt;\n\n    &lt;TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text='@{user.firstName + \" \" + user.lastName}' /&gt;\n\n    &lt;TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"@{String.valueOf(1 + (Integer)user.age)}\" /&gt;\n</code></pre> \u6ce8\u610fMap\u7684\u5de6\u5c16\u62ec\u53f7\u8981\u6539\u5199\u4e3a<code>&amp;lt;</code>\u3002</p> <p>\u4f7f\u7528 <code>ObservableArrayList</code> \u7c7b\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> ObservableArrayList JavaKotlin <pre><code>ObservableArrayList&lt;Object&gt; obList = new ObservableArrayList&lt;&gt;();\nobList.add(\"Rust\");\nobList.add(\"Fisher\");\nobList.add(\"Android\");\nobList.add(2020);\nbinding.setObList(obList);\n</code></pre> <pre><code>val obList = ObservableArrayList&lt;Any&gt;()\nobList.add(\"Rust\")\nobList.add(\"Fisher\")\nobList.add(\"Android\")\nobList.add(2020)\nobList.add(\"Kotlin\")\nbinding.obList = obList\n</code></pre> <p>\u5728layout\u4e2d\u8fdb\u884c\u8bbe\u7f6e <pre><code>&lt;data&gt;\n    &lt;import type=\"androidx.databinding.ObservableArrayList\" /&gt;\n\n    &lt;variable\n        name=\"obList\"\n        type=\"ObservableArrayList&amp;lt;Object&gt;\" /&gt;\n&lt;/data&gt;\n\n&lt;!-- .... --&gt;\n\n&lt;TextView\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"\n    android:text='@{obList[0] + \" \" + obList[1]}' /&gt;\n\n&lt;TextView\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"\n    android:text='@{String.valueOf(1 + (Integer)obList[3])}' /&gt;\n</code></pre></p>"},{"location":"android/jetpack/dataBinding/use_observableField/#kotlin","title":"Kotlin\u7248","text":"<p>\u6211\u4eec\u7528Kotlin\u6765\u5b9e\u73b0\u4e0a\u9762\u7684\u4f8b\u5b50\u3002\u4e3b\u8981\u770b\u4ee5\u4e0b3\u4e2a\u6587\u4ef6\u3002\u4ee3\u7801\u903b\u8f91\u548c\u524d\u9762\u7684\u4e00\u81f4\u3002</p> <ul> <li>SysInfoObsKt.kt \u4fe1\u606f\u7c7b</li> <li>act_data_binding_2_kt.xml layout</li> <li>DataBindingAct2Kt.kt \u754c\u9762Activity</li> </ul> SysInfoObsKt.kt <pre><code>import android.os.Build\nimport androidx.databinding.ObservableField\n\nclass SysInfoObsKt {\n    val info1 = ObservableField(Build.MANUFACTURER)\n    var timeStr = ObservableField&lt;String&gt;()\n    var time = ObservableField&lt;Long&gt;()\n}\n</code></pre> layout <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n\n    &lt;data&gt;\n\n        &lt;import type=\"com.rustfisher.tutorial2020.databinding.DataUtils\" /&gt;\n\n        &lt;variable\n            name=\"info\"\n            type=\"com.rustfisher.tutorial2020.databinding.data.SysInfoObsKt\" /&gt;\n\n        &lt;import type=\"androidx.databinding.ObservableArrayMap\" /&gt;\n\n        &lt;variable\n            name=\"user\"\n            type=\"ObservableArrayMap&amp;lt;String, Object&gt;\" /&gt;\n\n        &lt;import type=\"androidx.databinding.ObservableArrayList\" /&gt;\n\n        &lt;variable\n            name=\"obList\"\n            type=\"ObservableArrayList&amp;lt;Object&gt;\" /&gt;\n    &lt;/data&gt;\n\n    &lt;LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:orientation=\"vertical\"\n        android:padding=\"16dp\"&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"ObservableField kt\" /&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"@{info.info1}\" /&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"@{info.timeStr}\" /&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"@{DataUtils.formatTime(info.time)}\" /&gt;\n\n        &lt;View\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"1dp\"\n            android:layout_margin=\"8dp\"\n            android:background=\"#f0f0f0\" /&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text='@{user.firstName + \" \" + user.lastName}' /&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text=\"@{String.valueOf(1 + (Integer)user.age)}\" /&gt;\n\n        &lt;View\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"1dp\"\n            android:layout_margin=\"8dp\"\n            android:background=\"#f0f0f0\" /&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text='@{obList[0] + \" \" + obList[1]}' /&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:text='@{String.valueOf(1 + (Integer)obList[3])}' /&gt;\n\n    &lt;/LinearLayout&gt;\n&lt;/layout&gt;\n</code></pre> Activity\u754c\u9762\u4ee3\u7801 <pre><code>import android.os.Bundle\nimport androidx.databinding.DataBindingUtil\nimport androidx.databinding.ObservableArrayList\nimport androidx.databinding.ObservableArrayMap\nimport com.rustfisher.tutorial2020.AbsActivity\nimport com.rustfisher.tutorial2020.R\nimport com.rustfisher.tutorial2020.databinding.data.SysInfoObsKt\nimport java.util.*\n\n/**\n* \u6f14\u793aObservableFile\u7684kt\u7248\u672c\n*/\nclass DataBindingAct2Kt : AbsActivity() {\n    private val mSysInfo = SysInfoObsKt()\n    private var mTimer: Timer? = null\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        val binding: ActDataBinding2KtBinding =\n                DataBindingUtil.setContentView(this, R.layout.act_data_binding_2_kt)\n        binding.info = mSysInfo\n        mTimer = Timer()\n        mTimer!!.schedule(object : TimerTask() {\n            override fun run() {\n                mSysInfo.timeStr.set(\"Time: \" + System.currentTimeMillis())\n                mSysInfo.time.set(System.currentTimeMillis())\n            }\n        }, 0, 100)\n        val user = ObservableArrayMap&lt;String, Any&gt;()\n        user[\"firstName\"] = \"Rust\"\n        user[\"lastName\"] = \"Fisher\"\n        user[\"age\"] = 20\n        binding.user = user\n        val obList = ObservableArrayList&lt;Any&gt;()\n        obList.add(\"Rust\")\n        obList.add(\"Fisher\")\n        obList.add(\"Android\")\n        obList.add(2020)\n        obList.add(\"Kotlin\")\n        binding.obList = obList\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        mTimer!!.cancel()\n    }\n}\n</code></pre> <p>\u793a\u4f8b\u4ee3\u7801 AndroidTutorial - gitee</p>"},{"location":"android/jetpack/lifeCycle/lifecycle_intro/","title":"\u751f\u547d\u5468\u671f LifeCycle","text":"\u66f4\u65b0\u65e5\u671f 2021-9-1 <ul> <li>2021-9-1 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4f7f\u7528\u751f\u547d\u5468\u671f\u611f\u77e5\u578b\u7ec4\u4ef6\u5904\u7406\u751f\u547d\u5468\u671f\u3002</p> <p>\u751f\u547d\u5468\u671f\u611f\u77e5\u578b\u7ec4\u4ef6\u53ef\u6267\u884c\u64cd\u4f5c\u6765\u54cd\u5e94\u53e6\u4e00\u4e2a\u7ec4\u4ef6\uff08\u5982 Activity \u548c Fragment\uff09\u7684\u751f\u547d\u5468\u671f\u72b6\u6001\u7684\u53d8\u5316\u3002\u8fd9\u4e9b\u7ec4\u4ef6\u6709\u52a9\u4e8e\u60a8\u5199\u51fa\u66f4\u6709\u6761\u7406\u4e14\u5f80\u5f80\u66f4\u7cbe\u7b80\u7684\u4ee3\u7801\uff0c\u8fd9\u6837\u7684\u4ee3\u7801\u66f4\u6613\u4e8e\u7ef4\u62a4\u3002</p> <p>\u4e00\u79cd\u5e38\u89c1\u7684\u6a21\u5f0f\u662f\u5728 Activity \u548c Fragment \u7684\u751f\u547d\u5468\u671f\u65b9\u6cd5\u4e2d\u5b9e\u73b0\u4f9d\u8d56\u7ec4\u4ef6\u7684\u64cd\u4f5c\u3002\u4f46\u662f\uff0c\u8fd9\u79cd\u6a21\u5f0f\u4f1a\u5bfc\u81f4\u4ee3\u7801\u6761\u7406\u6027\u5f88\u5dee\u800c\u4e14\u4f1a\u6269\u6563\u9519\u8bef\u3002\u901a\u8fc7\u4f7f\u7528\u751f\u547d\u5468\u671f\u611f\u77e5\u578b\u7ec4\u4ef6\uff0c\u60a8\u53ef\u4ee5\u5c06\u4f9d\u8d56\u7ec4\u4ef6\u7684\u4ee3\u7801\u4ece\u751f\u547d\u5468\u671f\u65b9\u6cd5\u79fb\u5165\u7ec4\u4ef6\u672c\u8eab\u4e2d\u3002</p> <p>androidx.lifecycle \u8f6f\u4ef6\u5305\u63d0\u4f9b\u4e86\u53ef\u7528\u4e8e\u6784\u5efa\u751f\u547d\u5468\u671f\u611f\u77e5\u578b\u7ec4\u4ef6\u7684\u7c7b\u548c\u63a5\u53e3 - \u8fd9\u4e9b\u7ec4\u4ef6\u53ef\u4ee5\u6839\u636e Activity \u6216 Fragment \u7684\u5f53\u524d\u751f\u547d\u5468\u671f\u72b6\u6001\u81ea\u52a8\u8c03\u6574\u5176\u884c\u4e3a\u3002</p> <p>Lifecycle \u662f\u4e00\u4e2a\u7c7b\uff0c\u7528\u4e8e\u5b58\u50a8\u6709\u5173\u7ec4\u4ef6\uff08\u5982 Activity \u6216 Fragment\uff09\u7684\u751f\u547d\u5468\u671f\u72b6\u6001\u7684\u4fe1\u606f\uff0c\u5e76\u5141\u8bb8\u5176\u4ed6\u5bf9\u8c61\u89c2\u5bdf\u6b64\u72b6\u6001\u3002</p> <p>Lifecycle \u4f7f\u7528\u4e24\u79cd\u4e3b\u8981\u679a\u4e3e\u8ddf\u8e2a\u5176\u5173\u8054\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u72b6\u6001\uff1a</p>"},{"location":"android/jetpack/lifeCycle/lifecycle_intro/#_1","title":"\u6d3b\u52a8","text":"<p>\u4ece\u6846\u67b6\u548c Lifecycle \u7c7b\u5206\u6d3e\u7684\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u3002\u8fd9\u4e9b\u4e8b\u4ef6\u6620\u5c04\u5230 Activity \u548c Fragment \u4e2d\u7684\u56de\u8c03\u4e8b\u4ef6\u3002</p>"},{"location":"android/jetpack/lifeCycle/lifecycle_intro/#_2","title":"\u72b6\u6001\u8f6c\u6362","text":"<p>\u7531 Lifecycle \u5bf9\u8c61\u8ddf\u8e2a\u7684\u7ec4\u4ef6\u7684\u5f53\u524d\u72b6\u6001\u3002</p> <p></p> <p>\u7c7b\u53ef\u4ee5\u901a\u8fc7\u5411\u5176\u65b9\u6cd5\u6dfb\u52a0\u6ce8\u89e3\u6765\u76d1\u63a7\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u72b6\u6001\u3002\u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528 Lifecycle \u7c7b\u7684 addObserver() \u65b9\u6cd5\u5e76\u4f20\u9012\u89c2\u5bdf\u8005\u7684\u5b9e\u4f8b\u6765\u6dfb\u52a0\u89c2\u5bdf\u8005\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u4e2d\u6240\u793a\uff1a <pre><code>    public class MyObserver implements LifecycleObserver {\n        @OnLifecycleEvent(Lifecycle.Event.ON_RESUME)\n        public void connectListener() {\n            ...\n        }\n\n        @OnLifecycleEvent(Lifecycle.Event.ON_PAUSE)\n        public void disconnectListener() {\n            ...\n        }\n    }\n\n    myLifecycleOwner.getLifecycle().addObserver(new MyObserver());\n</code></pre> \u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0cmyLifecycleOwner \u5bf9\u8c61\u5b9e\u73b0\u4e86 LifecycleOwner \u63a5\u53e3\uff0c\u6211\u4eec\u5c06\u5728\u63a5\u4e0b\u6765\u7684\u90e8\u5206\u4e2d\u5bf9\u8be5\u63a5\u53e3\u8fdb\u884c\u8bf4\u660e\u3002</p>"},{"location":"android/jetpack/lifeCycle/lifecycle_intro/#_3","title":"\u5177\u4f53\u793a\u4f8b","text":"<p>\u5f15\u5165<code>androidx.appcompat</code>\u4f9d\u8d56 <pre><code>dependencies {\n    implementation 'androidx.appcompat:appcompat:1.1.0'\n    // ...\n}\n</code></pre></p> <p>\u6784\u5efa\u4e00\u4e2a\u89c2\u5bdf\u8005<code>MyObserver1</code>\uff0c\u76d1\u542c\u751f\u547d\u5468\u671f\u7684\u53d8\u5316\u3002 <pre><code>import androidx.lifecycle.Lifecycle;\nimport androidx.lifecycle.LifecycleObserver;\nimport androidx.lifecycle.OnLifecycleEvent;\n\npublic class MyObserver1 implements LifecycleObserver {\n    private static final String TAG = \"rustAppOb1\";\n\n    @OnLifecycleEvent(Lifecycle.Event.ON_CREATE)\n    public void doOnCreate() {\n        Log.d(TAG, \"[obs]doOnCreate\"); // \u76d1\u542c\u751f\u547d\u5468\u671f\u7684\u53d8\u5316\n    }\n\n    @OnLifecycleEvent(Lifecycle.Event.ON_START)\n    public void doOnStart() {\n        Log.d(TAG, \"[obs]doOnStart\");\n    }\n\n    @OnLifecycleEvent(Lifecycle.Event.ON_RESUME)\n    public void doOnResume() {\n        Log.d(TAG, \"[obs]doOnResume\");\n    }\n\n    @OnLifecycleEvent(Lifecycle.Event.ON_RESUME)\n    public void doOnResume2() {\n        Log.d(TAG, \"[obs]doOnResume2\");\n    }\n\n    @OnLifecycleEvent(Lifecycle.Event.ON_PAUSE)\n    public void doOnPause() {\n        Log.d(TAG, \"[obs]doOnPause\");\n    }\n\n    @OnLifecycleEvent(Lifecycle.Event.ON_STOP)\n    public void doOnStop() {\n        Log.d(TAG, \"[obs]doOnStop\");\n    }\n\n    @OnLifecycleEvent(Lifecycle.Event.ON_DESTROY)\n    public void doOnDestroy() {\n        Log.d(TAG, \"[obs]doOnDestroy\");\n    }\n\n    @OnLifecycleEvent(Lifecycle.Event.ON_ANY)\n    public void doOnAny() {\n        Log.d(TAG, \"[obs]doOnAny\");\n    }\n}\n</code></pre></p> <p>\u5728activity\u4e2d\u4f7f\u7528\uff0c\u5404\u4e2a\u751f\u547d\u5468\u671f\u6253\u5370log\u3002\u7ee7\u627f<code>androidx.appcompat.app.AppCompatActivity</code>\u3002 <pre><code>public class Lc1Act extends AppCompatActivity {\n    private static final String TAG = \"rustAppLc1\";\n\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        Log.d(TAG, \"[act]onCreate: start\");\n        super.onCreate(savedInstanceState);\n        ActLc1Binding binding = DataBindingUtil.setContentView(this, R.layout.act_lc1);\n\n        getLifecycle().addObserver(new MyObserver1());\n        Log.d(TAG, \"[act]onCreate: END\");\n    }\n\n    @Override\n    protected void onStart() {\n        Log.d(TAG, \"[act]onStart: start\");\n        super.onStart();\n        Log.d(TAG, \"[act]onStart: END\");\n    }\n\n    @Override\n    protected void onResume() {\n        Log.d(TAG, \"[act]onResume: start\");\n        super.onResume();\n        Log.d(TAG, \"[act]onResume: END\");\n    }\n\n    @Override\n    protected void onPause() {\n        Log.d(TAG, \"[act]onPause: start\");\n        super.onPause();\n        Log.d(TAG, \"[act]onPause: END\");\n    }\n\n    @Override\n    protected void onStop() {\n        Log.d(TAG, \"[act]onStop: start\");\n        super.onStop();\n        Log.d(TAG, \"[act]onStop: END\");\n    }\n\n    @Override\n    protected void onDestroy() {\n        Log.d(TAG, \"[act]onDestroy: start\");\n        super.onDestroy();\n        Log.d(TAG, \"[act]onDestroy: END\");\n    }\n\n    @Override\n    public void onBackPressed() {\n        Log.d(TAG, \"[act]onBackPressed\");\n        super.onBackPressed();\n    }\n}\n</code></pre></p> <p>\u8fd0\u884c\u65e5\u5fd7 <pre><code>D/rustAppLc1: [act]onCreate: start\nD/rustAppLc1: [act]onCreate: END\nD/rustAppOb1: [obs]doOnCreate\nD/rustAppOb1: [obs]doOnAny\nD/rustAppLc1: [act]onStart: start\nD/rustAppLc1: [act]onStart: END\nD/rustAppOb1: [obs]doOnStart\nD/rustAppOb1: [obs]doOnAny\nD/rustAppLc1: [act]onResume: start\nD/rustAppLc1: [act]onResume: END\nD/rustAppOb1: [obs]doOnResume\nD/rustAppOb1: [obs]doOnResume2\nD/rustAppOb1: [obs]doOnAny\nD/rustAppLc1: [act]onBackPressed\nD/rustAppOb1: [obs]doOnPause\nD/rustAppOb1: [obs]doOnAny\nD/rustAppLc1: [act]onPause: start\nD/rustAppLc1: [act]onPause: END\nD/rustAppOb1: [obs]doOnStop\nD/rustAppOb1: [obs]doOnAny\nD/rustAppLc1: [act]onStop: start\nD/rustAppLc1: [act]onStop: END\nD/rustAppOb1: [obs]doOnDestroy\nD/rustAppOb1: [obs]doOnAny\nD/rustAppLc1: [act]onDestroy: start\nD/rustAppLc1: [act]onDestroy: END\n</code></pre></p> <p>\u4ecelog\u4e2d\u53ef\u4ee5\u770b\u51faactivity\u751f\u547d\u5468\u671f\u548c\u89c2\u5bdf\u8005\u56de\u8c03\u51fd\u6570\u6267\u884c\u7684\u5148\u540e\u987a\u5e8f\u3002 \u65b0\u5efaactivity\u65f6\uff0c\u5148\u6267\u884cactivity\u7684\u751f\u547d\u5468\u671f\u51fd\u6570\uff0c\u518d\u6267\u884c\u89c2\u5bdf\u8005\u7684\u76d1\u542c\u65b9\u6cd5\u3002 \u9500\u6bc1\u754c\u9762\u65f6\uff0c\u5148\u6267\u884c\u7684\u65f6\u89c2\u5bdf\u8005\u7684\u65b9\u6cd5\uff0c\u7136\u540e\u662factivity\u7684\u65b9\u6cd5\u3002 \u5373\u5148\u5efa\u7acb\u9875\u9762\uff0c\u518d\u5efa\u7acb\u89c2\u5bdf\u8005\uff1b\u9000\u51fa\u65f6\u5148\u9000\u89c2\u5bdf\u8005\uff0c\u518d\u9000\u754c\u9762\u3002</p> <p>\u5982\u679c\u5f39\u51fa<code>AlertDialog</code>\uff0cactivity\u56de\u8c03<code>onWindowFocusChanged(boolean hasFocus)</code>\uff0c\u89c2\u5bdf\u8005\u4e0d\u4f1a\u54cd\u5e94\u3002</p>"},{"location":"android/jetpack/lifeCycle/lifecycle_intro/#lifecycleowner","title":"LifecycleOwner","text":"<p>LifecycleOwner \u662f\u5355\u4e00\u65b9\u6cd5\u63a5\u53e3\uff0c\u8868\u793a\u7c7b\u5177\u6709 Lifecycle\uff08\u751f\u547d\u5468\u671f\uff09\u3002 \u5b83\u5177\u6709\u4e00\u4e2a\u65b9\u6cd5\uff08\u5373 <code>getLifecycle()</code>\uff09\uff0c\u8be5\u65b9\u6cd5\u5fc5\u987b\u7531\u7c7b\u5b9e\u73b0\u3002 \u5982\u679c\u60a8\u5c1d\u8bd5\u7ba1\u7406\u6574\u4e2a\u5e94\u7528\u8fdb\u7a0b\u7684\u751f\u547d\u5468\u671f\uff0c\u8bf7\u53c2\u9605 ProcessLifecycleOwner\u3002</p> <p>\u6b64\u63a5\u53e3\u4ece\u5404\u4e2a\u7c7b\uff08\u5982 Fragment \u548c AppCompatActivity\uff09\u62bd\u8c61\u5316 Lifecycle \u7684\u6240\u6709\u6743\uff0c\u5e76\u5141\u8bb8\u7f16\u5199\u4e0e\u8fd9\u4e9b\u7c7b\u642d\u914d\u4f7f\u7528\u7684\u7ec4\u4ef6\u3002\u4efb\u4f55\u81ea\u5b9a\u4e49\u5e94\u7528\u7c7b\u5747\u53ef\u5b9e\u73b0 <code>LifecycleOwner</code> \u63a5\u53e3\u3002</p> <p>\u5b9e\u73b0 <code>LifecycleObserver</code> \u7684\u7ec4\u4ef6\u53ef\u4e0e\u5b9e\u73b0 <code>LifecycleOwner</code> \u7684\u7ec4\u4ef6\u65e0\u7f1d\u534f\u540c\u5de5\u4f5c\uff0c\u56e0\u4e3a\u6240\u6709\u8005\u53ef\u4ee5\u63d0\u4f9b\u751f\u547d\u5468\u671f\uff0c\u800c\u89c2\u5bdf\u8005\u53ef\u4ee5\u6ce8\u518c\u4ee5\u89c2\u5bdf\u751f\u547d\u5468\u671f\u3002</p> <p>\u4e0a\u9762\u7684<code>MyObserver1</code>\u7c7b\u5b9e\u73b0 <code>LifecycleObserver</code>\uff0c\u7136\u540e\u5728 onCreate() \u65b9\u6cd5\u4e2d\u4f7f\u7528 Activity \u7684 Lifecycle \u5bf9\u5176\u8fdb\u884c\u521d\u59cb\u5316\u3002 \u8fd9\u6837\uff0c<code>MyObserver1</code> \u7c7b\u4fbf\u53ef\u4ee5\u201c\u81ea\u7ed9\u81ea\u8db3\u201d\uff0c\u8fd9\u610f\u5473\u7740\uff0c\u5bf9\u751f\u547d\u5468\u671f\u72b6\u6001\u7684\u53d8\u5316\u505a\u51fa\u54cd\u5e94\u7684\u903b\u8f91\u4f1a\u5728 <code>MyObserver1</code>\uff08\u800c\u4e0d\u662f\u5728 Activity\uff09\u4e2d\u8fdb\u884c\u58f0\u660e\u3002\u8ba9\u5404\u4e2a\u7ec4\u4ef6\u5b58\u50a8\u81ea\u5df1\u7684\u903b\u8f91\uff0c\u53ef\u4f7f Activity \u548c Fragment \u903b\u8f91\u66f4\u6613\u4e8e\u7ba1\u7406\u3002</p>"},{"location":"android/jetpack/lifeCycle/lifecycle_intro/#lifecycle_1","title":"\u6301\u6709Lifecycle\u7684\u89c2\u5bdf\u8005\u793a\u4f8b","text":"<p>\u89c2\u5bdf\u8005\u53ef\u4ee5\u6301\u6709Lifecycle\u5bf9\u8c61\u3002\u5728\u8fdb\u884c\u4e00\u4e9b\u64cd\u4f5c\u524d\uff0c\u53ef\u4ee5\u5224\u65ad\u9875\u9762\u5f53\u524d\u7684\u72b6\u6001\u3002</p> <p>\u65b0\u5efa<code>MyObserver2</code>\u7c7b\u3002\u6301\u6709Lifecycle\u5b9e\u4f8b\u3002 <pre><code>import androidx.lifecycle.Lifecycle;\nimport androidx.lifecycle.LifecycleObserver;\nimport androidx.lifecycle.OnLifecycleEvent;\n\npublic class MyObserver2 implements LifecycleObserver {\n    private static final String TAG = \"rustAppOb2\";\n\n    private Lifecycle lifecycle;\n\n    public MyObserver2(Lifecycle lifecycle) {\n        this.lifecycle = lifecycle;\n    }\n\n    @OnLifecycleEvent(Lifecycle.Event.ON_ANY)\n    public void doOnAny() {\n        Log.d(TAG, \"[obs2]doOnAny; lifecycle-cur-state: \" + lifecycle.getCurrentState());\n        Log.d(TAG, \"doOnAny: atLeast INITIALIZED: \" + lifecycle.getCurrentState().isAtLeast(Lifecycle.State.INITIALIZED));\n        Log.d(TAG, \"doOnAny: atLeast CREATED: \" + lifecycle.getCurrentState().isAtLeast(Lifecycle.State.CREATED));\n        Log.d(TAG, \"doOnAny: atLeast STARTED: \" + lifecycle.getCurrentState().isAtLeast(Lifecycle.State.STARTED));\n        Log.d(TAG, \"doOnAny: atLeast RESUMED: \" + lifecycle.getCurrentState().isAtLeast(Lifecycle.State.RESUMED));\n        Log.d(TAG, \"doOnAny: atLeast DESTROYED: \" + lifecycle.getCurrentState().isAtLeast(Lifecycle.State.DESTROYED));\n    }\n}\n</code></pre> \u89c2\u5bdf<code>ON_ANY</code>\u8fd9\u4e2a\u4e8b\u4ef6\uff0c\u6253\u4e00\u4e9blog\uff0c\u770b\u770blifecycle\u7684\u72b6\u6001\u3002 \u4f7f\u7528\u4e86<code>isAtLeast</code>\u65b9\u6cd5\u3002</p> <p>Activity\u4e2d\u6ce8\u518c\u8fd9\u4e2a\u89c2\u5bdf\u8005\u3002 <pre><code>getLifecycle().addObserver(new MyObserver2(getLifecycle()));\n</code></pre></p> <p>\u8fd0\u884c\u90e8\u5206log\u4fe1\u606f <pre><code>D/rustAppLc1: [act]onCreate: start\nD/rustAppLc1: [act]onCreate: END\nD/rustAppOb2: [obs2]doOnAny; lifecycle-cur-state: CREATED\nD/rustAppOb2: doOnAny: atLeast INITIALIZED: true\nD/rustAppOb2: doOnAny: atLeast CREATED: true\nD/rustAppOb2: doOnAny: atLeast STARTED: false\nD/rustAppOb2: doOnAny: atLeast RESUMED: false\nD/rustAppOb2: doOnAny: atLeast DESTROYED: true\n</code></pre></p> <p>\u89c2\u5bdf<code>Lifecycle.State</code>\u679a\u4e3e\uff0c\u5b83\u628a\u751f\u547d\u5468\u671f\u72b6\u6001\u6309\u987a\u5e8f\u6392\u5217\u3002 <pre><code>  public enum State {\n        DESTROYED,\n        INITIALIZED,\n        CREATED,\n        STARTED,\n        RESUMED;\n\n        public boolean isAtLeast(@NonNull State state) {\n            return compareTo(state) &gt;= 0;\n        }\n    }\n</code></pre> <code>isAtLeast</code>\u6bd4\u8f83\u5f53\u524d\u72b6\u6001\u548c\u4f20\u5165\u7684\u72b6\u6001\u3002\u8fd4\u56detrue\u5219\u6807\u660e\u76f8\u5bf9\u4f20\u5165\u7684state\uff0c\u5f53\u524d\u662f\u201c\u5b89\u5168\u201d\u7684\u3002</p>"},{"location":"android/jetpack/lifeCycle/lifecycle_intro/#lifecycleowner_1","title":"\u5b9e\u73b0\u81ea\u5b9a\u4e49 LifecycleOwner","text":"<p>\u4e0a\u9762\u7684activity\u7ee7\u627f\u81ea<code>androidx.appcompat.app.AppCompatActivity</code>\uff0c\u5b83\u7684\u7236\u7c7b\u5b9e\u73b0\u4e86<code>LifecycleOwner</code>\u63a5\u53e3\u3002 \u6211\u4eec\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u81ea\u5b9a\u4e49 LifecycleOwner\u3002</p> <p>\u5982\u679c\u60a8\u6709\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7c7b\u5e76\u5e0c\u671b\u4f7f\u5176\u6210\u4e3a LifecycleOwner\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 LifecycleRegistry \u7c7b\uff0c\u4f46\u9700\u8981\u5c06\u4e8b\u4ef6\u8f6c\u53d1\u5230\u8be5\u7c7b\uff0c\u5982\u4ee5\u4e0b\u4ee3\u7801\u793a\u4f8b\u4e2d\u6240\u793a\uff1a <pre><code>public class MyActivity extends Activity implements LifecycleOwner {\n    private LifecycleRegistry lifecycleRegistry;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n\n        lifecycleRegistry = new LifecycleRegistry(this);\n        lifecycleRegistry.markState(Lifecycle.State.CREATED);\n    }\n\n    @Override\n    public void onStart() {\n        super.onStart();\n        lifecycleRegistry.markState(Lifecycle.State.STARTED);\n    }\n\n    @NonNull\n    @Override\n    public Lifecycle getLifecycle() {\n        return lifecycleRegistry;\n    }\n}\n</code></pre></p>"},{"location":"android/jetpack/liveData/use_mutableLiveData/","title":"\u4f7f\u7528MutableLiveData  \u66f4\u65b0\u65e5\u671f 2022-7-3 <ul> <li>2022-7-13 \u66f4\u65b0\u4ee3\u7801\u683c\u5f0f</li> <li>2021-11-3 \u66f4\u65b0\u8bf4\u660e</li> <li>2021-9-1 \u521b\u5efa\u6587\u6863</li> </ul>  <p>\u5728Android\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u4e86ViewModel\u3002ViewModel\u5982\u4f55\u5c06\u4e8b\u4ef6\u548c\u6570\u636e\u4f20\u9001\u5230Activity\u4e2d\uff1f</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528<code>MutableLiveData&lt;T&gt;</code>\u3002</p>","text":""},{"location":"android/jetpack/liveData/use_mutableLiveData/#_1","title":"\u51c6\u5907\u6570\u636e\u7c7b\u578b","text":"<p>\u65b0\u5efa\u7c7b<code>MutableDemoVM</code>\u3002 <pre><code>public class MutableDemoVM {\n    public int countPoint = 0;\n\n    public ObservableField&lt;String&gt; title = new ObservableField&lt;&gt;(\"\u4f7f\u7528MutableLiveData\");\n    public ObservableField&lt;String&gt; timeStr = new ObservableField&lt;&gt;();\n    public ObservableField&lt;Integer&gt; count = new ObservableField&lt;&gt;(0);\n\n    public MutableLiveData&lt;Void&gt; liveDataOnBack = new MutableLiveData&lt;&gt;();\n    public MutableLiveData&lt;Integer&gt; countLiveData = new MutableLiveData&lt;&gt;();\n\n    public void onClickBack(View view) {\n        liveDataOnBack.setValue(null);\n    }\n\n    public void onClickAdd(View view) {\n        countPoint++;\n        count.set(countPoint);\n        countLiveData.setValue(countPoint);\n    }\n}\n</code></pre> \u76d1\u542c\u5230\u70b9\u51fb\u4e8b\u4ef6\u540e\uff0c\u6267\u884c\u4e00\u4e9b\u64cd\u4f5c\uff0c\u7136\u540e\u628a\u6570\u636e\u53d1\u9001\u51fa\u53bb\u3002</p> <p>\u53d1\u9001\u4e8b\u4ef6\u9700\u8981\u8c03\u7528<code>setValue</code>\u65b9\u6cd5\u6216\u8005<code>postValue</code>\u65b9\u6cd5\u3002</p> <p>\u5b83\u4eec\u4e4b\u95f4\u4e00\u4e2a\u663e\u8457\u533a\u522b\u5728\u4e8e\uff0c<code>setValue</code>\u65b9\u6cd5\u5fc5\u987b\u8981\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\uff0c<code>postValue</code>\u65b9\u6cd5\u53ef\u4ee5\u5728\u4efb\u610f\u7ebf\u7a0b\u6267\u884c\u3002<code>postValue</code>\u65b9\u6cd5\u4f1a\u628a\u6570\u636e\u5207\u6362\u5230\u4e3b\u7ebf\u7a0b\u53bb\u53d1\u9001\u3002</p> <p>\u5982\u679c\u5728\u5b50\u7ebf\u7a0b\u4e2d\u8c03\u7528<code>setValue</code>\uff0c\u4f1a\u62a5<code>IllegalStateException:Cannot invoke setValue on a background thread</code>\u3002 <code>setValue</code>\u65b9\u6cd5\u8fdb\u884c\u4e86<code>assertMainThread</code>\u68c0\u67e5\u3002</p> <p>\u53e6\u4e00\u4e2a\u533a\u522b\u662f\uff0c<code>setValue</code>\u65b9\u6cd5\u662f\u7acb\u5373\u5c06\u6570\u636e\u4f20\u9001\u7ed9\u76d1\u542c\u5668\uff08\u89c2\u5bdf\u8005\uff09\u3002<code>postValue</code>\u65b9\u6cd5\u4f1a\u628a\u6570\u636e\u4f9d\u6b21\u53d1\u9001\u3002</p> <p>\u5982\u679c\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u8c03\u7528<code>postValue</code>\u540e\u53c8\u7acb\u5373\u8c03\u7528<code>setValue</code>\uff0c\u90a3\u4e48\u76d1\u542c\u5668\u4f1a\u5148\u62ff\u5230<code>setValue</code>\u7684\u6570\u636e\uff0c\u7136\u540e\u62ff\u5230<code>postValue</code>\u7684\u6570\u636e\u3002</p> <p>\u8fde\u7eed\u591a\u6b21\u8c03\u7528<code>postValue</code>\u6765\u53d1\u9001\u6570\u636e\uff0c\u5982\u679c\u4e3b\u7ebf\u7a0b\u6ca1\u6709\u6765\u5f97\u53ca\u6267\u884c\u53d1\u9001\u4efb\u52a1\uff0c\u76d1\u542c\u5668\u4f1a\u63a5\u6536\u5230\u6700\u540e\u4e00\u6b21\u53d1\u9001\u7684\u6570\u636e\u3002</p>"},{"location":"android/jetpack/liveData/use_mutableLiveData/#layout","title":"layout","text":"<p>\u51c6\u5907layout\u6587\u4ef6\u3002\u8bbe\u7f6e\u76d1\u542c\u4e0e\u5404\u4e2a\u611f\u5174\u8da3\u7684\u5c5e\u6027\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n\n    &lt;data&gt;\n        &lt;variable\n            name=\"vm\"\n            type=\"com.rustfisher.tutorial2020.databinding.data.MutableDemoVM\" /&gt;\n    &lt;/data&gt;\n\n    &lt;LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:orientation=\"vertical\"&gt;\n\n        &lt;LinearLayout\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"50dp\"\n            android:orientation=\"horizontal\"&gt;\n\n            &lt;ImageView\n                android:layout_width=\"50dp\"\n                android:layout_height=\"50dp\"\n                android:onClick=\"@{vm.onClickBack}\"\n                android:padding=\"10dp\"\n                android:src=\"@drawable/ic_arrow_back_black_24dp\" /&gt;\n\n            &lt;TextView\n                android:layout_width=\"wrap_content\"\n                android:layout_height=\"match_parent\"\n                android:gravity=\"center_vertical\"\n                android:text=\"@{vm.title}\"\n                android:textColor=\"#000000\"\n                android:textSize=\"18sp\" /&gt;\n\n        &lt;/LinearLayout&gt;\n\n        &lt;LinearLayout\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\"\n            android:orientation=\"vertical\"&gt;\n\n            &lt;TextView\n                android:layout_width=\"wrap_content\"\n                android:layout_height=\"wrap_content\"\n                android:layout_gravity=\"center_horizontal\"\n                android:text='@{\"count: \"+String.valueOf(vm.count)}'\n                android:textSize=\"16sp\" /&gt;\n\n            &lt;Button\n                android:layout_width=\"100dp\"\n                android:layout_height=\"50dp\"\n                android:layout_gravity=\"center_horizontal\"\n                android:layout_marginTop=\"20dp\"\n                android:onClick=\"@{vm::onClickAdd}\"\n                android:text=\"+\" /&gt;\n        &lt;/LinearLayout&gt;\n    &lt;/LinearLayout&gt;\n&lt;/layout&gt;\n</code></pre></p> <p>\u5e94\u7528vm::</p> <p>\u540e\u9762\u90fd\u7edf\u4e00\u7528vm:: \uff0c \u8fd9\u79cd2\u4e2a\u5192\u53f7\u7684\u5f62\u5f0f</p>"},{"location":"android/jetpack/liveData/use_mutableLiveData/#activity","title":"Activity\u8bbe\u7f6e","text":"<p>\u9700\u8981\u4f7f\u7528<code>androidx.appcompat.app.AppCompatActivity</code>\uff0c\u5b83\u652f\u6301\u4e86LifeCycle\u3002 <pre><code>public class MutableDemo1 extends AppCompatActivity {\n\n    private ActMutableDemo1Binding binding;\n    private MutableDemoVM mVM = new MutableDemoVM();\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        binding = DataBindingUtil.setContentView(this, R.layout.act_mutable_demo1);\n        binding.setVm(mVM);\n\n        // \u8bbe\u7f6e\u89c2\u5bdf\u8005\n        mVM.liveDataOnBack.observe(this, new Observer&lt;Void&gt;() {\n            @Override\n            public void onChanged(Void aVoid) {\n                onBackPressed();\n            }\n        });\n        mVM.countLiveData.observe(this, new Observer&lt;Integer&gt;() {\n            @Override\n            public void onChanged(Integer count) {\n                Toast.makeText(getApplicationContext(), \"count: \" + count, Toast.LENGTH_SHORT).show();\n            }\n        });\n    }\n}\n</code></pre></p> <p>\u5728activity\u4e2d\u8bbe\u7f6e\u89c2\u5bdf\u8005\u3002\u8bbe\u7f6e\u65b9\u6cd5\u662f<code>observe(@NonNull LifecycleOwner owner, @NonNull Observer&lt;? super T&gt; observer)</code>\u3002</p> <p>\u8fd9\u4e2a\u65b9\u6cd5\u5fc5\u987b\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\u3002</p>"},{"location":"android/jetpack/room/db-room-start/","title":"\u5f00\u59cb\u4f7f\u7528Room","text":"\u66f4\u65b0\u65e5\u671f 2023-6-19 <ul> <li>2023-6-19 \u66f4\u65b0\u6309\u6761\u4ef6\u5220\u9664</li> <li>2023-6-14 \u66f4\u65b0\u4f8b\u5b50</li> <li>2021-9-1 \u66f4\u65b0\u683c\u5f0f</li> <li>2021-6-26 \u521b\u5efa\u6587\u6863</li> </ul> <p>Room \u5728 SQLite \u4e0a\u63d0\u4f9b\u4e86\u4e00\u4e2a\u62bd\u8c61\u5c42\u3002</p> <p>\u5927\u81f4\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <ul> <li>\u5f15\u5165Room</li> <li>\u51c6\u5907\u6570\u636e\uff0c\u8bbe\u8ba1\u7ed3\u6784</li> <li>\u6570\u636e\u5e93\u64cd\u4f5c</li> </ul> <p>\u672c\u6587\u4ecb\u7ecdRoom\u7684\u7528\u6cd5\u3002\u5f15\u5165Room\uff1b\u51c6\u5907\u6570\u636e\uff0c\u8bbe\u8ba1\u7ed3\u6784\uff1b\u6570\u636e\u5e93\u64cd\u4f5c\u3002\u4ecb\u7ecd\u5e38\u89c1\u7684\u5d29\u6e83\u60c5\u51b5\u3002</p>"},{"location":"android/jetpack/room/db-room-start/#_1","title":"\u5177\u4f53\u6b65\u9aa4","text":""},{"location":"android/jetpack/room/db-room-start/#room_1","title":"\u5f15\u5165Room","text":"<p>\u5728\u6a21\u5757<code>gradle</code>\u5f15\u5165Room</p> gradle\u5f15\u5165Room <pre><code>def room_version = \"2.2.5\"\nimplementation \"androidx.room:room-runtime:$room_version\"\nannotationProcessor \"androidx.room:room-compiler:$room_version\"\n</code></pre>"},{"location":"android/jetpack/room/db-room-start/#_2","title":"\u51c6\u5907\u6570\u636e\uff0c\u8bbe\u8ba1\u7ed3\u6784","text":"<p>\u65b0\u5efaUser.java\uff0c\u7ed9User\u7c7b\u6dfb\u52a0<code>@Entity</code>\u6ce8\u89e3\uff0c\u8868\u660e\u5b83\u662fRoom\u7684\u5b9e\u4f53\u7c7b\u3002 \u7c7b\u4e2d\u7684\u5b57\u6bb5\u9700\u8981\u80fd\u88ab\u5176\u4ed6\u7c7b\uff08Room\uff09\u8bbf\u95ee\uff0c\u53ef\u4ee5\u4f7f\u7528<code>public</code>\uff0c\u4e5f\u53ef\u4ee5\u589e\u52a0getter/setter\u65b9\u6cd5\u3002</p> User\u7c7b <pre><code>import androidx.annotation.NonNull;\nimport androidx.room.ColumnInfo;\nimport androidx.room.Entity;\nimport androidx.room.PrimaryKey;\n\n@Entity\npublic class User {\n    @PrimaryKey(autoGenerate = true)\n    public long uid;\n\n    @ColumnInfo(name = \"first_name\")\n    public String firstName;\n\n    @ColumnInfo(name = \"last_name\")\n    public String lastName;\n\n    @ColumnInfo\n    public long createTime;\n    // \u6784\u9020\u5668\u4e0etoString...\n}\n</code></pre> <p>\u8fd9\u91cc\u9ed8\u8ba4\u8868\u540d\u4e3a\u7c7b\u7684\u540d\u5b57\u3002\u5982\u679c\u8981\u4f7f\u7528\u4e0d\u540c\u7684\u8868\u540d\uff0c\u9700\u8981\u5728\u6ce8\u89e3Entity\u540e\u52a0\u4e0a\u8bbe\u7f6e\u3002 <pre><code>@Entity(tableName = \"other_users\")\n</code></pre></p> <p><code>@PrimaryKey</code>\u6307\u5b9a\u4e86\u4e3b\u952e\u3002Room\u8981\u6c42\u6bcf\u4e2a\u5b9e\u4f53\u81f3\u5c11\u67091\u4e2a\u4e3b\u952e\u3002 \u8fd9\u91cc\u8bbe\u7f6e\u4e86<code>autoGenerate = true</code>\uff0c\u8868\u660e\u5b83\u662f\u81ea\u589e\u957f\u7684\u3002</p> <p><code>@ColumnInfo</code>\u8868\u793a\u8fd9\u4e2a\u5b57\u6bb5\u4e3a\u4e00\u5217\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5217\u540d\u662f\u5c5e\u6027\u7684\u540d\u79f0\u3002 \u4e5f\u53ef\u7528<code>@ColumnInfo(name = \"last_name\")</code>\u6765\u6307\u5b9a\u5217\u540d\u3002</p> Entity <p>Entity\u4e2d\u53ef\u4ee5\u5bf9\u6570\u636e\u8868\u8fdb\u884c\u8bbe\u7f6e\u3002</p> <p>\u66f4\u591a\u5173\u4e8eEntity\u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u5c06\u5728\u5b9e\u4f53\u7c7b\u4ecb\u7ecd\u91cc\u8bf4\u660e\u3002</p>"},{"location":"android/jetpack/room/db-room-start/#_3","title":"\u6570\u636e\u5e93\u7ba1\u7406\u8005","text":"<p>\u65b0\u5efa\u62bd\u8c61\u7c7bAppDatabase.java\uff0c\u5b83\u6307\u5b9a\u4e86\u5b9e\u4f53\u7c7b\uff0c\u6570\u636e\u5e93\u7248\u672c\u53f7\u3002</p> AppDatabase.java <pre><code>import androidx.room.Database;\nimport androidx.room.RoomDatabase;\n\n@Database(entities = {User.class}, version = 1)\npublic abstract class AppDatabase extends RoomDatabase {\n    public abstract UserDao userDao();\n}\n</code></pre> <p>\u5efa\u7acb\u6570\u636e\u5e93\u7ba1\u7406\u5668\u5355\u4f8bDbMgr\u3002</p> DbMgr <pre><code>import android.content.Context;\nimport androidx.room.Room;\n\npublic class DbMgr {\n    private static DbMgr mgr;\n    public static final String DB_NAME = \"rust-fisher-db.db\";\n    private AppDatabase database;\n\n    private DbMgr() {\n    }\n\n    public static DbMgr getMgr() {\n        if (mgr == null) {\n            synchronized (DbMgr.class) {\n                if (mgr == null) {\n                    mgr = new DbMgr();\n                }\n            }\n        }\n        return mgr;\n    }\n\n    public void initDb(Context context) {\n        database = Room.databaseBuilder(context, AppDatabase.class, DB_NAME).build();\n    }\n\n    public AppDatabase getDatabase() {\n        return database;\n    }\n}\n</code></pre> <p>\u5728\u4f7f\u7528\u6570\u636e\u5e93\u524d\uff0c\u6211\u4eec\u9700\u8981\u901a\u8fc7<code>Room.databaseBuilder</code>\u83b7\u5f97\u6570\u636e\u5e93\u5bf9\u8c61<code>database</code>\u3002 \u6570\u636e\u5e93\u540d\u79f0\u4e5f\u5728\u8fd9\u91cc\u6307\u5b9a\u3002</p> <p>\u5728\u5355\u8fdb\u7a0bapp\u4e2d\uff0c\u6570\u636e\u5e93\u5bf9\u8c61\u5efa\u8bae\u53ea\u521b\u5efa1\u4e2a\u3002</p>"},{"location":"android/jetpack/room/db-room-start/#_4","title":"\u6570\u636e\u5e93\u64cd\u4f5c","text":"<p>\u5728\u6b64\u6211\u4eec\u4ecb\u7ecd\u589e\uff0c\u5220\uff0c\u67e5\u7684\u64cd\u4f5c\u3002 \u65b0\u5efaUserDao.java\u6765\u89c4\u5b9a\u64cd\u4f5c\u3002 UserDao\u662f\u4e00\u4e2a\u63a5\u53e3\uff08interface\uff09\uff0c\u6dfb\u52a0\u4e86<code>@Dao</code>\u6ce8\u89e3\u3002</p> UserDao <pre><code>import androidx.room.Dao;\nimport androidx.room.Delete;\nimport androidx.room.Insert;\nimport androidx.room.Query;\n\nimport java.util.List;\n\n@Dao\npublic interface UserDao {\n    @Query(\"SELECT * FROM user\")\n    List&lt;User&gt; getAll();\n\n    @Query(\"SELECT * FROM user WHERE uid IN (:userIds)\")\n    List&lt;User&gt; loadAllByIds(int[] userIds);\n\n    @Query(\"SELECT * FROM user WHERE first_name LIKE :first AND \" +\n            \"last_name LIKE :last LIMIT 1\")\n    User findByName(String first, String last);\n\n    @Insert\n    void insertAll(User... users);\n\n    @Delete\n    void delete(User user); // \u4f1a\u6839\u636e\u4e3b\u952e\u6765\u5220\u9664\n}\n</code></pre> <p>\u6bcf\u4e00\u4e2a\u65b9\u6cd5\u4e0a\u9762\uff0c\u90fd\u4f7f\u7528\u4e86\u5bf9\u5e94\u7684\u6ce8\u89e3\uff0c\u6709\u7684\u8fd8\u5e26\u6709sql\u8bed\u53e5\u3002</p> <p>\u5982\u679c\u4e0d\u6839\u636e\u4e3b\u952e\u5220\u9664\uff0c\u5219\u9700\u8981\u589e\u52a0\u6761\u4ef6 \u6839\u636e\u67d0\u4e2a\u5b57\u6bb5\u6765\u5220\u9664<pre><code>@Query(\"DELETE FROM user WHERE createTime=:ts;\")\nvoid deleteByStartTs(long ts);\n</code></pre></p>"},{"location":"android/jetpack/room/db-room-start/#_5","title":"\u67e5","text":"<p>\u4f7f\u7528<code>@Query</code>\u6ce8\u89e3\u3002\u5bf9\u5e94\u7684sql\u547d\u4ee4\u662f<code>SELECT</code>\u3002</p> <p>\u67e5\u8be2\u5168\u90e8\u6570\u636e\uff0csql\u8bed\u53e5<code>SELECT * FROM user</code>\u3002</p> <p>\u6761\u4ef6\u67e5\u8be2\uff0c\u4f8b\u5982\u901a\u8fc7\u6307\u5b9a\u7684uid\u67e5\u8be2 <code>SELECT * FROM user WHERE uid IN (:userIds)</code>\u3002</p> <p>sql\u8bed\u53e5\u548cJava\u65b9\u6cd5\u4e2d\u7684\u53c2\u6570\u7528\u5192\u53f7<code>:</code>\u8fdb\u884c\u5bf9\u5e94\u3002 \u4f8b\u5982\u65b9\u6cd5\u4e2d\u7684\u53c2\u6570<code>String first</code>\uff0c\u5728sql\u8bed\u53e5\u4e2d\u662f<code>:first</code>\u3002</p> <p>\u5982\u679c\u8981\u5012\u5e8f\uff0c\u52a0\u4e2a<code>DESC</code>\u5373\u3002\u4f8b\u5982 <code>ORDER BY start_timestamp DESC;</code></p>"},{"location":"android/jetpack/room/db-room-start/#_6","title":"\u589e","text":"<p>\u4f7f\u7528<code>@Insert</code>\u6ce8\u89e3\u3002</p>"},{"location":"android/jetpack/room/db-room-start/#_7","title":"\u5220","text":"<p>\u4f7f\u7528<code>@Delete</code>\u6ce8\u89e3\u3002\u4f8b\u5b50\u4e2d\u7684\u5220\u9664\u64cd\u4f5c\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f20\u5165\u4e00\u4e2a<code>User</code>\u5bf9\u8c61\u3002</p> <p>\u81f3\u6b64\uff0c\u6211\u4eec\u7528\u5230\u7684\u7c7b\u548c\u63a5\u53e3\u6709 <pre><code>AppDatabase\nDbMgr\nUser\nUserDao\n</code></pre></p>"},{"location":"android/jetpack/room/db-room-start/#_8","title":"\u4f7f\u7528","text":"<p>Room\u8981\u6c42\u4e0d\u80fd\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u3002 \u6211\u4eec\u627e\u4e00\u4e2a\u5b50\u7ebf\u7a0b\u6765\u5904\u7406\u3002</p> HandlerThread <pre><code>private HandlerThread mDbHt = new HandlerThread(\"db\");\nprivate Handler mDbHandler;\n\n    // \u542f\u52a8\u5b50\u7ebf\u7a0b\n    mDbHt.start(); // \u521d\u59cb\u5316\u6570\u636e\u5e93\u7684\u4e13\u7528\u64cd\u4f5c\u7ebf\u7a0b\n    mDbHandler = new Handler(mDbHt.getLooper());\n</code></pre> \u6267\u884c\u589e\u52a0\u6570\u636e\u7684\u64cd\u4f5c <pre><code>mDbHandler.post(new Runnable() {\n    @Override\n    public void run() {\n        User user = new User(\"Rust\", \"Fisher\");\n        DbMgr.getMgr().getDatabase().userDao().insertAll(user);\n    }\n});\n</code></pre> \u67e5\u8be2\u6570\u636e <pre><code>mDbHandler.post(new Runnable() {\n    @Override\n    public void run() {\n        UserDao userDao = DbMgr.getMgr().getDatabase().userDao();\n        List&lt;User&gt; userList = userDao.getAll();\n    }\n});\n</code></pre> \u5220\u96641\u6761\u8bb0\u5f55 <pre><code>mDbHandler.post(new Runnable() {\n    @Override\n    public void run() {\n        UserDao userDao = DbMgr.getMgr().getDatabase().userDao();\n        User user = userDao.findByName(\"Rust\", \"Fisher\");\n        userDao.delete(user);\n    }\n});\n</code></pre> <p>\u5148\u67e5\u518d\u5220\uff0c\u8fd9\u91cc\u662f\u628a\u6700\u65e7\u7684\u4e00\u6761\u6570\u636e\u7ed9\u5220\u6389\u4e86\u3002</p> <p>\u5728\u672c\u4f8b\u4e2d\uff0c\u624b\u673a\u4e0a\u6570\u636e\u5e93\u6587\u4ef6\u8def\u5f84\u4e3a <code>/data/data/com.rustfisher.tutorial2020/databases/rust-fisher-db.db</code></p> \u8fd0\u884c\u6548\u679c\u622a\u56fe <p></p>"},{"location":"android/jetpack/room/db-room-start/#database-inspector","title":"Database Inspector","text":"<p>\u5728 Android Studio 4.1 \u53ca\u66f4\u9ad8\u7248\u672c\u4e2d\uff0c\u53ef\u4ee5\u7528 Database Inspector \u5728\u5e94\u7528\u8fd0\u884c\u65f6\u68c0\u67e5\u3001\u67e5\u8be2\u548c\u4fee\u6539\u5e94\u7528\u7684\u6570\u636e\u5e93\u3002</p> <p>Database Inspector \u4ec5\u53ef\u4e0e API \u7ea7\u522b 26 \u53ca\u66f4\u9ad8\u7248\u672c\u7684 Android \u64cd\u4f5c\u7cfb\u7edf\u4e2d\u6240\u5305\u542b\u7684 SQLite \u5e93\u7ed3\u5408\u4f7f\u7528\u3002\u5b83\u65e0\u6cd5\u5904\u7406\u4e0eapp\u6346\u7ed1\u7684\u5176\u4ed6 SQLite \u5e93\u3002</p> <p>\u5982\u9700\u5728 Database Inspector \u4e2d\u6253\u5f00\u6570\u636e\u5e93\uff0c \u9700\u8981\u5728\u6a21\u62df\u5668\u6216\u642d\u8f7d API \u7ea7\u522b 26 \u6216\u66f4\u9ad8\u7248\u672c\u7684\u5df2\u8fde\u63a5\u8bbe\u5907\u4e0a\u8fd0\u884capp\u3002</p> \u4ece\u83dc\u5355\u680f\u4e2d\u4f9d\u6b21\u9009\u62e9 <p> View &gt; Tool Windows &gt; Database Inspector</p> <p>\u4ece\u4e0b\u62c9\u83dc\u5355\u4e2d\u9009\u62e9\u6b63\u5728\u8fd0\u884c\u7684\u5e94\u7528\u8fdb\u7a0b\u3002</p> \u9009\u62e9app\u8fdb\u7a0b <p></p>"},{"location":"android/jetpack/room/db-room-start/#_9","title":"\u62a5\u9519\u8bb0\u5f55","text":"<p>\u5982\u679c\u5728\u4e3b\u7ebf\u7a0b\u6267\u884c\u6570\u636e\u5e93\u8bfb\u5199\u64cd\u4f5c\uff0c\u4f1a\u62a5\u9519</p> <p>java.lang.IllegalStateException: Cannot access database on the main thread since it may potentially lock the UI for a long period of time.</p> <p>\u5bf9\u6784\u5efa\u5668\u8c03\u7528<code>allowMainThreadQueries()</code>\uff0c\u5426\u5219 Room \u4e0d\u652f\u6301\u5728\u4e3b\u7ebf\u7a0b\u4e0a\u8bbf\u95ee\u6570\u636e\u5e93 <pre><code>database = Room.databaseBuilder(context, AppDatabase.class, DB_NAME)\n        .allowMainThreadQueries()\n        .build();\n</code></pre></p> <p>\u5982\u679c\u4fee\u6539\u4e86Entity\u7c7b\uff0c\u4f46\u662f\u6ca1\u6709\u5347\u7ea7\u6570\u636e\u5e93\u7248\u672c\uff0c\u4f1a\u62a5\u9519</p> \u4fee\u6539\u4e86Entity\u7c7b\uff0c\u4f46\u662f\u6ca1\u6709\u5347\u7ea7\u6570\u636e\u5e93\u7248\u672c <p>java.lang.IllegalStateException: Room cannot verify the data integrity. Looks like you've changed schema but forgot to update the version number. You can simply fix this by increasing the version number.</p> <p>\u63d2\u5165\u8bb0\u5f55\u65f6\uff0c\u5982\u679c\u6709\u91cd\u590d\u7684\u4e3b\u952e\uff08PrimaryKey\uff09\uff0c\u62a5\u9519</p> \u91cd\u590d\u7684\u4e3b\u952e <p>android.database.sqlite.SQLiteConstraintException: UNIQUE constraint failed: User.uid (code 1555 SQLITE_CONSTRAINT_PRIMARYKEY)</p>"},{"location":"android/jetpack/room/db-room-start/#_10","title":"\u76f8\u5173\u64cd\u4f5c","text":"<ul> <li>\u65b0\u589e\u6570\u636e</li> <li>\u66f4\u65b0\u6570\u636e</li> </ul> <p>\ud83e\uddd1\ud83c\udffb\u200d\ud83d\udcbb \u793a\u4f8b\u4ee3\u7801</p>"},{"location":"android/jetpack/room/room-add/","title":"\u6dfb\u52a0\u6570\u636e\uff08Insert\uff09","text":"\u66f4\u65b0\u65e5\u671f 2021-6-26 <ul> <li>2021-6-26 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u5411\u6570\u636e\u5e93\u4e2d\u65b0\u589e\u6570\u636e\uff0c\u4f7f\u7528Insert\u64cd\u4f5c\u3002</p> <p>\u5728\u76f8\u5173\u65b9\u6cd5\u4e0a\u52a0\u4e0a\u6ce8\u89e3<code>@Insert</code> <pre><code>@Dao\npublic interface UserDao {\n    @Insert(onConflict = OnConflictStrategy.REPLACE)\n    void insertUsers(User... users);\n\n    @Insert\n    void insertBothUsers(User user1, User user2);\n\n    @Insert\n    void insertUsersAndFriends(User user, List&lt;User&gt; friends);\n}\n</code></pre></p> <p>Insert\u6ce8\u89e3\u4e2d\uff0c\u7ed9onConflict\u8d4b\u503c</p> <ul> <li><code>OnConflictStrategy.REPLACE</code>\u8868\u793a\u5f53\u53d1\u751f\u51b2\u7a81\uff08\u91cd\u590d\uff09\u65f6\uff0c\u4f1a\u66ff\u6362\u65e7\u6570\u636e</li> <li><code>OnConflictStrategy.ABORT</code>\u662f\u9ed8\u8ba4\u503c\uff0c\u53d1\u751f\u51b2\u7a81\u65f6\u4f1a\u505c\u6b62\u65b0\u589e\u64cd\u4f5c</li> <li><code>OnConflictStrategy.IGNORE</code>\u8868\u793a\u5ffd\u7565\u51b2\u7a81\uff0c\u6267\u884c\u8fd9\u4e00\u884c\u7684\u64cd\u4f5c\u65f6\u4f1a\u8fd4\u56de-1</li> </ul> <p>\u5982\u679c <code>@Insert</code> \u65b9\u6cd5\u53ea\u63a5\u6536 1 \u4e2a\u53c2\u6570\uff0c\u5219\u5b83\u53ef\u4ee5\u8fd4\u56de long\uff0c\u8fd9\u662f\u63d2\u5165\u9879\u7684\u65b0 rowId\u3002</p> <p>\u5982\u679c\u53c2\u6570\u662f\u6570\u7ec4\u6216\u96c6\u5408\uff0c\u5219\u5e94\u8fd4\u56de long[] \u6216 List\u3002"},{"location":"android/jetpack/room/room-entity-intro/","title":"\u5b9e\u4f53\u7c7b\u4ecb\u7ecd","text":"\u66f4\u65b0\u65e5\u671f 2021-6-26 <ul> <li>2021-6-26 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u524d\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u4e86User\u5b9e\u4f53\u7c7b\u3002 \u8fd9\u91cc\u518d\u521b\u5efa\u4e00\u4e9b\u5b9e\u4f53\u7c7b\uff0c\u4ecb\u7ecd\u8868\u540d\uff0c\u5217\u540d\uff0c\u4e3b\u952e\u7684\u914d\u7f6e\u65b9\u6cd5\u548c\u5e38\u89c1\u95ee\u9898\u3002</p>"},{"location":"android/jetpack/room/room-entity-intro/#_2","title":"\u8868\u540d","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cRoom \u5c06\u7c7b\u540d\u79f0\u7528\u4f5c\u6570\u636e\u5e93\u8868\u540d\u79f0\u3002 \u5982\u679c\u6211\u4eec\u8981\u8bbe\u7f6e\u4e0d\u540c\u7684\u8868\u540d\uff0c\u8bbe\u7f6e <code>@Entity</code> \u6ce8\u91ca\u7684 <code>tableName</code> \u5c5e\u6027 <pre><code>@Entity(tableName = \"user-extra-2\")\npublic class User2 {/*...*/}\n</code></pre> \u50cf\u8fd9\u6837\u8bbe\u7f6e\u8868\u540d\u4e3a<code>user-extra-2</code></p>"},{"location":"android/jetpack/room/room-entity-intro/#_3","title":"\u4e3b\u952e","text":"<p>\u6bcf\u4e2a\u5b9e\u4f53\u5fc5\u987b\u5c06\u81f3\u5c111\u4e2a\u5b57\u6bb5\u5b9a\u4e49\u4e3a\u4e3b\u952e\u3002 \u5373\u4f7f\u53ea\u67091\u4e2a\u5b57\u6bb5\uff0c\u4ecd\u7136\u9700\u8981\u4e3a\u8be5\u5b57\u6bb5\u6dfb\u52a0<code>@PrimaryKey</code>\u6ce8\u91ca\u3002 <pre><code>@Entity(tableName = \"user-extra-2\")\npublic class User2 {\n\n    @NonNull\n    @PrimaryKey\n    @ColumnInfo(name = \"first_name\")\n    public String firstName;\n    // ...\n}\n</code></pre></p> <p>\u5982\u679c\u5b9e\u4f53\u5177\u6709\u590d\u5408\u4e3b\u952e\uff0c\u5728<code>@Entity</code>\u91cc\u6307\u5b9a<code>primaryKeys</code>\u3002\u6307\u5b9a\u7684\u5217\u540d\uff0c\u8981\u548c\u540e\u9762\u5b9a\u4e49\u7684\u5217\u540d\u4e00\u81f4\u3002 <pre><code>@Entity(tableName = \"user-extra-2\", primaryKeys = {\"first_name\", \"lastName\"})\npublic class User2 {\n\n    @NonNull\n    @ColumnInfo(name = \"first_name\")\n    public String firstName;\n\n    @NonNull\n    @ColumnInfo(defaultValue = \"Fisher\")\n    public String lastName;\n</code></pre> \u793a\u4f8b\u4e2d\uff0c2\u4e2a\u5217\u540d\u5206\u522b\u662f<code>first_name</code>\u548c<code>lastName</code>\u3002 \u8fd9\u91cc\u4ec5\u662f\u793a\u4f8b\u3002\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c\u6211\u4eec\u8fd8\u662f\u7edf\u4e00\u7528\u4e00\u79cd\u547d\u540d\u98ce\u683c\u6bd4\u8f83\u597d\u3002</p> <p>\u6b64\u5916\uff0c\u5982\u679c\u60f3\u8ba9 Room \u4e3a\u5b9e\u4f53\u5206\u914d\u81ea\u52a8 ID\uff0c\u5219\u53ef\u4ee5\u8bbe\u7f6e <code>@PrimaryKey</code> \u7684 <code>autoGenerate</code> \u5c5e\u6027\u3002 <pre><code>@Entity(tableName = \"user-extra-2\")\npublic class User2 {\n    @PrimaryKey(autoGenerate = true)\n    public long uid;\n    // ...\n}\n</code></pre></p>"},{"location":"android/jetpack/room/room-entity-intro/#_4","title":"\u91cd\u590d\u6307\u5b9a\u4e3b\u952e","text":"<p>\u5047\u8bbe\u6211\u4eec\u5728<code>@Entity</code>\u4e2d\u5b9a\u4e49\u4e86<code>primaryKeys</code>\uff0c\u53c8\u5728\u5b57\u6bb5\u4e0a\u4f7f\u7528<code>@PrimaryKey</code>\u6307\u5b9a\u4e3b\u952e <pre><code>@Entity(tableName = \"user-extra-2\", primaryKeys = {\"uid\"})\npublic class User2 {\n    @PrimaryKey\n    public long uid;\n//...\n}\n</code></pre></p> <p>\u4f1a\u5728\u7f16\u8bd1\u65f6\u62a5\u9519 <pre><code>\u9519\u8bef: You cannot have multiple primary keys defined in an Entity. If you want to declare a composite primary key, you should use @Entity#primaryKeys and not use @PrimaryKey. Defined Primary Keys: PrimaryKey[uid], PrimaryKey[uid]\npublic class User2 {\n</code></pre></p>"},{"location":"android/jetpack/room/room-entity-intro/#_5","title":"\u4e3b\u952e\u4e0d\u80fd\u4e3a\u7a7a","text":"<p>\u524d\u9762\u6211\u4eec\u7528long\u4f5c\u4e3a\u4e3b\u952e\u3002\u73b0\u5728\u5982\u679c\u7528String\u6765\u505a\u4e3b\u952e\uff0c\u9700\u8981\u52a0\u4e0a<code>@NonNull</code>\u6ce8\u89e3\u3002\u5426\u5219\u5982\u4e0b\u4ee3\u7801\u4f1a\u5728\u7f16\u8bd1\u65f6\u62a5\u9519 <pre><code>@Entity(tableName = \"user-extra-2\")\npublic class User2 {\n    public long uid;\n\n    @PrimaryKey\n    @ColumnInfo(name = \"first_name\")\n    public String firstName;\n</code></pre></p> <p>\u62a5\u9519\u4fe1\u606f\uff0c\u8981\u7ed9\u4e3b\u952e\u52a0\u4e0a<code>@NonNull</code>\u6ce8\u89e3 <pre><code>\u9519\u8bef: You must annotate primary keys with @NonNull. \"firstName\" is nullable. SQLite considers this a bug and Room does not allow it. See SQLite docs for details: https://www.sqlite.org/lang_createtable.html\n    public String firstName;\n</code></pre></p> <p>\u52a0\u4e0a\u6ce8\u89e3\u540e <pre><code>// ...\n@NonNull\n@PrimaryKey\n@ColumnInfo(name = \"first_name\")\npublic String firstName;\n// ...\n</code></pre></p>"},{"location":"android/jetpack/room/room-entity-intro/#primarykeys","title":"primaryKeys\u8303\u56f4","text":"<p>\u5047\u8bbe\u6211\u4eec\u6307\u5b9a\u7684\u5173\u952e\u5b57\u6bb5\u548c\u6307\u5b9a\u7684\u5217\u540d\u4e0d\u4e00\u81f4 <pre><code>@Entity(tableName = \"user-extra-2\", primaryKeys = {\"firstName\"})\npublic class User2 {\n    @NonNull\n    @ColumnInfo(name = \"first_name\")\n    public String firstName;\n    // ...\n}\n</code></pre> \u7f16\u8bd1\u65f6\u4f1a\u62a5\u9519 <pre><code>\u9519\u8bef: firstName referenced in the primary key does not exists in the Entity. Available column names:uid, first_name, last_name, createTime\npublic class User2 {\n</code></pre> \u56e0\u4e3a\u6211\u4eec\u6307\u5b9a\u4e86\u5217\u540d<code>first_name</code>\uff0cprimaryKeys\u7684\u53ef\u7528\u503c\u5fc5\u987b\u5728\u5217\u540d\u8303\u56f4\u5185\u3002</p>"},{"location":"android/jetpack/room/room-entity-intro/#_6","title":"\u5217\u540d","text":"<p>\u4e0a\u6587\u6211\u4eec\u53ef\u4ee5\u6ce8\u610f\u5230\uff0c\u5217\u540d\u9ed8\u8ba4\u662f\u5c5e\u6027\u7684\u540d\u5b57\uff0c\u4e5f\u53ef\u4ee5\u7528<code>@ColumnInfo</code>\u4e2d\u7684<code>name</code>\u6765\u91cd\u65b0\u5b9a\u4e49\u5217\u540d\u3002 \u4e5f\u53ef\u4ee5\u7ed9\u8fd9\u4e00\u5217\u4f7f\u7528<code>defaultValue</code>\u6dfb\u52a0\u9ed8\u8ba4\u503c\u3002 <pre><code>    @ColumnInfo(name = \"first_name\")\n    public String firstName;\n\n    @ColumnInfo(defaultValue = \"Fisher\")\n    public String lastName;\n</code></pre></p>"},{"location":"android/jetpack/room/room-entity-intro/#_7","title":"\u5ffd\u7565\u5b57\u6bb5","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cRoom \u4f1a\u4e3a\u5b9e\u4f53\u4e2d\u5b9a\u4e49\u7684\u6bcf\u4e2a\u5b57\u6bb5\u521b\u5efa\u4e00\u4e2a\u5217\u3002 \u5982\u679c\u67d0\u4e2a\u5b9e\u4f53\u4e2d\u6709\u60a8\u4e0d\u60f3\u4fdd\u7559\u7684\u5b57\u6bb5\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 <code>@Ignore</code>\u4e3a\u8fd9\u4e9b\u5b57\u6bb5\u6dfb\u52a0\u6ce8\u91ca\uff0c\u5982\u4ee5\u4e0b\u4ee3\u7801\u6bb5\u6240\u793a\uff1a <pre><code>@Entity\npublic class User2 {\n    @PrimaryKey\n    public int id;\n    // ...\n    @Ignore\n    Bitmap picture;\n}\n</code></pre></p> <p>\u5982\u679c\u5b9e\u4f53\u7ee7\u627f\u4e86\u7236\u5b9e\u4f53\u7684\u5b57\u6bb5\uff0c\u5219\u4f7f\u7528 @Entity \u5c5e\u6027\u7684 ignoredColumns \u5c5e\u6027\u901a\u5e38\u4f1a\u66f4\u5bb9\u6613\uff1a <pre><code>@Entity(ignoredColumns = \"picture\")\npublic class User3 extends User2 {\n    @PrimaryKey\n    public int id;\n    // ...\n}\n</code></pre></p>"},{"location":"android/jetpack/room/room-update/","title":"\u66f4\u65b0\u6570\u636e\uff08Update\uff09","text":"\u66f4\u65b0\u65e5\u671f 2021-6-26 <ul> <li>2021-6-26 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u66f4\u65b0\u6570\u636e\u5e93\u4e2d\u7684\u5df2\u6709\u6570\u636e\u3002\u4f7f\u7528\u7684\u6ce8\u89e3\u662f<code>@Update</code>\u3002</p> <p>\u5b9e\u4f53\u7c7bUser\uff0c<code>PrimaryKey</code>\u53ea\u6709\u4e00\u4e2a<code>uid</code> <pre><code>@Entity\npublic class User {\n    @PrimaryKey(autoGenerate = true)\n    public long uid;\n\n    @ColumnInfo(name = \"first_name\")\n    public String firstName;\n\n    @ColumnInfo(name = \"last_name\")\n    public String lastName;\n\n    @ColumnInfo\n    public long createTime;\n}\n</code></pre></p> <p>\u5728Dao\u4e2d\u7ed9\u65b9\u6cd5\u52a0\u4e0a\u6ce8\u89e3\u3002 <pre><code>@Dao\npublic interface UserDao {\n    @Update\n    void updateOneUser(User user);\n\n    @Update\n    int updateOneUserAndResult(User user);\n}\n</code></pre> \u65b9\u6cd5\u53ef\u4ee5\u8fd4\u56de\u7a7a\u3002\u4e5f\u53ef\u4ee5\u8fd4\u56deint\u3002</p> <p>\u5982\u679c\u8fd4\u56deint\uff0c\u8868\u793a\u6267\u884c\u66f4\u65b0\u6210\u529f\u7684\u6570\u91cf\u3002</p> <p>\u5982\u679c\u8981\u66f4\u65b0\u591a\u6761\u6570\u636e\uff0c\u53ef\u4ee5\u4f20\u5165\u591a\u4e2a\u5bf9\u8c61 <pre><code>    @Update(onConflict = OnConflictStrategy.ABORT)\n    int updateUsersCanAbort(User... user);\n\n    @Update(onConflict = OnConflictStrategy.IGNORE)\n    int updateUsersCanIgnore(User... user);\n\n    @Update(onConflict = OnConflictStrategy.REPLACE)\n    int updateUsersCanReplace(User... user);\n</code></pre> <code>onConflict</code>\u67093\u4e2a\u53c2\u6570\uff0c\u9ed8\u8ba4\u662f<code>ABORT</code>\u3002\u8fd9\u4e9b\u53c2\u6570\u4e0e\u6dfb\u52a0\u6570\u636e\u7684\u53c2\u6570\u4e00\u6837\u3002</p> <p>\u8fd4\u56de\u503cint\u8868\u793a\u6267\u884c\u66f4\u65b0\u64cd\u4f5c\u6210\u529f\u7684\u884c\u6570\uff08\u5bf9\u8c61\u6570\uff09\u3002</p> <p>\u5047\u8bbe\u8981\u66f4\u65b04\u4e2aUser\u5bf9\u8c61\uff0c\u4f46\u5b9e\u9645\u4e0a\u53ea\u66f4\u65b0\u4e863\u4e2a\uff0c\u5219<code>@Update</code>\u7684\u65b9\u6cd5\u8fd4\u56de3 <pre><code>    @NotNull\n    private User[] getUsers() {\n        User[] users = new User[4];\n        for (int i = 1; i &lt; 4; i++) {\n            final int uid = i + 1;\n            User user = new User(\"Rust\", \"Fisher-\" + uid);\n            user.uid = uid;\n            user.createTime = 54898 + i; // \u5047\u7684\u65f6\u95f4\n            users[i] = user;\n        }\n        User fakeUser = new User(\"fake\", \"user\");\n        fakeUser.uid = 100;\n        users[0] = fakeUser; // \u4e00\u4e2a\u5047\u7684\u6570\u636e\n        return users;\n    }\n\n// \u5c1d\u8bd5\u66f4\u65b0\u6570\u636e\nUser[] users = getUsers();\nUserDao userDao = DbMgr.getMgr().getDatabase().userDao();\nint res = userDao.updateUsersCanReplace(users);\nLog.d(TAG, \"updateManyCanReplace: \" + res);\n</code></pre></p> <p>\u6ce8\u610f\uff1a\u8fd9\u91cc\u7684User\u7c7b<code>PrimaryKey</code>\u53ea\u6709\u4e00\u4e2a<code>uid</code>\u3002</p> <p>\u6839\u636euid\u6765\u5224\u65ad\u8fd9\u4e00\u6761\u6570\u636e\u662f\u5426\u8981\u88ab\u66f4\u65b0\u3002</p>"},{"location":"android/jetpack/viewModel/act-frag-use-one-vm/","title":"Activity\u4e0eFragment\u7528\u540c\u4e00\u4e2aViewModel","text":"\u66f4\u65b0\u65e5\u671f 2022-5-17 <ul> <li>2022-5-17 \u589e\u52a0\u53c2\u8003</li> <li>2021-6-26 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u5b83\u4eec\u7528\u7684vm\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61\u3002Activity\u4e0eFragment\u4e2d\u90fd\u7528ViewModelProvider\u6765\u63d0\u4f9bViewModel\u5bf9\u8c61\u3002</p> <p>\u80fd\u7528\u540c\u4e00\u4e2avm\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u65b9\u4fbf\u7684\u5b9e\u73b0Activity\u4e0eFragment\u901a\u4fe1\u548cFragment\u4e4b\u95f4\u7684\u901a\u4fe1\u3002</p>"},{"location":"android/jetpack/viewModel/act-frag-use-one-vm/#viewmodel","title":"ViewModel","text":"<p>\u5b9a\u4e49AnimCollectVm <pre><code>public class AnimCollectVm extends AndroidViewModel {\n\n    public AnimCollectVm(@NonNull Application application) {\n        super(application);\n    }\n    // \u5176\u4ed6\u65b9\u6cd5...\n}\n</code></pre></p>"},{"location":"android/jetpack/viewModel/act-frag-use-one-vm/#activity","title":"Activity","text":"<p>\u5728<code>onCreate</code>\u65b9\u6cd5\u4e2d\uff0c\u8c03\u7528<code>new ViewModelProvider(this).get(AnimCollectVm.class)</code>\u83b7\u53d6\u5bf9\u8c61<code>mAnimVm</code> <pre><code>public class AnimCollectAct extends AppCompatActivity {\n    private AnimCollectActBinding mBinding;\n    private AnimCollectVm mAnimVm;\n\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        mBinding = DataBindingUtil.setContentView(this, R.layout.anim_collect_act);\n        mAnimVm = new ViewModelProvider(this).get(AnimCollectVm.class);\n        mBinding.setVm(mAnimVm);\n        // ...\n    }\n</code></pre></p>"},{"location":"android/jetpack/viewModel/act-frag-use-one-vm/#fragment","title":"Fragment","text":"<p>\u5728<code>onCreate</code>\u65b9\u6cd5\u4e2d\uff0c\u7528<code>new ViewModelProvider(getActivity()).get(AnimCollectVm.class)</code>\u83b7\u53d6\u5bf9\u8c61<code>mAnimVm</code> <pre><code>public class AbsAniFrag extends Fragment {\n    protected AnimCollectVm mAnimVm;\n\n    @Override\n    public void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        mAnimVm = new ViewModelProvider(getActivity()).get(AnimCollectVm.class);\n        Log.d(TAG, \"onCreate: frag vm-\" + mAnimVm.hashCode());\n        // ...\n    }\n}\n</code></pre></p>"},{"location":"android/jetpack/viewModel/act-frag-use-one-vm/#_1","title":"\u8fd0\u884c\u9a8c\u8bc1","text":"<p>Activity\u4e0eFragment\u83b7\u53d6\u5230\u7684\u662f\u540c\u4e00\u4e2avm\u5bf9\u8c61\u3002 \u5982\u679c\u6709\u591a\u4e2aFragment\uff0c\u4e5f\u53ef\u4ee5\u62ff\u5230\u540c\u4e00\u4e2a\u5bf9\u8c61\u3002</p>"},{"location":"android/jetpack/viewModel/act-frag-use-one-vm/#_2","title":"\u53c2\u8003","text":"<ul> <li>ViewModel \u6982\u89c8</li> <li>Activity\u4f7f\u7528ViewModel</li> </ul>"},{"location":"android/jetpack/viewModel/act-use-vm/","title":"Activity\u4f7f\u7528ViewModel","text":"\u66f4\u65b0\u65e5\u671f 2021-6-26 <ul> <li>2021-6-26 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u8fd9\u91cc\u7ed9\u51fa\u4e00\u4e2aActivity\u4f7f\u7528ViewModel\u7684\u7b80\u5355\u4f8b\u5b50\u3002</p> <ul> <li>\u8bbe\u8ba1ViewModel\u7c7b</li> <li>\u8bbe\u8ba1layout</li> <li>\u5728Activity\u4e2d\u5c062\u8005\u5173\u8054\u8d77\u6765</li> </ul>"},{"location":"android/jetpack/viewModel/act-use-vm/#viewmodel","title":"\u5b9a\u4e49ViewModel","text":"<p>\u65b0\u5efaAnimCollectVm\u7c7b\u7ee7\u627fAndroidViewModel\u3002</p> <pre><code>import android.app.Application;\nimport android.view.View;\n\nimport androidx.annotation.NonNull;\nimport androidx.lifecycle.AndroidViewModel;\nimport androidx.lifecycle.MutableLiveData;\n\npublic class AnimCollectVm extends AndroidViewModel {\n    // \u5176\u4ed6\u5bf9\u8c61...\n    public AnimCollectVm(@NonNull Application application) {\n        super(application);\n    }\n}\n</code></pre>"},{"location":"android/jetpack/viewModel/act-use-vm/#layout","title":"\u8bbe\u8ba1layout","text":"<p>layout\u6587\u4ef6<code>anim_collect_act.xml</code>\u3002 \u6700\u5916\u5c42\u7528<code>layout</code>\u6807\u7b7e\u3002<code>data</code>\u6807\u7b7e\u91cc\u653e\u4e00\u4e2aAnimCollectVm\u7c7b\u578b\u7684<code>vm</code>\u3002 <pre><code>&lt;layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"&gt;\n\n    &lt;data&gt;\n\n        &lt;variable\n            name=\"vm\"\n            type=\"com.rustfisher.tutorial2020.animation.collection.AnimCollectVm\" /&gt;\n    &lt;/data&gt;\n\n    &lt;androidx.constraintlayout.widget.ConstraintLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"&gt;\n\n        &lt;!-- \u5176\u4ed6\u5185\u5bb9 --&gt;\n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n&lt;/layout&gt;\n</code></pre> \u4f1a\u81ea\u52a8\u751f\u6210AnimCollectActBinding\u7c7b\u3002</p>"},{"location":"android/jetpack/viewModel/act-use-vm/#activityvm","title":"Activity\u4e2d\u4f7f\u7528vm","text":"<p>Activity\u7c7bAnimCollectAct\u9700\u8981\u7ee7\u627f<code>androidx.appcompat.app.AppCompatActivity</code>\u3002</p> <p>\u4f7f\u7528<code>DataBindingUtil.setContentView</code>\u65b9\u6cd5\u6765\u83b7\u5f97AnimCollectActBinding\u7684\u5bf9\u8c61<code>mBinding</code>\u3002</p> <p>\u4f7f\u7528ViewModelProvider\u7684<code>get</code>\u65b9\u6cd5\uff0c\u751f\u6210\u5bf9\u5e94\u7684AnimCollectVm\u5bf9\u8c61<code>mAnimVm</code>\u3002</p> <p>\u7136\u540e\u628a<code>mAnimVm</code>\u4ea4\u7ed9<code>mBinding</code>\u5bf9\u8c61\u3002 <pre><code>public class AnimCollectAct extends AppCompatActivity {\n    private AnimCollectActBinding mBinding;\n    private AnimCollectVm mAnimVm;\n\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        mBinding = DataBindingUtil.setContentView(this, R.layout.anim_collect_act);\n        mAnimVm = new ViewModelProvider(this).get(AnimCollectVm.class);\n        mBinding.setVm(mAnimVm);\n        // \u5176\u4ed6\u4ee3\u7801...\n    }\n}\n</code></pre></p> <p>\u53c2\u8003\u5de5\u7a0b Tutorial2020</p>"},{"location":"android/jetpack/viewModel/viewModel_intro/","title":"ViewModel \u6982\u89c8","text":"\u66f4\u65b0\u65e5\u671f 2021-6-26 <ul> <li>2021-6-26 \u521b\u5efa\u6587\u6863</li> </ul> <p>ViewModel \u7c7b\u65e8\u5728\u4ee5\u6ce8\u91cd\u751f\u547d\u5468\u671f\u7684\u65b9\u5f0f\u5b58\u50a8\u548c\u7ba1\u7406\u754c\u9762\u76f8\u5173\u7684\u6570\u636e\u3002ViewModel \u7c7b\u8ba9\u6570\u636e\u53ef\u5728\u53d1\u751f\u5c4f\u5e55\u65cb\u8f6c\u7b49\u914d\u7f6e\u66f4\u6539\u540e\u7ee7\u7eed\u5b58\u5728\u3002</p> <p>Android \u6846\u67b6\u53ef\u4ee5\u7ba1\u7406\u754c\u9762\u63a7\u5236\u5668\uff08\u5982 Activity \u548c Fragment\uff09\u7684\u751f\u547d\u5468\u671f\u3002Android \u6846\u67b6\u53ef\u80fd\u4f1a\u51b3\u5b9a\u9500\u6bc1\u6216\u91cd\u65b0\u521b\u5efa\u754c\u9762\u63a7\u5236\u5668\uff0c\u4ee5\u54cd\u5e94\u5b8c\u5168\u4e0d\u53d7\u60a8\u63a7\u5236\u7684\u67d0\u4e9b\u7528\u6237\u64cd\u4f5c\u6216\u8bbe\u5907\u4e8b\u4ef6\u3002</p> <p>\u5982\u679c\u7cfb\u7edf\u9500\u6bc1\u6216\u91cd\u65b0\u521b\u5efa\u754c\u9762\u63a7\u5236\u5668\uff0c\u5219\u5b58\u50a8\u5728\u5176\u4e2d\u7684\u4efb\u4f55\u4e34\u65f6\u6027\u754c\u9762\u76f8\u5173\u6570\u636e\u90fd\u4f1a\u4e22\u5931\u3002\u4f8b\u5982\uff0c\u5e94\u7528\u7684\u67d0\u4e2a Activity \u4e2d\u53ef\u80fd\u5305\u542b\u7528\u6237\u5217\u8868\u3002\u56e0\u914d\u7f6e\u66f4\u6539\u800c\u91cd\u65b0\u521b\u5efa Activity \u540e\uff0c\u65b0 Activity \u5fc5\u987b\u91cd\u65b0\u63d0\u53d6\u7528\u6237\u5217\u8868\u3002\u5bf9\u4e8e\u7b80\u5355\u7684\u6570\u636e\uff0cActivity \u53ef\u4ee5\u4f7f\u7528 onSaveInstanceState() \u65b9\u6cd5\u4ece onCreate() \u4e2d\u7684\u6346\u7ed1\u5305\u6062\u590d\u5176\u6570\u636e\uff0c\u4f46\u6b64\u65b9\u6cd5\u4ec5\u9002\u5408\u53ef\u4ee5\u5e8f\u5217\u5316\u518d\u53cd\u5e8f\u5217\u5316\u7684\u5c11\u91cf\u6570\u636e\uff0c\u800c\u4e0d\u9002\u5408\u6570\u91cf\u53ef\u80fd\u8f83\u5927\u7684\u6570\u636e\uff0c\u5982\u7528\u6237\u5217\u8868\u6216\u4f4d\u56fe\u3002</p> <p>\u53e6\u4e00\u4e2a\u95ee\u9898\u662f\uff0c\u754c\u9762\u63a7\u5236\u5668\u7ecf\u5e38\u9700\u8981\u8fdb\u884c\u5f02\u6b65\u8c03\u7528\uff0c\u8fd9\u4e9b\u8c03\u7528\u53ef\u80fd\u9700\u8981\u4e00\u4e9b\u65f6\u95f4\u624d\u80fd\u8fd4\u56de\u7ed3\u679c\u3002\u754c\u9762\u63a7\u5236\u5668\u9700\u8981\u7ba1\u7406\u8fd9\u4e9b\u8c03\u7528\uff0c\u5e76\u786e\u4fdd\u7cfb\u7edf\u5728\u5176\u9500\u6bc1\u540e\u6e05\u7406\u8fd9\u4e9b\u8c03\u7528\u4ee5\u907f\u514d\u6f5c\u5728\u7684\u5185\u5b58\u6cc4\u9732\u3002\u6b64\u9879\u7ba1\u7406\u9700\u8981\u5927\u91cf\u7684\u7ef4\u62a4\u5de5\u4f5c\uff0c\u5e76\u4e14\u5728\u56e0\u914d\u7f6e\u66f4\u6539\u800c\u91cd\u65b0\u521b\u5efa\u5bf9\u8c61\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u9020\u6210\u8d44\u6e90\u7684\u6d6a\u8d39\uff0c\u56e0\u4e3a\u5bf9\u8c61\u53ef\u80fd\u9700\u8981\u91cd\u65b0\u53d1\u51fa\u5df2\u7ecf\u53d1\u51fa\u8fc7\u7684\u8c03\u7528\u3002</p> <p>\u8bf8\u5982 Activity \u548c Fragment \u4e4b\u7c7b\u7684\u754c\u9762\u63a7\u5236\u5668\u4e3b\u8981\u7528\u4e8e\u663e\u793a\u754c\u9762\u6570\u636e\u3001\u5bf9\u7528\u6237\u64cd\u4f5c\u505a\u51fa\u54cd\u5e94\u6216\u5904\u7406\u64cd\u4f5c\u7cfb\u7edf\u901a\u4fe1\uff08\u5982\u6743\u9650\u8bf7\u6c42\uff09\u3002\u5982\u679c\u8981\u6c42\u754c\u9762\u63a7\u5236\u5668\u4e5f\u8d1f\u8d23\u4ece\u6570\u636e\u5e93\u6216\u7f51\u7edc\u52a0\u8f7d\u6570\u636e\uff0c\u90a3\u4e48\u4f1a\u4f7f\u7c7b\u8d8a\u53d1\u81a8\u80c0\u3002\u4e3a\u754c\u9762\u63a7\u5236\u5668\u5206\u914d\u8fc7\u591a\u7684\u8d23\u4efb\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5355\u4e2a\u7c7b\u5c1d\u8bd5\u81ea\u5df1\u5904\u7406\u5e94\u7528\u7684\u6240\u6709\u5de5\u4f5c\uff0c\u800c\u4e0d\u662f\u5c06\u5de5\u4f5c\u59d4\u6258\u7ed9\u5176\u4ed6\u7c7b\u3002\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u4e3a\u754c\u9762\u63a7\u5236\u5668\u5206\u914d\u8fc7\u591a\u7684\u8d23\u4efb\u4e5f\u4f1a\u5927\u5927\u589e\u52a0\u6d4b\u8bd5\u7684\u96be\u5ea6\u3002</p> <p>\u4ece\u754c\u9762\u63a7\u5236\u5668\u903b\u8f91\u4e2d\u5206\u79bb\u51fa\u89c6\u56fe\u6570\u636e\u6240\u6709\u6743\u7684\u505a\u6cd5\u66f4\u6613\u884c\u4e14\u66f4\u9ad8\u6548\u3002</p>"},{"location":"android/jetpack/viewModel/viewModel_intro/#fragment","title":"\u5728 Fragment \u4e4b\u95f4\u5171\u4eab\u6570\u636e","text":"<p>Activity \u4e2d\u7684\u4e24\u4e2a\u6216\u66f4\u591a Fragment \u9700\u8981\u76f8\u4e92\u901a\u4fe1\u662f\u4e00\u79cd\u5f88\u5e38\u89c1\u7684\u60c5\u51b5\u3002\u60f3\u8c61\u4e00\u4e0b\u4e3b\u4ece Fragment \u7684\u5e38\u89c1\u60c5\u51b5\uff0c\u5047\u8bbe\u60a8\u6709\u4e00\u4e2a Fragment\uff0c\u5728\u8be5 Fragment \u4e2d\uff0c\u7528\u6237\u4ece\u5217\u8868\u4e2d\u9009\u62e9\u4e00\u9879\uff0c\u8fd8\u6709\u53e6\u4e00\u4e2a Fragment\uff0c\u7528\u4e8e\u663e\u793a\u9009\u5b9a\u9879\u7684\u5185\u5bb9\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0d\u592a\u5bb9\u6613\u5904\u7406\uff0c\u56e0\u4e3a\u8fd9\u4e24\u4e2a Fragment \u90fd\u9700\u8981\u5b9a\u4e49\u67d0\u79cd\u63a5\u53e3\u63cf\u8ff0\uff0c\u5e76\u4e14\u6240\u6709\u8005 Activity \u5fc5\u987b\u5c06\u4e24\u8005\u7ed1\u5b9a\u5728\u4e00\u8d77\u3002\u6b64\u5916\uff0c\u8fd9\u4e24\u4e2a Fragment \u90fd\u5fc5\u987b\u5904\u7406\u53e6\u4e00\u4e2a Fragment \u5c1a\u672a\u521b\u5efa\u6216\u4e0d\u53ef\u89c1\u7684\u60c5\u51b5\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 ViewModel \u5bf9\u8c61\u89e3\u51b3\u8fd9\u4e00\u5e38\u89c1\u7684\u96be\u70b9\u3002\u8fd9\u4e24\u4e2a Fragment \u53ef\u4ee5\u4f7f\u7528\u5176 Activity \u8303\u56f4\u5171\u4eab ViewModel \u6765\u5904\u7406\u6b64\u7c7b\u901a\u4fe1\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u4ee3\u7801\u6240\u793a\uff1a</p> <p><pre><code>    public class SharedViewModel extends ViewModel {\n        private final MutableLiveData&lt;Item&gt; selected = new MutableLiveData&lt;Item&gt;();\n\n        public void select(Item item) {\n            selected.setValue(item);\n        }\n\n        public LiveData&lt;Item&gt; getSelected() {\n            return selected;\n        }\n    }\n\n    public class MasterFragment extends Fragment {\n        private SharedViewModel model;\n        public void onCreate(Bundle savedInstanceState) {\n            super.onCreate(savedInstanceState);\n            model = ViewModelProviders.of(getActivity()).get(SharedViewModel.class);\n            itemSelector.setOnClickListener(item -&gt; {\n                model.select(item);\n            });\n        }\n    }\n\n    public class DetailFragment extends Fragment {\n        public void onCreate(Bundle savedInstanceState) {\n            super.onCreate(savedInstanceState);\n            SharedViewModel model = ViewModelProviders.of(getActivity()).get(SharedViewModel.class);\n            model.getSelected().observe(this, { item -&gt;\n               // Update the UI.\n            });\n        }\n    }\n</code></pre> \u8bf7\u6ce8\u610f\uff0c\u8fd9\u4e24\u4e2a Fragment \u90fd\u4f1a\u68c0\u7d22\u5305\u542b\u5b83\u4eec\u7684 Activity\u3002\u8fd9\u6837\uff0c\u5f53\u8fd9\u4e24\u4e2a Fragment \u5404\u81ea\u83b7\u53d6 ViewModelProvider \u65f6\uff0c\u5b83\u4eec\u4f1a\u6536\u5230\u76f8\u540c\u7684 SharedViewModel \u5b9e\u4f8b\uff08\u5176\u8303\u56f4\u9650\u5b9a\u4e3a\u8be5 Activity\uff09\u3002</p> <p>\u6b64\u65b9\u6cd5\u5177\u6709\u4ee5\u4e0b\u4f18\u52bf\uff1a</p> <ul> <li>Activity \u4e0d\u9700\u8981\u6267\u884c\u4efb\u4f55\u64cd\u4f5c\uff0c\u4e5f\u4e0d\u9700\u8981\u5bf9\u6b64\u901a\u4fe1\u6709\u4efb\u4f55\u4e86\u89e3\u3002</li> <li>\u9664\u4e86 SharedViewModel \u7ea6\u5b9a\u4e4b\u5916\uff0cFragment \u4e0d\u9700\u8981\u76f8\u4e92\u4e86\u89e3\u3002\u5982\u679c\u5176\u4e2d\u4e00\u4e2a Fragment \u6d88\u5931\uff0c\u53e6\u4e00\u4e2a Fragment \u5c06\u7ee7\u7eed\u7167\u5e38\u5de5\u4f5c\u3002</li> <li>\u6bcf\u4e2a Fragment \u90fd\u6709\u81ea\u5df1\u7684\u751f\u547d\u5468\u671f\uff0c\u800c\u4e0d\u53d7\u53e6\u4e00\u4e2a Fragment \u7684\u751f\u547d\u5468\u671f\u7684\u5f71\u54cd\u3002\u5982\u679c\u4e00\u4e2a Fragment \u66ff\u6362\u53e6\u4e00\u4e2a Fragment\uff0c\u754c\u9762\u5c06\u7ee7\u7eed\u5de5\u4f5c\u800c\u6ca1\u6709\u4efb\u4f55\u95ee\u9898\u3002</li> </ul>"},{"location":"android/jetpack/viewModel/viewModel_intro/#viewmodelproviders","title":"ViewModelProviders \u793a\u4f8b","text":"<p>\u6ce8\uff1aViewModelProviders\u5df2Deprecated</p> <p>activity <pre><code>MyAppViewModelFactory factory = MyAppViewModelFactory.getInstance(getApplication());\nViewModelProviders.of(this, factory).get(VM.class);\n</code></pre></p> <p>fragment <pre><code>MyAppViewModelFactory factory = MyAppViewModelFactory.getInstance(getActivity().getApplication());\nViewModelProviders.of(getActivity(), factory).get(VM.class);\n</code></pre></p> <p>activity\u548cfragment\u62ff\u5230\u7684\u662f\u540c\u4e00\u4e2avm\u3002 \u8fd9\u8868\u660e\u4e00\u4e2aactivity\u548c\u591a\u4e2afragment\u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u4e2avm\uff0c\u7531\u540c\u4e00\u4e2avm\u6765\u7ba1\u7406\u6570\u636e\u3002</p>"},{"location":"android/jetpack/workManager/periodic1/","title":"WorkManager\u5b9a\u65f6\u4efb\u52a1","text":"\u66f4\u65b0\u65e5\u671f 2021-8-22 <ul> <li>2021-8-22 \u521b\u5efa\u6587\u6863</li> </ul> <p>App\u6709\u65f6\u53ef\u80fd\u9700\u8981\u5b9a\u671f\u8fd0\u884c\u67d0\u4e9b\u5de5\u4f5c\u3002\u4f8b\u5982\uff0c\u53ef\u80fd\u8981\u5b9a\u671f\u5907\u4efd\u6570\u636e\u3001\u4e0a\u4f20\u4fe1\u606f\u5230\u670d\u52a1\u5668\uff0c\u5b9a\u671f\u83b7\u53d6\u65b0\u7684\u5185\u5bb9\u7b49\u7b49\u3002 \u5728app\u8fd0\u884c\u671f\u95f4\uff0c\u6211\u4eec\u4f7f\u7528Handler\u4e5f\u53ef\u4ee5\u5b8c\u6210\u5b9a\u671f\u7684\u529f\u80fd\u3002\u5728\u8fd9\u91cc\u6211\u4eec\u4ecb\u7ecdWorkManager\u4f7f\u7528\u5b9a\u65f6\u4efb\u52a1\u7684\u65b9\u6cd5\u3002</p> <p>\u524d\u9762\u6211\u4eec\u4ecb\u7ecd\u4e86WorkManager\u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u7ea6\u675f\u548c\u5ef6\u8fdf\u7b49\u3002\u672c\u6587\u4ecb\u7ecdWorkManager\u7684\u5b9a\u65f6\u4efb\u52a1\u3002\u5982\u4f55\u521b\u5efa\u5b9a\u65f6\u4efb\u52a1\uff0c\u67e5\u770b\u4efb\u52a1\u72b6\u6001\uff0c\u53d6\u6d88\u4efb\u52a1\u3002</p> <p>\u672c\u6587\u4f7f\u7528kotlin</p> <p>\u6ce8\u610f\uff1a\u53ef\u4ee5\u5b9a\u4e49\u7684\u6700\u77ed\u91cd\u590d\u95f4\u9694\u662f 15 \u5206\u949f\uff08\u4e0e JobScheduler API \u76f8\u540c\uff09\u3002</p>"},{"location":"android/jetpack/workManager/periodic1/#gradle","title":"gradle","text":"<p>kotlin\u4f7f\u7528PeriodicWorkRequestBuilder\u65f6\u5019\u62a5\u9519\u8bef\u63d0\u793a</p> <p>Cannot inline bytecode built with JVM target 1.8 into bytecode that is being built with JVM target 1.6.  Please specify proper '-jvm-target' option</p> <p>\u6839\u636e\u63d0\u793a\uff0c\u5728app\u7684gradle\u914d\u7f6e\u6dfb\u52a0<code>kotlinOptions</code>\u7684<code>jvmTarget</code> <pre><code>android {\n    // \u5176\u4ed6\u914d\u7f6e...\n\n    kotlinOptions {\n        jvmTarget = \"1.8\"\n    }\n}\n</code></pre></p>"},{"location":"android/jetpack/workManager/periodic1/#_1","title":"\u521b\u5efa\u5b9a\u65f6\u4efb\u52a1","text":"<p>\u521b\u5efa\u5b9a\u65f6\u4efb\u52a1\uff0c\u7528\u5230PeriodicWorkRequestBuilder\uff0c\u4f20\u5165\u5b9a\u65f6\u7684\u53c2\u6570\uff0c<code>build()</code>\u5f97\u5230\u4efb\u52a1\u5b9e\u4f8b\u3002 \u4ea4\u7ed9WorkManager\u7684<code>enqueue</code>\u65b9\u6cd5\u5373\u53ef\u3002 <pre><code>val r1 = PeriodicWorkRequestBuilder&lt;UploadWorker2&gt;(15, TimeUnit.MINUTES)\n        .addTag(\"r1\").build()\nWorkManager.getInstance(applicationContext).enqueue(r1)\n</code></pre> \u4e0a\u9762\u7684\u4ee3\u7801\uff0c<code>enqueue</code>\u540e\u4f1a\u7acb\u523b\u6267\u884c\u4e00\u6b21\u4efb\u52a1\u3002 \u591a\u6b21\u521b\u5efa\u4efb\u52a1\uff0c\u53ef\u4ee5\u5f97\u5230\u591a\u4e2a\u5b9a\u65f6\u4efb\u52a1\u3002</p> <p>\u6ce8\u610f\uff1a\u53ef\u4ee5\u5b9a\u4e49\u7684\u6700\u77ed\u91cd\u590d\u95f4\u9694\u662f 15 \u5206\u949f\uff08\u4e0e JobScheduler API \u76f8\u540c\uff09\u3002</p>"},{"location":"android/jetpack/workManager/periodic1/#_2","title":"\u5355\u4e00\u4efb\u52a1","text":"<p>\u5982\u679c\u4e0d\u60f3\u8981\u91cd\u590d\u7684\u5b9a\u65f6\u4efb\u52a1\uff0c\u9700\u8981\u7528WorkManager\u7684<code>enqueueUniquePeriodicWork</code>\u65b9\u6cd5\u3002 <pre><code>val r1 = PeriodicWorkRequestBuilder&lt;UploadWorker2&gt;(15, TimeUnit.MINUTES)\n        .addTag(\"r2\").build()\nWorkManager.getInstance(applicationContext)\n        .enqueueUniquePeriodicWork(\n                \"\u5355\u72ec\u7684\u5b9a\u65f6\u4efb\u52a1r2\",\n                ExistingPeriodicWorkPolicy.KEEP,\n                r1)\n</code></pre> \u7528PeriodicWorkRequestBuilder\u521b\u5efa\u51fa\u4efb\u52a1\u540e\u3002 \u8c03\u7528<code>enqueueUniquePeriodicWork</code>\uff0c\u6b64\u65b9\u6cd5\u9700\u89813\u4e2a\u53c2\u6570\uff1a</p> <ul> <li><code>uniqueWorkName</code> \u552f\u4e00\u7684\u4efb\u52a1\u540d\u5b57</li> <li><code>ExistingPeriodicWorkPolicy</code> \u53d1\u73b0\u4efb\u52a1\u91cd\u590d\u65f6\u7684\u5904\u7406\u65b9\u6cd5<ul> <li><code>REPLACE</code> \u628a\u65e7\u7684\u4efb\u52a1\u505c\u6b62\u5e76\u5220\u9664\uff0c\u7136\u540e\u63d2\u5165\u65b0\u7684\u4efb\u52a1</li> <li><code>KEEP</code> \u4fdd\u7559\u539f\u6765\u7684\u4efb\u52a1\uff0c\u4e0d\u65b0\u589e\u4efb\u52a1</li> </ul> </li> <li><code>PeriodicWorkRequest</code> \u4efb\u52a1\u5bf9\u8c61</li> </ul> <p><code>enqueueUniquePeriodicWork</code>\u65b9\u6cd5\u80fd\u4fdd\u8bc11\u4e2a\u540d\u5b57\u540c\u65f6\u53ea\u6709\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\uff08PeriodicWorkRequest\uff09\u3002 \u5982\u679c\u662f\u540c\u6837\u7684\u540d\u5b57\uff08uniqueWorkName\uff09\uff0c\u63d2\u5165\u4efb\u52a1\u65f6\u53ef\u80fd\u4f1a\u66ff\u6362\u65e7\u4efb\u52a1\uff08REPLACE\uff09\uff0c\u6216\u8005\u4e0d\u5f71\u54cd\u65e7\u4efb\u52a1\uff08KEEP\uff09\u3002</p>"},{"location":"android/jetpack/workManager/periodic1/#_3","title":"\u67e5\u770b\u4efb\u52a1","text":"<p>\u5728\u8fd9\u91cc\u6211\u4eec\u7528<code>getWorkInfosByTag</code>\u6765\u67e5\u8be2\u4efb\u52a1</p> <pre><code>val status = WorkManager.getInstance(applicationContext).getWorkInfosByTag(\"r1\")\nval workInfoList: List&lt;WorkInfo&gt; = status.get()\nfor (w in workInfoList) {\n    Log.d(\"rustfisher.com\", \" $w\")\n}\n</code></pre> <p>\u67e5\u8be2\u7ed3\u679c\u7684\u4f8b\u5b50 <pre><code> WorkInfo{mId='83d7d512-8a5d-4613-acbb-e73ee2855212', mState=ENQUEUED, mOutputData=Data {}, mTags=[com.rustfisher.tutorial2020.workmanaer.WorkManagerAct$UploadWorker2, r1], mProgress=Data {}}\n</code></pre></p>"},{"location":"android/jetpack/workManager/periodic1/#_4","title":"\u53d6\u6d88\u4efb\u52a1","text":"<p>\u6211\u4eec\u6709\u591a\u79cd\u53d6\u6d88\u4efb\u52a1\u7684\u65b9\u6cd5\u3002</p>"},{"location":"android/jetpack/workManager/periodic1/#_5","title":"\u53d6\u6d88\u6240\u6709\u4efb\u52a1","text":"<p><code>cancelAllWork()</code>\uff0c\u53d6\u6d88\u6240\u6709\u4efb\u52a1 <pre><code>WorkManager.getInstance(applicationContext).cancelAllWork()\n</code></pre></p>"},{"location":"android/jetpack/workManager/periodic1/#_6","title":"\u53d6\u6d88\u5355\u72ec\u7684\u4efb\u52a1","text":"<p><code>cancelUniqueWork(uniqueWorkName: String)</code>\uff0c\u53d6\u6d88\u5355\u72ec\u7684\u4efb\u52a1\uff0c\u4f20\u5165<code>uniqueWorkName</code> <pre><code>WorkManager.getInstance(applicationContext).cancelUniqueWork(\"\u5355\u72ec\u7684\u5b9a\u65f6\u4efb\u52a1r2\")\n</code></pre></p>"},{"location":"android/jetpack/workManager/periodic1/#tag","title":"\u53d6\u6d88\u4f20\u5165tag\u7684\u6240\u6709\u4efb\u52a1","text":"<p><code>cancelAllWorkByTag(tag)</code>\uff0c\u53d6\u6d88\u4f20\u5165tag\u7684\u6240\u6709\u4efb\u52a1 <pre><code>WorkManager.getInstance(applicationContext).cancelAllWorkByTag(\"r1\")\n</code></pre></p>"},{"location":"android/jetpack/workManager/periodic1/#uuid","title":"\u53d6\u6d88\u7279\u5b9aUUID\u7684\u4efb\u52a1","text":"<p><code>cancelWorkById(UUID)</code>\uff0c\u53d6\u6d88\u7279\u5b9aUUID\u7684\u4efb\u52a1 <pre><code>WorkManager.getInstance(applicationContext).cancelWorkById(UUID)\n</code></pre></p> <p>\u53d6\u6d88\u4efb\u52a1\u540e\uff0c\u518d\u53bb\u67e5\u8be2\u4efb\u52a1\u72b6\u6001\uff0c\u4f1a\u53d1\u73b0<code>mState=CANCELLED</code> <pre><code>WorkInfo{mId='7c9e0deb-5267-4ade-8b95-c695e57f274c', mState=CANCELLED, mOutputData=Data {}, mTags=[r2, com.rustfisher.tutorial2020.workmanaer.WorkManagerAct$UploadWorker2], mProgress=Data {}}\n</code></pre></p>"},{"location":"android/jetpack/workManager/periodic1/#_7","title":"\u53c2\u8003","text":"<ul> <li>WorkManager\u4f7f\u7528\u5165\u95e8 https://an.rustfisher.com/android/jetpack/workManager/use1/</li> <li>WorkManager\u5de5\u4f5c\u7ea6\u675f\uff0c\u5ef6\u8fdf\u4e0e\u67e5\u8be2\u5de5\u4f5c https://an.rustfisher.com/android/jetpack/workManager/use2/</li> <li>\u5b9a\u671f\u5de5\u4f5c https://developer.android.com/topic/libraries/architecture/workmanager/how-to/define-work#schedule_periodic_work</li> <li>\u89c2\u5bdf\u5de5\u4f5c https://developer.android.com/topic/libraries/architecture/workmanager/how-to/managing-work#observing</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u534e\u4e3a\u4e91\u793e\u533a \u6398\u91d1</p>"},{"location":"android/jetpack/workManager/use1/","title":"Android WorkManager\u4f7f\u7528\u5165\u95e8","text":"\u66f4\u65b0\u65e5\u671f: 2021-9-12 <ul> <li>2021-9-12 \u66f4\u65b0\u56fe</li> <li>2021-8-18 \u521b\u5efa</li> </ul> <p><code>WorkManager</code>\u63d0\u4f9b\u4e86\u4efb\u52a1\u8c03\u5ea6\u529f\u80fd\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u5de5\u4f5c\u8fdb\u884c\u6807\u8bb0\u6216\u547d\u540d\u3002 \u6211\u4eec\u7528\u4e00\u4e2a\u793a\u4f8b\u6765\u6f14\u793a\u5982\u4f55\u4f7f\u7528WorkManager\u3002\u672c\u6587\u4f7f\u7528Kotlin\u3002</p>"},{"location":"android/jetpack/workManager/use1/#_1","title":"\u5165\u95e8\u793a\u4f8b","text":""},{"location":"android/jetpack/workManager/use1/#gradle","title":"gradle\u5f15\u5165\u4f9d\u8d56","text":"<p>\u5c06\u4ee5\u4e0b\u4f9d\u8d56\u9879\u6dfb\u52a0\u5230\u5e94\u7528\u6a21\u5757\u7684build.gradle\u6587\u4ef6\u4e2d <pre><code>dependencies {\n    def work_version = \"2.5.0\"\n\n    // (Java only)\n    implementation \"androidx.work:work-runtime:$work_version\"\n\n    // Kotlin + coroutines\n    implementation \"androidx.work:work-runtime-ktx:$work_version\"\n\n    // optional - RxJava2 support\n    implementation \"androidx.work:work-rxjava2:$work_version\"\n\n    // optional - GCMNetworkManager support\n    implementation \"androidx.work:work-gcm:$work_version\"\n\n    // optional - Test helpers\n    androidTestImplementation \"androidx.work:work-testing:$work_version\"\n\n    // optional - Multiprocess support\n    implementation \"androidx.work:work-multiprocess:$work_version\"\n}\n</code></pre> \u6dfb\u52a0\u4f9d\u8d56\u9879\u5e76\u540c\u6b65 Gradle \u540e\uff0c\u4e0b\u4e00\u6b65\u8981\u5b9a\u4e49\u4e00\u4e9b\u5de5\u4f5c\u3002</p>"},{"location":"android/jetpack/workManager/use1/#_2","title":"\u5b9a\u4e49\u5de5\u4f5c","text":"<p>\u8fd9\u91cc\u7684\u5de5\u4f5c\u4e3a\u65b9\u4fbf\u6d4b\u8bd5\u8fdb\u884c\u4e86\u7b80\u5316\u3002\u5b9e\u9645\u9879\u76ee\u4e2d\u8bf7\u6539\u4e3a\u5177\u4f53\u7684\u4e1a\u52a1\u4ee3\u7801\u3002 \u65b0\u5efa<code>UploadWorker</code>\u7c7b\u7ee7\u627f<code>Worker</code>\u7c7b\u3002\u9700\u89812\u4e2a\u53c2\u6570<code>context: Context, params: WorkerParameters</code>\u3002 \u5728<code>doWork()</code>\u65b9\u6cd5\u4e2d\u662f\u6211\u4eec\u7684\u5177\u4f53\u4efb\u52a1\uff0c\u5728<code>WorkManager</code>\u63d0\u4f9b\u7684\u540e\u53f0\u7ebf\u7a0b\u4e0a\u5f02\u6b65\u8fd0\u884c\u3002</p> <p><pre><code>class UploadWorker(context: Context, params: WorkerParameters) : Worker(context, params) {\n    override fun doWork(): Result {\n        for (i in 1..3) {\n            Log.d(TAG, \"\u6a21\u62df\u6267\u884c\u4efb\u52a1 ${tags.first()} ${Thread.currentThread()}\")\n            Thread.sleep(100) // \u6a21\u62df\u8017\u65f6\n        }\n        return Result.success()\n    }\n}\n</code></pre> <code>doWork()</code>\u65b9\u6cd5\u4e2d\u6211\u4eec\u6253\u5370\u5f53\u524d\u7ebf\u7a0b\u4fe1\u606f\u3002\u540e\u9762\u770b\u770b\u7ebf\u7a0b\u8fd0\u884c\u60c5\u51b5\u3002</p> <p>\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\uff0c<code>doWork()</code>\u9700\u8981\u8fd4\u56de\u4e00\u4e2a<code>Result</code>\uff1a</p> <ul> <li><code>Result.success()</code>\uff1a\u5de5\u4f5c\u6210\u529f\u5b8c\u6210</li> <li><code>Result.failure()</code>\uff1a\u5de5\u4f5c\u5931\u8d25</li> <li><code>Result.retry()</code>\uff1a\u5de5\u4f5c\u5931\u8d25\uff0c\u5e94\u6839\u636e\u5176\u91cd\u8bd5\u653f\u7b56\u5728\u5176\u4ed6\u65f6\u95f4\u5c1d\u8bd5</li> </ul>"},{"location":"android/jetpack/workManager/use1/#workrequest","title":"\u521b\u5efa WorkRequest","text":"<p>\u524d\u9762\u6211\u4eec\u5b9a\u4e49\u597d\u4e86\u5de5\u4f5c\u7c7b<code>UploadWorker</code>\u3002<code>WorkManager</code>\u53ef\u4ee5\u8c03\u5ea6\u5de5\u4f5c\uff0c\u8ba9\u5de5\u4f5c\u8fd0\u884c\u8d77\u6765\u3002\u5de5\u4f5c\u53ef\u4ee5\u5728\u67d0\u4e2a\u65f6\u95f4\u6bb5\u5185\u5b9a\u671f\u8fd0\u884c\uff0c\u4e5f\u53ef\u4ee5\u53ea\u8fd0\u884c\u4e00\u6b21\u3002 \u8981\u8fd0\u884c\u5de5\u4f5c\uff0c\u6d89\u53ca\u5230<code>WorkRequest</code>\u7c7b\u548c\u5b83\u7684\u5b50\u7c7b\u3002</p> <p>\u8fd9\u91cc\u6211\u4eec\u6f14\u793a\u53ea\u8fd0\u884c1\u6b21\u7684\u5de5\u4f5c\uff0c\u4f7f\u7528<code>OneTimeWorkRequest</code>\u3002 \u521b\u5efa<code>workA</code>\uff0c\u4f5c\u4e3a\u4e00\u4e2aActivity\u91cc\u7684\u53d8\u91cf <pre><code>private val mWorkA = OneTimeWorkRequest.Builder(UploadWorker::class.java)\n        .addTag(\"workA\").build()\n</code></pre></p> <p>\u521b\u5efa<code>workB</code> <pre><code>val workB = OneTimeWorkRequest.Builder(UploadWorker::class.java)\n        .addTag(\"workB\").build()\n</code></pre></p>"},{"location":"android/jetpack/workManager/use1/#workrequestworkmanager","title":"\u5c06WorkRequest\u63d0\u4ea4\u7ed9WorkManager","text":"<p>\u4f7f\u7528<code>enqueue</code>\u65b9\u6cd5\u5c06WorkRequest\u63d0\u4ea4\u7ed9WorkManager\u3002</p> <p>\u83b7\u53d6<code>WorkManager</code>\u7684\u5b9e\u4f8b\u7528<code>WorkManager.getInstance(applicationContext)</code>\u65b9\u6cd5\u3002</p> <p><code>mWorkA</code>\u662f\u53d8\u91cf <pre><code>WorkManager.getInstance(applicationContext).enqueue(mWorkA)\n// ...\n</code></pre></p> <p><code>workB</code>\u662f\u6bcf\u6b21\u90fd\u65b0\u5efa\u4e00\u4e2a\u5bf9\u8c61\uff0c\u7136\u540e\u4ea4\u7ed9<code>WorkManager</code>\u53bb\u6267\u884c\u3002 <pre><code>val workB = OneTimeWorkRequest.Builder(UploadWorker::class.java)\n        .addTag(\"workB\").build()\nWorkManager.getInstance(applicationContext).enqueue(workB)\n</code></pre></p> <p></p> <p>\u6267\u884c\u5de5\u4f5c\u5668\u7684\u786e\u5207\u65f6\u95f4\u53d6\u51b3\u4e8e<code>WorkRequest</code>\u4e2d\u4f7f\u7528\u7684\u7ea6\u675f\u548c\u7cfb\u7edf\u4f18\u5316\u65b9\u5f0f\u3002 Google\u5b98\u65b9\u8bbe\u8ba1\u8fc7<code>WorkManager</code>\uff0c\u80fd\u591f\u5728\u6ee1\u8db3\u7ea6\u675f\u7684\u60c5\u51b5\u4e0b\u63d0\u4f9b\u6700\u4f73\u884c\u4e3a\u3002</p>"},{"location":"android/jetpack/workManager/use1/#_3","title":"\u8fd0\u884c\u6d4b\u8bd5","text":"<p>\u6309\u94aeA\u89e6\u53d1<code>mWorkA</code>\uff0c\u6309\u94aeB\u89e6\u53d1<code>workB</code>\u3002\u5206\u522b\u70b9\u51fb\u6309\u94aeA/B <pre><code>\u6a21\u62df\u6267\u884c\u4efb\u52a1 workA Thread[pool-2-thread-3,5,main]\n\u6a21\u62df\u6267\u884c\u4efb\u52a1 workA Thread[pool-2-thread-3,5,main]\n\u6a21\u62df\u6267\u884c\u4efb\u52a1 workA Thread[pool-2-thread-3,5,main]\n\u70b9\u51fb\u6309\u94aeB Thread[main,5,main]\n\u6a21\u62df\u6267\u884c\u4efb\u52a1 workB Thread[pool-2-thread-1,5,main]\n\u6a21\u62df\u6267\u884c\u4efb\u52a1 workB Thread[pool-2-thread-1,5,main]\n\u6a21\u62df\u6267\u884c\u4efb\u52a1 workB Thread[pool-2-thread-1,5,main]\n</code></pre></p> <p>\u89c2\u5bdflog\u53d1\u73b0\uff0c\u5de5\u4f5c\u7684<code>doWork()</code>\u65b9\u6cd5\u5728<code>WorkManager</code>\u63d0\u4f9b\u7684\u540e\u53f0\u7ebf\u7a0b\u4e0a\u5f02\u6b65\u8fd0\u884c\u3002 \u4e3b\u7ebf\u7a0b\u662f<code>[main,5,main]</code>\uff0c\u5de5\u4f5c\u7684\u7ebf\u7a0b\u662f<code>[pool-2-thread-3,5,main]</code>\u3002</p> <p>\u800c\u5728\u5b9e\u9645\u64cd\u4f5c\u4e2d\u53d1\u73b0\uff0c\u591a\u6b21\u70b9\u51fb\u6309\u94aeA\uff0c<code>mWorkA</code>\u53ea\u4f1a\u6267\u884c\u7b2c\u4e00\u6b21\u3002\u540e\u9762\u518d\u70b9\u51fb\u6309\u94aeA\uff0c<code>mWorkA</code>\u4e5f\u4e0d\u4f1a\u6267\u884c\u4e86\u3002</p>"},{"location":"android/jetpack/workManager/use1/#_4","title":"\u5c0f\u7ed3","text":"<p>\u8fd9\u4e2a\u4f8b\u5b50\u4ecb\u7ecd\u4e86\u5982\u4f55\u5f15\u5165<code>WorkManager</code>\uff0c\u5b9a\u4e49\u5de5\u4f5c\uff08\u4efb\u52a1\uff09\uff0c\u6392\u961f\u6267\u884c\u4efb\u52a1\u3002 \u5728\u4f7f\u7528\u65b9\u5f0f\u4e0a\uff0c\u8ba9\u4eba\u8054\u60f3\u5230AsyncTask\u3002</p> <p>\u5176\u4ed6\u53c2\u8003</p> <ul> <li>Google \u4f7f\u7528WorkManager\u8c03\u5ea6\u4efb\u52a1 https://developer.android.com/topic/libraries/architecture/workmanager</li> <li>WorkManager\u4f7f\u7528\u5165\u95e8 https://developer.android.com/topic/libraries/architecture/workmanager/basics</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u534e\u4e3a\u4e91\u793e\u533a \u6398\u91d1</p>"},{"location":"android/jetpack/workManager/use2/","title":"WorkManager\u5de5\u4f5c\u7ea6\u675f\uff0c\u5ef6\u8fdf\u4e0e\u67e5\u8be2\u5de5\u4f5c","text":"\u66f4\u65b0\u65e5\u671f: 2021-8-22 <ul> <li>2021-8-22 \u521b\u5efa</li> </ul> <p>\u672c\u6587\u53ef\u80fd\u4f1a\u6df7\u7528\u201c\u5de5\u4f5c\u201d\u4e0e\u201c\u4efb\u52a1\u201d\u8fd9\u4e24\u4e2a\u8bcd\u3002 \u672c\u6587\u4f8b\u5b50\u4f7f\u7528Kotlin</p> <p>\u51c6\u5907\u4e00\u4e2a\u5de5\u4f5c\u7c7b\uff08\u4efb\u52a1\uff09UploadWorker2 <pre><code>class UploadWorker2(context: Context, params: WorkerParameters) : Worker(context, params) {\n    override fun doWork(): Result {\n        Log.d(TAG, \"\u6a21\u62df\u6267\u884c\u4efb\u52a12 ${Thread.currentThread()}\")\n        return Result.success()\n    }\n}\n</code></pre></p>"},{"location":"android/jetpack/workManager/use2/#_1","title":"\u5de5\u4f5c\u7ea6\u675f","text":"<p>\u7ea6\u675f\u53ef\u8ba9\u5de5\u4f5c\u5ef6\u8fdf\u5230\u6ee1\u8db3\u6700\u4f73\u6761\u4ef6\u65f6\u8fd0\u884c\u3002\u4e0b\u9762\u7684\u7ea6\u675f\u9002\u7528\u4e8e WorkManager\u3002</p> \u540d\u79f0 \u8bf4\u660e NetworkType \u7ea6\u675f\u8fd0\u884c\u5de5\u4f5c\u6240\u9700\u7684\u7f51\u7edc\u7c7b\u578b\u3002\u4f8b\u5982 Wi-Fi (UNMETERED)\u3002 BatteryNotLow \u82e5\u4e3a true\uff0c\u90a3\u4e48\u5f53\u8bbe\u5907\u5904\u4e8e\u201c\u7535\u91cf\u4e0d\u8db3\u6a21\u5f0f\u201d\u65f6\uff0c\u5de5\u4f5c\u4e0d\u4f1a\u8fd0\u884c\u3002 RequiresCharging \u82e5\u4e3a true\uff0c\u90a3\u4e48\u5de5\u4f5c\u53ea\u80fd\u5728\u8bbe\u5907\u5145\u7535\u65f6\u8fd0\u884c\u3002 DeviceIdle \u82e5\u4e3a true\uff0c\u5219\u8bbe\u5907\u5fc5\u987b\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\u624d\u80fd\u8fd0\u884c\u5de5\u4f5c\u3002\u5982\u679c\u8003\u8651\u5230\u5176\u4ed6\u5e94\u7528\u7684\u6027\u80fd\uff0c\u5efa\u8bae\u7528\u8fd9\u4e2a\u7ea6\u675f\u3002 StorageNotLow \u82e5\u4e3a true\uff0c\u90a3\u4e48\u5f53\u8bbe\u5907\u4e0a\u7684\u5b58\u50a8\u7a7a\u95f4\u4e0d\u8db3\u65f6\uff0c\u5de5\u4f5c\u4e0d\u4f1a\u8fd0\u884c\u3002 <p>\u53ef\u7528<code>Constraints.Builder()</code>\u6765\u521b\u5efa\u5de5\u4f5c\u7ea6\u675f\u3002\u7136\u540e\u5c06Constraints\u5b9e\u4f8b\u5206\u914d\u7ed9<code>WorkRequest.Builder()</code>\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u5de5\u4f5c\u7ea6\u675f\u662f\u9488\u5bf9\u5de5\u4f5cWorkRequest\u7684\u3002</p> <p>\u4e0b\u9762\u8fd9\u4e2a\u5de5\u4f5c\u7ea6\u675f\uff0c\u53ea\u67091\u4e2a\u8981\u6c42\uff0c\u5728\u8bbe\u5907\u4f7f\u7528\u8ba1\u8d39\u6d41\u91cf\u662f\u6267\u884c\u4efb\u52a1\u3002 <pre><code>val constraints = Constraints.Builder()\n        .setRequiredNetworkType(NetworkType.METERED)\n        .build()\nval d1 = OneTimeWorkRequest.Builder(UploadWorker2::class.java)\n        .setConstraints(constraints)\n        .addTag(\"\u7ea6\u675f\").build()\nmIdList.add(d1.id) // \u767b\u8bb0\u4efb\u52a1id\uff0c\u53ef\u53bb\u6389\nWorkManager.getInstance(applicationContext).enqueue(d1)\n</code></pre></p> <p>\u771f\u673a\u6d4b\u8bd5\u4e2d\uff0c\u5982\u679c\u4e00\u5f00\u59cb\u624b\u673a\u7528\u7740wifi\uff0c\u90a3\u4e48\u4efb\u52a1\u4e0d\u4f1a\u6267\u884c\u3002\u800c\u5173\u6389wifi\uff0c\u6253\u5f00\u6d41\u91cf\u5f00\u5173\uff0c\u5c31\u4f1a\u6267\u884c\u4efb\u52a1\u3002 \u8fd9\u5c31\u662f\u6ee1\u8db3\u6700\u4f73\u6761\u4ef6\u65f6\u8fd0\u884c\u3002</p>"},{"location":"android/jetpack/workManager/use2/#networktype","title":"NetworkType\u8bf4\u660e","text":"<p><code>androidx.work.NetworkType</code>\u662f\u4e00\u4e2a\u679a\u4e3e\u7c7b\u3002\u76ee\u524d\u6709</p> \u679a\u4e3e \u8bf4\u660e NOT_REQUIRED \u8fd9\u4e2a\u5de5\u4f5c\u4e0d\u9700\u8981\u7f51\u7edc CONNECTED \u8fd9\u4e2a\u5de5\u4f5c\u9700\u8981\u6709\u7f51\u7edc\u8fde\u63a5 UNMETERED \u9700\u8981Wi-Fi NOT_ROAMING \u975e\u6f2b\u6e38\u7f51\u7edc METERED \u9700\u8981\u6309\u6d41\u91cf\u8ba1\u8d39\u7684\u7f51\u7edc"},{"location":"android/jetpack/workManager/use2/#_2","title":"\u5ef6\u8fdf\u5de5\u4f5c","text":"<p>\u5982\u679c\u5de5\u4f5c\u6ca1\u6709\u7ea6\u675f\uff0c\u6216\u8005\u5f53\u5de5\u4f5c\u52a0\u5165\u961f\u5217\u65f6\u6240\u6709\u7ea6\u675f\u90fd\u5f97\u5230\u4e86\u6ee1\u8db3\uff0c\u90a3\u4e48\u7cfb\u7edf\u53ef\u80fd\u4f1a\u9009\u62e9\u7acb\u5373\u8fd0\u884c\u8be5\u5de5\u4f5c\u3002 \u5982\u679c\u4e0d\u5e0c\u671b\u5de5\u4f5c\u7acb\u5373\u8fd0\u884c\uff0c\u53ef\u4ee5\u7ed9\u5de5\u4f5c\u8bbe\u5b9a\u4e00\u4e2a\u5ef6\u8fdf\u65f6\u95f4\u3002</p> <p>\u4e0b\u9762\u8fd9\u4e2a\u5de5\u4f5c\u662f\u8981\u5ef6\u8fdf3\u79d2\u949f\u3002 <pre><code>val d1 = OneTimeWorkRequest.Builder(UploadWorker2::class.java)\n        .addTag(\"\u5ef6\u8fdf1\")\n        .setInitialDelay(3, TimeUnit.SECONDS)\n        .build()\nWorkManager.getInstance(applicationContext).enqueue(d1)\n</code></pre></p> <p><code>enqueue</code>\u4efb\u52a1\u540e\uff0c\u67e5\u4e00\u4e0b\u4efb\u52a1\u72b6\u6001\u3002\u5de5\u4f5c\u4ece<code>ENQUEUED</code>\u72b6\u6001\uff0c\u6267\u884c\u5b8c\u6bd5\u540e\u53d8\u6210\u4e86<code>SUCCEEDED</code>\u3002 <pre><code>WorkInfo{mId='2794b4dd-7c02-4fd0-9851-8798a0da3bb2', mState=ENQUEUED, mOutputData=Data {}, mTags=[com.rustfisher.tutorial2020.workmanaer.WorkManagerAct$UploadWorker2, \u5ef6\u8fdf1], mProgress=Data {}}\n\nWorkInfo{mId='2794b4dd-7c02-4fd0-9851-8798a0da3bb2', mState=SUCCEEDED, mOutputData=Data {}, mTags=[com.rustfisher.tutorial2020.workmanaer.WorkManagerAct$UploadWorker2, \u5ef6\u8fdf1], mProgress=Data {}}\n</code></pre></p>"},{"location":"android/jetpack/workManager/use2/#_3","title":"\u67e5\u8be2\u5de5\u4f5c","text":""},{"location":"android/jetpack/workManager/use2/#uuid","title":"\u4f7f\u7528UUID\u67e5\u8be2","text":"<p>\u65b0\u5efa\u5de5\u4f5c\u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u4f1a\u5206\u914d\u4e00\u4e2aUUID\u3002\u6211\u4eec\u53ef\u4ee5\u8bb0\u5f55UUID\u5230<code>mIdList</code>\u91cc\u3002\u901a\u8fc7UUID\u53ef\u4ee5\u67e5\u8be2\u5230\u5de5\u4f5c\u5f53\u524d\u7684\u72b6\u6001\u3002 <pre><code>val mgr = WorkManager.getInstance(applicationContext)\nfor (id in mIdList) {\n    val cur = mgr.getWorkInfoById(id)\n    Log.d(TAG, \"\u67e5\u8be2\u4efb\u52a1 ${cur.get()}\")\n}\n</code></pre></p> <p>\u4e00\u4e2a\u5de5\u4f5c\u72b6\u6001\u7684\u4f8b\u5b50\uff0c\u72b6\u6001\u662f<code>ENQUEUED</code> <pre><code>WorkInfo{mId='16cc292d-f140-488f-9ab5-a0d22b95d128', mState=ENQUEUED, mOutputData=Data {}, mTags=[com.rustfisher.tutorial2020.workmanaer.WorkManagerAct$UploadWorker, r1], mProgress=Data {}}\n</code></pre></p>"},{"location":"android/jetpack/workManager/use2/#tag","title":"\u4f7f\u7528tag\u67e5\u8be2","text":"<p>\u524d\u9762\u6211\u4eec\u7ed9\u5de5\u4f5c\u6253\u4e0atag\u3002\u53ef\u4ee5\u7528WorkManager\u7684<code>getWorkInfosByTag()</code>\u65b9\u6cd5\u628a\u6307\u5b9atag\u7684\u5de5\u4f5c\u67e5\u51fa\u6765\u3002 <pre><code>val mgr = WorkManager.getInstance(applicationContext)\n\nfor (w in mgr.getWorkInfosByTag(\"\u7ea6\u675f1\").get()) {\n    Log.d(TAG, \"$w\")\n}\n</code></pre></p> <p>\u5de5\u4f5c\u72b6\u6001\u7684\u4f8b\u5b50\uff0c\u4e0b\u9762\u8fd9\u4e2a\u5de5\u4f5c<code>UploadWorker</code>\u72b6\u6001\u662f<code>SUCCEEDED</code>\uff0ctag\u91cc\u6709<code>\u7ea6\u675f1</code> <pre><code>WorkInfo{mId='fed1974c-77e5-46ba-8b38-f6c01d68fe4c', mState=SUCCEEDED, mOutputData=Data {}, mTags=[com.rustfisher.tutorial2020.workmanaer.WorkManagerAct$UploadWorker, \u7ea6\u675f1], mProgress=Data {}}\n</code></pre></p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5de5\u4f5c\u7684\u72b6\u6001\u662f\u5b58\u50a8\u8d77\u6765\u7684\u3002\u5373\u4f7f\u91cd\u542fapp\u6216\u8005\u624b\u673a\uff0c\u90fd\u53ef\u4ee5\u67e5\u5230\u8fd9\u4e2a\u5de5\u4f5c\u7684\u72b6\u6001\u3002 \u5047\u8bbe\u67e5\u8be2tag\u662f<code>\u7ea6\u675f1</code>\uff0c\u6211\u4eec\u80fd\u5f97\u5230\u4e4b\u524d\u521b\u5efa\u7684\u542b\u6709\u8fd9\u4e2a<code>\u7ea6\u675f1</code>\u6807\u7b7e\u7684\u5de5\u4f5c\u3002</p>"},{"location":"android/jetpack/workManager/use2/#_4","title":"\u53c2\u8003","text":"<ul> <li>WorkManager\u5165\u95e8\u793a\u4f8b https://an.rustfisher.com/android/jetpack/workManager/use1/</li> <li>\u5b9a\u4e49\u5de5\u4f5c\u8bf7\u6c42 https://developer.android.com/topic/libraries/architecture/workmanager/how-to/define-work</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u534e\u4e3a\u4e91\u793e\u533a \u6398\u91d1</p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/","title":"GPUImage for Android \u521d\u63a2","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1 \u66f4\u65b0\u5206\u6790</li> <li>2022-5-19 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u672c\u6587\u76ee\u6807</p> <ul> <li> \u4e0b\u8f7d\u5de5\u7a0b\u4ee3\u7801\uff0c\u8fd0\u884c\u67e5\u770b\u6548\u679c</li> <li> \u5206\u6790\u5de5\u7a0b\u4ee3\u7801\u7ed3\u6784</li> <li> \u89c6\u9891\u6570\u636e\u6d41\u5411\u5206\u6790</li> </ul>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#_1","title":"\u7b80\u4ecb","text":"<p>GPUImage for Android\u4f7f\u7528OpenGL ES 2\u5728Android\u4e0a\u5b9e\u73b0\u4e86\u591a\u79cd\u57fa\u7840\u6ee4\u955c\u529f\u80fd\u3002 \u80fd\u5bf9\u6444\u50cf\u5934\u91c7\u96c6\u5230\u7684\u5b9e\u65f6\u6570\u636e\u548c\u56fe\u7247\u8fdb\u884c\u6ee4\u955c\u5904\u7406\u3002</p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#_2","title":"\u4e0b\u8f7d\u8fd0\u884c","text":"<p>\u5efa\u8bae\u628alibrary gradle\u6ce8\u91ca\u6389\u6700\u540e\u4e00\u53e5 <pre><code>//apply from: 'https://gist.githubusercontent.com/wasabeef/2f2ae8d97b429e7d967128125dc47854/raw/maven-central-v1.gradle'\n</code></pre></p> <p>\u8fd0\u884c\u5de5\u7a0b\u5230\u624b\u673a\u4e0a\uff0c\u9009\u62e9\u76f8\u673a\u6216\u8005\u76f8\u518c\u3002\u7136\u540e\u9009\u62e9\u6e32\u67d3\u79cd\u7c7b\uff0c\u62d6\u52a8\u8fdb\u5ea6\u6761\uff0c\u53ef\u4ee5\u770b\u5230\u6548\u679c\u3002</p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#_3","title":"\u4ee3\u7801\u7ed3\u6784","text":"<p>\u5de5\u7a0b\u7684\u529f\u80fd\u5305\u62ec\u5b9e\u65f6\u9884\u89c8\u6444\u50cf\u5934\u548c\u56fe\u7247\u5904\u7406\u3002\u4e0b\u9762\u6211\u4eec\u4ee5\u89c6\u9891\u4e3a\u4f8b\u770b\u4e00\u4e0b\u4ee3\u7801\u4e3b\u8981\u7684\u7ed3\u6784\u548c\u6570\u636e\u5904\u7406\u3002</p> <p>\u5de5\u7a0b\u91cc\u6709<code>sample</code>\u548c<code>library</code>\u4e24\u4e2a\u6a21\u5757\u3002\u6211\u4eec\u4e3b\u8981\u770b<code>library</code>\u3002</p> <p>GPUImageNativeLibrary\u63d0\u4f9b\u4e00\u4e9bnative\u65b9\u6cd5\uff0c\u6bd4\u5982\u8f6c\u6362yuv\u4e3aRGBA\u3002 \u5bf9\u5e94\u7684yuv-decoder.c\u5728cpp\u76ee\u5f55\u91cc\u3002</p> <p>GPUImage\u7c7b\u63d0\u4f9b\u4e86\u5927\u90e8\u5206\u7684\u529f\u80fd\u63a5\u53e3\u3002\u5b83\u6301\u6709GPUImageRenderer\u3001GPUImageFilter\uff0c\u4ee5\u53caGLSurfaceView\u548cGLTextureView\u3002</p> <p>GPUImageFilter\u5305\u542bOpenGL shader\u8bed\u53e5\uff0c\u8c03\u7528\u4e86GLES20\u7684\u65b9\u6cd5\u3002</p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#_4","title":"\u76f8\u673a\u9884\u89c8\u6570\u636e\u6d41\u5411","text":"\u6570\u636e\u6d41\u5411\u793a\u610f\u56fe <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u4ece\u76f8\u673a\u83b7\u53d6\u5230\u6570\u636e\uff0c\u5c42\u5c42\u4f20\u5165\u5e93\u4e2d\uff0c\u6700\u540e\u8fdb\u884c\u6e32\u67d3<code>OpenGlUtils.loadTexture</code>\u3002</p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#camera1","title":"Camera1 \u91c7\u96c6\u6570\u636e","text":"Camera1Loader.kt<pre><code>cameraInstance!!.setPreviewCallback { data, camera -&gt;\n    if (data == null || camera == null) {\n        return@setPreviewCallback\n    }\n    val size = camera.parameters.previewSize\n    onPreviewFrame?.invoke(data, size.width, size.height)\n}\n</code></pre> <p><code>onPreviewFrame</code>\u662f\u4e00\u4e2a\u56de\u8c03\u63a5\u53e3\uff0c\u5c06\u6444\u50cf\u5934\u91c7\u96c6\u5230\u7684\u6570\u636e\u56de\u8c03\u51fa\u53bb</p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#camera2","title":"Camera2 \u91c7\u96c6\u6570\u636e","text":"Camera2Loader.kt<pre><code>private fun startCaptureSession() {\n    val size = chooseOptimalSize()\n    imageReader =\n            ImageReader.newInstance(size.width, size.height, ImageFormat.YUV_420_888, 2).apply {\n                setOnImageAvailableListener({ reader -&gt;\n                    val image = reader?.acquireNextImage() ?: return@setOnImageAvailableListener\n                    onPreviewFrame?.invoke(image.generateNV21Data(), image.width, image.height)\n                    image.close()\n                }, null)\n            }\n\n    try {\n        cameraInstance?.createCaptureSession(\n            listOf(imageReader!!.surface),\n            CaptureStateCallback(),\n            null\n        )\n    } catch (e: CameraAccessException) {\n        Log.e(TAG, \"Failed to start camera session\")\n    }\n}\n</code></pre> <p>\u901a\u8fc7<code>onPreviewFrame</code>\u5c06nv21\u6570\u636e\u4f20\u51fa\u53bb</p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#_5","title":"\u5904\u7406\u6570\u636e","text":"<p>activity\u4e2d\u9009\u62e9\u5408\u9002\u7684<code>cameraLoader</code>\u3002\u4eceCamera\u4e2d\u83b7\u53d6\u5230\u7684\u6570\u636e\uff0c\u4f1a\u901a\u8fc7<code>onPreviewFrame</code>\u4f20\u51fa\u6765\uff0c\u5728activity\u4e2d\u63a5\u6536\u5230\u8fd9\u4e9b\u6570\u636e\u3002 \u7136\u540e\u4ea4\u7ed9<code>gpuImageView</code>\u53bb\u5904\u7406\u3002 CameraActivity.kt<pre><code>cameraLoader.setOnPreviewFrameListener { data, width, height -&gt;\n    gpuImageView.updatePreviewFrame(data, width, height)\n}\n</code></pre></p> <p>GPUImageView\u4e2d\u4ea4\u7ed9GPUImage\u6765\u5904\u7406 GPUImageView.java<pre><code>public void updatePreviewFrame(byte[] data, int width, int height) {\n    gpuImage.updatePreviewFrame(data, width, height);\n}\n</code></pre></p> <p>GPUImage\u4e2d\u4ea4\u7ed9GPUImageRender\u6765\u5904\u7406 GPUImage.java<pre><code>public void updatePreviewFrame(final byte[] data, final int width, final int height) {\n    renderer.onPreviewFrame(data, width, height);\n}\n</code></pre></p> <p>GPUImageRenderer\u4e2d\u8fdb\u884c\u5904\u7406 GPUImageRenderer.java<pre><code>public void onPreviewFrame(final byte[] data, final int width, final int height) {\n    if (glRgbBuffer == null) {\n        glRgbBuffer = IntBuffer.allocate(width * height);\n    }\n    if (runOnDraw.isEmpty()) {\n        runOnDraw(new Runnable() { // (1)\n            @Override\n            public void run() {\n                GPUImageNativeLibrary.YUVtoRBGA(data, width, height, glRgbBuffer.array());\n                glTextureId = OpenGlUtils.loadTexture(glRgbBuffer, width, height, glTextureId);\n                if (imageWidth != width) {\n                    imageWidth = width;\n                    imageHeight = height;\n                    adjustImageScaling();\n                }\n            }\n        });\n    }\n}\n</code></pre></p> <ol> <li>\u6dfb\u52a0\u4efb\u52a1</li> </ol> <p><code>runOnDraw</code>\u65b9\u6cd5\u628a\u6570\u636e\u5305\u8fdbRunnable\uff0c\u52a0\u5165\u4efb\u52a1\u961f\u5217<code>Queue&lt;Runnable&gt; runOnDraw</code>\u4e2d\u3002</p> <p>OpenGlUtils\u5148\u5c06YUV\u8f6c\u6362\u7ed9RBGA\uff0c\u518d\u8c03\u7528OpenGL\u7684\u65b9\u6cd5\u7ed8\u5236</p> OpenGlUtils.java<pre><code>public static int loadTexture(final IntBuffer data, final int width, final int height, final int usedTexId) {\n    int textures[] = new int[1];\n    if (usedTexId == NO_TEXTURE) {\n        GLES20.glGenTextures(1, textures, 0);\n        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, textures[0]);\n        GLES20.glTexParameterf(GLES20.GL_TEXTURE_2D,\n                GLES20.GL_TEXTURE_MAG_FILTER, GLES20.GL_LINEAR);\n        GLES20.glTexParameterf(GLES20.GL_TEXTURE_2D,\n                GLES20.GL_TEXTURE_MIN_FILTER, GLES20.GL_LINEAR);\n        GLES20.glTexParameterf(GLES20.GL_TEXTURE_2D,\n                GLES20.GL_TEXTURE_WRAP_S, GLES20.GL_CLAMP_TO_EDGE);\n        GLES20.glTexParameterf(GLES20.GL_TEXTURE_2D,\n                GLES20.GL_TEXTURE_WRAP_T, GLES20.GL_CLAMP_TO_EDGE);\n        GLES20.glTexImage2D(GLES20.GL_TEXTURE_2D, 0, GLES20.GL_RGBA, width, height,\n                0, GLES20.GL_RGBA, GLES20.GL_UNSIGNED_BYTE, data);\n    } else {\n        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, usedTexId);\n        GLES20.glTexSubImage2D(GLES20.GL_TEXTURE_2D, 0, 0, 0, width,\n                height, GLES20.GL_RGBA, GLES20.GL_UNSIGNED_BYTE, data);\n        textures[0] = usedTexId;\n    }\n    return textures[0];\n}\n</code></pre> <p>GPUImageRenderer\u6e32\u67d3\u7684\u65f6\u5019\uff0c\u5c06\u4efb\u52a1\u4ece\u961f\u5217<code>runOnDraw</code>\u4e2d\u53d6\u51fa\u518d\u6267\u884c GPUImageRenderer.java<pre><code>@Override\npublic void onDrawFrame(final GL10 gl) {\n    GLES20.glClear(GLES20.GL_COLOR_BUFFER_BIT | GLES20.GL_DEPTH_BUFFER_BIT);\n    runAll(runOnDraw);\n    filter.onDraw(glTextureId, glCubeBuffer, glTextureBuffer);\n    runAll(runOnDrawEnd);\n    if (surfaceTexture != null) {\n        surfaceTexture.updateTexImage();\n    }\n}\n</code></pre></p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#gles20","title":"GLES20 \u76f8\u5173","text":"<p>\u9879\u76ee\u4e2d\u4f7f\u7528\u4e86<code>GLES20</code>\uff0c\u8fd9\u91cc\u5217\u4e3e\u4e00\u4e0b\u4f7f\u7528\u5230\u7684\u65b9\u6cd5\u3002</p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#glviewport","title":"glViewport","text":"<p><code>glViewport( GLint x, GLint y, GLsizei width, GLsizei height )</code> </p> <p>x,y \u4ee5\u50cf\u7d20\u4e3a\u5355\u4f4d\uff0c\u6307\u5b9a\u4e86\u7a97\u53e3\u7684\u5de6\u4e0b\u89d2\u4f4d\u7f6e\u3002width,height\u8868\u793a\u89c6\u53e3\u77e9\u5f62\u7684\u5bbd\u5ea6\u548c\u9ad8\u5ea6\uff0c\u6839\u636e\u7a97\u53e3\u7684\u5b9e\u65f6\u53d8\u5316\u91cd\u7ed8\u7a97\u53e3\u3002</p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#glcreateprogram","title":"glCreateProgram","text":"<p>\u521b\u5efa GLSL \u7a0b\u5e8f</p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#loadprogram","title":"loadProgram","text":"<p><code>loadProgram(final String strVSource, final String strFSource)</code></p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#gllinkprogram","title":"glLinkProgram","text":"<p>\u94fe\u63a5 GLSL \u7a0b\u5e8f</p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#gluseprogram","title":"glUseProgram","text":"<p><code>glUseProgram(int program)</code></p> <p>\u4f7f\u7528 GLSL \u7a0b\u5e8f</p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#glvertexattribpointer","title":"glVertexAttribPointer","text":"<p>\u7ed1\u5b9a vertex \u5750\u6807\u503c</p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#glenablevertexattribarray","title":"glEnableVertexAttribArray","text":"<p>\u542f\u7528 vertex</p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#glgetattriblocation","title":"glGetAttribLocation","text":"<p>\u83b7\u53d6 shader \u4ee3\u7801\u4e2d\u7684\u53d8\u91cf\u7d22\u5f15</p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#glattachshader","title":"glAttachShader","text":"<p>attatch shader \u4ee3\u7801</p>"},{"location":"android/lib/android-gpuimage/android-gpuimage-intro/#glshadersource-glcompileshader","title":"glShaderSource \u548c glCompileShader","text":"<p>\u52a0\u8f7d shader \u4ee3\u7801</p> <p>GPUImage\u5de5\u7a0b\u7ed3\u6784\u662f\u4ec0\u4e48\u6837\u7684\uff1f</p> <p>\u5b83\u662f\u600e\u4e48\u5904\u7406\u6570\u636e\u7684\uff1f</p> <p>\u6211\u4eec\u80fd\u5426\u62ff\u5230OpenGL\u6e32\u67d3\u540e\u7684\u56fe\u50cf\u6570\u636e\uff1f</p>"},{"location":"android/lib/eventbus/event-bus-note/","title":"Android EventBus\u4f7f\u7528\u6ce8\u610f\u4e8b\u9879","text":"<p>\u4f7f\u7528EventBus 3.0.0 \u65f6 \u9664\u4e86\u6ce8\u518c\u548c\u6ce8\u9500EventBus\u5916\uff0c\u540c\u65f6\u8fd8\u9700\u8981\u4f7f\u7528\u5b83\u7684\u63a5\u6536\u65b9\u6cd5 <pre><code>    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        EventBus.getDefault().register(this);\n        // ......       \n    }\n\n    @Subscribe (threadMode = ThreadMode.MAIN)\n    public void onEventXYZ(EventMsg msg) {\n         // Must use EventBus function\n    }\n\n    @Override\n    protected void onResume() {\n        super.onResume();\n    }\n\n    @Override\n    protected void onDestroy() {\n        super.onDestroy();\n        EventBus.getDefault().unregister(this);\n    }\n</code></pre></p> <p><code>onEventXYZ(EventMsg msg)</code>\u662f\u63a5\u6536\u4e8b\u4ef6\u7684\u65b9\u6cd5\u3002\u5982\u679c\u6ca1\u6709\u63a5\u6536Event\u7684\u65b9\u6cd5\uff0c\uff08\u8363\u8000\u548c\u5c0f\u7c73\uff09\u5b9e\u6d4b\u4f1a\u62a5\u9519 <pre><code>Java.lang.RuntimeException: Unable to start activity\nComponentInfo{com.rustfisher.ndkproj/com.rustfisher.ndkproj.MainActivity}:\norg.greenrobot.eventbus.EventBusException: Subscriber class com.rustfisher.ndkproj.MainActivity and\nits super classes have no public methods with the @Subscribe annotation\n</code></pre></p>"},{"location":"android/lib/pinyin/lib-tinypinyin-intro/","title":"\u6c49\u5b57\u8f6c\u62fc\u97f3\u5e93 TinyPinyin","text":"\u66f4\u65b0\u65e5\u671f 2023-5-18 <ul> <li>2023-5-18 \u589e\u52a0tinypinyin-3.0.0.jar\u5730\u5740</li> <li>2022-9-30 \u66f4\u65b0\u8bf4\u660e</li> </ul> <p>\u9879\u76ee\u5730\u5740\uff1a https://github.com/promeG/TinyPinyin</p> <p>\u8fd9\u91cc\u6211\u4eec\u4f7f\u75282.0.3\u7248\u672c\u3002\u6700\u65b0\uff082020-4-16\uff09\u662f3.0.0\u7248\u672c\u3002</p> <p>jcenter \u5f15\u5165TinyPinyin\u4e0d\u592a\u597d\u7528\uff0c\u5df2\u7ecf\u4ece\u6e90\u7801\u4e2d\u6253\u5305\u51fajar\uff0c\u653e\u5728 https://gitee.com/rustfisher/AndroidTutorial</p>"},{"location":"android/lib/pinyin/lib-tinypinyin-intro/#_1","title":"\u591a\u97f3\u5b57","text":"<p>\u8fd9\u4e2a\u5e93\u91cc\u5e76\u6ca1\u6709\u56ca\u62ec\u6240\u6709\u7684\u591a\u97f3\u5b57\u8bcd\u3002\u6211\u4eec\u53ef\u4ee5\u6dfb\u52a0\u81ea\u5b9a\u4e49\u7684\u591a\u97f3\u5b57\u6570\u636e\u3002</p>"},{"location":"android/lib/pinyin/lib-tinypinyin-intro/#pinyinmapdict","title":"\u4f7f\u7528PinyinMapDict","text":"<p>\u5173\u4e8e\u81ea\u5b9a\u4e49\u591a\u97f3\u8bcd\u5178\u7684\u4f7f\u7528 <pre><code>Pinyin.init(Pinyin.newConfig()\n      .with(new PinyinMapDict() {\n          @Override\n          public Map&lt;String, String[]&gt; mapping() {\n              HashMap&lt;String, String[]&gt; map = new HashMap&lt;String, String[]&gt;();\n              map.put(\"\u91cd\u5e86\",  new String[]{\"CHONG\", \"QING\"});\n                    return map;\n                }\n       }));\n</code></pre></p>"},{"location":"android/lib/pinyin/lib-tinypinyin-intro/#assets","title":"\u6dfb\u52a0assets\u91cc\u7684\u591a\u97f3\u5b57\u6587\u4ef6","text":"<p>\u9996\u5148\u51c6\u5907\u597d\u591a\u97f3\u5b57\u6587\u672c\u6587\u4ef6\u3002\u5185\u5bb9\u683c\u5f0f\u5982\u4e0b <pre><code>keng'sheng \u542d\u58f0\nhui'he \u4f1a\u5408\nkuai'ji \u4f1a\u8ba1\ncai'kuai \u8d22\u4f1a\n</code></pre></p> <p>\u5b9a\u4e49\u8d44\u6e90\u7c7b\uff0c\u7ee7\u627f<code>AndroidAssetDict</code> <pre><code>public class CnCityFullDict extends AndroidAssetDict {\n    public CnCityFullDict(Context context) {\n        super(context);\n    }\n\n    @Override\n    protected String assetFileName() {\n        return \"cncity_fulllist.txt\";\n    }\n}\n</code></pre> <code>assetFileName</code>\u65b9\u6cd5\u8fd4\u56deassets\u76ee\u5f55\u4e0b\u7684\u8d44\u6e90\u6587\u4ef6\u540d\u3002\u540c\u7406\u6211\u4eec\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a\u8d44\u6e90\u7c7b\u3002</p> <p>\u5728<code>init</code>\u65b9\u6cd5\u4e2d\u8fdb\u884c\u914d\u7f6e\u3002\u4f7f\u7528\u8d44\u6e90\u6587\u4ef6\u3002\u4f7f\u7528\u591a\u4e2a\u8d44\u6e90\u6587\u4ef6\u65f6\u6ce8\u610f <pre><code>Pinyin.init(Pinyin.newConfig()\n        .with(new CnCityFullDict(getApplicationContext()))\n        .with(new PinyinDuoYin(getApplicationContext())));\n</code></pre></p> <p>\u6ce8\u610f\uff0c\u8981\u4f7f\u81ea\u5b9a\u4e49\u7684\u8bcd\u5e93\u751f\u6548\uff0c\u9700\u8981\u4f7f\u7528<code>toPinyin</code>\u65b9\u6cd5\uff0c\u5426\u5219\u4e0d\u4f1a\u8d77\u6548 <pre><code>public String toPinyin(String str, String separator)\n</code></pre></p>"},{"location":"android/lib/rx/rx-android-intro/","title":"RxAndroid \u4f7f\u7528\u65b9\u6cd5\u521d\u63a2","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-2-3 <ul> <li>2022-2-3 \u66f4\u65b0</li> </ul>"},{"location":"android/lib/rx/rx-android-intro/#rxjavarxandroid","title":"\u5173\u4e8eRxJava\u548cRxAndroid","text":"<p>RxAndroid\u4f7f\u7528\u4e86\u89c2\u5bdf\u8005\u6a21\u5f0f\uff0c\u5c5e\u54cd\u5e94\u578b\u673a\u5236\u3002</p> <p>\u53c2\u8003 https://github.com/ReactiveX/RxAndroid/</p> <p>\u5e94\u7528\u573a\u666f\uff1a\u5f02\u6b65\u3002\u5b83\u662f\u4e00\u4e2a\u5b9e\u73b0\u5f02\u6b65\u64cd\u4f5c\u7684\u5e93\u3002</p> <p>\u4f18\u52bf\uff1a\u4fdd\u6301\u4ee3\u7801\u53ef\u8bfb\u6027</p>"},{"location":"android/lib/rx/rx-android-intro/#_1","title":"\u4f7f\u7528\u5b9e\u4f8b","text":"<p>IDE\uff1a Android Studio</p>"},{"location":"android/lib/rx/rx-android-intro/#_2","title":"\u6dfb\u52a0\u4f9d\u8d56\u5e93","text":"<p>gradle\u4e2d\u6dfb\u52a0\u4f9d\u8d56 <pre><code>dependencies {\n    // ......\n    compile 'io.reactivex:rxandroid:1.2.1'\n    // Because RxAndroid releases are few and far between, it is recommended you also\n    // explicitly depend on RxJava's latest version for bug fixes and new features.\n    compile 'io.reactivex:rxjava:1.1.6'\n}\n</code></pre></p>"},{"location":"android/lib/rx/rx-android-intro/#1","title":"\u5b9e\u4f8b1 \u76f4\u63a5\u5173\u8054\u88ab\u89c2\u5bdf\u8005\u4e0e\u8ba2\u9605\u8005","text":"<p>\u5148\u5b9a\u4e49\u51fa\u88ab\u89c2\u5bdf\u8005\uff08\u4e8b\u4ef6\u6e90\uff09\u548c\u8ba2\u9605\u8005\u3002\u7136\u540e\u628a\u5b83\u4eec\u5173\u8054\u8d77\u6765\u3002 \u5f53\u8ba2\u9605\u8005\u6267\u884c\u4e86<code>onCompleted()</code>\u540e\uff0c\u5c31\u4e0d\u518d\u63a5\u6536\u6d88\u606f\u4e86\u3002 <pre><code>/**\n * \u88ab\u89c2\u5bdf\u8005\n */\nObservable.OnSubscribe mObservableAction = new Observable.OnSubscribe&lt;String&gt;() {\n    @Override\n    public void call(Subscriber&lt;? super String&gt; subscriber) {\n        subscriber.onNext(\"mObservableAction: \" + mCount);\n        /**\n         * Notifies the Observer that the {@link Observable}\n         * has finished sending push-based notifications\n         */\n        subscriber.onCompleted();// \u6267\u884c\u4e86\u6b64\u65b9\u6cd5\u540e\uff0c\u5c06\u4e0d\u518d\u63a5\u6536\u5904\u7406\u6d88\u606f\n    }\n};\n\n/**\n * \u63a5\u6536\u6d88\u606f\u7684\u8ba2\u9605\u8005\n */\nSubscriber&lt;String&gt; mSubscriber1 = new Subscriber&lt;String&gt;() {\n    @Override\n    public void onCompleted() {\n        Log.d(TAG, \"onCompleted: got sth\");\n    }\n\n    @Override\n    public void onError(Throwable e) {\n        Log.d(TAG, \"onError\");\n    }\n\n    @Override\n    public void onNext(String str) {\n        Log.d(TAG, \"onNext:\" + str);\n        mTv1.setText(str);\n    }\n};\n\n/**\n * \u4f5c\u4e3a\u89c2\u5bdf\u8005 - \u63a5\u6536\u5230\u4e8b\u4ef6\u540e\u6267\u884c\u64cd\u4f5c\n * \u4e0d\u77e5\u4e3a\u4f55\u8981\u8d77 Action1 \u8fd9\u4e2a\u540d\u5b57\n */\nprivate Action1&lt;String&gt; mActionTv2 = new Action1&lt;String&gt;() {\n    @Override\n    public void call(String s) {\n        mTv2.setText(s);\n    }\n};\n\nfindViewById(R.id.act_rx_btn1).setOnClickListener(new View.OnClickListener() {\n    @Override\n    public void onClick(View v) {\n        mCount++;\n        Log.d(TAG, \"onClick: \" + mCount);\n        /**\n         * \u5b9e\u4f8b1 \u5c06\u4e8b\u4ef6\u6e90\u4e0e\u8ba2\u9605\u8005\u5173\u8054\u8d77\u6765\n         */\n        @SuppressWarnings(\"unchecked\")\n        Observable&lt;String&gt; observable = Observable.create(mObservableAction)\n                .subscribeOn(AndroidSchedulers.mainThread());\n        observable.subscribe(mSubscriber1);// \u5148\u901a\u77e5\u4e00\u4e2a\uff0c\u518d\u901a\u77e5\u53e6\u4e00\u4e2a\n        observable.subscribe(mActionTv2);  // \u8fd9\u4e2a\u53ef\u4ee5\u4e00\u76f4\u6267\u884c\u4e0b\u53bb\n    }\n});\n</code></pre></p>"},{"location":"android/lib/rx/rx-android-intro/#2","title":"\u5b9e\u4f8b2 \u76f4\u63a5\u5206\u53d1\u7279\u5b9a\u4e8b\u4ef6\u7ed9\u8ba2\u9605\u8005","text":"<pre><code>private Action1&lt;String&gt; mActionTv3 = new Action1&lt;String&gt;() {\n    @Override\n    public void call(String s) {\n        mTv3.setText(s);\n    }\n};\n\nprivate Action1&lt;String&gt; mActionShowToast = new Action1&lt;String&gt;() {\n    @Override\n    public void call(String s) {\n        Toast.makeText(RxAndroidActivity.this, s, Toast.LENGTH_SHORT).show();\n    }\n};\n\nfindViewById(R.id.act_rx_btn2).setOnClickListener(new View.OnClickListener() {\n    @Override\n    public void onClick(View v) {\n        // \u4e8b\u4ef6\u4ea7\u751f\uff0c\u5206\u53d1\u7ed9\u8ba2\u9605\u8005\n        Observable&lt;String&gt; oba1 = Observable.just(\"\u4e8b\u4ef6\u5206\u53d1\u6e90 \" + mCount);\n        oba1.observeOn(AndroidSchedulers.mainThread());\n        oba1.subscribe(mActionTv3);\n        oba1.subscribe(mActionShowToast);\n    }\n});\n</code></pre>"},{"location":"android/lib/rx/rx-android-intro/#_3","title":"\u5faa\u73af\u4ea7\u751f\u7684\u6d88\u606f","text":"<p>\u5728\u5b50\u7ebf\u7a0b\u4e2d\u4ea7\u751f\u6d88\u606f\uff0c\u901a\u77e5UI\u7ebf\u7a0b\u3002</p> <p>\u5728\u4e0d\u6307\u5b9a\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\uff0c RxJava \u9075\u5faa\u7684\u662f\u7ebf\u7a0b\u4e0d\u53d8\u7684\u539f\u5219\uff0c\u5373\uff1a\u5728\u54ea\u4e2a\u7ebf\u7a0b\u8c03\u7528 subscribe()\uff0c \u5c31\u5728\u54ea\u4e2a\u7ebf\u7a0b\u751f\u4ea7\u4e8b\u4ef6\uff1b\u5728\u54ea\u4e2a\u7ebf\u7a0b\u751f\u4ea7\u4e8b\u4ef6\uff0c\u5c31\u5728\u54ea\u4e2a\u7ebf\u7a0b\u6d88\u8d39\u4e8b\u4ef6\u3002 \u5982\u679c\u9700\u8981\u5207\u6362\u7ebf\u7a0b\uff0c\u5c31\u9700\u8981\u7528\u5230 Scheduler \uff08\u8c03\u5ea6\u5668\uff09\u3002</p> <p>\u548c\u4e0a\u4e00\u4e2a\u4f8b\u5b50\u4e00\u6837\uff0c\u5b9a\u65f6\u4ea7\u751f\u4e00\u4e2a\u6d88\u606f\uff0c\u53d1\u9001\u7ed9\u8ba2\u9605\u8005</p> <pre><code>private Action1&lt;String&gt; mActionTimer = new Action1&lt;String&gt;() {\n    @Override\n    public void call(String s) {\n        final String second = s;\n        /**\n         * \u8dd1\u5728UI\u7ebf\u7a0b\u91cc\u66f4\u65b0\n         */\n        runOnUiThread(new Runnable() {\n            @Override\n            public void run() {\n                mTimerTv.setText(second);\n            }\n        });\n    }\n};\n\nnew Thread(new Runnable() {\n    @Override\n    public void run() {\n        int s = 0;\n        while (s &lt;= 100) {\n            Observable&lt;String&gt; timerOb = Observable.just(String.valueOf(s) + \"s\");\n\n            // \u6307\u5b9a\u5728\u4e3b\u7ebf\u7a0b\u53d1\u751f\u56de\u8c03\n            timerOb.observeOn(AndroidSchedulers.mainThread());\n\n            timerOb.subscribe(mActionTimer);\n            try {\n                Thread.sleep(1000L);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n                break;\n            }\n            s++;\n        }\n    }\n}).start();\n</code></pre>"},{"location":"android/lib/rx/rx-android-intro/#_4","title":"\u5b9e\u4f8b\u6548\u679c","text":"\u6548\u679c\u56fe <p>\u753b\u9762\u4e2d\u7684\u79d2\u6570\u8ba1\u6570\u5668\u4e00\u76f4\u5728\u66f4\u65b0</p>"},{"location":"android/lib/rx/rx-android-intro/#_5","title":"\u7ebf\u7a0b\u63a7\u5236","text":""},{"location":"android/lib/rx/rx-android-intro/#schedulerapi","title":"\u4f7f\u7528Scheduler\u7684API","text":"<p>\u8c03\u7528<code>Observable.subscribeOn(Schedulers s)</code>\u6765\u8bbe\u5b9a\u88ab\u89c2\u5bdf\u7684\u4efb\u52a1\u6267\u884c\u7684\u7ebf\u7a0b <code>Observable.observeOn()</code>\u6765\u8bbe\u5b9a\u56de\u8c03\u4f7f\u7528\u7684\u7ebf\u7a0b</p> <p>\u4ee5\u4e0b\u662f<code>Schedulers</code>\u7684\u90e8\u5206\u6e90\u7801 <pre><code>public final class Schedulers {\n    private final Scheduler computationScheduler; // \u8ba1\u7b97\u7ebf\u7a0b \u4e0eCPU\u6709\u5173\n    private final Scheduler ioScheduler; //  \u4e3b\u8981\u7528\u4e8eI/O\u8bfb\u5199\n    private final Scheduler newThreadScheduler;\n    // .......\n}\n</code></pre></p> <p>\u53ef\u4ee5\u4ece\u6ce8\u91ca\u4e2d\u4e86\u89e3\u5230\u7ebf\u7a0b\u5207\u6362\u7684\u6548\u679c * <code>Schedulers.immediate()</code> \u4e0d\u5207\u6362\u7ebf\u7a0b  * <code>Schedulers.newThread()</code> \u5bf9\u6bcf\u4e00\u6b21\u4efb\u52a1\u542f\u52a8\u4e00\u4e2a\u65b0\u7684\u7ebf\u7a0b * <code>Schedulers.computation()</code> \u9002\u7528\u4e8e\u8ba1\u7b97\u5de5\u4f5c\uff0c\u6bd4\u5982\u5904\u7406\u5faa\u73af\u4e8b\u4ef6\uff0c\u56de\u8c03\u6216\u8005\u5176\u4ed6\u8ba1\u7b97\u5de5\u4f5c\u3002\u4e0d\u8981\u5728\u8fd9\u91cc\u8fdb\u884cIO\u76f8\u5173\u7684\u64cd\u4f5c\u3002 * <code>Schedulers.io()</code> \u5185\u90e8\u5b9e\u73b0\u4e2d\u6709\u4e00\u4e2a\u81ea\u589e\u957f\u7684\u7ebf\u7a0b\u6c60\uff0c\u53ef\u7528\u4e8e\u5f02\u6b65\u7684\u963b\u585eIO\u8bfb\u5199\u5de5\u4f5c\u3002\u4e0d\u8981\u628a\u8ba1\u7b97\u5de5\u4f5c\u653e\u5728\u8fd9\u91cc\u3002</p> <p>\u8fd8\u6709\u4e00\u4e2aAndroid\u4e13\u7528\u7684UI\u7ebf\u7a0b\uff0c\u5f15\u5165<code>rx.android.schedulers.AndroidSchedulers;</code> * <code>AndroidSchedulers.mainThread()</code> \u4f7f\u7528UI\u7ebf\u7a0b</p> <p>\u4ee3\u7801\u793a\u4f8b\uff1a\u5728IO\u7ebf\u7a0b\u8bfb\u53d6\u56fe\u7247\uff0c\u7136\u540e\u663e\u793a\u5728\u754c\u9762\u4e0a <pre><code>Observable.create(new Observable.OnSubscribe&lt;Drawable&gt;() {\n            @Override\n            public void call(Subscriber&lt;? super Drawable&gt; subscriber) {\n                Drawable drawable = ContextCompat.getDrawable(getApplicationContext(), R.mipmap.ic_launcher);\n                int count = 0;\n                while (count &lt; 100) {\n                    count++;// \u4eba\u4e3a\u5236\u9020\u4e00\u4e9b\u5ef6\u65f6\n                    try {\n                        Thread.sleep(25);\n                    } catch (InterruptedException e) {\n                        e.printStackTrace();\n                    }\n                }\n                subscriber.onNext(drawable);\n                subscriber.onCompleted();\n            }\n        })\n                .subscribeOn(Schedulers.io()) // \u5728io\u7ebf\u7a0b\u53d6\u6570\u636e\n                .observeOn(AndroidSchedulers.mainThread())//\u5728\u4e3b\u7ebf\u7a0b\u6267\u884c\u56de\u8c03\n                .subscribe(new Observer&lt;Drawable&gt;() {\n                    @Override\n                    public void onNext(Drawable drawable) {\n                        mIv1.setImageDrawable(drawable);\n                    }\n\n                    @Override\n                    public void onCompleted() {\n                    }\n\n                    @Override\n                    public void onError(Throwable e) {\n                        Toast.makeText(getApplicationContext(), \"Error!\", Toast.LENGTH_SHORT).show();\n                    }\n                });\n</code></pre></p>"},{"location":"android/lib/rx/rx-android-intro/#_6","title":"\u53d8\u6362","text":"<p>\u5c06\u65f6\u95f4\u5e8f\u5217\u4e2d\u7684\u5bf9\u8c61\u6216\u6574\u4e2a\u5e8f\u5217\u8fdb\u884c\u52a0\u5de5\u5904\u7406\uff0c\u8f6c\u6362\u6210\u4e0d\u540c\u7684\u4e8b\u4ef6\u6216\u4e8b\u4ef6\u5e8f\u5217\u3002\u4e32\u6210\u4e32\u4e32\u3002</p>"},{"location":"android/lib/rx/rx-android-intro/#map","title":"\u4f7f\u7528<code>map()</code>\u6765\u8fdb\u884c\u53d8\u6362","text":"<p>\u8f93\u5165\u56fe\u7247\u7684\u8d44\u6e90int\u503c\uff0c\u901a\u8fc7map\u83b7\u5f97Drawable\u5bf9\u8c61\uff0c\u7136\u540e\u53d1\u9001\u7ed9\u76d1\u542c\u8005 \u8fd9\u662f\u6700\u7b80\u5355\u6700\u5e38\u7528\u7684\u53d8\u6362\u65b9\u5f0f\uff0c\u4e00\u5bf9\u4e00\u7684\u53d8\u6362</p> <pre><code>Observable.just(R.mipmap.ic_launcher)\n        .map(new Func1&lt;Integer, Drawable&gt;() {\n            @Override\n            public Drawable call(Integer integer) {\n                return ContextCompat.getDrawable(getApplicationContext(), integer);\n            }\n        })\n        .subscribeOn(Schedulers.io())// \u7ebf\u7a0b\u8c03\u5ea6\n        .observeOn(AndroidSchedulers.mainThread())\n        .subscribe(new Action1&lt;Drawable&gt;() {\n            @Override\n            public void call(Drawable drawable) {\n                mIv2.setImageDrawable(drawable);// \u663e\u793a\u56fe\u7247\n            }\n        });\n</code></pre> <p>\u5176\u4e2d<code>Func1</code>\u662f\u4e00\u4e2a\u63a5\u53e3\uff1b<code>T</code>\u662f\u8f93\u5165\u5bf9\u8c61\uff0c<code>R</code>\u662f\u8fd4\u56de\u5bf9\u8c61 <pre><code>public interface Func1&lt;T, R&gt; extends Function {\n    R call(T t);\n}\n</code></pre></p>"},{"location":"android/lib/rx/rx-android-intro/#flatmap","title":"\u4f7f\u7528<code>flatMap</code>","text":"<p>\u4e00\u4e2a\u5bf9\u8c61\u4e2d\u6301\u6709\u67d0\u4e2a\u96c6\u5408\uff0c\u60f3\u8981\u628a\u8fd9\u4e2a\u96c6\u5408\u8f93\u51fa\u3002 \u4f8b\u5982User\u6301\u6709\u4e00\u4e2aString list\uff0c\u73b0\u5728\u60f3\u4e00\u4e2a\u4e2a\u5730\u83b7\u53d6list\u4e2d\u7684\u5185\u5bb9</p> <pre><code>    User tom = new User(\"Tom\");\n    User jerry = new User(\"jerry\");\n    tom.profileList.add(\"p1\");\n    tom.profileList.add(\"p2\");\n    jerry.profileList.add(\"p4\");\n    jerry.profileList.add(\"p5\");\n\n    Observable.just(tom, jerry)\n            .flatMap(new Func1&lt;User, Observable&lt;String&gt;&gt;() {\n                @Override\n                public Observable&lt;String&gt; call(User user) {\n                    Log.d(TAG, \"user: \" + user.name);\n                    return Observable.from(user.profileList); // \u53ef\u4ee5\u63a5\u53d7Iterable\n                }\n            })\n            .subscribe(new Action1&lt;String&gt;() {\n                @Override\n                public void call(String s) {\n                    Log.d(TAG, \"profile:  \" + s);\n                }\n            });\n\n     /**\n     * \u793a\u4f8b\u7528\u6237\u7c7b\n     */\n    class User {\n        public User(String name) {\n            this.name = name;\n        }\n\n        public String name;\n        public List&lt;String&gt; profileList = new ArrayList&lt;&gt;();\n    }\n/*\n\u8f93\u51fa\nuser: Tom\nprofile:  p1\nprofile:  p2\nuser: jerry\nprofile:  p4\nprofile:  p5\n*/\n</code></pre> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u7b80\u4e66</p>"},{"location":"android/media/AudioRecord_AudioTrack_pcm_wav/","title":"Android\u97f3\u9891PCM\u6570\u636e\u7684\u91c7\u96c6\u548c\u64ad\u653e\uff0c\u8bfb\u5199\u97f3\u9891wav\u6587\u4ef6","text":"\u66f4\u65b0\u65e5\u671f 2022-10-12 <ul> <li>2022-10-12 \u589e\u52a0\u5f15\u7528\u8bf4\u660e</li> <li>2022-9-1 \u62bd\u53d6WebRTC\u7684AGC\u548cANS\u6a21\u5757</li> <li>2022-8-24 \u5f55\u5236\u5f00\u59cb\u65f6\u673a</li> <li>2022-8-19 \u566a\u58f0\u6291\u5236\u7684\u8bbe\u7f6e</li> <li>2022-8-3 \u81ea\u52a8\u589e\u76ca\uff0c\u4fee\u6b63wav\u5934\u90e8\u9519\u8bef</li> <li>2022-8-3 \u4ecebyte\u4e2d\u83b7\u53d6\u97f3\u91cf</li> <li>2022-7-27 \u4fee\u6539\u4ee3\u7801\uff0c\u66f4\u65b0\u8bf4\u660e</li> </ul> <p>\u672c\u6587\u76ee\u7684</p> <p>\u4f7f\u7528 AudioRecord \u548c AudioTrack \u5b8c\u6210\u97f3\u9891PCM\u6570\u636e\u7684\u91c7\u96c6\u548c\u64ad\u653e\uff0c\u5e76\u8bfb\u5199\u97f3\u9891wav\u6587\u4ef6</p> <p>\u914d\u7f6e\u5f00\u542f\u81ea\u52a8\u589e\u76ca\uff0c\u566a\u58f0\u6291\u5236</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/AudioRecord_AudioTrack_pcm_wav/#_1","title":"\u51c6\u5907\u5de5\u4f5c","text":"<p>Android\u63d0\u4f9b\u4e86AudioRecord\u548cMediaRecord\u3002MediaRecord\u53ef\u9009\u62e9\u5f55\u97f3\u7684\u683c\u5f0f\u3002 AudioRecord\u5f97\u5230PCM\u7f16\u7801\u683c\u5f0f\u7684\u6570\u636e\u3002AudioRecord\u80fd\u591f\u8bbe\u7f6e\u6a21\u62df\u4fe1\u53f7\u8f6c\u5316\u4e3a\u6570\u5b57\u4fe1\u53f7\u7684\u76f8\u5173\u53c2\u6570\uff0c\u5305\u62ec\u91c7\u6837\u7387\u548c\u91cf\u5316\u6df1\u5ea6\uff0c\u540c\u65f6\u4e5f\u5305\u62ec\u901a\u9053\u6570\u76ee\u7b49\u3002</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/AudioRecord_AudioTrack_pcm_wav/#pcm","title":"PCM","text":"<p>PCM\u662f\u5728\u7531\u6a21\u62df\u4fe1\u53f7\u5411\u6570\u5b57\u4fe1\u53f7\u8f6c\u5316\u7684\u4e00\u79cd\u5e38\u7528\u7684\u7f16\u7801\u683c\u5f0f\uff0c\u79f0\u4e3a\u8109\u51b2\u7f16\u7801\u8c03\u5236\uff0cPCM\u5c06\u6a21\u62df\u4fe1\u53f7\u6309\u7167\u4e00\u5b9a\u7684\u95f4\u8ddd\u5212\u5206\u4e3a\u591a\u6bb5\uff0c\u7136\u540e\u901a\u8fc7\u4e8c\u8fdb\u5236\u53bb\u91cf\u5316\u6bcf\u4e00\u4e2a\u95f4\u8ddd\u7684\u5f3a\u5ea6\u3002 PCM\u8868\u793a\u7684\u662f\u97f3\u9891\u6587\u4ef6\u4e2d\u968f\u7740\u65f6\u95f4\u7684\u6d41\u901d\u7684\u4e00\u6bb5\u97f3\u9891\u7684\u632f\u5e45\u3002Android\u5728WAV\u6587\u4ef6\u4e2d\u652f\u6301PCM\u7684\u97f3\u9891\u6570\u636e\u3002</p> <p>\u901a\u5e38\u6240\u8bf4\u97f3\u9891\u7684\u88f8\u6570\u636e\u683c\u5f0f\u5c31\u662f\u8109\u51b2\u7f16\u7801\u8c03\u5236\uff08Pulse Code Modulation\uff0cPCM\uff09\u6570\u636e\u3002\u63cf\u8ff0\u4e00\u6bb5PCM\u6570\u636e\u4e00\u822c\u9700\u8981\u4ee5\u4e0b\u51e0\u4e2a\u6982\u5ff5\uff1a\u91cf\u5316\u683c\u5f0f\uff08sampleFormat\uff09\u3001\u91c7\u6837\u7387 \uff08sampleRate\uff09\u3001\u58f0\u9053\u6570\uff08channel\uff09\u3002 \u4ee5CD\u7684\u97f3\u8d28\u4e3a\u4f8b\uff1a\u91cf\u5316\u683c\u5f0f\uff08\u6709\u7684\u5730\u65b9\u63cf\u8ff0\u4e3a\u4f4d\u6df1\u5ea6\uff09\u4e3a16\u6bd4\u7279\uff082\u5b57\u8282\uff09\uff0c\u91c7\u6837\u7387\u4e3a44100\uff0c\u58f0\u9053\u6570\u4e3a2\uff0c\u8fd9\u4e9b\u4fe1\u606f\u5c31\u63cf\u8ff0\u4e86CD\u7684\u97f3\u8d28\u3002</p> <p>\u2014\u2014 \u300a\u97f3\u89c6\u9891\u5f00\u53d1\u8fdb\u9636\u6307\u5357\u300b</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/AudioRecord_AudioTrack_pcm_wav/#wav","title":"WAV","text":"<p>WAV\uff0cMP3\u7b49\u6bd4\u8f83\u5e38\u89c1\u7684\u97f3\u9891\u683c\u5f0f\uff0c\u4e0d\u540c\u7684\u7f16\u7801\u683c\u5f0f\u5bf9\u5e94\u4e0d\u901a\u8fc7\u7684\u539f\u59cb\u97f3\u9891\u3002\u4e3a\u4e86\u65b9\u4fbf\u4f20\u8f93\uff0c\u901a\u5e38\u4f1a\u538b\u7f29\u539f\u59cb\u97f3\u9891\u3002 \u4e3a\u4e86\u8fa8\u522b\u51fa\u97f3\u9891\u683c\u5f0f\uff0c\u6bcf\u79cd\u683c\u5f0f\u6709\u7279\u5b9a\u7684\u5934\u6587\u4ef6\uff08header\uff09\u3002  WAV\u4ee5RIFF\u4e3a\u6807\u51c6\u3002RIFF\u662f\u4e00\u79cd\u8d44\u6e90\u4ea4\u6362\u6863\u6848\u6807\u51c6\u3002RIFF\u5c06\u6587\u4ef6\u5b58\u50a8\u5728\u6bcf\u4e00\u4e2a\u6807\u8bb0\u5757\u4e2d\u3002 \u57fa\u672c\u6784\u6210\u5355\u4f4d\u662ftrunk\uff0c\u6bcf\u4e2atrunk\u7531\u6807\u8bb0\u4f4d\uff0c\u6570\u636e\u5927\u5c0f\uff0c\u6570\u636e\u5b58\u50a8\uff0c\u4e09\u4e2a\u90e8\u5206\u6784\u6210\u3002 </p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/AudioRecord_AudioTrack_pcm_wav/#pcmwav","title":"PCM\u6253\u5305\u6210WAV","text":"<p>PCM\u662f\u539f\u59cb\u97f3\u9891\u6570\u636e\uff0cWAV\u662fwindows\u4e2d\u5e38\u89c1\u7684\u97f3\u9891\u683c\u5f0f\uff0c\u53ea\u662f\u5728pcm\u6570\u636e\u4e2d\u6dfb\u52a0\u4e86\u4e00\u4e2a\u6587\u4ef6\u5934\u3002</p> \u8d77\u59cb\u5730\u5740 \u5360\u7528\u7a7a\u95f4 \u672c\u5730\u5740\u6570\u5b57\u7684\u542b\u4e49 00H 4byte RIFF\uff0c\u8d44\u6e90\u4ea4\u6362\u6587\u4ef6\u6807\u5fd7\u3002 04H 4byte \u4ece\u4e0b\u4e00\u4e2a\u5730\u5740\u5f00\u59cb\u5230\u6587\u4ef6\u5c3e\u7684\u603b\u5b57\u8282\u6570\u3002\u9ad8\u4f4d\u5b57\u8282\u5728\u540e\u9762\uff0c\u8fd9\u91cc\u5c31\u662f001437ECH\uff0c\u6362\u6210\u5341\u8fdb\u5236\u662f1325036byte\uff0c\u7b97\u4e0a\u8fd9\u4e4b\u524d\u76848byte\u5c31\u6b63\u597d1325044byte\u4e86\u3002 08H 4byte WAVE\uff0c\u4ee3\u8868wav\u6587\u4ef6\u683c\u5f0f\u3002 0CH 4byte FMT \uff0c\u6ce2\u5f62\u683c\u5f0f\u6807\u5fd7 10H 4byte 00000010H\uff0c16PCM\uff0c\u6211\u7684\u7406\u89e3\u662f\u752816bit\u7684\u6570\u636e\u8868\u793a\u4e00\u4e2a\u91cf\u5316\u7ed3\u679c\u3002 14H 2byte \u4e3a1\u65f6\u8868\u793a\u7ebf\u6027PCM\u7f16\u7801\uff0c\u5927\u4e8e1\u65f6\u8868\u793a\u6709\u538b\u7f29\u7684\u7f16\u7801\u3002\u8fd9\u91cc\u662f0001H\u3002 16H 2byte 1\u4e3a\u5355\u58f0\u9053\uff0c2\u4e3a\u53cc\u58f0\u9053\uff0c\u8fd9\u91cc\u662f0001H\u3002 18H 4byte \u91c7\u6837\u9891\u7387\uff0c\u8fd9\u91cc\u662f00002B11H\uff0c\u4e5f\u5c31\u662f11025Hz\u3002 1CH 4byte Byte\u7387=<code>\u91c7\u6837\u9891\u7387*\u97f3\u9891\u901a\u9053\u6570*\u6bcf\u6b21\u91c7\u6837\u5f97\u5230\u7684\u6837\u672c\u4f4d\u6570/8</code>\uff0c00005622H\uff0c\u4e5f\u5c31\u662f<code>22050Byte/s=11025 * 1 * 16/2</code> 20H 2byte \u5757\u5bf9\u9f50=\u901a\u9053\u6570*\u6bcf\u6b21\u91c7\u6837\u5f97\u5230\u7684\u6837\u672c\u4f4d\u6570/8\uff0c0002H\uff0c\u4e5f\u5c31\u662f <code>2 == 1 * 16/8</code> 22H 2byte \u6837\u672c\u6570\u636e\u4f4d\u6570\uff0c0010H\u537316\uff0c\u4e00\u4e2a\u91cf\u5316\u6837\u672c\u53602byte\u3002 24H 4byte data\uff0c\u4e00\u4e2a\u6807\u5fd7\u800c\u5df2\u3002 28H 4byte Wav\u6587\u4ef6\u5b9e\u9645\u97f3\u9891\u6570\u636e\u6240\u5360\u7684\u5927\u5c0f\uff0c\u8fd9\u91cc\u662f001437C8H\u53731325000\uff0c\u518d\u52a0\u4e0a2CH\u5c31\u6b63\u597d\u662f1325044\uff0c\u6574\u4e2a\u6587\u4ef6\u7684\u5927\u5c0f\u3002 2CH \u4e0d\u5b9a \u91cf\u5316\u6570\u636e","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/AudioRecord_AudioTrack_pcm_wav/#audiorecord","title":"AudioRecord","text":"<p>AudioRecord\u53ef\u5b9e\u73b0\u4ece\u97f3\u9891\u8f93\u5165\u8bbe\u5907\u8bb0\u5f55\u58f0\u97f3\u7684\u529f\u80fd\u3002\u5f97\u5230PCM\u683c\u5f0f\u7684\u97f3\u9891\u3002 \u8bfb\u53d6\u97f3\u9891\u7684\u65b9\u6cd5\u6709<code>read(byte[], int, int)</code>\uff0c <code>read(short[], int, int)</code> \u6216 <code>read(ByteBuffer, int)</code>\u3002 \u53ef\u6839\u636e\u5b58\u50a8\u65b9\u5f0f\u548c\u9700\u6c42\u9009\u62e9\u4f7f\u7528\u8fd9\u9879\u65b9\u6cd5\u3002</p> <p>\u9700\u8981\u6743\u9650<code>&lt;uses-permission android:name=\"android.permission.RECORD_AUDIO\" /&gt;</code></p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/AudioRecord_AudioTrack_pcm_wav/#audiorecord_1","title":"AudioRecord \u6784\u9020\u51fd\u6570","text":"<p><code>public AudioRecord(int audioSource, int sampleRateInHz, int channelConfig, int audioFormat, int bufferSizeInBytes)</code></p> <ul> <li>audioSource \u97f3\u6e90\u8bbe\u5907\uff0c\u5e38\u7528\u9ea6\u514b\u98ce<code>MediaRecorder.AudioSource.MIC</code></li> <li>samplerateInHz \u91c7\u6837\u9891\u7387\uff0c44100Hz\u662f\u76ee\u524d\u6240\u6709\u8bbe\u5907\u90fd\u652f\u6301\u7684\u9891\u7387</li> <li>channelConfig \u97f3\u9891\u901a\u9053\uff0c\u5355\u58f0\u9053\u8fd8\u662f\u7acb\u4f53\u58f0</li> <li>audioFormat \u8be5\u53c2\u6570\u4e3a\u91cf\u5316\u6df1\u5ea6\uff0c\u5373\u4e3a\u6bcf\u6b21\u91c7\u6837\u7684\u4f4d\u6570</li> <li>bufferSizeInBytes \u53ef\u901a\u8fc7<code>getMinBufferSize()</code>\u65b9\u6cd5\u786e\u5b9a\uff0c\u6bcf\u6b21\u4ece\u786c\u4ef6\u8bfb\u53d6\u6570\u636e\u6240\u9700\u8981\u7684\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u3002</li> </ul>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/AudioRecord_AudioTrack_pcm_wav/#wav_1","title":"\u83b7\u53d6wav\u6587\u4ef6","text":"<p>\u82e5\u8981\u83b7\u5f97wav\u6587\u4ef6\uff0c\u9700\u8981\u5728PCM\u57fa\u7840\u4e0a\u589e\u52a0\u4e00\u4e2aheader\u3002\u53ef\u4ee5\u5c06PCM\u6587\u4ef6\u8f6c\u6362\u6210wav\uff0c\u8fd9\u91cc\u63d0\u4f9b\u4e00\u79cdPCM\u4e0ewav\u51e0\u4e4e\u540c\u65f6\u751f\u6210\u7684\u601d\u8def\u3002</p> <p>PCM\u4e0ewav\u540c\u65f6\u521b\u5efa\uff0c\u7ed9wav\u6587\u4ef6\u4e00\u4e2a\u9ed8\u8ba4\u7684header\u3002\u5f55\u5236\u7ebf\u7a0b\u542f\u52a8\u540e\uff0c\u540c\u65f6\u5199PCM\u4e0ewav\u3002 \u5f55\u5236\u5b8c\u6210\u65f6\uff0c\u91cd\u65b0\u751f\u6210header\uff0c\u5229\u7528<code>RandomAccessFile</code>\u4fee\u6539wav\u6587\u4ef6\u7684header\u3002</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/AudioRecord_AudioTrack_pcm_wav/#audiotrack","title":"AudioTrack","text":"<p>\u4f7f\u7528<code>AudioTrack</code>\u64ad\u653e\u97f3\u9891\u3002\u521d\u59cb\u5316AudioTrack\u65f6\uff0c\u8981\u6839\u636e\u5f55\u5236\u65f6\u7684\u53c2\u6570\u8fdb\u884c\u8bbe\u5b9a\u3002</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/AudioRecord_AudioTrack_pcm_wav/#_2","title":"\u4ee3\u7801\u793a\u4f8b","text":"<p>\u5de5\u5177\u7c7b<code>WindEar</code>\u5b9e\u73b0\u97f3\u9891PCM\u6570\u636e\u7684\u91c7\u96c6\u548c\u64ad\u653e\uff0c\u4e0e\u8bfb\u5199\u97f3\u9891wav\u6587\u4ef6\u7684\u529f\u80fd\u3002</p> <ul> <li><code>AudioRecordThread</code> \u4f7f\u7528<code>AudioRecord</code>\u5f55\u5236PCM\u6587\u4ef6\uff0c\u53ef\u9009\u62e9\u540c\u65f6\u751f\u6210wav\u6587\u4ef6</li> <li><code>AudioTrackPlayThread</code> \u4f7f\u7528AudioTrack\u64ad\u653ePCM\u6216wav\u97f3\u9891\u6587\u4ef6\u7684\u7ebf\u7a0b</li> <li><code>WindState</code> \u8868\u793a\u5f53\u524d\u72b6\u6001\uff0c\u4f8b\u5982\u662f\u5426\u5728\u64ad\u653e\uff0c\u5f55\u5236\u7b49\u7b49</li> </ul> <p>PCM\u6587\u4ef6\u7684\u8bfb\u5199\u91c7\u7528<code>FileOutputStream</code>\u548c<code>FileInputStream</code></p> <p><code>generateWavFileHeader</code>\u65b9\u6cd5\u53ef\u4ee5\u751f\u6210wav\u6587\u4ef6\u7684header</p> WindEar \u4ee3\u7801<pre><code>import android.content.Context;\nimport android.media.AudioFormat;\nimport android.media.AudioManager;\nimport android.media.AudioRecord;\nimport android.media.AudioTrack;\nimport android.media.MediaRecorder;\nimport android.os.Environment;\nimport android.os.Handler;\nimport android.os.Looper;\nimport android.util.Log;\n\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.io.RandomAccessFile;\nimport java.text.SimpleDateFormat;\nimport java.util.Date;\nimport java.util.Locale;\n\n/**\n * \u97f3\u9891\u5f55\u5236\u5668\n * \u4f7f\u7528 AudioRecord \u548c AudioTrack API \u5b8c\u6210\u97f3\u9891 PCM \u6570\u636e\u7684\u91c7\u96c6\u548c\u64ad\u653e\uff0c\u5e76\u5b9e\u73b0\u8bfb\u5199\u97f3\u9891 wav \u6587\u4ef6\n * \u68c0\u67e5\u6743\u9650\uff0c\u68c0\u67e5\u9ea6\u514b\u98ce\u7684\u5de5\u4f5c\u653e\u5728Activity\u4e2d\u8fdb\u884c\n * Created by Rust on 2018/2/24.\n */\npublic class WindEar {\n    private static final String TAG = \"rustApp\";\n    private static final String TMP_FOLDER_NAME = \"AnWindEar\";\n    private static final int RECORD_AUDIO_BUFFER_TIMES = 1;\n    private static final int PLAY_AUDIO_BUFFER_TIMES = 1;\n    private static final int AUDIO_FREQUENCY = 44100;\n\n    private static final int RECORD_CHANNEL_CONFIG = AudioFormat.CHANNEL_IN_STEREO;\n    private static final int PLAY_CHANNEL_CONFIG = AudioFormat.CHANNEL_OUT_STEREO;\n    private static final int AUDIO_ENCODING = AudioFormat.ENCODING_PCM_16BIT;\n\n    private AudioRecordThread aRecordThread;           // \u5f55\u5236\u7ebf\u7a0b\n    private volatile WindState state = WindState.IDLE; // \u5f53\u524d\u72b6\u6001\n    private File tmpPCMFile = null;\n    private File tmpWavFile = null;\n    private OnState onStateListener;\n    private Handler mainHandler = new Handler(Looper.getMainLooper());\n\n    /**\n     * PCM\u7f13\u5b58\u76ee\u5f55\n     */\n    private static String cachePCMFolder;\n\n    /**\n     * wav\u7f13\u5b58\u76ee\u5f55\n     */\n    private static String wavFolderPath;\n\n    private static WindEar instance = new WindEar();\n\n    private WindEar() {\n\n    }\n\n    public static WindEar getInstance() {\n        if (null == instance) {\n            instance = new WindEar();\n        }\n        return instance;\n    }\n\n    public void setOnStateListener(OnState onStateListener) {\n        this.onStateListener = onStateListener;\n    }\n\n    /**\n     * \u521d\u59cb\u5316\u76ee\u5f55\n     */\n    public static void init(Context context) {\n        // \u5b58\u50a8\u5728App\u5185\u6216SD\u5361\u4e0a\n//        cachePCMFolder = context.getFilesDir().getAbsolutePath() + File.separator + TMP_FOLDER_NAME;\n        cachePCMFolder = Environment.getExternalStorageDirectory().getAbsolutePath() + File.separator\n                + TMP_FOLDER_NAME;\n\n        File folder = new File(cachePCMFolder);\n        if (!folder.exists()) {\n            boolean f = folder.mkdirs();\n            Log.d(TAG, String.format(Locale.CHINA, \"PCM\u76ee\u5f55:%s -&gt; %b\", cachePCMFolder, f));\n        } else {\n            for (File f : folder.listFiles()) {\n                boolean d = f.delete();\n                Log.d(TAG, String.format(Locale.CHINA, \"\u5220\u9664PCM\u6587\u4ef6:%s %b\", f.getName(), d));\n            }\n            Log.d(TAG, String.format(Locale.CHINA, \"PCM\u76ee\u5f55:%s\", cachePCMFolder));\n        }\n\n        wavFolderPath = Environment.getExternalStorageDirectory().getAbsolutePath() + File.separator\n                + TMP_FOLDER_NAME;\n//        wavFolderPath = context.getFilesDir().getAbsolutePath() + File.separator + TMP_FOLDER_NAME;\n        File wavDir = new File(wavFolderPath);\n        if (!wavDir.exists()) {\n            boolean w = wavDir.mkdirs();\n            Log.d(TAG, String.format(Locale.CHINA, \"wav\u76ee\u5f55:%s -&gt; %b\", wavFolderPath, w));\n        } else {\n            Log.d(TAG, String.format(Locale.CHINA, \"wav\u76ee\u5f55:%s\", wavFolderPath));\n        }\n    }\n\n    /**\n     * \u5f00\u59cb\u5f55\u5236\u97f3\u9891\n     */\n    public synchronized void startRecord(boolean createWav) {\n        if (!state.equals(WindState.IDLE)) {\n            Log.w(TAG, \"\u65e0\u6cd5\u5f00\u59cb\u5f55\u5236\uff0c\u5f53\u524d\u72b6\u6001\u4e3a \" + state);\n            return;\n        }\n        try {\n            tmpPCMFile = File.createTempFile(\"recording\", \".pcm\", new File(cachePCMFolder));\n            if (createWav) {\n                SimpleDateFormat sdf = new SimpleDateFormat(\"yyMMdd_HHmmss\", Locale.CHINA);\n                tmpWavFile = new File(wavFolderPath + File.separator + \"r\" + sdf.format(new Date()) + \".wav\");\n            }\n            Log.d(TAG, \"tmp file \" + tmpPCMFile.getName());\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        if (null != aRecordThread) {\n            aRecordThread.interrupt();\n            aRecordThread = null;\n        }\n        aRecordThread = new AudioRecordThread(createWav);\n        aRecordThread.start();\n    }\n\n    public synchronized void stopRecord() {\n        if (!state.equals(WindState.RECORDING)) {\n            return;\n        }\n        state = WindState.STOP_RECORD;\n        notifyState(state);\n    }\n\n    /**\n     * \u64ad\u653e\u5f55\u5236\u597d\u7684PCM\u6587\u4ef6\n     */\n    public synchronized void startPlayPCM() {\n        if (!isIdle()) {\n            return;\n        }\n        new AudioTrackPlayThread(tmpPCMFile).start();\n    }\n\n    /**\n     * \u64ad\u653e\u5f55\u5236\u597d\u7684wav\u6587\u4ef6\n     */\n    public synchronized void startPlayWav() {\n        if (!isIdle()) {\n            return;\n        }\n        new AudioTrackPlayThread(tmpWavFile).start();\n    }\n\n    public synchronized void stopPlay() {\n        if (!state.equals(WindState.PLAYING)) {\n            return;\n        }\n        state = WindState.STOP_PLAY;\n    }\n\n    public synchronized boolean isIdle() {\n        return WindState.IDLE.equals(state);\n    }\n\n    /**\n     * \u97f3\u9891\u5f55\u5236\u7ebf\u7a0b\n     * \u4f7f\u7528FileOutputStream\u6765\u5199\u6587\u4ef6\n     */\n    private class AudioRecordThread extends Thread {\n        AudioRecord aRecord;\n        int bufferSize = 10240;\n        boolean createWav = false;\n\n        AudioRecordThread(boolean createWav) {\n            this.createWav = createWav;\n            bufferSize = AudioRecord.getMinBufferSize(AUDIO_FREQUENCY,\n                    RECORD_CHANNEL_CONFIG, AUDIO_ENCODING) * RECORD_AUDIO_BUFFER_TIMES;\n            Log.d(TAG, \"record buffer size = \" + bufferSize);\n            aRecord = new AudioRecord(MediaRecorder.AudioSource.MIC, AUDIO_FREQUENCY,\n                    RECORD_CHANNEL_CONFIG, AUDIO_ENCODING, bufferSize);\n        }\n\n        @Override\n        public void run() {\n            state = WindState.RECORDING;\n            notifyState(state);\n            Log.d(TAG, \"\u5f55\u5236\u5f00\u59cb\");\n            try {\n                // \u8fd9\u91cc\u9009\u62e9FileOutputStream\u800c\u4e0d\u662fDataOutputStream\n                FileOutputStream pcmFos = new FileOutputStream(tmpPCMFile);\n\n                FileOutputStream wavFos = new FileOutputStream(tmpWavFile);\n                if (createWav) {\n                    byte[] zeroHeader = new byte[44]; // \u5360\u4f4d\u7f6e\n                    wavFos.write(zeroHeader);\n                }\n                aRecord.startRecording();\n                byte[] byteBuffer = new byte[bufferSize];\n                while (state.equals(WindState.RECORDING) &amp;&amp; !isInterrupted()) {\n                    int end = aRecord.read(byteBuffer, 0, byteBuffer.length);\n                    pcmFos.write(byteBuffer, 0, end);\n                    pcmFos.flush();\n                    if (createWav) {\n                        wavFos.write(byteBuffer, 0, end);\n                        wavFos.flush();\n                    }\n                }\n                aRecord.stop(); // \u5f55\u5236\u7ed3\u675f\n                pcmFos.close();\n                wavFos.close();\n                if (createWav) {\n                    // \u4fee\u6539header\n                    RandomAccessFile wavRaf = new RandomAccessFile(tmpWavFile, \"rw\");\n                    byte[] header = generateWavFileHeader(tmpPCMFile.length() - 44, AUDIO_FREQUENCY, aRecord.getChannelCount());\n                    Log.d(TAG, \"header: \" + getHexString(header));\n                    wavRaf.seek(0);\n                    wavRaf.write(header);\n                    wavRaf.close();\n                    Log.d(TAG, \"tmpWavFile.length: \" + tmpWavFile.length());\n                }\n                Log.i(TAG, \"audio tmp PCM file len: \" + tmpPCMFile.length());\n            } catch (Exception e) {\n                Log.e(TAG, \"AudioRecordThread:\", e);\n                notifyState(WindState.ERROR);\n            }\n            notifyState(state);\n            state = WindState.IDLE;\n            notifyState(state);\n            Log.d(TAG, \"\u5f55\u5236\u7ed3\u675f\");\n        }\n\n    }\n\n    private static String getHexString(byte[] bytes) {\n        StringBuilder sb = new StringBuilder();\n        for (byte b : bytes) {\n            sb.append(Integer.toHexString(b)).append(\",\");\n        }\n        return sb.toString();\n    }\n\n    /**\n     * AudioTrack\u64ad\u653e\u97f3\u9891\u7ebf\u7a0b\n     * \u4f7f\u7528FileInputStream\u8bfb\u53d6\u6587\u4ef6\n     */\n    private class AudioTrackPlayThread extends Thread {\n        AudioTrack track;\n        int bufferSize = 10240;\n        File audioFile = null;\n\n        AudioTrackPlayThread(File aFile) {\n            setPriority(Thread.MAX_PRIORITY);\n            audioFile = aFile;\n            int bufferSize = AudioTrack.getMinBufferSize(AUDIO_FREQUENCY,\n                    PLAY_CHANNEL_CONFIG, AUDIO_ENCODING) * PLAY_AUDIO_BUFFER_TIMES;\n            track = new AudioTrack(AudioManager.STREAM_MUSIC,\n                    AUDIO_FREQUENCY,\n                    PLAY_CHANNEL_CONFIG, AUDIO_ENCODING, bufferSize,\n                    AudioTrack.MODE_STREAM);\n        }\n\n        @Override\n        public void run() {\n            super.run();\n            state = WindState.PLAYING;\n            notifyState(state);\n            try {\n                FileInputStream fis = new FileInputStream(audioFile);\n                track.play();\n                byte[] aByteBuffer = new byte[bufferSize];\n                while (state.equals(WindState.PLAYING) &amp;&amp;\n                        fis.read(aByteBuffer) &gt;= 0) {\n                    track.write(aByteBuffer, 0, aByteBuffer.length);\n                }\n                track.stop();\n                track.release();\n            } catch (Exception e) {\n                Log.e(TAG, \"AudioTrackPlayThread:\", e);\n                notifyState(WindState.ERROR);\n            }\n            state = WindState.STOP_PLAY;\n            notifyState(state);\n            state = WindState.IDLE;\n            notifyState(state);\n        }\n\n    }\n\n    private synchronized void notifyState(final WindState currentState) {\n        if (null != onStateListener) {\n            mainHandler.post(new Runnable() {\n                @Override\n                public void run() {\n                    onStateListener.onStateChanged(currentState);\n                }\n            });\n        }\n    }\n\n    public interface OnState {\n        void onStateChanged(WindState currentState);\n    }\n\n    /**\n     * \u8868\u793a\u5f53\u524d\u72b6\u6001\n     */\n    public enum WindState {\n        ERROR,\n        IDLE,\n        RECORDING,\n        STOP_RECORD,\n        PLAYING,\n        STOP_PLAY\n    }\n\n    /**\n     * @param out            wav\u97f3\u9891\u6587\u4ef6\u6d41\n     * @param totalAudioLen  \u4e0d\u5305\u62echeader\u7684\u97f3\u9891\u6570\u636e\u603b\u957f\u5ea6\n     * @param longSampleRate \u91c7\u6837\u7387,\u4e5f\u5c31\u662f\u5f55\u5236\u65f6\u4f7f\u7528\u7684\u9891\u7387\n     * @param channels       audioRecord\u7684\u9891\u9053\u6570\u91cf\n     * @throws IOException \u5199\u6587\u4ef6\u9519\u8bef\n     */\n    private void writeWavFileHeader(FileOutputStream out, long totalAudioLen, long longSampleRate,\n                                    int channels) throws IOException {\n        byte[] header = generateWavFileHeader(totalAudioLen, longSampleRate, channels);\n        out.write(header, 0, header.length);\n    }\n\n    /**\n     * \u4efb\u4f55\u4e00\u79cd\u6587\u4ef6\u5728\u5934\u90e8\u6dfb\u52a0\u76f8\u5e94\u7684\u5934\u6587\u4ef6\u624d\u80fd\u591f\u786e\u5b9a\u7684\u8868\u793a\u8fd9\u79cd\u6587\u4ef6\u7684\u683c\u5f0f\uff0c\n     * wave\u662fRIFF\u6587\u4ef6\u7ed3\u6784\uff0c\u6bcf\u4e00\u90e8\u5206\u4e3a\u4e00\u4e2achunk\uff0c\u5176\u4e2d\u6709RIFF WAVE chunk\uff0c\n     * FMT Chunk\uff0cFact chunk,Data chunk,\u5176\u4e2dFact chunk\u662f\u53ef\u4ee5\u9009\u62e9\u7684\n     *\n     * @param pcmAudioByteCount \u4e0d\u5305\u62echeader\u7684\u97f3\u9891\u6570\u636e\u603b\u957f\u5ea6\n     * @param longSampleRate    \u91c7\u6837\u7387,\u4e5f\u5c31\u662f\u5f55\u5236\u65f6\u4f7f\u7528\u7684\u9891\u7387\n     * @param channels          audioRecord\u7684\u9891\u9053\u6570\u91cf\n     */\n    private byte[] generateWavFileHeader(long pcmAudioByteCount, long longSampleRate, int channels) {\n        long totalDataLen = pcmAudioByteCount + 36; // \u4e0d\u5305\u542b\u524d8\u4e2a\u5b57\u8282\u7684WAV\u6587\u4ef6\u603b\u957f\u5ea6\n        long byteRate = longSampleRate * 2 * channels;\n        byte[] header = new byte[44];\n        header[0] = 'R'; // RIFF\n        header[1] = 'I';\n        header[2] = 'F';\n        header[3] = 'F';\n\n        header[4] = (byte) (totalDataLen &amp; 0xff);//\u6570\u636e\u5927\u5c0f\n        header[5] = (byte) ((totalDataLen &gt;&gt; 8) &amp; 0xff);\n        header[6] = (byte) ((totalDataLen &gt;&gt; 16) &amp; 0xff);\n        header[7] = (byte) ((totalDataLen &gt;&gt; 24) &amp; 0xff);\n\n        header[8] = 'W';//WAVE\n        header[9] = 'A';\n        header[10] = 'V';\n        header[11] = 'E';\n        //FMT Chunk\n        header[12] = 'f'; // 'fmt '\n        header[13] = 'm';\n        header[14] = 't';\n        header[15] = ' ';//\u8fc7\u6e21\u5b57\u8282\n        //\u6570\u636e\u5927\u5c0f\n        header[16] = 16; // 4 bytes: size of 'fmt ' chunk\n        header[17] = 0;\n        header[18] = 0;\n        header[19] = 0;\n        //\u7f16\u7801\u65b9\u5f0f 10H\u4e3aPCM\u7f16\u7801\u683c\u5f0f\n        header[20] = 1; // format = 1\n        header[21] = 0;\n        //\u901a\u9053\u6570\n        header[22] = (byte) channels;\n        header[23] = 0;\n        //\u91c7\u6837\u7387\uff0c\u6bcf\u4e2a\u901a\u9053\u7684\u64ad\u653e\u901f\u5ea6\n        header[24] = (byte) (longSampleRate &amp; 0xff);\n        header[25] = (byte) ((longSampleRate &gt;&gt; 8) &amp; 0xff);\n        header[26] = (byte) ((longSampleRate &gt;&gt; 16) &amp; 0xff);\n        header[27] = (byte) ((longSampleRate &gt;&gt; 24) &amp; 0xff);\n        //\u97f3\u9891\u6570\u636e\u4f20\u9001\u901f\u7387,\u91c7\u6837\u7387*\u901a\u9053\u6570*\u91c7\u6837\u6df1\u5ea6/8\n        header[28] = (byte) (byteRate &amp; 0xff);\n        header[29] = (byte) ((byteRate &gt;&gt; 8) &amp; 0xff);\n        header[30] = (byte) ((byteRate &gt;&gt; 16) &amp; 0xff);\n        header[31] = (byte) ((byteRate &gt;&gt; 24) &amp; 0xff);\n        // \u786e\u5b9a\u7cfb\u7edf\u4e00\u6b21\u8981\u5904\u7406\u591a\u5c11\u4e2a\u8fd9\u6837\u5b57\u8282\u7684\u6570\u636e\uff0c\u786e\u5b9a\u7f13\u51b2\u533a\uff0c\u901a\u9053\u6570*\u91c7\u6837\u4f4d\u6570\n        header[32] = (byte) (2 * channels);\n        header[33] = 0;\n        //\u6bcf\u4e2a\u6837\u672c\u7684\u6570\u636e\u4f4d\u6570\n        header[34] = 16;\n        header[35] = 0;\n        //Data chunk\n        header[36] = 'd';//data\n        header[37] = 'a';\n        header[38] = 't';\n        header[39] = 'a';\n        header[40] = (byte) (pcmAudioByteCount &amp; 0xff);\n        header[41] = (byte) ((pcmAudioByteCount &gt;&gt; 8) &amp; 0xff);\n        header[42] = (byte) ((pcmAudioByteCount &gt;&gt; 16) &amp; 0xff);\n        header[43] = (byte) ((pcmAudioByteCount &gt;&gt; 24) &amp; 0xff);\n        return header;\n    }\n}\n</code></pre> <p>\u6ce8\u610f pcmAudioByteCount</p> <p>\u6ce8\u610f \u4e0a\u9762\u7684<code>pcmAudioByteCount</code>\u662f\u4e0d\u5305\u62echeader\u7684\u97f3\u9891\u6570\u636e\u603b\u957f\u5ea6\u3002\u5982\u679c\u5f04\u9519\u4e86\u957f\u5ea6\uff0cMIUI\u67d0\u4e9b\u7248\u672c\u7684MediaPlayer\u4f1a\u65e0\u6cd5\u64ad\u653e\u3002</p> <p>\u957f\u5ea6\u5f04\u9519\uff0cMediaPlayer prepare\u540e\u4f1a\u62a5 -2147483648</p> <p>\u5f55\u5236\u5f00\u59cb\u65f6\u90fd\u662f0</p> <p>\u5f55\u5236\u521a\u5f00\u59cb\u7684\u65f6\u5019\uff0c<code>aRecord.read(byteBuffer, 0, byteBuffer.length)</code> \u7ed9\u7684\u53ef\u80fd\u90fd\u662f0</p> <p>\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u9700\u6c42\uff0c\u820d\u5f03\u5f00\u5934\u90e8\u5206\u76840\u3002\u6216\u8005\u662f\u201c\u9884\u70ed\u201d\u8df3\u8fc7\u524d\u97621\u79d2\u7684\u6570\u636e\u3002</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/AudioRecord_AudioTrack_pcm_wav/#_3","title":"\u83b7\u53d6\u97f3\u91cf\u5927\u5c0f","text":"<p>\u5982\u679c\u5f55\u97f3\u7684\u7f16\u7801\u662f16\u4e3apcm\uff0c\u800c\u5f55\u97f3\u6570\u636e\u6570\u636e\u662fbyte\uff0c\u9700\u8981\u5c06\u4e24\u4e2abyte\u8f6c\u4e3a\u4e00\u4e2ashort\u8fdb\u884c\u5904\u7406\uff0c\u5efa\u8bae\u7528\u5c0f\u7aef\u7684\u65b9\u5f0f\u3002</p> \u8ba1\u7b97\u65b9\u6cd5<pre><code>private static float calVolumeInByte(byte[] buffer) {\n    float sumVolume = 0.0f;\n    float avgVolume = 0.0f;\n    float volume = 0.0f;\n    for (int i = 0; i &lt; buffer.length; i += 2) {\n        int v1 = buffer[i] &amp; 0xFF;\n        int v2 = buffer[i + 1] &amp; 0xFF;\n        int temp = v1 + (v2 &lt;&lt; 8);// \u5c0f\u7aef little-end\n        if (temp &gt;= 0x8000) {\n            temp = 0xffff - temp;\n        }\n        sumVolume += Math.abs(temp);\n    }\n    avgVolume = sumVolume / buffer.length / 2;\n    volume = (float) (Math.log10(1 + avgVolume) * 10);\n    return volume;\n}\n</code></pre>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/AudioRecord_AudioTrack_pcm_wav/#_4","title":"\u5f00\u542f\u81ea\u52a8\u589e\u76ca","text":"<p>\u81ea\u52a8\u589e\u76ca AutomaticGainControl</p> <pre><code>if (AutomaticGainControl.isAvailable()) {\n    AutomaticGainControl agc = AutomaticGainControl.create(aRecord.getAudioSessionId());\n    if (agc != null) {\n        agc.setEnabled(true);\n    } else {\n        Log.w(TAG, \"AutomaticGainControl is NULL. \u65e0\u6cd5\u5f00\u542f\u81ea\u52a8\u589e\u76ca\");\n    }\n} else {\n    Log.w(TAG, \"AudioRecordThread: \u4e0d\u652f\u6301\u81ea\u52a8\u589e\u76caAutomaticGainControl\");\n}\n</code></pre>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/AudioRecord_AudioTrack_pcm_wav/#_5","title":"\u5f00\u542f\u566a\u58f0\u6291\u5236","text":"<p>\u4f7f\u7528 NoiseSuppressor \u5f00\u542f\u566a\u58f0\u6291\u5236</p> <p><pre><code>import android.media.audiofx.NoiseSuppressor;\n\nif (NoiseSuppressor.isAvailable()) {\n    NoiseSuppressor ns = NoiseSuppressor.create(aRecord.getAudioSessionId());\n    if (ns != null) {\n        ns.setEnabled(true);\n    } else {\n        Log.w(TAG, \"AudioRecordThread: \u4e0d\u652f\u6301\u566a\u58f0\u6291\u5236\");\n    }\n} else {\n    Log.w(TAG, \"AudioRecordThread: \u4e0d\u652f\u6301\u566a\u58f0\u6291\u5236\");\n}\n</code></pre> \u6709\u4e9b\u673a\u578b\u4e0d\u652f\u6301\u566a\u58f0\u6291\u5236</p> <p>\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528WebRTC\u7684AGC\u548cANS\u6a21\u5757</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/AudioRecord_AudioTrack_pcm_wav/#_6","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>AudioRecord - developer.android.com</li> <li>AudioTrack - developer.android.com</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u7b80\u4e66</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/Camera_SurfaceView_TextureView_get_nv21/","title":"Android\u4f7f\u7528SurfaceView\u548cTextureView\u9884\u89c8Camera\uff0c\u83b7\u53d6NV21\u6570\u636e","text":"\u66f4\u65b0: 2021-12-20 \u589e\u52a0\u81ea\u52a8\u5bf9\u7126\u8bf4\u660e <ul> <li>2021-12-20 \u589e\u52a0\u81ea\u52a8\u5bf9\u7126\u8bf4\u660e</li> <li>2021-12-10 \u66f4\u65b0\u8bf4\u660e\u548c\u53c2\u8003</li> <li>2018-2-16 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4f7f\u7528 android.hardware.Camera \u8fdb\u884c\u89c6\u9891\u7684\u91c7\u96c6\uff0c\u5206\u522b\u4f7f\u7528 SurfaceView\u3001TextureView \u6765\u9884\u89c8 Camera \u6570\u636e\uff0c\u53d6\u5230NV21\u7684\u6570\u636e\u56de\u8c03\u3002</p> <p>Deprecated</p> <p>android.hardware.Camera \u5df2\u7ecf\u4e0d\u5efa\u8bae\u4f7f\u7528\u4e86\u3002\u5efa\u8bae\u4f7f\u7528 android.hardware.camera2</p> <p>\u53ef\u53c2\u8003CameraX\u6253\u5f00\u5b9e\u65f6\u9884\u89c8</p> <p>\u83b7\u53d6nv21\u6570\u636e\uff0c\u53ef\u53c2\u8003CameraX\u5206\u6790\u5668</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/Camera_SurfaceView_TextureView_get_nv21/#_1","title":"\u51c6\u5907","text":"<p>\u4f7f\u7528\u76f8\u673a\u6743\u9650 <pre><code>&lt;uses-permission android:name=\"android.permission.CAMERA\" /&gt;\n</code></pre> camera\u9884\u89c8\u56de\u8c03\u4e2d\u9ed8\u8ba4\u4f7f\u7528NV21\u683c\u5f0f\u3002\u68c0\u67e5\u624b\u673a\u662f\u5426\u652f\u6301\u6444\u50cf\u5934\u3002</p> <p>UI\u51c6\u5907 <pre><code>&lt;!-- \u5168\u5c4f\u663e\u793a --&gt;\n&lt;style name=\"FullScreenTheme\" parent=\"AppTheme\"&gt;\n    &lt;item name=\"windowNoTitle\"&gt;true&lt;/item&gt;\n    &lt;item name=\"android:windowFullscreen\"&gt;true&lt;/item&gt;\n&lt;/style&gt;\n</code></pre></p> <p>\u627f\u8f7d\u9884\u89c8\u56fe\u50cf <pre><code>&lt;FrameLayout\n    android:id=\"@+id/camera_preview\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\" /&gt;\n</code></pre></p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/Camera_SurfaceView_TextureView_get_nv21/#surfaceview-cameranv21","title":"\u4f7f\u7528 SurfaceView \u9884\u89c8 Camera\uff0c\u53d6\u5230NV21\u6570\u636e","text":"<p>\u81ea\u5b9a\u4e49<code>CameraPreview</code>\u7ee7\u627f<code>SurfaceView</code>\uff0c\u5b9e\u73b0<code>SurfaceHolder.Callback</code>\u63a5\u53e3</p> <p>\u83b7\u53d6NV21\u6570\u636e\uff0c<code>Camera.setPreviewCallback()</code> \u8981\u653e\u5728 <code>Camera.startPreview()</code> \u4e4b\u524d\u3002 \u4f7f\u7528<code>Camera.PreviewCallback</code>\u83b7\u53d6\u9884\u89c8\u6570\u636e\u56de\u8c03\u3002\u9ed8\u8ba4\u662fNV21\u683c\u5f0f\u3002</p> <p><code>surfaceChanged</code>\u4e2d\uff0ccamera\u542f\u52a8\u9884\u89c8\u524d\u53ef\u4ee5\u8fdb\u884c\u8bbe\u7f6e\uff0c\u4f8b\u5982\u8bbe\u7f6e\u5c3a\u5bf8\uff0c\u8c03\u6574\u65b9\u5411 <pre><code>import android.content.Context;\nimport android.hardware.Camera;\nimport android.util.Log;\nimport android.view.SurfaceHolder;\nimport android.view.SurfaceView;\nimport java.io.IOException;\n\n/**\n * camera\u9884\u89c8\u89c6\u56fe\n * Created by Rust on 2018/2/26.\n */\npublic class CameraPreview extends SurfaceView implements SurfaceHolder.Callback {\n    private static final String TAG = \"rustApp\";\n    private SurfaceHolder mHolder;\n    private Camera mCamera;\n    private int mFrameCount = 0;\n\n    public CameraPreview(Context context) {\n        super(context);\n    }\n\n    public CameraPreview(Context context, Camera camera) {\n        super(context);\n        mCamera = camera;\n        mHolder = getHolder();\n        mHolder.addCallback(this);\n        mHolder.setType(SurfaceHolder.SURFACE_TYPE_PUSH_BUFFERS);\n    }\n\n    public void setCamera(Camera c) {\n        this.mCamera = c;\n    }\n\n    @Override\n    public void surfaceCreated(SurfaceHolder holder) {\n        // \u5f00\u542f\u9884\u89c8\n        try {\n            mCamera.setPreviewDisplay(holder);\n            mCamera.startPreview();\n        } catch (IOException e) {\n            Log.d(TAG, \"Error setting camera preview: \" + e.getMessage());\n        }\n    }\n\n    @Override\n    public void surfaceDestroyed(SurfaceHolder holder) {\n        // \u53ef\u5728\u6b64\u91ca\u653ecamera\n    }\n\n    @Override\n    public void surfaceChanged(SurfaceHolder holder, int format, int w, int h) {\n        // \u82e5\u9700\u8981\u65cb\u8f6c\u3001\u66f4\u6539\u5927\u5c0f\u6216\u91cd\u65b0\u8bbe\u7f6e\uff0c\u8bf7\u786e\u4fdd\u8bc1\u5df2\u505c\u6b62\u9884\u89c8\n        if (mHolder.getSurface() == null) {\n            return;\n        }\n        try {\n            mCamera.stopPreview();\n        } catch (Exception e) {\n            // ignore: tried to stop a non-existent preview\n        }\n        Camera.Parameters parameters = mCamera.getParameters();\n        // ImageFormat.NV21 == 17\n        Log.d(TAG, \"parameters.getPreviewFormat(): \" + parameters.getPreviewFormat());\n        if (this.getResources().getConfiguration().orientation != Configuration.ORIENTATION_LANDSCAPE) {\n            mCamera.setDisplayOrientation(90);\n        } else {\n            mCamera.setDisplayOrientation(0);\n        }\n        try {\n            mCamera.setPreviewDisplay(mHolder);\n            mCamera.setPreviewCallback(mCameraPreviewCallback); // \u56de\u8c03\u8981\u653e\u5728 startPreview() \u4e4b\u524d\n            mCamera.startPreview();\n        } catch (Exception e) {\n            Log.d(TAG, \"Error starting camera preview: \" + e.getMessage());\n        }\n    }\n\n    private Camera.PreviewCallback mCameraPreviewCallback = new Camera.PreviewCallback() {\n        @Override\n        public void onPreviewFrame(byte[] data, Camera camera) {\n            mFrameCount++;\n            Log.d(TAG, \"onPreviewFrame: data.length=\" + data.length + \", frameCount=\" + mFrameCount);\n        }\n    };\n}\n</code></pre></p> <p>\u4e3a\u4e86\u9632\u6b62\u963b\u585eUI\u7ebf\u7a0b\uff0c\u5728\u5b50\u7ebf\u7a0b\u4e2d\u6253\u5f00camera\u3002camera\u5e38\u653e\u5728<code>try catch</code>\u4e2d\u4f7f\u7528\u3002 <pre><code>public class MainActivity extends AppCompatActivity {\n\n    private static final String TAG = \"rustApp\";\n\n    private Camera mCamera;\n    private CameraPreview mPreview;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        new InitCameraThread().start();\n    }\n\n    @Override\n    protected void onResume() {\n        if (null == mCamera) {\n            if (safeCameraOpen()) {\n                mPreview.setCamera(mCamera); // \u91cd\u65b0\u83b7\u53d6camera\u64cd\u4f5c\u6743\n            } else {\n                Log.e(TAG, \"\u65e0\u6cd5\u64cd\u4f5ccamera\");\n            }\n        }\n        super.onResume();\n    }\n\n    @Override\n    protected void onPause() {\n        super.onPause();\n        releaseCamera();\n    }\n\n    private boolean safeCameraOpen() {\n        boolean qOpened = false;\n        try {\n            releaseCamera();\n            mCamera = Camera.open();\n            qOpened = (mCamera != null);\n        } catch (Exception e) {\n            Log.e(TAG, \"failed to open Camera\");\n            e.printStackTrace();\n        }\n        return qOpened;\n    }\n\n    private void releaseCamera() {\n        if (mCamera != null) {\n            mCamera.setPreviewCallback(null);\n            mCamera.release();        // release the camera for other applications\n            mCamera = null;\n        }\n    }\n\n    private class InitCameraThread extends Thread {\n        @Override\n        public void run() {\n            super.run();\n            if (safeCameraOpen()) {\n                Log.d(TAG, \"\u5f00\u542f\u6444\u50cf\u5934\");\n                runOnUiThread(new Runnable() {\n                    @Override\n                    public void run() {\n                        mPreview = new CameraPreview(MainActivity.this, mCamera);\n                        FrameLayout preview = findViewById(R.id.camera_preview);\n                        preview.addView(mPreview);\n                    }\n                });\n            }\n        }\n    }\n}\n</code></pre></p> <p>\u8fd0\u884c\u5728\u67d0\u4e9b\u771f\u673a\u4e0a\uff0c\u4f1a\u53d1\u73b0\u56fe\u50cf\u88ab\u201c\u62c9\u9ad8\u201d\u4e86\u3002</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/Camera_SurfaceView_TextureView_get_nv21/#textureview-cameranv21","title":"\u4f7f\u7528 TextureView \u9884\u89c8 Camera\uff0c\u53d6\u5230NV21\u6570\u636e","text":"<p><code>TextureView</code>\u53ef\u7528\u4e8e\u663e\u793a\u5185\u5bb9\u6d41\u3002\u5185\u5bb9\u6d41\u53ef\u4ee5\u662f\u89c6\u9891\u6216\u8005OpenGL\u7684\u573a\u666f\u3002\u5185\u5bb9\u6d41\u53ef\u6765\u81ea\u5e94\u7528\u8fdb\u7a0b\u6216\u662f\u8fdc\u7a0b\u5176\u5b83\u8fdb\u7a0b\u3002</p> <p><code>Textureview</code>\u5fc5\u987b\u5728\u786c\u4ef6\u52a0\u901f\u5f00\u542f\u7684\u7a97\u53e3\u4e2d\u4f7f\u7528\u3002\u82e5\u662f\u8f6f\u89e3\uff0c<code>TextureView</code>\u4e0d\u4f1a\u663e\u793a\u4e1c\u897f\u3002</p> <p>\u4e0d\u540c\u4e8e<code>SurfaceView</code>\uff0c<code>TextureView</code>\u4e0d\u4f1a\u5efa\u7acb\u4e00\u4e2a\u5355\u72ec\u7684\u7a97\u53e3\uff0c\u800c\u662f\u50cf\u4e00\u4e2a\u5e38\u89c4\u7684View\u4e00\u6837\uff08\u4e2a\u4eba\u8ba4\u4e3a\u8fd9\u662f\u4e2a\u4f18\u70b9\uff09\u3002 \u8fd9\u4f7f\u5f97<code>TextureView</code>\u53ef\u4ee5\u88ab\u79fb\u52a8\uff0c\u8f6c\u6362\u6216\u662f\u6dfb\u52a0\u52a8\u753b\u3002\u6bd4\u5982\uff0c\u53ef\u4ee5\u8c03\u7528<code>myView.setAlpha(0.5f)</code>\u5c06\u5176\u8bbe\u7f6e\u6210\u534a\u900f\u660e\u3002</p> <p>\u4f7f\u7528<code>TextureView</code>\u5f88\u7b80\u5355\uff1a\u83b7\u53d6\u5230\u5b83\u7684<code>SurfaceTexture</code>\uff0c\u4f7f\u7528<code>SurfaceTexture</code>\u5448\u73b0\u5185\u5bb9\u3002</p> <p><code>CameraPreview</code>\u7ee7\u627f\u4e86<code>TextureView</code>\uff0c\u5916\u90e8\u9700\u8981\u4f20\u5165camera\u5b9e\u4f8b\u3002\u5728<code>onSurfaceTextureAvailable</code>\u4e2d\uff0c\u914d\u7f6ecamera\uff0c\u6bd4\u5982\u8bbe\u7f6e\u56fe\u50cf\u65b9\u5411\u3002 \u901a\u8fc7\u8bbe\u7f6e<code>Camera.PreviewCallback</code>\u6765\u53d6\u5f97\u9884\u89c8\u6570\u636e\u3002 <pre><code>import java.io.IOException;\nimport android.content.Context;\nimport android.content.res.Configuration;\nimport android.graphics.SurfaceTexture;\nimport android.hardware.Camera;\nimport android.util.Log;\nimport android.view.TextureView;\n\npublic class CameraPreview extends TextureView implements TextureView.SurfaceTextureListener {\n    private static final String TAG = \"rustApp\";\n    private Camera mCamera;\n\n    public CameraPreview(Context context) {\n        super(context);\n    }\n\n    public CameraPreview(Context context, Camera camera) {\n        super(context);\n        mCamera = camera;\n    }\n\n    public void setCamera(Camera camera) {\n        this.mCamera = camera;\n    }\n\n    @Override\n    public void onSurfaceTextureAvailable(SurfaceTexture surface, int width, int height) {\n        Log.d(TAG, \"TextureView onSurfaceTextureAvailable\");\n        if (this.getResources().getConfiguration().orientation != Configuration.ORIENTATION_LANDSCAPE) {\n            mCamera.setDisplayOrientation(90);\n        } else {\n            mCamera.setDisplayOrientation(0);\n        }\n        try {\n            mCamera.setPreviewCallback(mCameraPreviewCallback);\n            mCamera.setPreviewTexture(surface); // \u4f7f\u7528SurfaceTexture\n            mCamera.startPreview();\n        } catch (IOException ioe) {\n            // Something bad happened\n        }\n    }\n\n    @Override\n    public void onSurfaceTextureSizeChanged(SurfaceTexture surface, int width, int height) {\n        Log.d(TAG, \"TextureView onSurfaceTextureSizeChanged\"); // Ignored, Camera does all the work for us\n    }\n\n    @Override\n    public boolean onSurfaceTextureDestroyed(SurfaceTexture surface) {\n        Log.d(TAG, \"TextureView onSurfaceTextureDestroyed\");\n        mCamera.stopPreview();\n        mCamera.release();\n        return true;\n    }\n\n    @Override\n    public void onSurfaceTextureUpdated(SurfaceTexture surface) {\n        // Invoked every time there's a new Camera preview frame\n    }\n\n    private Camera.PreviewCallback mCameraPreviewCallback = new Camera.PreviewCallback() {\n        @Override\n        public void onPreviewFrame(byte[] data, Camera camera) {\n            Log.d(TAG, \"onPreviewFrame: data.length=\" + data.length);\n        }\n    };\n}\n</code></pre></p> <p>\u64cd\u4f5c\u754c\u9762<code>TextureAct</code>\u3002\u83b7\u53d6camera\u64cd\u4f5c\u6743\uff0c\u521d\u59cb\u5316<code>CameraPreview</code>\u5e76\u6dfb\u52a0\u5230\u5e03\u5c40\u4e2d\u3002\u7b2c\u4e00\u6b21\u83b7\u53d6camera\u65f6\u5728\u5b50\u7ebf\u7a0b\u4e2d\u64cd\u4f5c\u3002</p> <p>\u5728<code>onPause</code>\u4e2d\u91ca\u653ecamera\uff0c<code>onResume</code>\u4e2d\u5c1d\u8bd5\u53d6\u56decamera\u63a7\u5236\u6743\u3002\u8fd9\u6837\u5e94\u7528\u6682\u65f6\u9000\u56de\u540e\u53f0\u65f6\uff0c\u5176\u4ed6\u5e94\u7528\u53ef\u4ee5\u64cd\u4f5c\u6444\u50cf\u5934\u3002 <pre><code>public class TextureAct extends AppCompatActivity {\n    private static final String TAG = \"rustApp\";\n    private Camera mCamera;\n    private CameraPreview mPreview;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_texture);\n        new InitCameraThread().start();\n    }\n\n    @Override\n    protected void onResume() {\n        if (null == mCamera) {\n            if (safeCameraOpen()) {\n                mPreview.setCamera(mCamera); // \u91cd\u65b0\u83b7\u53d6camera\u64cd\u4f5c\u6743\n            } else {\n                Log.e(TAG, \"\u65e0\u6cd5\u64cd\u4f5ccamera\");\n            }\n        }\n        super.onResume();\n    }\n\n    @Override\n    protected void onPause() {\n        super.onPause();\n        releaseCamera();\n    }\n\n    @Override\n    protected void onDestroy() {\n        super.onDestroy();\n        releaseCamera();\n    }\n\n    private boolean safeCameraOpen() {\n        boolean qOpened = false;\n        try {\n            releaseCamera();\n            mCamera = Camera.open();\n            qOpened = (mCamera != null);\n        } catch (Exception e) {\n            Log.e(TAG, \"failed to open Camera\");\n            e.printStackTrace();\n        }\n        return qOpened;\n    }\n\n    private void releaseCamera() {\n        if (mCamera != null) {\n            mCamera.setPreviewCallback(null);\n            mCamera.release();        // release the camera for other applications\n            mCamera = null;\n        }\n    }\n\n    private class InitCameraThread extends Thread {\n        @Override\n        public void run() {\n            super.run();\n            if (safeCameraOpen()) {\n                Log.d(TAG, \"TextureAct \u5f00\u542f\u6444\u50cf\u5934\");\n                runOnUiThread(new Runnable() {\n                    @Override\n                    public void run() {\n                        mPreview = new CameraPreview(TextureAct.this, mCamera);\n                        mPreview.setSurfaceTextureListener(mPreview);\n                        FrameLayout preview = findViewById(R.id.camera_preview);\n                        preview.addView(mPreview);\n                    }\n                });\n            }\n        }\n    }\n}\n</code></pre> <code>Textureview</code>\u5fc5\u987b\u5728\u786c\u4ef6\u52a0\u901f\u5f00\u542f\u7684\u7a97\u53e3\u4e2d\u4f7f\u7528\u3002<code>android:hardwareAccelerated=\"true\"</code> \u9ed8\u8ba4\u7684\u8fd9\u4e2a\u5c5e\u6027\u5c31\u662ftrue\uff0c\u65e0\u9700\u518d\u8bbe\u7f6e\u3002</p> <p>\u6bcf\u63a5\u5230\u4e00\u5e27\u6570\u636e\uff0c\u5c31\u4f1a\u8c03\u7528\u4e00\u6b21<code>onSurfaceTextureUpdated()</code>\u3002\u901a\u8fc7\u8fd9\u4e2a\u63a5\u53e3\u3002\u80fd\u591f\u5c06\u4e0a\u6765\u7684SurfaceTexture\u9001\u7ed9OpenGL\u518d\u53bb\u5904\u7406\u3002</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/Camera_SurfaceView_TextureView_get_nv21/#_2","title":"\u542f\u7528\u81ea\u52a8\u5bf9\u7126","text":"<p>manifest\u4e2d\u9700\u8981\u7533\u660e\u4f7f\u7528\u529f\u80fd <pre><code>&lt;uses-feature android:name=\"android.hardware.camera.autofocus\" /&gt;\n</code></pre></p> <p>\u5148\u68c0\u67e5\u662f\u5426\u652f\u6301\u81ea\u52a8\u5bf9\u7126\uff0c\u518d\u53bb\u8bbe\u7f6e <pre><code>import android.hardware.Camera.Parameters;\nimport android.hardware.Camera.PreviewCallback;\nimport android.hardware.Camera; // \u7528\u7684\u662fcamera1\n\nCamera.Parameters parameters = camera.getParameters();\nif (parameters.getSupportedFocusModes().contains(Camera.Parameters.FOCUS_MODE_CONTINUOUS_VIDEO)) {\n    parameters.setFocusMode(Camera.Parameters.FOCUS_MODE_CONTINUOUS_VIDEO);\n}\ncamera.setParameters(parameters);\n</code></pre></p> <p><code>autoFocus</code>\u65b9\u6cd5\u8981\u5728<code>camera.startPreview()</code>\u548c<code>camera.stopPreview()</code>\u4e4b\u95f4\u8c03\u7528 <pre><code>camera.startPreview();\ntry {\n    camera.autoFocus(new Camera.AutoFocusCallback() {\n        @Override\n        public void onAutoFocus(boolean success, Camera camera) {\n            KCLog.d(\"\u5bf9\u7126 \" + success);\n        }\n    });\n} catch (Exception e) {\n    KCLog.e(\"\u5bf9\u7126\u5931\u8d25\" + e.toString());\n}\n</code></pre></p> <p>\u53ef\u4ee5\u9009\u62e9\u76d1\u542c\u611f\u5e94\u5668\u53d8\u5316\uff0c\u5728\u91cc\u9762\u53d1\u8d77\u5bf9\u7126</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/Camera_SurfaceView_TextureView_get_nv21/#_3","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>Controlling the Camera - Android Developer</li> <li>Camera API - Android Developer</li> <li>TextureView - Android Developer</li> </ul>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/Camera_record_video_and_output/","title":"Android \u4f7f\u7528 Android Camera API \u5b8c\u6210\u97f3\u89c6\u9891\u7684\u91c7\u96c6\u3001\u7f16\u7801\u3001\u5c01\u5305\u6210 mp4 \u8f93\u51fa","text":"<ul> <li>win7</li> <li>Android Studio 3.0.1</li> </ul> <p>\u76f8\u5173\u4ee3\u7801\u8bf7\u53c2\u9605\uff1a https://github.com/RustFisher/android-CameraRecorder</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/Camera_record_video_and_output/#_1","title":"\u6982\u8ff0","text":"<p>\u672c\u6587\u76ee\u7684\uff1a\u4f7f\u7528 Android Camera API \u5b8c\u6210\u97f3\u89c6\u9891\u7684\u91c7\u96c6\u3001\u7f16\u7801\u3001\u5c01\u5305\u6210 mp4 \u8f93\u51fa</p> <p>\u57fa\u4e8e<code>android.hardware.Camera</code>\uff0c\u521b\u5efa\u4e00\u4e2a\u6a2a\u5c4f\u5e94\u7528\uff0c\u5b9e\u65f6\u9884\u89c8\u6444\u50cf\u5934\u56fe\u50cf\uff0c\u5b9e\u73b0\u5f55\u50cf\u5e76\u8f93\u51faMP4\u7684\u529f\u80fd\u3002 \u8fd9\u91cc\u4e0d\u4f7f\u7528Camera2\u3002</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/Camera_record_video_and_output/#_2","title":"\u7533\u8bf7\u6743\u9650","text":"<p><pre><code>&lt;!-- \u9700\u8981\u5f55\u5236\u97f3\u89c6\u9891\u6743\u9650\u548c\u5199\u5916\u90e8\u5b58\u50a8\u6743\u9650 --&gt;\n&lt;uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\" /&gt;\n&lt;uses-permission android:name=\"android.permission.RECORD_AUDIO\" /&gt;\n&lt;uses-permission android:name=\"android.permission.CAMERA\" /&gt;\n\n&lt;uses-feature android:name=\"android.hardware.camera\" /&gt;\n</code></pre> \u5728activity\u4e2d\u52a8\u6001\u7533\u8bf7\u6743\u9650 <pre><code>private static final String[] VIDEO_PERMISSIONS = {\n        Manifest.permission.CAMERA,\n        Manifest.permission.RECORD_AUDIO,\n        Manifest.permission.WRITE_EXTERNAL_STORAGE\n};\n</code></pre></p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/Camera_record_video_and_output/#_3","title":"\u5b9e\u73b0\u6444\u50cf\u5934\u9884\u89c8\u529f\u80fd","text":"<p>\u4f7f\u7528<code>SurfaceView</code>\u6765\u9884\u89c8\u3002\u65b0\u5efa<code>CameraPreview</code>\u7c7b\u7ee7\u627f\u81ea<code>SurfaceView</code>\u5e76\u5b9e\u73b0<code>SurfaceHolder.Callback</code>\uff1b camera\u76f8\u5173\u64cd\u4f5c\u90fd\u653e\u5728\u8fd9\u4e2aView\u91cc\u3002</p> <ul> <li><code>surfaceCreated</code>\u4e2d\u83b7\u53d6Camera\u5b9e\u4f8b\uff0c\u542f\u52a8\u9884\u89c8\uff1b\u8bbe\u7f6e\u9884\u89c8\u76f8\u5173\u53c2\u6570</li> <li><code>surfaceDestroyed</code>\u91ca\u653eCamera</li> </ul> <pre><code>public class CameraPreview extends SurfaceView implements SurfaceHolder.Callback {\n    private static final String TAG = \"rustAppCameraPreview\";\n    private SurfaceHolder mHolder;\n    private Camera mCamera;\n\n    public static final int MEDIA_TYPE_IMAGE = 1;\n    public static final int MEDIA_TYPE_VIDEO = 2;\n    private static int mOptVideoWidth = 1920;  // \u9ed8\u8ba4\u89c6\u9891\u5e27\u5bbd\u5ea6\n    private static int mOptVideoHeight = 1080;\n    private Uri outputMediaFileUri;\n    private String outputMediaFileType;\n\n\n    public CameraPreview(Context context) {\n        super(context);\n        mHolder = getHolder();\n        mHolder.addCallback(this);\n    }\n\n    private static Camera getCameraInstance() {\n        Camera c = null;\n        try {\n            c = Camera.open();\n        } catch (Exception e) {\n            Log.d(TAG, \"camera is not available\");\n        }\n        return c;\n    }\n\n    @Override\n    public void surfaceCreated(SurfaceHolder holder) {\n        mCamera = getCameraInstance();\n        try {\n            mCamera.setPreviewDisplay(holder);\n            mCamera.startPreview();\n            getCameraOptimalVideoSize(); // \u627e\u5230\u6700\u5408\u9002\u7684\u5206\u8fa8\u7387\n        } catch (IOException e) {\n            Log.d(TAG, \"Error setting camera preview: \" + e.getMessage());\n        }\n    }\n\n    private void getCameraOptimalVideoSize() {\n        try {\n            Camera.Parameters parameters = mCamera.getParameters();\n            List&lt;Camera.Size&gt; mSupportedPreviewSizes = parameters.getSupportedPreviewSizes();\n            List&lt;Camera.Size&gt; mSupportedVideoSizes = parameters.getSupportedVideoSizes();\n            Camera.Size optimalSize = CameraHelper.getOptimalVideoSize(mSupportedVideoSizes,\n                    mSupportedPreviewSizes, getWidth(), getHeight());\n            mOptVideoWidth = optimalSize.width;\n            mOptVideoHeight = optimalSize.height;\n            Log.d(TAG, \"prepareVideoRecorder: optimalSize:\" + mOptVideoWidth + \", \" + mOptVideoHeight);\n        } catch (Exception e) {\n            Log.e(TAG, \"getCameraOptimalVideoSize: \", e);\n        }\n    }\n\n    @Override\n    public void surfaceDestroyed(SurfaceHolder holder) {\n        mHolder.removeCallback(this);\n        mCamera.setPreviewCallback(null);\n        mCamera.stopPreview();\n        mCamera.release();\n        mCamera = null;\n    }\n\n    @Override\n    public void surfaceChanged(SurfaceHolder holder, int format, int w, int h) {\n    }\n}\n</code></pre>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/Camera_record_video_and_output/#fragment","title":"\u5728Fragment\u4e2d\u663e\u793a\u6444\u50cf\u5934\u9884\u89c8","text":"<p>\u9884\u7f6e\u4e00\u4e2aFrameLayout\uff0c\u5b9e\u4f8b\u5316\u4e00\u4e2a<code>CameraPreview</code>\u6dfb\u52a0\u8fdb\u53bb <pre><code>/**\n * \u89c6\u9891\u5f55\u5236\u754c\u9762\n * Created by Rust on 2018/5/17.\n */\npublic class VideoRecordFragment extends Fragment {\n    private static final String TAG = \"rustAppVideoFrag\";\n\n    private Button mCaptureBtn;\n    private CameraPreview mCameraPreview;\n\n    public static VideoRecordFragment newInstance() {\n        return new VideoRecordFragment();\n    }\n\n    @Override\n    public void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        Log.d(TAG, \"frag onCreate\");\n    }\n\n    @Nullable\n    @Override\n    public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {\n        Log.d(TAG, \"frag onCreateView\");\n        return inflater.inflate(R.layout.frag_video_record, container, false);\n    }\n\n    @Override\n    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\n        Log.d(TAG, \"frag onViewCreated\");\n        super.onViewCreated(view, savedInstanceState);\n        mCaptureBtn = view.findViewById(R.id.capture_btn);\n        //mCaptureBtn.setOnClickListener(mOnClickListener);// \u5f55\u5236\u952e\n\n        mCameraPreview = new CameraPreview(getContext());\n        FrameLayout preview = view.findViewById(R.id.camera_preview);\n        preview.addView(mCameraPreview);\n    }\n}\n</code></pre></p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/Camera_record_video_and_output/#mediarecorder","title":"\u4f7f\u7528<code>MediaRecorder</code>\u5f55\u5236","text":"<p>\u7ed9<code>MediaRecorder</code>\u6307\u5b9a\u53c2\u6570\u540e\uff0c\u8c03\u7528<code>start()</code>\u5f00\u59cb\u5f55\u5236\uff0c<code>stop()</code>\u7ed3\u675f\u5f55\u5236</p> <p>\u5f55\u5236\u5f00\u59cb\u524d\uff0c\u83b7\u53d6camera\uff0c<code>mCamera.unlock()</code>\u89e3\u9501\uff1b\u5f55\u5236\u5b8c\u6bd5\u540e\uff0c\u6e05\u9664<code>MediaRecorder</code>\uff0c<code>mCamera.lock()</code></p> <pre><code>private MediaRecorder mMediaRecorder;\n\n\n    public boolean startRecording() {\n        if (prepareVideoRecorder()) {\n            mMediaRecorder.start();\n            return true;\n        } else {\n            releaseMediaRecorder();\n        }\n        return false;\n    }\n\n    public void stopRecording() {\n        if (mMediaRecorder != null) {\n            mMediaRecorder.stop();\n        }\n        releaseMediaRecorder();\n    }\n\n    public boolean isRecording() {\n        return mMediaRecorder != null;\n    }\n\n    private boolean prepareVideoRecorder() {\n        if (null == mCamera) {\n            mCamera = getCameraInstance();\n        }\n        mMediaRecorder = new MediaRecorder();\n\n        mCamera.unlock();\n        mMediaRecorder.setCamera(mCamera);\n\n        mMediaRecorder.setAudioSource(MediaRecorder.AudioSource.DEFAULT);\n        mMediaRecorder.setVideoSource(MediaRecorder.VideoSource.CAMERA);\n\n        mMediaRecorder.setProfile(CamcorderProfile.get(CamcorderProfile.QUALITY_HIGH));\n\n        mMediaRecorder.setVideoSize(mOptVideoWidth, mOptVideoHeight);\n        mMediaRecorder.setOutputFile(getOutputMediaFile(MEDIA_TYPE_VIDEO).toString());\n        mMediaRecorder.setPreviewDisplay(mHolder.getSurface());\n\n        try {\n            mMediaRecorder.prepare();\n        } catch (IllegalStateException e) {\n            Log.d(TAG, \"IllegalStateException preparing MediaRecorder: \" + e.getMessage());\n            releaseMediaRecorder();\n            return false;\n        } catch (IOException e) {\n            Log.d(TAG, \"IOException preparing MediaRecorder: \" + e.getMessage());\n            releaseMediaRecorder();\n            return false;\n        }\n        return true;\n    }\n\n    private void releaseMediaRecorder() {\n        if (mMediaRecorder != null) {\n            mMediaRecorder.reset();\n            mMediaRecorder.release();\n            mMediaRecorder = null;\n            mCamera.lock();\n        }\n    }\n\n    private File getOutputMediaFile(int type) {\n        File mediaStorageDir = new File(Environment.getExternalStoragePublicDirectory(\n                Environment.DIRECTORY_PICTURES), TAG);\n        if (!mediaStorageDir.exists()) {\n            if (!mediaStorageDir.mkdirs()) {\n                Log.d(TAG, \"failed to create directory\");\n                return null;\n            }\n        }\n        String timeStamp = new SimpleDateFormat(\"yyyyMMdd_HHmmss\", Locale.CHINA).format(new Date());\n        File mediaFile;\n        if (type == MEDIA_TYPE_IMAGE) {\n            mediaFile = new File(mediaStorageDir.getPath() + File.separator +\n                    \"IMG_\" + timeStamp + \".jpg\");\n            outputMediaFileType = \"image/*\";\n        } else if (type == MEDIA_TYPE_VIDEO) {\n            mediaFile = new File(mediaStorageDir.getPath() + File.separator +\n                    \"VID_\" + timeStamp + \".mp4\");\n            outputMediaFileType = \"video/*\";\n        } else {\n            return null;\n        }\n        outputMediaFileUri = Uri.fromFile(mediaFile);\n        return mediaFile;\n    }\n</code></pre>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/Camera_record_video_and_output/#_4","title":"\u540e\u53f0\u8fd4\u56de\u65f6\u9884\u89c8\u9ed1\u5c4f\u7684\u95ee\u9898","text":"<p><code>CameraPreview</code>\u662f\u6211\u4eec\u5728Fragment\u521b\u5efa\u65f6\u5b9e\u4f8b\u5316\u5e76\u6dfb\u52a0\u8fdb\u53bb\u7684\u3002 \u5e94\u7528\u9000\u5230\u540e\u53f0\u540e\uff0c<code>CameraPreview</code>\u5df2\u7ecf\u88ab\u9500\u6bc1\u3002\u5e94\u7528\u56de\u5230\u524d\u53f0\u65f6\uff0c\u6211\u4eec\u5e94\u8be5\u5728<code>onResume</code>\u65b9\u6cd5\u4e2d\u8fdb\u884c\u64cd\u4f5c\u3002\u6062\u590d<code>CameraPreview</code>\u3002</p> <p>\u5728Fragment\u4e2d\uff0c\u5224\u65ad\u9500\u6bc1\u548c\u91cd\u5efa\u9884\u89c8\u7684\u65f6\u673a\u3002 <pre><code>    @Override\n    public void onPause() {\n        super.onPause();\n        Log.d(TAG, \"onPause: \u9500\u6bc1\u9884\u89c8\");\n        mCameraPreview = null;\n    }\n\n    @Override\n    public void onResume() {\n        super.onResume();\n        Log.d(TAG, \"onResume: \u56de\u5230\u524d\u53f0\");\n        if (null == mCameraPreview) {\n            initCameraPreview();\n        }\n    }\n\n    private void initCameraPreview() {\n        mCameraPreview = new CameraPreview(getContext());\n        FrameLayout preview = mRoot.findViewById(R.id.camera_preview);\n        preview.addView(mCameraPreview);\n    }\n</code></pre></p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/Camera_record_video_and_output/#_5","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>Android\u76f8\u673a\u5f00\u53d1(\u4e09): \u5b9e\u73b0\u62cd\u7167\u5f55\u50cf\u548c\u67e5\u770b</li> <li>googlesamples/android-MediaRecorder</li> <li>Controlling the Camera - Android Developer</li> <li>Camera API - Android Developer</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u7b80\u4e66</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaCodec_use_demo/","title":"Android MediaCodec \u7f16\u89e3\u7801\u4f7f\u7528\u65b9\u5f0f","text":"\u66f4\u65b0\u65e5\u671f 2022-6-10 <ul> <li>2022-6-10 \u62d3\u5c55\u9605\u8bfb</li> <li>2021-9-1 \u4fee\u6539\u683c\u5f0f</li> <li>2018-12-14 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4f7f\u7528MediaCodec\u8fdb\u884c\u7f16\u89e3\u7801\u3002\u8f93\u5165H.264\u683c\u5f0f\u7684\u6570\u636e\uff0c\u8f93\u51fa\u5e27\u6570\u636e\u5e76\u53d1\u9001\u7ed9\u76d1\u542c\u5668\u3002  </p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u7b80\u79f0MediaCodec\u4e3acodec</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaCodec_use_demo/#h264","title":"H.264\u7684\u914d\u7f6e","text":"<p>\u521b\u5efa\u5e76\u914d\u7f6ecodec\u3002\u914d\u7f6ecodec\u65f6\uff0c\u82e5\u624b\u52a8\u521b\u5efaMediaFormat\u5bf9\u8c61\u7684\u8bdd\uff0c\u4e00\u5b9a\u8981\u8bb0\u5f97\u8bbe\u7f6e\"csd-0\"\u548c\"csd-1\"\u8fd9\u4e24\u4e2a\u53c2\u6570\u3002 \"csd-0\"\u548c\"csd-1\"\u8fd9\u4e24\u4e2a\u53c2\u6570\u4e00\u5b9a\u8981\u548c\u63a5\u6536\u5230\u7684\u5e27\u5bf9\u5e94\u4e0a\u3002  </p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaCodec_use_demo/#_1","title":"\u8f93\u5165\u6570\u636e","text":"<p>\u7ed9codec\u8f93\u5165\u6570\u636e\u65f6\uff0c\u5982\u679c\u5bf9\u8f93\u5165\u6570\u636e\u8fdb\u884c\u6392\u961f\uff0c\u9700\u8981\u68c0\u67e5\u6392\u961f\u961f\u5217\u7684\u60c5\u51b5\u3002</p> <p>\u4f8b\u5982\u4e00\u5e27\u6570\u636e\u6682\u75281M\u5185\u5b58\uff0c1\u79d230\u5e27\uff0c\u6392\u961f\u961f\u5217\u6709\u53ef\u80fd\u4f1a\u6682\u752830M\u7684\u5185\u5b58\u3002\u5f53\u5185\u5b58\u6682\u7528\u8fc7\u9ad8\uff0c\u6211\u4eec\u9700\u8981\u91c7\u53d6\u4e00\u5b9a\u7684\u63aa\u65bd\u6765\u51cf\u5c0f\u5185\u5b58\u5360\u7528\u3002 codec\u786c\u89e3\u7801\u65f6\u4f1a\u53d7\u5230\u624b\u673a\u786c\u4ef6\u7684\u5f71\u54cd\u3002\u82e5\u624b\u673a\u6027\u80fd\u4e0d\u4f73\uff0c\u7f16\u89e3\u7801\u7684\u901f\u5ea6\u6709\u53ef\u80fd\u6162\u4e8e\u539f\u59cb\u6570\u636e\u8f93\u5165\u3002\u4e0d\u5f97\u5df2\u7684\u60c5\u51b5\u6211\u4eec\u53ef\u4ee5\u5c06\u6392\u961f\u4e2d\u7684\u65e7\u6570\u636e\u629b\u5f03\uff0c\u8f93\u5165\u65b0\u6570\u636e\u3002</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaCodec_use_demo/#_2","title":"\u89e3\u7801\u5668\u6027\u80fd","text":"<p>\u5bf9\u89c6\u9891\u5b9e\u65f6\u6027\u8981\u6c42\u9ad8\u7684\u573a\u666f\uff0ccodec\u6ca1\u6709\u53ef\u7528\u7684\u8f93\u5165\u7f13\u51b2\u533a\uff0c<code>mCodec.dequeueInputBuffer</code>\u8fd4\u56de-1\u3002 \u4e3a\u4e86\u5b9e\u65f6\u6027\uff0c\u8fd9\u91cc\u4f1a\u5f3a\u5236\u91ca\u653e\u6389\u8f93\u5165\u8f93\u51fa\u7f13\u51b2\u533a<code>mCodec.flush()</code>\u3002  </p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaCodec_use_demo/#_3","title":"\u95ee\u9898\u4e0e\u5f02\u5e38","text":"","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaCodec_use_demo/#mediacodec","title":"MediaCodec\u8f93\u5165\u6570\u636e\u548c\u8f93\u51fa\u6570\u636e\u6570\u91cf\u4e4b\u95f4\u6709\u6ca1\u6709\u7279\u5b9a\u7684\u5173\u7cfb","text":"<p>\u5bf9\u4e8eMediaCodec\uff0c\u8f93\u5165\u6570\u636e\u548c\u8f93\u51fa\u6570\u636e\u6570\u91cf\u4e4b\u95f4\u6709\u6ca1\u6709\u7279\u5b9a\u7684\u5173\u7cfb\uff1f\u5047\u8bbe\u8f93\u516510\u5e27\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u5f97\u5230\u591a\u5c11\u6b21\u8f93\u51fa\uff1f</p> <p>\u5b9e\u6d4b\u53d1\u73b0\uff0c\u4e0d\u80fd\u767e\u5206\u767e\u4fdd\u8bc1\u8f93\u5165\u8f93\u51fa\u6b21\u6570\u662f\u76f8\u7b49\u7684\u3002\u4f8b\u5982vivo x6 plus\uff0c\u8f93\u516530\u5e27\uff0c\u80fd\u5f97\u523028\u5e27\u7ed3\u679c\u3002\u6216\u8005300\u6b21\u8f93\u5165\uff0c\u5f97\u5230298\u6b21\u8f93\u51fa\u3002</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaCodec_use_demo/#dequeueinputbuffer0-1","title":"<code>dequeueInputBuffer(0)</code>\u4e00\u76f4\u8fd4\u56de-1","text":"<p>\u67d0\u4e9b\u624b\u673a\u957f\u65f6\u95f4\u7f16\u89e3\u7801\u540e\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u5c1d\u8bd5\u83b7\u53d6codec\u8f93\u5165\u7f13\u51b2\u533a\u65f6\u4e0b\u6807\u4e00\u76f4\u8fd4\u56de-1\u3002 \u4f8b\u5982vivo x6 plus\uff0c\u8fd0\u884c\u7ea620\u5206\u949f\u540e\uff0c<code>mCodec.dequeueInputBuffer(0)</code>\u4e00\u76f4\u8fd4\u56de-1\u3002</p> <p>\u5904\u7406\u65b9\u6cd5\uff1a\u5982\u679c\u4e00\u76f4\u8fd4\u56de-1\uff0c\u540c\u6b65\u65b9\u5f0f\u4e0b\u5c1d\u8bd5\u8c03\u7528<code>codec.flush()</code>\u65b9\u6cd5\uff0c\u5f02\u6b65\u65b9\u5f0f\u4e0b\u5c1d\u8bd5<code>codec.flush()</code>\u540e\u518d\u8c03\u7528<code>codec.start()</code>\u65b9\u6cd5\u3002</p> <p>\u6709\u4e00\u4e9b\u624b\u673a\u89e3\u7801\u901f\u5ea6\u592a\u6162\uff0c\u6709\u53ef\u80fd\u4f1a\u7ecf\u5e38\u8fd4\u56de-1\u3002\u4e0d\u8981\u9891\u7e41\u8c03\u7528<code>codec.flush()</code>\uff0c\u4ee5\u514d\u663e\u793a\u4e0d\u6b63\u5e38\u3002</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaCodec_use_demo/#-","title":"\u4ee3\u7801\u793a\u4f8b - \u540c\u6b65\u65b9\u5f0f\u8fdb\u884c\u7f16\u89e3\u7801","text":"<p>\u8fd9\u4e00\u4e2a\u4f8b\u5b50\u4f7f\u7528\u540c\u6b65\u65b9\u5f0f\u8fdb\u884c\u7f16\u89e3\u7801</p> \u4f7f\u7528\u540c\u6b65\u65b9\u5f0f <pre><code>/**\n* \u89e3\u7801\u5668\n*/\npublic class CodecDecoder {\n    private static final String TAG = \"CodecDecoder\";\n\n    private static final String MIME_TYPE = \"video/avc\";\n    private static final String CSD0 = \"csd-0\";\n    private static final String CSD1 = \"csd-1\";\n\n    private static final int TIME_INTERNAL = 1;\n    private static final int DECODER_TIME_INTERNAL = 1;\n\n    private MediaCodec mCodec;\n    private long mCount = 0; // \u5a92\u4f53\u89e3\u7801\u5668MediaCodec\u7528\u7684\n\n    // \u9001\u5165\u7f16\u89e3\u7801\u5668\u524d\u7684\u7f13\u51b2\u961f\u5217\n    // \u9700\u8981\u5b9e\u65f6\u76d1\u63a7\u8fd9\u4e2a\u961f\u5217\u6240\u6682\u7528\u7684\u5185\u5b58\u60c5\u51b5  \u5728\u8fd9\u91cc\u5835\u585e\u7684\u8bdd\u5f88\u5bb9\u6613\u5f15\u8d77OOM\n    private Queue&lt;byte[]&gt; data = null;\n\n    private DecoderThread decoderThread;\n    private CodecListener listener; // \u81ea\u5b9a\u4e49\u7684\u76d1\u542c\u5668  \u5f53\u89e3\u7801\u5f97\u5230\u5e27\u6570\u636e\u65f6\u901a\u8fc7\u5b83\u53d1\u9001\u51fa\u53bb\n\n    public CodecDecoder() {\n        data = new ConcurrentLinkedQueue&lt;&gt;();\n    }\n\n    public boolean isCodecCreated() {\n        return mCodec!=null;\n    }\n\n    public boolean createCodec(CodecListener listener, byte[] spsBuffer, byte[] ppsBuffer, int width, int height) {\n        this.listener = listener;\n        try {\n            mCodec = MediaCodec.createDecoderByType(Constants.MIME_TYPE);\n            MediaFormat mediaFormat = createVideoFormat(spsBuffer, ppsBuffer, width, height);\n            mCodec.configure(mediaFormat, null, null, 0);\n            mCodec.start();\n\n            Log.d(TAG, \"decoderThread mediaFormat in:\" + mediaFormat);\n\n            decoderThread = new DecoderThread();\n            decoderThread.start();\n\n            return true;\n        }\n        catch (Exception e) {\n            e.printStackTrace();\n            Log.e(TAG, \"MediaCodec create error:\" + e.getMessage());\n\n            return false;\n        }\n    }\n\n    private MediaFormat createVideoFormat(byte[] spsBuffer, byte[] ppsBuffer, int width, int height) {\n        MediaFormat mediaFormat;\n        mediaFormat = MediaFormat.createVideoFormat(MIME_TYPE, width, height);\n        mediaFormat.setByteBuffer(CSD0, ByteBuffer.wrap(spsBuffer));\n        mediaFormat.setByteBuffer(CSD1, ByteBuffer.wrap(ppsBuffer));\n        mediaFormat.setInteger(MediaFormat.KEY_COLOR_FORMAT,\n                MediaCodecInfo.CodecCapabilities.COLOR_FormatYUV420Flexible);\n\n        return mediaFormat;\n    }\n\n    private long lastInQueueTime = 0;\n\n    // \u8f93\u5165H.264\u5e27\u6570\u636e  \u8fd9\u91cc\u4f1a\u76d1\u63a7\u6392\u961f\u60c5\u51b5\n    public void addData(byte[] dataBuffer) {\n        final long timeDiff = System.currentTimeMillis() - lastInQueueTime;\n        if (timeDiff &gt; 1) {\n            lastInQueueTime = System.currentTimeMillis();\n            int queueSize = data.size(); // ConcurrentLinkedQueue\u67e5\u8be2\u957f\u5ea6\u65f6\u4f1a\u904d\u5386\u4e00\u6b21 \u5728\u6570\u636e\u91cf\u5de8\u5927\u7684\u60c5\u51b5\u4e0b\u5c3d\u91cf\u5c11\u7528\u8fd9\u4e2a\u65b9\u6cd5\n            if (queueSize &gt; 30) {\n                data.clear();\n                LogInFile.getLogger().e(\"frame queue \u5e27\u6570\u636e\u961f\u5217\u8d85\u51fa\u4e0a\u9650\uff0c\u81ea\u52a8\u6e05\u9664\u6570\u636e \" + queueSize);\n            }\n            data.add(dataBuffer.clone());\n            Log.e(TAG, \"frame queue \u6dfb\u52a0\u4e00\u5e27\u6570\u636e\");\n        } else {\n            LogInFile.getLogger().e(\"frame queue \u6dfb\u52a0\u901f\u5ea6\u592a\u5feb,\u8df3\u8fc7\u6b64\u5e27. timeDiff=\" + timeDiff);\n        }\n    }\n\n    public void destroyCodec() {\n        if (mCodec != null) {\n            try {\n                mCount = 0;\n\n                if(data!=null) {\n                    data.clear();\n                    data = null;\n                }\n\n                if(decoderThread!=null) {\n                    decoderThread.stopThread();\n                    decoderThread = null;\n                }\n\n                mCodec.release();\n                mCodec = null;\n            }\n            catch (Exception e) {\n                e.printStackTrace();\n                Log.d(TAG, \"destroyCodec exception:\" + e.toString());\n            }\n        }\n    }\n\n    private class DecoderThread extends Thread {\n        private final int INPUT_BUFFER_FULL_COUNT_MAX = 50;\n        private boolean isRunning;\n        private int inputBufferFullCount = 0; // \u8f93\u5165\u7f13\u51b2\u533a\u6ee1\u4e86\u591a\u5c11\u6b21\n\n        public void stopThread() {\n            isRunning = false;\n        }\n\n        @Override\n        public void run() {\n            setName(\"CodecDecoder_DecoderThread-\" + getId());\n            isRunning = true;\n            while (isRunning) {\n                try {\n                    if (data != null &amp;&amp; !data.isEmpty()) {\n                        int inputBufferIndex = mCodec.dequeueInputBuffer(0);\n                        if (inputBufferIndex &gt;= 0) {\n                            byte[] buf = data.poll();\n                            ByteBuffer inputBuffer = mCodec.getInputBuffer(inputBufferIndex);\n                            if (null != inputBuffer) {\n                                inputBuffer.clear();\n                                inputBuffer.put(buf, 0, buf.length);\n                                mCodec.queueInputBuffer(inputBufferIndex, 0,\n                                        buf.length, mCount * TIME_INTERNAL, 0);\n                                mCount++;\n                            }\n                            inputBufferFullCount = 0; // \u8fd8\u6709\u7f13\u51b2\u533a\u53ef\u4ee5\u7528\u7684\u65f6\u5019\u91cd\u7f6e\u8ba1\u6570\n                        } else {\n                            inputBufferFullCount++;\n                            LogInFile.getLogger().e(TAG, \"decoderThread inputBuffer full.  inputBufferFullCount=\" + inputBufferFullCount);\n                            if (inputBufferFullCount &gt; INPUT_BUFFER_FULL_COUNT_MAX) {\n                                mCount = 0;\n                                mCodec.flush(); // \u5728\u8fd9\u91cc\u6e05\u9664\u6240\u6709\u7f13\u51b2\u533a\n                                LogInFile.getLogger().e(TAG, \"mCodec.flush()...\");\n                            }\n                        }\n                    }\n\n                    // Get output buffer index\n                    MediaCodec.BufferInfo bufferInfo = new MediaCodec.BufferInfo();\n                    int outputBufferIndex = mCodec.dequeueOutputBuffer(bufferInfo, 0);\n                    while (outputBufferIndex &gt;= 0) {\n                        final int index = outputBufferIndex;\n                        Log.d(TAG, \"releaseOutputBuffer \" + Thread.currentThread().toString());\n                        final ByteBuffer outputBuffer = byteBufferClone(mCodec.getOutputBuffer(index));\n                        Image image = mCodec.getOutputImage(index);\n                        if (null != image) {\n                            // \u83b7\u53d6NV21\u683c\u5f0f\u7684\u6570\u636e\n                            final byte[] nv21 = ImageUtil.getDataFromImage(image, FaceDetectUtil.COLOR_FormatNV21);\n                            final int imageWid = image.getWidth();\n                            final int imageHei = image.getHeight();\n                            // \u8fd9\u91cc\u9009\u62e9\u521b\u5efa\u65b0\u7684\u7ebf\u7a0b\u53bb\u53d1\u9001\u6570\u636e - \u8fd9\u662f\u53ef\u4f18\u5316\u7684\u5730\u65b9\n                            new Thread(new Runnable() {\n                                @Override\n                                public void run() {\n                                    listener.onDataDecoded(outputBuffer,\n                                            mCodec.getOutputFormat().getInteger(MediaFormat.KEY_COLOR_FORMAT),\n                                            nv21, imageWid, imageHei);\n                                }\n                            }).start();\n                        } else {\n                            listener.onDataDecoded(outputBuffer,\n                                    mCodec.getOutputFormat().getInteger(MediaFormat.KEY_COLOR_FORMAT),\n                                    new byte[]{0}, 0, 0);\n                        }\n\n                        try {\n                            mCodec.releaseOutputBuffer(index, false);\n                        } catch (IllegalStateException ex) {\n                            android.util.Log.e(TAG, \"releaseOutputBuffer ERROR\", ex);\n                        }\n                        outputBufferIndex = mCodec.dequeueOutputBuffer(bufferInfo, 0);\n                    }\n                }\n                catch (Exception e) {\n                    e.printStackTrace();\n                    Log.e(TAG, \"decoderThread exception:\" + e.getMessage());\n                }\n\n                try {\n                    Thread.sleep(DECODER_TIME_INTERNAL);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n\n    // deep clone byteBuffer\n    private static ByteBuffer byteBufferClone(ByteBuffer buffer) {\n        if (buffer.remaining() == 0)\n            return ByteBuffer.wrap(new byte[]{0});\n\n        ByteBuffer clone = ByteBuffer.allocate(buffer.remaining());\n\n        if (buffer.hasArray()) {\n            System.arraycopy(buffer.array(), buffer.arrayOffset() + buffer.position(), clone.array(), 0, buffer.remaining());\n        } else {\n            clone.put(buffer.duplicate());\n            clone.flip();\n        }\n\n        return clone;\n    }\n}\n</code></pre>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaCodec_use_demo/#-_1","title":"\u4ee3\u7801\u793a\u4f8b - \u5de5\u5177\u51fd\u6570","text":"<p>\u4e00\u4e9b\u5de5\u5177\u51fd\u6570\u3002\u6bd4\u5982\u4eceimage\u4e2d\u53d6\u51faNV21\u683c\u5f0f\u7684\u6570\u636e\u3002</p> \u5de5\u5177\u51fd\u6570 <pre><code>    private byte[] getDataFromImage(Image image) {\n        return getDataFromImage(image, COLOR_FormatNV21);\n    }\n\n    /**\n    * \u5c06Image\u6839\u636ecolorFormat\u7c7b\u578b\u7684byte\u6570\u636e\n    */\n    private byte[] getDataFromImage(Image image, int colorFormat) {\n        if (colorFormat != COLOR_FormatI420 &amp;&amp; colorFormat != COLOR_FormatNV21) {\n            throw new IllegalArgumentException(\"only support COLOR_FormatI420 \" + \"and COLOR_FormatNV21\");\n        }\n        if (!isImageFormatSupported(image)) {\n            throw new RuntimeException(\"can't convert Image to byte array, format \" + image.getFormat());\n        }\n        Rect crop = image.getCropRect();\n        int format = image.getFormat();\n        int width = crop.width();\n        int height = crop.height();\n        Image.Plane[] planes = image.getPlanes();\n        byte[] data = new byte[width * height * ImageFormat.getBitsPerPixel(format) / 8];\n        byte[] rowData = new byte[planes[0].getRowStride()];\n        int channelOffset = 0;\n        int outputStride = 1;\n        for (int i = 0; i &lt; planes.length; i++) {\n            switch (i) {\n                case 0:\n                    channelOffset = 0;\n                    outputStride = 1;\n                    break;\n                case 1:\n                    if (colorFormat == COLOR_FormatI420) {\n                        channelOffset = width * height;\n                        outputStride = 1;\n                    } else if (colorFormat == COLOR_FormatNV21) {\n                        channelOffset = width * height + 1;\n                        outputStride = 2;\n                    }\n                    break;\n                case 2:\n                    if (colorFormat == COLOR_FormatI420) {\n                        channelOffset = (int) (width * height * 1.25);\n                        outputStride = 1;\n                    } else if (colorFormat == COLOR_FormatNV21) {\n                        channelOffset = width * height;\n                        outputStride = 2;\n                    }\n                    break;\n            }\n            ByteBuffer buffer = planes[i].getBuffer();\n            int rowStride = planes[i].getRowStride();\n            int pixelStride = planes[i].getPixelStride();\n\n            int shift = (i == 0) ? 0 : 1;\n            int w = width &gt;&gt; shift;\n            int h = height &gt;&gt; shift;\n            buffer.position(rowStride * (crop.top &gt;&gt; shift) + pixelStride * (crop.left &gt;&gt; shift));\n            for (int row = 0; row &lt; h; row++) {\n                int length;\n                if (pixelStride == 1 &amp;&amp; outputStride == 1) {\n                    length = w;\n                    buffer.get(data, channelOffset, length);\n                    channelOffset += length;\n                } else {\n                    length = (w - 1) * pixelStride + 1;\n                    buffer.get(rowData, 0, length);\n                    for (int col = 0; col &lt; w; col++) {\n                        data[channelOffset] = rowData[col * pixelStride];\n                        channelOffset += outputStride;\n                    }\n                }\n                if (row &lt; h - 1) {\n                    buffer.position(buffer.position() + rowStride - length);\n                }\n            }\n        }\n        return data;\n    }\n\n    /**\n    * \u662f\u5426\u662f\u652f\u6301\u7684\u6570\u636e\u7c7b\u578b\n    */\n    private static boolean isImageFormatSupported(Image image) {\n        int format = image.getFormat();\n        switch (format) {\n            case ImageFormat.YUV_420_888:\n            case ImageFormat.NV21:\n            case ImageFormat.YV12:\n                return true;\n        }\n        return false;\n    }\n</code></pre> <p>\"csd-0\"\u548c\"csd-1\"\u662f\u4ec0\u4e48\uff0c\u5bf9\u4e8eH264\u89c6\u9891\u7684\u8bdd\uff0c\u5b83\u5bf9\u5e94\u7684\u662fsps\u548cpps\uff0c\u5bf9\u4e8eAAC\u97f3\u9891\u7684\u8bdd\uff0c\u5bf9\u5e94\u7684\u662fADTS\uff0c\u505a\u97f3\u89c6\u9891\u5f00\u53d1\u7684\u4eba\u5e94\u8be5\u90fd\u77e5\u9053\uff0c\u5b83\u4e00\u822c\u5b58\u5728\u4e8e\u7f16\u7801\u5668\u751f\u6210\u7684IDR\u5e27\u4e4b\u4e2d\u3002</p> <p>\u5f97\u5230\u7684mediaFormat <pre><code>rustfisher: mediaFormat in:{height=720, width=1280, csd-1=java.nio.ByteArrayBuffer[position=0,limit=7,capacity=7], mime=video/avc, csd-0=java.nio.ByteArrayBuffer[position=0,limit=13,capacity=13], color-format=2135033992}\n</code></pre></p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaCodec_use_demo/#_4","title":"\u5b58\u50a8\u56fe\u7247\u7684\u65b9\u6cd5","text":"<p>Image\u7c7b\u5728Android API21\u53ca\u4ee5\u540e\u529f\u80fd\u5341\u5206\u5f3a\u5927\u3002</p> \u4f7f\u7528Image\u7c7b\u5b58\u50a8\u56fe\u7247 <pre><code>    private static void dumpFile(String fileName, byte[] data) {\n        FileOutputStream outStream;\n        try {\n            outStream = new FileOutputStream(fileName);\n        } catch (IOException ioe) {\n            throw new RuntimeException(\"rustfisher: Unable to create output file \" + fileName, ioe);\n        }\n        try {\n            outStream.write(data);\n            outStream.close();\n        } catch (IOException ioe) {\n            throw new RuntimeException(\"rustfisher: failed writing data to file \" + fileName, ioe);\n        }\n    }\n\n    private void compressToJpeg(String fileName, Image image) {\n        FileOutputStream outStream;\n        try {\n            outStream = new FileOutputStream(fileName);\n        } catch (IOException ioe) {\n            throw new RuntimeException(\"rustfisher: Unable to create output file \" + fileName, ioe);\n        }\n        Rect rect = image.getCropRect();\n        YuvImage yuvImage = new YuvImage(getDataFromImage(image, COLOR_FormatNV21), ImageFormat.NV21, rect.width(), rect.height(), null);\n        yuvImage.compressToJpeg(rect, 100, outStream);\n    }\n</code></pre>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaCodec_use_demo/#nv21bitmap","title":"NV21\u8f6cbitmap\u7684\u65b9\u6cd5","text":"<p>\u76f4\u63a5\u5b58\u5165\u6587\u4ef6</p> nv21\u5b58\u4e3ajpg\u6587\u4ef6 <pre><code>// in try catch\nFileOutputStream fos = new FileOutputStream(Environment.getExternalStorageDirectory() + \"/rustfisher.jpg\");\nYuvImage yuvImage = new YuvImage(nv21bytearray, ImageFormat.NV21, width, height, null);\nyuvImage.compressToJpeg(new Rect(0, 0, width, height), 100, fos);\nfos.close();\n</code></pre> <p>\u83b7\u5f97Bitmap\u5bf9\u8c61\u7684\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u8017\u65f6\u8017\u5185\u5b58  </p> NV21 -&gt; yuvImage -&gt; jpeg -&gt; bitmap <pre><code>// in try catch\nYuvImage yuvImage = new YuvImage(nv21bytearray, ImageFormat.NV21, width, height, null);\nByteArrayOutputStream os = new ByteArrayOutputStream();\nyuvImage.compressToJpeg(new Rect(0, 0, width, height), 100, os);\nbyte[] jpegByteArray = os.toByteArray();\nBitmap bitmap = BitmapFactory.decodeByteArray(jpegByteArray, 0, jpegByteArray.length);\nos.close();\n</code></pre> <p>\ud83d\udd0d \u53c2\u8003stackoverflow</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaCodec_use_demo/#codecyuv420outputbuffer","title":"codec\u9009\u62e9YUV420\u683c\u5f0f\u8f93\u51faOutputBuffer\u7684\u95ee\u9898","text":"<p>\u5047\u8bbecodec\u9009\u62e9\u7684\u683c\u5f0f\u662f<code>COLOR_FormatYUV420Flexible</code> <pre><code>mediaFormat.setInteger(MediaFormat.KEY_COLOR_FORMAT, MediaCodecInfo.CodecCapabilities.COLOR_FormatYUV420Flexible);\n</code></pre> \u89e3\u7801\u540e\uff0c\u5f97\u5230\u7684\u683c\u5f0f\u662f<code>COLOR_QCOM_FormatYUV420SemiPlanar32m // 0x7FA30C04</code> <pre><code>mCodec.getOutputFormat().getInteger(MediaFormat.KEY_COLOR_FORMAT)\n</code></pre> \u89e3\u7801\u51fa\u6765\u7684<code>ByteBuffer oBuffer = mCodec.getOutputBuffer(index);</code>\u5305\u542b\u5143\u7d20\u4e2a\u6570\u4e3a1413120\uff1b\u8bb0\u4e3a<code>nv21Codec</code> \u800c\u901a\u8fc7<code>mCodec.getOutputImage(index)</code>\u5f97\u5230\u7684image\u5bf9\u8c61\u83b7\u53d6\u5230\u7684nv21\u6570\u7ec4\u5143\u7d20\u4e2a\u6570\u4e3a1382400\uff1b\u8bb0\u4e3a<code>nv21</code>\uff0c\u8fd9\u4e9b\u662f\u6211\u4eec\u60f3\u8981\u7684\u6570\u636e</p> <p>\u5bf9\u6bd4\u8fd92\u4e2a\u6570\u7ec4\u6211\u4eec\u53d1\u73b0\uff0c\u524d\u9762\u7684y\u90e8\u5206\u662f\u76f8\u540c\u7684\u3002<code>nv21</code>\u524d921600\u4e2a\u5143\u7d20\u662fy\u6570\u636e\uff0c\u540e460800\u4e2a\u5143\u7d20\u662fuv\u6570\u636e\u3002 <code>nv21Codec</code>\u524d921600\u4e2a\u5143\u7d20\u662fy\u6570\u636e\uff0c\u4e4b\u540e\u768420480\u4e2a\u5b57\u8282\u90fd\u662f0\uff0c\u518d\u63a5\u4e0b\u6765\u7684460800\u4e2a\u5143\u7d20\u662fuv\u6570\u636e\u3002\u6700\u540e\u768410240\u4e2a\u5b57\u8282\u662f0</p> <p><code>nv21</code>\u548c<code>nv21Codec</code>\u7684uv\u90e8\u5206\u5b58\u50a8\u987a\u5e8f\u662f\u76f8\u53cd\u7684\u3002</p> <p>\u5173\u4e8eyuv\uff0c\u53ef\u4ee5\u67e5\u770bYUV\u683c\u5f0f\u7684\u4ecb\u7ecd\u3002</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaCodec_use_demo/#_5","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>Android: MediaCodec\u89c6\u9891\u6587\u4ef6\u786c\u4ef6\u89e3\u7801,\u9ad8\u6548\u7387\u5f97\u5230YUV\u683c\u5f0f\u5e27,\u5feb\u901f\u4fdd\u5b58JPEG\u56fe\u7247(\u4e0d\u4f7f\u7528OpenGL)(\u9644Demo)</li> <li>Android: Image\u7c7b\u6d45\u6790(\u7ed3\u5408YUV_420_888)</li> <li>Android MediaCodec stuff</li> <li>\u96f7\u9704\u9a85(leixiaohua1020)\u7684\u4e13\u680f</li> <li>[\u603b\u7ed3]FFMPEG\u89c6\u97f3\u9891\u7f16\u89e3\u7801\u96f6\u57fa\u7840\u5b66\u4e60\u65b9\u6cd5 | \u96f7\u9704\u9a85</li> <li>Bilibili/ijkplayer | Github</li> <li>Web video codec guide | MDN Web Docs</li> </ul>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaCodec_use_demo/#ipb","title":"I\u5e27\uff0cP\u5e27\uff0cB\u5e27","text":"<p>I \u5e27\uff1a\u5173\u952e\u5e27\u3002\u538b\u7f29\u7387\u4f4e\uff0c\u53ef\u4ee5\u5355\u72ec\u89e3\u7801\u6210\u4e00\u5e45\u5b8c\u6574\u7684\u56fe\u50cf\u3002</p> <p>P \u5e27\uff1a\u53c2\u8003\u5e27\u3002\u538b\u7f29\u7387\u8f83\u9ad8\uff0c\u89e3\u7801\u65f6\u4f9d\u8d56\u4e8e\u524d\u9762\u5df2\u89e3\u7801\u7684\u6570\u636e\u3002</p> <p>B \u5e27\uff1a\u524d\u540e\u53c2\u8003\u5e27\u3002\u538b\u7f29\u7387\u6700\u9ad8\uff0c\u89e3\u7801\u65f6\u4e0d\u5149\u4f9d\u8d56\u524d\u9762\u5df2\u7ecf\u89e3\u7801\u7684\u5e27\uff0c\u800c\u4e14\u8fd8\u4f9d\u8d56\u5b83\u540e\u9762\u7684 P \u5e27\u3002\u6362\u53e5\u8bdd\u8bf4\u5c31\u662f\uff0cB \u5e27\u540e\u9762\u7684 P \u5e27\u8981\u4f18\u5148\u4e8e\u5b83\u8fdb\u884c\u89e3\u7801\uff0c\u7136\u540e\u624d\u80fd\u5c06 B \u5e27\u89e3\u7801\u3002</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaMuxer_MediaExtractor_mp4/","title":"\u4f7f\u7528 MediaExtractor \u548c MediaMuxer \u89e3\u6790\u548c\u5c01\u88c5 mp4 \u6587\u4ef6","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-10-11 <ul> <li>2022-10-11 \u66f4\u65b0\u683c\u5f0f</li> </ul> <p>\u672c\u6587\u76ee\u7684\uff1a\u4f7f\u7528 MediaExtractor \u548c MediaMuxer \u89e3\u6790\u548c\u5c01\u88c5 mp4 \u6587\u4ef6</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaMuxer_MediaExtractor_mp4/#_1","title":"\u7b80\u4ecb","text":"<p>MP4\u6216\u79f0MPEG-4\u7b2c14\u90e8\u5206\uff08\u82f1\u8bed\uff1aMPEG-4 Part 14\uff09\u662f\u4e00\u79cd\u6807\u51c6\u7684\u6570\u5b57\u591a\u5a92\u4f53\u5bb9\u5668\u683c\u5f0f\u3002</p> <p>MP4\u4e2d\u7684\u97f3\u9891\u683c\u5f0f\u901a\u5e38\u4e3aAAC(audio/mp4a-latm)</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaMuxer_MediaExtractor_mp4/#mediaextractor","title":"MediaExtractor","text":"<p>MediaExtractor \u53ef\u7528\u4e8e\u5206\u79bb\u591a\u5a92\u4f53\u5bb9\u5668\u4e2d\u89c6\u9891track\u548c\u97f3\u9891track</p> <p><code>setDataSource()</code> \u8bbe\u7f6e\u6570\u636e\u6e90\uff0c\u6570\u636e\u6e90\u53ef\u4ee5\u662f\u672c\u5730\u6587\u4ef6\u5730\u5740\uff0c\u4e5f\u53ef\u4ee5\u662f\u7f51\u7edc\u5730\u5740</p> <p><code>getTrackFormat(int index)</code> \u6765\u83b7\u53d6\u5404\u4e2atrack\u7684<code>MediaFormat</code>\uff0c\u901a\u8fc7<code>MediaFormat</code>\u6765\u83b7\u53d6track\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5982\uff1aMimeType\u3001\u5206\u8fa8\u7387\u3001\u91c7\u6837\u9891\u7387\u3001\u5e27\u7387\u7b49\u7b49</p> <p><code>selectTrack(int index)</code> \u901a\u8fc7\u4e0b\u6807\u9009\u62e9\u6307\u5b9a\u7684\u901a\u9053</p> <p><code>readSampleData(ByteBuffer buffer, int offset)</code> \u83b7\u53d6\u5f53\u524d\u7f16\u7801\u597d\u7684\u6570\u636e\u5e76\u5b58\u5728\u6307\u5b9a\u597d\u504f\u79fb\u91cf\u7684buffer\u4e2d</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaMuxer_MediaExtractor_mp4/#mediamuxer","title":"MediaMuxer","text":"<p>MediaMuxer \u53ef\u7528\u4e8e\u6df7\u5408\u57fa\u672c\u7801\u6d41\u3002\u5c06\u6240\u6709\u7684\u4fe1\u9053\u7684\u4fe1\u606f\u5408\u6210\u4e00\u4e2a\u89c6\u9891\u3002 \u76ee\u524d\u8f93\u51fa\u683c\u5f0f\u652f\u6301MP4\uff0cWebm\uff0c3GP\u3002\u4eceAndroid Nougat\u5f00\u59cb\u652f\u6301\u5411MP4\u4e2d\u6df7\u5165B-frames\u3002</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaMuxer_MediaExtractor_mp4/#mp4","title":"\u63d0\u53d6\u5e76\u8f93\u51faMP4\u6587\u4ef6\u4e2d\u7684\u89c6\u9891\u90e8\u5206","text":"<p>\u4ece\u4e00\u4e2aMP4\u6587\u4ef6\u4e2d\u63d0\u53d6\u51fa\u89c6\u9891\uff0c\u5f97\u5230\u4e0d\u542b\u97f3\u9891\u7684MP4\u6587\u4ef6\u3002</p> <p>\u5b9e\u73b0\u6d41\u7a0b\uff0c\u9996\u5148\u662f\u4f7f\u7528<code>MediaExtractor</code>\u63d0\u53d6\uff0c\u7136\u540e\u4f7f\u7528<code>MediaMuxer</code>\u8f93\u51faMP4\u6587\u4ef6\u3002</p> <ul> <li><code>MediaExtractor</code>\u8bbe\u7f6e\u6570\u636e\u6e90\uff0c\u627e\u5230\u5e76\u9009\u62e9\u89c6\u9891\u8f68\u9053\u7684\u683c\u5f0f\u548c\u4e0b\u6807</li> <li><code>MediaMuxer</code>\u8bbe\u7f6e\u8f93\u51fa\u683c\u5f0f\u4e3a<code>MUXER_OUTPUT_MPEG_4</code>\uff0c\u6dfb\u52a0\u524d\u9762\u9009\u5b9a\u7684\u683c\u5f0f\uff0c\u8c03\u7528<code>start()</code>\u542f\u52a8</li> <li><code>MediaExtractor</code>\u8bfb\u53d6\u5e27\u6570\u636e\uff0c\u4e0d\u505c\u5730\u5c06\u5e27\u6570\u636e\u548c\u76f8\u5173\u4fe1\u606f\u4f20\u5165<code>MediaMuxer</code></li> <li>\u6700\u540e\u505c\u6b62\u5e76\u91ca\u653e<code>MediaMuxer</code>\u548c<code>MediaExtractor</code></li> </ul> <p>\u6700\u597d\u653e\u5728\u5b50\u7ebf\u7a0b\u4e2d\u64cd\u4f5c\u3002 <pre><code>    /**\n     * \u63d0\u53d6\u89c6\u9891\n     *\n     * @param sourceVideoPath \u539f\u59cb\u89c6\u9891\u6587\u4ef6\n     * @throws Exception \u51fa\u9519\n     */\n    public static void extractVideo(String sourceVideoPath, String outVideoPath) throws Exception {\n        MediaExtractor sourceMediaExtractor = new MediaExtractor();\n        sourceMediaExtractor.setDataSource(sourceVideoPath);\n        int numTracks = sourceMediaExtractor.getTrackCount();\n        int sourceVideoTrackIndex = -1; // \u539f\u59cb\u89c6\u9891\u6587\u4ef6\u89c6\u9891\u8f68\u9053\u53c2\u6570\n        for (int i = 0; i &lt; numTracks; ++i) {\n            MediaFormat format = sourceMediaExtractor.getTrackFormat(i);\n            String mime = format.getString(MediaFormat.KEY_MIME);\n            Log.d(TAG, \"MediaFormat: \" + mime);\n            if (mime.startsWith(\"video/\")) {\n                sourceMediaExtractor.selectTrack(i);\n                sourceVideoTrackIndex = i;\n                Log.d(TAG, \"selectTrack index=\" + i + \"; format: \" + mime);\n                break;\n            }\n        }\n\n        MediaMuxer outputMediaMuxer = new MediaMuxer(outVideoPath,\n                MediaMuxer.OutputFormat.MUXER_OUTPUT_MPEG_4);\n        outputMediaMuxer.addTrack(sourceMediaExtractor.getTrackFormat(sourceVideoTrackIndex));\n        outputMediaMuxer.start();\n\n        ByteBuffer inputBuffer = ByteBuffer.allocate(1024 * 1024 * 2); // \u5206\u914d\u7684\u5185\u5b58\u8981\u5c3d\u91cf\u5927\u4e00\u4e9b\n        MediaCodec.BufferInfo info = new MediaCodec.BufferInfo();\n        int sampleSize;\n        while ((sampleSize = sourceMediaExtractor.readSampleData(inputBuffer, 0)) &gt;= 0) {\n            long presentationTimeUs = sourceMediaExtractor.getSampleTime();\n            info.offset = 0;\n            info.size = sampleSize;\n            info.flags = MediaCodec.BUFFER_FLAG_SYNC_FRAME;\n            info.presentationTimeUs = presentationTimeUs;\n            outputMediaMuxer.writeSampleData(sourceVideoTrackIndex, inputBuffer, info);\n            sourceMediaExtractor.advance();\n        }\n\n        outputMediaMuxer.stop();\n        outputMediaMuxer.release();    // \u505c\u6b62\u5e76\u91ca\u653e MediaMuxer\n        sourceMediaExtractor.release();\n        sourceMediaExtractor = null;   // \u91ca\u653e MediaExtractor\n    }\n</code></pre> \u5982\u679c\u4e0a\u9762\u7684<code>ByteBuffer</code>\u5206\u914d\u7684\u7a7a\u95f4\u592a\u5c0f\uff0c<code>readSampleData(inputBuffer, 0)</code>\u53ef\u80fd\u4f1a\u51fa\u73b0<code>IllegalArgumentException</code>\u5f02\u5e38\u3002</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaMuxer_MediaExtractor_mp4/#mp4_1","title":"\u63d0\u53d6MP4\u6587\u4ef6\u4e2d\u7684\u97f3\u9891\u90e8\u5206\uff0c\u83b7\u53d6\u97f3\u9891\u6587\u4ef6","text":"","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaMuxer_MediaExtractor_mp4/#java-mp4-parseraac","title":"\u57fa\u4e8e<code>Java MP4 Parser</code>\u63d0\u53d6\u51faAAC\u6587\u4ef6\u7684\u65b9\u6cd5","text":"<p><code>Java MP4 Parser</code> - https://github.com/sannies/mp4parser Java\u5b9e\u73b0\u8bfb\u3001\u5199\u548c\u521b\u5efaMP4\u5bb9\u5668\u3002\u4f46\u662f\u548c\u7f16\u89e3\u7801\u97f3\u89c6\u9891\u6709\u533a\u522b\u3002\u8fd9\u91cc\u4e3b\u8981\u662f\u63d0\u53d6\u4e0e\u518d\u5408\u6210\u3002</p> <p>\u4e0b\u8f7d<code>isoparser-1.1.22.jar</code>\u5e76\u6dfb\u52a0\u8fdb\u5de5\u7a0b\u4e2d\uff1b\u5c1d\u8bd5\u8fc7gradle\u76f4\u63a5\u5bfc\u5165\uff0c\u4f46\u4e0d\u6210\u529f</p> <p>\u627e\u5230\u89c6\u9891\u6587\u4ef6\u4e2d\u6240\u6709\u7684\u97f3\u8f68\uff0c\u5c06\u5b83\u4eec\u63d0\u53d6\u51fa\u6765\u5199\u5165\u65b0\u7684\u6587\u4ef6\u4e2d <pre><code>    public void extractAudioFromMP4(String outAudioPath, String sourceMP4Path) throws IOException {\n        Movie movie = MovieCreator.build(sourceMP4Path);\n        List&lt;Track&gt; audioTracks = new ArrayList&lt;&gt;();\n        for (Track t : movie.getTracks()) {\n            if (t.getHandler().equals(\"soun\")) {\n                audioTracks.add(t);\n            }\n        }\n        Movie result = new Movie();\n        if (audioTracks.size() &gt; 0) {\n            result.addTrack(new AppendTrack(audioTracks.toArray(new Track[audioTracks.size()])));\n        }\n        Container out = new DefaultMp4Builder().build(result);\n        FileChannel fc = new RandomAccessFile(outAudioPath, \"rw\").getChannel();\n        out.writeContainer(fc);\n        fc.close();\n    }\n</code></pre> \u5728\u7ea2\u7c73\u624b\u673a\u4e0a\u6d4b\u8bd5\u6210\u529f\u3002\u4eceMP4\u6587\u4ef6\uff08\u65f6\u957f\u7ea62\u520620\u79d2\uff09\u4e2d\u63d0\u53d6\u51fa\u7684AAC\u6587\u4ef6\u53ef\u5728\u624b\u673a\u4e0a\u76f4\u63a5\u64ad\u653e\u3002</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaMuxer_MediaExtractor_mp4/#aacmp4","title":"\u5c06AAC\u97f3\u8f68\u6362\u5230\u53e6\u4e00\u4e2aMP4\u6587\u4ef6","text":"<p>MediaExtractor\u53ef\u4ee5\u76f4\u63a5\u4ece\u63d0\u53d6AAC\u6587\u4ef6\u6216MP4\u6587\u4ef6\u4e2d\u63d0\u53d6ACC\u97f3\u8f68\uff0cMediaMuxer\u6765\u5199\u5165\u65b0\u7684MP4\u6587\u4ef6\u3002</p> <p>\u63d0\u4f9b\u97f3\u9891\u7684\u6587\u4ef6\u53ef\u4ee5\u662fMP4\u6587\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u662fAAC\u6587\u4ef6\uff1b\u53e6\u4e00\u4e2a\u63d0\u4f9b\u89c6\u9891\uff0c\u6df7\u5408\u8f93\u51fa\u65b0\u7684MP4\u6587\u4ef6\u3002</p> <p>\u751f\u6210\u7684\u89c6\u9891\u7684\u957f\u5ea6\u7531\u63d0\u4f9b\u89c6\u9891\u7684\u6587\u4ef6\u51b3\u5b9a\u3002 <pre><code>    /**\n     * @param outputVideoFilePath \u8f93\u51fa\u89c6\u9891\u6587\u4ef6\u8def\u5f84\n     * @param videoProviderPath   \u63d0\u4f9b\u89c6\u9891\u7684MP4\u6587\u4ef6 \u65f6\u957f\u4ee5\u6b64\u4e3a\u51c6\n     * @param audioProviderPath   \u63d0\u4f9b\u97f3\u9891\u7684\u6587\u4ef6\n     * @throws Exception \u8fd0\u884c\u5f02\u5e38  \u4f8b\u5982\u8bfb\u5199\u6587\u4ef6\u5f02\u5e38\n     */\n    public static void replaceAudioForMP4File(String outputVideoFilePath, String videoProviderPath,\n                                              String audioProviderPath)\n            throws Exception {\n        MediaMuxer mediaMuxer = new MediaMuxer(outputVideoFilePath,\n                MediaMuxer.OutputFormat.MUXER_OUTPUT_MPEG_4);\n\n        // \u89c6\u9891 MediaExtractor\n        MediaExtractor mVideoExtractor = new MediaExtractor();\n        mVideoExtractor.setDataSource(videoProviderPath);\n        int videoTrackIndex = -1;\n        for (int i = 0; i &lt; mVideoExtractor.getTrackCount(); i++) {\n            MediaFormat format = mVideoExtractor.getTrackFormat(i);\n            if (format.getString(MediaFormat.KEY_MIME).startsWith(\"video/\")) {\n                mVideoExtractor.selectTrack(i);\n                videoTrackIndex = mediaMuxer.addTrack(format);\n                Log.d(TAG, \"Video: format:\" + format);\n                break;\n            }\n        }\n\n        // \u97f3\u9891 MediaExtractor\n        MediaExtractor audioExtractor = new MediaExtractor();\n        audioExtractor.setDataSource(audioProviderPath);\n        int audioTrackIndex = -1;\n        for (int i = 0; i &lt; audioExtractor.getTrackCount(); i++) {\n            MediaFormat format = audioExtractor.getTrackFormat(i);\n            if (format.getString(MediaFormat.KEY_MIME).startsWith(\"audio/\")) {\n                audioExtractor.selectTrack(i);\n                audioTrackIndex = mediaMuxer.addTrack(format);\n                Log.d(TAG, \"Audio: format:\" + format);\n                break;\n            }\n        }\n        mediaMuxer.start(); // \u6dfb\u52a0\u5b8c\u6240\u6709\u8f68\u9053\u540estart\n\n        long videoEndPreTimeUs = 0;\n        // \u5c01\u88c5\u89c6\u9891track\n        if (-1 != videoTrackIndex) {\n            MediaCodec.BufferInfo info = new MediaCodec.BufferInfo();\n            info.presentationTimeUs = 0;\n            ByteBuffer buffer = ByteBuffer.allocate(1024 * 1024);\n            int sampleSize;\n            while ((sampleSize = mVideoExtractor.readSampleData(buffer, 0)) &gt;= 0) {\n                info.offset = 0;\n                info.size = sampleSize;\n                info.flags = MediaCodec.BUFFER_FLAG_SYNC_FRAME;\n                info.presentationTimeUs = mVideoExtractor.getSampleTime();\n                videoEndPreTimeUs = info.presentationTimeUs;\n                mediaMuxer.writeSampleData(videoTrackIndex, buffer, info);\n                mVideoExtractor.advance();\n            }\n        }\n        Log.d(TAG, \"\u89c6\u9891 videoEndPreTimeUs \" + videoEndPreTimeUs);\n\n        // \u5c01\u88c5\u97f3\u9891track\n        if (-1 != audioTrackIndex) {\n            MediaCodec.BufferInfo info = new MediaCodec.BufferInfo();\n            info.presentationTimeUs = 0;\n            ByteBuffer buffer = ByteBuffer.allocate(1024 * 1024);\n            int sampleSize;\n            while ((sampleSize = audioExtractor.readSampleData(buffer, 0)) &gt;= 0 &amp;&amp;\n                    audioExtractor.getSampleTime() &lt;= videoEndPreTimeUs) {\n                info.offset = 0;\n                info.size = sampleSize;\n                info.flags = MediaCodec.BUFFER_FLAG_SYNC_FRAME;\n                info.presentationTimeUs = audioExtractor.getSampleTime();\n                mediaMuxer.writeSampleData(audioTrackIndex, buffer, info);\n                audioExtractor.advance();\n            }\n        }\n        mVideoExtractor.release(); // \u91ca\u653eMediaExtractor\n        audioExtractor.release();\n        mediaMuxer.stop();\n        mediaMuxer.release();     // \u91ca\u653eMediaMuxer\n    }\n</code></pre></p> <pre><code>Video: format:{csd-1=java.nio.ByteArrayBuffer[position=0,limit=9,capacity=9], mime=video/avc, frame-rate=30, height=1080, width=1920, max-input-size=1572864, isDMCMMExtractor=1, durationUs=12425577, csd-0=java.nio.ByteArrayBuffer[position=0,limit=20,capacity=20]}\nAudio: format:{max-input-size=5532, aac-profile=2, mime=audio/mp4a-latm, durationUs=340101875, csd-0=java.nio.ByteArrayBuffer[position=0,limit=2,capacity=2], channel-count=2, sample-rate=44100}\n</code></pre>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaMuxer_MediaExtractor_mp4/#mp3aac","title":"MP3\u8f6c\u6362\u4e3aAAC","text":"","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaMuxer_MediaExtractor_mp4/#androidaudioconverter","title":"\u4f7f\u7528 AndroidAudioConverter","text":"<p>AndroidAudioConverter - https://github.com/adrielcafe/AndroidAudioConverter</p> <p>\u57fa\u4e8eFFmpeg\u7684\u7b2c\u4e09\u65b9\u5e93\u3002\u652f\u6301\u683c\u5f0f\u6709AAC, MP3, M4A, WMA, WAV \u548c FLAC</p> <p>\u4f7f\u7528\u65b9\u6cd5\uff1a</p> <p><code>app/build.gradle</code> <pre><code>repositories {\n  maven {\n    url \"https://jitpack.io\"\n  }\n}\n\ndependencies {\n  compile 'com.github.adrielcafe:AndroidAudioConverter:0.0.8'\n}\n</code></pre></p> <p>\u7533\u8bf7\u8bfb\u5199\u5916\u90e8\u5b58\u50a8\u6743\u9650 <pre><code>    &lt;uses-permission android:name=\"android.permission.READ_EXTERNAL_STORAGE\" /&gt;\n    &lt;uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\" /&gt;\n</code></pre></p> <p>\u5728<code>Application</code>\u7c7b\u4e2d\u52a0\u8f7d\u5e93 <pre><code>public class MuxerApp extends Application {\n\n    @Override\n    public void onCreate() {\n        super.onCreate();\n        AndroidAudioConverter.load(this, new ILoadCallback() {\n            @Override\n            public void onSuccess() {\n                // Great!\n            }\n            @Override\n            public void onFailure(Exception error) {\n                // FFmpeg is not supported by device\n            }\n        });\n    }\n}\n</code></pre></p> <p>\u4f7f\u7528\u8f6c\u6362\u529f\u80fd <pre><code>    final String sourceMP3Path = SOURCE_PATH + File.separator + \"music1.mp3\";\n    Log.d(TAG, \"\u8f6c\u6362\u5f00\u59cb \" + sourceMP3Path);\n    File srcFile = new File(sourceMP3Path);\n    IConvertCallback callback = new IConvertCallback() {\n        @Override\n        public void onSuccess(File convertedFile) {\n            Log.d(TAG, \"onSuccess: \" + convertedFile);\n        }\n\n        @Override\n        public void onFailure(Exception error) {\n            Log.e(TAG, \"onFailure: \", error);\n        }\n    };\n    AndroidAudioConverter.with(getApplicationContext())\n            // Your current audio file\n            .setFile(srcFile)\n\n            // Your desired audio format\n            .setFormat(AudioFormat.AAC)\n\n            // An callback to know when conversion is finished\n            .setCallback(callback)\n\n            // Start conversion\n            .convert();\n</code></pre></p> <p>\u5728\u4e09\u661fNote4\u4e0a\u6d4b\u8bd5\uff0c\u8f6c\u636213MB\u7684MP3\u6587\u4ef6\u7528\u4e86\u5927\u7ea63\u520618\u79d2\u3002</p>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaMuxer_MediaExtractor_mp4/#_2","title":"\u53c2\u8003","text":"<ul> <li>MediaExtractor - Android Developer</li> <li>MediaMuxer - Android Developer</li> <li>Java MP4 Parser</li> <li>Android MediaPlayer</li> </ul>","tags":["Android Media","\u97f3\u89c6\u9891"]},{"location":"android/media/MediaPlayer_intro/","title":"Android MediaPlayer \u57fa\u7840\u7b80\u4ecb","text":"\u66f4\u65b0\u65e5\u671f 2022-8-22 <ul> <li>2022-8-22 \u66f4\u65b0\u4ecb\u7ecd</li> </ul> <p>\u7b80\u5355\u4ecb\u7ecdMediaPlayer\u7684\u57fa\u672c\u6982\u5ff5\uff0c\u72b6\u6001\uff0c\u5e38\u7528\u7684\u65b9\u6cd5\u4e0e\u76d1\u542c\u5668\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_intro/#mediaplayer","title":"\u4ec0\u4e48\u662fMediaPlayer","text":"<p>MediaPlayer\u7c7b\u53ef\u4ee5\u7528\u6765\u64ad\u653e\u97f3\u89c6\u9891\u6587\u4ef6\uff0c\u6216\u8005\u662f\u97f3\u9891\u6d41\u3002\u5f00\u53d1\u8005\u53ef\u4ee5\u7528\u5b83\u6765\u64ad\u653e\u672c\u5730\u97f3\u9891\uff0c\u6216\u8005\u662f\u7f51\u7edc\u5728\u7ebf\u97f3\u9891\u3002</p> <p>MediaPlayer\u5c5e\u4e8e<code>android.media</code>\u5305\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_intro/#mediaplayer_1","title":"MediaPlayer\u7684\u72b6\u6001","text":"<p>\u64ad\u653e\u63a7\u5236\u7531\u72b6\u6001\u673a\u63a7\u5236\u3002\u5728\u65e5\u5e38\u751f\u6d3b\u4e2d\uff0c\u6211\u4eec\u5e38\u89c1\u7684\u97f3\u9891\u72b6\u6001\u6709\u64ad\u653e\u4e2d\uff0c\u6682\u505c\uff0c\u505c\u6b62\uff0c\u7f13\u51b2\u7b49\u7b49\u3002 MediaPlayer\u7684\u72b6\u6001\u6709\u5982\u4e0b\u51e0\u79cd\uff1a</p> <ul> <li>Idle</li> <li>End</li> <li>Error</li> <li>Initialized</li> <li>Preparing</li> <li>Prepared</li> <li>Started</li> <li>Stopped</li> <li>Paused</li> <li>PlaybackCompleted</li> </ul> <p>\u72b6\u6001\u7684\u5207\u6362\u53c2\u8003\u5b98\u65b9\u56fe\u4f8b\u3002 \u8fd9\u91cc\u7a0d\u5fae\u89e3\u91ca\u4e00\u4e0b\u72b6\u6001\u8f6c\u6362\u56fe\u7247\u3002\u692d\u5706\u4ee3\u8868MediaPlayer\u53ef\u80fd\u505c\u7559\u7684\u72b6\u6001\u3002\u692d\u5706\u4e4b\u95f4\u7684\u7bad\u5934\u8868\u793a\u65b9\u6cd5\u8c03\u7528\uff0c\u72b6\u6001\u5207\u6362\u7684\u65b9\u5411\u3002\u5355\u7bad\u5934\u8868\u793a\u65b9\u6cd5\u540c\u6b65\u8c03\u7528\uff0c\u53cc\u7bad\u5934\u8868\u793a\u5f02\u6b65\u8c03\u7528\u3002</p> <p></p> <p>\u4ece\u56fe\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\u72b6\u6001\u5207\u6362\u7684\u8def\u5f84\u548c\u6d89\u53ca\u5230\u7684\u65b9\u6cd5\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_intro/#idleend","title":"Idle\u4e0eEnd\u72b6\u6001","text":"<p>\u5f53new\u4e00\u4e2aMediaPlayer\u6216\u8005\u8c03\u7528\u4e86reset\u65b9\u6cd5\uff0c\u5f53\u524dMediaPlayer\u4f1a\u5904\u4e8eIdle\u72b6\u6001\u3002\u8c03\u7528release\u540e\uff0c\u4f1a\u5904\u4e8eEnd\u72b6\u6001\u3002\u5728\u8fd92\u4e2a\u72b6\u6001\u4e4b\u95f4\u7684\u72b6\u6001\u53ef\u4ee5\u770b\u505a\u662fMediaPlayer\u5bf9\u8c61\u7684\u751f\u547d\u5468\u671f\u3002</p> <p>\u5728\u65b0\u521b\u5efaMediaPlayer\u548c\u8c03\u7528reset\u7684MediaPlayer\u4e4b\u95f4\u6709\u4e00\u4e9b\u7ec6\u5fae\u7684\u5dee\u522b\u3002 \u8fd9\u4e24\u79cd\u60c5\u51b5\u90fd\u5904\u4e8eIdle\u72b6\u6001\uff0c\u8c03\u7528 getCurrentPosition(), getDuration(), getVideoHeight(), getVideoWidth(), setAudioAttributes(android.media.AudioAttributes), setLooping(boolean), setVolume(float, float), pause(), start(), stop(), seekTo(long, int), prepare() \u6216 prepareAsync()\u65b9\u6cd5\u90fd\u4f1a\u629b\u51fa\u9519\u8bef\uff0c\u5982\u679c\u662f\u65b0\u5b9e\u4f8b\u5316\u7684MediaPlayer\uff0c\u4e0d\u4f1a\u56de\u8c03 OnErrorListener.onError()\uff1b\u4f46\u5982\u679c\u662freset\u540e\u7684MediaPlayer\uff0c\u4f1a\u56de\u8c03 OnErrorListener.onError()\u5e76\u4e14\u8f6c\u6362\u5230Error\u72b6\u6001\u3002</p> <p>\u5982\u679cMediaPlayer\u5bf9\u8c61\u4e0d\u518d\u4f7f\u7528\u4e86\uff0c\u7acb\u5373\u8c03\u7528release()\u65b9\u6cd5\uff0c\u91ca\u653e\u5185\u90e8\u64ad\u653e\u5668\u5360\u7528\u7684\u8d44\u6e90\u3002\u8fd9\u4e9b\u8d44\u6e90\u53ef\u80fd\u662f\u552f\u4e00\u7684\uff0c\u6bd4\u5982\u786c\u4ef6\u52a0\u901f\u7ec4\u4ef6\u3002\u5982\u679c\u8c03\u7528release\u5931\u8d25\uff0c\u53ef\u80fd\u4f1a\u5f15\u8d77\u4e00\u8fde\u4e32\u7684MediaPlayer\u5b9e\u4f8b\u5931\u6548\u3002\u5f53MediaPlayer\u5904\u4e8eEnd\u72b6\u6001\uff0c\u5b83\u5c31\u4e0d\u80fd\u518d\u8f6c\u79fb\u5230\u5176\u5b83\u72b6\u6001\u4e86\u3002</p> <p>new\u4e00\u4e2aMediaPlayer\uff0c\u5904\u4e8eIdle\u72b6\u6001\u3002\u5982\u679c\u7528create\u65b9\u6cd5\u521b\u5efa\u5b9e\u4f8b\uff0c\u5f53\u521b\u5efa\u5b8c\u6210\u65f6\u5904\u4e8ePrepared\u72b6\u6001\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_intro/#_1","title":"\u53d1\u751f\u9519\u8bef","text":"<p>\u4e00\u4e9b\u60c5\u5f62\u53ef\u80fd\u4f1a\u8ba9MediaPlayer\u64cd\u4f5c\u5931\u8d25\uff0c\u6bd4\u5982\u4e0d\u652f\u6301\u7684\u97f3\u89c6\u9891\u683c\u5f0f\uff0c\u5206\u8fa8\u7387\u8fc7\u9ad8\uff0c\u7f51\u7edc\u8d85\u65f6\u7b49\u7b49\u3002 \u56e0\u6b64\u5728\u8fd9\u4e9b\u60c5\u5f62\u4e0b\u9519\u8bef\u5904\u7406\u548c\u6062\u590d\u975e\u5e38\u91cd\u8981\u3002\u6709\u65f6\u5019\u7f16\u7a0b\u9519\u8bef\u4e5f\u4f1a\u5bfc\u81f4MediaPlayer\u64cd\u4f5c\u9519\u8bef\u3002 \u5f00\u53d1\u8005\u53ef\u4ee5\u8bbe\u7f6e\u9519\u8bef\u76d1\u542c\u5668<code>setOnErrorListener(android.media.MediaPlayer.OnErrorListener)</code>\u3002\u5f53\u9519\u8bef\u53d1\u751f\u65f6\uff0c\u4f1a\u8c03\u7528\u7528\u6237\u5b9e\u73b0\u7684OnErrorListener.onError()\u65b9\u6cd5\u3002</p> <p>\u4e0d\u7ba1\u6709\u6ca1\u6709\u8bbe\u7f6e\u76d1\u542c\u5668\uff0c\u9519\u8bef\u53d1\u751f\u65f6MediaPlayer\u4f1a\u8fdb\u5165Error\u72b6\u6001\u3002</p> <p>\u4e3a\u4e86\u91cd\u590d\u4f7f\u7528\u540c\u4e00\u4e2aMediaPlayer\u5bf9\u8c61\uff0c\u53ef\u4ee5\u4f7f\u7528<code>reset()</code>\u65b9\u6cd5\u628a\u5b83\u4eceError\u72b6\u6001\u6062\u590d\u5230Idle\u72b6\u6001\u3002  \u8bbe\u7f6e\u9519\u8bef\u76d1\u542c\u5668OnErrorListener\u662f\u4e00\u4e2a\u597d\u7684\u7f16\u7a0b\u4e60\u60ef\u3002\u5f00\u53d1\u8005\u53ef\u4ee5\u76d1\u542c\u5230\u64ad\u653e\u5f15\u64ce\u7684\u9519\u8bef\u901a\u77e5\u3002 \u6709\u65f6\u5019\u4f1a\u629b\u51faIllegalStateException\u5f02\u5e38\uff0c\u6bd4\u5982\u5728\u9519\u8bef\u7684\u72b6\u6001\u8c03\u7528\u4e86prepare(), prepareAsync()\u65b9\u6cd5\uff0c\u6216\u662fsetDataSource\u65b9\u6cd5\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_intro/#setdatasource","title":"\u8bbe\u7f6e\u97f3\u6e90 setDataSource","text":"<p>\u8c03\u7528setDataSource(java.io.FileDescriptor), \u6216\u8005 setDataSource(java.lang.String), \u6216\u8005 setDataSource(android.content.Context, android.net.Uri), \u6216\u8005 setDataSource(java.io.FileDescriptor, long, long), \u6216\u8005 setDataSource(android.media.MediaDataSource) \u53ef\u4ee5\u5c06MediaPlayer\u7684\u72b6\u6001\u4eceIdle\u8f6c\u5230Initialized\u72b6\u6001\u3002 \u5982\u679c\u5728Idle\u72b6\u6001\u4e4b\u5916\u7684\u72b6\u6001\u8c03\u7528\u4e86setDataSource()\uff0c\u4f1a\u629b\u51faIllegalStateException\u5f02\u5e38\u3002 \u5f00\u53d1\u8005\u5e94\u8be5\u7559\u610fsetDataSource\u65b9\u6cd5\u629b\u51fa\u7684IllegalArgumentException\u548cIOException\u5f02\u5e38\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_intro/#prepared","title":"\u64ad\u653e\u97f3\u9891\u524d\u5fc5\u987b\u5728Prepared\u72b6\u6001","text":"<p>MediaPlayer\u5728\u5f00\u59cb\u64ad\u653e\u97f3\u9891\u524d\u5fc5\u987b\u5904\u4e8ePrepared\u72b6\u6001\u3002</p> <p>MediaPlayer\u6709\u540c\u6b65\u548c\u5f02\u6b652\u79cd\u65b9\u5f0f\u6765\u8fdb\u5165Prepared\u72b6\u6001\u3002\u5982\u679c\u662f\u5f02\u6b65\u7684\u65b9\u5f0f\uff0c\u4f1a\u5148\u8f6c\u5230Preparing\u72b6\u6001\uff0c\u518d\u8f6c\u5230Prepared\u72b6\u6001\u3002 \u5f53\u51c6\u5907\u5b8c\u6210\u65f6\uff0c\u5185\u90e8\u7684\u64ad\u653e\u5f15\u64ce\u4f1a\u56de\u8c03\u7528\u6237\u4e4b\u524d\u8bbe\u7f6e\u7684OnPreparedListener\u7684onPrepared()\u65b9\u6cd5\u3002</p> <p>\u5f00\u53d1\u8005\u5fc5\u987b\u6ce8\u610f\u7684\u662f\uff0cPreparing\u72b6\u6001\u662f\u4e00\u4e2a\u8fc7\u6e21\u72b6\u6001\uff08transient state\uff09\u3002</p> <p>\u5904\u4e8ePrepared\u72b6\u6001\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u76f8\u5bf9\u5e94\u7684\u65b9\u6cd5\u8bbe\u7f6e\u97f3\u91cf\uff0c\u5c4f\u5e55\u5e38\u4eae\uff0c\u64ad\u653e\u5faa\u73af\u7b49\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_intro/#_2","title":"\u5f00\u59cb\u64ad\u653e","text":"<p>\u64ad\u653e\u97f3\u9891\u5fc5\u987b\u8c03\u7528start()\u65b9\u6cd5\u3002\u8c03\u7528start()\u8fd4\u56de\u6210\u529f\u540e\uff0cMediaPlayer\u5904\u4e8eStarted\u72b6\u6001\u3002 \u53ef\u4ee5\u901a\u8fc7isPlaying()\u6765\u5224\u65ad\u5f53\u524d\u662f\u5426\u5728Started\u72b6\u6001\u3002</p> <p>\u5982\u679c\u5f00\u53d1\u8005\u8bbe\u7f6e\u4e86OnBufferingUpdateListener\uff0cAndroid\u5185\u90e8\u64ad\u653e\u5668\u4f1a\u5411\u5916\u4f20\u9012buffer\u4fe1\u606f\u3002</p> <p>\u5982\u679c\u5f53\u524d\u5904\u4e8eStarted\u72b6\u6001\uff0c\u518d\u8c03\u7528start()\u65b9\u6cd5\u6ca1\u6709\u6548\u679c\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_intro/#_3","title":"\u6682\u505c\u64ad\u653e\u4e0e\u7ee7\u7eed\u64ad\u653e","text":"<p>\u97f3\u9891\u53ef\u4ee5\u88ab\u6682\u505c\u64ad\u653e\u548c\u7ee7\u7eed\u64ad\u653e\uff0c\u4e5f\u53ef\u4ee5\u8c03\u6574\u64ad\u653e\u7684\u4f4d\u7f6e\u3002\u901a\u8fc7pause()\u65b9\u6cd5\u6765\u6682\u505c\u97f3\u9891\u64ad\u653e\u3002 \u6210\u529f\u8c03\u7528pause()\u65b9\u6cd5\u540e\uff0cMediaPlayer\u8fdb\u5165Paused\u72b6\u6001\u3002 \u5e94\u5f53\u6ce8\u610f\u7684\u662f\uff0cMediaPlayer\u5728Started\u72b6\u6001\u4e0ePaused\u72b6\u6001\u4e4b\u95f4\u5207\u6362\u662f\u5f02\u6b65\u7684\u3002\u64ad\u653e\u97f3\u9891\u6d41\u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u8f6c\u6362\u8fc7\u7a0b\u53ef\u80fd\u4f1a\u9700\u8981\u51e0\u79d2\u949f\u3002</p> <p>MediaPlayer\u6682\u505c\u65f6\uff0cstart()\u65b9\u6cd5\u53ef\u4ee5\u4ece\u6682\u505c\u7684\u4f4d\u7f6e\u7ee7\u7eed\u64ad\u653e\u3002\u6210\u529f\u8c03\u7528start\u65b9\u6cd5\u540e\u4f1a\u8fdb\u5165Started\u72b6\u6001\u3002</p> <p>\u5904\u4e8ePaused\u72b6\u6001\u65f6\uff0c\u8c03\u7528pause()\u65b9\u6cd5\u6ca1\u6709\u6548\u679c\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_intro/#_4","title":"\u505c\u6b62","text":"<p>\u8c03\u7528stop()\u65b9\u6cd5\u8ba9MediaPlayer\u4eceStarted, Paused, Prepared \u6216 PlaybackCompleted \u72b6\u6001\u8fdb\u5165 Stopped \u72b6\u6001\u3002</p> <p>\u5728Stopped\u72b6\u6001\u65f6\uff0c\u5fc5\u987b\u5148\u8c03\u7528prepare() \u6216 prepareAsync()\u8fdb\u5165Prepared\u72b6\u6001\u540e\uff0c\u624d\u80fd\u64ad\u653e\u97f3\u9891\u3002</p> <p>\u5904\u4e8eStopped\u72b6\u6001\u65f6\uff0c\u8c03\u7528stop()\u65b9\u6cd5\u6ca1\u6709\u6548\u679c\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_intro/#_5","title":"\u8c03\u6574\u64ad\u653e\u4f4d\u7f6e","text":"<p>\u8c03\u7528<code>seekTo(long, int)</code>\u6765\u8c03\u6574\u64ad\u653e\u4f4d\u7f6e\u3002</p> <p><code>seekTo(long, int)</code>\u662f\u4e00\u4e2a\u5f02\u6b65\u65b9\u6cd5\uff0c\u867d\u7136\u5b83\u80fd\u7acb\u523b\u8fd4\u56de\uff0c\u4f46\u5b9e\u9645\u7684\u4f4d\u7f6e\u8c03\u6574\u53ef\u80fd\u4f1a\u6d88\u8017\u4e00\u6bb5\u65f6\u95f4\uff0c\u7279\u522b\u662f\u5728\u64ad\u653e\u97f3\u9891\u6d41\u7684\u65f6\u5019\u3002\u5f53\u5b9e\u9645\u64ad\u653e\u4f4d\u7f6e\u8c03\u6574\u540e\uff0c\u5185\u90e8\u64ad\u653e\u5668\u4f1a\u56de\u8c03\u5f00\u53d1\u8005\u8bbe\u7f6e\u7684OnSeekComplete.onSeekComplete()\u3002</p> <p>\u5728Prepared, Paused \u548c PlaybackCompleted\u72b6\u6001\u4e2d\uff0c\u90fd\u53ef\u4ee5\u8c03\u7528seekTo\u65b9\u6cd5\u3002</p> <p>\u53ef\u4ee5\u901a\u8fc7<code>getCurrentPosition()</code>\u65b9\u6cd5\u6765\u83b7\u53d6\u5f53\u524d\u64ad\u653e\u4f4d\u7f6e\u3002\u5f00\u53d1\u8005\u53ef\u4ee5\u5f97\u77e5\u5f53\u524d\u64ad\u653e\u7684\u8fdb\u5ea6\u7b49\u7b49\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_intro/#android-80","title":"Android 8.0","text":"<p>\u4e4b\u524d\u4f7f\u7528<code>seekTo</code>\u7ecf\u5e38\u9047\u5230\u6062\u590d\u64ad\u653e\u65f6\u4f4d\u7f6e\u4e0d\u51c6\u7684\u95ee\u9898\uff0c\u800c\u4e14\u751a\u81f3\u6709\u91cd\u5934\u5f00\u59cb\u64ad\u653e\u7684\u73b0\u8c61\u3002 \u8fd9\u4e2a\u662f\u56e0\u4e3a<code>seekTo</code>\u662f\u56de\u5230\u4e0a\u4e00\u65f6\u95f4\u70b9\u9644\u8fd1\u7684\u5173\u952e\u5e27\u5bfc\u81f4\u7684\u3002</p> <p>\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u5728\u6700\u65b0\u7684Android 8.0\u5e73\u53f0\u4e0a\uff0c\u5df2\u7ecf\u6709\u4e86\u65b0\u7684\u89e3\u51b3\u65b9\u6848\uff1a <code>seekTo(long msec, @SeekMode int mode)</code></p> <pre><code>if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {\n    mPlayer.seekTo(progress, MediaPlayer.SEEK_CLOSEST);\n} else {\n    mPlayer.seekTo(progress);\n}\n</code></pre> <p>\u4e0a\u6587\u7684<code>MediaPlayer.SEEK_CLOSEST</code>\uff0c\u8868\u793a\u627e\u5230\u7ed9\u5b9a\u65f6\u523b\u7684\u6700\u63a5\u8fd1\u7684\u4e00\u5e27\uff08frame\uff09\u3002\u800c\u4e0d\u7528\u53bb\u627e\u5173\u952e\u5e27\uff08key frame\uff09\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_intro/#_6","title":"\u64ad\u653e\u5b8c\u6bd5","text":"<p>\u97f3\u9891\u64ad\u653e\u5b8c\u6210\u540e\uff0c\u64ad\u653e\u5b8c\u6bd5\u3002</p> <p>\u5982\u679c\u8c03\u7528setLooping(boolean)\u4e3atrue\uff0cMediaPlayer\u4f1a\u505c\u7559\u5728Started\u72b6\u6001\u3002</p> <p>\u5982\u679csetLooping\u4e3afalse\uff0c\u5185\u90e8\u64ad\u653e\u5668\u4f1a\u8c03\u7528\u5f00\u53d1\u8005\u8bbe\u7f6e\u7684OnCompletion.onCompletion()\uff0c\u5e76\u4e14\u8fdb\u5165PlaybackCompleted\u72b6\u6001\u3002</p> <p>\u5904\u4e8ePlaybackCompleted\u72b6\u6001\u65f6\uff0c\u8c03\u7528start()\u65b9\u6cd5\u53ef\u4ee5\u4ece\u5934\u5f00\u59cb\u64ad\u653e\u97f3\u9891\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_intro/#_7","title":"\u5e38\u7528\u76d1\u542c\u5668","text":"<p>\u5f00\u53d1\u8005\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e9b\u76d1\u542c\u5668\uff0c\u76d1\u542cMediaPlayer\u7684\u72b6\u6001\uff0c\u9519\u8bef\u4e8b\u4ef6\u7b49\u7b49\u3002\u5f00\u53d1\u8005\u5e94\u5728\u540c\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u521b\u5efaMediaPlayer\u4e0e\u8bbe\u7f6e\u7684\u76d1\u542c\u5668\u3002</p> <p><code>setOnPreparedListener(android.media.MediaPlayer.OnPreparedListener)</code> \u76d1\u542cMediaPlayer\u51c6\u5907\u5b8c\u6210\u3002\u4e00\u822c\u4e0e<code>prepareAsync</code>\u914d\u5408\u4f7f\u7528\u3002</p> <p><code>setOnVideoSizeChangedListener(android.media.MediaPlayer.OnVideoSizeChangedListener)</code> \u83b7\u77e5video\u5927\u5c0f\u6216video\u5927\u5c0f\u6539\u53d8\u65f6\u7684\u76d1\u542c\u3002</p> <p><code>setOnSeekCompleteListener(android.media.MediaPlayer.OnSeekCompleteListener)</code> \u76d1\u542c\u8c03\u6574\u4f4d\u7f6e\u5b8c\u6210\u3002</p> <p><code>setOnCompletionListener(android.media.MediaPlayer.OnCompletionListener)</code> \u64ad\u653e\u5b8c\u6210\u3002</p> <pre><code>mediaPlayer.setOnCompletionListener(new MediaPlayer.OnCompletionListener() {\n    @Override\n    public void onCompletion(MediaPlayer mediaPlayer) {\n        // \u5f53\u524d\u64ad\u653e\u5b8c\u6bd5\n    }\n});\n</code></pre> <p><code>setOnBufferingUpdateListener(android.media.MediaPlayer.OnBufferingUpdateListener)</code> \u76d1\u542c\u7f13\u51b2\u8fdb\u5ea6\u3002\u5728\u64ad\u653e\u7f51\u7edc\u97f3\u9891\u65f6\u5e38\u7528\u3002</p> <p>\u7f13\u51b2\u76d1\u542c\u5668<code>OnBufferingUpdateListener</code></p> <pre><code>mMediaPlayer.prepareAsync();\nmMediaPlayer.setOnBufferingUpdateListener(new MediaPlayer.OnBufferingUpdateListener() {\n    @Override\n    public void onBufferingUpdate(MediaPlayer mp, int percent) {\n        // \u4f8b\u5982\u5728\u8fd9\u91cc\u66f4\u65b0UI\n    }\n});\n</code></pre> <p><code>setOnInfoListener(android.media.MediaPlayer.OnInfoListener)</code> \u76d1\u542c\u666e\u901a\u4fe1\u606f\u6216\u8005\u8b66\u544a\u4fe1\u606f\u3002</p> <p><code>setOnErrorListener(android.media.MediaPlayer.OnErrorListener)</code> \u76d1\u542c\u9519\u8bef\u4fe1\u606f\u3002\u9519\u8bef\u53d1\u751f\u65f6\uff0c\u53ef\u4ee5\u5728\u8fd9\u91cc\u5904\u7406\u9519\u8bef\u3002</p> <pre><code>mediaPlayer.setOnErrorListener(new MediaPlayer.OnErrorListener() {\n    @Override\n    public boolean onError(MediaPlayer mediaPlayer, int i, int i1) {\n        LogUtil.e(TAG_PREFIX + \" onERR i = \" + i + \" i1 = \" + i1);\n        return true; // \u8fd4\u56detrue\u8868\u793a\u5728\u6b64\u5904\u7406\u9519\u8bef\uff0c\u4e0d\u4f1a\u56de\u8c03onCompletion\n    }\n});\n</code></pre> <p>\u6ce8\u610fonError\u7684\u8fd4\u56de\u503c\u3002\u53ef\u4ee5\u9009\u62e9\u81ea\u5df1\u5904\u7406error\u3002</p> <pre><code>/*\n* @return True if the method handled the error, false if it didn't.\n* Returning false, or not having an OnErrorListener at all, will\n* cause the OnCompletionListener to be called.\n*/\nboolean onError(MediaPlayer mp, int what, int extra);\n</code></pre> <p>\u9519\u8bef\u4ee3\u7801<code>-38</code>\u3002\u901a\u5e38\u8868\u793a\u72b6\u6001\u4e0d\u5bf9\u3002\u5728\u9519\u8bef\u7684\u72b6\u6001\u6267\u884c\u4e86\u9519\u8bef\u7684\u64cd\u4f5c\u3002 \u53ef\u4ee5\u53c2\u8003Android MediaPlayer Error (-38,0) - stackoverflow</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_intro/#_8","title":"\u9700\u8981\u7684\u6743\u9650","text":"<p>\u64ad\u653e\u7f51\u7edc\u97f3\u9891\u65f6\u9700\u8981<code>Manifest.permission.INTERNET</code>\u6743\u9650\u3002</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u6398\u91d1 \u7b80\u4e66</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/","title":"Android MediaPlayer \u64ad\u653e\u97f3\u9891","text":"\u66f4\u65b0\u65e5\u671f: 2022-8-22 <ul> <li>2022-8-22 \u66f4\u65b0\u8bf4\u660e</li> <li>2022-8-9 \u589e\u52a0\u64ad\u653e\u4f8b\u5b50</li> </ul> <p>\u4e3b\u8981\u4ecb\u7ecd\u4f7f\u7528MediaPlayer\u64ad\u653e\u97f3\u9891\u7684\u65b9\u5f0f\u3002\u5173\u4e8eMediaPlayer\u7684\u57fa\u7840\u77e5\u8bc6\uff0c\u6bd4\u5982\u72b6\u6001\uff0c\u53ef\u4ee5\u53c2\u8003Android MediaPlayer \u57fa\u7840\u7b80\u4ecb\u3002</p> <p>\u4e3a\u4e86\u65b9\u4fbf\u8868\u8fbe\uff0c\u5b9a\u4e49\u53d8\u91cf\u540d\u4e3a<code>mediaPlayer</code>\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#mediaplayer","title":"MediaPlayer\u7684\u4f7f\u7528\u65b9\u5f0f","text":"","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#mediaplayer_1","title":"\u521b\u5efaMediaPlayer","text":"<p>\u53ef\u4ee5\u76f4\u63a5 new MediaPlayer\uff0c\u4e5f\u53ef\u4ee5\u7528MediaPlayer\u63d0\u4f9b\u7684create\u65b9\u6cd5\u521b\u5efa\u3002 <pre><code>mediaPlayer = new MediaPlayer();\n</code></pre></p> <p>\u4f7f\u7528create\u65b9\u6cd5\u521b\u5efa\u6210\u529f\u540e\uff0cmediaPlayer\u5904\u4e8ePrepared\u72b6\u6001\u3002\u53ef\u4ee5\u76f4\u63a5start\u64ad\u653e\u3002 <pre><code>mediaPlayer = MediaPlayer.create(getApplicationContext(), Uri.fromFile(file));\nmediaPlayer.start();\n</code></pre></p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#-setdatasource","title":"\u8bbe\u7f6e\u97f3\u6e90 - setDataSource","text":"<p>\u901a\u8fc7\u8c03\u7528<code>setDataSource</code>\u6765\u8bbe\u7f6e\u97f3\u6e90\u3002<code>setDataSource</code>\u6709\u591a\u4e2a\u91cd\u8f7d\u65b9\u6cd5\uff0c\u6211\u4eec\u6765\u770b\u5e38\u7528\u7684\u51e0\u79cd\u3002</p> <p>\u4f8b\u5982\u8bbe\u7f6e\u4f7f\u7528assets\u91cc\u7684\u8d44\u6e90\u3002\u5b9e\u9645\u60c5\u51b5\u53ef\u80fd\u9700\u8981try catch\u3002 <pre><code>AssetFileDescriptor fd = null;\nMediaPlayer mediaPlayer = new MediaPlayer();\nfd = context.getApplicationContext().getAssets().openFd(name);\nmediaPlayer.setDataSource(fd.getFileDescriptor(), fd.getStartOffset(), fd.getLength());\n</code></pre></p> <p>\u6216\u8005\u4f7f\u7528\u6587\u4ef6\u62ff\u5230<code>FileDescriptor</code>\uff0c\u4e5f\u9700\u8981try catch <pre><code>FileInputStream fis = new FileInputStream(wavFile);\nmediaPlayer.setDataSource(fis.getFD());\n</code></pre></p> MediaPlayer\u62a5\u9519 (1, -2147483648) <p>\u6709\u4eba\u9047\u5230\u8fc7MediaPlayer\u62a5\u9519 (1, -2147483648)\uff0c\u53ef\u5c1d\u8bd5\u7528<code>FileDescriptor</code>\u6765<code>setDataSource</code>\uff0c\u89c4\u907f\u9519\u8bef</p> <p>StackOverflow</p> <p>\u672c\u5730\u6587\u4ef6\uff0c\u9700\u8981\u6587\u4ef6\u7684\u7edd\u5bf9\u8def\u5f84\u3002 <pre><code>mediaPlayer.setDataSource(file.getAbsolutePath());\n</code></pre></p> <p>\u6216\u8005\u83b7\u53d6\u6587\u4ef6\u7684Uri\u6765\u521b\u5efamediaPlayer\u3002 <pre><code>mediaPlayer = MediaPlayer.create(getApplicationContext(), Uri.fromFile(file));\n</code></pre></p> <p>\u8bbe\u7f6e\u7f51\u7edc\u97f3\u9891\uff0c\u4e5f\u662f\u7528setDataSource\u65b9\u6cd5\uff0c\u8bbe\u7f6eurl\u3002 <pre><code>mediaPlayer.setDataSource(\"https://demo.com/sample.mp3\"));\n</code></pre></p> <p>\u64ad\u653e\u7f51\u7edc\u97f3\u9891\u65f6\uff0c\u5982\u679c\u4f7f\u7528\u7684\u662fhttp\uff0c\u6709\u53ef\u80fd\u4f1a\u62a5\u9519 <pre><code>java.io.IOException: Cleartext HTTP traffic to demo.com not permitted\n</code></pre></p> <p>\u53ef\u4ee5\u7b80\u5355\u5730\u8bbe\u7f6e\u4e00\u4e0bmanifest\uff0c\u8bbe\u7f6eusesCleartextTraffic=\"true\" <pre><code>&lt;application\n        android:usesCleartextTraffic=\"true\"&gt;\n</code></pre></p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#-prepare","title":"\u51c6\u5907 - prepare","text":"<p>\u540c\u6b65\u548c\u5f02\u6b65\u51c6\u5907\u97f3\u9891\u8d44\u6e90\u3002prepareAsync()\u662f\u5f02\u6b65\u7684\u65b9\u5f0f\uff0cprepare\u662f\u540c\u6b65\u7684\u3002\u6ce8\u610f\u7ebf\u7a0b\u8c03\u5ea6\u95ee\u9898\uff0c\u540c\u65f6\u4e0d\u8981\u963b\u585eUI\u7ebf\u7a0b\u3002</p> <p>\u4f7f\u7528\u5f02\u6b65\u65b9\u5f0f\u51c6\u5907\u97f3\u9891\uff0c\u7ecf\u5e38\u4e0eMediaPlayer.OnPreparedListener\u76d1\u542c\u5668\u914d\u5408\u4f7f\u7528\u3002\u5f02\u6b65\u51c6\u5907\u65f6\uff0c\u4e5f\u53ef\u4ee5\u8fdb\u884c\u5176\u4ed6\u7684\u8bbe\u7f6e\u3002 <pre><code>mediaPlayer.prepareAsync();\nmediaPlayer.setOnPreparedListener(new MediaPlayer.OnPreparedListener() {\n    @Override\n    public void onPrepared(MediaPlayer mediaPlayer) {\n        mediaPlayer.start(); // \u51c6\u5907\u597d\u4e86\u5c31\u64ad\u653e\n    }\n});\n</code></pre></p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#-looping","title":"\u5faa\u73af\u64ad\u653e - Looping","text":"<p>\u8bbe\u7f6e\u5faa\u73af\u64ad\u653esetLooping\u3002 <pre><code>mediaPlayer.setLooping(true);\n</code></pre> \u64ad\u653e\u5b8c\u6bd5\u540e\uff0c\u4e0d\u4f1a\u56de\u8c03OnCompletionListener\uff0c\u800c\u662f\u4ece\u5934\u64ad\u653e\u5f53\u524d\u97f3\u9891\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#-start","title":"\u64ad\u653e - start","text":"<p>\u64ad\u653e\u97f3\u9891\uff0c\u8c03\u7528start\u65b9\u6cd5\u3002 <pre><code>mediaPlayer.start();\n</code></pre></p> <p>\u5904\u4e8ePrepared\uff0cPause\u548cPlaybackComplete\u72b6\u6001\u65f6\uff0c\u53ef\u4ee5\u8c03\u7528start\u65b9\u6cd5\uff0c\u8fdb\u5165Started\u72b6\u6001\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#-pause","title":"\u6682\u505c - pause","text":"<p>\u6682\u505c\u64ad\u653e\uff0c\u4f7f\u7528pause\u65b9\u6cd5\u3002\u5728\u6682\u505c\u524d\u5148\u5224\u65ad\u4e00\u4e0bmediaPlayer\u7684\u662f\u5426\u5728\u64ad\u653e\u3002</p> <p><pre><code>if (mediaPlayer.isPlaying()) {\n    mediaPlayer.pause();\n}\n</code></pre> \u6682\u505c\u6210\u529f\u5219\u5904\u4e8ePaused\u72b6\u6001\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#-stop","title":"\u505c\u6b62 - stop","text":"<p>\u56de\u987e\u4e00\u4e0bMediaPlayer\u72b6\u6001\u5207\u6362\u7684\u56fe\u793a\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5\u5728\u64ad\u653e\u4e2d\uff0c\u6682\u505c\uff0c\u64ad\u653e\u5b8c\u6210\u8fd93\u4e2a\u72b6\u6001\u4e0b\uff0c\u53ef\u4ee5\u8c03\u7528stop\u65b9\u6cd5\uff0c\u8fdb\u5165Stopped\u72b6\u6001\u3002</p> <pre><code>mediaPlayer.stop();\n</code></pre>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#-seekto","title":"\u8c03\u8fdb\u5ea6 - seekTo","text":"<p>\u8c03\u6574\u64ad\u653e\u8fdb\u5ea6\u3002\u6211\u4eec\u5e73\u65f6\u4f7f\u7528\u97f3\u4e50\u64ad\u653e\u8f6f\u4ef6\u4e00\u822c\u90fd\u4f1a\u6709\u8fd9\u4e2a\u529f\u80fd\u3002 seekTo\u65b9\u6cd5\u63a5\u53d7\u4e00\u4e2a\u6beb\u79d2\u53c2\u6570\u3002</p> <pre><code>int targetMS = (int) (percent * mediaPlayer.getDuration());\nmediaPlayer.seekTo(targetMS);\n</code></pre> <p>seekTo\u5e76\u4e0d\u4f1a\u6539\u53d8MediaPlayer\u7684\u72b6\u6001\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#-reset","title":"\u91cd\u7f6e - reset","text":"<p>reset\u540e\u7684mediaPlayer\u8fdb\u5165Idle\u72b6\u6001\u3002\u9700\u8981\u91cd\u65b0\u8bbe\u7f6e\u97f3\u6e90\u4e0e\u51c6\u5907\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#-release","title":"\u91ca\u653e - release","text":"<p>\u4e0d\u518d\u4f7f\u7528\u8fd9\u4e2amediaPlayer\u65f6\uff0c\u5e94\u5f53\u5c3d\u5feb\u91ca\u653e\u6389\uff0c\u4ee5\u91ca\u653e\u76f8\u5173\u7684\u8d44\u6e90\u3002 \u8c03\u7528release\u540e\uff0cmediaPlayer\u8fdb\u5165End\u72b6\u6001\u3002\u6b64\u65f6\u8fd9\u4e2amediaPlayer\u5c31\u4e0d\u80fd\u518d\u4f7f\u7528\u4e86\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#_1","title":"\u5e38\u7528\u76d1\u542c\u5668","text":"","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#onbufferingupdatelistener","title":"\u7f13\u51b2\u76d1\u542c\u5668 OnBufferingUpdateListener","text":"<p>\u6bd4\u5982\u6211\u4eec\u52a0\u8f7d\u7f51\u7edc\u97f3\u9891\u7684\u65f6\u5019\uff0c\u5e38\u7528\u8fd9\u4e2a\u76d1\u542c\u5668\u6765\u76d1\u542c\u7f13\u51b2\u8fdb\u5ea6\u3002\u663e\u793a\u7f13\u51b2\u8fdb\u5ea6\uff0c\u4e5f\u53ef\u4ee5\u63d0\u9ad8\u7528\u6237\u4f53\u9a8c\u3002</p> <pre><code>mMediaPlayer.prepareAsync();\nmMediaPlayer.setOnBufferingUpdateListener(new MediaPlayer.OnBufferingUpdateListener() {\n    @Override\n    public void onBufferingUpdate(MediaPlayer mp, int percent) {\n        // percent\u4ee3\u8868\u7f13\u51b2\u767e\u5206\u6bd4\n    }\n});\n</code></pre>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#onerrorlistener","title":"\u9519\u8bef\u76d1\u542c\u5668 OnErrorListener","text":"<pre><code>mediaPlayer.setOnErrorListener(new MediaPlayer.OnErrorListener() {\n    @Override\n    public boolean onError(MediaPlayer mediaPlayer, int i, int i1) {\n        return true; // \u8fd4\u56detrue\u8868\u793a\u5728\u6b64\u5904\u7406\u9519\u8bef\uff0c\u4e0d\u4f1a\u56de\u8c03onCompletion\n    }\n});\n</code></pre> <p>\u6ce8\u610fonError\u7684\u8fd4\u56de\u503c\u3002\u53ef\u4ee5\u9009\u62e9\u81ea\u5df1\u5904\u7406error\u3002</p> <pre><code>/*\n * @return True if the method handled the error, false if it didn't.\n * Returning false, or not having an OnErrorListener at all, will\n * cause the OnCompletionListener to be called.\n */\nboolean onError(MediaPlayer mp, int what, int extra);\n</code></pre>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#oncompletionlistener","title":"\u64ad\u653e\u5b8c\u6bd5\u76d1\u542c\u5668 OnCompletionListener","text":"<pre><code>mediaPlayer.setOnCompletionListener(new MediaPlayer.OnCompletionListener() {\n    @Override\n    public void onCompletion(MediaPlayer mediaPlayer) {\n        // \u64ad\u653e\u5b8c\u6bd5\n    }\n});\n</code></pre>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#_2","title":"\u4f7f\u7528\u793a\u4f8b","text":"","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#assets","title":"\u64ad\u653eassets\u91cc\u7684\u97f3\u9891","text":"<p>\u64ad\u653eassets\u91cc\u7684\u97f3\u9891\u6587\u4ef6\uff0c\u4f7f\u7528\u5230AssetFileDescriptor\u7c7b\u3002\u4f7f\u7528\u540e\u8bb0\u5f97\u5173\u95edAssetFileDescriptor\u3002</p> <pre><code>private void playAssetsAudio(final String name, Context context) {\n    Log.d(TAG, \"playAssetWordSound: try to play assets sound file. -&gt; \" + name);\n    AssetFileDescriptor fd = null;\n    try {\n        MediaPlayer mediaPlayer;\n        Log.v(TAG, \"Looking in assets.\");\n        fd = context.getApplicationContext().getAssets().openFd(name);\n        mediaPlayer = new MediaPlayer();\n        mediaPlayer.reset();\n        mediaPlayer.setDataSource(fd.getFileDescriptor(), fd.getStartOffset(), fd.getLength());\n        mediaPlayer.prepareAsync();\n        mediaPlayer.setOnPreparedListener(new MediaPlayer.OnPreparedListener() {\n            @Override\n            public void onPrepared(MediaPlayer mediaPlayer) {\n                Log.d(TAG, \"onPrepared: \" + name);\n                mediaPlayer.start();\n            }\n        });\n        mediaPlayer.setOnCompletionListener(new MediaPlayer.OnCompletionListener() {\n            @Override\n            public void onCompletion(MediaPlayer mp) {\n                mp.release();\n                Log.d(TAG, \"onCompletion: \" + name);\n            }\n        });\n        mediaPlayer.setOnErrorListener(new MediaPlayer.OnErrorListener() {\n            @Override\n            public boolean onError(MediaPlayer mp, int i, int i1) {\n                mp.release();\n                return true;\n            }\n        });\n    } catch (Exception e) {\n        try {\n            if (fd != null) {\n                fd.close();\n            }\n        } catch (Exception e1) {\n            Log.e(TAG, \"Exception close fd: \", e1);\n        }\n    } finally {\n        if (fd != null) {\n            try {\n                fd.close();\n            } catch (IOException e) {\n                Log.e(TAG, \"Finally, close fd \", e);\n            }\n        }\n    }\n}\n</code></pre>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#_3","title":"\u64ad\u653e\u672c\u5730\u97f3\u9891\u6587\u4ef6","text":"<p>\u5c1d\u8bd5\u64ad\u653e\u97f3\u9891\u6587\u4ef6\u3002\u4ec5\u64ad\u653e\u4e00\u6b21\u3002</p> <pre><code>private void playAudioFile(final File file) {\n    Log.d(TAG, \"playAudioFile: \" + file.getAbsolutePath());\n    MediaPlayer mediaPlayer;\n    try {\n        mediaPlayer = new MediaPlayer();\n        mediaPlayer.setLooping(false);\n        mediaPlayer.setDataSource(file.getAbsolutePath());\n        mediaPlayer.prepare();\n        mediaPlayer.start();\n        mediaPlayer.setOnCompletionListener(new MediaPlayer.OnCompletionListener() {\n            @Override\n            public void onCompletion(MediaPlayer mp) {\n                mp.release();\n            }\n        });\n        mediaPlayer.setOnErrorListener(new MediaPlayer.OnErrorListener() {\n            @Override\n            public boolean onError(MediaPlayer mediaPlayer, int i, int i1) {\n                Log.d(TAG, \"Play local sound onError: \" + i + \", \" + i1);\n                return true;\n            }\n        });\n    } catch (Exception e) {\n        Log.e(TAG, \"playAudioFile: \", e);\n    }\n}\n</code></pre>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#_4","title":"\u64ad\u653e\u5728\u7ebf\u97f3\u9891","text":"<p>\u8bbe\u7f6eurl\uff0c\u64ad\u653e\u5728\u7ebf\u97f3\u9891</p> <pre><code>private void playOnlineSound(String soundUrlDict) {\n    try {\n        MediaPlayer mediaPlayer = new MediaPlayer();\n        mediaPlayer.setDataSource(soundUrlDict);\n        mediaPlayer.prepareAsync();\n        mediaPlayer.setOnPreparedListener(new MediaPlayer.OnPreparedListener() {\n            @Override\n            public void onPrepared(MediaPlayer mediaPlayer) {\n                mediaPlayer.start();\n            }\n        });\n        mediaPlayer.setOnCompletionListener(new MediaPlayer.OnCompletionListener() {\n            @Override\n            public void onCompletion(MediaPlayer mp) {\n                if (mp != null) {\n                    mp.release();\n                }\n                Log.d(TAG, \"onCompletion: play sound.\");\n            }\n        });\n        mediaPlayer.setOnErrorListener(new MediaPlayer.OnErrorListener() {\n            @Override\n            public boolean onError(MediaPlayer mediaPlayer, int i, int i1) {\n                Log.d(TAG, \"Play online sound onError: \" + i + \", \" + i1);\n                return false;\n            }\n        });\n    } catch (IOException e1) {\n        Log.e(TAG, \"url: \", e1);\n    }\n}\n</code></pre> <p>\u4ee3\u7801\u53ef\u4ee5\u53c2\u8003\u793a\u4f8b\u5de5\u7a0b\uff1a https://github.com/RustFisher/android-MediaPlayer</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_audio/#_5","title":"\u53c2\u8003","text":"<ul> <li>Android MediaPlayer \u57fa\u7840\u7b80\u4ecb</li> <li>Android MediaPlayer \u64ad\u653e\u97f3\u9891</li> <li>Android \u4f7f\u7528URLConnection\u4e0b\u8f7d\u97f3\u9891\u6587\u4ef6</li> <li>Android MediaPlayer \u97f3\u9891\u500d\u901f\u64ad\u653e\uff0c\u8c03\u6574\u64ad\u653e\u901f\u5ea6</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u6398\u91d1 \u7b80\u4e66 51CTO</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_speed/","title":"Android MediaPlayer \u97f3\u9891\u500d\u901f\u64ad\u653e\uff0c\u8c03\u6574\u64ad\u653e\u901f\u5ea6","text":"\u66f4\u65b0\u65e5\u671f 2022-08-03 <ul> <li>2022-08-03 \u66f4\u65b0\u8bf4\u660e</li> </ul> <p>\u73b0\u5728\u5e02\u9762\u4e0a\u7684\u5f88\u591a\u97f3\u89c6\u9891App\u90fd\u6709\u500d\u901f\u64ad\u653e\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u628a\u64ad\u653e\u901f\u5ea6\u8c03\u6574\u4e3a0.5\u30011.5\u30012\u500d\u7b49\u7b49\u3002</p> <p>\u4eceAndroid API 23 (Android M)\u5f00\u59cb\uff0cMediaPlayer\u652f\u6301\u8c03\u6574\u64ad\u653e\u901f\u5ea6\u3002</p> <p>\u4f7f\u7528\u7684\u65b9\u6cd5\u662f<code>setPlaybackParams</code>\uff0c\u4f20\u5165\u4e00\u4e2a\u4ee3\u8868\u64ad\u653e\u5c5e\u6027\u7684\u7c7bPlaybackParams\u3002</p> <p>\u672c\u6587\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528MediaPlayer\u8c03\u6574\u64ad\u653e\u901f\u5ea6\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_speed/#mediaplayersetplaybackparams","title":"MediaPlayer.setPlaybackParams \u8bf4\u660e","text":"<p>\u64ad\u653e\u901f\u5ea6\u8bbe\u7f6e\u5728PlaybackParams\u5bf9\u8c61\u4e2d\uff0c\u518d\u5c06\u6b64\u5bf9\u8c61\u4f20\u5165<code>setPlaybackParams</code>\u3002</p> <p><code>setPlaybackParams</code>\u662f\u4e00\u4e2anative\u65b9\u6cd5\u3002</p> <p>\u5982\u679cMediaPlayer\u6ca1\u6709\u51c6\u5907\uff08\u5728prepared\u4e4b\u524d\uff09\uff0c\u8c03\u7528\u6b64\u65b9\u6cd5\u5e76\u4e0d\u4f1a\u6539\u53d8MediaPlayer\u7684\u72b6\u6001\u3002</p> <p>\u5728MediaPlayer\u6210\u529fprepare\u4e4b\u540e\uff0c\u5982\u679c\u8bbe\u7f6e\u7684\u901f\u5ea6\u4e3a0\uff0c\u76f8\u5f53\u4e8e\u8c03\u7528\u4e86pause\u65b9\u6cd5\uff1b\u5982\u679c\u8bbe\u7f6e\u901f\u5ea6\u4e0d\u4e3a0\uff0c\u76f8\u5f53\u4e8e\u8c03\u7528\u4e86start\u65b9\u6cd5\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_speed/#_1","title":"\u5f02\u5e38\u60c5\u51b5","text":"<p>\u5982\u679cMediaPlayer\u6ca1\u6709\u521d\u59cb\u5316\u6216\u8005\u5df2\u7ecf\u88ab\u91ca\u653e\uff0c\u5373\u5904\u4e8eIdle\u6216End\u72b6\u6001\uff0c\u8c03\u7528setPlaybackParams\u65b9\u6cd5\u4f1a\u629b\u51faIllegalStateException\u5f02\u5e38\u3002</p> <p>\u5982\u679c\u4f20\u5165\u7684PlaybackParams\u4e0d\u88ab\u652f\u6301\uff0c\u5219\u629b\u51faIllegalArgumentException\u5f02\u5e38\u3002</p> <p>\u5982\u679c\u8bbe\u7f6e\u901f\u5ea6\u5c0f\u4e8e0\uff0c\u5219\u629b\u51fajava.lang.IllegalArgumentException\u5f02\u5e38\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_speed/#mediaplayersetplaybackparams_1","title":"MediaPlayer.setPlaybackParams \u65b9\u6cd5\u793a\u4f8b","text":"<p>\u8bbe\u7f6e\u64ad\u653e\u901f\u5ea6\u3002\u5148\u5224\u65ad\u5f53\u524d\u7cfb\u7edf\u7248\u672c\u3002</p> <pre><code>private boolean setPlaySpeed(float speed) {\n    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) {\n        PlaybackParams params = mediaPlayer.getPlaybackParams();\n        params.setSpeed(speed);\n        mediaPlayer.setPlaybackParams(params);\n        return true;\n    }\n    return false;\n}\n</code></pre> <p>getPlaybackParams\u53ef\u4ee5\u83b7\u53d6\u5230MediaPlayer\u5f53\u524d\u7684PlaybackParams\u5bf9\u8c61\u3002 \u4e5f\u53ef\u4ee5\u7ed9\u8fd9\u4e2a\u65b9\u6cd5\u52a0\u4e0atry catch\uff0c\u7ed3\u5408\u8fd4\u56de\u7684boolean\u503c\u5224\u65ad\u8bbe\u7f6e\u901f\u5ea6\u662f\u5426\u6210\u529f\u3002</p> <pre><code>private boolean setPlaySpeed(float speed) {\n    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) {\n        try {\n            PlaybackParams params = mediaPlayer.getPlaybackParams();\n            params.setSpeed(speed);\n            mediaPlayer.setPlaybackParams(params);\n            return true;\n        } catch (Exception e) {\n            Log.e(TAG, \"setPlaySpeed: \", e);\n            return false;\n        }\n    }\n    return false;\n}\n</code></pre> <p>\u53c2\u8003\u4ee3\u7801 https://github.com/RustFisher/android-MediaPlayer</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_speed/#playbackparams","title":"PlaybackParams \u5305\u542b\u7684\u901f\u5ea6\u503c","text":"<p>\u8c03\u6574MediaPlayer\u64ad\u653e\u901f\u5ea6\u65f6\uff0c\u6211\u4eec\u4f7f\u7528\u4e86PlaybackParams\u5bf9\u8c61\u3002AudioTrack\u4e5f\u4f1a\u7528\u5230\u8fd9\u4e2a\u7c7b\u3002</p> <p>PlaybackParams\u5305\u542b\u7740\u64ad\u653e\u65f6\u5019\u7684\u4e00\u4e9b\u5c5e\u6027\u3002\u4f8b\u5982speed\u5c31\u662f\u64ad\u653e\u901f\u5ea6\u3002</p>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_speed/#playbackparamssetspeedfloat-speed","title":"PlaybackParams.setSpeed(float speed)","text":"<p>\u4f20\u5165\u901f\u5ea6\u500d\u7387\u503c\u3002\u4f1a\u6807\u8bb0\u5f53\u524d\u8bbe\u7f6e\u8fc7\u4e86\u901f\u5ea6\u3002</p> <pre><code>public PlaybackParams setSpeed(float speed) {\n    mSpeed = speed;\n    mSet |= SET_SPEED;\n    return this;\n}\n</code></pre>","tags":["Android Media"]},{"location":"android/media/MediaPlayer_use_play_speed/#playbackparamsgetspeed","title":"PlaybackParams.getSpeed()","text":"<p>\u83b7\u53d6\u5df2\u8bbe\u7f6e\u7684\u901f\u5ea6\u503c\u3002\u5982\u679c\u4e4b\u524d\u6ca1\u8bbe\u7f6e\u8fc7\u901f\u5ea6\uff0c\u5219\u629b\u51faIllegalStateException\u5f02\u5e38\u3002</p> <pre><code>public float getSpeed() {\n    if ((mSet &amp; SET_SPEED) == 0) {\n        throw new IllegalStateException(\"speed not set\");\n    }\n    return mSpeed;\n}\n</code></pre> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u6398\u91d1 \u7b80\u4e66 51CTO</p>","tags":["Android Media"]},{"location":"android/media/camera2-get-size-fps-en/","title":"Android Camera2 get size and fps info","text":"update: 2022-2-8 <ul> <li>2022-2-8 create</li> </ul>","tags":["Android Camera"]},{"location":"android/media/camera2-get-size-fps-en/#camera","title":"Camera","text":"<p>We use <code>android.hardware.Camera</code> to get supported preview size and fps infomation.</p> <p><code>Camera.open</code> for <code>camera</code> instance, then <code>camera.getParameters()</code> for parameters.</p> <pre><code>for (int i = 0; i &lt; Camera.getNumberOfCameras(); i++) {\n    Camera camera = null;\n    try {\n        camera = Camera.open(i);\n        Parameters parameters = camera.getParameters();\n        supportedSizes = parameters.getSupportedPreviewSizes();\n        supportedFpsRanges = parameters.getSupportedPreviewFpsRange();\n    } catch (RuntimeException e) {\n        Log.e(TAG, \"Failed to open, skipping\", e);\n        continue;\n    } finally {\n        if (camera != null) {\n            camera.release();\n        }\n    }\n}\n</code></pre> <p><code>android.hardware.Camera</code>: we call it\u300ccamera\u300dor\u300ccamera1\u300d belowing</p> <p>Above code for some phones (eg. HONOR X10) that have lifting front camera, <code>Camera.open</code> could rise the front camera. User may feel weird about it, the front camera just show up and go back.</p> HONOR X10 front camera <p></p> <p>We should consider using Camera2 to get preview size. No more<code>Camera.open</code>.</p>","tags":["Android Camera"]},{"location":"android/media/camera2-get-size-fps-en/#camera2","title":"Camera2","text":"","tags":["Android Camera"]},{"location":"android/media/camera2-get-size-fps-en/#gradle-camera2","title":"gradle camera2","text":"<p>This demo is a module. Now we take a look in module gradle.</p> <p>We need androidx packages.</p> <ul> <li>compileSdk 31</li> <li>androidx.camera:camera-core:1.1.0-beta01</li> <li>androidx.camera:camera-camera2:1.1.0-beta01</li> </ul> <p><pre><code>apply plugin: 'com.android.library'\n\nandroid {\n    compileSdk 31\n    defaultConfig {\n        minSdkVersion 19\n        targetSdkVersion 31\n        versionCode 110\n        versionName \"1.1.0\"\n        testInstrumentationRunner \"android.support.test.runner.AndroidJUnitRunner\"\n    }\n\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n        }\n    }\n}\n\ndependencies {\n    implementation fileTree(include: ['*.jar'], dir: 'libs')\n    implementation 'androidx.appcompat:appcompat:1.3.1'\n    testImplementation 'junit:junit:4.12'\n    androidTestImplementation 'com.android.support.test:runner:1.0.2'\n    androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'\n\n    implementation \"androidx.camera:camera-core:1.1.0-beta01\"\n    implementation \"androidx.camera:camera-camera2:1.1.0-beta01\"\n}\n</code></pre> NOTICE: Here <code>minSdkVersion 19</code>. So we need to judge Android version.</p> <p>camera2's version in beta01, we believe camera2 is developing.</p>","tags":["Android Camera"]},{"location":"android/media/camera2-get-size-fps-en/#use-camera2","title":"Use camera2","text":"<p>First look at these imported package, most about camera2 <pre><code>import android.hardware.camera2.CameraAccessException;\nimport android.hardware.camera2.CameraCharacteristics;\nimport android.hardware.camera2.CameraManager;\nimport android.hardware.camera2.params.StreamConfigurationMap;\nimport android.os.Build;\n</code></pre></p> <p>Check the running Android SDK version, required API &gt;= 21(LOLLIPOP).</p> <p>Get the CameraManager instance by using <code>getSystemService</code>. <pre><code>if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {\n    CameraManager cameraManager = (CameraManager) mContext.getSystemService(Context.CAMERA_SERVICE);\n}\n</code></pre> Not like camera1, camera2 can get the infomation about camera without calling <code>Camera.open</code>.</p> <p>Camera.Size in <code>android.hardware</code> package is deprecated. Camera2 uses <code>android.util.Size</code>. <pre><code>List&lt;android.util.Size&gt; supportedUtilSize = new ArrayList&lt;&gt;();\nCameraCharacteristics characteristics = cameraManager.getCameraCharacteristics(\"0\"); // 0 or 1\nStreamConfigurationMap configs = characteristics.get(CameraCharacteristics.SCALER_STREAM_CONFIGURATION_MAP);\nsupportedUtilSize = Arrays.asList(configs.getOutputSizes(ImageFormat.JPEG));\n</code></pre></p> <p>For fps range, here use Range class. <pre><code>CameraCharacteristics characteristics = cameraManager.getCameraCharacteristics(\"1\"); // 0 or 1\nRange&lt;Integer&gt;[] ranges21 = characteristics.get(CameraCharacteristics.CONTROL_AE_AVAILABLE_TARGET_FPS_RANGES);\n</code></pre> <p>Don't forget to check Android version <pre><code>if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {\n    // do your work\n}\n</code></pre></p>","tags":["Android Camera"]},{"location":"android/media/camera2-get-size-fps-en/#range","title":"Range","text":"<p>We got Range to store fps range in above code. <pre><code>package android.util;\n\npublic final class Range&lt;T extends Comparable&lt;? super T&gt;&gt; {\n</code></pre> <p>Range needs T who extends Comparable. We used Range before, here is Integer class infomation. <pre><code>package java.lang;\n\npublic final class Integer extends Number implements Comparable&lt;Integer&gt; \n</code></pre> <p>Range provides some useful functions. It remands me set in math. </p> <p>Some function:</p> <p><code>public boolean contains(T value)</code></p> <p>eg. We got [1, 100], input 99, output true.</p> <p><code>public boolean contains(Range&lt;T&gt; range)</code></p> <p>eg. For [1, 300], input [2, 333], output false.</p> <p><code>public T clamp(T value)</code></p> <p>eg. For [1, 10], input 3, output 3. Input 32, output 10(the max value).</p> also publish at <ul> <li>medium</li> </ul>","tags":["Android Camera"]},{"location":"android/media/camera2-get-size-fps/","title":"Android Camera2\u83b7\u53d6\u9884\u89c8\u5c3a\u5bf8\u548cfps\u8303\u56f4","text":"\u66f4\u65b0\u65e5\u671f: 2022-6-10 <ul> <li>2022-6-10 \u66f4\u65b0\u683c\u5f0f</li> <li>2022-2-23 \u66f4\u65b0\u8bf4\u660e</li> <li>2022-2-8 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u5347\u964d\u6444\u50cf\u5934\u5b89\u5353\u624b\u673a\u521a\u4e0a\u5e02\u7684\u65f6\u5019\uff0c\u6709\u4e9b\u5f88\u6d41\u884c\u7684app\u521a\u6253\u5f00\u65f6\uff0c\u524d\u7f6e\u6444\u50cf\u5934\u5c31\u5347\u8d77\u6765\u4e86\u3002\u597d\u50cf\u5c31\u662f\u51fa\u6765\u770b\u4e00\u773c\u7136\u540e\u53c8\u6536\u56de\u53bb\u3002 \u867d\u7136\u6211\u4eec\u4e0d\u8c03\u7528\u62cd\u7167\u529f\u80fd\uff0c\u53ea\u662f\u4e3a\u4e86\u83b7\u53d6\u76f8\u673a\u7684\u4fe1\u606f\uff0c\u4e5f\u662f\u53ef\u80fd\u8ba9\u6444\u50cf\u5934\u5347\u8d77\u6765\u7684\u3002</p>","tags":["Android Camera"]},{"location":"android/media/camera2-get-size-fps/#camera","title":"Camera\u5b9e\u73b0","text":"<p>\u4f7f\u7528<code>android.hardware.Camera</code>\u83b7\u53d6\u6444\u50cf\u5934\u652f\u6301\u7684\u9884\u89c8\u5c3a\u5bf8\u548cfps\u3002 \u5148<code>Camera.open</code>\u83b7\u53d6\u5230<code>camera</code>\u5b9e\u4f8b\uff0c\u7136\u540e\u518d<code>camera.getParameters()</code>\u3002 <pre><code>for (int i = 0; i &lt; Camera.getNumberOfCameras(); i++) {\n    Camera camera = null;\n    try {\n        camera = Camera.open(i);\n        Parameters parameters = camera.getParameters();\n        supportedSizes = parameters.getSupportedPreviewSizes();\n        supportedFpsRanges = parameters.getSupportedPreviewFpsRange();\n    } catch (RuntimeException e) {\n        Log.e(TAG, \"Failed to open, skipping\", e);\n        continue;\n    } finally {\n        if (camera != null) {\n            camera.release();\n        }\n    }\n}\n</code></pre></p> <p><code>android.hardware.Camera</code>\uff1a\u4e0b\u6587\u7b80\u79f0\u4e3a\u300ccamera\u300d\u6216\u8005\u300ccamera1\u300d\u3002</p> <p>\u4e0a\u9762\u7684\u4ee3\u7801\u5bf9\u4e8e\u53ef\u5347\u964d\u6444\u50cf\u5934\u624b\u673a\uff08\u4f8b\u5982\u8363\u8000X10\uff09\u6765\u8bf4\uff0c\u524d\u7f6e\u6444\u50cf\u5934\u4f1a\u5347\u8d77\u6765\uff0c\u7136\u540e\u53c8\u7f29\u56de\u53bb\u3002\u7528\u6237\u4f53\u9a8c\u4e0d\u597d\u3002</p> \u8363\u8000X10\u524d\u7f6e\u6444\u50cf\u5934 <p></p> <p>\u53ef\u4ee5\u7528Camera2\u6765\u5b9e\u73b0\uff0c\u4e0d\u7528\u6253\u5f00\u6444\u50cf\u5934\u5c31\u80fd\u83b7\u53d6\u5230\u76f8\u5173\u4fe1\u606f\u3002</p>","tags":["Android Camera"]},{"location":"android/media/camera2-get-size-fps/#camera2","title":"Camera2","text":"","tags":["Android Camera"]},{"location":"android/media/camera2-get-size-fps/#camera2_1","title":"\u5f15\u5165camera2","text":"<p>\u9996\u5148\u770b\u6a21\u5757\u7684gradle\u3002\u672c\u6587\u793a\u4f8b\u662f\u653e\u5728\u6a21\u5757\u91cc\u7684\u3002 \u6211\u4eec\u9700\u8981\u5f15\u5165androidx\u76f8\u5173\u7684\u5305\u3002</p> <ul> <li>compileSdk 31</li> <li>androidx.camera:camera-core:1.1.0-beta01</li> <li>androidx.camera:camera-camera2:1.1.0-beta01</li> </ul> <pre><code>apply plugin: 'com.android.library'\n\nandroid {\n    compileSdk 31\n    defaultConfig {\n        minSdkVersion 19\n        targetSdkVersion 31\n        versionCode 110\n        versionName \"1.1.0\"\n        testInstrumentationRunner \"android.support.test.runner.AndroidJUnitRunner\"\n    }\n\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n        }\n    }\n}\n\ndependencies {\n    implementation fileTree(include: ['*.jar'], dir: 'libs')\n    implementation 'androidx.appcompat:appcompat:1.3.1'\n    testImplementation 'junit:junit:4.12'\n    androidTestImplementation 'com.android.support.test:runner:1.0.2'\n    androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'\n\n    implementation \"androidx.camera:camera-core:1.1.0-beta01\" // (1)\n    implementation \"androidx.camera:camera-camera2:1.1.0-beta01\"\n}\n</code></pre> <ol> <li>\u8fd9\u91cc\u4f7f\u7528\u7684\u662fbeta01\u7248\u7684camera2\u5305\uff0c\u53ef\u4ee5\u770b\u51facamera2\u4ecd\u5728\u53d1\u5c55\u4e2d</li> </ol> <p>\u6ce8\u610f\u8fd9\u91cc<code>minSdkVersion 19</code>\uff0c\u540e\u9762\u4f7f\u7528\u7684\u65f6\u5019\u9700\u8981\u5224\u65ad\u4e00\u4e0b\u8fd0\u884c\u7684Android\u7248\u672c</p>","tags":["Android Camera"]},{"location":"android/media/camera2-get-size-fps/#_1","title":"\u4f7f\u7528","text":"<p>\u90e8\u5206\u5bfc\u5165\u7684\u5305\u7684\u60c5\u51b5 <pre><code>import android.hardware.camera2.CameraAccessException;\nimport android.hardware.camera2.CameraCharacteristics;\nimport android.hardware.camera2.CameraManager;\nimport android.hardware.camera2.params.StreamConfigurationMap;\nimport android.os.Build;\n</code></pre></p> <p>\u7528\u83b7\u53d6\u7cfb\u7edf\u670d\u52a1\u7684\u65b9\u5f0f\u6765\u83b7\u53d6CameraManager\uff0c\u8fd9\u91cc\u8981\u6c42 API &gt;= 21 <pre><code>if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {\n    CameraManager cameraManager = (CameraManager) mContext.getSystemService(Context.CAMERA_SERVICE);\n}\n</code></pre> Camera2\u76f8\u6bd4\u4e8ecamera1\u7684\u4e00\u5927\u4e0d\u540c\u662f\uff0cCamera2\u4e0d\u9700\u8981\u8c03\u7528<code>Camera.open</code>\u65b9\u6cd5\uff0c\u5c31\u80fd\u53bb\u67e5\u8be2\u76f8\u673a\u7684\u4e00\u4e9b\u914d\u7f6e\u3002</p> <p>\u83b7\u53d6\u652f\u6301\u7684\u5c3a\u5bf8\u3002<code>android.hardware</code>\u5305\u91cc\u7684Camera.Size\u5df2\u7ecf\u4e0d\u63a8\u8350\u4f7f\u7528\u4e86\uff08Deprecated\uff09\u3002Camera2\u7528\u7684\u662f<code>android.util.Size</code>\u3002 <pre><code>List&lt;android.util.Size&gt; supportedUtilSize = new ArrayList&lt;&gt;();\nCameraCharacteristics characteristics = cameraManager.getCameraCharacteristics(\"0\"); // 0\u548c1\nStreamConfigurationMap configs = characteristics.get(CameraCharacteristics.SCALER_STREAM_CONFIGURATION_MAP);\nsupportedUtilSize = Arrays.asList(configs.getOutputSizes(ImageFormat.JPEG));\n</code></pre></p> <p>\u83b7\u53d6\u652f\u6301\u7684fps\u8303\u56f4\uff0c\u7ed3\u679c\u7528Range\u6765\u8868\u793a\u3002 <pre><code>CameraCharacteristics characteristics = cameraManager.getCameraCharacteristics(\"1\"); // 0\u548c1\nRange&lt;Integer&gt;[] ranges21 = characteristics.get(CameraCharacteristics.CONTROL_AE_AVAILABLE_TARGET_FPS_RANGES);\n</code></pre> <p>\u6ce8\u610f\u4e0a\u9762\u7684\u4ee3\u7801\u9700\u8981\u5224\u65ad\u7cfb\u7edf\u7248\u672c <pre><code>if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {\n    // \u5728\u8fd9\u91cc\u9762\u8fdb\u884c\u64cd\u4f5c\n}\n</code></pre></p>","tags":["Android Camera"]},{"location":"android/media/camera2-get-size-fps/#range","title":"Range\u4ecb\u7ecd","text":"<p>\u83b7\u53d6fps\u6570\u636e\u65f6\u6211\u4eec\u7528\u5230\u4e86Range\u7c7b\u3002 <pre><code>package android.util;\n\npublic final class Range&lt;T extends Comparable&lt;? super T&gt;&gt; {\n</code></pre> \u5b83\u63a5\u53d7\u7684\u8303\u578b\u8981\u80fd\u591f\u8fdb\u884c\u6bd4\u8f83\uff0c\u5373\u7ee7\u627fComparable\u3002\u524d\u9762\u7684\u4ee3\u7801\u6211\u4eec\u7528\u7684\u662fRange\u3002 <pre><code>package java.lang;\n\npublic final class Integer extends Number implements Comparable&lt;Integer&gt; \n</code></pre> <p>Range\u8868\u793a\u8303\u56f4\u3002\u5b83\u4ee3\u8868\u4e86\u4e00\u4e2a\u8303\u56f4\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e9b\u5e38\u7528\u7684\u65b9\u6cd5\u3002\u6bd4\u8f83\u7c7b\u4f3c\u6570\u5b66\u4e2d\u7684\u96c6\u5408\u7684\u6982\u5ff5\u3002</p> <p>\u4f8b\u5982\uff1a</p> <ul> <li>\u5224\u65ad\u76ee\u6807\u503c\u662f\u5426\u5728\u8303\u56f4\u91cc<code>public boolean contains(T value)</code></li> <li>\u5224\u65ad\u4f20\u5165\u7684\u8303\u56f4\u662f\u5426\u5728\u81ea\u5df1\u7684\u8303\u56f4\u91cc\u9762<code>public boolean contains(Range&lt;T&gt; range)</code></li> <li>\u83b7\u53d6\u4e00\u4e2a\u8303\u56f4\u5185\u7684\u6570\u503c\uff0c\u5373\u9650\u5236\u6570\u503c\u4e0d\u80fd\u8d85\u8fc7\u81ea\u5df1\u7684\u8303\u56f4 <code>public T clamp(T value)</code>\u3002\u5047\u8bbe\u8303\u56f4\u662f0\u523010\uff0c\u4f20\u516512\uff0c\u5219\u8fd4\u56de10\uff0c\u4e5f\u5c31\u662f\u4e0a\u9650\u3002</li> </ul>","tags":["Android Camera"]},{"location":"android/media/camera2-get-size-fps/#_2","title":"\u53c2\u8003","text":"<ul> <li>Android CameraX \u6253\u5f00\u6444\u50cf\u5934\u9884\u89c8</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog 51CTO</p>","tags":["Android Camera"]},{"location":"android/media/intro/h264-intro/","title":"H.264\u7b80\u4ecb","text":"\u66f4\u65b0\u65e5\u671f: 2019-10-14 <ul> <li>2019-10-14 \u521b\u5efa\u6587\u6863</li> </ul> <p>H.264\uff0c\u53c8\u79f0\u4e3aMPEG-4\u7b2c10\u90e8\u5206\uff0c\u9ad8\u7ea7\u89c6\u9891\u7f16\u7801\u662f\u4e00\u79cd\u9762\u5411\u5757\uff0c\u57fa\u4e8e\u8fd0\u52a8\u8865\u507f\u7684\u89c6\u9891\u7f16\u7801\u6807\u51c6\u3002 \u52302014\u5e74\uff0c\u5b83\u5df2\u7ecf\u6210\u4e3a\u9ad8\u7cbe\u5ea6\u89c6\u9891\u5f55\u5236\u3001\u538b\u7f29\u548c\u53d1\u5e03\u7684\u6700\u5e38\u7528\u683c\u5f0f\u4e4b\u4e00\u3002</p> <p>\u4f18\u52bf\uff1a</p> <ul> <li>1\uff09\u7f51\u7edc\u4eb2\u548c\u6027\uff0c\u5373\u53ef\u9002\u7528\u4e8e\u5404\u79cd\u4f20\u8f93\u7f51\u7edc</li> <li>2\uff09\u9ad8\u7684\u89c6\u9891\u538b\u7f29\u6bd4</li> </ul>"},{"location":"android/media/intro/h264-intro/#_1","title":"\u540d\u8bcd\u89e3\u91ca","text":""},{"location":"android/media/intro/h264-intro/#vcl-video-coding-layer","title":"\u89c6\u9891\u7f16\u7801\u5c42(VCL, Video Coding Layer)","text":"<p>\u8d1f\u8d23\u6709\u6548\u8868\u793a\u89c6\u9891\u6570\u636e\u7684\u5185\u5bb9</p>"},{"location":"android/media/intro/h264-intro/#nal-network-abstraction-layer","title":"\u7f51\u7edc\u63d0\u53d6\u5c42(NAL, Network Abstraction Layer)","text":"<p>\u8d1f\u8d23\u683c\u5f0f\u5316\u6570\u636e\u5e76\u63d0\u4f9b\u5934\u4fe1\u606f\uff0c\u4ee5\u4fdd\u8bc1\u6570\u636e\u9002\u5408\u5404\u79cd\u4fe1\u9053\u548c\u5b58\u50a8\u4ecb\u8d28\u4e0a\u7684\u4f20\u8f93\u3002 \u4ee5\u5c06NAL\u5f53\u6210\u662f\u4e00\u4e2a\u4e13\u4f5c\u5c01\u88c5(packaging)\u7684\u6a21\u5757\uff0c\u7528\u6765\u5c06VCL\u538b\u7f29\u8fc7\u7684bitstream\u5c01\u88c5\u6210\u9002\u5f53\u5927\u5c0f\u7684\u5c01\u5305\u5355\u4f4d(NAL-unit)\uff0c\u5e76\u5728NAL-unit Header\u4e2d\u7684NAL-unit Type\u5b57\u6bb5\u8bb0\u8f7d\u6b64\u5c01\u5305\u7684\u578b\u5f0f\uff0c\u6bcf\u79cd\u578b\u5f0f\u5206\u522b\u5bf9\u5e94\u5230VCL\u4e2d\u4e0d\u540c\u7684\u7f16\u89e3\u7801\u5de5\u5177\u3002</p>"},{"location":"android/media/intro/h264-intro/#_2","title":"\u573a\u548c\u5e27","text":"<p>\u89c6\u9891\u7684\u4e00\u573a\u6216\u4e00\u5e27\u53ef\u7528\u6765\u4ea7\u751f\u4e00\u4e2a\u7f16\u7801\u56fe\u50cf\u3002\u5728\u7535\u89c6\u4e2d\uff0c\u4e3a\u51cf\u5c11\u5927\u9762\u79ef\u95ea\u70c1\u73b0\u8c61\uff0c\u628a\u4e00\u5e27\u5206\u6210\u4e24\u4e2a\u9694\u884c\u7684\u573a\u3002</p>"},{"location":"android/media/intro/h264-intro/#_3","title":"\u5b8f\u5757","text":"<p>\u4e00\u4e2a\u7f16\u7801\u56fe\u50cf\u901a\u5e38\u5212\u5206\u6210\u82e5\u5e72\u5b8f\u5757\u7ec4\u6210\uff0c\u4e00\u4e2a\u5b8f\u5757\u7531\u4e00\u4e2a16\u00d716\u4eae\u5ea6\u50cf\u7d20\u548c\u9644\u52a0\u7684\u4e00\u4e2a8\u00d78 Cb\u548c\u4e00\u4e2a8\u00d78 Cr\u5f69\u8272\u50cf\u7d20\u5757\u7ec4\u6210\u3002</p>"},{"location":"android/media/intro/h264-intro/#slice","title":"\u7247\uff08slice\uff09","text":"<p>\u6bcf\u4e2a\u56fe\u8c61\u4e2d\uff0c\u82e5\u5e72\u5b8f\u5757\u88ab\u6392\u5217\u6210\u7247\u7684\u5f62\u5f0f\u3002\u7247\u5206\u4e3aI\u7247\u3001B\u7247\u3001P\u7247\u548c\u5176\u4ed6\u4e00\u4e9b\u7247\u3002 I\u7247\u53ea\u5305\u542bI\u5b8f\u5757\uff0cP\u7247\u53ef\u5305\u542bP\u548cI\u5b8f\u5757\uff0c\u800cB\u7247\u53ef\u5305\u542bB\u548cI\u5b8f\u5757\u3002 I\u5b8f\u5757\u5229\u7528\u4ece\u5f53\u524d\u7247\u4e2d\u5df2\u89e3\u7801\u7684\u50cf\u7d20\u4f5c\u4e3a\u53c2\u8003\u8fdb\u884c\u5e27\u5185\u9884\u6d4b\u3002 P\u5b8f\u5757\u5229\u7528\u524d\u9762\u5df2\u7f16\u7801\u56fe\u8c61\u4f5c\u4e3a\u53c2\u8003\u56fe\u8c61\u8fdb\u884c\u5e27\u5185\u9884\u6d4b\u3002 B\u5b8f\u5757\u5219\u5229\u7528\u53cc\u5411\u7684\u53c2\u8003\u56fe\u8c61\uff08\u524d\u4e00\u5e27\u548c\u540e\u4e00\u5e27\uff09\u8fdb\u884c\u5e27\u5185\u9884\u6d4b\u3002</p> <p>\u7247\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u9650\u5236\u8bef\u7801\u7684\u6269\u6563\u548c\u4f20\u8f93\uff0c\u4f7f\u7f16\u7801\u7247\u76f8\u4e92\u95f4\u662f\u72ec\u7acb\u7684\u3002 \u67d0\u7247\u7684\u9884\u6d4b\u4e0d\u80fd\u4ee5\u5176\u5b83\u7247\u4e2d\u7684\u5b8f\u5757\u4e3a\u53c2\u8003\u56fe\u50cf\uff0c\u8fd9\u6837\u67d0\u4e00\u7247\u4e2d\u7684\u9884\u6d4b\u8bef\u5dee\u624d\u4e0d\u4f1a\u4f20\u64ad\u5230\u5176\u5b83\u7247\u4e2d\u53bb\u3002</p> <p>H264\u7ed3\u6784\u4e2d\uff0c\u4e00\u4e2a\u89c6\u9891\u56fe\u50cf\u7f16\u7801\u540e\u7684\u6570\u636e\u53eb\u505a\u4e00\u5e27\uff0c\u4e00\u5e27\u7531\u4e00\u4e2a\u7247\uff08slice\uff09\u6216\u591a\u4e2a\u7247\u7ec4\u6210\uff0c \u4e00\u4e2a\u7247\u7531\u4e00\u4e2a\u6216\u591a\u4e2a\u5b8f\u5757\uff08MB\uff09\u7ec4\u6210\uff0c\u4e00\u4e2a\u5b8f\u5757\u753116x16\u7684yuv\u6570\u636e\u7ec4\u6210\u3002\u5b8f\u5757\u4f5c\u4e3aH264\u7f16\u7801\u7684\u57fa\u672c\u5355\u4f4d\u3002</p>"},{"location":"android/media/intro/h264-intro/#h264sps-pps","title":"H.264\u7801\u6d41\u4e2dSPS PPS","text":"<p>SPS Sequence Paramater Set\uff0c\u53c8\u79f0\u4f5c\u5e8f\u5217\u53c2\u6570\u96c6\u3002 PPS Picture Paramater Set\uff0c\u56fe\u50cf\u53c2\u6570\u96c6\u3002</p> <p>\u5728H.264\u7684SPS\u4e2d\uff0c\u7b2c\u4e00\u4e2a\u5b57\u8282\u8868\u793a<code>profile_idc</code>,\u6839\u636e<code>profile_idc</code>\u7684\u503c\u53ef\u4ee5\u786e\u5b9a\u7801\u6d41\u7b26\u5408\u54ea\u4e00\u79cd\u6863\u6b21\u3002 <pre><code>private static final byte[] SPS = {(byte) 0x00, (byte) 0x00, (byte) 0x01, (byte) 0x67, (byte) 0x4d, (byte) 0x00, (byte) 0x1f, (byte) 0xe5, (byte) 0x40, (byte) 0x28, (byte) 0x02, (byte) 0xd8, (byte) 0x80};\nprivate static final byte[] PPS = {(byte) 0x00, (byte) 0x00, (byte) 0x01, (byte) 0x68, (byte) 0xee, (byte) 0x31, (byte) 0x12};\n</code></pre></p> <p>\u53c2\u8003</p> <ul> <li>H.264\u7801\u6d41\u4e2dSPS PPS\u8be6\u89e3 - DaveBobo</li> <li>H.264\u5148\u8fdb\u7684\u89c6\u9891\u7f16\u8bd1\u7801\u6807\u51c6 - CSDN</li> <li>RGB\u3001YUV\u548cYCbCr</li> <li>H264\u7f16\u7801\u603b\u7ed3 - \u7b80\u4e66</li> <li>\u97f3\u89c6\u9891\u6280\u672f\u603b\u7ed3 - leixiaohua1020 CSDN</li> </ul>"},{"location":"android/media/intro/yuv-intro/","title":"YUV\u7b80\u4ecb\uff08\u65e7\u7248\u672c\uff09","text":"\u66f4\u65b0\u65f6\u95f4: 2021-12-29 <ul> <li>2021-12-29: \u589e\u52a0\u8bf4\u660e</li> </ul> <p>\u65b0\u7248\u6587\u6863</p> <p>\u8bf7\u67e5\u770bYUV\u4ecb\u7ecd</p> <p>YUV\u662f\u4e00\u79cd\u989c\u8272\u7f16\u7801\u65b9\u6cd5\u3002</p> <p>\u6570\u5b57\u89c6\u9891\u5e38\u7528YUV\u683c\u5f0f\u6765\u538b\u7f29\u3002\u672c\u6587\u8bb2\u8ff0\u4e86YUV\u89c6\u9891\u7684\u4e00\u4e9b\u57fa\u672c\u6982\u5ff5\uff0c\u4e0d\u6d89\u53caYUV\u538b\u7f29\u5904\u7406\u8ba1\u7b97\u3002</p> <p>\u5728\u7535\u8111\u56fe\u5f62\u4e2d\u6211\u4eec\u5e38\u4f1a\u9047\u5230RGB\u989c\u8272\u3002RGB\u4e2d\u7684\u7ea2\u7eff\u84dd\u76f4\u63a5\u5206\u522b\u5bf9\u5e94\u4e86\u53ef\u89c1\u5149\u7684\u90e8\u5206\u3002</p> <p>RGB\u503c\u80fd\u5efa\u7acb\u4e00\u4e2a\u7cbe\u786e\u7684\u6570\u5b57\u5750\u6807\u7cfb\u7edf\uff0c\u79f0\u4f5c\u989c\u8272\u7a7a\u95f4\uff08color space\uff09\u3002\u7ea2\u8272\u90e8\u5206\u5b9a\u4e49\u4e86\u5750\u6807\u7cfb\u4e2d\u7684\u4e00\u4e2a\u8f74\u3002 \u5176\u6b21\u662f\u7eff\u8272\u548c\u84dd\u8272\u3002\u5982\u4e0b\u56fe\u6240\u793a\u3002\u6240\u6709\u6709\u6548\u7684RGB\u503c\u90fd\u5728\u8fd9\u4e2a\u989c\u8272\u7a7a\u95f4\u91cc\u3002</p> <p>\u4f8b\u5982\u6d0b\u7ea2\u8272\uff08pure magenta\uff09\u662f 100% blue\uff0c100% red\uff0c \u548c 0% green.</p> <p></p> <p>RGB\u662f\u4ee3\u8868\u989c\u8272\u7684\u4e00\u79cd\u65b9\u5f0f\u3002\u5176\u5b83\u5750\u6807\u7cfb\u4e5f\u53ef\u4ee5\u4ee3\u8868\u989c\u8272\u3002  </p> <p>YUV\u662f\u5c06\u4eae\u5ea6\u4fe1\u606f\u548c\u989c\u8272\u4fe1\u606f\u5206\u522b\u7f16\u7801\u7684\u4e00\u7cfb\u5217\u989c\u8272\u7a7a\u95f4\u7684\u7edf\u79f0\u3002\u548cRGB\u76f8\u4f3c\uff0cYUV\u4f7f\u75283\u4e2a\u503c\u6765\u8868\u793a\u989c\u8272\u3002 \u8fd93\u4e2a\u503c\u79f0\u4e3aY'\uff0cU\uff0c\u548cV\u3002\uff08\u4e8b\u5b9e\u4e0a\uff0c<code>YUV</code>\u8fd9\u4e2a\u79f0\u547c\u5728\u7535\u8111\u89c6\u9891\u4e2d\u603b\u662f\u6307\u4ee3<code>Y'CbCr</code>\u3002\u7136\u800c\u5728\u672c\u6587\u4e2d<code>YUV</code>\u7ecf\u5e38\u7528\u6765\u6307\u4ee3\u548c<code>Y'CbCr</code>\u76f8\u540c\u539f\u7406\u7684\u989c\u8272\u7a7a\u95f4\uff09</p> <p>YUV\u7c7b\u4f3cRGB\uff0c\u90fd\u80fd\u4ee3\u8868\u989c\u8272\uff0c\u8868\u793a\u989c\u8272\u3002</p> <p><code>Y'</code>\u90e8\u5206\uff0c\u4e5f\u79f0\u4f5cluma\uff0c\u4ee3\u8868\u989c\u8272\u4e2d\u7684<code>\u4eae\u5ea6\u503c</code>\u3002\u8fd9\u4e2a\u8bb0\u53f7\uff08<code>'</code>\uff09\u662f\u7528\u6765\u4e0e\u79f0\u4e3a<code>Y</code>\u7684luminance\uff08\u4eae\u5ea6\uff09\u4f5c\u533a\u522b\u7684\u3002</p> <p>luminance\u53ef\u4ece\u7ebf\u6027RGB\u503c\u4e2d\u5bfc\u51fa\uff0cluma\u4ece\u975e\u7ebf\u6027\uff08gamma-corrected\uff09RGB\u503c\u4e2d\u5bfc\u51fa\u3002 luminance\u66f4\u63a5\u8fd1\u771f\u5b9e\u4eae\u5ea6\uff0c\u4f46luma\u5728\u6280\u672f\u4e0a\u66f4\u5e38\u7528\u3002 \u70b9\u8bb0\u53f7\uff08<code>'</code>\uff09\u901a\u5e38\u88ab\u5ffd\u7565\uff0c\u4f46YUV\u989c\u8272\u7a7a\u95f4\u603b\u662f\u4f7f\u7528luma\u3002</p> <p>\u6807\u51c6\u5b9a\u4e49\u7535\u89c6\u4e2d\uff0cluma\u8ba1\u7b97\u516c\u5f0f\u4e3a\uff1a <pre><code>Y' = 0.299R + 0.587G + 0.114B\n</code></pre> \u8fd9\u4e2a\u516c\u5f0f\u63ed\u793a\u4e86\u4eba\u773c\u5bf9\u4e8e\u7279\u5b9a\u6ce2\u957f\u7684\u5149\u66f4\u4e3a\u654f\u611f\u3002\u84dd\u8272\u662f\u6700\u6697\u6de1\u7684\uff0c\u7eff\u8272\u662f\u6700\u660e\u4eae\u7684\uff0c\u7ea2\u8272\u5904\u4e8e\u4e24\u8005\u4e4b\u95f4\u3002 \u8fd9\u4e2a\u516c\u5f0f\u4e5f\u5f71\u54cd\u4e86\u65e9\u671f\u7535\u89c6\u4f7f\u7528\u7684\u8367\u5149\u7c89\u3002</p> <p>\u73b0\u4ee3\u7535\u89c6\u6280\u672f\u4f7f\u7528\u4e86\u66f4\u65b0\u7684\u516c\u5f0f\uff0c\u7528\u4e8e\u9ad8\u6e05\u7535\u89c6 <pre><code>Y' = 0.2125R + 0.7154G + 0.0721B\n</code></pre> \u516c\u5f0f\u76f8\u5173\u5b9a\u4e49\u53ef\u67e5\u8be2<code>ITU-R BT.601</code></p> <p>U\u548cV\u90e8\u5206\uff0c\u79f0\u4e3a\u8272\u5ea6\u503c\u6216\u989c\u8272\u533a\u5206\u503c\u3002\u7531\u4ee5\u4e0b\u516c\u5f0f\u8ba1\u7b97\uff1a <pre><code>U = B - Y'\nV = R - Y'\n</code></pre> <code>YUV</code>\u80fd\u591f\u5b8c\u6574\u5730\u8fd8\u539f\u56deRBG\u503c\u3002\u4f20\u8f93\u6765\u7684<code>YUV</code>\uff0c\u80fd\u8f6c\u6362\u4e3a\u76f8\u5e94\u7684\u989c\u8272\u503c\u3002</p>"},{"location":"android/media/intro/yuv-intro/#yuv_1","title":"YUV\u7684\u4f18\u70b9","text":"<p>\u7531\u4e8e\u5386\u53f2\u539f\u56e0\uff0c\u6a21\u62df\u7535\u89c6\u90e8\u5206\u4f7f\u7528\u4e86YUV\u683c\u5f0f\u3002\u6a21\u62df\u5f69\u8272\u7535\u89c6\u4fe1\u53f7\u80fd\u591f\u517c\u5bb9\u4ee5\u524d\u7684\u9ed1\u767d\u7535\u89c6\u3002 \u5f69\u8272\u7535\u89c6\u4fe1\u53f7\u643a\u5e26\u7740\u8272\u5ea6\u503c\uff08U\u548cV\uff09\u4e0e\u7070\u5ea6\u503c\u3002\u9ed1\u767d\u7535\u89c6\u5ffd\u7565\u8272\u5ea6\u503c\uff0c\u663e\u793a\u51fa\u7070\u5ea6\u56fe\u7247\u3002 \u5f69\u8272\u7535\u89c6\u53ef\u4ee5\u63d0\u53d6\u51fa\u8272\u5ea6\u4fe1\u606f\u5e76\u5c06\u4fe1\u53f7\u8fd8\u539f\u56deRGB\u3002</p> <p>\u5728\u4eca\u5929YUV\u6709\u7740\u53e6\u4e00\u4e2a\u4f18\u70b9\u3002\u76f8\u6bd4\u4e8e\u4eae\u5ea6\u7684\u53d8\u6362\uff0c\u4eba\u773c\u5bf9\u4e8e\u8272\u5f69\u7684\u53d8\u6362\u66f4\u8fdf\u949d\u3002\u90a3\u4e48\u4e00\u5f20\u56fe\u7247\u4e2d\uff0c\u53ef\u4ee5\u5c11\u5b58\u653e\u4e00\u4e9b\u8272\u5ea6\u4fe1\u606f\u3002 \u4f8b\u5982\uff0c\u6700\u5f00\u59cb1\u4e2a\u50cf\u7d20\u6709Y'UV\u8fd93\u4e2a\u503c\u3002\u53ef\u4ee5\u5c06\u540c\u6c34\u5e73\u7ebf\uff08horizontal resolution\uff09\u4e0a\u7684\u8272\u5ea6\u503c\u7684\u6570\u91cf\u964d\u4e3a\u4eae\u5ea6\u503c\u6570\u91cf\u7684\u4e00\u534a\u3002</p> <p>\u6362\u8a00\u4e4b\uff0c\u4e00\u884c\u50cf\u7d20\u4e2d\uff0c\u6bcf2\u4e2a\u4eae\u5ea6\u503c\u5171\u75281\u4e2aU\u548cV\u503c\u3002 \u5047\u8bbe\u6bcf\u4e2a\u503c\u662f8\u4f4d\uff0c\u5219\u6bcf2\u4e2a\u50cf\u7d20\u9700\u89814\u4e2a\u5b57\u8282\u6765\u8868\u793a\uff082\u4e2aY'\uff0c1\u4e2aU\u548c1\u4e2aV\uff09\u3002\u5e73\u5747\u4e0b\u6765\u6bcf\u4e2a\u50cf\u7d20\u752816\u4f4d\u6765\u8868\u793a\u3002 \u76f8\u5f53\u4e8e\u635f\u5931\u4e8630%\u768424\u4f4dRGB\u7f16\u7801\u3002</p> <p>\u4e0a\u9762\u7684\u5c0f\u4f8b\u5b50\uff1a\u6700\u5f00\u59cb2\u4e2a\u50cf\u7d20\u5171\u9700\u89816\u4e2a\u5b57\u8282\uff082\u5957Y'UV\uff09\u3002\u73b0\u57282\u4e2a\u50cf\u7d20\u5171\u9700\u89814\u4e2a\u5b57\u8282\uff082\u4e2aY'\uff0c1\u4e2aU\u548c1\u4e2aV\uff09\u3002</p> <p>YUV\u5e76\u6ca1\u6709\u538b\u7f29RGB\u4fe1\u606f\u3002\u9664\u975e\u8272\u5ea6\u503c\u88ab\u964d\u4f4e\u91c7\u6837\u7387\u3002\u4e00\u4e2aYUV\u50cf\u7d20\u548c\u4e00\u4e2aRGB\u50cf\u7d20\u6709\u7740\u76f8\u540c\u7684\u5927\u5c0f\u3002 \u4eceRGB\u6362\u7b97\u6210YUV\u5e76\u6ca1\u6709\u635f\u5931\u4fe1\u606f\u3002\u82e5\u6ca1\u6709\u964d\u91c7\u6837\u7387\uff0c\u4e00\u4e2aYUV\u50cf\u7d20\u53ef\u4ee5\u65e0\u635f\u5730\u8f6c\u6362\u56deRGB\u50cf\u7d20\u3002 \u964d\u4f4e\u91c7\u6837\u7387\u4f1a\u635f\u5931\u4e00\u4e9b\u989c\u8272\u4fe1\u606f\u4f46\u80fd\u8ba9YUV\u56fe\u50cf\u66f4\u5c0f\u3002\u5982\u679c\u5904\u7406\u5f97\u5f53\uff0c\u8fd9\u79cd\u635f\u5931\u662f\u53ef\u4ee5\u63a5\u53d7\u7684\u3002</p>"},{"location":"android/media/intro/yuv-intro/#yuv_2","title":"\u8ba1\u7b97\u673a\u89c6\u9891\u4e2d\u7684YUV","text":"<p>\u4e0a\u9762\u7684YUV\u5e76\u4e0d\u662f\u6570\u5b57\u89c6\u9891\u4e2d\u6700\u51c6\u786e\u7684\u8f6c\u6362\u65b9\u5f0f\u3002\u6570\u5b57\u89c6\u9891\u901a\u5e38\u4f7f\u7528\u4e00\u79cd\u79f0\u4e3a<code>Y'CbCr</code>\u7684YUV\u683c\u5f0f\u3002 \u901a\u5e38\uff0c<code>Y'CbCr</code>\u5bf9\u4e8eYUV\u7684\u8303\u56f4\u662f\uff1a <pre><code>Y'     16\u2013235\nCb/Cr  16\u2013240, with 128 representing zero\n</code></pre> \u4e0a\u9762\u8fd9\u4e9b\u8303\u56f4\u4ee58\u4f4d<code>Y'CbCr</code>\u4e3a\u524d\u63d0\u3002 \u63a5\u4e0b\u6765\u662f<code>Y'CbCr</code>\u7684\u8ba1\u7b97\u8fc7\u7a0b\uff0c\u4f7f\u7528BT.601\u7684luma\u5b9a\u4e49\u3002</p> <ol> <li>RGB\u503c\u8303\u56f4\u662f[0,1]\u3002\u6362\u8a00\u4e4b\u7eaf\u9ed1\u662f0\uff0c\u7eaf\u767d\u662f1.\u8fd9\u4e9b\u662f\u975e\u7ebf\u6027\u7684RGB\u503c\u3002</li> <li>\u8ba1\u7b97luma\u3002BT.601\u4e2d\uff0c<code>Y' = 0.299R + 0.587G + 0.114B</code>\uff0c\u5982\u524d\u6587\u6240\u8ff0\u3002</li> <li>\u8ba1\u7b97\u8272\u5ea6\u503c(B - Y') \u548c (R - Y')\u3002\u8fd9\u4e9b\u503c\u8303\u56f4\uff0c (B - Y')\u8303\u56f4\u662f +/- 0.886\uff1b(R - Y')\u8303\u56f4\u662f+/- 0.701</li> <li>\u7f29\u653e\u8272\u5ea6\u503c <pre><code>Pb = (0.5 / (1 - 0.114)) \u00d7 (B - Y')\nPr = (0.5 / (1 - 0.299)) \u00d7 (R - Y')\n</code></pre> \u8fd9\u91cc\u7684\u7f29\u653e\u56e0\u5b50\u7684\u8bbe\u8ba1\u76ee\u7684\u662f\u4e3a\u4e86\u8ba1\u7b97\u5f97\u5230\u540c\u6837\u7684\u8303\u56f4\uff0c+/- 0.5\u3002 \u5b83\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u79f0\u4e3a<code>Y'PbPr</code>\u7684YUV\u989c\u8272\u7a7a\u95f4\u3002\u8fd9\u79cd\u989c\u8272\u7a7a\u95f4\u7528\u4e8e\u6a21\u62df\u4fe1\u53f7\u89c6\u9891\u3002</li> <li>\u901a\u8fc7<code>Y'PbPr</code>\u8ba1\u7b97\u51fa<code>Y'CbCr</code> <pre><code>Y' = 16 + 219 \u00d7 Y'\nCb = 128 + 224 \u00d7 Pb\nCr = 128 + 224 \u00d7 Pr\n</code></pre> \u8ba1\u7b97\u5f97\u5230\u7684\u503c\u7684\u53d6\u503c\u8303\u56f4\u5c31\u662f\u524d\u9762\u6240\u5217\u7684<code>Y'CbCr</code>\u8303\u56f4\u3002\u5f53\u7136\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5c06RGB\u503c\u8f6c\u6362\u4e3a<code>Y'CbCr</code>\u3002</li> </ol>"},{"location":"android/media/intro/yuv-intro/#_1","title":"\u53c2\u8003","text":"<p>About YUV Video - MSDN</p> <p>Recommended 8-Bit YUV Formats for Video Rendering - MSDN</p>"},{"location":"android/ndk/compile_import_a_file/","title":"Android NDK \u4f7f\u7528.a\u6587\u4ef6","text":"<p>\u4e00\u4e2a\u7f16\u8bd1\u65f6\u4f7f\u7528.a\u6587\u4ef6\u7684\u4f8b\u5b50\u3002\u6d41\u7a0b\u662f\u51c6\u5907\u597d\u5e93\u6587\u4ef6\u4ee5\u53ca\u5bf9\u5e94\u7684\u5934\u6587\u4ef6\uff0c\u7f16\u5199makefile\uff0c\u7f16\u8bd1\u3002</p>"},{"location":"android/ndk/compile_import_a_file/#_1","title":"\u51c6\u5907\u5e93\u6587\u4ef6\u4e0e\u5934\u6587\u4ef6","text":"<p>\u5148\u51c6\u5907\u5934\u6587\u4ef6\u548c<code>.a</code>\u6587\u4ef6\u3002\u8fd9\u91cc\u4ee5ncnn\u76ee\u5f55\u4e3a\u4f8b\u3002</p> <pre><code>|-- Android.mk\n|-- Application.mk\n|-- ncnn\n|   |-- include\n|   |   |-- benchmark.h\n|   |   |-- ....h # \u5bf9\u5e94\u7684\u5934\u6587\u4ef6\n|   |-- lib\n|   |   `-- libncnn.a\n</code></pre>"},{"location":"android/ndk/compile_import_a_file/#makefile","title":"\u7f16\u5199makefile","text":"<p>\u5728<code>Android.mk</code>\u4e2d\u58f0\u660e\u5e93\u6587\u4ef6\u3002 \u8fd9\u91cc\u662f\u5f15\u5165opencv\u7684\u5e93\u3002</p> <pre><code>LOCAL_PATH := $(call my-dir)\n\ninclude $(CLEAR_VARS)\nLOCAL_MODULE    := ncnn\nLOCAL_SRC_FILES := ncnn/lib/libncnn.a\ninclude $(PREBUILT_STATIC_LIBRARY)\n\nLOCAL_STATIC_LIBRARIES := ncnn\n\nOPENCVROOT:=$(LOCAL_PATH)/../../../../../../OpenCV-android-sdk\nOPENCV_CAMERA_MODULES:=off\nOPENCV_INSTALL_MODULES:=on\n#OPENCV_LIB_TYPE:=SHARED\nOPENCV_LIB_TYPE:=STATIC\ninclude ${OPENCVROOT}/sdk/native/jni/OpenCV.mk\n\n# v20 with sse\nLOCAL_SRC_FILES :=  v20/fdssttracker.cpp v20/fhog.cpp v20/runtracker.cpp \\\n                     jni_eman.cpp \\\n                     ncnn/ssdmobilenet.cpp jni_encnn.cpp\n\n# \u540e\u9762\u662f\u6a21\u5757\u7684\u914d\u7f6e\n</code></pre> <p>\u8fd9\u91cc\u8981\u6ce8\u610f\uff0c\u5934\u6587\u4ef6\u548c.a\u6587\u4ef6\u5fc5\u987b\u662f\u5bf9\u5e94\u7684\u3002\u5426\u5219\u7f16\u8bd1\u65f6\u4f1a\u62a5\u9519<code>error: undefined reference to</code></p> <pre><code>E:/projects/myProj/myProject/f1/src/main/jni/ncnn/lib/libncnn.a(net.cpp.o):net.cpp:function ncnn::Net::load_model(__STDIO_FILE_STRUCT*): error: undefined reference to 'stderr'\nE:/projects/myProj/myProject/f1/src/main/jni/ncnn/lib/libncnn.a(net.cpp.o):net.cpp:function ncnn::Net::load_model(char const*): `error: undefined reference to`\n'stderr'\nE:/projects/myProj/myProject/f1/src/main/jni/ncnn/lib/libncnn.a(net.cpp.o):net.cpp:function ncnn::Net::load_model(unsigned char const*): error: undefined reference to 'stderr'\nE:/projects/myProj/myProject/f1/src/main/jni/ncnn/lib/libncnn.a(net.cpp.o):net.cpp:function ncnn::Net::find_blob_index_by_name(char const*) const: error: undefined reference to 'stderr'\nclang++.exe: error: linker command failed with exit code 1 (use -v to see invocation)\nmake: *** [E:/projects/myProj/myProject/f1/src/main/obj/local/armeabi-v7a/libf1.so] Error 1\n</code></pre>"},{"location":"android/ndk/dynamic_reg_function/","title":"NDK\u4e2d\u52a8\u6001\u6ce8\u518cJNI\u65b9\u6cd5","text":"\u66f4\u65b0\u65e5\u671f 2022-6-21 <ul> <li>2022-6-21 \u66f4\u65b0\u4f8b\u5b50</li> <li>2016-8-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>Java\u4e2d\u5b9a\u4e49\u4e86native\u65b9\u6cd5\u540e\uff0c\u5728C/C++\u4e2d\u4f7f\u7528<code>JNI_OnLoad</code>\u51fd\u6570\u6765\u6ce8\u518c\u76f8\u5e94\u7684\u65b9\u6cd5\u3002</p> <p>\u4e00\u822c\u505a\u6cd5\u5982\u4e0b\uff1a</p> <ul> <li>Java\u4e2d\u5b9a\u4e49native\u65b9\u6cd5\uff0c\u786e\u5b9aJava\u6587\u4ef6\u7684\u5305\u540d\u548c\u8def\u5f84</li> <li>\u7f16\u5199C/C++\u6587\u4ef6<ul> <li>\u5b9e\u73b0\u76f8\u5e94\u7684jni\u65b9\u6cd5</li> <li>\u6839\u636eJava\u6587\u4ef6\u8def\u5f84\u548c\u65b9\u6cd5\u7b7e\u540d\u786e\u5b9a<code>JNINativeMethod</code></li> <li>\u5b9e\u73b0<code>JNIEXPORT int JNICALL JNI_OnLoad(JavaVM *vm,void *reserved)</code>\u65b9\u6cd5<ul> <li>\u6ce8\u518cjni\u65b9\u6cd5 <code>RegisterNatives</code></li> </ul> </li> </ul> </li> <li>\u7f16\u8bd1\u751f\u6210so\u6587\u4ef6</li> <li>Java\u4e2d\u52a0\u8f7dso\u5e93\u6587\u4ef6</li> <li>Java\u4e2d\u8c03\u7528native\u65b9\u6cd5</li> </ul> <p>\u76f8\u6bd4\u4e8e\u4e4b\u524d\u7684\u9759\u6001\u6ce8\u518c\uff0c\u8fd9\u91cc\u6ca1\u6709\u7528<code>javah</code>\u751f\u6210\u5934\u6587\u4ef6\u3002</p>"},{"location":"android/ndk/dynamic_reg_function/#java","title":"\u5173\u4e8e\u67e5\u8be2Java\u65b9\u6cd5\u7b7e\u540d","text":"<p>\u5173\u4e8e\u67e5\u8be2Java\u65b9\u6cd5\u7b7e\u540d\uff0c\u53ef\u4ee5\u4f7f\u7528<code>javap -s</code>\u547d\u4ee4\u67e5\u8be2\u76f8\u5e94\u7684class\u6587\u4ef6\u3002</p> <p>\u4f8b\u5982\u67e5\u770b<code>DynamicJNI.java</code>\u7684\u65b9\u6cd5\u7b7e\u540d\uff0c\u5148\u7f16\u8bd1\u51fa<code>DynamicJNI.class</code>\u6587\u4ef6\uff0c\u518d\u67e5\u8be2\u3002 <pre><code>$ javap -s ./build/intermediates/classes/debug/com/rustfisher/appndkground/jni/DynamicJNI.class\nCompiled from \"DynamicJNI.java\"\npublic class com.rustfisher.appndkground.jni.DynamicJNI {\n  public com.rustfisher.appndkground.jni.DynamicJNI();\n    descriptor: ()V\n\n  public static native java.lang.String getHello();\n    descriptor: ()Ljava/lang/String;\n\n  public static native int meaningOfTheUniverse();\n    descriptor: ()I\n\n  static {};\n    descriptor: ()V\n}\n</code></pre></p> <p>\u67e5\u8be2\u5f97\u77e5<code>getHello()</code>\u7684\u65b9\u6cd5\u7b7e\u540d\u4e3a<code>()Ljava/lang/String</code>\uff1b <code>meaningOfTheUniverse()</code>\u65b9\u6cd5\u7b7e\u540d\u4e3a<code>()I</code>\uff1b</p> <p>\u5982\u679c\u65b9\u6cd5\u7b7e\u540d\u9519\u4e86\uff0c\u7f16\u8bd1\u80fd\u901a\u8fc7\uff0c\u4f46\u8fd0\u884c\u65f6\u4f1a\u62a5NoSuchMethod\u5f02\u5e38</p>"},{"location":"android/ndk/dynamic_reg_function/#native1","title":"\u52a8\u6001\u6ce8\u518cnative\u65b9\u6cd5\u793a\u4f8b1","text":"<p>\u4e3b\u8981\u6587\u4ef6\uff1a</p> <ul> <li><code>dynamic_jni.cpp</code> \u65b9\u6cd5\u5b9e\u73b0\u6587\u4ef6</li> <li><code>DynamicJNI.java</code> jni\u63a5\u53e3</li> </ul> <p><code>DynamicJNI.java</code>\u4e2d\u5b9a\u4e49native\u65b9\u6cd5\u3002<code>ndkground</code>\u662f\u6a21\u5757\u540d\u79f0\u3002 <pre><code>public class DynamicJNI {\n    static {\n        System.loadLibrary(\"ndkground\");\n    }\n\n    public static native String getHello();\n\n    public static native int meaningOfTheUniverse();\n\n}\n</code></pre> \u6587\u4ef6\u8def\u5f84\u662f<code>\"com/rustfisher/appndkground/jni/DynamicJNI\"</code>\uff0c\u8fd9\u4e2a\u8def\u5f84\u786e\u5b9a\u540e\u4e00\u822c\u4e0d\u518d\u6539\u52a8\u3002</p> <p><code>dynamic_jni.cpp</code>\u5b9e\u73b0\u76f8\u5173\u7684\u65b9\u6cd5 <pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;jni.h&gt;\n\n#define JNI_REG_CLASS \"com/rustfisher/appndkground/jni/DynamicJNI\" // path of Java file\n\nJNIEXPORT jstring JNICALL get_hello(JNIEnv *env, jclass clazz) {\n    return env-&gt;NewStringUTF(\"hello from jni\");\n}\n\nJNIEXPORT jint JNICALL meaning_of_the_universe(JNIEnv *env, jclass clazz) {\n    return 42;\n}\n\nstatic JNINativeMethod g_methods[] = {\n    { \"getHello\", \"()Ljava/lang/String;\", (void*)get_hello},\n    { \"meaningOfTheUniverse\", \"()I\", (void*)meaning_of_the_universe},\n};\n\n// must define this function\nJNIEXPORT int JNICALL JNI_OnLoad(JavaVM *vm,void *reserved) {\n  JNIEnv *env;\n  if (vm-&gt;GetEnv((void **) &amp;env,JNI_VERSION_1_6) != JNI_OK) {\n    return JNI_ERR;\n  }\n\n  jclass javaClass = env-&gt;FindClass(JNI_REG_CLASS);\n  if (javaClass == NULL){\n    return JNI_ERR;\n  }\n\n  int method_count = sizeof(g_methods) / sizeof(g_methods[0]);\n  if (env-&gt;RegisterNatives(javaClass, g_methods, method_count) &lt; 0) {\n    return JNI_ERR;\n  }\n\n  return JNI_VERSION_1_6;\n}\n</code></pre></p> <p>\u8fd9\u91cc\u4f7f\u7528Cygwin\u6267\u884c<code>ndk-build</code>\u6765\u7f16\u8bd1\u751f\u6210so\u6587\u4ef6\u3002</p> <p>\u8c03\u7528\u52a8\u6001\u6ce8\u518c\u7684jni\u65b9\u6cd5 <code>DynamicJNI.getHello()</code></p> <p>\u76f8\u5e94\u4ee3\u7801\u53c2\u89c1 https://github.com/RustFisher/android-Basic4/tree/master/appNdkGround</p>"},{"location":"android/ndk/dynamic_reg_function/#native2","title":"\u52a8\u6001\u6ce8\u518cnative\u65b9\u6cd5\u793a\u4f8b2","text":"<p>\u8fd9\u662f\u4e00\u4e2a\u4fee\u6539\u8001\u7248\u672cwebrtc\u4ee3\u7801\u7684\u4f8b\u5b50\u3002\u5728\u539f\u6765\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u52a8\u6001\u6ce8\u518c\u7684native\u65b9\u6cd5\u3002</p> <p>\u5934\u6587\u4ef6\u52a0\u5165\u65b9\u6cd5\u58f0\u660e .h\u5934\u6587\u4ef6<pre><code>static void JNICALL VerticeToNegStatic(JNIEnv * env,jobject,jlong context);\nvoid VerticeToNeg();\nstatic void JNICALL VerticeToPosStatic(JNIEnv * env,jobject,jlong context);\nvoid VerticeToPos();\n</code></pre></p> <p>cpp\u4ee3\u7801\u4e2d\u6ce8\u518c\uff0c\u5148\u627e\u5230Java\u7684\u7c7b<code>_javaRenderClass</code>\uff1b\u7136\u540e\u8c03\u7528\u6ce8\u518c\u7684\u65b9\u6cd5<code>env-&gt;RegisterNatives</code> .cc\u6587\u4ef6 \u52a8\u6001\u6ce8\u518c\u90e8\u5206<pre><code>// get the ViEAndroidGLES20 class\njclass javaRenderClassLocal =\n    env-&gt;FindClass(\"org/webrtc/videoengine/ViEAndroidGLES20\");\nif (!javaRenderClassLocal) {\n  WEBRTC_TRACE(kTraceError, kTraceVideoRenderer, _id,\n                \"%s: could not find ViEAndroidGLES20\", __FUNCTION__);\n  return -1;\n}\n\n// create a global reference to the class (to tell JNI that\n// we are referencing it after this function has returned)\n_javaRenderClass =\n    reinterpret_cast&lt;jclass&gt; (env-&gt;NewGlobalRef(javaRenderClassLocal));\nif (!_javaRenderClass) {\n  WEBRTC_TRACE(kTraceError, kTraceVideoRenderer, _id,\n                \"%s: could not create Java SurfaceHolder class reference\",\n                __FUNCTION__);\n  return -1;\n}\n\n// Delete local class ref, we only use the global ref\nenv-&gt;DeleteLocalRef(javaRenderClassLocal);\n\n// ....\n\nJNINativeMethod nativeFunctions[5] = {\n  { \"DrawNative\",\n    \"(J)V\",\n    (void*) &amp;AndroidNativeOpenGl2Channel::DrawNativeStatic, },\n  { \"CreateOpenGLNative\",\n    \"(JII)I\",\n    (void*) &amp;AndroidNativeOpenGl2Channel::CreateOpenGLNativeStatic },\n  { \"ChangeMirrorXNative\",\n    \"(J)V\",\n    (void*) &amp;AndroidNativeOpenGl2Channel::ChangeMirrorXNativeStatic },\n  { \"VerticeToNegNative\",\n    \"(J)V\",\n    (void*) &amp;AndroidNativeOpenGl2Channel::VerticeToNegStatic },\n  { \"VerticeToPosNative\",\n    \"(J)V\",\n    (void*) &amp;AndroidNativeOpenGl2Channel::VerticeToPosStatic },\n};\nif (env-&gt;RegisterNatives(javaRenderClass, nativeFunctions, sizeof(nativeFunctions) / sizeof(nativeFunctions[0])) == 0) {\n  // \u6ce8\u518c\u6210\u529f\n} else {\n  // \u62a5\u8b66\u544a..\n}\n</code></pre></p> .cc\u6587\u4ef6\u8c03\u7528\u4ee3\u7801<pre><code>void JNICALL AndroidNativeOpenGl2Channel::VerticeToNegStatic(\n    JNIEnv * env, jobject, jlong context) {\n  // \u4e1a\u52a1\u903b\u8f91\n}\n\nvoid AndroidNativeOpenGl2Channel::VerticeToNeg() {\n  // \u4e1a\u52a1\u903b\u8f91\n}\n\nvoid JNICALL AndroidNativeOpenGl2Channel::VerticeToPosStatic(\n    JNIEnv * env, jobject, jlong context) {\n  // \u4e1a\u52a1\u903b\u8f91\n}\n\nvoid AndroidNativeOpenGl2Channel::VerticeToPos() {\n  // \u4e1a\u52a1\u903b\u8f91\n}\n</code></pre> <p>Java\u4ee3\u7801\u4e2d\u5bf9\u5e94\u7684\u65b9\u6cd5 Java\u91cc\u7684native\u65b9\u6cd5<pre><code>private native int CreateOpenGLNative(long nativeObject,\n                                      int width, int height);\n\nprivate native void DrawNative(long nativeObject);\n\nprivate native void ChangeMirrorXNative(long nativeObject);\n\nprivate native void VerticeToNegNative(long nativeObject);\n\nprivate native void VerticeToPosNative(long nativeObject);\n</code></pre></p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u7b80\u4e66</p>"},{"location":"android/ndk/logcat-use/","title":"\u6253log","text":"<p>\u524d\u9762\u6211\u4eec\u77e5\u9053\u5982\u4f55\u4f7f\u7528\u5c06\u5b57\u7b26\u4e32\u4f20\u5165\u548c\u4f20\u51fa\u672c\u5730\uff08native\uff09\u65b9\u6cd5\u3002</p> <p>\u672c\u6587\u8bb2\u8ff0\u5982\u4f55\u5728NDK\u4e2d\u4f7f\u7528log\u3002</p> <p>\u6253log\u662f\u6bd4\u8f83\u5e38\u89c1\u7684\u4e00\u79cd\u8c03\u8bd5\u624b\u6bb5\u3002\u501f\u52a9log\u6211\u4eec\u53ef\u4ee5\u4e86\u89e3\u5e94\u7528\u8fd0\u884c\u7684\u72b6\u6001\uff0c\u83b7\u53d6\u5230\u4e00\u4e9b\u611f\u5174\u8da3\u7684\u4fe1\u606f\u3002</p> <p>\u4e00\u822c\u6211\u4eec\u4f1a\u7528android.util.Log\u7c7b\u6765\u6253log\u3002\u6bd4\u5982<code>Log.d(TAG, \"RustFisher\");</code></p> <p>\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728C++\u4ee3\u7801\u4e2d\u4f7f\u7528log\u3002</p> <p>\u56de\u5934\u770b\u5b57\u7b26\u4e32\u4f8b\u5b50\u793a\u4f8b\u5de5\u7a0b\u4e2d\u7684<code>reverseString</code>\u65b9\u6cd5\u3002</p> <p>\u9996\u5148\u5728<code>CMakeLists.txt</code>\u4e2d\uff0c\u628alog\u76f8\u5173\u5e93<code>log-lib</code>\u5f15\u5165\u3002 \u7b2c\u4e00\u6b65\u662f<code>find_library</code>\uff0c\u586b\u5165<code>log-lib</code>\u3002 \u6700\u540e\u662f\u5728<code>target_link_libraries</code>\u4e2d\uff0c\u628a<code>log-lib</code>\u548c\u8fde\u63a5\u5230\u6211\u4eec\u7684\u6a21\u5757<code>fisher-pole</code>\u3002 <pre><code>find_library( # Defines the name of the path variable that stores the\n        # location of the NDK library.\n        log-lib\n\n        # Specifies the name of the NDK library that\n        # CMake needs to locate.\n        log )\n\nadd_library( # Specifies the name of the library.\n             fisher-pole\n\n             # Sets the library as a shared library.\n             SHARED\n\n             # Provides a relative path to your source file(s).\n             tom.cpp jerry.cpp baseparam.cpp)\n\ntarget_link_libraries( # Specifies the target library.\n        fisher-pole\n\n        # Links the log library to the target library.\n        ${log-lib} )\n</code></pre></p> <p>\u4fee\u6539\u5b8c<code>CMakeLists.txt</code>\u540e\uff0c\u76f4\u63a5\u8f6c\u5411cpp\u6587\u4ef6\u3002</p> <p>\u6587\u4ef6\u6dfb\u52a0\u5f15\u7528\u548c\u58f0\u660e\u3002 <pre><code>#include &lt;android/log.h&gt;\n\n#define tag \"rustApp\"\n</code></pre></p> <p>\u8c03\u7528<code>int __android_log_print(int prio, const char* tag, const char* fmt, ...)</code>\u65b9\u6cd5\u6253log\u3002</p> <p>\u4ee5<code>jerry.cpp</code>\u4e3a\u4f8b\uff0c\u5728\u6211\u4eec\u611f\u5174\u8da3\u7684\u5730\u65b9\u6253\u4e0alog <pre><code>extern \"C\"\nJNIEXPORT jstring JNICALL\nJava_com_rustfisher_fishpole_worker_Jerry_reverseString(JNIEnv *env, jobject thiz, jstring input) {\n    const char *inputPtr = env-&gt;GetStringUTFChars(input, NULL);\n    int len1 = env-&gt;GetStringLength(input);\n    int len2 = strlen(inputPtr);\n\n    __android_log_print(ANDROID_LOG_INFO, tag, \"[reverseString] input: %s\", inputPtr);\n    __android_log_print(ANDROID_LOG_INFO, tag, \"[reverseString] GetStringLength: %d, strlen: %d\",\n                        len1, len2);\n\n    char *out = new char[len1]{};\n\n    __android_log_print(ANDROID_LOG_INFO, tag, \"[reverseString] origin out: %s\", out);\n\n    for (int i = 0; i &lt; len1; i++) {\n        out[i] = inputPtr[len1 - i - 1];\n    }\n\n    __android_log_print(ANDROID_LOG_INFO, tag, \"[reverseString] result: %s\", out);\n    jstring res = env-&gt;NewStringUTF(out);\n\n    delete[] out;\n    env-&gt;ReleaseStringChars(input, reinterpret_cast&lt;const jchar *&gt;(inputPtr));\n\n    return res;\n}\n</code></pre></p> <p>\u8fd0\u884c\u8d77\u6765\u53ef\u4ee5\u770b\u5230\u7ed3\u679c\u3002</p> <p>\u4ee3\u7801\u5728\u8fd9 https://gitee.com/rustfisher/AndroidTutorial</p>"},{"location":"android/ndk/makefile_example/","title":"Android NDK Makefile\u76f8\u5173\u793a\u4f8b","text":""},{"location":"android/ndk/makefile_example/#androidmkapplicationmk","title":"<code>Android.mk</code>\u4e0e<code>Application.mk</code>","text":"<p>Android Studio 3\u4e4b\u524d\uff0c\u9700\u8981\u7f16\u5199<code>Android.mk</code>\u548c<code>Application.mk</code>\u6587\u4ef6\u3002</p> <p>\u4f7f\u7528jdk8\u6216jdk7\u4e2d\u63d0\u4f9b\u7684<code>javah</code>\u6765\u751f\u6210\u5934\u6587\u4ef6\u3002</p>"},{"location":"android/ndk/makefile_example/#buildgradlejni","title":"<code>build.gradle</code>\u8bbe\u5b9ajni","text":"<p>\u4ee5\u4e0b\u662f\u67d0\u6a21\u5757\u7684<code>build.gradle</code>\u6587\u4ef6 <pre><code>android {\n    // ....\n    sourceSets.main {\n        jni.srcDirs = [] // \u7981\u6b62\u81ea\u52a8\u6267\u884cndk-build\n        jniLibs.srcDirs = ['src/main/libs'] // \u8bbe\u5b9a\u6210so\u6587\u4ef6\u751f\u6210\u7684\u76ee\u5f55\n    }\n}\n</code></pre></p>"},{"location":"android/ndk/makefile_example/#_1","title":"\u6307\u5b9a\u6a21\u5757\u7684\u540d\u5b57","text":"<p>\u5728<code>Android.mk</code>\u6587\u4ef6\u4e2d\u6307\u5b9a\u6a21\u5757\u7684\u540d\u5b57 <pre><code>LOCAL_MODULE := modname\n</code></pre> \u7f16\u8bd1\u5f97\u5230<code>libmodname.so</code>\u6587\u4ef6</p> <p>\u52a0\u8f7d\u5e93\u6587\u4ef6 <pre><code>    static {\n        System.loadLibrary(\"modname\");\n    }\n</code></pre></p>"},{"location":"android/ndk/makefile_example/#target_arch_abi","title":"\u5229\u7528<code>$(TARGET_ARCH_ABI)</code>\u5224\u65ad\u76ee\u6807\u67b6\u6784\u7c7b\u522b","text":"<p>Android Studio 3\u4e4b\u524d\uff0c\u9700\u8981\u7f16\u5199<code>Android.mk</code>\u548c<code>Application.mk</code>\u6587\u4ef6\u3002\u4f7f\u7528jdk8\u6216jdk7\u3002</p> <p>\u4e00\u4e2a\u5178\u578b<code>Application.mk</code> <pre><code>APP_ABI := arm64-v8a armeabi-v7a\nAPP_PLATFORM := android-19\nAPP_STL := gnustl_static\nAPP_CPPFLAGS += -std=c++11\n</code></pre> \u6307\u5b9a\u4e862\u79cd\u67b6\u6784</p> <p>\u5728<code>Android.mk</code>\u4e2d\uff0c\u53ef\u4ee5\u7528<code>$(TARGET_ARCH_ABI)</code>\u5224\u65ad\u76ee\u6807\u67b6\u6784\u7c7b\u522b\uff1b \u4f8b\u5982jni\u76ee\u5f55\u4e2d\u6709\u5982\u4e0b\u7684\u6587\u4ef6 <pre><code>jni\n|-- Android.mk\n|-- Application.mk\n|-- something.cpp\n|-- include\n|   |-- something.h\n|-- lib\n|   |-- arm64-v8a\n|   |   `-- libcustom.a\n|   `-- armeabi-v7a\n|       `-- libcustom.a\n</code></pre></p> <p><code>Android.mk</code>\u4e2d\u5224\u65ad\u5f53\u524d\u7f16\u8bd1\u7684\u76ee\u6807\u67b6\u6784\u800c\u52a0\u8f7d\u5e93\u6587\u4ef6<code>libcustom.a</code> <pre><code>LOCAL_LDFLAGS := $(LOCAL_PATH)/lib/$(TARGET_ARCH_ABI)/libcustom.a\n</code></pre></p>"},{"location":"android/ndk/makefile_example/#opencv","title":"\u5f15\u7528OpenCV\u6a21\u5757","text":"<p>\u5047\u8bbe\u5df2\u7ecf\u4e0b\u8f7d\u597d<code>opencv-3.2.0</code>SDK\uff0c<code>Android.mk</code>\u4e2d\u5f15\u7528 <pre><code>OPENCVROOT:=$(LOCAL_PATH)/../../../../../opencv-3.2.0-android-sdk/OpenCV-android-sdk\nOPENCV_CAMERA_MODULES:=off\nOPENCV_INSTALL_MODULES:=on\nOPENCV_LIB_TYPE:=STATIC\n\ninclude ${OPENCVROOT}/sdk/native/jni/OpenCV.mk\n</code></pre> \u4f7f\u7528\u76f8\u5bf9\u8def\u5f84\u627e\u5230sdk\uff0c\u5f15\u5165OpenCV\u7684mk\u6587\u4ef6</p>"},{"location":"android/ndk/makefile_example/#android-ndk-makefile_1","title":"Android NDK \u901a\u7528 makefile \u4e0e\u76f8\u5173\u914d\u7f6e","text":"<p><code>Android.mk</code> <pre><code>LOCAL_PATH:= $(call my-dir)\ninclude $(CLEAR_VARS)\nLOCAL_MODULE := waveExtract\nTARGET_ARCH_ABI := all\n\nLOCAL_SRC_FILES := src/wave_display.c src/FFT.c\n\nLOCAL_LDLIBS+= -L$(SYSROOT)/usr/lib -llog\n\ninclude $(BUILD_SHARED_LIBRARY)\n</code></pre></p> <p><code>Application.mk</code> <pre><code>APP_PLATFORM := android-19\nAPP_MODULES := waveExtract\nAPP_ABI := armeabi-v7a arm64-v8a\nAPP_STL := stlport_static\nAPP_CPPFLAGS += -fexceptions\n# for using c++ features,you need to enable these in your Makefile\nAPP_CPP_FEATURES += exceptions rtti\n</code></pre></p> <p><code>build.gradle</code> <pre><code>apply plugin: 'com.android.library'\n\nandroid {\n    compileSdkVersion 28\n\n    defaultConfig {\n        minSdkVersion 19\n        targetSdkVersion 28\n        versionCode 1\n        versionName \"1.0\"\n\n        testInstrumentationRunner \"android.support.test.runner.AndroidJUnitRunner\"\n\n    }\n\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n        }\n    }\n\n    sourceSets {\n        main {\n            jni.srcDirs = []\n            jniLibs.srcDirs = ['src/main/libs']\n        }\n    }\n\n}\n\ndependencies {\n    implementation fileTree(dir: 'libs', include: ['*.jar'])\n\n    implementation 'com.android.support:appcompat-v7:28.+'\n    testImplementation 'junit:junit:4.12'\n    androidTestImplementation 'com.android.support.test:runner:1.0.2'\n    androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'\n}\n</code></pre></p>"},{"location":"android/ndk/read_write_file/","title":"Android NDK \u8bfb\u5199\u6587\u4ef6","text":"\u66f4\u65b0\u65e5\u671f 2021-9-1 <ul> <li>2021-9-1 \u66f4\u65b0\u683c\u5f0f</li> <li>2017-10-1 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u65e7\u6587\u6863</p> <p>\u6b64\u6587\u6863\u6bd4\u8f83\u65e7\uff0c\u65b0\u7684\u6587\u6863\u8bf7\u53c2\u89c1NDK \u8bfb\u5199\u6587\u672c\u6587\u4ef6</p> <p>\u5f00\u53d1\u73af\u5883\u4e0e\u5de5\u5177\uff1a win7_x64\uff0cAndroid Studio 2.2.3, Cygwin</p> <p>\u4f7f\u7528NDK\uff0c\u5c31\u8fdb\u5165\u4e86Linux\u7684\u4e16\u754c\u3002\u7406\u89e3\u4e86\u8fd9\u4e00\u70b9\uff0c\u5f88\u591a\u4e8b\u60c5\u5c31\u597d\u529e\u4e86\u3002\u9700\u8981\u719f\u6089C\u8bed\u8a00\u64cd\u4f5c\u6587\u4ef6\u7684\u65b9\u5f0f\u3002</p>"},{"location":"android/ndk/read_write_file/#_1","title":"\u51c6\u5907\u4e8b\u9879","text":""},{"location":"android/ndk/read_write_file/#_2","title":"\u7533\u8bf7\u6743\u9650","text":"<p>\u7533\u8bf7SD\u5361\u7684\u8bfb\u5199\u6743\u9650 <pre><code>&lt;uses-permission android:name=\"android.permission.WRITE_EXTERNAL_STORAGE\" /&gt;\n&lt;uses-permission android:name=\"android.permission.READ_EXTERNAL_STORAGE\" /&gt;\n</code></pre></p> <p>Android6.0\u5f00\u59cb\u9700\u8981\u52a8\u6001\u7533\u8bf7\u6743\u9650\u3002</p>"},{"location":"android/ndk/read_write_file/#_3","title":"\u4f7f\u7528\u6587\u4ef6\u7edd\u5bf9\u8def\u5f84","text":"<p>\u624b\u673asd\u5361\u4e2d\u5b58\u653e\u7740\u6587\u4ef6\u3002\u76ee\u5f55\u4e3a <code>/sdcard/hello.txt</code>\u548c<code>/sdcard/egdir/csv/eg_data.csv</code>\u3002</p> <p>\u5f53\u7136\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728Java\u5c42\u83b7\u53d6\u6587\u4ef6\u8def\u5f84\u540e\u4f20\u5165native\u65b9\u6cd5\u3002</p>"},{"location":"android/ndk/read_write_file/#_4","title":"\u8bfb\u5199\u793a\u4f8b","text":""},{"location":"android/ndk/read_write_file/#_5","title":"\u6587\u4ef6\u76ee\u5f55","text":"<pre><code>jni/\n|-- Android.mk\n|-- com_rustfisher_ndkalgo_RWFile.h\n`-- RWFile.c\n</code></pre>"},{"location":"android/ndk/read_write_file/#java","title":"Java\u6587\u4ef6","text":"<p><code>RWFile.java</code> \u91cc\u9762\u5199\u4e86\u591a\u4e2anative\u65b9\u6cd5\u3002</p> <pre><code>public class RWFile {\n\n    static {\n        System.loadLibrary(\"NDKMan\");\n    }\n\n    public String readIn() {\n        return nativeRead();\n    }\n\n    public String writeToFile(String msg) {\n        return nativeWrite(msg);\n    }\n\n    public String readSDFile(String fileName) {\n        return nativeReadSDFile(fileName);\n    }\n\n    private native String nativeRead();\n\n    /**\n     * @param fileName e.g. FolderName/textFile.txt\n     */\n    private native String nativeReadSDFile(String fileName);\n\n    private native String nativeWrite(String msg);\n}\n</code></pre> <p><code>RWFile.c</code>\u7f16\u8bd1\u51fa<code>.h</code>\u6587\u4ef6\u540e\uff0c\u91cc\u9762\u7684\u65b9\u6cd5\u540d\u3002\u53ef\u4ee5\u770b\u51fa\u7f16\u8bd1\u540e\u7684\u65b9\u6cd5\u540d\u548c\u539f\u6765\u7684native\u65b9\u6cd5\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u3002 <pre><code>void join(char *s1, char *s2,char *result)          // \u62fc\u63a5char\u7684\u51fd\u6570\nJava_com_rustfisher_ndkalgo_RWFile_nativeRead       // \u8bfb\u53d6\u56fa\u5b9a\u6587\u4ef6\u7684\u5185\u5bb9\nJava_com_rustfisher_ndkalgo_RWFile_nativeReadSDFile // \u6839\u636e\u6587\u4ef6\u540d\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\nJava_com_rustfisher_ndkalgo_RWFile_nativeWrite      // \u5c06\u5185\u5bb9\u5199\u5165\u6587\u4ef6\n</code></pre></p>"},{"location":"android/ndk/read_write_file/#c","title":"C\u6587\u4ef6","text":"<p>C\u6587\u4ef6\u662f\u6211\u4eec\u5177\u4f53\u5b9e\u73b0\u529f\u80fd\u7684\u5730\u65b9\u3002<code>RWFile.c</code>\u4ee3\u7801\u5982\u4e0b\u3002</p> <pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#include \"com_rustfisher_ndkalgo_RWFile.h\"\n\nconst char *sdcardDir = \"/sdcard/\";\n\nvoid join(char *s1, char *s2,char *result) {\n    result = (char *) malloc(strlen(s1)+strlen(s2)+1);// +1 for the zero-terminator\n    if (result == NULL) {\n        return;\n    }\n    strcpy(result, s1);\n    strcat(result, s2);\n}\n\nJNIEXPORT jstring JNICALL Java_com_rustfisher_ndkalgo_RWFile_nativeRead\n(JNIEnv *env, jobject jObj) {\n    FILE* file = fopen(\"/sdcard/hello.txt\",\"r+\");\n    char myStr[128];\n    if (file != NULL) {\n        char* readInPtr = fgets(myStr, 128, file);\n        fclose(file);\n        if (NULL != readInPtr) {\n            return (*env)-&gt;NewStringUTF(env, myStr);\n        }\n        return (*env)-&gt;NewStringUTF(env, \"JNI read file fail!\");\n    }\n    return (*env)-&gt;NewStringUTF(env, \"JNI read file fail!\");\n}\n\nJNIEXPORT jstring JNICALL Java_com_rustfisher_ndkalgo_RWFile_nativeReadSDFile\n(JNIEnv *env, jobject jObj, jstring fileName) {\n    char *fileNamePtr = (*env)-&gt;GetStringUTFChars(env, fileName, 0);\n    char * result;\n    join(sdcardDir,fileNamePtr,result);\n\n    FILE* file = fopen(result,\"r+\");\n\n    if (file != NULL) {\n        char myStr[128];\n        char* readInPtr = fgets(myStr, 128, file);\n        fclose(file);\n        if (NULL != readInPtr) {\n            return (*env)-&gt;NewStringUTF(env, myStr);\n        }\n        return (*env)-&gt;NewStringUTF(env, \"JNI read fail - NULL == readInPtr\");\n    }\n    return (*env)-&gt;NewStringUTF(env, \"JNI read file fail! - file is NULL \");\n}\n\n\nJNIEXPORT jstring JNICALL Java_com_rustfisher_ndkalgo_RWFile_nativeWrite\n(JNIEnv *env, jobject jObj, jstring msg) {\n\n    FILE* file = fopen(\"/sdcard/hello.txt\",\"w+\");\n    const char *nativeMsg = (*env)-&gt;GetStringUTFChars(env, msg, 0);\n\n    if (file != NULL) {\n        fputs(nativeMsg, file);\n        fflush(file);\n        fclose(file);\n    }\n\n    return (*env)-&gt;NewStringUTF(env, \"Write finished.\");\n}\n</code></pre>"},{"location":"android/ndk/read_write_file/#_6","title":"\u9700\u5173\u6ce8\u7684\u51fd\u6570","text":"<p>\u8981\u7279\u522b\u5173\u5fc3\u51fd\u6570\u7684\u8fd4\u56de\u503c\uff0c\u8fd4\u56de\u503c\u5f80\u5f80\u4ee3\u8868\u7740\u8c03\u7528\u7684\u7ed3\u679c\u3002</p>"},{"location":"android/ndk/read_write_file/#fopen","title":"\u6253\u5f00\u6587\u4ef6 <code>fopen</code>","text":"<p><code>FILE * fopen(const char * path,const char * mode);</code> mode\u6a21\u5f0f\u9009\u62e9\uff0c\u4f8b\u5982<code>\"r\"</code></p> <ul> <li>r(read): \u8bfb</li> <li>w(write): \u5199</li> <li>a(append): \u8ffd\u52a0</li> <li>t(text): \u6587\u672c\u6587\u4ef6\uff0c\u53ef\u7701\u7565\u4e0d\u5199</li> <li>b(banary): \u4e8c\u8fdb\u5236\u6587\u4ef6</li> <li>+: \u8bfb\u548c\u5199</li> </ul> <p>\u51e1\u7528\u201cr\u201d\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u65f6\uff0c\u8be5\u6587\u4ef6\u5fc5\u987b\u5df2\u7ecf\u5b58\u5728\uff0c\u4e14\u53ea\u80fd\u4ece\u8be5\u6587\u4ef6\u8bfb\u51fa\u3002</p> <p>\u7528\u201cw\u201d\u6253\u5f00\u7684\u6587\u4ef6\u53ea\u80fd\u5411\u8be5\u6587\u4ef6\u5199\u5165\u3002\u82e5\u6253\u5f00\u7684\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u4ee5\u6307\u5b9a\u7684\u6587\u4ef6\u540d\u5efa\u7acb\u8be5\u6587\u4ef6\uff0c\u82e5\u6253\u5f00\u7684\u6587\u4ef6\u5df2 \u7ecf\u5b58\u5728\uff0c\u5219\u5c06\u8be5\u6587\u4ef6\u5220\u53bb\uff0c\u91cd\u5efa\u4e00\u4e2a\u65b0\u6587\u4ef6\u3002\u8fd9\u4e2a\u65b9\u6cd5\u4fdd\u8bc1\u76ee\u6807\u6587\u4ef6\u91cc\u5199\u5165\u7684\u53ea\u6709\u6211\u4eec\u8981\u7684\u6570\u636e\u3002</p> <p>\u82e5\u8981\u5411\u4e00\u4e2a\u5df2\u5b58\u5728\u7684\u6587\u4ef6\u8ffd\u52a0\u65b0\u7684\u4fe1\u606f\uff0c\u53ea\u80fd\u7528\u201ca\u201d\u65b9\u5f0f\u6253\u5f00\u6587\u4ef6\u3002\u4f46\u6b64\u65f6\u8be5\u6587\u4ef6\u5fc5\u987b\u662f\u5b58\u5728\u7684\uff0c\u5426\u5219\u5c06\u4f1a\u51fa\u9519\u3002</p> <p>\u5728\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u65f6\uff0c\u5982\u679c\u51fa\u9519\uff0cfopen\u5c06\u8fd4\u56de\u4e00\u4e2a\u7a7a\u6307\u9488\u503cNULL\u3002\u5728\u7a0b\u5e8f\u4e2d\u53ef\u4ee5\u7528\u8fd9\u4e00\u4fe1\u606f\u6765\u5224\u522b\u662f\u5426\u5b8c\u6210 \u6253\u5f00\u6587\u4ef6\u7684\u5de5\u4f5c\uff0c\u5e76\u4f5c\u76f8\u5e94\u7684\u5904\u7406\u3002</p> <p>\u5982\u679c\u6210\u529f\u7684\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6, fopen()\u51fd\u6570\u8fd4\u56de\u6587\u4ef6\u6307\u9488, \u5426\u5219\u8fd4\u56de\u7a7a\u6307\u9488</p>"},{"location":"android/ndk/read_write_file/#fgets","title":"\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e <code>fgets</code>","text":"<p><code>char *fgets(char *s, int n, FILE *stream);</code> \u4ece\u6587\u4ef6\u6307\u9488stream\u4e2d\u8bfb\u53d6n-1\u4e2a\u5b57\u7b26\uff0c\u5b58\u5230\u4ee5s\u4e3a\u8d77\u59cb\u5730\u5740\u7684\u7a7a\u95f4\u91cc\uff0c\u76f4\u5230\u8bfb\u5b8c\u4e00\u884c\uff0c\u5982\u679c\u6210\u529f\u5219\u8fd4\u56des\u7684\u6307 \u9488\uff0c\u5426\u5219\u8fd4\u56deNULL\u3002</p>"},{"location":"android/ndk/read_write_file/#ndkjstring-env-newstringutfenv-char","title":"NDK\u4e2d\u751f\u6210jstring\u7684\u51fd\u6570  <code>(*env)-&gt;NewStringUTF(env, char *);</code>","text":"<p><code>(*env)-&gt;NewStringUTF(env, char *);</code> \u5982\u679c\u4f20\u5165\u7684char*\u662f\u4e00\u4e2a\u7a7a\u503c\uff0c\u5728\u4e00\u4e9b\u5e73\u53f0\u4e0a\u4f1a\u62a5\u9519\u3002 \u6bd4\u5982\u7ea2\u7c73\u624b\u673a\u4f1a\u76f4\u63a5\u5d29\u6e83\uff0c\u800c\u9b45\u65cf\u624b\u673a\u80fd\u5f97\u5230\u4e00\u4e2a\u7a7a\u7684String\u3002 \u53ef\u4ee5\u53c2\u8003NDK\u4e2d\u7684\u5b57\u7b26\u4e32</p> <p>\ud83d\udcd6 NDK \u8bfb\u5199\u6587\u672c\u6587\u4ef6</p>"},{"location":"android/ndk/sprintf-itoa/","title":"\u7528sprintf\u4ee3\u66ffitoa","text":"<p>\u7f16\u8bd1\u5230itoa\u65f6\u4f1a\u51fa\u9519\uff0c\u60f3\u529e\u6cd5\u66ff\u6362\u6389\u8fd9\u4e2a\u51fd\u6570\u3002</p> <p>\u9700\u6c42\u662f\u628a\u5341\u8fdb\u5236\u6570\u8f6c\u6362\u4e3a\u5b57\u7b26\u3002</p> <pre><code>p1 = (char*)malloc(sizeof(char) * 4);\n//itoa(i + 1, p1, 10);\nsprintf(p1, \"%d\", i+1);\n</code></pre>"},{"location":"android/ndk/string-use/","title":"\u5b57\u7b26\u4e32\u7684\u4f7f\u7528","text":"<p>\u524d\u9762\u6211\u4eec\u77e5\u9053\u5982\u4f55\u4f7f\u7528\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff0c\u672c\u6587\u6211\u4eec\u6765\u770b\u5982\u4f55\u5c06\u5b57\u7b26\u4e32\u4f20\u5165\u548c\u4f20\u51fa\u672c\u5730\uff08native\uff09\u65b9\u6cd5\u3002</p> <p>\u6211\u4eec\u5148\u6765\u770b\u4e00\u4e2a\u8fd4\u56deString\u7684\u4f8b\u5b50\uff0c\u5206\u522b\u770bkotlin\u4ee3\u7801\u4e0ecpp\u4ee3\u7801\u3002 <pre><code>class Jerry {\n    companion object {\n        init {\n            System.loadLibrary(\"fisher-pole\")\n        }\n    }\n    external fun name(): String?\n}\n</code></pre></p> <pre><code>extern \"C\"\nJNIEXPORT jstring JNICALL\nJava_com_rustfisher_fishpole_worker_Jerry_name(JNIEnv *env, jobject thiz) {\n    std::string jerry = \"Jerry\";\n    return env-&gt;NewStringUTF(jerry.c_str());\n}\n</code></pre> <p>\u5728c++\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u8c03\u7528\u4e86<code>env-&gt;NewStringUTF();</code>\u65b9\u6cd5\u6765\u83b7\u5f97jstring\u3002</p> <p>\u8c03\u7528\u65b9\u6cd5\u7684\u5199\u6cd5\u662f\uff1a<code>env-&gt;</code>\u518d\u52a0\u4e0a\u5177\u4f53\u7684\u65b9\u6cd5\u3002</p> <p><code>NewStringUTF</code>\u51fd\u6570\u53ef\u4ee5\u7528\u6765\u6784\u9020\u4e00\u4e2a\u65b0\u7684jstring\uff0c\u800c\u8bfb\u53d6\u73b0\u6709jstring\u5bf9\u8c61\u7684\u5185\u5bb9\uff0c\u9700\u8981\u4f7f\u7528<code>GetStringUTFChars</code>\u51fd\u6570\u3002 \u8be5\u51fd\u6570\u8fd4\u56de\u6307\u5411\u63cf\u8ff0\u5b57\u7b26\u4e32\u7684\u201c\u6539\u826fUTF-8\u201d\u5b57\u7b26\u7684 const jbyte* \u6307\u9488\u3002</p> <p>\u6ce8\u610f\uff0c\u5177\u4f53\u7684\u865a\u62df\u673a\u53ef\u4ee5\u4e3a\u5176\u5185\u90e8\u7684\u5b57\u7b26\u4e32\u8868\u793a\u81ea\u7531\u9009\u62e9\u7f16\u7801\u673a\u5236\u3002</p> <p>\u6240\u4ee5\uff0c\u4f60\u53ef\u4ee5\u5f97\u5230\u5b9e\u9645\u7684Java\u5b57\u7b26\u4e32\u7684\u5b57\u7b26\u6307\u9488\u3002</p> <p>\u56e0\u4e3aJava\u5b57\u7b26\u4e32\u662f\u4e0d\u53ef\u53d8\u7684\uff0c\u6240\u4ee5\u614e\u91cd\u5904\u7406const\u5c31\u663e\u5f97\u975e\u5e38\u91cd\u8981\uff0c\u4e0d\u8981\u8bd5\u56fe\u5c06\u6570\u636e\u5199\u5230\u8be5\u5b57\u7b26\u6570\u7ec4\u4e2d\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c\u865a\u62df\u673a\u4f7f\u7528UTF-16\u6216UTF-32\u5b57\u7b26\u4f5c\u4e3a\u5176\u5185\u90e8\u5b57\u7b26\u4e32\u7684\u8868\u793a\uff0c\u90a3\u4e48\u8be5\u51fd\u6570\u4f1a\u5206\u914d\u4e00\u4e2a\u65b0\u7684\u5185\u5b58\u5757\u6765\u5b58\u50a8\u7b49\u4ef7\u7684\u201c\u6539\u826fUTF-8\u201d\u7f16\u7801\u5b57\u7b26\u3002</p> <p>\u865a\u62df\u673a\u5fc5\u987b\u77e5\u9053\u4f60\u4f55\u65f6\u4f7f\u7528\u5b8c\u5b57\u7b26\u4e32\uff0c\u8fd9\u6837\u5b83\u5c31\u80fd\u8fdb\u884c\u5783\u573e\u56de\u6536(\u5783\u573e\u56de\u6536\u5668\u662f\u5728\u4e00\u4e2a\u72ec\u7acb\u7ebf\u7a0b\u4e2d\u8fd0\u884c\u7684\uff0c\u5b83\u80fd\u591f\u4e2d\u65ad\u672c\u5730\u65b9\u6cd5\u7684\u6267\u884c)\u3002\u57fa\u4e8e\u8fd9\u4e2a\u539f\u56e0\uff0c\u4f60\u5fc5\u987b\u8c03\u7528<code>ReleaseStringUTFChars</code>\u51fd\u6570\u3002</p> <p>\u53e6\u5916\uff0c\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528<code>GetStringRegion</code>\u6216<code>GetStringUTFRegion</code>\u65b9\u6cd5\u6765\u63d0\u4f9b\u4f60\u81ea\u5df1\u7684\u7f13\u5b58\uff0c\u4ee5\u5b58\u653e\u5b57\u7b26\u4e32\u7684\u5b57\u7b26\u3002 \u6700\u540e<code>GetStringUTFLength</code>\u51fd\u6570\u8fd4\u56de\u5b57\u7b26\u4e32\u7684\u201c\u6539\u826fUTF-8\u201d\u7f16\u7801\u6240\u9700\u7684\u5b57\u7b26\u4e2a\u6570\u3002</p>"},{"location":"android/ndk/string-use/#_2","title":"\u5012\u5e8f\u5b57\u7b26\u4e32\u7684\u4f8b\u5b50","text":"<p>\u6709\u4e86\u4e0a\u9762\u7684\u77e5\u8bc6\u540e\uff0c\u6211\u4eec\u6765\u5c1d\u8bd5\u628a\u8f93\u5165\u7684\u5b57\u7b26\u4e32\u5012\u5e8f\u8f93\u5165\u3002</p> <p>\u9996\u5148\u51c6\u5907native\u65b9\u6cd5\uff0c\u5728kotlin\u4ee3\u7801\u589e\u52a0<code>reverseString</code>\u65b9\u6cd5 <pre><code>class Jerry {\n    companion object {\n        init {\n            System.loadLibrary(\"fisher-pole\")\n        }\n    }\n    external fun reverseString(input: String): String?\n}\n</code></pre></p> <p>\u7f16\u5199C++\u5b9e\u73b0\uff0c\u5728jerry.cpp\u4e2d\u589e\u52a0\u4ee3\u7801 <pre><code>extern \"C\"\nJNIEXPORT jstring JNICALL\nJava_com_rustfisher_fishpole_worker_Jerry_reverseString(JNIEnv *env, jobject thiz, jstring input) {\n    const char *inputPtr = env-&gt;GetStringUTFChars(input, NULL);\n    int len1 = env-&gt;GetStringLength(input);\n    int len2 = strlen(inputPtr);\n\n    char *out = new char[len1 + 1]{}; // \u8fd9\u91cc\u9700\u8981\u591a\u4e00\u4f4d\n    for (int i = 0; i &lt; len1; i++) {\n        out[i] = inputPtr[len1 - i - 1];\n    }\n    jstring res = env-&gt;NewStringUTF(out);\n\n    delete[] out;\n    env-&gt;ReleaseStringChars(input, reinterpret_cast&lt;const jchar *&gt;(inputPtr));\n\n    return res;\n}\n</code></pre> <code>len1</code>\u548c<code>len2</code>\u5176\u5b9e\u662f\u4e00\u6837\u7684\u3002\u4e24\u79cd\u65b9\u6cd5\u83b7\u53d6\u4f20\u5165\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u3002</p> <p>\u9996\u5148\u62ff\u5230\u4f20\u5165\u7684jstring\u7684\u5185\u5bb9\uff0c\u7528<code>env-&gt;GetStringUTFChars</code>\u65b9\u6cd5\u3002\u83b7\u5f97\u4e00\u4e2aconst char\u6307\u9488\u3002</p> <p>\u7136\u540e\u65b0\u5206\u914d\u4e00\u4e2achar\u6570\u7ec4\uff0c\u62ff\u6765\u5b58\u653e\u5012\u5e8f\u540e\u7684\u5185\u5bb9\u3002</p> <p><code>env-&gt;NewStringUTF</code>\u65b0\u5efa\u4e00\u4e2ajstring\uff0c\u5c31\u662f\u6211\u4eec\u8981\u7684\u7ed3\u679c\u3002</p> <p>\u6700\u540e\u56de\u6536\u8d44\u6e90\uff0c\u5e76\u8fd4\u56de\u7ed3\u679c\u3002</p> <p>\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c\u5e76\u4e0d\u4f1a\u8fd9\u4e48\u505a\uff0c\u8fd9\u53ea\u662f\u4e2a\u793a\u4f8b\u3002</p> <p>\u4ee3\u7801\u5728\u8fd9 https://gitee.com/rustfisher/AndroidTutorial</p>"},{"location":"android/ndk/field-use/obj-field-use/","title":"\u8bbf\u95ee\u5b9e\u4f8b\u57df","text":""},{"location":"android/ndk/field-use/obj-field-use/#_2","title":"\u4ee3\u7801\u5b9e\u73b0","text":"<p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a<code>FisherTom</code>\u7c7b\uff0c\u91cc\u9762\u6709<code>money</code>\u3002Java\u65b9\u6cd5<code>addMoney()</code>\u8868\u793a\u201c\u589e\u52a0money\u201d\u3002</p> <p>\u8fdb\u884c\u4e00\u4e9b\u8fd0\u7b97\u540e\u6539\u53d8\u4e86<code>money</code>\u7684\u503c\u3002 <pre><code>    private double money = 100;\n\n    static {\n        System.loadLibrary(\"fisher-pole\");\n    }\n\n    public double addMoney() {\n        money = money * 1.2 + 4;\n        return money;\n    }\n\n    public native double nAddMoney();\n</code></pre></p> <p>\u6211\u4eec\u60f3\u7528C++\u4ee3\u7801\u6765\u5b9e\u73b0\u201c\u589e\u52a0money\u201d\u7684\u529f\u80fd\u3002\u65b0\u5efa\u4e00\u4e2a\u672c\u5730\u65b9\u6cd5<code>nAddMoney()</code>\u3002 <pre><code>extern \"C\"\nJNIEXPORT jdouble JNICALL\nJava_com_rustfisher_fishpole_worker_FisherTom_nAddMoney(JNIEnv *env, jobject thiz) {\n    jclass tom_clz = env-&gt;GetObjectClass(thiz); // \u83b7\u53d6\u5230\u8fd9\u4e2aJava\u7c7b\n    jfieldID money_fid = env-&gt;GetFieldID(tom_clz, \"money\", \"D\"); // \u83b7\u53d6\u5230\u5c5e\u6027id\n    jdouble money = env-&gt;GetDoubleField(thiz, money_fid); // \u83b7\u53d6\u5230\u5f53\u524d\u503c\n    money = money * 1.2 + 4.2; // \u7b80\u5355\u7684\u8fd0\u7b97\n    env-&gt;SetDoubleField(thiz, money_fid, money); // \u628a\u503c\u5b58\u8fdb\u53bb\n    return money;\n}\n</code></pre> \u4ee3\u7801\u6d41\u7a0b</p> <ul> <li>\u5728C++\u4ee3\u7801\u4e2d\uff0c\u5148\u8c03\u7528<code>GetObjectClass</code>\u65b9\u6cd5\u83b7\u53d6\u5230jclass\uff0c\u4e5f\u5c31\u662f\u5bf9\u5e94\u7684Java\u7c7b\u3002</li> <li>\u7136\u540e\u627e\u5230<code>money</code>\u7684jfieldID\uff0c\u8fd9\u6837\u624d\u80fd\u76f4\u63a5\u64cd\u4f5c\u5b83\u3002</li> <li>\u8bfb\u53d6\u548c\u8bbe\u7f6e<code>money</code>\u7684\u6570\u503c\uff0c\u5206\u522b\u7528<code>GetDoubleField</code>\u548c<code>SetDoubleField</code>\u65b9\u6cd5\u3002</li> <li><code>SetDoubleField</code>\u4e4b\u540e\uff0c\u5728Java\u5c42\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230<code>money</code>\u7684\u6570\u503c\u5df2\u7ecf\u88ab\u4fee\u6539\u4e86\u3002</li> </ul> <p>\u901a\u8fc7\u4ee5\u4e0a\u4f8b\u5b50\uff0c\u6211\u4eec\u4e86\u89e3\u5982\u4f55\u7528C++\u4fee\u6539\u5bf9\u8c61\u91cc\u7684\u5c5e\u6027\u3002</p>"},{"location":"android/ndk/field-use/obj-field-use/#_3","title":"\u5206\u6790","text":"<p>\u4e0b\u9762\u6211\u4eec\u6765\u4ed4\u7ec6\u770b\u4e00\u4e0b<code>Java_com_rustfisher_fishpole_worker_FisherTom_nAddMoney(JNIEnv *env, jobject thiz)</code></p> <p>\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f<code>jobject</code>\u7c7b\u578b\u3002\u5b9e\u9645\u4e0a\uff0c\u5b83\u548cJava\u4e2d\u7684this\u5f15\u7528\u7b49\u4ef7\u3002 \u9759\u6001\u65b9\u6cd5\u5f97\u5230\u7684\u662f\u7c7b\u7684\u5f15\u7528\uff0c\u800c\u975e\u9759\u6001\u65b9\u6cd5\u5f97\u5230\u7684\u662f\u5bf9\u9690\u5f0f\u7684this\u53c2\u6570\u5bf9\u8c61\u7684\u5f15\u7528\u3002</p> <p>\u73b0\u5728\uff0c\u6211\u4eec\u8bbf\u95ee<code>private double money</code>\u3002 JNI \u8981\u6c42\u7a0b\u5e8f\u5458\u901a\u8fc7\u8c03\u7528\u7279\u6b8a\u7684JNI\u51fd\u6570\u6765\u83b7\u53d6\u548c\u8bbe\u7f6e\u6570\u636e\u7684\u503c\u3002 \u5728\u6211\u4eec\u7684\u4f8b\u5b50\u91cc\uff0c\u8981\u4f7f\u7528<code>GetdoubleField</code>\u548c<code>SetDoubleField</code>\u51fd\u6570\uff0c\u56e0\u4e3a<code>money</code>\u662fdouble\u7c7b\u578b\u7684\u3002</p> <p>\u5bf9\u4e8e\u5176\u4ed6\u7c7b\u578b\uff0c\u53ef\u4ee5\u4f7f\u7528\u7684\u51fd\u6570\u6709:  <code>GetIntField</code>/<code>SetIntField</code>\uff1b<code>GetObjectField</code>/<code>SetObjectField</code>\u7b49\u7b49\u3002</p> <p>\u5176\u901a\u7528\u8bed\u6cd5\u662f: <pre><code>x = env-&gt;GetXxxField(thiz, x);\nenv-&gt;SetXxxField(thiz, fieldID, x);\n</code></pre></p> <p>\u8fd9\u91cc\uff0c<code>fieldID</code>\u662f\u4e00\u4e2a\u7279\u6b8a\u7c7b\u578b<code>jfieldID</code>\u7684\u503c\uff0c<code>jfieldID</code>\u6807\u8bc6\u7ed3\u6784\u4e2d\u7684\u4e00\u4e2a\u57df\uff0c\u800cXxx\u4ee3\u8868Java\u6570\u636e\u7c7b\u578b(Object, Boolean, Byte \u6216\u5176\u4ed6)\u3002\u4e3a\u4e86\u83b7\u5f97<code>fieldID</code>,\u5fc5\u987b\u5148\u83b7\u5f97\u4e00\u4e2a\u8868\u793a\u7c7b\u7684\u503c\uff0c\u6709\u4e24\u79cd\u65b9\u6cd5\u53ef\u4ee5\u5b9e\u73b0\u6b64\u76ee\u7684\u3002 <code>GetObjectClass</code>\u51fd\u6570\u53ef\u4ee5\u8fd4\u56de\u4efb\u610f\u5bf9\u8c61\u7684\u7c7b\u3002 \u4f8b\u5982: <pre><code>jclass tom_clz = env-&gt;GetObjectClass(thiz);\n</code></pre></p> <p><code>FindClass</code>\u51fd\u6570\u53ef\u4ee5\u8ba9\u4f60\u4ee5\u5b57\u7b26\u4e32\u5f62\u5f0f\u6765\u6307\u5b9a\u7c7b\u540d(\u6709\u70b9\u5947\u602a\u7684\u662f\uff0c\u8981\u4ee5/\u4ee3\u66ff\u53e5\u53f7\u4f5c\u4e3a\u5305\u540d\u4e4b\u95f4\u7684\u5206\u9694\u7b26)\u3002 <pre><code>jclass class_String = env-&gt;FindClass(\"java/lang/String);\n</code></pre></p> <p>\u4e4b\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528<code>GetFieldID</code>\u51fd\u6570\u6765\u83b7\u5f97fieldID\u3002 \u5fc5\u987b\u63d0\u4f9b\u57df\u7684\u540d\u5b57\u3001\u5b83\u7684\u7b7e\u540d\u4ee5\u53ca\u5b83\u7684\u7c7b\u578b\u7684\u7f16\u7801\u3002</p> <p>\u4f8b\u5982\uff0c\u4e0b\u9762\u662f\u4ece<code>money</code>\u57df\u5f97\u5230\u57dfID\u7684\u4ee3\u7801: <pre><code>jfieldID money_fid = env-&gt;GetFieldID(tom_clz, \"money\", \"D\");\n</code></pre> \u5b57\u7b26\u4e32\"D\"\u8868\u793a\u7c7b\u578b\u662fdouble\u3002\u540e\u9762\u6211\u4eec\u4f1a\u8bb2\u89e3\u7f16\u7801\u7b7e\u540d\u7684\u5168\u90e8\u89c4\u5219\u3002</p> <p>\u4f60\u53ef\u80fd\u4f1a\u8ba4\u4e3a\u8bbf\u95ee\u6570\u636e\u57df\u76f8\u5f53\u4ee4\u4eba\u8d39\u89e3\u3002JNI\u7684\u8bbe\u8ba1\u8005\u4e0d\u60f3\u628a\u6570\u636e\u57df\u76f4\u63a5\u66b4\u9732\u5728\u5916\uff0c\u6240\u4ee5\u4ed6\u4eec\u4e0d\u5f97\u4e0d\u63d0\u4f9b\u83b7\u53d6\u548c\u8bbe\u7f6e\u6570\u636e\u57df\u503c\u7684\u51fd\u6570\u3002 \u4e3a\u4e86\u4f7f\u8fd9\u4e9b\u51fd\u6570\u7684\u5f00\u9500\u6700\u5c0f\u5316\uff0c\u4ece\u57df\u540d\u8ba1\u7b97\u57dfID (\u4ee3\u4ef7\u6700\u5927\u7684\u4e00\u4e2a\u6b65\u9aa4)\u88ab\u5206\u89e3\u51fa\u6765\u4f5c\u4e3a\u5355\u72ec\u7684\u4e00\u6b65\u64cd\u4f5c\u3002 \u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u4f60\u53cd\u590d\u5730\u83b7\u53d6\u548c\u8bbe\u7f6e\u4e00\u4e2a\u7279\u5b9a\u7684\u57ce\uff0c\u4f60\u8ba1\u7b97\u57df\u6807\u8bc6\u7b26\u7684\u5f00\u9500\u5c31\u53ea\u6709\u4e00\u6b21\u3002</p>"},{"location":"android/ndk/field-use/static-field-use/","title":"\u8bbf\u95ee\u9759\u6001\u57df","text":"<p>\u8bbf\u95ee\u9759\u6001\u57df\u548c\u8bbf\u95ee\u975e\u9759\u6001\u57df\u7c7b\u4f3c\u3002\u4f60\u8981\u4f7f\u7528<code>GetStaticFieldID</code>\u548c<code>GetStaticXxxField</code>/<code>SetStaticXxxField</code>\u51fd\u6570\u3002 \u5b83\u4eec\u51e0\u4e4e\u4e0e\u975e\u9759\u6001\u7684\u60c5\u5f62\u4e00\u6837\u3002</p>"},{"location":"android/ndk/field-use/static-field-use/#_2","title":"\u793a\u4f8b","text":"<p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a<code>FisherTom</code>\u7c7b\u3002\u6211\u4eec\u60f3\u8981\u8bbf\u95ee\u7684\u9759\u6001\u53d8\u91cf\u662f<code>staticNumber1</code>\u3002 <pre><code>public class FisherTom {\n    private static int staticNumber1 = 200;\n\n    static {\n        System.loadLibrary(\"fisher-pole\");\n    }\n\n    public native int nVisitStaticNumber1();\n\n    public static native int nVisitStaticNumber2();\n}\n</code></pre> \u67092\u4e2anative\u65b9\u6cd5\uff0c<code>nVisitStaticNumber1()</code>\u548c<code>nVisitStaticNumber2()</code>\u3002\u540e\u8005\u662f\u9759\u6001\u672c\u5730\u65b9\u6cd5\u3002</p> <p>\u5bf9\u5e94\u7684cpp\u5b9e\u73b0\u4ee3\u7801\u5206\u522b\u5982\u4e0b\uff1a</p> <p><code>nVisitStaticNumber1()</code>\u7684\u5bf9\u5e94\u65b9\u6cd5 <pre><code>extern \"C\"\nJNIEXPORT jint JNICALL\nJava_com_rustfisher_fishpole_worker_FisherTom_nVisitStaticNumber1(JNIEnv *env, jobject thiz) {\n    jclass cls = env-&gt;GetObjectClass(thiz);\n    jfieldID n_fid = env-&gt;GetStaticFieldID(cls, \"staticNumber1\", \"I\");\n    jint n1 = env-&gt;GetStaticIntField(cls, n_fid);\n    return n1;\n}\n</code></pre></p> <p><code>nVisitStaticNumber2()</code>\u7684\u5bf9\u5e94\u65b9\u6cd5\u3002 <pre><code>extern \"C\"\nJNIEXPORT jint JNICALL\nJava_com_rustfisher_fishpole_worker_FisherTom_nVisitStaticNumber2(JNIEnv *env, jclass clazz) {\n    jfieldID n_fid = env-&gt;GetStaticFieldID(clazz, \"staticNumber1\", \"I\");\n    jint n1 = env-&gt;GetStaticIntField(clazz, n_fid);\n    return n1;\n}\n</code></pre></p> <p>\u4ece\u4e0a\u97622\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u770b\u51fa\uff0c\u9759\u6001\u672c\u5730(static native)\u65b9\u6cd5\u5bf9\u5e94\u7684cpp\u65b9\u6cd5\u4e2d\uff0c\u53c2\u6570\u662f<code>jclass</code>\u3002</p> <p>\u800c<code>nVisitStaticNumber1()</code>\u7684\u5bf9\u5e94\u65b9\u6cd5\u53c2\u6570\u91cc\u662f<code>jobject</code>\u3002\u9700\u8981\u4f7f\u7528<code>GetObjectClass</code>\u6765\u83b7\u5f97\u5bf9\u5e94\u7684<code>jclass</code>\u3002</p> <p>\u4e24\u4e2a\u65b9\u6cd5\u5728\u8bbf\u95ee\u9759\u6001\u53d8\u91cf\u65f6\uff0c\u90fd\u8c03\u7528<code>GetStaticFieldID</code>\u65b9\u6cd5\u3002</p> <p>\u901a\u8fc7\u4ee5\u4e0a\u4f8b\u5b50\uff0c\u6211\u4eec\u4e86\u89e3\u5982\u4f55\u7528C++\u8bbf\u95ee\u7c7b\u7684\u9759\u6001\u5c5e\u6027\u3002</p>"},{"location":"android/ndk/io/read_write_txt_file/","title":"NDK \u8bfb\u5199\u6587\u672c\u6587\u4ef6","text":"\u66f4\u65b0\u65e5\u671f 2021-9-1 <ul> <li>2021-9-1 \u66f4\u65b0\u683c\u5f0f</li> <li>2021-1-21 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883\u4e0e\u5de5\u5177 <ul> <li>Android Studio 4.1.1</li> <li>NDK 20.0.*</li> </ul> <p>\u7528cpp\u4ee3\u7801\u5b9e\u73b0\u6587\u4ef6\u7684\u8bfb\u5199\u64cd\u4f5c\u3002</p>"},{"location":"android/ndk/io/read_write_txt_file/#ndk_1","title":"ndk\u73af\u5883\u642d\u5efa","text":"<p>main/cpp\u76ee\u5f55\u4e0b\u7684CMakeLists.txt\uff0c\u6307\u5b9afisher-lib.cpp\u4e3a\u6e90\u6587\u4ef6\u3002\u5e93\u7684\u540d\u79f0\u5b9a\u4e3a<code>fisher-lib</code>\u3002</p> <pre><code>cmake_minimum_required(VERSION 3.4.1)\nadd_library( # Specifies the name of the library.\n             fisher-lib\n\n             # Sets the library as a shared library.\n             SHARED\n\n             # Provides a relative path to your source file(s).\n             fisher-lib.cpp )\n</code></pre>"},{"location":"android/ndk/io/read_write_txt_file/#java","title":"Java\u4ee3\u7801","text":"<p>\u65b0\u5efaFileUtils\u6587\u4ef6\uff0c\u6ce8\u610f\u5305\u540d\u3002 <pre><code>package com.rustfisher.tutorial2020.ndk.util;\n\n/**\n * \u6587\u4ef6\u64cd\u4f5c\u529f\u80fd\n * 2021-1-26\n */\npublic class FileUtils {\n\n    static {\n        System.loadLibrary(\"fisher-lib\");\n    }\n\n    /**\n     * @param filepath \u6587\u4ef6\u7edd\u5bf9\u8def\u5f84\n     */\n    public native String nReadFile(String filepath);\n\n    public native void nWrite(String filepath, String msg);\n}\n</code></pre></p> <p>\u8bb0\u5f97\u52a0\u8f7d<code>fisher-lib</code>\u3002</p>"},{"location":"android/ndk/io/read_write_txt_file/#cpp","title":"cpp\u4ee3\u7801","text":"<p>\u5199\u597dJava\u4ee3\u7801\u540e\uff0c\u4f7f\u7528as\u7684\u529f\u80fd\uff0c\u53ef\u4ee5\u5f88\u5feb\u7684\u5728cpp\u6587\u4ef6\u4e2d\u5f97\u5230\u65b9\u6cd5\u540d\u3002</p> <pre><code>#include &lt;jni.h&gt;\n#include &lt;string&gt;\n\nextern \"C\"\nJNIEXPORT jstring JNICALL\nJava_com_rustfisher_tutorial2020_ndk_util_FileUtils_nReadFile(JNIEnv *env, jobject thiz,\n                                                              jstring filepath) {\n    char *filepathPtr = const_cast&lt;char *&gt;(env-&gt;GetStringUTFChars(filepath, JNI_FALSE));\n    FILE *file = fopen(filepathPtr, \"r+\");\n    char myStr[128];\n    if (file != nullptr) {\n        char *readInPtr = fgets(myStr, 128, file);\n        fclose(file);\n        if (nullptr != readInPtr) {\n            return env-&gt;NewStringUTF(myStr);\n        }\n        return env-&gt;NewStringUTF(\"JNI read file fail!\");\n    }\n    return env-&gt;NewStringUTF(\"JNI read file fail!\");\n}\n\nextern \"C\"\nJNIEXPORT void JNICALL\nJava_com_rustfisher_tutorial2020_ndk_util_FileUtils_nWrite(JNIEnv *env, jobject thiz,\n                                                           jstring filepath, jstring msg) {\n    char *filepathPtr = const_cast&lt;char *&gt;(env-&gt;GetStringUTFChars(filepath, NULL));\n    FILE *file = fopen(filepathPtr, \"w+\");\n    const char *nativeMsg = reinterpret_cast&lt;const char *&gt;(env-&gt;GetStringUTFChars(msg, NULL));\n\n    if (file != nullptr) {\n        fputs(nativeMsg, file);\n        fflush(file);\n        fclose(file);\n    }\n}\n</code></pre>"},{"location":"android/ndk/io/read_write_txt_file/#_1","title":"\u8fd0\u884c\u6d4b\u8bd5","text":"<p>\u4f8b\u5982\u5728NdkFileVm\u91cc\u6267\u884c\u64cd\u4f5c</p> <pre><code>    private final FileUtils mNdkFileUtils = new FileUtils();\n    String mFilepath1;\n\n    public NdkFileVm(@NonNull Application application) {\n        super(application);\n\n        File file = new File(application.getFilesDir(), \"ndk_file1.txt\");\n\n        mFilepath1 = file.getAbsolutePath();\n        if (file.exists()) {\n            try {\n                file.createNewFile();\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n\n\n    public void writeInData(View v) {\n        String data = \"Rust Fisher. Data time \" + System.currentTimeMillis();\n        mNdkFileUtils.nWrite(mFilepath1, data);\n    }\n\n    public void readData(View v) {\n        String data = mNdkFileUtils.nReadFile(mFilepath1);\n        mObData1.set(data);\n    }\n</code></pre>"},{"location":"android/ndk/io/read_write_txt_file/#_2","title":"\u65b9\u6cd5\u8bb0\u5f55","text":""},{"location":"android/ndk/io/read_write_txt_file/#fopen","title":"\u6253\u5f00\u6587\u4ef6 <code>fopen</code>","text":"<p><code>FILE * fopen(const char * path,const char * mode);</code> mode\u6a21\u5f0f\u9009\u62e9\uff0c\u4f8b\u5982<code>\"r\"</code></p> <ul> <li>r(read): \u8bfb</li> <li>w(write): \u5199</li> <li>a(append): \u8ffd\u52a0</li> <li>t(text): \u6587\u672c\u6587\u4ef6\uff0c\u53ef\u7701\u7565\u4e0d\u5199</li> <li>b(banary): \u4e8c\u8fdb\u5236\u6587\u4ef6</li> <li>+: \u8bfb\u548c\u5199</li> </ul> <p>\u51e1\u7528\u201cr\u201d\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u65f6\uff0c\u8be5\u6587\u4ef6\u5fc5\u987b\u5df2\u7ecf\u5b58\u5728\uff0c\u4e14\u53ea\u80fd\u4ece\u8be5\u6587\u4ef6\u8bfb\u51fa\u3002</p> <p>\u7528\u201cw\u201d\u6253\u5f00\u7684\u6587\u4ef6\u53ea\u80fd\u5411\u8be5\u6587\u4ef6\u5199\u5165\u3002\u82e5\u6253\u5f00\u7684\u6587\u4ef6\u4e0d\u5b58\u5728\uff0c\u5219\u4ee5\u6307\u5b9a\u7684\u6587\u4ef6\u540d\u5efa\u7acb\u8be5\u6587\u4ef6\uff0c\u82e5\u6253\u5f00\u7684\u6587\u4ef6\u5df2 \u7ecf\u5b58\u5728\uff0c\u5219\u5c06\u8be5\u6587\u4ef6\u5220\u53bb\uff0c\u91cd\u5efa\u4e00\u4e2a\u65b0\u6587\u4ef6\u3002\u8fd9\u4e2a\u65b9\u6cd5\u4fdd\u8bc1\u76ee\u6807\u6587\u4ef6\u91cc\u5199\u5165\u7684\u53ea\u6709\u6211\u4eec\u8981\u7684\u6570\u636e\u3002</p> <p>\u82e5\u8981\u5411\u4e00\u4e2a\u5df2\u5b58\u5728\u7684\u6587\u4ef6\u8ffd\u52a0\u65b0\u7684\u4fe1\u606f\uff0c\u53ea\u80fd\u7528\u201ca\u201d\u65b9\u5f0f\u6253\u5f00\u6587\u4ef6\u3002\u4f46\u6b64\u65f6\u8be5\u6587\u4ef6\u5fc5\u987b\u662f\u5b58\u5728\u7684\uff0c\u5426\u5219\u5c06\u4f1a\u51fa\u9519\u3002</p> <p>\u5728\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u65f6\uff0c\u5982\u679c\u51fa\u9519\uff0cfopen\u5c06\u8fd4\u56de\u4e00\u4e2a\u7a7a\u6307\u9488\u503cNULL\u3002\u5728\u7a0b\u5e8f\u4e2d\u53ef\u4ee5\u7528\u8fd9\u4e00\u4fe1\u606f\u6765\u5224\u522b\u662f\u5426\u5b8c\u6210 \u6253\u5f00\u6587\u4ef6\u7684\u5de5\u4f5c\uff0c\u5e76\u4f5c\u76f8\u5e94\u7684\u5904\u7406\u3002</p> <p>\u5982\u679c\u6210\u529f\u7684\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6, fopen()\u51fd\u6570\u8fd4\u56de\u6587\u4ef6\u6307\u9488, \u5426\u5219\u8fd4\u56de\u7a7a\u6307\u9488</p>"},{"location":"android/ndk/io/read_write_txt_file/#fgets","title":"\u8bfb\u53d6\u6587\u4ef6\u6570\u636e <code>fgets</code>","text":"<p><code>char *fgets(char *s, int n, FILE *stream);</code> \u4ece\u6587\u4ef6\u6307\u9488stream\u4e2d\u8bfb\u53d6n-1\u4e2a\u5b57\u7b26\uff0c\u5b58\u5230\u4ee5s\u4e3a\u8d77\u59cb\u5730\u5740\u7684\u7a7a\u95f4\u91cc\uff0c\u76f4\u5230\u8bfb\u5b8c\u4e00\u884c\uff0c\u5982\u679c\u6210\u529f\u5219\u8fd4\u56des\u7684\u6307 \u9488\uff0c\u5426\u5219\u8fd4\u56deNULL\u3002</p>"},{"location":"android/ndk/io/read_write_txt_file/#env-newstringutf","title":"env-&gt;NewStringUTF","text":"<p><code>(*env)-&gt;NewStringUTF(env, char *);</code> \u5982\u679c\u4f20\u5165\u7684char*\u662f\u4e00\u4e2a\u7a7a\u503c\uff0c\u5728\u4e00\u4e9b\u5e73\u53f0\u4e0a\u4f1a\u62a5\u9519\u3002 \u6bd4\u5982\u7ea2\u7c73\u624b\u673a\u4f1a\u76f4\u63a5\u5d29\u6e83\uff0c\u800c\u9b45\u65cf\u624b\u673a\u80fd\u5f97\u5230\u4e00\u4e2a\u7a7a\u7684String\u3002 \u53ef\u4ee5\u53c2\u8003NDK\u4e2d\u7684\u5b57\u7b26\u4e32</p> <p>\ud83e\uddd1\ud83c\udffb\u200d\ud83d\udcbb \u793a\u4f8b\u4ee3\u7801</p>"},{"location":"android/ndk/return/return-array/","title":"\u8fd4\u56de\u6570\u7ec4","text":"<p>\u8fd4\u56de\u6570\u7ec4\uff0c\u4f8b\u5982int\u6570\u7ec4\uff0cfloat\u6570\u7ec4\u7b49\u7b49\u3002</p>"},{"location":"android/ndk/return/return-array/#int","title":"\u8fd4\u56de\u65b0\u7684int\u6570\u7ec4","text":"<p>\u65b0\u521b\u5efa<code>jintArray</code>\u5e76\u8fd4\u56de\u3002 <pre><code>public native int[] nGenIntArray();\n</code></pre></p> <p>\u751f\u6210<code>jintArray</code>\uff0c\u9700\u8981\u8c03\u7528<code>NewIntArray</code>\u65b9\u6cd5\u3002\u751f\u6210\u6570\u7ec4\u540e\uff0c\u9700\u8981<code>SetIntArrayRegion</code>\u65b9\u6cd5\u5c06\u6570\u636e\u586b\u5145\u8fdb\u53bb\u3002 <pre><code>extern \"C\"\nJNIEXPORT jintArray JNICALL\nJava_com_rustfisher_fishpole_worker_BaseParam_nGenIntArray(JNIEnv *env, jobject thiz) {\n    int arr[] = {1, 2, 3, 4, 5, 6, 7, 8, 9, 0};\n    int len = sizeof(arr) / sizeof(arr[0]);\n    jintArray resArr = env-&gt;NewIntArray(len);\n    env-&gt;SetIntArrayRegion(resArr, 0, len, arr);\n    return resArr;\n}\n</code></pre></p>"},{"location":"android/ndk/return/return-array/#_2","title":"\u64cd\u4f5c\u6570\u7ec4\u4e2d\u7684\u5143\u7d20","text":"<p>\u8f93\u5165\u4e00\u4e2a\u6570\u7ec4\uff0c\u4fee\u6539\u91cc\u9762\u7684\u6570\u636e\u3002</p> <pre><code>public native void nModifyIntArray(int[] input);\n</code></pre> <p>\u8f93\u5165\u7684<code>jintArray</code>\u53ef\u4ee5\u7528<code>GetArrayLength</code>\u65b9\u6cd5\u83b7\u53d6\u957f\u5ea6\u3002 \u901a\u8fc7<code>GetIntArrayElements</code>\u62ff\u5230\u6307\u9488\u3002 \u4fee\u6539\u540e\u518d\u628a\u6570\u636e\u590d\u5236\u5230<code>jintArray</code>\u4e2d\u3002 <pre><code>extern \"C\"\nJNIEXPORT void JNICALL\nJava_com_rustfisher_fishpole_worker_BaseParam_nModifyIntArray(JNIEnv *env, jobject thiz,\n                                                              jintArray input) {\n    int len = env-&gt;GetArrayLength(input);\n    int* ptr = env-&gt;GetIntArrayElements(input, JNI_FALSE);\n    for(int i = 0; i &lt; len; i++) {\n        ptr[i] = i + len;\n    }\n    env-&gt;ReleaseIntArrayElements(input, ptr, JNI_COMMIT);\n    delete ptr;\n}\n</code></pre></p> <p><code>ReleaseIntArrayElements</code>\u7b2c3\u4e2a\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li>0 Updates to the array from within the C code are reflected in the Java language copy.</li> <li>JNI_COMMIT forces the native array to be copied back to the original array in the Java virtual machine. </li> <li>JNI_ABORT frees the memory allocated for the native array without copying back the new contents.</li> </ul> <p>\u4e0a\u9762\u6211\u4eec\u4f7f\u7528\u7684\u662fJNI_COMMIT\uff0c\u628anative\u6570\u7ec4\u7684\u503c\u590d\u5236\u5230Java\u7684\u6570\u7ec4\u4e2d\u3002</p>"},{"location":"android/ndk/return/return-base-type/","title":"\u8fd4\u56deJava\u57fa\u672c\u7c7b\u578b","text":"<p>\u5f53\u5728C\u548cJava\u4e4b\u95f4\u4f20\u9012\u6570\u5b57\u65f6\uff0c\u5e94\u8be5\u77e5\u9053\u5b83\u4eec\u5f7c\u6b64\u4e4b\u95f4\u7684\u5bf9\u5e94\u7c7b\u578b\u3002</p> <p>\u4f8b\u5982\uff0cC\u4e5f\u6709int\u548clong\u7684\u6570\u636e\u7c7b\u578b\uff0c\u4f46\u662f\u5b83\u4eec\u7684\u5b9e\u73b0\u5374\u662f\u53d6\u51b3\u4e8e\u5e73\u53f0\u7684\u3002\u5728\u4e00\u4e9b\u5e73\u53f0\u4e0a\uff0cint\u7c7b\u578b\u662f16\u4f4d\u7684\uff0c\u5728\u53e6\u5916\u4e00\u4e9b\u5e73\u53f0\u4e0a\u662f32\u4f4d\u7684\u3002</p> <p>\u7136\u800c\uff0c\u5728Java\u5e73\u53f0\u4e0aint\u7c7b\u578b\u603b\u662f32\u4f4d\u7684\u6574\u6570\u3002\u57fa\u4e8e\u8fd9\u4e2a\u539f\u56e0\uff0cJava\u672c\u5730\u63a5\u53e3\u5b9a\u4e49\u4e86jint\u3001jlong\u7b49\u7c7b\u578b\u3002</p> <p>Java\u6570\u636e\u7c7b\u578b\u548cC\u6570\u636e\u7c7b\u578b\u7684\u5bf9\u5e94\u5173\u7cfb</p> Java C \u5b57\u8282 boolean jboolean 1 byte jbyte 1 char jchar 2 short jshort 2 int jint 4 long jlong 8 float jfloat 4 double jdouble 8 <p>\u5728\u5934\u6587\u4ef6jni.h\u4e2d\uff0c\u8fd9\u4e9b\u7c7b\u578b\u88ab<code>typedef</code>\u8bed\u53e5\u58f0\u660e\u4e3a\u5728\u76ee\u6807\u5e73\u53f0\u4e0a\u7b49\u4ef7\u7684\u7c7b\u578b\u3002</p> <p>\u8be5\u5934\u6587\u4ef6\u8fd8\u5b9a\u4e49\u4e86\u5e38\u91cfJNI_FALSE = 0\u548cJNI_TRUE = 1\u3002</p>"},{"location":"android/ndk/return/return-base-type/#java","title":"\u8fd4\u56deJava\u57fa\u672c\u7c7b\u578b","text":"<p>Java\u76848\u79cd\u57fa\u672c\u7c7b\u578b\uff1a char\uff0cbyte\uff0cshort\uff0cint\uff0clong\uff0cfloat\uff0cdouble\uff0cboolean</p> <p>\u4e0b\u9762\u7b80\u5355\u6f14\u793a\u8fd4\u56de8\u79cd\u57fa\u672c\u7c7b\u578b\u7684\u65b9\u6cd5\u3002 \u65b0\u5efa<code>BaseParam.java</code>\u4e0e<code>baseparam.cpp</code>\u6587\u4ef6\u3002\u5206\u522b\u5b9e\u73b0native\u65b9\u6cd5\u4e0ec\u65b9\u6cd5\u3002</p> <p>\u6a21\u5757\u540d\u5b57\u4e3a<code>fisher-pole</code>\u3002 <pre><code>static {\n    System.loadLibrary(\"fisher-pole\");\n}\n</code></pre></p>"},{"location":"android/ndk/return/return-base-type/#char","title":"char","text":"<pre><code>public native char nChar();\n</code></pre> <pre><code>extern \"C\"\nJNIEXPORT jchar JNICALL\nJava_com_rustfisher_fishpole_worker_BaseParam_nChar(JNIEnv *env, jobject thiz) {\n    return 'a';\n}\n</code></pre> <p>\u8fd4\u56dechar    a</p>"},{"location":"android/ndk/return/return-base-type/#byte","title":"byte","text":"<pre><code>public native byte nByte();\n</code></pre> <pre><code>extern \"C\"\nJNIEXPORT jbyte JNICALL\nJava_com_rustfisher_fishpole_worker_BaseParam_nByte(JNIEnv *env, jobject thiz) {\n    unsigned char abc = 99;\n    return abc;\n}\n</code></pre> <p>\u8fd4\u56debyte    99</p>"},{"location":"android/ndk/return/return-base-type/#short","title":"short","text":"<pre><code>public native short nShort();\n</code></pre> <pre><code>extern \"C\"\nJNIEXPORT jshort JNICALL\nJava_com_rustfisher_fishpole_worker_BaseParam_nShort(JNIEnv *env, jobject thiz) {\n    short s = 128;\n    return s;\n}\n</code></pre> <p>\u8fd4\u56deshort   128</p>"},{"location":"android/ndk/return/return-base-type/#int","title":"int","text":"<pre><code>public native int nInt();\n</code></pre> <pre><code>extern \"C\"\nJNIEXPORT jint JNICALL\nJava_com_rustfisher_fishpole_worker_BaseParam_nInt(JNIEnv *env, jobject thiz) {\n    return 42;\n}\n</code></pre> <p>\u8fd4\u56deint     42</p>"},{"location":"android/ndk/return/return-base-type/#long","title":"long","text":"<pre><code>public native long nLong();\n</code></pre> <p><pre><code>extern \"C\"\nJNIEXPORT jlong JNICALL\nJava_com_rustfisher_fishpole_worker_BaseParam_nLong(JNIEnv *env, jobject thiz) {\n    long res = 123456789;\n    return res;\n}\n</code></pre> \u8fd4\u56delong    123456789</p>"},{"location":"android/ndk/return/return-base-type/#float","title":"float","text":"<pre><code>public native float nFloat();\n</code></pre> <p><pre><code>extern \"C\"\nJNIEXPORT jfloat JNICALL\nJava_com_rustfisher_fishpole_worker_BaseParam_nFloat(JNIEnv *env, jobject thiz) {\n    return 3.14159F;\n}\n</code></pre> \u8fd4\u56defloat   3.14159</p>"},{"location":"android/ndk/return/return-base-type/#double","title":"double","text":"<pre><code>public native double nDouble();\n</code></pre> <p><pre><code>extern \"C\"\nJNIEXPORT jdouble JNICALL\nJava_com_rustfisher_fishpole_worker_BaseParam_nDouble(JNIEnv *env, jobject thiz) {\n    return 3.141592658;\n}\n</code></pre> \u8fd4\u56dedouble  3.141592658</p>"},{"location":"android/ndk/return/return-base-type/#boolean","title":"boolean","text":"<pre><code>public native boolean nBool();\n</code></pre> <pre><code>extern \"C\"\nJNIEXPORT jboolean JNICALL\nJava_com_rustfisher_fishpole_worker_BaseParam_nBool(JNIEnv *env, jobject thiz) {\n    return JNI_FALSE;\n}\n</code></pre> <p>\u8fd4\u56deboolean false</p>"},{"location":"android/ndk/return/return-pojo/","title":"\u8fd4\u56deJava\u7b80\u5355\u5bf9\u8c61","text":"<p>NDK\u4e2d\u53ef\u4ee5\u521b\u5efaJava\u5bf9\u8c61\u5e76\u8fd4\u56de\u3002 \u4e3b\u8981\u6d89\u53ca\u7684\u65b9\u6cd5\u6709\uff1a</p> \u65b9\u6cd5 \u7b80\u4ecb jclass FindClass(const char* name) \u83b7\u53d6Java\u7c7b jmethodID GetMethodID(jclass clazz, const char name, const char sig) \u83b7\u53d6Java\u65b9\u6cd5ID jobject NewObject(jclass clazz, jmethodID methodID, ...) \u65b0\u5efaJava\u5bf9\u8c61"},{"location":"android/ndk/return/return-pojo/#java_1","title":"\u65b0\u5efaJava\u7c7b","text":"<p>\u65b0\u5efa\u4e00\u4e2aJava\u7c7b<code>Carp</code>\u3002\u521b\u5efa\u4e00\u4e2a\u67094\u4e2a\u53c2\u6570\u7684\u6784\u9020\u65b9\u6cd5\u3002</p> <pre><code>public class Carp {\n    private String name;\n    private int age;\n    private float weight;\n    private boolean alive;\n\n    public Carp() {\n    }\n\n    public Carp(String name, int age, float weight, boolean alive) {\n        this.name = name;\n        this.age = age;\n        this.weight = weight;\n        this.alive = alive;\n    }\n    // getter setter ..\n\n    @NonNull\n    @Override\n    public String toString() {\n        return String.format(Locale.CHINA, \"Carp {name: %s, age: %d, weight: %f, alive: %b}\",\n                name, age, weight, alive);\n    }\n}\n</code></pre>"},{"location":"android/ndk/return/return-pojo/#nativecpp","title":"native\u4e0ecpp","text":"<p>\u5b9a\u4e49native\u65b9\u6cd5\uff0c\u4f20\u5165\u4e3b\u8981\u7684\u53c2\u6570\u3002</p> <pre><code>public native Carp nGetCarp(String name, int age, float weight, boolean alive);\n</code></pre> <p>cpp\u65b9\u6cd5\u4e2d\u521b\u5efa\u5bf9\u8c61\u5e76\u8fd4\u56de\u3002 <pre><code>extern \"C\"\nJNIEXPORT jobject JNICALL\nJava_com_rustfisher_fishpole_worker_BaseParam_nGetCarp(JNIEnv *env, jobject thiz, jstring name,\n                                                       jint age, jfloat weight, jboolean alive) {\n    jclass carp_clz = env-&gt;FindClass(\"com/rustfisher/fishpole/data/Carp\");\n    jmethodID fun_construct = env-&gt;GetMethodID(carp_clz, \"&lt;init&gt;\", \"(Ljava/lang/String;IFZ)V\");\n    return env-&gt;NewObject(carp_clz, fun_construct, name, age, weight, alive);\n}\n</code></pre></p> <p><code>FindClass</code>\u9700\u8981\u4f20\u5165\u5b8c\u6574\u7684\u7c7b\u540d\u3002\u4f8b\u5b50\u4e2d\u662f<code>\"com/rustfisher/fishpole/data/Carp\"</code>\u3002</p> <p>\u7136\u540e\u9700\u8981\u62ff\u5230\u6784\u9020\u65b9\u6cd5\uff0c\u6784\u9020\u65b9\u6cd5<code>public Carp(String name, int age, float weight, boolean alive)</code>\u7684\u65b9\u6cd5\u7b7e\u540d\u662f<code>(Ljava/lang/String;IFZ)V</code>\u3002</p> <p>\u6700\u540e\u8c03\u7528\u6784\u9020\u65b9\u6cd5\u521b\u5efa\u65b0\u5bf9\u8c61\u5e76\u8fd4\u56de\u3002</p> <p>Java\u4e2d\u4f7f\u7528\u8fd9\u4e2anative <code>nGetCarp</code> \u65b9\u6cd5\u3002 <pre><code>baseParam.nGetCarp(\"Carp1\", 1, 1.1f, true);\n// Carp {name: Carp1, age: 1, weight: 1.100000, alive: true}\n</code></pre></p>"},{"location":"android/ndk/start/add-ndk-to-mod/","title":"\u6a21\u5757\u6dfb\u52a0C/C++\u652f\u6301","text":"\u66f4\u65b0\u65e5\u671f 2021-9-1 <ul> <li>2021-9-1 \u66f4\u65b0\u683c\u5f0f</li> <li>2021-6-26 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u5982\u4f55\u7ed9\u5de5\u7a0b\u6dfb\u52a0C/C++\u652f\u6301\u3002 \u672c\u6587\u8bb0\u5f55\u5982\u4f55\u7ed9\u5de5\u7a0b\u4e2d\u7684\u6a21\u5757\uff08library\uff09\u6dfb\u52a0C/C++\u652f\u6301\u3002</p>"},{"location":"android/ndk/start/add-ndk-to-mod/#_1","title":"\u65b0\u5efa\u6a21\u5757","text":"<p>\u6a21\u5757\u5316\u662f\u9879\u76ee\u5f00\u53d1\u7684\u5e38\u89c1\u65b9\u5f0f\u3002\u53ef\u4ee5\u6309\u7167\u529f\u80fd\u5212\u5206\u6a21\u5757\uff0c\u533a\u5206\u7ba1\u7406\u3002\u8fbe\u5230\u89e3\u8026\u7684\u6548\u679c\u3002</p> <p>\u5de5\u7a0b\u4e2d\u5df2\u6709<code>app</code>\u6a21\u5757\u3002\u65b0\u5efa\u6a21\u5757<code>fishpole</code>\u3002</p> \u65b0\u5efa\u6a21\u5757 <p></p> <p>\u9009\u62e9Android Library</p> \u9009\u62e9 Android Library <p></p> <p>\u4e00\u8def\u70b9\u51fb\u4e0b\u4e00\u6b65\u76f4\u81f3\u5b8c\u6210\u3002</p> <p>\u67e5\u770b\u9879\u76ee\u7684<code>settings.gradle</code>\uff0c\u770b\u5230\u591a\u4e86<code>fishpole</code>\u6a21\u5757\u3002</p> <pre><code>include ':fishpole'\n</code></pre> <p>\u8ba9<code>app</code>\u6a21\u5757\u4f9d\u8d56<code>fishpole</code>\u3002<code>app</code>\u6a21\u5757\u7684gradle\u6dfb\u52a0\u4e86\u4f9d\u8d56\u3002 <pre><code>dependencies {\n    // ...\n    implementation project(path: ':fishpole')\n}\n</code></pre></p>"},{"location":"android/ndk/start/add-ndk-to-mod/#ndk","title":"\u6a21\u5757\u6dfb\u52a0NDK","text":"<p>\u548c\u4e4b\u524d\u7ed9\u73b0\u6709\u9879\u76ee\u6dfb\u52a0C/C++\u652f\u6301\u7c7b\u4f3c\u3002\u5927\u81f4\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ul> <li>\u6dfb\u52a0cpp\u76ee\u5f55</li> <li>\u5728cpp\u76ee\u5f55\u4e2d\u6dfb\u52a0cmake</li> <li>\u5728gradle\u4e2d\u914d\u7f6ecmake</li> <li>\u65b0\u5efanative\u65b9\u6cd5</li> <li>\u7f16\u5199cpp\u5b9e\u73b0\u65b9\u6cd5</li> </ul>"},{"location":"android/ndk/start/add-ndk-to-mod/#cmake","title":"cmake","text":"<p>CMakeLists.txt\u6587\u4ef6\u3002\u6a21\u5757\u540d\u5b57\u4e3a<code>fisher-pole</code>\u3002 <pre><code>cmake_minimum_required(VERSION 3.4.1)\nadd_library( # Specifies the name of the library.\n             fisher-pole\n\n             # Sets the library as a shared library.\n             SHARED\n\n             # Provides a relative path to your source file(s).\n             tom.cpp jerry.cpp )\n</code></pre></p> <p>cpp\u6587\u4ef6\u5728\u4e0b\u6587\u3002</p>"},{"location":"android/ndk/start/add-ndk-to-mod/#gradle","title":"gradle","text":"<p>\u6a21\u5757gradle\u6587\u4ef6\u6dfb\u52a0cmake\u914d\u7f6e <pre><code>android {\n    externalNativeBuild {\n        cmake {\n            path \"src/main/cpp/CMakeLists.txt\"\n            version \"3.10.2\"\n        }\n    }\n}\n</code></pre></p>"},{"location":"android/ndk/start/add-ndk-to-mod/#java-kotlin-c","title":"Java, Kotlin, C++","text":"<p>\u65b0\u5efaJava\u7c7b<code>FisherTom</code>\u3002\u58f0\u660e\u51e0\u4e2anative\u65b9\u6cd5\u3002\u4e0d\u8981\u5fd8\u8bb0<code>System.loadLibrary</code>\u3002 <pre><code>public class FisherTom {\n    static {\n        System.loadLibrary(\"fisher-pole\");\n    }\n\n    public native int addFish(int a, int b);\n\n    public native float calFish(float f1, float f2);\n\n    public native String name();\n}\n</code></pre></p> <p>\u4e0e<code>FisherTom</code>\u5bf9\u5e94\u7684<code>tom.cpp</code> <pre><code>#include &lt;jni.h&gt;\n#include &lt;string&gt;\n\nextern \"C\"\nJNIEXPORT jstring JNICALL\nJava_com_rustfisher_fishpole_worker_FisherTom_name(JNIEnv *env, jobject thiz) {\n    std::string myName = \"Tom\";\n    return env-&gt;NewStringUTF(myName.c_str());\n}\n\nextern \"C\"\nJNIEXPORT jint JNICALL\nJava_com_rustfisher_fishpole_worker_FisherTom_addFish(JNIEnv *env, jobject thiz, jint a, jint b) {\n    return a + b;\n}\n\nextern \"C\"\nJNIEXPORT jfloat JNICALL\nJava_com_rustfisher_fishpole_worker_FisherTom_calFish(JNIEnv *env, jobject thiz, jfloat f1,\n                                                      jfloat f2) {\n    return f1 * f2;\n}\n</code></pre></p> <p>\u518d\u65b0\u5efa\u4e00\u4e2aKotlin\u7c7b<code>Jerry</code>\u3002\u58f0\u660e\u51e0\u4e2a<code>external</code>\u65b9\u6cd5\u3002 <pre><code>class Jerry {\n    companion object {\n        init {\n            System.loadLibrary(\"fisher-pole\")\n        }\n    }\n\n    external fun addFish(a: Int, b: Int): Int\n    external fun calFish(f1: Float, f2: Float): Float\n    external fun name(): String?\n}\n</code></pre></p> <p>Java\u4e2d\u7684native\u65b9\u6cd5\uff0c\u5728Kotlin\u4e2d\u4f7f\u7528external\u3002</p> <p>\u4e0e<code>Jerry</code>\u5bf9\u5e94\u7684jerry.cpp <pre><code>#include &lt;jni.h&gt;\n#include &lt;string&gt;\n\nextern \"C\"\nJNIEXPORT jint JNICALL\nJava_com_rustfisher_fishpole_worker_Jerry_addFish(JNIEnv *env, jobject thiz, jint a, jint b) {\n    return a + b;\n}\n\nextern \"C\"\nJNIEXPORT jfloat JNICALL\nJava_com_rustfisher_fishpole_worker_Jerry_calFish(JNIEnv *env, jobject thiz, jfloat f1, jfloat f2) {\n    return f1 * f2 * 1.1f; // Different with Tom ;)\n}\n\nextern \"C\"\nJNIEXPORT jstring JNICALL\nJava_com_rustfisher_fishpole_worker_Jerry_name(JNIEnv *env, jobject thiz) {\n    std::string jerry = \"Jerry\";\n    return env-&gt;NewStringUTF(jerry.c_str());\n}\n</code></pre></p>"},{"location":"android/ndk/start/add-ndk-to-mod/#_2","title":"\u4f7f\u7528","text":"<p>\u5728\u6211\u4eec\u7684app\u6a21\u5757\u4e2d\u4f7f\u7528\u8fd92\u4e2a\u7c7b\u3002 <pre><code>FisherTom tom = new FisherTom();\nJerry jerry = new Jerry();\nString tomMsg = tom.name() + \": int: \" + tom.addFish(1, 2) + \", float: \" + tom.calFish(2, 3.4f);\nString jerryMsg = jerry.name() + \": int: \" + jerry.addFish(1, 2) + \", float: \" + jerry.calFish(2, 3.4f);\n</code></pre></p> <p>\ud83e\uddd1\ud83c\udffb\u200d\ud83d\udcbb \u793a\u4f8b\u4ee3\u7801</p>"},{"location":"android/ndk/start/add-ndk-to-proj/","title":"\u6dfb\u52a0C/C++\u652f\u6301","text":"\u66f4\u65b0\u65e5\u671f 2021-9-1 <ul> <li>2021-9-1 \u66f4\u65b0\u683c\u5f0f</li> <li>2020-5-28 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u524d\u9762\u6211\u4eec\u65b0\u5efa\u5de5\u7a0b\u65f6\u9009\u62e9\u652f\u6301C/C++\u3002\u5982\u4f55\u7ed9\u73b0\u6709\u9879\u76ee\u6dfb\u52a0C/C++\u652f\u6301\u5462\uff1f</p>"},{"location":"android/ndk/start/add-ndk-to-proj/#_1","title":"\u6dfb\u52a0\u6b65\u9aa4","text":"<p>\u4ee5Tutorial2020\u5de5\u7a0b\u4e3a\u4f8b\u3002\u6211\u4eec\u7ed9\u5b83\u624b\u52a8\u6dfb\u52a0NDK\u3002 \u5de5\u7a0b\u4e2d\u6709\u4e00\u4e2aapp\u6a21\u5757\u3002\u5f80\u8fd9\u4e2a\u6a21\u5757\u4e2d\u6dfb\u52a0NDK\u3002</p>"},{"location":"android/ndk/start/add-ndk-to-proj/#cpp","title":"\u6dfb\u52a0cpp\u76ee\u5f55","text":"<p>\u5728app/src/main\u76ee\u5f55\u4e0b\uff0c\u65b0\u5efacpp\u76ee\u5f55\uff0c\u5176\u4e0ejava\u540c\u7ea7\u3002</p> <p>\u5728cpp\u76ee\u5f55\u4e2d\u65b0\u5efa\u6587\u4ef6<code>fisher-lib.cpp</code>\u3002\u76ee\u524d\u8fd9\u4e2a\u6587\u4ef6\u8fd8\u662f\u7a7a\u7684\uff0c\u540e\u9762\u518d\u6dfb\u52a0\u4ee3\u7801\u3002</p>"},{"location":"android/ndk/start/add-ndk-to-proj/#native","title":"\u65b0\u5efanative\u65b9\u6cd5","text":"<p>\u65b0\u5efa<code>CalUtil</code>\u7c7b\uff0c\u91cc\u9762\u5b9a\u4e49native\u65b9\u6cd5\u3002 <pre><code>package com.rustfisher.tutorial2020.cal;\n\npublic class CalUtil {\n    public native int getNumber();\n\n    public native String getMsg();\n}\n</code></pre></p>"},{"location":"android/ndk/start/add-ndk-to-proj/#cmake","title":"\u6dfb\u52a0cmake\u914d\u7f6e","text":"<p>\u5728cpp\u76ee\u5f55\u4e2d\u65b0\u5efa<code>CMakeLists.txt</code>\u6587\u4ef6\u3002 \u4f7f\u7528<code>add_library</code>\u65b9\u6cd5\u8fdb\u884c\u914d\u7f6e\u3002\u5e93\u540d\u53eb\u505a<code>fisher-lib</code>\u3002 <pre><code>cmake_minimum_required(VERSION 3.4.1)\nadd_library( # Specifies the name of the library.\n             fisher-lib\n\n             # Sets the library as a shared library.\n             SHARED\n\n             # Provides a relative path to your source file(s).\n             fisher-lib.cpp )\n</code></pre></p> <p>\u6b64\u65f6cmake\u8fd8\u6ca1\u6709\u8d77\u4f5c\u7528\u3002\u4eceas\u4e2d\u53ef\u4ee5\u770b\u51fa\u5b57\u4f53\u90fd\u8fd8\u662f\u7070\u8272\u3002\u6211\u4eec\u8fd8\u9700\u8981\u914d\u7f6egradle\u3002</p>"},{"location":"android/ndk/start/add-ndk-to-proj/#gradle","title":"\u914d\u7f6egradle","text":"<p>\u4eff\u7167\u4e4b\u524d\u7684\u65b0\u5efa\u5de5\u7a0b\uff0c\u6dfb\u52a0gradle\u914d\u7f6e<code>externalNativeBuild</code>\u3002\u6307\u5b9acmake\u7684\u8def\u5f84\u548c\u7248\u672c\u3002 <pre><code>android {\n\n    defaultConfig {\n        // \u8981\u6dfb\u52a0\u7684\u90e8\u5206\n        externalNativeBuild {\n            cmake {\n                cppFlags \"\"\n            }\n        }\n    }\n\n    // \u8981\u6dfb\u52a0\u7684\u90e8\u5206\n    externalNativeBuild {\n        cmake {\n            path \"src/main/cpp/CMakeLists.txt\"\n            version \"3.10.2\"\n        }\n    }\n}\n</code></pre></p> <p>sync\u540e\u53ef\u4ee5\u53d1\u73b0CMakeLists.txt\u7684\u4ee3\u7801\u5df2\u7ecf\u6709\u989c\u8272\u4e86\u3002</p>"},{"location":"android/ndk/start/add-ndk-to-proj/#cpp_1","title":"\u5b9e\u73b0cpp","text":"<p>\u73b0\u5728gradle\u548ccmake\u5df2\u7ecf\u914d\u7f6e\u5b8c\u6bd5\uff0c\u6211\u4eec\u6765\u5b9e\u73b0cpp\u4ee3\u7801\u3002 CalUtil\u4e2d\u67092\u4e2anative\u65b9\u6cd5\uff0c\u65b9\u6cd5\u7b7e\u540d\u524d\u7f00\u662f<code>Java_com_rustfisher_tutorial2020_cal_CalUtil_</code>\u3002 \u5f53\u6211\u4eec\u8f93\u5165<code>g</code>\u65f6\uff0cas\u4f1a\u667a\u80fd\u63d0\u793a\u51fa\u6211\u4eec\u60f3\u8981\u7684\u65b9\u6cd5\u540d\u3002\u5341\u5206\u4fbf\u5229\u3002 <pre><code>#include &lt;jni.h&gt;\n#include &lt;string&gt;\n\nextern \"C\" JNIEXPORT jstring JNICALL\nJava_com_rustfisher_tutorial2020_cal_CalUtil_getMsg(JNIEnv *env, jobject thiz) {\n    std::string hello = \"\u6b22\u8fce\u6765\u5230Tutorial\";\n    return env-&gt;NewStringUTF(hello.c_str());\n}\n\nextern \"C\" JNIEXPORT jint JNICALL\nJava_com_rustfisher_tutorial2020_cal_CalUtil_getNumber(JNIEnv *env, jobject thiz) {\n    return 2020;\n}\n</code></pre></p> <p>\u8fd9\u91cc\u9047\u5230\u4e00\u4e2aas\u7684\u95ee\u9898\uff0c\u7f16\u5199\u597dcpp\u4ee3\u7801\u540e\uff0c\u4f1a\u6709\u7ea2\u7ebf\u63d0\u793a\u4ee3\u7801\u9519\u8bef\u3002\u4f46\u662f\u76f4\u63a5\u8fd0\u884c\u9879\u76ee\u53c8\u662f\u6b63\u5e38\u7684\u3002 \u91cd\u65b0\u6253\u5f00\u4e00\u6b21\u8fd9\u4e2a\u5de5\u7a0b\uff0c\u7ea2\u7ebf\u5c31\u4e0d\u89c1\u4e86\u3002\u70b9\u51fb\u5de6\u8fb9\u7684\u56fe\u6807\uff0c\u53ef\u4ee5\u8df3\u8f6c\u5230\u5bf9\u5e94\u7684Java\u65b9\u6cd5\u3002</p> cpp\u4ee3\u7801 <p></p>"},{"location":"android/ndk/start/add-ndk-to-proj/#_2","title":"\u8c03\u7528\u65b9\u6cd5","text":"<p>\u8c03\u7528\u8fd92\u4e2a\u65b9\u6cd5\u3002 <pre><code>private CalUtil mCalUtil = new CalUtil();\n// ....\nmCalUtil.getMsg();\nmCalUtil.getNumber()\n</code></pre></p> <p>\u81f3\u6b64\u7ed9\u73b0\u6709\u9879\u76ee\u6dfb\u52a0NDK\u5b8c\u6bd5\u3002</p>"},{"location":"android/ndk/start/add-ndk-to-proj/#_3","title":"\u5c0f\u7ed3","text":"<ul> <li>\u6dfb\u52a0cpp\u76ee\u5f55</li> <li>\u5728cpp\u76ee\u5f55\u4e2d\u6dfb\u52a0cmake</li> <li>\u5728gradle\u4e2d\u914d\u7f6ecmake</li> <li>\u65b0\u5efanative\u65b9\u6cd5</li> <li>\u7f16\u5199cpp\u5b9e\u73b0\u65b9\u6cd5</li> </ul> <p>\ud83e\uddd1\ud83c\udffb\u200d\ud83d\udcbb \u793a\u4f8b\u4ee3\u7801</p>"},{"location":"android/ndk/start/env/","title":"ndk\u73af\u5883\u51c6\u5907","text":"\u66f4\u65b0\u65e5\u671f 2021-9-1 <ul> <li>2021-9-1 \u66f4\u65b0\u683c\u5f0f</li> <li>2020-5-28 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883 <ul> <li>Android Studio 3.6.3</li> <li>macOS 10.14.4</li> </ul>"},{"location":"android/ndk/start/env/#ndk_1","title":"\u4e0b\u8f7d\u5b89\u88c5NDK\u5de5\u5177","text":"<p>\u5728as\u7684\u8bbe\u7f6e\u4e2d\u627e\u5230 Android SDK</p> <p>\u53ef\u4ee5\u4ece\u8bbe\u7f6e\u4e2d\u6253\u5f00 Appearance &amp; Behavior &gt; System Settings &gt; Android SDK</p> <p>\u4e5f\u53ef\u4ee5\u6253\u5f00 Tools - SDK Manager</p> SDK Manager <p></p> <p>\u9009\u62e9SDK Tools\u9875\u9762\u3002\u52fe\u9009NDK\u548cCMake\uff0c\u70b9\u51fb\u300cOK\u300d\u3002\u4e0b\u8f7d\u5b89\u88c5\u9700\u8981\u4e00\u4e9b\u65f6\u95f4\u3002</p> <p>\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u65b0\u6253\u5f00\u4e00\u4e2a\u547d\u4ee4\u884c\uff0c\u8f93\u5165<code>ndk-build -v</code>\u67e5\u770b\u7248\u672c\u4fe1\u606f <pre><code>ndk-build -v\nGNU Make 3.81\nCopyright (C) 2006  Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.\nThere is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A\nPARTICULAR PURPOSE.\n\nThis program built for x86_64-apple-darwin\n</code></pre></p> <p>\u81f3\u6b64ndk\u5de5\u5177\u5df2\u7ecf\u5b89\u88c5\u5b8c\u6210\u3002</p> <p>CMake\u4ecb\u7ecd\u3002</p> <p>\ud83d\udcd6 \u65b0\u5efa\u652f\u6301C/C++\u7684\u5de5\u7a0b \ud83d\udcd6 \u73b0\u6709\u5de5\u7a0b\u6dfb\u52a0C/C++\u652f\u6301 \ud83d\udcd6 \u6a21\u5757\u6dfb\u52a0C/C++\u652f\u6301</p>"},{"location":"android/ndk/start/new-proj-with-ndk/","title":"\u65b0\u5efa\u652f\u6301C/C++\u7684\u5de5\u7a0b","text":"\u66f4\u65b0\u65e5\u671f 2021-9-1 <ul> <li>2021-9-1 \u66f4\u65b0\u683c\u5f0f</li> <li>2020-5-28 \u521b\u5efa\u6587\u6863</li> </ul>"},{"location":"android/ndk/start/new-proj-with-ndk/#_1","title":"\u65b0\u5efa\u5de5\u7a0b","text":"<p>\u65b0\u5efa\u652f\u6301C/C++\u7684\u5de5\u7a0b\u548c\u6211\u4eec\u521b\u5efa\u5de5\u7a0b\u7684\u6b65\u9aa4\u57fa\u672c\u4e00\u81f4\u3002 \u5728\u9009\u62e9\u9879\u76ee\u6a21\u677f\u754c\u9762\uff0c\u9009\u62e9Native C++\u5361\u7247\u3002</p> \u9009\u62e9Native C++ <p></p> <p>\u70b9\u51fb\u4e0b\u4e00\u6b65\uff0c\u7136\u540e\u586b\u5165\u9879\u76ee\u7684\u57fa\u672c\u4fe1\u606f\u3002</p> \u586b\u5165\u4fe1\u606f <p></p> <p>\u7136\u540e\u4e00\u8def\u70b9\u51fb\u4e0b\u4e00\u6b65\u76f4\u81f3\u5b8c\u6210\u3002</p> <p>\u6253\u5f00\u65b0\u5efa\u597d\u7684\u9879\u76ee\u3002\u53ef\u4ee5\u770b\u5230cpp\u76ee\u5f55\u4e0ejava\u540c\u7ea7\u3002 src/main/cpp\u4e2d\u6709 native-lib.cpp \u548c CMakeLists.txt</p> <p>\u53e6\u5916\u4e00\u4e2a\u503c\u5f97\u5173\u6ce8\u7684\u662fgradle\u6587\u4ef6\u3002\u91cc\u9762\u6709<code>cmake</code>\u7684\u914d\u7f6e\u3002</p>"},{"location":"android/ndk/start/new-proj-with-ndk/#ndk-not-configured","title":"\u62a5\u9519: NDK not configured","text":"<p>\u82e5\u65e0\u62a5\u9519\u8bf7\u5ffd\u7565\u672c\u8282</p> <p>\u65b0\u5efa\u5de5\u7a0bBuild\u680f\u76ee\u51fa\u73b0\u62a5\u9519\u4fe1\u606f</p> <p>NDK not configured</p> <p>NDK not configured. Download it with SDK manager. Preferred NDK version is '20.0.5594570'. Log: /SampleNDK/app/.cxx/ndk_locator_record.json</p> <p>\u4fe1\u606f\u6307\u51faNDK\u5de5\u5177\u6ca1\u6709\u914d\u7f6e\u597d\u3002<code>ndk_locator_record.json</code>\u7ed9\u51fa\u4e86\u8be6\u7ec6\u7684\u4fe1\u606f\u3002 <pre><code>{\n    \"level\": \"ERROR\",\n    \"message\": \"No version of NDK matched the requested version 20.0.5594570. Versions available locally: 18.1.5063045, 21.2.6472646\"\n}\n</code></pre></p> <p>\u9879\u76ee\u8981\u6c42NDK\u7248\u672c20.0.5594570\uff0c\u4f46\u7535\u8111\u4e0a\u6ca1\u6709\u4e0e\u4e4b\u5339\u914d\u7684\u7248\u672c\u3002 \u6211\u4eec\u524d\u9762\u5b89\u88c5\u7684\u662f21.2.6472646\u7248\u672c\uff0c\u53ef\u4ee5\u5728SDK Manager\u91cc\u4e0b\u8f7d\u5b89\u88c5NDK 20.0.5594570\u3002 \u5b89\u88c5\u5b8c\u6bd5\u540e\uff0c\u91cd\u65b0\u6253\u5f00\u8fd9\u4e2a\u9879\u76ee\u5373\u53ef\u3002</p>"},{"location":"android/ndk/start/new-proj-with-ndk/#_2","title":"\u8fd0\u884c\u5de5\u7a0b","text":"<p>\u5728\u624b\u673a\u4e0a\u8fd0\u884c\u8fd9\u4e2a\u5de5\u7a0b\u3002\u53ef\u4ee5\u770b\u5230\u6548\u679c\u3002</p> \u8fd0\u884c\u6548\u679c <p></p> <p>\u6784\u5efa\u548c\u8fd0\u884c\u8fc7\u7a0b\u5927\u81f4\u5982\u4e0b\uff1a</p> <ul> <li>Gradle \u8c03\u7528\u60a8\u7684\u5916\u90e8\u6784\u5efa\u811a\u672c <code>CMakeLists.txt</code>\u3002</li> <li>CMake \u6309\u7167\u6784\u5efa\u811a\u672c\u4e2d\u7684\u547d\u4ee4\u5c06 C++ \u6e90\u4ee3\u7801\u6587\u4ef6 <code>native-lib.cpp</code> \u7f16\u8bd1\u5230\u5171\u4eab\u7684\u5bf9\u8c61\u5e93\u4e2d\uff0c\u5e76\u5c06\u5176\u547d\u540d\u4e3a <code>libnative-lib.so</code>\uff0cGradle \u968f\u540e\u4f1a\u5c06\u540e\u8005\u6253\u5305\u5230 APK \u4e2d\u3002</li> <li>\u8fd0\u884c\u65f6\uff0c\u5e94\u7528\u7684 <code>MainActivity</code> \u4f1a\u4f7f\u7528 <code>System.loadLibrary()</code> \u52a0\u8f7d\u539f\u751f\u5e93\u3002\u73b0\u5728\uff0c\u5e94\u7528\u5c31\u53ef\u4ee5\u4f7f\u7528\u5e93\u7684\u539f\u751f\u51fd\u6570 <code>stringFromJNI()</code> \u4e86\u3002</li> <li><code>MainActivity.onCreate()</code> \u4f1a\u8c03\u7528 <code>stringFromJNI()</code>\uff0c\u540e\u8005\u4f1a\u8fd4\u56de<code>\u201cHello from C++\u201d</code>\uff0c\u5e76\u901a\u8fc7 <code>TextView</code>\u663e\u793a\u51fa\u6765\u3002</li> </ul>"},{"location":"android/ndk/start/new-proj-with-ndk/#_3","title":"\u89c2\u5bdf\u5de5\u7a0b","text":"<p>\u9996\u5148\u5173\u6ce8cpp\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u3002</p>"},{"location":"android/ndk/start/new-proj-with-ndk/#cmakeliststxt","title":"CMakeLists.txt","text":"<p>CMakeLists.txt\u662f\u6784\u5efa\u811a\u672c\u3002\u6587\u4ef6\u4e2d\u8fdb\u884c\u4e00\u4e9b\u914d\u7f6e\u3002</p> <pre><code>add_library( # Sets the name of the library.\n             native-lib\n\n             # Sets the library as a shared library.\n             SHARED\n\n             # Provides a relative path to your source file(s).\n             native-lib.cpp )\n\ntarget_link_libraries( # Specifies the target library.\n                       native-lib\n\n                       # Links the target library to the log library\n                       # included in the NDK.\n                       ${log-lib} )\n</code></pre> <p>\u4ece\u6587\u4ef6\u4e2d\u53ef\u4ee5\u5f97\u77e5\uff0c\u5e93\u7684\u540d\u5b57\u53eb\u505a<code>native-lib</code>\uff0c\u6e90\u6587\u4ef6\u662f<code>native-lib.cpp</code>\u3002</p> <p>\u4ee5\u524d\u53ef\u4ee5\u7528<code>Android.mk</code>\u6765\u8fdb\u884cndk-build\u3002\u73b0\u5728cmake\u53d6\u4ee3\u4e86<code>Android.mk</code>\u3002</p>"},{"location":"android/ndk/start/new-proj-with-ndk/#cpp","title":"cpp\u6587\u4ef6","text":"<p>cpp\u6587\u4ef6\u662f\u5b9e\u73b0\u529f\u80fd\u7684\u5730\u65b9\u3002 <pre><code>#include &lt;jni.h&gt;\n#include &lt;string&gt;\n\nextern \"C\" JNIEXPORT jstring JNICALL\nJava_com_rustfisher_samplendk_MainActivity_stringFromJNI(\n        JNIEnv* env,\n        jobject /* this */) {\n    std::string hello = \"Hello from C++\";\n    return env-&gt;NewStringUTF(hello.c_str());\n}\n</code></pre></p> <p>\u6ce8\u610f\u65b9\u6cd5\u7684\u540d\u5b57\uff0c<code>Java_com_rustfisher_samplendk_MainActivity</code>\u662f\u5e26\u6709Java\u6587\u4ef6\u7684\u5305\u540d\u3002 <code>stringFromJNI</code>\u662f\u5177\u4f53\u7684\u65b9\u6cd5\u540d\u3002</p> <p>\u4ee5\u524d\u7684ndk\u53ef\u4ee5\u7528<code>javah</code>\u751f\u6210<code>.h</code>\u5934\u6587\u4ef6\u3002\u73b0\u5728\u4e0d\u9700\u8981\u81ea\u5df1\u624b\u52a8\u751f\u6210\u4e86\u3002</p>"},{"location":"android/ndk/start/new-proj-with-ndk/#buildgradle","title":"build.gradle","text":"<p>gradle\u4e2d\u6307\u5b9a\u4e86<code>CMake</code>\u7684\u914d\u7f6e\u3002 <pre><code>android {\n    defaultConfig {\n        externalNativeBuild {\n            cmake {\n                cppFlags \"\"\n            }\n        }\n    }\n    // ...\n    externalNativeBuild {\n        cmake {\n            path \"src/main/cpp/CMakeLists.txt\"\n            version \"3.10.2\"\n        }\n    }\n}\n</code></pre> \u53ef\u6307\u5b9a\u6b64 CMake \u7248\u672c\u4f5c\u4e3a\u6700\u4f4e\u7248\u672c\uff0c\u53ea\u9700\u5728 build.gradle \u6761\u76ee\u7684\u672b\u5c3e\u6dfb\u52a0\u4e00\u4e2a\u201c+\u201d\u5373\u53ef\uff0c\u4f8b\u5982 3.10.2+\u3002\u4e0d\u8fc7\uff0c\u8fd9\u5e76\u975e\u6700\u4f73\u505a\u6cd5\u3002</p>"},{"location":"android/ndk/start/new-proj-with-ndk/#java","title":"Java\u6587\u4ef6","text":"<p><code>MainActivity</code>\u9700\u8981\u52a0\u8f7d\u8fd9\u4e2a\u5e93\u3002 <pre><code>static {\n    System.loadLibrary(\"native-lib\");\n}\n</code></pre></p> <p>\u5b9a\u4e49\u5173\u8054\u7684native\u65b9\u6cd5\u3002 <pre><code>public native String stringFromJNI();\n</code></pre></p>"},{"location":"android/ndk/start/new-proj-with-ndk/#so","title":".so \u6587\u4ef6","text":"<p>\u521a\u624d\u8fd0\u884c\u5728armeabi-v7a\u67b6\u6784\u7684\u624b\u673a\u4e0a\u3002 \u7f16\u8bd1\u751f\u6210\u7684<code>.so</code>\u6587\u4ef6\u5728 app/build/intermediates/cmake/debug/obj/armeabi-v7a/libnative-lib.so</p> <p>CMake \u5e93\u6587\u4ef6\u547d\u540d\u89c4\u8303\uff1a<code>lib</code>+<code>native-lib</code>+<code>.so</code>\u3002\u5373 libnative-lib.so</p> <p>\u751f\u6210release\u7248apk\u65f6\uff0c\u4f1a\u6253\u5305<code>.so</code>\u6587\u4ef6\u8fdb\u53bb\u3002</p>"},{"location":"android/ndk/start/new-proj-with-ndk/#_4","title":"\u4fee\u6539\u5de5\u7a0b","text":"<p>\u65b0\u5efa\u7684\u5de5\u7a0b\u4e2d\uff0c\u914d\u7f6e\u548c\u65b9\u6cd5\u90fd\u662fas\u9ed8\u8ba4\u7684\u3002\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u8981\u6765\u4fee\u6539\u3002</p>"},{"location":"android/ndk/start/new-proj-with-ndk/#_5","title":"\u4fee\u6539\u5e93\u540d","text":"<p>\u9ed8\u8ba4\u7684\u5e93\u540d\u5b57\u662f<code>native-lib</code>\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4fee\u6539\u3002</p> <p>\u4fee\u6539CMakeLists.txt\u3002\u628a\u5e93\u7684\u540d\u5b57\u6539\u6210<code>fisher-lib</code>\uff0ccpp\u6587\u4ef6\u540d\u5b57\u6539\u6210fisher-lib.cpp\u3002 <pre><code>add_library( # Sets the name of the library.\n             fisher-lib\n\n             # Sets the library as a shared library.\n             SHARED\n\n             # Provides a relative path to your source file(s).\n             fisher-lib.cpp )\n\ntarget_link_libraries( # Specifies the target library.\n                       fisher-lib\n\n                       # Links the target library to the log library\n                       # included in the NDK.\n                       ${log-lib} )\n</code></pre></p> <p>cpp\u6587\u4ef6\u7684\u540d\u5b57\u6539\u6210fisher-lib.cpp\u3002</p> <p><code>MainActivity</code>\u6587\u4ef6\u4e2d\uff0c\u4fee\u6539\u5e93\u540d\u3002 <pre><code>static {\n    System.loadLibrary(\"fisher-lib\");\n}\n</code></pre></p> <p>\u518d\u6b21\u7f16\u8bd1\u8fd0\u884c\u5373\u53ef\u3002 \u53ef\u4ee5\u5728build\u76ee\u5f55\u4e2d\u627e\u5230libfisher-lib.so\u3002</p>"},{"location":"android/ndk/start/new-proj-with-ndk/#native","title":"\u6dfb\u52a0native\u65b9\u6cd5","text":"<p>\u4eff\u7167\u5df2\u6709\u7684\u65b9\u6cd5\uff0c\u5728<code>MainActivity</code>\u4e2d\u6dfb\u52a0\u4e00\u4e2anative\u65b9\u6cd5\u3002 <pre><code>public native int getIntFromJNI();\n</code></pre></p> <p>fisher-lib.cpp\u6587\u4ef6\u4e2d\u6dfb\u52a0\u65b9\u6cd5\u3002\u6ce8\u610f\u8981\u5199\u4e0a\u8fd4\u56de\u7c7b\u578b<code>extern \"C\" JNIEXPORT int JNICALL</code>\u3002 <pre><code>extern \"C\" JNIEXPORT int JNICALL\nJava_com_rustfisher_samplendk_MainActivity_getIntFromJNI(\n        JNIEnv* env,\n        jobject /* this */) {\n    return 42;\n}\n</code></pre></p> <p>\u7f16\u8bd1\u8fd0\u884c\u5373\u53ef\u3002</p> <p>\ud83e\uddd1\ud83c\udffb\u200d\ud83d\udcbb \u793a\u4f8b\u4ee3\u7801</p>"},{"location":"android/network/Media_download_stream_file/","title":"Android \u4f7f\u7528URLConnection\u4e0b\u8f7d\u97f3\u9891\u6587\u4ef6","text":"\u66f4\u65b0\u65e5\u671f 2022-08-03 <ul> <li>2022-08-03 \u4fee\u6539\u683c\u5f0f</li> </ul> <p>\u4f7f\u7528MediaPlayer\u64ad\u653e\u5728\u7ebf\u97f3\u9891\uff0c\u8bf7\u53c2\u8003Android MediaPlayer \u64ad\u653e\u97f3\u9891</p> <p>\u6709\u65f6\u5019\u6211\u4eec\u4f1a\u9700\u8981\u4e0b\u8f7d\u97f3\u9891\u6587\u4ef6\u3002\u8fd9\u91cc\u63d0\u4f9b\u4e00\u79cd\u601d\u8def\uff0c\u5c06\u5728\u7ebf\u97f3\u9891\u6587\u4ef6\u901a\u8fc7\u6d41\u5199\u5230\u672c\u5730\u6587\u4ef6\u4e2d\u3002 \u4f7f\u7528URLConnection\u6765\u5efa\u7acb\u8fde\u63a5\uff0c\u83b7\u53d6\u5230\u7684\u6570\u636e\u5199\u5230\u6587\u4ef6\u4e2d\u3002</p> <p>URLConnection\u5efa\u7acb\u8fde\u63a5\u540e\uff0c\u53ef\u4ee5\u83b7\u53d6\u5230\u6570\u636e\u957f\u5ea6\u3002\u7531\u6b64\u6211\u4eec\u53ef\u4ee5\u8ba1\u7b97\u51fa\u4e0b\u8f7d\u8fdb\u5ea6\u3002 <pre><code>public class DownloadStreamThread extends Thread {\n    String urlStr;\n    final String targetFileAbsPath;\n\n    public DownloadStreamThread(String urlStr, String targetFileAbsPath) {\n        this.urlStr = urlStr;\n        this.targetFileAbsPath = targetFileAbsPath;\n    }\n\n    @Override\n    public void run() {\n        super.run();\n        int count;\n        File targetFile = new File(targetFileAbsPath);\n        try {\n            boolean n = targetFile.createNewFile();\n            Log.d(TAG, \"Create new file: \" + n + \", \" + targetFile);\n        } catch (IOException e) {\n            Log.e(TAG, \"run: \", e);\n        }\n        try {\n            URL url = new URL(urlStr);\n            URLConnection connection = url.openConnection();\n            connection.connect();\n            int contentLength = connection.getContentLength();\n            InputStream input = new BufferedInputStream(url.openStream());\n            OutputStream output = new FileOutputStream(targetFileAbsPath);\n\n            byte[] buffer = new byte[1024];\n            long total = 0;\n            while ((count = input.read(buffer)) != -1) {\n                total += count;\n                Log.d(TAG, String.format(Locale.CHINA, \"Download progress: %.2f%%\", 100 * (total / (double) contentLength)));\n                output.write(buffer, 0, count);\n            }\n            output.flush();\n            output.close();\n            input.close();\n        } catch (Exception e) {\n            Log.e(TAG, \"run: \", e);\n        }\n    }\n}\n</code></pre></p> <p>\u542f\u52a8\u4e0b\u8f7d\uff0c\u5373\u542f\u52a8\u7ebf\u7a0b\u3002 <pre><code>new DownloadStreamThread(urlStr, targetFileAbsPath).start();\n</code></pre></p> <p>\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u672c\u5730\u5df2\u7ecf\u6709\u4e86\u6587\u4ef6\uff0c\u9700\u8981\u505a\u4e00\u4e9b\u903b\u8f91\u5224\u65ad\u3002\u4f8b\u5982\u662f\u5426\u5220\u6389\u65e7\u6587\u4ef6\uff0c\u91cd\u65b0\u4e0b\u8f7d\u3002\u6216\u662f\u5224\u65ad\u51fa\u5df2\u6709\u6587\u4ef6\uff0c\u4e2d\u6b62\u6b64\u6b21\u4e0b\u8f7d\u4efb\u52a1\u3002</p> <p>\u4f8b\u5982\u53ef\u4ee5\u7528<code>connection.getContentLength()</code>\u4e0e\u5f53\u524d\u6587\u4ef6\u957f\u5ea6\u6765\u6bd4\u8f83\uff0c\u5982\u679c\u4e0d\u4e00\u81f4\uff0c\u5219\u5220\u6389\u672c\u5730\u6587\u4ef6\uff0c\u91cd\u65b0\u4e0b\u8f7d\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0cURLConnection\u80fd\u5904\u7406\u5f88\u591a\u6d41\u5a92\u4f53\u3002\u5728\u8fd9\u91cc\u662f\u7528\u6765\u4e0b\u8f7d\u97f3\u9891\u6587\u4ef6\u3002\u53ef\u4ee5\u5b9e\u73b0\u4e0b\u8f7d\u529f\u80fd\u548c\u7c7b\u4f3c\u201c\u8fb9\u4e0b\u8fb9\u64ad\u201d\u7684\u529f\u80fd\u3002</p> <p>\u4ee3\u7801\u53ef\u4ee5\u53c2\u8003\u793a\u4f8b\u5de5\u7a0b\uff1a https://github.com/RustFisher/android-MediaPlayer</p> <p>\u66f4\u591a\u53c2\u8003\uff1a</p> <ul> <li>MediaPlayer \u57fa\u7840\u7b80\u4ecb</li> <li>\u64ad\u653e\u97f3\u9891</li> <li>\u8c03\u6574\u97f3\u9891\u64ad\u653e\u901f\u5ea6</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u6398\u91d1 51CTO</p>"},{"location":"android/network/google_force_https/","title":"Android P \u7f51\u7edc\u8bf7\u6c42\u5f00\u59cb\u5f3a\u5236\u8981\u6c42https","text":"<p>Android P \u7b2c\u4e8c\u4e2a\u6d4b\u8bd5\u7248\u672c\u8bf7\u6c42\u7f51\u7edc CLEARTEXT communication to host not permitted by network</p> <p>\u95ee\u9898\uff1a \u7531\u4e8e Android P \u9650\u5236\u4e86\u660e\u6587\u6d41\u91cf\u7684\u7f51\u7edc\u8bf7\u6c42\uff0c\u975e\u52a0\u5bc6\u7684\u6d41\u91cf\u8bf7\u6c42\u90fd\u4f1a\u88ab\u7cfb\u7edf\u7981\u6b62\u6389\u3002</p> <p>\u5982\u679c\u5f53\u524d\u5e94\u7528\u7684\u8bf7\u6c42\u662f htttp \u8bf7\u6c42\uff0c\u800c\u975e https ,\u8fd9\u6837\u5c31\u4f1a\u5bfc\u7cfb\u7edf\u7981\u6b62\u5f53\u524d\u5e94\u7528\u8fdb\u884c\u8be5\u8bf7\u6c42\uff0c\u5982\u679c WebView \u7684 url \u7528 http \u534f\u8bae\uff0c\u540c\u6837\u4f1a\u51fa\u73b0\u52a0\u8f7d\u5931\u8d25\uff0chttps \u4e0d\u53d7\u5f71\u54cd\u3002</p> <p>\u4e3a\u6b64\uff0cOkHttp3 \u505a\u4e86\u68c0\u67e5\uff0c\u6240\u4ee5\u5982\u679c\u4f7f\u7528\u4e86\u660e\u6587\u6d41\u91cf\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728 Android P \u7248\u672c OkHttp3 \u5c31\u629b\u51fa\u5f02\u5e38: CLEARTEXT communication to \" + host + \" not permitted by network security policy</p> <pre><code>if (!Platform.get().isCleartextTrafficPermitted(host)) {\n      throw new RouteException(new UnknownServiceException(\n          \"CLEARTEXT communication to \" + host + \" not permitted by network security policy\"));\n }\n</code></pre> <p>\u89e3\u51b3\uff1a</p> <p>\u5728 res \u4e0b\u65b0\u5efa\u4e00\u4e2a xml \u76ee\u5f55\uff0c\u7136\u540e\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a\uff1anetwork_security_config.xml \u6587\u4ef6 \uff0c\u8be5\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;network-security-config&gt;\n    &lt;base-config cleartextTrafficPermitted=\"true\" /&gt;\n&lt;/network-security-config&gt;\n</code></pre></p> <p>\u7136\u540e\u5728 AndroidManifest.xml application \u6807\u7b7e\u5185\u5e94\u7528\u4e0a\u9762\u7684xml\u914d\u7f6e\uff1a</p> <pre><code>&lt;application\n    android:name=\".App\"\n    android:icon=\"@mipmap/ic_launcher\"\n    android:label=\"@string/app_name\"\n    android:networkSecurityConfig=\"@xml/network_security_config\"\n    android:roundIcon=\"@mipmap/ic_launcher_round\"\n    android:theme=\"@style/AppTheme\"&gt;&lt;/application&gt;\n</code></pre> <p>\u6216\u8005\u66f4\u7b80\u5355\u7684\u65b9\u5f0f\uff0c\u8bbe\u7f6e<code>android:usesCleartextTraffic=\"true\"</code> <pre><code>&lt;application\n    android:usesCleartextTraffic=\"true\"&gt;\n</code></pre></p> <p>\u5f53\u7136\uff0c\u6700\u63a8\u8350\u7684\u65b9\u5f0f\u662f\u670d\u52a1\u5668\u548c\u672c\u5730\u5e94\u7528\u90fd\u6539\u7528 https</p>"},{"location":"android/network/URLConnection/HttpURLConnection_get_post/","title":"HttpURLConnection GET\u548cPOST\u83b7\u53d6\u6587\u672c\u6570\u636e","text":"\u66f4\u65b0\u65e5\u671f\uff1a2023-3-9 <ul> <li>2023-3-9 \u66f4\u65b0\u683c\u5f0f</li> </ul> <p><code>AndroidManifest.xml</code>\u4e2d\u4e0d\u8981\u5fd8\u8bb0\u7533\u8bf7\u7f51\u7edc\u6743\u9650 <pre><code>&lt;uses-permission android:name=\"android.permission.INTERNET\" /&gt;\n</code></pre></p>"},{"location":"android/network/URLConnection/HttpURLConnection_get_post/#get","title":"GET\u65b9\u5f0f\u83b7\u53d6\u6587\u672c\u6570\u636e","text":"<p>\u76ee\u6807\u7f51\u5740\u662f https://www.baidu.com/s?wd=abc \uff0c\u8fd9\u662f\u767e\u5ea6\u641c\u7d22<code>abc</code></p> <p>\u65b0\u5efaURL\u5bf9\u8c61\u540e\uff0c\u8c03\u7528<code>openConnection()</code>\u65b9\u6cd5\u5efa\u7acb\u8fde\u63a5\uff0c\u5f97\u5230<code>HttpURLConnection</code>\u3002\u8bbe\u7f6e\u4e00\u4e9b\u53c2\u6570\u3002 \u7136\u540e\u4ece<code>HttpURLConnection</code>\u8fde\u63a5\u4e2d\u83b7\u53d6\u8f93\u5165\u6d41\uff0c\u4ece\u4e2d\u8bfb\u53d6\u6570\u636e\u3002 <pre><code>try {\n    URL url = new URL(\"https://www.baidu.com/s?wd=abc\");\n    HttpURLConnection conn = (HttpURLConnection) url.openConnection();\n    conn.setRequestMethod(\"GET\");\n    conn.setConnectTimeout(10 * 1000);\n    conn.setRequestProperty(\"Cache-Control\", \"max-age=0\");\n    conn.setDoOutput(true);\n    int code = conn.getResponseCode();\n    if (code == 200) {\n        ByteArrayOutputStream baos = new ByteArrayOutputStream();\n        InputStream inputStream = conn.getInputStream();\n        byte[] in = new byte[1024];\n        int len;\n        while ((len = inputStream.read(in)) &gt; -1) {\n            baos.write(in, 0, len);\n        }\n        final String content = new String(baos.toByteArray());\n        baos.close();\n        inputStream.close();\n        conn.disconnect();\n    }\n} catch (Exception e) {\n    e.printStackTrace();\n}\n</code></pre></p>"},{"location":"android/network/URLConnection/HttpURLConnection_get_post/#post","title":"POST\u8c03\u7528\u63a5\u53e3","text":"<p>\u548c\u4e0a\u6587\u7684GET\u7c7b\u4f3c\uff0c\u90fd\u662furl\u5f00\u542f\u8fde\u63a5\u62ff\u5230<code>conn</code>\uff0c\u7136\u540e\u8bbe\u7f6e\u53c2\u6570\u3002 \u8fd9\u91cc\u6211\u4eec\u7528POST\u65b9\u6cd5\uff0c\u5e76\u4e14\u5e26\u6709<code>body</code>\u3002\u670d\u52a1\u5668\u80fd\u6536\u5230\u6211\u4eec\u4f20\u4e0a\u53bb\u7684\u53c2\u6570\u3002 \u5047\u8bbe\u670d\u52a1\u5668\u63a5\u53d7\u7684\u662fjson\u683c\u5f0f\u3002 <pre><code>try {\n    URL url = new URL(\"http://sample.com/sample\");\n    HttpURLConnection conn = (HttpURLConnection) url.openConnection();\n    conn.setRequestMethod(\"POST\");\n    conn.setConnectTimeout(10 * 1000);\n\n    // \u8fd9\u91cc\u662f\u793a\u4f8b\n    JSONObject bodyJson = new JSONObject();\n    bodyJson.put(\"imei\", \"\u83b7\u53d6imei\");\n    bodyJson.put(\"deviceSn\", \"\u83b7\u53d6sn\");\n    bodyJson.put(\"deviceBrand\", Build.BRAND);\n    String body = bodyJson.toString();\n\n    conn.setRequestProperty(\"Content-Type\", \"application/json\"); // \u7c7b\u578b\u8bbe\u7f6e\n    conn.setRequestProperty(\"Cache-Control\", \"max-age=0\");\n    conn.setDoOutput(true);\n    conn.getOutputStream().write(body.getBytes());\n\n    int code = conn.getResponseCode();\n    if (code == 200) {\n        ByteArrayOutputStream baos = new ByteArrayOutputStream();\n        InputStream inputStream = conn.getInputStream();\n        byte[] in = new byte[1024];\n        int len;\n        while ((len = inputStream.read(in)) &gt; -1) {\n            baos.write(in, 0, len);\n        }\n        String content = new String(baos.toByteArray());\n        baos.close();\n        inputStream.close();\n        conn.disconnect();\n\n        JSONObject jsonObject = new JSONObject(content);\n        // \u6839\u636e\u5b9a\u4e49\u597d\u7684\u6570\u636e\u7ed3\u6784\u89e3\u6790\u51fa\u60f3\u8981\u7684\u4e1c\u897f\n    }\n} catch (Exception e) {\n    e.printStackTrace();\n}\n</code></pre></p> <p>\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u4f1a\u4f7f\u7528\u4e00\u4e9b\u6bd4\u8f83\u6210\u719f\u7684\u7f51\u7edc\u6846\u67b6\uff0c\u4f8b\u5982OkHttp\u3002</p>"},{"location":"android/network/URLConnection/post-file/","title":"Android HttpURLConnection POST \u4e0a\u4f20\u6587\u4ef6","text":"\u66f4\u65b0\u65e5\u671f\uff1a2023-3-23 <ul> <li>2023-3-23 \u66f4\u65b0\u8bf4\u660e</li> <li>2023-3-9 \u521b\u5efa\u6587\u6863</li> </ul>"},{"location":"android/network/URLConnection/post-file/#httpurlconnection-post","title":"HttpURLConnection POST\u4e0a\u4f20\u6587\u4ef6\u548c\u53c2\u6570","text":"<p>\u4f7f\u7528HttpURLConnection\u521b\u5efa\u8fde\u63a5\uff0c\u4f20\u9012\u53c2\u6570\u548c\u6587\u4ef6\u3002</p> <pre><code>package com.kct.sdk.util;\n\nimport java.io.*;\nimport java.net.HttpURLConnection;\nimport java.net.URL;\n\npublic class MultipartUtilityV2 {\n    private HttpURLConnection httpConn;\n    private DataOutputStream request;\n    private final String boundary = \"*****\";\n    private final String crlf = \"\\r\\n\";\n    private final String twoHyphens = \"--\";\n\n    /**\n     * This constructor initializes a new HTTP POST request with content type\n     * is set to multipart/form-data\n     *\n     * @param requestURL\n     * @throws IOException\n     */\n    public MultipartUtilityV2(String requestURL)\n            throws IOException {\n\n        // creates a unique boundary based on time stamp\n        URL url = new URL(requestURL);\n        httpConn = (HttpURLConnection) url.openConnection();\n        httpConn.setUseCaches(false);\n        httpConn.setDoOutput(true); // indicates POST method\n        httpConn.setDoInput(true);\n\n        httpConn.setRequestMethod(\"POST\");\n        httpConn.setRequestProperty(\"Connection\", \"Keep-Alive\");\n        httpConn.setRequestProperty(\"Cache-Control\", \"no-cache\");\n        httpConn.setRequestProperty(\n                \"Content-Type\", \"multipart/form-data;boundary=\" + this.boundary);\n\n        request = new DataOutputStream(httpConn.getOutputStream());\n    }\n\n    /**\n     * Adds a form field to the request\n     *\n     * @param name  field name\n     * @param value field value\n     */\n    public void addFormField(String name, String value) throws IOException {\n        request.writeBytes(this.twoHyphens + this.boundary + this.crlf);\n        request.writeBytes(\"Content-Disposition: form-data; name=\\\"\" + name + \"\\\"\" + this.crlf);\n        request.writeBytes(\"Content-Type: text/plain; charset=UTF-8\" + this.crlf);\n        request.writeBytes(this.crlf);\n        request.writeBytes(value + this.crlf);\n        request.flush();\n    }\n\n    /**\n     * Adds a upload file section to the request\n     *\n     * @param fieldName  name attribute in &lt;input type=\"file\" name=\"...\" /&gt;\n     * @param uploadFile a File to be uploaded\n     * @throws IOException\n     */\n    public void addFilePart(String fieldName, File uploadFile)\n            throws IOException {\n        String fileName = uploadFile.getName();\n        request.writeBytes(this.twoHyphens + this.boundary + this.crlf);\n        request.writeBytes(\"Content-Disposition: form-data; name=\\\"\" +\n                fieldName + \"\\\";filename=\\\"\" +\n                fileName + \"\\\"\" + this.crlf);\n        request.writeBytes(this.crlf);\n\n        FileInputStream fis = new FileInputStream(uploadFile);\n        byte[] bytes = new byte[10240];\n        int length = 0;\n        int len;\n        for (; (len = fis.read(bytes, 0, 10240)) != -1; length += len) {\n            if (len &lt; 10240) {\n                ++len;\n            }\n            request.write(bytes, 0, len);\n        }\n        fis.close();\n        request.flush();\n    }\n\n    /**\n     * Completes the request and receives response from the server.\n     *\n     * @return a list of Strings as response in case the server returned\n     * status OK, otherwise an exception is thrown.\n     * @throws IOException\n     */\n    public String finish() throws IOException {\n        String response = \"\";\n\n        request.writeBytes(this.crlf);\n        request.writeBytes(this.twoHyphens + this.boundary +\n                this.twoHyphens + this.crlf);\n\n        request.flush();\n        request.close();\n\n        // checks server's status code first\n        int status = httpConn.getResponseCode();\n        if (status == HttpURLConnection.HTTP_OK) {\n            InputStream responseStream = new\n                    BufferedInputStream(httpConn.getInputStream());\n\n            BufferedReader responseStreamReader =\n                    new BufferedReader(new InputStreamReader(responseStream));\n\n            String line = \"\";\n            StringBuilder stringBuilder = new StringBuilder();\n\n            while ((line = responseStreamReader.readLine()) != null) {\n                stringBuilder.append(line).append(\"\\n\");\n            }\n            responseStreamReader.close();\n\n            response = stringBuilder.toString();\n            httpConn.disconnect();\n        } else {\n            throw new IOException(\"Server returned non-OK status: \" + status);\n        }\n\n        return response;\n    }\n}\n</code></pre> <p>\u4e0a\u9762\u7684\u4ee3\u7801 <code>MultipartUtilityV2(String requestURL)</code> \u4e2d\uff1a</p> <ul> <li>\u521b\u5efa\u4e00\u4e2aURL\u5bf9\u8c61\uff0cURL\u4e3arequestURL\u3002</li> <li>\u6253\u5f00\u4e00\u4e2aHTTP\u8fde\u63a5\u5e76\u5c06\u5176\u8d4b\u503c\u7ed9httpConn\u3002</li> <li>\u7981\u7528\u7f13\u5b58\u3002</li> <li>\u542f\u7528\u8f93\u51fa\u6d41\uff0c\u6307\u793a\u4f7f\u7528POST\u65b9\u6cd5\u3002</li> <li>\u542f\u7528\u8f93\u5165\u6d41\u3002</li> <li>\u8bbe\u7f6e\u8bf7\u6c42\u65b9\u6cd5\u4e3aPOST\u3002</li> <li>\u8bbe\u7f6e\u8fde\u63a5\u5c5e\u6027Connection\u4e3aKeep-Alive\u3002</li> <li>\u8bbe\u7f6e\u8fde\u63a5\u5c5e\u6027Cache-Control\u4e3ano-cache\u3002</li> <li>\u8bbe\u7f6e\u8bf7\u6c42\u5934Content-Type\u4e3amultipart/form-data\uff0c\u5e76\u6307\u5b9a\u8fb9\u754c\u4e3athis.boundary\u3002</li> </ul> <p><code>addFilePart</code>\u65b9\u6cd5\u7528\u4e8e\u5c06\u6587\u4ef6\u6dfb\u52a0\u5230HTTP\u8bf7\u6c42\u4e2d\u7684 <code>multipart/form-data</code> \u90e8\u5206\u3002 \u5177\u4f53\u6765\u8bf4\uff0c\u8be5\u65b9\u6cd5\u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff1afieldName\u8868\u793aHTTP\u8bf7\u6c42\u4e2d\u6307\u5b9a\u6587\u4ef6\u4e0a\u4f20\u7684\u5b57\u6bb5\u540d\uff0cuploadFile\u8868\u793a\u8981\u4e0a\u4f20\u7684\u6587\u4ef6\u5bf9\u8c61\u3002</p> <p>\u8be5\u65b9\u6cd5\u7684\u6267\u884c\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u83b7\u53d6\u4e0a\u4f20\u6587\u4ef6\u7684\u6587\u4ef6\u540d\u3002</li> <li>\u5199\u5165 <code>multipart/form-data</code> \u90e8\u5206\u7684\u8fb9\u754c\u548cContent-Disposition\u5934\u90e8\u4fe1\u606f\uff0c\u6307\u5b9aname\u4e3afieldName\uff0cfilename\u4e3afileName\u3002</li> <li>\u5199\u5165\u56de\u8f66\u6362\u884c\u7b26\u3002</li> <li>\u6253\u5f00\u4e00\u4e2a\u8f93\u5165\u6d41\u8bfb\u53d6\u4e0a\u4f20\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u6bcf\u6b21\u8bfb\u53d610240\u5b57\u8282\u6570\u636e\uff0c\u5e76\u5c06\u8bfb\u53d6\u5230\u7684\u6570\u636e\u5199\u5165HTTP\u8bf7\u6c42\u8f93\u51fa\u6d41\u4e2d\u3002</li> <li>\u5173\u95ed\u8f93\u5165\u6d41\u5e76\u6e05\u7a7a\u8f93\u51fa\u6d41\u3002</li> </ul>"},{"location":"android/network/URLConnection/post-file/#_1","title":"\u4f7f\u7528\u793a\u4f8b\uff0c\u653e\u5728\u5b50\u7ebf\u7a0b\u4e2d\u8fdb\u884c","text":"<pre><code>try {\n    MultipartUtilityV2 multipartUtilityV2 = new MultipartUtilityV2(url); // \u76ee\u6807\u63a5\u53e3\n    multipartUtilityV2.addFormField(\"key1\", \"RustFisher\"); // \u81ea\u5b9a\u4e49\u53c2\u6570\n    multipartUtilityV2.addFormField(\"work\", \"an.rustfisher.com\");\n    multipartUtilityV2.addFilePart(\"file\", file); // \u8981\u4e0a\u4f20\u7684\u6587\u4ef6 file\n    String resStr = multipartUtilityV2.finish();\n    // \u68c0\u67e5\u8fd4\u56de\u7684\u7ed3\u679c\n} catch (Exception e) {\n    // \u5f02\u5e38\u5904\u7406\n}\n</code></pre>"},{"location":"android/network/URLConnection/post-file/#_2","title":"\u53c2\u8003","text":"<p>https://stackoverflow.com/questions/11766878/sending-files-using-post-with-httpurlconnection</p>"},{"location":"android/network/okhttp/OkHttp-use1/","title":"Android OkHttp\u5f00\u59cb\u4f7f\u7528","text":"\u66f4\u65b0\u65e5\u671f: 2021-10-27 <ul> <li>2021-10-27 \u65b0\u5efa\u6587\u6863</li> </ul> <p>\u4e4b\u524d\u7528HttpURLConnection GET\u548cPOST\u83b7\u53d6\u6587\u672c\u6570\u636e\u3002\u73b0\u5728\u6765\u8ba4\u8bc6\u4e00\u4e0b\u8fd9\u6b3e\u7f51\u7edc\u8bbf\u95ee\u5229\u5668\u3002</p> <p>OkHttp\u662f\u4e00\u6b3eHTTP\u5ba2\u6237\u7aef\u3002\u6709\u5982\u4e0b\u7279\u70b9\uff1a</p> <ul> <li>\u8fde\u63a5\u6c60\u51cf\u5c11\u8bf7\u6c42\u5ef6\u8fdf\uff08\u5728HTTP/2\u4e0d\u53ef\u7528\u7684\u60c5\u51b5\u4e0b\uff09</li> <li>\u4f20\u8f93GZIP\u65f6\u51cf\u5c11\u4e0b\u8f7d\u4f53\u79ef</li> <li>\u7f13\u5b58\u76f8\u540c\u8bf7\u6c42\u7684\u56de\u590d</li> </ul> <p>OkHttp\u80fd\u4ece\u8fde\u63a5\u6545\u969c\u4e2d\u9759\u9ed8\u6062\u590d\u3002\u5982\u679c\u670d\u52a1\u6709\u591a\u4e2aIP\u5730\u5740\uff0c\u5982\u679c\u7b2c\u4e00\u6b21\u8bbf\u95ee\u5931\u8d25\uff0c\u5b83\u4f1a\u5c1d\u8bd5\u5176\u4ed6\u5730\u5740\u3002 \u8fd9\u529f\u80fd\u5bf9IPv4+IPv6\u548c\u591a\u4e2ahost\u7684\u670d\u52a1\u6765\u8bf4\u5f88\u6709\u5fc5\u8981\u3002</p> <p>OkHttp\u652f\u6301\u73b0\u4ee3TLS\u7279\u6027\u3002</p>"},{"location":"android/network/okhttp/OkHttp-use1/#_1","title":"\u8981\u6c42","text":"<p>\u76ee\u524dOkHttp\u8981\u6c42Android 5.0+ (API level 21+) \uff0c\u6216\u8005Java 8+\u3002</p> <p>OkHttp\u4f9d\u8d56\u4e8eOkio\u548cKotlin\u6807\u51c6\u5e93\u3002\u5b98\u65b9\u5f3a\u70c8\u5efa\u8bae\u6211\u4eec\u4fdd\u6301OkHttp\u7684\u66f4\u65b0\u3002</p> <p>OkHttp 3.12.x \u652f\u6301Android 2.3+ (API level 9+) \u548c Java 7+\u3002</p> <p>\u63a5\u4e0b\u6765\u4ecb\u7ecd\u5728Android\u5f00\u53d1\u4e2d\u4f7f\u7528OkHttp\u3002</p>"},{"location":"android/network/okhttp/OkHttp-use1/#android","title":"Android\u5f15\u5165\u4f9d\u8d56","text":"<p>\u5148\u5f15\u5165OkHttp\u4f9d\u8d56 <pre><code>implementation 'com.squareup.okhttp3:okhttp:4.9.0'\n</code></pre></p> <p>\u4ee5Gitee\u5f00\u653eAPI\u4e3a\u4f8b https://gitee.com/api/v5/swagger\uff0c\u62ff\u8fd9\u91cc\u7684\u63a5\u53e3\u505a\u793a\u4f8b\u3002\u9700\u8981\u51c6\u5907\u81ea\u5df1\u7684gitee\u8d26\u53f7\u3002</p> <p>\u4e0b\u9762\u662fGET\u548cPOST\u7684\u5b9e\u9645\u64cd\u4f5c\uff0c\u4f7f\u7528Kotlin\u5f00\u53d1\u3002</p>"},{"location":"android/network/okhttp/OkHttp-use1/#get","title":"GET","text":""},{"location":"android/network/okhttp/OkHttp-use1/#star","title":"\u5217\u51fa star \u4e86\u4ed3\u5e93\u7684\u7528\u6237","text":"<p>\u8fd9\u662f\u4e2aGET\u63a5\u53e3\u3002url: https://gitee.com/api/v5/repos/rustfisher/AndroidTutorial/stargazers?page=1&amp;per_page=20</p> <p>\u7528curl\u547d\u4ee4\u53ef\u4ee5\u62ff\u5230\u83b7\u53d6\u7ed3\u679c <pre><code>curl -X GET --header 'Content-Type: application/json;charset=UTF-8' 'https://gitee.com/api/v5/repos/rustfisher/AndroidTutorial/stargazers?page=1&amp;per_page=20'\n</code></pre></p> <p>\u53d1\u8d77GET\u8bf7\u6c42 <pre><code>private fun get1() {\n    val client = OkHttpClient()\n    val request = Request.Builder().url(\"https://gitee.com/api/v5/repos/rustfisher/AndroidTutorial/stargazers?page=1&amp;per_page=20\")\n            .build()\n    request.header(\"Content-Type: application/json;charset=UTF-8\")\n    client.newCall(request).enqueue(object : Callback {\n        override fun onFailure(call: Call, e: IOException) {\n            Log.d(TAG, \"[get1] onFailure: $call\\n$e\")\n        }\n\n        override fun onResponse(call: Call, response: Response) {\n            Log.d(TAG, \"[get1] onResponse: $call\\n$response\")\n            if (response.code == 200) {\n                // \u8bf7\u6c42\u6210\u529f response.body!!.string()\n            }\n        }\n    })\n}\n</code></pre></p> <ul> <li>\u521b\u5efaOkHttpClient\u5ba2\u6237\u7aef\u5bf9\u8c61<code>client</code></li> <li>\u7136\u540e\u521b\u5efaRequest\u8bf7\u6c42\u5bf9\u8c61<code>request</code></li> <li>request\u8bbe\u7f6eheader\uff0c<code>request.header(\"Content-Type: application/json;charset=UTF-8\")</code></li> <li>\u628a\u8bf7\u6c42\u4ea4\u7ed9\u5ba2\u6237\u7aef\u52a0\u5165\u8bf7\u6c42\u961f\u5217<ul> <li><code>enqueue(object : Callback)</code>\u65b9\u6cd5\u53ef\u4ee5\u4f20\u5165\u4e00\u4e2aCallback\u56de\u8c03</li> </ul> </li> <li>\u8bf7\u6c42\u5230\u7684\u7ed3\u679c\u5728<code>response.body</code>\u91cc</li> </ul>"},{"location":"android/network/okhttp/OkHttp-use1/#post","title":"POST","text":""},{"location":"android/network/okhttp/OkHttp-use1/#_2","title":"\u521b\u5efa\u4ee3\u7801\u7247\u6bb5","text":"<p>gitee\u6709\u4ee3\u7801\u7247\u6bb5\uff08gist\uff09\u529f\u80fd\uff0c\u4ee5\u521b\u5efa\u4ee3\u7801\u7247\u6bb5\u8fd9\u4e2a\u63a5\u53e3\u4e3a\u4f8b\u3002</p> <p>\u63a5\u53e3\u6587\u6863: https://gitee.com/api/v5/swagger#/postV5Gists</p> <p>\u4e0b\u9762\u662f\u63a5\u53e3\u63cf\u8ff0</p> Parameter Value Description Type Data Type access_token\uff08\u5fc5\u4f20\uff09 \uff08\u767b\u5f55gitee\u83b7\u5f97\uff09 \u7528\u6237\u6388\u6743\u7801 formData string files\uff08\u5fc5\u4f20\uff09 \u4ee3\u7801\u7247\u6bb5\u6587\u4ef6\u540d\u53ca\u5185\u5bb9\u3002\u5982: { \"f1.txt\": { \"content\": \"\u5185\u5bb9\" } } formData object description\uff08\u5fc5\u4f20\uff09 \u4ee3\u7801\u7247\u6bb5\u63cf\u8ff0\uff0c1~30\u4e2a\u5b57\u7b26 formData string public \u516c\u5f00/\u79c1\u6709\uff0c\u9ed8\u8ba4: \u79c1\u6709 formData boolean <p>\u76f8\u5173\u4ee3\u7801 <pre><code>private fun post1() {\n    val mediaType = \"application/json; charset=utf-8\".toMediaType()\n    val client = OkHttpClient()\n    val postData = buildJson1()\n    val body = buildJson1().toString().toRequestBody(mediaType)\n    Log.d(TAG, \"post1: $postData\")\n    val request = Request.Builder().url(\"https://gitee.com/api/v5/gists\")\n            .post(body)\n            .build()\n    val resp = client.newCall(request).execute() // \u7acb\u523b\u6267\u884c \u4f1a\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\n    if (resp.code &gt;= 200 || resp.code &lt;= 201) {\n        val resStr = resp.body!!.string()\n        Log.d(TAG, \"post1: resp body: $resStr\")\n        mHandler.post { binding.resTv.text = resStr }\n    }\n}\n\nprivate fun buildJson1(): JSONObject {\n    val map = HashMap&lt;String, Any&gt;()\n    map[\"access_token\"] = \"0d6f65ef07976154138e126764303622\"\n    val file1Map = HashMap&lt;String, Any&gt;()\n    file1Map[\"content\"] = \"# POST\u6d4b\u8bd5 \\n rustfisher.com\"\n    val file2Map = HashMap&lt;String, Any&gt;()\n    file2Map[\"content\"] = \"# \u7b2c\u4e8c\u4e2a\u6587\u4ef6 \\n an.rustfisher.com\"\n    val filesMap = HashMap&lt;String, Any&gt;()\n    filesMap[\"file1\"] = file1Map\n    filesMap[\"file2\"] = file2Map\n    map[\"files\"] = filesMap\n    map[\"description\"] = \"\u6d4b\u8bd5POST\u63a5\u53e3\"\n    return JSONObject(map as Map&lt;*, *&gt;)\n}\n</code></pre></p> <p>\u8fd9\u91cc\u9700\u8981\u4e0a\u62a5\u4e00\u4e9b\u4fe1\u606f\uff0c\u7528JSONObject\u88c5\u8f7d\u4fe1\u606f\u3002\u5f97\u5230\u7684json\u5185\u5bb9\uff0c\u518d\u8f6c\u6210RequestBody\u3002</p> <p>\u6700\u540e\u4ea4\u7ed9OkHttp\u5ba2\u6237\u7aef\u53bb\u6267\u884c\u8bf7\u6c42\u3002\u6ce8\u610f\u8fd9\u91cc\u8981\u5728\u5b50\u7ebf\u7a0b\u4e2d\u64cd\u4f5c\u3002</p>"},{"location":"android/network/okhttp/OkHttp-use1/#_3","title":"\u5c0f\u7ed3","text":"<p>\u4e0a\u9762\u6211\u4eec\u6f14\u793a\u4e86OkHttp\u7684\u57fa\u672c\u7528\u6cd5\u3002</p> <p>\u4ee5\u4e0a2\u4e2a\u4f8b\u5b50\u6211\u4eec\u53ef\u4ee5\u770b\u51fa<code>enqueue</code>\u548c<code>execute</code>\u7684\u4e0d\u540c\u3002 <code>enqueue</code>\u662f\u5f02\u6b65\u65b9\u6cd5\uff0c\u4f1a\u628a\u7f51\u7edc\u8bbf\u95ee\u653e\u5230\u5b50\u7ebf\u7a0b\u53bb\u3002 \u800c<code>execute</code>\u4f1a\u5728\u5f53\u524d\u7ebf\u7a0b\u6267\u884c\u8bf7\u6c42\u3002</p> <p>\u4f7f\u7528\u7684\u65f6\u5019\u9700\u8981\u6ce8\u610f\u533a\u5206\uff0c\u907f\u514d\u5728\u4e3b\u7ebf\u7a0b\u91cc\u8fdb\u884c\u4e86\u7f51\u7edc\u8bbf\u95ee\u3002</p> <p>\u5982\u679c\u9700\u8981\u987a\u5e8f\u53d1\u8d77\u591a\u4e2a\u7f51\u7edc\u8bf7\u6c42\uff0c\u53ef\u4ee5\u8003\u8651\u5728\u4e00\u4e2a\u5b50\u7ebf\u7a0b\u91cc\u7528<code>execute</code>\u6765\u8fdb\u884c\u8bbf\u95ee\u3002</p> <p>\u5728\u5b9e\u9645\u5de5\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e5f\u7ecf\u5e38\u91c7\u7528OkHttp + Retrofit\u7684\u65b9\u5f0f\u3002</p>"},{"location":"android/network/okhttp/OkHttp-use1/#_4","title":"\u53c2\u8003","text":"<p>OkHttp\u7cfb\u5217</p> <ul> <li>OkHttp\u5165\u95e8</li> <li>OkHttp + Retrofit \u4f7f\u7528\u793a\u4f8b</li> <li>OkHttp\u63a5\u6536\u666e\u901a\u6587\u672c</li> <li>OkHttp + Retrofit \u4e0b\u8f7d\u6587\u4ef6\u4e0e\u8fdb\u5ea6\u76d1\u542c</li> <li>OkHttp + Retrofit \u53d6\u6d88\u8bf7\u6c42\u7684\u65b9\u6cd5</li> <li>OkHttp + Retrofit \u8303\u56f4\u4e0b\u8f7d</li> <li>OkHttp Retrofit \u4e0a\u4f20\u6587\u4ef6</li> </ul> <p></p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a \u6398\u91d1</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_cancel_request/","title":"Android OkHttp + Retrofit \u53d6\u6d88\u8bf7\u6c42\u7684\u65b9\u6cd5","text":"\u66f4\u65b0\u65e5\u671f: 2022-8-17 <ul> <li>2022-8-17 \u66f4\u65b0\u683c\u5f0f</li> </ul>"},{"location":"android/network/okhttp/OkHttp_Retrofit_cancel_request/#_1","title":"\u524d\u8a00","text":"<p>\u5728\u67d0\u4e00\u4e2a\u754c\u9762\uff0c\u7528\u6237\u53d1\u8d77\u4e86\u4e00\u4e2a\u7f51\u7edc\u8bf7\u6c42\uff0c\u56e0\u4e3a\u67d0\u79cd\u539f\u56e0\u7528\u6237\u5728\u7f51\u7edc\u8bf7\u6c42\u5b8c\u6210\u524d\u79bb\u5f00\u4e86\u5f53\u524d\u754c\u9762\uff0c\u6bd4\u8f83\u597d\u7684\u505a\u6cd5\u662f\u53d6\u6d88\u8fd9\u4e2a\u7f51\u7edc\u8bf7\u6c42\u3002</p> <p>\u5bf9\u4e8eOkHttp\u6765\u8bf4\uff0c\u5177\u4f53\u662f\u8c03\u7528<code>Call</code>\u7684<code>cancel</code>\u65b9\u6cd5\u3002</p> <p>\u5982\u4f55\u627e\u5230\u8fd9\u4e00\u4e2a\u7f51\u7edc\u8bf7\u6c42\u5e76\u53d6\u6d88\u6389\u5b83\u5462\uff1f</p> <p>\u64cd\u4f5c\u5927\u81f4\u5206\u4e3a3\u6b65\u3002</p> <p>\u7b2c\u4e00\u6b65\uff0c\u5728\u5efa\u7acb\u8bf7\u6c42\u65f6\uff0c\u7ed9\u8bf7\u6c42\uff08request\uff09\u6dfb\u52a0\u6807\u8bb0\uff1b</p> <p>\u7b2c\u4e8c\u6b65\uff0c\u6839\u636e\u6807\u8bb0\uff0c\u627e\u5230\u8bf7\u6c42\uff1b</p> <p>\u6700\u540e\uff0c\u53d6\u6d88\u8fd9\u4e2a\u8bf7\u6c42\u3002</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_cancel_request/#okhttptag","title":"OkHttp\u4e2d\u7684tag","text":"<p>\u8981\u53d6\u6d88\u4e00\u4e2a\u8bf7\u6c42\uff0cOkHttp\u4e2d\u53ef\u4ee5\u4f7f\u7528cancel\u65b9\u6cd5\uff0c\u53c2\u8003\u3002</p> <p>OkHttp\u7684request\u5bf9\u8c61\u6709tag\u3002\u53ef\u4ee5\u6839\u636etag\u6765\u6807\u793a\u8bf7\u6c42\u3002\u53c2\u8003Stack Overflow\u3002</p> <pre><code>//Set tags for your requests when you build them:\nRequest request = new Request.Builder().\nurl(url).tag(\"requestKey\").build();\n\n//When you want to cancel:\n//A) go through the queued calls and cancel if the tag matches:\nfor (Call call : mHttpClient.dispatcher().queuedCalls()) {\n    if (call.request().tag().equals(\"requestKey\"))\n        call.cancel();\n}\n\n//B) go through the running calls and cancel if the tag matches:\nfor (Call call : mHttpClient.dispatcher().runningCalls()) {\n    if (call.request().tag().equals(\"requestKey\"))\n        call.cancel();\n}\n</code></pre> <p>Retrofit\u4e2d\u5e76\u6ca1\u6709\u663e\u793a\u5730\u63d0\u4f9b\u53d6\u6d88\u8bf7\u6c42\u7684\u63a5\u53e3\u3002</p> <p>2018\u5e74\u65f6Retrofit\u4ecd\u672a\u63d0\u4f9b\u76f4\u63a5\u8bbf\u95eecall\u5bf9\u8c61\u7684\u65b9\u6cd5</p> <p>\u90a3\u4e48\u5982\u4f55\u627e\u5230\u76ee\u6807\u7f51\u7edc\u8bf7\u6c42\u5462\uff1f</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_cancel_request/#retrofitheader","title":"Retrofit\u52a0\u5165\u81ea\u5b9a\u4e49header","text":"<p>\u7ed9\u6bcf\u4e2a\u4e0e\u9875\u9762\uff08Activity\uff0cFragment\uff09\u76f8\u5173\u7684request\u52a0\u5165\u81ea\u5b9a\u4e49header\uff0c\u53c2\u8003\u3002</p> <p>\u7ed9OkHttpClient\u6dfb\u52a0\u62e6\u622a\u5668\u3002\u6807\u8bb0\u51fa\u9875\u9762\u7684\u751f\u5b58\u72b6\u6001\u3002\u5982\u679c\u9875\u9762\u9500\u6bc1\u4e86\uff0c\u5219\u53d6\u6d88\u5bf9\u5e94\u7684request\u3002</p> <p>\u4ee5GithubOnAndroid\u9879\u76ee\u4e3a\u4f8b\uff0c</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_cancel_request/#_2","title":"\u6dfb\u52a0\u6807\u8bb0","text":"<p>\u6301\u6709\u4e00\u4e2aConcurrentHashMap\u6765\u6807\u8bb0\u9875\u9762\u5b58\u6d3b\u72b6\u6001\u3002 <pre><code>private static ConcurrentHashMap&lt;String, Boolean&gt; actLiveMap = new ConcurrentHashMap&lt;&gt;(); // \u6807\u8bb0Activity\u662f\u5426\u5b58\u6d3b\n\npublic static void markPageAlive(String actName) {\n    actLiveMap.put(actName, true);\n}\n\npublic static void markPageDestroy(String actName) {\n    actLiveMap.put(actName, false);\n}\n</code></pre>"},{"location":"android/network/okhttp/OkHttp_Retrofit_cancel_request/#activity","title":"Activity\u4e2d\u767b\u8bb0\u754c\u9762\u72b6\u6001","text":"<p>\u7ed9\u5f53\u524dActivity\u8d77\u540d\u5b57\u3002\u6bcf\u4e2aActivity\u7684\u6807\u8bb0\u540d\u5fc5\u987b\u552f\u4e00\u3002</p> <pre><code>private static final String MY_ACT_NAME = \"xxx1Activity\";\n\n@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    NetworkCenter.markPageAlive(MY_ACT_NAME);\n    // ...\n}\n\n@Override\nprotected void onDestroy() {\n    super.onDestroy();\n    NetworkCenter.markPageDestroy(MY_ACT_NAME);\n    // ...\n}\n</code></pre>"},{"location":"android/network/okhttp/OkHttp_Retrofit_cancel_request/#okhttpclient","title":"OkHttpClient\u6dfb\u52a0\u62e6\u622a\u5668","text":"<p>\u7ed9OkHttpClient\u6dfb\u52a0\u62e6\u622a\u5668\uff0c\u5728\u62e6\u622a\u5668\u4e2d\u68c0\u67e5\u9875\u9762\u7684\u5b58\u6d3b\u60c5\u51b5\u3002 \u68c0\u67e5\u540e\uff0c\u628a\u8fd9\u4e2a\u81ea\u5b9a\u4e49header\u79fb\u9664\u6389\u3002</p> <pre><code>public static final String HEADER_ACT_NAME = \"Activity-Name\"; // \u6807\u8bb0Activity\u754c\u9762\u540d\u5b57\n\nprivate Interceptor lifeInterceptor = new Interceptor() {\n    @Override\n    public Response intercept(Chain chain) throws IOException {\n        Request request = chain.request();\n        String actName = request.header(HEADER_ACT_NAME);\n        if (!TextUtils.isEmpty(actName)) {\n            Log.d(TAG, \"lifeInterceptor: actName: \" + actName);\n            Boolean actLive = actLiveMap.get(actName);\n            if (actLive == null || !actLive) {\n                chain.call().cancel();\n                Log.d(TAG, \"lifeInterceptor: \u53d6\u6d88\u8bf7\u6c42, actName: \" + actName);\n            } else {\n                Log.d(TAG, \"lifeInterceptor: \u53d1\u8d77\u8bf7\u6c42, actName: \" + actName);\n            }\n        }\n        Request newRequest = request.newBuilder().removeHeader(HEADER_ACT_NAME).build();\n        return chain.proceed(newRequest);\n    }\n};\n\n\nOkHttpClient = new OkHttpClient.Builder()\n        .readTimeout(10, TimeUnit.SECONDS)\n        .connectTimeout(10, TimeUnit.SECONDS)\n        .addInterceptor(lifeInterceptor) // \u6dfb\u52a0\u62e6\u622a\u5668\n        .build();\n</code></pre> <p><code>call.cancel()</code>\u540e\uff0c\u4e0d\u4f1a\u518d\u8d70Retrofit\u7684subscribe\u65b9\u6cd5\u3002</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_cancel_request/#header","title":"\u6dfb\u52a0header","text":"<pre><code>@GET(\"users/{owner}/repos\")\nObservable&lt;List&lt;UserRepo&gt;&gt; userRepo(\n        @Header(NetworkCenter.HEADER_ACT_NAME) @Nullable String actName,\n        @Path(\"owner\") String owner,\n        @Query(\"sort\") String sortType);\n</code></pre>"},{"location":"android/network/okhttp/OkHttp_Retrofit_cancel_request/#_3","title":"\u53c2\u8003","text":"<p>OkHttp\u7cfb\u5217</p> <ul> <li>OkHttp\u5165\u95e8</li> <li>OkHttp + Retrofit \u4f7f\u7528\u793a\u4f8b</li> <li>OkHttp\u63a5\u6536\u666e\u901a\u6587\u672c</li> <li>OkHttp + Retrofit \u4e0b\u8f7d\u6587\u4ef6\u4e0e\u8fdb\u5ea6\u76d1\u542c</li> <li>OkHttp + Retrofit \u53d6\u6d88\u8bf7\u6c42\u7684\u65b9\u6cd5</li> <li>OkHttp + Retrofit \u8303\u56f4\u4e0b\u8f7d</li> <li>OkHttp Retrofit \u4e0a\u4f20\u6587\u4ef6</li> </ul> <p></p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u6398\u91d1 \u7b80\u4e66 51CTO</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_download_file/","title":"Android OkHttp + Retrofit \u4e0b\u8f7d\u6587\u4ef6\u4e0e\u8fdb\u5ea6\u76d1\u542c","text":"\u66f4\u65b0\u65e5\u671f\uff1a2021-11-29 <ul> <li>2021-11-29 \u66f4\u65b0\u8bf4\u660e</li> <li>2019-10-24 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4e0b\u8f7d\u6587\u4ef6\u662f\u4e00\u4e2a\u6bd4\u8f83\u5e38\u89c1\u7684\u9700\u6c42\u3002\u7ed9\u5b9a\u4e00\u4e2aurl\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528URLConnection\u4e0b\u8f7d\u6587\u4ef6\u3002\u4f7f\u7528OkHttp\u4e5f\u53ef\u4ee5\u901a\u8fc7\u6d41\u6765\u4e0b\u8f7d\u6587\u4ef6\u3002 \u7f51\u9875\u548c\u5f88\u591a\u5e94\u7528\u90fd\u6709\u663e\u793a\u4e0b\u8f7d\u8fdb\u5ea6\u7684\u529f\u80fd\u3002\u7ed9OkHttp\u4e2d\u6dfb\u52a0\u62e6\u622a\u5668\uff0c\u4e5f\u53ef\u5b9e\u73b0\u4e0b\u8f7d\u8fdb\u5ea6\u7684\u76d1\u542c\u529f\u80fd\u3002</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_download_file/#_1","title":"\u4f7f\u7528\u6d41\u6765\u5b9e\u73b0\u4e0b\u8f7d\u6587\u4ef6","text":"<p>\u4ee3\u7801\u53ef\u4ee5\u53c2\u8003\uff1ahttps://github.com/AnRFDev/android-Basic4/tree/master/appdowloadsample</p> <p>\u83b7\u53d6\u5e76\u4f7f\u7528\u5b57\u8282\u6d41\uff0c\u9700\u8981\u6ce8\u610f\u4e24\u4e2a\u8981\u70b9\uff0c\u4e00\u4e2a\u662f\u670d\u52a1\u63a5\u53e3\u65b9\u6cd5\u7684 <code>@Streaming</code> \u6ce8\u89e3\uff0c\u53e6\u4e00\u4e2a\u662f\u83b7\u53d6\u5230ResponseBody\u3002</p> <p>\u83b7\u53d6\u6d41\uff08Stream\uff09\uff0c\u4e0b\u9762\u4ee5ApiService\u4e3a\u4f8b\u3002\u7ed9\u65b9\u6cd5\u6dfb\u52a0\u4e0a<code>@Streaming</code>\u7684\u6ce8\u89e3\u3002</p> <p><pre><code>private interface ApiService {\n    @Streaming\n    @GET\n    Observable&lt;ResponseBody&gt; download(@Url String url);\n}\n</code></pre> <code>download</code>\u65b9\u6cd5\u7684\u53c2\u6570<code>url</code>\u9700\u8981<code>@Url</code>\u6ce8\u89e3\u3002 \u8fd4\u56de\u7684Observable\u91cc\u7684\u7c7b\u578b\u662fResponseBody\u3002</p> <p>\u521d\u59cb\u5316OkHttp\u3002\u8bb0\u5f97\u586b\u5165\u4f60\u7684baseUrl\u3002 <pre><code>OkHttpClient okHttpClient = new OkHttpClient.Builder()\n        .connectTimeout(8, TimeUnit.SECONDS)\n        .build();\n\nretrofit = new Retrofit.Builder()\n        .client(okHttpClient)\n        .addCallAdapterFactory(RxJava2CallAdapterFactory.create())\n        .baseUrl(\"https://rustfisher.com\") // only for test\n        .build();\n</code></pre></p> <p>\u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42\u3002\u83b7\u53d6\u5230ResponseBody\u3002 <pre><code>String downUrl = \"rustfisher.com/aaa-unreal.apk\";\nretrofit.create(ApiService.class)\n        .download(downUrl)\n        .subscribeOn(Schedulers.io())\n        .observeOn(Schedulers.io())\n        .doOnNext(new Consumer&lt;ResponseBody&gt;() {\n            @Override\n            public void accept(ResponseBody body) throws Exception {\n                // \u5904\u7406 ResponseBody \u4e2d\u7684\u6d41...\n            }\n        })\n        .doOnError(new Consumer&lt;Throwable&gt;() {\n            @Override\n            public void accept(Throwable throwable) throws Exception {\n                Log.e(TAG, \"accept on error: \" + downUrl, throwable);\n            }\n        })\n        .observeOn(AndroidSchedulers.mainThread())\n        .subscribe(new Observer&lt;ResponseBody&gt;() {\n            @Override\n            public void onSubscribe(Disposable d) {\n\n            }\n\n            @Override\n            public void onNext(ResponseBody responseBody) {\n\n            }\n\n            @Override\n            public void onError(Throwable e) {\n                Log.e(TAG, \"Download center retrofit onError: \", e);\n            }\n\n            @Override\n            public void onComplete() {\n\n            }\n        });\n</code></pre> <code>accept</code>\u65b9\u6cd5\u91cc\u5f97\u5230ResponseBody\uff0c\u62ff\u5230\u5b57\u8282\u6d41<code>body.byteStream()</code>\u3002</p> <p>\u8fd9\u91cc\u4f1a\u5148\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6tmpFile\uff0c\u628a\u6570\u636e\u5199\u5230\u4e34\u65f6\u6587\u4ef6\u91cc\u3002\u4e0b\u8f7d\u5b8c\u6210\u540e\u518d\u91cd\u547d\u540d\u6210\u76ee\u6807\u6587\u4ef6targetFile\u3002 <pre><code>public void saveFile(ResponseBody body) {\n    state = DownloadTaskState.DOWNLOADING; // \u66f4\u65b0\u72b6\u6001\n    byte[] buf = new byte[2048];\n    int len;\n    FileOutputStream fos = null;\n    try {\n        Log.d(TAG, \"saveFile: body content length: \" + body.contentLength());\n        srcInputStream = body.byteStream();\n        File dir = tmpFile.getParentFile();\n        if (dir == null) {\n            throw new FileNotFoundException(\"target file has no dir.\");\n        }\n        if (!dir.exists()) {\n            boolean m = dir.mkdirs();\n            onInfo(\"Create dir \" + m + \", \" + dir);\n        }\n        File file = tmpFile;\n        if (!file.exists()) {\n            boolean c = file.createNewFile();\n            onInfo(\"Create new file \" + c);\n        }\n        fos = new FileOutputStream(file);\n        long time = System.currentTimeMillis();\n        while ((len = srcInputStream.read(buf)) != -1 &amp;&amp; !isCancel) {\n            fos.write(buf, 0, len);\n            int duration = (int) (System.currentTimeMillis() - time);\n\n            int overBytes = len - downloadBytePerMs() * duration;\n            if (overBytes &gt; 0) {\n                try {\n                    Thread.sleep(overBytes / downloadBytePerMs());\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n            }\n            time = System.currentTimeMillis();\n            if (isCancel) {\n                state = DownloadTaskState.CLOSING;\n                srcInputStream.close();\n                break;\n            }\n        }\n        if (!isCancel) {\n            fos.flush();\n            boolean rename = tmpFile.renameTo(targetFile);\n            if (rename) {\n                setState(DownloadTaskState.DONE);\n                onSuccess(url);\n            } else {\n                setState(DownloadTaskState.ERROR);\n                onError(url, new Exception(\"Rename file fail. \" + tmpFile));\n            }\n        }\n    } catch (FileNotFoundException e) {\n        Log.e(TAG, \"saveFile: FileNotFoundException \", e);\n        setState(DownloadTaskState.ERROR);\n        onError(url, e);\n    } catch (Exception e) {\n        Log.e(TAG, \"saveFile: IOException \", e);\n        setState(DownloadTaskState.ERROR);\n        onError(url, e);\n    } finally {\n        try {\n            if (srcInputStream != null) {\n                srcInputStream.close();\n            }\n            if (fos != null) {\n                fos.close();\n            }\n        } catch (IOException e) {\n            Log.e(TAG, \"saveFile\", e);\n        }\n        if (isCancel) {\n            onCancel(url);\n        }\n    }\n}\n</code></pre></p> <p>\u6bcf\u6b21\u8bfb\u6570\u636e\u7684\u5faa\u73af\uff0c\u8ba1\u7b97\u8bfb\u4e86\u591a\u5c11\u6570\u636e\u548c\u7528\u4e86\u591a\u5c11\u65f6\u95f4\u3002 \u5728\u67d0\u4e9b\u4e1a\u52a1\u573a\u666f\u91cc\uff0c\u9700\u8981\u63a7\u5236\u4e0b\u8f7d\u7684\u901f\u5ea6\u3002\u6bd4\u5982\u51cf\u8f7b\u670d\u52a1\u5668\uff0c\u8def\u7531\u5668\u6216\u8005ap\u7684\u8d1f\u62c5\u3002 \u8d85\u8fc7\u9650\u901f\u540e\u4e3b\u52a8<code>sleep</code>\u4e00\u4e0b\uff0c\u8fbe\u5230\u4ece\u5ba2\u6237\u7aef\u8fd9\u8fb9\u63a7\u5236\u4e0b\u8f7d\u901f\u5ea6\u7684\u6548\u679c\u3002\u8981\u6ce8\u610f\u4e0d\u80fd<code>sleep</code>\u592a\u4e45\uff0c\u4ee5\u514dsocket\u5173\u95ed\u3002 \u8fd9\u91cc\u63a7\u5236\u7684\u662f\u7f51\u7edc\u6570\u636e\u6d41\u4e0e\u672c\u5730\u6587\u4ef6\u7684\u8bfb\u5199\u901f\u5ea6\u3002</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_download_file/#_2","title":"\u4e0b\u8f7d\u8fdb\u5ea6\u76d1\u542c","text":"<p>OkHttp\u5b9e\u73b0\u4e0b\u8f7d\u8fdb\u5ea6\u76d1\u542c\uff0c\u53ef\u4ee5\u4ece\u5b57\u8282\u6d41\u7684\u8bfb\u5199\u90a3\u91cc\u5165\u624b\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528\u62e6\u622a\u5668\uff0c\u53c2\u8003\u5b98\u65b9\u7684\u4f8b\u5b50\u3002 \u8fd9\u91cc\u7528\u62e6\u622a\u5668\u7684\u65b9\u5f0f\u5b9e\u73b0\u7f51\u7edc\u4e0b\u8f7d\u8fdb\u5ea6\u76d1\u542c\u529f\u80fd\u3002</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_download_file/#_3","title":"\u5b9a\u4e49\u56de\u8c03\u4e0e\u7f51\u7edc\u62e6\u622a\u5668","text":"<p>\u5148\u5b9a\u4e49\u56de\u8c03\u3002\u56de\u8c03\u65b9\u6cd5\u91cc\u5c3d\u91cf\u591a\u4f20\u9001\u4e86\u53c2\u6570\u3002 <pre><code>public interface ProgressListener {\n    void update(String url, long bytesRead, long contentLength, boolean done);\n}\n</code></pre></p> <p>\u81ea\u5b9a\u4e49ProgressResponseBody\u3002 <pre><code>public class ProgressResponseBody extends ResponseBody {\n\n    private final ResponseBody responseBody;\n    private final ProgressListener progressListener;\n    private BufferedSource bufferedSource;\n    private final String url;\n\n    ProgressResponseBody(String url, ResponseBody responseBody, ProgressListener progressListener) {\n        this.responseBody = responseBody;\n        this.progressListener = progressListener;\n        this.url = url;\n    }\n\n    @Override\n    public MediaType contentType() {\n        return responseBody.contentType();\n    }\n\n    @Override\n    public long contentLength() {\n        return responseBody.contentLength();\n    }\n\n    @Override\n    public BufferedSource source() {\n        if (bufferedSource == null) {\n            bufferedSource = Okio.buffer(source(responseBody.source()));\n        }\n        return bufferedSource;\n    }\n\n    private Source source(final Source source) {\n        return new ForwardingSource(source) {\n            long totalBytesRead = 0L;\n\n            @Override\n            public long read(Buffer sink, long byteCount) throws IOException {\n                long bytesRead = super.read(sink, byteCount);\n                // read() returns the number of bytes read, or -1 if this source is exhausted.\n                totalBytesRead += bytesRead != -1 ? bytesRead : 0;\n                progressListener.update(url, totalBytesRead, responseBody.contentLength(), bytesRead == -1);\n                return bytesRead;\n            }\n        };\n    }\n}\n</code></pre></p> <p>\u5b9a\u4e49\u62e6\u622a\u5668\u3002\u4eceResponse\u4e2d\u83b7\u53d6\u4fe1\u606f\u3002 <pre><code>public class ProgressInterceptor implements Interceptor {\n\n    private ProgressListener progressListener;\n\n    public ProgressInterceptor(ProgressListener progressListener) {\n        this.progressListener = progressListener;\n    }\n\n    @NotNull\n    @Override\n    public Response intercept(@NotNull Chain chain) throws IOException {\n        Response originalResponse = chain.proceed(chain.request());\n        return originalResponse.newBuilder()\n                .body(new ProgressResponseBody(chain.request().url().url().toString(), originalResponse.body(), progressListener))\n                .build();\n    }\n}\n</code></pre></p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_download_file/#_4","title":"\u6dfb\u52a0\u62e6\u622a\u5668","text":"<p>\u5728\u521b\u5efaOkHttpClient\u65f6\u6dfb\u52a0ProgressInterceptor\u3002 <pre><code>OkHttpClient okHttpClient = new OkHttpClient.Builder()\n    .connectTimeout(8, TimeUnit.SECONDS)\n    .addInterceptor(new ProgressInterceptor(new ProgressListener() {\n        @Override\n        public void update(String url, long bytesRead, long contentLength, boolean done) {\n            // tellProgress(url, bytesRead, contentLength, done);\n        }\n    }))\n    .build();\n</code></pre></p> <p>\u503c\u5f97\u6ce8\u610f\u7684\u662f\u8fd9\u91cc\u7684\u8fdb\u5ea6\u66f4\u65b0\u975e\u5e38\u9891\u7e41\u3002\u5e76\u4e0d\u4e00\u5b9a\u6bcf\u6b21\u56de\u8c03\u90fd\u8981\u53bb\u66f4\u65b0UI\u3002\u51cf\u8f7b\u4e3b\u7ebf\u7a0b\u7684\u538b\u529b\u3002</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_download_file/#_5","title":"\u5c0f\u7ed3","text":"<p>\u76f4\u63a5\u83b7\u53d6\u6d41\u53ef\u4ee5\u4e0b\u8f7d\u6587\u4ef6\uff0c\u5199\u5230\u672c\u5730\u3002\u4f7f\u7528\u62e6\u622a\u5668\u53ef\u4ee5\u5b9e\u73b0\u89c2\u5bdf\u4e0b\u8f7d\u8fdb\u5ea6\u7684\u6548\u679c\u3002</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_download_file/#_6","title":"\u53c2\u8003","text":"<p>OkHttp\u7cfb\u5217</p> <ul> <li>OkHttp\u5165\u95e8</li> <li>OkHttp + Retrofit \u4f7f\u7528\u793a\u4f8b</li> <li>OkHttp\u63a5\u6536\u666e\u901a\u6587\u672c</li> <li>OkHttp + Retrofit \u4e0b\u8f7d\u6587\u4ef6\u4e0e\u8fdb\u5ea6\u76d1\u542c</li> <li>OkHttp + Retrofit \u53d6\u6d88\u8bf7\u6c42\u7684\u65b9\u6cd5</li> <li>OkHttp + Retrofit \u8303\u56f4\u4e0b\u8f7d</li> <li>OkHttp Retrofit \u4e0a\u4f20\u6587\u4ef6</li> </ul> <p></p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a cnblog \u6398\u91d1 \u7b80\u4e66</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_download_file_partial/","title":"Android OkHttp + Retrofit \u8303\u56f4\u4e0b\u8f7d","text":"\u66f4\u65b0\u65e5\u671f: 2022-8-17 <ul> <li>2022-8-17 \u66f4\u65b0\u683c\u5f0f</li> </ul> <p>\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u5982\u4f55\u4f7f\u7528OkHttp+Retrofit\u4e0b\u8f7d\u6587\u4ef6\u3002</p> <p>\u4e0b\u8f7d\u6587\u4ef6\u65f6\uff0c\u53ef\u80fd\u4f1a\u9047\u5230\u4e00\u4e9b\u610f\u5916\u60c5\u51b5\uff0c\u6bd4\u5982\u7f51\u7edc\u9519\u8bef\u6216\u662f\u7528\u6237\u6682\u505c\u4e86\u4e0b\u8f7d\u3002 \u518d\u6b21\u542f\u52a8\u4e0b\u8f7d\uff0c\u5982\u679c\u53c8\u8981\u4ece\u5934\u5f00\u59cb\uff0c\u4f1a\u767d\u767d\u6d6a\u8d39\u524d\u9762\u4e0b\u8f7d\u597d\u7684\u5185\u5bb9\u3002</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_download_file_partial/#http","title":"http\u8303\u56f4\u8bf7\u6c42","text":"<p>Range \u662f\u4e00\u4e2a\u8bf7\u6c42\u9996\u90e8\uff0c\u544a\u77e5\u670d\u52a1\u5668\u8fd4\u56de\u6587\u4ef6\u7684\u54ea\u4e00\u90e8\u5206\u3002</p> <p>\u5728\u4e00\u4e2a Range \u9996\u90e8\u4e2d\uff0c\u53ef\u4ee5\u4e00\u6b21\u6027\u8bf7\u6c42\u591a\u4e2a\u90e8\u5206\uff0c\u670d\u52a1\u5668\u4f1a\u4ee5 multipart \u6587\u4ef6\u7684\u5f62\u5f0f\u5c06\u5176\u8fd4\u56de\u3002</p> <p>\u5982\u679c\u670d\u52a1\u5668\u8fd4\u56de\u7684\u662f\u8303\u56f4\u54cd\u5e94\uff0c\u9700\u8981\u4f7f\u7528 206 Partial Content \u72b6\u6001\u7801\u3002</p> <p>\u5047\u5982\u6240\u8bf7\u6c42\u7684\u8303\u56f4\u4e0d\u5408\u6cd5\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u4f1a\u8fd4\u56de  416 Range Not Satisfiable \u72b6\u6001\u7801\uff0c\u8868\u793a\u5ba2\u6237\u7aef\u9519\u8bef\u3002</p> <p>\u670d\u52a1\u5668\u5141\u8bb8\u5ffd\u7565Range\u9996\u90e8\uff0c\u4ece\u800c\u8fd4\u56de\u6574\u4e2a\u6587\u4ef6\uff0c\u72b6\u6001\u7801\u7528200\u3002</p> <p>\u793a\u4f8b <pre><code>Range: &lt;unit&gt;=&lt;range-start&gt;-\nRange: &lt;unit&gt;=&lt;range-start&gt;-&lt;range-end&gt;\nRange: &lt;unit&gt;=&lt;range-start&gt;-&lt;range-end&gt;, &lt;range-start&gt;-&lt;range-end&gt;\nRange: &lt;unit&gt;=&lt;range-start&gt;-&lt;range-end&gt;, &lt;range-start&gt;-&lt;range-end&gt;, &lt;range-start&gt;-&lt;range-end&gt;\n</code></pre></p> <p>\u53d1\u8d77\u8bf7\u6c42\u65f6\uff0c\u4e00\u822cRange\u7684\u5185\u5bb9\u5199\u6210 bytes=0-100 \u8fd9\u6837\u7684\u5f62\u5f0f\u3002 \u6216\u8005\u8bf7\u6c42\u591a\u4e2a\u90e8\u5206\u65f6\uff0c\u6307\u5b9a\u591a\u4e2a\u8303\u56f4\u3002 <pre><code>Range: bytes=200-1000, 2000-6576, 19000- \n</code></pre></p> <p>Content-Range \u8868\u793a\u4e3b\u4f53\u957f\u5ea6\u6216\u8005\u5c3a\u5bf8\u3002</p> <p>\u53c2\u8003\uff1a https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Range</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_download_file_partial/#range","title":"\u670d\u52a1\u5668\u9700\u8981\u652f\u6301range","text":"<p>\u5728\u8fd4\u56de\u4e2d\uff0c\u82e5\u80fd\u591f\u627e\u5230 Content-Range\uff0c\u5219\u8868\u660e\u670d\u52a1\u5668\u652f\u6301\u65ad\u70b9\u7eed\u4f20\u3002 \u6709\u4e9b\u670d\u52a1\u5668\u8fd8\u4f1a\u8fd4\u56de Accept-Ranges\uff0c\u8f93\u51fa\u7ed3\u679c Accept-Ranges: bytes \uff0c\u8bf4\u660e\u670d\u52a1\u5668\u652f\u6301\u6309\u5b57\u8282\u4e0b\u8f7d\u3002</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_download_file_partial/#_1","title":"\u4f7f\u7528\u793a\u4f8b","text":"<p>\u53c2\u8003 https://github.com/AnRFDev/android-Basic4/tree/master/appdowloadsample</p> <p>\u4f7f\u7528OkHttp\u6dfb\u52a0Range\u5934\u90e8\uff0c\u544a\u77e5\u670d\u52a1\u5668\u6211\u4eec\u9700\u8981\u7684\u6587\u4ef6\u6570\u636e\u8303\u56f4\u3002</p> <p>\u5b9a\u4e49\u7684\u65b9\u6cd5\u4e2d\u8981\u6c42\u4f20\u5165 @Header(\"Range\") <pre><code>private interface ApiService {\n    @Streaming\n    @GET\n    Observable&lt;ResponseBody&gt; downloadPartial(@Url String url, @Header(\"Range\") String range);\n}\n</code></pre></p> <p>\u9700\u8981\u4f20\u5165\u7684Range\u5b57\u7b26\u4e32\u5f62\u5982 bytes=200-1000</p> <pre><code>retrofit.create(ApiService.class)\n    .downloadPartial(callBack.getUrl(), \"bytes=\" + startByte + \"-\")\n    .subscribeOn(Schedulers.newThread())\n    .observeOn(Schedulers.io())\n    .doOnNext(new Consumer&lt;ResponseBody&gt;() {\n        @Override\n        public void accept(ResponseBody responseBody) throws Exception {\n            callBack.saveFile(responseBody);\n        }\n    })\n    .doOnError(new Consumer&lt;Throwable&gt;() {\n        @Override\n        public void accept(Throwable throwable) throws Exception {\n            tellDownloadError(callBack.getUrl(), throwable);\n        }\n    })\n    .observeOn(AndroidSchedulers.mainThread())\n    .subscribe(new Observer&lt;ResponseBody&gt;() {\n        @Override\n        public void onSubscribe(Disposable d) {\n\n        }\n\n        @Override\n        public void onNext(ResponseBody responseBody) {\n\n        }\n\n        @Override\n        public void onError(Throwable e) {\n            callBack.setState(DownloadTaskState.ERROR);\n            tellDownloadError(callBack.getUrl(), e);\n        }\n\n        @Override\n        public void onComplete() {\n\n        }\n    });\n</code></pre> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u4e0b\u8f7d\u524d\uff0c\u5148\u53bb\u68c0\u67e5\u6587\u4ef6\u5df2\u4e0b\u8f7d\u7684\u90e8\u5206\u7684\u5927\u5c0f\uff0c\u518d\u51b3\u5b9aRange\u8303\u56f4\u3002 \u7eed\u4f20\u65f6\uff0c\u5199\u5165\u672c\u5730\u6587\u4ef6\u6ce8\u610f\u9009\u62e9\u6d41\u7684append\u6a21\u5f0f\u3002</p> <pre><code>fos = new FileOutputStream(file, true);\n</code></pre>"},{"location":"android/network/okhttp/OkHttp_Retrofit_download_file_partial/#_2","title":"\u53c2\u8003","text":"<p>OkHttp\u7cfb\u5217</p> <ul> <li>OkHttp\u5165\u95e8</li> <li>OkHttp + Retrofit \u4f7f\u7528\u793a\u4f8b</li> <li>OkHttp\u63a5\u6536\u666e\u901a\u6587\u672c</li> <li>OkHttp + Retrofit \u4e0b\u8f7d\u6587\u4ef6\u4e0e\u8fdb\u5ea6\u76d1\u542c</li> <li>OkHttp + Retrofit \u53d6\u6d88\u8bf7\u6c42\u7684\u65b9\u6cd5</li> <li>OkHttp + Retrofit \u8303\u56f4\u4e0b\u8f7d</li> <li>OkHttp Retrofit \u4e0a\u4f20\u6587\u4ef6</li> </ul> <p></p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u6398\u91d1 \u7b80\u4e66 51CTO</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/","title":"Android OkHttp + Retrofit \u4f7f\u7528\u793a\u4f8b","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-8-1 <ul> <li>2022-8-1 \u66f4\u65b0\u7528\u6cd5\u548c\u9519\u8bef\u793a\u4f8b</li> <li>2021-11-29 \u66f4\u65b0\u8bf4\u660e</li> <li>2019-05-17 \u521b\u5efa\u6587\u6863</li> </ul> <p>OkHttp\u662f\u4e00\u6b3eHTTP\u5ba2\u6237\u7aef\u3002\u5b83\u4f7f\u7528\u8fde\u63a5\u6c60\u51cf\u5c11\u8bf7\u6c42\u5ef6\u8fdf\uff0c\u80fd\u5728\u4f20\u8f93GZIP\u65f6\u51cf\u5c11\u4e0b\u8f7d\u4f53\u79ef\uff0c\u8fd8\u6709\u7f13\u5b58\u76f8\u540c\u8bf7\u6c42\u7684\u56de\u590d\u7684\u7279\u70b9\u3002 \u53ef\u4ee5\u5355\u72ec\u4f7f\u7528OkHttp\uff0c\u4e5f\u53ef\u4ee5\u7ed3\u5408Retrofit\uff0c\u6253\u9020\u4e00\u4e2a\u9002\u5408\u81ea\u5df1\u4e1a\u52a1\u9700\u6c42\u7684\u5de5\u5177\u3002</p> <p>\u672c\u6587\u4ecb\u7ecdOkHttp + Retrofit\u4f7f\u7528\u793a\u4f8b\u3002\u4ece\u5f15\u5165\u4f9d\u8d56\uff0c\u7f16\u5199\u63a5\u53e3\uff0c\u5230\u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42\u3002</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#_1","title":"\u7b80\u5355\u4f7f\u7528","text":""},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#_2","title":"\u5f15\u5165\u4f9d\u8d56","text":"<p>\u5f15\u5165\u4f9d\u8d56\uff0c\u4f7f\u7528Retrofit2\u3002 <pre><code>implementation 'com.squareup.retrofit2:retrofit:2.1.0'\nimplementation 'com.squareup.retrofit2:converter-gson:2.1.0'\nimplementation 'com.squareup.retrofit2:adapter-rxjava:2.1.0'\n</code></pre></p> <p>\u7136\u540e\u65b0\u5efa\u4e00\u4e2a\u63a5\u53e3\uff08interface\uff09CfgService\uff0c\u5728\u8fd9\u91cc\u9762\u5b9a\u4e49\u6211\u4eec\u9700\u8981\u7528\u5230\u7684\u670d\u52a1\u3002 <pre><code>public interface CfgService { /* \u5177\u4f53\u7684\u65b9\u6cd5 */ }\n</code></pre> \u540e\u9762\u4f1a\u7528\u5230\u4e00\u4e9b\u6ce8\u89e3\u3002</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#query","title":"\u67e5\u8be2 <code>@Query</code>","text":"<p>\u4f8b\u5982URL <code>https://rustfisher.com/api/config?env=dev</code>\uff0c\u95ee\u53f7\u540e\u9762\u5c5e\u4e8e\u67e5\u8be2\u5185\u5bb9\u3002 \u4e0d\u8bba\u662fGET\u6216POST\uff0c\u90fd\u8981\u7528<code>@Query</code>\u8fd9\u4e2a\u6ce8\u89e3\u3002\u5426\u5219\u4f1a\u62a5\u5f02\u5e38\u3002</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#url","title":"URL\u586b\u5145\u4e0e\u62fc\u63a5","text":"<p>\u5355\u7eafURL\u586b\u5145\u53ef\u4ee5\u7528<code>@Path</code>\u6ce8\u89e3\u3002 \u4f8b\u5982\u4e0b\u9762\u8fd9\u4e2apost\u8bf7\u6c42\u3002 <pre><code>@POST(\"api/user/{uid}/token/refresh\")\nCall&lt;RefreshTokenResp&gt; refreshToken(@Path(\"uid\") String uid, @Query(\"token\") String token);\n</code></pre></p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#get","title":"GET\u5e26\u6709\u67e5\u8be2\u7684\u53c2\u6570","text":"<p>\u4f7f\u7528<code>GET</code>\u6ce8\u89e3 <pre><code>public interface CfgService {\n    @GET(\"api/config\")\n    Call&lt;ServerCfgResp&gt; getServerCfg(@Query(\"env\") String env);\n}\n</code></pre></p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#postbody","title":"POST\uff0c\u5e26\u6709\u67e5\u8be2\u7684\u53c2\u6570\u548cbody","text":"<p>\u4f7f\u7528<code>POST</code>\u6ce8\u89e3\uff0c\u4f20\u53c2\u4f7f\u7528<code>@Body RequestBody</code> <pre><code>public interface UserService {\n\n    @POST(\"user-service/login\")\n    Call&lt;LoginResp&gt; login(@Query(\"lenovoST\") String token, @Query(\"realm\") String realm,\n                            @Body RequestBody body);\n\n    @POST(\"user-service/logout\")\n    Call&lt;CommonEntity&gt; logout(@Query(\"token\") String token, @Body RequestBody body);\n}\n</code></pre></p> <p>\u8c03\u7528\u7684\u65f6\u5019\u8981\u521b\u5efa<code>RequestBody</code>\uff1b\u5148\u8c03\u67e5\u597d\u540e\u53f0\u63a5\u53d7\u7684body\u7c7b\u578b\u3002 <pre><code>Map&lt;String, String&gt; map = new HashMap&lt;&gt;();\nmap.put(\"system\", \"Android\");\nmap.put(\"phoneBrand\", Build.BRAND);\nmap.put(\"modelNum\", Build.MODEL);\nGson gson = new Gson();\nString bodyJson = gson.toJson(map);\nRequestBody requestBody = RequestBody.create(MediaType.parse(\"application/json\"), bodyJson);\n// \u7c7b\u4f3c\u8fd9\u6837\u7684\u8bf7\u6c42\uff0c\u9700\u8981\u4f20\u5165requestBody\nReqCtrl.getCtrl().getUserService().login(token, realm, requestBody)\n    // .....\n</code></pre></p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#http-400-bad-request","title":"HTTP 400 Bad Request","text":"<p>retrofit2.adapter.rxjava2.HttpException: HTTP 400 Bad Request</p> <p>\u5982\u679c\u63a5\u53e3\u9700\u8981\u4e00\u4e2ajson body\uff0c\u800cPOST\u65b9\u6cd5\u7528\u7684\u662f<code>@FormUrlEncoded</code>\u4e0e<code>@FieldMap</code>\uff0c\u5219\u4f1a\u62a5\u9519 <code>HTTP 400 Bad Request</code></p> <p>\u9519\u8bef\u793a\u4f8b</p> curl\u63a5\u53e3\u4f8b\u5b50<pre><code>curl -X 'POST' \\\n'http://1.2.3.4:8080/api/v1/login' \\\n-H 'accept: */*' \\\n-H 'Content-Type: application/json' \\\n-d '{\n\"account\": \"an.rustfisher.com\",\n\"secret\": \"RustFisher\"\n}'\n</code></pre> \u9519\u8bef\u7528\u6cd5<pre><code>@POST(\"login\")\n@FormUrlEncoded\nObservable&lt;Resp&lt;LwUserData&gt;&gt; login(@FieldMap Map&lt;String, Object&gt; map);\n</code></pre> <p>\u4f20\u53c2\u5e94\u8be5\u4f7f\u7528<code>@Body RequestBody</code>\uff0c\u5e76\u4e14\u4e0d\u8981 <code>@FormUrlEncoded</code></p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#_3","title":"\u8c03\u7528\u7f51\u7edc\u8bf7\u6c42","text":"<pre><code>mNetworkManager.getUserApi().login(mLenovoToken, ServerCfg.RID, requestBody).enqueue(new Callback&lt;LoginResp&gt;() {\n    @Override\n    public void onResponse(Call&lt;LoginResp&gt; call, final Response&lt;LoginResp&gt; response) {\n        // \u670d\u52a1\u5668\u6709\u56de\u590d ...\n    }\n\n    @Override\n    public void onFailure(Call&lt;LoginResp&gt; call, final Throwable t) {\n        // \u8bbf\u95ee\u5931\u8d25 ...\n    }\n});\n</code></pre>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#ssl","title":"\u4fe1\u4efb\u6240\u6709\u670d\u52a1\u5668\u7684ssl","text":"<p>\u5e76\u4e0d\u63a8\u8350\u8fd9\u4e48\u505a</p> <p>\u5386\u53f2\u539f\u56e0\uff0c\u6709\u7684\u9879\u76ee\u91cc\u5bf9\u6d4b\u8bd5\u7ad9\u4f1a\u4fe1\u4efb\u6240\u6709\u7684ssl\u8bc1\u4e66\u3002</p> \u4fe1\u4efb\u6240\u6709SSL\u7684\u65b9\u6cd5 <pre><code>public class SSLUtils {\n    /**\n    * @return \u4fe1\u4efb\u6240\u6709\u670d\u52a1\u5668\n    */\n    public static SSLSocketFactory getSSLSocketFactory() throws Exception {\n        SSLSocketFactory sslSocketFactory = null;\n        SSLContext sslContext = SSLContext.getInstance(\"TLS\");\n        sslContext.init(null, new TrustManager[]{createTrustAllManager()}, new SecureRandom());\n        sslSocketFactory = sslContext.getSocketFactory();\n        return sslSocketFactory;\n    }\n\n    public static X509TrustManager createTrustAllManager() {\n        X509TrustManager tm = null;\n        try {\n            tm = new X509TrustManager() {\n                public void checkClientTrusted(X509Certificate[] chain, String authType)\n                        throws CertificateException {\n                    //do nothing\uff0c\u63a5\u53d7\u4efb\u610f\u5ba2\u6237\u7aef\u8bc1\u4e66\n                }\n\n                public void checkServerTrusted(X509Certificate[] chain, String authType)\n                        throws CertificateException {\n                    //do nothing\uff0c\u63a5\u53d7\u4efb\u610f\u670d\u52a1\u7aef\u8bc1\u4e66\n                }\n\n                public X509Certificate[] getAcceptedIssuers() {\n                    return new X509Certificate[0];\n                }\n            };\n        } catch (Exception e) {\n\n        }\n        return tm;\n    }\n\n}\n</code></pre>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#ioreactivexobservable","title":"\u4f7f\u7528io.reactivex.Observable","text":"<p>import\u7684\u65f6\u5019\u6ce8\u610f\u4e00\u4e0b\uff0c\u4f7f\u7528rx2\u7684\u5305\u3002</p> <pre><code>import io.reactivex.Observable; // \u8fd9\u4e2a\u662frx2\u7684\u5305\n// ...\n\n    /**\n     * \u7528\u6237\u53cd\u9988\u63a5\u53e3\n     *\n     * @param content \u7528\u6237\u8f93\u5165\u7684\u53cd\u9988\u5185\u5bb9\n     */\n    @POST(\"feedbackAction\")\n    Observable&lt;UserFeedback&gt; userFeedback(@Query(\"appVersion\") String appVersion,\n                                          @Query(\"phoneModel\") String phoneModel,\n                                          @Query(\"phoneOsVersion\") String osVersion,\n                                          @Query(\"submitContent\") String content);\n</code></pre>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#-retrofit2rxjava2","title":"\u793a\u4f8b - Retrofit2\uff0cRxJava2","text":"<p>\u63a5\u4e0b\u6765\u662f\u4e00\u4e2a\u8bbf\u95ee\u793a\u4f8b\u7684\u90e8\u5206\u4ee3\u7801</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#_4","title":"\u5f15\u5165\u4f9d\u8d56","text":"<pre><code>implementation 'com.squareup.retrofit2:retrofit:2.5.0'\nimplementation 'com.squareup.retrofit2:converter-gson:2.5.0'\nimplementation 'com.squareup.retrofit2:adapter-rxjava2:2.3.0'\nimplementation 'io.reactivex.rxjava2:rxandroid:2.1.1'\nimplementation 'io.reactivex.rxjava2:rxjava:2.2.8'\n</code></pre>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#interface","title":"\u5b9a\u4e49interface","text":"<pre><code>import java.util.Map;\n\nimport io.reactivex.Observable;\nimport retrofit2.http.Field;\nimport retrofit2.http.FieldMap;\nimport retrofit2.http.FormUrlEncoded;\nimport retrofit2.http.GET;\nimport retrofit2.http.POST;\nimport retrofit2.http.Query;\n\n/**\n * rustfisher.com \u540e\u53f0\u63a5\u53e3\n * Created on 2019-5-17\n */\npublic interface RustDroneCommonService {\n\n    /**\n     * \u7528\u6237\u53cd\u9988\u63a5\u53e3\n     *\n     * @param content \u7528\u6237\u8f93\u5165\u7684\u53cd\u9988\u5185\u5bb9\n     */\n    @FormUrlEncoded\n    @POST(\"feedbackAction\")\n    Observable&lt;FeedbackResp&gt; userFeedback(@Field(\"appVersion\") String appVersion,\n                                          @Field(\"phoneModel\") String phoneModel,\n                                          @Field(\"phoneOsVersion\") String osVersion,\n                                          @Field(\"submitContent\") String content,\n                                          @FieldMap Map&lt;String, String&gt; map);\n\n    /**\n     * \u83b7\u53d6\u624b\u673a\u9a8c\u8bc1\u7801\n     *\n     * @param mobile \u624b\u673a\u53f7\n     */\n    @GET(\"verifyCode\")\n    Observable&lt;PhoneCodeResp&gt; getPhoneCode(@Query(\"mobile\") String mobile, @Query(\"oprType\") int type);\n}\n</code></pre>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#_5","title":"\u8c03\u7528\u63a5\u53e3","text":"<pre><code>import io.reactivex.Observer;\nimport io.reactivex.android.schedulers.AndroidSchedulers;\nimport io.reactivex.disposables.Disposable;\nimport io.reactivex.schedulers.Schedulers;\n\nRustDroneDataCenter.getCenter().getCommonService().userFeedback(BuildConfig.VERSION_NAME,\n                    Build.MODEL.replace(\" \", \"-\"), Build.VERSION.RELEASE, fd, ext)\n                    .subscribeOn(Schedulers.newThread())\n                    .observeOn(AndroidSchedulers.mainThread())\n                    .subscribe(new Observer&lt;FeedbackResp&gt;() {\n                        @Override\n                        public void onSubscribe(Disposable d) {\n//                            LL.dn(TAG, \"onSubscribe: \" + d);\n                        }\n\n                        @Override\n                        public void onNext(FeedbackResp feedbackResp) {\n                            LL.dn(TAG, \"onNext: \" + feedbackResp);\n                            if (feedbackResp.getCode() == 0) {\n                                popSubmitSuccessDialog();\n                            } else {\n                                LL.e(\"\u4e0a\u4f20\u7528\u6237\u53cd\u9988\u5931\u8d25\");\n                                mPbLayout.setVisibility(View.GONE);\n                                popRetryDialog();\n                            }\n                        }\n\n                        @Override\n                        public void onError(Throwable e) {\n                            LL.e(\"\u4e0a\u4f20\u7528\u6237\u53cd\u9988\u5931\u8d25 code: \" + e);\n                            mPbLayout.setVisibility(View.GONE);\n                            popRetryDialog();\n                        }\n\n                        @Override\n                        public void onComplete() {\n                            mPbLayout.setVisibility(View.GONE);\n                            LL.dn(TAG, \"onComplete: \u4e0a\u4f20\u7ed3\u675f\");\n                        }\n                    });\n</code></pre>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#githubonandroid","title":"GithubOnAndroid\u793a\u4f8b","text":"<p>\u4f7f\u7528\u7684\u662fGithub\u7684\u5f00\u53d1API\u3002\u793a\u4f8b\u4ee3\u7801\u5730\u5740\uff1a https://github.com/RustFisher/GithubOnAndroid</p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#_6","title":"\u62e6\u622a\u5668","text":""},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#_7","title":"\u5b9a\u4e49\u62e6\u622a\u5668","text":"<p>\u5728\u4e0b\u9762\u7684\u62e6\u622a\u5668\u91cc\u6253log\uff0c\u8868\u660e\u62e6\u622a\u5230\u4e86\u8bf7\u6c42\u3002\u4f46\u4e0d\u505a\u5176\u5b83\u5904\u7406\u3002 <pre><code>// \u4ec5\u4ec5\u662f\u793a\u4f8b\uff0c\u4e0d\u505a\u4efb\u4f55\u5904\u7406\nprivate Interceptor doNothingInterceptor = new Interceptor() {\n    @Override\n    public Response intercept(Chain chain) throws IOException {\n        Log.d(TAG, \"Interceptor1: intercept\");\n        return chain.proceed(chain.request());\n    }\n};\n</code></pre></p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#_8","title":"\u6dfb\u52a0\u62e6\u622a\u5668","text":"<p>\u8981\u4f7f\u7528\u62e6\u622a\u5668\uff0c\u9700\u8981\u628a\u62e6\u622a\u5668\u6dfb\u52a0\u8fdb\u53bb<code>addInterceptor()</code> <pre><code>OkHttpClient okHttpClient = new OkHttpClient.Builder()\n    .readTimeout(10, TimeUnit.SECONDS)\n    .connectTimeout(10, TimeUnit.SECONDS)\n    .addInterceptor(doNothingInterceptor) // \u6dfb\u52a0\u62e6\u622a\u5668\n    .addInterceptor(new Interceptor() {\n        @Override\n        public Response intercept(Chain chain) throws IOException {\n            Log.d(TAG, \"Interceptor2: intercept\");\n            return chain.proceed(chain.request());\n        }\n    })\n    .addNetworkInterceptor(new Interceptor() {\n        @Override\n        public Response intercept(Chain chain) throws IOException {\n            Log.d(TAG, \"NetworkInterceptor1: intercept\");\n            return chain.proceed(chain.request());\n        }\n    })\n    .build();\n</code></pre></p>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#header","title":"\u62e6\u622a\u5668\u4e2d\u589e\u52a0header","text":"<p>\u5728\u62e6\u622a\u5668\u4e2d\u6211\u4eec\u53ef\u4ee5\u8fdb\u884c\u4e00\u4e9b\u64cd\u4f5c\uff0c\u6bd4\u5982\u64cd\u4f5cchain\u4e2d\u7684request\u6dfb\u52a0header\u3002</p> <pre><code>    // \u6dfb\u52a0\u4e00\u4e9b\u516c\u5171\u53c2\u6570\n    private Interceptor mRustDroneInterceptor = new Interceptor() {\n        @Override\n        public Response intercept(Chain chain) throws IOException {\n            Request request = chain.request().newBuilder()\n                    .addHeader(\"token\", UserCenter.getToken())\n                    .build();\n            return chain.proceed(request);\n        }\n    };\n</code></pre>"},{"location":"android/network/okhttp/OkHttp_Retrofit_use_intro/#_9","title":"\u53c2\u8003","text":"<p>OkHttp\u7cfb\u5217</p> <ul> <li>OkHttp\u5165\u95e8</li> <li>OkHttp + Retrofit \u4f7f\u7528\u793a\u4f8b</li> <li>OkHttp\u63a5\u6536\u666e\u901a\u6587\u672c</li> <li>OkHttp + Retrofit \u4e0b\u8f7d\u6587\u4ef6\u4e0e\u8fdb\u5ea6\u76d1\u542c</li> <li>OkHttp + Retrofit \u53d6\u6d88\u8bf7\u6c42\u7684\u65b9\u6cd5</li> <li>OkHttp + Retrofit \u8303\u56f4\u4e0b\u8f7d</li> <li>OkHttp Retrofit \u4e0a\u4f20\u6587\u4ef6</li> </ul> <p></p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a</p>"},{"location":"android/network/okhttp/resp-normal-string/","title":"OkHttp\u63a5\u6536\u666e\u901a\u6587\u672c","text":"<p>\u540e\u53f0\u8fd4\u56de\u7684\u4e0d\u662fjson\u683c\u5f0f\u6570\u636e\uff0c\u800c\u662f\u666e\u901a\u6587\u672c\u3002\u7ee7\u7eed\u62ffGson\u89e3\u6790\u4f1a\u51fa\u9519\u3002 \u6b64\u65f6\u6211\u4eec\u9700\u8981ScalarsConverterFactory\u6765\u5904\u7406\u666e\u901a\u6587\u672c\u3002</p> <p><code>build.gradle</code>\u5f15\u5165\u76f8\u5173\u5e93 <pre><code>implementation 'com.squareup.retrofit2:converter-scalars:2.5.0'\n</code></pre></p> <p>\u7f16\u5199\u63a5\u53e3\u7684\u65f6\u5019\uff0c\u8fd4\u56de\u7c7b\u578b\u4f7f\u7528String\u3002\u4f8b\u5982\u8bf7\u6c42\u4e00\u4e2a\u9759\u6001\u6587\u4ef6\uff0c\u8fd9\u91cc\u4f7f\u7528Get\u65b9\u6cd5\u3002 <pre><code>@GET(\"server/sample/abc\")\nObservable&lt;String&gt; reqNormalText();\n</code></pre></p> <p>\u521b\u5efaRetrofit\u5bf9\u8c61\u7684\u65f6\u5019\uff0c\u9700\u8981\u6dfb\u52a0ScalarsConverterFactory\u3002 <pre><code>retrofit = new Retrofit.Builder()\n        .addConverterFactory(ScalarsConverterFactory.create()) // \u8fd9\u91cc\u6dfb\u52a0\n        .addConverterFactory(GsonConverterFactory.create(buildGson()))\n</code></pre></p>"},{"location":"android/network/okhttp/resp-normal-string/#_1","title":"\u53c2\u8003","text":"<p>OkHttp\u7cfb\u5217</p> <ul> <li>OkHttp\u5165\u95e8</li> <li>OkHttp + Retrofit \u4f7f\u7528\u793a\u4f8b</li> <li>OkHttp\u63a5\u6536\u666e\u901a\u6587\u672c</li> <li>OkHttp + Retrofit \u4e0b\u8f7d\u6587\u4ef6\u4e0e\u8fdb\u5ea6\u76d1\u542c</li> <li>OkHttp + Retrofit \u53d6\u6d88\u8bf7\u6c42\u7684\u65b9\u6cd5</li> <li>OkHttp + Retrofit \u8303\u56f4\u4e0b\u8f7d</li> <li>OkHttp Retrofit \u4e0a\u4f20\u6587\u4ef6</li> </ul> <p></p>"},{"location":"android/network/okhttp/upload_file/","title":"Android OkHttp Retrofit \u4e0a\u4f20\u6587\u4ef6","text":"\u66f4\u65b0\u65e5\u671f\uff1a2023-3-9 <ul> <li>2023-3-9 \u66f4\u65b0\u683c\u5f0f</li> </ul>"},{"location":"android/network/okhttp/upload_file/#_1","title":"\u5355\u6587\u4ef6\u4e0a\u4f20\uff0c\u65e0\u53c2\u6570\u7684\u60c5\u51b5","text":"<p>\u670d\u52a1\u63a5\u53e3\u7f16\u5199 <pre><code>/**\n * \u4e0a\u4f20\u6587\u4ef6\n */\n@Multipart\n@POST(\"applog/upload\")\nObservable&lt;UploadFileResp&gt; uploadFile(@Part MultipartBody.Part file);\n</code></pre></p> <p>\u6784\u5efa<code>MultipartBody.Part</code> <pre><code>File f = new File(\"aa.txt\");\nRequestBody requestBody =\n        RequestBody.create(MediaType.parse(\"multipart/form-data\"), f);\nMultipartBody.Part part =\n        MultipartBody.Part.createFormData(\"file\", f.getName(), requestBody);\n</code></pre></p> <p>\u5b50\u7ebf\u7a0b\u4e2d\u8c03\u7528\u4e0a\u4f20 <pre><code>commonService.uploadFile(part).subscribe(new Observer&lt;UploadFileResp&gt;() {\n    @Override\n    public void onSubscribe(Disposable d) {\n\n    }\n\n    @Override\n    public void onNext(UploadFileResp resp) {\n        if (resp.getCode() == RESP_GOOD_CODE) {\n            boolean r = f.delete();\n            LL.dn(TAG, r + \" \u4e0a\u4f20log\u6210\u529f : \" + f.getName());\n\n        }\n    }\n\n    @Override\n    public void onError(Throwable e) {\n        Log.e(TAG, \"\u4e0a\u4f20log\u6587\u4ef6 [\" + f + \"] onError: \", e);\n        LL.en(TAG, e.getMessage());\n    }\n\n    @Override\n    public void onComplete() {\n\n    }\n});\n</code></pre></p>"},{"location":"android/network/okhttp/upload_file/#_2","title":"\u53c2\u8003","text":"<p>OkHttp\u7cfb\u5217</p> <ul> <li>OkHttp\u5165\u95e8</li> <li>OkHttp + Retrofit \u4f7f\u7528\u793a\u4f8b</li> <li>OkHttp\u63a5\u6536\u666e\u901a\u6587\u672c</li> <li>OkHttp + Retrofit \u4e0b\u8f7d\u6587\u4ef6\u4e0e\u8fdb\u5ea6\u76d1\u542c</li> <li>OkHttp + Retrofit \u53d6\u6d88\u8bf7\u6c42\u7684\u65b9\u6cd5</li> <li>OkHttp + Retrofit \u8303\u56f4\u4e0b\u8f7d</li> <li>OkHttp Retrofit \u4e0a\u4f20\u6587\u4ef6</li> </ul> <p></p>"},{"location":"android/notification/demo1/","title":"Notification \u4f7f\u7528","text":"<p>Android L ; Android Studio 14</p>"},{"location":"android/notification/demo1/#_1","title":"\u4f7f\u7528\u8fc7\u7a0b","text":"<ul> <li>NotificationManager - \u7528\u4e8e\u63d0\u793a\u7684\u7ba1\u7406\uff0c\u4f8b\u5982\u53d1\u9001\u3001\u53d6\u6d88</li> <li>NotificationCompat.Builder - Builder\u6a21\u5f0f\u6784\u9020notification\uff1b\u53ef\u53c2\u8003\u300aEffective Java\u300b\u7b2c2\u6761</li> <li>Notification - \u63d0\u793a\uff0c\u80fd\u591f\u663e\u793a\u5728\u72b6\u6001\u680f\u548c\u4e0b\u62c9\u680f\u4e0a\uff1b\u6784\u9020\u5b9e\u4f8b\u80fd\u8bbe\u5b9aflags</li> </ul>"},{"location":"android/notification/demo1/#notificationdemo","title":"NotificationDemo","text":"<p>\u672c\u4f8b\u610f\u5728\u8bb0\u5f55android notification\u7684\u4f7f\u7528\u65b9\u6cd5\u3002</p> <p>\u754c\u9762\u4e2d\u653e\u7f6e\u4e86\u5f88\u591a\u4e2a\u6309\u94ae\uff0c\u6bcf\u4e2a\u6309\u94ae\u53d1\u9001\u7684\u63d0\u793a\u5e76\u4e0d\u5b8c\u5168\u76f8\u540c\u3002\u6d41\u7a0b\u90fd\u4e00\u6837\u3002 \u8bbe\u5b9a\u4e00\u4e2aNotificationManager\uff0c \u4f7f\u7528NotificationCompat.Builder\u6765\u5efa\u7acbNotification\uff1b\u70b9\u51fb\u6309\u94ae\u65f6NotificationManager.notify\u53d1\u9001\u63d0\u793a \u5176\u4e2d\u6709\u63a5\u6536\u5e7f\u64ad\u53d1\u9001notification\u7684\u4f8b\u5b50</p> <p><code>build.gradle</code>\u90e8\u5206\u4ee3\u7801\uff0c\u6700\u4f4eAPI 19\uff1a <pre><code>android {\n    compileSdkVersion 23\n    buildToolsVersion \"23.0.1\"\n\n    defaultConfig {\n        applicationId \"com.rust.rustnotifydemo\"\n        minSdkVersion 19\n        targetSdkVersion 23\n        versionCode 1\n        versionName \"1.0\"\n    }\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n        }\n    }\n}\n</code></pre></p> <p>\u4e3b\u8981\u4ee3\u7801 <code>MainActivity.java</code> \uff1a <pre><code>import android.app.NotificationManager;\nimport android.app.Notification;\nimport android.app.PendingIntent;\nimport android.content.BroadcastReceiver;\nimport android.content.Context;\nimport android.content.Intent;\nimport android.content.IntentFilter;\nimport android.graphics.Bitmap;\nimport android.graphics.BitmapFactory;\nimport android.os.Bundle;\nimport android.support.v7.app.AppCompatActivity;\nimport android.support.v4.app.NotificationCompat;\nimport android.support.v7.widget.Toolbar;\nimport android.view.MotionEvent;\nimport android.view.View;\nimport android.view.inputmethod.InputMethodManager;\nimport android.widget.Button;\nimport android.widget.EditText;\n\nclass notifyBroadcast extends BroadcastReceiver {\n\n    @Override\n    public void onReceive(Context context, Intent intent) {\n        NotificationManager nMgr =\n                (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);\n        Intent goHome = new Intent(Intent.ACTION_MAIN);\n        goHome.addCategory(Intent.CATEGORY_HOME);\n        NotificationCompat.Builder builder = new NotificationCompat.Builder(context)\n                .setSmallIcon(R.drawable.signal_horn_26px)\n                .setContentText(\"\u70b9\u51fb\u8fd4\u56de\u684c\u9762\")\n                .setContentTitle(\"Go home\")\n                .setTicker(\"\u6765\u81ea\u5e7f\u64ad\u7684\u63d0\u793a\")\n                .setContentIntent(PendingIntent.getActivity(context, 0, goHome, 0));\n        Notification notificationBroadcast = builder.build();\n        notificationBroadcast.flags |= Notification.FLAG_AUTO_CANCEL;\n        nMgr.notify(002, notificationBroadcast);/* id\u76f8\u540c\uff1b\u6b64\u63d0\u793a\u4e0e Notification 2 \u53ea\u80fd\u663e\u793a\u4e00\u4e2a */\n    }\n}\n\npublic class MainActivity extends AppCompatActivity {\n    public static final String BroadcastNotify = \"com.rust.notify.broadcast\";\n\n    private EditText editContent;\n    private Button sendNotification;\n    private Button notifyButton1;\n    private Button notifyButton2;\n    private Button cleanButton;\n    private Button notifyBroadcast;\n\n    private int notificationId = 001;\n\n    private BroadcastReceiver notifyReceiver;\n    private InputMethodManager inputMgr;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);\n        setSupportActionBar(toolbar);\n\n        IntentFilter filter = new IntentFilter(BroadcastNotify);\n        notifyReceiver = new notifyBroadcast();\n        registerReceiver(notifyReceiver, filter);\n\n        /* get the widgets */\n        editContent = (EditText) findViewById(R.id.et_content);\n        sendNotification = (Button) findViewById(R.id.btn_send_content);\n        notifyButton1 = (Button) findViewById(R.id.btn_notify_1);\n        notifyButton2 = (Button) findViewById(R.id.btn_notify_2);\n        notifyBroadcast = (Button) findViewById(R.id.btn_notify_broadcast);\n        cleanButton = (Button) findViewById(R.id.btn_clean_notification);\n\n        /* \u6784\u9020\u4e00\u4e2aBitmap\uff0c\u663e\u793a\u5728\u4e0b\u62c9\u680f\u4e2d */\n        final Bitmap notifyBitmapTrain = BitmapFactory\n                .decodeResource(this.getResources(), R.drawable.train);\n\n        /* \u7ba1\u7406\u5668-\u7528\u6765\u53d1\u9001notification */\n        final NotificationManager nMgr =\n                (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE);\n\n        notifyButton1.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                Intent intent = new Intent();\n                intent.setClass(getApplicationContext(), MainActivity.class);\n\n                NotificationCompat.Builder nBuilder1 =\n                        new NotificationCompat.Builder(getApplicationContext())\n                                .setTicker(\"Notify 1 ! \")/* \u72b6\u6001\u680f\u663e\u793a\u7684\u63d0\u793a\u8bed */\n                                .setContentText(\"Go back to RustNotifyDemo\")/* \u4e0b\u62c9\u680f\u4e2d\u7684\u5185\u5bb9 */\n                                .setSmallIcon(R.drawable.notification_small_icon_24)/* \u72b6\u6001\u680f\u56fe\u7247 */\n                                .setLargeIcon(notifyBitmapTrain)/* \u4e0b\u62c9\u680f\u5185\u5bb9\u663e\u793a\u7684\u56fe\u7247 */\n                                .setContentTitle(\"notifyButton1 title\")/* \u4e0b\u62c9\u680f\u663e\u793a\u7684\u6807\u9898 */\n                                .setContentIntent(PendingIntent\n                                        .getActivity(getApplicationContext(), 0, intent,\n                                                PendingIntent.FLAG_UPDATE_CURRENT));\n                                        /* \u76f4\u63a5\u4f7f\u7528PendingIntent.getActivity()\uff1b\u4e0d\u9700\u8981\u5b9e\u4f8b */\n                                        /* getActivity() \u662f static \u65b9\u6cd5*/\n                Notification n = nBuilder1.build();/* \u76f4\u63a5\u521b\u5efaNotification */\n                n.flags |= Notification.FLAG_AUTO_CANCEL;/* \u70b9\u51fb\u540e\u89e6\u53d1\u65f6\u95f4\uff0c\u63d0\u793a\u81ea\u52a8\u6d88\u5931 */\n                nMgr.notify(notificationId, n);\n            }\n        });\n\n        notifyButton2.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                NotificationCompat.Builder nBuilder2 =\n                        new NotificationCompat.Builder(getApplicationContext())\n                                .setTicker(\"Notify 2 ! \")/* \u72b6\u6001\u680f\u663e\u793a\u7684\u63d0\u793a\u8bed */\n                                .setContentText(\"Notification 2 content\")/* \u4e0b\u62c9\u680f\u4e2d\u7684\u5185\u5bb9 */\n                                .setSmallIcon(R.drawable.floppy_16px)/* \u72b6\u6001\u680f\u56fe\u7247 */\n                                .setLargeIcon(notifyBitmapTrain)/* \u4e0b\u62c9\u680f\u5185\u5bb9\u663e\u793a\u7684\u56fe\u7247 */\n                                .setContentTitle(\"title2\");/* \u4e0b\u62c9\u680f\u663e\u793a\u7684\u6807\u9898 */\n                nMgr.notify(notificationId + 1, nBuilder2.build());\n                /* \u4e24\u4e2aid\u4e00\u6837\u7684notification\u4e0d\u80fd\u540c\u65f6\u663e\u793a\uff0c\u4f1a\u88ab\u65b0\u7684\u63d0\u793a\u66ff\u6362\u6389 */\n            }\n        });\n\n        sendNotification.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                String content = editContent.getText().toString();\n                if (content.equals(\"\")) {\n                    content = \"U input nothing\";\n                }\n                NotificationCompat.Builder contentBuilder =\n                        new NotificationCompat.Builder(getApplicationContext())\n                                .setTicker(content)/* \u72b6\u6001\u680f\u663e\u793a\u7684\u63d0\u793a\u8bed */\n                                .setContentText(\"I can auto cancel\")/* \u4e0b\u62c9\u680f\u4e2d\u7684\u5185\u5bb9 */\n                                .setSmallIcon(R.drawable.rain_32px)/* \u72b6\u6001\u680f\u56fe\u7247 */\n                                .setLargeIcon(notifyBitmapTrain)/* \u4e0b\u62c9\u680f\u5185\u5bb9\u663e\u793a\u7684\u56fe\u7247 */\n                                .setContentTitle(\"Edit title\");/* \u4e0b\u62c9\u680f\u663e\u793a\u7684\u6807\u9898 */\n                Notification n = contentBuilder.build();\n                nMgr.notify(notificationId + 2, n);\n            }\n        });\n\n        notifyBroadcast.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                Intent i = new Intent(BroadcastNotify);\n                sendBroadcast(i);\n            }\n        });\n\n        cleanButton.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                nMgr.cancel(notificationId);/* \u6839\u636eid\uff0c\u64a4\u9500notification */\n            }\n        });\n    }\n\n    /**\n     * \u70b9\u51fb\u7a7a\u767d\u5904\uff0c\u8f6f\u952e\u76d8\u81ea\u52a8\u6d88\u5931\n     */\n    @Override\n    public boolean onTouchEvent(MotionEvent event) {\n        if (event.getAction() == MotionEvent.ACTION_DOWN) {\n            if (getCurrentFocus() != null &amp;&amp; getCurrentFocus().getWindowToken() != null) {\n                inputMgr = (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE);\n                inputMgr.hideSoftInputFromWindow(\n                        getCurrentFocus().getWindowToken(), InputMethodManager.HIDE_NOT_ALWAYS);\n            }\n        }\n        return super.onTouchEvent(event);\n    }\n\n    @Override\n    protected void onDestroy() {\n        unregisterReceiver(notifyReceiver);\n        super.onDestroy();\n    }\n}\n</code></pre> <code>MainActivity launchMode=\"singleInstance\"</code>\uff1b\u4fbf\u4e8e\u8fd4\u56de activity</p> <p>\u56fe\u7247\u8d44\u6e90\u90fd\u662f\u7f51\u7edc\u4e0b\u8f7d</p>"},{"location":"android/permissions/custom-user-permission/","title":"Android \u6dfb\u52a0\u81ea\u5b9a\u4e49\u6743\u9650","text":"<ul> <li>permission-tree \u6743\u9650\u7684\u6839\u8282\u70b9\uff0c3\u4e2a\u6210\u5458\u90fd\u8981\u5b9a\u4e49   name \u4e00\u822c\u6765\u8bf4\u9700\u89812\u4e2a\u201c.\u201d\uff1b\u6bd4\u5982\u4e0b\u9762\u7684\"rust.permission.user\"\uff1b   \u5426\u5219\u62a5\u9519<code>INSTALL_PARSE_FAILED_MANIFEST_MALFORMED</code>   icon \u548c label \u6b63\u5e38\u6dfb\u52a0\u5373\u53ef</li> <li>permission \u6743\u9650\u58f0\u660e\uff0c\u5b9a\u4e49\u6743\u9650\u7ec4\u3001\u7b49\u7ea7\u7b49\u4fe1\u606f</li> <li>uses-permission \u4f7f\u7528\u6743\u9650</li> </ul> <p><pre><code>    &lt;!-- user define permission\n         permission tree and permission --&gt;\n    &lt;permission-tree\n        android:name=\"rust.permission.user\"\n        android:icon=\"@mipmap/ic_launcher\"\n        android:label=\"@string/app_name\" /&gt;\n    &lt;permission\n        android:name=\"rust.permission.user.TEST\"\n        android:label=\"@string/app_name\"\n        android:permissionGroup=\"@string/action_settings\"\n        android:protectionLevel=\"normal\" /&gt;\n\n    &lt;!-- use user permission --&gt;\n    &lt;uses-permission android:name=\"rust.permission.user.TEST\" /&gt;\n</code></pre> \u4ee3\u7801\u4e2d\u68c0\u67e5\u662f\u5426\u7533\u8bf7\u4e86\u6743\u9650 \u4f7f\u7528PackageManager\u7684\u65b9\u6cd5\u6765\u68c0\u67e5 <pre><code>    private static final String TestPermission = \"rust.permission.user.TEST\";\n    ......\n    checkUserPermission(getApplicationContext(), TestPermission);\n    ......\n\n    /**\n     * check permission\n     *\n     * @param context - the application context\n     */\n    private void checkUserPermission(Context context, String permissionName) {\n        PackageManager pm = getPackageManager();\n        boolean permitTest = (PackageManager.PERMISSION_GRANTED ==\n                pm.checkPermission(permissionName, getPackageName()));\n        Toast.makeText(context, permitTest ? \"Test YES!\" : \"Test NO!\", Toast.LENGTH_SHORT)\n                .show();\n    }\n</code></pre></p>","tags":["Android PackageManager"]},{"location":"android/phone/phone_settings/","title":"\u673a\u5668\u7684\u4e00\u4e9b\u8bbe\u7f6e","text":"<p>\u534e\u4e3a\u5e73\u677f\uff0c\u6253\u5f00\u8ba1\u7b97\u5668App\uff0c\u8f93\u5165<code>()()2846579()()</code>\u3002 \u5728 \u540e\u53f0\u8bbe\u7f6e - LOG\u8bbe\u7f6e \u4e2d\u9009\u62e9AP\u65e5\u5fd7\u5373\u53ef\u3002</p> <p>\u534e\u4e3a\u5e73\u677fM3\u6ca1\u7535\u7684\u65f6\u5019\uff0c\u6bd4\u5982\u7535\u91cf\u572810%\u4ee5\u4e0b\u3002\u8fd0\u7b97\u901f\u5ea6\u4f1a\u964d\u4f4e\u3002</p>"},{"location":"android/pm/basic-use/","title":"PackageManager\u7684\u4e00\u4e9b\u57fa\u7840\u7528\u6cd5","text":"<p>\u901a\u5e38\u6211\u4eec\u7528<code>context.getPackageManager()</code>\u6765\u83b7\u53d6PackageManager</p>","tags":["Android PackageManager"]},{"location":"android/pm/basic-use/#app","title":"\u6309\u5305\u540d\u67e5\u627e\u5df2\u5b89\u88c5app\u4fe1\u606f","text":"<p>\u4f7f\u7528<code>getPackageInfo</code>\u65b9\u6cd5\uff0c\u67e5\u627e\u672c\u673a\u5e94\u7528\u4fe1\u606f\u3002</p> <pre><code>PackageManager pm = context.getPackageManager();\ntry {\n    PackageInfo pi = pm.getPackageInfo(task.getPkgName(), PackageManager.GET_META_DATA);\n} catch (PackageManager.NameNotFoundException e) {\n    Log.e(TAG, \"\u6ca1\u6709\u8fd9\u4e2aapp: \" + task.getPkgName());\n}\n</code></pre>","tags":["Android PackageManager"]},{"location":"android/pm/restart-App/","title":"\u4ee3\u7801\u91cd\u542fapp\u7684\u65b9\u6cd5","text":"\u4fee\u6539\u65e5\u671f\uff1a2022-5-24 <ul> <li>2022-5-24\uff1a\u589e\u52a0\u8bf4\u660e</li> <li>2022-2-3 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4f7f\u7528<code>PackageManager</code>\u5b9e\u73b0\u91cd\u542fapp\u7684\u529f\u80fd\u3002</p> <p>\u5177\u4f53\u6b65\u9aa4\u662f\uff0c\u5148<code>startActivity</code>\u542f\u52a8\u81ea\u5df1app\uff0c\u7136\u540e\u9000\u51fa\u5f53\u524d\u8fdb\u7a0b\u3002</p> <pre><code>public static void triggerRebirth(Context context) {\n    PackageManager packageManager = context.getPackageManager();\n    Intent intent = packageManager.getLaunchIntentForPackage(context.getPackageName()); // (1)\n    ComponentName componentName = intent.getComponent();\n    Intent mainIntent = Intent.makeRestartActivityTask(componentName); // (2)\n    context.startActivity(mainIntent);\n    Runtime.getRuntime().exit(0); // (3)\n}\n</code></pre> <ol> <li>\u4f1a\u5148\u53bb\u627e\u6ce8\u518c\u4e86<code>android.intent.category.INFO</code>\u7684activity\uff0c\u7136\u540e\u627e<code>android.intent.category.LAUNCHER</code></li> <li>\u521b\u5efa\u7684intent\u7528\u6765\u91cd\u542fapp</li> <li>\u9000\u51fa\u5f53\u524d\u8fdb\u7a0b</li> </ol> <p>\u91cd\u542f\u524d\u5f39\u51fa\u4e00\u4e9b\u63d0\u793a\u7ed9\u7528\u6237\uff0c\u63d0\u9ad8\u4ea7\u54c1\u4f53\u9a8c</p> <p>\u53c2\u8003\uff1a</p> <p>stackoverflow</p>","tags":["Android PackageManager"]},{"location":"android/resource/resources_overview/","title":"res\u8d44\u6e90\u76ee\u5f55\u7b80\u4ecb","text":"\u66f4\u65b0\u65e5\u671f 2022-9-30 <ul> <li>2022-9-30 \u66f4\u65b0\u8bf4\u660e</li> </ul> <p>\u7b80\u5355\u4ecb\u7ecdAndroid\u5de5\u7a0b\u4e2d\u7684\u8d44\u6e90\u76ee\u5f55\uff08resources\uff09\uff0c<code>res</code>\u3002</p>"},{"location":"android/resource/resources_overview/#_1","title":"\u8d44\u6e90","text":"<p>\u8d44\u6e90\u662f\u6307\u4ee3\u7801\u4f7f\u7528\u7684\u9644\u52a0\u6587\u4ef6\u548c\u9759\u6001\u5185\u5bb9\uff0c\u4f8b\u5982\u4f4d\u56fe\u3001\u5e03\u5c40\u5b9a\u4e49\u3001\u754c\u9762\u5b57\u7b26\u4e32\u3001\u52a8\u753b\u8bf4\u660e\u7b49\u3002</p> <p>\u672c\u6587\u4e2d\u6211\u4eec\u5173\u6ce8\u7684\u662f\u8fd9\u4e00\u4e2a\u76ee\u5f55\u3002 </p> <p>Android\u91cc\u7684\u8d44\u6e90\uff08res\u8d44\u6e90\uff09\u6307\u7684\u662f\u4ec0\u4e48\uff1f</p> <p>\u8d44\u6e90\u662f\u6307\u4ee3\u7801\u4f7f\u7528\u7684\u9644\u52a0\u6587\u4ef6\u548c\u9759\u6001\u5185\u5bb9\uff0c\u4f8b\u5982\u4f4d\u56fe\u3001\u5e03\u5c40\u5b9a\u4e49\u3001\u754c\u9762\u5b57\u7b26\u4e32\u3001\u52a8\u753b\u8bf4\u660e\u7b49\u3002</p> <p>\u628a\u8d44\u6e90\u653e\u8fdb\u5bf9\u5e94\u7684\u76ee\u5f55\u540e\uff0c\u53ef\u4f7f\u7528\u5728\u9879\u76ee<code>R</code>\u7c7b\u4e2d\u751f\u6210\u7684\u8d44\u6e90ID\u6765\u8bbf\u95ee\u8fd9\u4e9b\u8d44\u6e90\u3002\u5f62\u5982<code>R.drawable.icon</code>\uff0c<code>R.layout.main_activity</code>\u3002 <code>R</code>\u7c7b\u662f\u81ea\u52a8\u751f\u6210\u7684\u3002\u4ee3\u8868resources\u3002</p>"},{"location":"android/resource/resources_overview/#_2","title":"\u5206\u7ec4\u8d44\u6e90\u7c7b\u578b","text":"<p>\u5c06\u5404\u7c7b\u8d44\u6e90\u653e\u5165\u9879\u76ee <code>res/</code> \u76ee\u5f55\u7684\u7279\u5b9a\u5b50\u76ee\u5f55\u4e2d\u3002 \u5b50\u76ee\u5f55\u7684\u540d\u5b57\u7279\u522b\u91cd\u8981\u3002\u6211\u4eec\u628a\u4e0d\u540c\u7684\u8d44\u6e90\u653e\u5230\u4e0d\u540c\u7684\u5b50\u76ee\u5f55\u4e2d\uff08res\u5b50\u76ee\u5f55\uff09\u3002\u53c2\u8003\u4e0b\u9762\u7684\u8868\u683c\u3002</p> \u76ee\u5f55 \u8d44\u6e90\u7c7b\u578b animator/ \u7528\u4e8e\u5b9a\u4e49\u5c5e\u6027\u52a8\u753b\u7684 XML \u6587\u4ef6\u3002 anim/ \u7528\u4e8e\u5b9a\u4e49\u6e10\u53d8\u52a8\u753b\u7684 XML \u6587\u4ef6\u3002\uff08\u5c5e\u6027\u52a8\u753b\u4e5f\u53ef\u4fdd\u5b58\u5728\u6b64\u76ee\u5f55\u4e2d\uff0c\u4f46\u4e3a\u4e86\u533a\u5206\u8fd9\u4e24\u79cd\u7c7b\u578b\uff0c\u5c5e\u6027\u52a8\u753b\u9996\u9009 animator/ \u76ee\u5f55\u3002\uff09 color/ \u7528\u4e8e\u5b9a\u4e49\u989c\u8272\u72b6\u6001\u5217\u8868\u7684 XML \u6587\u4ef6\u3002 drawable/ \u4f4d\u56fe\u6587\u4ef6\uff08.png\u3001.9.png\u3001.jpg\u3001.gif\uff09\u6216\u7f16\u8bd1\u4e3a\u4ee5\u4e0b\u53ef\u7ed8\u5236\u5bf9\u8c61\u8d44\u6e90\u5b50\u7c7b\u578b\u7684 XML \u6587\u4ef6\uff1a \u4f4d\u56fe\u6587\u4ef6\u3001\u4e5d\u5bab\u683c\uff08\u53ef\u8c03\u6574\u5927\u5c0f\u7684\u4f4d\u56fe\uff09\u3001\u72b6\u6001\u5217\u8868\u3001\u5f62\u72b6\u3001\u52a8\u753b\u53ef\u7ed8\u5236\u5bf9\u8c61\u3001\u5176\u4ed6\u53ef\u7ed8\u5236\u5bf9\u8c61\u3002 mipmap/ \u9002\u7528\u4e8e\u4e0d\u540c\u542f\u52a8\u5668\u56fe\u6807\u5bc6\u5ea6\u7684\u53ef\u7ed8\u5236\u5bf9\u8c61\u6587\u4ef6\u3002\u5e94\u7528\u56fe\u6807\u653e\u8fd9\u91cc\u3002mipmap\u540e\u9762\u8ddf\u7740\u7684dpi\u7c7b\u522b\uff0c\u6bd4\u5982<code>hdpi</code> <code>mdpi</code>\uff0c\u91cc\u9762\u7684\u56fe\u6807\u5c3a\u5bf8\u5927\u5c0f\u662f\u4e0d\u540c\u7684\u3002\u53ef\u4ee5\u53c2\u8003\u9ed8\u8ba4\u56fe\u6807\u7684\u5927\u5c0f\uff0c\u6765\u5207App\u7684\u56fe\u6807\u3002\u5982\u679c\u8981\u7701\u4e8b\uff0c\u53ef\u4ee5\u7528\u4e00\u4e2a\u56fe\u6807\u590d\u5236\u8fdb\u5404\u4e2a\u76ee\u5f55\u4e2d\u3002 layout/ \u7528\u4e8e\u5b9a\u4e49\u7528\u6237\u754c\u9762\u5e03\u5c40\u7684 XML \u6587\u4ef6\u3002\u653elayout\u6587\u4ef6\u3002 menu/ \u7528\u4e8e\u5b9a\u4e49\u5e94\u7528\u83dc\u5355\uff08\u5982\u9009\u9879\u83dc\u5355\u3001\u4e0a\u4e0b\u6587\u83dc\u5355\u6216\u5b50\u83dc\u5355\uff09\u7684 XML \u6587\u4ef6\u3002 raw/ \u9700\u4ee5\u539f\u59cb\u5f62\u5f0f\u4fdd\u5b58\u7684\u4efb\u610f\u6587\u4ef6\u3002\u5982\u8981\u4f7f\u7528\u539f\u59cb InputStream \u6253\u5f00\u8fd9\u4e9b\u8d44\u6e90\uff0c\u8bf7\u4f7f\u7528\u8d44\u6e90 ID\uff08\u5373 R.raw.filename\uff09\u8c03\u7528 Resources.openRawResource()\u3002 \u4f46\u662f\uff0c\u5982\u9700\u8bbf\u95ee\u539f\u59cb\u6587\u4ef6\u540d\u548c\u6587\u4ef6\u5c42\u6b21\u7ed3\u6784\uff0c\u5219\u53ef\u4ee5\u8003\u8651\u5c06\u67d0\u4e9b\u8d44\u6e90\u4fdd\u5b58\u5728 assets/ \u76ee\u5f55\uff08\u800c\u975e res/raw/\uff09\u4e0b\u3002assets/ \u4e2d\u7684\u6587\u4ef6\u6ca1\u6709\u8d44\u6e90 ID\uff0c\u56e0\u6b64\u60a8\u53ea\u80fd\u4f7f\u7528 AssetManager \u8bfb\u53d6\u8fd9\u4e9b\u6587\u4ef6\u3002 values/ \u5305\u542b\u5b57\u7b26\u4e32\u3001\u6574\u578b\u6570\u548c\u989c\u8272\u7b49\u7b80\u5355\u503c\u7684 XML \u6587\u4ef6\u3002\u5176\u4ed6 res/ \u5b50\u76ee\u5f55\u4e2d\u7684 XML \u8d44\u6e90\u6587\u4ef6\u4f1a\u6839\u636e XML \u6587\u4ef6\u540d\u5b9a\u4e49\u5355\u4e2a\u8d44\u6e90\uff0c\u800c values/ \u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u53ef\u63cf\u8ff0\u591a\u4e2a\u8d44\u6e90\u3002\u5bf9\u4e8e\u6b64\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\uff0c \u5143\u7d20\u7684\u6bcf\u4e2a\u5b50\u5143\u7d20\u5747\u4f1a\u5b9a\u4e49\u4e00\u4e2a\u8d44\u6e90\u3002\u4f8b\u5982\uff0c \u5143\u7d20\u4f1a\u521b\u5efa R.string \u8d44\u6e90\uff0c \u5143\u7d20\u4f1a\u521b\u5efa R.color \u8d44\u6e90\u3002\u7531\u4e8e\u6bcf\u4e2a\u8d44\u6e90\u5747\u4f7f\u7528\u81ea\u5df1\u7684 XML \u5143\u7d20\u8fdb\u884c\u5b9a\u4e49\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u968f\u610f\u547d\u540d\u6587\u4ef6\uff0c\u5e76\u5728\u67d0\u4e2a\u6587\u4ef6\u4e2d\u653e\u5165\u4e0d\u540c\u7684\u8d44\u6e90\u7c7b\u578b\u3002\u4f46\u662f\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u5c06\u72ec\u7279\u7684\u8d44\u6e90\u7c7b\u578b\u653e\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u4e2d\uff0c\u4f7f\u5176\u4e00\u76ee\u4e86\u7136\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e\u53ef\u5728\u6b64\u76ee\u5f55\u4e2d\u521b\u5efa\u7684\u8d44\u6e90\uff0c\u4e0b\u9762\u7ed9\u51fa\u4e86\u76f8\u5e94\u7684\u6587\u4ef6\u540d\u7ea6\u5b9a\uff1aarrays.xml\uff1a\u8d44\u6e90\u6570\u7ec4\uff08\u7c7b\u578b\u6570\u7ec4\uff09\u3002colors.xml\uff1a\u989c\u8272\u503c\u3002dimens.xml\uff1a\u5c3a\u5bf8\u503c\u3002strings.xml\uff1a\u5b57\u7b26\u4e32\u503c\u3002styles.xml\uff1a\u6837\u5f0f\u3002 xml/ \u53ef\u5728\u8fd0\u884c\u65f6\u901a\u8fc7\u8c03\u7528 Resources.getXML() \u8bfb\u53d6\u7684\u4efb\u610f XML \u6587\u4ef6\u3002\u5404\u79cd XML \u914d\u7f6e\u6587\u4ef6\uff08\u5982\u53ef\u641c\u7d22\u914d\u7f6e\uff09\u90fd\u5fc5\u987b\u4fdd\u5b58\u5728\u6b64\u5904\u3002 font/ \u5e26\u6709\u6269\u5c55\u540d\u7684\u5b57\u4f53\u6587\u4ef6\uff08\u5982 .ttf\u3001.otf \u6216 .ttc\uff09\uff0c\u6216\u5305\u542b  \u5143\u7d20\u7684 XML \u6587\u4ef6\u3002 <p>\u6ce8\u610f\uff1a\u5207\u52ff\u5c06\u8d44\u6e90\u6587\u4ef6\u76f4\u63a5\u4fdd\u5b58\u5728 res/ \u76ee\u5f55\u5185\uff0c\u56e0\u4e3a\u8fd9\u6837\u4f1a\u9020\u6210\u7f16\u8bd1\u9519\u8bef\u3002</p> <p>\u6700\u5f00\u59cb\u9636\u6bb5\uff0c\u6211\u4eec\u63a5\u89e6\u6bd4\u8f83\u591a\u7684\u662f<code>layout</code>\u76ee\u5f55\u3002\u5982\u679c\u8981\u6dfb\u52a0\u4e00\u4e9b\u56fe\u7247\uff0c\u53ef\u4ee5\u76f4\u63a5\u653e\u8fdb<code>drawable</code>\u76ee\u5f55\u3002 \u5173\u4e8e<code>drawable</code>\u76ee\u5f55\uff0c\u53ef\u4ee5\u53c2\u8003drawable shape\u7684\u7ed8\u5236\u548c\u4f7f\u7528\u3002</p> <p>\u4fee\u6539\u5e94\u7528\u56fe\u6807\uff0c\u5e94\u8be5\u653e\u8fdb<code>mipmap</code>\u5bf9\u5e94\u7684\u76ee\u5f55\u3002\u4f8b\u5982<code>mipmap-hdpi</code>\u91cc\u7684\u56fe\u6807\u662f72x72\u50cf\u7d20\u7684,<code>mipmap-mdpi</code>\u662f48x48\u50cf\u7d20\u7684\u3002 \u56fe\u7701\u4e8b\u7684\u8bdd\uff0c\u62ff\u4e00\u4e2a\u56fe\u6807\uff0c\u5206\u522b\u590d\u5236\u8fdbmipmap\u7684\u6240\u6709dpi\u76ee\u5f55\u91cc\uff0c\u4e00\u5b9a\u8981\u7edf\u4e00\u6587\u4ef6\u540d\uff0c\u6bd4\u5982<code>ic_your_launcher.png</code>\u3002 \u7136\u540e\u5728\u6e05\u5355\u6587\u4ef6<code>AndroidManifest.xml</code>\u4e2d\uff0c\u4fee\u6539icon\u3002 <pre><code> &lt;application\n        android:icon=\"@mipmap/ic_your_launcher\"\n</code></pre></p> <p>\u540e\u9762\u5982\u679c\u6211\u4eec\u8981\u5b9a\u4e49Button\uff0cTextView\u7684\u4e00\u4e9b\u6837\u5f0f\uff0c\u6bd4\u5982\u8bbe\u7f6e\u989c\u8272\uff0c\u80cc\u666f\u3002\u4f1a\u63a5\u89e6\u5230<code>drawable</code>\u76ee\u5f55\u3002</p> <p>\u53c2\u8003\u6587\u6863\u5e94\u7528\u8d44\u6e90\u6982\u89c8</p>"},{"location":"android/resource/adjust/app-res-adapt-multi-language/","title":"Android \u591a\u8bed\u8a00\u81ea\u52a8\u9002\u914d","text":"<p>Android\u4e3a\u591a\u8bed\u8a00\u9002\u914d\u63d0\u4f9b\u4e86\u5f88\u5927\u7684\u65b9\u4fbf\u3002\u5f00\u53d1\u8005\u4e0d\u9700\u8981\u5728\u4ee3\u7801\u4e2d\u8fdb\u884c\u4fee\u6539\u3002\u53ea\u9700\u8981\u914d\u7f6exml\u6587\u4ef6\u3002</p> <p>res --&gt; values \u5176\u4e2d\u5b58\u653e\u6709xml\u6587\u4ef6\u3002\u4e00\u822c\u8fd9\u4e9b\u90fd\u662f\u82f1\u6587\u7684\u5b57\u7b26\u4e32\u3002\u6211\u4eec\u53ef\u4ee5\u5b58\u653e\u5176\u4ed6\u8bed\u8a00\u7684\u5b57\u7b26\u4e32\u3002</p> <p>\u53e6\u4e00\u8bed\u79cd\u7684\u5b57\u7b26\u4e32\u6587\u4ef6\u653e\u5728\u53e6\u5916\u7684\u6587\u4ef6\u5939\u4e0b\u3002\u6587\u4ef6\u5939\u547d\u540d\u89c4\u5219\u4e3a\uff1a <code>values-##-r**</code></p> <p>\u4f8b\u5982: <code>values-zh-rCN</code></p> <p>\u5176\u4e2d##\u8868\u793a\u8bed\u8a00\u4ee3\u53f7\uff08language codes\uff09\uff0c**\u8868\u793a\u56fd\u5bb6\u4ee3\u53f7\uff08country codes\uff09\uff0c\u4e5f\u53ef\u4ee5\u53ea\u6709\u8bed\u8a00\u4ee3\u53f7\u3002</p> <p>\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ul> <li>1.\u5728res\u6587\u4ef6\u5939\u4e0b\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6\u5939\uff0c\u547d\u540d\u4e3a<code>values-zh-rCN</code></li> <li>2.\u5728<code>values-zh-rCN</code>\u6587\u4ef6\u5939\u4e2d\u65b0\u5efa\u4e00\u4e2a<code>string.xml</code>\u6587\u4ef6\uff0c\u91cc\u9762\u5b58\u653e\u7684\u662f\u7a0b\u5e8f\u4e2d\u7528\u5230\u7684\u5b57\u7b26\u4e32\u3002</li> </ul>"},{"location":"android/resource/adjust/app-res-adapt-screen-size/","title":"\u5c4f\u5e55\u9002\u914d","text":""},{"location":"android/resource/adjust/app-res-adapt-screen-size/#smallest-width","title":"\u6700\u5c0f\u5bbd\u5ea6\uff08Smallest-width\uff09\u9650\u5b9a\u7b26","text":"<p>\u4f8b\u5b50\uff1a\u6bd4\u5982\u8bf4large\u540c\u65f6\u5305\u542b\u77405\u5bf8\u548c7\u5bf8\uff0c\u8fd9\u610f\u5473\u7740\u4f7f\u7528\u201clarge\u201d\u9650\u5b9a\u7b26\u7684\u8bdd\u6211\u6ca1\u529e\u6cd5\u5b9e\u73b0\u4e3a5\u5bf8\u548c7\u5bf8\u7684\u5e73\u677f\u7535\u8111\u5206\u522b\u52a0\u8f7d\u4e0d\u540c\u7684\u5e03\u5c40</p> <p>\u4e8e\u662f\uff0c\u5728Android 3.2\u53ca\u4e4b\u540e\u7248\u672c\uff0c\u5f15\u5165\u4e86\u6700\u5c0f\u5bbd\u5ea6\uff08Smallest-width\uff09\u9650\u5b9a\u7b26</p> <p>\u5b9a\u4e49\uff1a\u901a\u8fc7\u6307\u5b9a\u67d0\u4e2a\u6700\u5c0f\u5bbd\u5ea6\uff08\u4ee5 dp \u4e3a\u5355\u4f4d\uff09\u6765\u7cbe\u786e\u5b9a\u4f4d\u5c4f\u5e55\u4ece\u800c\u52a0\u8f7d\u4e0d\u540c\u7684UI\u8d44\u6e90</p>"},{"location":"android/resource/adjust/app-res-adapt-screen-size/#_2","title":"\u4f7f\u7528\u573a\u666f","text":"<p>\u9700\u8981\u4e3a\u6807\u51c6 7 \u82f1\u5bf8\u5e73\u677f\u7535\u8111\u5339\u914d\u53cc\u9762\u677f\u5e03\u5c40\uff08\u5176\u6700\u5c0f\u5bbd\u5ea6\u4e3a 600 dp\uff09\uff0c\u5728\u624b\u673a\uff08\u8f83\u5c0f\u7684\u5c4f\u5e55\u4e0a\uff09\u5339\u914d\u5355\u9762\u677f\u5e03\u5c40</p> <p>\u53ef\u4f7f\u7528 sw600dp \u6307\u660e\u53cc\u9762\u677f\u5e03\u5c40\u4ec5\u9002\u7528\u4e8e\u6700\u5c0f\u5bbd\u5ea6\u4e3a 600 dp \u7684\u5c4f\u5e55\uff0c\u800c\u4e0d\u662f\u4f7f\u7528 large \u5c3a\u5bf8\u9650\u5b9a\u7b26\u3002</p> <p>sw xxxdp\uff0c\u5373small width\u7684\u7f29\u5199\uff0c\u5176\u4e0d\u533a\u5206\u65b9\u5411\uff0c\u5373\u65e0\u8bba\u662f\u5bbd\u5ea6\u8fd8\u662f\u9ad8\u5ea6\uff0c\u53ea\u8981\u5927\u4e8e xxxdp\uff0c\u5c31\u91c7\u7528\u6b21\u6b64\u5e03\u5c40\u3002</p> <p>\u4f8b\u5b50\uff1a\u4f7f\u7528\u4e86layout-sw600dp\u7684\u6700\u5c0f\u5bbd\u5ea6\u9650\u5b9a\u7b26\uff0c\u5373\u65e0\u8bba\u662f\u5bbd\u5ea6\u8fd8\u662f\u9ad8\u5ea6\uff0c\u53ea\u8981\u5927\u4e8e600dp\uff0c\u5c31\u91c7\u7528<code>layout-sw600dp</code>\u76ee\u5f55\u4e0b\u7684\u5e03\u5c40</p>"},{"location":"android/resource/drawable/shape-dotted-line/","title":"\u4f7f\u7528shape\u6765\u7ed8\u5236\u865a\u7ebf","text":"<p>\u9700\u8981stroke\u8bbe\u7f6e<code>android:dashGap</code>\u5c5e\u6027\u3002</p> <p><code>shape_dash_line_uf.xml</code> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;shape xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:shape=\"line\"&gt;\n    &lt;size android:height=\"1dp\" /&gt;\n    &lt;stroke\n        android:width=\"1dp\"\n        android:color=\"#474c57\"\n        android:dashWidth=\"1dp\"\n        android:dashGap=\"2dp\" /&gt;\n&lt;/shape&gt;\n</code></pre></p> <p>\u5173\u6389activity\u7684\u786c\u4ef6\u52a0\u901f<code>android:hardwareAccelerated=\"false\"</code>\uff0c\u5426\u5219\u4f1a\u663e\u793a\u4e00\u6761\u76f4\u7ebf\u3002 <pre><code>&lt;activity\n    android:name=\"com.rustfisher.basic4.UserFeedbackAct\"\n    android:hardwareAccelerated=\"false\"\n    android:screenOrientation=\"portrait\"&gt;\n\n&lt;/activity&gt;\n</code></pre></p> <p>layout\u4e2d\u4f7f\u7528\u3002\u628ashape\u8bbe\u7f6e\u4e3a\u80cc\u666f\u3002\u5e76\u4e14View\u7684\u9ad8\u5ea6\u8bbe\u7f6e\u4e3a0dp\u3002 <pre><code>&lt;View\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"0dp\"\n    android:layout_weight=\"1\"\n    android:background=\"@drawable/shape_dash_line_uf\" /&gt;\n</code></pre></p>"},{"location":"android/resource/font/app-use-other-font/","title":"Android\u4f7f\u7528\u7b2c\u4e09\u65b9\u5b57\u4f53","text":"<p>\u5b57\u4f53\u8d44\u6e90\u6587\u4ef6 <pre><code>res/font/\n        circular_pro_bold.otf\n        pangmenzhegndao_2.ttf\n</code></pre></p> <p>\u4ee3\u7801\u4e2d\u52a0\u8f7d\u5e76\u4f7f\u7528\u5b57\u4f53 <pre><code>Typeface cirTf = ResourcesCompat.getFont(TachApplication.getInstance(), R.font.circular_pro_bold);\nTypeface pangMenTf = ResourcesCompat.getFont(TachApplication.getInstance(), R.font.circular_pro_bold);\nTextView udroneTv = root.findViewById(R.id.udrone_tv);\nTextView umlTv = root.findViewById(R.id.uml_tv);\nudroneTv.setTypeface(cirTf);\numlTv.setTypeface(cirTf);\nmUserFeedbackTv.setTypeface(pangMenTf);\n</code></pre></p> <p>\u53c2\u8003</p> <p>https://stackoverflow.com/questions/27588965/how-to-use-custom-font-in-a-project-written-in-android-studio</p>"},{"location":"android/rtfsc/Android-Context/","title":"\u8ba4\u8bc6 Android Context","text":"<p>Android L</p> <p>app\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528app\u7684\u8d44\u6e90\uff0c\u6bd4\u5982\u6587\u5b57\u3001\u56fe\u7247\uff0cActivity\u3001Service\u6216\u8005broadcastReceiver\u7b49\u7b49\u3002\u65f6\u5e38\u4e5f\u4f1a\u7528\u5230<code>getApplicationContext()</code>\u6765\u83b7\u53d6\u4e00\u4e2aContext\u5bf9\u8c61\u3002\u90a3\u4e48\u8fd9\u4e2aContext\u5230\u5e95\u662f\u4ec0\u4e48\u5462\uff1f</p> <p>\u6211\u4eec\u4e00\u8d77\u6765\u8ba4\u8bc6\u4e00\u4e0bAndroid\u4e2d\u7684Context\u3002</p>"},{"location":"android/rtfsc/Android-Context/#context","title":"<code>Context</code>\u7c7b\u7b80\u4ecb","text":"<p>context\u542b\u4e49\u6709\u8bed\u5883\uff0c\u4e0a\u4e0b\u6587\uff0c\u80cc\u666f\uff0c\u73af\u5883\u7b49\u7b49\u3002 Context\u662f\u7ef4\u6301Android\u7a0b\u5e8f\u4e2d\u5404\u7ec4\u4ef6\u80fd\u591f\u6b63\u5e38\u5de5\u4f5c\u7684\u4e00\u4e2a\u6838\u5fc3\u529f\u80fd\u7c7b\u3002</p> <p><code>Context</code>\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\u3002\u5b83\u662f\u4e00\u4e2a app \u5168\u5c40\u73af\u5883\u7684\u201c\u63a5\u53e3\u201d\uff0c\u7531 Android \u7cfb\u7edf\u63d0\u4f9b\u7ee7\u627f\u7c7b\uff08\u4f8b\u5982Activity\u3001Service\u3001Application\u7b49\uff09\u3002\u5b83\u80fd\u8fde\u63a5\u5230\u5e94\u7528\u7684\u8d44\u6e90\uff0c\u4e5f\u80fd\u4f7f\u7528\u5e94\u7528\u7ea7\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u542f\u52a8activity\uff0c\u5e7f\u64ad\u548c\u63a5\u6536intent\u3002</p> <p>\u5e94\u7528\u7a0b\u5e8f\u4e2dContext\u7684\u603b\u6570\u76ee\u4e3a\uff1a \u603bContext\u4e2a\u6570 = Activity\u4e2a\u6570 + Service\u4e2a\u6570 + 1\uff08Application Context\uff09</p>"},{"location":"android/rtfsc/Android-Context/#context_1","title":"<code>Context</code>\u7684\u5b50\u7c7b","text":""},{"location":"android/rtfsc/Android-Context/#_1","title":"\u7b80\u5355\u7684\u7ee7\u627f\u5173\u7cfb\u793a\u610f","text":"<pre><code>Context\n\u251c\u2500\u2500 ContextImpl\n\u2514\u2500\u2500 ContextWrapper\n    \u251c\u2500\u2500 Application\n    \u251c\u2500\u2500 ContextThemeWrapper\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 Activity\n    \u2514\u2500\u2500 Service\n</code></pre> <p>\u4ece\u7ee7\u627f\u5173\u7cfb\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0cApplication\u7c7b\u3001Service\u7c7b\u548cActivity\u7c7b\u90fd\u7ee7\u627f\u4e86Context\u7c7b\u3002\u5e94\u7528\u7a0b\u5e8f\u88ab\u542f\u52a8\u540e\uff0c\u4f1a\u4e3a\u5e94\u7528\u7a0b\u5e8f\u521b\u5efa\u4e00\u4e2a\u5168\u5c40\u7684Application\u5bf9\u5e94\u7684Context\u5bf9\u8c61\u3002ContextImpl\u7c7b\u662fContext\u7684\u771f\u6b63\u5b9e\u73b0\u3002ContextWrapper\u7c7b\u662f\u5c01\u88c5\u7c7b\u3002\u53ef\u4ee5\u5728\u4e0d\u6539\u53d8ContextImpl\u7684\u60c5\u51b5\u4e0b\uff0c\u4e3a\u5176\u589e\u52a0\u4e00\u4e9b\u81ea\u5b9a\u4e49\u64cd\u4f5c\u3002ContextWrapper\u4e2d\u7684mBase\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2aContextImpl\u5bf9\u8c61\u3002\u800cContextImpl\u7c7b\u4e2d\u7684mOuterContext\u662f\u4e00\u4e2aContext\u5bf9\u8c61\uff0c\u6307\u5411\u76f8\u5bf9\u5e94\u7684Activity\u6216Service\u6216Application\u3002</p>"},{"location":"android/rtfsc/Android-Context/#contextimpl","title":"ContextImpl","text":"<p><code>Context</code> \u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u5b50\u7c7b <code>ContextImpl</code> \u5b9e\u73b0\u4e86<code>Context</code>\u7684\u65b9\u6cd5\uff1b\u4e3aActivity\u548c\u5176\u4ed6\u5e94\u7528\u7ec4\u4ef6\u63d0\u4f9b\u57fa\u672c\u7684context\u5bf9\u8c61\u3002 ContextImpl.java (frameworks\\base\\core\\java\\android\\app)</p> <pre><code>/**\n * Common implementation of Context API, which provides the base\n * context object for Activity and other application components.\n */\nclass ContextImpl extends Context { /*...*/ }\n</code></pre>"},{"location":"android/rtfsc/Android-Context/#contextwrapper","title":"ContextWrapper","text":"<p>Wrapper \u6709\u5c01\u88c5\u7684\u610f\u601d\uff1b<code>ContextWrapper</code>\u662fContext\u7684\u5c01\u88c5\u7c7b \u3002\u8fd9\u91cc\u4f7f\u7528\u4e86\u88c5\u9970\u8005\u6a21\u5f0f\uff0c\u6784\u9020\u65b9\u6cd5\u4e2d\u4f20\u5165\u4e86\u4e00\u4e2aContext \u5b9e\u4f8b\u3002<code>ContextWrapper</code>\u6301\u6709<code>ContextImpl</code>\u5bf9\u8c61\u3002\u53ef\u4ee5\u5728\u4e0d\u6539\u53d8<code>ContextImpl</code>\u7684\u60c5\u51b5\u4e0b\u589e\u52a0\u4e00\u4e9b\u64cd\u4f5c\u3002</p> <p>ContextWrapper.java (frameworks\\base\\core\\java\\android\\content) <pre><code>/**\n * Proxying implementation of Context that simply delegates all of its calls to\n * another Context.  Can be subclassed to modify behavior without changing\n * the original Context.\n */\npublic class ContextWrapper extends Context {\n    Context mBase;\n\n    public ContextWrapper(Context base) {\n        mBase = base;\n    }\n    // ...\n}\n</code></pre> \u5177\u4f53\u64cd\u4f5c\u4e2d\uff0cApplication\u7c7b\u3001Activity\u548cService\u7c7b\u4e0e<code>ContextImpl</code>\u4ea7\u751f\u4ea4\u96c6\u3002</p>"},{"location":"android/rtfsc/Android-Context/#contextthemewrapper","title":"ContextThemeWrapper","text":"<p>\u5141\u8bb8\u5728\u5c01\u88c5\u7684context\u4e2d\u4fee\u6539\u4e3b\u9898\uff08theme\uff09</p> <p>ContextThemeWrapper.java (frameworks\\base\\core\\java\\android\\view)</p> <p><pre><code>/**\n * A ContextWrapper that allows you to modify the theme from what is in the\n * wrapped context.\n */\npublic class ContextThemeWrapper extends ContextWrapper { /* ... */ }\n</code></pre> \u5176\u4e2d\u63d0\u4f9b\u4e86\u5173\u4e8etheme\u7684\u65b9\u6cd5\uff0capp\u5f00\u53d1\u4e2d <code>android:theme</code> \u4e0e\u6b64\u6709\u5173\u3002\u76f8\u540c\u7684\u4ee3\u7801\uff0c\u76f8\u540c\u7684\u8c03\u7528\uff0c\u4f7f\u7528\u4e0d\u540c\u7684 theme \u4f1a\u6709\u4e0d\u540c\u7684\u6548\u679c\u3002</p>"},{"location":"android/rtfsc/Android-Context/#getapplicationcontext-getbasecontext","title":"getApplicationContext() \u548c getBaseContext()","text":"<pre><code>public class ContextWrapper extends Context {\n    Context mBase;\n    ......\n    @Override\n    public Context getApplicationContext() {\n        return mBase.getApplicationContext();\n    }\n    ......\n    /**\n     * @return the base context as set by the constructor or setBaseContext\n     */\n    public Context getBaseContext() {\n        return mBase;// Don't use getBaseContext(), just use the Context you have.\n    }\n    ......\n}\n</code></pre> <p><pre><code>getApplicationContext() = android.app.Application@39d42b0e\ngetBaseContext() = android.app.ContextImpl@1f48c92f\n</code></pre> getApplicationContext() \u4eceapplication\u53d6\u5f97context\u3002getBaseContext() \u4ece\u5b9e\u73b0\u7c7bContextImpl\u90a3\u5f97\u6765\u3002</p>"},{"location":"android/rtfsc/Android-Context/#context_2","title":"Context\u5b50\u7c7b\u521b\u5efa\u6d41\u7a0b","text":""},{"location":"android/rtfsc/Android-Context/#application","title":"Application\u7684\u521b\u5efa\u6d41\u7a0b","text":"<p>\u6211\u4eec\u628a\u5173\u6ce8\u70b9\u5148\u653e\u5728application\u4e0a\uff0c\u6682\u65f6\u5ffd\u7565\u6e90\u7801\u4e2d\u7684\u5176\u4ed6\u4fe1\u606f\u3002</p> <p>\u6d41\u7a0b\u63cf\u8ff0\uff1a</p> <p><code>LoadedApk</code>\u5148\u901a\u8fc7<code>classLoader</code>\u7684<code>loadClass(className)</code>\u83b7\u53d6application\u7684<code>class</code>\uff0c\u518d\u901a\u8fc7<code>clazz.newInstance()</code>\u521b\u5efa<code>Application</code>\u5b9e\u4f8b\u3002\u63a5\u7740\u8c03\u7528<code>app.attach(context)</code>\u65b9\u6cd5\u5b8c\u6210\u521d\u59cb\u5316\u3002 Application\u7684attach\u65b9\u6cd5\u91cc\u8c03\u7528\u4e86\u81ea\u5df1\u7684<code>attachBaseContext(context)</code>, \u628a\u7b2c\u4e00\u6b65\u521b\u5efa\u7684<code>ContextImpl</code>\u5b9e\u4f8b\u8d4b\u503c\u7ed9<code>ContextWrapper</code>\u7684<code>mBase</code>\u6210\u5458\u53d8\u91cf\u3002 \u5230\u6b64Application\u5b9e\u4f8b\u521b\u5efa\u5c31\u5b8c\u6210\u4e86\u3002</p>"},{"location":"android/rtfsc/Android-Context/#activity-performlaunchactivity","title":"Activity\u7684\u521b\u5efa - performLaunchActivity","text":"<p>\u8fd9\u91cc\u5173\u6ce8\u7684\u662fActivity\u7684\u5b9e\u4f8b\u5316\u4ee5\u53ca\u4e4b\u524d\u7684\u4e00\u4e9b\u51c6\u5907\u8fc7\u7a0b\u3002</p> <p>\u6d41\u7a0b\u7b80\u6790\uff1a</p> <p>\u4e3b\u8981\u5173\u6ce8<code>ActivityThread</code>\u7684<code>performLaunchActivity</code>\u65b9\u6cd5\u3002\u901a\u8fc7<code>ContextImpl</code>\u7684<code>createActivityContext</code>\u83b7\u5f97\u4e00\u4e2aContextImpl\u5b9e\u4f8b\uff0c\u79f0\u4e3a<code>appContext</code>\u3002<code>Instrumentation</code>\u7684<code>newActivity</code>\u8fd4\u56de\u4e86\u4e00\u4e2aActivity\u5b9e\u4f8b\u3002<code>LoadedApk.makeApplication</code>\u53ef\u4ee5\u83b7\u5f97\u5f53\u524d\u7684application\uff0c\u5982\u679c\u5f53\u524d\u6ca1\u6709\u5219\u65b0\u5efa\u4e00\u4e2aapplication\u3002\u6700\u540e\u901a\u8fc7<code>ContextImpl.setOuterContext</code>\u548cActivity\u7684<code>attach</code>\u65b9\u6cd5\uff0c\u5c06ContextImpl\u5b9e\u4f8b\u4e0eActivity\u5b9e\u4f8b\u5173\u8054\u5230\u4e00\u8d77\u3002</p>"},{"location":"android/rtfsc/Android-Context/#_2","title":"\u4f7f\u7528","text":""},{"location":"android/rtfsc/Android-Context/#application_1","title":"\u81ea\u5b9a\u4e49Application","text":"<p>\u65b0\u5efa\u4e00\u4e2aMyApplication\u7c7b\uff0c\u7ee7\u627f\u81eaApplication <pre><code>import android.app.Application;\nimport android.content.Context;\n\npublic class MyApplication extends Application {\n    private static Context context;\n\n    public static Context getMyContext() {\n        return context;\n    }\n\n    @Override\n    public void onCreate() {\n        super.onCreate();\n        context = getApplicationContext();\n    }\n}\n</code></pre> \u5728Manifest\u4e2d\u4f7f\u7528MyApplication\uff1b <pre><code>    &lt;application\n        android:name=\"com.rust.aboutview.MyApplication\"\n        android:allowBackup=\"true\"\n        android:icon=\"@mipmap/ic_launcher\"\n        android:label=\"@string/app_name\"\n        android:supportsRtl=\"true\"\n        android:theme=\"@style/AppTheme\"&gt;\n    ......\n</code></pre> \u5373\u53ef\u5728\u4e0d\u540c\u7684\u5730\u65b9\u8c03\u7528 getMyContext() \u65b9\u6cd5 <pre><code>MyApplication.getMyContext()\n</code></pre></p>"},{"location":"android/rtfsc/Android-Context/#_3","title":"\u53c2\u8003","text":"<p>http://blog.csdn.net/yanbober/article/details/45967639</p> <p>https://xujiaojie.github.io/2017/09/18/%E5%AE%8C%E5%85%A8%E5%89%96%E6%9E%90Android%E4%B8%8A%E4%B8%8B%E6%96%87%E7%8E%AF%E5%A2%83Context/</p> <p>https://xujiaojie.github.io/2017/09/18/%E5%AE%8C%E5%85%A8%E5%89%96%E6%9E%90Android%E4%B8%8A%E4%B8%8B%E6%96%87%E7%8E%AF%E5%A2%83Context/</p> <p>https://juejin.im/post/5c37f402e51d4552411ac0a0</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u6398\u91d1</p>"},{"location":"android/rtfsc/Android_SparseArray_src_code_note/","title":"Android SparseArray \u539f\u7406\u89e3\u6790","text":"<p>\u4ec0\u4e48\u662fSparseArray\uff1f\u5b83\u7684\u5185\u90e8\u5b9e\u73b0\u91c7\u7528\u4e86\u4ec0\u4e48\u6570\u636e\u7ed3\u6784\uff1fSparseArray\u76f8\u6bd4\u4e8eHashMap\u7684\u4f18\u52a3\u52bf\u662f\u4ec0\u4e48\uff1f</p>"},{"location":"android/rtfsc/Android_SparseArray_src_code_note/#sparsearray","title":"\u4ec0\u4e48\u662fSparseArray\uff1f","text":"<p>SparseArray\u5b58\u50a8\u7684\u662f\u952e\u503c\u5bf9\uff0c\u4ee5int\u4f5c\u4e3akey\uff0cObject\u4f5c\u4e3avalue\u3002Sparse\u6709\u7a00\u758f\u3001\u7f3a\u5c11\u7684\u610f\u601d\u3002SparseArray\u5e94\u7528\u573a\u666f\u662f\u76f8\u5bf9\u7a00\u5c11\u7684\u6570\u636e\uff0c\u4e00\u822c\u662f\u51e0\u767e\u4ee5\u5185\u3002</p>"},{"location":"android/rtfsc/Android_SparseArray_src_code_note/#sparsearray_1","title":"SparseArray\u91c7\u7528\u7684\u6570\u636e\u7ed3\u6784\uff1f","text":"<p>SparseArray\u5e76\u4e0d\u50cfHashMap\u91c7\u7528\u4e00\u7ef4\u6570\u7ec4+\u5355\u94fe\u8868\u548c\u4e8c\u53c9\u6811\u7ed3\u6784\uff0c\u800c\u662f\u91c7\u7528\u4e24\u4e2a\u4e00\u7ef4\u6570\u7ec4\uff0c\u4e00\u4e2a\u662f\u5b58\u50a8key(int\u7c7b\u578b),\u4e00\u4e2a\u662f\u5b58value object\u3002</p> <pre><code>    private int[] mKeys; // \u5b58\u50a8key\n    private Object[] mValues; // \u5b58\u50a8value\u5bf9\u8c61\n    private int mSize; // \u8bb0\u5f55\u5b58\u50a8\u952e\u503c\u5bf9\u7684\u6570\u91cf\n</code></pre> <p>mKeys\u548cmValues\u8bfb\u5199\u65f6\u91c7\u7528\u7684\u4e0b\u6807\u662f\u4e00\u4e00\u5bf9\u5e94\u7684\u3002</p>"},{"location":"android/rtfsc/Android_SparseArray_src_code_note/#sparsearray_2","title":"SparseArray\u9ed8\u8ba4\u5bb9\u91cf\u591a\u5927\uff1f","text":"<p>SparseArray\u5728\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u4e2d\u6307\u5b9a\u5176\u9ed8\u8ba4\u5bb9\u91cf\u5927\u5c0f\u3002\u9ed8\u8ba4\u4e3a10</p> <p>\u521d\u59cb\u5316\u540e<code>mSize = 0</code>\uff0c\u5b9e\u4f8b\u5316mKeys\u548cmValues\u3002</p>"},{"location":"android/rtfsc/Android_SparseArray_src_code_note/#sparsearray-get","title":"SparseArray get\u65b9\u6cd5\u7684\u6d41\u7a0b\u5206\u6790","text":"<p>\u8f93\u5165\u4e00\u4e2aint\u578b\u7684key\uff0c\u901a\u8fc7\u4e8c\u5206\u6cd5\u67e5\u627e\u5339\u914d\u7684\u4e0b\u6807\u3002\u82e5\u6ca1\u627e\u5230\u5bf9\u5e94\u7684\u4e0b\u6807\uff0c\u5219\u8fd4\u56denull\u6216\u7528\u6237\u6307\u5b9a\u7684\u9ed8\u8ba4\u5bf9\u8c61\u3002</p> <p>key\u662f\u9012\u589e\u5b58\u653e\u7684\u3002\u4e8c\u5206\u6cd5\u67e5\u627e\u4e0b\u6807\u65f6\uff0c\u53ef\u80fd\u4f1a\u8fd4\u56de\u4e00\u4e2a\u8d1f\u503c\uff0c\u6b64\u65f6\u8868\u793a\u5728mKeys\u4e2d\u6ca1\u627e\u5230\u5bf9\u5e94\u7684\u952e\u3002</p> <pre><code>    public E get(int key) {\n        return get(key, null);\n    }\n\n    /**\n     * Gets the Object mapped from the specified key, or the specified Object\n     * if no such mapping has been made.\n     */\n    @SuppressWarnings(\"unchecked\")\n    public E get(int key, E valueIfKeyNotFound) {\n        int i = ContainerHelpers.binarySearch(mKeys, mSize, key); // \u4e8c\u5206\u6cd5\u67e5\u627e\u4e0b\u6807\n\n        if (i &lt; 0 || mValues[i] == DELETED) { \n        // \u627e\u5230\u7684\u4e0b\u6807\u4e3a\u8d1f\u6216\u5f53\u524d\u4f4d\u7f6e\u5143\u7d20\u4ee5\u88ab\u5220\u9664\uff0c\u8868\u660e\u6ca1\u627e\u5230\n            return valueIfKeyNotFound;\n        } else {\n            return (E) mValues[i]; // \u627e\u5230\u6307\u5b9a\u5143\u7d20\n        }\n    }\n</code></pre>"},{"location":"android/rtfsc/Android_SparseArray_src_code_note/#sparsearray-put","title":"SparseArray put\u65b9\u6cd5\u7684\u6d41\u7a0b\u5206\u6790","text":"<pre><code>public void put(int key, E value) {\n       // \u4e8c\u5206\u6cd5\u627e\u5230key\u7684\u4e0b\u6807\n        int i = ContainerHelpers.binarySearch(mKeys, mSize, key);\n\n        if (i &gt;= 0) {\n            // \u4ee3\u8868\u5f53\u524d\u5df2\u7ecf\u5b58\u5728key\u53ca\u5176\u5bf9\u5e94\u7684\u503c\uff0c\u76f4\u63a5\u66ff\u6362value\n            mValues[i] = value;\n        } else {\n            // \u8868\u793a\u5f53\u524d\u5e76\u4e0d\u5b58\u5728key\uff0c\u5219\u5e94\u6dfb\u52a0\u65b0\u7684\u952e\u503c\u5bf9\n            // i\u53d6\u53cd\uff0c\u5f97\u5230\u8981\u6dfb\u52a0\u7684\u6570\u7ec4\u4f4d\u7f6e\u4e0b\u6807\u3002\u4e8c\u53c9\u67e5\u627e\u8fd4\u56de\u7684\u662fkey\u7684\u201c\u5e94\u5f53\u201d\u5b58\u653e\u7684\u4f4d\u7f6e\u4e0b\u6807\u3002\n            i = ~i;\n\n            if (i &lt; mSize &amp;&amp; mValues[i] == DELETED) {\n                // \u539f\u6765\u4f4d\u7f6e\u4e0a\u7684\u5143\u7d20\u5df2\u7ecf\u88ab\u5220\u6389\u4e86\uff0c\u76f4\u63a5\u8d4b\u503c\u66ff\u6362\n                mKeys[i] = key;\n                mValues[i] = value;\n                return;\n            }\n\n            if (mGarbage &amp;&amp; mSize &gt;= mKeys.length) {\n                // \u5bb9\u91cf\u4e0d\u8db3\uff0c\u8fdb\u884c\u56de\u6536\u64cd\u4f5c\n                gc();\n                // \u91cd\u65b0\u67e5\u627e\u76ee\u6807\u4e0b\u6807\n                i = ~ContainerHelpers.binarySearch(mKeys, mSize, key);\n            }\n            // \u76ee\u6807\u4e0b\u6807\u4e3ai\uff0c\u5c06key\u6dfb\u52a0\u8fdbmKeys\u6570\u7ec4\u4e2d\n            mKeys = GrowingArrayUtils.insert(mKeys, mSize, i, key);\n            // \u76ee\u6807\u4e0b\u6807\u4e3ai\uff0c\u5c06value\u63d2\u5165mValues\u6570\u7ec4\u4e2d\n            mValues = GrowingArrayUtils.insert(mValues, mSize, i, value);\n            // \u5df2\u5b58\u50a8\u7684\u6570\u636e\u4e2a\u6570\u52a01\n            mSize++;\n        }\n}\n\n// GrowingArrayUtils.java\npublic static &lt;T&gt; T[] insert(T[] array, int currentSize, int index, T element) {\n        assert currentSize &lt;= array.length;\n\n        if (currentSize + 1 &lt;= array.length) {\n            // \u5f53\u524d\u6570\u7ec4\u5bb9\u91cf\u5145\u8db3\uff0cindex\u5f00\u59cb\u7684\u5143\u7d20\u540e\u79fb1\u4f4d\n            System.arraycopy(array, index, array, index + 1, currentSize - index);\n            array[index] = element;\n            return array;\n        }\n\n        // \u5bb9\u91cf\u4e0d\u8db3\uff0c\u5148\u6269\u5bb9\u751f\u6210\u65b0\u7684\u6570\u7ec4newArray\n        @SuppressWarnings(\"unchecked\")\n        T[] newArray = ArrayUtils.newUnpaddedArray((Class&lt;T&gt;)array.getClass().getComponentType(),\n                growSize(currentSize));\n        // \u5c06\u539f\u6765\u6570\u7ec4index\u4e4b\u524d\u7684\u90e8\u5206\u590d\u5236\u5230\u65b0\u6570\u7ec4\u5bf9\u8c61\u4e2d\n        System.arraycopy(array, 0, newArray, 0, index);\n        newArray[index] = element; // \u63d2\u5165\u5143\u7d20\n        // \u5c06\u539f\u6570\u7ec4index+1\u4e4b\u540e\u7684\u5143\u7d20\u62f7\u8d1d\u5230\u65b0\u6570\u7ec4\u4e2d\n        System.arraycopy(array, index, newArray, index + 1, array.length - index);\n        return newArray;\n    }\n\n// \u6269\u5bb9\u8ba1\u7b97\u89c4\u5219\uff0c\u5f53\u524d\u5bb9\u91cf\u5c0f\u4e8e\u7b49\u4e8e4\u5219\u8fd4\u56de8\uff1b\u5426\u5219\u8fd4\u56de2\u500d\u7684\u5bb9\u91cf\n// \u6269\u5bb9\u540e\u6700\u5c0f\u5bb9\u91cf\u662f8\npublic static int growSize(int currentSize) {\n        return currentSize &lt;= 4 ? 8 : currentSize * 2;\n}\n</code></pre>"},{"location":"android/rtfsc/Android_SparseArray_src_code_note/#key","title":"key\u4e0b\u6807\u7684\u4e8c\u53c9\u67e5\u627e\u65b9\u6cd5\u5206\u6790","text":"<p>\u4e8c\u53c9\u67e5\u627e\u65b9\u6cd5<code>ContainerHelpers.binarySearch(int[] array, int size, int value)</code> <pre><code>    static int binarySearch(int[] array, int size, int value) {\n        int lo = 0;\n        int hi = size - 1;\n\n        while (lo &lt;= hi) {\n            final int mid = (lo + hi) &gt;&gt;&gt; 1;\n            final int midVal = array[mid];\n\n            if (midVal &lt; value) {\n                lo = mid + 1;\n            } else if (midVal &gt; value) {\n                hi = mid - 1;\n            } else {\n                return mid;  // value found\n            }\n        }\n        return ~lo;  // value not present\n    }\n</code></pre></p> <p>\u5982\u679c\u6ca1\u6709\u627e\u5230\u8f93\u5165value\u5bf9\u5e94\u7684\u4e0b\u6807\uff0c\u5219\u4f1a\u8fd4\u56de\u4e00\u4e2a\u6309\u4f4d\u53d6\u53cd\u540e\u7684\u503c\uff08\u4e00\u822c\u662f\u4e2a\u8d1f\u503c\uff09\u3002</p> <p>\u4f8b\u5982\u8f93\u5165array\u662f [1,2,4,5]\uff0csize\u662f4\uff0cvalue\u662f3\uff1b\u90a3\u4e48\u4f1a\u5f97\u52302\u7684\u53d6\u53cd\u503c\u3002\u800c<code>2</code>\u5c31\u662fvalue\u7684\u76ee\u6807\u4f4d\u7f6e\u4e0b\u6807\u3002</p>"},{"location":"android/rtfsc/Android_SparseArray_src_code_note/#sparsearray_3","title":"SparseArray\u6700\u5927\u5bb9\u91cf\uff1f\u6bcf\u6b21\u6269\u5bb9\u591a\u5c11\uff1f","text":"<p>SparseArray\u5e76\u4e0d\u50cfHashMap\u4e00\u6837\u5b9a\u4e49\u6709\u6700\u5927\u5bb9\u91cf\u662f\u591a\u5c11\uff0c\u6700\u5927\u53ef\u4ee5\u8fbe\u5230Integer.MAX_VALUE\uff0c\u53ef\u80fd\u4f1a\u62a5oom\u3002\u6bcf\u6b21\u6269\u5bb9\u65f6\u5982\u679c\u5f53\u524d\u5bb9\u91cf\u5c0f\u4e8e5\u5219\u6269\u5bb9\u662f8\uff0c\u5426\u5219\u6269\u5bb9\u4e3a\u539f\u5bb9\u91cf\u76842\u500d\u3002</p> <pre><code>public static int growSize(int currentSize) {\n        return currentSize &lt;= 4 ? 8 : currentSize * 2;\n}\n</code></pre>"},{"location":"android/rtfsc/Android_SparseArray_src_code_note/#sparsearrayhashmap","title":"SparseArray\u4e0eHashMap\u7684\u6bd4\u8f83\uff0c\u5e94\u7528\u573a\u666f\u662f\uff1f","text":"<ul> <li>SparseArray\u91c7\u7528\u7684\u4e0d\u662f\u54c8\u5e0c\u7b97\u6cd5\uff0cHashMap\u91c7\u7528\u7684\u662f\u54c8\u5e0c\u7b97\u6cd5\u3002</li> <li>SparseArray\u91c7\u7528\u7684\u662f\u4e24\u4e2a\u4e00\u7ef4\u6570\u7ec4\u5206\u522b\u7528\u4e8e\u5b58\u50a8\u952e\u548c\u503c\uff0cHashMap\u91c7\u7528\u7684\u662f\u4e00\u7ef4\u6570\u7ec4+\u5355\u5411\u94fe\u8868\u6216\u4e8c\u53c9\u6811\u3002</li> <li>SparseArray key\u53ea\u80fd\u662fint\u7c7b\u578b\uff0c\u800cHashMap\u7684key\u662fObject\u3002</li> <li>SparseArray  key\u662f\u6709\u5e8f\u5b58\u50a8\uff08\u5347\u5e8f\uff09\uff0c\u800cHashMap\u4e0d\u662f\u3002</li> <li>SparseArray \u9ed8\u8ba4\u5bb9\u91cf\u662f10\uff0c\u800cHashMap\u9ed8\u8ba4\u5bb9\u91cf\u662f16\u3002</li> <li>SparseArray \u9ed8\u8ba4\u6bcf\u6b21\u6269\u5bb9\u662f2\u500d\u4e8e\u539f\u6765\u7684\u5bb9\u91cf\uff0c\u800cHashMap\u9ed8\u8ba4\u6bcf\u6b21\u6269\u5bb9\u65f6\u662f\u539f\u5bb9\u91cf*0.75\u500d</li> <li>SparseArray value\u7684\u5b58\u50a8\u88ab\u4e0d\u50cfHashMap\u4e00\u6837\u9700\u8981\u989d\u5916\u7684\u9700\u8981\u4e00\u4e2a\u5b9e\u4f53\u7c7b\uff08Node\uff09\u8fdb\u884c\u5305\u88c5</li> <li>SparseArray\u67e5\u627e\u5143\u7d20\u603b\u4f53\u800c\u8a00\u6bd4HashMap\u8981\u900a\u8272\uff0c\u56e0\u4e3aSparseArray\u67e5\u627e\u662f\u9700\u8981\u7ecf\u8fc7\u4e8c\u5206\u6cd5\u7684\u8fc7\u7a0b\uff0c\u800cHashMap\u4e0d\u5b58\u5728\u51b2\u7a81\u7684\u60c5\u51b5\u5176\u6280\u672f\u5904\u7684hash\u5bf9\u5e94\u7684\u4e0b\u6807\u76f4\u63a5\u5c31\u53ef\u4ee5\u53d6\u5230\u503c\u3002</li> </ul> <p>\u9488\u5bf9\u4e0a\u9762\u4e0eHashMap\u7684\u6bd4\u8f83\uff0c\u91c7\u7528SparseArray\u8fd8\u662fHashMap\uff0c\u5efa\u8bae\u6839\u636e\u5982\u4e0b\u9700\u6c42\u9009\u53d6\uff1a - \u5982\u679c\u5bf9\u5185\u5b58\u8981\u6c42\u6bd4\u8f83\u9ad8\uff0c\u800c\u5bf9\u67e5\u8be2\u6548\u7387\u6ca1\u4ec0\u4e48\u5927\u7684\u8981\u6c42\uff0c\u53ef\u4ee5\u662f\u4f7f\u7528SparseArray - \u6570\u91cf\u5728\u767e\u7ea7\u522b\u7684SparseArray\u6bd4HashMap\u6709\u66f4\u597d\u7684\u4f18\u52bf - \u8981\u6c42key\u662fint\u7c7b\u578b\u7684\uff0c\u56e0\u4e3aHashMap\u4f1a\u5bf9int\u81ea\u5b9a\u88c5\u7bb1\u53d8\u6210Integer\u7c7b\u578b - \u8981\u6c42key\u662f\u6709\u5e8f\u7684\u4e14\u662f\u5347\u5e8f</p>"},{"location":"android/rtfsc/Android_SparseArray_src_code_note/#_1","title":"\u53c2\u8003","text":"<p>https://www.jianshu.com/p/30a2bfb202b4</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u6398\u91d1</p>"},{"location":"android/service/IntentService-intro1/","title":"Android IntentService \u5206\u6790\u548c\u7528\u6cd5","text":"<p>IntentService\u7684\u5206\u6790\u548c\u7528\u6cd5\uff0c\u5b9e\u7528\u6027\u4ecb\u7ecd\u3002</p>"},{"location":"android/service/IntentService-intro1/#intentservice","title":"IntentService \u7b80\u4ecb","text":"<ul> <li>IntentService\u7ee7\u627f\u81eaService\uff0c\u53ef\u7528<code>startService</code>\u542f\u52a8\uff0c\u4e5f\u9700\u8981\u5728<code>AndroidManifest.xml</code>\u4e2d\u6ce8\u518c</li> <li>IntentService\u5728\u4e00\u4e2a\u5355\u72ec\u7684worker\u7ebf\u7a0b\u4e2d\u5904\u7406\u4efb\u52a1</li> <li>\u4efb\u52a1\u5b8c\u6210\u540e\uff0c\u4f1a\u81ea\u52a8\u505c\u6b62</li> <li>\u53ef\u591a\u6b21\u542f\u52a8\u540c\u4e00\u4e2aIntentService\uff0c\u5b83\u4eec\u4f1a\u81ea\u4e00\u4e2a\u63a5\u4e00\u4e2a\u5730\u6392\u961f\u5904\u7406</li> </ul>"},{"location":"android/service/IntentService-intro1/#intentservice-service","title":"IntentService \u4e0e Service","text":"<p>\u8017\u65f6\u4efb\u52a1\u53ef\u4ee5\u4e0d\u7528\u5728Service\u4e2d\u624b\u52a8\u5f00\u542f\u7ebf\u7a0b\u3002 \u5f53\u64cd\u4f5c\u5b8c\u6210\u65f6\uff0c\u6211\u4eec\u4e0d\u7528\u624b\u52a8\u505c\u6b62IntentService\uff0c\u5b83\u4f1a\u81ea\u52a8\u5224\u5b9a\u505c\u6b62\u3002  </p>"},{"location":"android/service/IntentService-intro1/#intentservice_1","title":"IntentService \u81ea\u52a8\u505c\u6b62","text":"<p>\u53c2\u8003IntentService\u6e90\u7801\uff1a <pre><code>private volatile ServiceHandler mServiceHandler;\n\nprivate final class ServiceHandler extends Handler {\n    public ServiceHandler(Looper looper) {\n        super(looper);\n    }\n\n    @Override\n    public void handleMessage(Message msg) {\n        onHandleIntent((Intent)msg.obj);\n        stopSelf(msg.arg1); // \u4f20\u5165startID\n    }\n}\n\n@Override\npublic void onCreate() {\n    super.onCreate();\n    HandlerThread thread = new HandlerThread(\"IntentService[\" + mName + \"]\");\n    thread.start();\n\n    mServiceLooper = thread.getLooper();\n    mServiceHandler = new ServiceHandler(mServiceLooper);\n}\n\n@Override\npublic void onStart(@Nullable Intent intent, int startId) {\n    Message msg = mServiceHandler.obtainMessage();\n    msg.arg1 = startId; // \u8fd9\u4e2a\u662f\u505c\u6b62\u670d\u52a1\u7684\u4f9d\u636e\n    msg.obj = intent;\n    mServiceHandler.sendMessage(msg);\n}\n</code></pre> \u5229\u7528<code>ServiceHandler</code>\u6765\u63a7\u5236\u751f\u547d\u5468\u671f\u3002onCreate\u65b9\u6cd5\u4e2d\u5f00\u542f\u4e86\u4e00\u4e2a<code>HandlerThread</code>\u6765\u5904\u7406\u8bf7\u6c42\u3002 \u5728<code>onStart</code>\u4e2d\u83b7\u53d6\u5230<code>startId</code>\u3002\u5728<code>ServiceHandler</code>\u4e2d\u6bcf\u6b21\u5904\u7406\u5b8c\u4e00\u4e2a\u547d\u4ee4\u90fd\u4f1a\u8c03\u7528<code>stopSelf(int startId)</code>\u65b9\u6cd5\u6765\u505c\u6b62\u670d\u52a1\u3002 IntentService\u76f4\u5230\u547d\u4ee4\u961f\u5217\u4e2d\u7684\u6240\u6709\u547d\u4ee4\u88ab\u6267\u884c\u5b8c\u540e\u624d\u4f1a\u505c\u6b62\u670d\u52a1\u3002</p>"},{"location":"android/service/IntentService-intro1/#_1","title":"\u7528\u6cd5\u793a\u4f8b","text":"<p>\u65b0\u5efa\u4e00\u4e2a\u6a21\u62df\u8ba1\u7b97\u7684\u540e\u53f0\u670d\u52a1<code>CalIntentService</code>\u7ee7\u627f<code>IntentService</code> <pre><code>/**\n * \u6a21\u62df\u8ba1\u7b97\u7684\u540e\u53f0\u670d\u52a1\n * Created by Rust on 2017/6/9.\n */\npublic class CalIntentService extends IntentService {\n\n    private static final String TAG = \"rustApp\";\n    private int mStartId = 0;\n\n    /**\n     * \u4e00\u5b9a\u8981\u4e00\u4e2a\u65e0\u53c2\u6784\u9020\u5668\n     */\n    public CalIntentService() {\n        this(\"cal_intent_service_name\");\n    }\n\n    /**\n     * Creates an IntentService.  Invoked by your subclass's constructor.\n     *\n     * @param name Used to name the worker thread, important only for debugging.\n     */\n    public CalIntentService(String name) {\n        super(name);\n    }\n\n    @Override\n    public void onStart(@Nullable Intent intent, int startId) {\n        super.onStart(intent, startId);\n        mStartId = startId;\n        Log.d(TAG, \"[CalIntentService] onStart, startId=\" + mStartId); // \u590d\u5199\u8fd9\u4e2a\u65b9\u6cd5\u6765\u770bstartId\n    }\n\n    @Override\n    public void onDestroy() {\n        super.onDestroy(); // \u89c2\u5bdf\u751f\u547d\u5468\u671f\n        Log.d(TAG, \"[CalIntentService] onDestroy. StartId=\" + mStartId);\n    }\n\n    @Override\n    protected void onHandleIntent(@Nullable Intent intent) {\n        if (null != intent) {\n            String name = intent.getStringExtra(\"name\");\n            String msg = intent.getStringExtra(\"msg\");\n            Log.d(TAG, \"[CalIntentService] \u6536\u5230 name:\" + name + \", msg:\" + msg + \", at \"\n                    + Thread.currentThread().toString());\n        }\n        try {\n            Thread.sleep(1000); // \u6a21\u62df\u8017\u65f6\u64cd\u4f5c\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        Log.d(TAG, \"[CalIntentService] \u8ba1\u7b97\u7ed3\u675f.  mStartId=\" + mStartId);\n    }\n}\n</code></pre></p> <p>AndroidManifest\u4e2d\u6ce8\u518c\u8fd9\u4e2a\u670d\u52a1\u3002\u76ee\u524d\u53ea\u5141\u8bb8\u672cApp\u4f7f\u7528 <pre><code>&lt;service\n    android:name=\"com.rustfisher.service.CalIntentService\"\n    android:exported=\"false\" /&gt;\n</code></pre></p> <p>Activity\u4e2d\u542f\u52a8\u8fd9\u4e2a\u670d\u52a1 <pre><code>btn2.setOnClickListener(new View.OnClickListener() {\n    @Override\n    public void onClick(View v) {\n        Intent calIntent = new Intent(getApplicationContext(), CalIntentService.class);\n        calIntent.putExtra(\"name\", \"Rust\");\n        calIntent.putExtra(\"msg\", \"Click event: \" + mClickCount++);\n        startService(calIntent);\n    }\n});\n</code></pre></p> <p>\u5728\u624b\u673a\u4e0a\u8fd0\u884c\uff0c\u5feb\u901f\u70b9\u51fb\u51e0\u6b21\u6309\u94ae\uff0c\u542f\u52a8IntentService\uff0clogcat\u8f93\u51fa <pre><code>[CalIntentService] onStart, startId=1\n[CalIntentService] \u6536\u5230 name:Rust, msg:Click event: 0, at Thread[IntentService[cal_intent_service_name],5,main]\n[CalIntentService] onStart, startId=2\n[CalIntentService] onStart, startId=3\n[CalIntentService] onStart, startId=4\n[CalIntentService] \u8ba1\u7b97\u7ed3\u675f.  \u6700\u65b0StartId=4\n[CalIntentService] \u6536\u5230 name:Rust, msg:Click event: 1, at Thread[IntentService[cal_intent_service_name],5,main]\n[CalIntentService] \u8ba1\u7b97\u7ed3\u675f.  \u6700\u65b0StartId=4\n[CalIntentService] \u6536\u5230 name:Rust, msg:Click event: 2, at Thread[IntentService[cal_intent_service_name],5,main]\n[CalIntentService] \u8ba1\u7b97\u7ed3\u675f.  \u6700\u65b0StartId=4\n[CalIntentService] \u6536\u5230 name:Rust, msg:Click event: 3, at Thread[IntentService[cal_intent_service_name],5,main]\n[CalIntentService] \u8ba1\u7b97\u7ed3\u675f.  \u6700\u65b0StartId=4\n[CalIntentService] onDestroy. StartId=4\n</code></pre></p> <p>\u53ef\u4ee5\u770b\u51fa\uff0c\u5148\u6267\u884c<code>onStart</code>\uff0c\u7136\u540e\u6392\u961f\u6267\u884c<code>onHandleIntent</code>\u3002\u4efb\u52a1\u5168\u90e8\u7ed3\u675f\u540e\u81ea\u884c\u505c\u6b62\u3002</p>"},{"location":"android/service/service-intro/","title":"Service\u7efc\u8ff0","text":"<p>Service\u662f\u4e00\u79cd\u53ef\u5728\u540e\u53f0\u6267\u884c\u957f\u65f6\u95f4\u8fd0\u884c\u64cd\u4f5c\u800c\u4e0d\u63d0\u4f9b\u754c\u9762\u7684\u5e94\u7528\u7ec4\u4ef6\u3002 \u670d\u52a1\u53ef\u7531\u5176\u4ed6\u5e94\u7528\u7ec4\u4ef6\u542f\u52a8\uff0c\u800c\u4e14\u5373\u4f7f\u7528\u6237\u5207\u6362\u5230\u5176\u4ed6\u5e94\u7528\uff0c\u670d\u52a1\u4ecd\u5c06\u5728\u540e\u53f0\u7ee7\u7eed\u8fd0\u884c\u3002 \u6b64\u5916\uff0c\u7ec4\u4ef6\u53ef\u901a\u8fc7\u7ed1\u5b9a\u5230\u670d\u52a1\u4e0e\u4e4b\u8fdb\u884c\u4ea4\u4e92\uff0c\u751a\u81f3\u662f\u6267\u884c\u8fdb\u7a0b\u95f4\u901a\u4fe1 (IPC)\u3002 \u4f8b\u5982\uff0c\u670d\u52a1\u53ef\u5728\u540e\u53f0\u5904\u7406\u7f51\u7edc\u4e8b\u52a1\u3001\u64ad\u653e\u97f3\u4e50\uff0c\u6267\u884c\u6587\u4ef6 I/O \u6216\u4e0e\u5185\u5bb9\u63d0\u4f9b\u7a0b\u5e8f\u8fdb\u884c\u4ea4\u4e92\u3002</p> <p>\u672c\u6587\u4ecb\u7ecd\u51e0\u4e2a\u6982\u5ff5\uff1a</p> <ul> <li>\u524d\u53f0\uff0c\u540e\u53f0\u670d\u52a1\u4e0e\u7ed1\u5b9a</li> <li>\u670d\u52a1\u7684\u751f\u547d\u5468\u671f</li> </ul> <p>\u5728\u5f00\u59cb\u4f7f\u7528Service\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u8ba4\u8bc6\u4e00\u4e0bService\u7684\u51e0\u4e2a\u6982\u5ff5\u3002</p>"},{"location":"android/service/service-intro/#_1","title":"\u524d\u53f0\uff0c\u540e\u53f0\u670d\u52a1\u4e0e\u7ed1\u5b9a","text":"<p>\u67093\u79cd\u4e0d\u540c\u7684\u670d\u52a1\u7c7b\u578b\u3002</p>"},{"location":"android/service/service-intro/#_2","title":"\u524d\u53f0\u670d\u52a1","text":"<p>\u524d\u53f0\u670d\u52a1\u6267\u884c\u4e00\u4e9b\u7528\u6237\u80fd\u6ce8\u610f\u5230\u7684\u64cd\u4f5c\u3002\u4f8b\u5982\uff0c\u97f3\u9891\u5e94\u7528\u4f1a\u4f7f\u7528\u524d\u53f0\u670d\u52a1\u6765\u64ad\u653e\u97f3\u9891\u66f2\u76ee\u3002\u524d\u53f0\u670d\u52a1\u5fc5\u987b\u663e\u793a\u901a\u77e5\u3002 \u5373\u4f7f\u7528\u6237\u505c\u6b62\u4e0e\u5e94\u7528\u7684\u4ea4\u4e92\uff0c\u524d\u53f0\u670d\u52a1\u4ecd\u4f1a\u7ee7\u7eed\u8fd0\u884c\u3002</p>"},{"location":"android/service/service-intro/#_3","title":"\u540e\u53f0\u670d\u52a1","text":"<p>\u540e\u53f0\u670d\u52a1\u6267\u884c\u7528\u6237\u4e0d\u4f1a\u76f4\u63a5\u6ce8\u610f\u5230\u7684\u64cd\u4f5c\u3002\u4f8b\u5982\uff0c\u5982\u679c\u5e94\u7528\u4f7f\u7528\u67d0\u4e2a\u670d\u52a1\u6765\u538b\u7f29\u5176\u5b58\u50a8\u7a7a\u95f4\uff0c\u5219\u6b64\u670d\u52a1\u901a\u5e38\u662f\u540e\u53f0\u670d\u52a1\u3002</p> <p>\u6ce8\u610f\uff1a\u5982\u679c\u60a8\u7684\u5e94\u7528\u9762\u5411 API \u7ea7\u522b 26 \u6216\u66f4\u9ad8\u7248\u672c\uff0c\u5f53\u5e94\u7528\u672c\u8eab\u672a\u5728\u524d\u53f0\u8fd0\u884c\u65f6\uff0c\u7cfb\u7edf\u4f1a\u5bf9\u8fd0\u884c\u540e\u53f0\u670d\u52a1\u65bd\u52a0\u9650\u5236\u3002\u5728\u8bf8\u5982\u6b64\u7c7b\u7684\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u60a8\u7684\u5e94\u7528\u5e94\u6539\u4e3a\u4f7f\u7528\u8ba1\u5212\u4f5c\u4e1a\u3002</p>"},{"location":"android/service/service-intro/#_4","title":"\u7ed1\u5b9a\u670d\u52a1","text":"<p>\u5f53\u5e94\u7528\u7ec4\u4ef6\u901a\u8fc7\u8c03\u7528<code>bindService()</code>\u7ed1\u5b9a\u5230\u670d\u52a1\u65f6\uff0c\u670d\u52a1\u5373\u5904\u4e8e\u7ed1\u5b9a\u72b6\u6001\u3002 \u7ed1\u5b9a\u670d\u52a1\u4f1a\u63d0\u4f9b\u5ba2\u6237\u7aef-\u670d\u52a1\u5668\u63a5\u53e3\uff0c\u4ee5\u4fbf\u7ec4\u4ef6\u4e0e\u670d\u52a1\u8fdb\u884c\u4ea4\u4e92\u3001\u53d1\u9001\u8bf7\u6c42\u3001\u63a5\u6536\u7ed3\u679c\uff0c\u751a\u81f3\u662f\u5229\u7528\u8fdb\u7a0b\u95f4\u901a\u4fe1 (IPC) \u8de8\u8fdb\u7a0b\u6267\u884c\u8fd9\u4e9b\u64cd\u4f5c\u3002 \u4ec5\u5f53\u4e0e\u53e6\u4e00\u4e2a\u5e94\u7528\u7ec4\u4ef6\u7ed1\u5b9a\u65f6\uff0c\u7ed1\u5b9a\u670d\u52a1\u624d\u4f1a\u8fd0\u884c\u3002\u591a\u4e2a\u7ec4\u4ef6\u53ef\u540c\u65f6\u7ed1\u5b9a\u5230\u8be5\u670d\u52a1\uff0c\u4f46\u5168\u90e8\u53d6\u6d88\u7ed1\u5b9a\u540e\uff0c\u8be5\u670d\u52a1\u5373\u4f1a\u88ab\u9500\u6bc1\u3002</p>"},{"location":"android/service/service-intro/#_5","title":"\u751f\u547d\u5468\u671f","text":"<p>\u4e0eActivity\u7c7b\u4f3c\uff0cService\u4e5f\u6709\u81ea\u5df1\u7684\u751f\u547d\u5468\u671f\u3002 \u542f\u52a8\u670d\u52a1\u65b9\u5f0f\u4e0d\u540c\uff0c\u8d70\u7684\u751f\u547d\u5468\u671f\u4e5f\u4e0d\u540c\u3002</p> <p>\u540e\u9762\u4f1a\u9488\u5bf9\u4e0d\u540c\u7684\u542f\u52a8\u65b9\u5f0f\uff0c\u4ecb\u7ecd\u751f\u547d\u5468\u671f\u7684\u53d8\u5316\u3002</p>"},{"location":"android/service/system-alert-window-service/","title":"Android \u60ac\u6d6e\u7a97 System Alert Window","text":"\u66f4\u65b0\u65e5\u671f: 2022-9-14 <ul> <li>2022-9-14 \u6dfb\u52a0\u8bf4\u660e</li> <li>2022-1-6 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u60ac\u6d6e\u7a97\u80fd\u663e\u793a\u5728\u5176\u4ed6\u5e94\u7528\u4e0a\u65b9\u3002\u684c\u9762\u7cfb\u7edf\u4f8b\u5982Windows\uff0cmacOS\uff0cUbuntu\uff0c\u6253\u5f00\u7684\u7a0b\u5e8f\u80fd\u4ee5\u7a97\u53e3\u5f62\u5f0f\u663e\u793a\u5728\u5c4f\u5e55\u4e0a\u3002 \u53d7\u9650\u4e8e\u5c4f\u5e55\u5927\u5c0f\uff0c\u5b89\u5353\u7cfb\u7edf\u4e2d\u4e3b\u8981\u4f7f\u7528\u591a\u4efb\u52a1\u5207\u6362\u7684\u65b9\u5f0f\u548c\u5206\u5c4f\u7684\u65b9\u5f0f\u3002\u89c6\u9891\u64ad\u653e\uff0c\u89c6\u9891\u5bf9\u8bdd\u53ef\u80fd\u4f1a\u91c7\u7528\u60ac\u6d6e\u7a97\u529f\u80fd\uff08\u4f8b\u5982\u624bQ\uff0c\u5fae\u4fe1\u7684\u89c6\u9891\u901a\u8bdd\uff09\u3002\u5e94\u7528\u7559\u4e0b\u4e00\u4e2a\u89c6\u9891\uff08\u901a\u8bdd\uff09\u7a97\u53e3\uff0c\u7528\u6237\u53ef\u4ee5\u8fd4\u56de\u5b89\u5353\u684c\u9762\uff0c\u6216\u8005\u53bb\u5176\u4ed6app\u7684\u754c\u9762\u64cd\u4f5c\u3002 \u524d\u9762\u6211\u4eec\u63a2\u8ba8\u4e86\u60ac\u6d6eactivity\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u5e76\u7ed3\u5408CameraX\u9884\u89c8\u6765\u5b9e\u73b0\u5e94\u7528\u5185\u6444\u50cf\u5934\u9884\u89c8\u60ac\u6d6eActivity\u3002\u8fd9\u4e9b\u662f\u5728app\u5185\u5b9e\u73b0\u7684\u60ac\u6d6eactivity\u6548\u679c\u3002</p> <p>\u672c\u6587\u6211\u4eec\u7528\u4e00\u4e2a\u4f8b\u5b50\u6765\u5c55\u793aAndroid\u60ac\u6d6e\u7a97\u7684\u5b9e\u73b0\u65b9\u6cd5\u548c\u6ce8\u610f\u4e8b\u9879\u3002</p> <p>\u672c\u6587\u4f8b\u5b50\u542f\u7528\u4e86dataBinding <pre><code>dataBinding {\n    enabled = true\n}\n</code></pre></p> <p>\u4e0d\u542f\u7528dataBinding\u4e5f\u53ef\u4ee5\uff0c\u7528findViewById\u5373\u53ef\u3002 \u8fd9\u91cc\u4f7f\u7528dataBinding\u53ea\u662f\u4e3a\u4e86\u65b9\u4fbf\u3002</p>"},{"location":"android/service/system-alert-window-service/#system_alert_window","title":"<code>SYSTEM_ALERT_WINDOW</code>\u6743\u9650","text":"<p>manifest\u91cc\u7533\u660e\u6743\u9650<code>SYSTEM_ALERT_WINDOW</code> <pre><code>&lt;uses-permission android:name=\"android.permission.SYSTEM_ALERT_WINDOW\" /&gt;\n</code></pre> \u8bf7\u6c42\u4e86\u8fd9\u4e2a\u6743\u9650\u540e\uff0capp\u7684\u6743\u9650\u7ba1\u7406\u4e2d\u4f1a\u6709\u300c\u663e\u793a\u60ac\u6d6e\u7a97\u300d\u7684\u6743\u9650\u9009\u9879\u3002\u540e\u9762\u6211\u4eec\u4f1a\u5f15\u5bfc\u7528\u6237\u53bb\u5f00\u542f\u8fd9\u4e2a\u6743\u9650\u3002</p> <p>\u6807\u9898\u4e2d\u201cSystem Alert Window\u201d\u5373<code>SYSTEM_ALERT_WINDOW</code></p>"},{"location":"android/service/system-alert-window-service/#_1","title":"\u60ac\u6d6e\u7a97\u7684\u754c\u9762","text":"<p>\u51c6\u5907layout\u6587\u4ef6floating_window_1.xml\uff0c\u5b83\u4f5c\u4e3a\u60ac\u6d6e\u7a97\u7684\u754c\u9762\u3002</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:id=\"@+id/f_root\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:background=\"#00897B\"\n    android:gravity=\"center_horizontal\"\n    android:orientation=\"vertical\"\n    android:padding=\"4dp\"&gt;\n\n    &lt;TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:gravity=\"center_horizontal\"\n        android:text=\"\u60ac\u6d6e\u7a97\\n an.rustfisher.com \"\n        android:textColor=\"#FFFFFF\"\n        android:textSize=\"16sp\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/f_btn1\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginTop=\"20dp\"\n        android:background=\"#00897B\"\n        android:text=\"\u6253\u5f00\u63a7\u5236\u9875\u9762\"\n        android:textColor=\"#FFFFFF\" /&gt;\n\n    &lt;View\n        android:layout_width=\"100dp\"\n        android:layout_height=\"1dp\"\n        android:layout_margin=\"16dp\"\n        android:background=\"#eaeaea\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/exit_btn\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:background=\"#00897B\"\n        android:text=\"\u5173\u95ed\u60ac\u6d6e\u7a97\u670d\u52a1\"\n        android:textColor=\"#FFFFFF\" /&gt;\n&lt;/LinearLayout&gt;\n</code></pre>"},{"location":"android/service/system-alert-window-service/#service","title":"\u60ac\u6d6e\u7a97service","text":"<p>\u65b0\u5efa\u4e00\u4e2aService FloatingWindowService\u3002\u5b83\u6765\u6267\u884c\u521b\u5efa/\u9500\u6bc1\u60ac\u6d6e\u7a97\u7684\u64cd\u4f5c\u3002 \u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\u3002</p> <p><pre><code>// package com.rustfisher.tutorial2020.service.floating;\nimport android.app.Service;\nimport android.content.Intent;\nimport android.graphics.PixelFormat;\nimport android.os.Build;\nimport android.os.IBinder;\nimport android.util.DisplayMetrics;\nimport android.util.Log;\nimport android.view.Gravity;\nimport android.view.LayoutInflater;\nimport android.view.MotionEvent;\nimport android.view.View;\nimport android.view.ViewGroup;\nimport android.view.WindowManager;\n\nimport androidx.annotation.Nullable;\n\nimport com.rustfisher.tutorial2020.R;\n\n/**\n * \u60ac\u6d6e\u7a97\u7684\u670d\u52a1\n *\n * @author an.rustfisher.com\n * @date 2022-01-05 23:53\n */\npublic class FloatingWindowService extends Service {\n    private static final String TAG = \"rfDevFloatingService\";\n\n    private WindowManager windowManager;\n    private View floatView;\n\n    @Nullable\n    @Override\n    public IBinder onBind(Intent intent) {\n        return null;\n    }\n\n    @Override\n    public int onStartCommand(Intent intent, int flags, int startId) {\n        Log.d(TAG, \"onStartCommand , \" + startId);\n        if (floatView == null) {\n            Log.d(TAG, \"onStartCommand: \u521b\u5efa\u60ac\u6d6e\u7a97\");\n            initUi();\n        }\n        return super.onStartCommand(intent, flags, startId);\n    }\n\n    @Override\n    public void onDestroy() {\n        Log.d(TAG, \"onDestroy\");\n        super.onDestroy();\n    }\n\n    private void initUi() {\n        DisplayMetrics metrics = getApplicationContext().getResources().getDisplayMetrics();\n        int width = metrics.widthPixels;\n        int height = metrics.heightPixels;\n\n        windowManager = (WindowManager) getSystemService(WINDOW_SERVICE);\n        LayoutInflater inflater = (LayoutInflater) getBaseContext().getSystemService(LAYOUT_INFLATER_SERVICE);\n        floatView = (ViewGroup) inflater.inflate(R.layout.floating_window_1, null);\n\n        int layoutType;\n        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {\n            layoutType = WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY;\n        } else {\n            layoutType = WindowManager.LayoutParams.TYPE_TOAST;\n        }\n\n        WindowManager.LayoutParams floatLp = new WindowManager.LayoutParams(\n                (int) (width * (0.4f)),\n                (int) (height * (0.3f)),\n                layoutType,\n                WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE,\n                PixelFormat.TRANSLUCENT\n        );\n\n        floatLp.gravity = Gravity.CENTER;\n        floatLp.x = 0;\n        floatLp.y = 0;\n\n        windowManager.addView(floatView, floatLp);\n\n        floatView.findViewById(R.id.f_btn1).setOnClickListener(v -&gt; {\n            stopSelf();\n            windowManager.removeView(floatView);\n            Intent backToHome = new Intent(getApplicationContext(), FloatingCmdAct.class);\n            backToHome.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n            startActivity(backToHome);\n        });\n        floatView.findViewById(R.id.exit_btn).setOnClickListener(v -&gt; {\n            stopSelf();\n            windowManager.removeView(floatView);\n        });\n\n        floatView.setOnTouchListener(new View.OnTouchListener() {\n            final WindowManager.LayoutParams floatWindowLayoutUpdateParam = floatLp;\n            double x;\n            double y;\n            double px;\n            double py;\n\n            @Override\n            public boolean onTouch(View v, MotionEvent event) {\n                switch (event.getAction()) {\n                    case MotionEvent.ACTION_DOWN:\n                        x = floatWindowLayoutUpdateParam.x;\n                        y = floatWindowLayoutUpdateParam.y;\n                        px = event.getRawX();\n                        py = event.getRawY();\n                        break;\n                    case MotionEvent.ACTION_MOVE:\n                        floatWindowLayoutUpdateParam.x = (int) ((x + event.getRawX()) - px);\n                        floatWindowLayoutUpdateParam.y = (int) ((y + event.getRawY()) - py);\n                        windowManager.updateViewLayout(floatView, floatWindowLayoutUpdateParam);\n                        break;\n                }\n                return false;\n            }\n        });\n    }\n}\n</code></pre> \u5728<code>onStartCommand</code>\u65b9\u6cd5\u4e2d\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u542f\u52a8\u8fd9\u4e2a\u670d\u52a1\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u60ac\u6d6e\u7a97<code>floatView</code>\uff0c\u5219\u53bb\u521b\u5efa\u4e00\u4e2a\u3002</p> <p>WindowManager\u63d0\u4f9b\u4e86\u4e0e\u7a97\u53e3\u7ba1\u7406\u5668\uff08window manager\uff09\u6c9f\u901a\u7684\u63a5\u53e3\u3002 \u663e\u793aView\u5230\u7a97\u53e3\uff08\u5c4f\u5e55\uff09\u4e0a\uff0c\u7528\u7684\u662fWindowManager\u63d0\u4f9b\u7684\u65b9\u6cd5<code>addView</code>\u3002\u79fb\u9664\u8c03\u7528<code>removeView</code>\u3002</p> <p>layout\u7c7b\u578b\u9700\u8981\u6307\u5b9a</p> <ul> <li><code>WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY</code></li> <li><code>WindowManager.LayoutParams.TYPE_TOAST</code></li> </ul> <p>LayoutInflater\u7528\u6765\u521b\u5efa<code>floatView</code>\u3002</p> <p><code>floatView</code>\u7684OnTouchListener\uff0c\u7528\u6765\u6267\u884c\u62d6\u52a8\u64cd\u4f5c\u3002</p> <p>\u56de\u5230\u63a7\u5236activity\u65f6\uff0c\u9700\u8981flag\uff1a<code>Intent.FLAG_ACTIVITY_NEW_TASK</code>\uff0c\u5426\u5219\u62a5\u9519AndroidRuntimeException <pre><code>android.util.AndroidRuntimeException: \n    Calling startActivity() from outside of an Activity  context requires the FLAG_ACTIVITY_NEW_TASK flag.\n</code></pre></p> <p>\u4e00\u4e2a\u5c0f\u95ee\u9898\uff1aService\u7684\u751f\u547d\u5468\u671f\u65b9\u6cd5\u8fd0\u884c\u5728\u4e3b\u7ebf\u7a0b\uff08UI\u7ebf\u7a0b\uff09\u4e0a\u5417\uff1f</p> <p>Service\u76f8\u5173\u6982\u5ff5\u8bf7\u53c2\u8003Service\u7efc\u8ff0</p>"},{"location":"android/service/system-alert-window-service/#activity","title":"activity","text":"<p>\u63d0\u4f9b\u4e00\u4e2a\u542f\u52a8\u670d\u52a1\u7684\u5730\u65b9\u3002</p>"},{"location":"android/service/system-alert-window-service/#layout","title":"layout","text":"<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layout&gt;\n\n    &lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"&gt;\n\n        &lt;LinearLayout\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"match_parent\"\n            android:gravity=\"center_horizontal\"\n            android:orientation=\"vertical\"&gt;\n\n            &lt;Button\n                android:id=\"@+id/setting_window_btn\"\n                style=\"@style/NormalBtn\"\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"wrap_content\"\n                android:layout_marginTop=\"4dp\"\n                android:text=\"\u60ac\u6d6e\u7a97\u6743\u9650\" /&gt;\n\n            &lt;Button\n                android:id=\"@+id/start_btn\"\n                style=\"@style/NormalBtn\"\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"wrap_content\"\n                android:layout_marginTop=\"4dp\"\n                android:text=\"\u542f\u52a8\u670d\u52a1\" /&gt;\n\n            &lt;Button\n                android:id=\"@+id/end_btn\"\n                style=\"@style/NormalBtn\"\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"wrap_content\"\n                android:layout_marginTop=\"4dp\"\n                android:text=\"\u505c\u6b62\u670d\u52a1\" /&gt;\n\n        &lt;/LinearLayout&gt;\n\n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n&lt;/layout&gt;\n</code></pre>"},{"location":"android/service/system-alert-window-service/#_2","title":"\u63a7\u5236","text":"<p>\u4e3a\u4e86\u65b9\u4fbf\u4ece\u60ac\u6d6e\u7a97\u51fa\u53d1\u8df3\u56de\u8fd9\u4e2aactivity\uff0c\u542f\u52a8\u6a21\u5f0f\u8bbe\u7f6e\u4e3a<code>singleTop</code>\u3002 <pre><code>&lt;activity\n    android:name=\".service.floating.FloatingCmdAct\"\n    android:launchMode=\"singleTop\" /&gt;\n</code></pre> \u53ef\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u542f\u52a8\u6a21\u5f0f\u3002</p> <p>\u4ee5\u4e0b\u662fFloatingCmdAct\u7684\u5b8c\u6574\u4ee3\u7801 <pre><code>// package com.rustfisher.tutorial2020.service.floating;\nimport android.content.Intent;\nimport android.net.Uri;\nimport android.os.Build;\nimport android.os.Bundle;\nimport android.provider.Settings;\nimport android.util.Log;\nimport android.widget.Toast;\n\nimport androidx.annotation.Nullable;\nimport androidx.appcompat.app.AppCompatActivity;\nimport androidx.databinding.DataBindingUtil;\n\nimport com.rustfisher.tutorial2020.R;\nimport com.rustfisher.tutorial2020.databinding.ActFloatingCmdBinding;\n\n/**\n * \u542f\u52a8\u670d\u52a1\u524d\u7684\u754c\u9762\n *\n * @author an.rustfisher.com\n * @date 2022-01-05 14:57\n */\npublic class FloatingCmdAct extends AppCompatActivity {\n    private static final String TAG = \"rfDevFloatingCmd\";\n\n    private ActFloatingCmdBinding mBinding;\n\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        mBinding = DataBindingUtil.setContentView(this, R.layout.act_floating_cmd);\n\n        mBinding.settingWindowBtn.setOnClickListener(v -&gt; {\n            if (android.os.Build.VERSION.SDK_INT &gt;= android.os.Build.VERSION_CODES.M) {\n                startActivity(new Intent(Settings.ACTION_MANAGE_OVERLAY_PERMISSION, Uri.parse(\"package:\" + getPackageName())));\n            } else {\n                Toast.makeText(getApplicationContext(), \"API &lt; \" + android.os.Build.VERSION_CODES.M, Toast.LENGTH_SHORT).show();\n            }\n        });\n        mBinding.startBtn.setOnClickListener(v -&gt; {\n            startService(new Intent(getApplicationContext(), FloatingWindowService.class));\n            Toast.makeText(getApplicationContext(), \"\u542f\u52a8\u670d\u52a1\", Toast.LENGTH_SHORT).show();\n        });\n        mBinding.endBtn.setOnClickListener(v -&gt; {\n            stopService(new Intent(getApplicationContext(), FloatingWindowService.class));\n            Toast.makeText(getApplicationContext(), \"\u505c\u6b62\u670d\u52a1\", Toast.LENGTH_SHORT).show();\n        });\n\n        if (!checkOverlayDisplayPermission()) {\n            Toast.makeText(getApplicationContext(), \"\u8bf7\u5141\u8bb8\u5e94\u7528\u663e\u793a\u60ac\u6d6e\u7a97\", Toast.LENGTH_SHORT).show();\n        }\n    }\n\n    @Override\n    protected void onNewIntent(Intent intent) {\n        super.onNewIntent(intent);\n        Log.d(TAG, \"onNewIntent: \u56de\u6765\u4e86\");\n    }\n\n    private boolean checkOverlayDisplayPermission() {\n        // API23\u4ee5\u540e\u9700\u8981\u68c0\u67e5\u6743\u9650\n        if (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.M) {\n            return Settings.canDrawOverlays(this);\n        } else {\n            return true;\n        }\n    }\n}\n</code></pre> API23\u4ee5\u540e\uff0c\u9700\u8981\u68c0\u67e5\u662f\u5426\u5141\u8bb8\u663e\u793a\u60ac\u6d6e\u7a97\u3002\u5982\u679c\u4e0d\u5141\u8bb8\u5219\u5f39\u4e00\u4e2atoast\u3002 \u8df3\u8f6c\u53bb\u663e\u793a\u60ac\u6d6e\u7a97\u6743\u9650\u754c\u9762\uff0c\u7528<code>Settings.ACTION_MANAGE_OVERLAY_PERMISSION</code> <pre><code>Intent(Settings.ACTION_MANAGE_OVERLAY_PERMISSION, Uri.parse(\"package:\" + getPackageName()))\n</code></pre></p> <p>\u4ee3\u7801\u8bf7\u53c2\u8003\u5de5\u7a0b https://gitee.com/rustfisher/AndroidTutorial</p>"},{"location":"android/service/system-alert-window-service/#_3","title":"\u8fd0\u884c\u6548\u679c","text":"<p>\u7ea2\u7c739A\uff08MIUI 12.5.1 Android 10\uff09</p> <p></p>"},{"location":"android/service/system-alert-window-service/#_4","title":"\u5c0f\u7ed3","text":"<p>\u672c\u6587\u5b9e\u73b0\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u60ac\u6d6e\u7a97\u529f\u80fd\u3002\u6709\u4e86<code>SYSTEM_ALERT_WINDOW</code>\u6743\u9650\u540e\uff0c\u60ac\u6d6e\u7a97\u80fd\u663e\u793a\u5728\u5176\u4ed6app\u4e0a\u65b9\u3002 \u6dfb\u52a0view\u5230\u7a97\u53e3\u4e0a\uff0c\u4e3b\u8981\u4f7f\u7528android.view.WindowManager\u7684\u529f\u80fd\u3002</p>"},{"location":"android/service/system-alert-window-service/#_5","title":"\u53c2\u8003","text":"<ul> <li>\u60ac\u6d6eactivity\u7684\u5b9e\u73b0\u65b9\u5f0f</li> <li>CameraX\u9884\u89c8</li> <li>\u5e94\u7528\u5185\u6444\u50cf\u5934\u9884\u89c8\u60ac\u6d6eActivity</li> <li>https://www.geeksforgeeks.org/how-to-make-a-floating-window-application-in-android/</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a cnblog \u6398\u91d1 oschina csdn</p>"},{"location":"android/service/start/background-service/","title":"\u540e\u53f0\u670d\u52a1","text":"<p>\u672c\u6587\u8bb2\u8ff0\u542f\u52a8\u540e\u53f0\u670d\u52a1\u7528\u6cd5\u3002 \u8c03\u7528<code>startService</code>\u65b9\u6cd5\u542f\u52a8\u670d\u52a1\u3002\u540c\u65f6\u6f14\u793a\u5982\u4f55\u505c\u6b62\u670d\u52a1\u3002</p> <p>\u672c\u6587\u4e2d\u7684 \u670d\u52a1/Service \u6307\u7684\u662f\u540e\u53f0\u670d\u52a1\u3002</p> <p>\u672c\u6587\u7684\u793a\u4f8b\u4f7f\u7528Kotlin\u5b9e\u73b0\u3002</p>"},{"location":"android/service/start/background-service/#_2","title":"\u65b0\u5efa\u670d\u52a1","text":"<p>\u6211\u4eec\u65b0\u5efa\u4e00\u4e2aServiceStartDemo\u7c7b\u7ee7\u627fService <pre><code>class ServiceStartDemo : Service() {\n\n    companion object {\n        const val TAG = \"rustAppStartDemoService\"\n    }\n\n    override fun onCreate() {\n        super.onCreate()\n        Log.d(TAG, \"onCreate ${Thread.currentThread()}\")\n    }\n\n    override fun onBind(intent: Intent): IBinder? {\n        Log.d(TAG, \"onBind ${Thread.currentThread()}\")\n        return null\n    }\n\n    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {\n        Log.d(TAG, \"onStartCommand flags:$flags, startId:$startId [$this] ${Thread.currentThread()}\")\n        return super.onStartCommand(intent, flags, startId)\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        Log.d(TAG, \"onDestroy [$this] ${Thread.currentThread()}\")\n    }\n}\n</code></pre></p> <ul> <li>\u5728\u5404\u4e2a\u751f\u547d\u5468\u671f\u65b9\u6cd5\u4e2d\u6211\u4eec\u6253\u4e0alog\uff0c\u4fbf\u4e8e\u540e\u7eed\u89c2\u5bdf<ul> <li>log\u4e2d\u6253\u51fa\u670d\u52a1\u5bf9\u8c61\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u7ebf\u7a0b\u4fe1\u606f\u7b49\u7b49</li> </ul> </li> <li><code>onBind</code>\u65b9\u6cd5\u4e2d\u6211\u4eec\u8fd4\u56de<code>null</code>\uff0c\u8868\u660e\u8fd9\u4e2a\u670d\u52a1\u4e0d\u80fd\u7528<code>bindService</code>\u7684\u65b9\u5f0f\u542f\u52a8</li> </ul> <p>\u5728<code>AndroidManifest.xml</code>\u4e2d\u6ce8\u518c\u8fd9\u4e2a\u670d\u52a1 <pre><code>&lt;manifest xmlns:android=\"http://schemas.android.com/apk/res/android\" &gt;\n  &lt;!-- ... --&gt;\n  &lt;application&gt;\n    &lt;service\n        android:name=\".service.start.ServiceStartDemo\"\n        android:enabled=\"true\"\n        android:exported=\"false\" /&gt;\n            &lt;!-- ... --&gt;\n  &lt;/application&gt;\n&lt;/manifest&gt;\n</code></pre></p> <p>\u6ce8\u610f</p> <ul> <li><code>name</code>\u662f\u6211\u4eec\u7684\u670d\u52a1\u7684\u7c7b\u540d\u3002\u5b83\u662f\u552f\u4e00\u5fc5\u9700\u7684\u5c5e\u6027</li> <li><code>enabled</code>\u4e3a<code>true</code>\uff0c\u8868\u660e\u7cfb\u7edf\u53ef\u4ee5\u793a\u4f8b\u5316\u8fd9\u4e2a\u670d\u52a1\u3002\u9ed8\u8ba4\u503c\u4e3a<code>true</code><ul> <li><code>application</code>\u4e5f\u6709\u81ea\u5df1\u7684<code>enabled</code>\u5c5e\u6027\uff0c\u9ed8\u8ba4\u503c\u4e3a<code>true</code>\u3002\u8be5\u5c5e\u6027\u9002\u7528\u4e8e\u6240\u6709\u5e94\u7528\u7ec4\u4ef6\uff0c\u5305\u62ec\u670d\u52a1</li> </ul> </li> <li><code>exported</code>\u8fd9\u91cc\u8bbe\u7f6e\u4e3a<code>false</code>\uff0c\u8868\u660e\u4e0d\u7ed9\u5176\u4ed6\u8fdb\u7a0b\uff08app\uff09\u4f7f\u7528\uff0c\u4ec5\u9002\u7528\u4e8e\u6211\u4eec\u8fd9\u4e2aapp</li> </ul> <p>\u8fd9\u6837\u6211\u4eec\u7684\u670d\u52a1\u5c31\u51c6\u5907\u5b8c\u6bd5\u4e86\u3002</p>"},{"location":"android/service/start/background-service/#startservice","title":"startService\u542f\u52a8\u670d\u52a1","text":"<p>\u5728activity\u4e2d\u8c03\u7528<code>startService</code>\u65b9\u6cd5\uff0c\u542f\u52a8\u670d\u52a1\u3002 <pre><code>startService(Intent(applicationContext, ServiceStartDemo::class.java))\n</code></pre></p> <p>\u8c03\u7528\u65b9\u6cd5\u540e\uff0cServiceStartDemo\u670d\u52a1\u4f1a\u542f\u52a8\u8d77\u6765\u3002 \u9996\u6b21\u542f\u52a8\u7684\u8bdd\uff0c\u670d\u52a1\u4f1a\u8d70<code>onCreate</code>\u548c<code>onStartCommand</code>\u65b9\u6cd5\u3002 \u521d\u59cb\u5316\u6027\u8d28\u7684\u4ee3\u7801\uff0c\u653e\u5728<code>onCreate</code>\u91cc\u3002</p> <p>\u670d\u52a1\u5df2\u7ecf\u5b58\u5728\u7684\u60c5\u51b5\u4e0b\uff0c\u7528<code>startService</code>\u65b9\u6cd5\u542f\u52a8\u670d\u52a1\uff0c\u670d\u52a1\u4f1a\u8d70<code>onStartCommand</code>\u65b9\u6cd5\u3002 \u6b64\u65f6<code>onStartCommand</code>\u91cc\u7684<code>startId</code>\u4f1a\u81ea\u589e\u3002\u7528\u8fd9\u4e2a\u6570\u503c\u53ef\u4ee5\u770b\u51fa\u8fd9\u4e2aService\u5bf9\u8c61\u88ab\u542f\u52a8\u4e86\u591a\u5c11\u6b21\u3002</p> <p>\u540c\u65f6\u6211\u4eec\u53ef\u4ee5\u5728Service\u7684log\u91cc\u89c2\u5bdf\u5230\uff0cService\u7684\u751f\u547d\u5468\u671f\u51fd\u6570\u662f\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\u7684\u3002 \u56e0\u6b64Service\u4e5f\u53ef\u80fd\u4f1a\u9047\u5230ANR\u95ee\u9898\u3002\u4e0d\u80fd\u628a\u8fc7\u4e8e\u8017\u65f6\u7684\u4efb\u52a1\u653e\u5728\u751f\u547d\u5468\u671f\u51fd\u6570\u91cc\u3002</p>"},{"location":"android/service/start/background-service/#activityservice","title":"Activity\u4e0eService\u6c9f\u901a","text":"<p>Activity\u4e0eService\u662f\u76f8\u4e92\u72ec\u7acb\u7684\u7ec4\u4ef6\u3002\u7528<code>startService</code>\u65b9\u6cd5\u542f\u52a8\u670d\u52a1\u5e76\u4e0d\u4f1a\u8ba9activity\u6301\u6709service\u7684\u5b9e\u4f8b\u3002 \u5b83\u4eec\u4e4b\u95f4\u53ef\u4ee5\u7528\u5e7f\u64ad\u6765\u8fdb\u884c\u6c9f\u901a\u3002\u6216\u8005\u7528EventBus\u4e4b\u7c7b\u7684\u5de5\u5177\u8fdb\u884c\u6c9f\u901a\u3002</p>"},{"location":"android/service/start/background-service/#_3","title":"\u505c\u6b62\u670d\u52a1","text":"<p>\u5b8c\u6210\u4efb\u52a1\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u505c\u6b62\u670d\u52a1\u3002\u8282\u7701\u7cfb\u7edf\u8d44\u6e90\u3002 \u524d\u9762\u662f\u7528<code>startService</code>\u65b9\u6cd5\u542f\u52a8\u7684\u670d\u52a1\uff0c\u540e\u9762\u7528<code>stopService(Intent)</code>\u6765\u505c\u6b62\u670d\u52a1\u3002</p> \u65b9\u6cd5 \u4ecb\u7ecd <code>stopService(Intent)</code> Activity\u6216\u5176\u4ed6\u7ec4\u4ef6\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u505c\u6b62\u76ee\u6807service <code>stopSelf()</code> Service\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u6765\u505c\u6b62\u81ea\u5df1 <p>\u4f8b\u5982\u5728Activity\u4e2d</p> <pre><code>stopService(Intent(applicationContext, ServiceStartDemo::class.java))\n</code></pre> <p>\u5728Service\u4e2d</p> <pre><code>stopSelf()\n</code></pre> <p>\u4e00\u65e6\u8bf7\u6c42\u4f7f\u7528 <code>stopSelf()</code> \u6216 <code>stopService()</code> \u6765\u505c\u6b62\u670d\u52a1\uff0c\u670d\u52a1\u4f1a\u8d70<code>onDestroy()</code>\u65b9\u6cd5\u3002 \u7cfb\u7edf\u4f1a\u5c3d\u5feb\u9500\u6bc1\u670d\u52a1\u3002</p>"},{"location":"android/service/start/foreground-service/","title":"Android \u542f\u52a8\u524d\u53f0\u670d\u52a1","text":"\u66f4\u65b0\u65e5\u671f: 2021-8-26 <ul> <li>2021-8-26 \u521b\u5efa</li> </ul> <p>\u524d\u53f0\u670d\u52a1\u53ef\u4ee5\u7ed9\u7528\u6237\u63d0\u4f9b\u754c\u9762\u4e0a\u7684\u64cd\u4f5c\u3002 \u6bcf\u4e2a\u524d\u53f0\u670d\u52a1\u90fd\u5fc5\u987b\u8981\u5728\u901a\u77e5\u680f\u663e\u793a\u4e00\u4e2a\u901a\u77e5\uff08notification\uff09\u3002\u7528\u6237\u53ef\u4ee5\u611f\u77e5\u5230app\u7684\u524d\u53f0\u670d\u52a1\u6b63\u5728\u8fd0\u884c\u3002 \u8fd9\u4e2a\u901a\u77e5\uff08notification\uff09\u9ed8\u8ba4\u662f\u4e0d\u80fd\u79fb\u9664\u7684\u3002\u670d\u52a1\u505c\u6b62\u540e\uff0c\u901a\u77e5\u4f1a\u88ab\u7cfb\u7edf\u79fb\u9664\u3002 \u5f53\u7528\u6237\u4e0d\u9700\u8981\u76f4\u63a5\u64cd\u4f5capp\uff0capp\u9700\u8981\u7ed9\u7528\u6237\u4e00\u4e2a\u72b6\u6001\u663e\u793a\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u7528\u524d\u53f0\u670d\u52a1\u3002</p> <p>\u5e02\u9762\u4e0a\u7684app\uff0c\u4f8b\u5982\u5404\u7c7b\u97f3\u4e50app</p> <p></p> <p>\u672c\u6587\u9488\u5bf9Android 8\uff08Oreo\uff0cSDK_INT 26\uff09\u53ca\u4ee5\u540e\u7684\u7248\u672c\u3002</p>"},{"location":"android/service/start/foreground-service/#_1","title":"\u4f7f\u7528\u8bf4\u660e","text":"<p>\u672c\u4f8b\u4f1a\u4f7f\u75281\u4e2aActivity\u548c1\u4e2aService\u3002\u6f14\u793a\u5982\u4f55\u542f\u52a8\u524d\u53f0\u670d\u52a1\uff0c\u505c\u6b62\u670d\u52a1\u3002</p>"},{"location":"android/service/start/foreground-service/#manifest","title":"manifest","text":"<p>\u5728manifest\u91cc\u6ce8\u518c<code>ForegroundDemoAct</code>\u548c<code>ForegroundService1</code>\u3002\u5e76\u4e14\u7533\u8bf7\u6743\u9650<code>FOREGROUND_SERVICE</code>\u3002</p> <p><pre><code>&lt;manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"com.rustfisher.tutorial2020\"&gt;\n\n    &lt;!--  \u524d\u53f0\u670d\u52a1\u6743\u9650  --&gt;\n    &lt;uses-permission android:name=\"android.permission.FOREGROUND_SERVICE\" /&gt;\n\n    &lt;application ...  &gt;\n\n        &lt;service android:name=\".service.foreground.ForegroundService1\" /&gt;\n\n        &lt;activity\n            android:name=\".service.foreground.ForegroundDemoAct\"\n            android:launchMode=\"singleTop\" /&gt;\n\n    &lt;/application&gt;\n&lt;/manifest&gt;\n</code></pre> Activity\u7684\u542f\u52a8\u6a21\u5f0f\u6211\u4eec\u9009\u62e9\u4e86<code>singleTop</code>\u3002\u662f\u4e3a\u4e86\u65b9\u4fbf\u6f14\u793a\u70b9\u51fb\u901a\u77e5\u65f6\u5019\u7684\u8df3\u8f6c\u6548\u679c\u3002</p>"},{"location":"android/service/start/foreground-service/#_2","title":"\u542f\u52a8\u524d\u53f0\u670d\u52a1","text":"<p>\u5728activity\u4e2d\u542f\u52a8\u670d\u52a1\uff0c\u8c03\u7528<code>startForegroundService(Intent)</code>\u65b9\u6cd5\u3002 <pre><code>startForegroundService(Intent(applicationContext, ForegroundService1::class.java))\n</code></pre></p> <p>\u7136\u540e\u5728service\u4e2d\uff0c\u9700\u8981\u5bf9\u5e94\u5730\u4f7f\u7528<code>startForeground</code>\u65b9\u6cd5\u3002 <pre><code>override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {\n    Log.d(TAG, \"onStartCommand flags:$flags, startId:$startId [$this] ${Thread.currentThread()}\")\n\n    val pendingIntent: PendingIntent =\n            Intent(this, ForegroundDemoAct::class.java).let { notificationIntent -&gt;\n                PendingIntent.getActivity(this, 0, notificationIntent, 0)\n            }\n\n    if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) {\n        val chanId = \"f-channel\"\n        val chan = NotificationChannel(chanId, \"\u524d\u53f0\u670d\u52a1channel\",\n                NotificationManager.IMPORTANCE_NONE)\n        chan.lightColor = Color.BLUE\n        chan.lockscreenVisibility = Notification.VISIBILITY_PRIVATE\n        val service = getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager\n        service.createNotificationChannel(chan)\n        Log.d(TAG, \"\u670d\u52a1\u8c03\u7528startForeground\")\n\n        val notification: Notification =\n                Notification.Builder(applicationContext, chanId)\n                        .setContentTitle(\"RustFisher\u524d\u53f0\u670d\u52a1\")\n                        .setContentText(\"https://an.rustfisher.com\")\n                        .setSmallIcon(R.drawable.f_zan_1)\n                        .setContentIntent(pendingIntent)\n                        .build()\n        startForeground(1, notification)\n    } else {\n        Log.d(TAG, \"${Build.VERSION.SDK_INT} &lt; O(API 26) \")\n    }\n    return super.onStartCommand(intent, flags, startId)\n}\n</code></pre> \u6211\u4eec\u6765\u770bservice\u91cc\u7684\u8fd9\u6bb5\u4ee3\u7801\u3002\u521b\u5efa\u4e86\u4e00\u4e2a\u7b80\u5355\u7684<code>Notification</code>\u3002</p> <ul> <li>PendingIntent\u4f1a\u88ab\u5206\u914d\u7ed9Notification\uff0c\u4f5c\u4e3a\u70b9\u51fb\u901a\u77e5\u540e\u7684\u8df3\u8f6c\u52a8\u4f5c</li> <li>\u4f7f\u7528NotificationManager\u5148\u521b\u5efa\u4e86\u4e00\u4e2aNotificationChannel</li> <li>\u7528Notification.Builder\u914d\u7f6e\u5e76\u521b\u5efa\u4e00\u4e2aNotification\uff0c\u4f8b\u5982\u914d\u7f6e\u6807\u9898\uff0c\u5185\u5bb9\u6587\u5b57\uff0c\u56fe\u6807\u7b49</li> <li>\u542f\u52a8\u524d\u53f0\u670d\u52a1\uff0c\u8c03\u7528<code>startForeground(1, notification)</code>\u65b9\u6cd5</li> </ul> <p>\u5728\u8bbe\u5907\u4e0a\u4f1a\u663e\u793a\u51fa\u4e00\u4e2a\u901a\u77e5\uff08\u4ee5OnePlus5\u4e3a\u4f8b\uff09</p> <p></p> <p>\u70b9\u51fb\u8fd9\u4e2a\u901a\u77e5\uff0c\u4f1a\u8df3\u8f6c\u5230ForegroundDemoAct\u3002\u8fd9\u662f\u4e4b\u524d\u7528PendingIntent\u8bbe\u7f6e\u7684\u3002</p>"},{"location":"android/service/start/foreground-service/#_3","title":"\u505c\u6b62\u670d\u52a1","text":"<p>\u53ef\u4ee5\u7528<code>stopService</code>\u6765\u505c\u6b62\u670d\u52a1 <pre><code>stopService(Intent(applicationContext, ForegroundService1::class.java))\n</code></pre> \u8fd9\u6837Service\u9000\u51fa\uff0c\u8d70<code>onDestroy</code>\u65b9\u6cd5\u3002</p>"},{"location":"android/service/start/foreground-service/#_4","title":"\u505c\u6b62\u524d\u53f0\u670d\u52a1","text":"<p>\u5728Service\u4e2d\u8c03\u7528<code>stopForeground(boolean)</code>\u65b9\u6cd5\uff0c\u80fd\u505c\u6b62\u524d\u53f0\uff0c\u4f46\u662f\u4e0d\u9000\u51fa\u6574\u4e2a\u670d\u52a1\u3002 \u8fd9\u4e2aboolean\u8868\u793a\u662f\u5426\u53d6\u6d88\u6389\u524d\u53f0\u670d\u52a1\u7684\u901a\u77e5\u3002false\u8868\u793a\u4fdd\u7559\u901a\u77e5\u3002</p> <p>\u4f8b\u5982\u5728Service\u4e2d\u8c03\u7528 <pre><code>stopForeground(false)\n</code></pre> \u670d\u52a1\u53d8\u6210\u4e86\u540e\u53f0\u670d\u52a1\uff0c\u5e76\u6ca1\u6709\u9000\u51fa\u3002\u6b64\u65f6\u5bf9\u5e94\u7684\u901a\u77e5\u53ef\u4ee5\u6ed1\u52a8\u53d6\u6d88\u6389\u3002</p>"},{"location":"android/service/start/foreground-service/#_5","title":"\u62a5\u9519\u4fe1\u606f","text":""},{"location":"android/service/start/foreground-service/#anr","title":"ANR","text":"<p>\u5728Activity\u4e2d\u8c03\u7528<code>startForegroundService(Intent)</code>\u542f\u52a8\u670d\u52a1\uff0c\u4f46\u662f\u4e0d\u8c03\u7528<code>Service.startForeground()</code>\u3002 \u4e00\u52a05\u624b\u673aAndroid10\u8fd0\u884clog\u5982\u4e0b <pre><code>2021-08-26 23:03:25.352 25551-25551/com.rustfisher.tutorial2020 D/rustAppUseStartService: \u8c03\u7528 startForegroundService \u4e3b\u7ebf\u7a0b\u4fe1\u606fThread[main,5,main]\n2021-08-26 23:03:25.368 25551-25551/com.rustfisher.tutorial2020 D/rustAppForeground1: onCreate Thread[main,5,main] rustfisher.com\n2021-08-26 23:03:25.370 25551-25551/com.rustfisher.tutorial2020 D/rustAppForeground1: onStartCommand flags:0, startId:1 [com.rustfisher.tutorial2020.service.foreground.ForegroundService1@c77d408] Thread[main,5,main]\n2021-08-26 23:03:35.375 1596-1720/? W/ActivityManager: Bringing down service while still waiting for start foreground: ServiceRecord{53d70f2 u0 com.rustfisher.tutorial2020/.service.foreground.ForegroundService1}\n2021-08-26 23:03:35.382 25551-25551/com.rustfisher.tutorial2020 D/rustAppForeground1: onDestroy [com.rustfisher.tutorial2020.service.foreground.ForegroundService1@c77d408] Thread[main,5,main]\n\n2021-08-26 23:03:52.956 1596-1720/? E/ActivityManager: ANR in com.rustfisher.tutorial2020\n    PID: 25551\n    Reason: Context.startForegroundService() did not then call Service.startForeground(): ServiceRecord{53d70f2 u0 com.rustfisher.tutorial2020/.service.foreground.ForegroundService1}\n</code></pre></p>"},{"location":"android/service/start/foreground-service/#bad-notification","title":"Bad notification","text":"<p>\u6211\u4eec\u5728ForegroundService1\u7684\u65b9\u6cd5<code>onStartCommand</code>\u91cc\u52a0\u5165<code>startForeground</code>\u3002 \u5982\u679c<code>startForeground(0, noti)</code>\u7684id\u4f20\u51650\uff0c\u5219\u4f1a\u62a5\u9519<code>RemoteServiceException</code>\u3002 <pre><code> 29871-29871/com.rustfisher.tutorial2020 E/AndroidRuntime: FATAL EXCEPTION: main\n    Process: com.rustfisher.tutorial2020, PID: 29871\n    android.app.RemoteServiceException: Bad notification for startForeground\n</code></pre></p>"},{"location":"android/service/start/foreground-service/#_6","title":"\u5c0f\u7ed3","text":"<ul> <li>\u901a\u8fc7<code>startForegroundService()</code>\u542f\u52a8\u524d\u53f0\u670d\u52a1\uff0c\u5fc5\u987b\u5728Service\u4e2d\u6709<code>startForeground()</code>\uff0c\u5426\u5219\u4f1aANR\uff0c\u6216\u8005\u5d29\u6e83</li> <li><code>startForeground()</code>\u4e2d\u7684<code>id</code>\u4e0d\u80fd\u4e3a0\uff0c<code>notification</code>\u4e0d\u80fd\u4e3anull</li> <li>\u670d\u52a1\u53ef\u4ee5\u9000\u51fa\u524d\u53f0<code>stopForeground</code></li> </ul>"},{"location":"android/service/start/foreground-service/#_7","title":"\u53c2\u8003","text":"<ul> <li>Service\u7efc\u8ff0 https://an.rustfisher.com/android/service/service-intro/</li> <li>Android\u524d\u53f0\u670d\u52a1 https://developer.android.com/guide/components/foreground-services</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a </p>"},{"location":"android/startProject/as-use-kotlin/","title":"Android\u9879\u76ee\u4f7f\u7528kotlin","text":"\u66f4\u65b0\u65e5\u671f 2021-9-29 <ul> <li>2021-9-29 \u4fee\u6539\u94fe\u63a5</li> <li>2021-9-1 \u66f4\u65b0\u683c\u5f0f</li> <li>2020-8-24 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u53ef\u53c2\u8003Kotlin\u6982\u5ff5\u4ecb\u7ecd</p>"},{"location":"android/startProject/as-use-kotlin/#as","title":"\u4f7f\u7528as\u5f15\u5165","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528as\u7684\u529f\u80fd\u6765\u5f15\u5165kotlin\u3002</p> <p>\u4f9d\u6b21\u70b9\u51fb <code>File &gt; New</code>\uff0c\u7136\u540e\u4ece\u5404\u79cd Android \u6a21\u677f\u4e2d\u9009\u62e9\u4e00\u4e2a\uff0c\u4f8b\u5982\u4e00\u4e2a\u65b0\u7684\u7a7a\u767d Fragment\uff0c\u5982\u56fe 1 \u6240\u793a\u3002\u5982\u679c\u60a8\u672a\u5728\u6b64\u83dc\u5355\u4e2d\u770b\u5230\u6a21\u677f\u5217\u8868\uff0c\u8bf7\u5148\u6253\u5f00 Project \u7a97\u53e3\uff0c\u7136\u540e\u9009\u62e9\u60a8\u7684\u5e94\u7528\u6a21\u5757\u3002</p> \u9009\u62e9\u6a21\u677f <p></p> <p>\u5728\u968f\u5373\u663e\u793a\u7684\u5411\u5bfc\u4e2d\uff0c\u9009\u62e9 Kotlin \u4f5c\u4e3a Source Language\u3002\u56fe 2 \u663e\u793a\u4e86\u5f53\u60a8\u8981\u521b\u5efa\u65b0 Activity \u65f6\u4f7f\u7528\u7684 New Android Activity \u5bf9\u8bdd\u6846\u3002</p> \u9009\u62e9\u5f00\u53d1\u8bed\u8a00 <p></p>"},{"location":"android/startProject/as-use-kotlin/#gradle","title":"gradle\u914d\u7f6e\u5f15\u5165","text":"\u9879\u76ee\u7684gradle <pre><code>// Project build.gradle file.\n    buildscript {\n        ext.kotlin_version = '1.3.30'\n        ...\n        dependencies {\n            classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version\"\n        }\n    }\n</code></pre> \u6a21\u5757\u7684gradle <pre><code>// Inside each module using kotlin\n    apply plugin: 'kotlin-android-extensions'\n    apply plugin: 'kotlin-android'\n\n    ...\n\n    dependencies {\n    implementation \"androidx.core:core-ktx:1.0.1\"\n    implementation \"org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version\"\n    }\n</code></pre> <p>\u9996\u6b21\u5f15\u5165kotlin\uff0cgradle\u4f1a\u82b1\u4e00\u4e9b\u65f6\u95f4\u6765\u4e0b\u8f7d\u76f8\u5173\u7684\u5e93\u6587\u4ef6\u3002</p> <p>Gradle\u4ecb\u7ecd Kotlin\u6982\u5ff5\u4ecb\u7ecd</p>"},{"location":"android/startProject/start_new_project/","title":"Android Studio \u65b0\u5efa Android App \u5de5\u7a0b","text":"\u66f4\u65b0\u65e5\u671f 2023-2-9 <ul> <li>2023-2-9 \u589e\u52a0adb\u4e0b\u8f7d\u94fe\u63a5</li> <li>2022-5-20 \u66f4\u65b0\u8bf4\u660e</li> <li>2021-10-15 \u66f4\u65b0\u89c6\u9891\u94fe\u63a5</li> <li>2020-8-24 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4e0b\u8f7d\u4e00\u4e2aAndroid Studio\uff08\u4ee5\u4e0b\u7b80\u79f0as\uff09\u5b89\u88c5\u597d\u3002\u8fd9\u91cc\u7528\u7684\u662fas3.4\u3002\u7528Windows\u6216\u8005Mac\u90fd\u884c\u3002</p> <p>\u5b98\u65b9\u7f51\u5740\u4e0d\u4e00\u5b9a\u80fd\u6253\u5f00\uff0c\u7f51\u7edc\u4e0d\u4e00\u5b9a\u597d\u7528\u3002\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5728\u522b\u7684\u5730\u65b9\u4e0b\u8f7d\u4e00\u4e2aas\u3002\u8fd9\u91cc\u6709\u767e\u5ea6\u7f51\u76d8\u94fe\u63a5\uff0c\u53ef\u4ee5\u8bd5\u8bd5\u3002</p> \u7f51\u76d8\u94fe\u63a5 <p><code>android-studio-2020.3.1.24-windows.exe</code></p> <p>\u767e\u5ea6\u7f51\u76d8\u94fe\u63a5: https://pan.baidu.com/s/1MCX0VkgmsWJRq2av7K-wdg  \u5bc6\u7801: 1bbj</p> <p>\u963f\u91cc\u4e91\u76d8\u94fe\u63a5: https://alywp.net/31NpgW</p> <p><code>android-studio-2020.3.1.24-mac.dmg</code></p> <p>\u94fe\u63a5: https://pan.baidu.com/s/1VJVe3TjswzbTHMEASTixPQ  \u5bc6\u7801: md4r</p> <p>\u628aAndroid SDK\u653e\u5728\u4f60\u559c\u6b22\u7684\u5730\u65b9\u3002\u51c6\u5907\u5b8c\u6210\u540e\u53ef\u4ee5\u5f00\u59cb\u65b0\u5efa\u5de5\u7a0b\u4e86\u3002</p>"},{"location":"android/startProject/start_new_project/#as","title":"as\u65b0\u5efa\u5de5\u7a0b","text":"<p>\u5728as\u4e0a\u65b9\u5de5\u5177\u680f\u4e2d\u9009\u62e9File\u3002 <pre><code>File -&gt; New -&gt; New Project\n</code></pre> \u5f39\u6846<code>Choose your project</code>\u53ef\u4ee5\u9009\u62e9\u9884\u8bbe\u6a21\u677f\u3002\u6211\u4eec\u9009\u62e9<code>Phone and Tablet</code>\u9009\u9879\u5361\u4e2d\u7684<code>Empty Activity</code>\u3002</p> <p>as\u9884\u7f6e\u4e86\u5927\u91cf\u7684\u6a21\u677f\u3002\u6709\u7a7a\u7684\u8bdd\u53ef\u4ee5\u4e00\u4e2a\u4e2a\u8bd5\u8bd5\u3002\u4e3a\u4e86\u7b80\u5355\u6211\u4eec\u9009\u62e9<code>Empty Activity</code>\uff0c\u7136\u540e\u70b9\u51fb<code>next</code>\u3002</p> <p>\u6765\u5230<code>Configure your project</code>\u754c\u9762\uff0c\u6211\u4eec\u53ef\u4ee5\u586b\u5165app\u7684\u540d\u5b57\uff0c\u5305\u540d\uff0c\u5b58\u50a8\u4f4d\u7f6e\uff0c\u5f00\u53d1\u8bed\u8a00\u548c\u6700\u4f4eAPI\u7248\u672c\u3002</p> <p>\u5e94\u7528\u7684\u5305\u540d\uff08Package name\uff09\u8981\u4e8b\u5148\u8003\u8651\u597d\u3002\u793a\u4f8b\u91cc\u662f <code>com.rustfisher.tutorial2020</code> \u867d\u8bf4\u5de5\u7a0b\u5efa\u7acb\u540e\u4e5f\u53ef\u4ee5\u6539\u5305\u540d\uff0c\u4f46\u540e\u9762\u518d\u6539\u4f1a\u6709\u70b9\u9ebb\u70e6\u3002</p> <p>\u4e4b\u524d\u5f88\u591aapp\u6700\u4f4eAPI\u7b49\u7ea7\u652f\u6301\u523014\u3002\u8fd9\u91cc\u4e3a\u4e86\u7b80\u5355\uff0c\u9009\u62e9API19\u3002</p> \u914d\u7f6e\u9879\u76ee\u793a\u4f8b\u56fe <p></p> <p>\u65b0\u5efa\u5de5\u7a0b\u540e\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4e0b\u65b9\u7684\u7a97\u53e3\u6709\u4e2a\u5708\u5708\u5728\u8f6c\u3002\u90a3\u4e2a\u662fgradle\u5728\u6267\u884c\u3002\u5728\u5b83syncing\u7684\u65f6\u5019\u6211\u4eec\u7b80\u7565\u770b\u770b\u5de5\u7a0b\u7ed3\u6784\u3002</p> syncing <p></p> <p>\u5982\u679c\u8981\u4f7f\u7528kotlin\uff0c\u53ef\u4ee5\u9009\u62e9kotlin\u4e3asource language\uff0c\u6216\u8005\u53c2\u8003\u8fd9\u91cc\u4f7f\u7528\u3002</p>"},{"location":"android/startProject/start_new_project/#_1","title":"\u89c2\u5bdf\u5de5\u7a0b\u7ed3\u6784","text":"<p>\u65b0\u5efa\u5de5\u7a0b\u4e2d\u6709\u4e00\u7cfb\u5217\u6587\u4ef6\u3002 <pre><code>\u251c\u2500\u2500 Tutorial2020.iml       # as\u7528\u5230\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u4e0d\u7ba1\u5b83\uff0cas\u4f1a\u81ea\u52a8\u4fee\u6539\u5b83\u7684\u3002\n\u251c\u2500\u2500 app                    # \u5e94\u7528\u76f8\u5173\u7684\u4e1c\u897f\u90fd\u5728\u91cc\u9762\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 app.iml            # as\u7528\u5230\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u4e0d\u7ba1\u5b83\uff0cas\u4f1a\u81ea\u52a8\u4fee\u6539\u5b83\u7684\u3002\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 build              # \u7f16\u8bd1\u7684\u4ea7\u7269\u3002\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u624b\u52a8\u628a\u5b83\u6574\u4e2a\u5220\u6389\u3002\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 build.gradle       # \u975e\u5e38\u91cd\u8981\uff0capp\u7684\u6784\u5efa\u914d\u7f6e\u3002\u4fd7\u79f0\u201capp\u7684gradle\u6587\u4ef6\u201d\u3002\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 libs               # \u4f9d\u8d56\u5305\u53ef\u4ee5\u653e\u8fd9\u91cc\uff0c\u6bd4\u5982\u4e00\u4e9bjar\u6587\u4ef6\u3002\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 proguard-rules.pro # \u5148\u4e0d\u7ba1\u3002\u8fd9\u4e2a\u662f\u6df7\u6dc6\u914d\u7f6e\u3002\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 src                # \u4ee3\u7801\u5728\u8fd9\u3002\u975e\u5e38\u91cd\u8981\u3002\n\u251c\u2500\u2500 build.gradle           # \u5f88\u91cd\u8981\u3002\u9879\u76ee\u7ea7\u7684\u914d\u7f6e\u3002\u4fd7\u79f0\u201c\u9879\u76eegradle\u6587\u4ef6\u201d\u3002\n\u251c\u2500\u2500 gradle                 # \u8fd9\u4e2a\u5148\u4e0d\u7528\u7ba1\n\u251c\u2500\u2500 gradle.properties      # \u5148\u4e0d\u7ba1\n\u251c\u2500\u2500 gradlew                # \u5148\u4e0d\u7ba1\n\u251c\u2500\u2500 gradlew.bat            # \u5148\u4e0d\u7ba1\n\u251c\u2500\u2500 local.properties       # \u672c\u5730\u914d\u7f6e\u6587\u4ef6\uff0c\u4e00\u822c\u4e0d\u4e0a\u4f20\n\u2514\u2500\u2500 settings.gradle        # gralde\u7684\u9879\u76ee\u7ea7\u914d\u7f6e\uff0c\u5148\u4e0d\u7ba1\n</code></pre></p> <p>\u81f3\u6b64App\u5de5\u7a0b\u65b0\u5efa\u597d\u4e86\u3002</p> <p>\u4e0b\u65b9\u547d\u4ee4\u9762\u677f\u663e\u793a\u201csynced successfully\u201d\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u7f16\u8bd1\u5b89\u88c5\u8fd0\u884capp\u4e86\u3002</p>"},{"location":"android/startProject/start_new_project/#app","title":"\u8ba9app\u8dd1\u8d77\u6765","text":"<p>\u628a\u5b89\u5353\u624b\u673a\u8fde\u63a5\u5230\u7535\u8111\u3002\u8bb0\u5f97\u6253\u5f00\u5f00\u53d1\u8005\u9009\u9879\u4e2d\u5141\u8bb8USB\u5b89\u88c5\u5e94\u7528\u3002\u5c0f\u7c73\u7cfb\u5217\u624b\u673a\u8981\u6253\u5f00\u8fd9\u4e2a\u5f00\u5173\u7684\u8bdd\uff0c\u53ef\u80fd\u8fd8\u9700\u8981\u5148\u767b\u5f55\u5c0f\u7c73\u5f00\u53d1\u8005\u8d26\u53f7\u5e76\u4e14\u63d2\u5165SIM\u5361\u3002 \u8fde\u63a5\u5230\u7535\u8111\u540e\u9009\u5141\u8bb8\u7535\u8111\u8c03\u8bd5\u3002</p> <p>as\u9876\u90e8\u5de5\u5177\u680f\u6709\u4e2a\u50cf\u64ad\u653e\u952e\u7684\u7eff\u8272\u6309\u94ae\uff0c\u540d\u5b57\u53eb\u505a\u201cRun app\u201d\u3002\u70b9\u51fb\u5f39\u51fa\u201cSelect Deployment Target\u201d\u7a97\u53e3\u3002</p> <p>\u300cConnected Devices\u300d\u4e2d\u5e94\u8be5\u6709\u4f60\u7684\u624b\u673a\uff0c\u9009\u4e2d\u5b83\u7136\u540e\u70b9\u300cOK\u300d\u3002</p> <p>\u53ef\u4ee5\u770b\u5230Build\u547d\u4ee4\u7a97\u53e3\u53c8\u5728\u5fd9\u4e86\u3002\u5b83\u7f16\u8bd1\u597d\u540e\u4f1a\u628aapp\u88c5\u5230\u624b\u673a\u4e0a\u3002\u73b0\u5728\u9ed8\u8ba4\u7684app\u989c\u8272\u98ce\u683c\u5e94\u8be5\u662f\u7eff\u8272\u7684\u3002</p> <p>Hello world</p> <p>\u793a\u4f8b\u5de5\u7a0b AndroidTutorial - gitee</p>"},{"location":"android/startProject/start_new_project/#_2","title":"\u95ee\u9898\u5904\u7406","text":"<p>\u5982\u679c\u4f7f\u7528\u7684\u662fGitHub\u4e0a\u7684\u5de5\u7a0b\uff0c\u53ef\u80fd\u4f1a\u9047\u5230\u4e00\u4e9b\u95ee\u9898\u3002</p>"},{"location":"android/startProject/start_new_project/#failed-to-find-build-tools-revision-2902","title":"Failed to find Build Tools revision 29.0.2","text":"<p>as\u63d0\u793a\u7f3a\u4e4f\u6784\u5efa\u5de5\u517729.0.2</p> <p>\u6211\u4eec\u6253\u5f00as\u7684\u9876\u90e8\u83dc\u5355 Tools - SDK Manager\u3002</p> <p>\u6216\u8005\u76f4\u63a5\u6253\u5f00\u8bbe\u7f6e\u627e\u5230Appearance &amp; Behavior &gt; System Settings &gt; Android SDK\u3002</p> SDK Manager <p></p> <p>\u76ee\u524d\u6211\u4eec\u5173\u6ce8SDK Platforms\u548cSDK Tools\u3002\u52fe\u9009\u53f3\u4e0b\u89d2\u7684Show Package Details\u53ef\u4ee5\u67e5\u770b\u66f4\u7ec6\u81f4\u7684\u7248\u672c\u4fe1\u606f\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u52fe\u9009\u4e0a\u60f3\u8981\u5b89\u88c5\u7684\u5de5\u5177\u7248\u672c\uff0c\u6216\u8005\u628a\u5df2\u5b89\u88c5\u7684\u7248\u672c\u53d6\u6d88\u6389\u3002</p> <p>\u91cc\u9762\u53ef\u4ee5\u67e5\u770bSDK\u7684\u60c5\u51b5\u3002\u52fe\u9009\u4e0a\u6211\u4eec\u7f3a\u5c11\u7684\u90a3\u4e2a\u5de5\u5177\uff0c\u70b9\u51fb\u786e\u5b9a\u5373\u53ef\u4e0b\u8f7d\u5b89\u88c5\u3002</p> <p>2020\u5e74\u56fd\u5185\u4e0b\u8f7dSDK\u901f\u5ea6\u6bd4\u4ee5\u524d\u5feb\u5f88\u591a\u4e86\u3002</p>"},{"location":"android/startProject/start_new_project/#adb-windows-64","title":"adb Windows 64\u4f4d","text":"<p>\u5728\u8fd9\u91cc\u53ef\u4ee5\u4e0b\u8f7d\u6700\u65b0\u7684Windows adb\u5de5\u5177 </p> <p>\ud83d\udc49 https://dl.google.com/android/repository/platform-tools-latest-windows.zip</p> <p>\u89e3\u538b\u540e\u6574\u4e2a\u66ff\u6362platform-tools</p>"},{"location":"android/startProject/start_new_project/#_3","title":"\u66f4\u8fdb\u4e00\u6b65","text":"<p>\u63a5\u4e0b\u6765\u6211\u4eec\u53ef\u4ee5\u8fdb\u4e00\u6b65\u4e86\u89e3\uff1a</p> <ul> <li>Activity\u7efc\u8ff0</li> <li>gradle\u7b80\u4ecb</li> </ul> <p>\u4e0b\u8f7d\u4e0e\u4f7f\u7528Android Studio\uff0c\u521b\u5efa\u793a\u4f8b\u5de5\u7a0b\uff0c\u53ef\u4ee5\u53c2\u8003\u8fd9\u4e2a\u89c6\u9891</p> <p>\u9879\u76ee\u7ed3\u6784\u7684\u4ecb\u7ecd\u89c6\u9891 - bilibili</p>"},{"location":"android/sys/adb_mock_touch_and_monkeyrunner/","title":"Android \u6a21\u62df\u7528\u6237\u70b9\u51fb","text":"\u66f4\u65b0\u65e5\u671f: 2021-12-2 <ul> <li>2021-12-2 \u66f4\u65b0\u5185\u5bb9</li> <li>2018-02-05 \u521b\u5efa\u6587\u6863</li> </ul> <p>Android\u6a21\u62df\u7528\u6237\u70b9\u51fb\u3002\u5728\u81ea\u52a8\u5316\u6d4b\u8bd5\u4e2d\u53ef\u4f7f\u7528\u7684\u5de5\u5177\u3002\u53ef\u4ee5\u5229\u7528adb\u547d\u4ee4\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528Android SDK\u4e2d\u7684<code>monkeyrunner</code>\u5de5\u5177\u3002</p>"},{"location":"android/sys/adb_mock_touch_and_monkeyrunner/#adb","title":"\u4f7f\u7528adb\u547d\u4ee4","text":"<p>\u4e3b\u8981\u4f7f\u7528input\u547d\u4ee4 <pre><code># win7\nusage: input ...\n\n       input text &lt;string&gt;\n       input keyevent &lt;key code number or name&gt;\n       input tap &lt;x&gt; &lt;y&gt;\n       input swipe &lt;x1&gt; &lt;y1&gt; &lt;x2&gt; &lt;y2&gt;\n</code></pre> keyevent\u6307\u7684\u662fandroid\u5bf9\u5e94\u7684keycode\uff0c\u6bd4\u5982home\u952e\u7684keycode=3\uff0cback\u952e\u7684keycode=4</p> <p>tap\u662ftouch\u5c4f\u5e55\u7684\u4e8b\u4ef6\uff0c\u53ea\u9700\u7ed9\u51fax\u3001y\u5750\u6807\u5373\u53ef</p> <p>swipe\u6a21\u62df\u6ed1\u52a8\u7684\u4e8b\u4ef6\uff0c\u7ed9\u51fa\u8d77\u70b9\u548c\u7ec8\u70b9\u7684\u5750\u6807\u5373\u53ef</p> <pre><code># \u6a21\u62df\u70b9\u51fb\u4f4d\u7f6e (100,100)\nadb shell input tap 100 100\n\n# \u6a21\u62df\u6ed1\u52a8 \u4ece(650, 250)\u5230(200,300)\nadb shell input swipe 650 250 200 300\n</code></pre> <p>win7\u4e0b\uff0c\u7f16\u5199\u4e00\u4e2abat\u811a\u672c\uff0c\u6a21\u62df\u7528\u6237\u6ed1\u52a8 <pre><code>@echo off\necho --------- Mock start ----------\n\n:tag_start\necho running...\nadb shell input swipe 650 250 200 666\n@ping 127.0.0.1 -n 8 &gt;nul\ngoto tag_start\n\necho --------- Mock finish ---------\npause\n</code></pre></p> <p>\u6b7b\u5faa\u73af\u53d1\u9001\u6ed1\u52a8\u547d\u4ee4\uff0c\u5ef6\u65f6\u8bed\u53e5 <pre><code>@ping 127.0.0.1 -n 8 &gt;nul\n</code></pre></p>"},{"location":"android/sys/adb_mock_touch_and_monkeyrunner/#requires-inject_events-permission","title":"requires INJECT_EVENTS permission","text":"<p>\u5728\u7ea2\u7c739\uff08Android 10\uff09\u4e0a\u5c1d\u8bd5\u4f7f\u7528adb\uff0c\u62a5SecurityException\u5f02\u5e38</p> requires INJECT_EVENTS permission <pre><code>~ $ adb shell input swipe 650 250 200 666\njava.lang.SecurityException: Injecting to another application requires INJECT_EVENTS permission\n    at android.os.Parcel.createException(Parcel.java:2074)\n    at android.os.Parcel.readException(Parcel.java:2042)\n    at android.os.Parcel.readException(Parcel.java:1990)\n    at android.hardware.input.IInputManager$Stub$Proxy.injectInputEvent(IInputManager.java:925)\n    at android.hardware.input.InputManager.injectInputEvent(InputManager.java:886)\n    at com.android.commands.input.Input.injectMotionEvent(Input.java:428)\n    at com.android.commands.input.Input.access$200(Input.java:41)\n    at com.android.commands.input.Input$InputSwipe.sendSwipe(Input.java:258)\n    at com.android.commands.input.Input$InputSwipe.run(Input.java:242)\n    at com.android.commands.input.Input.onRun(Input.java:108)\n    at com.android.internal.os.BaseCommand.run(BaseCommand.java:56)\n    at com.android.commands.input.Input.main(Input.java:71)\n    at com.android.internal.os.RuntimeInit.nativeFinishInit(Native Method)\n    at com.android.internal.os.RuntimeInit.main(RuntimeInit.java:380)\nCaused by: android.os.RemoteException: Remote stack trace:\n    at com.android.server.input.InputManagerService.injectInputEventInternal(InputManagerService.java:735)\n    at com.android.server.input.InputManagerService.injectInputEvent(InputManagerService.java:709)\n    at android.hardware.input.IInputManager$Stub.onTransact(IInputManager.java:422)\n    at android.os.Binder.execTransactInternal(Binder.java:1021)\n    at android.os.Binder.execTransact(Binder.java:994)\n</code></pre> <p>\u5728\u5f00\u53d1\u8005\u9009\u9879\u91cc\uff0c\u6253\u5f00\u300cUSB\u8c03\u8bd5\uff08\u5b89\u5168\u8bbe\u7f6e\uff09\u300d\u9009\u9879</p>"},{"location":"android/sys/adb_mock_touch_and_monkeyrunner/#monkeyrunner","title":"monkeyrunner","text":"<p>\u73af\u5883\u914d\u7f6e\uff0c\u914d\u7f6e\u597dJava\u4e0eAndroid SDK\u7684\u73af\u5883\u53d8\u91cf\u3002\u624b\u673a\u8fde\u63a5\u5230\u7535\u8111\u3002 \u7cfb\u7edf\u53d8\u91cf\u4e2d\u52a0\u5165<code>ANDROID_SWT</code>\uff0c\u6b64\u4f8b\u4e2d\u8def\u5f84\u4e3a<code>G:\\SDK\\tools\\lib\\x86_64</code></p> <p>\u4fee\u6539\u540e\u7684\u811a\u672c<code>rustmonkeyrunner.bat</code>\uff0cWindows\u73af\u5883\u4e0b\u9700\u8981\u5728gitbash\u6216CMD\u91cc\u8fd0\u884c</p> <p>\u6765\u81eaunable-to-access-jarfile-framework-monkeyrunner-25-3-2-jar <pre><code>@echo off\nrem Copyright (C) 2010 The Android Open Source Project\nrem\nrem Licensed under the Apache License, Version 2.0 (the \"License\");\nrem you may not use this file except in compliance with the License.\nrem You may obtain a copy of the License at\nrem\nrem      http://www.apache.org/licenses/LICENSE-2.0\nrem\nrem Unless required by applicable law or agreed to in writing, software\nrem distributed under the License is distributed on an \"AS IS\" BASIS,\nrem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nrem See the License for the specific language governing permissions and\nrem limitations under the License.\n\nrem don't modify the caller's environment\nsetlocal\n\nrem Set up prog to be the path of this script, including following symlinks,\nrem and set up progdir to be the fully-qualified pathname of its directory.\nset prog=%~f0\n\nrem Change current directory and drive to where the script is, to avoid\nrem issues with directories containing whitespaces.\ncd /d %~dp0\n\nrem Check we have a valid Java.exe in the path.\nset java_exe=\ncall ..\\lib\\find_java.bat\nif not defined java_exe goto :EOF\nfor /f %%a in (\"%APP_HOME%\\lib\\monkeyrunner-25.3.2.jar\") do set jarfile=%%~nxa\nset frameworkdir=.\nset libdir=\n\nif exist %frameworkdir%\\%jarfile% goto JarFileOk\n    set frameworkdir=..\\lib\n\nif exist %frameworkdir%\\%jarfile% goto JarFileOk\n    set frameworkdir=..\\framework\n\n:JarFileOk\n\nset jarpath=%frameworkdir%\\%jarfile%\n\nif not defined ANDROID_SWT goto QueryArch\n    set swt_path=%ANDROID_SWT%\n    goto SwtDone\n\n:QueryArch\n\n    for /f \"delims=\" %%a in ('%frameworkdir%\\..\\bin\\archquery') do set swt_path=%frameworkdir%\\%%a\n\n:SwtDone\n\nif exist \"%swt_path%\" goto SetPath\n    echo SWT folder '%swt_path%' does not exist.\n    echo Please set ANDROID_SWT to point to the folder containing swt.jar for your platform.\n    exit /B\n\n:SetPath\n\ncall \"%java_exe%\" -Xmx512m \"-Djava.ext.dirs=%frameworkdir%;%swt_path%\" -Dcom.android.monkeyrunner.bindir=..\\..\\platform-tools -jar %jarpath% %*\n</code></pre></p> <p>\u8fd0\u884c\u811a\u672c <pre><code>Administrator@rust-PC ~\n$ /cygdrive/g/SDK/tools/bin/rustmonkeyrunner.bat\nJython 2.5.3 (2.5:c56500f08d34+, Aug 13 2012, 14:54:35)\n[Java HotSpot(TM) 64-Bit Server VM (Oracle Corporation)] on java1.8.0_77\n</code></pre></p> <p>\u9996\u6b21\u8fd0\u884c\u65f6import\u6a21\u5757\u8fdf\u8fdf\u6ca1\u6709\u53cd\u5e94 <pre><code>&gt;&gt;&gt; from com.android.monkeyrunner import MonkeyRunner, MonkeyDevice, MonkeyImage\n</code></pre></p> <p>\u5c1d\u8bd5\u8fd0\u884c\u811a\u672c<code>an_test2.py</code></p> <pre><code>import os\n\nprint(\"importing module...\")\nfrom com.android.monkeyrunner import MonkeyRunner, MonkeyDevice, MonkeyImage\n\nprint(\"waiting for connection...\")\ndevice = MonkeyRunner.waitForConnection()\nprint(\"device found!\")\n\ns_wid = int(device.getProperty(\"display.width\"))     # \u83b7\u53d6\u5c4f\u5e55\u5bbd\u5ea6\u50cf\u7d20\ns_height = int(device.getProperty(\"display.height\")) # \u83b7\u53d6\u5c4f\u5e55\u9ad8\u5ea6\u50cf\u7d20\n\nprint(\"build.version.sdk \" + str(device.getProperty(\"build.version.sdk\")))\nprint(\"display.width     \" + str(s_wid))\nprint(\"display.height    \" + str(s_height))\n\ndrag_point_left_x = 20\ndrag_point_right_x = s_wid - 20\ndrag_point_y = s_height / 2\n\nfor i in range(0, 10):\n    print(\"current loop is \" + str(i))\n    device.drag((drag_point_right_x, drag_point_y), (drag_point_left_x, drag_point_y), 1.0, 50)\n    print(\"waiting...\")\n    MonkeyRunner.sleep(1)\n    print(\"continue\")\n    device.drag((drag_point_left_x, drag_point_y), (drag_point_right_x, drag_point_y), 0.5, 3)\n    MonkeyRunner.sleep(3)\n\nprint(\"-------- finish --------\")\n</code></pre> <p>\u547d\u4ee4\u884c\u76f4\u63a5\u6267\u884c\uff0c\u53ef\u4ee5\u770b\u5230\u6267\u884c\u7ed3\u679c\u548c\u76f8\u5e94\u7684\u62a5\u9519\u4fe1\u606f <pre><code>C:\\Users\\Administrator&gt;G:\\SDK\\tools\\bin\\rustmonkeyrunner.bat H:\\fisher_p\\py_ws\\an_test2.py\nimporting module...\nwaiting for connection...\ndevice found!\nbuild.version.sdk 23\ndisplay.width     1440\ndisplay.height    2560\ncurrent loop is 0\nwaiting...\ncontinue\ncurrent loop is 1\n# .....\n-------- finish --------\n</code></pre> \u6d4b\u8bd5\u4e2d\u53d1\u73b0\uff0c\u811a\u672c\u53ef\u4ee5\u8fd0\u884c\u5728\u7cfb\u7edfapp\u3002\u82e5\u5f53\u524d\u6253\u5f00\u7684\u662f\u7b2c\u4e09\u65b9app\uff0c\u4f1a\u76f4\u63a5\u62a5\u9519\uff0c\u83b7\u53d6\u4e0d\u5230\u76f8\u5e94\u4fe1\u606f</p>"},{"location":"android/sys/adb_mock_touch_and_monkeyrunner/#_1","title":"\u53c2\u8003","text":"<ul> <li>monkeyrunner \u83b7\u53d6\u7cfb\u7edf\u4fe1\u606f</li> <li>Android MonkeyDevice - Google</li> </ul>"},{"location":"android/sys/anr-intro/","title":"Android ANR","text":""},{"location":"android/sys/anr-intro/#anr","title":"ANR\u662f\u4ec0\u4e48","text":"<p>ANR,\u662f\u201cApplication Not Responding\u201d\u7684\u7f29\u5199,\u5373\u201c\u5e94\u7528\u7a0b\u5e8f\u65e0\u54cd\u5e94\u201d\u3002 \u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u4e3b\u7ebf\u7a0b\u5728\u8d85\u65f6\u65f6\u95f4\u5185\u5bf9\u8f93\u5165\u4e8b\u4ef6\u6ca1\u6709\u5904\u7406\u5b8c\u6bd5,\u6216\u8005\u5bf9\u7279\u5b9a\u64cd\u4f5c\u6ca1\u6709\u6267\u884c\u5b8c\u6bd5,\u5c31\u4f1a\u51fa\u73b0 ANR\u3002 \u5728Android4.4\u4ee5\u540e\u7248\u672c\u4e0a,\u5f00\u53d1\u8005\u53ef\u4ee5\u9009\u62e9\u76d1\u89c6ContentProvider\u5b50\u7ebf\u7a0b\u7684ANR\u8d85\u65f6\u3002</p>"},{"location":"android/sys/anr-intro/#anr_1","title":"ANR\u7684\u4e09\u6761\u4ef6","text":"<p>\u4e3b\u7ebf\u7a0b:\u53ea\u6709\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u7684\u4e3b\u7ebf\u7a0b\u54cd\u5e94\u8d85\u65f6\u624d\u4f1a\u4ea7\u751f ANR</p> <p>\u7528\u6237\u8f93\u5165/\u7279\u5b9a\u64cd\u4f5c:\u7528\u6237\u8f93\u5165\u662f\u6307\u6309\u952e\u3001\u89e6\u5c4f\u7b49\u8bbe\u5907\u8f93\u5165\u4e8b\u4ef6;\u7279\u5b9a\u64cd\u4f5c\u662f\u6307BroadcastReceiver \u548cService \u7684 \u751f\u547d\u5468\u671f\u4e2d\u7684\u5404\u4e2a\u51fd\u6570\u3002\u4ea7\u751f\u4e2a\u51fd\u6570\u3002\u4ea7\u751f ANR \u7684\u4e0a\u4e0b\u6587\u4e0d\u540c,\u62a5\u51fa ANR \u7684\u539f\u56e0\u4e5f\u4f1a\u4e0d\u540c\u3002</p>"},{"location":"android/sys/anr-intro/#anr_2","title":"ANR\u95ee\u9898\u7684\u7c7b\u578b","text":"<ul> <li>Input dispatching\u8d85\u65f6\u3002</li> <li>BroadcastReceiver \u6267\u884c\u8d85\u65f6\u3002</li> <li>Service \u5404\u751f\u547d\u5468\u671f\u51fd\u6570\u6267\u884c\u8d85\u65f6\u3002</li> <li>ContentProvider \u76f8\u5173\u64cd\u4f5c\u6267\u884c\u8d85\u65f6\u3002</li> </ul> <p>\u5728\u5f00\u59cb\u5206\u6790\u524d,\u4e00\u5b9a\u8981\u5148\u660e\u786e\u662f\u54ea\u7c7bANR\u3002</p> <p>Input dispatching\u8d85\u65f6 \u7528\u6237\u8f93\u5165\u4e8b\u4ef6\u5904\u7406\u8d85\u65f6 \u7a97\u53e3\u83b7\u53d6\u7126\u70b9\u8d85\u65f6</p>"},{"location":"android/sys/anr-intro/#_1","title":"\u7528\u6237\u8f93\u5165\u4e8b\u4ef6\u5904\u7406\u8d85\u65f6","text":"<p>\u539f\u56e0:\u4e3b\u7ebf\u7a0b\u5bf9\u8f93\u5165\u4e8b\u4ef6\u5728 5 \u79d2\u5185\u6ca1\u6709\u5904\u7406\u5b8c\u6bd5 \u63d0\u793a\u8bed:Reason: Input dispatching timed out (Waiting because the focused window has not finished processing the input events that were previously delivered to it.)</p> <p>\u4ea7\u751f\u8fd9\u79cd ANR \u7684\u524d\u63d0\u662f\u8981\u6709\u8f93\u5165\u4e8b\u4ef6,\u5982\u679c\u7528\u6237\u6ca1\u6709\u89e6\u53d1\u4efb\u4f55\u8f93\u5165\u4e8b\u4ef6\uff0c\u5373\u4fbf\u662f\u4e3b\u7ebf\u7a0b\u963b\u585e\u4e86,\u4e5f\u4e0d\u4f1a\u4ea7\u751fANR\uff0c\u56e0\u4e3a  InputDispatcher \u6ca1\u6709\u5206\u53d1\u4e8b\u4ef6\u7ed9\u5e94\u7528\u7a0b\u5e8f, \u5f53\u7136\u4e5f\u4e0d\u4f1a\u68c0\u6d4b\u5904\u7406\u8d85\u65f6\u548c\u62a5\u544a ANR \u4e86\u3002</p>"},{"location":"android/sys/anr-intro/#anr-","title":"ANR\u6a21\u62df - \u4e3b\u7ebf\u7a0b\u8d85\u65f6\u672a\u54cd\u5e94","text":"<p>\u73b0\u5728\u6a21\u62df\u4e00\u4e0b\u4e3b\u7ebf\u7a0b\u8d85\u65f6\u672a\u54cd\u5e94\uff1b \u65b0\u5efa\u4e00\u4e2atestanre app\uff0c\u5728MainActivity.java\u4e2d\u5b9a\u4e492\u4e2abutton <pre><code>public class MainActivity extends Activity {\n    private TextView tv1;\n    private Button btn1;\n    private Button btn2;\n    private int pushButton2 = 0;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        tv1 = (TextView) findViewById(R.id.tv1);\n        btn1 = (Button) findViewById(R.id.btn1);\n        btn2 = (Button) findViewById(R.id.btn2);\n        btn1.setOnClickListener(new OnClickListener() {\n            @Override\n            public void onClick(View arg0) {\n                try {\n                    Thread.sleep(11 * 1000);//\u4e3b\u7ebf\u7a0b\u7b49\u5f85\n                } catch (InterruptedException e) {\n                    Log.e(\"rust\", \"DEAD\");\n                }\n            }\n        });\n\n        btn2.setOnClickListener(new OnClickListener() {\n            @Override\n            public void onClick(View arg0) {\n                pushButton2++;\n                tv1.setText(\"U push button2 :\" + pushButton2);\n            }\n        });\n    }\n}\n</code></pre> app\u88c5\u5230\u673a\u5668\u4e0a\uff0c\u70b9\u51fbbtn2\uff0c\u770b\u5230\u6570\u5b57\u589e\u52a0\uff1b\u70b9\u51fbbtn1\uff0c\u4e3b\u7ebf\u7a0b\u8fdb\u5165\u6b7b\u5faa\u73af\uff0c\u518d\u70b9\u51e0\u4e0bbtn2\u4e5f\u6ca1\u53cd\u5e94 \u4ea7\u751fANR\u540e\uff0c\u751f\u6210/data/anr/traces.txt\u6587\u4ef6 <pre><code>10-14 14:47:23.079: E/ActivityManager(2835): ANR in com.rust.testanre (com.rust.testanre/.MainActivity)\n10-14 14:47:23.079: E/ActivityManager(2835):   98% 10614/com.rust.testanre: 98% user + 0.3% kernel / faults: 1711 minor\n10-14 14:47:23.079: E/ActivityManager(2835):   100% 10614/com.rust.testanre: 100% user + 0% kernel\n10-14 14:47:23.079: E/ActivityManager(2835):     100% 10614/m.rust.testanre: 100% user + 0% kernel\n10-14 14:47:35.775: E/CRASHLOG(2533): CRASH   683c4835534e7bb4572b  2015-10-14/14:47:35  ANR /data/logs/crashlog5\n10-14 14:47:45.927: I/art(10614): Thread[5,tid=10622,WaitingInMainSignalCatcherLoop,Thread*=0x7f5269c2a400,peer=0x12c000a0,\"Signal Catcher\"]: reacting to signal 3\n10-14 14:47:45.984: I/art(10614): Wrote stack traces to '/data/anr/traces.txt'\n</code></pre> \u4e3b\u7ebf\u7a0b\u4e2d\u4e0d\u80fd\u6267\u884c\u8017\u65f6\u8fc7\u957f\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982\u64cd\u4f5c\u7f51\u7edc\u6216\u6570\u636e\u5e93\uff0c\u9ad8\u8017\u65f6\u7684\u8ba1\u7b97\uff0c\u5927\u91cf\u6570\u636e\u7684\u6392\u5e8f\u8ba1\u7b97\u7b49\u7b49 \u8fd9\u4e9b\u5e94\u8be5\u653e\u5230\u5b50\u7ebf\u7a0b\u4e2d\u8fdb\u884c\uff1b\u628a\u4e0a\u9762\u7684\u6b7b\u5faa\u73af\u653e\u5165\u5b50\u7ebf\u7a0b\u4e2d <pre><code>        btn1.setOnClickListener(new OnClickListener() {\n            @Override\n            public void onClick(View arg0) {\n                new Thread(new Runnable(){\n                    @Override\n                    public void run() {\n                        while(true){}//\u65b0\u542f\u4e00\u4e2a\u5b50\u7ebf\u7a0b\u6765\u8fd0\u884c\u6b7b\u5faa\u73af\n                    }\n                }).start();\n            }\n        });\n</code></pre> \u8fd0\u884c\u7a0b\u5e8f\uff0c\u70b9\u51fbbtn1\u540e\uff0cbtn2\u4e0d\u53d7\u4ec0\u4e48\u5f71\u54cd</p> <p>\u51fa\u73b0\u6b64\u7c7b\u578bANR\u65f6\uff0c\u91cd\u70b9\u68c0\u67e5\u4e3b\u7ebf\u7a0b\u4e2d\u6709\u6ca1\u6709\u8017\u65f6\u7684\u64cd\u4f5c\uff0c\u662f\u5426\u5b58\u5728\u6b7b\u5faa\u73af  </p> <p>\u5982\u679c\u5728MainActivity\u7684onPause()\u65b9\u6cd5\u4e2d\u5b58\u5728\u6b7b\u5faa\u73af\uff0cMainActivity\u7b2c\u4e00\u6b21\u8fd0\u884c\u65f6\u6b63\u5e38\uff1b\u4e00\u65e6\u5c1d\u8bd5\u8df3\u8f6c\u53bbSecondActivity\uff0c\u4f1a\u9ed1\u5c4f \u70b9\u51fb\u4e00\u4e0b\u5c4f\u5e55\uff0clog\u5982\u4e0b</p> <p><pre><code>10-14 17:03:33.592: I/InputDispatcher(2835): Dropping event because there is no touchable window at (941, 701).\n</code></pre> \u70b9\u51fb\u8fd4\u56de\u952e\uff0c\u5c1d\u8bd5\u56de\u5230MainActivity\uff0c\u4ea7\u751fANR</p> <p>\u5728activity\u751f\u547d\u5468\u671f\u7684\u5404\u4e2a\u65b9\u6cd5\u91cc\uff0c\u4e0d\u80fd\u51fa\u73b0\u6b7b\u5faa\u73af</p>"},{"location":"android/sys/anr-intro/#anr-anr","title":"\u4ea7\u751f ANR \u7684\u4e0a\u4e0b\u6587\u4e0d\u540c\uff0c\u62a5\u51fa ANR \u7684\u539f\u56e0\u4e5f\u4f1a\u4e0d\u540c\u3002","text":""},{"location":"android/sys/anr-intro/#_2","title":"\u7a97\u53e3\u83b7\u53d6\u7126\u70b9\u8d85\u65f6","text":"<p>\u539f\u56e0: \u7126\u70b9\u5e94\u7528\u57285 \u79d2\u5185\u6ca1\u6709\u83b7\u5f97\u7a97\u53e3\u7126\u70b9 \u63d0\u793a\u8bed:Reason: Input dispatching timed out (Waiting because no window has focus but there is a  focused application that may eventually add a window when it finishes starting up.)</p>"},{"location":"android/sys/anr-intro/#broadcastreceiver","title":"BroadcastReceiver \u6267\u884c\u8d85\u65f6","text":"<p>\u539f\u56e0: \u4e3b\u7ebf\u7a0b\u5728\u6267\u884c BroadcastReceiver \u7684 onReceive \u51fd\u6570\u65f610/60 \u79d2\u5185\u6ca1\u6709\u6267\u884c\u5b8c\u6bd5 \u63d0\u793a\u8bed:Reason: Broadcast of Intent { act=android.net.wifi.WIFI_STATE_CHANGED flg=0x4000010 cmp=com.android.settings/.widget.SettingsAppWidget Provider (has extras) }</p> <p>BroadcastReceiver\u7684 onReceive \u51fd\u6570\u8fd0\u884c\u5728\u4e3b\u7ebf\u7a0b\u4e2d,\u5f53\u8fd9\u4e2a\u51fd\u6570\u8d85\u8fc7 10\u79d2\u949f\u6ca1\u6709\u8fd4\u56de\u5c31\u4f1a\u89e6\u53d1 ANR\u3002\u4e0d\u8fc7\u5bf9 \u8fd9\u79cd\u60c5\u51b5\u7684 ANR \u7cfb\u7edf\u4e0d\u4f1a\u663e\u793a\u5bf9\u8bdd\u6846\u63d0\u793a,\u4ec5\u662f\u8f93\u51fa log \u800c\u5df2\u3002</p>"},{"location":"android/sys/anr-intro/#service","title":"Service \u5404\u751f\u547d\u5468\u671f\u51fd\u6570\u6267\u884c\u8d85\u65f6","text":"<p>\u539f\u56e0: \u4e3b\u7ebf\u7a0b\u5728\u6267\u884c Service \u7684\u5404\u4e2a\u751f\u547d\u5468\u671f\u51fd\u6570\u65f6 20 \u79d2\u5185\u6ca1\u6709\u6267\u884c\u5b8c\u6bd5</p> <p>\u63d0\u793a\u8bed:Reason: Executing service com.android.bluetooth/.btservice.AdapterService Service \u7684\u5404\u4e2a\u751f\u547d\u5468\u671f\u51fd\u6570,\u5982OnStart\u3001OnCreate\u3001OnStop\u4e5f\u8fd0\u884c\u5728\u4e3b\u7ebf\u7a0b\u4e2d,\u5f53\u8fd9\u4e9b\u51fd\u6570\u8d85\u8fc7 20 \u79d2\u949f\u6ca1\u6709 \u8fd4\u56de\u5c31\u4f1a\u89e6\u53d1 ANR\u3002\u540c\u6837\u5bf9\u8fd9\u79cd\u60c5\u51b5\u7684 ANR \u7cfb\u7edf\u4e5f\u4e0d\u4f1a\u663e\u793a\u5bf9\u8bdd\u6846\u63d0\u793a,\u4ec5\u662f\u8f93\u51fa log\u3002</p>"},{"location":"android/sys/anr-intro/#contentprovider","title":"ContentProvider \u76f8\u5173\u64cd\u4f5c\u6267\u884c\u8d85\u65f6","text":"<p>\u539f\u56e0: \u4e3b\u7ebf\u7a0b\u5728\u6267\u884c ContentProvider \u76f8\u5173\u64cd\u4f5c\u65f6\u6ca1\u6709\u5728\u89c4\u5b9a\u7684\u65f6\u95f4\u5185\u6267\u884c\u5b8c\u6bd5\u3002 \u63d0\u793a\u8bed:Reason: ContentProvider not responding</p>"},{"location":"android/sys/anr-intro/#44","title":"4.4\u65b0\u589e\u529f\u80fd,\u7531\u5e94\u7528\u7a0b\u5e8f\u81ea\u884c\u8bbe\u7f6e\u662f\u5426\u542f\u7528\u4ee5\u53ca\u8d85\u65f6\u65f6\u95f4\u3002","text":"<p>ContentProviderClient.java beforeRemote() :\u4f8b\u5982 query \u51fd\u6570\u5f00\u59cb\u6267\u884c\u6b64\u65b9\u6cd5 afterRemote :\u4f8b\u5982 query \u51fd\u6570\u7ed3\u675f\u65f6\u6267\u884c\u6b64\u65b9\u6cd5 setDetectNotResponding() :\u63d0\u4f9b\u7ed9\u5e94\u7528\u81ea\u884c\u8bbe\u7f6e\u662f\u5426\u542f\u7528\u6b64\u529f\u80fd</p> <p>ContentProvider \u76f8\u5173\u64cd\u4f5c\u6267\u884c\u8d85\u65f6 \u6e90\u7801\u4e2d\u53ea\u53d1\u73b0\u4e00\u5904\u542f\u7528\u6b64\u529f\u80fd\u7684\u4ee3\u7801: DocumentsUI/src/com/android/documentsui/DocumentsApplication.java</p>"},{"location":"android/sys/anr-intro/#anr_3","title":"\u5e94\u7528\u5982\u4f55\u907f\u514dANR?","text":"<p>\u4e0d\u8981\u5047\u8bbe\u4e00\u4e2a\u64cd\u4f5c\u4e0d\u8017\u65f6</p> <p>\u907f\u514d\u5c06\u8017\u65f6\u7684\u64cd\u4f5c\u653e\u5728\u4e3b\u7ebf\u7a0b,\u8017\u65f6\u64cd\u4f5c\u5305\u62ec:</p> <ul> <li>\u6570\u636e\u5e93\u64cd\u4f5c\u3002 \u6570\u636e\u5e93\u64cd\u4f5c\u5c3d\u91cf\u91c7\u7528\u5f02\u6b65\u65b9\u6cd5\u505a\u5904\u7406</li> <li>\u521d\u59cb\u5316\u7684\u6570\u636e\u548c\u63a7\u4ef6\u592a\u591a</li> <li>\u9891\u7e41\u7684\u521b\u5efa\u7ebf\u7a0b\u6216\u8005\u5176\u5b83\u5927\u5bf9\u8c61;</li> <li>\u52a0\u8f7d\u8fc7\u5927\u6570\u636e\u548c\u56fe\u7247;</li> <li>\u5bf9\u5927\u6570\u636e\u6392\u5e8f\u548c\u5faa\u73af\u64cd\u4f5c;</li> <li>\u8fc7\u591a\u7684\u5e7f\u64ad\u548c\u6ee5\u7528\u5e7f\u64ad;</li> <li>\u5927\u5bf9\u8c61\u7684\u4f20\u9012\u548c\u5171\u4eab;</li> <li>\u8bbf\u95ee\u7f51\u7edc</li> </ul>"},{"location":"android/sys/anr-intro/#anr_4","title":"\u5982\u4f55\u5206\u6790ANR?","text":"<ul> <li>\u95ee\u81ea\u5df1\u4e09\u4e2a\u95ee\u9898</li> <li>\u5e94\u7528\u7a0b\u5e8f\u4e3b\u7ebf\u7a0b\u5728\u505a\u4ec0\u4e48?</li> <li>CPU\u5360\u7528\u7387\u591a\u9ad8?</li> <li>\u5185\u5b58\u4f7f\u7528\u91cf\u591a\u9ad8?</li> </ul>"},{"location":"android/sys/anr-intro/#_3","title":"\u5e94\u7528\u7a0b\u5e8f\u4e3b\u7ebf\u7a0b\u5728\u505a\u4ec0\u4e48?","text":"<ul> <li>\u963b\u585e</li> <li>\u6b7b\u5faa\u73af</li> <li>\u4f4e\u6027\u80fd</li> </ul>"},{"location":"android/sys/anr-intro/#cpu","title":"CPU\u5360\u7528\u7387\u591a\u9ad8?","text":"<ul> <li>\u5e94\u7528\u662f\u5426CPU\u5360\u7528\u7387\u8fc7\u9ad8?</li> <li>\u5e94\u7528\u7684\u670d\u52a1\u7aef\u662f\u5426CPU\u5360\u7528\u7387\u8fc7\u9ad8?</li> <li>\u7cfb\u7edf\u670d\u52a1\u662f\u5426CPU\u5360\u7528\u7387\u8fc7\u9ad8?</li> <li>\u7cfb\u7edfIOWait\u662f\u5426\u8fc7\u9ad8?</li> <li>\u5355\u6838\u8bbe\u5907\u4e0a\u662f\u5426CPU\u5360\u7528\u7387100%?</li> <li>\u591a\u6838\u8bbe\u5907\u662f\u5426\u53ea\u542f\u52a8\u4e86\u4e00\u4e2aCPU?</li> <li>\u591a\u6838\u8bbe\u5907\u4e0a\u5404CPU\u7684\u5360\u7528\u7387\u5982\u4f55?</li> </ul>"},{"location":"android/sys/anr-intro/#_4","title":"\u5185\u5b58\u4f7f\u7528\u91cf\u591a\u9ad8?","text":"<ul> <li>\u5e94\u7528\u662f\u5426\u51fa\u73b0\u4e86Out of memory</li> <li>\u5e94\u7528\u662f\u5426\u5728\u9891\u7e41GC?</li> <li>\u5e94\u7528GC\u65f6\u95f4\u662f\u5426\u8fc7\u957f?</li> <li>\u5e94\u7528\u7684\u5185\u5b58\u4f7f\u7528\u91cf\u662f\u5426\u591f\u9ad8?</li> <li>\u7cfb\u7edf\u5185\u5b58\u5269\u4f59\u591a\u5c11?</li> <li>\u7cfb\u7edf\u5185\u5b58\u810f\u9875\u662f\u5426\u8fc7\u591a?</li> <li>\u7cfb\u7edf\u662f\u5426\u51fa\u73b0\u4e86OOM\u9519\u8bef?</li> </ul> <p>System.log\u4e2d\u7684\u4fe1\u606f ANR\u53d1\u751f\u7684\u7b2c\u4e00\u73b0\u573a\uff0c\u6bd4\u5982Input event dispatching timed out sending to ...</p> <p>\u901a\u8fc7ANR\u7b2c\u4e00\u73b0\u573a\u7684\u65f6\u95f4\u548cANR\u7c7b\u578b,\u53ef\u4ee5\u627e\u5230\u51fa\u9519\u65f6\u95f4\u6bb5, \u538b\u7f29\u9700\u8981\u5206\u6790\u7684\u65f6\u95f4\u8303\u56f4</p>"},{"location":"android/sys/device-build-version/","title":"Android \u5173\u4e8e\u8bbe\u5907\u7248\u672c\u53f7","text":"<p>\u8bbe\u5907\u4fe1\u606f\u53ef\u4ee5\u5728 Settings - About \u91cc\u770b\u5230</p> <p>\u6700\u8fd1\u60f3\u6539\u673a\u5668\u7684build number\uff0c\u627e\u5230\u4e86<code>build/core/Makefile</code>\u91cc\u7684\u5b9a\u4e49 <pre><code># Display parameters shown under Settings -&gt; About Phone\n\nifeq ($(TARGET_BUILD_VARIANT),user)\n  # User builds should show:\n  # release build number or branch.buld_number non-release builds\n\n  # Dev. branches should have DISPLAY_BUILD_NUMBER set\n  ifeq \"true\" \"$(DISPLAY_BUILD_NUMBER)\"\n    BUILD_DISPLAY_ID := $(BUILD_ID)-$(BUILD_NUMBER) $(BUILD_KEYS)\n  else\n    BUILD_DISPLAY_ID := $(BUILD_ID) $(BUILD_KEYS)\n  endif\nelse\n  # Non-user builds should show detailed build information\n  BUILD_DISPLAY_ID := $(build_desc)\nendif\n</code></pre></p> <p>\u53ef\u770b\u51fa\u975euser\u7248BUILD_DISPLAY_ID\u7528\u7684\u662fbuild_desc</p> <p>\u53ef\u4ee5\u641c\u7d22\u5230</p> <p><code>build_desc := $(TARGET_PRODUCT)-$(TARGET_BUILD_VARIANT) $(PLATFORM_VERSION) $(BUILD_ID) $(BUILD_NUMBER) $(BUILD_VERSION_TAGS)</code></p> <p>\u6253\u5f00<code>build/core/build_id.mk</code>\uff0c\u53ef\u4ee5\u4fee\u6539<code>BUILD_ID</code></p> <p>\u91cd\u65b0\u7f16\u8bd1\u4ee3\u7801\u5373\u53ef</p> <p>\u6e90\u7801 <code>Build.java</code> (base/core/java/android/os) \u6709\u5bf9\u8fd9\u4e9b\u4fe1\u606f\u7684\u5f15\u7528</p> <p>\u60f3\u8981\u5728apk\u4e2d\u53d6\u5f97\u7684\u8bdd\uff0c\u76f4\u63a5\u8c03\u7528Build\u8fd9\u4e2a\u7c7b\u5373\u53ef</p> <p>\u4f8b\u5982\uff1a<code>Build.DISPLAY</code>  \u8fd4\u56de\u7684\u5c31\u662f\u4e00\u4e2aString</p> <pre><code>    /** A build ID string meant for displaying to the user */\n    public static final String DISPLAY = getString(\"ro.build.display.id\");\n</code></pre>"},{"location":"android/sys/device-build-version/#build","title":"Build\u76f8\u5173\u4fe1\u606f","text":"<p>\u6253\u5370\u51fa\u5404\u4e2a\u72b6\u6001\u4fe1\u606f <pre><code>  Log.d(TAG, \"Build.DISPLAY: \" + Build.DISPLAY);\n  Log.d(TAG, \"Build.ID: \" + Build.ID);\n  Log.d(TAG, \"Build.PRODUCT: \" + Build.PRODUCT);\n  Log.d(TAG, \"Build.BOARD: \" + Build.BOARD);\n  Log.d(TAG, \"Build.DEVICE: \" + Build.DEVICE);\n\n// Build.DISPLAY: KTU84P\n// Build.ID: KTU84P\n// Build.PRODUCT: gucci\n// Build.BOARD: msm8916\n// Build.DEVICE: gucci\n</code></pre></p> <p>\u53ef\u4ee5\u4ece<code>Build</code>\u7c7b\u4e2d\u83b7\u53d6\u8bbe\u5907\u7684\u76f8\u5173\u4fe1\u606f\uff1b\u7ed3\u5408\u65f6\u95f4\u6233\u6765\u7528\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u65e5\u5fd7\u6587\u4ef6\u540d\u3002 <pre><code>private static final long TIME_7_DAYS_MM = 1000 * 60 * 60 * 24 * 7; // 7 days in millisecond\n\n    private String timestamp() {\n        SimpleDateFormat format = new SimpleDateFormat(\"yyyy-MM-dd_HH-MM-SS\", Locale.CHINA);\n        return format.format(new Date(System.currentTimeMillis()));\n    }   // 2017-12-26_11-35-14\n\n    private void myDeviceId() {\n        String id = Build.BRAND + \"-\" + Build.MODEL + \"-\" + Build.DEVICE + \"-\" + Build.ID;\n        id = id.replace(\" \", \"_\");\n        Log.d(TAG, \"id: \" + id);\n        String id64 = Base64.encodeToString(id.getBytes(), Base64.DEFAULT);\n        byte[] decodedId64 = Base64.decode(id64, Base64.DEFAULT);\n        Log.d(TAG, \"id in base64: \" + id64 + \", decodedId64: \" + new String(decodedId64));\n    }\n\n// id: Xiaomi-HM_NOTE_1S-gucci-KTU84P\n// id in base64: WGlhb21pLUhNX05PVEVfMVMtZ3VjY2ktS1RVODRQ\n// , decodedId64: Xiaomi-HM_NOTE_1S-gucci-KTU84P\n</code></pre></p> <p>\u68c0\u67e5base64\u52a0\u5bc6\u89e3\u5bc6 <pre><code>$ echo Xiaomi-HM_NOTE_1S-gucci-KTU84P | base64\nWGlhb21pLUhNX05PVEVfMVMtZ3VjY2ktS1RVODRQCg==\n\n$ echo WGlhb21pLUhNX05PVEVfMVMtZ3VjY2ktS1RVODRQ | base64 -d\nXiaomi-HM_NOTE_1S-gucci-KTU84P\n</code></pre></p>"},{"location":"android/sys/device-node/","title":"Android app\u8bfb\u5199\u8bbe\u5907\u8282\u70b9","text":"<p>Android L</p>"},{"location":"android/sys/device-node/#android","title":"Android \u8bbe\u5907\u8282\u70b9","text":"<p>Android\u57fa\u4e8eLinux\u5185\u6838\u3002\u8bbe\u5907\u8282\u70b9\u6587\u4ef6\u662f\u8bbe\u5907\u9a71\u52a8\u7684\u903b\u8f91\u6587\u4ef6\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bbe\u5907\u8282\u70b9\u6765\u8bbf\u95ee\u8bbe\u5907\u9a71\u52a8\u3002 \u5f88\u591a\u8bbe\u5907\u4fe1\u606f\u90fd\u53ef\u5b58\u50a8\u5728\u8282\u70b9\u4e2d\u3002apk\u53ef\u4ee5\u8bbf\u95ee\u8282\u70b9\uff0c\u83b7\u53d6\u8bbe\u5907\u4fe1\u606f\u6216\u72b6\u6001\u3002</p>"},{"location":"android/sys/device-node/#framework","title":"framework\u4e2d\u8bfb\u53d6\u8282\u70b9\u7684\u4f8b\u5b50","text":"<p>Android Settings \u5e94\u7528\u4e2d\u7ed9\u51fa\u4e86\u5f88\u591a\u7684\u8bbe\u5907\u4fe1\u606f\uff0c\u53ef\u4ee5\u4ee5\u6b64\u4e3a\u5165\u53e3\uff1b\u8fdb\u4e00\u6b65\u53ef\u4ee5\u627e\u5230 Build.java \u4f8b\u5982\u83b7\u53d6\u8bbe\u5907\u7684\u7248\u672c\u53f7\uff0c\u5e94\u7528\u4e2d\u76f4\u63a5\u53ef\u4ee5\u8c03\u7528 Build.DISPLAY \u83b7\u5f97\u5b57\u7b26\u4e32</p> <p>\u6e90\u7801 Build.java (frameworks\\base\\core\\java\\android\\os) <pre><code>    public static final String PRODUCT = getString(\"ro.product.name\");\n    // ......\n    private static String getString(String property) {\n        return SystemProperties.get(property, UNKNOWN);\n    }\n</code></pre></p> <p>\u8df3\u8f6c\u5230 SystemProperties.java (frameworks\\base\\core\\java\\android\\os) \u8fd9\u4e2a\u7c7b\u4e0d\u5f00\u653e <pre><code>    // \u8c03\u7528 native_get \uff0c\u83b7\u53d6\u8282\u70b9\uff1b\u53ef\u4ee5\u8bbe\u5b9a\u9ed8\u8ba4\u503c\n    public static String get(String key, String def) {\n        if (key.length() &gt; PROP_NAME_MAX) {\n            throw new IllegalArgumentException(\"key.length &gt; \" + PROP_NAME_MAX);\n        }\n        return native_get(key, def);\n    }\n</code></pre></p>"},{"location":"android/sys/device-node/#_1","title":"\u5e94\u7528\u5c42\u8bfb\u5199\u8282\u70b9","text":"<p>\u5e94\u7528\u5c42\u4e2d\uff0c\u4e00\u822c\u90fd\u80fd\u591f\u8bfb\u53d6\u8bbe\u5907\u8282\u70b9\u3002\u5bf9\u4e8e\u5199\u8282\u70b9\u8fd9\u4e2a\u64cd\u4f5c\uff0c\u9700\u8981\u66f4\u9ad8\u7684root\u6743\u9650\u3002</p>"},{"location":"android/sys/device-node/#_2","title":"\u8bfb\u53d6\u8bbe\u5907\u8282\u70b9","text":"<p>\u4f8b\u5982\u7ed9\u8bbe\u5907\u65b0\u6dfb\u52a0\u4e86\u8282\u70b9\uff0c\u8def\u5f84\u662f <code>/sys/class/demo/version</code> \u53ef\u4ee5<code>adb shell</code>\u8fdb\u5165\u673a\u5668\uff0c\u7136\u540e <code>cat /sys/class/demo/version</code>\uff1b\u5373\u53ef\u83b7\u5f97\u4fe1\u606f</p> <p>\u4e5f\u53ef\u4ee5\u5199\u6210\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5982\u4e0b\uff1a <pre><code>    /**\n     * \u83b7\u53d6\u8282\u70b9\n     */\n    private static String getString(String path) {\n        String prop = \"waiting\";// \u9ed8\u8ba4\u503c\n        try {\n            BufferedReader reader = new BufferedReader(new FileReader(path));\n            prop = reader.readLine();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return prop;\n    }\n</code></pre> \u8c03\u7528\u65b9\u6cd5\u5c31\u662f\uff1a <pre><code>    getString(\"/sys/class/demo/version\")\n</code></pre></p>"},{"location":"android/sys/device-node/#_3","title":"\u5199\u8bbe\u5907\u8282\u70b9","text":"<p>\u8fd9\u91cc\u5199\u8282\u70b9\u7684\u65b9\u6cd5\u9700\u8981\u66f4\u9ad8\u7684\u6743\u9650\uff0capk\u8981\u653e\u5230\u6e90\u7801\u4e2d\u8fdb\u884c\u7f16\u8bd1\uff1b \u6e90\u7801\u4e2d\u7f16\u8bd1apk\u7684\u65b9\u6cd5\u5982\u540c\u6dfb\u52a0\u7b2c\u4e09\u65b9apk\u7684\u65b9\u6cd5 AndroidManifest\u4e2d\u6dfb\u52a0\uff1a <pre><code>        android:sharedUserId=\"android.uid.system\"\n</code></pre> \u5199\u8282\u70b9\u7684\u4ee3\u7801 <pre><code>    private static final String WAKE_PATH = \"/sys/class/demo/wake\";\n    ......\n        try {\n            BufferedWriter bufWriter = null;\n            bufWriter = new BufferedWriter(new FileWriter(WAKE_PATH));\n            bufWriter.write(\"1\");  // \u5199\u64cd\u4f5c\n            bufWriter.close();\n            Toast.makeText(getApplicationContext(),\n                    \"\u529f\u80fd\u5df2\u6fc0\u6d3b\",Toast.LENGTH_SHORT).show();\n            Log.d(TAG,\"\u529f\u80fd\u5df2\u6fc0\u6d3b angle \" + getString(ANGLE_PATH));\n        } catch (IOException e) {\n            e.printStackTrace();\n            Log.e(TAG,\"can't write the \" + WAKE_PATH);\n        }\n</code></pre> \u7ecf\u8fc7\u6e90\u7801mm\u7f16\u8bd1\u540e\uff0cpush\u5230\u8bbe\u5907\u4e2d\u53ef\u4ee5\u67e5\u770b\u6548\u679c</p>"},{"location":"android/text/style/use-replacementspan/","title":"\u4f7f\u7528 ReplacementSpan","text":"<p>ReplacementSpan\u662f<code>android.text.style</code>\u91cc\u7684\u4e00\u4e2a\u62bd\u8c61\u7c7b\u3002</p> <p>\u6211\u4eec\u4e3b\u8981\u5728<code>draw</code>\u65b9\u6cd5\u4e2d\u5bf9\u6587\u672c\u8fdb\u884c\u64cd\u4f5c\u3002</p>"},{"location":"android/text/style/use-replacementspan/#_1","title":"\u5b9e\u73b0\u4e0b\u5212\u7ebf\u6548\u679c","text":""},{"location":"android/text/style/use-replacementspan/#_2","title":"\u51c6\u5907\u5de5\u4f5c","text":"<p>\u65b0\u5efa\u4e00\u4e2a<code>drawable_tv_underline.xml</code>\u3002\u7528\u6765\u5145\u5f53\u4e0b\u5212\u7ebf\u3002 \u53ef\u4ee5\u4fee\u6539\u4e0b\u5212\u7ebf\u7684\u989c\u8272\u548c\u7c97\u7ec6\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;shape xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:shape=\"line\"&gt;\n    &lt;stroke\n        android:width=\"2dp\"\n        android:color=\"#3792e5\" /&gt;\n&lt;/shape&gt;\n</code></pre></p> <p>\u4ee5\u6b64\u7c7b\u63a8\uff0c\u518d\u5efa\u7acb\u4e00\u4e2a<code>drawable_tv_underline2.xml</code> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;shape xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:shape=\"line\"&gt;\n    &lt;stroke\n        android:width=\"1dp\"\n        android:color=\"#FF7700\" /&gt;\n&lt;/shape&gt;\n</code></pre></p>"},{"location":"android/text/style/use-replacementspan/#span","title":"\u5b9e\u73b0Span","text":"<p>\u65b0\u5efa<code>DrawableSpan.kt</code>\u6587\u4ef6\uff0cDrawableSpan\u7ee7\u627fReplacementSpan\u3002</p> <p>\u9700\u8981\u4f20\u5165\u4e00\u4e2aDrawable\u5bf9\u8c61\u6765\u5f53\u4e0b\u5212\u7ebf\u3002</p> <p>\u5728<code>draw</code>\u65b9\u6cd5\u4e2d\uff0c\u6211\u4eec\u5148\u8ba1\u7b97\u51fa\u6587\u5b57\u7684\u663e\u793a\u8303\u56f4\uff0c\u4ee5\u6b64\u6765\u786e\u5b9a\u4e0b\u5212\u7ebf\u7684\u5c3a\u5bf8\u548c\u4f4d\u7f6e\u3002</p> <pre><code>import android.graphics.*\nimport android.graphics.drawable.Drawable\nimport android.text.style.ReplacementSpan\nimport kotlin.math.roundToInt\n\nclass DrawableSpan(private val drawable: Drawable) : ReplacementSpan() {\n    private val padding: Rect = Rect()\n    var textColor = Color.parseColor(\"#3792e5\")\n\n    init {\n        drawable.getPadding(padding)\n    }\n\n    override fun draw(canvas: Canvas, text: CharSequence, start: Int, end: Int, x: Float, top: Int, y: Int, bottom: Int, paint: Paint) {\n        val rect = RectF(x, top.toFloat(), x + measureText(paint, text, start, end), bottom.toFloat())\n        drawable.setBounds(rect.left.toInt() - padding.left,\n                rect.top.toInt() - padding.top,\n                rect.right.toInt() + padding.right,\n                (rect.bottom.toInt() + rect.height() / 1.2f).toInt())\n        paint.color = textColor\n        canvas.drawText(text, start, end, x, y.toFloat(), paint)\n        drawable.draw(canvas)\n    }\n\n    override fun getSize(paint: Paint, text: CharSequence, start: Int, end: Int, fm: Paint.FontMetricsInt?): Int = paint.measureText(text, start, end).roundToInt()\n\n    private fun measureText(paint: Paint, text: CharSequence, start: Int, end: Int): Float = paint.measureText(text, start, end)\n}\n</code></pre>"},{"location":"android/text/style/use-replacementspan/#_3","title":"\u4f7f\u7528","text":"<p>\u4f7f\u7528\u8fd9\u4e2aDrawableSpan\u3002 \u6a21\u62df\u4e86\u4e00\u4e2a\u4f7f\u7528\u573a\u666f\u3002</p> <pre><code>final String text1 = \"RustFisher:\\nHow to underline text in TextView with some different color than that of text?\";\nSpannableStringBuilder ssb = new SpannableStringBuilder(text1);\nfor (int i = 0; i &lt; text1.length(); i += 6) {\n    ssb.setSpan(new DrawableSpan(getResources().getDrawable(R.drawable.drawable_tv_underline)), i, Math.min(i + 4, text1.length()), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);\n}\nmBinding.tv1.setText(ssb);\n\nSpannableStringBuilder ssb2 = new SpannableStringBuilder(text1);\nfor (int i = 0; i &lt; text1.length(); i += 6) {\n    ssb2.setSpan(new DrawableSpan(getResources().getDrawable(R.drawable.drawable_tv_underline2)), i, Math.min(i + 4, text1.length()), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);\n}\nmBinding.tv2.setText(ssb2);\n</code></pre>"},{"location":"android/text/style/use-replacementspan/#_4","title":"\u8fd0\u884c\u6548\u679c","text":"<p>\u53ef\u4ee5\u770b\u51fa\uff0c\u6709\u4e0b\u5212\u7ebf\u7684\u90e8\u5206\uff0c\u6587\u5b57\u989c\u8272\u4e5f\u88ab\u4fee\u6539\u4e86\u3002</p>"},{"location":"android/text/style/use-replacementspan/#_5","title":"\u591a\u4e2a\u6587\u5b57\u989c\u8272\u4e0e\u4e0b\u5212\u7ebf","text":"<p>\u524d\u9762\u6211\u4eec\u5b9e\u73b0\u4e86\u4e0b\u5212\u7ebf\u6548\u679c\u3002\u4ece\u4e0a\u9762\u7684\u6548\u679c\u56fe\u6211\u4eec\u770b\u5230\u4e0b\u5212\u7ebf\u548c\u6587\u5b57\u989c\u8272\u90fd\u53ef\u4ee5\u4fee\u6539\u3002 \u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u8fd9\u4e2a\u7279\u70b9\u6765\u589e\u52a0\u6587\u5b57\u53d8\u8272\u6548\u679c\u3002</p> <p>\u5982\u679c\u53ea\u662f\u4fee\u6539\u6587\u5b57\u989c\u8272\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528ForegroundColorSpan\u6765\u5b9e\u73b0\u3002 \u8fd9\u91cc\u6211\u4eec\u5b9e\u73b0\u7684\u662f\u4ece\u5934\u5f00\u59cb\u7684\u53d8\u8272\u6548\u679c\u3002</p>"},{"location":"android/text/style/use-replacementspan/#span_1","title":"\u5b9e\u73b0span\u7c7b","text":"<p><code>draw</code>\u65b9\u6cd5\u91cc\uff0c\u6211\u4eec\u9700\u8981\u5904\u7406\u4e00\u4e0b\u53d8\u8272\u7ec8\u70b9\u4e0b\u6807<code>foregroundEndIndex</code>\u4e0e\u6587\u672c\u7ed3\u5c3e<code>end</code>\u4e4b\u95f4\u7684\u5173\u7cfb\u3002</p> <pre><code>import android.graphics.*\nimport android.graphics.drawable.Drawable\nimport android.text.style.ReplacementSpan\nimport kotlin.math.roundToInt\n\nclass UnderlineAndForegroundSpan(private val drawable: Drawable) : ReplacementSpan() {\n    private val padding: Rect = Rect()\n    var textColor = Color.parseColor(\"#202020\")\n    var foregroundColor = Color.parseColor(\"#F8872E\")\n    var foregroundEndIndex = 0\n\n    init {\n        drawable.getPadding(padding)\n    }\n\n    override fun draw(canvas: Canvas, text: CharSequence, start: Int, end: Int, x: Float, top: Int, y: Int, bottom: Int, paint: Paint) {\n        val rect = RectF(x, top.toFloat(), x + measureText(paint, text, start, end), bottom.toFloat())\n        drawable.setBounds(rect.left.toInt() - padding.left,\n                rect.top.toInt() - padding.top,\n                rect.right.toInt() + padding.right,\n                (rect.bottom.toInt() + rect.height() / 1.2f).toInt())\n        if (foregroundEndIndex &lt;= 0) {\n            paint.color = textColor\n            canvas.drawText(text, start, end, x, y.toFloat(), paint)\n        } else {\n            when {\n                end &lt;= foregroundEndIndex -&gt; {\n                    paint.color = foregroundColor\n                    canvas.drawText(text, start, end, x, y.toFloat(), paint)\n                }\n                start &lt; foregroundEndIndex -&gt; {\n                    // \u628a\u6587\u5b57\u5206\u5f002\u6bb5\u753b\n                    paint.color = foregroundColor\n                    canvas.drawText(text, start, foregroundEndIndex, x, y.toFloat(), paint)\n\n                    paint.color = textColor\n                    val drawInPart = text.subSequence(start, foregroundEndIndex)\n                    canvas.drawText(text, foregroundEndIndex, end, x + measureText(paint, drawInPart, 0, drawInPart.length), y.toFloat(), paint)\n                }\n                else -&gt; {\n                    paint.color = textColor\n                    canvas.drawText(text, start, end, x, y.toFloat(), paint)\n                }\n            }\n        }\n\n        drawable.draw(canvas)\n    }\n\n    override fun getSize(paint: Paint, text: CharSequence, start: Int, end: Int, fm: Paint.FontMetricsInt?): Int = paint.measureText(text, start, end).roundToInt()\n\n    private fun measureText(paint: Paint, text: CharSequence, start: Int, end: Int): Float = paint.measureText(text, start, end)\n}\n</code></pre>"},{"location":"android/text/style/use-replacementspan/#_6","title":"\u4f7f\u7528\u4e0e\u8fd0\u884c\u6548\u679c","text":"<p>\u4e0e\u524d\u9762\u7c7b\u4f3c\uff0c\u6a21\u62df\u4e00\u4e2a\u4f7f\u7528\u573a\u666f\u3002</p>"},{"location":"android/text/style/use-replacementspan/#_7","title":"\u5355\u72ec\u4f7f\u7528","text":"<pre><code>final String text = \"RustFisher:\\nHow to underline text in TextView with some different color than that of text?\";\nSpannableStringBuilder ssb = new SpannableStringBuilder(text);\nfor (int i = 0; i &lt; text.length(); i += 6) {\n    UnderlineAndForegroundSpan span = new UnderlineAndForegroundSpan(getResources().getDrawable(R.drawable.drawable_tv_underline));\n    span.setForegroundEndIndex(text.length() / 2);\n    ssb.setSpan(span, i, Math.min(i + 4, text.length()), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);\n}\nmBinding.tv3.setText(ssb);\n</code></pre>"},{"location":"android/text/style/use-replacementspan/#foregroundcolorspan","title":"\u7ed3\u5408ForegroundColorSpan","text":"<p>\u5148\u4f7f\u7528ForegroundColorSpan\u6765\u8bbe\u5b9a\u989c\u8272\uff0c\u518d\u628a\u4e0b\u5212\u7ebf\u6548\u679c\u52a0\u8fdb\u53bb\u3002</p> <p><pre><code>SpannableStringBuilder ssb2 = new SpannableStringBuilder(text);\nfinal int foregroundColor = Color.RED;\nssb2.setSpan(new ForegroundColorSpan(foregroundColor), 0, text.length() / 2, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);\nfor (int i = 0; i &lt; text.length(); i += 6) {\n    UnderlineAndForegroundSpan span = new UnderlineAndForegroundSpan(getResources().getDrawable(R.drawable.drawable_tv_underline));\n    span.setForegroundEndIndex(text.length() / 2);\n    span.setForegroundColor(foregroundColor);\n    ssb2.setSpan(span, i, Math.min(i + 4, text.length()), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);\n}\nmBinding.tv4.setText(ssb2);\n</code></pre> \u4f1a\u8986\u76d6\u6389\u524d\u9762\u8bbe\u7f6e\u7684ForegroundColorSpan</p> <p></p>"},{"location":"android/text/style/use-replacementspan/#_8","title":"\u53c2\u8003","text":"<ul> <li>https://stackoverflow.com/questions/19046614/how-to-underline-text-in-textview-with-some-different-color-than-that-of-text</li> </ul>"},{"location":"android/thread/android-thread-survey/","title":"Android\u591a\u7ebf\u7a0b\u7efc\u8ff0","text":"\u66f4\u65b0\u65e5\u671f: 2021-9-12 <ul> <li>2021-9-26 \u534f\u7a0b</li> <li>2021-9-12 \u66f4\u65b0\u56fe</li> <li>2021-9-11 \u66f4\u65b0\u7ebf\u7a0b\u6c60\uff0cWorkManager\u4ecb\u7ecd</li> <li>2021-9-6 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4ecb\u7ecdAndroid\u5e94\u7528\u5f00\u53d1\u4e2d\u7684\u591a\u7ebf\u7a0b\u3002\u6d89\u53caThread\u3001Handler\u3001\u7ebf\u7a0b\u6c60\u3001WorkManager\u7b49\u3002</p> <p></p>"},{"location":"android/thread/android-thread-survey/#_1","title":"\u591a\u7ebf\u7a0b\u4ecb\u7ecd","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u5728\u540c\u4e00\u65f6\u523b\u8fd0\u884c\u591a\u4e2a\u7a0b\u5e8f\u3002\u4f8b\u5982\u4e00\u8fb9\u64ad\u653e\u97f3\u4e50\uff0c\u4e00\u8fb9\u4e0b\u8f7d\u6587\u4ef6\u548c\u6d4f\u89c8\u7f51\u9875\u3002\u64cd\u4f5c\u7cfb\u7edf\u5c06cpu\u7684\u65f6\u95f4\u7247\u5206\u914d\u7ed9\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u7ed9\u4eba\u4e00\u79cd\u5e76\u884c\u5904\u7406\u7684\u611f\u89c9\u3002 \u4e00\u4e2a\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u53ef\u4ee5\u540c\u65f6\u6267\u884c\u591a\u4e2a\u4efb\u52a1\u3002\u901a\u5e38\uff0c\u6bcf\u4e00\u4e2a\u4efb\u52a1\u79f0\u4e3a\u4e00\u4e2a\u7ebf\u7a0b\uff08thread\uff09\uff0c\u5b83\u662f\u7ebf\u7a0b\u63a7\u5236\u7684\u7b80\u79f0\u3002\u53ef\u4ee5\u540c\u65f6\u8fd0\u884c\u4e00\u4e2a\u4ee5\u4e0a\u7ebf\u7a0b\u7684\u7a0b\u5e8f\u6210\u4e3a\u591a\u7ebf\u7a0b\u7a0b\u5e8f\uff08multithreaded\uff09\u3002 \u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u591a\u7ebf\u7a0b\u975e\u5e38\u6709\u7528\u3002\u4f8b\u5982\u5e94\u7528\u4e00\u8fb9\u5904\u7406\u7528\u6237\u7684\u8f93\u5165\u6307\u4ee4\uff0c\u4e00\u904d\u8054\u7f51\u83b7\u53d6\u6570\u636e\u3002</p> <p>\u2705 \u591a\u7ebf\u7a0b\u4ecb\u7ecd</p>"},{"location":"android/thread/android-thread-survey/#handler","title":"Handler","text":"<p>Android\u5f00\u53d1\u4e2d\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528Thread\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528Handler\u3002</p> <p>Handler\u5728Android\u5f00\u53d1\u4e2d\u662f\u4e00\u4e2a\u6bd4\u8f83\u5e38\u7528\u7684\u5de5\u5177\u3002\u4e00\u4e2aHandler\u5141\u8bb8\u53d1\u9001\u548c\u5904\u7406Message\uff08\u4efb\u52a1\uff09\uff0c\u901a\u8fc7\u5173\u8054\u7ebf\u7a0b\u7684MessageQueue\u6267\u884cRunnable\u5bf9\u8c61\u3002\u6709\u4e9b\u5b9a\u65f6\u4efb\u52a1\u4e5f\u53ef\u4ee5\u7528\u5b83\u6765\u6267\u884c\u3002</p> <p>\u6bcf\u4e2aHandler\u5b9e\u4f8b\u90fd\u548c\u4e00\u4e2a\u5355\u72ec\u7684\u7ebf\u7a0b\u53ca\u5176\u6d88\u606f\u961f\u5217\u7ed1\u5b9a\u3002\u53ef\u4ee5\u5c06\u4e00\u4e2a\u4efb\u52a1\u5207\u6362\u5230Handler\u6240\u5728\u7684\u7ebf\u7a0b\u4e2d\u53bb\u6267\u884c\u3002\u4e00\u4e2a\u7528\u6cd5\u5c31\u662f\u5b50\u7ebf\u7a0b\u901a\u8fc7Handler\u66f4\u65b0UI\u3002</p> <p>\u2705 Handler\u4f7f\u7528</p>"},{"location":"android/thread/android-thread-survey/#_2","title":"\u7ebf\u7a0b\u6c60","text":"<p>\u6709\u5927\u91cf\u5f02\u6b65\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u7ebf\u7a0b\u6c60\u3002\u9700\u8981\u6267\u884c\u5927\u91cf\u5f02\u6b65\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u51cf\u8f7b\u6bcf\u4e2a\u5f02\u6b65\u4efb\u52a1\u7684\u8c03\u7528\u5f00\u9500\uff0c\u63d0\u9ad8\u6027\u80fd\u3002\u53e6\u5916\u5b83\u8fd8\u80fd\u591f\u9650\u5236\u548c\u7ba1\u7406\u5b50\u7ebf\u7a0b\u3002</p> <p>ThreadPoolExecutor\u63d0\u4f9b\u4e86\u5f88\u591a\u53c2\u6570\uff0c\u65b9\u4fbf\u5f00\u53d1\u8005\u8c03\u63a7\u3002\u7ebf\u7a0b\u6c60\u7684\u8bbe\u8ba1\u8005\u5efa\u8bae\u5f00\u53d1\u8005\u4f7f\u7528\u4ee5\u4e0b\u51e0\u4e2a\u5de5\u5382\u65b9\u6cd5\uff0cAndroid\u4e2d\u4e3b\u8981\u67095\u79cd</p> <ul> <li><code>newCachedThreadPool()</code> \u4e0d\u9650\u5236\u6570\u91cf\u7684\u7ebf\u7a0b\u6c60\uff0c\u80fd\u81ea\u52a8\u56de\u6536\u7ebf\u7a0b</li> <li><code>newFixedThreadPool(int nThreads)</code> \u56fa\u5b9a\u6570\u91cf\u7684\u7ebf\u7a0b\u6c60</li> <li><code>newSingleThreadExecutor()</code> \u5355\u4e00\u7684\u5b50\u7ebf\u7a0b</li> <li><code>newScheduledThreadPool(int corePoolSize)</code> \u80fd\u6267\u884c\u5ef6\u65f6\u4efb\u52a1\u6216\u8005\u5468\u671f\u6027\u4efb\u52a1</li> <li><code>newWorkStealingPool()</code> \u5de5\u4f5c\u7a83\u53d6\u7ebf\u7a0b\u6c60</li> </ul> <p>\u2705 \u7ebf\u7a0b\u6c60\u4f7f\u7528</p>"},{"location":"android/thread/android-thread-survey/#workmanager","title":"WorkManager","text":"<p>WorkManager\u63d0\u4f9b\u4e86\u4efb\u52a1\u8c03\u5ea6\u529f\u80fd\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u5de5\u4f5c\u8fdb\u884c\u6807\u8bb0\u6216\u547d\u540d\u3002WorkManager\u53ef\u4ee5\u5728\u5b50\u7ebf\u7a0b\u4e2d\u6267\u884c\u4efb\u52a1\uff0c\u4f46\u7528\u6cd5\u4e0d\u4ec5\u9650\u4e8e\u591a\u7ebf\u7a0b\u3002\u66f4\u5728\u4e8e\u5de5\u4f5c\u8c03\u5ea6\u3002</p> <p>\u2705 WorkManager\u4f7f\u7528\u5165\u95e8 \u2705 \u5de5\u4f5c\u7ea6\u675f\uff0c\u5ef6\u8fdf\u4e0e\u67e5\u8be2\u5de5\u4f5c</p>"},{"location":"android/thread/android-thread-survey/#_3","title":"\u534f\u7a0b","text":"<p>\u5728Android\u4e2d\u4f7f\u7528Kotlin\u534f\u7a0b\u3002\u4e5f\u80fd\u8fbe\u5230\u7ebf\u7a0b\u8c03\u5ea6\u7684\u6548\u679c\u3002\u5355\u4e2a\u7ebf\u7a0b\u4e0a\u53ef\u8fd0\u884c\u591a\u4e2a\u534f\u7a0b\u3002\u534f\u7a0b\u652f\u6301\u6302\u8d77\uff0c\u4e0d\u4f1a\u4f7f\u6b63\u5728\u8fd0\u884c\u534f\u7a0b\u7684\u7ebf\u7a0b\u963b\u585e\u3002\u6302\u8d77\u6bd4\u963b\u585e\u8282\u7701\u5185\u5b58\uff0c\u4e14\u652f\u6301\u591a\u4e2a\u5e76\u884c\u64cd\u4f5c\u3002\u8bb8\u591aJetpack\u5e93\u90fd\u5305\u542b\u63d0\u4f9b\u5168\u9762\u534f\u7a0b\u652f\u6301\u7684\u6269\u5c55\u3002\u67d0\u4e9b\u5e93\u8fd8\u63d0\u4f9b\u81ea\u5df1\u7684\u534f\u7a0b\u4f5c\u7528\u57df\uff0c\u53ef\u7528\u4e8e\u7ed3\u6784\u5316\u5e76\u53d1\u3002</p> <p>\u2705 Android Kotlin\u534f\u7a0b\u5165\u95e8 \u2705 Kotlin\u534f\u7a0b\u5165\u95e8</p>"},{"location":"android/thread/async-task-use-intro/","title":"AsyncTask \u4f7f\u7528\u4ecb\u7ecd","text":"\u66f4\u65b0\u65e5\u671f: 2021-9-11 <ul> <li>2021-9-11 \u66f4\u65b0</li> <li>2020-4-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>deprecated \u5df2\u4e0d\u518d\u63a8\u8350\u4f7f\u7528</p> <p>\u5728API 30\u4e2d\u4e0d\u518d\u63a8\u8350\u4f7f\u7528AsyncTask\u3002\u8bf7\u4f7f\u7528java.util.concurrent\u4e2d\u7684\u65b9\u6cd5\uff0c\u6216\u8005Kotlin\u534f\u7a0b\u3002</p> <p>\u672c\u6587\u7b80\u5355\u4ecb\u7ecdAndroid\u4e2d\u7684AsyncTask\u7684\u7528\u6cd5\u3002</p> <p>AsyncTask\u6709\u52a9\u4e8e\u4f7f\u7528UI\u7ebf\u7a0b\u3002\u8fd9\u4e2a\u7c7b\u80fd\u8ba9\u4f60\u4e0d\u4e3b\u52a8\u4f7f\u7528\u591a\u7ebf\u7a0b\u6216Handler\uff0c\u5728\u5b50\u7ebf\u7a0b\u79cd\u6267\u884c\u8017\u65f6\u4efb\u52a1\uff0c\u5e76\u5728UI\u7ebf\u7a0b\u53d1\u5e03\u7ed3\u679c\u3002 AsyncTask\u662f\u4e00\u4e2a\u5728\u4e0d\u9700\u8981\u5f00\u53d1\u8005\u76f4\u63a5\u64cd\u4f5c\u591a\u7ebf\u7a0b\u548cHandler\u7684\u60c5\u51b5\u4e0b\u7684\u5e2e\u52a9\u7c7b\uff0c\u9002\u7528\u4e8e\u77ed\u65f6\u95f4\u7684\u64cd\u4f5c\uff08\u6700\u591a\u51e0\u79d2\uff09\u3002 \u5982\u9700\u957f\u65f6\u95f4\u7684\u7ebf\u7a0b\u64cd\u4f5c\uff0c\u5efa\u8bae\u4f7f\u7528\u591a\u7ebf\u7a0b\u5305<code>java.util.concurrent</code>\u4e2d\u7684\u529f\u80fd\uff0c\u6bd4\u5982\u7ebf\u7a0b\u6c60\u3002</p> <p>\u5047\u8bbe\u6211\u4eec\u6709\u4e2a\u9700\u8981\u5728\u540e\u53f0\u7ebf\u7a0b\u4e2d\u8fd0\u884c\u7684\u5f02\u6b65\u8ba1\u7b97\u4efb\u52a1\uff0c\u5e76\u4e14\u7ed3\u679c\u9700\u8981\u66f4\u65b0ui\u3002 \u90a3\u6211\u4eec\u9700\u8981\u5173\u6ce83\u4e2a\u8303\u578b\u53c2\u6570\uff1a<code>Params</code>\uff0c <code>Progress</code> \u548c <code>Result</code>\u3002 \u518d\u5173\u6ce84\u4e2a\u6b65\u9aa4\u65b9\u6cd5\uff1a<code>onPreExecute</code>, <code>doInBackground</code>, <code>onProgressUpdate</code> \u548c <code>onPostExecute</code></p>"},{"location":"android/thread/async-task-use-intro/#_1","title":"\u5c5e\u6027\u4ecb\u7ecd","text":"<p>\u4f7f\u7528AsyncTask\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u770b\u4e00\u4e0b\u5b83\u7684\u4e09\u4e2a\u7c7b\u578b\u3002 <pre><code>AsyncTask&lt;Params, Progress, Result&gt;\n</code></pre></p> <ul> <li><code>Params</code> \u6267\u884c\u4efb\u52a1\u524d\uff0c\u4f20\u5165\u7684\u53c2\u6570\u7684\u7c7b\u578b</li> <li><code>Progress</code> \u540e\u53f0\u7ebf\u7a0b\u6267\u884c\u7684\u65f6\u5019\uff0c\u7528\u6765\u8868\u793a\u8fdb\u5ea6\u7684\u7c7b\u578b</li> <li><code>Result</code> \u8868\u793a\u6267\u884c\u7ed3\u679c\u7684\u7c7b\u578b</li> </ul> <p>\u8fd93\u4e2a\u7c7b\u578b\u9700\u8981\u5f00\u53d1\u8005\u81ea\u5df1\u6307\u5b9a\u3002\u6bd4\u5982\u6307\u5b9a String, Integer \u7b49\u3002\u8fd93\u4e2a\u7c7b\u578b\u5728\u540e\u9762\u7684\u65b9\u6cd5\u91cc\u4f1a\u7528\u5230\u3002</p> <p>\u4e0d\u7528\u7684\u6cdb\u578b\u53ef\u4ee5\u7528<code>Void</code>\u8868\u793a\u3002\u4f8b\u5982 <pre><code>private class MyTask extends AsyncTask&lt;Void, Void, Void&gt; { ... }\n</code></pre></p>"},{"location":"android/thread/async-task-use-intro/#_2","title":"\u65b9\u6cd5\u4ecb\u7ecd","text":"<p>\u8981\u4f7f\u7528AsyncTask\uff0c\u5fc5\u987b\u65b0\u5efa\u4e00\u4e2a\u7c7b\u6765\u7ee7\u627f\u5b83\uff0c\u5e76\u4e14\u91cd\u5199<code>doInBackground</code>\u65b9\u6cd5\u3002\u901a\u5e38\u4e5f\u4f1a\u91cd\u5199<code>onPostExecute</code>\u65b9\u6cd5\u3002 \u6267\u884c\u5f02\u6b65\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4e3b\u8981\u5173\u5fc3\u4e0b\u9762\u8fd94\u4e2a\u65b9\u6cd5\u3002</p> <ul> <li><code>onPreExecute()</code> \u6267\u884c\u4efb\u52a1\u524d\u5728ui\u7ebf\u7a0b\u8c03\u7528\u3002\u901a\u7528\u7528\u6765\u8bbe\u7f6e\u4efb\u52a1\uff0c\u6bd4\u5982\u5728\u754c\u9762\u4e0a\u663e\u793a\u4e00\u4e2a\u8fdb\u5ea6\u6761\u3002</li> <li><code>Result doInBackground(Params... params)</code> \u5728<code>onPreExecute()</code>\u7ed3\u675f\u540e\u7acb\u5373\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u3002\u8017\u65f6\u7684\u5f02\u6b65\u4efb\u52a1\u5c31\u5728\u8fd9\u91cc\u64cd\u4f5c\u3002\u6267\u884c\u4efb\u52a1\u65f6\u4f20\u5165\u7684\u53c2\u6570\u4f1a\u88ab\u4f20\u5230\u8fd9\u91cc\u3002\u5f02\u6b65\u4efb\u52a1\u7684\u4e2d\u95f4\u7ed3\u679c\u5728\u8fd9\u91cc\u53ef\u4ee5\u7528<code>publishProgress</code>\u53d1\u9001\u5230\u4e3b\u7ebf\u7a0b\u3002</li> <li><code>onProgressUpdate(Progress... values)</code> \u5728ui\u7ebf\u7a0b\u4e2d\u6267\u884c\u3002\u540e\u53f0\u4efb\u52a1\u8fd8\u5728\u8fdb\u884c\u7684\u65f6\u5019\uff0c\u8fd9\u91cc\u8d1f\u8d23\u5904\u7406\u8fdb\u5ea6\u4fe1\u606f\u3002\u6bd4\u5982\u5728\u8fd9\u663e\u793a\u8fdb\u5ea6\u6761\u52a8\u753b\uff0c\u4fee\u6539\u6587\u5b57\u663e\u793a\u7b49\u3002</li> <li><code>onPostExecute(Result result)</code> \u540e\u53f0\u4efb\u52a1\u7ed3\u675f\u4e86\u8c03\u8fd9\u4e2a\u65b9\u6cd5\u3002\u5b83\u5728ui\u7ebf\u7a0b\u6267\u884c\u3002\u6700\u540e\u7684\u7ed3\u679c\u4f1a\u4f20\u5230\u8fd9\u3002</li> </ul>"},{"location":"android/thread/async-task-use-intro/#_3","title":"\u7528\u6cd5\u793a\u4f8b","text":"<p>\u865a\u6784\u4e00\u4e2a\u8ba1\u7b97\u4efb\u52a1 <pre><code>/**\n * \u865a\u62df\u7684\u8ba1\u7b97\u4efb\u52a1\n */\nprivate class CalculationTask extends AsyncTask&lt;Float, Integer, Float&gt; {\n    protected Float doInBackground(Float... inputs) {\n        Log.d(TAG, \"doInBackground thread ID = \" + Thread.currentThread().getId());\n        long step = 0;\n        float result = 0;\n        for (float f : inputs) {\n            // \u5047\u8bbe\u8fd9\u91cc\u6709\u4e00\u4e9b\u8017\u65f6\u7684\u64cd\u4f5c\n            result += f;\n        }\n        while (step &lt; 5) {\n            result += step;\n            step++;\n            publishProgress((int) step);\n        }\n        return result;\n    }\n\n    protected void onProgressUpdate(Integer... progress) {\n        Log.d(TAG, \"onProgressUpdate thread ID = \" + Thread.currentThread().getId());\n        Log.d(TAG, \"onProgressUpdate: \" + progress[0]);\n    }\n\n    protected void onPostExecute(Float result) {\n        Log.d(TAG, \"onPostExecute thread ID = \" + Thread.currentThread().getId());\n        Log.d(TAG, \"\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\");\n    }\n}\n\n// \u6267\u884c\u4efb\u52a1\nnew CalculationTask().execute(1.2f, 2.3f, 6.3f);\n</code></pre></p>"},{"location":"android/thread/async-task-use-intro/#_4","title":"\u53d6\u6d88\u4efb\u52a1","text":"<p>\u8c03\u7528<code>cancel(boolean)</code>\u53ef\u968f\u65f6\u53d6\u6d88\u4efb\u52a1\u3002\u53d6\u6d88\u4efb\u52a1\u540e<code>isCancelled()</code>\u4f1a\u8fd4\u56detrue\u3002 \u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u540e\uff0c\u540e\u53f0\u4efb\u52a1<code>doInBackground(Object[])</code>\u6267\u884c\u5b8c\u6bd5\u540e\u4f1a\u8c03\u7528<code>onCancelled(Object)</code>\u800c\u4e0d\u518d\u662f<code>onPostExecute(Object)</code>\u3002 \u4e3a\u4fdd\u8bc1\u4efb\u52a1\u80fd\u88ab\u53ca\u65f6\u5730\u53d6\u6d88\uff0c\u5728<code>doInBackground(Object[])</code>\u4e2d\u5e94\u8be5\u7ecf\u5e38\u68c0\u67e5<code>isCancelled()</code>\u8fd4\u56de\u503c</p>"},{"location":"android/thread/async-task-use-intro/#threading-rules","title":"\u7ebf\u7a0b\u89c4\u5219 Threading rules","text":"<p>\u4e00\u4e9b\u7ebf\u7a0b\u89c4\u5219</p> <ul> <li>\u5f02\u6b65\u4efb\u52a1\u5fc5\u987b\u4eceUI\u7ebf\u7a0b\u542f\u52a8</li> <li>\u5fc5\u987b\u5728UI\u7ebf\u7a0b\u5b9e\u4f8b\u5316AsyncTask\u7c7b</li> <li>\u5fc5\u987b\u5728UI\u7ebf\u7a0b\u8c03\u7528<code>execute(Params...)</code></li> <li>\u4e0d\u8981\u624b\u52a8\u8c03\u7528<code>onPreExecute(), onPostExecute(Result), doInBackground(Params...), onProgressUpdate(Progress...)</code></li> <li>\u540c\u4e00\u4e2a\u5f02\u6b65\u4efb\u52a1\u5b9e\u4f8b\u53ea\u80fd\u88ab\u6267\u884c\u4e00\u6b21\u3002\u91cd\u590d\u6267\u884c\u540c\u4e00\u4e2a\u5f02\u6b65\u4efb\u52a1\u5b9e\u4f8b\u4f1a\u629b\u51fa\u5f02\u5e38\uff08<code>IllegalStateException</code>\uff09\u3002</li> </ul> <p> \u53c2\u8003\uff1a</p> <ul> <li>Google\u6587\u6863</li> </ul>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/","title":"Android\u4f7f\u7528 ConstraintLayout \u6784\u5efa\u81ea\u9002\u5e94\u754c\u9762","text":"\u66f4\u65b0\u65e5\u671f\uff1a2020-4-20 <ul> <li>2020-4-20\uff1a\u521b\u5efa\u6587\u6863</li> </ul> <p>ConstraintLayout \u53ef\u8ba9\u60a8\u4f7f\u7528\u6241\u5e73\u89c6\u56fe\u5c42\u6b21\u7ed3\u6784\uff08\u65e0\u5d4c\u5957\u89c6\u56fe\u7ec4\uff09\u521b\u5efa\u590d\u6742\u7684\u5927\u578b\u5e03\u5c40\u3002\u5b83\u4e0e RelativeLayout \u76f8\u4f3c\uff0c\u5176\u4e2d\u6240\u6709\u7684\u89c6\u56fe\u5747\u6839\u636e\u540c\u7ea7\u89c6\u56fe\u4e0e\u7236\u5e03\u5c40\u4e4b\u95f4\u7684\u5173\u7cfb\u8fdb\u884c\u5e03\u5c40\uff0c\u4f46\u5176\u7075\u6d3b\u6027\u8981\u9ad8\u4e8e RelativeLayout\uff0c\u5e76\u4e14\u66f4\u6613\u4e8e\u4e0e Android Studio \u7684\u5e03\u5c40\u7f16\u8f91\u5668\u914d\u5408\u4f7f\u7528\u3002</p> <p>\u672c\u6587\u5c55\u793a\u7ea6\u675f\u6761\u4ef6\u4e2d\u7684\u51e0\u79cd\u7528\u6cd5\u3002</p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#_1","title":"\u7ea6\u675f\u6761\u4ef6","text":"<p>\u521b\u5efa\u7ea6\u675f\u6761\u4ef6\u65f6\uff0c\u8bf7\u6ce8\u610f\u4ee5\u4e0b\u89c4\u5219\uff1a - \u6bcf\u4e2a\u89c6\u56fe\u90fd\u5fc5\u987b\u81f3\u5c11\u6709\u4e24\u4e2a\u7ea6\u675f\u6761\u4ef6\uff1a\u4e00\u4e2a\u6c34\u5e73\u7ea6\u675f\u6761\u4ef6\uff0c\u4e00\u4e2a\u5782\u76f4\u7ea6\u675f\u6761\u4ef6\u3002 - \u53ea\u80fd\u5728\u5171\u7528\u540c\u4e00\u5e73\u9762\u7684\u7ea6\u675f\u624b\u67c4\u4e0e\u5b9a\u4f4d\u70b9\u4e4b\u95f4\u521b\u5efa\u7ea6\u675f\u6761\u4ef6\u3002\u56e0\u6b64\uff0c\u89c6\u56fe\u7684\u5782\u76f4\u5e73\u9762\uff08\u5de6\u4fa7\u548c\u53f3\u4fa7\uff09\u53ea\u80fd\u7ea6\u675f\u5728\u53e6\u4e00\u4e2a\u5782\u76f4\u5e73\u9762\u4e0a\uff1b\u800c\u57fa\u51c6\u7ebf\u5219\u53ea\u80fd\u7ea6\u675f\u5230\u5176\u4ed6\u57fa\u51c6\u7ebf\u4e0a\u3002 - \u6bcf\u4e2a\u7ea6\u675f\u53e5\u67c4\u53ea\u80fd\u7528\u4e8e\u4e00\u4e2a\u7ea6\u675f\u6761\u4ef6\uff0c\u4f46\u60a8\u53ef\u4ee5\u5728\u540c\u4e00\u5b9a\u4f4d\u70b9\u4e0a\u521b\u5efa\u591a\u4e2a\u7ea6\u675f\u6761\u4ef6\uff08\u4ece\u4e0d\u540c\u7684\u89c6\u56fe\uff09\u3002</p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#gradle","title":"gradle \u5f15\u5165","text":"<p>\u5f15\u5165constraintlayout\u5e93 <pre><code>implementation 'androidx.constraintlayout:constraintlayout:1.1.3'\n</code></pre></p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#constraintlayout","title":"constraintlayout\u4f7f\u7528","text":"<p>\u5728layout\u4e2d\u4f7f\u7528<code>android.support.constraint.ConstraintLayout</code>\uff0c\u5982\u4e0b\u793a\u4f8b <pre><code>    &lt;androidx.constraintlayout.widget.ConstraintLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"50dp\"\n        app:layout_constraintTop_toTopOf=\"parent\"&gt;\n\n        &lt;!-- child view layout --&gt;\n\n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre></p> <p>style\u4e2d\u65b0\u5efa\u4e00\u4e2a\u6837\u5f0f\uff0c\u65b9\u4fbf\u540e\u9762\u64cd\u4f5c <pre><code>    &lt;!-- con layout \u793a\u4f8btext --&gt;\n    &lt;style name=\"ConSampleText\"&gt;\n        &lt;item name=\"android:layout_width\"&gt;wrap_content&lt;/item&gt;\n        &lt;item name=\"android:layout_height\"&gt;wrap_content&lt;/item&gt;\n        &lt;item name=\"android:padding\"&gt;4dp&lt;/item&gt;\n        &lt;item name=\"android:textColor\"&gt;#fff&lt;/item&gt;\n        &lt;item name=\"android:background\"&gt;#3F51B5&lt;/item&gt;\n    &lt;/style&gt;\n</code></pre></p> <p>\u82e5\u5b50view\u6ca1\u6709\u6dfb\u52a0\u7ea6\u675f\uff0c\u5219\u4f1a\u8dd1\u5230\u7236constraintlayout\u7684(0,0)\u4f4d\u7f6e <pre><code>    &lt;androidx.constraintlayout.widget.ConstraintLayout\n        android:id=\"@+id/c1\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"50dp\"\n        android:background=\"#f0f0f0\"\n        app:layout_constraintTop_toTopOf=\"parent\"&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:text=\"No rule, jump to (0,0)\" /&gt;\n\n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre></p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#_2","title":"\u5bf9\u9f50\uff0c\u5c5e\u6027\u8bf4\u660e","text":"<p>\u5b9a\u4f4d\u65f6\u4f7f\u7528\u5230\u8bf8\u5982<code>app:layout_constraintStart_toStartOf</code>\u6216\u8005<code>app:layout_constraintTop_toTopOf</code>\u5c5e\u6027\u3002</p> <p><code>app:layout_constraintStart_toStartOf</code>\uff0c\u91cc\u9762\u67092\u4e2aStart\u5b57\u773c\u3002 \u7b2c\u4e00\u4e2aStart\u8868\u793a\u81ea\u8eab\u7684\u8d77\u59cb\u4f4d\u7f6e\uff08\u9ed8\u8ba4\u662f\u5de6\u8fb9\uff09\u3002\u7b2c\u4e8c\u4e2a<code>toStartOf</code>\u8868\u793a\u5bf9\u9f50\u53c2\u7167\u7269\u7684\u8d77\u59cb\u4f4d\u7f6e\u3002</p> <p><code>app:layout_constraintTop_toTopOf</code>\u4e5f\u7c7b\u4f3c\u3002\u4e0e\u53c2\u7167\u7269\u9876\u90e8\u5bf9\u9f50\u3002</p> <p>\u6307\u5b9a\u4f4d\u7f6e\u7684\u5b57\u773c\uff0c\u5982<code>Top</code>\u3001<code>Bottom</code>\u3001<code>End</code>\u3001<code>Start</code>\uff0c\u5b83\u4eec\u7ec4\u5408\u4f7f\u7528\u53ef\u7528\u6765\u786e\u5b9a\u76f8\u5bf9\u4f4d\u7f6e\uff1aapp:layout_constraint{}_to{}Of</p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#layout","title":"\u76f8\u5bf9\u7236layout\u7684\u5b9a\u4f4d","text":"<p>\u5c06\u5b50view\u5bf9\u9f50\u5230\u7236layout\u7684\u5404\u4e2a\u8fb9\u7f18\u4f4d\u7f6e\u3002</p> <p>\u7ea6\u675f\u7684\u53c2\u8003\u5bf9\u8c61\u662f<code>parent</code>\u3002</p> <pre><code>    &lt;androidx.constraintlayout.widget.ConstraintLayout\n        android:id=\"@+id/c2\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"140dp\"\n        android:layout_marginTop=\"20dp\"\n        android:background=\"#f0f0f0\"\n        app:layout_constraintTop_toBottomOf=\"@id/c1\"&gt;\n\n        &lt;!-- \u76f8\u5bf9\u7236layout\u7684\u8fb9\u7f18\u5b9a\u4f4d --&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:text=\"\u5c45\u4e2d\"\n            app:layout_constraintBottom_toBottomOf=\"parent\"\n            app:layout_constraintEnd_toEndOf=\"parent\"\n            app:layout_constraintStart_toStartOf=\"parent\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:text=\"\u5de6\u4e0a\u89d2\"\n            app:layout_constraintStart_toStartOf=\"parent\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:text=\"\u5de6\u4e0b\u89d2\"\n            app:layout_constraintBottom_toBottomOf=\"parent\"\n            app:layout_constraintStart_toStartOf=\"parent\" /&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:text=\"\u53f3\u4e0b\u89d2\"\n            app:layout_constraintBottom_toBottomOf=\"parent\"\n            app:layout_constraintEnd_toEndOf=\"parent\" /&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:text=\"\u53f3\u4e0a\u89d2\"\n            app:layout_constraintEnd_toEndOf=\"parent\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:text=\"\u9876\u90e8\u6c34\u5e73\u5c45\u4e2d\"\n            app:layout_constraintEnd_toEndOf=\"parent\"\n            app:layout_constraintStart_toStartOf=\"parent\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:text=\"\u5e95\u90e8\u6c34\u5e73\u5c45\u4e2d\"\n            app:layout_constraintBottom_toBottomOf=\"parent\"\n            app:layout_constraintEnd_toEndOf=\"parent\"\n            app:layout_constraintStart_toStartOf=\"parent\" /&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:text=\"\u5de6\u8fb9\u5782\u76f4\u5c45\u4e2d\"\n            app:layout_constraintBottom_toBottomOf=\"parent\"\n            app:layout_constraintStart_toStartOf=\"parent\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:text=\"\u53f3\u8fb9\u5782\u76f4\u5c45\u4e2d\"\n            app:layout_constraintBottom_toBottomOf=\"parent\"\n            app:layout_constraintEnd_toEndOf=\"parent\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre> <p>\u624b\u673a\u622a\u56fe </p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#_3","title":"\u57fa\u7ebf\u5bf9\u9f50","text":"<p>\u5c06\u4e00\u4e2a\u89c6\u56fe\u7684\u6587\u672c\u57fa\u7ebf\u4e0e\u53e6\u4e00\u89c6\u56fe\u7684\u6587\u672c\u57fa\u7ebf\u5bf9\u9f50\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528<code>app:layout_constraintBaseline_toBaselineOf</code>\u5c5e\u6027\u8bbe\u7f6e\u57fa\u7ebf\u5bf9\u9f50\u3002</p> <p>\u793a\u4f8b <pre><code>    &lt;androidx.constraintlayout.widget.ConstraintLayout\n        android:id=\"@+id/c21\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"100dp\"\n        android:background=\"#f0f0f0\"\n        app:layout_constraintTop_toTopOf=\"parent\"&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv1\"\n            style=\"@style/ConSampleText\"\n            android:layout_marginStart=\"10dp\"\n            android:text=\"an\"\n            android:textSize=\"13sp\"\n            app:layout_constraintBottom_toBottomOf=\"parent\"\n            app:layout_constraintStart_toStartOf=\"parent\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv2\"\n            style=\"@style/ConSampleText\"\n            android:layout_marginStart=\"10dp\"\n            android:text=\"Rust\"\n            android:textSize=\"20sp\"\n            app:layout_constraintBaseline_toBaselineOf=\"@id/tv1\"\n            app:layout_constraintStart_toEndOf=\"@+id/tv1\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv3\"\n            style=\"@style/ConSampleText\"\n            android:layout_marginStart=\"10dp\"\n            android:text=\"Fisher\"\n            android:textSize=\"24sp\"\n            app:layout_constraintBaseline_toBaselineOf=\"@id/tv1\"\n            app:layout_constraintStart_toEndOf=\"@+id/tv2\" /&gt;\n\n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre></p> <p>\u793a\u4f8b\u56fe</p> <p></p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#guideline","title":"\u5f15\u5bfc\u7ebf\u7ea6\u675f Guideline","text":"<p>\u5728ConstraintLayout\u4e2d\u6dfb\u52a0\u5f15\u5bfc\u7ebf\uff0c\u53ef\u4ee5\u65b9\u4fbf\u5b9a\u4f4d\u3002\u5176\u4ed6View\u53ef\u4ee5\u5f15\u5bfc\u7ebf\u4f5c\u4e3a\u53c2\u8003\u4f4d\u7f6e\u3002</p> <p>\u6dfb\u52a0Guideline\uff0c\u9700\u8981\u786e\u5b9a\u5b83\u7684\u65b9\u5411\uff0c\u5206\u522b\u662f\u5782\u76f4\u548c\u6c34\u5e73\u3002 - <code>android:orientation=\"vertical\"</code> - <code>android:orientation=\"horizontal\"</code></p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#_4","title":"\u6bd4\u4f8b\u5b9a\u4f4d","text":"<p>\u8fd9\u91cc\u6309\u6bd4\u4f8b\u6765\u5b9a\u4f4d\uff0c\u4f7f\u7528<code>app:layout_constraintGuide_percent</code>\u3002 \u9700\u8981\u6307\u5b9a\u6bd4\u4f8b\u503c\uff0c\u4f8b\u5982<code>app:layout_constraintGuide_percent=\"0.5\"</code>\u3002 <pre><code>    &lt;androidx.constraintlayout.widget.ConstraintLayout\n        android:id=\"@+id/c3\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"240dp\"\n        android:layout_marginTop=\"40dp\"\n        android:background=\"#f0f0f0\"\n        app:layout_constraintTop_toBottomOf=\"@id/c2\"&gt;\n\n        &lt;!-- \u5f15\u5bfc\u7ebf\u7ea6\u675f: \u76f8\u5bf9\u7236layout \u6309\u6bd4\u4f8b\u5b9a\u4f4d --&gt;\n\n        &lt;!-- \u5782\u76f4\u5f15\u5bfc\u7ebf Guideline --&gt;\n        &lt;androidx.constraintlayout.widget.Guideline\n            android:id=\"@+id/g1\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:orientation=\"vertical\"\n            app:layout_constraintGuide_percent=\"0.33\" /&gt;\n\n        &lt;androidx.constraintlayout.widget.Guideline\n            android:id=\"@+id/g2\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:orientation=\"horizontal\"\n            app:layout_constraintGuide_percent=\"0.5\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/t1\"\n            style=\"@style/ConSampleText\"\n            android:text=\"\u5782\u76f4\u76841/3\u5f15\u5bfc\u7ebf\u540e\"\n            app:layout_constraintStart_toStartOf=\"@id/g1\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/t2\"\n            style=\"@style/ConSampleText\"\n            android:text=\"\u5782\u76f4\u76841/3\u5f15\u5bfc\u7ebf\u524d\"\n            app:layout_constraintEnd_toStartOf=\"@id/g1\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/t3\"\n            style=\"@style/ConSampleText\"\n            android:layout_marginTop=\"2dp\"\n            android:text=\"\u5782\u76f4\u76841/3\u5f15\u5bfc\u7ebf\u5c45\u4e2d\"\n            app:layout_constraintEnd_toEndOf=\"@id/g1\"\n            app:layout_constraintStart_toStartOf=\"@id/g1\"\n            app:layout_constraintTop_toBottomOf=\"@id/t2\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/th1\"\n            style=\"@style/ConSampleText\"\n            android:text=\"\u6c34\u5e73\u76841/2\u5f15\u5bfc\u7ebf\u5c45\u4e2d\"\n            app:layout_constraintBottom_toBottomOf=\"@id/g2\"\n            app:layout_constraintStart_toStartOf=\"parent\"\n            app:layout_constraintTop_toTopOf=\"@id/g2\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/th2\"\n            style=\"@style/ConSampleText\"\n            android:layout_marginStart=\"2dp\"\n            android:text=\"\u6c34\u5e73\u76841/2\u5f15\u5bfc\u7ebf\u4e0a\u9762\"\n            app:layout_constraintBottom_toBottomOf=\"@id/g2\"\n            app:layout_constraintStart_toEndOf=\"@id/th1\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/th3\"\n            style=\"@style/ConSampleText\"\n            android:layout_marginStart=\"2dp\"\n            android:text=\"\u6c34\u5e73\u76841/2\u5f15\u5bfc\u7ebf\u4e0b\u9762\"\n            app:layout_constraintStart_toEndOf=\"@id/th1\"\n            app:layout_constraintTop_toBottomOf=\"@id/g2\" /&gt;\n\n        &lt;androidx.constraintlayout.widget.Guideline\n            android:id=\"@+id/gv75\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:orientation=\"vertical\"\n            app:layout_constraintGuide_percent=\"0.75\" /&gt;\n\n        &lt;androidx.constraintlayout.widget.Guideline\n            android:id=\"@+id/gh75\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:orientation=\"horizontal\"\n            app:layout_constraintGuide_percent=\"0.75\" /&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:layout_marginStart=\"2dp\"\n            android:text=\"(0.75,0.75)\"\n            app:layout_constraintBottom_toBottomOf=\"@id/gh75\"\n            app:layout_constraintEnd_toEndOf=\"@id/gv75\"\n            app:layout_constraintStart_toStartOf=\"@id/gv75\"\n            app:layout_constraintTop_toTopOf=\"@id/gh75\" /&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:layout_marginStart=\"2dp\"\n            android:text=\"(0.33, 0.75)\"\n            app:layout_constraintBottom_toBottomOf=\"@id/gh75\"\n            app:layout_constraintEnd_toEndOf=\"@id/g1\"\n            app:layout_constraintStart_toStartOf=\"@id/g1\"\n            app:layout_constraintTop_toTopOf=\"@id/gh75\" /&gt;\n\n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre></p> <p>\u624b\u673a\u622a\u56fe </p> <p>as\u9884\u89c8\u56fe </p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#_5","title":"\u5177\u4f53\u6570\u503c","text":"<p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528<code>app:layout_constraintGuide_end</code>\u6216\u8005<code>app:layout_constraintGuide_begin</code>\u6765\u6307\u5b9a\u5177\u4f53\u7684\u6570\u503c\u3002</p> <p><pre><code>    &lt;androidx.constraintlayout.widget.ConstraintLayout\n        android:id=\"@+id/c4\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"50dp\"\n        android:layout_marginTop=\"30dp\"\n        android:background=\"#f0f0f0\"\n        app:layout_constraintTop_toBottomOf=\"@id/c3\"&gt;\n\n        &lt;androidx.constraintlayout.widget.Guideline\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:orientation=\"horizontal\"\n            app:layout_constraintGuide_begin=\"10dp\" /&gt;\n\n        &lt;androidx.constraintlayout.widget.Guideline\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:orientation=\"horizontal\"\n            app:layout_constraintGuide_end=\"10dp\" /&gt;\n\n        &lt;androidx.constraintlayout.widget.Guideline\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:orientation=\"vertical\"\n            app:layout_constraintGuide_begin=\"10dp\" /&gt;\n\n        &lt;androidx.constraintlayout.widget.Guideline\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:orientation=\"vertical\"\n            app:layout_constraintGuide_end=\"10dp\" /&gt;\n\n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre> as\u9884\u89c8\u56fe</p> <p></p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#_6","title":"\u5c4f\u969c\u7ea6\u675f","text":"<p>\u4e0e\u5f15\u5bfc\u7ebf\u7c7b\u4f3c\uff0c\u5c4f\u969c\u662f\u4e00\u6761\u9690\u85cf\u7684\u7ebf\uff0c\u60a8\u53ef\u4ee5\u7528\u5b83\u6765\u7ea6\u675f\u89c6\u56fe\u3002\u5c4f\u969c\u4e0d\u4f1a\u5b9a\u4e49\u81ea\u5df1\u7684\u4f4d\u7f6e\uff1b\u76f8\u53cd\uff0c\u5c4f\u969c\u7684\u4f4d\u7f6e\u4f1a\u968f\u7740\u5176\u4e2d\u6240\u542b\u89c6\u56fe\u7684\u4f4d\u7f6e\u800c\u79fb\u52a8\u3002 \u5982\u679c\u60a8\u5e0c\u671b\u5c06\u89c6\u56fe\u9650\u5236\u5230\u4e00\u7ec4\u89c6\u56fe\u800c\u4e0d\u662f\u67d0\u4e2a\u7279\u5b9a\u89c6\u56fe\uff0c\u8fd9\u5c31\u975e\u5e38\u6709\u7528\u3002 </p> <p></p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#_7","title":"\u7ad6\u76f4\u5c4f\u969c\u793a\u4f8b","text":"<p>\u8fd9\u662f\u4e00\u4e2a\u7ad6\u76f4\u5c4f\u969c\u7684\u4f8b\u5b50\u3002barrier1\u4ee5tv221\u548ctv222\u4f5c\u4e3a\u53c2\u8003\u3002</p> <p>\u8bbe\u7f6e<code>app:barrierDirection=\"end\"</code>\uff0c\u5e76\u4e14\u8bbe\u7f6etv223\u5728\u5b83\u7684\u53f3\u4fa7\u3002</p> <p>\u4e5f\u5c31\u662fbarrier1\u4f1a\u88abtv221\u548ctv222\u201c\u63a8\u201d\u7740\u8d70\u3002 <pre><code>    &lt;androidx.constraintlayout.widget.ConstraintLayout\n        android:id=\"@+id/c22\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"120dp\"\n        android:layout_marginTop=\"10dp\"\n        android:background=\"#f3f3f3\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@id/c21\"&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv221\"\n            style=\"@style/ConSampleText\"\n            android:layout_marginStart=\"10dp\"\n            android:text=\"an\"\n            app:layout_constraintStart_toStartOf=\"parent\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv222\"\n            style=\"@style/ConSampleText\"\n            android:layout_marginTop=\"4dp\"\n            android:text=\"RustFisher\"\n            app:layout_constraintStart_toStartOf=\"parent\"\n            app:layout_constraintTop_toBottomOf=\"@id/tv221\" /&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:layout_marginTop=\"4dp\"\n            android:text=\"\u6ca1\u6709\u4ee5\u6b64\u4f5c\u4e3a\u53c2\u8003\uff0c\u4e0d\u7ba1\u8fd9\u4e2a\u6709\u591a\u957f\"\n            app:layout_constraintStart_toStartOf=\"parent\"\n            app:layout_constraintTop_toBottomOf=\"@id/tv222\" /&gt;\n\n        &lt;androidx.constraintlayout.widget.Barrier\n            android:id=\"@+id/barrier1\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            app:barrierDirection=\"end\"\n            app:constraint_referenced_ids=\"tv221 ,tv222\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv223\"\n            style=\"@style/ConSampleText\"\n            android:layout_marginStart=\"10dp\"\n            android:text=\".com\"\n            app:layout_constraintStart_toEndOf=\"@id/barrier1\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre></p> <p>\u9884\u89c8\u56fe</p> <p></p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#_8","title":"\u8c03\u6574\u7ea6\u675f\u504f\u5dee","text":"<p>\u5bf9\u67d0\u4e2a\u89c6\u56fe\u7684\u4e24\u4fa7\u6dfb\u52a0\u7ea6\u675f\u6761\u4ef6\uff08\u5e76\u4e14\u540c\u4e00\u7ef4\u5ea6\u7684\u89c6\u56fe\u5c3a\u5bf8\u4e3a\u201cfixed\u201d\u6216\u8005\u201cwrap Content\u201d\uff09\u65f6\uff0c\u5219\u8be5\u89c6\u56fe\u5728\u4e24\u4e2a\u7ea6\u675f\u6761\u4ef6\u4e4b\u95f4\u5c45\u4e2d\u4e14\u9ed8\u8ba4\u504f\u5dee\u4e3a 50%\u3002 \u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u5c5e\u6027\u6765\u8c03\u6574\u504f\u5dee\u3002 - <code>app:layout_constraintVertical_bias</code> - <code>app:layout_constraintHorizontal_bias</code></p> <p>\u4f8b\u5982 <pre><code>    &lt;androidx.constraintlayout.widget.ConstraintLayout\n        android:id=\"@+id/c23\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"140dp\"\n        android:layout_marginTop=\"10dp\"\n        android:background=\"#f3f3f3\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@id/c22\"&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:text=\"Rust\"\n            app:layout_constraintBottom_toBottomOf=\"parent\"\n            app:layout_constraintEnd_toEndOf=\"parent\"\n            app:layout_constraintStart_toStartOf=\"parent\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:text=\"0.33,0.33\"\n            app:layout_constraintBottom_toBottomOf=\"parent\"\n            app:layout_constraintEnd_toEndOf=\"parent\"\n            app:layout_constraintHorizontal_bias=\"0.33\"\n            app:layout_constraintStart_toStartOf=\"parent\"\n            app:layout_constraintTop_toTopOf=\"parent\"\n            app:layout_constraintVertical_bias=\"0.33\" /&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:text=\"0.8,0.8\"\n            app:layout_constraintBottom_toBottomOf=\"parent\"\n            app:layout_constraintEnd_toEndOf=\"parent\"\n            app:layout_constraintHorizontal_bias=\"0.8\"\n            app:layout_constraintStart_toStartOf=\"parent\"\n            app:layout_constraintTop_toTopOf=\"parent\"\n            app:layout_constraintVertical_bias=\"0.8\" /&gt;\n\n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre></p> <p>as\u9884\u89c8\u56fe</p> <p></p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#_9","title":"\u8c03\u6574\u89c6\u56fe\u5c3a\u5bf8","text":"<p>\u8fd9\u91cc\u8c03\u6574\u7684\u662f\u5b50view\u7684\u5c3a\u5bf8\u3002</p> <p>Match Constraints \u89c6\u56fe\u4f1a\u5c3d\u53ef\u80fd\u6269\u5c55\uff0c\u4ee5\u6ee1\u8db3\u6bcf\u4fa7\u7684\u7ea6\u675f\u6761\u4ef6\uff08\u5728\u8003\u8651\u89c6\u56fe\u7684\u5916\u8fb9\u8ddd\u4e4b\u540e\uff09\u3002 \u4e0d\u8fc7\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u5c5e\u6027\u548c\u503c\u4fee\u6539\u8be5\u884c\u4e3a\uff08\u8fd9\u4e9b\u5c5e\u6027\u4ec5\u5728\u60a8\u5c06\u89c6\u56fe\u5bbd\u5ea6\u8bbe\u7f6e\u4e3a\u201cmatch constraints\u201d\u65f6\u624d\u4f1a\u751f\u6548\uff09\uff1a</p> <p>layout_constraintWidth_default - spread\uff1a\u5c3d\u53ef\u80fd\u6269\u5c55\u89c6\u56fe\u4ee5\u6ee1\u8db3\u6bcf\u4fa7\u7684\u7ea6\u675f\u6761\u4ef6\u3002\u8fd9\u662f\u9ed8\u8ba4\u884c\u4e3a\u3002 - wrap\uff1a\u4ec5\u5728\u9700\u8981\u65f6\u6269\u5c55\u89c6\u56fe\u4ee5\u9002\u5e94\u5176\u5185\u5bb9\uff0c\u4f46\u5982\u6709\u7ea6\u675f\u6761\u4ef6\u9650\u5236\uff0c\u89c6\u56fe\u4ecd\u7136\u53ef\u4ee5\u5c0f\u4e8e\u5176\u5185\u5bb9\u3002\u56e0\u6b64\uff0c\u5b83\u4e0e\u4f7f\u7528 Wrap Content\uff08\u4e0a\u9762\uff09\u4e4b\u95f4\u7684\u533a\u522b\u5728\u4e8e\uff0c\u5c06\u5bbd\u5ea6\u8bbe\u4e3a Wrap Content \u4f1a\u5f3a\u884c\u4f7f\u5bbd\u5ea6\u59cb\u7ec8\u4e0e\u5185\u5bb9\u5bbd\u5ea6\u5b8c\u5168\u5339\u914d\uff1b\u800c\u4f7f\u7528 layout_constraintWidth_default \u8bbe\u7f6e\u4e3a wrap \u7684Match Constraints \u65f6\uff0c\u89c6\u56fe\u53ef\u4ee5\u5c0f\u4e8e\u5185\u5bb9\u5bbd\u5ea6\u3002</p> <ul> <li><code>layout_constraintWidth_min</code> \u8be5\u89c6\u56fe\u7684\u6700\u5c0f\u5bbd\u5ea6\u91c7\u7528 dp \u7ef4\u5ea6\u3002</li> <li><code>layout_constraintWidth_max</code> \u8be5\u89c6\u56fe\u7684\u6700\u5927\u5bbd\u5ea6\u91c7\u7528 dp \u7ef4\u5ea6\u3002</li> </ul> <p>layout\u4e2d\u8bbe\u7f6e <code>android:layout_width=\"0dp\"</code>\u548c<code>android:layout_height=\"0dp\"</code>\u3002 \u786e\u5b9a\u597d\u5468\u56f4\u7684\u53c2\u7167\u7ebf\u3002 <pre><code>    &lt;androidx.constraintlayout.widget.ConstraintLayout\n        android:id=\"@+id/c24\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"200dp\"\n        android:layout_marginTop=\"20dp\"\n        android:background=\"#009C8D\"\n        app:layout_constraintTop_toBottomOf=\"@id/c23\"&gt;\n\n        &lt;androidx.constraintlayout.widget.Guideline\n            android:id=\"@+id/v50\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:orientation=\"vertical\"\n            app:layout_constraintGuide_percent=\"0.5\" /&gt;\n\n        &lt;androidx.constraintlayout.widget.Guideline\n            android:id=\"@+id/h50\"\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:orientation=\"horizontal\"\n            app:layout_constraintGuide_percent=\"0.5\" /&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:layout_width=\"0dp\"\n            android:layout_height=\"0dp\"\n            android:layout_margin=\"30dp\"\n            android:gravity=\"center\"\n            android:text=\"R\"\n            app:layout_constraintBottom_toTopOf=\"@id/h50\"\n            app:layout_constraintEnd_toStartOf=\"@id/v50\"\n            app:layout_constraintStart_toStartOf=\"parent\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:layout_width=\"0dp\"\n            android:layout_height=\"0dp\"\n            android:layout_margin=\"30dp\"\n            android:gravity=\"center\"\n            android:text=\"U\"\n            app:layout_constraintBottom_toTopOf=\"@id/h50\"\n            app:layout_constraintEnd_toEndOf=\"parent\"\n            app:layout_constraintStart_toEndOf=\"@id/v50\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:layout_width=\"0dp\"\n            android:layout_height=\"0dp\"\n            android:layout_margin=\"30dp\"\n            android:gravity=\"center\"\n            android:text=\"S\"\n            app:layout_constraintBottom_toBottomOf=\"parent\"\n            app:layout_constraintEnd_toStartOf=\"@id/v50\"\n            app:layout_constraintStart_toStartOf=\"parent\"\n            app:layout_constraintTop_toBottomOf=\"@id/h50\" /&gt;\n\n        &lt;TextView\n            style=\"@style/ConSampleText\"\n            android:layout_width=\"0dp\"\n            android:layout_height=\"0dp\"\n            android:layout_margin=\"30dp\"\n            android:gravity=\"center\"\n            android:text=\"T\"\n            app:layout_constraintBottom_toBottomOf=\"parent\"\n            app:layout_constraintEnd_toEndOf=\"parent\"\n            app:layout_constraintStart_toEndOf=\"@id/v50\"\n            app:layout_constraintTop_toBottomOf=\"@id/h50\" /&gt;\n\n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre></p> <p>as\u9884\u89c8\u56fe  \u8fd0\u884c\u622a\u56fe </p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#_10","title":"\u5c06\u5c3a\u5bf8\u8bbe\u7f6e\u4e3a\u6bd4\u4f8b","text":"<p>\u6bd4\u4f8b\u4e3a\u5bbd\u6bd4\u9ad8 width:height\u3002\u5982\u679c\u5bbd\u9ad8\u5176\u4e2d\u4e00\u4e2a\u8bbe\u7f6e\u4e86\u5927\u4e8e0\u7684\u5177\u4f53\u503c\u6216wrap_content\uff0c\u53ef\u4ee5\u5176\u4e3a\u6807\u51c6\u6765\u8c03\u6574\u53e6\u4e00\u4e2a\u5c3a\u5bf8\u53c2\u6570\u3002</p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#1","title":"\u793a\u4f8b1","text":"<p>\u8bbe\u7f6e<code>layout_width=\"40dp\"</code>\uff0c<code>android:layout_height=\"0dp\"</code>\uff0c\u6bd4\u4f8b\u4e3a3:2\u3002 \u4ee5\u5bbd40dp\u4e3a\u57fa\u51c6\uff0c\u6309\u6bd4\u4f8b\u8c03\u6574\u9ad8\u5ea6\u3002 <pre><code>&lt;androidx.constraintlayout.widget.ConstraintLayout\n    android:layout_width=\"@dimen/con_card_size\"\n    android:layout_height=\"@dimen/con_card_size\"\n    android:background=\"#f0f0f0\"&gt;\n\n    &lt;TextView\n        android:layout_width=\"40dp\"\n        android:layout_height=\"0dp\"\n        android:layout_marginTop=\"16dp\"\n        android:layout_marginBottom=\"16dp\"\n        android:background=\"#2196F3\"\n        android:gravity=\"center\"\n        android:text=\"3:2\"\n        android:textColor=\"#ffffff\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintDimensionRatio=\"3:2\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre></p> <p>\u9884\u89c8\u56fe </p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#2","title":"\u793a\u4f8b2","text":"<p>\u9ad8\u5ea640dp\uff0c\u6bd4\u4f8b3:2\uff0c\u81ea\u52a8\u8c03\u6574\u5bbd\u5ea6\u3002 <pre><code>&lt;androidx.constraintlayout.widget.ConstraintLayout\n    android:layout_width=\"@dimen/con_card_size\"\n    android:layout_height=\"@dimen/con_card_size\"\n    android:layout_marginStart=\"20dp\"\n    android:background=\"#f0f0f0\"&gt;\n\n    &lt;TextView\n        android:layout_width=\"0dp\"\n        android:layout_height=\"40dp\"\n        android:layout_marginTop=\"16dp\"\n        android:layout_marginBottom=\"16dp\"\n        android:background=\"#009688\"\n        android:gravity=\"center\"\n        android:text=\"3:2\"\n        android:textColor=\"#ffffff\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintDimensionRatio=\"3:2\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre></p> <p>\u9884\u89c8\u56fe </p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#0","title":"\u5bbd\u9ad8\u90fd\u8bbe\u4e3a0","text":"<p>\u5bbd\u9ad8\u90fd\u8bbe\u7f6e\u4e3a0dp\uff0c\u6bd4\u4f8b\u4e3a3:2\u3002\u4f1a\u5c1d\u8bd5\u586b\u6ee1\u6574\u4e2a\u7236layout\u3002 <pre><code>&lt;androidx.constraintlayout.widget.ConstraintLayout\n    android:layout_width=\"@dimen/con_card_size\"\n    android:layout_height=\"@dimen/con_card_size\"\n    android:layout_marginStart=\"20dp\"\n    android:background=\"#f0f0f0\"&gt;\n\n    &lt;TextView\n        android:layout_width=\"0dp\"\n        android:layout_height=\"0dp\"\n        android:background=\"#3F51B5\"\n        android:gravity=\"center\"\n        android:text=\"3:2\"\n        android:textColor=\"#ffffff\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintDimensionRatio=\"3:2\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre></p> <p>\u9884\u89c8\u56fe </p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#wrap_content0","title":"\u5bbdwrap_content\uff0c\u9ad8\u5ea60","text":"<p>layout_width -&gt; wrap_content\uff0c\u9ad8\u5ea6\u4e3a0\uff0c\u6bd4\u4f8b1:2\u3002\u4ee5\u5bbd\u5ea6\u4e3a\u57fa\u51c6\u3002 <pre><code>&lt;androidx.constraintlayout.widget.ConstraintLayout\n    android:layout_width=\"@dimen/con_card_size\"\n    android:layout_height=\"@dimen/con_card_size\"\n    android:background=\"#f0f0f0\"&gt;\n\n    &lt;TextView\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"0dp\"\n        android:layout_marginTop=\"16dp\"\n        android:layout_marginBottom=\"16dp\"\n        android:background=\"#009688\"\n        android:gravity=\"center\"\n        android:text=\"1:2\"\n        android:textColor=\"#ffffff\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintDimensionRatio=\"1:2\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre> \u9884\u89c8\u56fe </p>"},{"location":"android/ui/layout/constraintlayout/ConstraintLayout-intro-and-use1/#wrap_content0_1","title":"\u9ad8\u5ea6wrap_content\uff0c\u5bbd\u5ea60","text":"<p>\u6bd4\u4f8b5:2\uff0c\u4f1a\u4ee5\u9ad8\u5ea6\u4e3a\u57fa\u51c6\u3002 <pre><code>&lt;androidx.constraintlayout.widget.ConstraintLayout\n    android:layout_width=\"@dimen/con_card_size\"\n    android:layout_height=\"@dimen/con_card_size\"\n    android:layout_marginStart=\"20dp\"\n    android:background=\"#f0f0f0\"\n    app:layout_constraintTop_toTopOf=\"parent\"&gt;\n\n    &lt;TextView\n        android:layout_width=\"0dp\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginTop=\"16dp\"\n        android:layout_marginBottom=\"16dp\"\n        android:background=\"#009688\"\n        android:gravity=\"center\"\n        android:text=\"5:2\"\n        android:textColor=\"#ffffff\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintDimensionRatio=\"5:2\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre></p> <p>\u9884\u89c8\u56fe </p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u6398\u91d1 \u7b80\u4e66 \u534e\u4e3a\u4e91\u793e\u533a</p>"},{"location":"android/ui/layout/constraintlayout/chain_use/","title":"Android ConstraintLayout \u4f7f\u7528\u94fe\u63a7\u5236\u7ebf\u6027\u7ec4","text":"<p>\u94fe\u662f\u4e00\u7ec4\u89c6\u56fe\uff0c\u8fd9\u4e9b\u89c6\u56fe\u901a\u8fc7\u53cc\u5411\u4f4d\u7f6e\u7ea6\u675f\u6761\u4ef6\u76f8\u4e92\u94fe\u63a5\u5230\u4e00\u8d77\u3002\u94fe\u4e2d\u7684\u89c6\u56fe\u53ef\u4ee5\u5782\u76f4\u6216\u6c34\u5e73\u5206\u5e03\u3002</p> <ul> <li> <ol> <li>Spread\uff1a\u89c6\u56fe\u662f\u5747\u5300\u5206\u5e03\u7684\uff08\u5728\u8003\u8651\u5916\u8fb9\u8ddd\u4e4b\u540e\uff09\u3002\u8fd9\u662f\u9ed8\u8ba4\u503c\u3002</li> </ol> </li> <li> <ol> <li>Spread inside\uff1a\u7b2c\u4e00\u4e2a\u548c\u6700\u540e\u4e00\u4e2a\u89c6\u56fe\u56fa\u5b9a\u5728\u94fe\u4e24\u7aef\u7684\u7ea6\u675f\u8fb9\u754c\u4e0a\uff0c\u5176\u4f59\u89c6\u56fe\u5747\u5300\u5206\u5e03\u3002</li> </ol> </li> <li> <ol> <li>Weighted\uff1a\u5f53\u94fe\u8bbe\u7f6e\u4e3a spread \u6216 spread inside \u65f6\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u89c6\u56fe\u8bbe\u7f6e\u4e3a\u201cmatch constraints\u201d(0dp) \u6765\u586b\u5145\u5269\u4f59\u7a7a\u95f4\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8bbe\u7f6e\u4e3a\u201cmatch constraints\u201d\u7684\u6bcf\u4e2a\u89c6\u56fe\u4e4b\u95f4\u7684\u7a7a\u95f4\u5747\u5300\u5206\u5e03\uff0c\u4f46\u60a8\u53ef\u4ee5\u4f7f\u7528 layout_constraintHorizontal_weight \u548c layout_constraintVertical_weight \u5c5e\u6027\u4e3a\u6bcf\u4e2a\u89c6\u56fe\u5206\u914d\u91cd\u8981\u6027\u6743\u91cd\u3002\u5982\u679c\u60a8\u719f\u6089\u7ebf\u6027\u5e03\u5c40\u4e2d\u7684 layout_weight \u7684\u8bdd\uff0c\u5c31\u4f1a\u77e5\u9053\u8be5\u6837\u5f0f\u4e0e\u5b83\u7684\u539f\u7406\u662f\u76f8\u540c\u7684\u3002\u56e0\u6b64\uff0c\u6743\u91cd\u503c\u6700\u9ad8\u7684\u89c6\u56fe\u83b7\u5f97\u7684\u7a7a\u95f4\u6700\u5927\uff1b\u76f8\u540c\u6743\u91cd\u7684\u89c6\u56fe\u83b7\u5f97\u540c\u6837\u5927\u5c0f\u7684\u7a7a\u95f4\u3002</li> </ol> </li> <li> <ol> <li>Packed\uff1a\u89c6\u56fe\u6253\u5305\u5728\u4e00\u8d77\uff08\u5728\u8003\u8651\u5916\u8fb9\u8ddd\u4e4b\u540e\uff09\u3002 \u7136\u540e\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u66f4\u6539\u94fe\u7684\u5934\u89c6\u56fe\u504f\u5dee\u8c03\u6574\u6574\u6761\u94fe\u7684\u504f\u5dee\uff08\u5de6/\u53f3\u6216\u4e0a/\u4e0b\uff09\u3002</li> </ol> </li> </ul> <p></p> <p>\u94fe\u7684\u201c\u5934\u201d\u89c6\u56fe\uff1a\u6c34\u5e73\u94fe\u4e2d\u6700\u5de6\u4fa7\u7684\u89c6\u56fe\u4ee5\u53ca\u5782\u76f4\u94fe\u4e2d\u6700\u9876\u90e8\u7684\u89c6\u56fe\u3002</p> <p>\u94fe\u7684\u201c\u5c3e\u201d\u89c6\u56fe\uff1a\u6c34\u5e73\u94fe\u4e2d\u6700\u53f3\uff08end\uff09\u4fa7\u7684\u89c6\u56fe\u4ee5\u53ca\u5782\u76f4\u94fe\u4e2d\u6700\u5e95\u90e8\u7684\u89c6\u56fe\u3002</p> <p>\u8981\u7ec4\u6210\u94fe\uff0c\u5934\u548c\u5c3e\u5fc5\u987b\u8fdb\u884c\u8bbe\u7f6e\u3002 \u4ee5\u6c34\u5e73\u94fe\u4e3a\u4f8b</p> <ul> <li>\u5934 <code>app:layout_constraintStart_toStartOf=\"parent\"</code></li> <li>\u5c3e <code>app:layout_constraintEnd_toEndOf=\"parent\"</code></li> </ul>"},{"location":"android/ui/layout/constraintlayout/chain_use/#_1","title":"\u6c34\u5e73\u94fe","text":""},{"location":"android/ui/layout/constraintlayout/chain_use/#spread","title":"\u9ed8\u8ba4\u5747\u5300\u5206\u5e03 Spread","text":"<p>4\u4e2aTextView\u6c34\u5e73\u6392\u5f00\uff0c\u5747\u5300\u5206\u5e03\u3002 layout\u4e2d\u7b80\u5355\u8bf4\u6765\u662f\u4e92\u76f8\u4f5c\u4e3a\u53c2\u7167\u7269\u3002</p> <pre><code>    &lt;androidx.constraintlayout.widget.ConstraintLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"60dp\"\n        android:layout_marginTop=\"20dp\"\n        android:background=\"#fff\"&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv1\"\n            style=\"@style/ConSampleText\"\n            android:layout_marginEnd=\"8dp\"\n            android:background=\"#009688\"\n            android:gravity=\"center\"\n            android:text=\"R\"\n            android:textColor=\"#ffffff\"\n            app:layout_constraintEnd_toStartOf=\"@+id/tv2\"\n            app:layout_constraintStart_toStartOf=\"parent\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv2\"\n            style=\"@style/ConSampleText\"\n            android:background=\"#009688\"\n            android:gravity=\"center\"\n            android:text=\"u\"\n            android:textColor=\"#ffffff\"\n            app:layout_constraintEnd_toStartOf=\"@+id/tv3\"\n            app:layout_constraintStart_toEndOf=\"@+id/tv1\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv3\"\n            style=\"@style/ConSampleText\"\n            android:background=\"#009688\"\n            android:gravity=\"center\"\n            android:text=\"s\"\n            android:textColor=\"#ffffff\"\n            app:layout_constraintEnd_toStartOf=\"@+id/tv4\"\n            app:layout_constraintStart_toEndOf=\"@+id/tv2\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv4\"\n            style=\"@style/ConSampleText\"\n            android:background=\"#009688\"\n            android:gravity=\"center\"\n            android:text=\"t\"\n            android:textColor=\"#ffffff\"\n            app:layout_constraintEnd_toEndOf=\"parent\"\n            app:layout_constraintStart_toEndOf=\"@+id/tv3\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre> <p>Spread \u9884\u89c8\u56fe </p> <p>style.xml <pre><code>    &lt;style name=\"ConSampleText\"&gt;\n        &lt;item name=\"android:layout_width\"&gt;wrap_content&lt;/item&gt;\n        &lt;item name=\"android:layout_height\"&gt;wrap_content&lt;/item&gt;\n        &lt;item name=\"android:padding\"&gt;4dp&lt;/item&gt;\n        &lt;item name=\"android:textColor\"&gt;#fff&lt;/item&gt;\n        &lt;item name=\"android:background\"&gt;#3F51B5&lt;/item&gt;\n    &lt;/style&gt;\n</code></pre></p>"},{"location":"android/ui/layout/constraintlayout/chain_use/#spread-inside","title":"Spread inside","text":"<p>\u5982\u679c\u9700\u8981Spread inside\u6837\u5f0f\uff0c\u9700\u8981\u8bbe\u7f6e\u4e00\u4e0b\u201c\u5934\u201d\u5b50view\uff1a<code>app:layout_constraintHorizontal_chainStyle=\"spread_inside\"</code></p> <pre><code>    &lt;!-- ... --&gt;\n    &lt;TextView\n        android:id=\"@+id/tv1\"\n        style=\"@style/ConSampleText\"\n        android:background=\"#009688\"\n        android:gravity=\"center\"\n        android:text=\"R\"\n        android:textColor=\"#ffffff\"\n        app:layout_constraintEnd_toStartOf=\"@+id/tv22\"\n        app:layout_constraintHorizontal_chainStyle=\"spread_inside\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n    &lt;!-- ... --&gt;\n</code></pre> <p>Spread inside \u9884\u89c8\u56fe </p>"},{"location":"android/ui/layout/constraintlayout/chain_use/#weighted","title":"Weighted","text":"<p>\u53ef\u4ee5\u8bbe\u7f6e\u5b50view\u6309\u6bd4\u4f8b\u5206\u914d\u5269\u4f59\u7a7a\u95f4\u3002\u9700\u8981\u5148\u628awidth\u8bbe\u4e3a0dp\u3002 \u5e76\u4e14\u8bbe\u7f6e<code>app:layout_constraintHorizontal_weight</code>\u5c5e\u6027\u3002</p> <p><pre><code>    &lt;androidx.constraintlayout.widget.ConstraintLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"60dp\"\n        android:layout_marginTop=\"20dp\"\n        android:background=\"#fff\"&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv1\"\n            style=\"@style/ConSampleText\"\n            android:layout_width=\"0dp\"\n            app:layout_constraintHorizontal_weight=\"2\"\n            android:background=\"#4CAF50\"\n            android:gravity=\"center\"\n            android:text=\"R\"\n            android:textColor=\"#ffffff\"\n            app:layout_constraintEnd_toStartOf=\"@+id/tv2\"\n            app:layout_constraintStart_toStartOf=\"parent\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv2\"\n            style=\"@style/ConSampleText\"\n            android:layout_width=\"0dp\"\n            android:background=\"#009688\"\n            app:layout_constraintHorizontal_weight=\"1\"\n            android:gravity=\"center\"\n            android:text=\"u\"\n            android:textColor=\"#ffffff\"\n            app:layout_constraintEnd_toStartOf=\"@+id/tv3\"\n            app:layout_constraintStart_toEndOf=\"@+id/tv1\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv3\"\n            style=\"@style/ConSampleText\"\n            android:background=\"#4CAF50\"\n            android:gravity=\"center\"\n            android:text=\"s\"\n            android:textColor=\"#ffffff\"\n            app:layout_constraintEnd_toStartOf=\"@+id/tv4\"\n            app:layout_constraintStart_toEndOf=\"@+id/tv2\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv4\"\n            style=\"@style/ConSampleText\"\n            android:background=\"#009688\"\n            android:gravity=\"center\"\n            android:text=\"t\"\n            android:textColor=\"#ffffff\"\n            app:layout_constraintEnd_toEndOf=\"parent\"\n            app:layout_constraintStart_toEndOf=\"@+id/tv3\"\n            app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n\n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre> weighted\u9884\u89c8\u56fe </p>"},{"location":"android/ui/layout/constraintlayout/chain_use/#packed","title":"packed","text":"<p>\u7b2c\u4e00\u4e2a\u5b50view\u8bbe\u7f6e <code>app:layout_constraintHorizontal_chainStyle=\"packed\"</code></p> <pre><code>    &lt;!-- ... --&gt;\n    &lt;TextView\n        android:id=\"@+id/tv1\"\n        style=\"@style/ConSampleText\"\n        android:background=\"#009688\"\n        android:gravity=\"center\"\n        android:text=\"R\"\n        android:textColor=\"#ffffff\"\n        app:layout_constraintEnd_toStartOf=\"@+id/tv22\"\n        app:layout_constraintHorizontal_chainStyle=\"packed\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n    &lt;!-- ... --&gt;\n</code></pre> <p>packed\u9884\u89c8\u56fe </p>"},{"location":"android/ui/layout/constraintlayout/chain_use/#5","title":"5\u7b49\u5206\u5c4f\u5e55","text":"<p>\u7b49\u5206\u5c4f\u5e55\u7684\u65b9\u6cd5\u6709\u5f88\u591a\u79cd\u65b9\u5f0f\u3002\u4f8b\u5982\u52a0\u4e0aguideline\uff0c\u8bbe\u7f6e\u597d\u6bd4\u4f8b\u3002\u8fd9\u91cc\u6211\u4eec\u7528\u94fe\u5f0f\u6765\u6c34\u5e73\u7b49\u5206\u5c4f\u5e55\u6216\u7236layout\u3002 \u4e0d\u8bba\u662f\u5e73\u5206\uff0c3\u7b49\u5206\u6216\u662f5\u7b49\u5206\uff0c\u65b9\u5f0f\u90fd\u662f\u7c7b\u4f3c\u7684\u3002\u4ee55\u7b49\u5206\u4e3a\u4f8b\u3002</p> <p>\u793a\u4f8b\u56fe</p> <p></p> <p>\u5207\u5206\u7684view\uff0c\u5bbd\u5ea6\u8bbe\u7f6e\u4e3a0dp\uff0clayout_constraintHorizontal_weight\u8bbe\u7f6e\u4e3a\u4e00\u6837\u7684\uff0c\u6bd4\u59821\u3002</p> <p>\u5934\u89c6\u56fe\u6ce8\u610f\u8bbe\u7f6e<code>app:layout_constraintHorizontal_chainStyle=\"spread\"</code>\u548c<code>app:layout_constraintStart_toStartOf=\"parent\"</code>\uff1b \u5c3e\u89c6\u56fe\u6ce8\u610f\u8bbe\u7f6e<code>app:layout_constraintEnd_toEndOf=\"parent\"</code>\u3002</p> <pre><code>    &lt;androidx.constraintlayout.widget.ConstraintLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"290dp\"\n        android:layout_marginTop=\"8dp\"\n        android:background=\"#ffffff\"&gt;\n\n        &lt;RelativeLayout\n            android:id=\"@+id/dc_start\"\n            android:layout_width=\"0dp\"\n            android:layout_height=\"match_parent\"\n            app:layout_constraintEnd_toStartOf=\"@id/dc_2\"\n            app:layout_constraintHorizontal_chainStyle=\"spread\"\n            app:layout_constraintHorizontal_weight=\"1\"\n            app:layout_constraintStart_toStartOf=\"parent\"&gt;\n\n            &lt;ImageView\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"match_parent\"\n                android:scaleType=\"center\"\n                android:src=\"@drawable/pic_hj1\" /&gt;\n\n        &lt;/RelativeLayout&gt;\n\n        &lt;RelativeLayout\n            android:id=\"@+id/dc_2\"\n            android:layout_width=\"0dp\"\n            android:layout_height=\"match_parent\"\n            app:layout_constraintEnd_toStartOf=\"@id/dc_3\"\n            app:layout_constraintHorizontal_weight=\"1\"\n            app:layout_constraintStart_toEndOf=\"@id/dc_start\"&gt;\n\n            &lt;ImageView\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"match_parent\"\n                android:scaleType=\"center\"\n                android:src=\"@drawable/pic_hj2\" /&gt;\n\n        &lt;/RelativeLayout&gt;\n\n        &lt;RelativeLayout\n            android:id=\"@+id/dc_3\"\n            android:layout_width=\"0dp\"\n            android:layout_height=\"match_parent\"\n            app:layout_constraintEnd_toStartOf=\"@id/dc_4\"\n            app:layout_constraintHorizontal_weight=\"1\"\n            app:layout_constraintStart_toEndOf=\"@id/dc_2\"&gt;\n\n            &lt;ImageView\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"match_parent\"\n                android:scaleType=\"center\"\n                android:src=\"@drawable/pic_hj3\" /&gt;\n\n        &lt;/RelativeLayout&gt;\n\n        &lt;RelativeLayout\n            android:id=\"@+id/dc_4\"\n            android:layout_width=\"0dp\"\n            android:layout_height=\"match_parent\"\n            app:layout_constraintEnd_toStartOf=\"@id/dc_tail\"\n            app:layout_constraintHorizontal_weight=\"1\"\n            app:layout_constraintStart_toEndOf=\"@id/dc_3\"&gt;\n\n            &lt;ImageView\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"match_parent\"\n                android:scaleType=\"center\"\n                android:src=\"@drawable/pic_hj4\" /&gt;\n\n        &lt;/RelativeLayout&gt;\n\n        &lt;RelativeLayout\n            android:id=\"@+id/dc_tail\"\n            android:layout_width=\"0dp\"\n            android:layout_height=\"match_parent\"\n            app:layout_constraintEnd_toEndOf=\"parent\"\n            app:layout_constraintHorizontal_weight=\"1\"\n            app:layout_constraintStart_toEndOf=\"@+id/dc_4\"&gt;\n\n            &lt;ImageView\n                android:layout_width=\"match_parent\"\n                android:layout_height=\"match_parent\"\n                android:scaleType=\"center\"\n                android:src=\"@drawable/pic_hj5\" /&gt;\n\n        &lt;/RelativeLayout&gt;\n\n    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre>"},{"location":"android/ui/layout/constraintlayout/chain_use/#_2","title":"\u6ce8\u610f\u4e8b\u9879","text":"<p>\u4ee5\u4e0b\u662f\u4f7f\u7528\u94fe\u65f6\u9700\u8981\u8003\u8651\u7684\u5176\u4ed6\u4e8b\u9879\uff1a</p> <ul> <li>\u89c6\u56fe\u53ef\u4ee5\u662f\u6c34\u5e73\u94fe\u548c\u5782\u76f4\u94fe\u7684\u4e00\u90e8\u5206\uff0c\u56e0\u6b64\u53ef\u4ee5\u8f7b\u677e\u6784\u5efa\u7075\u6d3b\u7684\u7f51\u683c\u5e03\u5c40\u3002</li> <li>\u53ea\u6709\u5f53\u94fe\u7684\u6bcf\u4e00\u7aef\u90fd\u88ab\u7ea6\u675f\u5230\u540c\u4e00\u8f74\u4e0a\u7684\u53e6\u4e00\u4e2a\u5bf9\u8c61\u65f6\uff0c\u94fe\u624d\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002</li> <li>\u867d\u7136\u94fe\u7684\u65b9\u5411\u4e3a\u5782\u76f4\u6216\u6c34\u5e73\uff0c\u4f46\u4f7f\u7528\u5176\u4e2d\u4e00\u4e2a\u65b9\u5411\u4e0d\u4f1a\u6cbf\u8be5\u65b9\u5411\u4e0e\u89c6\u56fe\u5bf9\u9f50\u3002\u56e0\u6b64\uff0c\u8bf7\u52a1\u5fc5\u5305\u542b\u5176\u4ed6\u7ea6\u675f\u6761\u4ef6\uff0c\u4ee5\u4fbf\u4f7f\u94fe\u4e2d\u7684\u6bcf\u4e2a\u89c6\u56fe\u90fd\u80fd\u6b63\u786e\u5b9a\u4f4d\uff0c\u4f8b\u5982\u5bf9\u9f50\u7ea6\u675f\u3002</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u6398\u91d1 \u7b80\u4e66</p>"},{"location":"android/ui/layout/drawerlayout/drawer-layout-use1/","title":"Android DrawerLayout \u4f7f\u7528\u793a\u4f8b","text":"<p>\u8981\u4f7f\u7528DrawerLayout\uff0c\u53ef\u4ee5\u5728layout xml\u6587\u4ef6\u4e2d\u5c06DrawerLayout\u8bbe\u7f6e\u4e3a\u6839\u89c6\u56fe\u3002</p>"},{"location":"android/ui/layout/drawerlayout/drawer-layout-use1/#_1","title":"\u4ece\u5de6\u8fb9\u6ed1\u51fa\u7684\u62bd\u5c49\u89c6\u56fe\uff08\u4fa7\u6ed1\u680f\uff09","text":"<p>\u4e00\u4e2a\u7b80\u5355\u7684\u4ece\u5de6\u8fb9\u6ed1\u51fa\u4fa7\u6ed1\u680f\u7684\u4f8b\u5b50\u3002</p> <p>\u6548\u679c\u56fe</p> <p> </p> <p>\u4fa7\u6ed1\u680f\u6ed1\u51fa\u540e\uff0c\u540e\u9762\u7684\u89c6\u56fe\u4f1a\u6709\u4e2a\u9634\u5f71\u3002</p> <p>layout\u6587\u4ef6 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;androidx.drawerlayout.widget.DrawerLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:orientation=\"vertical\"\n    tools:openDrawer=\"start\"&gt;\n\n    &lt;RelativeLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:layout_centerInParent=\"true\"\n            android:text=\"\u6211\u662f\u4e3b\u9875\" /&gt;\n\n    &lt;/RelativeLayout&gt;\n\n    &lt;RelativeLayout\n        android:layout_width=\"250dp\"\n        android:layout_height=\"match_parent\"\n        android:layout_gravity=\"start\"\n        android:background=\"#ffffff\"&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:layout_centerInParent=\"true\"\n            android:text=\"\u6211\u662f\u4fa7\u6ed1\u680f\" /&gt;\n    &lt;/RelativeLayout&gt;\n\n&lt;/androidx.drawerlayout.widget.DrawerLayout&gt;\n</code></pre> \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cDrawerLayout\u8981\u8bbe\u7f6e<code>tools:openDrawer=\"start\"</code>\uff1b\u800c\u4e14\u4fa7\u6ed1\u680flayout\u8981\u8bbe\u7f6e<code>android:layout_gravity=\"start\"</code>\u3002</p> <p>\u5982\u679c\u6539\u6210<code>tools:openDrawer=\"end\"</code>\uff0c\u4fa7\u6ed1\u680flayout\u8981\u8bbe\u7f6e<code>android:layout_gravity=\"end\"</code>\u3002\u4fa7\u6ed1\u680f\u53ef\u4ee5\u4ece\u53f3\u8fb9\u6ed1\u51fa\u3002</p> <p>\u73b0\u5728\u4fa7\u8fb9\u680f\u653e\u7684\u662fRelativeLayout\u3002 \u4e5f\u53ef\u4ee5\u653e\u4e00\u4e2aRecyclerView\u3002</p>"},{"location":"android/ui/layout/drawerlayout/drawer-layout-use1/#_2","title":"\u62bd\u5c49\u51fa\u6765\u65f6\u63a8\u52a8\u9875\u9762","text":"<p>\u76d1\u542c\u4fa7\u6ed1\u680f\u7684\u6ed1\u52a8\u4e8b\u4ef6\uff0c\u4f7f\u7528<code>ActionBarDrawerToggle</code>\u3002\u4fa7\u6ed1\u680f\u6ed1\u51fa\u65f6\uff0c\u5728<code>onDrawerSlide</code>\u65b9\u6cd5\u4e2d\u8ba1\u7b97\u51fa\u6ed1\u52a8\u7684\u8ddd\u79bb\u3002 \u7136\u540e\u4e3b\u89c6\u56fe\u8bbe\u7f6e\u6c34\u5e73\u76f8\u5bf9\u504f\u79fb\u8ddd\u79bb<code>setTranslationX</code>\u5373\u53ef\u3002</p> <p></p> <p>\u53ef\u5728activity\u7684onCreate\u65b9\u6cd5\u6267\u884c\u914d\u7f6e\u64cd\u4f5c <pre><code>    DrawerLayout root = findViewById(R.id.root);\n    final View contentView = findViewById(R.id.content_field);\n\n    ActionBarDrawerToggle actionBarDrawerToggle = new ActionBarDrawerToggle(this, root, android.R.string.yes, android.R.string.cancel) {\n\n        @Override\n        public void onDrawerSlide(View drawerView, float slideOffset) {\n            super.onDrawerSlide(drawerView, slideOffset);\n            float slideX = drawerView.getWidth() * slideOffset;\n            contentView.setTranslationX(slideX);\n        }\n    };\n    root.addDrawerListener(actionBarDrawerToggle);\n</code></pre></p>"},{"location":"android/ui/layout/drawerlayout/drawer-layout-use1/#_3","title":"\u6539\u53d8\u6ed1\u51fa\u65f6\u7684\u9634\u5f71","text":"<p>\u4f7f\u7528DrawerLayout\u7684<code>setScrimColor</code>\u65b9\u6cd5\uff0c\u6539\u53d8\u9634\u5f71\u989c\u8272\u3002\u9ed8\u8ba4\u7684\u9634\u5f71\u989c\u8272\u662f <code>DEFAULT_SCRIM_COLOR = 0x99000000</code>\u3002</p> <p></p> <pre><code>DrawerLayout root = findViewById(R.id.root);\nroot.setScrimColor(Color.TRANSPARENT);\n</code></pre>"},{"location":"android/ui/layout/drawerlayout/drawer-layout-use1/#drawerlayout","title":"\u9501\u5b9aDrawerLayout","text":"<pre><code>root.setDrawerLockMode(DrawerLayout.LOCK_MODE_UNLOCKED); // \u89e3\u9501\n\nroot.setDrawerLockMode(DrawerLayout.LOCK_MODE_LOCKED_CLOSED); // \u4e0d\u68c0\u6d4b\u4ece\u5de6\u5230\u53f3\u7684\u6ed1\u52a8\u52a8\u4f5c\n</code></pre>"},{"location":"android/ui/layout/linearLayout/intro/","title":"LinearLayout\u7b80\u8ff0","text":"<p>\u7b80\u8ff0LinearLayout\u7684\u4f7f\u7528\u65b9\u5f0f\u548c\u7279\u70b9\u3002\u7ed9\u51fa\u4e00\u4e9b\u793a\u4f8b\u770b\u770bLinearLayout\u600e\u4e48\u7528\u3002</p> <p>LinearLayout\u91cc\u9762\u53ef\u4ee5\u653e\u7f6e\u591a\u4e2aview\uff08\u8fd9\u91cc\u79f0\u4e3a\u5b50view\uff0c\u5b50\u9879\uff09\u3002 \u5b50view\u53ef\u4ee5\u662fTextView\uff0cButton\uff0c\u6216\u8005\u662fLinearLayout\uff0cRelativeLayout\u7b49\u7b49\u3002 \u5b83\u4eec\u5c06\u4f1a\u6309\u987a\u5e8f\u4f9d\u6b21\u6392\u5e03\u4e3a\u4e00\u5217\u6216\u4e00\u884c\u3002 \u63a5\u4e0b\u6765\u4ecb\u7ecd\u4e00\u4e9b\u5728xml\u4e2d\u7684\u8bbe\u7f6e\u3002</p> <p>\u5148\u5728xml\u4e2d\u653e\u4e00\u4e2aLinearLayout\u3002 <pre><code>&lt;LinearLayout\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:orientation=\"vertical\"&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre> \u4e0b\u9762\u4ecb\u7ecd\u4e00\u4e9b\u5c5e\u6027\u3002</p>"},{"location":"android/ui/layout/linearLayout/intro/#_1","title":"\u7ad6\u76f4\u6392\u5e03\u4e0e\u6c34\u5e73\u6392\u5e03","text":"<p>\u901a\u8fc7\u8bbe\u7f6eorientation\u6765\u786e\u5b9a\u6c34\u5e73\u6216\u7ad6\u76f4\u6392\u5e03\u5b50view\u3002 \u53ef\u9009\u503c\u6709vertical\u548chorizontal\u3002</p>"},{"location":"android/ui/layout/linearLayout/intro/#_2","title":"\u7ad6\u76f4\u6392\u5e03","text":"<p>\u8bbe\u7f6eorientation\u4e3avertical\u3002 <pre><code>android:orientation=\"vertical\"\n</code></pre></p>"},{"location":"android/ui/layout/linearLayout/intro/#_3","title":"\u6c34\u5e73\u6392\u5e03","text":"<p>\u8bbe\u7f6eorientation\u4e3ahorizontal\u3002 <pre><code>android:orientation=\"horizontal\"\n</code></pre></p>"},{"location":"android/ui/layout/linearLayout/intro/#gravity","title":"\u6392\u5e03\u65b9\u5f0f gravity","text":"<p>\u51b3\u5b9a\u5b50view\u7684\u6392\u5e03\u65b9\u5f0f\u3002<code>gravity</code>\u6709\u201c\u91cd\u529b\u201d\u7684\u610f\u601d\uff0c\u6211\u4eec\u5f15\u7533\u4e3a\u5b50view\u4f1a\u5411\u54ea\u4e2a\u65b9\u5411\u9760\u62e2\u3002 <code>gravity</code>\u6709\u51e0\u4e2a\u9009\u9879\u53ef\u4ee5\u9009\u62e9\uff0c\u6211\u4eec\u5e38\u7528\u7684\u6709start\uff0cend\uff0cleft\uff0cright\uff0ctop\uff0cbottom\u3002</p> <p>\u4f8b\u5982 <pre><code>&lt;LinearLayout\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:gravity=\"start\"\n    android:orientation=\"vertical\"&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre></p> <p>\u4e0b\u9762\u662fgravity\u7684\u9009\u9879\u3002\u6211\u4eec\u4f1a\u628aLinearLayout\u53eb\u505a\u201c\u7236view\u201d\u6216\u8005\u201c\u5bb9\u5668\u201d\u3002</p> \u5e38\u91cf \u5b9a\u4e49\u503c \u63cf\u8ff0 top 30 \u628aview\u63a8\u5230\u5bb9\u5668\u91cc\u7684\u9876\u90e8\u3002\u4e0d\u4f1a\u6539\u53d8view\u7684\u5c3a\u5bf8\u3002 bottom 50 \u628aview\u63a8\u5230\u5bb9\u5668\u7684\u5e95\u90e8\u3002\u4e0d\u4f1a\u6539\u53d8view\u7684\u5c3a\u5bf8\u3002 center 11 \u5b50view\u6c34\u5e73\u4e0e\u7ad6\u76f4\u90fd\u5c45\u4e2d\u3002\u4e0d\u4f1a\u6539\u53d8view\u7684\u5c3a\u5bf8\u3002 center_horizontal 1 \u5b50view\u6c34\u5e73\u5c45\u4e2d\u3002\u4e0d\u4f1a\u6539\u53d8view\u7684\u5c3a\u5bf8\u3002 center_vertical 10 \u5b50view\u5782\u76f4\u5c45\u4e2d\u3002\u4e0d\u4f1a\u6539\u53d8view\u7684\u5c3a\u5bf8\u3002 start 800003 \u628aview\u63a8\u5230\u5bb9\u5668\u91cc\u6700\u5f00\u59cb\u7684\u5730\u65b9\u3002\u4e0d\u4f1a\u6539\u53d8view\u7684\u5c3a\u5bf8\u3002 end 800005 \u628a\u5b50view\u653e\u5230\u5bb9\u5668\u7684\u6700\u5c3e\u90e8\u3002\u4e0d\u6539\u53d8view\u7684\u5c3a\u5bf8\u3002 left 3 \u5b50view\u4ece\u5bb9\u5668\u7684\u5de6\u8fb9\u5f00\u59cb\u6392\u5e03\u3002\u4e0d\u4f1a\u6539\u53d8view\u7684\u5c3a\u5bf8\u3002 right 5 \u5b50view\u4ece\u5bb9\u5668\u7684\u53f3\u8fb9\u5f00\u59cb\u6392\u5e03\u3002\u4e0d\u4f1a\u6539\u53d8view\u7684\u5c3a\u5bf8\u3002 <p>start\u548cleft\uff0cend\u548cright\u5e76\u4e0d\u4e00\u5b9a\u662f\u540c\u6837\u7684\u6548\u679c\u3002 \u5bf9\u4e8eRTL\uff08right to left\uff09\u7c7b\u578b\u7684\u624b\u673a\uff0c\u6bd4\u5982\u67d0\u4e9b\u963f\u62c9\u4f2f\u6587\u7684\u7cfb\u7edf\u3002start\u662f\u4ece\u53f3\u5230\u5de6\u7684\u3002 \u6211\u4eec\u65e5\u5e38\u751f\u6d3b\u4e2d\u5f88\u5c11\u89c1\u5230RTL\uff0c\u4e00\u822c\u90fd\u662fLTR\u3002\u4f46\u8fd8\u662f\u5efa\u8bae\u591a\u7528start\u800c\u4e0d\u662fleft\u3002</p> <p>gravity\u53ef\u4ee5\u540c\u65f6\u8bbe\u7f6e\u591a\u4e2a\u503c\uff0c\u7528\u6216\u7b26\u53f7<code>|</code>\u6765\u8fde\u63a5\u3002\u6bd4\u5982<code>android:gravity=\"end|center_vertical\"</code>\u3002 <pre><code>&lt;LinearLayout\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"60dp\"\n    android:gravity=\"end|center_vertical\"\n    android:orientation=\"vertical\"&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre></p> <p></p> <p></p>"},{"location":"android/ui/layout/linearLayout/intro/#viewlayout_gravity","title":"\u5b50view\u7684layout_gravity","text":"<p>layout_gravity\u770b\u8d77\u6765\u548cgravity\u6709\u4e9b\u76f8\u4f3c\u3002</p> <ul> <li><code>android:gravity</code> \u63a7\u5236\u81ea\u5df1\u5185\u90e8\u7684\u5b50\u5143\u7d20\u3002</li> <li><code>android:layout_gravity</code> \u662f\u544a\u8bc9\u7236\u5143\u7d20\u81ea\u5df1\u7684\u4f4d\u7f6e\u3002</li> </ul> <p>\u53d6\u503c\u8303\u56f4\u548cgravity\u662f\u4e00\u6837\u7684\u3002\u4ee3\u8868\u7684\u542b\u4e49\u4e5f\u76f8\u4f3c\u3002 <pre><code>    &lt;LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"100dp\"\n        android:orientation=\"horizontal\"&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:background=\"#90CAF9\"\n            android:text=\"none\" /&gt;\n\n        &lt;TextView\n            android:layout_width=\"wrap_content\"\n            android:layout_height=\"wrap_content\"\n            android:layout_gravity=\"center\"\n            android:background=\"#9FA8DA\"\n            android:text=\"center\" /&gt;\n\n    &lt;/LinearLayout&gt;\n</code></pre></p> <p></p> <p></p>"},{"location":"android/ui/layout/linearLayout/intro/#layout_weight","title":"\u5206\u5272\u5360\u6bd4layout_weight","text":"<p>\u53ef\u4ee5\u5728\u8bbe\u7f6e\u5b50view\u7684layout_weight\uff0c\u6765\u786e\u5b9a\u7a7a\u95f4\u5360\u6bd4\u3002 \u8bbe\u7f6e<code>layout_weight</code>\u7684\u65f6\u5019\uff0c\u4e00\u822c\u8981\u8bbe\u7f6e<code>layout_width=\"0dp\"</code>\u3002 <pre><code>    &lt;LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginTop=\"10dp\"\n        android:background=\"#FFCC80\"\n        android:orientation=\"horizontal\"&gt;\n\n        &lt;TextView\n            android:layout_width=\"0dp\"\n            android:layout_height=\"wrap_content\"\n            android:layout_weight=\"1\"\n            android:background=\"#eaeaea\"\n            android:gravity=\"center\"\n            android:text=\"1\" /&gt;\n\n        &lt;TextView\n            android:layout_width=\"0dp\"\n            android:layout_height=\"wrap_content\"\n            android:layout_weight=\"2\"\n            android:text=\"2\" /&gt;\n\n        &lt;TextView\n            android:layout_width=\"0dp\"\n            android:layout_height=\"wrap_content\"\n            android:layout_weight=\"1\"\n            android:background=\"#eaeaea\"\n            android:text=\"1\" /&gt;\n\n        &lt;TextView\n            android:layout_width=\"0dp\"\n            android:layout_height=\"wrap_content\"\n            android:layout_weight=\"3\"\n            android:background=\"#BEC0D1\"\n            android:text=\"3\" /&gt;\n\n    &lt;/LinearLayout&gt;\n</code></pre></p> <p></p>"},{"location":"android/ui/layout/linearLayout/intro/#weightsum","title":"\u5206\u5272\u5360\u6bd4\u4e4b\u548c weightSum","text":"<p><code>android:weightSum</code> \u5b9a\u4e49\u5b50view\u7684weight\u4e4b\u548c\u7684\u6700\u5927\u503c\u3002\u5982\u679c\u4e0d\u76f4\u63a5\u6307\u5b9a\uff0c\u5b83\u4f1a\u662f\u6240\u6709\u5b50view\u7684<code>layout_weight</code>\u4e4b\u548c\u3002 \u5982\u679c\u60f3\u7ed9\u5355\u72ec\u7684\u4e00\u4e2a\u5b50view\u4e00\u534a\u7684\u7a7a\u95f4\u5360\u6bd4\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u5b50view\u7684layout_weight\u4e3a0.5\uff0c\u5e76\u4e14\u8bbe\u7f6eLinearLayout\u7684weightSum\u4e3a1.0\u3002</p> <p>\u53d6\u503c\u53ef\u4ee5\u662f\u6d6e\u70b9\u6570\uff0c\u6bd4\u5982<code>9.3</code>\u3002</p> <pre><code>    &lt;LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginTop=\"10dp\"\n        android:background=\"#4DB6AC\"\n        android:weightSum=\"9.3\"\n        android:orientation=\"horizontal\"&gt;\n\n        &lt;TextView\n            android:layout_width=\"0dp\"\n            android:layout_height=\"wrap_content\"\n            android:layout_weight=\"4.6\"\n            android:background=\"#eaeaea\"\n            android:gravity=\"center\"\n            android:text=\"4.6\" /&gt;\n\n        &lt;TextView\n            android:layout_width=\"0dp\"\n            android:layout_height=\"wrap_content\"\n            android:background=\"#7986CB\"\n            android:layout_weight=\"2.5\"\n            android:text=\"2.5\" /&gt;\n\n    &lt;/LinearLayout&gt;\n</code></pre> <p></p>"},{"location":"android/ui/layout/linearLayout/intro/#divider","title":"\u5206\u5272\u7ebf divider","text":"<p>\u8bbe\u7f6edivider\u4e0eshowDividers\u5c5e\u6027\u3002 <pre><code>    android:divider=\"@drawable/divider_linear_1\"\n    android:showDividers=\"middle\"\n</code></pre> \u76f4\u63a5\u7ed9divider\u8bbe\u7f6e\u989c\u8272\u662f\u65e0\u6548\u7684\u3002</p> <p>\u5728drawable\u76ee\u5f55\u91cc\u65b0\u5efa\u4e00\u4e2axml\uff0c\u53eb\u505a<code>divider_linear_1.xml</code>\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;shape xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n    &lt;solid android:color=\"#7986CB\" /&gt;\n    &lt;size\n        android:width=\"1dp\"\n        android:height=\"1dp\" /&gt;\n&lt;/shape&gt;\n</code></pre> size\u5fc5\u987b\u6307\u5b9a\uff0c\u5426\u5219\u5f53\u505adivider\u6765\u7528\u65f6\u4f1a\u663e\u793a\u4e0d\u51fa\u6765\u3002</p> <p>LinearLayout\u8bbe\u7f6edivider\u3002 <pre><code>    &lt;LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:background=\"#eaeaea\"\n        android:divider=\"@drawable/divider_linear_1\"\n        android:orientation=\"vertical\"\n        android:showDividers=\"middle\"&gt;\n        ....\n</code></pre></p> <p></p> <p><pre><code>    &lt;LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"100dp\"\n        android:layout_marginTop=\"20dp\"\n        android:background=\"#FFD9D9\"\n        android:divider=\"@drawable/divider_linear_1\"\n        android:orientation=\"horizontal\"\n        android:showDividers=\"middle\"&gt;\n        ...\n</code></pre> </p> <p>showDividers\u6709\u51e0\u79cd\u53ef\u9009</p> <ul> <li>middle \u4e2d\u95f4\u7684\u5206\u5272\u7ebf</li> <li>beginning \u5f00\u59cb\u7684\u5206\u5272\u7ebf</li> <li>end \u7ed3\u675f\u7684\u5206\u5272\u7ebf</li> <li>none \u6ca1\u6709\u5206\u5272\u7ebf</li> </ul> <p>\u66f4\u591a\u8bf7\u53c2\u8003\u5b98\u65b9\u6587\u6863LinearLayout</p>"},{"location":"android/ui/layout/relativeLayout/intro/","title":"RelativeLayout \u76f8\u5bf9\u5e03\u5c40","text":"<p>\u7b80\u8ff0RelativeLayout\u7684\u4f7f\u7528\u65b9\u5f0f\u548c\u7279\u70b9\u3002\u7ed9\u51fa\u4e00\u4e9b\u793a\u4f8b\u770b\u770bRelativeLayout\u600e\u4e48\u7528\u3002</p>"},{"location":"android/ui/layout/relativeLayout/intro/#relativelayout","title":"RelativeLayout \u7b80\u8ff0","text":"<p>RelativeLayout\u548cLinearLayout\u7c7b\u4f3c\uff0c\u90fd\u662fViewGroup\uff0c\u80fd\u201c\u5bb9\u7eb3\u201d\u591a\u4e2a\u5b50view\u3002 RelativeLayout \u662f\u4e00\u4e2a\u4ee5\u76f8\u5bf9\u4f4d\u7f6e\u663e\u793a\u5b50\u89c6\u56fe\u7684\u89c6\u56fe\u7ec4\u3002\u6bcf\u4e2a\u89c6\u56fe\u7684\u4f4d\u7f6e\u53ef\u4ee5\u6307\u5b9a\u4e3a\u76f8\u5bf9\u4e8e\u540c\u7ea7\u5143\u7d20\u7684\u4f4d\u7f6e\uff08\u4f8b\u5982\uff0c\u5728\u53e6\u4e00\u4e2a\u89c6\u56fe\u7684\u5de6\u4fa7\u6216\u4e0b\u65b9\uff09\u6216\u76f8\u5bf9\u4e8e\u7236\u7ea7 RelativeLayout \u533a\u57df\u7684\u4f4d\u7f6e\uff08\u4f8b\u5982\u5728\u5e95\u90e8\u3001\u5de6\u4fa7\u6216\u4e2d\u5fc3\u5bf9\u9f50\uff09\u3002</p> <p>\u5b50view\u53ef\u4ee5\u662fTextView\uff0cButton\uff0c\u6216\u8005\u662fLinearLayout\uff0cRelativeLayout\u7b49\u7b49\u3002 \u5982\u679c\u4e0d\u6dfb\u52a0\u5176\u4ed6\u914d\u7f6e\uff0c\u5b83\u4eec\u9ed8\u8ba4\u662f\u5728RelativeLayout\u7684\u5de6\u4e0a\u89d2\u3002 \u5728RelativeLayout\u4e2d\uff0c\u5b50View\u53ef\u4ee5\u6839\u636e\u53e6\u4e00\u4e2a\u5b50View\u6765\u786e\u5b9a\u4f4d\u7f6e\u3002 \u4f46\u5fc5\u987b\u6ce8\u610f\u7684\u662f\uff0cRelativeLayout\u548c\u5b83\u7684\u5b50View\u4e0d\u80fd\u4e92\u76f8\u4f9d\u8d56\u3002\u6bd4\u5982RelativeLayout\u8bbe\u7f6e\u9ad8\u5ea6\u4e3awrap_content\uff0c\u5b50View\u8bbe\u7f6e\u4e86ALIGN_PARENT_BOTTOM\uff0c\u8fd9\u6837\u4f60\u4f1a\u53d1\u73b0RelativeLayout\u88ab\u6491\u5230\u6700\u5927\u3002 RelativeLayout\u80fd\u6d88\u9664\u5d4c\u5957\u89c6\u56fe\u7ec4\u5e76\u4f7f\u5e03\u5c40\u5c42\u6b21\u7ed3\u6784\u4fdd\u6301\u6241\u5e73\u5316\u3002</p> <p>\u63a5\u4e0b\u6765\u4ecb\u7ecd\u4e00\u4e9b\u5728xml\u4e2d\u7684\u8bbe\u7f6e\u3002</p>"},{"location":"android/ui/layout/relativeLayout/intro/#_1","title":"\u5c5e\u6027\u4ecb\u7ecd","text":"<p>RelativeLayout \u53ef\u4ee5\u6307\u5b9a\u5b50\u89c6\u56fe\u76f8\u5bf9\u4e8e\u7236\u89c6\u56fe\u6216\u5f7c\u6b64\uff08\u7531 ID \u786e\u5b9a\uff09\u7684\u4f4d\u7f6e\u3002\u56e0\u6b64\uff0c\u60a8\u53ef\u4ee5\u6309\u7167\u53f3\u8fb9\u6846\u5bf9\u9f50\u4e24\u4e2a\u5143\u7d20\uff0c\u6216\u8005\u4f7f\u5b83\u4eec\u4e00\u4e0a\u4e00\u4e0b\uff0c\u5c4f\u5e55\u5c45\u4e2d\uff0c\u5de6\u4fa7\u5c45\u4e2d\uff0c\u7b49\u7b49\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6240\u6709\u5b50\u89c6\u56fe\u5747\u7ed8\u5236\u5728\u5e03\u5c40\u7684\u5de6\u4e0a\u89d2\uff0c\u56e0\u6b64\u60a8\u5fc5\u987b\u4f7f\u7528 RelativeLayout.LayoutParams \u4e2d\u63d0\u4f9b\u7684\u5404\u79cd\u5e03\u5c40\u5c5e\u6027\u5b9a\u4e49\u6bcf\u4e2a\u89c6\u56fe\u7684\u4f4d\u7f6e\u3002</p> <p>\u6709\u5f88\u591a\u5e03\u5c40\u5c5e\u6027\u53ef\u7528\u4e8e RelativeLayout \u4e2d\u7684\u89c6\u56fe\uff0c\u90e8\u5206\u793a\u4f8b\u5305\u62ec\uff1a</p> <ul> <li>android:layout_alignParentTop<ul> <li>\u5982\u679c\u4e3a \"true\"\uff0c\u4f1a\u5c06\u6b64\u89c6\u56fe\u7684\u4e0a\u8fb9\u7f18\u4e0e\u7236\u89c6\u56fe\u7684\u4e0a\u8fb9\u7f18\u5bf9\u9f50\u3002</li> </ul> </li> <li>android:layout_centerVertical<ul> <li>\u5982\u679c\u4e3a \"true\"\uff0c\u4f1a\u5c06\u6b64\u5b50\u7ea7\u5728\u7236\u7ea7\u5185\u5782\u76f4\u5c45\u4e2d\u3002</li> </ul> </li> <li>android:layout_below<ul> <li>\u5c06\u6b64\u89c6\u56fe\u7684\u4e0a\u8fb9\u7f18\u653e\u7f6e\u5728\u4f7f\u7528\u8d44\u6e90 ID \u6307\u5b9a\u7684\u89c6\u56fe\u4e0b\u65b9\u3002</li> </ul> </li> <li>android:layout_toRightOf<ul> <li>\u5c06\u6b64\u89c6\u56fe\u7684\u5de6\u8fb9\u7f18\u653e\u7f6e\u5728\u4f7f\u7528\u8d44\u6e90 ID \u6307\u5b9a\u7684\u89c6\u56fe\u53f3\u4fa7\u3002</li> </ul> </li> </ul> <p>\u8fd9\u4e9b\u53ea\u662f\u51e0\u4e2a\u793a\u4f8b\u3002\u6240\u6709\u5e03\u5c40\u5c5e\u6027\u90fd\u8bb0\u5f55\u5728 RelativeLayout.LayoutParams\u3002</p>"},{"location":"android/ui/layout/relativeLayout/intro/#_2","title":"\u793a\u4f8b","text":"<p>\u4e3a\u4e86\u8ba9UI\u597d\u770b\u4e00\u70b9\uff0c\u5148\u5b9a\u4e49\u4e00\u4e0b\u6837\u5f0f\uff0c\u5728<code>style.xml</code>\u6587\u4ef6\u4e2d\u65b0\u589e\u4e00\u4e2astyle\u3002 <pre><code>    &lt;style name=\"RelativeLayoutDemo1Item\"&gt;\n        &lt;item name=\"android:layout_height\"&gt;wrap_content&lt;/item&gt;\n        &lt;item name=\"android:layout_width\"&gt;wrap_content&lt;/item&gt;\n        &lt;item name=\"android:padding\"&gt;4dp&lt;/item&gt;\n        &lt;item name=\"android:background\"&gt;@color/colorAccent&lt;/item&gt;\n        &lt;item name=\"android:textColor\"&gt;#ffffff&lt;/item&gt;\n        &lt;item name=\"android:textSize\"&gt;12sp&lt;/item&gt;\n    &lt;/style&gt;\n</code></pre></p>"},{"location":"android/ui/layout/relativeLayout/intro/#1","title":"\u793a\u4f8b1","text":"<p>\u5728layout\u4e2d\u589e\u52a0RelativeLayout\u4e0e\u4e00\u4e9b\u5b50View\u3002 \u5b50View\u8bbe\u7f6e\u4e86\u4e0d\u540c\u7684\u5c5e\u6027\uff0c\u5206\u5e03\u5728\u7236View\u7684\u4e0a\u4e0b\u5de6\u53f3\u4e2d\u5404\u4e2a\u5730\u65b9\u3002</p> <pre><code>    &lt;RelativeLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"100dp\"&gt;\n\n        &lt;TextView\n            style=\"@style/RelativeLayoutDemo1Item\"\n            android:text=\"default\" /&gt;\n\n        &lt;TextView\n            style=\"@style/RelativeLayoutDemo1Item\"\n            android:layout_alignParentEnd=\"true\"\n            android:text=\"layout_alignParentEnd\" /&gt;\n\n        &lt;TextView\n            style=\"@style/RelativeLayoutDemo1Item\"\n            android:layout_centerInParent=\"true\"\n            android:text=\"layout_centerInParent\" /&gt;\n\n        &lt;TextView\n            style=\"@style/RelativeLayoutDemo1Item\"\n            android:layout_alignParentBottom=\"true\"\n            android:text=\"layout_alignParentBottom\" /&gt;\n\n        &lt;TextView\n            style=\"@style/RelativeLayoutDemo1Item\"\n            android:layout_alignParentEnd=\"true\"\n            android:layout_alignParentBottom=\"true\"\n            android:text=\"layout_alignParentBottom | End\" /&gt;\n\n    &lt;/RelativeLayout&gt;\n</code></pre> <p></p>"},{"location":"android/ui/layout/relativeLayout/intro/#2","title":"\u793a\u4f8b2","text":"<p>\u5b50View\u53ef\u4ee5\u628a\u53e6\u5916\u7684\u5b50View\u5f53\u505a\u4f4d\u7f6e\u4f9d\u636e\u3002 <pre><code>    &lt;RelativeLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"match_parent\"\n        android:layout_marginTop=\"120dp\"&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv1\"\n            style=\"@style/RelativeLayoutDemo1Item\"\n            android:text=\"R\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv2\"\n            style=\"@style/RelativeLayoutDemo1Item\"\n            android:layout_below=\"@id/tv1\"\n            android:layout_toEndOf=\"@id/tv1\"\n            android:text=\"u\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv3\"\n            style=\"@style/RelativeLayoutDemo1Item\"\n            android:layout_below=\"@id/tv2\"\n            android:layout_toEndOf=\"@id/tv2\"\n            android:text=\"s\" /&gt;\n\n        &lt;TextView\n            android:id=\"@+id/tv4\"\n            style=\"@style/RelativeLayoutDemo1Item\"\n            android:layout_below=\"@id/tv3\"\n            android:layout_toEndOf=\"@id/tv3\"\n            android:text=\"t\" /&gt;\n\n    &lt;/RelativeLayout&gt;\n</code></pre> </p> <p>\u66f4\u591a\u8bf7\u53c2\u8003</p> <p>RelativeLayout View.MeasureSpec MeasureSpec\u7b80\u8ff0</p>"},{"location":"android/ui/statusbar/android-7-adjust-status-bar-color/","title":"Android7.0\u53ca\u4ee5\u540e\u6c89\u6d78\u5f0f\u72b6\u6001\u680f\u53d8\u7070\u95ee\u9898","text":"<p>\u5728activity <code>setContentView</code> \u4e4b\u524d\uff0c\u4f7f\u7528\u53cd\u5c04\u4fee\u6539<code>DecorView</code>\u7684<code>mSemiTransparentStatusBarColor</code>\u989c\u8272\u3002 <pre><code>if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) {\n    try {\n        Class decorViewClazz = Class.forName(\"com.android.internal.policy.DecorView\");\n        Field field = decorViewClazz.getDeclaredField(\"mSemiTransparentStatusBarColor\");\n        field.setAccessible(true);\n        field.setInt(getWindow().getDecorView(), Color.TRANSPARENT);  // \u6539\u4e3a\u900f\u660e\n    } catch (Exception e) {\n        Log.e(TAG, \"onCreate: \", e);\n    }\n}\n</code></pre></p>"},{"location":"android/ui/statusbar/get-status-bar-height/","title":"\u83b7\u53d6\u9ad8\u5ea6","text":""},{"location":"android/ui/statusbar/get-status-bar-height/#statusbar","title":"\u83b7\u53d6StatusBar\u9ad8\u5ea6","text":"<p>\u672c\u6587\u8bb0\u5f55\u83b7\u53d6StatusBar\u9ad8\u5ea6\u7684\u65b9\u6cd5\u3002</p> <p>\u5728activity\u4e2d\u83b7\u53d6<code>DecorView</code>\uff0c\u7136\u540e\u62ff\u5230\u53ef\u89c1\u533a\u57dfWindowVisibleDisplayFrame\u3002 <pre><code>    private void getStatusBarHeight() {\n        Rect rectangle = new Rect();\n        Window window = getWindow();\n        window.getDecorView().getWindowVisibleDisplayFrame(rectangle);\n        // rectangle.top \u5c31\u662f\u9ad8\u5ea6\n        Log.d(TAG, \"getStatusBarHeight: \" + rectangle.top);\n    }\n</code></pre></p>"},{"location":"android/ui/view/measureSpec_intro/","title":"View.MeasureSpec\u7b80\u8ff0","text":""},{"location":"android/ui/view/measureSpec_intro/#measurespec","title":"MeasureSpec","text":"<p>\u7236View\u901a\u8fc7<code>MeasureSpec</code>\u7ed9\u5b50View\u4f20\u8fbe\u5c3a\u5bf8\u7684\u8981\u6c42\u3002<code>MeasureSpec</code>\u5305\u542b\u5c3a\u5bf8\u548c\u6a21\u5f0f\u3002</p> <p>3\u79cd\u6a21\u5f0f\u5982\u4e0b\u3002</p>"},{"location":"android/ui/view/measureSpec_intro/#unspecified","title":"UNSPECIFIED (\u672a\u6307\u5b9a)","text":"<p>\u7236\u63a7\u4ef6\u5bf9\u5b50\u63a7\u4ef6\u4e0d\u52a0\u4efb\u4f55\u675f\u7f1a\uff0c\u5b50\u5143\u7d20\u53ef\u4ee5\u5f97\u5230\u4efb\u610f\u60f3\u8981\u7684\u5927\u5c0f\uff0c\u8fd9\u79cdMeasureSpec\u4e00\u822c\u662f\u7531\u7236\u63a7\u4ef6\u81ea\u8eab\u7684\u7279\u6027\u51b3\u5b9a\u7684\u3002\u6bd4\u5982ScrollView\uff0c\u5b83\u7684\u5b50View\u53ef\u4ee5\u968f\u610f\u8bbe\u7f6e\u5927\u5c0f\uff0c\u65e0\u8bba\u591a\u9ad8\uff0c\u90fd\u80fd\u6eda\u52a8\u663e\u793a\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0csize\u4e00\u822c\u5c31\u6ca1\u4ec0\u4e48\u610f\u4e49\u3002</p>"},{"location":"android/ui/view/measureSpec_intro/#exactly","title":"EXACTLY(\u5b8c\u5168)","text":"<p>\u7236\u63a7\u4ef6\u4e3a\u5b50View\u6307\u5b9a\u786e\u5207\u5927\u5c0f\uff0c\u5e0c\u671b\u5b50View\u5b8c\u5168\u6309\u7167\u81ea\u5df1\u7ed9\u5b9a\u5c3a\u5bf8\u6765\u5904\u7406\uff0c\u8ddf\u4e0a\u9762\u7684\u573a\u666f1\u8ddf2\u6bd4\u8f83\u76f8\u4f3c\uff0c\u8fd9\u65f6\u7684MeasureSpec\u4e00\u822c\u662f\u7236\u63a7\u4ef6\u6839\u636e\u81ea\u8eab\u7684MeasureSpec\u8ddf\u5b50View\u7684\u5e03\u5c40\u53c2\u6570\u6765\u786e\u5b9a\u7684\u3002\u4e00\u822c\u8fd9\u79cd\u60c5\u51b5\u4e0bsize&gt;0,\u6709\u4e2a\u786e\u5b9a\u503c\u3002</p>"},{"location":"android/ui/view/measureSpec_intro/#at_most","title":"AT_MOST(\u81f3\u591a)","text":"<p>\u7236\u63a7\u4ef6\u4e3a\u5b50\u5143\u7d20\u6307\u5b9a\u6700\u5927\u53c2\u8003\u5c3a\u5bf8\uff0c\u5e0c\u671b\u5b50View\u7684\u5c3a\u5bf8\u4e0d\u8981\u8d85\u8fc7\u8fd9\u4e2a\u5c3a\u5bf8\uff0c\u8ddf\u4e0a\u9762\u573a\u666f3\u6bd4\u8f83\u76f8\u4f3c\u3002\u8fd9\u79cd\u6a21\u5f0f\u4e5f\u662f\u7236\u63a7\u4ef6\u6839\u636e\u81ea\u8eab\u7684MeasureSpec\u8ddf\u5b50View\u7684\u5e03\u5c40\u53c2\u6570\u6765\u786e\u5b9a\u7684\uff0c\u4e00\u822c\u662f\u5b50View\u7684\u5e03\u5c40\u53c2\u6570\u91c7\u7528wrap_content\u7684\u65f6\u5019\u3002</p>"},{"location":"android/ui/view/view-summary/","title":"Android View\u7684\u7efc\u8ff0","text":"\u66f4\u65b0\u65e5\u671f: 2021-8-31 <ul> <li>2021-8-31 \u65b0\u589e\u6587\u6863</li> </ul> <p>View\u662f\u7528\u6237\u4ea4\u4e92\u7684\u57fa\u672c\u7ec4\u4ef6\u3002\u4e00\u4e2aView\u5360\u636e\u4e86\u5c4f\u5e55\u4e0a\u7684\u4e00\u4e2a\u65b9\u5f62\u533a\u95f4\uff0c\u80fd\u591f\u7ed8\u5236\u56fe\u50cf\u5e76\u5904\u7406\u4e8b\u4ef6\u3002 View\u662fUI\u7684\u57fa\u7840\uff0c\u6211\u4eec\u524d\u9762\u770b\u7684TextView\uff0cButton\uff0cLinearLayout\uff0cRelativeLayout\u5176\u5b9e\u90fd\u662fView\u7684\u5b50\u7c7b\u3002 \u5b50\u7c7bViewGroup\u662f\u5404\u79cdlayout\u7684\u57fa\u7c7b\u3002ViewGroup\u53ef\u88c5\u8f7dView\u548c\u5176\u5b83ViewGroup\u3002</p>"},{"location":"android/ui/view/view-summary/#view","title":"\u4f7f\u7528View","text":"<p>\u5c4f\u5e55\u4e0a\u7684\u6240\u6709view\u90fd\u540c\u5c5e\u4e8e1\u68f5\u6811\uff08tree\uff09\u3002\u53ef\u4ee5\u7528\u4ee3\u7801\u6765\u6dfb\u52a0view\u6216\u8005\u5728layout\u7684xml\u6587\u4ef6\u4e2d\u6307\u5b9a\u3002 View\u7684\u5b50\u7c7b\u6709\u5f88\u591a\uff0c\u53ef\u663e\u793a\u6587\u5b57\uff08TextView\uff09\u3001\u56fe\u7247\uff08ImageView\uff09\u3001\u7f51\u9875\uff08WebView\uff09\u7b49\u3002</p> view\u7684\u6811\u5f62\u7ed3\u6784\u4f8b\u5b50 <p>\u5728Android Studio\u7684Component Tree\u9762\u677f\u53ef\u4ee5\u67e5\u770blayout\u7684View\u7ed3\u6784 </p> <p>\u6709\u4e00\u4e9b\u901a\u7528\u7684\u64cd\u4f5c\uff1a</p> <p>\u8bbe\u7f6e\u5c5e\u6027\uff1a\u6bd4\u5982\u7ed9TextView\u8bbe\u7f6e\u6587\u5b57\u5185\u5bb9\u3002\u6bcf\u79cd\u5b50\u7c7b\u90fd\u6709\u4e0d\u540c\u7684\u65b9\u6cd5\u3002\u5728xml\u4e2d\u4e5f\u53ef\u4ee5\u6307\u5b9aview\u7684\u5185\u5bb9\u3002</p> <p>\u8bbe\u7f6e\u5173\u6ce8\uff1aframework\u4f1a\u5904\u7406\u7528\u6237\u8f93\u5165\u65f6\u7684\u79fb\u52a8\u5173\u6ce8\u3002\u8981\u5f3a\u884c\u5173\u6ce8\u67d0\u4e2aview\uff0c\u8bf7\u8c03\u7528<code>requestFocus()</code>\u3002</p> <p>\u8bbe\u7f6e\u76d1\u542c\u5668\uff1aView\u5141\u8bb8\u5ba2\u6237\u7aef\u8bbe\u7f6e\u4e00\u4e9b\u76d1\u542c\u5668\u3002\u4f8b\u5982\u6240\u6709\u7684view\u90fd\u80fd\u8bbe\u7f6e\u76d1\u542c\u5668\u53bb\u76d1\u542cfocus\u4e8b\u4ef6\u3002 \u5f00\u53d1\u8005\u53ef\u4ee5\u7528<code>setOnFocusChangeListener(android.view.View.OnFocusChangeListener)</code>\u6765\u8bbe\u7f6efocus\u4e8b\u4ef6\u76d1\u542c\u3002 \u4e5f\u53ef\u76d1\u542c\u70b9\u51fb\u4e8b\u4ef6\u3002</p> <p>\u8bbe\u7f6e\u662f\u5426\u53ef\u89c1\uff1a\u7528<code>setVisibility(int)</code>\u65b9\u6cd5\u663e\u793a\u6216\u9690\u85cfview</p> \u4e0d\u8981\u4e3b\u52a8\u8c03measure layout draw\u7684\u76f8\u5173\u65b9\u6cd5 <p>Android framework \u4f1a\u5904\u7406View\u7684\u6d4b\u91cf\uff08measure\uff09\uff0c\u5e03\u5c40\uff08layout\uff09\u548c\u7ed8\u5236\uff08draw\uff09\u5de5\u4f5c\u3002 \u5f00\u53d1\u8005\u4e0d\u9700\u8981\u4e3b\u52a8\u8c03\u7528\u76f8\u5173\u7684\u65b9\u6cd5\u3002\u9664\u975e\u662f\u81ea\u5b9a\u4e49\u4e86ViewGroup\u3002</p>"},{"location":"android/ui/view/view-summary/#view_1","title":"View\u7684\u56de\u8c03\u51fd\u6570","text":"<p>\u6211\u4eec\u5173\u6ce8\u8fc7Activity\uff0cService\u7b49\u7b49\u7ec4\u4ef6\u7684\u56de\u8c03\u51fd\u6570\uff08\u751f\u547d\u5468\u671f\uff09\u3002\u8fd9\u91cc\u4ecb\u7ecdView\u7684\u56de\u8c03\u51fd\u6570\u3002</p> \u5206\u7c7b \u65b9\u6cd5 \u8bf4\u660e \u521b\u5efa \u6784\u9020\u5668 \u7528\u4ee3\u7801\u521b\u5efaView\u7528\u7684\u6784\u9020\u5668\u548c\u52a0\u8f7dlayout\u4e2d\u7684View\u7528\u7684\u6784\u9020\u5668\u4e0d\u540c\u3002\u4ecelayout\u52a0\u8f7dView\u65f6\uff0c\u4f1a\u89e3\u6790xml\u4e2d\u5b9a\u4e49\u7684\u4e00\u4e9b\u53c2\u6570\u3002 <code>onFinishInflate()</code> \u4ecexml\u4e2d\u52a0\u8f7dview\uff0c\u5f53\u5b83\u4ee5\u53ca\u5b83\u7684\u6240\u6709\u5b50view\u90fd\u52a0\u8f7d\u5b8c\u6210\u65f6\u8d70\u8fd9\u4e2a\u51fd\u6570\u3002 Layout <code>onMeasure(int, int)</code> view\u548c\u5b83\u7684\u5b50view\u8981\u51b3\u5b9a\u5c3a\u5bf8\u7684\u65f6\u5019\u8c03\u7528\u3002 <code>onLayout(boolean, int, int, int, int)</code> view\u7ed9\u5b83\u6240\u6709\u7684\u5b50view\u6307\u5b9a\u5c3a\u5bf8\u548c\u4f4d\u7f6e\u3002 <code>onSizeChanged(int, int, int, int)</code> \u5f53view\u7684\u5c3a\u5bf8\u53d1\u751f\u53d8\u5316\u65f6\u8d70\u8fd9\u4e2a\u65b9\u6cd5\u3002 Drawing <code>onDraw(android.graphics.Canvas)</code> view\u7ed8\u5236\u5b83\u7684\u5185\u5bb9\u65f6\u8d70\u8fd9\u4e2a\u65b9\u6cd5\u3002 Event processing <code>onKeyDown(int, android.view.KeyEvent)</code> \u5f53key\u4e8b\u4ef6\u53d1\u751f\u65f6\u8d70\u8fd9\u4e2a\u65b9\u6cd5\u3002 <code>onKeyUp(int, android.view.KeyEvent)</code> key up \u4e8b\u4ef6\u53d1\u751f <code>onTrackballEvent(android.view.MotionEvent)</code> \u5149\u6807\u7403\u79fb\u52a8\u4e8b\u4ef6 <code>onTouchEvent(android.view.MotionEvent)</code> \u63a5\u6536\u5230\u4e86\u89e6\u6478\u4e8b\u4ef6 Focus <code>onFocusChanged(boolean, int, android.graphics.Rect)</code> view\u83b7\u5f97\u6216\u5931\u53bb\u5173\u6ce8\uff08focus\uff09\u65f6\u8c03\u7528 <code>onWindowFocusChanged(boolean)</code> view\u6240\u5728\u7684window\u83b7\u5f97\u6216\u5931\u53bb\u5173\u6ce8\uff08focus\uff09\u65f6\u8c03\u7528 Attaching <code>onAttachedToWindow()</code> \u5f53view\u5173\u8054\u5230window\u65f6\u8c03\u7528 <code>onDetachedFromWindow()</code> \u5f53view\u4e0ewindow\u89e3\u9664\u5173\u8054\u65f6\u8c03\u7528 <code>onWindowVisibilityChanged()</code> \u5f53view\u5173\u8054\u7684window\u53ef\u89c1\u6027\u53d8\u5316\u65f6\u8c03\u7528"},{"location":"android/ui/view/view-summary/#_1","title":"\u7ed8\u5236\u6d41\u7a0b","text":"<p>\u5206\u4e3a3\u4e2a\u9636\u6bb5\uff1ameasure\u3001layout\u3001draw</p> <p>\u5728<code>onMeasure</code>\u65b9\u6cd5\u4e2dView\u4f1a\u5bf9\u5176\u6240\u6709\u7684\u5b50\u5143\u7d20\u6267\u884cmeasure\u8fc7\u7a0b\uff0c\u6b64\u65f6measure\u8fc7\u7a0b\u5c31\u4ece\u7236\u5bb9\u5668\u201c\u4f20\u9012\u201d\u5230\u4e86\u5b50\u5143\u7d20\u4e2d\uff0c\u63a5\u7740\u5b50\u5143\u7d20\u4f1a\u9012\u5f52\u7684\u5bf9\u5176\u5b50\u5143\u7d20\u8fdb\u884cmeasure\u8fc7\u7a0b\uff0c\u5982\u6b64\u53cd\u590d\u5b8c\u6210\u5bf9\u6574\u4e2aView\u6811\u7684\u904d\u5386\u3002onLayout\u4e0eonDraw\u8fc7\u7a0b\u7684\u6267\u884c\u6d41\u7a0b\u4e0e\u6b64\u7c7b\u4f3c\u3002</p> <p>measure\u8fc7\u7a0b\u51b3\u5b9a\u4e86View\u7684\u6d4b\u91cf\u5bbd\u9ad8\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u7ed3\u675f\u540e\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7<code>getMeasuredHeight</code>\u548c<code>getMeasuredWidth</code>\u83b7\u5f97View\u7684\u6d4b\u91cf\u5bbd\u9ad8\u4e86\u3002</p> <p>layout\u8fc7\u7a0b\u51b3\u5b9a\u4e86View\u5728\u7236\u5bb9\u5668\u4e2d\u7684\u4f4d\u7f6e\u548cView\u7684\u6700\u7ec8\u663e\u793a\u5bbd\u9ad8\uff0c<code>getTop</code>\u7b49\u65b9\u6cd5\u53ef\u83b7\u53d6View\u7684top\u7b49\u56db\u4e2a\u4f4d\u7f6e\u53c2\u6570\uff08View\u7684\u5de6\u4e0a\u89d2\u9876\u70b9\u7684\u5750\u6807\u4e3a(left, top), \u53f3\u4e0b\u89d2\u9876\u70b9\u5750\u6807\u4e3a(right, bottom)\uff09\u3002 <code>getWidth</code>\u548c<code>getHeight</code>\u53ef\u83b7\u5f97View\u7684\u6700\u7ec8\u663e\u793a\u5bbd\u9ad8<code>\uff08width = right - left\uff1bheight = bottom - top\uff09</code>\u3002 </p> <p>draw\u8fc7\u7a0b\u51b3\u5b9a\u4e86View\u6700\u7ec8\u663e\u793a\u51fa\u6765\u7684\u6837\u5b50\uff0c\u6b64\u8fc7\u7a0b\u5b8c\u6210\u540e\uff0cView\u624d\u4f1a\u5728\u5c4f\u5e55\u4e0a\u663e\u793a\u51fa\u6765\u3002</p> <p>\u81ea\u5b9a\u4e49\u4e00\u4e2a\u7c7b\u7ee7\u627fView\uff0c\u653e\u5230activity\u7684layout\u4e2d\uff0c\u6253\u5370log\u89c2\u5bdf\u5404\u4e2a\u51fd\u6570\u8c03\u7528\u60c5\u51b5 <pre><code>Activity   onCreate\nView       LifeView(Context context, @Nullable AttributeSet attrs)\nView       onFinishInflate\nActivity   onStart\nActivity   onResume\nView       onAttachedToWindow\nView       onMeasure\nView       onSizeChanged\nView       onLayout\nView       onDraw\nView       onWindowFocusChanged  true\nView       onMeasure\nView       onLayout\nView       onDraw\nActivity   onPause\nView       onWindowFocusChanged  false\nActivity   onStop\nActivity   onDestroy\n</code></pre> \u53ef\u4ee5\u770b\u51fa\uff0c\u5728activity\u53ef\u89c1\uff08<code>onResume</code>\uff09\u540e\uff0cview\u4e0ewindow\u5173\u8054\u8d77\u6765\u3002 \u5148\u6d4b\u91cf\uff0c\u51b3\u5b9a\u81ea\u8eab\u5927\u5c0f\uff0c\u51b3\u5b9a\u5728\u7236\u5bb9\u5668\u4e2d\u7684\u4f4d\u7f6e\u548c\u5927\u5c0f\uff0c\u7136\u540e\u7ed8\u5236\u5230\u5c4f\u5e55\u4e0a\u3002 \u6839\u636e\u4e0a\u9762\u7684log\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u770b\u51faView\u7684\u4e3b\u8981\u7ed8\u5236\u6d41\u7a0b\u662fmeasure\u3001layout\u3001draw\u3002</p>"},{"location":"android/ui/view/view-summary/#ondrawinvalidate","title":"onDraw\u548cinvalidate()","text":"<p>\u8fde\u7eed\u591a\u6b21\u8c03\u7528<code>invalidate()</code>\uff0c<code>onDraw</code>\u7684\u6267\u884c\u6b21\u6570\u662f\u591a\u5c11\u6b21\u3002</p> <p><pre><code>[act] \u591a\u6b21 invalidate\nView\u751f\u547d\u5468\u671f onDraw, 1535337048483\nView\u751f\u547d\u5468\u671f onDraw, 1535337048499\nView\u751f\u547d\u5468\u671f onDraw, 1535337048516\nView\u751f\u547d\u5468\u671f onDraw, 1535337048532\nView\u751f\u547d\u5468\u671f onDraw, 1535337048549\n</code></pre> \u4ece\u4f8b\u5b50\u4e2d\u53ef\u770b\u51fa\uff0c<code>onDraw</code>\u6267\u884c\u7684\u95f4\u9694\u5927\u7ea6\u662f16ms\u3002\u548cAndroid\u5237\u65b0\u754c\u9762\u7684\u65f6\u95f4\u95f4\u9694\u63a5\u8fd1\u3002</p> <p>\u518d\u770b<code>invalidate()</code>\u65b9\u6cd5\u6ce8\u91ca\uff0c\u5927\u610f\u662f\u5f53view\u53ef\u89c1\u65f6\uff0c<code>onDraw</code>\u65b9\u6cd5\u5c06\u5728\u672a\u6765\u67d0\u4e2a\u65f6\u95f4\u70b9\u88ab\u8c03\u7528\u3002 <pre><code>/**\n    * Invalidate the whole view. If the view is visible,\n    * {@link #onDraw(android.graphics.Canvas)} will be called at some point in\n    * the future.\n    * ....\n    */\npublic void invalidate() {\n    invalidate(true);\n}\n</code></pre> \u4e5f\u5c31\u662f\u8bf4\uff0c\u8c03\u7528\u4e86<code>invalidate()</code>\u65b9\u6cd5\u540e\uff0c\u5e76\u4e0d\u4fdd\u8bc1\u4f1a\u7acb\u5373\u6267\u884c<code>onDraw</code>\u3002</p>"},{"location":"android/ui/view/view-summary/#id","title":"ID","text":"<p>View\u53ef\u80fd\u4f1a\u6709\u4e00\u4e2a\u4e0e\u4e4b\u5173\u8054\u7684\u6570\u5b57id\u3002\u901a\u5e38\u6765\u8bf4\u8fd9\u4e9b\u662f\u5728layout xml\u6587\u4ef6\u4e2d\u5206\u914d\u7684id\u3002 \u5e38\u89c1\u7528\u6cd5\u662f\uff1a</p> <p>\u5b9a\u4e49\u4e00\u4e2aButton\u5728layout\u4e2d\u5e76\u4e14\u5206\u914d\u4e00\u4e2aid <pre><code>&lt;Button\n    android:id=\"@+id/my_button\"\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\"\n    android:text=\"@string/my_button_text\"/&gt;\n</code></pre></p> <p>\u5728Activity\u7684<code>onCreated</code>\u65b9\u6cd5\u91cc\u901a\u8fc7id\u627e\u5230\u8fd9\u4e2aButton <pre><code>Button myButton = findViewById(R.id.my_button);\n</code></pre></p> <p>view\u7684ID\u5e76\u4e0d\u9700\u8981\u5168\u5c40\u72ec\u4e00\u65e0\u4e8c\u7684\uff0c\u800c\u662f\u8981\u5728\u5b83\u6240\u5c5e\u7684\u6811\u91cc\u662f\u552f\u4e00\u7684\u3002</p>"},{"location":"android/ui/view/view-summary/#position","title":"\u4f4d\u7f6e Position","text":"<p>\u4e00\u4e2aview\u5360\u636e\u4e00\u4e2a\u65b9\u5f62\u7684\u4f4d\u7f6e\u3002view\u7684\u4f4d\u7f6e\u7528\u5de6\u4e0a\u89d2\u7684\u70b9\u6765\u8868\u793a\u3002\u4f4d\u7f6e\u548c\u5c3a\u5bf8\u7684\u5355\u4f4d\u662f\u50cf\u7d20\uff08pixel\uff09\u3002 \u8c03\u7528<code>getLeft()</code>\u548c<code>getTop()</code>\u53ef\u4ee5\u83b7\u5f97view\u7684\u5750\u6807\u3002<code>getLeft()</code>\u8fd4\u56deview\u7684left\u503c\uff0c\u6216\u8005\u8bf4\u662fx\u503c\u3002<code>getTop()</code>\u8fd4\u56detop\u503c\uff0c\u6216\u8005\u8bf4\u662fy\u503c\u3002\u8fd9\u4e9b\u65b9\u6cd5\u8fd4\u56de\u7684\u5750\u6807\u662fview\u5728\u5b83\u7684\u7236view\u4e2d\u7684\u4f4d\u7f6e\u3002\u4f8b\u5982\uff0c\u5047\u8bbe<code>getLeft()</code>\u8fd4\u56de20\uff0c\u8868\u793a\u8fd9\u4e2aview\u5728\u5b83\u7236view\u5de6\u8fb9\u7f18\u5f80\u53f320\u4e2a\u50cf\u7d20\u7684\u4f4d\u7f6e\u3002</p> <p>\u53e6\u5916\uff0c<code>getRight()</code>\u65b9\u6cd5\u80fd\u8fd4\u56deview\u7684right\u503c\u3002<code>getBottom()</code>\u65b9\u6cd5\u8fd4\u56debottom\u503c\u3002 <code>getRight() == getLeft() + getWidth()</code></p>"},{"location":"android/ui/view/view-summary/#size-padding-margins","title":"Size, padding \u548c margins","text":"<p>view\u7684\u5c3a\u5bf8\uff08size\uff09\u6709\u5bbd\uff08width\uff09\u548c\u9ad8\uff08height\uff09\u3002\u4e00\u4e2aview\u5b9e\u9645\u4e0a\u6709\u4e24\u5bf9\u5bbd\u9ad8\u503c\u3002</p> <p>\u7b2c\u4e00\u5bf9\u5bbd\u9ad8\u662f\u6d4b\u91cf\u5bbd\u9ad8\uff08measured width/height\uff09\u3002\u8fd9\u4e2a\u5c3a\u5bf8\u8868\u793a\u4e00\u4e2aview\u60f3\u8981\u5728\u7236view\u91cc\u8981\u591a\u5927\u3002\u901a\u8fc7<code>getMeasuredWidth()</code> \u548c <code>getMeasuredHeight()</code>\u65b9\u6cd5\u53ef\u4ee5\u5f97\u5230\u6d4b\u91cf\u5bbd\u9ad8\u3002</p> <p>\u7b2c\u4e8c\u5bf9\u5bbd\u9ad8\u53ef\u4ee5\u7406\u89e3\u4e3a\u5b9e\u9645\u5bbd\u9ad8\u3002\u8fd9\u4e2a\u5bbd\u9ad8\u6709\u53ef\u80fd\u4e0e\u6d4b\u91cf\u5bbd\u9ad8\u4e0d\u540c\u3002\u901a\u8fc7<code>getWidth()</code>\u548c<code>getHeight()</code>\u53ef\u62ff\u5230\u5bbd\u9ad8\u503c\u3002</p> <p>\u4e3a\u4e86\u6d4b\u91cf\u5c3a\u5bf8\uff0cview\u9700\u8981\u8003\u8651padding\u503c\u3002padding\u503c\u7684\u5355\u4f4d\u662f\u50cf\u7d20\uff08px\uff09\uff0c\u5206\u4e3a\u5de6\u4e0a\u53f3\u4e0b\uff08left,top,right,bottom\uff09\u3002 padding\u53ef\u7528\u4e8e\u5c06view\u7684\u5185\u5bb9\u504f\u79fb\u7279\u5b9a\u6570\u91cf\u7684\u50cf\u7d20\u3002 \u4f8b\u5982\uff0c\u5de6padding\u4e3a2\u50cf\u7d20\u7684\u65f6\u5019\uff0c\u4f1a\u628aview\u7684\u5185\u5bb9\u4ece\u5de6\u5411\u53f3\u63a82\u4e2a\u50cf\u7d20\u3002 \u53ef\u4ee5\u7528<code>setPadding(int, int, int, int)</code>\u6216\u8005<code>setPaddingRelative(int, int, int, int)</code>\u65b9\u6cd5\u8bbe\u7f6epadding\u503c\u3002 \u7528<code>getPaddingLeft()</code>\uff0c <code>getPaddingTop()</code>\uff0c <code>getPaddingRight()</code>\uff0c <code>getPaddingBottom()</code>\uff0c <code>getPaddingStart()</code>\uff0c <code>getPaddingEnd()</code>\u83b7\u53d6\u5bf9\u5e94\u7684padding\u503c\u3002</p> <p>view\u53ef\u4ee5\u8bbe\u5b9apadding\u503c\uff0c\u4f46\u6ca1\u6709margin\u503c\u3002ViewGroup\u80fd\u652f\u6301margin\u503c\u3002</p>"},{"location":"android/ui/view/view-summary/#setxsettranslationx","title":"setX\u4e0esetTranslationX\u7684\u533a\u522b","text":"<p>\u9996\u5148\u6765\u770b<code>getX()</code>\u4e0e<code>getTranslationX()</code>\u7684\u533a\u522b\u3002</p> <ul> <li><code>getX()</code>\u83b7\u5f97view\u5728\u5c4f\u5e55\u4e2d\u7684x\u5750\u6807\u3002</li> <li><code>getTranslationX()</code>\u83b7\u5f97\u76f8\u5bf9\u4e8e\u8d77\u59cb\u4f4d\u7f6ex\u7684\u5dee\u503c\u3002</li> </ul> <p>\u4f8b\u5982\u4e00\u4e2aview\u521d\u59cb\u65f6\u6c34\u5e73\u5c45\u4e2d\u5728\u5c4f\u5e55\u4e2d\u3002<code>getX, Y = [536.0000, 0.0000]; TranslationX,Y = [0.0000, 0.0000];</code>\u3002</p> <p><code>setX</code>\u6307\u5b9a\u4e86view\u5728\u7236\u89c6\u56fe\u4e2d\u7684\u4f4d\u7f6e\u3002<code>setTranslationX</code>\u6307\u5b9a\u4e86\u76f8\u5bf9\u4e8e\u521d\u59cb\u4f4d\u7f6e\u7684\u4f4d\u7f6e\u3002</p> <p>\u5982\u679c\u6211\u4eec\u60f3\u8ba9view\u56de\u5230\u521d\u59cb\u4f4d\u7f6e\uff0c\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528<code>setTranslationX(0)</code>\u3002</p> <p><code>setTranslationX</code>\u53ef\u4ee5\u5e94\u7528\u5728drawerLayout\u4e2d\uff0c\u5f39\u51fa\u62bd\u5c49\u89c6\u56fe\u65f6\u8ba9\u4e3b\u89c6\u56fe\u8ddf\u7740\u79fb\u52a8\u3002</p>"},{"location":"android/ui/view/view-summary/#layout","title":"Layout","text":"<p>layout\uff08\u5e03\u5c40\uff09\u67092\u4e2a\u8fc7\u7a0b\uff1a\u6d4b\u91cf\uff08measure\uff09\u8fc7\u7a0b\u548c\u5e03\u5c40\uff08layout\uff09\u8fc7\u7a0b\u3002\u6d4b\u91cf\u8fc7\u7a0b\u5728<code>measure(int, int)</code>\u65b9\u6cd5\u91cc\u5b9e\u73b0\uff0cview\u6811\u4ece\u9876\u5f80\u4e0b\u904d\u5386\u6d4b\u91cf\u4e00\u904d\u3002\u5728\u904d\u5386\u8fc7\u7a0b\u4e2d\uff0c\u6bcf\u4e2aview\u628a\u5c3a\u5bf8\u4fe1\u606f\u5f80\u4e0b\u4f20\u3002\u5728\u6d4b\u91cf\u8fc7\u7a0b\u4e2d\uff0c\u6bcf\u4e2aview\u90fd\u5b58\u4e0b\u4e86\u5b83\u7684\u6d4b\u91cf\u503c\u3002 \u7b2c\u4e8c\u4e2a\u8fc7\u7a0b\u5728\u5e03\u5c40\u65b9\u6cd5\u4e2d<code>layout(int, int, int, int)</code>\uff0c\u4e5f\u662f\u81ea\u9876\u5411\u4e0b\u8fdb\u884c\u7684\u3002 \u6d4b\u91cf\u8fc7\u7a0b\u4e2d\uff0c\u6bcf\u4e2a\u7236view\u90fd\u7528\u6d4b\u91cf\u503c\u6765\u8d1f\u8d23\u5b9a\u4f4d\u5b83\u7684\u5b50view\u3002</p> <p>\u5f53view\u7684<code>measure()</code>\u65b9\u6cd5\u6267\u884c\u5b8c\u6bd5\uff0c<code>getMeasuredWidth()</code>\u548c<code>getMeasuredHeight()</code>\u7684\u8fd4\u56de\u503c\u5df2\u7ecf\u786e\u5b9a\u4e86\uff1b\u5b83\u7684\u5b50view\u540c\u7406\u3002 \u4e00\u4e2aview\u7684\u6d4b\u91cf\u5bbd\u9ad8\u5fc5\u987b\u9075\u5b88\u5b83\u7684\u7236view\u7684\u9650\u5236\u3002\u8fd9\u4fdd\u8bc1\u4e86\u6d4b\u91cf\u8fc7\u7a0b\u7684\u6700\u540e\uff0c\u6240\u6709\u7684\u7236view\u90fd\u80fd\u63a5\u53d7\u5b83\u4eec\u5b50view\u7684\u6d4b\u91cf\u7ed3\u679c\u3002\u4e00\u4e2a\u7236view\u53ef\u80fd\u4f1a\u591a\u6b21\u8c03\u7528\u5b83\u7684\u5b50view\u7684<code>measure()</code>\u65b9\u6cd5\u3002 \u4f8b\u5982\uff0c\u7236view\u53ef\u80fd\u4f1a\u4f20\u672a\u6307\u5b9a\u5c3a\u5bf8\u7ed9\u5b50view\uff0c\u6765\u641e\u6e05\u695a\u5b50view\u60f3\u8981\u591a\u5927\u7684\u5c3a\u5bf8\u3002\u5982\u679c\u5b50view\u7684\u672a\u56fa\u5b9a\u5c3a\u5bf8\u592a\u5c0f\u6216\u8005\u592a\u5927\uff0c\u5c31\u7ed9\u5b50view\u7684<code>measure</code>\u65b9\u6cd5\u4f20\u786e\u5b9a\u7684\u53c2\u6570\u3002 \u6d4b\u91cf\u8fc7\u7a0b\u75282\u4e2a\u7c7b\u6765\u8868\u793a\u5c3a\u5bf8\u3002MeasureSpec\u7c7b\u7528\u6765\u544a\u8bc9\u7236view\u60f3\u8981\u7684\u5c3a\u5bf8\u548c\u4f4d\u7f6e\u3002 \u57fa\u7840\u7684LayoutParams\u7c7b\u63cf\u8ff0\u5bbd\u9ad8\u60f3\u8981\u591a\u5927\u3002\u5bf9\u4e8e\u5bbd\u6216\u9ad8\uff0c\u53ef\u7528\u4ee5\u4e0b\u7684\u8bbe\u5b9a\uff1a</p> <ul> <li>\u4e00\u4e2a\u786e\u5207\u6570\u5b57</li> <li><code>MATCH_PARENT</code>\uff0c\u8868\u793a\u548c\u7236view\u4e00\u6837\u5927\uff08\u8981\u6263\u9664padding\u503c\uff09</li> <li><code>WRAP_CONTENT</code>\uff0c\u80fd\u5305\u542b\u81ea\u5df1\u7684\u5185\u5bb9\u5373\u53ef\uff08\u8981\u8003\u8651\u81ea\u5df1\u7684padding\u503c\uff09</li> </ul> <p>\u5bf9\u4e8e\u4e0d\u540c\u7684ViewGroup\u7684\u5b50\u7c7b\uff0c\u6709\u5bf9\u5e94\u7684\u4e0d\u540c\u7684LayoutParams\u5b50\u7c7b\u3002\u4f8b\u5982LinearLayout.LayoutParams\u6709<code>weight</code>\u8fd9\u4e2a\u5c5e\u6027\u3002 \u7236view\u4f20\u9012\u7ed9\u5b50view\uff0c\u7528MeasureSpecs\u6765\u4f20\u9012\u8981\u6c42\u3002MeasureSpecs\u67093\u79cd\u6a21\u5f0f\uff1a</p> <ul> <li><code>UNSPECIFIED</code> \u7236\u63a7\u4ef6\u5bf9\u5b50\u63a7\u4ef6\u4e0d\u52a0\u4efb\u4f55\u675f\u7f1a\uff0c\u5b50\u5143\u7d20\u53ef\u4ee5\u5f97\u5230\u4efb\u610f\u60f3\u8981\u7684\u5927\u5c0f\uff0c\u8fd9\u79cdMeasureSpec\u4e00\u822c\u662f\u7531\u7236\u63a7\u4ef6\u81ea\u8eab\u7684\u7279\u6027\u51b3\u5b9a\u7684\u3002\u6bd4\u5982ScrollView\uff0c\u5b83\u7684\u5b50View\u53ef\u4ee5\u968f\u610f\u8bbe\u7f6e\u5927\u5c0f\uff0c\u65e0\u8bba\u591a\u9ad8\uff0c\u90fd\u80fd\u6eda\u52a8\u663e\u793a\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0csize\u4e00\u822c\u5c31\u6ca1\u4ec0\u4e48\u610f\u4e49\u3002</li> <li><code>EXACTLY</code> \u7236view\u7ed9\u4e00\u4e2a\u786e\u5b9a\u7684\u5c3a\u5bf8\u6570\u503c\u7ed9\u5b50view\u3002\u5e0c\u671b\u5b50View\u5b8c\u5168\u6309\u7167\u81ea\u5df1\u7ed9\u5b9a\u5c3a\u5bf8\u6765\u5904\u7406\u3002</li> <li><code>AT_MOST</code> \u7236view\u7ed9\u4e00\u4e2a\u6700\u5927\u503c\uff0c\u5e0c\u671b\u5b50view\u4e0d\u80fd\u8d85\u51fa\u9650\u5236\u3002</li> </ul>"},{"location":"android/ui/view/view-summary/#_2","title":"\u4e8b\u4ef6\u5904\u7406\u548c\u7ebf\u7a0b","text":"<p>\u4e00\u4e2aview\u7684\u57fa\u672c\u5904\u7406\u6d41\u7a0b\u5982\u4e0b</p> <ul> <li>\u6765\u4e86\u4e00\u4e2a\u4e8b\u4ef6\uff0c\u5206\u53d1\u5230\u5bf9\u5e94\u7684view\u3002\u8fd9\u4e2aview\u5904\u7406\u4e8b\u4ef6\uff0c\u5e76\u901a\u77e5\u76f8\u5173\u7684\u76d1\u542c\u5668\u3002</li> <li>\u5982\u679c\u5728\u5904\u7406\u4e8b\u4ef6\u8fc7\u7a0b\u4e2d\uff0cview\u7684\u8fb9\u754c\u9700\u8981\u53d8\u5316\uff0c\u4f1a\u8c03\u7528<code>requestLayout()</code>\u3002</li> <li>\u7c7b\u4f3c\u7684\uff0c\u5982\u679cview\u7684\u5185\u5bb9\u53d1\u751f\u53d8\u5316\uff0c\u4f1a\u8c03\u7528<code>invalidate()</code>\u3002</li> <li>\u8c03\u7528<code>requestLayout()</code>\u6216\u8005<code>invalidate()</code>\uff0cframework\u4f1a\u5728\u6070\u5f53\u65f6\u95f4\u5904\u7406\u597d\u6d4b\u91cf\uff0c\u5e03\u5c40\u548c\u7ed8\u5236\u7684\u8fc7\u7a0b\u3002</li> </ul> UI\u7ebf\u7a0b <p>\u5904\u7406view\u7684\u7ebf\u7a0b\u53eb\u505aUI\u7ebf\u7a0b\u3002\u5fc5\u987b\u5728UI\u7ebf\u7a0b\u64cd\u4f5cview\u3002 \u5982\u679c\u5728\u5176\u4ed6\u7ebf\u7a0b\u91cc\u60f3\u8981\u64cd\u4f5cview\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528Handler\u3002</p>"},{"location":"android/ui/view/view-summary/#_3","title":"\u89e6\u6478\u4e8b\u4ef6\u63cf\u8ff0","text":""},{"location":"android/ui/view/view-summary/#_4","title":"\u89e6\u6478\u4e8b\u4ef6\u5206\u53d1","text":"<p>\u7531\u6839\u89c6\u56fe\u5411\u5b50view\u5206\u53d1\u3002<code>onInterceptTouchEvent</code> \u65b9\u6cd5\uff08ViewGroup\u624d\u6709\uff09\u7684\u8fd4\u56de\u503c\u51b3\u5b9a\u662f\u5426\u62e6\u622a\u89e6\u6478\u4e8b\u4ef6\uff08true\uff1a\u62e6\u622a\uff0cfalse\uff1a\u4e0d\u62e6\u622a\uff09\u3002 \u5982\u679c ViewGroup \u62e6\u622a\u4e86\u89e6\u6478\u4e8b\u4ef6\uff0c\u90a3\u4e48\u5176 <code>onTouchEvent</code> \u5c31\u4f1a\u88ab\u8c03\u7528\u7528\u6765\u5904\u7406\u89e6\u6478\u4e8b\u4ef6\u3002  \u5206\u53d1\u7684\u8fc7\u7a0b\u4e2d\uff0cViewGroup\u53ef\u4ee5\u62e6\u622a\u4e8b\u4ef6\uff0c\u4e0d\u518d\u7ee7\u7eed\u5206\u53d1\u3002</p>"},{"location":"android/ui/view/view-summary/#_5","title":"\u89e6\u6478\u4e8b\u4ef6\u6d88\u8d39","text":"<p><code>onTouchEvent</code>\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u51b3\u5b9a\u662f\u5426\u5904\u7406\u5b8c\u6210\u89e6\u6478\u4e8b\u4ef6</p> <ul> <li>true\uff1a\u5df2\u7ecf\u5904\u7406\u5b8c\u6210\uff0c\u4e0d\u9700\u8981\u7ed9\u7236 ViewGroup \u5904\u7406</li> <li>false\uff1a\u8fd8\u6ca1\u5904\u7406\u5b8c\u6210 \uff0c\u9700\u8981\u4f20\u9012\u7ed9\u7236 ViewGroup \u5904\u7406</li> </ul>"},{"location":"android/ui/view/view-summary/#ontouchontouchevent","title":"onTouch\uff0conTouchEvent\u533a\u522b","text":"<p><code>onTouch</code>\u5148\u4e8e<code>onTouchEvent</code>\uff0c<code>mOnTouchListener</code>\u53ef\u4ee5\u62e6\u4f4f<code>onTouchEvent</code>\uff1b \u6709<code>mOnTouchListener</code>\uff0c\u5219\u6267\u884c<code>mOnTouchListener.onTouch</code>\u65b9\u6cd5\u3002 <code>onTouchEvent</code>\u83b7\u53d6\u624b\u673a\u5c4f\u5e55\u7684\u89e6\u6478\u4e8b\u4ef6\u3002</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a </p>"},{"location":"android/ui/view/view_get_size/","title":"Activity\u4e2d\u83b7\u53d6View\u7684\u5bbd\u9ad8","text":"<p>\u6709\u4e9b\u65f6\u5019\u6211\u4eec\u9700\u8981\u83b7\u53d6\u5230View\u7684\u5bbd\u9ad8\u4fe1\u606f\u3002</p> <p>\u5728onCreate\u548conResume\u4e2d\u5c1d\u8bd5view.getWidth()\u6216\u662fview.getHeiht()\u65f6\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\u83b7\u53d6\u5230\u7684\u662f0\u3002</p> <p>Activity\u89c6\u56fe\u5728\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u5404\u4e2a\u5b50view\u5e76\u4e0d\u4e00\u5b9a\u88ab\u52a0\u8f7d\u5b8c\u6210\u3002 \u83b7\u53d6\u5bbd\u9ad8\u6b63\u786e\u7684\u65b9\u6cd5\u6709\u54ea\u4e9b\u5462\uff1f</p>"},{"location":"android/ui/view/view_get_size/#1-activityonwindowfocuschanged","title":"\u65b9\u6cd51 - \u5728Activity\u7684<code>onWindowFocusChanged</code>\u83b7\u53d6\u5bbd\u9ad8","text":"<pre><code>    @Override\n    public void onWindowFocusChanged(boolean hasFocus) {\n        super.onWindowFocusChanged(hasFocus);\n        // \u5728\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u83b7\u53d6\u5230View\u7684\u771f\u5b9e\u5bbd\u9ad8\n        Log.d(TAG, \"onWindowFocusChanged: mBtn1.getWidth == \" + mBtn1.getWidth());\n    }\n</code></pre>"},{"location":"android/ui/view/view_get_size/#2-viewtreeobserverongloballayoutlistener","title":"\u65b9\u6cd52 - \u4f7f\u7528ViewTreeObserver\u7684<code>OnGlobalLayoutListener</code>\u56de\u8c03","text":"<p>\u83b7\u53d6View\u7684ViewTreeObserver\uff0c\u6dfb\u52a0\u56de\u8c03 <pre><code>    ViewTreeObserver vto = mBtn1.getViewTreeObserver();\n    vto.addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() {\n        @Override\n        public void onGlobalLayout() {\n            int height = mBtn1.getHeight();\n            int width = mBtn1.getWidth();\n            Log.d(TAG, \"onGlobalLayout: mBtn1 \" + width + \", \" + height);\n            mBtn1.getViewTreeObserver().removeOnGlobalLayoutListener(this);\n        }\n    });\n</code></pre></p>"},{"location":"android/ui/view/view_get_size/#3-viewpostrunnable-action","title":"\u65b9\u6cd53 - \u4f7f\u7528<code>View.post(Runnable action)</code>\u65b9\u6cd5","text":"<p>\u4f8b\u5982\u6211\u4eec\u5728onCreate\u4e2dpost\u4e00\u4e2aRunnable <pre><code>@Override\nprotected void onCreate(@Nullable Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    mBtn1 = findViewById(R.id.btn1);\n    Log.d(TAG, \"mBtn1 post runnable\");\n    mBtn1.post(new Runnable() {\n        @Override\n        public void run() {\n            Log.d(TAG, \"mBtn1: \" + mBtn1.getWidth() + \", \" + mBtn1.getHeight());\n        }\n    });\n}\n</code></pre> \u53ef\u4ee5\u83b7\u53d6\u5230view\u7684\u5bbd\u9ad8\u3002\u4ecelog\u7684\u65f6\u95f4\u4e0a\u53ef\u4ee5\u770b\u51fa\uff0c\u5728view\u52a0\u8f7d\u5b8c\u6bd5\u540e\uff0c\u6267\u884c\u7684Runnable\u3002 <pre><code>06-19 11:54:17.865 28009-28009/com.rustfisher.basic4 D/rustApp: mBtn1 post runnable\n06-19 11:54:17.867 28009-28009/com.rustfisher.basic4 D/rustApp: [act2] onResume\n06-19 11:54:17.899 28009-28009/com.rustfisher.basic4 D/rustApp: mBtn1: 355, 144\n</code></pre></p>"},{"location":"android/ui/view/view_get_size/#-imageview","title":"\u5e94\u7528 - \u52a8\u6001\u8c03\u6574ImageView\u7684\u5bbd\u9ad8","text":"<p>\u83b7\u53d6\u5230view\u7684\u5bbd\u9ad8\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u52a8\u6001\u5730\u8c03\u6574ImageView\u7684\u9ad8\u5ea6\u3002 \u5047\u8bbe\u56fe\u7247\u5bbd\u9ad8\u4e3a704 * 440\u3002xml\u4e2d\u8bbe\u7f6escaleType\u4e3afitXY\u3002\u5df2\u77e5ImageView\u7684\u5bbd\u5ea6\u662f\u56fa\u5b9a\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u8c03\u6574\u9ad8\u5ea6\u3002</p> <pre><code>&lt;ImageView\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:scaleType=\"fitXY\"/&gt;\n</code></pre> <p>\u6839\u636e\u56fe\u7247\u771f\u5b9e\u5927\u5c0f\u6765\u91cd\u8bbeImageView\u7684\u9ad8\u5ea6\u3002 <pre><code>@Override\npublic void onWindowFocusChanged(boolean hasFocus) {\n    super.onWindowFocusChanged(hasFocus);\n    resetIntroIvParams();\n}\n\nprivate void resetIntroIvParams() {\n    int height = mIntroIv.getHeight(); // 704 * 440\n    int wid = mIntroIv.getWidth();\n    if (height &gt; 0 &amp;&amp; wid &gt; 0) {\n        ViewGroup.LayoutParams layoutParams = mIntroIv.getLayoutParams();\n        layoutParams.height = (int) (wid * 440.0 / 704.0);\n        mIntroIv.setLayoutParams(layoutParams);\n    }\n}\n</code></pre></p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u7b80\u4e66</p>"},{"location":"android/ui/view/animation/animation-drawable-use/","title":"Android\u5e27\u52a8\u753b","text":"<p>\u4f7f\u7528\u4e00\u7cfb\u5217\u4e0d\u540c\u7684\u56fe\u7247\uff0c\u7136\u540e\u50cf\u4e00\u5377\u80f6\u5377\u4e00\u6837\u6309\u987a\u5e8f\u64ad\u653e\uff0c\u8fd9\u662f\u4e00\u79cd\u4f20\u7edf\u7684\u52a8\u753b\uff0c\u4e5f\u53ef\u79f0\u4e3a\u5e27\u52a8\u753b\u3002\u4e5f\u53ef\u4ee5\u6bd4\u55bb\u4e3a\u50cf\u4e00\u5377\u80f6\u5377\u4e00\u6837\u6309\u987a\u5e8f\u64ad\u653e\u3002 \u64ad\u653e\u8d77\u6765\uff0c\u6709\u70b9\u50cf\u5728\u770bgif\u56fe\u3002</p> <p>\u672c\u6587\u4ecb\u7ecd\u4f7f\u7528AnimationDrawable\u7c7b\u6765\u5b9e\u73b0\u52a8\u753b\u6548\u679c\u3002 \u4e3a\u4e86\u5f00\u53d1\u65b9\u4fbf\uff0c\u6211\u4eec\u53ef\u4ee5\u5728xml\u4e2d\u6307\u5b9a\u52a8\u753b\u5404\u4e2a\u5e27\u7684\u4fe1\u606f\u3002</p>"},{"location":"android/ui/view/animation/animation-drawable-use/#_1","title":"\u4f7f\u7528\u80cc\u666f\u56fe\u7247","text":"<p>\u8fd9\u662f\u7b2c\u4e00\u4e2a\u4f8b\u5b50\u3002\u6211\u4eec\u5148\u51c6\u59074\u5f20\u56fe\u7247\uff08\u56fe\u7247\u8bf7\u81ea\u5907\uff09\u653e\u8fdb<code>res/drawable/</code>\u4e2d\u3002 \u5728\u8fd9\u4e2a\u76ee\u5f55\u91cc\uff0c\u518d\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6<code>ani_frame_1.xml</code>\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;animation-list xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:id=\"@+id/ani_frame_1\"\n    android:oneshot=\"false\"&gt;\n    &lt;item\n        android:drawable=\"@drawable/f_zan_1\"\n        android:duration=\"250\" /&gt;\n    &lt;item\n        android:drawable=\"@drawable/f_zan_4\"\n        android:duration=\"250\" /&gt;\n    &lt;item\n        android:drawable=\"@drawable/f_zan_3\"\n        android:duration=\"250\" /&gt;\n    &lt;item\n        android:drawable=\"@drawable/f_zan_2\"\n        android:duration=\"250\" /&gt;\n&lt;/animation-list&gt;\n</code></pre> \u53ef\u4ee5\u770b\u5230\u6839\u8282\u70b9<code>&lt;animation-list&gt;</code>\u5305\u542b\u4e864\u4e2a<code>item</code>\u3002\u6bcf\u4e2a\u5b50\u8282\u70b9\u90fd\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5e27\u3002 <code>duration</code>\u662f\u8fd9\u4e00\u5e27\u7684\u65f6\u5e38\uff08\u6beb\u79d2\uff09\u3002<code>drawable</code>\u662f\u6307\u5b9a\u53ef\u7ed8\u5236\u8d44\u6e90\u3002<code>oneshot=\"false\"</code>\uff0c\u8868\u793a\u8ba9\u52a8\u753b\u4e00\u76f4\u5faa\u73af\u64ad\u653e\u4e0b\u53bb\u3002 \u8fd9\u6837\u52a8\u753b\u8d44\u6e90\u5c31\u51c6\u5907\u597d\u4e86\u3002</p> <p>\u5728layout\u4e2d\u51c6\u5907\u4e00\u4e2aImageView\uff0c\u7528\u5b83\u6765\u663e\u793a\u52a8\u753b <pre><code>&lt;ImageView\n    android:id=\"@+id/iv1\"\n    android:layout_width=\"100dp\"\n    android:layout_height=\"100dp\"\n    android:layout_marginTop=\"60dp\" /&gt;\n</code></pre></p> <p>\u5728activity\u4e2d\u64cd\u4f5c\u8fd9\u4e2aImageView\u3002\u628a\u52a8\u753b\u8d44\u6e90\u8bbe\u7f6e\u4e3a\u80cc\u666f\u3002 <pre><code>var mFrameIv: ImageView? = null\n// override fun onCreate(savedInstanceState: Bundle?)\nmFrameIv = findViewById(R.id.iv1)\nmFrameIv!!.setBackgroundResource(R.drawable.ani_frame_1)\n</code></pre></p> <p>\u628aImageView\u7684\u80cc\u666f\u5f3a\u8f6c\u4e3aAnimationDrawable\u3002\u64ad\u653e\u52a8\u753b\uff0c\u8981\u7528<code>AnimationDrawable.start()</code>\u65b9\u6cd5\u3002 <pre><code>val ani: AnimationDrawable = mFrameIv!!.background as AnimationDrawable\nani.start()\n</code></pre> \u5f53\u52a8\u753b\u6b63\u5728\u64ad\u653e\u65f6\uff0c\u8c03\u7528<code>start()</code>\u65b9\u6cd5\u662f\u4e0d\u4f1a\u5f71\u54cd\u5f53\u524d\u64ad\u653e\u7684\u3002</p> <p>\u505c\u6b62\u52a8\u753b\uff0c<code>AnimationDrawable.stop()</code> <pre><code>val ani: AnimationDrawable = mFrameIv!!.background as AnimationDrawable\nani.stop()\n</code></pre> <code>stop()</code>\u65b9\u6cd5\u53ef\u4ee5\u8ba9\u52a8\u753b\u505c\u6b62\u5728\u5f53\u524d\u5e27\u3002\u518d\u8c03\u7528<code>start()</code>\u7684\u8bdd\uff0c\u4f1a\u4ece\u5934\u5f00\u59cb\u64ad\u653e\u3002</p> <p></p>"},{"location":"android/ui/view/animation/animation-drawable-use/#src","title":"\u4f7f\u7528src","text":"<p>\u524d\u9762\u6211\u4eec\u5229\u7528\u7684\u662fImageView\u7684\u80cc\u666f\u8d44\u6e90\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528<code>src</code>\u3002 \u51c6\u5907\u53e6\u4e00\u4e2a\u52a8\u753b\u8d44\u6e90<code>ani_frame_2</code>\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;animation-list xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:id=\"@+id/ani_frame_1\"\n    android:oneshot=\"true\"&gt;\n    &lt;item\n        android:drawable=\"@drawable/f_zan_1\"\n        android:duration=\"250\" /&gt;\n    &lt;item\n        android:drawable=\"@drawable/f_zan_4\"\n        android:duration=\"250\" /&gt;\n    &lt;item\n        android:drawable=\"@drawable/f_zan_3\"\n        android:duration=\"250\" /&gt;\n    &lt;item\n        android:drawable=\"@drawable/f_zan_2\"\n        android:duration=\"250\" /&gt;\n&lt;/animation-list&gt;\n</code></pre> <code>android:oneshot=\"true\"</code>\uff0c\u52a8\u753b\u64ad\u653e1\u6b21\u540e\u5c31\u4f1a\u81ea\u884c\u505c\u6b62\u5e76\u4fdd\u6301\u5728\u6700\u540e\u4e00\u5e27\u3002</p> <p>! \u6ce8\u610f\uff0c\u505c\u6b62\u540e\u5e76\u4e0d\u662f\u56de\u5230\u7b2c\u4e00\u5e27\u3002</p> <p>\u7136\u540e\u5728layout\u4e2d\uff0c\u628a\u5b83\u8bbe\u7f6e\u4e3aImageView\u7684<code>src</code>\u3002 <pre><code>&lt;ImageView\n    android:id=\"@+id/iv1\"\n    android:layout_width=\"100dp\"\n    android:layout_height=\"100dp\"\n    android:layout_marginTop=\"60dp\"\n    android:src=\"@drawable/ani_frame_2\" /&gt;\n</code></pre></p> <p>\u5728activity\u4e2d\u5c31\u4e0d\u662f\u64cd\u4f5cImageView\u7684<code>background</code>\u4e86\uff0c\u800c\u662f\u64cd\u4f5c<code>drawable</code>\u3002 <pre><code>// \u542f\u52a8\nval ani: AnimationDrawable = frameIv.drawable as AnimationDrawable\nani.start()\n\n// \u505c\u6b62\nval ani: AnimationDrawable = frameIv.drawable as AnimationDrawable\nani.stop()\n</code></pre></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c2\u4e2a\u4f8b\u5b50\u4e2d\u90fd\u9700\u8981\u64cd\u4f5cAnimationDrawable\u3002 \u8bf7\u52a1\u5fc5\u6ce8\u610f\uff0c\u5bf9 <code>AnimationDrawable.start()</code> \u65b9\u6cd5\u4e0d\u80fd\u5728 Activity \u7684 <code>onCreate()</code> \u65b9\u6cd5\u671f\u95f4\u8c03\u7528\uff0c\u56e0\u4e3a AnimationDrawable \u5c1a\u672a\u5b8c\u5168\u9644\u52a0\u5230\u7a97\u53e3\u3002\u5982\u679c\u60f3\u7acb\u5373\u64ad\u653e\u52a8\u753b\u800c\u65e0\u9700\u4e92\u52a8\uff0c\u90a3\u4e48\u53ef\u80fd\u9700\u8981\u4ece Activity \u4e2d\u7684 <code>onStart()</code> \u65b9\u6cd5\u8fdb\u884c\u8c03\u7528\uff0c\u8be5\u65b9\u6cd5\u4f1a\u5728 Android \u5728\u5c4f\u5e55\u4e0a\u5448\u73b0\u89c6\u56fe\u65f6\u8c03\u7528\u3002</p> <p>AnimationDrawable\u7c7b\u6709\u51e0\u4e2a\u5c5e\u6027\u53ef\u4ee5\u6ce8\u610f\u4e00\u4e0b</p> \u5c5e\u6027 \u8bf4\u660e <code>isOneShot</code> \u662f\u5426\u53ea\u64ad\u653e1\u6b21\uff0c\u4e0exml\u4e2d\u7684<code>android:oneshot</code>\u5bf9\u5e94 <code>isRunning</code> \u5f53\u524d\u52a8\u753b\u662f\u5426\u6b63\u5728\u64ad\u653e <code>numberOfFrames</code> \u5e27\u7684\u6570\u91cf"},{"location":"android/ui/view/animation/animation-drawable-use/#_2","title":"\u53c2\u8003","text":"<ul> <li>Android drawable\u52a8\u753b https://developer.android.com/guide/topics/graphics/drawable-animation</li> <li>res\u8d44\u6e90\u76ee\u5f55\u7b80\u4ecb https://an.rustfisher.com/android/resource/resources_overview/</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u534e\u4e3a\u4e91\u793e\u533a</p>"},{"location":"android/ui/view/animation/object-animator-intro/","title":"Android ObjectAnimator \u66f4\u6539\u89c6\u56fe\u4f4d\u7f6e","text":"<p>\u5982\u679c\u8981\u6539\u53d8\u67d0\u4e2aView\u7684\u4f4d\u7f6e\uff0c\u76f4\u63a5\u4fee\u6539\u5750\u6807\u4f1a\u6709\u4e00\u79cd\u5237\u7684\u4e00\u4e0b\u7a81\u7136\u6539\u53d8\u4f4d\u7f6e\u7684\u611f\u89c9\u3002 \u4e3a\u4e86\u8ba9\u5b83\u770b\u8d77\u6765\u66f4\u81ea\u7136\u4e00\u4e9b\uff0c\u6211\u4eec\u53ef\u4ee5\u52a0\u5165\u52a8\u753b\uff0c\u4f4d\u7f6e\u79fb\u52a8\u770b\u8d77\u6765\u66f4\u987a\u6ed1\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u7528<code>ObjectAnimator</code>\u6765\u5b9e\u73b0\u52a8\u753b\u6548\u679c\u3002\u914d\u5408\u4e0a\u65f6\u95f4\u63d2\u503c\u5668\uff0c\u80fd\u63a7\u5236\u52a8\u753b\u7684\u52a0\u51cf\u901f\u3002</p> <p>\u63a5\u4e0b\u6765\u7528\u4e00\u4e9b\u4f8b\u5b50\u6765\u8bf4\u660e<code>ObjectAnimator</code>\u7684\u7528\u6cd5\u3002\u672c\u6587\u4f7f\u7528Kotlin\u6765\u6f14\u793a\u3002</p>"},{"location":"android/ui/view/animation/object-animator-intro/#_1","title":"\u52a8\u753b\u79fb\u52a8\u793a\u4f8b","text":"<p><code>mTv</code>\u662f\u88ab\u6211\u4eec\u64cd\u4f5c\u7684View\u3002\u540c\u65f6\u5b83\u663e\u793a\u4e86\u5f53\u524d\u5b83\u7684<code>x,y</code>\u548c<code>translationX/Y</code> <pre><code>private val mUpdateListener = ValueAnimator.AnimatorUpdateListener {\n    mTv.text = \"RustFisher\\n(${mTv.x.toInt()},${mTv.y.toInt()}); (${mTv.translationX.toInt()},${mTv.translationY.toInt()})\"\n}\n</code></pre> \u8fd9\u4e2a<code>mUpdateListener</code>\u4e0d\u7528\u4e5f\u884c\u3002\u8fd9\u91cc\u53ea\u662f\u4e3a\u4e86\u663e\u793a\u5750\u6807\u3002</p>"},{"location":"android/ui/view/animation/object-animator-intro/#translation_x","title":"TRANSLATION_X","text":"<p>\u8fd9\u4e2a\u5c0f\u4f8b\u5b50\u662f\u4e3a\u4e86\u6f14\u793a<code>TRANSLATION_X</code>\u4fee\u6539\u7684\u52a8\u753b\u3002\u6c34\u5e73\u65b9\u5411\u7684\u52a8\u753b\uff0c\u65f6\u5e381\u79d2\u3002</p> <pre><code>val ani = ObjectAnimator.ofFloat(mTv, View.TRANSLATION_X, 0f, 200f, 640f).apply {\n    duration = 1000\n}\nani.addUpdateListener(mUpdateListener)\nani.start()\n</code></pre> <p>\u4f7f\u7528\u9759\u6001\u65b9\u6cd5<code>ObjectAnimator.ofFloat</code>\u83b7\u5f97<code>ObjectAnimator</code>\u5bf9\u8c61\u3002</p> <p><code>ofFloat(T target, Property&lt;T, Float&gt; property, float... values)</code></p> <ul> <li>target \u662f\u8981\u79fb\u52a8\u7684\u5bf9\u8c61\uff0c\u6211\u4eec\u4f20\u5165\u4e00\u4e2aView</li> <li>property \u662f\u8981\u66f4\u6539\u7684\u5c5e\u6027</li> <li>float... values \u662f\u76ee\u7684\u6570\u503c</li> </ul> <p>\u6ce8\u610f\u8fd9\u91cc\u90fd\u662f\u7528float\u3002<code>values</code>\u91cc\u6211\u4eec\u4f20\u5165\u4e863\u4e2a\u6570\u5b57\u3002\u5f00\u59cb\u5230\u7ed3\u675f\u65f6\u4ece0\u53d8\u5316\u5230640\u3002 \u52a8\u753b\u5c06\u4f1a\u5206\u62102\u4e2a\u90e8\u5206\uff0c\u524d500\u6beb\u79d2\u662f0\u5230200\uff1b\u540e500\u6beb\u79d2\u662f200\u5230640\u3002</p> <p>\u5728<code>apply</code>\u91cc\uff0c\u52a8\u753b\u65f6\u95f4<code>duration</code>\u8bbe\u7f6e\u4e3a1000\u6beb\u79d2\u3002</p> <p>\u52a8\u753b\u6548\u679c</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6700\u540e\u505c\u6b62\u7684\u4f4d\u7f6e\u5e76\u4e0d\u662f\u6211\u4eec\u6307\u5b9a\u7684640\uff0c\u800c\u662f\u5dee\u90a3\u4e481\u50cf\u7d20\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u5982\u679c\u4e0d\u7528\u76d1\u542c\u5668\uff0c\u53ef\u4ee5\u5199\u6210\u8fd9\u6837 <pre><code>ObjectAnimator.ofFloat(mTv, View.TRANSLATION_X, 0f, 200f, 640f).apply {\n    duration = 1000\n    start()\n}\n</code></pre></p>"},{"location":"android/ui/view/animation/object-animator-intro/#translation_y","title":"TRANSLATION_Y","text":"<p>\u540c\u7406\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u6539\u53d8<code>View.TRANSLATION_Y</code> <pre><code>val ani = ObjectAnimator.ofFloat(mTv, View.TRANSLATION_Y, 100f).apply {\n    duration = 1000\n}\nani.addUpdateListener(mUpdateListener)\nani.start()\n</code></pre> values\u91cc\u53ea\u4f20\u5165\u4e86100f\u3002\u8868\u793a\u4ece\u5f53\u524d\u503c\u53d8\u5316\u5230100f\u3002\u8fd9\u4e2a\u662f\u76ee\u6807\u503c\u3002</p>"},{"location":"android/ui/view/animation/object-animator-intro/#xy","title":"X,Y","text":"<p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u76f4\u63a5\u6539\u53d8View\u7684X\u548cY <pre><code>val ani = ObjectAnimator.ofFloat(mTv, View.X, 500f).apply {\n    duration = 800\n}\nani.addUpdateListener(mUpdateListener)\nani.start()\n// \u6216\u8005\nval ani = ObjectAnimator.ofFloat(mTv, View.Y, 700f).apply {\n    duration = 700\n}\nani.addUpdateListener(mUpdateListener)\nani.start()\n</code></pre></p> <p></p>"},{"location":"android/ui/view/animation/object-animator-intro/#_2","title":"\u4e0a\u4e0b\u5de6\u53f3","text":"<p>\u53ef\u4ee5\u4ee5View\u5f53\u524d\u4f4d\u7f6e\u4e3a\u51fa\u53d1\u70b9\uff0c\u8ba1\u7b97\u51fa\u76ee\u6807\u70b9\u3002\u5b9e\u73b0\u4e00\u4e2a\u63a7\u5236\u4e0a\u4e0b\u5de6\u53f3\u79fb\u52a8\u7684\u6548\u679c\u3002</p> <p>\u4f8b\u5982\u63a7\u5236\u5411\u4e0a\uff0c\u8ba9Y\u51cf\u5c11100\u3002 <pre><code>val ani = ObjectAnimator.ofFloat(mTv, View.Y, mTv.y - 100).apply {\n    duration = 200\n}\nani.addUpdateListener(mUpdateListener)\nani.start()\n</code></pre></p> <p></p>"},{"location":"android/ui/view/animation/object-animator-intro/#_3","title":"\u6cbf\u6307\u5b9a\u8def\u5f84\u79fb\u52a8","text":"<p>\u9664\u4e86\u6c34\u5e73/\u5782\u76f4\u79fb\u52a8\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u8def\u5f84\u7ed9\u52a8\u753b\u3002 \u8981\u7528\u5230<code>Path</code>\u7c7b\u3002</p>"},{"location":"android/ui/view/animation/object-animator-intro/#_4","title":"\u5706\u5f27","text":"<p>\u6307\u5b9a\u4e00\u4e2a\u5706\u5f27\u8def\u5f84\u3002<code>Path().apply{ }</code>\u91cc\u6307\u5b9a\u5706\u5f27\u7684\u53c2\u6570\u3002 <pre><code>val path = Path().apply {\n    arcTo(0f, 0f, 960f, 1200f, 270f, -180f, true)\n}\nval ani = ObjectAnimator.ofFloat(mTv, View.X, View.Y, path).apply {\n    duration = 2000\n}\nani.addUpdateListener(mUpdateListener)\nani.start()\n</code></pre></p> <p></p>"},{"location":"android/ui/view/animation/object-animator-intro/#_5","title":"\u6298\u7ebf","text":"<p>\u540c\u6837\u662f\u5229\u7528<code>Path</code>\uff0c\u6211\u4eec\u81ea\u5df1\u7ed8\u5236\u4e00\u4e2a\u6298\u7ebf\u8def\u7ebf\u3002 <pre><code>val path = Path().apply {\n    moveTo(0f, 0f)\n    lineTo(800f, 400f)\n    lineTo(0f, 600f)\n    lineTo(800f, 800f)\n    lineTo(0f, 1000f)\n}\nval ani = ObjectAnimator.ofFloat(mTv, View.X, View.Y, path).apply {\n    duration = 3000\n}\nani.addUpdateListener(mUpdateListener)\nani.start()\n</code></pre> \u8fd9\u662f\u4e2a\u957f\u8fbe3\u79d2\u7684\u52a8\u753b\u3002\u4ece<code>(0,0)</code>\u51fa\u53d1\uff0c\u6700\u540e\u62b5\u8fbe<code>(0,1000)</code>\u3002\u89c6\u89c9\u4e0a\u5c31\u662f\u8d70\u4e86\u4e00\u4e2a\u6298\u7ebf\u3002 \u521b\u5efaPath\u65f6\uff0c\u5148<code>moveTo(0f, 0f)</code>\u56de\u5230<code>(0,0)</code>\uff0c\u7136\u540e\u7528<code>lineTo</code>\u628a\u8def\u5f84\u7ed8\u5236\u51fa\u6765\u3002</p> <p></p>"},{"location":"android/ui/view/animation/object-animator-intro/#_6","title":"\u53c2\u8003","text":"<ul> <li>Android \u4f4d\u79fb\u52a8\u753b https://developer.android.com/training/animation/reposition-view</li> <li>Android \u52a8\u753b\u7b80\u4ecb https://an.rustfisher.com/android/ui/view/animation/view-animation-intro/</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a</p>"},{"location":"android/ui/view/animation/tween-use1/","title":"Android \u8865\u95f4\u52a8\u753b","text":"<p>\u8865\u95f4\u52a8\u753b\uff1a\u901a\u8fc7\u4f7f\u7528 Animation \u5bf9\u5355\u5f20\u56fe\u7247\u6267\u884c\u4e00\u7cfb\u5217\u8f6c\u6362\u6765\u521b\u5efa\u52a8\u753b\u3002</p> <p>\u5728 XML \u4e2d\u5b9a\u4e49\u7684\u52a8\u753b\uff0c\u7528\u4e8e\u5bf9\u56fe\u5f62\u6267\u884c\u65cb\u8f6c\u3001\u6de1\u51fa\u3001\u79fb\u52a8\u548c\u62c9\u4f38\u7b49\u8f6c\u6362\u3002</p> <p>\u52a8\u753b\u6587\u4ef6\u653e\u5728<code>res/anim/</code>\uff0c\u8be5\u6587\u4ef6\u540d\u5c06\u7528\u4f5c\u8d44\u6e90 ID\u3002</p>"},{"location":"android/ui/view/animation/tween-use1/#_1","title":"\u79fb\u52a8\u793a\u4f8b","text":"<p>\u5148\u7528\u4e00\u4e2a\u4f8b\u5b50\u5efa\u7acb\u76f4\u89c2\u7684\u8ba4\u8bc6\u3002\u65b0\u5efa\u4e00\u4e2a\u52a8\u753bxml\uff0c\u5b9e\u73b0\u4ece\u5de6\u5230\u53f3\u7684\u6548\u679c\u3002 <code>move_hor_1.xml</code> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;set xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n    &lt;translate\n        android:duration=\"200\"\n        android:toXDelta=\"-100%\" /&gt;\n\n    &lt;translate\n        android:duration=\"400\"\n        android:startOffset=\"200\"\n        android:toXDelta=\"100%\" /&gt;\n&lt;/set&gt;\n</code></pre></p> <p>\u8981\u4f7f\u7528\u8fd9\u4e2a\u52a8\u753b\uff0c\u9700\u8981\u7528\u5230<code>AnimationUtils.loadAnimation(getContext(), R.anim.move_hor_1);</code>\u6765\u52a0\u8f7d\u52a8\u753b\u3002\u5f97\u5230\u5bf9\u8c61<code>mAnimation</code> \u4ea4\u7ed9<code>View.startAnimation(mAnimation);</code>\u6765\u542f\u52a8\u3002</p> <p>\u4e0a\u9762\u7684\u52a8\u753b\u4f8b\u5b50\u6548\u679c\u56fe</p> <p></p> <p>\u4ed4\u7ec6\u770b\u4e00\u4e0b\u52a8\u753bxml\u91cc\u7684\u5185\u5bb9</p> <ul> <li><code>set</code>\u91cc\u67092\u4e2a<code>translate</code></li> <li><code>translate</code>\u8868\u793a\u79fb\u52a8\u52a8\u4f5c</li> <li><code>duration</code>\u662f\u8fd9\u4e2a\u52a8\u4f5c\u7684\u6267\u884c\u65f6\u957f\uff08\u6beb\u79d2\uff09</li> <li><code>toXDelta</code>\u8868\u793a\u6a2a\u884c\u79fb\u52a8</li> <li><code>startOffset</code>\u8868\u793a\u52a8\u753b\u5f00\u59cb\u6267\u884c\u591a\u4e45\u540e\u518d\u6267\u884c\u8fd9\u4e2a\u52a8\u4f5c</li> </ul> <p>\u5b9e\u9645\u4e0a\uff0c\u7b2c\u4e8c\u4e2a<code>translate</code>\u5468\u671f\u662f400\u6beb\u79d2\uff0c\u5b83\u201c\u7b49\u4e86\u201d200\u6beb\u7c73\u624d\u5f00\u59cb\u6267\u884c\u3002 \u628aView\u4ece\u5de6\u8fb9\u79fb\u52a8\u5230\u4e86\u53f3\u8fb9\u3002</p>"},{"location":"android/ui/view/animation/tween-use1/#_2","title":"\u7f29\u653e\u793a\u4f8b","text":"<p>\u9664\u4e86\u4f4d\u79fb\uff0c\u8fd8\u53ef\u4ee5\u6267\u884c\u7f29\u653e\u6548\u679c\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u793a\u4f8b\u79cd\u5148\u653e\u5927\u518d\u7f29\u5c0f\u56de\u53bb\u3002\u4e3b\u8981\u662f\u7528\u4e86<code>android:repeatMode=\"reverse\"</code>\u548c<code>android:repeatCount=\"1\"</code>\u3002</p> <p>\u5b8c\u6574\u52a8\u753bxml\u5982\u4e0b <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;set xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n    &lt;scale\n        android:duration=\"600\"\n        android:fromXScale=\"1\"\n        android:fromYScale=\"1\"\n        android:pivotX=\"50%\"\n        android:pivotY=\"50%\"\n        android:repeatCount=\"1\"\n        android:repeatMode=\"reverse\"\n        android:toXScale=\"1.35\"\n        android:toYScale=\"1.35\" /&gt;\n&lt;/set&gt;\n</code></pre></p> <p>scale\u91cc\u9762\u6211\u4eec\u9047\u5230\u4e86\u51e0\u4e2a\u5143\u7d20<code>pivotX</code>\uff0c<code>repeatCount</code>\uff0c<code>repeatMode</code></p> <ul> <li><code>android:pivotX</code> \u5728\u5bf9\u8c61\u7f29\u653e\u65f6\u8981\u4fdd\u6301\u4e0d\u53d8\u7684 X \u5750\u6807\uff1b<code>pivotY</code>\u540c\u7406\u3002</li> <li><code>android:repeatCount</code> \u52a8\u753b\u7684\u91cd\u590d\u6b21\u6570\u3002\u8bbe\u4e3a \"-1\" \u8868\u793a\u65e0\u9650\u6b21\u91cd\u590d\uff0c\u4e5f\u53ef\u8bbe\u4e3a\u6b63\u6574\u6570\u3002</li> <li>\u4f8b\u5982\uff0c\u503c \"1\" \u8868\u793a\u52a8\u753b\u5728\u521d\u6b21\u64ad\u653e\u540e\u91cd\u590d\u64ad\u653e\u4e00\u6b21\uff0c\u56e0\u6b64\u52a8\u753b\u603b\u5171\u64ad\u653e\u4e24\u6b21\u3002\u9ed8\u8ba4\u503c\u4e3a \"0\"\uff0c\u8868\u793a\u4e0d\u91cd\u590d\u3002</li> <li><code>android:repeatMode</code> \u52a8\u753b\u64ad\u653e\u5230\u7ed3\u5c3e\u5904\u7684\u884c\u4e3a\u3002<code>android:repeatCount</code> \u5fc5\u987b\u8bbe\u7f6e\u4e3a\u6b63\u6574\u6570\u6216 \"-1\"\uff0c\u8be5\u5c5e\u6027\u624d\u6709\u6548\u3002</li> <li>\u8bbe\u7f6e\u4e3a <code>\"reverse\"</code> \u53ef\u8ba9\u52a8\u753b\u5728\u6bcf\u6b21\u8fed\u4ee3\u65f6\u53cd\u5411\u64ad\u653e\uff0c</li> <li>\u8bbe\u7f6e\u4e3a <code>\"repeat\"</code> \u5219\u53ef\u8ba9\u52a8\u753b\u6bcf\u6b21\u4ece\u5934\u5f00\u59cb\u5faa\u73af\u64ad\u653e\u3002</li> </ul>"},{"location":"android/ui/view/animation/tween-use1/#_3","title":"\u591a\u4e2a\u52a8\u753b\u5143\u7d20\u7684\u4f8b\u5b50","text":"<p>\u4e00\u4e2a<code>&lt;set&gt;</code>\u96c6\u5408\u91cc\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u5143\u7d20\u3002</p> <p></p> <p>\u5f55\u5236gif\u7684\u51fa\u6765\u53d1\u73b0\u5feb\u7ed3\u675f\u65f6\u603b\u6709\u4e00\u4e2a\u6296\u52a8\uff0c\u662f\u5f55\u5236\u7684\u95ee\u9898\u3002</p> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;set xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:shareInterpolator=\"false\"&gt;\n    &lt;rotate\n        android:duration=\"500\"\n        android:fromDegrees=\"0\"\n        android:pivotX=\"50%\"\n        android:pivotY=\"50%\"\n        android:toDegrees=\"360\" /&gt;\n\n    &lt;translate\n        android:duration=\"500\"\n        android:fromXDelta=\"0%\"\n        android:toXDelta=\"50%\" /&gt;\n\n    &lt;alpha\n        android:duration=\"500\"\n        android:fromAlpha=\"1\"\n        android:toAlpha=\"0.5\" /&gt;\n\n    &lt;set\n        android:interpolator=\"@android:anim/decelerate_interpolator\"\n        android:startOffset=\"500\"&gt;\n        &lt;rotate\n            android:duration=\"400\"\n            android:fromDegrees=\"360\"\n            android:pivotX=\"100%\"\n            android:pivotY=\"50%\"\n            android:toDegrees=\"0\" /&gt;\n\n        &lt;translate\n            android:duration=\"400\"\n            android:fromXDelta=\"0%\"\n            android:toXDelta=\"-50%\" /&gt;\n\n        &lt;alpha\n            android:duration=\"400\"\n            android:fromAlpha=\"0.5\"\n            android:toAlpha=\"1\" /&gt;\n\n    &lt;/set&gt;\n&lt;/set&gt;\n</code></pre> <p><code>&lt;set&gt;</code>\u91cc\u653e\u7f6e\u7740\u591a\u4e2a\u5143\u7d20\uff0c\u53ef\u4ee5\u628a<code>&lt;set&gt;</code>\u653e\u8fdb<code>&lt;set&gt;</code>\u91cc\u3002 \u6211\u4eec\u5206\u6210\u51fa\u53d1\u548c\u56de\u6765\u4e24\u4e2a\u52a8\u4f5c</p> <p>\u51fa\u53d1\uff1a</p> <p>\u7b2c\u4e00\u4e2a<code>&lt;rotate&gt;</code>\u662f\u4ece\u81ea\u5df1\u7684\u4e2d\u5fc3\u4f4d\u7f6e\u5f00\u59cb\u3002 <code>&lt;translate&gt;</code>\u6c34\u5e73\u5411\u53f3\u8d70\u4e8650%\u3002</p> <p>\u56de\u6765\uff1a</p> <p>\u540e\u9762<code>&lt;rotate&gt;</code>\u7684<code>pivotX</code>\u9700\u8981\u8003\u8651\u5230\u51fa\u53d1\u65f6\u6c34\u5e73\u79fb\u52a8\u4e8650%\uff0c\u56e0\u6b64<code>pivotX</code>\u53d6\u503c100%\u3002</p> <p>\u800c<code>&lt;translate&gt;</code>\u4ece0%\u8d70\u5230-50%\u5373\u53ef\u3002</p>"},{"location":"android/ui/view/animation/tween-use1/#xml","title":"\u52a8\u753bxml\u5143\u7d20","text":"<p>\u4e0b\u9762\u603b\u7ed3\u4e00\u4e0b\u5404\u4e2a\u5c5e\u6027 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n    &lt;set xmlns:android=\"http://schemas.android.com/apk/res/android\"\n        android:interpolator=\"@[package:]anim/interpolator_resource\"\n        android:shareInterpolator=[\"true\" | \"false\"] &gt;\n        &lt;alpha\n            android:fromAlpha=\"float\"\n            android:toAlpha=\"float\" /&gt;\n        &lt;scale\n            android:fromXScale=\"float\"\n            android:toXScale=\"float\"\n            android:fromYScale=\"float\"\n            android:toYScale=\"float\"\n            android:pivotX=\"float\"\n            android:pivotY=\"float\" /&gt;\n        &lt;translate\n            android:fromXDelta=\"float\"\n            android:toXDelta=\"float\"\n            android:fromYDelta=\"float\"\n            android:toYDelta=\"float\" /&gt;\n        &lt;rotate\n            android:fromDegrees=\"float\"\n            android:toDegrees=\"float\"\n            android:pivotX=\"float\"\n            android:pivotY=\"float\" /&gt;\n        &lt;set&gt;\n            ...\n        &lt;/set&gt;\n    &lt;/set&gt;\n</code></pre></p>"},{"location":"android/ui/view/animation/tween-use1/#set","title":"set","text":"<p>\u5bb9\u7eb3\u5176\u4ed6\u52a8\u753b\u5143\u7d20\uff08\u3001 \u6216\u5176\u4ed6  \u5143\u7d20\uff09\u7684\u5bb9\u5668\u3002\u4ee3\u8868 AnimatorSet\u3002 \u53ef\u4ee5\u653e\u7f6e\u591a\u4e2a\u52a8\u753b\u5143\u7d20\uff0c\u7ec4\u5408\u5728\u4e00\u8d77\u3002\u6bcf\u4e2aset\u53ef\u5b9a\u4e49\u81ea\u5df1\u7684 <code>ordering</code> \u5c5e\u6027\u3002 <ul> <li><code>android:interpolator</code> \u63d2\u503c\u5668\u8d44\u6e90\u3002 \u8981\u5e94\u7528\u4e8e\u52a8\u753b\u7684 Interpolator\u3002 \u8be5\u503c\u5fc5\u987b\u662f\u5bf9\u6307\u5b9a\u63d2\u503c\u5668\u7684\u8d44\u6e90\u7684\u5f15\u7528\uff08\u800c\u4e0d\u662f\u63d2\u503c\u5668\u7c7b\u540d\u79f0\uff09\u3002\u53ef\u4f7f\u7528\u5e73\u53f0\u63d0\u4f9b\u7684\u9ed8\u8ba4\u63d2\u503c\u5668\u8d44\u6e90\uff0c\u4e5f\u53ef\u521b\u5efa\u81ea\u5df1\u7684\u63d2\u503c\u5668\u8d44\u6e90\u3002</li> <li><code>android:shareInterpolator</code> \u5e03\u5c14\u503c\u3002\u5982\u679c\u8981\u5728\u6240\u6709\u5b50\u5143\u7d20\u4e2d\u5171\u7528\u540c\u4e00\u63d2\u503c\u5668\uff0c\u5219\u4e3a\u201ctrue\u201d\u3002</li> </ul>"},{"location":"android/ui/view/animation/tween-use1/#alpha","title":"alpha","text":"<p>\u6de1\u5165\u6216\u6de1\u51fa\u52a8\u753b\u3002\u5bf9\u5e94AlphaAnimation\u7c7b\u3002</p> <ul> <li><code>android:fromAlpha</code> \u6d6e\u70b9\u6570\u3002\u8d77\u59cb\u4e0d\u900f\u660e\u5ea6\u504f\u79fb\uff0c0.0 \u8868\u793a\u900f\u660e\uff0c1.0 \u8868\u793a\u4e0d\u900f\u660e\u3002</li> <li><code>android:toAlpha</code> \u6d6e\u70b9\u6570\u3002\u7ed3\u675f\u4e0d\u900f\u660e\u5ea6\u504f\u79fb\uff0c0.0 \u8868\u793a\u900f\u660e\uff0c1.0 \u8868\u793a\u4e0d\u900f\u660e\u3002</li> </ul>"},{"location":"android/ui/view/animation/tween-use1/#scale","title":"scale","text":"<p>\u7f29\u653e\u52a8\u753b\uff0c\u8c03\u6574\u5927\u5c0f\u7684\u52a8\u753b\uff1b\u5bf9\u5e94<code>ScaleAnimation</code>\u3002 \u6307\u5b9a <code>pivotX</code> \u548c <code>pivotY</code>\uff0c\u6765\u6307\u5b9aView\u5411\u5916\uff08\u6216\u5411\u5185\uff09\u6269\u5c55\u7684\u4e2d\u5fc3\u70b9\u3002 \u4f8b\u5982\uff0c\u5982\u679c\u8fd9\u4e24\u4e2a\u503c\u4e3a 0\u30010\uff08\u5de6\u4e0a\u89d2\uff09\uff0c\u5219\u6240\u6709\u6269\u5c55\u5747\u5411\u53f3\u4e0b\u65b9\u5411\u8fdb\u884c\u3002</p> <ul> <li><code>android:fromXScale</code> \u6d6e\u70b9\u6570\u3002\u8d77\u59cb X \u5c3a\u5bf8\u504f\u79fb\uff0c\u5176\u4e2d 1.0 \u8868\u793a\u4e0d\u53d8\u3002</li> <li><code>android:toXScale</code> \u6d6e\u70b9\u6570\u3002\u7ed3\u675f X \u5c3a\u5bf8\u504f\u79fb\uff0c\u5176\u4e2d 1.0 \u8868\u793a\u4e0d\u53d8\u3002</li> <li><code>android:fromYScale</code> \u6d6e\u70b9\u6570\u3002\u8d77\u59cb Y \u5c3a\u5bf8\u504f\u79fb\uff0c\u5176\u4e2d 1.0 \u8868\u793a\u4e0d\u53d8\u3002</li> <li><code>android:toYScale</code> \u6d6e\u70b9\u6570\u3002\u7ed3\u675f Y \u5c3a\u5bf8\u504f\u79fb\uff0c\u5176\u4e2d 1.0 \u8868\u793a\u4e0d\u53d8\u3002</li> <li><code>android:pivotX</code> \u6d6e\u70b9\u6570\u3002\u5728\u5bf9\u8c61\u7f29\u653e\u65f6\u8981\u4fdd\u6301\u4e0d\u53d8\u7684 X \u5750\u6807\u3002</li> <li><code>android:pivotY</code> \u6d6e\u70b9\u6570\u3002\u5728\u5bf9\u8c61\u7f29\u653e\u65f6\u8981\u4fdd\u6301\u4e0d\u53d8\u7684 Y \u5750\u6807\u3002</li> </ul>"},{"location":"android/ui/view/animation/tween-use1/#translate","title":"translate","text":"<p>\u79fb\u52a8\u52a8\u753b\u3002\u5782\u76f4\u6216\u6c34\u5e73\u79fb\u52a8\u3002\u6216\u8005\u6c34\u5e73\u548c\u5782\u76f4\u79fb\u52a8\u4e00\u8d77\u3002\u5bf9\u5e94TranslateAnimation\u3002 \u652f\u6301\u91c7\u7528\u4ee5\u4e0b\u4e09\u79cd\u683c\u5f0f\u4e4b\u4e00\u7684\u4ee5\u4e0b\u5c5e\u6027\uff1a\u4ece -100 \u5230 100 \u7684\u4ee5\u201c\uff05\u201d\u7ed3\u5c3e\u7684\u503c\uff0c\u8868\u793a\u76f8\u5bf9\u4e8e\u81ea\u8eab\u7684\u767e\u5206\u6bd4\uff1b\u4ece -100 \u5230 100 \u7684\u4ee5\u201c\uff05p\u201d\u7ed3\u5c3e\u7684\u503c\uff0c\u8868\u793a\u76f8\u5bf9\u4e8e\u5176\u7236\u9879\u7684\u767e\u5206\u6bd4\uff1b\u4e0d\u5e26\u540e\u7f00\u7684\u6d6e\u70b9\u503c\uff0c\u8868\u793a\u7edd\u5bf9\u503c\u3002</p> <p>\u5c5e\u6027\uff1a</p> <ul> <li><code>android:fromXDelta</code> float\u6216\u767e\u5206\u6bd4\u3002\u8d77\u59cb X \u504f\u79fb\u3002\u8868\u793a\u65b9\u5f0f\uff1a\u76f8\u5bf9\u4e8e\u6b63\u5e38\u4f4d\u7f6e\u7684\u50cf\u7d20\u6570\uff08\u4f8b\u5982 \"5\"\uff09\uff0c\u76f8\u5bf9\u4e8e\u5143\u7d20\u5bbd\u5ea6\u7684\u767e\u5206\u6bd4\uff08\u4f8b\u5982 \"5%\"\uff09\uff0c\u6216\u76f8\u5bf9\u4e8e\u7236\u9879\u5bbd\u5ea6\u7684\u767e\u5206\u6bd4\uff08\u4f8b\u5982 \"5%p\"\uff09\u3002</li> <li><code>android:toXDelta</code> float\u6216\u767e\u5206\u6bd4\u3002\u7ed3\u675f X \u504f\u79fb\u3002\u8868\u793a\u65b9\u5f0f\u540c<code>fromXDelta</code></li> <li><code>android:fromYDelta</code> float\u6216\u767e\u5206\u6bd4\u3002\u8d77\u59cb Y \u504f\u79fb\u3002\u8868\u793a\u65b9\u5f0f\uff1a\u76f8\u5bf9\u4e8e\u6b63\u5e38\u4f4d\u7f6e\u7684\u50cf\u7d20\u6570\uff08\u4f8b\u5982 \"5\"\uff09\uff0c\u76f8\u5bf9\u4e8e\u5143\u7d20\u9ad8\u5ea6\u7684\u767e\u5206\u6bd4\uff08\u4f8b\u5982 \"5%\"\uff09\uff0c\u6216\u76f8\u5bf9\u4e8e\u7236\u9879\u9ad8\u5ea6\u7684\u767e\u5206\u6bd4\uff08\u4f8b\u5982 \"5%p\"\uff09\u3002</li> <li><code>android:toYDelta</code> float\u6216\u767e\u5206\u6bd4\u3002\u7ed3\u675f Y \u504f\u79fb\u3002\u8868\u793a\u65b9\u5f0f\u540c<code>fromYDelta</code></li> </ul>"},{"location":"android/ui/view/animation/tween-use1/#rotate","title":"rotate","text":"<p>\u65cb\u8f6c\u52a8\u753b\u3002\u5bf9\u5e94RotateAnimation\u3002</p> <p>\u5c5e\u6027\uff1a</p> <ul> <li><code>android:fromDegrees</code>\u6d6e\u70b9\u6570\u3002\u8d77\u59cb\u89d2\u5ea6\u4f4d\u7f6e\uff0c\u4ee5\u5ea6\u4e3a\u5355\u4f4d\u3002</li> <li><code>android:toDegrees</code>\u6d6e\u70b9\u6570\u3002\u7ed3\u675f\u89d2\u5ea6\u4f4d\u7f6e\uff0c\u4ee5\u5ea6\u4e3a\u5355\u4f4d\u3002</li> <li><code>android:pivotX</code>float\u6216\u767e\u5206\u6bd4\u3002\u65cb\u8f6c\u4e2d\u5fc3\u7684 X \u5750\u6807\u3002\u8868\u793a\u65b9\u5f0f\uff1a\u76f8\u5bf9\u4e8e\u5bf9\u8c61\u5de6\u8fb9\u7f18\u7684\u50cf\u7d20\u6570\uff08\u4f8b\u5982 \"5\"\uff09\uff0c\u76f8\u5bf9\u4e8e\u5bf9\u8c61\u5de6\u8fb9\u7f18\u7684\u767e\u5206\u6bd4\uff08\u4f8b\u5982 \"5%\"\uff09\uff0c\u6216\u76f8\u5bf9\u4e8e\u7236\u7ea7\u5bb9\u5668\u5de6\u8fb9\u7f18\u7684\u767e\u5206\u6bd4\uff08\u4f8b\u5982 \"5%p\"\uff09\u3002</li> <li><code>android:pivotY</code>float\u6216\u767e\u5206\u6bd4\u3002\u65cb\u8f6c\u4e2d\u5fc3\u7684 Y \u5750\u6807\u3002\u8868\u793a\u65b9\u5f0f\uff1a\u76f8\u5bf9\u4e8e\u5bf9\u8c61\u4e0a\u8fb9\u7f18\u7684\u50cf\u7d20\u6570\uff08\u4f8b\u5982 \"5\"\uff09\uff0c\u76f8\u5bf9\u4e8e\u5bf9\u8c61\u4e0a\u8fb9\u7f18\u7684\u767e\u5206\u6bd4\uff08\u4f8b\u5982 \"5%\"\uff09\uff0c\u6216\u76f8\u5bf9\u4e8e\u7236\u7ea7\u5bb9\u5668\u4e0a\u8fb9\u7f18\u7684\u767e\u5206\u6bd4\uff08\u4f8b\u5982 \"5%p\"\uff09\u3002</li> </ul>"},{"location":"android/ui/view/animation/tween-use1/#_4","title":"\u53c2\u8003","text":"<ul> <li>Tween\u52a8\u753b\u6307\u5357 https://developer.android.com/guide/topics/resources/animation-resource#Tween</li> <li>res\u7b80\u4ecb https://an.rustfisher.com/android/resource/resources_overview/</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u534e\u4e3a\u4e91\u793e\u533a</p>"},{"location":"android/ui/view/animation/view-animation-intro/","title":"Android\u5e94\u7528\u7684\u52a8\u753b","text":"<p>\u5e27\u52a8\u753b\uff0c\u5c5e\u6027\u52a8\u753b\uff0c\u8865\u95f4\u52a8\u753b</p>"},{"location":"android/ui/view/animation/view-animation-intro/#_1","title":"\u5e27\u52a8\u753b","text":"<p>Frame Animation</p> <p>\u7528\u591a\u5f20\u56fe\u7247\u6765\u7ec4\u6210\u52a8\u753b\u3002\u4e00\u5e27\u5e27\u7684\u64ad\u653e\u56fe\u7247\uff0c\u5229\u7528\u4eba\u773c\u89c6\u89c9\u6b8b\u7559\u539f\u7406\uff0c\u7ed9\u6211\u4eec\u5e26\u6765\u52a8\u753b\u7684\u611f\u89c9\u3002\u5b83\u7684\u539f\u7406\u7684GIF\u56fe\u7247\u3001\u7535\u5f71\u64ad\u653e\u539f\u7406\u4e00\u6837\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528<code>AnimationDrawable</code>\u6765\u5b9e\u73b0\u52a8\u753b\u6548\u679c\u3002</p>"},{"location":"android/ui/view/animation/view-animation-intro/#_2","title":"\u8865\u95f4\u52a8\u753b","text":"<p>Tween Animation</p> <ul> <li>\u8865\u95f4\u52a8\u753b\u5c31\u662f\u6211\u4eec\u53ea\u9700\u6307\u5b9a\u5f00\u59cb\u3001\u7ed3\u675f\u7684\u201c\u5173\u952e\u5e27\u201c\uff0c\u800c\u53d8\u5316\u4e2d\u7684\u5176\u4ed6\u5e27\u7531\u7cfb\u7edf\u6765\u8ba1\u7b97\uff0c\u4e0d\u5fc5\u81ea\u5df1\u4e00\u5e27\u5e27\u7684\u53bb\u5b9a\u4e49\u3002</li> <li>Android\u4f7f\u7528Animation\u4ee3\u8868\u62bd\u8c61\u52a8\u753b\uff0c\u5305\u62ec\u56db\u79cd\u5b50\u7c7b\uff1aAlphaAnimation(\u900f\u660e\u5ea6\u52a8\u753b)\u3001ScaleAnimation(\u7f29\u653e\u52a8\u753b)\u3001TranslateAnimation(\u4f4d\u79fb\u52a8\u753b)\u3001RotateAnimation(\u65cb\u8f6c\u52a8\u753b)</li> <li>\u4e00\u822c\u90fd\u4f1a\u91c7\u7528\u52a8\u753b\u8d44\u6e90\u6587\u4ef6\u6765\u5b9a\u4e49\u52a8\u753b\uff0c\u628a\u754c\u9762\u4e0e\u903b\u8f91\u5206\u79bb</li> <li>\u5b9a\u4e49\u597danim\u6587\u4ef6\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7AnimationUtils\u5de5\u5177\u7c7b\u6765\u52a0\u8f7d\u5b83\u4eec\uff0c\u52a0\u8f7d\u6210\u529f\u540e\u8fd4\u56de\u4e00\u4e2aAnimation\u3002\u7136\u540e\u5c31\u53ef\u4ee5\u901a\u8fc7View\u7684startAnimation(anim)\u5f00\u59cb\u6267\u884c\u52a8\u753b\u4e86</li> </ul>"},{"location":"android/ui/view/animation/view-animation-intro/#_3","title":"\u5c5e\u6027\u52a8\u753b","text":"<p>Property Animation</p> <ul> <li>\u76f4\u63a5\u66f4\u6539\u6211\u4eec\u5bf9\u8c61\u7684\u5c5e\u6027\u3002\u5728\u4e0a\u9762\u63d0\u5230\u7684Tween Animation\u4e2d\uff0c\u53ea\u662f\u66f4\u6539View\u7684\u7ed8\u753b\u6548\u679c\u800cView\u7684\u771f\u5b9e\u5c5e\u6027\u662f\u4e0d\u6539\u53d8\u7684</li> <li>\u5e38\u7528Animator\u7c7b\uff0cValueAnimator\u7b49<ul> <li>Animator\u53ef\u52a0\u8f7d\u52a8\u753b\u8d44\u6e90\u6587\u4ef6</li> <li>ValueAnimator\u53ef\u4f7f\u7528\u5185\u7f6e\u4f30\u503c\u5668\uff0c\u6dfb\u52a0\u76d1\u542cAnimatorUpdateListener\uff0c\u5728\u6bcf\u6b21\u53d8\u5316\u65f6\u4fee\u6539view\u7684\u5c5e\u6027</li> </ul> </li> </ul>"},{"location":"android/ui/view/animation/view-animation-intro/#_4","title":"\u5c5e\u6027\u52a8\u753b\u4e0e\u89c6\u56fe\u52a8\u753b\u7684\u533a\u522b","text":"<p>\u89c6\u56fe\u52a8\u753b\u7cfb\u7edf\u4ec5\u63d0\u4f9b\u4e3a View \u5bf9\u8c61\u6dfb\u52a0\u52a8\u753b\u6548\u679c\u7684\u529f\u80fd\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u60a8\u60f3\u4e3a\u975e \u5bf9\u8c61\u6dfb\u52a0\u52a8\u753b\u6548\u679c\uff0c\u5219\u5fc5\u987b\u5b9e\u73b0\u81ea\u5df1\u7684\u4ee3\u7801\u624d\u80fd\u505a\u5230\u3002\u89c6\u56fe\u52a8\u753b\u7cfb\u7edf\u4e5f\u5b58\u5728\u4e00\u4e9b\u9650\u5236\uff0c\u56e0\u4e3a\u5b83\u4ec5\u516c\u5f00 \u5bf9\u8c61\u7684\u90e8\u5206\u65b9\u9762\u6765\u4f9b\u60a8\u6dfb\u52a0\u52a8\u753b\u6548\u679c\uff1b\u4f8b\u5982\uff0c\u60a8\u53ef\u4ee5\u5bf9\u89c6\u56fe\u7684\u7f29\u653e\u548c\u65cb\u8f6c\u6dfb\u52a0\u52a8\u753b\u6548\u679c\uff0c\u4f46\u65e0\u6cd5\u5bf9\u80cc\u666f\u989c\u8272\u8fd9\u6837\u505a\u3002</p> <p>\u89c6\u56fe\u52a8\u753b\u7cfb\u7edf\u7684\u53e6\u4e00\u4e2a\u7f3a\u70b9\u662f\u5b83\u53ea\u4f1a\u5728\u7ed8\u5236\u89c6\u56fe\u7684\u4f4d\u7f6e\u8fdb\u884c\u4fee\u6539\uff0c\u800c\u4e0d\u4f1a\u4fee\u6539\u5b9e\u9645\u7684\u89c6\u56fe\u672c\u8eab\u3002\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u4e3a\u67d0\u4e2a\u6309\u94ae\u6dfb\u52a0\u4e86\u52a8\u753b\u6548\u679c\uff0c\u4f7f\u5176\u53ef\u4ee5\u5728\u5c4f\u5e55\u4e0a\u79fb\u52a8\uff0c\u8be5\u6309\u94ae\u4f1a\u6b63\u786e\u7ed8\u5236\uff0c\u4f46\u80fd\u591f\u70b9\u51fb\u6309\u94ae\u7684\u5b9e\u9645\u4f4d\u7f6e\u5e76\u4e0d\u4f1a\u66f4\u6539\uff0c\u56e0\u6b64\u60a8\u5fc5\u987b\u901a\u8fc7\u5b9e\u73b0\u81ea\u5df1\u7684\u903b\u8f91\u6765\u5904\u7406\u6b64\u4e8b\u4ef6\u3002</p> <p>\u6709\u4e86\u5c5e\u6027\u52a8\u753b\u7cfb\u7edf\uff0c\u60a8\u5c31\u53ef\u4ee5\u5b8c\u5168\u6446\u8131\u8fd9\u4e9b\u675f\u7f1a\uff0c\u8fd8\u53ef\u4ee5\u4e3a\u4efb\u4f55\u5bf9\u8c61\uff08\u89c6\u56fe\u548c\u975e\u89c6\u56fe\uff09\u7684\u4efb\u4f55\u5c5e\u6027\u6dfb\u52a0\u52a8\u753b\u6548\u679c\uff0c\u5e76\u4e14\u5b9e\u9645\u4fee\u6539\u7684\u662f\u5bf9\u8c61\u672c\u8eab\u3002\u5c5e\u6027\u52a8\u753b\u7cfb\u7edf\u5728\u6267\u884c\u52a8\u753b\u65b9\u9762\u4e5f\u66f4\u4e3a\u5f3a\u5065\u3002\u6982\u62ec\u5730\u8bb2\uff0c\u60a8\u53ef\u4ee5\u4e3a\u8981\u6dfb\u52a0\u52a8\u753b\u6548\u679c\u7684\u5c5e\u6027\uff08\u4f8b\u5982\u989c\u8272\u3001\u4f4d\u7f6e\u6216\u5927\u5c0f\uff09\u5206\u914d Animator\uff0c\u8fd8\u53ef\u4ee5\u5b9a\u4e49\u52a8\u753b\u7684\u5404\u4e2a\u65b9\u9762\uff0c\u4f8b\u5982\u591a\u4e2a Animator \u7684\u63d2\u503c\u548c\u540c\u6b65\u3002</p> <p>\u4e0d\u8fc7\uff0c\u89c6\u56fe\u52a8\u753b\u7cfb\u7edf\u7684\u8bbe\u7f6e\u9700\u8981\u7684\u65f6\u95f4\u8f83\u77ed\uff0c\u9700\u8981\u7f16\u5199\u7684\u4ee3\u7801\u4e5f\u8f83\u5c11\u3002\u5982\u679c\u89c6\u56fe\u52a8\u753b\u53ef\u4ee5\u5b8c\u6210\u60a8\u9700\u8981\u6267\u884c\u7684\u6240\u6709\u64cd\u4f5c\uff0c\u6216\u8005\u73b0\u6709\u4ee3\u7801\u5df2\u6309\u7167\u60a8\u9700\u8981\u7684\u65b9\u5f0f\u8fd0\u884c\uff0c\u5219\u65e0\u9700\u4f7f\u7528\u5c5e\u6027\u52a8\u753b\u7cfb\u7edf\u3002\u5728\u67d0\u4e9b\u7528\u4f8b\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u9488\u5bf9\u4e0d\u540c\u7684\u60c5\u51b5\u540c\u65f6\u4f7f\u7528\u8fd9\u4e24\u79cd\u52a8\u753b\u7cfb\u7edf\u3002</p>"},{"location":"android/ui/view/button/overview/","title":"Android Button \u6309\u94ae\u7b80\u8ff0","text":"<p>Button\u80fd\u5bf9\u7528\u6237\u7684\u70b9\u51fb\u884c\u4e3a\u4f5c\u51fa\u53cd\u5e94\u3002</p>"},{"location":"android/ui/view/button/overview/#xml","title":"xml","text":"<p>\u5728xml\u6587\u4ef6\u4e2d\u653e\u7f6e\u4e00\u4e2abutton\u3002 <pre><code> &lt;Button\n     android:id=\"@+id/btn\"\n     android:layout_height=\"wrap_content\"\n     android:layout_width=\"wrap_content\"\n     android:text=\"@string/self_destruct\" /&gt;\n</code></pre></p>"},{"location":"android/ui/view/button/overview/#_1","title":"\u70b9\u51fb\u4e8b\u4ef6","text":"<p>\u8981\u60f3\u76d1\u542c\u5230button\u7684\u70b9\u51fb\u4e8b\u4ef6\uff0c\u6211\u4eec\u5728Activity\u4e2d\u8fdb\u884c\u8bbe\u7f6e\u3002 <pre><code> public class MyActivity extends Activity {\n     protected void onCreate(Bundle savedInstanceState) {\n         super.onCreate(savedInstanceState);\n\n\n         setContentView(R.layout.content_layout_id);\n\n         final Button button = findViewById(R.id.button_id);\n         button.setOnClickListener(new View.OnClickListener() {\n             public void onClick(View v) {\n                 // \u8fd9\u91cc\u662f\u6309\u94ae\u70b9\u51fb\u4e8b\u4ef6\uff0c\u5728\u4e3b\u7ebf\u7a0b\u6267\u884c\n             }\n         });\n     }\n }\n</code></pre> \u4e0a\u9762\u6211\u4eec\u7528\u5230\u4e86<code>View.OnClickListener</code>\u3002button\u88ab\u70b9\u51fb\u540e\u4f1a\u6267\u884c<code>onClick</code>\u65b9\u6cd5\u3002 \u7cfb\u7edf\u4f1a\u5728App\u7684\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c<code>onClick</code>\u65b9\u6cd5\u3002\u6211\u4eec\u53ef\u4ee5\u5728\u8fd9\u91cc\u9762\u66f4\u65b0UI\u3002\u4f46\u4e0d\u8981\u505a\u592a\u8017\u65f6\u7684\u64cd\u4f5c\u3002</p> <p>\u6211\u4eec\u6ce8\u610f\u5230OnClickListener\u5176\u5b9e\u662fView\u4e2d\u7684\u4e00\u4e2a\u63a5\u53e3\u3002setOnClickListener\u4e5f\u662fView\u7684\u4e00\u4e2a\u65b9\u6cd5\u3002 \u6362\u53e5\u8bdd\u8bf4\uff0c\u5c31\u7b97\u6211\u4eec\u8fd9\u91cc\u7528\u7684\u4e0d\u662fbutton\uff0c\u4e5f\u53ef\u4ee5\u7528\u8fd9\u6837\u7684\u65b9\u5f0f\u6765\u76d1\u542c\u70b9\u51fb\u4e8b\u4ef6\u3002 \u5373<code>View.setOnClickListener(View.OnClickListener())</code>\u3002 \u4ee5\u540e\u4f1a\u9047\u5230TextView\uff0cImageView\u76d1\u542c\u70b9\u51fb\u4e8b\u4ef6\uff0c\u6216\u662f\u6574\u4e2aLayout\u6765\u76d1\u542c\u70b9\u51fb\u4e8b\u4ef6\u3002 \u8fd9\u91cc\u4f7f\u7528\u7684\u662f\u76d1\u542c\u5668\u6a21\u5f0f\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0cButton\u7ee7\u627f\u81eaTextView\u3002</p>"},{"location":"android/ui/view/button/overview/#translationz","title":"translationZ","text":"<p>Android 5.0 \u4e4b\u540e\uff0cButton \u9ed8\u8ba4\u6709Z\u8f74\u65b9\u5411\u7684\u4f4d\u79fb\u3002</p> <p>\u53ef\u4ee5\u7ed9\u5176\u5b83View\u8bbe\u7f6e<code>android:translationZ</code>\uff0c\u4e0eButton\u201c\u4e89\u4e2a\u9ad8\u4e0b\u201d</p> <pre><code>android:translationZ=\"3dp\"\n</code></pre> <p>\u66f4\u591a\u8bf7\u53c2\u8003\u5b98\u65b9\u6587\u6863LinearLayout</p>"},{"location":"android/ui/view/customView/auto-zoom-line-chart/","title":"Android \u81ea\u52a8\u7f29\u653e\u4e0a\u4e0b\u9650\u7684\u6298\u7ebf\u56fe","text":"<p>\u4e00\u6761\u6298\u7ebf\uff0c\u6839\u636e\u6700\u5927\u6700\u5c0f\u503c\u81ea\u52a8\u7f29\u653e\u4e0a\u4e0b\u9650\u3002</p> <ul> <li>\u7ee7\u627f<code>View</code></li> <li>\u6570\u636e\u4f7f\u7528<code>FloatBuffer</code>\u5b58\u50a8</li> <li>\u53ef\u6539\u53d8\u663e\u793a\u7a97\u53e3\u7684\u5927\u5c0f</li> <li>\u53ef\u6307\u5b9a\u5750\u6807\u8f74\uff0c\u6298\u7ebf\u548c\u5b57\u4f53\u989c\u8272</li> </ul> AutoLineChart\u5b8c\u6574\u4ee3\u7801<pre><code>import android.content.Context;\nimport android.graphics.Canvas;\nimport android.graphics.Color;\nimport android.graphics.Paint;\nimport android.graphics.Rect;\nimport android.util.AttributeSet;\nimport android.util.Log;\nimport android.util.TypedValue;\nimport android.view.View;\n\nimport java.nio.FloatBuffer;\n\npublic class AutoLineChart extends View {\n\n    private static final String TAG = \"rustApp\" + AutoLineChart.class.getSimpleName();\n\n    private float yMax = 1.6f;\n    private float yMin = -1.0f;\n\n    float yAxisZoomLimitMax = 1.6f;\n    float yAxisZoomLimitMin = -1.0f; // \u7f29\u5c0fy\u8f74\u7684\u6781\u9650\u503c\n\n    // Y\u8f74\u81ea\u52a8\u7f29\u653e\u65f6\u7684\u589e\u51cf\u8ddd\u79bb\n    float axisYPerStep = 0.1f;\n\n    // \u56fe\u8868\u7ebf\u6761\u5728view\u9876\u90e8\u7559\u51fa\u7684\u95f4\u8ddd\n    float viewYStart = 2;\n    float axisTextSize = 10;\n\n    private int onShowPointsCount = 500;  // \u5f53\u524d\u663e\u793a\u7684\u6570\u636e\u4e2a\u6570\n    int onShowMinPoints = 100;            // \u81f3\u5c11\u8981\u663e\u793a\u7684\u6570\u636e\u4e2a\u6570\n    private int maxPoint = 9000;          // \u6570\u636e\u5b58\u50a8\u6700\u5927\u4e2a\u6570\n\n    // \u5750\u6807\u8f74\u7ebf\u6761\u5bbd\u5ea6\n    float axisLineWid = 1f;\n\n    int dataLineWid = 4;\n\n    // \u6570\u636e\u7ebf\u989c\u8272\n    private int dataColor = Color.parseColor(\"#eaffe9\");\n\n    // \u56fe\u8868\u4e2d\u7684\u80cc\u666f\u7ebf\u6761\u989c\u8272\n    private int mainBgLineColor = Color.parseColor(\"#535353\");\n\n    // \u5750\u6807\u8f74\u989c\u8272\n    private int axisColor = Color.WHITE;\n\n    // \u5750\u6807\u503c\u5b57\u4f53\u989c\u8272\n    private int axisTextColor = Color.WHITE;\n\n    // \u80cc\u666f\u8272\n    private int viewBgColor = Color.parseColor(\"#222222\");\n\n    Rect rectText = new Rect();\n\n    private float xStep = 1.0f;\n    private float viewWidth;\n    private float viewHeight;\n    private float botLeftXOnView = 0; // \u56fe\u8868\u5de6\u4e0b\u70b9\u5728view\u4e2d\u7684x\u5750\u6807\n    private float botLeftYOnView = 0;\n    private float originYToBottom = 20; // \u56fe\u8868\u539f\u70b9\u8ddd\u79bbview\u5e95\u90e8\u7684\u8ddd\u79bb\n\n    private FloatBuffer dataBuffer;\n\n    private Paint bgPaint;\n    private Paint linePaint;\n\n    public AutoLineChart(Context context) {\n        this(context, null);\n    }\n\n    public AutoLineChart(Context context, AttributeSet attrs) {\n        this(context, attrs, 0);\n    }\n\n    public AutoLineChart(Context context, AttributeSet attrs, int defStyleAttr) {\n        super(context, attrs, defStyleAttr);\n        init(context);\n    }\n\n    public int getMaxPoint() {\n        return maxPoint;\n    }\n\n    public void setOnShowPointsCount(int onShowPointsCount) {\n        this.onShowPointsCount = onShowPointsCount;\n    }\n\n    public int getOnShowPointsCount() {\n        return onShowPointsCount;\n    }\n\n    public int getOnShowMinPoints() {\n        return onShowMinPoints;\n    }\n\n    public void addData(float data) {\n        dataBuffer.put(data);\n        if (dataBuffer.position() &gt; (dataBuffer.capacity() * 2 / 3)) {\n            float[] bufferArr = dataBuffer.array();\n            System.arraycopy(bufferArr, dataBuffer.position() - maxPoint, bufferArr, 0, maxPoint);\n            dataBuffer.position(maxPoint);\n//            Log.d(TAG, \"\u628a\u5f53\u524d\u6570\u636e\u79fb\u52a8\u5230buffer\u8d77\u59cb\u4f4d\u7f6e \" + dataBuffer);\n        }\n        invalidate();\n    }\n\n    private void init(Context context) {\n        dataBuffer = FloatBuffer.allocate(3 * maxPoint); // \u5206\u914d3\u500d\u7684\u7a7a\u95f4\n        bgPaint = new Paint(Paint.ANTI_ALIAS_FLAG);\n        linePaint = new Paint(Paint.ANTI_ALIAS_FLAG);\n        bgPaint.setStrokeWidth(axisLineWid);\n        bgPaint.setStyle(Paint.Style.STROKE);\n        bgPaint.setColor(mainBgLineColor);\n        linePaint.setStrokeWidth(dataLineWid);\n        linePaint.setStyle(Paint.Style.STROKE);\n        linePaint.setColor(dataColor);\n\n        botLeftXOnView = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, 32, context.getResources().getDisplayMetrics());\n        originYToBottom = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, 20, context.getResources().getDisplayMetrics());\n        viewYStart = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, 20, context.getResources().getDisplayMetrics());\n        axisLineWid = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, 1, context.getResources().getDisplayMetrics());\n        axisTextSize = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_SP, 10, context.getResources().getDisplayMetrics());\n    }\n\n    @Override\n    protected void onSizeChanged(int w, int h, int oldw, int oldh) {\n        super.onSizeChanged(w, h, oldw, oldh);\n        viewWidth = getWidth();\n        viewHeight = getHeight();\n        botLeftYOnView = viewHeight - originYToBottom;\n    }\n\n    @Override\n    protected void onDraw(Canvas canvas) {\n        super.onDraw(canvas);\n        canvas.drawColor(viewBgColor);\n        xStep = (viewWidth - botLeftXOnView) / (onShowPointsCount - 1);\n        float maxData = 0.1f;\n        float minData = 0;\n\n        int dataStartIndexInBuffer = 0; // \u6570\u636e\u5728buffer\u4e2d\u7684\u8d77\u59cb\u4e0b\u6807\n        if (dataBuffer.position() &gt; onShowPointsCount) {\n            dataStartIndexInBuffer = dataBuffer.position() - onShowPointsCount;\n        }\n        float[] bufferArr = dataBuffer.array();\n        for (int i = dataStartIndexInBuffer; i &lt; dataBuffer.position(); i++) {\n            if (bufferArr[i] &lt; minData) {\n                minData = bufferArr[i];\n            } else if (bufferArr[i] &gt; maxData) {\n                maxData = bufferArr[i];\n            }\n        }\n\n        zoomYAxis(maxData, minData);\n        drawBgLines(canvas);\n        drawWave(canvas, dataStartIndexInBuffer);\n    }\n\n    // \u7f29\u653eY\u8f74\n    private void zoomYAxis(float maxData, float minData) {\n        if (maxData &lt; yAxisZoomLimitMax) {\n            yMax = yAxisZoomLimitMax;\n        } else if (maxData &lt; yMax) {\n            while (maxData &lt; yMax) {\n                yMax -= axisYPerStep;\n            }\n            yMax += axisYPerStep;\n        } else if (maxData &gt; yMax) {\n            while (maxData &gt; yMax) {\n                yMax += axisYPerStep;\n            }\n        }\n\n        if (minData &gt; yAxisZoomLimitMin) {\n            yMin = yAxisZoomLimitMin;\n        } else if (minData &gt; yMin) {\n            while (minData &gt; yMin) {\n                yMin += axisYPerStep;\n            }\n            yMin -= axisYPerStep;\n        } else if (minData &lt; yMin) {\n            yMin -= axisYPerStep;\n        }\n    }\n\n    private void drawBgLines(Canvas canvas) {\n        // \u753b\u5750\u6807\u8f74\n        bgPaint.setStyle(Paint.Style.FILL);\n        bgPaint.setStrokeWidth(axisLineWid);\n        bgPaint.setTextSize(axisTextSize);\n        bgPaint.setTextAlign(Paint.Align.RIGHT);\n\n        for (float y = 0; y &lt;= yMax; y += 0.5) {\n            drawYAxis(canvas, y);\n        }\n        for (float y = 0; y &gt;= yMin; y -= 0.5) {\n            drawYAxis(canvas, y);\n        }\n        bgPaint.setColor(axisColor);\n        canvas.drawLine(botLeftXOnView, viewYStart / 2, botLeftXOnView, botLeftYOnView + viewYStart / 2, bgPaint);\n//        canvas.drawLine(botLeftXOnView, botLeftYOnView, viewWidth, botLeftYOnView, bgPaint); // x\u8f74\n    }\n\n    private void drawYAxis(Canvas canvas, float axisYValue) {\n        final float yDataRange = yMax - yMin;\n        final float yAxisRangeOnView = botLeftYOnView - viewYStart;\n        float aY = botLeftYOnView - (axisYValue - yMin) / yDataRange * yAxisRangeOnView;\n        bgPaint.setColor(axisColor);\n        canvas.drawLine(botLeftXOnView - 20, aY, botLeftXOnView, aY, bgPaint);\n\n        String axisText = String.valueOf(axisYValue);\n        bgPaint.getTextBounds(axisText, 0, axisText.length(), rectText); // \u83b7\u53d6\u6587\u672c\u7684\u5bbd\u9ad8\n        canvas.drawText(axisText, botLeftXOnView - rectText.width() / 2, aY + rectText.height() / 2, bgPaint);\n\n        bgPaint.setColor(mainBgLineColor);\n        canvas.drawLine(botLeftXOnView, aY, viewWidth, aY, bgPaint);\n    }\n\n    private void drawWave(Canvas canvas, int dataStartIndexInBuffer) {\n        final float yDataRange = yMax - yMin;\n        final float yAxisRangeOnView = botLeftYOnView - viewYStart;\n        final float yDataStep = yAxisRangeOnView / yDataRange;\n\n        float[] dataArr = dataBuffer.array();\n        for (int i = dataStartIndexInBuffer; i &lt; dataBuffer.position() - 1; i++) {\n            canvas.drawLine(botLeftXOnView + (i - dataStartIndexInBuffer) * xStep, getYL(dataArr[i], yDataStep),\n                    botLeftXOnView + (i - dataStartIndexInBuffer + 1) * xStep, getYL(dataArr[i + 1], yDataStep),\n                    linePaint);\n        }\n    }\n\n    private float getYL(final float yData, float yDataStep) {\n        return botLeftYOnView - (yData - yMin) * yDataStep;\n    }\n}\n</code></pre>"},{"location":"android/ui/view/customView/canvas-clip-path/","title":"\u88c1\u526a\u753b\u5e03 canvas clip path","text":"<p>\u672c\u6587\u8bb0\u5f55\u5982\u4f55\u4f7f\u7528<code>canvas.clipPath(path)</code>\u65b9\u6cd5\u3002</p> <p><code>clipPath</code>\u65b9\u6cd5\u76f8\u5f53\u4e8e\u6309\u7ed9\u5b9a\u7684\u8def\u5f84\u88c1\u526a\u753b\u5e03\u3002 \u6839\u636e\u8fd9\u4e2a\u7528\u9014\uff0c\u6211\u4eec\u53ef\u4ee5\u505a\u51fa\u5706\u89d2\u56fe\u7247\u7684\u6548\u679c\u3002</p>"},{"location":"android/ui/view/customView/canvas-clip-path/#_1","title":"\u5706\u89d2\u56fe\u7247\u793a\u4f8b","text":"<p>\u5706\u89d2\u56fe\u7247\u662f\u4e00\u79cd\u5e38\u89c1\u7684\u8bbe\u8ba1\u3002Android\u5b98\u65b9\u5e93\u4e2d\u5e76\u6ca1\u6709\u76f4\u63a5\u663e\u793a\u5706\u89d2\u56fe\u7247\u7684\u65b9\u6cd5\u3002 \u5982\u679c\u662f\u7eaf\u8272\uff0c\u6e10\u53d8\u8272\u7684\u80cc\u666f\uff0c\u6211\u4eec\u53ef\u4ee5\u7528shape\u7684corners\u6765\u5b9e\u73b0\u5706\u89d2\u3002 \u8fd9\u91cc\u662f\u5229\u7528<code>clipPath</code>\u5728<code>super.onDraw(canvas)</code>\u4e4b\u524d\u5c06\u753b\u5e03\u88c1\u51fa\u5706\u89d2\u3002\u9700\u8981\u4f20\u5165\u4e00\u4e2aPath\u6765\u6307\u5b9a\u88c1\u526a\u8303\u56f4\u3002</p> <p>\u65b0\u5efa\u4e00\u4e2a<code>RoundImageView</code>\u7c7b\uff0c\u7ee7\u627f\u81ea<code>AppCompatImageView</code>\u3002</p> <pre><code>import android.content.Context;\nimport android.content.res.TypedArray;\nimport android.graphics.Canvas;\nimport android.graphics.Path;\nimport android.util.AttributeSet;\n\nimport androidx.appcompat.widget.AppCompatImageView;\n\npublic class RoundImageView extends AppCompatImageView {\n    private float vw, vh;\n    private Path path = new Path();\n\n    private float topLeftR;\n    private float topRightR;\n    private float botLeftR;\n    private float botRightR;\n\n    public RoundImageView(Context context) {\n        this(context, null);\n    }\n\n    public RoundImageView(Context context, AttributeSet attrs) {\n        this(context, attrs, 0);\n    }\n\n    public RoundImageView(Context context, AttributeSet attrs, int defStyleAttr) {\n        super(context, attrs, defStyleAttr);\n        TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.RoundImageView);\n        topLeftR = typedArray.getDimensionPixelSize(R.styleable.RoundImageView_topLeftR, 0);\n        topRightR = typedArray.getDimensionPixelSize(R.styleable.RoundImageView_topRightR, 0);\n        botLeftR = typedArray.getDimensionPixelSize(R.styleable.RoundImageView_botLeftR, 0);\n        botRightR = typedArray.getDimensionPixelSize(R.styleable.RoundImageView_botRightR, 0);\n        typedArray.recycle();\n    }\n\n    @Override\n    protected void onLayout(boolean changed, int left, int top, int right, int bottom) {\n        super.onLayout(changed, left, top, right, bottom);\n        vw = getWidth();\n        vh = getHeight();\n    }\n\n    @Override\n    protected void onDraw(Canvas canvas) {\n        path.reset();\n        if (vw &gt; topLeftR &amp;&amp; vh &gt; topRightR) {\n            path.moveTo(topLeftR, 0);\n            path.lineTo(vw - topRightR, 0);\n            path.quadTo(vw, 0, vw, topRightR);\n            path.lineTo(vw, vh - botRightR);\n            path.quadTo(vw, vh, vw - botRightR, vh);\n            path.lineTo(botLeftR, vh);\n            path.quadTo(0, vh, 0, vh - botLeftR);\n            path.lineTo(0, topLeftR);\n            path.quadTo(0, 0, topLeftR, 0);\n            path.close();\n            canvas.clipPath(path);\n        }\n        super.onDraw(canvas);\n    }\n}\n</code></pre> <p>\u91cc\u9762\u4f7f\u7528\u4e86<code>TypedArray</code>\uff0c\u9700\u8981\u65b0\u589e<code>declare-styleable</code>\u8d44\u6e90\u3002 <pre><code>&lt;resources&gt;\n    &lt;declare-styleable name=\"RoundImageView\"&gt;\n        &lt;attr name=\"topLeftR\" format=\"dimension\" /&gt;\n        &lt;attr name=\"topRightR\" format=\"dimension\" /&gt;\n        &lt;attr name=\"botLeftR\" format=\"dimension\" /&gt;\n        &lt;attr name=\"botRightR\" format=\"dimension\" /&gt;\n    &lt;/declare-styleable&gt;\n&lt;/resources&gt;\n</code></pre></p> <p>\u4f7f\u7528\u8fd9\u4e2a\u7c7b\u3002\u5728layout\u4e2d\u76f4\u63a5\u4f7f\u7528\u3002\u5206\u522b\u5b9a\u4e494\u4e2a\u5706\u89d2\u534a\u5f84\u53c2\u6570\u3002\u7ed9<code>src</code>\u8bbe\u7f6e\u7eaf\u8272\u3002 \u5982\u679c\u7ed9\u5b9a\u56fe\u7247\uff0c\u56fe\u7247\u5185\u5bb9\u63a5\u89e6\u5230view\u7aef\u70b9\u65f6\uff0c\u624d\u4f1a\u770b\u5f97\u51fa\u6709\u5706\u89d2\u6548\u679c\u3002 <pre><code>&lt;com.rustfisher.tutorial2020.customview.view.RoundImageView\n    style=\"@style/RoundIvCube\"\n    app:botLeftR=\"8dp\"\n    app:botRightR=\"8dp\"\n    app:topLeftR=\"8dp\"\n    app:topRightR=\"8dp\" /&gt;\n\n&lt;com.rustfisher.tutorial2020.customview.view.RoundImageView\n    style=\"@style/RoundIvCube\"\n    app:botLeftR=\"25dp\"\n    app:botRightR=\"25dp\"\n    app:topLeftR=\"25dp\"\n    app:topRightR=\"25dp\" /&gt;\n\n&lt;com.rustfisher.tutorial2020.customview.view.RoundImageView\n    style=\"@style/RoundIvCube\"\n    app:botLeftR=\"16dp\" /&gt;\n\n&lt;com.rustfisher.tutorial2020.customview.view.RoundImageView\n    style=\"@style/RoundIvCube\"\n    app:topLeftR=\"16dp\" /&gt;\n\n&lt;com.rustfisher.tutorial2020.customview.view.RoundImageView\n    style=\"@style/RoundIvCube\"\n    app:botRightR=\"16dp\"\n    app:topLeftR=\"16dp\" /&gt;\n</code></pre></p> <p>style\u5b9a\u4e49 <pre><code>    &lt;style name=\"RoundIvCube\"&gt;\n        &lt;item name=\"android:layout_width\"&gt;50dp&lt;/item&gt;\n        &lt;item name=\"android:layout_height\"&gt;50dp&lt;/item&gt;\n        &lt;item name=\"android:src\"&gt;#303F9F&lt;/item&gt;\n        &lt;item name=\"android:layout_margin\"&gt;8dp&lt;/item&gt;\n    &lt;/style&gt;\n</code></pre></p> <p>\u8fd0\u884c\u7ed3\u679c</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u5404\u4e2a\u56fe\u5f62\u7684\u5706\u89d2\u3002\u4f46\u662f\u6211\u4eec\u4e5f\u80fd\u53d1\u73b0\u6709\u952f\u9f7f\u3002\u8fd9\u4e2a\u88c1\u526a\u65b9\u6cd5\u6ca1\u80fd\u505a\u5230\u5149\u6ed1\u5706\u6da6\u7684\u5706\u89d2\u3002</p>"},{"location":"android/ui/view/customView/draw-text/","title":"\u6587\u5b57\u4f4d\u7f6e\u4fe1\u606f","text":"<p>\u51c6\u5907\u57fa\u7840\u7c7bBaseView\uff0c\u7ee7\u627fView\u7c7b\u3002 <pre><code>public class BaseView extends View {\n    static final int LINE_OFFSET = 60;\n\n    protected Paint notePaint = new Paint();\n    protected Paint textPaint = new Paint(Paint.ANTI_ALIAS_FLAG);\n    protected Rect textRect = new Rect();\n\n    public BaseView(Context context) {\n        this(context, null);\n    }\n\n    public BaseView(Context context, AttributeSet attrs) {\n        this(context, attrs, 0);\n    }\n\n    public BaseView(Context context, AttributeSet attrs, int defStyleAttr) {\n        super(context, attrs, defStyleAttr);\n    }\n}\n</code></pre> \u5728BaseView\u91cc\u51c6\u5907\u4e862\u4e2a\u753b\u7b14\u3002</p> <p>\u7ed8\u5236\u6587\u5b57\u7684\u65b9\u6cd5<code>canvas.drawText</code>\uff0c\u9700\u8981\u6307\u5b9a\u5b57\u7b26\u4e32\uff0c\u7ed8\u5236\u8d77\u59cb\u5750\u6807\uff0c\u753b\u7b14paint\u3002 <pre><code>canvas.drawText(text, x, y, textPaint);\n</code></pre></p> <p>\u8d77\u59cb\u5750\u6807\u7684y\u503c\u6240\u5728\u6a2a\u7ebf\u5728\u540e\u9762\u4e5f\u79f0\u4e3a baseline \u3002</p>"},{"location":"android/ui/view/customView/draw-text/#_2","title":"\u83b7\u53d6\u6587\u5b57\u8fb9\u754c","text":"<p>\u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u5230\u6587\u5b57\u7684\u90e8\u5206\u7b14\u753b\u662f\u53ef\u4ee5\u8d85\u51fa\u8fb9\u7ebf\u7684\u3002\u6bd4\u5982\u5f00\u5934\u7684<code>j</code>\u548c\u7ed3\u5c3e\u7684<code>r</code>\u5b57\u7b26\u3002</p> <p>\u4f7f\u7528<code>Paint.getTextBounds</code>\u65b9\u6cd5\u83b7\u53d6\u6587\u5b57\u7684\u8fb9\u754c\u3002 <pre><code>textPaint.getTextBounds(onShowText, 0, onShowText.length(), textRect); // \u83b7\u53d6text\u8fb9\u754c\n</code></pre></p> <p>\u7ed8\u5236\u4e0a\u56fe\u7684\u90e8\u5206\u4ee3\u7801 <pre><code>private void drawBounds(Canvas canvas, float tx, float ty, String onShowText) {\n    canvas.drawText(onShowText, tx, ty, textPaint); // \u5199\u5b57\n    textPaint.getTextBounds(onShowText, 0, onShowText.length(), textRect); // \u83b7\u53d6text\u8fb9\u754c\n\n    notePaint.setStrokeWidth(3);\n    notePaint.setColor(Color.parseColor(\"#EF6C00\"));\n\n    // \u5de6\u8fb9\u7ebf\n    canvas.drawLine(tx, ty - textRect.height() - LINE_OFFSET, tx, ty + LINE_OFFSET, notePaint);\n\n    // \u53f3\u8fb9\u7ebf\n    canvas.drawLine(tx + textRect.width(), ty - textRect.height() - LINE_OFFSET, tx + textRect.width(), ty + LINE_OFFSET, notePaint);\n\n    notePaint.setColor(Color.parseColor(\"#FF0277BD\"));\n    // \u4e0a\u8fb9\u7ebf\n    canvas.drawLine(tx - LINE_OFFSET, ty - textRect.height(), tx + textRect.width() + LINE_OFFSET, ty - textRect.height(), notePaint);\n\n    notePaint.setColor(Color.parseColor(\"#00695C\"));\n    // y - baseline\n    canvas.drawLine(tx - LINE_OFFSET, ty, tx + textRect.width() + LINE_OFFSET, ty, notePaint);\n}\n</code></pre></p>"},{"location":"android/ui/view/customView/draw-text/#text","title":"\u83b7\u53d6text\u5c3a\u5bf8\u4fe1\u606f","text":"<p>\u9700\u8981\u4f7f\u7528<code>Paint.FontMetrics</code>\u7c7b\u3002\u5b83\u67095\u4e2a\u5c5e\u6027</p> \u5c5e\u6027 \u4ecb\u7ecd top \u4ecebaseline\u5230\u6700\u9ad8\u7684\u6587\u5b57\u9876\u90e8\u7684\u6700\u5927\u8ddd\u79bb ascent \u5355\u884c\u8ddd\uff08singled spaced\uff09\u65f6\uff0cbaseline\u4e0a\u65b9\u7a7a\u95f4\u7684\u63a8\u8350\u8ddd\u79bb descent \u5355\u884c\u8ddd\u65f6\uff0cbaseline\u4e0b\u65b9\u7a7a\u95f4\u7684\u63a8\u8350\u8ddd\u79bb bottom baseline\u5230\u6700\u4e0b\u65b9\u5b57\u7b26\u7684\u6700\u5927\u8ddd\u79bb leading \u591a\u884c\u6587\u5b57\u4e4b\u95f4\u63a8\u8350\u4f7f\u7528\u7684\u989d\u5916\u7a7a\u95f4 <p>\u4f7f\u7528<code>Paint.getFontMetrics()</code>\u65b9\u6cd5\u83b7\u53d6<code>Paint.FontMetrics</code>\u3002 <pre><code>Paint.FontMetrics fm = textPaint.getFontMetrics();\n</code></pre></p> <p>\u6ce8\u610f\uff0c<code>top</code>\u548c<code>ascent</code>\u662f\u8d1f\u503c\u3002</p> <p></p> <p>\u7ed8\u5236\u4e0a\u56fe\u7684\u65b9\u6cd5 <pre><code>private void drawFontMetrics(Canvas canvas, float x, float y, String text) {\n    canvas.drawText(text, x, y, textPaint);\n    textPaint.getTextBounds(text, 0, text.length(), textRect);\n    Paint.FontMetrics fm = textPaint.getFontMetrics();\n\n    notePaint.setStrokeWidth(1);\n    notePaint.setColor(Color.BLACK);\n    canvas.drawText(String.format(Locale.CHINA, \"top:%.2f, bottom:%.2f\", fm.top, fm.bottom), x, y + notePaint.getTextSize() * 2.5f, notePaint);\n    canvas.drawText(String.format(Locale.CHINA, \"ascent:%.2f, descent:%.2f, leading:%.2f\", fm.ascent, fm.descent, fm.leading), x, y + notePaint.getTextSize() * 4f, notePaint);\n\n    notePaint.setColor(Color.parseColor(\"#FFD84315\"));\n\n    // fm top\u7ebf\n    canvas.drawLine(x - L_BIAS, y + fm.top, x + textRect.width() + L_BIAS, y + fm.top, notePaint);\n\n    notePaint.setColor(Color.parseColor(\"#FF00695C\"));\n\n    // fm bottom\u7ebf\n    canvas.drawLine(x - L_BIAS, y + fm.bottom, x + textRect.width() + L_BIAS, y + fm.bottom, notePaint);\n\n    notePaint.setColor(Color.parseColor(\"#4527A0\"));\n\n    // fm ascent\u7ebf\n    canvas.drawLine(x - L_BIAS, y + fm.ascent, x + textRect.width() + L_BIAS, y + fm.ascent, notePaint);\n\n    notePaint.setColor(Color.parseColor(\"#0E0822\"));\n\n    // fm descent\u7ebf\n    canvas.drawLine(x - L_BIAS, y + fm.descent, x + textRect.width() + L_BIAS, y + fm.descent, notePaint);\n}\n</code></pre></p>"},{"location":"android/ui/view/customView/draw-text/#_3","title":"\u5bf9\u9f50\u6587\u5b57\u4e2d\u95f4","text":"<p>\u6709\u4e86\u4e0a\u9762\u7684\u57fa\u7840\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u5feb\u77e5\u9053\u5982\u4f55\u5b9e\u73b0\u6587\u5b57\u201c\u5c45\u4e2d\u5bf9\u9f50\u201d\u3002\u5c06\u6587\u5b57\u7684\u6c34\u5e73\u4e2d\u5fc3\u7ebf\u6216\u7ad6\u76f4\u4e2d\u5fc3\u7ebf\u5bf9\u9f50\u5230\u67d0\u4e2a\u70b9\u3002</p> <p>\u4f8b\u5982\u7ed8\u5236\u4e00\u4e2a\u5e73\u9762\u5750\u6807\u7cfb</p> <p></p> <p>\u7ed8\u5236\u51fa2\u4e2a\u5750\u6807\u8f74\uff0c\u7136\u540e\u7ed8\u5236\u4e0a\u523b\u5ea6\uff0c\u5e76\u5199\u4e0a\u6570\u503c\u3002 \u6570\u503c\u6587\u5b57\u5bf9\u5e94\u5230\u523b\u5ea6\u76f8\u5e94\u7684\u4f4d\u7f6e\u4e0a\u3002\u6211\u4eec\u4e3b\u8981\u4f7f\u7528<code>Paint.getTextBounds</code>\u83b7\u53d6\u5230\u6587\u5b57\u7684\u5c3a\u5bf8\u4fe1\u606f\uff0c\u518d\u8ba1\u7b97\u51fa\u5408\u9002\u7684\u4f4d\u7f6e\u3002</p> <pre><code>private void drawChart(Canvas canvas) {\n    final float x0 = 100;\n    final float y0 = 300; // \u539f\u70b9\u5728\u753b\u5e03\u4e0a\u7684\u5750\u6807\n    final float halfLine = 5; // \u523b\u5ea6\u957f\u5ea6\u7684\u4e00\u534a\n\n    textPaint.setColor(Color.BLACK);\n    textPaint.setTextSize(20);\n    notePaint.setStrokeWidth(2);\n    canvas.drawLine(x0, y0, x0 + 500, y0, notePaint); // \u7ed8\u5236\u6a2a\u8f74\n    canvas.drawLine(x0, y0, x0, y0 - 290, notePaint); // \u7ed8\u5236\u7eb5\u8f74\n\n    // \u7ed8\u5236\u6a2a\u8f74\u523b\u5ea6\u548c\u6570\u5b57\n    for (int i = 1; i &lt;= 4; i++) {\n        int step = i * 100;\n        String n = String.valueOf(step);\n        float x = x0 + step;\n        canvas.drawLine(x, y0 - halfLine, x, y0 + halfLine, notePaint); // \u523b\u5ea6\n\n        // \u6587\u5b57\u5bf9\u9f50\n        textPaint.getTextBounds(n, 0, n.length(), textRect);\n        canvas.drawText(n, x - textRect.width() / 2f, y0 + textRect.height() + halfLine, textPaint);\n    }\n\n\n    // \u7ed8\u5236\u7eb5\u8f74\u523b\u5ea6\u548c\u6570\u5b57\n    for (int i = 1; i &lt;= 2; i++) {\n        int step = i * 100;\n        String n = String.valueOf(step);\n        float y = y0 - step;\n        canvas.drawLine(x0 - halfLine, y, x0 + halfLine, y, notePaint); // \u523b\u5ea6\n\n        // \u6587\u5b57\u5bf9\u9f50\n        textPaint.getTextBounds(n, 0, n.length(), textRect);\n        canvas.drawText(n, x0 - halfLine * 2 - textRect.width(), y + textRect.height() / 2f, textPaint);\n    }\n\n    // \u7ed8\u5236\u539f\u70b9 0\n    String origin = \"0\";\n    textPaint.getTextBounds(origin, 0, origin.length(), textRect);\n    canvas.drawText(origin, x0 - textRect.width(), y0 + textRect.height(), textPaint);\n}\n</code></pre>"},{"location":"android/ui/view/customView/wave-view/","title":"Android \u67f1\u72b6\u6ce2\u5f62\u56fe wave view","text":"\u66f4\u65b0\u65e5\u671f 2022-8-15 <ul> <li>2022-8-15 \u521b\u5efa\u6587\u6863</li> </ul>"},{"location":"android/ui/view/customView/wave-view/#_1","title":"\u524d\u8a00","text":"<p>\u67f1\u72b6\u6ce2\u5f62\u56fe\u662f\u4e00\u79cd\u5e38\u89c1\u7684\u56fe\u5f62\u3002\u4e00\u4e2a\u4e2a\u67f1\u5b50\u6309\u987a\u5e8f\u6392\u5217\uff0c\u6784\u6210\u4e00\u4e2a\u6ce2\u5f62\u56fe\u3002</p> <p>\u67f1\u5b50\u7684\u9ad8\u5ea6\u7531\u8f93\u5165\u6570\u636e\u51b3\u5b9a\u3002\u5982\u679c\u8f93\u5165\u7684\u662f\u97f3\u9891\u7684\u97f3\u91cf\uff0c\u5219\u53ef\u5f97\u5230\u4e00\u4e2a\u58f0\u6ce2\u56fe\u3002</p> <p></p> <p>\u5728\u4e00\u4e9b\u97f3\u9891\u8f6f\u4ef6\u4e2d\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5de6\u53f3\u62d6\u52a8\u58f0\u6ce2\uff0c\u6765\u6539\u53d8\u97f3\u9891\u7684\u64ad\u653e\u8fdb\u5ea6</p> <p>\u672c\u6587\u4e3e\u4f8b\u7684\u81ea\u5b9aView\uff0c\u5b9e\u73b0\u5982\u4e0b\u529f\u80fd\uff1a</p> <ul> <li>\u4ee5\u67f1\u72b6\u5f62\u5f0f\u5c55\u793a\u6570\u636e\u7684\u5927\u5c0f</li> <li>\u6807\u660e\u56fe\u5f62\u5f53\u524d\u6700\u4e2d\u95f4\u7684\u6570\u636e</li> <li>\u53ef\u4ee5\u6a2a\u5411\u62d6\u52a8\u8fdb\u5ea6\uff0c\u8fdb\u5ea6\u5c31\u662f\u8ba9\u67d0\u4e2a\u7279\u5b9a\u7684\u6570\u636e\u5c45\u4e2d\u5c55\u793a</li> <li>\u53ef\u4ee5\u6539\u53d8\u5de6\u53f3\u4e24\u8fb9\u7684\u67f1\u5b50\u989c\u8272</li> <li>\u53ef\u4ee5\u8c03\u6574\u67f1\u5b50\u7684\u5bbd\u5ea6</li> <li>\u62d6\u52a8\u5b8c\u6bd5\u540e\u76d1\u542c\u5f53\u524d\u8fdb\u5ea6</li> </ul>"},{"location":"android/ui/view/customView/wave-view/#_2","title":"\u5b9e\u73b0","text":"<p>\u9996\u5148\u521b\u5efa\u7c7bSoundWaveView\u7ee7\u627f\u81eaView</p> <p>\u6211\u4eec\u53ef\u4ee5\u5148\u8bb0\u5f55\u7ed9\u5b9a\u7684\u5bbd\u9ad8\uff0c\u65b9\u4fbf\u540e\u9762\u627e\u5230View\u7684\u4e2d\u95f4\u70b9 <pre><code>private int viewWid = 1000;     // px\nprivate int viewHeight = 100;   // px\n\n@Override\nprotected void onSizeChanged(int w, int h, int oldw, int oldh) {\n    super.onSizeChanged(w, h, oldw, oldh);\n    viewWid = w;\n    viewHeight = h;\n    // ..\n}\n</code></pre></p>"},{"location":"android/ui/view/customView/wave-view/#_3","title":"\u57fa\u672c\u5c5e\u6027","text":"<p>\u4f8b\u5982\u67f1\u5b50\u7684\u989c\u8272\uff0c\u5bbd\u5ea6\u3002\u53ef\u4ee5\u8bbe\u7f6e\u4e2a\u5c5e\u6027\u6765\u8bb0\u5f55\uff0c\u5e76\u5f00\u653e\u51fa\u53bb\u53ef\u7531\u5916\u90e8\u6765\u8bbe\u7f6e\u3002</p> \u90e8\u5206\u57fa\u672c\u5c5e\u6027<pre><code>private float barWidDp = 1.5f;\nprivate float barWidPx = 3f;\nprivate float barGapPx = barWidPx / 2;\nprivate int barCount = 1;       // \u5f53\u524d\u5bbd\u5ea6\u80fd\u7ed8\u5236\u591a\u5c11\u4e2a\u67f1\u5b50\n\nprivate final Paint paint = new Paint();\nprivate int leftColor = Color.GREEN;\nprivate int rightColor = Color.LTGRAY;\nprivate int middleLineColor = Color.parseColor(\"#55000000\");\n</code></pre>"},{"location":"android/ui/view/customView/wave-view/#_4","title":"\u8bbe\u8ba1\u76d1\u542c\u5668","text":"<p>\u62d6\u52a8\u5b8c\u6bd5\u540e\uff0c\u53ef\u4ee5\u5c06\u5f53\u524d\u8fdb\u5ea6\u901a\u77e5\u51fa\u53bb\u3002\u4e5f\u53ef\u4ee5\u76f4\u63a5\u628a\u89e6\u6478\u4e8b\u4ef6\u4f20\u51fa\u53bb\u3002</p> \u76d1\u542c\u5668\u76f8\u5173<pre><code>public interface OnEvent {\n    void onMoveEnd(); // \u505c\u6b62\u62d6\u52a8\u4e86\n\n    void onDragTouchEvent(MotionEvent event);\n}\n\nprivate OnEvent onEventListener;\n\nprivate void tellOnMoveEnd() {\n    if (onEventListener != null) {\n        onEventListener.onMoveEnd();\n    }\n}\n</code></pre>"},{"location":"android/ui/view/customView/wave-view/#_5","title":"\u7ed8\u5236\u56fe\u5f62","text":"<p>\u5728<code>onDraw</code>\u65b9\u6cd5\u4e2d\u6839\u636e\u6570\u636e\u7ed8\u5236\u56fe\u5f62</p> <p>\u672c\u4f8b\u6ca1\u6709\u8bbe\u8ba1\u80cc\u666f\uff0c\u76f4\u63a5\u7ed8\u5236\u6570\u636e\u3002</p> <p>\u56fe\u5f62\u9700\u6c42\u4e4b\u4e00\u662f\u8981\u6c42\u67d0\u4e2a\u6570\u636e\u80fd\u5c45\u4e2d\u663e\u793a\uff0c\u6211\u4eec\u7528<code>midIndex</code>\u6765\u6807\u8bb0\u8fd9\u4e2a\u6570\u636e\u7684\u4e0b\u6807\u3002</p> <p>\u6bd4\u8f83\u7b80\u5355\u7c97\u66b4\u7684\u5b9e\u73b0\u65b9\u6cd5\uff0c\u904d\u5386\u6574\u4e2a\u6570\u636e\u5217\u8868\uff0c\u8ba1\u7b97\u51fa\u6bcf\u4e2a\u6570\u636e\u7684x\u5750\u6807\u3002\u8d85\u51fa\u8303\u56f4\u7684\u4e0d\u7ed8\u5236\uff0c\u8303\u56f4\u5185\u7684\u9010\u4e00\u7ed8\u5236\u3002 <pre><code>@Override\nprotected void onDraw(Canvas canvas) {\n    super.onDraw(canvas);\n    if (dataList == null || dataList.isEmpty()) {\n        // draw nothing\n        drawMiddleLine(canvas);\n        return;\n    }\n    float x0 = viewWid / 2.0f;\n\n    if (midIndex &gt; 0) {\n        x0 = x0 - (barGapPx + barWidPx) * midIndex; // \u53ef\u80fd\u662f\u8d1f\u6570\n    }\n    for (int i = 0; i &lt; dataList.size(); i++) {\n        float d = dataList.get(i);\n        float x = x0 + (barWidPx + barGapPx) * i;\n        if (x &lt; 0) {\n            continue;\n        }\n        if (x &gt; viewWid) {\n            break;\n        }\n        if (i &lt;= midIndex) {\n            paint.setColor(leftColor);\n        } else {\n            paint.setColor(rightColor);\n        }\n        paint.setStrokeWidth(barWidPx);\n        float bh = (d / showMaxData) * viewHeight;\n        bh = Math.max(bh, 4); // \u6700\u5c0f\u4e5f\u8981\u4e00\u70b9\u9ad8\u5ea6 (1)\n        float bhGap = (viewHeight - bh) / 2f;\n        canvas.drawLine(x, bhGap, x, viewHeight - bhGap, paint);\n    }\n\n    drawMiddleLine(canvas);\n}\n\nprivate void drawMiddleLine(Canvas canvas) {\n    paint.setColor(middleLineColor);\n    canvas.drawLine(viewWid / 2f, 0, viewWid / 2f, viewHeight, paint);\n}\n</code></pre></p> <ol> <li>\u5982\u679c\u6570\u636e\u592a\u5c0f\uff0c\u4e3a\u4e86\u66f4\u7f8e\u89c2\uff0c\u4e5f\u8981\u663e\u793a\u4e00\u70b9\u4e1c\u897f</li> </ol>"},{"location":"android/ui/view/customView/wave-view/#_6","title":"\u5de6\u53f3\u62d6\u52a8","text":"<p>\u672c\u4f8b\u7ed9\u51fa\u7684\u601d\u8def\u662f\u5728SoundWaveView\u4e2d\u76f4\u63a5\u83b7\u53d6\u89e6\u6478\u4e8b\u4ef6\u5e76\u8fdb\u884c\u5904\u7406\u3002</p> <p>\u7b80\u5355\u533a\u5206\u4e00\u4e0b\u6a21\u5f0f\uff0c\u5206\u4e3a\u7eaf\u5c55\u793a\u548c\u53ef\u62d6\u52a8\u6a21\u5f0f <pre><code>/**\n* \u5355\u7eaf\u64ad\u653e \u5c55\u793a \u65e0\u4ea4\u4e92\n*/\npublic static final int MODE_PLAY = 1;\n\n/**\n* \u5141\u8bb8\u5de6\u53f3\u62d6\u52a8\n*/\npublic static final int MODE_CAN_DRAG = 2;\n</code></pre></p> <p>\u590d\u5199<code>onTouchEvent</code>\u65b9\u6cd5\uff0c\u5982\u679c\u662f<code>MODE_CAN_DRAG</code>\u6a21\u5f0f\uff0c\u5219\u62e6\u622a\u89e6\u6478\u4e8b\u4ef6\u3002\u5224\u65ad\u62d6\u52a8\u7684\u6a2a\u5411\uff08x\uff09\u8ddd\u79bb\u3002 <pre><code>@Override\npublic boolean onTouchEvent(MotionEvent event) {\n    if (mode == MODE_CAN_DRAG) {\n        switch (event.getAction()) {\n            case MotionEvent.ACTION_MOVE:\n                float dx = (downX - event.getX()); // \u4e0d\u8981\u90a3\u4e48\u7075\u654f\n                float movePercent = dx / viewWid;\n                int dIndex = (int) (movePercent * barCount);\n                int targetMidIndex = downOldMidIndex + dIndex;\n                targetMidIndex = Math.max(0, targetMidIndex);\n                targetMidIndex = Math.min(targetMidIndex, dataList.size() - 1);\n                setMidIndex(targetMidIndex);\n                Log.d(TAG, \"onTouchEvent-MOVE; dx: \" + dx + \", dIndex: \" + dIndex + \"; targetMidIndex: \" + targetMidIndex);\n                break;\n            case MotionEvent.ACTION_DOWN:\n                downX = event.getX();\n                downOldMidIndex = midIndex;\n                break;\n            case MotionEvent.ACTION_CANCEL:\n            case MotionEvent.ACTION_UP:\n                downOldMidIndex = midIndex;\n                tellOnMoveEnd();\n                break;\n        }\n        if (onEventListener != null) {\n            onEventListener.onDragTouchEvent(event);\n        }\n        return true;\n    }\n    return super.onTouchEvent(event);\n}\n</code></pre></p>"},{"location":"android/ui/view/customView/wave-view/#_7","title":"\u5b8c\u6574\u4ee3\u7801","text":"<p>\u6587\u4ef6SoundWaveView.java\uff0c\u8fd9\u4e2aview\u4e3b\u8981\u76ee\u7684\u662f\u5c55\u73b0\u58f0\u6ce2\uff0c\u53d6\u540d\u4e3a\u300cSoundWave\u300d</p> SoundWaveView\u5b8c\u6574\u4ee3\u7801<pre><code>import android.content.Context;\nimport android.graphics.Canvas;\nimport android.graphics.Color;\nimport android.graphics.Paint;\nimport android.util.AttributeSet;\nimport android.util.Log;\nimport android.view.MotionEvent;\nimport android.view.View;\n\nimport androidx.annotation.Nullable;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\n/**\n * @author an.rustfisher.com\n */\npublic class SoundWaveView extends View {\n    private static final String TAG = \"rustAppSoundWaveView\";\n\n    /**\n     * \u5355\u7eaf\u64ad\u653e \u5c55\u793a \u65e0\u4ea4\u4e92\n     */\n    public static final int MODE_PLAY = 1;\n\n    /**\n     * \u5141\u8bb8\u5de6\u53f3\u62d6\u52a8\n     */\n    public static final int MODE_CAN_DRAG = 2;\n\n    private int mode = MODE_PLAY; // 1 \u64ad\u653e\n    private List&lt;Float&gt; dataList = new ArrayList&lt;&gt;(100);\n    private float showMaxData = 40f; // \u80fd\u663e\u793a\u7684\u6700\u5927\u6570\u636e\n    private int midIndex = 0;   // \u5728\u4e2d\u95f4\u663e\u793a\u7684\u6570\u636e\u7684\u4e0b\u6807\n    private float barWidDp = 1.5f;\n    private float barWidPx = 3f;\n    private float barGapPx = barWidPx / 2;\n    private int barCount = 1;       // \u5f53\u524d\u5bbd\u5ea6\u80fd\u7ed8\u5236\u591a\u5c11\u4e2a\u67f1\u5b50\n    private int viewWid = 1000;     // px\n    private int viewHeight = 100;   // px\n\n    private final Paint paint = new Paint();\n    private int leftColor = Color.GREEN;\n    private int rightColor = Color.LTGRAY;\n    private int middleLineColor = Color.parseColor(\"#55000000\");\n\n    private float downX = 0; // getX\n    private int downOldMidIndex = 0;\n\n    public interface OnEvent {\n        void onMoveEnd(); // \u505c\u6b62\u62d6\u52a8\u4e86\n\n        void onDragTouchEvent(MotionEvent event);\n    }\n\n    private OnEvent onEventListener;\n\n    public SoundWaveView(Context context) {\n        this(context, null);\n    }\n\n    public SoundWaveView(Context context, @Nullable AttributeSet attrs) {\n        this(context, attrs, 0);\n    }\n\n    public SoundWaveView(Context context, @Nullable AttributeSet attrs, int defStyleAttr) {\n        super(context, attrs, defStyleAttr);\n        paint.setColor(Color.BLUE);\n    }\n\n    @Override\n    protected void onSizeChanged(int w, int h, int oldw, int oldh) {\n        super.onSizeChanged(w, h, oldw, oldh);\n        viewWid = w;\n        viewHeight = h;\n        calBarPara();\n        Log.d(TAG, \"onSizeChanged: \" + w + \", \" + h);\n        Log.d(TAG, \"onSizeChanged: barWidPx: \" + barWidPx);\n    }\n\n    @Override\n    protected void onDraw(Canvas canvas) {\n        super.onDraw(canvas);\n        if (dataList == null || dataList.isEmpty()) {\n            // draw nothing\n            drawMiddleLine(canvas);\n            return;\n        }\n        float x0 = viewWid / 2.0f;\n\n        // \u7ed8\u5236\u6570\u636e\n        if (midIndex &gt; 0) {\n            x0 = x0 - (barGapPx + barWidPx) * midIndex; // \u53ef\u80fd\u662f\u8d1f\u6570\n        }\n        for (int i = 0; i &lt; dataList.size(); i++) {\n            float d = dataList.get(i);\n            float x = x0 + (barWidPx + barGapPx) * i;\n            if (x &lt; 0) {\n                continue;\n            }\n            if (x &gt; viewWid) {\n                break;\n            }\n            if (i &lt;= midIndex) {\n                paint.setColor(leftColor);\n            } else {\n                paint.setColor(rightColor);\n            }\n            paint.setStrokeWidth(barWidPx);\n            float bh = (d / showMaxData) * viewHeight;\n            bh = Math.max(bh, 4); // \u6700\u5c0f\u4e5f\u8981\u4e00\u70b9\u9ad8\u5ea6\n            float bhGap = (viewHeight - bh) / 2f;\n            canvas.drawLine(x, bhGap, x, viewHeight - bhGap, paint);\n        }\n        drawMiddleLine(canvas);\n    }\n\n    private void drawMiddleLine(Canvas canvas) {\n        paint.setColor(middleLineColor);\n        canvas.drawLine(viewWid / 2f, 0, viewWid / 2f, viewHeight, paint);\n    }\n\n    public float getMidByPercent() {\n        return midIndex / (float) (dataList.size() - 1);\n    }\n\n    @Override\n    public boolean onTouchEvent(MotionEvent event) {\n        if (mode == MODE_CAN_DRAG) {\n            switch (event.getAction()) {\n                case MotionEvent.ACTION_MOVE:\n                    float dx = (downX - event.getX()); // \u4e0d\u8981\u90a3\u4e48\u7075\u654f\n                    float movePercent = dx / viewWid;\n                    int dIndex = (int) (movePercent * barCount);\n                    int targetMidIndex = downOldMidIndex + dIndex;\n                    targetMidIndex = Math.max(0, targetMidIndex);\n                    targetMidIndex = Math.min(targetMidIndex, dataList.size() - 1);\n                    setMidIndex(targetMidIndex);\n                    Log.d(TAG, \"onTouchEvent-MOVE; dx: \" + dx + \", dIndex: \" + dIndex + \"; targetMidIndex: \" + targetMidIndex);\n                    break;\n                case MotionEvent.ACTION_DOWN:\n                    downX = event.getX();\n                    downOldMidIndex = midIndex;\n                    break;\n                case MotionEvent.ACTION_CANCEL:\n                case MotionEvent.ACTION_UP:\n                    downOldMidIndex = midIndex;\n                    tellOnMoveEnd();\n                    break;\n            }\n            if (onEventListener != null) {\n                onEventListener.onDragTouchEvent(event);\n            }\n            return true;\n        }\n        return super.onTouchEvent(event);\n    }\n\n    public void setMode(int mode) {\n        this.mode = mode;\n    }\n\n    public int getMode() {\n        return mode;\n    }\n\n    public int getMidIndex() {\n        return midIndex;\n    }\n\n    public List&lt;Float&gt; getDataList() {\n        return dataList;\n    }\n\n    public void setOnEventListener(OnEvent onEventListener) {\n        this.onEventListener = onEventListener;\n    }\n\n    public void clear() {\n        dataList = new ArrayList&lt;&gt;();\n        midIndex = 0;\n        invalidate();\n    }\n\n    private void calBarPara() {\n        barWidPx = dp2Px(barWidDp);\n        barGapPx = barWidPx;\n        barCount = (int) ((viewWid - barGapPx) / (barWidPx + barGapPx));\n        paint.setStrokeWidth(barWidPx);\n        Log.d(TAG, \"calBarPara: barCount: \" + barCount);\n    }\n\n    public void setDataList(List&lt;Float&gt; input) {\n        dataList = new ArrayList&lt;&gt;(input);\n        midIndex = 0;\n        invalidate();\n    }\n\n    public void setMidIndex(int midIndex) {\n        this.midIndex = midIndex;\n        invalidate();\n    }\n\n    public void setMidEnd() {\n        setMidIndex(dataList.size() - 1);\n    }\n\n    // \u8bbe\u7f6e\u5f53\u524d\u64ad\u653e\u8fdb\u5ea6\n    public void setPlayPercent(float percent) {\n        midIndex = (int) (percent * (dataList.size() - 1));\n        if (percent &gt;= 1) {\n            midIndex = dataList.size() - 1;\n        }\n        invalidate();\n    }\n\n    public void setShowMaxData(float showMaxData) {\n        this.showMaxData = showMaxData;\n    }\n\n    public float getShowMaxData() {\n        return showMaxData;\n    }\n\n    // \u4e0d\u505c\u5730\u63d2\u5165\u6570\u636e\n    public void addDataEnd(float f) {\n        dataList.add(f);\n        midIndex = dataList.size() - 1;\n        invalidate();\n    }\n\n    public void setLeftColor(int leftColor) {\n        this.leftColor = leftColor;\n    }\n\n    public void setRightColor(int rightColor) {\n        this.rightColor = rightColor;\n    }\n\n    private float dp2Px(float dp) {\n        float density = getContext().getResources().getDisplayMetrics().density;\n        int mark = dp &gt; 0 ? 1 : -1;\n        return dp * density * mark;\n    }\n\n    private void tellOnMoveEnd() {\n        if (onEventListener != null) {\n            onEventListener.onMoveEnd();\n        }\n    }\n}\n</code></pre> <p>layout\u4e2d\u4f7f\u7528 <pre><code>&lt;com.rustfisher.tutorial2020.customview.soundwave.SoundWaveView\n    android:id=\"@+id/sound_wave_view\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"100dp\"\n    android:layout_marginTop=\"4dp\"\n    android:background=\"@android:color/white\"\n    app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n</code></pre></p> activity\u4e2d\u4f7f\u7528\u6a21\u62df\u6570\u636e<pre><code>private void setData1() {\n    List&lt;Float&gt; dataList = new ArrayList&lt;&gt;();\n    for (int i = 0; i &lt; 1000; i++) {\n        dataList.add((float) (Math.random() * soundWaveView.getShowMaxData()));\n    }\n    soundWaveView.setDataList(dataList);\n    soundWaveView.setMidIndex(0);\n\n    soundWaveView.setOnEventListener(new SoundWaveView.OnEvent() {\n        @Override\n        public void onMoveEnd() {\n            Log.d(TAG, \"onMoveEnd: \" + soundWaveView.getMidIndex());\n        }\n\n        @Override\n        public void onDragTouchEvent(MotionEvent event) {\n            // \u5728\u8fd9\u91cc\u53ef\u4ee5\u6536\u5230\u89e6\u6478\u4e8b\u4ef6\n        }\n    });\n}\n</code></pre> <p>\u8fd0\u884c\u793a\u4f8b\uff1a</p> <p></p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u6269\u5c55\u4e00\u4e0b\uff0c\u5047\u8bbe\u4e0d\u4f7f\u7528\u67f1\u5b50\uff0c\u4e5f\u53ef\u4ee5\u628a\u76f8\u90bb\u70b9\u8fde\u63a5\u8d77\u6765\uff0c\u5f62\u6210\u6298\u7ebf\u56fe\u7684\u6837\u5b50\u3002</p> <p>\u76f8\u5173\u4ee3\u7801\u5728\uff1a AndroidTutorial - gitee</p>"},{"location":"android/ui/view/customView/wave-view/#_8","title":"\u6269\u5c55\u9605\u8bfb","text":"<ul> <li>\u81ea\u5b9a\u4e49SurfaceView</li> <li>\u81ea\u52a8\u7f29\u653e\u4e0a\u4e0b\u9650\u7684\u6298\u7ebf\u56fe</li> <li>\u76d1\u542c\u8005\u6a21\u5f0f - \u5728Java\u4e0eAndroid\u4e2d\u7684\u4f7f\u7528</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>segmentfault cnblogs juejin 51CTO oschina \u77e5\u4e4e \u534e\u4e3a\u4e91\u793e\u533a csdn \u7b80\u4e66</p>"},{"location":"android/ui/view/customView/zt-star-moving/","title":"Android\u81ea\u5b9a\u4e49View\u4e4b\u661f\u7403\u8fd0\u52a8","text":"\u66f4\u65b0\u65e5\u671f 2023-03-13 <ul> <li>2023-03-13 \u66f4\u65b0</li> <li>2018-2-24 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4f5c\u8005\u4fe1\u606f</p> <p>\u4f5c\u8005\uff1aclwater</p> <p>Android\u81ea\u5b9a\u4e49View\u4e4b\u661f\u7403\u8fd0\u52a8 - clwater - \u6398\u91d1</p> <p>Android\u81ea\u5b9a\u4e49View\u4e4b\u661f\u7403\u8fd0\u52a8 - \u539f\u6587\u94fe\u63a5</p>"},{"location":"android/ui/view/customView/zt-star-moving/#_1","title":"\u524d\u8a00","text":"<p>\u5728dribbble\u95f2\u901b\u7684\u65f6\u5019\u53d1\u73b0\u7684\u4e00\u4e2a\u6709\u610f\u601d\u7684\u661f\u7403\u8fd0\u52a8\u7684\u52a8\u753b,\u521a\u597d\u6700\u8fd1\u65f6\u95f4\u5c1a\u53ef,\u5c31\u7b80\u5355\u5b9e\u73b0\u4e86\u4e00\u4e0b\u4e2d\u95f4\u8fd0\u52a8\u7684\u90e8\u5206,\u53c8\u662f\u56e0\u4e3a\u65f6\u95f4\u7684\u539f\u56e0,\u5f00\u5934\u4f4d\u79fb\u7684\u90e8\u5206\u6ca1\u6709\u5b8c\u6210.</p> <p></p> <p>\u8fd9\u662f\u5728dribbble\u4e2d\u53d1\u73b0\u7684\u52a8\u753b</p> <p></p> <p>\u8fd9\u662f\u6211\u81ea\u5df1\u5b9e\u73b0\u7684\u6548\u679c\u2026 \u603b\u89c9\u5f97\u6211\u8fd9\u4e2a\u661f\u7403\u6709\u70b9\u80d6\u2026 \u56e0\u4e3a\u80d6\u6240\u4ee5\u8f6c\u7684\u6162\u4e48\u8fd9\u662f.\u901f\u5ea6\u7b49\u7ec6\u8282\u8fd8\u6709\u4f18\u5316\u7684\u4f59\u5730</p>"},{"location":"android/ui/view/customView/zt-star-moving/#_2","title":"\u8bbe\u8ba1\u8fc7\u7a0b","text":"<p>\u8001\u529e\u6cd5,\u5148\u5206\u89e3\u52a8\u753b\u7684\u6784\u6210.\u6574\u4e2a\u52a8\u753b\u53ef\u4ee5\u770b\u505a\u662f\u4e00\u4e2a\u81ea\u65cb\u7684\u661f\u7403\u4ece\u53f3\u4e0a\u89d2\u7531\u5c0f\u53d8\u5927\u7684\u79fb\u52a8\u5230\u5c4f\u5e55\u7684\u4e2d\u592e\u7684.</p> <p>\u661f\u7403\u7684\u4f4d\u79fb\u53ca\u7f29\u653e\u4e0d\u8bf4(\u5176\u5b9e\u662f\u6700\u8fd1\u6709\u9700\u6c42,\u6682\u65f6\u6ca1\u65f6\u95f4\u5b8c\u5584),\u4e3b\u8981\u5b8c\u5584\u4e86\u661f\u7403\u7684\u65cb\u8f6c\u53ca\u5c3e\u90e8\u7684\u5904\u7406.</p> <p>\u6700\u5e95\u5c42\u662f\u80cc\u666f\u7684\u661f\u661f\u95ea\u70c1,\u6bcf\u6b21\u5728\u661f\u7403\u4e00\u5b9a\u8303\u56f4\u5185\u968f\u673a\u51fa\u73b0,\u5e76\u7f29\u653e\u5c31\u597d</p> <p>\u6700\u5f00\u59cb\u8bbe\u8ba1\u5c3e\u90e8\u6548\u679c\u7684\u65f6\u5019,\u662f\u5728\u6ca1\u5217\u4e2d\u8bbe\u8ba1\u4e86\u4e24\u7aef\u7ebf.\u518d\u4e0d\u65ad\u7684\u8fd0\u884c\u53ca\u79fb\u52a8.\u4f46\u662f\u5b9e\u73b0\u8d77\u6765\u5f88\u4e71.</p> <p>\u6700\u540e\u91c7\u7528\u4e86\u5148\u7ed8\u5236\u6240\u6709\u5c3e\u90e8\u5c55\u793a\u7684\u5185\u5bb9,\u7136\u540e\u5728\u7528\u548c\u80cc\u666f\u4e00\u6837\u7684\u989c\u8272\u90e8\u5206\u906e\u76d6\u5e76\u79fb\u52a8\u6b64\u90e8\u5206\u5f62\u6210\u89c6\u89c9\u4e0a\u7684\u6548\u679c\u7684\u65b9\u6cd5.(\u4e5f\u53ef\u4ee5\u8bbe\u7f6ePorterDuff\u6a21\u5f0f\u6765\u5c55\u793a).\u8bbe\u8ba1\u8fc7\u7a0b\u4e2d\u7684\u6548\u679c\u5982\u4e0b</p> <p></p> <p></p> <p>\u661f\u7403\u7684\u8bbe\u8ba1,\u661f\u7403\u7684\u672c\u8eab\u4f7f\u7528\u7b80\u5355\u7684\u906e\u76d6\u548c\u8d1d\u585e\u5c14\u66f2\u7ebf\u5c31\u80fd\u5b8c\u6210\u4e00\u4e2a\u8f83\u4e3a\u6ee1\u610f\u7684\u661f\u7403\u80cc\u666f.</p> <p></p> <p>\u91cd\u70b9\u662f\u661f\u7403\u5730\u8868\u7684\u8bbe\u8ba1\u4ee5\u53ca\u661f\u7403\u81ea\u8f6c\u4e0b\u7684\u5730\u8868\u6837\u5f0f\u7684\u79fb\u52a8.\u89e3\u51b3\u7684\u65b9\u6cd5\u662f\u662f\u5148\u7ed8\u5236\u4e09\u4e2a\u91cd\u590d\u5e76\u8fde\u7eed\u7684\u5730\u8868\u6837\u5f0f,\u901a\u8fc7\u79fb\u52a8\u6574\u4e2a\u5730\u8868\u6837\u5f0f\u6a21\u62df\u661f\u7403\u7684\u8f6c\u52a8.\u6700\u540e\u901a\u8fc7PorterDuff\u6765\u63a7\u5236\u5c55\u793a\u7684\u90e8\u5206\u548c\u661f\u7403\u7684\u4f4d\u7f6e\u91cd\u5408.</p> <p>\u672a\u5f00\u542fPorterDuff\u6a21\u5f0f\u65f6\u7ed8\u5236\u7684\u6837\u5f0f\u5982\u4e0b:</p> <p></p> <p>\u5f00\u542fPorterDuff\u6a21\u5f0f\u540e\u518d\u6307\u5b9a\u4f4d\u7f6e\u5c55\u793a\u6307\u5b9a\u5f62\u72b6\u7684\u56fe\u5f62\u5982\u4e0b:</p> <p></p> <p>\u6700\u540e\u518d\u79fb\u52a8\u8bbe\u7f6e\u597d\u7684\u661f\u7403\u5730\u8c8c\u5c31\u53ef\u4ee5\u6a21\u62df\u51fa\u661f\u7403\u8f6c\u52a8\u7684\u6548\u679c\u4e86</p>"},{"location":"android/ui/view/customView/zt-star-moving/#_3","title":"\u4ee3\u7801\u5b9e\u73b0","text":""},{"location":"android/ui/view/customView/zt-star-moving/#_4","title":"\u80cc\u666f\u7684\u661f\u661f","text":"<pre><code>private fun drawStarts(canvas: Canvas, perIndexInAll: Float) {\n    //\u80cc\u666f\u7684\u661f\u661f\u5728\u661f\u7403\u9644\u8fd1\u7684\u4e00\u5b9a\u8303\u56f4\u5185\u968f\u673a\u51fa\u73b0\n    val maxRand = 800\n\n    canvas.translate(-maxRand / 2F , -maxRand / 2F)\n    val Random = Random(perIndexInAll.toInt().toLong())\n\n    //\u7ed8\u5236\u80cc\u666f\u7684\u661f\u661f\n    for (index in 0..4){\n        drawStart(canvas ,  Random.nextFloat() * maxRand , Random.nextFloat() * maxRand , perIndex)\n    }\n\n    canvas.translate(maxRand / 2F , maxRand / 2F)\n}\n\n//\u7ed8\u5236\u80cc\u666f\u7684\u661f\u661f\u5185\u5bb9\n//\u7ed8\u5236\u80cc\u666f\u7684\u661f\u661f\u5185\u5bb9\nprivate fun drawStart(canvas: Canvas, x: Float, y: Float, per: Float) {\n    var per = per\n    //\u8fd9\u4e2a\u90e8\u5206\u662f\u4e3a\u4e86\u8ba9\u661f\u661f\u5b9e\u73b0\u4ece\u5c0f\u5230\u5927\u540e\u518d\u4ece\u5927\u5230\u5c0f\u7684\u53d8\u52a8\n    if (per &gt;= 1.0F){\n        per -= 1F\n    }\n    if (per &lt;= 0.5F){\n        per *= 2\n    }else{\n        per = (1 - per) * 2\n    }\n\n    canvas.save()\n    canvas.translate(x , y)\n\n    canvas.scale(per , per)\n\n    val paint = Paint()\n    paint.color = 0xff78D8DF.toInt()\n\n    val startLength = 30F\n    val startOffset = startLength / 3F\n\n    //\u901a\u8fc7\u8def\u5f84\u63cf\u7ed8\u661f\u661f\u7684\u5f62\u72b6\n    val path = Path()\n    path.moveTo(0F , startLength)\n    path.lineTo(startOffset , startOffset )\n    path.lineTo(startLength , 0F)\n    path.lineTo(startOffset  , -startOffset )\n    path.lineTo(0F , -startLength)\n    path.lineTo(-startOffset  , -startOffset )\n    path.lineTo(-startLength , 0F)\n    path.lineTo(-startOffset  , startOffset )\n    path.lineTo(0F , startLength)\n\n    canvas.drawPath(path , paint)\n\n    paint.color = viewBackgroundColor\n    //\u901a\u8fc7\u7f29\u5c0f\u7ed8\u5236\u661f\u661f\u5185\u90e8\u5f62\u72b6\n    canvas.scale(0.3F , 0.3F)\n    canvas.drawPath(path , paint)\n\n    canvas.restore()\n}\n</code></pre>"},{"location":"android/ui/view/customView/zt-star-moving/#_5","title":"\u661f\u7403\u5916\u90e8","text":"<pre><code>private fun drawGas(canvas: Canvas, index: Float) {\n    canvas.save()\n    canvas.rotate(45F)\n\n    val gasWidth = 18F\n    val baseR = baseR * 0.7F\n    val absBaseR = baseR / 5F\n\n    val paint = Paint()\n    paint.strokeWidth = gasWidth\n    paint.style = Paint.Style.STROKE\n    paint.color = 0xff2F3768.toInt()\n\n    val paintArc = Paint()\n    paintArc.color = 0xff2F3768.toInt()\n\n    val gasLength = baseR * 2F\n    canvas.save()\n\n    val gsaL = gasWidth / 2F * 3\n    var maxGasLength = (gasLength + gsaL ) / 2\n    var index = index\n\n    canvas.scale(1F , -1F)\n\n    //\u7ed8\u5236\u661f\u7403\u540e\u9762\u7684\u6c14\u6d41\u60c5\u51b5\n    //\u820d\u4e0d\u5f97\u90a3\u4e48\u591a\u5b9a\u4e49\u597d\u7684\u53d8\u91cf\n    //\u53c8\u4e0d\u60f3\u5199\u4e2a\u53c2\u6570\u5f88\u591a\u7684\u51fd\u6570,\u5c31\u8fd9\u4e48\u5b9e\u73b0\u4e86\n    canvas.save()\n    canvas.translate(baseR , baseR * 1.2F)\n    canvas.translate(0F , absBaseR)\n    //drawLines\u51fd\u6570\u4e00\u4e2a\u7ed8\u5236\u4e24\u5934\u5e26\u534a\u5706\u7684\u7ebf\u6bb5\n    drawLines(0F, maxGasLength, canvas, paint)\n    drawWhite( maxGasLength * index, gasWidth , gsaL * 2 , canvas)\n    drawWhite( maxGasLength * (index - 1 ) * 1.1F, gasWidth , gsaL * 2 , canvas)\n    drawWhite( maxGasLength * (index + 1 ) * 1.1F, gasWidth , gsaL * 2 , canvas)\n    canvas.restore()\n\n    index = index + 0.3F\n\n    //.....\u6ca1\u6709\u5199\u51fd\u6570\u5c31\u4e0d\u4e0a\u91cd\u590d\u7684\u4ee3\u7801\u4e86\n\n    val rectf = RectF(-baseR , -baseR , baseR ,baseR)\n    canvas.drawArc(rectf , 0F , 180F , false , paint)\n\n    canvas.drawLine(baseR ,0F ,  baseR ,  -baseR, paint)\n    canvas.drawLine(-baseR ,0F ,  -baseR ,  -baseR, paint)\n\n    canvas.restore()\n}\n\n//\u7ed8\u5236\u5c3e\u90e8\u7a7a\u767d\u90e8\u5206\nprivate fun drawWhite(offset: Float, gasWidth: Float, gsaL : Float , canvas: Canvas) {\n    val r = gasWidth / 2F\n\n    canvas.save()\n    canvas.translate( 0F , offset - 2 * gsaL )\n\n    val pointPaint = Paint()\n    pointPaint.strokeWidth = 20F\n    pointPaint.color = Color.RED\n\n    //\u901a\u8fc7\u8d1d\u585e\u5c14\u66f2\u7ebf\u7ed8\u5236\u534a\u5706\u6548\u679c\n    val path = Path()\n    path.moveTo(-r , gsaL)\n    path.cubicTo(\n            - r * C ,  gsaL - r,\n            r * C ,  gsaL - r,\n            r , gsaL\n    )\n\n    path.lineTo(r , - gsaL)\n    path.cubicTo(\n            r * C ,  - gsaL + r,\n            -r * C ,  - gsaL + r,\n            -r , - gsaL\n    )\n\n    path.lineTo(-r , gsaL * 1.5F)\n\n    val paint = Paint()\n    paint.color = viewBackgroundColor\n    canvas.drawPath(path , paint)\n\n    canvas.restore()\n}\n</code></pre>"},{"location":"android/ui/view/customView/zt-star-moving/#_6","title":"\u661f\u7403","text":"<pre><code>private fun drawPlanet(canvas: Canvas , index : Float) {\n    //\u8bbe\u7f6e\u539f\u56fe\u5c42\n    val srcB = makeSrc(index)\n    //\u8bbe\u7f6e\u906e\u7f69\u5c42\n    //\u906e\u7f69\u5c42\u53ea\u6709\u4e00\u548c\u661f\u7403\u5927\u5c0f\u4e00\u6837\u7684\u5706\n    val dstB = makeDst(index)\n\n    val paint = Paint()\n    canvas.saveLayer(-baseR, -baseR, baseR , baseR, null, Canvas.ALL_SAVE_FLAG)\n    //\u7ed8\u5236\u906e\u7f69\u5c42\n    canvas.drawBitmap(dstB,  -baseR / 2F, -baseR / 2F , paint)\n    //\u8bbe\u7f6e\u906e\u7f69\u6a21\u5f0f\u4e3aSRC_IN\u663e\u793a\u539f\u56fe\u5c42\u4e2d\u539f\u56fe\u5c42\u4e0e\u906e\u7f69\u5c42\u76f8\u4ea4\u90e8\u5206\n    paint.xfermode = PorterDuffXfermode(PorterDuff.Mode.SRC_IN)\n    canvas.drawBitmap(srcB, width / -2F, height / -2F , paint)\n    paint.xfermode = null\n}\n\n\n//\u8bbe\u7f6e\u6e90\u56fe\u5c42\nfun makeSrc(index :Float): Bitmap {\n    val bm = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888)\n    val canvas = Canvas(bm)\n    canvas.translate(width.toFloat() / 2F , height.toFloat() / 2F)\n\n    val paint = Paint()\n    paint.color = 0xff57BEC6.toInt()\n    paint.style = Paint.Style.FILL\n\n    val rectf = RectF(-baseR / 2F, -baseR / 2F, baseR / 2F, baseR / 2F)\n    canvas.drawArc(rectf , 0F , 360F , true , paint)\n\n    canvas.save()\n\n\n    //\u7ed8\u5236\u661f\u7403\u80cc\u666f\n    paint.color = 0xff78D7DE.toInt()\n    var baseR = baseR * 0.9.toFloat()\n    val rectf2 = RectF(-baseR / 2F, -baseR / 2F, baseR / 2F, baseR / 2F)\n    canvas.translate(baseR / 6F , baseR / 6F)\n    canvas.drawArc(rectf2 , 0F , 360F , true , paint)\n\n    canvas.restore()\n    canvas.rotate(-45F)\n    canvas.save()\n\n    val bottomBaseR = baseR / 0.9F / 2\n    val path = Path()\n    path.moveTo(-bottomBaseR , 0F)\n    path.cubicTo(-bottomBaseR , bottomBaseR * 2, bottomBaseR  , bottomBaseR * 2, bottomBaseR , 0F)\n\n    path.cubicTo(\n            bottomBaseR * C,bottomBaseR ,\n            -bottomBaseR * C,bottomBaseR ,\n            -bottomBaseR , 0F\n    )\n\n    //\u7ed8\u5236\u661f\u7403\u80cc\u666f\u7684\u9634\u5f71\u6548\u679c\n    paint.color = 0xffAAEEF2.toInt()\n    paint.style = Paint.Style.FILL\n    canvas.drawPath(path , paint)\n\n    //\u7ed8\u5236\u661f\u7403\u7684\u5730\u8c8c\n    drawPoints(index , canvas)\n\n    canvas.restore()\n\n    paint.strokeWidth = 30F\n    paint.color = 0xff2F3768.toInt()\n    paint.style = Paint.Style.STROKE\n    canvas.drawArc(rectf , 0F , 360F , true , paint)\n\n    return bm\n}\n\nprivate fun drawPoints(index: Float, canvas: Canvas) {\n        val paintB = Paint()\n        val paintS = Paint()\n        paintS.style = Paint.Style.FILL\n        paintS.color = 0xffE7F2FB.toInt()\n\n        paintB.style = Paint.Style.FILL\n        paintB.color = 0xff2F3768.toInt()\n\n        val baseRB = baseR / 2F / 3\n        val baseRS = baseR / 2F / 3 / 3\n\n        val rectfB = RectF(-baseRB, -baseRB, baseRB, baseRB)\n        val rectfS = RectF(-baseRS, -baseRS, baseRS, baseRS)\n\n        val pointPaint = Paint()\n        pointPaint.color = Color.BLACK\n        pointPaint.strokeWidth = 50F\n\n        val coverWidth = baseR\n\n        //\u901a\u8fc7\u79fb\u52a8\u5750\u6807\u539f\u70b9\u6a21\u62df\u661f\u7403\u7684\u81ea\u8f6c\u6548\u679c\n        canvas.translate(-coverWidth / 2F , coverWidth * 1.5F)\n\n        val index = index\n        canvas.translate(0F , coverWidth * index )\n\n        //\u91cd\u590d\u7ed8\u5236\u4e09\u6b21\u661f\u7403\u7684\u5730\u8c8c\u4f7f\u5f97\u661f\u7403\u7684\u81ea\u8f6c\u65e0\u7f1d\u8fde\u63a5\n        for (i in 0..2){\n            canvas.save()\n            canvas.translate(coverWidth / 3F / 2  , -coverWidth / 3F * 2)\n            canvas.drawArc(rectfB , 0F , 360F , true , paintB)\n            canvas.drawArc(rectfS , 0F , 360F , true , paintS)\n            canvas.restore()\n\n            canvas.save()\n            canvas.translate(coverWidth / 3F *2 , -coverWidth / 3F)\n            canvas.drawArc(rectfB , 0F , 360F , true , paintB)\n            canvas.drawArc(rectfS , 0F , 360F , true , paintS)\n            canvas.restore()\n\n            canvas.save()\n            canvas.translate(coverWidth / 3F *2 , -coverWidth / 8F * 7 + -coverWidth / 10F )\n            canvas.drawArc(rectfS , 0F , 360F , true , paintB)\n            canvas.restore()\n\n            canvas.save()\n            canvas.translate(coverWidth / 3F *2 , -coverWidth / 8F * 7  - -coverWidth / 10F )\n            canvas.drawArc(rectfS , 0F , 360F , true , paintB)\n            canvas.restore()\n\n            canvas.translate(0F , -coverWidth)\n        }\n    }\n</code></pre> <p>\u76f8\u5173\u4ee3\u7801\u53ef\u4ee5\u8bbf\u95ee\u6211\u7684GitHub\u6765\u83b7\u53d6,\u6b22\u8fce\u5927\u5bb6start\u6216\u8005\u63d0\u4f9b\u5efa\u8bae.</p> <p>Author: clwater</p> <p>Link: Android\u81ea\u5b9a\u4e49View\u4e4b\u661f\u7403\u8fd0\u52a8</p> <p>Source: \u5168\u6751\u4eba\u7684\u6084\u6084\u8bdd</p> <p>Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.</p>"},{"location":"android/ui/view/customView/surfaceView/custom-surface-view/","title":"Android SurfaceView\u7b80\u4ecb\u4e0e\u4f7f\u7528","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-9 <ul> <li>2022-6-9 \u589e\u52a0\u8bf4\u660e</li> </ul>"},{"location":"android/ui/view/customView/surfaceView/custom-surface-view/#surfaceview","title":"SurfaceView \u7b80\u4ecb","text":"<p>SurfaceView\u5728Android\u7cfb\u7edf\u4e2d\uff0c\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u89c6\u56fe\u3002\u5b83\u62e5\u6709\u72ec\u7acb\u7684\u7ed8\u56fe\u8868\u9762\uff0c\u5373\u5b83\u4e0d\u4e0e\u5bbf\u4e3b\u7a97\u53e3\u5171\u4eab\u540c\u4e00\u4e2a\u7ed8\u56fe\u8868\u9762\u3002 \u7531\u4e8e\u62e5\u6709\u72ec\u7acb\u7684\u7ed8\u56fe\u8868\u9762\uff0c\u56e0\u6b64SurfaceView\u7684UI\u5c31\u53ef\u4ee5\u5728\u4e00\u4e2a\u72ec\u7acb\u7684\u7ebf\u7a0b\u4e2d\u8fdb\u884c\u7ed8\u5236\uff0c\u53c8\u7531\u4e8e\u4e0d\u4f1a\u5360\u7528\u4e3b\u7ebf\u7a0b\u8d44\u6e90\uff0c \u8fd0\u7528SurfaceView\u53ef\u4ee5\u5b9e\u73b0\u590d\u6742\u800c\u9ad8\u6548\u7684UI\uff0c\u53e6\u4e00\u65b9\u9762\u53c8\u4e0d\u4f1a\u5bfc\u81f4\u7528\u6237\u8f93\u5165\u5f97\u4e0d\u5230\u53ca\u65f6\u54cd\u5e94\u3002 \u6bd4\u8f83\u9002\u5408\u5e94\u7528\u5728\u89c6\u9891\u64ad\u653e\uff0c\u56fe\u7247\u6d4f\u89c8\uff0c\u5bf9\u753b\u9762\u8981\u6c42\u9ad8\u7684\u6e38\u620f\u4e0a\u9762\u3002 SurfaceView\u76f8\u5f53\u4e8e\u662f\u5728\u5c4f\u5e55\u91cc\u9762\uff0c\u800c\u5c4f\u5e55\u7ed9\u5b83\u5f00\u4e86\u4e00\u4e2a\u6d1e\u3002\u7ed9\u5b83\u8bbe\u7f6e\u80cc\u666f\u8272\u5c31\u80fd\u628a\u5b83\u76d6\u4f4f\u3002</p> <p>\u4f7f\u7528SurfaceView\u7684\u539f\u56e0\u4e4b\u4e00\uff0c\u662f\u80fd\u591f\u5728\u5b50\u7ebf\u7a0b\u4e2d\u66f4\u65b0\u56fe\u50cf\u3002\u51cf\u8f7bUI\u7ebf\u7a0b\u7684\u538b\u529b\u3002 \u6240\u6709SurfaceView\u548cSurfaceHolder.Callback\u7684\u65b9\u6cd5\u90fd\u5e94\u8be5\u5728UI\u7ebf\u7a0b\u91cc\u8c03\u7528\uff0c\u4e00\u822c\u6765\u8bf4\u5c31\u662f\u5e94\u7528\u7a0b\u5e8f\u4e3b\u7ebf\u7a0b\u3002  \u6e32\u67d3\u7ebf\u7a0b\u6240\u8981\u8bbf\u95ee\u7684\u5404\u79cd\u53d8\u91cf\u5e94\u8be5\u4f5c\u540c\u6b65\u5904\u7406\u3002\u8981\u786e\u4fdd\u7ed8\u56fe\u7ebf\u7a0b\u4ec5\u5728surface\u53ef\u7528\u671f\u95f4\u8fdb\u884c\u7ed8\u56fe\u3002 SurfaceView\u4e3b\u8981\u7531SurfaceHolder\u6765\u63a7\u5236\uff0cholder\u76f8\u5f53\u4e8e\u4e00\u4e2a\u63a7\u5236\u5668\u3002</p>"},{"location":"android/ui/view/customView/surfaceView/custom-surface-view/#_1","title":"\u6838\u5fc3\u8981\u70b9","text":"<p>View\uff1a\u5fc5\u987b\u5728UI\u7684\u4e3b\u7ebf\u7a0b\u4e2d\u66f4\u65b0\u753b\u9762\uff0c\u7528\u4e8e\u88ab\u52a8\u66f4\u65b0\u753b\u9762\u3002 SurfaceView\uff1aUI\u7ebf\u7a0b\u548c\u5b50\u7ebf\u7a0b\u4e2d\u90fd\u53ef\u4ee5\u3002\u5728\u4e00\u4e2a\u65b0\u542f\u52a8\u7684\u7ebf\u7a0b\u4e2d\u91cd\u65b0\u7ed8\u5236\u753b\u9762\uff0c\u4e3b\u52a8\u66f4\u65b0\u753b\u9762\u3002 </p> <pre><code>java.lang.Object\n   \u21b3    android.view.View\n        \u21b3    android.view.SurfaceView\n</code></pre>"},{"location":"android/ui/view/customView/surfaceView/custom-surface-view/#surfaceview_1","title":"SurfaceView \u4f7f\u7528\u65b9\u6cd5","text":"<p>\u521b\u5efa\u4e00\u4e2a\u7c7b\u7ee7\u627fSurfaceView\u5e76\u5b9e\u73b0<code>SurfaceHolder.Callback</code>\u63a5\u53e3\u3002</p> <pre><code>public class MySView extends SurfaceView implements SurfaceHolder.Callback {\n    .........\n}\n</code></pre>"},{"location":"android/ui/view/customView/surfaceView/custom-surface-view/#surfaceholder","title":"\u83b7\u53d6SurfaceHolder","text":"<p>\u5728\u6784\u9020\u51fd\u6570\u4e2d\u83b7\u53d6SurfaceHolder\u3002\u5e76\u6dfb\u52a0\u56de\u8c03\u3002</p> <pre><code>public MySView(Context context, AttributeSet attrs, int defStyleAttr) {\n    super(context, attrs, defStyleAttr);\n    holder = getHolder();\n    holder.addCallback(this);\n    // ......\n}\n</code></pre>"},{"location":"android/ui/view/customView/surfaceView/custom-surface-view/#_2","title":"\u590d\u5199\u65b9\u6cd5","text":"<p><pre><code>@Override\npublic void surfaceCreated(SurfaceHolder holder) {\n    Log.d(TAG, \"surfaceCreated\");\n    drawThread = new DrawThread(holder);// \u521b\u5efa\u4e00\u4e2a\u7ed8\u56fe\u7ebf\u7a0b\n    drawThread.start();\n}\n\n@Override\npublic void surfaceChanged(SurfaceHolder holder, int format, int width, int height) {\n    Log.d(TAG, \"surfaceChanged\");\n}\n\n@Override\npublic void surfaceDestroyed(SurfaceHolder holder) {\n    drawThread.closeThread();// \u9500\u6bc1\u7ebf\u7a0b\n    Log.d(TAG, \"surfaceDestroyed\");\n}\n</code></pre> \u5f53Activity\u4e0d\u53ef\u89c1\u65f6\uff0cSurfaceView\u4f1a\u8c03\u7528<code>surfaceDestroyed</code>\u65b9\u6cd5\u3002\u6b64\u65f6\u5c31\u8981\u9500\u6bc1\u7ed8\u56fe\u7ebf\u7a0b\u3002</p>"},{"location":"android/ui/view/customView/surfaceView/custom-surface-view/#_3","title":"\u7ed8\u56fe\u5b50\u7ebf\u7a0b","text":"<p>SurfaceView\u4e2d\u7ed8\u56fe\u64cd\u4f5c\u662f\u5728\u5b50\u7ebf\u7a0b\u4e2d\u8fdb\u884c\u7684\u3002\u6b63\u5e38\u6765\u8bf4\u5b50\u7ebf\u7a0b\u4e0d\u80fd\u64cd\u4f5cUI\u3002\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 SurfaceHolder\u63d0\u4f9b\u7684\u65b9\u6cd5\u9501\u5b9a\u753b\u5e03\uff0c\u7ed8\u56fe\u5b8c\u6210\u540e\u91ca\u653e\u5e76\u66f4\u65b0\u753b\u5e03\u3002 \u4e0b\u9762\u7684\u7ebf\u7a0b\u63d0\u4f9b\u4e86\u505c\u6b62\u3001\u6062\u590d\u548c\u7ed3\u675f\u7b49\u529f\u80fd\u3002 <pre><code>class DrawThread extends Thread {\n\n    private SurfaceHolder mmHolder;\n    private boolean mmRunning;\n    private boolean mmIsPause;\n\n    public DrawThread(SurfaceHolder holder) {\n        this.mmHolder = holder;\n        mmRunning = true;\n    }\n\n    @Override\n    public void run() {\n        while (mmRunning &amp;&amp; !isInterrupted()) {\n            if (!mmIsPause) {\n                Canvas canvas = null;\n                try {\n                    synchronized (mmHolder) {\n                        canvas = holder.lockCanvas();        // \u9501\u5b9a\u753b\u5e03\uff0c\u83b7\u5f97\u8fd4\u56de\u7684\u753b\u5e03\u5bf9\u8c61Canvas\n                        canvas.drawColor(bgSurfaceViewColor);// \u8bbe\u7f6e\u753b\u5e03\u80cc\u666f\u989c\u8272\n                        // \u7ed8\u56fe\u64cd\u4f5c......\n                    }\n                } catch (Exception e) {\n                    e.printStackTrace();\n                } finally {\n                    if (canvas != null) {\n                        mmHolder.unlockCanvasAndPost(canvas);// \u91ca\u653e\u753b\u5e03\uff0c\u5e76\u63d0\u4ea4\u6539\u53d8\u3002\n                    }\n                    pauseThread();\n                }\n            } else {\n                onThreadWait();\n            }\n        }\n    }\n\n\n    public synchronized void pauseThread() {\n        mmIsPause = true;\n    }\n\n    /**\n     * \u7ebf\u7a0b\u7b49\u5f85,\u4e0d\u63d0\u4f9b\u7ed9\u5916\u90e8\u8c03\u7528\n     */\n    private void onThreadWait() {\n        try {\n            synchronized (this) {\n                this.wait();\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    public synchronized void resumeThread() {\n        mmIsPause = false;\n        this.notify();\n    }\n\n    public synchronized void closeThread() {\n        try {\n            mmRunning = false;\n            notify();\n            interrupt();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre></p>"},{"location":"android/ui/view/customView/surfaceView/custom-surface-view/#layout","title":"layout\u4e2d\u4f7f\u7528","text":"<p>\u5207\u8bb0\u4e0d\u53ef\u5728layout\u4e2d\u8bbe\u7f6ebackground\uff0c\u989c\u8272\u4f1a\u76f4\u63a5\u628aSurfaceView\u6321\u4f4f\u3002 <pre><code>&lt;com.rustfisher.fisherandroidchart.MySView\n    android:id=\"@+id/mySurfaceView\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"230dp\" /&gt;\n</code></pre></p>"},{"location":"android/ui/view/customView/surfaceView/custom-surface-view/#_4","title":"\u53c2\u8003","text":"<ul> <li>SurfaceView.java androidxref.com/9.0.0_r3</li> <li>GLSurfaceView.java androidxref.com/9.0.0_r3</li> <li>TextureView.java androidxref.com/9.0.0_r3</li> <li>SurfaceTexture.java androidxref.com/9.0.0_r3</li> </ul>"},{"location":"android/ui/view/editText/edit-text-set-selection-use/","title":"EditText\u5149\u6807\u79fb\u52a8\u4e0e\u9009\u62e9","text":"\u66f4\u65b0\u65e5\u671f 2020-4-20 <ul> <li>2020-4-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd<code>setSelection</code>\u65b9\u6cd5\u3002</p> <p><code>setSelection</code>\u6709</p> <ul> <li><code>setSelection(int start, int stop)</code> \u9009\u62e9\u8303\u56f4</li> <li><code>setSelection(int index)</code> \u628a\u5149\u6807\u79fb\u52a8\u5230\u6307\u5b9a\u4f4d\u7f6e</li> </ul> <p>\u5047\u8bbe\u6709EditText\uff0c\u53d8\u91cf\u540d\u4e3a<code>mEt1</code>\u3002</p> \u628a\u5149\u6807\u79fb\u52a8\u5230\u6700\u524d <pre><code>mEt1.setSelection(0);\n</code></pre> \u628a\u5149\u6807\u79fb\u52a8\u5230\u6700\u540e <pre><code>mEt1.setSelection(mEt1.getText().length());\n</code></pre> \u5149\u6807\u53f3\u79fb\u4e00\u4f4d <pre><code>mEt1.setSelection(mEt1.getSelectionEnd() + 1);\n</code></pre> \u5149\u6807\u5de6\u79fb\u4e00\u4f4d <pre><code>mEt1.setSelection(mEt1.getSelectionEnd() - 1);\n</code></pre> <p>\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u4f20\u5165\u7684index\u8d85\u51fa\u4e86text\u7684\u8303\u56f4\uff0c\u4f1a\u62a5 <code>java.lang.IndexOutOfBoundsException</code></p> <p>\u56e0\u6b64\u5728\u5b9e\u9645\u5de5\u7a0b\u4e2d\uff0c\u9700\u8981\u5224\u65ad\u4f20\u5165\u7684\u4f4d\u7f6e\u662f\u5426\u5728EditText\u5df2\u6709\u5185\u5bb9\u7684\u957f\u5ea6\u8303\u56f4\u5185\u3002</p> \u5168\u9009\u5f53\u524d\u8f93\u5165\u7684text <pre><code>mEt1.setSelection(0, mEt1.getText().length());\n</code></pre> <p>\ud83d\udcd6 EditText\u76d1\u542c\u56de\u8f66 \ud83d\udcd6 \u8f6f\u952e\u76d8\u906e\u4f4f\u8f93\u5165\u6846 \ud83d\udcd6 \u76d1\u542c\u8f93\u5165\u5185\u5bb9</p>"},{"location":"android/ui/view/editText/listen-editor-action/","title":"EditText\u76d1\u542c\u56de\u8f66","text":"<p>\u4f7f\u7528EditText\u65f6\uff0c\u6709\u65f6\u5019\u6211\u4eec\u4f1a\u9700\u8981\u76d1\u542c\u8f93\u5165\u7684\u56de\u8f66\uff0c\u4ee5\u505a\u51fa\u4e00\u4e9b\u64cd\u4f5c\u3002 \u6216\u8005\u9700\u8981\u628a\u56de\u8f66\u53d8\u6210\u201c\u641c\u7d22\u201d\uff0c\u201c\u53d1\u9001\u201d\u6216\u201c\u5b8c\u6210\u201d\u7b49\u7b49\u3002</p> <p>EditText\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5c5e\u6027<code>imeOptions</code>\u7528\u6765\u66ff\u6362\u8f6f\u952e\u76d8\u4e2denter\u952e\u7684\u5916\u89c2\uff0c\u5982<code>actionGo</code>\u4f1a\u4f7f\u5916\u89c2\u53d8\u6210\u201c\u524d\u5f80\u201d\u3002 \u9700\u8981\u540c\u65f6\u8bbe\u7f6e<code>android:inputType=\"text\"</code>\u3002 <pre><code>&lt;EditText\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:imeOptions=\"actionGo\"\n    android:inputType=\"text\" /&gt;\n</code></pre></p> <p>\u4e0b\u9762\u5217\u51fa\u6bd4\u8f83\u7ecf\u5e38\u7528\u5230\u7684\u51e0\u4e2a\u5c5e\u6027\u4ee5\u53ca\u66ff\u6362\u7684\u6587\u672c\u5916\u89c2\uff1a</p> \u5c5e\u6027 \u8bf4\u660e \u5bf9\u5e94\u9759\u6001\u53d8\u91cf actionUnspecified \u672a\u6307\u5b9a EditorInfo.IME_ACTION_UNSPECIFIED actionNone \u52a8\u4f5c EditorInfo.IME_ACTION_NONE actionGo \u53bb\u5f80 EditorInfo.IME_ACTION_GO actionSearch \u641c\u7d22 EditorInfo.IME_ACTION_SEARCH actionSend \u53d1\u9001 EditorInfo.IME_ACTION_SEND actionNext \u4e0b\u4e00\u9879 EditorInfo.IME_ACTION_NEXT actionDone \u5b8c\u6210 EditorInfo.IME_ACTION_DONE <p>\u8bbe\u7f6e\u7684\u65b9\u6cd5\u53ef\u4ee5\u5728\u5e03\u5c40\u6587\u4ef6\u4e2d\u8bbe\u7f6e <code>android:imeOptions=\"actionNext\"</code> \u6216\u8005\u5728\u4ee3\u7801\u4e2d <code>mUserEdit.setImeOptions(EditorInfo.IME_ACTION_NEXT);</code></p> <p>\u63a5\u4e0b\u6765\u8bbe\u7f6e\u56de\u8f66\u6309\u952e\u7684\u76d1\u542c\u4e8b\u4ef6 <code>setOnEditorActionListener</code> <pre><code>    et1.setOnEditorActionListener(mOnEditorActionListener);\n    // ......\n    private TextView.OnEditorActionListener mOnEditorActionListener = new TextView.OnEditorActionListener() {\n        @Override\n        public boolean onEditorAction(TextView v, int actionId, KeyEvent event) {\n            Log.d(TAG, \"actionId: \" + actionId);\n            Log.d(TAG, \"event:    \" + event);\n            return false;\n        }\n    };\n</code></pre> \u5982\u679c<code>onEditorAction</code>\u8fd4\u56detrue\uff0c\u8868\u793a\u6d88\u8d39\u6389\u8fd9\u4e2a\u4e8b\u4ef6\u3002</p> <p>\u4e0a\u9762\u7684<code>actionId</code>\u5bf9\u5e94\u7684\u662f<code>android.view.inputmethod.EditorInfo</code>\u4e2d\u7684\u5e38\u91cf\u3002 <pre><code>    public static final int IME_ACTION_UNSPECIFIED = 0x00000000;\n    public static final int IME_ACTION_NONE = 0x00000001;\n    public static final int IME_ACTION_GO = 0x00000002;\n    public static final int IME_ACTION_SEARCH = 0x00000003;\n    public static final int IME_ACTION_SEND = 0x00000004;\n    public static final int IME_ACTION_NEXT = 0x00000005;\n    public static final int IME_ACTION_DONE = 0x00000006;\n    public static final int IME_ACTION_PREVIOUS = 0x00000007;\n</code></pre></p>"},{"location":"android/ui/view/editText/soft-keyboard-cover-et/","title":"EditText\u5f39\u51fa\u8f6f\u952e\u76d8\u906e\u4f4f\u8f93\u5165\u6846\u95ee\u9898","text":"<p>\u5f39\u51fa\u8f6f\u952e\u76d8\u540e\uff0cEditText\u88ab\u906e\u4f4f\u4e86\u3002</p>"},{"location":"android/ui/view/editText/soft-keyboard-cover-et/#nestedscrollviewedittext","title":"NestedScrollView\u4e2d\u7684EditText","text":"<p>\u8ba9EditText\u4f4d\u7f6e\u81ea\u52a8\u5411\u4e0a\u79fb\u3002</p> <p>\u5728Manifest\u4e2d\u5bf9Activity\u8fdb\u884c\u8bbe\u7f6e<code>android:windowSoftInputMode=\"adjustPan\"</code>\u3002</p> <pre><code>&lt;activity\n    android:name=\".RustFisherAct\"\n    android:windowSoftInputMode=\"adjustPan\"/&gt;\n</code></pre>"},{"location":"android/ui/view/editText/soft-keyboard-cover-et/#activity-windowsoftinputmode","title":"activity windowSoftInputMode","text":"<p>\u5728<code>SoftInputModeAct</code>\u4e2d\uff0c\u5e95\u90e8\u653e\u4e00\u4e2aEditText\uff0c\u89c2\u5bdf\u8f6f\u952e\u76d8\u5f39\u51fa\u7684\u73b0\u8c61\u3002 \u6539\u53d8manifest\u4e2d<code>android:windowSoftInputMode</code>\u7684\u8bbe\u7f6e\u3002</p> <p>manifest.xml <pre><code>    &lt;activity\n        android:name=\".edittext.SoftInputModeAct\"\n        android:windowSoftInputMode=\"adjustNothing\" /&gt;\n</code></pre> \u5f39\u51fa\u7684\u8f6f\u952e\u76d8\u628aEditText\u76d6\u4f4f\u4e86\u3002</p>"},{"location":"android/ui/view/editText/text-watcher-use/","title":"\u76d1\u542c\u8f93\u5165\u5185\u5bb9","text":""},{"location":"android/ui/view/editText/text-watcher-use/#_1","title":"\u4ee3\u7801\u4e2d\u52a8\u6001\u9650\u5236\u8f93\u5165\u957f\u5ea6","text":"<p>\u4f7f\u7528<code>TextWatcher</code></p> <pre><code>mQueryEt.addTextChangedListener(new TextWatcher() {\n    @Override\n    public void beforeTextChanged(CharSequence s, int start, int count, int after) {\n    }\n\n    @Override\n    public void onTextChanged(CharSequence s, int start, int before, int count) {\n\n    }\n\n    @Override\n    public void afterTextChanged(Editable s) {\n        // \u5982\u679cEditText\u4e2d\u7684\u6570\u636e\u4e0d\u4e3a\u7a7a\uff0c\u4e14\u957f\u5ea6\u5927\u4e8e\u6307\u5b9a\u7684\u6700\u5927\u957f\u5ea6\n        if (!TextUtils.isEmpty(s) &amp;&amp; s.length() &gt; 15) {\n            // \u5220\u9664\u6307\u5b9a\u957f\u5ea6\u4e4b\u540e\u7684\u6570\u636e\n            s.delete(15, s.length() - 1);\n        }\n    }\n});\n</code></pre>"},{"location":"android/ui/view/imageView/overview/","title":"ImageView \u56fe\u7247\u663e\u793a","text":""},{"location":"android/ui/view/imageView/overview/#_1","title":"\u5bfc\u8a00","text":"<p>\u4e3a\u4e86\u8ba9App\u754c\u9762\u66f4\u7f8e\u89c2\u751f\u52a8\uff0c\u6211\u4eec\u53ef\u4ee5\u653e\u4e0a\u56fe\u7247\u3002 \u663e\u793a\u56fe\u7247\u662f\u201c\u521a\u9700\u201d\u3002\u4e0d\u8bba\u662f\u4e66\u7c4d\uff0c\u62a5\u7eb8\uff0c\u7f51\u7ad9\uff0c\u90fd\u6709\u663e\u793a\u56fe\u7247\u7684\u9700\u6c42\u3002\u6bd5\u7adf\u201c\u65e0\u56fe\u65e0\u771f\u76f8\u201d\u3002 \u5728Android\u5e94\u7528\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u901a\u5e38\u4f7f\u7528<code>ImageView</code>\u6765\u663e\u793a\u56fe\u7247\u3002 \u672c\u6587\u7684\u4e3b\u89d2\u662f<code>ImageView</code>\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u770b\u770b\u5982\u4f55\u4f7f\u7528\u5b83\u3002</p>"},{"location":"android/ui/view/imageView/overview/#imageview_1","title":"ImageView\u7684\u4f7f\u7528","text":"<p>ImageView\u7ecf\u5e38\u7528\u6765\u663e\u793a\u56fe\u7247\u3002\u4f8b\u5982\u76f4\u63a5\u663e\u793adrawable\u91cc\u7684\u56fe\u7247\u8d44\u6e90\u3002 ImageView\u663e\u793a\u7684\u662fDrawable\u5bf9\u8c61\u3002</p>"},{"location":"android/ui/view/imageView/overview/#srcbackground","title":"src\u4e0ebackGround\u7684\u533a\u522b","text":"<p>\u5728layout xml\u4e2d\uff0c\u6211\u4eec\u5148\u6765\u770b\u4e00\u4e0bsrc\u4e0ebackGround\u7684\u533a\u522b\u3002 backGround\u662fView\uff08ImageView\u662fView\u7684\u5b50\u7c7b\uff09\u7684\u80cc\u666f\uff0c\u4f1a\u628a\u56fe\u7247\u62c9\u5927\u94fa\u6ee1\u6574\u4e2aView\u3002 src\u662fImageView\u7684\u5c5e\u6027\uff0c\u63a5\u53d7\u8981\u5c55\u793a\u7684\u56fe\u7247\u8d44\u6e90\u3002</p> <p>\u4e3a\u65b9\u4fbf\u540e\u7eed\u8868\u8ff0\uff0c\u5148\u7ed9ImageView\u6307\u5b9a\u4e00\u4e2astyle\uff0c\u7edf\u4e00\u5927\u5c0f\u3002\u518d\u8bbe\u7f6e\u4e00\u4e2a\u9ed8\u8ba4\u80cc\u666f\u989c\u8272\u3002 <pre><code>    &lt;style name=\"IvDemo1\"&gt;\n        &lt;item name=\"android:layout_width\"&gt;100dp&lt;/item&gt;\n        &lt;item name=\"android:layout_height\"&gt;80dp&lt;/item&gt;\n        &lt;item name=\"android:background\"&gt;#929292&lt;/item&gt;\n        &lt;item name=\"android:layout_marginTop\"&gt;4dp&lt;/item&gt;\n    &lt;/style&gt;\n</code></pre> \u5728drawable\u76ee\u5f55\u4e2d\u589e\u52a0\u4e00\u5f20\u56fe\u7247\u3002\u56fe\u7247\u7684\u5bbd\u957f\u6bd4\u548cstyle\u8bbe\u7f6e\u7684\u4e0d\u4e00\u6837\u3002\u65b9\u4fbf\u6211\u4eec\u67e5\u770b\u56fe\u7247\u6548\u679c\u3002</p> <p>\u5728\u793a\u4f8bxml\u4e2d\uff0c\u5c55\u793asrc\u4e0ebackGround\u7684\u533a\u522b\u3002 <pre><code>    &lt;ImageView\n        style=\"@style/IvDemo1\"\n        android:background=\"@drawable/pic_2_robots\" /&gt;\n\n    &lt;ImageView\n        style=\"@style/IvDemo1\"\n        android:layout_marginStart=\"20dp\"\n        android:src=\"@drawable/pic_2_robots\" /&gt;\n</code></pre></p> <p></p> <p>\u5de6\u8fb9\u662f\u8bbe\u7f6e\u4e3a\u4e86background\uff0c\u53ef\u4ee5\u770b\u5230\u56fe\u7247\u88ab\u62c9\u4f38\u94fa\u6ee1\u4e86\u6574\u4e2aImageView\u3002 \u800c\u4e14\u56fe\u7247\u6709\u4e00\u70b9\u53d8\u5f62\u3002\u90a3\u662f\u56e0\u4e3a\u56fe\u7247\u7684\u5bbd\u957f\u6bd4\u548cImageView\u7684\u5bbd\u957f\u6bd4\u4e0d\u4e00\u81f4\u3002</p> <p>\u53f3\u8fb9\u8bbe\u7f6e\u4e86src\uff0c\u53ef\u4ee5\u770b\u5230\u56fe\u7247\u5e76\u6ca1\u6709\u94fa\u6ee1\u3002\u53f3\u8fb9\u56fe\u7247\u7684\u663e\u793a\u65b9\u5f0f\uff0c\u5c31\u662f\u6211\u4eec\u63a5\u4e0b\u6765\u8981\u4ecb\u7ecd\u7684scaleType\u3002</p>"},{"location":"android/ui/view/imageView/overview/#scaletype","title":"scaleType\uff0c\u56fe\u7247\u663e\u793a\u65b9\u5f0f","text":"<p>\u8bbe\u7f6e\u4e86src\u540e\uff0c\u518d\u8bbe\u7f6escaleType\uff0c\u80fd\u786e\u5b9a\u56fe\u7247\u7684\u663e\u793a\u6548\u679c\u3002 <pre><code>    &lt;ImageView\n        style=\"@style/IvDemo1\"\n        android:scaleType=\"fitXY\"\n        android:src=\"@drawable/pic_2_robots\" /&gt;\n</code></pre></p> <p>\u5b9e\u9645\u4e0a\uff0csrc\u9664\u4e86\u7528drawable\u91cc\u7684\u8d44\u6e90\uff0c\u4e5f\u53ef\u4ee5\u7528mipmap\u3002 <pre><code>    &lt;ImageView\n        style=\"@style/IvDemo1\"\n        android:layout_marginStart=\"20dp\"\n        android:scaleType=\"center\"\n        android:src=\"@mipmap/ic_launcher\" /&gt;\n</code></pre></p> <p>scaleType\u6709\u5f88\u591a\u79cd\u53d6\u503c\uff0c\u5206\u522b\u662f\uff1a fitStart\uff0cfitCenter\uff0cfitEnd\uff0cfitXY\uff0ccenter\uff0ccenterCrop\uff0ccenterInside\uff0cmatrix\u3002</p> <p>\u5e26\u6709\u201cfit\u201d\u5b57\u6837\u7684\uff0c\u4f1a\u663e\u793a\u56fe\u7247\u7684\u5168\u90e8\u5185\u5bb9\u3002 fitStart\uff0cfitCenter\uff0cfitEnd\u56fe\u7247\u4f1a\u6309\u539f\u6bd4\u4f8b\u663e\u793a\u3002 \u56fe\u7247\u4f1a\u5f80\u6307\u5b9a\u7684\u65b9\u5411\u9760\u62e2\u3002 fitXY\u4f1a\u62c9\u4f38\u56fe\u7247\uff0c\u94fa\u6ee1\u6574\u4e2aImageView\u3002</p> <p>center\uff0ccenterCrop\uff0ccenterInside\u90fd\u662f\u5c3d\u53ef\u80fd\u663e\u793a\u56fe\u7247\u7684\u4e2d\u95f4\u90e8\u5206\u3002 center\u4e0d\u7f29\u653e\u56fe\u7247\uff0c\u5982\u679c\u56fe\u7247\u6bd4ImageView\u5927\uff0c\u5219\u4f1a\u663e\u793a\u56fe\u7247\u4e2d\u95f4\u7684\u90e8\u5206\u3002 centerCrop\uff0c\u5c3d\u53ef\u80fd\u591a\u7684\u663e\u793a\u56fe\u7247\u7684\u4e2d\u95f4\u90e8\u5206\u3002 centerInside\uff0c\u628a\u56fe\u7247\u653e\u5230\u4e2d\u95f4\u53bb\u663e\u793a\uff0c\u4e0d\u4f1a\u5c1d\u8bd5\u94fa\u6ee1ImageView\u3002</p> <p>matrix\u628a\u56fe\u7247\u94fa\u5728ImageView\u5de6\u4e0a\u89d2\uff0c\u5e76\u4e14\u4e0d\u7f29\u653e\u56fe\u7247\u3002</p> <p></p>"},{"location":"android/ui/view/imageView/overview/#alpha","title":"\u8bbe\u7f6e\u56fe\u7247\u900f\u660e\u5ea6\uff0calpha","text":"<p>\u8bbe\u7f6ealpha\u503c\uff0c\u80fd\u6539\u53d8\u6574\u4e2aImageView\u7684\u900f\u660e\u5ea6\u3002 <pre><code>    &lt;ImageView\n        style=\"@style/IvDemo1\"\n        android:layout_marginStart=\"20dp\"\n        android:alpha=\"0.9\"\n        android:scaleType=\"fitCenter\"\n        android:src=\"@drawable/pic_2_robots\" /&gt;\n</code></pre></p> <p>\u4e0b\u9762\u662falpha\u503c\u6539\u53d8\u7684\u4f8b\u5b50\u3002</p> <p></p> <p>gif\u56fe\u7247\u8be5\u600e\u4e48\u663e\u793a\u5462\uff1f</p> <p>\u5de5\u7a0b\u653e\u8fd9\u91cc\uff1a https://gitee.com/rustfisher/AndroidTutorial</p>"},{"location":"android/ui/view/import/view-in-activity-thinking/","title":"Android Activity \u4e0eView \u7684\u4e92\u52a8\u601d\u8003","text":"<p>\u539f\u6587\u4f5c\u8005\uff1a\u5c0f\u9c7c\u4eba\u7231\u7f16\u7a0b</p> <p>\u539f\u6587\u94fe\u63a5\uff1aAndroid Activity \u4e0eView \u7684\u4e92\u52a8\u601d\u8003 - \u7a00\u571f\u6398\u91d1</p>"},{"location":"android/ui/view/import/view-in-activity-thinking/#_1","title":"\u524d\u8a00","text":"<p>\u7cfb\u5217\u6587\u7ae0</p> <ul> <li>Android Activity \u4e0eView \u7684\u4e92\u52a8\u601d\u8003</li> <li>Android Activity \u751f\u547d\u5468\u671f\u8be6\u89e3\u53ca\u76d1\u542c</li> <li>Android onSaveInstanceState/onRestoreInstanceState \u539f\u6765\u8981\u8fd9\u4e48\u7406\u89e3</li> <li>Android Fragment \u8981\u4f60\u4f55\u7528\uff1f</li> <li>Android Activity/View/Window/Dialog/Fragment \u6df1\u5c42\u6b21\u5173\u8054(\u767d\u8bdd\u89e3\u6790)</li> </ul> <p>\u524d\u51e0\u5929\u6709\u4e2a\u5c0f\u4f19\u4f34\u95ee\u6211\u4e2a\u95ee\u9898\uff1a\u5f53Activity \u9000\u5230\u540e\u53f0\uff08\u672a\u9500\u6bc1\uff09\uff0c\u6b64\u65f6\u5bf9View \u8fdb\u884c requestLayout/invalidate \u64cd\u4f5c\uff0c\u4f1a\u6709\u6548\u679c\u5417\uff1f\u867d\u7136\u76f4\u89c9\u548c\u7ecf\u9a8c\u544a\u8bc9\u6211\u662f\u6ca1\u6709\u6548\u679c\u7684\uff0c\u4f46\u662f\u8fd8\u662f\u8981\u4ee5\u7406\u670d\u4eba\u3002\u672c\u7bc7\u5faa\u7740Activity \u751f\u547d\u5468\u671f\uff0c\u63a2\u7d22View \u4e0e\u5176\u4e92\u52a8\u7684\u7ec6\u8282\u3002 \u901a\u8fc7\u672c\u7bc7\u6587\u7ae0\uff0c\u4f60\u5c06\u4e86\u89e3\u5230\uff1a</p> <p>1\u3001Activity \u521b\u5efa\u65f6\u5982\u4f55\u5173\u8054View</p> <p>2\u3001Activity \u9500\u6bc1\u65f6\u5982\u4f55\u89e3\u9664\u5173\u8054View</p> <p>3\u3001Activity \u5904\u5728\u5176\u5b83\u72b6\u6001\u65f6\u5237\u65b0View</p>"},{"location":"android/ui/view/import/view-in-activity-thinking/#1activity-view","title":"1\u3001Activity \u521b\u5efa\u65f6\u5982\u4f55\u5173\u8054View","text":""},{"location":"android/ui/view/import/view-in-activity-thinking/#activity","title":"Activity \u751f\u547d\u5468\u671f","text":""},{"location":"android/ui/view/import/view-in-activity-thinking/#viewtree","title":"ViewTree \u7684\u521b\u5efa","text":"<p>\u4ece\u4e00\u4e2a\u6700\u7b80\u5355\u7684Android Hello World \u8bf4\u8d77\uff1a <pre><code>protected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_main);\n}\n</code></pre> setContentView()\u6307\u5b9a\u4e00\u4e2a\u5e03\u5c40\u6587\u4ef6\uff0c\u8868\u793a\u8981\u5728Activity\u4e0a\u5c55\u793a\u8fd9\u4e2a\u5e03\u5c40\u3002 \u8be5\u65b9\u6cd5\u6709\u4e24\u4e2a\u4e3b\u8981\u4f5c\u7528\uff1a</p> <ul> <li>1\u3001\u5c06\u81ea\u5b9a\u4e49\u7684\u5e03\u5c40(View)\u52a0\u5165\u5230ViewTree\u91cc\uff0c\u800cViewTree\u7684\u6839\u5c31\u662fDecorView\u3002</li> <li>2\u3001\u5c06Window(PhoneWindow)\u548cDecorView \u5173\u8054\u3002</li> </ul> <p>\u4e5f\u5c31\u662f\u8bf4\u5f53Activity \u5904\u5728\"Create\"\u72b6\u6001\u65f6\uff0c\u6574\u4e2aViewTree\u5df2\u7ecf\u88ab\u521b\u5efa\u4e86\u3002</p> <p>\u8fd9\u4e2a\u9636\u6bb5\u7684\u8c03\u7528\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u5176\u4e2d1\u30012 \u8868\u793a\u6267\u884c\u7684\u987a\u5e8f\uff0c1\u5148\u4e8e2\u6267\u884c\u3002</p> <p>\u53ef\u4ee5\u770b\u51fa\uff0c\u5728onCreate\u8c03\u7528\u4e4b\u524d\uff0cActivity \u5df2\u7ecf\u521b\u5efa\u4e86Window\u3002\u800c\u5728setContentView()\u65f6\uff0c\u521b\u5efa\u4e86ViewTree\uff0c\u5e76\u5c06Window\u4e0eDecorView\u5173\u8054\u4e0a\u4e86\u3002</p>"},{"location":"android/ui/view/import/view-in-activity-thinking/#viewtree-window","title":"\u5c06ViewTree \u6dfb\u52a0\u5230Window","text":"<p>\u6211\u4eec\u77e5\u9053\uff0cActivity \u5904\u5728\"Create\"\u72b6\u6001\u9636\u6bb5\uff0c\u9875\u9762\u5185\u5bb9\u662f\u770b\u4e0d\u5230\u7684\uff0c\u9700\u8981\u7b49\u5230\"Resume\"\u72b6\u6001\u624d\u80fd\u770b\u5230\uff0c\u8fd9\u662f\u600e\u4e48\u4e00\u56de\u4e8b\u5462\uff1f</p> <p></p> <p>\u5176\u4e2d1\u30012 \u8868\u793a\u6267\u884c\u7684\u987a\u5e8f\uff0c1\u5148\u4e8e2\u6267\u884c\u3002</p> <p>\u53ef\u4ee5\u770b\u51fa\uff0c\u5148\u6267\u884c\u4e86onResume\uff0c\u518d\u6267\u884caddView()\u64cd\u4f5c\u3002</p> <p>\u63d0\u53d6\u90e8\u5206\u4ee3\u7801\u5982\u4e0b\uff1a ActivityThread.java<pre><code>public void handleResumeActivity(IBinder token, boolean finalStateRequest, boolean isForward,\n                                    String reason) {\n    //...\n        //\u6700\u7ec8\u8c03\u7528\u5230onResume\n        final ActivityClientRecord r = performResumeActivity(token, finalStateRequest, reason);\n    //\u901a\u8fc7 r.window \u5224\u65ad\uff0c\u53ea\u6709Activity \u7b2c\u4e00\u6b21\u542f\u52a8\u624d\u4f1a\u8d70\u8fd9\n    if (r.window == null &amp;&amp; !a.mFinished &amp;&amp; willBeVisible) {\n        //\u53d6\u51faWindow\u8d4b\u503c\n        r.window = r.activity.getWindow();\n        //\u53d6\u51faDecorView\n        View decor = r.window.getDecorView();\n        decor.setVisibility(View.INVISIBLE);\n        ViewManager wm = a.getWindowManager();\n        WindowManager.LayoutParams l = r.window.getAttributes();\n        a.mDecor = decor;\n        l.type = WindowManager.LayoutParams.TYPE_BASE_APPLICATION;\n        l.softInputMode |= forwardBit;\n        if (a.mVisibleFromClient) {\n            if (!a.mWindowAdded) {\n                a.mWindowAdded = true;\n                //\u52a0\u5165\u5230Window\u91cc\n                wm.addView(decor, l);\n            } else {\n                ...\n            }\n        }\n    } else if (!willBeVisible) {\n        ...\n    }\n    ...\n}\n</code></pre></p> <p>\u5206\u522b\u5c06DecorView\u548cWindowManager\u53d6\u51fa\uff0c\u5c06\u4e24\u8005\u8fdb\u884c\u5173\u8054\uff0c\u5173\u8054\u7684\u52a8\u4f5c\u662f    WindowManager.addView()\u3002</p> <p>\u800caddView()\u6267\u884c\u7684\u7ed3\u679c\u662f\u5c06\u672c\u6b21\u52a8\u4f5c(\u6d4b\u91cf\u3001\u5e03\u5c40\u3001\u7ed8\u5236)\u63d0\u4ea4\u5230\u961f\u5217\u91cc\uff0c\u7b49\u5230\u6709\u5c4f\u5e55\u5237\u65b0\u4fe1\u53f7\u8fc7\u6765\u65f6\u5c06\u4f1a\u6267\u884c\u961f\u5217\u91cc\u7684\u52a8\u4f5c\uff0c\u6700\u7ec8\u5c06\u4f1a\u4eceDecorView\u5f00\u59cb\u6267\u884cVIew\u7684\u4e09\u5927\u6d41\u7a0b(\u6d4b\u91cf\u3001\u5e03\u5c40\u3001\u7ed8\u5236)\uff0c\u6267\u884c\u5b8c\u6bd5\u540e\u6211\u4eec\u5c06\u4f1a\u770b\u5230\u9875\u9762\u5c55\u793a\u3002</p> <p>\u8fd9\u4e5f\u5c31\u662f\u4e3a\u4ec0\u4e48\u5f88\u591a\u6587\u7ae0\u7ecf\u5e38\u8bf4\u7684\uff1a\u9875\u9762\u8981\u5230onResume()\u6267\u884c\u540e\u624d\u4f1a\u5c55\u793a\u3002</p> <p>\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff1a\u5728onResume()\u91cc\u80fd\u591f\u6b63\u5e38\u83b7\u53d6\u5e03\u5c40\u7684\u5bbd\u9ad8\u5417\uff1f</p> <p>\u7b54\u6848\u662f\uff1a\u4e0d\u80fd\u3002</p> <p>\u56e0\u4e3aonResume()\u548cWindowManager.addView()\u6267\u884c\u662f\u5728\u540c\u4e00\u4e2a\u7ebf\u7a0b\u91cc\u987a\u5e8f\u6267\u884c\u7684\uff0c\u6b64\u65f6addView()\u5e76\u6ca1\u6709\u6267\u884c\u3002\u66f4\u8fdb\u4e00\u6b65\u8bf4\uff0c\u5373\u4f7faddView()\u6267\u884c\u4e86\uff0c\u4e5f\u53ea\u662f\u5c06\u52a8\u4f5c\u653e\u5230\u961f\u5217\u91cc\u7b49\u5f85\u6267\u884c\u800c\u5df2\u3002 \u6709\u51e0\u79cd\u65b9\u5f0f\u53ef\u4ee5\u5728\u521d\u6b21\u8fdb\u5165Activity\u65f6\u83b7\u53d6\u5230\u5bbd\u9ad8\uff1a</p> <p>1\u3001\u5728onResume()\u91ccpost(Runnable)\uff0c\u5728Runnable\u91cc\u83b7\u53d6\u5bbd\u9ad8\u3002</p> <p>2\u3001\u91cd\u5199View\u7684onSizeChanged()\u65b9\u6cd5\uff0c\u5728\u8be5\u65b9\u6cd5\u91cc\u83b7\u53d6\u5bbd\u9ad8\u3002</p> <p>3\u3001\u76d1\u542cView.addOnLayoutChangeListener()\u65b9\u6cd5\u83b7\u53d6\u5bbd\u9ad8\u3002</p> <p>\u81f3\u6b64\uff0c\u968f\u7740Activity\u4ece\"Create\"\u72b6\u6001\u5230\"Resume\"\u72b6\u6001\uff0cView\u4e5f\u4ece\u521b\u5efa\u5230\u88ab\u6dfb\u52a0\u5230Window\u91cc\uff0c\u5e76\u6700\u7ec8\u5c55\u793a\u5728\u5c4f\u5e55\u4e0a\u3002</p>"},{"location":"android/ui/view/import/view-in-activity-thinking/#2activity-view","title":"2\u3001Activity \u9500\u6bc1\u65f6\u5982\u4f55\u89e3\u9664\u5173\u8054View","text":"<p>\u4f17\u6240\u5468\u77e5\uff0cActivity \u9500\u6bc1\u7684\u6700\u540e\u662f\u6267\u884c\u4e86onDestroy()\uff0c\u5f53Activity \u5904\u5728\"Destroy\"\u72b6\u6001\u65f6\uff0cView\u662f\u4ec0\u4e48\u60c5\u51b5\u5462\uff1f</p> <p></p> <p>\u53ef\u4ee5\u770b\u51fa\uff0c\u5148\u6267\u884c\u4e86onDestroy()\uff0c\u518d\u79fb\u9664\u4e86View\u3002</p> <p>\u63d0\u53d6\u90e8\u5206\u4ee3\u7801\u5982\u4e0b\uff1a</p> <p>ActivityThread.java<pre><code>public void handleDestroyActivity(IBinder token, boolean finishing, int configChanges,\n                                    boolean getNonConfigInstance, String reason) {\n    //\u6700\u7ec8\u6267\u884c\u5230onDestroy\n    ActivityClientRecord r = performDestroyActivity(token, finishing,\n            configChanges, getNonConfigInstance, reason);\n    if (r != null) {\n        WindowManager wm = r.activity.getWindowManager();\n        View v = r.activity.mDecor;\n        if (v != null) {\n            if (r.activity.mWindowAdded) {\n                if (r.mPreserveWindow) {\n                    r.window.clearContentView();\n                } else {\n                    //\u79fb\u9664View\n                    wm.removeViewImmediate(v);\n                }\n            }\n        }\n    }\n}\n</code></pre> \u81f3\u6b64\uff0c\u968f\u7740Activity \u6d41\u8f6c\u5230\"Destroy\"\u72b6\u6001\uff0cView\u4e5f\u88ab\u79fb\u9664\u51fa\u4e86Window\uff0c\u6b64\u65f6\u9875\u9762\u5df2\u7ecf\u4e0d\u53ef\u89c1\u3002</p>"},{"location":"android/ui/view/import/view-in-activity-thinking/#3activity-view","title":"3\u3001Activity \u5904\u5728\u5176\u5b83\u72b6\u6001\u65f6\u5237\u65b0View","text":"<p>\u4e0a\u4e24\u8282\u9610\u8ff0\u4e86Activity \u521b\u5efa\u4e0e\u9500\u6bc1\u5bf9\u5e94\u7684View\u7684\u64cd\u4f5c\uff0c\u63a5\u4e0b\u6765\u5206\u6790\u521b\u5efa\u4e0e\u9500\u6bc1\u72b6\u6001\u7684\u4e2d\u95f4\u72b6\u6001\u662f\u5982\u4f55\u8868\u73b0\u7684\u3002</p> <p>\u5206\u4e24\u79cd\u60c5\u51b5\uff1a</p> <p>1\u3001Activity \u5904\u5728\"Resume\"\u72b6\u6001\u65f6\uff0c\u5bf9View\u8fdb\u884c\u5237\u65b0\u64cd\u4f5c\u3002</p> <p>2\u3001Activity \u5904\u5728\"Stop\"\u72b6\u6001\u65f6\uff0c\u5bf9View\u8fdb\u884c\u5237\u65b0\u64cd\u4f5c\u3002</p> <p>\u6ce8\uff1a\u6b64\u5904\u7684\u5237\u65b0\u6307\u7684\u662fView.requestLayout()\u3001View.invalidate()\u3002</p>"},{"location":"android/ui/view/import/view-in-activity-thinking/#resume-view","title":"Resume \u72b6\u6001\u4e0b\u5237\u65b0View","text":"<p>\u8981\u5224\u65ad\u5237\u65b0\u662f\u5426\u751f\u6548\uff0c\u53ea\u9700\u8981\u76d1\u542cView\u7684onMeasure()\u3001onLayout()\u3001onDraw()\u65b9\u6cd5\u5373\u53ef\uff0c\u5b83\u4eec\u82e5\u662f\u88ab\u8c03\u7528\u4e86\uff0c\u8bf4\u660e\u5237\u65b0\u64cd\u4f5c\u6210\u529f\u4e86\u3002 \u4e3e\u4e2a\u7b80\u5355\u4f8b\u5b50\uff1a</p> <p><pre><code>public class MyTextView extends AppCompatTextView {\n    public MyTextView(Context context) {\n        super(context);\n    }\n\n    public MyTextView(Context context, AttributeSet attrs) {\n        super(context, attrs);\n    }\n\n    public MyTextView(Context context, AttributeSet attrs, int defStyleAttr) {\n        super(context, attrs, defStyleAttr);\n    }\n\n    @Override\n    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n        super.onMeasure(widthMeasureSpec, heightMeasureSpec);\n        Log.d(\"fish\", \"onMeasure called\");\n    }\n\n    @Override\n    protected void onLayout(boolean changed, int left, int top, int right, int bottom) {\n        super.onLayout(changed, left, top, right, bottom);\n        Log.d(\"fish\", \"onLayout called\");\n    }\n\n    @Override\n    protected void onDraw(Canvas canvas) {\n        super.onDraw(canvas);\n        Log.d(\"fish\", \"onDraw called\");\n    }\n}\n</code></pre> \u58f0\u660e\u4e00\u4e2a\u7c7b\uff0c\u7ee7\u627f\u81eaAppCompatTextView\uff0c\u91cd\u5199onMeasure()/onLayout()/onDraw() \u65b9\u6cd5\uff0c\u5e76\u6dfb\u52a0\u6253\u5370\u3002</p> <p>\u7136\u540e\u6d4b\u8bd5\u5237\u65b0\u64cd\u4f5c\uff0c\u770b\u6253\u5370\u7ed3\u679c\uff1a</p> <p><pre><code>protected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_flush_ui);\n\n    TextView textView = findViewById(R.id.tv);\n\n    findViewById(R.id.btn_request).setOnClickListener((v)-&gt;{\n        textView.requestLayout();\n    });\n\n    findViewById(R.id.btn_invalidate).setOnClickListener((v)-&gt;{\n        textView.invalidate();\n    });\n}\n</code></pre> \u6beb\u65e0\u7591\u95ee\uff0c\u5728\"Resume\"\u72b6\u6001\u4e0b\u5237\u65b0View\uff0c\u5f53\u8c03\u7528requestLayout()\u65f6\uff0conMeasure()\u3001onLayout()\u88ab\u6267\u884c\u4e86\uff1b\u5f53\u8c03\u7528invalidate()\u65f6\uff0conDraw()\u88ab\u6267\u884c\u4e86\u3002 \u56e0\u6b64\uff0c\u9875\u9762\u7684\u5237\u65b0\u64cd\u4f5c\u662f\u6210\u529f\u7684\u3002</p>"},{"location":"android/ui/view/import/view-in-activity-thinking/#stop-view","title":"Stop \u72b6\u6001\u4e0b\u5237\u65b0View","text":"<p>\u6539\u9020\u6d4b\u8bd5Demo:</p> <pre><code>private Runnable requestRunnable = new Runnable() {\n    @Override\n    public void run() {\n        Log.d(\"fish\", \"request layout call\");\n        textView.requestLayout();\n        textView.postDelayed(this, 1000);\n    }\n};\n</code></pre> <p>\u4e0d\u65ad\u5730\u5ef6\u8fdf\u8c03\u7528\uff1a</p> <p><pre><code>findViewById(R.id.btn_request).setOnClickListener((v)-&gt;{\n    textView.postDelayed(requestRunnable, 1000);\n});\n</code></pre> \u5728Activity \u5904\u5728\"Resume\"\u72b6\u6001\u65f6\uff0c\"onMeasure called\"\u4e00\u76f4\u5728\u6253\u5370\u3002</p> <p>\u6b64\u65f6\uff0c\u56de\u5230\u684c\u9762\uff0cActivity \u5904\u5728\"Stop\"\u72b6\u6001\uff0c\"onMeasure called\" \u6253\u5370\u6ca1\u6709\u4e86\u3002 \u8fd9\u8bf4\u660e\uff1a</p> <p>\u5f53Activity \u5904\u5728\"Stop\"\u72b6\u6001\u65f6\uff0c\u6b64\u65f6\u5bf9View\u7684\u5237\u65b0\u662f\u65e0\u6548\u7684\u3002</p> <p>\u4ee5\u4e0a\u662f\u9488\u5bf9requestLayout()\u7684\u64cd\u4f5c\uff0c\u5b9e\u9645\u4e0a\u5bf9\u4e8einvalidate()\u6548\u679c\u4ea6\u662f\u5982\u6b64\uff0c\u5c31\u4e0d\u91cd\u590d\u6f14\u793a\u4e86\uff0c\u53ef\u5728\u6587\u672b\u7684Demo\u94fe\u63a5\u91cc\u67e5\u770b\u3002</p>"},{"location":"android/ui/view/import/view-in-activity-thinking/#view","title":"View \u7684\u5237\u65b0\u539f\u7406","text":""},{"location":"android/ui/view/import/view-in-activity-thinking/#viewrequestlayout","title":"View.requestLayout()","text":"<p>\u4ece\u5b9e\u8df5\u4e2d\u9a8c\u8bc1\u4e86\u731c\u60f3\uff0c\u63a5\u4e0b\u6765\u63a2\u7a76\u5176\u539f\u7406\u3002 \u4e4b\u524d\u5728 Android invalidate/postInvalidate/requestLayout-\u5f7b\u5e95\u5398\u6e05 \u6709\u5206\u6790\u8fc7\u5237\u65b0\u539f\u7406\uff0c\u672c\u6b21\u518d\u6765\u7b80\u5355\u56de\u987e\u4e00\u4e0b\u3002</p> <p>View.java<pre><code>public void requestLayout() {\n    //...\n    //\u6dfb\u52a0\u6807\u8bb0\n    mPrivateFlags |= PFLAG_FORCE_LAYOUT;\n    mPrivateFlags |= PFLAG_INVALIDATED;\n\n    if (mParent != null &amp;&amp; !mParent.isLayoutRequested()) {\n        //\u82e5\u662f\u7236\u5e03\u5c40\u6ca1\u6709layout\uff0c\u5219\u4f1a\u518d\u6b21\u8fdb\u884c\n        //mParent \u4e3a\u7236\u5e03\u5c40\n        mParent.requestLayout();\n    }\n}\n</code></pre> \u53ef\u4ee5\u770b\u51fa\uff0c\u4e00\u76f4\u8c03\u7528\u7236\u5e03\u5c40\u7684requestLayout\uff0c\u8c03\u7528\u7684\u7ec8\u70b9\u662f\uff1a</p> <p>ViewRootImpl.java<pre><code>    public void requestLayout() {\n        if (!mHandlingLayoutInLayoutRequest) {\n            checkThread();\n            mLayoutRequested = true;\n            scheduleTraversals();\n        }\n    }\n</code></pre> \u6b64\u5904\u5c31\u63d0\u4ea4\u4e86\u5237\u65b0\u64cd\u4f5c\u5230\u961f\u5217\u91cc\uff0c\u7b49\u5f85\u5c4f\u5e55\u5237\u65b0\u4fe1\u53f7\u7684\u5230\u6765\u3002</p> <p></p> <p>\u4ece\u5b9e\u9a8c\u7684\u7ed3\u679c\u6765\u770b\uff0c\u53ef\u4ee5\u80af\u5b9a\u7684\u662frequestLayout \u8bf7\u6c42\u6ca1\u6709\u5206\u53d1\u5230ViewRootImpl\uff0c\u751a\u81f3\u5927\u80c6\u731c\u6d4bTextView.reqeustLayout()\u8bf7\u6c42\u6ca1\u6709\u4ea4\u7ed9\u7236\u5e03\u5c40\u3002 \u800c\u6b64\u5904\u5224\u65ad\u7684\u4f9d\u636e\u662f\uff1a</p> <pre><code>mParent.isLayoutRequested()\n</code></pre> <p>\u8be5\u65b9\u6cd5\u5b9e\u73b0\u4e3a\uff1a</p> <pre><code>public boolean isLayoutRequested() {\n    return (mPrivateFlags &amp; PFLAG_FORCE_LAYOUT) == PFLAG_FORCE_LAYOUT;\n}\n</code></pre> <p>\u663e\u800c\u6613\u89c1\uff0c\u5176\u5b9e\u5c31\u662f\u5224\u65ad\u6807\u8bb0\u4f4d\uff1aPFLAG_FORCE_LAYOUT\u3002</p> <p>\u63a5\u7740\u6765\u5bfb\u627e\u8be5\u6807\u8bb0\u4f4d\u5728\u54ea\u91cc\u6539\u53d8\u4e86\u3002\u6b64\u5904\u76f4\u63a5\u8bf4\u7ed3\u8bba\uff0c\u66f4\u8be6\u7ec6\u7684\u5206\u6790\u8bf7\u79fb\u6b65\uff1a</p> <p>Android \u81ea\u5b9a\u4e49View\u4e4bMeasure\u8fc7\u7a0b</p> <p>1\u3001\u6dfb\u52a0\u8be5\u6807\u8bb0\u7684\u65f6\u673a\u5728View.requestLayout\u65f6\u3002</p> <p>2\u3001\u6e05\u9664\u8be5\u6807\u8bb0\u7684\u65f6\u673a\u662fView.layout()\u65f6\u3002</p> <p>\u5f53View.layout \u6267\u884c\u540e\uff0c\u8bf4\u660eView\u7684\u6446\u653e\u4f4d\u7f6e\u5df2\u7ecf\u786e\u5b9a\uff0c\u56e0\u6b64\u6807\u8bb0\u53ef\u4ee5\u6e05\u7a7a\u4e86\u3002</p> <p>\u6dfb\u52a0\u6807\u8bb0\u548c\u6e05\u9664\u6807\u8bb0\u662f\u6210\u5bf9\u51fa\u73b0\u7684\uff0crequestLayout \u6ca1\u6709\u63d0\u4ea4\u7ed9\u7236\u5e03\u5c40\uff0c\u8bf4\u660ePFLAG_FORCE_LAYOUT \u53ea\u662f\u6dfb\u52a0\u4e86\uff0c\u6ca1\u6709\u88ab\u6e05\u9664\uff0c\u4e5f\u5c31\u662f\u8bf4\u7236\u5e03\u5c40\u7684layout\u64cd\u4f5c\u6ca1\u6709\u6267\u884c\uff0c\u5f53\u7136\u5b83\u7684measure\u64cd\u4f5c\u4e5f\u6ca1\u6267\u884c</p> <p>\u95ee\u9898\u5c31\u8f6c\u5230\u4e86\uff1a\u4e3a\u4ec0\u4e48\u7236\u5e03\u5c40\u6ca1\u6709\u6267\u884cmeasure/layout\uff1f</p> <p>\u5bfb\u6839\u6eaf\u6d41\uff0c\u4e09\u5927\u6d41\u7a0b\u7684\u53d1\u8d77\u662f\u5728ViewRootImpl\u5b9e\u73b0\u7684\uff0c\u91cd\u70b9\u65b9\u6cd5\uff1aperformTraversals() \u800c\u8be5\u65b9\u6cd5\u91cc\u5206\u522b\u6267\u884c\u4e86performMeasure\u3001performLayout\u3001performDraw\u3002\u6700\u7ec8\u8fd9\u4e9b\u65b9\u6cd5\u6267\u884c\u5230onMeasure\u3001onLayout\u3001onDraw \u91cc\u3002 \u6267\u884cperformMeasure \u524d\u63d0\u6761\u4ef6\u662f\uff1a</p> <pre><code>boolean layoutRequested = mLayoutRequested &amp;&amp; (!mStopped || mReportNextDraw);\n</code></pre> <p>\u6267\u884cperformLayout \u524d\u63d0\u6761\u4ef6\u662f\uff1a</p> <pre><code>final boolean didLayout = layoutRequested &amp;&amp; (!mStopped || mReportNextDraw);\n</code></pre> <p>\u6211\u4eec\u6ce8\u610f\u5230\u4e86mStopped \u53d8\u91cf\uff0c\u5f53mStopped=false\u7684\u65f6\u5019\u624d\u4f1a\u6267\u884cperformMeasure\u3001performLayout\u3002</p> <p>\u53ea\u9700\u8981\u627e\u5230mStopped\u4ec0\u4e48\u65f6\u5019\u53d8\u4e3atrue\uff0c\u7b54\u6848\u5c31\u627e\u5230\u4e86\u3002</p> ViewRootImpl.java<pre><code>void setWindowStopped(boolean stopped) {\n    checkThread();\n    //\u4e0d\u4e00\u81f4\u624d\u4f1a\u6267\u884c\uff0c\u6b64\u5904\u4f1a\u6267\u884c\u4e24\u6b21\n    if (mStopped != stopped) {\n        //\u4fee\u6539mStopped\n        mStopped = stopped;\n        final ThreadedRenderer renderer = mAttachInfo.mThreadedRenderer;\n        if (renderer != null) {\n            renderer.setStopped(mStopped);\n        }\n        if (!mStopped) {\n            //\u5982\u679c\u4e0d\u662f\u505c\u6b62\uff0c\u90a3\u4e48\u5c31\u662f\u5f00\u59cb\n            mNewSurfaceNeeded = true;\n            //\u91cd\u65b0\u63d0\u4ea4\u5237\u65b0\u52a8\u4f5c\u5230\u961f\u5217\u91cc\u3002\n            scheduleTraversals();\n        } else {\n            //\u91ca\u653e\u8d44\u6e90\n            if (renderer != null) {\n                renderer.destroyHardwareResources(mView);\n            }\n        }\n        ...\n        if (mStopped) {\n            if (mSurfaceHolder != null &amp;&amp; mSurface.isValid()) {\n                notifySurfaceDestroyed();\n            }\n            //\u9500\u6bc1surface\n            destroySurface();\n        }\n    }\n}\n</code></pre> <ul> <li>1\u3001\u5f53Activity \u5904\u5728\"Stop\"\u72b6\u6001\u65f6\uff0cAMS \u53d1\u51fa\u6307\u4ee4\u7ed9ActivityThread\uff0c\u6700\u7ec8\u5c06\u4f1a\u6267\u884c\u5230ViewRootImpl. setWindowStopped(boolean stopped)\uff0c\u5c06\u6210\u5458\u53d8\u91cfmStopped\u7f6e\u4e3afalse\u3002</li> <li>2\u3001\u5f53\u8981\u6267\u884cView\u7684\u4e09\u5927\u6d41\u7a0b\u65f6\uff0c\u53d1\u73b0mStopped==false\uff0c\u8868\u793a\u5f53\u524dActivity \u5df2\u7ecf\u5904\u5728\"Stop\"\u72b6\u6001\u4e86\uff0c\u56e0\u6b64\u4e0d\u4f1a\u6267\u884c\u5237\u65b0\u64cd\u4f5c\u4e86\u3002</li> </ul> <p>\u4ee5\u4e0a\u89e3\u91ca\u4e86\uff1a</p> <p>\u5f53Activity\u5904\u5728\"Stop\"\u72b6\u6001\u65f6\uff0cView.requestLayout()\u662f\u6ca1\u6709\u6548\u679c\u7684\u539f\u56e0\u3002</p>"},{"location":"android/ui/view/import/view-in-activity-thinking/#viewinvalidate","title":"View.invalidate()","text":"<p>\u4e0eView.requestLayout \u7c7b\u4f3c\uff1a</p> <p>View.java<pre><code>void invalidateInternal(int l, int t, int r, int b, boolean invalidateCache,\n                        boolean fullInvalidate) {\n    //\u5224\u65ad\u6807\u8bb0\n    if ((mPrivateFlags &amp; (PFLAG_DRAWN | PFLAG_HAS_BOUNDS)) == (PFLAG_DRAWN | PFLAG_HAS_BOUNDS)\n            || (invalidateCache &amp;&amp; (mPrivateFlags &amp; PFLAG_DRAWING_CACHE_VALID) == PFLAG_DRAWING_CACHE_VALID)\n            || (mPrivateFlags &amp; PFLAG_INVALIDATED) != PFLAG_INVALIDATED\n            || (fullInvalidate &amp;&amp; isOpaque() != mLastIsOpaque)) {\n        if (fullInvalidate) {\n            mLastIsOpaque = isOpaque();\n            //\u6e05\u9664\u6807\u8bb0\n            mPrivateFlags &amp;= ~PFLAG_DRAWN;\n        }\n        ...\n        final ViewParent p = mParent;\n        if (p != null &amp;&amp; ai != null &amp;&amp; l &lt; r &amp;&amp; t &lt; b) {\n            final Rect damage = ai.mTmpInvalRect;\n            damage.set(l, t, r, b);\n            //\u8c03\u7528\u7236\u5e03\u5c40\n            p.invalidateChild(this, damage);\n        }\n    }\n}\n</code></pre> \u4e5f\u662f\u901a\u8fc7\u5c42\u5c42\u8c03\u7528\uff0c\u6700\u7ec8\u5230ViewRootImpl.java\u91cc\u7684\uff1a</p> ViewRootImpl.java<pre><code>void invalidate() {\n    mDirty.set(0, 0, mWidth, mHeight);\n    if (!mWillDrawSoon) {\n        //\u63d0\u4ea4\u5230\u5237\u65b0\u961f\u5217\uff0c\u7b49\u5f85\u5c4f\u5e55\u4fe1\u53f7\u7684\u5230\u6765\n        scheduleTraversals();\n    }\n}\n</code></pre> <p></p> <p>\u5f53Activity \u5904\u5728\"Stop\"\u72b6\u6001\u65f6\uff0c\u56e0\u4e3aView\u7684PFLAG_DRAWN\u6807\u8bb0\u6ca1\u6709\u88ab\u6dfb\u52a0\uff0c\u6240\u4ee5\u5728invalidateInternal()\u65b9\u6cd5\u91cc\u5c31\u4e0d\u4f1a\u518d\u6267\u884cp.invalidateChild(this, damage); \u800cPFLAG_DRAWN \u6807\u8bb0\u662f\u6267\u884c\u4e86View.draw(x1,x2,x3)\u65b9\u6cd5\u65f6\u6dfb\u52a0\u7684\uff0c\u8868\u793a\u8fd9\u4e00\u6b21\u7684\u7ed8\u5236\u52a8\u4f5c\u5df2\u7ecf\u5b8c\u6210\u3002</p> <p>\u4e0erequestLayout \u4e00\u6837\uff0c\u56e0\u4e3adraw\u8fc7\u7a0b\u6ca1\u6709\u88ab\u6267\u884c\uff0c\u56e0\u6b64\u770b\u770b\u6267\u884cdraw\u8fc7\u7a0b\u7684\u524d\u7f6e\u6761\u4ef6\uff1a</p> ViewRootImpl.java<pre><code>boolean cancelDraw = mAttachInfo.mTreeObserver.dispatchOnPreDraw() || !isViewVisible;\n</code></pre> <p>\u800c\u51b3\u5b9aisViewVisible\u7684\u56e0\u7d20\u662f\uff1amAppVisible\u3002</p> <p>\u8be5\u53d8\u91cf\u88ab\u8d4b\u503c\u7684\u5730\u65b9\uff1a</p> ViewRootImpl.java<pre><code>void handleAppVisibility(boolean visible) {\n    if (mAppVisible != visible) {\n        mAppVisible = visible;\n        mAppVisibilityChanged = true;\n        //\u63d0\u4ea4\u5237\u65b0\u52a8\u4f5c\n        scheduleTraversals();\n        if (!mAppVisible) {\n            WindowManagerGlobal.trimForeground();\n        }\n    }\n}\n</code></pre> <p>\u5f53Activity \u5904\u5728\"Pause\"\u72b6\u6001\u65f6\uff0cAMS \u53d1\u51fa\u89c6\u56fe\u53ef\u89c1\u6027\u66f4\u6539\u7684\u547d\u4ee4\uff0c\u6700\u7ec8\u4f1a\u6267\u884c\u5230ViewRootImp.handleAppVisibility()\uff0c\u6b64\u65f6mAppVisible==false\uff0c\u8868\u793aApp\u5df2\u7ecf\u4e0d\u53ef\u89c1\u3002 \u800c\u6267\u884cperfromDraw()\u524d\u7f6e\u6761\u4ef6\u662fApp\u53ef\u89c1\u3002</p> <p>\u5f53Activity\u5904\u5728\"Pause\"\u3001\"Stop\"\u72b6\u6001\u65f6\uff0cView.invalidate()\u662f\u6ca1\u6709\u6548\u679c\u7684\u539f\u56e0\u3002</p> <p>\u6ce8\u610f\uff1a\u6b64\u5904\u7684Pause \u72b6\u6001\u5e94\u8be5\u6392\u9664\u5176\u4e0a\u5c42\u6709\u900f\u660e\u975e\u5168\u5c4f\u7684Activity\uff0c\u6b64\u79cd\u573a\u666f\u4e0b\u662f\u4e0d\u4f1a\u8c03\u7528ViewRootImp.handleAppVisibility()</p>"},{"location":"android/ui/view/import/view-in-activity-thinking/#stopstartresume-view","title":"\u4eceStop\u5230Start/Resume View \u662f\u5982\u4f55\u5237\u65b0\u7684","text":"<p>\u4ece\u4e0a\u9762\u7684\u5206\u6790\u53ef\u77e5\uff0c\u5f53Activity \u53d8\u4e3a\"Stop\"\u72b6\u6001\u65f6\uff0c\u663e\u793a\u6709\u5173\u7684Surface\u3001Render\u90fd\u5df2\u7ecf\u88ab\u9500\u6bc1\u3002\u5f53\u4ece\"Stop\"\u72b6\u6001\u56de\u5230\"Resume\"\u72b6\u6001\u65f6\uff0c\u8fd9\u4e9b\u53c8\u662f\u600e\u4e48\u89e6\u53d1\u7684\u5462\uff1f</p> <p>\u4eceViewRootImpl.setWindowStopped()\u4e0eViewRootImpl.handleAppVisibility() \u65b9\u6cd5\u7684\u5b9e\u73b0\u53ef\u77e5\uff1a</p> <p>1\u3001\u5728\u53ef\u89c1\u65f6ViewRootImpl.setWindowStopped()\u4f1a\u8c03\u7528scheduleTraversals()\u3002</p> <p>2\u3001ViewRootImpl.handleAppVisibility() \u5219\u662f\u6bcf\u6b21\u8c03\u7528\u90fd\u4f1a\u89e6\u53d1scheduleTraversals() \u8c03\u7528\u3002</p> <p>\u800cscheduleTraversals()\u4f1a\u89e6\u53d1\u4e09\u5927\u6d41\u7a0b(Measure/Layout/Draw)\uff0c\u8fd9\u6837\u5f53\u6211\u4eecApp\u4ece\u540e\u53f0\u9000\u5230\u524d\u53f0\u65f6\uff0c\u754c\u9762\u5c31\u5b8c\u6210\u4e86\u6e32\u67d3\u5e76\u5c55\u793a\u4e86\u3002</p> <p>\u672c\u6587\u57fa\u4e8eAndroid 10.0</p> <p>Demo \u5730\u5740\uff1a\u6d4b\u8bd5\u5237\u65b0</p> <p>\u63a5\u4e0b\u6765\u5c06\u91cd\u70b9\u5206\u6790Activity/Fragment\u7684\u6df1\u5c42\u6b21\u5173\u8054\uff0c\u4ee5\u53ca\u6574\u4e2a\u751f\u547d\u5468\u671f\u7684\u8054\u52a8\uff0c\u6700\u540e\u81ea\u7136\u800c\u7136\u5c31\u4f1a\u8fdb\u5165Jetpack\u5206\u6790\u3002</p>"},{"location":"android/ui/view/progressbar/custom_colorful/","title":"\u6761\u7eb9\u8fdb\u5ea6\u6761","text":"<p>\u76f8\u5173\u4ee3\u7801\u8bf7\u53c2\u9605\uff1a https://github.com/RustFisher/aboutView/blob/master/app/src/main/java/com/rust/aboutview/activity/RoundCornerActivity.java</p> <p>\u7d20\u6750\u56fe </p> <p>\u5982\u679c\u7528shape\u6216\u8005.9\u56fe\u7247\u4e0d\u592a\u597d\u5904\u7406\u8fd9\u4e2a\u6761\u7eb9\u3002\u8f6c\u53d8\u601d\u8def\uff0c\u653e\u7f6e2\u5f20\u56fe\u7247\u3002\u4e00\u5f20\u4f5c\u4e3a\u80cc\u666f\uff08\u5e95\uff0cbottom\uff09\uff0c\u4e00\u5f20\u4f5c\u4e3a\u8fdb\u5ea6\u6761\u56fe\u7247\uff08cover\uff09\u3002 \u8fdb\u5ea6\u6539\u53d8\u65f6\uff0c\u6539\u53d8\u4e0a\u9762\u56fe\u7247\u7684\u5bbd\u5ea6\u3002</p> <p>\u8fd9\u5c31\u8981\u6c42\u4e0a\u9762\u7684\u56fe\u7247\u662f\u5706\u89d2\u7684\u3002\u81ea\u5b9a\u4e49ImageView\uff0c\u8c03\u7528<code>canvas.clipPath</code>\u6765\u5207\u5272\u753b\u5e03\u3002 <pre><code>public class RoundCornerImageView extends android.support.v7.widget.AppCompatImageView {\n    private float mRadius = 18;\n    private Path mClipPath = new Path();\n    private RectF mRect = new RectF();\n\n    public RoundCornerImageView(Context context) {\n        super(context);\n    }\n\n    public RoundCornerImageView(Context context, AttributeSet attrs) {\n        super(context, attrs);\n    }\n\n    public RoundCornerImageView(Context context, AttributeSet attrs, int defStyle) {\n        super(context, attrs, defStyle);\n    }\n\n    public void setRadiusDp(float dp) {\n        mRadius = dp2px(dp, getResources());\n        postInvalidate();\n    }\n\n    public void setRadiusPx(int px) {\n        mRadius = px;\n        postInvalidate();\n    }\n\n    @Override\n    protected void onDraw(Canvas canvas) {\n        mRect.set(0, 0, this.getWidth(), this.getHeight());\n        mClipPath.reset(); // remember to reset path\n        mClipPath.addRoundRect(mRect, mRadius, mRadius, Path.Direction.CW);\n        canvas.clipPath(mClipPath);\n        super.onDraw(canvas);\n    }\n\n    private float dp2px(float value, Resources resources) {\n        return TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, value, resources.getDisplayMetrics());\n    }\n}\n</code></pre> \u6bcf\u6b21\u7ed8\u5236\u90fd\u5207\u5272\u4e00\u6b21\u5706\u89d2\u3002\u8bb0\u5f97\u8c03\u7528<code>Path.reset()</code>\u65b9\u6cd5\u3002</p> <p>\u56de\u5230\u6211\u4eec\u8981\u7684\u8fdb\u5ea6\u6761\u3002\u5e03\u5c40\u6587\u4ef6\u4e2d\u653e\u7f6e\u597d\u5c42\u53e0\u7684\u56fe\u7247\u3002 <pre><code>    &lt;RelativeLayout\n        android:id=\"@+id/progress_layout\"\n        android:layout_width=\"190dp\"\n        android:layout_height=\"10dp\"\n        android:layout_centerInParent=\"true\"&gt;\n\n        &lt;ImageView\n            android:id=\"@+id/p_bot_iv\"\n            android:layout_width=\"190dp\"\n            android:layout_height=\"10dp\"\n            android:src=\"@drawable/shape_round_corner_bottom\" /&gt;\n\n        &lt;com.rustfisher.view.RoundCornerImageView\n            android:id=\"@+id/p_cover_iv\"\n            android:layout_width=\"100dp\"\n            android:layout_height=\"10dp\"\n            android:scaleType=\"centerCrop\"\n            android:src=\"@drawable/pic_cover_blue_white\" /&gt;\n\n    &lt;/RelativeLayout&gt;\n</code></pre></p> <p>\u9700\u8981\u5728\u4ee3\u7801\u4e2d\u52a8\u6001\u5730\u6539\u53d8cover\u7684\u5bbd\u5ea6\uff1bdialog\u4e2d\u63d0\u4f9b\u5982\u4e0b\u65b9\u6cd5\u6539\u53d8<code>LayoutParams</code> <pre><code>    public void updatePercent(int percent) {\n        mPercent = percent;\n        mPercentTv.setText(String.format(Locale.CHINA, \"%2d%%\", mPercent));\n        float percentFloat = mPercent / 100.0f;\n        final int ivWidth = mBotIv.getWidth();\n        RelativeLayout.LayoutParams lp = (RelativeLayout.LayoutParams) mProgressIv.getLayoutParams();\n        int marginEnd = (int) ((1 - percentFloat) * ivWidth);\n        lp.width = ivWidth - marginEnd;\n        mProgressIv.setLayoutParams(lp);\n        mProgressIv.postInvalidate();\n    }\n</code></pre></p> <p>\u663e\u793a\u51fadialog\u5e76\u4f20\u5165\u8fdb\u5ea6\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u6548\u679c\u4e86\u3002</p>"},{"location":"android/ui/view/recyclerView/clipToPadding_use/","title":"clipToPadding\u4ecb\u7ecd","text":"<p>clipToPadding \u9ed8\u8ba4\u662ftrue\u3002\u5b50view\u4f1a\u88abrecyclerView\u7684padding\u5f71\u54cd\u3002</p> <p>\u5982\u679c\u8bbe\u7f6e\u4e3afalse\uff0c\u5b50\u9879\u4f1a\u5ffd\u7565\u8c03recyclerView\u7684padding\u503c\u3002</p> <p>item\u7684layout\u8bbe\u7f6e\u4e86marginStart\u548cmarginEnd\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"60dp\"\n    android:layout_marginStart=\"0dp\"\n    android:layout_marginEnd=\"10dp\"\n    android:elevation=\"2dp\"\n    android:orientation=\"horizontal\"&gt;\n    &lt;!-- ... --&gt;\n&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;\n</code></pre></p> <p>layout\u4e2d\u7684RecyclerView <pre><code>&lt;androidx.recyclerview.widget.RecyclerView\n    android:id=\"@+id/todo_re_view\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:clipToPadding=\"false\"\n    android:paddingStart=\"20dp\"\n    android:paddingEnd=\"10dp\" /&gt;\n</code></pre></p> <p>\u4e00\u4e2a\u6a2a\u5411\u6ed1\u52a8\u7684\u793a\u4f8b\uff0c\u521a\u5f00\u59cb</p> <p></p> <p>\u6ed1\u52a8\u540e</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u5b50\u9879\u65e0\u89c6\u4e86RecyclerView\u7684paddingStart\u548cpaddingEnd\uff0c\u5b8c\u6574\u5730\u4f7f\u7528\u4e86RecyclerView\u7684\u5bbd\u5ea6\u3002</p>"},{"location":"android/ui/view/recyclerView/demo1/","title":"Android RecyclerView\u5b9e\u9645\u4f7f\u7528 - \u5236\u4f5c\u4e00\u4e2a\u5217\u8868","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-7-27 <ul> <li>2022-7-27 \u4fee\u6539\u5217\u8868</li> </ul> <p>\u793a\u4f8b\uff0c\u7528RecyclerView\u505a\u51fa\u4e00\u4e2a\u5217\u8868\u3002\u663e\u793a\u6d4b\u8bd5\u6570\u636e\u3002</p> <p>\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u5982\u4f55\u7528RecyclerView\u663e\u793a\u4e00\u5217\u6570\u636e\u3002\u8fd9\u91cc\u6211\u4eec\u505a\u51fa\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\u3002\u5c3d\u91cf\u505a\u597d\u770b\u4e00\u70b9\u3002</p> <p>\u8fd9\u4e2a\u793a\u4f8b\u4f1a\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <ul> <li>1.\u786e\u5b9a\u6570\u636e\u3002\u8fd9\u91cc\u7528\u7684\u662f\u6a21\u62df\u6570\u636e\u3002</li> <li>2.\u8bbe\u8ba1UI\u548c\u8868\u73b0\u5f62\u5f0f\u3002</li> <li>3.\u7f16\u5199layout\u4e0e\u9002\u914d\u5668\u3002</li> </ul>"},{"location":"android/ui/view/recyclerView/demo1/#_1","title":"\u6a21\u62df\u6570\u636e","text":"<p>\u5de7\u5987\u96be\u4e3a\u65e0\u7c73\u4e4b\u708a\uff0c\u6a21\u62df\u6570\u636e\u5c31\u662f\u6a21\u62df\u9700\u6c42\u3002</p> <p>\u65b0\u5efa\u4e00\u4e2a\u7c7bDataTest\uff0c\u8bbe\u8ba14\u4e2a\u5c5e\u6027\u3002 <pre><code>public class DataTest {\n    private String timezone;\n    private int number;\n    private int personCount;\n    private int count;\n\n    public DataTest(String timezone, int number, int personCount, int count) {\n        this.timezone = timezone;\n        this.number = number;\n        this.personCount = personCount;\n        this.count = count;\n    }\n// getter setter...\n}\n</code></pre></p>"},{"location":"android/ui/view/recyclerView/demo1/#item","title":"\u8bbe\u8ba1item\u7684\u5e03\u5c40","text":"<p>\u8bbe\u8ba1UI\uff0c\u5728\u4e00\u884c\u91cc\u663e\u793a4\u4e2a\u5c5e\u6027\u503c\u3002item\u7528\u7684\u662f<code>item_recy2.xml</code>\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:orientation=\"horizontal\"&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv1\"\n        style=\"@style/RePage2Header\"\n        android:layout_marginEnd=\"@dimen/re_2_half_gap\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv2\"\n        style=\"@style/RePage2Header\"\n        android:layout_marginStart=\"@dimen/re_2_half_gap\"\n        android:layout_marginEnd=\"@dimen/re_2_half_gap\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv3\"\n        style=\"@style/RePage2Header\"\n        android:layout_marginStart=\"@dimen/re_2_half_gap\"\n        android:layout_marginEnd=\"@dimen/re_2_half_gap\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv4\"\n        style=\"@style/RePage2Header\"\n        android:layout_marginStart=\"@dimen/re_2_half_gap\" /&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre></p> <p>\u672c\u4f8b\u4e2d\u7684ui\u6211\u4eec\u81ea\u7531\u53d1\u6325\u3002</p>"},{"location":"android/ui/view/recyclerView/demo1/#_2","title":"\u51c6\u5907\u989c\u8272\uff0c\u5c3a\u5bf8\u7b49\u8d44\u6e90","text":"<p>\u76f8\u5173\u7684style\u548c\u989c\u8272\uff0c\u5c3a\u5bf8\u914d\u7f6e\u6587\u4ef6\uff0c\u5728<code>res/values</code>\u76ee\u5f55\u4e0b\u3002</p> <p>\u5173\u4e8e\u8d44\u6e90\u6587\u4ef6\uff0c\u53ef\u4ee5\u53c2\u8003res\u8d44\u6e90\u76ee\u5f55\u7b80\u4ecb</p> <p>style\u6587\u4ef6<code>style.xml</code>\u3002 <pre><code>&lt;style name=\"RePage2Header\"&gt;\n    &lt;item name=\"android:layout_width\"&gt;0dp&lt;/item&gt;\n    &lt;item name=\"android:layout_height\"&gt;40dp&lt;/item&gt;\n    &lt;item name=\"android:layout_weight\"&gt;2&lt;/item&gt;\n    &lt;item name=\"android:textColor\"&gt;#ffffff&lt;/item&gt;\n    &lt;item name=\"android:gravity\"&gt;center&lt;/item&gt;\n    &lt;item name=\"android:background\"&gt;@color/rePage2Item&lt;/item&gt;\n&lt;/style&gt;\n</code></pre> \u6211\u4eec\u7ed9layout\u91cc\u7684\u6bcf\u4e2aTextView\u90fd\u8bbe\u7f6e\u4e86<code>layout_width</code>\u4e3a0dp\u3002\u662f\u4e3a\u4e86\u4f7f\u7528<code>layout_weight</code>\u5c5e\u6027\u3002 \u8ba9\u5b83\u4eec4\u4e2aTextView\u6309\u6bd4\u4f8b\u5206\u5272\u7236View\u7684\u5bbd\u5ea6\u3002</p> <p>\u8fd9\u91cc\u7684\u5206\u5272\u7528\u5230\u4e86LinearLayout\u7684\u5206\u5272\u5360\u6bd4\u7279\u6027\u3002</p> <p>\u989c\u8272\u914d\u7f6e\u6587\u4ef6<code>color.xml</code>\uff0c\u6dfb\u52a0\u5982\u4e0b\u989c\u8272\u8bbe\u7f6e\u3002 <pre><code>&lt;color name=\"rePage2Item\"&gt;#082941&lt;/color&gt;\n</code></pre></p> <p>\u5c3a\u5bf8\u914d\u7f6e<code>dimens.xml</code>\u3002 <pre><code>&lt;dimen name=\"re_2_gap\"&gt;4dp&lt;/dimen&gt;\n&lt;dimen name=\"re_2_half_gap\"&gt;2dp&lt;/dimen&gt;\n</code></pre></p>"},{"location":"android/ui/view/recyclerView/demo1/#viewholder","title":"\u8bbe\u8ba1ViewHolder","text":"<p>\u8d44\u6e90\u6587\u4ef6\u548clayout\u51c6\u5907\u59a5\u5f53\uff0c\u5f00\u59cb\u5199\u5bf9\u5e94\u7684viewHolder\u3002\u8fd9\u91cc\u4e5f\u662f\u628aVH\u7c7b\u548cAdapter\u7c7b\u653e\u5728activity\u7c7b\u91cc\u9762\u3002 <pre><code>private class VH extends RecyclerView.ViewHolder {\n    TextView tv1;\n    TextView tv2;\n    TextView tv3;\n    TextView tv4;\n\n    public VH(@NonNull View itemView) {\n        super(itemView);\n        tv1 = itemView.findViewById(R.id.tv1);\n        tv2 = itemView.findViewById(R.id.tv2);\n        tv3 = itemView.findViewById(R.id.tv3);\n        tv4 = itemView.findViewById(R.id.tv4);\n    }\n}\n</code></pre></p>"},{"location":"android/ui/view/recyclerView/demo1/#adapter","title":"\u8bbe\u8ba1Adapter\u7c7b","text":"<p>\u9002\u914d\u5668Adapter\u7c7b\u3002 <pre><code>private class Adapter extends RecyclerView.Adapter&lt;VH&gt; {\n\n    private List&lt;DataTest&gt; dataList = new ArrayList&lt;&gt;();\n\n    public Adapter() {\n    }\n\n    public void setDataList(List&lt;DataTest&gt; dataList) {\n        this.dataList = dataList; // \u6700\u597d\u8fdb\u884c\u5224\u7a7a\u64cd\u4f5c\n        notifyDataSetChanged();\n    }\n\n    @NonNull\n    @Override\n    public VH onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\n        return new VH(LayoutInflater.from(parent.getContext()).inflate(R.layout.item_recy2, parent, false));\n    }\n\n    @Override\n    public void onBindViewHolder(@NonNull VH holder, int position) {\n        DataTest dataTest = dataList.get(position);\n        holder.tv1.setText(dataTest.getTimezone());\n        holder.tv2.setText(String.valueOf(dataTest.getNumber()));\n        holder.tv3.setText(String.valueOf(dataTest.getPersonCount()));\n        holder.tv4.setText(String.valueOf(dataTest.getCount()));\n    }\n\n    @Override\n    public int getItemCount() {\n        return dataList.size();\n    }\n}\n</code></pre></p>"},{"location":"android/ui/view/recyclerView/demo1/#recyclerview","title":"\u914d\u7f6eRecyclerView","text":"<p>\u8bbe\u7f6erecyclerview\u3002 <pre><code>// \u5728activity\u6216\u8005fragment\u91cc\nprivate Adapter mAdapter = new Adapter();\n\n@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.act_recy_2);\n    RecyclerView recyclerView = findViewById(R.id.re_view);\n    recyclerView.setLayoutManager(new LinearLayoutManager(this, RecyclerView.VERTICAL, false));\n    recyclerView.setAdapter(mAdapter);\n    mAdapter.setDataList(genDataTestList());\n    recyclerView.addItemDecoration(new RecyclerView.ItemDecoration() {\n        @Override\n        public void getItemOffsets(@NonNull Rect outRect, @NonNull View view, @NonNull RecyclerView parent, @NonNull RecyclerView.State state) {\n            super.getItemOffsets(outRect, view, parent, state);\n            outRect.top = getResources().getDimensionPixelOffset(R.dimen.re_2_gap);\n        }\n    });\n}\n\n// \u751f\u6210\u6a21\u62df\u6570\u636e\nprivate List&lt;DataTest&gt; genDataTestList() {\n    List&lt;DataTest&gt; list = new ArrayList&lt;&gt;();\n    for (int i = 1; i &lt;= 60; i++) {\n        DataTest d = new DataTest(\"\u65f6\u533a\" + i, i, i, i);\n        list.add(d);\n    }\n    return list;\n}\n</code></pre> \u5728<code>onCreate</code>\u65b9\u6cd5\u4e2d\u914d\u7f6erecyclerView\u3002 <code>recyclerView.addItemDecoration</code>\u65b9\u6cd5\u662f\u7ed9item\u8bbe\u7f6e\u95f4\u9694\u6837\u5f0f\u3002 <code>getItemOffsets</code>\u53ef\u4ee5\u8bbe\u7f6e\u5b50\u9879\u7684\u95f4\u8ddd\u3002\u8fd9\u91cc\u7ed9\u5b50\u9879\u5e95\u90e8\u4e00\u4e2a\u95f4\u8ddd\u503c\u3002\u5177\u4f53\u6570\u503c\u8bbe\u7f6e\u5728dimen\u4e2d\u3002 <code>genDataTestList()</code>\u662f\u751f\u6210\u6a21\u62df\u7684\u6570\u636e\u3002</p>"},{"location":"android/ui/view/recyclerView/demo1/#_3","title":"\u8fd0\u884c\u6548\u679c","text":"<p>\u8fd0\u884c\u8d77\u6765\u5373\u53ef\u770b\u5230\u6548\u679c\u3002</p> <p></p>"},{"location":"android/ui/view/recyclerView/demo1/#includelayout","title":"\u4f7f\u7528include\u4fee\u6539layout","text":"<p>\u770b\u5230\u6548\u679c\u56fe\uff0c\u6709\u7684\u670b\u53cb\u95ee\uff1a\u8868\u5934\u548citem\u7684\u7ed3\u6784\u662f\u4e00\u6837\u7684\uff0c\u53ef\u4ee5\u590d\u7528\u5417\uff1f</p> <p>\u5176\u5b9e\u662f\u53ef\u4ee5\u7684\u3002\u6211\u4eec\u53ef\u4ee5\u5728layout\u4e2d\u4f7f\u7528<code>include</code>\u6807\u7b7e\uff0c\u628a\u53e6\u4e00\u4e2alayout\u6587\u4ef6\u201c\u5305\u542b\u201d\u8fdb\u6765\u3002 \u590d\u5236<code>act_recy_2.xml</code>\u7c98\u8d34\u5f97\u5230<code>act_recy_2_include.xml</code>\uff0c\u628a\u539f\u6765\u7684\u8868\u5934\u7684LinearLayout\u6539\u6210include\u3002</p> <p><pre><code>&lt;include layout=\"@layout/item_recy2\" /&gt;\n</code></pre> \u7ed9include\u8bbe\u5b9alayout\uff0c\u5373\u6211\u4eec\u5b9a\u4e49\u7684item\u7684\u5e03\u5c40<code>item_recy2</code>\u3002 \u5f53\u6211\u4eec\u60f3\u6dfb\u52a0\u4e2a<code>margin-top</code>\u7684\u65f6\u5019\uff0c\u6bd4\u5982\u8fd9\u6837 <pre><code>&lt;include\n    android:layout_marginTop=\"4dp\"\n    layout=\"@layout/item_recy2\" /&gt;\n</code></pre></p> <p>as\u4f1a\u5f39\u51fa\u8b66\u544a\uff1a</p> <p>Layout parameter layout_marginTop ignored unless both layout_width and layout_height are also specified on  tag <p>\u4e5f\u5c31\u662f\u5728include\u6807\u7b7e\u4e2d\uff0c\u5982\u679c\u8981\u8bbe\u7f6e\u5176\u4ed6\u5c5e\u6027\uff0c\u9700\u8981\u5148\u8bbe\u7f6e<code>layout_width</code>\u548c<code>layout_height</code>\u3002</p> <p>\u4fee\u6539\u4e00\u4e0b\uff0c\u518d\u52a0\u4e2aid\uff0c\u53d8\u6210\u8fd9\u6837\u3002 <pre><code>&lt;include\n    android:id=\"@+id/header\"\n    layout=\"@layout/item_recy2\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:layout_marginTop=\"4dp\" /&gt;\n</code></pre></p> <p>\u8ba9Activity\u4f7f\u7528\u8fd9\u4e2alayout\u3002\u4fee\u6539\u4e00\u4e0b<code>RecyclerViewDemo2Act</code>\u3002 <pre><code>@Override\nprotected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.act_recy_2_include);\n    initHeader();\n    // \u914d\u7f6eRecyclerView\u7684\u90e8\u5206\n}\n\nprivate void initHeader() {\n    View header = findViewById(R.id.header);\n    TextView tv1 = header.findViewById(R.id.tv1);\n    tv1.setText(\"\u65f6\u533a\");\n    TextView tv2 = header.findViewById(R.id.tv2);\n    tv2.setText(\"\u5e8f\u53f7\");\n    TextView tv3 = header.findViewById(R.id.tv3);\n    tv3.setText(\"\u4eba\u5458\");\n    TextView tv4 = header.findViewById(R.id.tv4);\n    tv4.setText(\"\u6570\u91cf\");\n}\n</code></pre> \u6211\u4eec\u6dfb\u52a0\u4e86\u4e00\u4e2a\u65b9\u6cd5<code>initHeader()</code>\u3002\u91cc\u9762\u5148\u628aheader\u627e\u5230\uff0c\u901a\u8fc7header\u627e\u5230\u5b83\u7684\u5b50view\uff0c\u4e5f\u5c31\u662f\u90a34\u4e2aTextView\u3002 \u5206\u522b\u8bbe\u7f6e\u6587\u5b57\u5373\u53ef\u3002</p> <p>\u8fd0\u884c\u770b\u770b\u6548\u679c\uff0c\u662f\u4e0d\u662f\u548c\u524d\u9762\u7684\u4e00\u6837\u3002</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u534e\u4e3a\u4e91\u793e\u533a \u7b80\u4e66</p>"},{"location":"android/ui/view/recyclerView/demo_color_picker/","title":"\u4f7f\u7528RecyclerView\u6765\u521b\u5efa\u4e00\u4e2a\u989c\u8272\u9009\u62e9\u677f","text":"<p>\u989c\u8272\u9009\u62e9\u5668\uff0c\u6216\u8005\u53eb\u989c\u8272\u9009\u62e9\u677f\u3002\u7ed9\u7528\u6237\u5c55\u793a\u5404\u79cd\u989c\u8272\uff0c\u7528\u6237\u53ef\u4ee5\u70b9\u51fb\u9009\u53d6\u81ea\u5df1\u60f3\u8981\u7684\u989c\u8272\u3002</p> <p>\u5b9e\u73b0\u7684\u6548\u679c</p> <ul> <li>\u80fd\u591f\u6dfb\u52a0\u591a\u4e2a\u989c\u8272\uff0c\u6570\u91cf\u4e0d\u5b9a\uff1b\u80fd\u591f\u6ed1\u52a8</li> <li>\u9009\u62e9\u677f\u7684\u9009\u9879\u6709\u70b9\u51fb\u9009\u4e2d\u6548\u679c</li> <li>\u9009\u4e2d\u7684\u989c\u8272\u8981\u80fd\u901a\u77e5\u51fa\u6765</li> </ul> <p>\u6548\u679c\u56fe\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"android/ui/view/recyclerView/demo_color_picker/#_1","title":"\u5b9e\u73b0\u601d\u8def","text":"<p>\u9996\u5148\u6211\u4eec\u8981\u628a\u5019\u9009\u7684\u989c\u8272\u5c55\u793a\u51fa\u6765\u3002 \u53ef\u4ee5\u770b\u5230\u4e00\u5217\u6709\u591a\u4e2a\u989c\u8272\u3002 \u6bcf\u4e2a\u989c\u8272item\u8981\u80fd\u54cd\u5e94\u70b9\u51fb\uff0c\u800c\u4e14\u8981\u6709\u9009\u4e2d\u6548\u679c\u3002\u90a3\u4e48\u5c31\u662f\u8981\u5b58\u50a8\u9009\u4e2d\u7684\u72b6\u6001\u3002</p>"},{"location":"android/ui/view/recyclerView/demo_color_picker/#_2","title":"\u5b9e\u73b0\u4ee3\u7801","text":"\u6587\u4ef6 \u4f5c\u7528 CircleImageView.java \u81ea\u5b9a\u4e49UI\uff0c\u5706\u70b9\u663e\u793a\u989c\u8272\uff1b\u8fd9\u91cc\u662f\u4e00\u4e2a\u80fd\u6539\u53d8\u989c\u8272\u7684\u5706\u70b9 ColorBoardListAdapter.java RecyclerView.Adapter\uff1b\u9002\u914d\u5668 color_item_view.xml \u5706\u70b9\u7684\u5e03\u5c40\u6587\u4ef6 attr.xml \u5706\u70b9\u7684\u81ea\u5b9a\u4e49\u5c5e\u6027 ColorBoardActivity.java \u7528\u4e8e\u6f14\u793a activity_color_board.xml \u7528\u4e8e\u6f14\u793a <p>\u7ed9RecyclerView\u8bbe\u5b9a\u70b9\u51fb\u4e8b\u4ef6\uff0c\u83b7\u53d6\u70b9\u51fbposition\uff1b\u7136\u540e\u901a\u77e5\u5404\u4e2aitem\uff0c\u6539\u53d8\u72b6\u6001\u3002 \u5706\u70b9\u7684\u5927\u5c0f\u548c\u80cc\u666f\u5927\u5c0f\u662f\u9884\u5148\u8bbe\u5b9a\u597d\u7684\u3002</p>"},{"location":"android/ui/view/recyclerView/demo_color_picker/#_3","title":"\u4ee3\u7801\u7247\u6bb5\u8bf4\u660e","text":"<p><code>CircleImageView.java</code> \u81ea\u5b9a\u4e49\u5706\u70b9UI\uff1b\u4e00\u5b9a\u8981\u590d\u5199<code>setSelected(boolean selected)</code>\u65b9\u6cd5\u3002 \u8fd9\u662f\u4e2a\u81ea\u5b9a\u4e49View\u3002\u7528<code>canvas</code>\u6765\u7ed8\u5236\u5706\u3002 <pre><code>@Override\nprotected void onDraw(Canvas canvas) {\n    super.onDraw(canvas);\n    mPaint.setAntiAlias(true);\n    mPaint.setStyle(Paint.Style.FILL);\n    mPaint.setStrokeWidth(1.5f);\n    if (mSelected) {\n        mPaint.setColor(Color.WHITE);// \u82e5\u88ab\u9009\u4e2d\uff0c\u5219\u753b\u4e00\u4e2a\u5706\u5f62\u80cc\u666f\n        canvas.drawCircle(getWidth() / 2, getHeight() / 2, mRadius, mPaint);\n    }\n    mPaint.setColor(mColor);\n    canvas.drawCircle(getWidth() / 2, getHeight() / 2, mRadius - 10, mPaint);\n}\n\n@Override\npublic void setSelected(boolean selected) {\n    mSelected = selected;// \u786e\u5b9a\u6b64UI\u662f\u5426\u88ab\u9009\u4e2d\n    super.setSelected(selected);\n    invalidate();\n}\n</code></pre></p> <p><code>ColorBoardListAdapter.java</code>\u9002\u914d\u5668\u4e2d\u9ed8\u8ba4\u70b9\u4e2d\u7684item position\u4e3a-1 <pre><code>// \u4f9b\u5916\u90e8\u8c03\u7528\uff0c\u83b7\u53d6\u70b9\u51fb\u7684position\uff1b\u901a\u77e5item\u66f4\u6539\npublic void setSelectedPosition(int position) {\n    this.mSelectedPosition = position;\n    notifyDataSetChanged();\n    notifyItemChanged(position);\n}\n// ......\n@Override\npublic void onBindViewHolder(ViewHolder holder, final int position) {\n    holder.mImageView.setColor(mDataList.get(position).color);\n    holder.mImageView.setSelected(mSelectedPosition == position);// \u5224\u65ad\u662f\u5426\u88ab\u9009\u4e2d\n    if (mOnItemClickListener != null) {\n        holder.mImageView.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                mOnItemClickListener.onItemClick(v, position);\n            }\n        });\n        holder.mImageView.setOnLongClickListener(new View.OnLongClickListener() {\n            @Override\n            public boolean onLongClick(View v) {\n                mOnItemClickListener.onItemLongClick(v, position);\n                return true;\n            }\n        });\n    }\n}\n</code></pre></p> <p><code>ColorBoardActivity.java</code>\u8bbe\u5b9a\u70b9\u51fb\u4e8b\u4ef6\uff0c\u7136\u540e\u4f20\u56de\u70b9\u51fbposition\u3002 \u5019\u9009\u989c\u8272\u662f\u5728\u8fd9\u91cc\u8fdb\u884c\u914d\u7f6e\u7684\uff0c\u60f3\u8981\u51e0\u4e2a\u989c\u8272\u5c31\u6dfb\u52a0\u51e0\u4e2a\u989c\u8272\u3002 \u793a\u4f8b\u4e2d\u7684\u989c\u8272\u662f\u6211\u4eec\u81ea\u5df1\u6307\u5b9a\u3002\u5b9e\u9645\u9879\u76ee\u4e2d\u4e5f\u53ef\u4ee5\u63a5\u6536\u540e\u53f0\u4f20\u6765\u7684\u6570\u636e\u3002 <pre><code>// activity\nprivate void initColorBoard() {\n    final ArrayList&lt;ColorBoardListAdapter.ColorItemViewEntity&gt; colorItemEntities = new ArrayList&lt;&gt;();\n    colorItemEntities.add(new ColorBoardListAdapter.ColorItemViewEntity(1, Color.rgb(0, 10, 50)));\n    // \u60f3\u52a0\u51e0\u4e2a\u52a0\u51e0\u4e2a......\n\n    GridLayoutManager gridLayoutManager = new GridLayoutManager(this, 3);// 3\u884c\n    gridLayoutManager.setOrientation(LinearLayoutManager.HORIZONTAL);\n    mColorBoard.setLayoutManager(gridLayoutManager);\n    final ColorBoardListAdapter colorBoardListAdapter = new ColorBoardListAdapter(colorItemEntities);\n    colorBoardListAdapter.setOnItemClickListener(new ColorBoardListAdapter.OnItemClickListener() {\n        @Override\n        public void onItemClick(View view, int position) {\n            int clickID = colorItemEntities.get(position).id;\n            int color = colorItemEntities.get(position).color;\n            colorBoardListAdapter.setSelectedPosition(position);// \u70b9\u51fbitem\u4f4d\u7f6e\u4f20\u56de\u53bb\n            Log.d(TAG, \"onItemClick: \" + clickID + \";  color = \" + color);\n        }\n\n        @Override\n        public void onItemLongClick(View view, int position) {\n\n        }\n    });\n    mColorBoard.setAdapter(ColorBoardListAdapter);\n}\n</code></pre> \u6a2a\u5411\u6eda\u52a8\uff0c\u6bcf\u5217\u7684item\u6570\u91cf\u786e\u5b9a\uff0c\u6211\u4eec\u7528GridLayoutManager\u3002\u5e76\u4e14\u6307\u5b9a\u6eda\u52a8\u65b9\u5411\u4e3a\u6a2a\u5411<code>LinearLayoutManager.HORIZONTAL</code>\u3002 \u6307\u5b9a\u884c\u6570\u4e3a3\u884c\u3002</p> <p>\u5f53\u63a5\u6536\u5230item\u7684\u70b9\u51fb\u4e8b\u4ef6\uff0c\u9700\u8981\u64cd\u4f5c\u6570\u636e\uff0c\u628a\u9009\u4e2d\u7684\u6570\u636e\u8bb0\u5f55\u4e0b\u6765\u3002\u901a\u77e5RecyclerView\u5237\u65b0\u3002</p> <p>\u4f7f\u7528RecyclerView\uff0c\u6dfb\u52a0\u5b50\u9879\u975e\u5e38\u65b9\u4fbf\u3002\u6269\u5c55\u4e5f\u5f88\u65b9\u4fbf\u3002</p> <p>\u9879\u76ee\u5730\u5740\uff1a https://github.com/RustFisher/aboutView   </p> <p>\u53c2\u8003\uff1a</p> <p>http://stackoverflow.com/questions/27194044/how-to-properly-highlight-selected-item-on-recyclerview</p>"},{"location":"android/ui/view/recyclerView/demo_color_picker/#recyclerview_1","title":"RecyclerView\u6ed1\u52a8\u65f6\u5ffd\u7565\u95f4\u9694","text":"<p>RecyclerView\u5185\u5bb9\u6ca1\u6709\u586b\u6ee1\u65f6\uff0c\u6709\u4e00\u4e2apadding\u95f4\u9694\u3002\u5185\u5bb9\u589e\u52a0\u540e\uff0c\u53ef\u4ee5\u5f00\u59cb\u6ed1\u52a8\u3002</p> <p>\u6ed1\u52a8\u65f6\u53ef\u4ee5\u76d6\u8fc7\u539f\u6765\u7684padding\u95f4\u9694\u3002\u9700\u8981\u8bbe\u7f6e<code>android:clipToPadding=\"true\"</code>\u3002 <pre><code>&lt;android.support.v7.widget.RecyclerView\n    android:id=\"@+id/rv\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:layout_marginBottom=\"4dp\"\n    android:clipToPadding=\"true\"\n    android:paddingEnd=\"12dp\"\n    android:paddingStart=\"12dp\" /&gt;\n</code></pre></p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a \u7b80\u4e66</p>"},{"location":"android/ui/view/recyclerView/intro/","title":"Android RecyclerView\u4f7f\u7528\u5165\u95e8","text":"\u66f4\u65b0\u65e5\u671f 2021-9-1 <ul> <li>2021-9-1 \u66f4\u65b0\u683c\u5f0f</li> <li>2020-8-19 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u672c\u6587\u4ecb\u7ecdRecyclerView\u7684\u4f7f\u7528\u5165\u95e8\u3002\u8fd9\u91cc\u7ed9\u51fa\u4e00\u79cd\u6bd4\u8f83\u5e38\u89c1\u7684\u4f7f\u7528\u65b9\u5f0f\u3002</p> <p>\u60f3\u5fc5\u8bfb\u8005\u670b\u53cb\u5bf9\u5217\u8868\u7684\u8868\u73b0\u5f62\u5f0f\u5df2\u7ecf\u4e0d\u518d\u964c\u751f\u3002\u624b\u673a\u4e0a\u6709\u8054\u7cfb\u4eba\u5217\u8868\uff0c\u6587\u4ef6\u5217\u8868\uff0c\u77ed\u4fe1\u5217\u8868\u7b49\u7b49\u3002 \u672c\u6587\u8bb2\u8ff0\u7684\u662f\u5728Android\u5f00\u53d1\u4e2d\u7528RecyclerView\u6765\u5b9e\u73b0\u5217\u8868\u6548\u679c\u3002</p>"},{"location":"android/ui/view/recyclerView/intro/#_1","title":"\u4f7f\u7528\u6b65\u9aa4","text":""},{"location":"android/ui/view/recyclerView/intro/#recyclerview","title":"\u5f15\u5165RecyclerView","text":"<p>\u5728app\u7684build.gradle\u6587\u4ef6\u4e2d\u6dfb\u52a0\u5f15\u7528\u3002\u6211\u4eec\u4f7f\u7528\u7684\u662fandroidx\u5305\u3002</p> gradle <pre><code>dependencies {\n    // ...\n    implementation 'androidx.recyclerview:recyclerview:1.1.0'\n}\n</code></pre>"},{"location":"android/ui/view/recyclerView/intro/#_2","title":"\u6570\u636e\u51c6\u5907","text":"<p>\u5148\u786e\u5b9a\u4e00\u4e0b\u8981\u663e\u793a\u4ec0\u4e48\u6837\u7684\u6570\u636e\u3002\u662f\u7528\u6237\u4fe1\u606f\uff0c\u8054\u7cfb\u4eba\uff0c\u6216\u662f\u6587\u4ef6\u3002\u8fd9\u91cc\u4ee5\u5b57\u7b26\u4e3a\u4f8b\u3002 \u5199\u4ee3\u7801\u524d\uff0c\u6211\u4eec\u5148\u8003\u8651\u4e00\u4e0b\u9700\u6c42\uff0c\u5c31\u662f\u8981\u5982\u4f55\u663e\u793a\uff0c\u600e\u4e48\u663e\u793a\u6570\u636e\u3002\u65e5\u5e38\u5de5\u4f5c\u4e2d\uff0c\u4e00\u822c\u4f1a\u6709UI\u6548\u679c\u56fe\u3002\u800c\u672c\u6587\u4e2d\u7684\u7f8e\u672f\u8bbe\u8ba1\u5c31\u7531\u6211\u4eec\u81ea\u5df1\u53d1\u6325\u4e86\u3002</p> <p>\u6bd4\u5982\u663e\u793a <code>a</code> \u548c <code>97</code>\u3002</p>"},{"location":"android/ui/view/recyclerView/intro/#viewholderlayout","title":"ViewHolder\u4e0elayout","text":"<p>\u73b0\u5728\u8981\u663e\u793a\u7684\u6570\u636e\u5df2\u7ecf\u786e\u5b9a\u4e86\u3002\u6765\u8bbe\u8ba1UI\u8868\u73b0\u3002layout\u4e0eViewHolder\u7d27\u5bc6\u76f8\u5173\u3002\u5728\u8bbe\u8ba1Adapter\u7c7b\u524d\uff0c\u5148\u5199ViewHolder\u7c7b\u4f1a\u6bd4\u8f83\u597d\u3002</p> <p>\u65b0\u5efa\u5b9a\u4e49item\uff08\u5217\u8868\u5b50\u9879\uff09\u7684\u5e03\u5c40\u6587\u4ef6<code>item_letter.xml</code>\u3002</p> item_letter.xml <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:orientation=\"horizontal\"&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv1\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:textColor=\"#000000\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv2\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:textColor=\"#000000\" /&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre> <p>\u8fd9\u91cc\u4f7f\u7528\u5185\u90e8\u7c7b\uff0c\u628aViewHolder\u7c7b\u5199\u5728Activity\u7c7b\u91cc\u9762\u3002</p> \u521b\u5efaVH\u7c7b <pre><code>private class VH extends RecyclerView.ViewHolder {\n    TextView tv1;\n    TextView tv2;\n\n    public VH(@NonNull View itemView) {\n        super(itemView);\n        tv1 = itemView.findViewById(R.id.tv1);\n        tv2 = itemView.findViewById(R.id.tv2);\n    }\n}\n</code></pre> <p>\u4ece\u4e0a\u9762\u53ef\u4ee5\u770b\u51fa\uff0cViewHolder\u548citem\u7684layout\u662f\u7d27\u5bc6\u76f8\u5173\u7684\u3002 layout\u91cc\u9762\u7684id\u5199\u7684\u6bd4\u8f83\u7b80\u5355\u3002\u5b9e\u9645\u9879\u76ee\u4e2d\u53ef\u4ee5\u7ed9\u4e00\u4e9b\u66f4\u6709\u610f\u4e49\u7684id\u547d\u540d\u3002</p> <p>\u5728activity\u7684layout\u6587\u4ef6\u4e2d\uff0c\u6dfb\u52a0RecyclerView\u3002</p> layout\u4e2d\u6dfb\u52a0RecyclerView <pre><code>&lt;androidx.recyclerview.widget.RecyclerView\n    android:id=\"@+id/re_view\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\" /&gt;\n</code></pre>"},{"location":"android/ui/view/recyclerView/intro/#adapter","title":"\u8bbe\u8ba1Adapter","text":"<p>\u8bbe\u8ba1\u4e00\u4e2a\u9002\u914d\u5668\u7ee7\u627f\u81ea<code>RecyclerView.Adapter&lt;VH&gt;</code>\u3002</p> <p>\u8fd9\u91cc\u7684<code>VH</code>\u662f\u6211\u4eec\u4e0a\u9762\u5199\u597d\u7684ViewHolder\u3002</p> <p><code>LetterAdapter</code>\u4e2d\u6301\u6709\u5b83\u81ea\u5df1\u7684\u6570\u636e\u5217\u8868\u3002\u9700\u8981\u5b9e\u73b03\u4e2a\u65b9\u6cd5\u3002</p> <ul> <li><code>onCreateViewHolder</code>\u65b9\u6cd5\uff0c\u8981\u6c42\u8fd4\u56deVH\u5bf9\u8c61\u3002<ul> <li>\u8fd9\u91cc\u5c31\u662f\u521b\u5efaVH\u5bf9\u8c61\u5e76\u8fd4\u56de\u3002\u800cVH\u6784\u9020\u5668\u8981\u6c42\u4f20\u5165\u4e00\u4e2aView\uff0c\u6211\u4eec\u5229\u7528<code>LayoutInflater</code>\u521b\u5efa\u4e00\u4e2aview\u7ed9\u5b83\u3002\u5f53\u7136\uff0c\u521b\u5efa\u7684\u6839\u636e\u5c31\u662f\u524d\u9762\u8bbe\u8ba1\u597d\u7684<code>item_letter</code>\u3002</li> </ul> </li> <li><code>onBindViewHolder</code>\u662f\u628a\u6570\u636e\u4ea4\u7ed9\u5bf9\u5e94\u7684VH\u6765\u663e\u793a\u3002</li> <li><code>getItemCount</code>\u65b9\u6cd5\u8981\u6c42\u8fd4\u56de\u6570\u636e\u7684\u6570\u91cf\u3002</li> </ul> LetterAdapter <pre><code>private class LetterAdapter extends RecyclerView.Adapter&lt;VH&gt; {\n\n    private List&lt;Character&gt; dataList;\n\n    public LetterAdapter(List&lt;Character&gt; dataList) {\n        this.dataList = dataList;\n    }\n\n    @NonNull\n    @Override\n    public VH onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\n        return new VH(LayoutInflater.from(parent.getContext()).inflate(R.layout.item_letter, parent, false));\n    }\n\n    @Override\n    public void onBindViewHolder(@NonNull VH holder, int position) {\n        Character c = dataList.get(position);\n        holder.tv1.setText(c.toString());\n        holder.tv2.setText(String.valueOf(Integer.valueOf(c)));\n    }\n\n    @Override\n    public int getItemCount() {\n        return dataList.size();\n    }\n}\n</code></pre> <p>\u7c97\u5fc3\u5927\u610f\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u5fd8\u8bb0\u521d\u59cb\u5316adapter\u91cc\u7684dataList\u3002\u4f1a\u62a5\u4e00\u4e2a<code>null pointer</code>\u5f02\u5e38\u3002</p>"},{"location":"android/ui/view/recyclerView/intro/#recyclerview_1","title":"\u8bbe\u7f6eRecyclerView","text":"<p>\u5728Activity\u7684onCreate\u65b9\u6cd5\u91cc\u8fdb\u884c\u4e86\u521d\u59cb\u5316\u3002</p> <p>RecyclerView\u9700\u89812\u9879\u8bbe\u7f6e\uff0c\u9002\u914d\u5668\u4e0eLayoutManager\u3002\u9002\u914d\u5668\u5c31\u662f\u6211\u4eec\u4e0a\u9762\u5b9a\u7684\u90a3\u4e2a\u3002 LayoutManager\u8fd9\u91cc\u7528<code>LinearLayoutManager</code>\uff0c\u6307\u5b9a\u4e3a\u5782\u76f4\u65b9\u5411\uff0c\u8fd9\u6837\u6211\u4eec\u4f1a\u5f97\u5230\u4e00\u4e2a\u4e0a\u4e0b\u6ed1\u52a8\u7684\u5217\u8868\u3002</p> \u4f7f\u7528LinearLayoutManager <pre><code>List&lt;Character&gt; characterList = new ArrayList&lt;&gt;();\nfor (char c = 'a'; c &lt;= 'z'; c++) {\n    characterList.add(c);\n}\n\nmLetterAdapter = new LetterAdapter(characterList);\nRecyclerView letterReView = findViewById(R.id.re_view);\nletterReView.setAdapter(mLetterAdapter);\nletterReView.setLayoutManager(new LinearLayoutManager(this, RecyclerView.VERTICAL, false));\n</code></pre>"},{"location":"android/ui/view/recyclerView/intro/#_3","title":"\u89c2\u5bdf\u8fd0\u884c\u7ed3\u679c","text":"<p>\u8fd0\u884c\u5230\u624b\u673a\u6216\u8005\u6a21\u62df\u5668\u4e0a\uff0c\u6253\u5f00\u8fd9\u4e2aactivity\u3002\u6709\u7684\u670b\u53cb\u5c31\u53d1\u73b0\uff0c\u4e3a\u5565\u5c4f\u5e55\u91cc\u4e00\u4e2a\u5b50\u9879item\u5c31\u5360\u6ee1\u4e86\u6574\u4e2a\u5c4f\u5e55\uff1f</p> <p>\u56e0\u4e3a\u6211\u4eec\u524d\u9762\u8bbe\u7f6e\u7684item\u5360\u6ee1\u5c4f\u5e55\u3002\u56de\u5230<code>item_letter.xml</code>\uff0c\u770b\u4e00\u4e0b\u6839layout\u7684\u8bbe\u7f6e\u3002 \u628a<code>layout_height=\"match_parent\"</code>\u91cc\u7684\u8bbe\u7f6e\u6539\u4e3a<code>wrap_content</code>\u3002 \u91cd\u65b0\u7f16\u8bd1\u8fd0\u884c\u4e00\u4e0b\u518d\u770b\u770b\u7ed3\u679c\u3002</p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u7ed9\u6839layout\u8bbe\u7f6e\u56fa\u5b9a\u7684\u9ad8\u5ea6\u3002\u5177\u4f53\u89c6\u7f8e\u672f\u8bbe\u8ba1\u548c\u9700\u6c42\u800c\u5b9a\u3002</p>"},{"location":"android/ui/view/recyclerView/intro/#_4","title":"\u5c0f\u7ed3","text":"<p>\u5230\u8fd9\u91cc\u6211\u4eec\u638c\u63e1\u4e86RecyclerView\u7684\u57fa\u672c\u4f7f\u7528\u65b9\u5f0f\u3002</p> <p>\u63a5\u4e0b\u6765\u8fd8\u8981\u4e86\u89e3\u5982\u4f55\u81ea\u5b9a\u4e49\u5b83\u7684\u8868\u73b0\u5f62\u5f0f\u3002</p> <p>\u4f8b\u5982\u70b9\u51fb\u6216\u957f\u6309item\u7684\u53cd\u5e94\uff1b\u62d6\u52a8\u8c03\u6574\u987a\u5e8f\uff0c\u4fa7\u6ed1\u5220\u9664\uff1bitem\u4e4b\u95f4\u6dfb\u52a0\u5206\u5272\u7ebf\uff1b\u589e/\u5220/\u6539\u6570\u636e\uff1b\u4f7f\u7528\u7011\u5e03\u6d41\u6837\u5f0f\u7b49\u7b49\u3002\u4e5f\u53ef\u4ee5\u67e5\u770b\u6ed1\u52a8\u8ddd\u79bb\u3002</p> <p>RecyclerView\u4f7f\u7528\u4e86\u9002\u914d\u5668\u6a21\u5f0f\u3002</p> <p>\u53ef\u4ee5\u67e5\u770b\u4e00\u4e2a\u4f7f\u7528\u793a\u4f8b\uff0c\u663e\u793a\u4e00\u5217\u6570\u636e\u3002\u5982\u679c\u8981\u663e\u793a\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\uff0c\u8fd9\u91cc\u6709\u5b9e\u73b0\u65b9\u5f0f\u3002</p> <p>\u53ef\u4ee5\u53c2\u8003\u5b98\u65b9\u7684RecyclerView\u6587\u6863\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u534e\u4e3a\u4e91\u793e\u533a \u7b80\u4e66</p>"},{"location":"android/ui/view/recyclerView/item-animator/","title":"\u53d6\u6d88\u5b50\u9879\u66f4\u65b0\u52a8\u753b","text":"<pre><code>reView.setItemAnimator(null); // \u7981\u6b62item\u66f4\u65b0\u7684\u52a8\u753b\n</code></pre>"},{"location":"android/ui/view/recyclerView/item_click/","title":"Android RecyclerView\u54cd\u5e94\u5b50\u9879\u70b9\u51fb","text":"<p>\u70b9\u51fb\uff0c\u662f\u6700\u5e38\u89c1\u6700\u91cd\u8981\u7684\u7684\u4ea4\u4e92\u624b\u6bb5\u3002 \u672c\u6587\u4ecb\u7ecdRecyclerView\u8bbe\u7f6e\u70b9\u51fb\u7684\u65b9\u6cd5\u3002\u8fd9\u91cc\u7ed9\u51fa\u6bd4\u8f83\u5e38\u89c1\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u5373\u76d1\u542c\u8005\u6a21\u5f0f\u3002</p> <p>\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u5982\u4f55\u7528RecyclerView\u663e\u793a\u4e00\u5217\u6570\u636e\u3002 \u7528\u6237\u70b9\u51fb\u67d0\u4e2aitem\u65f6\uff0capp\u53ef\u4ee5\u505a\u51fa\u76f8\u5e94\u7684\u53cd\u5e94\u3002\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528\u6dfb\u52a0\u70b9\u51fb\u76d1\u542c\u5668\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u8fd9\u4e2a\u6548\u679c\u3002</p> <p>\u5728Android\u5f00\u53d1\u4e2d\uff0c\u76d1\u542c\u5668\u6a21\u5f0f\u4f7f\u7528\u5341\u5206\u5e7f\u6cdb\u3002 \u76f8\u4fe1\u5927\u5bb6\u5bf9<code>setOnClickListener</code>\u65b9\u6cd5\u975e\u5e38\u719f\u6089\u3002\u6700\u5148\u88ab\u521d\u5b66\u8005\u8ba4\u8bc6\u5230\u7684\u5e94\u8be5\u662fButton\u7684\u70b9\u51fb\u4e8b\u4ef6\u76d1\u542c\u3002</p>"},{"location":"android/ui/view/recyclerView/item_click/#_1","title":"\u8bbe\u8ba1\u5e76\u6dfb\u52a0\u76d1\u542c\u5668","text":"<p>\u9996\u5148\u8bbe\u8ba1\u76d1\u542c\u5668\u3002\u65b0\u5efa<code>OnItemClickListener1</code>\u63a5\u53e3\u3002</p> <p>\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u63a5\u53e3\u7684\u540d\u5b57\u53ef\u4ee5\u5b9a\u4e49\u7684\u66f4\u6709\u542b\u4e49\u4e00\u4e9b\u3002 <pre><code>public interface OnItemClickListener {\n\n    void onItemClick(Character c);\n\n    void onItemLongClick(Character c);\n\n}\n</code></pre> \u8fd9\u4e2a\u63a5\u53e3\u91cc\u6211\u4eec\u653e\u7f6e\u4e862\u4e2a\u65b9\u6cd5\u3002\u5206\u522b\u7528\u6765\u54cd\u5e94\u70b9\u51fb\u4e0e\u957f\u6309\u4e8b\u4ef6\u3002</p>"},{"location":"android/ui/view/recyclerView/item_click/#adapter","title":"Adapter\u6301\u6709\u76d1\u542c\u5668","text":"<p>\u9996\u5148\u4fee\u6539\u4e00\u4e0bVH\u7c7b\u3002\u6211\u4eec\u5e0c\u671b\u6574\u4e2aitem\u6765\u63a5\u53d7\u70b9\u51fb\u3002 <pre><code>private class VH extends RecyclerView.ViewHolder {\n    View item; // \u6211\u4eec\u5e0c\u671b\u62ff\u5230\u6574\u4e2aitem\u7684view\n    TextView tv1;\n    TextView tv2;\n\n    public VH(@NonNull View itemView) {\n        super(itemView);\n        item = itemView;\n        tv1 = itemView.findViewById(R.id.tv1);\n        tv2 = itemView.findViewById(R.id.tv2);\n    }\n}\n</code></pre></p> <p>\u63a5\u4e0b\u6765\u4fee\u6539\u524d\u9762\u7684Adapter\u7c7b\u3002\u5728\u9002\u914d\u5668\u4e2d\u6301\u6709\u76d1\u542c\u5668\u5bf9\u8c61<code>onItemClickListener</code>\u3002 \u5728<code>onBindViewHolder</code>\u65b9\u6cd5\u4e2d\uff0c\u7ed9item\u8bbe\u7f6e\u76d1\u542c\u3002</p> <p><pre><code>holder.item.setOnClickListener(new View.OnClickListener() {\n    @Override\n    public void onClick(View v) {\n        if (onItemClickListener != null) {\n            onItemClickListener.onItemClick(c);\n        }\n    }\n});\nholder.item.setOnLongClickListener(new View.OnLongClickListener() {\n    @Override\n    public boolean onLongClick(View v) {\n        if (onItemClickListener != null) {\n            onItemClickListener.onItemLongClick(c);\n        }\n        return true;\n    }\n});\n</code></pre> \u8fd9\u91cc\u52a0\u4e0a\u5224\u7a7a\u5904\u7406\u3002\u9632\u6b62\u7a7a\u6307\u9488\u3002 \u5b9e\u9645\u4e0a\uff0c\u662fitem\u8fd9\u4e2aView\u63a5\u6536\u5230\u4e86\u70b9\u51fb\u4e8b\u4ef6\uff0c\u518d\u901a\u8fc7\u6211\u4eec\u8bbe\u8ba1\u7684\u76d1\u542c\u5668\u628a\u4e8b\u4ef6\u4f20\u51fa\u53bb\u3002 <code>setOnLongClickListener</code>\u8fd9\u91cc\u8fd4\u56detrue\u3002\u628a\u8fd9\u4e2along click\u4e8b\u4ef6\u6d88\u8d39\u6389\u3002</p> <p>\u6b64\u65f6\u7684<code>LetterAdapter</code>\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\u3002 <pre><code>private class LetterAdapter extends RecyclerView.Adapter&lt;VH&gt; {\n\n    private List&lt;Character&gt; dataList;\n    private OnItemClickListener onItemClickListener;\n\n    public LetterAdapter(List&lt;Character&gt; dataList) {\n        this.dataList = dataList; // \u8fd9\u91cc\u6700\u597d\u8fdb\u884c\u5224\u7a7a\u5904\u7406\n    }\n\n    @NonNull\n    @Override\n    public VH onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\n        return new VH(LayoutInflater.from(parent.getContext()).inflate(R.layout.item_letter, parent, false));\n    }\n\n    @Override\n    public void onBindViewHolder(@NonNull VH holder, int position) {\n        final Character c = dataList.get(position);\n        holder.tv1.setText(c.toString());\n        holder.tv2.setText(String.valueOf(Integer.valueOf(c)));\n        holder.item.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                if (onItemClickListener != null) {\n                    onItemClickListener.onItemClick(c);\n                }\n            }\n        });\n        holder.item.setOnLongClickListener(new View.OnLongClickListener() {\n            @Override\n            public boolean onLongClick(View v) {\n                if (onItemClickListener != null) {\n                    onItemClickListener.onItemLongClick(c);\n                }\n                return true;\n            }\n        });\n    }\n\n    @Override\n    public int getItemCount() {\n        return dataList.size();\n    }\n\n    public void setOnItemClickListener(OnItemClickListener onItemClickListener) {\n        this.onItemClickListener = onItemClickListener;\n    }\n}\n</code></pre></p>"},{"location":"android/ui/view/recyclerView/item_click/#_2","title":"\u4f7f\u7528\u76d1\u542c\u5668","text":"<p>\u7ecf\u8fc7\u4e0a\u9762\u7684\u52aa\u529b\uff0c\u6211\u4eec\u7684LetterAdapter\u6709\u4e86\u76d1\u542c\u5668\u7684\u529f\u80fd\u3002\u73b0\u5728\u5728activity\u4e2d\u4e3a\u5217\u8868\u8bbe\u7f6e\u76d1\u542c\u3002</p> <p><pre><code>mLetterAdapter.setOnItemClickListener(new OnItemClickListener() {\n    @Override\n    public void onItemClick(Character c) {\n        Toast.makeText(getApplicationContext(), \"Click \" + c, Toast.LENGTH_SHORT).show();\n    }\n\n    @Override\n    public void onItemLongClick(Character c) {\n        Toast.makeText(getApplicationContext(), \"Long click \" + c, Toast.LENGTH_LONG).show();\n    }\n});\n</code></pre> \u8fd9\u91cc\u53ef\u4ee5\u770b\u51fa\uff0c\u8bbe\u7f6e\u76d1\u542c\u5668\u7684\u662fLetterAdapter\uff0c\u800c\u4e0d\u662fRecyclerView\u3002</p> <p>\u8fd0\u884c\u8d77\u6765\uff0c\u70b9\u51fb\u5217\u8868\u770b\u770b\u6548\u679c\u3002</p>"},{"location":"android/ui/view/recyclerView/item_click/#_3","title":"\u8bbe\u8ba1\u76d1\u542c\u5668\u7684\u53e6\u4e00\u4e2a\u65b9\u6848","text":"<p>\u4e0a\u9762\u6211\u4eec\u901a\u8fc7\u63a5\u53e3\uff08<code>interface</code>\uff09\u6765\u7ed9\u8bbe\u8ba1\u4e86\u70b9\u51fb\u76d1\u542c\u5668\u3002 \u6211\u4eec\u53ef\u4ee5\u8bd5\u8bd5\u4e0d\u7528\u63a5\u53e3\uff0c\u6539\u7528\u62bd\u8c61\u7c7b\uff08<code>abstract class</code>\uff09\u6765\u8bbe\u8ba1\u76d1\u542c\u5668\u3002</p> <p>\u65b0\u5efa\u62bd\u8c61\u7c7b<code>AbsOnItemClick.java</code>\u3002 <pre><code>public abstract class AbsOnItemClick {\n\n    public abstract void onClick(char c);\n\n    public void onLongClick(char c) {\n\n    }\n}\n</code></pre> \u91cc\u97621\u4e2a\u62bd\u8c61\u65b9\u6cd5\uff0c1\u4e2a\u666e\u901apublic\u65b9\u6cd5\u3002</p> <p>\u4f9d\u846b\u82a6\u753b\u74e2\uff0c\u5728<code>LetterAdapter</code>\u7c7b\u4e2d\u6dfb\u52a0\u8fd9\u4e2a\u76d1\u542c\u5668\u3002</p> <pre><code>private AbsOnItemClick absOnItemClick;\n\n// onBindViewHolder\u65b9\u6cd5\u4e2d\u8bbe\u7f6e\u76d1\u542c\n\n    holder.item.setOnClickListener(new View.OnClickListener() {\n        @Override\n        public void onClick(View v) {\n            if (absOnItemClick != null) {\n                absOnItemClick.onClick(c);\n            }\n        }\n    });\n    holder.item.setOnLongClickListener(new View.OnLongClickListener() {\n        @Override\n        public boolean onLongClick(View v) {\n            if (absOnItemClick != null) {\n                absOnItemClick.onLongClick(c);\n            }\n            return true;\n        }\n    });\n\n// setter\u65b9\u6cd5 \u8bbe\u7f6e\u76d1\u542c\u5668\npublic void setAbsOnItemClick(AbsOnItemClick absOnItemClick) {\n    this.absOnItemClick = absOnItemClick;\n}\n</code></pre> <p>\u5728activity\u4e2d\u8bbe\u7f6e\u76d1\u542c\u5668\u3002 <pre><code>mLetterAdapter.setAbsOnItemClick(new AbsOnItemClick() {\n    @Override\n    public void onClick(char c) {\n        Log.d(\"rustApp\", \"[abs] onClick: \" + c);\n    }\n});\n</code></pre></p> <p>\u8fd0\u884c\u8d77\u6765\u770b\u770b\u6548\u679c\u3002\u53ef\u4ee5\u770b\u5230\u6253\u51fa\u4e86log\u3002 <pre><code>rustApp: [abs] onClick: h\n</code></pre></p>"},{"location":"android/ui/view/recyclerView/item_click/#_4","title":"\u62bd\u8c61\u7c7b\u4e0e\u63a5\u53e3","text":"<p>\u5bf9\u6bd4\u63a5\u53e3\u6211\u4eec\u53ef\u4f53\u4f1a\u5230\uff0c\u62bd\u8c61\u7c7b\u6709\u81ea\u5df1\u72ec\u7279\u7684\u5730\u65b9\u3002\u62bd\u8c61\u7c7b\u5f3a\u5236\u6211\u4eec\u5b9e\u73b0\u4e86\u5b83\u7684\u62bd\u8c61\u65b9\u6cd5\u3002\u800c\u666e\u901a\u7684\u65b9\u6cd5\u662f\u7531\u6211\u4eec\u81ea\u5df1\u9009\u62e9\u662f\u5426\u91cd\u5199\u3002 \u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u9700\u8981\u9009\u62e9\u662f\u7528\u63a5\u53e3\u8fd8\u662f\u62bd\u8c61\u7c7b\u3002</p> <p>\u5de5\u7a0b\u5730\u5740 AndroidTutorial</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u534e\u4e3a\u4e91\u793e\u533a \u7b80\u4e66</p>"},{"location":"android/ui/view/recyclerView/scroll_distance/","title":"Android RecyclerView\u83b7\u53d6\u6ed1\u52a8\u8ddd\u79bb","text":"<p>\u672c\u6587\u4ecb\u7ecd\u5185\u5bb9\uff0c\u83b7\u53d6RecyclerView\u6ed1\u52a8\uff08\u6eda\u52a8\uff09\u7684\u8ddd\u79bb\u3002</p> <p>\u83b7\u53d6\u6ed1\u52a8\u7684\u8ddd\u79bb\u53ef\u80fd\u5e76\u4e0d\u662f\u4e00\u4e2a\u975e\u5e38\u5e38\u89c1\u7684\u9700\u6c42\u3002 \u5728\u4e00\u4e9bapp\u4e2d\u6d4f\u89c8\u6587\u7ae0\u5185\u5bb9\u65f6\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u6ce8\u610f\u5230\u4e00\u4e2a\u300cTop\u300d\u6309\u94ae\u3002 \u70b9\u51fb\u8fd9\u4e2a\u6309\u94ae\u53ef\u4ee5\u6ed1\u52a8\u56de\u6587\u7ae0\u7684\u9876\u90e8\u3002 \u800c\u521a\u5f00\u59cb\u6d4f\u89c8\u6587\u7ae0\u65f6\uff0c\u8fd9\u4e2a\u6309\u94ae\u5e76\u6ca1\u6709\u663e\u793a\u51fa\u6765\u3002\u5411\u4e0b\u6ed1\u52a8\u5230\u4e00\u5b9a\u8ddd\u79bb\u7684\u65f6\u5019\uff0c\u5b83\u624d\u4f1a\u51fa\u73b0\u3002 \u5982\u679c\u6211\u4eec\u6765\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\uff0c\u6700\u5148\u8003\u8651\u7684\u5e94\u8be5\u662f\u83b7\u53d6RecyclerView\u6ed1\u52a8\u7684\u8ddd\u79bb\u3002 \u6839\u636e\u6ed1\u52a8\u7684\u8ddd\u79bb\uff0c\u6765\u5224\u65ad\u662f\u5426\u5e94\u8be5\u663e\u793a\u8fd9\u4e2a\u300cTop\u300d\u6309\u94ae\u3002</p> <p>\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u7528RecyclerView\u663e\u793a\u4e00\u4e9b\u6570\u636e\u3002\u4e5f\u77e5\u9053\u4e86\u5982\u4f55\u8bbe\u7f6e\u5b50\u9879\u70b9\u51fb\u7684\u76d1\u542c\u5668\u3002 \u5728\u5b9e\u73b0\u5b50\u9879\u70b9\u51fb\u7684\u76d1\u542c\u5668\u65f6\uff0c\u6211\u4eec\u7528\u5230\u4e86\u76d1\u542c\u8005\u6a21\u5f0f\u3002 \u800cRecyclerView\u6709\u6ed1\u52a8\u65f6\u76d1\u542c\u5668<code>RecyclerView.OnScrollListener</code>\u3002 \u901a\u8fc7\u8fd9\u4e2a\u6ed1\u52a8\u65f6\u76d1\u542c\u5668\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u83b7\u5f97\u6ed1\u52a8\u7684\u72b6\u6001\u3001\u8ddd\u79bb\u7b49\u7b49\u4fe1\u606f\u3002</p>"},{"location":"android/ui/view/recyclerView/scroll_distance/#_1","title":"\u4ee3\u7801\u5b9e\u73b0","text":"<p>\u901a\u8fc7<code>addOnScrollListener</code>\u6dfb\u52a0\u6ed1\u52a8\u76d1\u542c\u3002 <pre><code>recyclerView.addOnScrollListener(new RecyclerView.OnScrollListener() {\n    @Override\n    public void onScrollStateChanged(@NonNull RecyclerView recyclerView, int newState) {\n        super.onScrollStateChanged(recyclerView, newState);\n    }\n\n    @Override\n    public void onScrolled(@NonNull RecyclerView recyclerView, int dx, int dy) {\n        Log.d(TAG, \"onScrolled: dy: \" + dy);\n    }\n});\n</code></pre> \u6ce8\u610f\uff0c\u8fd9\u91cc\u662f<code>add</code>\uff0c\u6dfb\u52a0\u76d1\u542c\u5668\u3002\u4e4b\u524d\u6211\u4eec\u662f<code>set</code>\uff0c\u8bbe\u7f6e\u76d1\u542c\u5668\u3002 \u90fd\u662f\u76d1\u542c\u8005\u6a21\u5f0f\uff0c\u4f46\u5177\u4f53\u5b9e\u73b0\u4e0a\u6709\u533a\u522b\u3002</p> <p><code>RecyclerView.OnScrollListener</code>\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u6027\u5730\u5b9e\u73b0\u5b83\u7684\u65b9\u6cd5\u3002 <code>onScrolled</code>\u65b9\u6cd5\u7684<code>dy</code>\u8868\u793a\u7684\u662f\u6bcf\u4e00\u6b21y\u65b9\u5411\u4e0a\u7684\u76f8\u5bf9\u6ed1\u52a8\u8ddd\u79bb\u3002\u5411\u4e0b\u6ed1\u52a8\u662f\u6b63\u6570\uff0c\u5411\u4e0a\u6ed1\u52a8\u662f\u8d1f\u6570\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u53d8\u91cf<code>mmRvScrollY</code>\u6765\u7d2f\u8ba1\u6ed1\u52a8\u7684\u8ddd\u79bb\u3002 <pre><code>recyclerView.addOnScrollListener(new RecyclerView.OnScrollListener() {\n    int mmRvScrollY = 0; // \u5217\u8868\u6ed1\u52a8\u8ddd\u79bb\n\n    @Override\n    public void onScrollStateChanged(@NonNull RecyclerView recyclerView, int newState) {\n        super.onScrollStateChanged(recyclerView, newState);\n    }\n\n    @Override\n    public void onScrolled(@NonNull RecyclerView recyclerView, int dx, int dy) {\n        mmRvScrollY += dy;\n        Log.d(TAG, \"onScrolled: mmRvScrollY: \" + mmRvScrollY + \", dy: \" + dy);\n    }\n});\n</code></pre></p> <p>\u6bcf\u6b21\u6ed1\u52a8\u90fd\u7d2f\u52a0\u5230<code>mmRvScrollY</code>\u4e2d\u3002\u90e8\u5206\u6253\u5370log\u5982\u4e0b <pre><code>onScrolled: mmRvScrollY: 3167, dy: 3\nonScrolled: mmRvScrollY: 3169, dy: 2\nonScrolled: mmRvScrollY: 3167, dy: -2\nonScrolled: mmRvScrollY: 3155, dy: -12\n</code></pre></p> <p><code>onScrollStateChanged</code>\u65b9\u6cd5\u7ed9\u7684<code>newState</code>\u67093\u4e2a\u72b6\u6001</p> <code>newState</code>\u7684\u5e38\u91cf\u540d \u6570\u503c \u72b6\u6001 SCROLL_STATE_IDLE 0 \u5f53\u524d\u6ca1\u6709\u5728\u6eda\u52a8\uff0c\u9759\u6b62\u72b6\u6001 SCROLL_STATE_DRAGGING 1 \u6b63\u5728\u88ab\u5916\u90e8\u8f93\u5165\u62d6\u52a8\u3002\u6bd4\u5982\u7528\u6237\u7528\u624b\u6307\u62d6\u52a8 SCROLL_STATE_SETTLING 2 \u5916\u90e8\u6ca1\u6709\u62d6\u52a8\u5b83\uff0cRecyclerView\u6b63\u5728\u6267\u884c\u6eda\u52a8\u52a8\u753b\uff0c\u6eda\u52a8\u5230\u6700\u7ec8\u7684\u4f4d\u7f6e"},{"location":"android/ui/view/recyclerView/scroll_distance/#add","title":"add\u76d1\u542c\u8005","text":"<p>\u6211\u4eec\u628a\u76ee\u5149\u8f6c\u5230<code>addOnScrollListener</code>\u65b9\u6cd5\u4e0a\u6765\u3002\u67e5\u9605RecyclerView\u7684\u6e90\u7801\uff0c\u53ef\u4ee5\u770b\u5230 <pre><code>public void addOnScrollListener(@NonNull OnScrollListener listener) {\n    if (mScrollListeners == null) {\n        mScrollListeners = new ArrayList&lt;&gt;();\n    }\n    mScrollListeners.add(listener);\n}\n</code></pre> RecyclerView\u6301\u6709\u4e00\u4e2a<code>mScrollListeners</code>\u5217\u8868\u6765\u5b58\u653e\u591a\u4e2aOnScrollListener\u76d1\u542c\u5668\u3002</p> <p>\u5bf9\u5e94add\u65b9\u6cd5\uff0c\u8fd8\u6709\u4e00\u4e2a<code>clearOnScrollListeners</code>\u65b9\u6cd5\u3002\u628a\u5b58\u7740\u7684OnScrollListener\u76d1\u542c\u5668\u5168\u90e8\u6e05\u9664\u6389\u3002</p> <p>\u4e4b\u524d\u6211\u4eec\u7684\u5b50\u9879\u70b9\u51fb\u76d1\u542c\u5668\u53ea\u67091\u4e2a\uff0c\u7528set\u65b9\u6cd5\u3002\u8fd9\u91cc\u7684\u76d1\u542c\u5668\u53ef\u4ee5\u6709\u591a\u4e2a\uff0c\u5b58\u653e\u5728\u4e00\u4e2a\u5217\u8868\u91cc\u3002 \u672a\u6765\u6211\u4eec\u4f7f\u7528\u76d1\u542c\u8005\u6a21\u5f0f\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u53c2\u8003OnScrollListener\u7684\u601d\u8def\u3002</p> <p>\u5de5\u7a0b\u5730\u5740 AndroidTutorial</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u534e\u4e3a\u4e91\u793e\u533a \u7b80\u4e66</p>"},{"location":"android/ui/view/recyclerView/show_multi_item/","title":"Android RecyclerView\u663e\u793a\u591a\u79cditem","text":"<p>\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u7528RecyclerView\u663e\u793a\u4e00\u4e9b\u6570\u636e\u3002\u4e5f\u77e5\u9053\u5982\u4f55\u83b7\u53d6\u6ed1\u52a8\u7684\u8ddd\u79bb\u3002</p> <p>\u524d\u9762\u6211\u4eec\u7684\u5217\u8868\u4e2d\u663e\u793a\u7684\u90fd\u662f\u540c\u7c7b\u6570\u636e\u3002\u5982\u679c\u8981\u5728\u4e00\u4e2a\u5217\u8868\u4e2d\u663e\u793a\u4e0d\u540c\u7c7b\u522b\u7684\u6570\u636e\uff0c\u8be5\u600e\u4e48\u505a\u5462\uff1f RecyclerView\u5df2\u7ecf\u6709\u5e94\u5bf9\u8fd9\u7c7b\u573a\u666f\u7684\u80fd\u529b\uff0c\u672c\u6587\u63cf\u8ff0\u5982\u4f55\u7528RecyclerView\u663e\u793a\u591a\u79cd\u5185\u5bb9\uff08item\uff09\u3002</p>"},{"location":"android/ui/view/recyclerView/show_multi_item/#_1","title":"\u7efc\u8ff0","text":"<p>\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u6d89\u53ca\u5230\u7684\u7c7b\u548c\u6587\u4ef6\u6bd4\u8f83\u591a\u3002</p> <p>\u653e\u5728\u540c\u4e00\u4e2a\u5305\u91cc\u7684\u6587\u4ef6 <pre><code>BaseMultiData.java\nBaseVH.java\nItemTypeDef.java\nMultiData1.java\nMultiData2.java\nMultiItemAdapter.java\nOneVH.java\nReViewDemoMulti.java\nTwoVH.java\n</code></pre></p> <p>layout\u8d44\u6e90\u6587\u4ef6 <pre><code>item_multi_1.xml\nitem_multi_2.xml\n</code></pre></p> <p></p>"},{"location":"android/ui/view/recyclerView/show_multi_item/#_2","title":"\u573a\u666f\u63cf\u8ff0\uff0c\u6570\u636e\u51c6\u5907","text":"<p>\u9996\u5148\u5047\u8bbe\u573a\u666f\u3002\u5047\u8bbe\u6211\u4eec\u67092\u79cd\u6570\u636e\u3002\u7b2c\u4e00\u79cd\u6570\u636e\u53ea\u67091\u4e2a\u5b57\u7b26\u4e32\uff0c\u7b2c\u4e8c\u79cd\u6570\u636e\u67092\u4e2a\u5b57\u7b26\u4e32\u3002 \u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5148\u8bbe\u8ba1\u51fa\u4e00\u4e2a\u6570\u636e\u7684\u62bd\u8c61\u7c7b\u3002\u5e76\u4e14\u8bbe\u8ba1\u679a\u4e3e\u7c7b\u578b\u6765\u533a\u5206\u8fd92\u79cd\u6570\u636e\u3002</p> <p>\u5229\u7528\u679a\u4e3e\u7c7b\u578b\u6765\u533a\u5206\u6570\u636e\u7684\u7c7b\u522b\uff0c<code>ItemTypeDef.java</code>\u3002 <pre><code>public class ItemTypeDef {\n\n    public static final int ITEM_TYPE_ONE_TEXT = 1;\n    public static final int ITEM_TYPE_2_TEXT = 2;\n\n    public enum Type {\n        ONE_TEXT(ITEM_TYPE_ONE_TEXT),\n        TWO_TEXT(ITEM_TYPE_2_TEXT);\n        int code;\n\n        Type(int code) {\n            this.code = code;\n        }\n\n        public int getCode() {\n            return code;\n        }\n\n        public static Type getItemTypeByCode(int code) {\n            switch (code) {\n                case ITEM_TYPE_ONE_TEXT:\n                    return Type.ONE_TEXT;\n                case ITEM_TYPE_2_TEXT:\n                    return Type.TWO_TEXT;\n            }\n            return Type.ONE_TEXT;\n        }\n    }\n}\n</code></pre> \u679a\u4e3e\u7c7b\u81ea\u5df1\u5e26\u6709<code>ordinal()</code>\u65b9\u6cd5\u6765\u8868\u660e\u679a\u4e3e\u7684\u987a\u5e8f\u503c\u3002 \u4f46\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u6211\u4eec\u5c06\u679a\u4e3e\u5305\u88f9\u5728\u4e00\u4e2a\u7c7b\u91cc\u9762\uff0c\u5e76\u4e14\u5f3a\u884c\u4f7f\u7528\u4e86int\u6765\u6807\u8bb0\u7c7b\u522b\u3002</p> <p>\u6570\u636e\u7684\u62bd\u8c61\u7c7b <pre><code>public abstract class BaseMultiData {\n    public abstract int typeCode();\n}\n</code></pre></p> <p>\u8bbe\u8ba1\u8868\u793a\u5177\u4f53\u6570\u636e\u7684\u7c7b\u3002 \u7b2c1\u79cd\u6570\u636eclass\u3002 <pre><code>public class MultiData1 extends BaseMultiData {\n\n    private String str1;\n\n    public MultiData1(String str1) {\n        this.str1 = str1;\n    }\n\n    public String getStr1() {\n        return str1;\n    }\n\n    @Override\n    public int typeCode() {\n        return ItemTypeDef.Type.ONE_TEXT.getCode();\n    }\n}\n</code></pre></p> <p>\u7b2c2\u79cd\u6570\u636eclass\u3002 <pre><code>public class MultiData2 extends BaseMultiData {\n\n    private String str1;\n    private String str2;\n\n    public MultiData2(String str1, String str2) {\n        this.str1 = str1;\n        this.str2 = str2;\n    }\n\n    public String getStr1() {\n        return str1;\n    }\n\n    public String getStr2() {\n        return str2;\n    }\n\n    @Override\n    public int typeCode() {\n        return ItemTypeDef.Type.TWO_TEXT.getCode();\n    }\n}\n</code></pre></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e24\u79cd\u6570\u636e\u7c7b\u5206\u522b\u6301\u67091\u548c2\u4e2aString\u3002</p>"},{"location":"android/ui/view/recyclerView/show_multi_item/#_3","title":"\u8d44\u6e90\u6587\u4ef6","text":"<p>\u524d\u9762\u8bbe\u8ba1\u4e862\u79cd\u6570\u636e\uff0c\u5bf9\u5e94\u7684\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u8bbe\u8ba12\u79cd\u6837\u5f0f\u3002</p>"},{"location":"android/ui/view/recyclerView/show_multi_item/#layout","title":"layout","text":"<p>\u5148\u51c6\u59072\u79cdlayout\u3002</p> <p>\u7ed9\u7b2c1\u79cd\u6570\u636e<code>MultiData1</code>\u51c6\u5907\u4e86<code>item_multi_1.xml</code>\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"40dp\"\n    android:background=\"#33691E\"\n    android:orientation=\"horizontal\"&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv1\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"center_vertical\"\n        android:layout_marginStart=\"12dp\"\n        android:textColor=\"#ffffff\" /&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre></p> <p>\u7ed9\u7b2c2\u79cd\u6570\u636e<code>MultiData2</code>\u51c6\u5907\u4e86<code>item_multi_2.xml</code> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"50dp\"\n    android:background=\"#ffffff\"\n    android:orientation=\"horizontal\"&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv1\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"center_vertical\"\n        android:layout_marginStart=\"12dp\"\n        android:text=\"tv1\"\n        android:textColor=\"#33691E\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv2\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"center_vertical\"\n        android:layout_marginStart=\"12dp\"\n        android:text=\"tv2\"\n        android:textColor=\"#8BC34A\" /&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre></p>"},{"location":"android/ui/view/recyclerView/show_multi_item/#vh","title":"VH","text":"<p>\u8bbe\u8ba1\u5bf9\u5e94\u7684ViewHolder\u3002 \u9996\u5148\u662f\u62bd\u8c61\u7c7b<code>BaseVH</code>\u3002\u5b83\u6301\u6709\u4e00\u4e2a<code>ItemTypeDef.Type</code>\u6765\u8868\u660e\u81ea\u5df1\u7684\u7c7b\u522b\u3002 <pre><code>public abstract class BaseVH extends RecyclerView.ViewHolder {\n    private ItemTypeDef.Type type;\n    public View root;\n\n    public BaseVH(View itemView, ItemTypeDef.Type type) {\n        super(itemView);\n        this.root = itemView;\n        this.type = type;\n    }\n\n    public ItemTypeDef.Type getType() {\n        return type;\n    }\n}\n</code></pre></p> <p>\u5177\u4f53\u5b9e\u73b0\u7c7b\u3002\u7b2c1\u79cd\u6570\u636e\u7684<code>OneVH</code>\u3002 <pre><code>public class OneVH extends BaseVH {\n    public TextView tv1;\n\n    public OneVH(View itemView, ItemTypeDef.Type type) {\n        super(itemView, type);\n        tv1 = itemView.findViewById(R.id.tv1);\n    }\n}\n</code></pre></p> <p>\u7b2c2\u79cd\u6570\u636e\u7684<code>TwoVH</code>\u3002 <pre><code>public class TwoVH extends BaseVH {\n    public TextView tv1;\n    public TextView tv2;\n\n    public TwoVH(View itemView, ItemTypeDef.Type type) {\n        super(itemView, type);\n        tv1 = itemView.findViewById(R.id.tv1);\n        tv2 = itemView.findViewById(R.id.tv2);\n    }\n}\n</code></pre></p>"},{"location":"android/ui/view/recyclerView/show_multi_item/#_4","title":"\u8bbe\u8ba1\u9002\u914d\u5668","text":"<p>\u73b0\u57282\u79cd\u6570\u636e\u7684\u7c7b\u548c\u8d44\u6e90\u90fd\u51c6\u5907\u597d\u4e86\u3002\u6211\u4eec\u6765\u8bbe\u8ba1\u9002\u914d\u5668\u3002</p> <p><code>RecyclerView.Adapter</code>\u4e2d\u7528\u6765\u533a\u5206\u5b50\u9879\u7c7b\u522b\u7684\u65b9\u6cd5\u662f<code>public int getItemViewType(int position)</code>\u3002 \u6211\u4eec\u9700\u8981\u590d\u5199\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u544a\u8bc9RecyclerView\u5f53\u524d\u5b50\u9879\u7684\u7c7b\u522b\u3002\u5b83\u8fd4\u56de\u7684\u662fint\u3002 <pre><code>    @Override\n    public int getItemViewType(int position) {\n        return dataList.get(position).typeCode();\n    }\n</code></pre></p> <p>\u9002\u914d\u5668\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b <pre><code>public class MultiItemAdapter extends RecyclerView.Adapter&lt;BaseVH&gt; {\n\n    private List&lt;BaseMultiData&gt; dataList = new ArrayList&lt;&gt;();\n\n    public void setDataList(List&lt;BaseMultiData&gt; dataList) {\n        this.dataList = dataList;\n        notifyDataSetChanged();\n    }\n\n    @NonNull\n    @Override\n    public BaseVH onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\n        switch (ItemTypeDef.Type.getItemTypeByCode(viewType)) {\n            case ONE_TEXT:\n                return new OneVH(LayoutInflater.from(parent.getContext()).inflate(R.layout.item_multi_1, parent, false), ItemTypeDef.Type.ONE_TEXT);\n            case TWO_TEXT:\n                return new TwoVH(LayoutInflater.from(parent.getContext()).inflate(R.layout.item_multi_2, parent, false), ItemTypeDef.Type.TWO_TEXT);\n        }\n        return null;\n    }\n\n    @Override\n    public void onBindViewHolder(@NonNull BaseVH holder, int position) {\n        BaseMultiData data = dataList.get(position);\n        switch (holder.getType()) {\n            case ONE_TEXT:\n                ((OneVH) holder).tv1.setText(((MultiData1) data).getStr1());\n                break;\n            case TWO_TEXT:\n                TwoVH twoVH = (TwoVH) holder;\n                MultiData2 data2 = (MultiData2) data;\n                twoVH.tv1.setText(data2.getStr1());\n                twoVH.tv2.setText(data2.getStr2());\n                break;\n        }\n    }\n\n    @Override\n    public int getItemCount() {\n        return dataList.size();\n    }\n\n    @Override\n    public int getItemViewType(int position) {\n        return dataList.get(position).typeCode();\n    }\n}\n</code></pre></p> <p>\u8981\u663e\u793a\u591a\u79cditem\uff0c\u5f97\u628a\u5b83\u4eec\u88c5\u5728\u4e00\u8d77\u3002\u6570\u636e\u5217\u8868<code>dataList</code>\u58f0\u660e\u88c5\u8f7d\u7684\u662f\u62bd\u8c61\u7c7b<code>BaseMultiData</code>\u3002 \u521b\u5efaViewHolder\u7684<code>onCreateViewHolder</code>\u65b9\u6cd5\u4e2d\uff0c\u6839\u636e<code>viewType</code>\u6765\u5224\u65ad\u5e94\u8be5\u521b\u5efa\u54ea\u4e00\u79cdViewHolder\u3002 \u88c5\u914d\u6570\u636e\u7684<code>onBindViewHolder</code>\u65b9\u6cd5\u4e2d\uff0c\u4e5f\u662f\u6839\u636eholder\u7684\u7c7b\u522b\u6765\u8bbe\u7f6e\u76f8\u5e94\u7684\u6570\u636e\u3002\u8fd9\u91cc\u7528\u5230\u4e86\u5f3a\u5236\u8f6c\u6362\u3002</p> <p>\u5728activity\u4e2d\u4f7f\u7528\u8fd9\u4e2a\u9002\u914d\u5668 <pre><code>public class ReViewDemoMulti extends AbsActivity {\n\n    private MultiItemAdapter mMultiItemAdapter = new MultiItemAdapter();\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_recyler_view_demo);\n\n        RecyclerView recyclerView = findViewById(R.id.re_view);\n        recyclerView.setAdapter(mMultiItemAdapter);\n        recyclerView.setLayoutManager(new LinearLayoutManager(this, RecyclerView.VERTICAL, false));\n\n        mMultiItemAdapter.setDataList(genData());\n    }\n\n    private List&lt;BaseMultiData&gt; genData() {\n        List&lt;BaseMultiData&gt; list = new ArrayList&lt;&gt;();\n        for (int i = 0; i &lt; 60; i++) {\n            if (i % 2 == 0) {\n                list.add(new MultiData1(\"[Data1] \" + i));\n            } else {\n                list.add(new MultiData2(\"[Data2] \" + i, \"Type2\"));\n            }\n        }\n        return list;\n    }\n}\n</code></pre></p> <p>\u8fd0\u884c\u8d77\u6765\u5373\u53ef\u770b\u5230\u6548\u679c\u3002 \u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684\ud83c\udf30\uff0c\u5de5\u4f5c\u4e2d\u7684\u5f00\u53d1\u9700\u6c42\u4f1a\u66f4\u590d\u6742\u6216\u7e41\u6742\u3002\u53ef\u4ee5\u672c\u6587\u4ecb\u7ecd\u7684\u65b9\u6cd5\u4e3a\u57fa\u7840\uff0c\u5b9e\u73b0\u5177\u4f53\u7684\u5f00\u53d1\u9700\u6c42\u3002</p> <p>\u5de5\u7a0b\u5730\u5740 AndroidTutorial</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u534e\u4e3a\u4e91\u793e\u533a</p>"},{"location":"android/ui/view/recyclerView/slide-delete-drag-swap-item/","title":"\u4fa7\u6ed1\u5220\u9664\uff0c\u62d6\u52a8\u6392\u5e8f","text":"<p>\u5bf9\u4e8e\u5217\u8868\u6765\u8bf4\uff0c\u4ea4\u4e92\u65b9\u5f0f\u4e0d\u4ec5\u4ec5\u662f\u4e0a\u4e0b\u5de6\u53f3\u6ed1\u52a8\u6574\u4e2a\u5217\u8868\uff0c\u70b9\u51fb\uff0c\u957f\u6309\u8fd9\u4e9b\u3002 RecyclerView\u4e2d\u7684\u9879\u76ee\uff0c\u4e5f\u652f\u6301\u4fa7\u6ed1\u548c\u62d6\u52a8\u7b49\u64cd\u4f5c\u3002 \u76d1\u542c\u5230\u4fa7\u6ed1\u548c\u62d6\u52a8\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u6267\u884c\u60f3\u8981\u7684\u64cd\u4f5c\u3002</p>"},{"location":"android/ui/view/recyclerView/slide-delete-drag-swap-item/#_2","title":"\u793a\u4f8b","text":"<p>\u76ee\u6807\uff1a\u5bf9\u4e8e\u7ad6\u76f4\u7684\u5355\u9879\u5217\u8868\uff0c\u5de6\u53f3\u6ed1\u52a8\u53ef\u5220\u9664\u9009\u9879\uff0c\u957f\u6309\u540e\u62d6\u52a8\u53ef\u6539\u53d8\u9009\u9879\u4f4d\u7f6e\u3002</p> <p>\u4e0b\u9762\u662f\u8fd0\u884c\u6548\u679c\u56fe</p> \u4fa7\u6ed1\u5220\u9664 \u62d6\u52a8\u6392\u5e8f <p>\u53ef\u4ee5\u660e\u786e\u7684\u662f\uff0c\u6211\u4eec\u9700\u8981\u76d1\u542c\u52302\u79cd\u52a8\u4f5c\uff0c\u5de6\u53f3\u4fa7\u6ed1\u548c\u62d6\u52a8\u3002 \u4e3a\u5b9e\u73b0\u8fd9\u4e2a\u76ee\u6807\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5b98\u65b9\u63d0\u4f9b\u7684<code>ItemTouchHelper</code>\u3002</p> <p>\u4e3b\u8981\u5173\u6ce8<code>ItemTouchHelper.Callback</code>\u7c7b\u3002<code>ItemTouchHelper.Callback</code>\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u5148\u6765\u4e86\u89e3\u5b83\u7684\u4ee5\u4e0b3\u4e2a\u65b9\u6cd5\u3002</p> <ul> <li><code>getMovementFlags</code> \u5728\u6b64\u65b9\u6cd5\u91cc\u9762\u6211\u4eec\u9700\u8981\u6784\u5efa\u4e24\u4e2aflag\uff0c\u4e00\u4e2a\u662fdragFlags\uff0c\u8868\u793a\u62d6\u52a8\u6548\u679c\u652f\u6301\u7684\u65b9\u5411\uff0c\u53e6\u4e00\u4e2a\u662fswipeFlags\uff0c\u8868\u793a\u4fa7\u6ed1\u6548\u679c\u652f\u6301\u7684\u65b9\u5411\u3002\u5728\u6211\u4eec\u7684Demo\u4e2d\uff0c\u62d6\u52a8\u6267\u884c\u4e0a\u4e0b\u4e24\u4e2a\u65b9\u5411\uff0c\u4fa7\u6ed1\u6267\u884c\u5de6\u53f3\u4e24\u4e2a\u65b9\u5411\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u6211\u4eec\u90fd\u53ef\u4ee5\u5728\u6b64\u65b9\u6cd5\u91cc\u9762\u5b9a\u4e49\u3002</li> <li><code>onMove</code> \u5f53\u62d6\u52a8\u4e8b\u4ef6\u5df2\u53d1\u751f\uff0c\u4f1a\u56de\u8c03\u6b64\u65b9\u6cd5\u3002\u5728\u6b64\u65b9\u6cd5\u91cc\u9762\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u66f4\u65b0\u6570\u636e\u6e90\u3002\u4f8b\u5982\uff0c\u4e00\u4e2aItemView\u4ece0\u62d6\u5230\u4e861\u4f4d\u7f6e\uff0c\u90a3\u4e48\u5bf9\u5e94\u7684\u6570\u636e\u6e90\u4e5f\u9700\u8981\u66f4\u6539\u4f4d\u7f6e\u3002</li> <li><code>onSwiped</code> \u5f53\u4fa7\u6ed1\u4e8b\u4ef6\u5df2\u53d1\u751f\uff0c\u4f1a\u56de\u8c03\u6b64\u65b9\u6cd5\u3002\u5728\u6b64\u65b9\u6cd5\u91cc\u9762\uff0c\u6211\u4eec\u4e5f\u4f1a\u66f4\u65b0\u6570\u636e\u6e90\u3002\u4e0eonMove\u65b9\u6cd5\u4e0d\u540c\u5230\u7684\u662f\uff0c\u6211\u4eec\u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u9762\u4ece\u6570\u636e\u6e90\u91cc\u9762\u79fb\u9664\u76f8\u5e94\u7684\u6570\u636e\uff0c\u7136\u540e\u8c03\u7528<code>notifyXXX</code>\u65b9\u6cd5\u3002</li> </ul> <p>\u6211\u4eec\u65b0\u5efa<code>ReViewTouchCallback</code>\u7c7b\uff0c\u7ee7\u627f<code>ItemTouchHelper.Callback</code>\u3002 <pre><code>public class ReViewTouchCallback extends ItemTouchHelper.Callback {\n\n    private final IActionListener mIActionListener;\n\n    public ReViewTouchCallback(IActionListener IActionListener) {\n        mIActionListener = IActionListener;\n    }\n\n    @Override\n    public int getMovementFlags(RecyclerView recyclerView, RecyclerView.ViewHolder viewHolder) {\n        int dragFlags = ItemTouchHelper.UP | ItemTouchHelper.DOWN; // \u4e0a\u4e0b\u62d6\u52a8\n        int swipeFlags = ItemTouchHelper.LEFT | ItemTouchHelper.RIGHT; // \u5411\u5de6\u6ed1\u52a8\n        return makeMovementFlags(dragFlags, swipeFlags);\n    }\n\n    @Override\n    public boolean onMove(RecyclerView recyclerView, RecyclerView.ViewHolder viewHolder, RecyclerView.ViewHolder target) {\n        return mIActionListener.onItemMove(viewHolder.getAdapterPosition(), target.getAdapterPosition());\n    }\n\n    @Override\n    public void onSwiped(RecyclerView.ViewHolder viewHolder, int direction) {\n        mIActionListener.onItemRemove(viewHolder.getAdapterPosition());\n    }\n}\n</code></pre> \u590d\u5199\u4e863\u4e2a\u4e3b\u8981\u7684\u65b9\u6cd5\uff0c\u5e76\u5c06\u56de\u8c03\u503c\u4f20\u51fa\u6765\u3002</p> <p>\u5176\u4e2d<code>IActionListener</code>\u662f\u6211\u4eec\u8bbe\u8ba1\u7684\u76d1\u542c\u5668 <pre><code>public interface IActionListener {\n    boolean onItemMove(int pos, int targetPos);\n\n    void onItemRemove(int pos);\n}\n</code></pre></p> <p>\u5728activity\u4e2d\u5b9e\u9645\u4f7f\u7528\u3002\u76d1\u542c\u5230\u4fa7\u6ed1\u6216\u8005\u62d6\u52a8\u4e8b\u4ef6\u65f6\uff0c\u5bf9\u6570\u636e\u5217\u8868\u8fdb\u884c\u64cd\u4f5c\u3002 <pre><code>// onCreated\u65b9\u6cd5\u4e2d\u8fdb\u884c\u8bbe\u7f6e\nItemTouchHelper itemTouchHelper = new ItemTouchHelper(new ReViewTouchCallback(new IActionListener() {\n    @Override\n    public boolean onItemMove(int src, int target) {\n        Collections.swap(mAdapter.getDataList(), src, target);\n        mAdapter.notifyItemMoved(src, target);\n        return true;\n    }\n\n    @Override\n    public void onItemRemove(int pos) {\n        mAdapter.getDataList().remove(pos);\n        mAdapter.notifyItemRemoved(pos);\n    }\n}));\nitemTouchHelper.attachToRecyclerView(binding.reView);\n</code></pre> \u79fb\u52a8item\uff0c\u9700\u8981\u8c03\u7528Adapter\u7684<code>notifyItemMoved</code>\u65b9\u6cd5\u3002 RecyclerView\u4f1a\u6709\u4e00\u4e2a\u8fc7\u6e21\u52a8\u753b\u3002</p> <p>\u76d1\u542c\u5230\u5220\u9664\u64cd\u4f5c\u65f6\uff0c\u5c06\u6570\u636e\u5217\u8868\u91cc\u7684\u5143\u7d20\u5220\u9664\u6389\u3002\u7136\u540e\u8c03\u7528Adapter\u7684<code>notifyItemRemoved</code>\u65b9\u6cd5\u3002 \u540c\u6837\u4f1a\u6709\u4e00\u4e2a\u5220\u9664\u7684\u8fc7\u6e21\u52a8\u753b\u3002</p> <p>\u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\uff0c\u9700\u8981\u8c03\u7528<code>attachToRecyclerView</code>\u4e0eRecyclerView\u8fdb\u884c\u7ed1\u5b9a\u3002</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a</p>"},{"location":"android/ui/view/recyclerView/staggered-grid-use/","title":"\u7011\u5e03\u6d41\u6548\u679c","text":"<p>\u4f7f\u7528StaggeredGridLayoutManager\u5b9e\u73b0\u7011\u5e03\u6d41\u6548\u679c\u3002</p> <p>\u5047\u8bbe\u6211\u4eec\u8981\u505a\u4e00\u4e2a\u7ad6\u76f4\u5217\u8868\uff0c\u6bcf\u884c2\u4e2aitem\u3002</p> <p>\u6548\u679c\u56fe </p> <p>\u7ed9RecyclerView\u4f7f\u7528<code>StaggeredGridLayoutManager</code>\u3002 <pre><code>binding.reView.setLayoutManager(new StaggeredGridLayoutManager(2, RecyclerView.VERTICAL));\n</code></pre></p> <p>item\u7684layout <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:orientation=\"horizontal\"&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:background=\"#03A9F4\"\n        android:gravity=\"center\"\n        android:minHeight=\"40dp\"\n        android:text=\"data item\"\n        android:textColor=\"#fff\"\n        android:textSize=\"18sp\"\n        android:textStyle=\"bold\" /&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre></p> <p>\u64cd\u4f5c\u6570\u636e\u5217\u8868\uff0c\u589e\u52a0\u548c\u5220\u9664\u4e00\u4e9b\u5b50\u9879\u3002 \u589e\u52a0\u6570\u636e\u540e\uff0c\u8c03\u7528<code>mAdapter.notifyItemInserted</code>\u66f4\u65b0\u5217\u8868\u3002 \u5220\u9664\u6570\u636e\u540e\uff0c\u8c03\u7528<code>mAdapter.notifyItemRemoved</code>\u3002 <pre><code>private View.OnClickListener mOnClickListener = new View.OnClickListener() {\n    @Override\n    public void onClick(View v) {\n        switch (v.getId()) {\n            case R.id.head_add1:\n                mAdapter.getDataList().add(0, new Data(\"data\\n\" + System.currentTimeMillis(), color1));\n                mAdapter.notifyItemInserted(0);\n                break;\n            case R.id.head_minus1:\n                mAdapter.getDataList().remove(0);\n                mAdapter.notifyItemRemoved(0);\n                break;\n            case R.id.tail_add1:\n                mAdapter.getDataList().add(new Data(\"data\\n\" + System.currentTimeMillis(), color2));\n                mAdapter.notifyItemInserted(mAdapter.getDataList().size() - 1);\n                break;\n            case R.id.tail_minus1:\n                int tail = mAdapter.getItemCount() - 1;\n                mAdapter.getDataList().remove(tail);\n                mAdapter.notifyItemRemoved(tail);\n                break;\n            case R.id.head3_add1:\n                mAdapter.getDataList().add(3, new Data(\"data\\n\" + System.currentTimeMillis(), color1));\n                mAdapter.notifyItemInserted(3);\n                break;\n            case R.id.head3_minus1:\n                mAdapter.getDataList().remove(3);\n                mAdapter.notifyItemRemoved(3);\n                break;\n        }\n    }\n};\n</code></pre></p> <p>\u6548\u679c\u5c55\u793a</p>"},{"location":"android/ui/view/rtfsc/post/","title":"Android View post \u65b9\u6cd5","text":"\u66f4\u65b0\u65e5\u671f 2021-9-19 <ul> <li>2021-9-19 \u521b\u5efa</li> </ul> <p>\u89e3\u6790<code>View.post</code>\u65b9\u6cd5\u3002\u5206\u6790\u4e00\u4e0b\u8fd9\u4e2a\u65b9\u6cd5\u7684\u6d41\u7a0b\u3002</p> <p>\u8bf4\u8d77post\u65b9\u6cd5\uff0c\u6211\u4eec\u5f88\u5bb9\u6613\u8054\u60f3\u5230Handler\u7684<code>post</code>\u65b9\u6cd5\uff0c\u90fd\u662f\u63a5\u6536\u4e00\u4e2aRunnable\u5bf9\u8c61\u3002\u90a3\u4e48\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u6709\u5565\u4e0d\u540c\u5462\uff1f</p>"},{"location":"android/ui/view/rtfsc/post/#handlerpost","title":"Handler\u7684post\u65b9\u6cd5","text":"<p>\u5148\u6765\u7b80\u5355\u770b\u4e00\u4e0bHandler\u7684<code>post(Runnable)</code>\u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u662f\u5c06\u4e00\u4e2aRunnable\u52a0\u5230\u6d88\u606f\u961f\u5217\u4e2d\uff0c\u5e76\u4e14\u4f1a\u5728\u8fd9\u4e2ahandler\u5173\u8054\u7684\u7ebf\u7a0b\u91cc\u6267\u884c\u3002</p> <p>\u4e0b\u9762\u662f\u5173\u8054\u7684\u90e8\u5206\u6e90\u7801\u3002\u53ef\u4ee5\u770b\u5230\u4f20\u5165\u7684Runnable\u5bf9\u8c61\uff0c\u88c5\u5165Message\u540e\uff0c\u88ab\u6dfb\u52a0\u8fdb\u4e86<code>queue</code>\u961f\u5217\u4e2d\u3002</p> Handler \u6709\u5173\u7684\u90e8\u5206\u6e90\u7801 <pre><code>// android.os Handler \u6709\u5173\u7684\u90e8\u5206\u6e90\u7801\npublic final boolean post(@NonNull Runnable r) {\n    return sendMessageDelayed(getPostMessage(r), 0);\n}\n\nprivate static Message getPostMessage(Runnable r) {\n    Message m = Message.obtain();\n    m.callback = r;\n    return m;\n}\n\npublic final boolean sendMessageDelayed(@NonNull Message msg, long delayMillis) {\n    if (delayMillis &lt; 0) {\n        delayMillis = 0;\n    }\n    return sendMessageAtTime(msg, SystemClock.uptimeMillis() + delayMillis);\n}\n\npublic boolean sendMessageAtTime(@NonNull Message msg, long uptimeMillis) {\n    MessageQueue queue = mQueue;\n    if (queue == null) {\n        RuntimeException e = new RuntimeException(\n                this + \" sendMessageAtTime() called with no mQueue\");\n        Log.w(\"Looper\", e.getMessage(), e);\n        return false;\n    }\n    return enqueueMessage(queue, msg, uptimeMillis);\n}\n\nprivate boolean enqueueMessage(@NonNull MessageQueue queue, @NonNull Message msg,\n        long uptimeMillis) {\n    msg.target = this;\n    msg.workSourceUid = ThreadLocalWorkSource.getUid();\n\n    if (mAsynchronous) {\n        msg.setAsynchronous(true);\n    }\n    return queue.enqueueMessage(msg, uptimeMillis);\n}\n</code></pre> <p>\u5177\u4f53\u6d41\u7a0b\uff0c\u53ef\u4ee5\u770bhandler\u4ecb\u7ecd</p>"},{"location":"android/ui/view/rtfsc/post/#viewpost","title":"View\u7684post\u65b9\u6cd5","text":"<p>\u6211\u4eec\u76f4\u63a5\u8ddf\u7740<code>post</code>\u7684\u6e90\u7801\u8d70\u3002</p> <p><pre><code>public boolean post(Runnable action) {\n    final AttachInfo attachInfo = mAttachInfo;\n    if (attachInfo != null) {\n        return attachInfo.mHandler.post(action);\n    }\n\n    // Postpone the runnable until we know on which thread it needs to run.\n    // Assume that the runnable will be successfully placed after attach.\n    getRunQueue().post(action);\n    return true;\n}\n\nprivate HandlerActionQueue getRunQueue() {\n    if (mRunQueue == null) {\n        mRunQueue = new HandlerActionQueue();\n    }\n    return mRunQueue;\n}\n</code></pre> \u53ef\u4ee5\u770b\u5230\u4e00\u5f00\u59cb\u5c31\u67e5\u8be2\u662f\u5426\u6709<code>attachInfo</code>\uff0c\u5982\u679c\u6709\uff0c\u5219\u7528<code>attachInfo.mHandler</code>\u6765\u6267\u884c\u8fd9\u4e2a\u4efb\u52a1\u3002</p> <p>\u5982\u679c\u6ca1\u6709<code>attachInfo</code>\uff0c\u5219\u6dfb\u52a0\u5230<code>View</code>\u81ea\u5df1\u7684<code>mRunQueue</code>\u4e2d\u3002\u786e\u5b9a\u8fd0\u884c\u7684\u7ebf\u7a0b\u540e\uff0c\u518d\u6267\u884c\u4efb\u52a1\u3002</p> <p><code>post(Runnable action)</code>\u7684\u8fd4\u56deboolean\u503c\uff0c\u5982\u679c\u4e3atrue\uff0c\u8868\u793a\u4efb\u52a1\u88ab\u6dfb\u52a0\u5230\u6d88\u606f\u961f\u5217\u4e2d\u4e86\u3002 \u5982\u679c\u662ffalse\uff0c\u901a\u5e38\u8868\u793a\u6d88\u606f\u961f\u5217\u5173\u8054\u7684looper\u6b63\u5728\u9000\u51fa\u3002</p> <p>\u90a3\u4e48\u6211\u4eec\u9700\u8981\u4e86\u89e3AttachInfo\u548cHandlerActionQueue\u3002</p>"},{"location":"android/ui/view/rtfsc/post/#attachinfo","title":"AttachInfo","text":"<p>AttachInfo\u662fView\u7684\u9759\u6001\u5185\u90e8\u7c7b\u3002View\u5173\u8054\u5230\u7236window\u540e\uff0c\u7528\u8fd9\u4e2a\u7c7b\u6765\u5b58\u50a8\u4e00\u4e9b\u4fe1\u606f\u3002</p> <p>AttachInfo\u5b58\u50a8\u7684\u4e00\u90e8\u5206\u4fe1\u606f\u5982\u4e0b\uff1a</p> <ul> <li><code>WindowId mWindowId</code> window\u7684\u6807\u5fd7</li> <li><code>View mRootView</code> \u6700\u9876\u90e8\u7684view</li> <li><code>Handler mHandler</code> \u8fd9\u4e2ahandler\u53ef\u4ee5\u7528\u6765\u5904\u7406\u4efb\u52a1</li> </ul>"},{"location":"android/ui/view/rtfsc/post/#handleractionqueue","title":"HandlerActionQueue","text":"<p>\u5f53View\u8fd8\u6ca1\u6709handler\u7684\u65f6\u5019\uff0c\u62ffHandlerActionQueue\u6765\u7f13\u5b58\u4efb\u52a1\u3002HandlerAction\u662f\u5b83\u7684\u9759\u6001\u5185\u90e8\u7c7b\uff0c\u5b58\u50a8Runnable\u4e0e\u5ef6\u65f6\u4fe1\u606f\u3002 <pre><code>public class HandlerActionQueue {\n    private HandlerAction[] mActions;\n\n    public void post(Runnable action)\n    public void executeActions(Handler handler)\n    // ...\n\n    private static class HandlerAction {\n        final Runnable action;\n        final long delay;\n        // ...\n    }\n}\n</code></pre></p>"},{"location":"android/ui/view/rtfsc/post/#viewmrunqueue","title":"View\u7684mRunQueue","text":"<p>\u5c06\u4efb\u52a1\uff08<code>runnable</code>\uff09\u6392\u6210\u961f\u3002\u5f53View\u5173\u8054\u4e0a\u7a97\u53e3\u5e76\u4e14\u6709handler\u540e\uff0c\u518d\u6267\u884c\u8fd9\u4e9b\u4efb\u52a1\u3002</p> <pre><code>/**\n * Queue of pending runnables. Used to postpone calls to post() until this\n * view is attached and has a handler.\n */\nprivate HandlerActionQueue mRunQueue;\n</code></pre> <p>\u8fd9\u4e2a<code>mRunQueue</code>\u91cc\u5b58\u50a8\u7684\u4efb\u52a1\u5565\u65f6\u5019\u88ab\u6267\u884c\uff1f\u6211\u4eec\u5173\u6ce8<code>dispatchAttachedToWindow</code>\u65b9\u6cd5\u3002 <pre><code>void dispatchAttachedToWindow(AttachInfo info, int visibility) {\n    // ...\n    // Transfer all pending runnables.\n    if (mRunQueue != null) {\n        mRunQueue.executeActions(info.mHandler);\n        mRunQueue = null;\n    }\n    // ...\n}\n</code></pre> \u8fd9\u4e2a\u65b9\u6cd5\u91cc\u8c03\u7528\u4e86<code>mRunQueue.executeActions</code>\u3002</p> <p><code>executeActions(Handler handler)</code>\u65b9\u6cd5\u5b9e\u9645\u4e0a\u662f\u7528\u4f20\u5165\u7684handler\u5904\u7406\u961f\u5217\u4e2d\u7684\u4efb\u52a1\u3002</p> <p>\u800c\u8fd9\u4e2a<code>dispatchAttachedToWindow</code>\u4f1a\u88abViewGroup\u4e2d\u88ab\u8c03\u7528\u3002</p> <p>\u6216\u8005\u662fViewRootImpl\u4e2d\u8c03\u7528 <pre><code>host.dispatchAttachedToWindow(mAttachInfo, 0);\n</code></pre></p>"},{"location":"android/ui/view/rtfsc/post/#_1","title":"\u5c0f\u7ed3","text":"<p>View\u7684post\u65b9\u6cd5\uff0c\u5b9e\u9645\u4e0a\u662f\u4f7f\u7528\u4e86AttachInfo\u7684<code>handler</code>\u3002</p> <p>\u5982\u679cView\u5f53\u524d\u8fd8\u6ca1\u6709AttachInfo\uff0c\u5219\u628a\u4efb\u52a1\u6dfb\u52a0\u5230\u4e86View\u81ea\u5df1\u7684HandlerActionQueue\u961f\u5217\u4e2d\uff0c\u7136\u540e\u5728<code>dispatchAttachedToWindow</code>\u4e2d\u628a\u4efb\u52a1\u4ea4\u7ed9\u4f20\u5165\u7684AttachInfo\u7684<code>handler</code>\u3002\u4e5f\u53ef\u4ee5\u8fd9\u6837\u8ba4\u4e3a\uff0c<code>View.post</code>\u7528\u7684\u5c31\u662f<code>handler.post</code>\u3002</p> <p>\u6211\u4eec\u5728\u83b7\u53d6View\u7684\u5bbd\u9ad8\u65f6\uff0c\u4f1a\u5229\u7528View\u7684post\u65b9\u6cd5\uff0c\u5c31\u662f\u7b49View\u771f\u7684\u5173\u8054\u5230window\u518d\u62ff\u5bbd\u9ad8\u4fe1\u606f\u3002</p> <p>\u6d41\u7a0b\u56fe\u5f52\u7eb3\u5982\u4e0b</p> <p></p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u534e\u4e3a\u4e91\u793e\u533a \u6398\u91d1</p>"},{"location":"android/ui/view/textView/SpannableString_intro/","title":"\u7b80\u4ecb","text":""},{"location":"android/ui/view/textView/SpannableString_intro/#textview","title":"TextView\u663e\u793a\u6b21\u65b9\u65b9\u7b26\u53f7\u6837\u5f0f","text":"<p>\u6bd4\u5982\u663e\u793a\u5e26\u6709\u5e73\u65b9\u7684\u5b57\u7b26\u4e32<code>kg/cm2</code>\uff0c\u4f7f\u7528<code>RelativeSizeSpan</code>\u3002 <pre><code>SpannableString mUnitStr = new SpannableString(\"kg/cm2\");\nmUnitStr.setSpan(new RelativeSizeSpan(0.5f), 5, 6, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);//\u4e00\u534a\u5927\u5c0f\nmUnitStr.setSpan(new SuperscriptSpan(), 5, 6, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);   //\u4e0a\u6807\n</code></pre></p>"},{"location":"android/ui/view/textView/SpannableString_intro/#clickablespan","title":"\u4f7f\u7528ClickableSpan","text":"<p>\u60f3\u83b7\u5f97\u70b9\u51fb\u6548\u679c\uff0c\u53ef\u4ee5\u65b0\u5efa\u4e00\u4e2a\u7c7b\u7ee7\u627f<code>ClickableSpan</code>\u3002 \u5728<code>updateDrawState(TextPaint ds)</code>\u65b9\u6cd5\u4e2d\u53ef\u4ee5\u8bbe\u7f6e\u989c\u8272\u3002\u8fd9\u6837\u540c\u65f6\u5b9e\u73b0\u4e86\u989c\u8272\u548c\u70b9\u51fb\u7684\u9700\u6c42\u3002</p> <pre><code>    public abstract class ColorClickSpan extends ClickableSpan {\n        private int color;\n\n        public ColorClickSpan(int color) {\n            this.color = color;\n        }\n\n        @Override\n        public void updateDrawState(TextPaint ds) {\n            if (ds != null) {\n                ds.setColor(color);\n                ds.setUnderlineText(true);\n            }\n        }\n    }\n</code></pre> <p>\u4f7f\u7528\u65f6\u4e0d\u8981\u5fd8\u8bb0<code>setMovementMethod</code>\u65b9\u6cd5\u3002 <pre><code>tv.setText(clickSpan);\ntv.setMovementMethod(LinkMovementMethod.getInstance());\n</code></pre></p>"},{"location":"android/ui/view/textView/foregroundColorSpan_not_work/","title":"TextView ForegroundColorSpan \u5931\u6548","text":"<p>SpannableStringBuilder\u5148\u540e\u4f7f\u7528\u4e86ClickableSpan\u548cForegroundColorSpan\uff0cForegroundColorSpan\u5931\u6548\u95ee\u9898\u3002 \u76f4\u89c2\u8868\u73b0\u662f\u6ca1\u6709ForegroundColorSpan\u7684\u989c\u8272\u3002</p> <p>\u4ee5\u4e0b\u4ee3\u7801\uff0c\u5728\u67d0\u4e9b\u65e7\u673a\u5668\u4e0a\uff0cAndroid 7\uff0c\u51fa\u73b0\u6b64\u95ee\u9898\u3002\u7ea2\u7c736A\uff088.1.0\uff09\uff0c\u4e00\u52a05\uff0810\uff09\uff0c\u5747\u65e0\u6b64\u95ee\u9898\u3002 <pre><code>SpannableStringBuilder ssb = new SpannableStringBuilder(\"my sentence.\");\nClickableSpan clickableSpan = new ClickableSpan() {\n    @Override\n    public void onClick(@NonNull View widget) {\n        // ..\n    }\n};\nssb.setSpan(clickableSpan, start, end, Spanned.SPAN_EXCLUSIVE_INCLUSIVE);\nssb.setSpan(new UnderlineSpan(), start, end, Spanned.SPAN_EXCLUSIVE_INCLUSIVE);\nssb.setSpan(new ForegroundColorSpan(colorValue), start, end, Spanned.SPAN_EXCLUSIVE_INCLUSIVE);\n</code></pre></p>"},{"location":"android/ui/view/textView/foregroundColorSpan_not_work/#_1","title":"\u89e3\u51b3\u65b9\u6cd5","text":"<p>\u6211\u4eec\u67e5\u770b<code>ForegroundColorSpan</code>\u6e90\u7801\uff0c\u53d1\u73b0\u6307\u5b9a\u989c\u8272\u662f\u901a\u8fc7<code>updateDrawState(TextPaint ds)</code>\u6765\u5b9e\u73b0\u7684\u3002 \u7531\u6b64\u60f3\u5230\uff0c\u5728ClickableSpan\u4e2d\u987a\u4fbf\u6307\u5b9a\u989c\u8272\uff0c\u4e0d\u4f7f\u7528ForegroundColorSpan\u5c31\u53ef\u4ee5\u6765\u3002</p> <p>\u65b0\u589e\u4e00\u4e2a\u62bd\u8c61\u7c7b<code>ColorClickSpan</code>\u3002\u91cc\u9762\u6709\u4e00\u4e2a\u989c\u8272\u503c\u3002 <pre><code>    public abstract class ColorClickSpan extends ClickableSpan {\n        private int color;\n\n        public ColorClickSpan(int color) {\n            this.color = color;\n        }\n\n        @Override\n        public void updateDrawState(TextPaint ds) {\n            if (ds != null) {\n                ds.setColor(color);\n                ds.setUnderlineText(true);\n            }\n        }\n    }\n</code></pre></p> <p>\u76f4\u63a5\u4f7f\u7528<code>ColorClickSpan</code> <pre><code>    ssb.setSpan(new ColorClickSpan(color) {\n        @Override\n        public void onClick(View widget) {\n            // ...\n        }\n    }, start, end, Spanned.SPAN_EXCLUSIVE_INCLUSIVE);\n</code></pre></p> <p>\u989c\u8272\u53ef\u4ee5\u6b63\u5e38\u663e\u793a\u4e86\u3002</p>"},{"location":"android/ui/view/textView/intro/","title":"TextView\u7b80\u4ecb","text":"<p>\u672c\u6587\u4ecb\u7ecdTextView\u7684\u4f7f\u7528\u3002\u4ecb\u7ecd\u4e00\u4e9b\u5e38\u7528\u7684\u5c5e\u6027\u3002</p>"},{"location":"android/ui/view/textView/intro/#textview_1","title":"TextView","text":"<p>\u6587\u5b57\uff0c\u662f\u6211\u4eec\u4f20\u8fbe\u4fe1\u606f\u7684\u4e00\u79cd\u5e38\u89c1\u65b9\u5f0f\u3002\u5728\u5b89\u5353\u5e94\u7528\u4e0a\u663e\u793a\u6587\u5b57\uff0c\u6211\u4eec\u901a\u5e38\u4f7f\u7528TextView\u3002 \u4e4b\u524d\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u5982\u4f55\u83b7\u53d6\u5230layout\u4e2d\u7684TextView\uff0c\u4e5f\u77e5\u9053<code>setText()</code>\u65b9\u6cd5\u53ef\u4ee5\u4fee\u6539\u663e\u793a\u7684\u6587\u5b57\u3002</p> <p>\u7ed3\u5408\u6211\u4eec\u5b9e\u9645\u7684\u751f\u6d3b\u548c\u5b66\u4e60\u7ecf\u9a8c\uff0c\u5199\u5b57\u7684\u65f6\u5019\uff0c\u6709\u54ea\u4e9b\u65b9\u9762\u662f\u53ef\u4ee5\u7531\u6211\u4eec\u6765\u63a7\u5236\u7684\uff1f \u6587\u672c\u5185\u5bb9\uff1b\u6587\u5b57\u989c\u8272\uff1b\u5927\u5c0f\uff1b\u80cc\u666f\u7b49\u7b49\u3002</p> <p>\u6700\u7b80\u5355\u7684TextView\u3002 <pre><code>&lt;TextView\n    android:layout_width=\"wrap_content\"\n    android:layout_height=\"wrap_content\" /&gt;\n</code></pre></p> <p>\u5f97\u76ca\u4e8eas\u5f3a\u5927\u7684\u63d0\u793a\u529f\u80fd\uff0c\u6211\u4eec\u5728layout\u4e2d\u8f93\u5165<code>&lt;Te</code>\u7684\u65f6\u5019\uff0cas\u53ef\u80fd\u5c31\u5f39\u51fa\u4e86\u63d0\u793a\u3002</p> <p></p> <p>\u56de\u8f66\u6216\u8005\u9f20\u6807\u53cc\u51fbTextView\u5373\u53ef\u3002</p> <p>\u8fd9\u91cc\u5173\u6ce8\u4e24\u4e2a\u57fa\u672c\u5c5e\u6027<code>layout_width</code>\u548c<code>layout_height</code>\u3002\u5206\u522b\u8868\u793aTextView\u7684\u5bbd\u5ea6\u548c\u9ad8\u5ea6\u8bbe\u7f6e\u3002 \u5b9e\u9645\u4e0a\u8fd9\u4e24\u4e2a\u5c5e\u6027\u662fView\u7684\u5c5e\u6027\u3002TextView\u7ee7\u627f\u81eaView\u3002\u5bbd\u9ad8\u5c5e\u6027\u662f\u57fa\u7840\u5c5e\u6027\uff0c\u662f\u5fc5\u987b\u8bbe\u7f6e\u7684\u3002</p>"},{"location":"android/ui/view/textView/intro/#_1","title":"\u5bbd\u548c\u9ad8\u5c5e\u6027","text":"<p>layout_width/layout_height \u53ef\u4ee5\u586b\u5165<code>wrap_content</code>\uff0c<code>match_parent</code>\u6216\u8005\u5177\u4f53\u7684\u6570\u503c\u3002</p> <p>wrap_content \u8868\u793a\u63a7\u4ef6\u5bbd/\u9ad8\u5ea6\u53ef\u7531\u5185\u5bb9\u6765\u51b3\u5b9a\u3002\u5bf9\u4e8eTextView\uff0c\u6587\u5b57\u8d8a\u957f\uff0c\u5b83\u7684\u5bbd\u5ea6\u8d8a\u5bbd\uff0c\u76f4\u5230\u7236view\uff08\u4e0a\u5c42\u5bb9\u5668\uff09\u5141\u8bb8\u7684\u6700\u5927\u5bbd/\u9ad8\u5ea6\u3002</p> <p>match_parent \u8868\u793a\u63a7\u4ef6\u5bbd/\u9ad8\u5ea6\u8fbe\u5230\u7236view\u5141\u8bb8\u7684\u6700\u5927\u503c\u3002\u901a\u4fd7\u8bf4\u5c31\u662f\u628a\u7a7a\u95f4\u6491\u6ee1\u3002</p> <p>\u5f53\u7136\u6211\u4eec\u4e5f\u53ef\u4ee5\u8f93\u5165\u5177\u4f53\u6570\u503c\u3002\u6bd4\u5982<code>80dp</code>\u3002 dp\u662f\u5b89\u5353\u4e2d\u7684\u4e00\u79cd\u5355\u4f4d\uff0c\u901a\u5e38\u7528\u6765\u89c4\u5b9a\u63a7\u4ef6\u7684\u5bbd\u9ad8\uff0c\u95f4\u9694\u8ddd\u79bb\u7b49\u7b49\u3002\u6211\u4eec\u90fd\u77e5\u9053\u5e02\u9762\u4e0a\u6709\u5f88\u591a\u5f88\u591a\u5f88\u591a\u79cd\u5b89\u5353\u624b\u673a\u3002\u5404\u4e2a\u624b\u673a\u5c4f\u5e55\u5927\u5c0f\u548c\u5206\u8fa8\u7387\u53ef\u80fd\u90fd\u6709\u5dee\u522b\u3002\u4f8b\u5982\u6709\u5c0f\u7c73\u624b\u673a\u548c\u534e\u4e3a\u624b\u673a\uff0c\u5b83\u4eec\u7684\u5c4f\u5e55\u5927\u5c0f\u548c\u5206\u8fa8\u7387\u90fd\u4e0d\u4e00\u6837\u3002\u6211\u4eec\u7ed9TextView\u8bbe\u7f6e\u5bbd\u5ea6\u4e3a100dp\u540e\uff0c\u5728\u4e24\u4e2a\u624b\u673a\u7684\u5c4f\u5e55\u4e0a\uff0c\u5b83\u7684\u7269\u7406\u5bbd\u5ea6\u662f\u5dee\u4e0d\u591a\u7684\u3002</p> <p>\u7c7b\u4f3c\u7684\uff0c\u8868\u793a\u6587\u5b57\u5927\u5c0f\u7684\u5355\u4f4d\uff0c\u5b89\u5353\u91cc\u7528<code>sp</code>\u3002</p>"},{"location":"android/ui/view/textView/intro/#_2","title":"\u663e\u793a\u6587\u5b57","text":"<p>\u663e\u793a\u6587\u5b57\uff0c\u53ef\u80fd\u662fTextView\u6700\u4e3b\u8981\u7684\u7528\u6cd5\u4e86\u3002\u5728layout\u4e2d\u8bbe\u7f6e\u6587\u5b57\uff0c\u4f7f\u7528<code>text</code>\u5c5e\u6027\u3002 <pre><code>    &lt;TextView\n        android:id=\"@+id/tv1\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"2020\u5e74\u7684Android\u65b0\u624b\u6559\u7a0b\u3002\u7a81\u51fa\u4e00\u4e2a\u7b80\u5355\u660e\u4e86\uff0c\u4e0a\u624b\u5feb\u3002 - RustFisher\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/sample_tv\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"@string/app_name\" /&gt;\n</code></pre> \u8fd9\u91cc\u6d89\u53ca\u5230\u4e00\u4e2a\u4ee3\u7801\u98ce\u683c\u7684\u95ee\u9898\u3002\u4e0a\u9762\u5206\u522b\u7ed9TextView\u8bbe\u7f6e\u4e86<code>id</code>\u3002\u6709\u7684\u4eba\u559c\u6b22\u9a7c\u5cf0\u98ce\u683c\u7684\uff0c\u4f8b\u5982<code>sampleTv</code>\u3002\u7b14\u8005\u4e2a\u4eba\u559c\u6b22\u5728layout\u4e2d\u4f7f\u7528\u5c0f\u5199\u5b57\u6bcd\u52a0\u4e0b\u5212\u7ebf\u7684\u98ce\u683c\u3002\u4eca\u540e\u4e00\u822c\u90fd\u662f\u8fd9\u6837\u7684\u98ce\u683c\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u8bbe\u7f6etext\u6709\u591a\u79cd\u65b9\u5f0f\u3002\u53ef\u4ee5\u76f4\u63a5\u628a\u5185\u5bb9\u5199\u8fdb\u53bb\uff08hard code\uff09\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528string\u8d44\u6e90\u3002 \u76f4\u63a5\u5199\u5185\u5bb9\uff0cas\u4f1a\u7ed9\u4e00\u4e2a\u9ec4\u8272\u7684\u8b66\u544a\uff0c\u5efa\u8bae\u7528\u6237\u6362\u7528<code>@string</code>\u8d44\u6e90\u7684\u65b9\u5f0f\u3002\u9f20\u6807\u79fb\u4e0a\u53bbas\u5c31\u53ef\u4ee5\u770b\u5230as\u7684\u8b66\u544a\u4e86\u3002</p> <p>\u82e5\u8981\u4f7f\u7528<code>@string</code>\u8d44\u6e90\uff0c\u6211\u4eec\u5148\u770b\u53e6\u4e00\u4e2axml\u6587\u4ef6\uff0c\u5373<code>strings.xml</code>\u3002\u5b83\u5728res/values\u91cc\u9762\u3002</p> <pre><code>&lt;string name=\"app_name\"&gt;Tutorial2020&lt;/string&gt;\n</code></pre> <p>\u8d44\u6e90\u547d\u540d\u98ce\u683c\u4e5f\u662f\u5c0f\u5199\u5b57\u6bcd\u52a0\u4e0b\u5212\u7ebf\u3002</p> <p>res\u91cc\u9762\u7684\u5f88\u591a\u8d44\u6e90\uff0c\u6211\u4eec\u53ef\u4ee5\u90fd\u53ef\u4ee5\u7528<code>R...</code>\u6765\u627e\u5230\u3002</p> <p>\u524d\u9762\u6211\u4eec\u63d0\u5230\uff0c\u53ef\u4ee5\u4f7f\u7528TextView\u7684setText\u65b9\u6cd5\u6765\u8bbe\u7f6e\u6587\u5b57\u5185\u5bb9\uff0c\u4f8b\u5982<code>setText(\"123\")</code>\u3002 \u4e5f\u53ef\u4ee5\u4f20\u5165\u6587\u5b57\u8d44\u6e90\u7684\u540d\u79f0\uff08\u7f16\u53f7\uff09\uff0c\u7c7b\u4f3c<code>setText(R.string.app_name)</code>\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c<code>R.string.app_name</code>\u672c\u8eab\u662f\u4e00\u4e2aint\u6570\u5b57\uff0cTextView\u4f1a\u6839\u636e\u8fd9\u4e2a\u7f16\u53f7\u53bb\u627e\u5bf9\u5e94\u7684\u8d44\u6e90\u3002 \u5982\u679c\u8fd9\u6837\u8c03\u7528<code>setText(123)</code>\uff0c\u5927\u6982\u7387\u4f1a\u62a5\u4e0b\u9762\u7684\u8fd9\u4e2a\u9519\u8bef\u3002 <pre><code>android.content.res.Resources$NotFoundException: String resource ID #0x0\n    at android.content.res.Resources.getText(Resources.java:360)\n</code></pre></p>"},{"location":"android/ui/view/textView/intro/#_3","title":"\u6587\u5b57\u8bbe\u7f6e","text":"<p>\u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u4f1a\u8bbe\u7f6eTextView\u6587\u5b57\u7684\u989c\u8272\uff0c\u80cc\u666f\u7b49\u7b49\u3002</p> <ul> <li>textColor \u8bbe\u7f6e\u5b57\u4f53\u989c\u8272</li> <li>textSize \u8bbe\u7f6e\u5b57\u4f53\u5927\u5c0f</li> <li>textStyle \u8bbe\u7f6e\u5b57\u4f53\u6837\u5f0f</li> </ul> <p>\u4ee5\u4e0b\u662f\u793a\u4f8b\uff1a</p> <p></p> <p></p> <p>\u770b\u5230\u989c\u8272\u8bbe\u7f6e\u90a3\u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u9f20\u6807\u70b9\u51fb\u4e00\u4e0b\u90a3\u4e2a\u5c0f\u8272\u5757\uff0cas\u4f1a\u5f39\u51fa\u4e00\u4e2a\u989c\u8272\u9009\u62e9\u5668\u3002\u8fd9\u4e2a\u9009\u62e9\u5668\u8fd8\u662f\u5f88\u65b9\u4fbf\u7684\u3002</p> <p></p>"},{"location":"android/ui/view/textView/intro/#_4","title":"\u95f4\u8ddd\u8bbe\u7f6e","text":"<p>margin\u548cpadding\u5176\u5b9e\u662fView\u7684\u5c5e\u6027\u3002\u8fd9\u91cc\u6211\u4eec\u62ffTextView\u6765\u770b\u4e00\u4e0b\u3002</p> <p></p> <p>\u4ee5\u540e\u60f3\u663e\u793a\u4e00\u4e9b\u6587\u5b57\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9996\u5148\u4f1a\u60f3\u8d77\u7684\u662fTextView\u3002</p> <p>\u5de5\u7a0b\u653e\u8fd9\u91cc\uff1a https://gitee.com/rustfisher/AndroidTutorial</p>"},{"location":"android/ui/view/textView/show_html/","title":"TextView \u663e\u793ahtml","text":"<p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u6bb5html\u6587\u672c\uff0c\u8981\u663e\u793a\u50cf\u6d4f\u89c8\u5668\u4e00\u6837\u7684\u6548\u679c\u3002 \u5bf9\u4e8e\u7b80\u5355\u7684html\u6587\u672c\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528TextView\u6765\u663e\u793a\u3002</p>"},{"location":"android/ui/view/textView/show_html/#_1","title":"\u4f7f\u7528","text":"<p>\u4e0a\u624b\u5f88\u7b80\u5355\uff0c\u4f7f\u7528<code>Html.fromHtml()</code>\u628ahtml\u6587\u672c\u8f6c\u6362\u518d\u4ea4\u7ed9<code>setText</code>\u3002</p> <p>html\u6587\u672c\u5982\u4e0b\uff0c\u8fd9\u91cc\u6307\u5b9a\u201ccolor\u201d\u6587\u5b57\u4e3a\u7ea2\u8272\u3002 <pre><code>&lt;p&gt;Tell me the &lt;font color=\"red\"&gt;color&lt;/font&gt;&lt;/p&gt;\n</code></pre></p> <p>\u6d4f\u89c8\u5668\u663e\u793a\u6548\u679c\uff1a</p> <p>Tell me the color</p> <p>Java\u4e2d\u9700\u8981\u5bf9\u53cc\u5f15\u53f7\u8f6c\u4e49\u4e00\u4e0b\u3002 <pre><code>private static final String T1 = \"&lt;p&gt;Tell me the &lt;font color=\\\"red\\\"&gt;color&lt;/font&gt;&lt;/p&gt;\";\n\ntv1.setText(Html.fromHtml(T1));\n</code></pre></p> <p>\u624b\u673a\u4e0a\u663e\u793a\u6548\u679c\u3002</p> <p></p>"},{"location":"android/ui/view/textView/show_html/#_2","title":"\u9ed8\u8ba4\u652f\u6301\u7684\u6807\u7b7e","text":"<p><code>Html.fromHtml()</code>\u652f\u6301\u4e00\u4e9b\u6807\u7b7e\uff0c\u4f8b\u5982<code>&lt;font&gt;</code> <code>&lt;p&gt;</code> \u7b49\u7b49\u3002 \u4f46\u662f\u4e0d\u652f\u6301<code>style</code>\u3002 \u4f8b\u5982\u4e0b\u9762\u8fd9\u6bb5html\u6587\u672c\uff0c\u6807\u7b7e\u4e2d\u5e26\u6709style\uff08\u5185\u8054\u6837\u5f0f\uff09\u3002 <pre><code>&lt;p&gt;Tell me the &lt;text style=\"color: blue; font-weight: bold;\"&gt;color&lt;/text&gt;.&lt;/p&gt;\n</code></pre> \u6d4f\u89c8\u5668\u663e\u793a\u6548\u679c\uff1a</p> <p>Tell me the color.</p> <p>Java\u4ee3\u7801\u3002 <pre><code>private static final String H1 = \"&lt;p&gt;Tell me the &lt;text style=\\\"color: blue; font-weight: bold;\\\"&gt;color&lt;/text&gt;.&lt;/p&gt;\";\n\ntv2.setText(Html.fromHtml(H1));\n</code></pre></p> <p>\u624b\u673a\u663e\u793a\u6548\u679c\u5982\u4e0b</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230html\u4e2dstyle\u6307\u5b9a\u7684\u5b57\u4f53\u989c\u8272\u548c\u52a0\u7c97\u5e76\u6ca1\u6709\u663e\u793a\u51fa\u6765\u3002</p> <p>\u8981\u60f3\u8ba9\u5b83\u6b63\u5e38\u663e\u793a\uff0c\u9700\u8981\u6539\u4e3a <pre><code>&lt;p&gt;Tell me the &lt;b&gt;&lt;font color=\"blue\"&gt;color&lt;/font&gt;&lt;/b&gt;.&lt;/p&gt;\n</code></pre> \u6d4f\u89c8\u5668\u6548\u679c\u5982\u4e0b</p> <p>Tell me the color.</p> <p>Java\u4ee3\u7801 <pre><code>private static final String H1_FIX = \"&lt;p&gt;Tell me the &lt;b&gt;&lt;font color=\\\"blue\\\"&gt;color&lt;/font&gt;&lt;/b&gt;.&lt;/p&gt;\";\ntv3.setText(Html.fromHtml(H1_FIX));\n</code></pre></p> <p>\u53ef\u4ee5\u770b\u51fa\uff0c\u652f\u6301<code>&lt;p&gt;</code> <code>&lt;b&gt;</code> <code>&lt;font&gt;</code>\u6807\u7b7e\u3002\u636e\u4e0d\u5b8c\u5168\u7edf\u8ba1\uff0c\u652f\u6301\u7684\u6807\u7b7e\u5982\u4e0b\u3002 <pre><code>p\nul\nli\ndiv\nspan\nstrong\nb\nem\ncite\ndfn\ni\nbig\nsmall\nfont\nblockquote\ntt\na\nu\ndel\ns\nstrike\nsup\nsub\nh1\nh2\nh3\nh4\nh5\nh6\nimg\nbr\n</code></pre></p> <p>\u76ee\u524d\u5f88\u591ahtml\u4e2d\u90fd\u4f7f\u7528\u4e86\u5185\u8054\u6837\u5f0f\uff0c\u800c\u4e14\u524d\u7aef\u5f00\u53d1\u4e2d\u4e0d\u8d5e\u6210\u4f7f\u7528<code>&lt;font&gt;</code>\u6807\u7b7e\u3002 \u4f46<code>Html.fromHtml</code>\u4e2d\u7684\u9ed8\u8ba4\u8f6c\u6362\u5668\u5e76\u4e0d\u652f\u6301\u5185\u8054\u6837\u5f0f\u3002\u8fd9\u6837\u524d\u7aef\u5199\u7684html\u6587\u672c\uff0c\u653e\u5728Android TextView\u4e0a\u5c31\u5931\u53bb\u4e86\u5f88\u591a\u663e\u793a\u6548\u679c\u3002 \u53ef\u4ee5\u8003\u8651\u4f7f\u7528WebView\u52a0\u8f7dHtml\u6587\u672c\u3002</p>"},{"location":"android/ui/view/textView/special_char/","title":"\u7279\u6b8a\u5b57\u7b26","text":"<p>\u6709\u4e00\u4e9b\u7279\u6b8a\u5b57\u7b26\u5728\u663e\u793a\u7684\u65f6\u5019\u4f1a\u51fa\u95ee\u9898\u3002 \u4f8b\u5982<code>\\u2019</code>\u3002</p> <p>\u663e\u793a\u7684\u4ee3\u7801\u5982\u4e0b <pre><code>    String S1 = \"\u8fd9\u662f\u5b57\\u2029\u7b26\";\n\n    binding.tv1.setText(S1);\n    Log.d(TAG, \"onCreate: S1: \" + S1);\n</code></pre></p> <p>\u624b\u673a\u663e\u793a\u6548\u679c </p> <p>log\u4e2d\u663e\u793a\u7684\u662f <code>\u8fd9\u662f\u5b57\u7b26</code>\u3002\u5e76\u4e0d\u4f1a\u663e\u793a\u51fa\u4e71\u7801\uff0c\u4e5f\u6ca1\u6709\u663e\u793a\u51fa<code>\\u2019</code>\u3002 \u5f00\u53d1\u4e2d\u9700\u8981\u6ce8\u610f\u8fd9\u7c7b\u5b57\u7b26\u3002</p>"},{"location":"android/ui/view/textView/textView_clickableSpan_crash_in_recyclerview/","title":"TextView\u4f7f\u7528ClickableSpan\u5d29\u6e83\u95ee\u9898","text":"<p>\u62a5\u9519\u4fe1\u606f <pre><code>android.view.InflateException: Binary XML file line #14: Error inflating class TextView\n    at android.view.LayoutInflater.createViewFromTag(LayoutInflater.java:767)\n    at android.view.LayoutInflater.rInflate(LayoutInflater.java:810)\n    at android.view.LayoutInflater.inflate(LayoutInflater.java:508)\n    at android.view.LayoutInflater.inflate(LayoutInflater.java:418)\n</code></pre></p> <p>bugly\u5c06\u5b83\u5f52\u7c7b\u4e3a <code>java.lang.ArrayIndexOutOfBoundsException</code>\u3002</p> <p>item\u7684layout\u6ca1\u6709\u8bbe\u7f6e<code>ellipsize</code>\u548c<code>maxLine</code>\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:layout_marginStart=\"12dp\"\n    android:layout_marginTop=\"2dp\"\n    android:layout_marginEnd=\"12dp\"\n    android:layout_marginBottom=\"4dp\"\n    android:background=\"@color/compPageBgColor\"\n    android:gravity=\"center_vertical\"\n    android:orientation=\"vertical\"&gt;\n\n    &lt;TextView\n        android:id=\"@+id/en_tv\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:gravity=\"start\"\n        android:textSize=\"16sp\" /&gt;\n\n    &lt;TextView\n        android:id=\"@+id/cn_tv\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:gravity=\"start\"\n        android:textSize=\"13sp\" /&gt;\n\n&lt;/LinearLayout&gt;\n</code></pre></p> <p>\u5728RecyclreView\u521b\u5efaViewHodler\u7684\u65f6\u5019\u5c31\u4f1a\u5d29\u6e83\u3002<code>onBindViewHolder</code>\u4e2d\uff0c<code>textview</code>\u4f7f\u7528\u4e86ClickableSpan\u3002 ClickableSpan\u590d\u5199\u4e86<code>updateDrawState</code>\u65b9\u6cd5\u3002 <pre><code>int color = Color.RED;\n\n    public CVH onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\n        return new CVH(LayoutInflater.from(parent.getContext()).inflate(R.layout.my_item, parent, false));\n    }\n\n    @Override\n    public void onBindViewHolder(@NonNull CVH holder, int position) {\n        SpannableStringBuilder ssb = new SpannableStringBuilder(\"abcdefg\");\n        // ...\n        ssb.setSpan(new ClickableSpan() {\n                    @Override\n                    public void onClick(@NonNull View widget) {\n                        if (onItemClickListener != null) {\n                            onItemClickListener.onClick(info);\n                        }\n                    }\n                    @Override\n                    public void updateDrawState(TextPaint ds) {\n                        if (ds != null) {\n                            ds.setColor(color);\n                            ds.setUnderlineText(true);\n                        }\n                    }\n                }, start, end, Spanned.SPAN_EXCLUSIVE_INCLUSIVE);\n        holder.contentEnTv.setMovementMethod(LinkMovementMethod.getInstance());\n        holder.contentEnTv.setText(ssb);\n    }\n</code></pre></p> <p>\u5c06TextView\u6362\u6210androidx.appcompat.widget.AppCompatTextView\uff0c\u4e00\u6837\u4f1a\u5d29\u6e83</p> <p>\u95ee\u9898\u4f1a\u51fa\u73b0\u5728</p> <ul> <li>\u5c0f\u7c734c\uff08Android5.1.1, API 22\uff09</li> <li>OPPO\uff08Android 6.0.1, API 23\uff09</li> <li>\u5b89\u5353\u5e73\u677f\uff08Android 7\uff09</li> </ul> <p>\u6ca1\u6709\u8fd9\u4e2a\u5d29\u6e83\u7684\u673a\u578b\uff0c\u7ea2\u7c736A\uff08Android8.1\uff09\uff0c1+5\uff08Android 10\uff09\u3002</p> <p>\u76f8\u5173\u95ee\u9898\uff1a https://stackoverflow.com/questions/46947850/textview-with-ellipsize-middle-casues-arrayindexoutofboundsexception-exception</p> <p>Android\u7cfb\u7edf(7\u53ca\u4ee5\u4e0b)\u7684\u4e00\u4e2abug https://issuetracker.google.com/issues/36950033</p>"},{"location":"android/ui/view/textView/textView_clickableSpan_crash_in_recyclerview/#_1","title":"\u7ed5\u8fc7\u8fd9\u4e2a\u95ee\u9898","text":"<p>Android7\u4ee5\u4e0a\u7684\u7cfb\u7edf\u4e0d\u4f1a\u51fa\u73b0\u6b64bug\uff0c\u6211\u4eec\u5c1d\u8bd5\u7ed5\u8fc7\u8fd9\u4e2a\u95ee\u9898\u3002 textView\u8bbe\u7f6espan\u7684\u4ee3\u7801\u9700\u8981\u4fee\u6539\u3002</p> <p>\u65b0\u589e\u4e00\u4e2a\u62bd\u8c61\u7c7b<code>ColorClickSpan</code>\u3002\u91cc\u9762\u6709\u4e00\u4e2a\u989c\u8272\u503c\u3002 <pre><code>    public abstract class ColorClickSpan extends ClickableSpan {\n        private int color;\n\n        public ColorClickSpan(int color) {\n            this.color = color;\n        }\n\n        @Override\n        public void updateDrawState(TextPaint ds) {\n            if (ds != null) {\n                ds.setColor(color);\n                ds.setUnderlineText(true);\n            }\n        }\n    }\n</code></pre></p> <p>\u4fee\u6539<code>onBindViewHolder</code>\u91cc\u7684\u4f7f\u7528\u65b9\u5f0f\u3002 <pre><code>    ssb.setSpan(new ColorClickSpan(color) {\n        @Override\n        public void onClick(View widget) {\n            // ...\n        }\n    }, start, end, Spanned.SPAN_EXCLUSIVE_INCLUSIVE);\n</code></pre></p> <p>\u8fd9\u6837\u6539\uff0c\u5c0f\u7c734c(5.1.1)\u548c\u5e73\u677f(7)\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u4e86\u3002</p> <p>\u5c0f\u7ed3\u4e00\u4e0b\uff0c\u6700\u5f00\u59cb\u662f\u4e3a\u4e86\u89e3\u51b3ForegroundColorSpan\u5931\u6548\u7684\u95ee\u9898\u3002\u60f3\u7528ClickableSpan\u540c\u65f6\u5b9e\u73b0\u70b9\u51fb\u548c\u663e\u793a\u989c\u8272\u7684\u529f\u80fd\u3002 \u5374\u89e6\u53d1\u4e86\u4f4e\u7248\u672c\u5b89\u5353\u7cfb\u7edfTextView\u7684bug\u3002\u8c03\u6574\u4e86\u5b9e\u73b0\u65b9\u5f0f\u540e\uff0c\u7ed5\u5f00\u4e86\u8fd9\u4e2a\u4f4e\u7248\u672c\u5b89\u5353\u7cfb\u7edf\u5d29\u6e83\u95ee\u9898\u3002</p>"},{"location":"android/ui/view/textView/text_style/","title":"textStyle","text":"<p>\u672c\u6587\u8bb2\u8ff0<code>textStyle</code>\uff0c\u5e76\u4e0d\u662f<code>styles.xml</code>\u3002</p> <p>\u5728xml\u4e2d\u8bbe\u7f6e<code>android:textStyle</code>\uff0c\u9009\u62e9\u60f3\u8981\u7684\u6548\u679c\u3002</p> <p>\u67093\u4e2a\u9009\u9879</p> <ul> <li>normal \u6ca1\u6709\u7279\u6b8a\u6548\u679c\uff0c\u9ed8\u8ba4\u503c</li> <li>italic \u659c\u4f53</li> <li>bold \u7c97\u4f53</li> </ul>"},{"location":"android/ui/view/textView/text_style/#xml","title":"xml\u4e2d\u8bbe\u7f6e","text":"<p>\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e2a\u7279\u6027\uff0c\u4f8b\u5982\u659c\u4f53 <pre><code>    &lt;TextView\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"Fisher\"\n        android:textColor=\"#000000\"\n        android:textStyle=\"italic\" /&gt;\n</code></pre> </p> <p>\u4e5f\u53ef\u4ee5\u540c\u65f6\u8bbe\u7f6e2\u4e2a\u7279\u6027\uff0c\u6bd4\u5982\u659c\u4f53\u5e76\u4e14\u52a0\u7c97 <pre><code>    &lt;TextView\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"bold|italic\"\n        android:textColor=\"#000000\"\n        android:textStyle=\"bold|italic\" /&gt;\n</code></pre></p> <p></p>"},{"location":"android/ui/view/textView/text_style/#_1","title":"\u4ee3\u7801\u4e2d\u8bbe\u7f6e","text":"<p>\u4f7f\u7528TextView\u7684<code>setTypeface</code>\u65b9\u6cd5\u6765\u8bbe\u7f6e\u5b57\u4f53\u6548\u679c\u3002 <pre><code>tv1.setTypeface(null, Typeface.NORMAL); // \u666e\u901a\n\ntv1.setTypeface(null, Typeface.BOLD); // \u52a0\u7c97\n\ntv2.setTypeface(null, Typeface.ITALIC); // \u659c\u4f53\n\ntv3.setTypeface(null, Typeface.BOLD_ITALIC); // \u52a0\u7c97\u548c\u659c\u4f53\n</code></pre></p> <p><code>setTypeface(@Nullable Typeface tf, @Typeface.Style int style)</code>\u67092\u4e2a\u53c2\u6570\u3002 \u7b2c\u4e00\u4e2a\u662f\u5b57\u4f53\uff0c\u8fd9\u91cc\u53ef\u4ee5\u5ffd\u7565\u3002 \u7b2c\u4e8c\u4e2a\u662f\u6548\u679c\uff0c\u6709\u6b63\u5e38\uff0c\u52a0\u7c97\uff0c\u659c\u4f53\uff0c\u52a0\u7c97\u548c\u659c\u4f53\u8fd9\u51e0\u79cd\u53ef\u9009\u3002</p>"},{"location":"android/ui/view/textView/text_style/#_2","title":"\u659c\u4f53\u6587\u5b57\u53f3\u8fb9\u88ab\u5207\u6389\u7684\u95ee\u9898","text":"<p>TextView\u8bbe\u7f6e\u4e86\u659c\u4f53\u540e\uff0c\u663e\u793a\u6548\u679c\u50cf\u662f\u88ab\u5207\u6389\u4e86\u4e00\u5757\u3002</p> <p>\u53ef\u4ee5\u589e\u52a0\u4e00\u4e2a\u5360\u4f4d\u7b26<code>&amp;#x200A;</code>\u6765\u201c\u6491\u5f00\u201dTextView\u7684\u5bbd\u5ea6\u3002</p> <pre><code>&lt;string name=\"sample_text_1\"&gt;\u663e\u793a\u6548\u679c&amp;#x200A;&lt;/string&gt;\n&lt;string name=\"sample_text_2\"&gt;\u50cf\u662f&amp;#x200A;&lt;/string&gt;\n&lt;string name=\"sample_text_3\"&gt;\u88ab\u5207\u6389\u4e86\u4e00\u5757&amp;#x200A;&lt;/string&gt;\n</code></pre> <p>\u53c2\u8003</p> <p>https://stackoverflow.com/questions/4353836/italic-textview-with-wrap-contents-seems-to-clip-the-text-at-right-edge</p>"},{"location":"android/ui/view/textView/typeface/","title":"Android \u5b57\u4f53\uff08\u5b57\u5e93\uff09","text":""},{"location":"android/ui/view/textView/typeface/#_1","title":"\u7cfb\u7edf\u81ea\u5e26\u7684\u5b57\u4f53","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cTextView \u7684 typeface \u5c5e\u6027\u652f\u6301 sans\u3001serif\u548cmonospace \u8fd9\u4e09\u79cd\u5b57\u4f53\u3002 \u7cfb\u7edf\u9ed8\u8ba4 sans \u4f5c\u4e3a\u6587\u672c\u663e\u793a\u7684\u5b57\u4f53\u3002\u4f46\u8fd9\u4e09\u79cd\u5b57\u4f53\u53ea\u652f\u6301\u82f1\u6587\u3002\u5982\u679c\u663e\u793a\u4e2d\u6587\uff0c\u65e0\u8bba\u9009\u62e9\u8fd9\u4e09\u79cd\u5b57\u4f53\u4e2d\u7684\u54ea\u4e00\u79cd\uff0c\u663e\u793a\u6548\u679c\u90fd\u662f\u4e00\u6837\u7684\u3002</p>"},{"location":"android/ui/view/textView/typeface/#layout","title":"layout\u4e2d\u8bbe\u7f6e\u5b57\u4f53","text":"<p>\u4f7f\u7528<code>android:typeface</code>\u6765\u8bbe\u7f6e\u5b57\u4f53\u3002 <pre><code>&lt;!-- sans\u5b57\u4f53 --&gt;\n&lt;TextView\n    android:text=\"Hello,World\"\n    android:typeface=\"sans\" /&gt;\n\n&lt;!-- serifs\u5b57\u4f53 --&gt;\n&lt;TextView\n    android:text=\"Hello,World\"\n    android:typeface=\"serif\" /&gt;\n\n&lt;!-- monospace\u5b57\u4f53 --&gt;\n&lt;TextView\n    android:text=\"Hello,World\"\n    android:typeface=\"monospace\" /&gt;\n</code></pre></p>"},{"location":"android/ui/view/textView/typeface/#_2","title":"\u4ee3\u7801\u4e2d\u4f7f\u7528\u5b57\u4f53","text":"<p>\u4f7f\u7528\u7cfb\u7edf\u81ea\u5e26\u7684\u5b57\u4f53 <pre><code> tv.setTypeface(Typeface.SERIF);\n tv.setTypeface(Typeface.SANS_SERIF);\n tv.setTypeface(Typeface.MONOSPACE);\n</code></pre></p>"},{"location":"android/ui/view/textView/typeface/#_3","title":"\u5f15\u5165\u5b57\u4f53\u5e93","text":"<p>\u9700\u8981\u5f15\u5165ttf\u5b57\u4f53\u6587\u4ef6\u3002\u628a\u5b57\u4f53\u6587\u4ef6\u653e\u5728<code>assets/font</code>\u76ee\u5f55\u91cc\u3002 \u4ee3\u7801\u4e2d\u4f7f\u7528AssetManager\u6765\u83b7\u53d6\u5b57\u4f53\u3002</p> <p>\u4f8b\u5982\u5728Activity\u4e2d\u8bbe\u7f6e\u5b57\u4f53\u3002 <pre><code>TextView tv1 = findViewById(R.id.tv1);\nTypeface tf = Typeface.createFromAsset(getAssets(), \"fonts/otherFont.ttf\");\ntv1.setTypeface(tf); // \u4f7f\u7528\u5b57\u4f53\n</code></pre></p>"},{"location":"android/ui/view/webView/call-java-function/","title":"js\u8c03\u7528Java\u65b9\u6cd5","text":"<p>js\u6216\u662fts\u8c03\u7528Java\u65b9\u6cd5\u3002</p>"},{"location":"android/ui/view/webView/call-java-function/#java","title":"Java\u7aef","text":"<p>\u9996\u5148js\u548cJava\u4e4b\u95f4\u7ea6\u5b9a\u4e00\u4e2a\u63a5\u53e3\u540d\uff0c\u8fd9\u91cc\u53eb\u505a<code>androidInterface</code>\u3002</p> <p>Java\u7aef\u8981\u7ed9WebView\u6dfb\u52a0js\u63a5\u53e3\u3002\u5373\u8c03\u7528<code>addJavascriptInterface</code>\u65b9\u6cd5\u3002</p> <p>\u5728WebView\u52a0\u8f7d\u672c\u5730\u5b58\u50a8\u7684\u7f51\u9875\u57fa\u7840\u4e0a\uff0c\u6211\u4eec\u5bf9WebView\u8fdb\u884c\u8bbe\u7f6e\u3002</p> <pre><code>WebView webView = findViewById(R.id.web2);\nwebView.addJavascriptInterface(this, \"androidInterface\"); // \u6dfb\u52a0\u63a5\u53e3\nWebSettings webSettings = webView.getSettings();\nwebSettings.setJavaScriptEnabled(true);\nwebSettings.setAllowFileAccess(true);\nwebSettings.setAllowFileAccessFromFileURLs(true);\nwebSettings.setAllowContentAccess(true);\nwebSettings.setDomStorageEnabled(true);\nwebView.loadUrl(url);\n</code></pre> <p>\u4e0a\u9762\u7684<code>this</code>\u662factivity\uff0c\u5728\u8fd9\u4e2aactivity\u4e2d\u6211\u4eec\u65b0\u589e2\u4e2aJava\u65b9\u6cd5\u3002 <pre><code>import android.webkit.JavascriptInterface;\n\n@JavascriptInterface\npublic String getStringInfo() {\n    return Build.BRAND;\n}\n\n@JavascriptInterface\npublic String getOneJson() {\n    return new Gson().toJson(new User((int) System.currentTimeMillis(), true, \"default rule\", 3));\n}\n</code></pre> \u65b9\u6cd5\u90fd\u6dfb\u52a0\u4e86<code>@JavascriptInterface</code>\u6ce8\u89e3\u3002\u5e76\u4e14\u8fd4\u56de\u7684\u90fd\u662f\u5b57\u7b26\u4e32\u3002</p> <p>\u5982\u679c\u8981\u4f20\u9001\u5bf9\u8c61\uff0c\u53ef\u4ee5\u8f6c\u6362\u4e3ajson\u5b57\u7b26\u4e32\u6765\u4f20\u9001\u3002</p> <p>\u8fd9\u6837Java\u65b9\u9762\u5c31\u51c6\u5907\u5b8c\u6bd5\u4e86\u3002</p>"},{"location":"android/ui/view/webView/call-java-function/#_1","title":"\u7f51\u9875\u7aef","text":"<p>\u524d\u7aef\u8c03\u7528Java\u65b9\u6cd5\u9700\u8981\u501f\u52a9<code>window</code>\u3002ts\u6216\u8005js\u90fd\u7528\u5230<code>window</code>\u3002</p> <p>\u4e0a\u9762\u6211\u4eec\u7ea6\u5b9a\u4e86\u4f7f\u7528<code>androidInterface</code>\u4e3a\u63a5\u53e3\u540d\u3002\u8c03\u7528\u65b9\u6cd5\u5982<code>window.androidInterface</code>\u3002</p> <p>\u4f8b\u5982typescript\u8c03\u7528Java\u65b9\u6cd5\u3002 <pre><code>callNative(): string {\n    let result = window.androidInterface.getStringInfo();\n    return result;\n}\n\ngetOneObject(): User {\n    let json = window.androidInterface.getOneJson();\n    let user: User = JSON.parse(json);\n    return user;\n}\n</code></pre></p> <p>js\u7684\u4e5f\u7c7b\u4f3c\uff0c\u4f7f\u7528<code>window.androidInterface</code>\u3002</p>"},{"location":"android/ui/view/webView/load-assets-files/","title":"WebView\u52a0\u8f7dassets\u4e2d\u7684\u7f51\u9875","text":"<p>\u6211\u4eec\u628a\u7f51\u9875\u6587\u4ef6\u653e\u5230<code>assets</code>\u76ee\u5f55\u4e2d\u3002</p> <p>\u8bbe\u7f6e<code>WebSettings</code>\uff0c\u5141\u8bb8\u8bfb\u53d6\u6587\u4ef6\u7b49\u7b49\u3002</p> <p><code>assets</code>\u76ee\u5f55\u7684\u8def\u5f84\u4ee5<code>file:///android_asset/</code>\u5f00\u5934\u3002</p> <pre><code>WebView webView = findViewById(R.id.web2);\n\nString url = \"file:///android_asset/drag-to/index.html\";\nWebSettings webSettings = webView.getSettings();\nwebSettings.setJavaScriptEnabled(true);\nwebSettings.setAllowFileAccess(true);\nwebSettings.setAllowFileAccessFromFileURLs(true);\nwebSettings.setAllowContentAccess(true);\nwebSettings.setDomStorageEnabled(true);\nwebView.loadUrl(url);\n</code></pre> <p>\u4f8b\u5982\u653e\u4e00\u4e2aCocos Creator\u6253\u5305\u7684web\u9879\u76ee\u3002</p> <p>\u624b\u673a\u8fd0\u884c\u6548\u679c\u5982\u56fe</p> <p></p>"},{"location":"android/ui/view/webView/load-local-html/","title":"WebView\u52a0\u8f7d\u672c\u5730\u5b58\u50a8\u7684\u7f51\u9875","text":"<p>\u672c\u5730\u5b58\u50a8\uff0c\u5305\u62ecapp\u5185\u90e8\u7684\u5b58\u50a8\uff0c\u624b\u673a\u516c\u5171\u7684\u5b58\u50a8\u4f4d\u7f6e\u3002</p> <p>\u4e3a\u4e86\u6f14\u793a\u65b9\u4fbf\uff0c\u6211\u4eec\u628aassets\u91cc\u7684html\u6587\u4ef6\u590d\u5236\u5230app\u5b58\u50a8\u6216SD\u5361\u4e0a\u3002 \u518d\u53bb\u663e\u793a\u8fd9\u4e2a\u7f51\u9875\u3002</p>"},{"location":"android/ui/view/webView/load-local-html/#app","title":"\u52a0\u8f7dapp\u5b58\u50a8\u4e2d\u7684\u7f51\u9875","text":"<p>\u6211\u4eec\u628a\u7f51\u9875\u6587\u4ef6\u653e\u5230app\u7684\u79c1\u6709\u76ee\u5f55\u4e2d\u3002</p> <p>\u8def\u5f84\u4e3a\uff1a<code>/data/user/0/com.rustfisher.tutorial2020/files/sample.html</code></p> <p>url\u8981\u4ee5<code>file://</code> \u5f00\u5934\uff1a <code>file:///data/user/0/com.rustfisher.tutorial2020/files/sample.html</code></p> <p>\u8bbe\u7f6e<code>WebSettings</code>\uff0c\u5141\u8bb8\u8bfb\u53d6\u6587\u4ef6\u7b49\u7b49\u3002</p> <pre><code>String url = \"\";\nFile htmlFile = new File(getFilesDir(), \"sample.html\");\nLog.d(TAG, htmlFile + \"\\nfile exits:  \" + htmlFile.exists());\nurl = \"file://\" + htmlFile.getAbsolutePath();\nLog.d(TAG, \"url: \" + url);\nWebSettings webSettings = webView.getSettings();\nwebSettings.setJavaScriptEnabled(true);\nwebSettings.setAllowFileAccess(true);\nwebSettings.setAllowFileAccessFromFileURLs(true);\nwebSettings.setAllowContentAccess(true);\nwebSettings.setDomStorageEnabled(true);\nwebView.loadUrl(url);\n</code></pre> <p>\u4e00\u5b9a\u4e0d\u80fd\u5fd8\u8bb0<code>file://</code> \u5f00\u5934</p>"},{"location":"android/ui/view/webView/load-local-html/#sd","title":"\u52a0\u8f7dsd\u5361\u4e2d\u7684\u7f51\u9875","text":"<p>\u4e0eapp\u5185\u90e8\u5b58\u50a8\u7c7b\u4f3c\uff0c\u53ea\u9700\u8981\u4fee\u6539\u8def\u5f84\u3002</p> <p>\u4f8b\u5982\u5728\u6a21\u62df\u5668\u4e0a\u7684url\u4e3a <code>file:///storage/emulated/0/sample.html</code></p> <p>\ud83e\uddd1\ud83c\udffb\u200d\ud83d\udcbb \u793a\u4f8b\u4ee3\u7801</p>"},{"location":"android/ui/view/webView/loadData/","title":"\u663e\u793ahtml\u6587\u672c","text":"<p>\u5148\u770b\u4e00\u6bb5\u4ee3\u7801\u793a\u4f8b\u3002\u793a\u4f8b\u4e2d\u7528\u5230\u7684html\u6587\u672c\u4e0eTextView\u663e\u793aHtml\u76f8\u540c\u3002 <pre><code>    private static final String T1 = \"&lt;p&gt;Tell me the &lt;font color=\\\"red\\\"&gt;color&lt;/font&gt;&lt;/p&gt;\";\n    private static final String H1 = \"&lt;p&gt;Tell me the &lt;text style=\\\"color: blue; font-weight: bold;\\\"&gt;color&lt;/text&gt;.&lt;/p&gt;\";\n    private static final String H1_FIX = \"&lt;p&gt;Tell me the &lt;b&gt;&lt;font color=\\\"blue\\\"&gt;color&lt;/font&gt;&lt;/b&gt;.&lt;/p&gt;\";\n\n    wb1.loadData(T1, \"text/html\", \"UTF-8\");\n    wb2.loadData(H1, \"text/html\", \"UTF-8\");\n    wb3.loadData(H1_FIX, \"text/html\", \"UTF-8\");\n</code></pre></p> <p>layout\u4e2d\u653e\u7f6eWebView <pre><code>    &lt;WebView\n        android:id=\"@+id/web3\"\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\" /&gt;\n</code></pre></p> <p>WebView\u663e\u793aHtml\u6587\u672c\u6548\u679c\u56fe</p> <p></p> <p>\u4e4b\u524dTextView\u663e\u793a\u4e0d\u51fa\u989c\u8272\u548c\u52a0\u7c97\u7684<code>H1</code>\uff0c\u5728webView\u4e2d\u53ef\u4ee5\u6b63\u5e38\u663e\u793a\u3002</p> <p>\u4e0a\u9762\u7684<code>loadData</code>\u65b9\u6cd5\u4e2d\u6307\u5b9a\u4e86mimeType\u4e3a<code>text/html</code>\uff0c\u7f16\u7801\u7c7b\u578b<code>UTF-8</code>\u3002</p>"},{"location":"android/ui/view/webView/loadData/#webview-loaddata","title":"WebView loadData \u4e2d\u6587\u4e71\u7801","text":"<p>\u4f7f\u7528<code>loadData</code>\u51fa\u73b0\u4e2d\u6587\u4e71\u7801\u3002 <pre><code>String htmlData = \"&lt;p&gt;This is me. \u6211\u662f\u6587\u672cText.&lt;/p&gt;\";\nwebView.loadData(htmlData, \"text/html\", \"UTF-8\"); // \u67d0\u4e9b\u673a\u578b\u51fa\u73b0\u4e2d\u6587\u4e71\u7801\n</code></pre></p> <p>\u4f7f\u7528<code>loadDataWithBaseURL</code>\u65b9\u6cd5\u89c4\u907f\u4e2d\u6587\u4e71\u7801\u95ee\u9898\u3002 <pre><code>webView.loadDataWithBaseURL(null, htmlData, \"text/html\", \"UTF-8\", null);\n</code></pre></p>"},{"location":"android/ui/view/webView/long-click-pop-menu-x5/","title":"x5 WebView\u81ea\u5b9a\u4e49\u957f\u6309\u83dc\u5355","text":"<p>\u60f3\u8981\u81ea\u5b9a\u4e49\u957f\u6309\u83dc\u5355\uff0c\u91cd\u5199<code>startActionMode</code>\u7684\u505a\u6cd5\u5728x5 WebView\u4e0a\u5e76\u4e0d\u8d77\u4f5c\u7528\u3002</p> <p>x5 WebView\u5e95\u5c42\u5e76\u6ca1\u6709\u8d70<code>startActionMode</code>\u65b9\u6cd5\u3002\u6211\u4eec\u9700\u8981\u6362\u4e2a\u601d\u8def\u3002 \u8fd9\u91cc\u7528menu\u6765\u81ea\u5b9a\u4e49\u83dc\u5355\u3002</p>"},{"location":"android/ui/view/webView/long-click-pop-menu-x5/#menu","title":"\u81ea\u5b9a\u4e49menu","text":"<p>\u5148\u65b0\u5efa\u4e00\u4e2amenu\u6587\u4ef6<code>web_view_x5_menu1.xml</code> <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;menu xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"&gt;\n    &lt;item\n        android:id=\"@+id/copy\"\n        android:title=\"Copy\"\n        app:showAsAction=\"always\" /&gt;\n    &lt;item\n        android:id=\"@+id/action1\"\n        android:title=\"action1\"\n        app:showAsAction=\"always\" /&gt;\n&lt;/menu&gt;\n</code></pre></p>"},{"location":"android/ui/view/webView/long-click-pop-menu-x5/#x5-webview_1","title":"\u64cd\u4f5cx5 WebView","text":"<p>\u65b0\u5efa\u4e00\u4e2a\u7c7b\u7ee7\u627fProxyWebViewClientExtension\uff0c\u5b9e\u73b0<code>onShowLongClickPopupMenu</code>\u65b9\u6cd5\u3002 \u957f\u6309\u5f39\u51fa\u83dc\u5355\u65f6\uff0c\u4f1a\u8d70\u8fd9\u4e2a\u65b9\u6cd5\u3002</p> <p>\u65b0\u5efaISelectionInterfaceX\u7c7b\u5b9e\u73b0ISelectionInterface\u63a5\u53e3\u3002 <code>updateHelperWidget</code>\u65b9\u6cd5\u91cc\u5bf9\u83dc\u5355\u8fdb\u884c\u64cd\u4f5c\u3002\u628a\u9ed8\u8ba4\u7684\u83dc\u5355\u6362\u6210\u6211\u4eec\u7684\u81ea\u5b9a\u4e49\u83dc\u5355\u3002 <pre><code>    private class ProxyWebViewClientExtensionX extends ProxyWebViewClientExtension {\n        private WebView webView;\n        private Handler handler = new Handler(Looper.getMainLooper());\n\n        public ProxyWebViewClientExtensionX(WebView webView) {\n            this.webView = webView;\n        }\n\n        @Override\n        public boolean onShowLongClickPopupMenu() {\n            handler.postDelayed(new Runnable() {\n                @Override\n                public void run() {\n                    webView.getX5WebViewExtension().enterSelectionMode(false);\n                }\n            }, 30);\n            return true;\n        }\n    }\n\n    private class ISelectionInterfaceX implements ISelectionInterface {\n        boolean isInActionMode = false;\n        ActionMode actionMode;\n        private WebView webView;\n        View actionView;\n        private Handler handler = new Handler(Looper.getMainLooper());\n\n        public ISelectionInterfaceX(WebView webView) {\n            this.webView = webView;\n        }\n\n        @Override\n        public void onSelectionChange(Rect rect, Rect rect1, int i, int i1, short i2) {\n            Log.d(TAG, \"onSelectionChange: \");\n        }\n\n        @Override\n        public void onSelectionBegin(Rect rect, Rect rect1, int i, int i1, short i2) {\n            Log.d(TAG, \"onSelectionBegin: \");\n        }\n\n        @Override\n        public void onSelectionBeginFailed(int i, int i1) {\n            Log.d(TAG, \"onSelectionBeginFailed: \");\n        }\n\n        @Override\n        public void onSelectionDone(Rect rect, boolean b) {\n            Log.d(TAG, \"onSelectionDone: \");\n        }\n\n        @Override\n        public void hideSelectionView() {\n            System.out.println();\n            if (actionView != null) {\n                webView.removeViewInLayout(actionView);\n                actionView = null;\n            }\n            if (actionMode != null) {\n                actionMode.finish();\n                actionMode = null;\n            }\n        }\n\n        @Override\n        public void onSelectCancel() {\n            Log.d(TAG, \"onSelectCancel: \");\n        }\n\n        @Override\n        public void updateHelperWidget(final Rect rect, final Rect rect1) {\n            System.out.println();\n            handler.postDelayed(new Runnable() {\n                @Override\n                public void run() {\n                    final ActionMode.Callback callback = new ActionMode.Callback() {\n                        @Override\n                        public boolean onCreateActionMode(ActionMode mode, Menu menu) {\n                            mode.getMenuInflater().inflate(R.menu.web_view_x5_menu1, menu);\n                            return true;\n                        }\n\n                        @Override\n                        public boolean onPrepareActionMode(ActionMode mode, Menu menu) {\n                            return false;\n                        }\n\n                        @Override\n                        public boolean onActionItemClicked(ActionMode mode,\n                                                           MenuItem item) {\n                            final IX5WebViewExtension webViewExtension = webView.getX5WebViewExtension();\n                            String selectionText = \"\";\n                            if (webViewExtension != null) {\n                                selectionText = webViewExtension.getSelectionText();\n                            }\n                            boolean leaveSelection = true;\n                            switch (item.getItemId()) {\n                                case R.id.copy:\n                                    Toast.makeText(WebViewX5ClickAct.this, selectionText, Toast.LENGTH_SHORT).show();\n                                    break;\n                                case R.id.action1:\n                                    Toast.makeText(WebViewX5ClickAct.this, \"(action1) \" + selectionText, Toast.LENGTH_SHORT).show();\n                                    break;\n                            }\n                            final boolean finalLeaveSelection = leaveSelection;\n                            handler.postDelayed(new Runnable() {\n                                @Override\n                                public void run() {\n                                    if (finalLeaveSelection &amp;&amp; webViewExtension != null) {\n                                        webViewExtension.leaveSelectionMode();\n                                    }\n                                }\n                            }, 30);\n                            return true;\n                        }\n\n                        @Override\n                        public void onDestroyActionMode(ActionMode mode) {\n                            isInActionMode = false;\n                        }\n                    };\n\n                    Context context = webView.getContext();\n\n                    // \u751f\u6210actionView\uff0c\u5e76\u901a\u8fc7\u5b83\u542f\u52a8ActionMode\uff0c\u89e3\u51b3\u5b9a\u4f4d\u95ee\u9898\n                    // actionView\u7684\u5927\u5c0f\u548c\u4f4d\u7f6e\uff0c\u5927\u81f4\u548cSelection\u76f8\u540c\uff0c\u76f4\u63a5\u5c06\u5176add\u5230WebView\u4e2d\n                    if (actionView != null) {\n                        webView.removeViewInLayout(actionView);\n                    }\n\n                    actionView = new View(context);\n                    actionView.setBackgroundColor(0x33FF00FF);// \u65b9\u4fbf\u8c03\u8bd5\n                    int width = rect1.right - rect.left;\n                    int height = rect1.bottom - rect.top;\n                    FrameLayout.LayoutParams lp = new FrameLayout.LayoutParams(width &lt;= 0 ? 10 : width, height &lt;= 0 ? 10 : height);\n                    lp.leftMargin = rect.left;\n                    lp.topMargin = rect.top;\n                    webView.addView(actionView, lp);\n\n                    // \u9700\u8981\u5ef6\u8fdfstartActionMode\uff0c\u7ed9\u5e03\u5c40actionView\u7684\u65f6\u95f4\n                    actionView.post(new Runnable() {\n                        @Override\n                        public void run() {\n                            if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) {\n                                actionMode = actionView.startActionMode(callback, ActionMode.TYPE_FLOATING);\n                            } else {\n                                actionMode = actionView.startActionMode(callback);\n                            }\n                        }\n                    });\n                }\n            }, 0);\n        }\n\n        @Override\n        public void setText(String s, boolean b) {\n            Log.d(TAG, \"setText: \");\n        }\n\n        @Override\n        public String getText() {\n            Log.d(TAG, \"getText: \");\n            return null;\n        }\n\n        @Override\n        public void onRetrieveFingerSearchContextResponse(String s, String s1, int i) {\n            Log.d(TAG, \"onRetrieveFingerSearchContextResponse: \");\n        }\n    }\n</code></pre></p> <p>\u5bf9webView\u8fdb\u884c\u8bbe\u7f6e <pre><code>mX5WebView2.getSettings().setJavaScriptEnabled(true);\nIX5WebViewExtension x5WebViewExtension = mX5WebView2.getX5WebViewExtension();\nif (x5WebViewExtension != null) {\n    x5WebViewExtension.enterSelectionMode(true);\n    x5WebViewExtension.setWebViewClientExtension(new ProxyWebViewClientExtensionX(mX5WebView2));\n    x5WebViewExtension.setSelectListener(new ISelectionInterfaceX(mX5WebView2));\n} else {\n    Log.e(TAG, \"x5\u8fd8\u6ca1\u6709\u51c6\u5907\u597d - x5WebViewExtension is null.\");\n}\nmX5WebView2.loadDataWithBaseURL(null, mH1, \"text/html\", \"UTF-8\", null);\n</code></pre></p>"},{"location":"android/ui/view/webView/long-click-pop-menu-x5/#x5","title":"x5\u5185\u6838\u52a0\u8f7d\u95ee\u9898","text":"<p>\u624b\u673a\u4e0a\u5e76\u4e0d\u4e00\u5b9a\u4f1a\u6709x5\u6d4f\u89c8\u5668\u5185\u6838\u3002 \u6ca1\u6709x5\u5185\u6838\uff0c\u4e0d\u8fdb\u884c\u8bbe\u7f6e\u3002\u957f\u6309\u83dc\u5355\u8fd8\u662f\u9ed8\u8ba4\u7684\u3002</p> <p>App\u5982\u4f55\u9996\u6b21\u52a0\u8f7dx5\u5185\u6838\uff1f App \u5728\u542f\u52a8\u540e\uff08\u4f8b\u5982\u5728 Application \u7684 onCreate \u4e2d\uff09\u7acb\u523b\u8c03\u7528 QbSdk \u7684\u9884\u52a0\u8f7d\u63a5\u53e3 initX5Environment \uff0c\u53ef\u53c2\u8003\u63a5\u5165\u793a\u4f8b\u6216API\u6587\u6863(https://x5.tencent.com/tbs/sdk.html). \u9700\u8981\u6ce8\u610f\u7684\u662f\uff1a \u5f53\u672c\u5730\u6ca1\u6709\u5bbf\u4e3bx5\u5185\u6838\u53ef\u7528\uff0c\u6b64\u65f6\u9700\u8981\u5728wifi\u6761\u4ef6\u4e0b\u4e0b\u8f7dx5\u5185\u6838(23M\u5de6\u53f3\uff0c\u8017\u65f690\u79d2\u5de6\u53f3)\uff0c\u5982\u679c\u5728\u6b64\u4e4b\u524d\u6253\u5f00webview\u53ef\u80fd\u5bfc\u81f4\u65e0\u5185\u6838\u53ef\u7528\u800c\u4f7f\u7528\u7cfb\u7edf\u5185\u6838\u7684\u60c5\u51b5</p>"},{"location":"android/ui/view/webView/long-click-pop-menu/","title":"\u81ea\u5b9a\u4e49\u957f\u6309\u6587\u5b57\u5f39\u51fa\u7684\u83dc\u5355","text":"<p>\u957f\u6309WebView\u4e2d\u7684\u6587\u5b57\uff0c\u4f1a\u6709\u9009\u62e9\u5149\u6807\uff0c\u5e76\u4e14\u5f39\u51fa\u4e00\u4e2a\u5c0f\u83dc\u5355\u3002 \u4e00\u822c\u83dc\u5355\u91cc\u4f1a\u6709\u300c\u590d\u5236\u300d\uff0c\u300c\u641c\u7d22\u300d\u7b49\u7b49\u9009\u9879\u3002</p> <p>\u8fd9\u4e2a\u83dc\u5355\u53ef\u4ee5\u7531\u5f00\u53d1\u8005\u81ea\u5b9a\u4e49\u3002\u8ba9\u5f39\u51fa\u7684\u83dc\u5355\u663e\u793a\u5176\u4ed6\u9009\u9879\u3002 \u6bd4\u5982\u5f39\u51fa\u300c\u590d\u5236\u300d\u300c\u7ffb\u8bd1\u300d\u3002</p> <p>\u4e00\u822c\u6b65\u9aa4\uff1a</p> <ul> <li>\u8bbe\u8ba1\u76d1\u542c\u5668</li> <li>\u81ea\u5b9a\u4e49WebView\uff0c\u590d\u5199\u65b9\u6cd5</li> <li>\u5b9a\u4e49Js\u63a5\u53e3</li> </ul> <p>\u9700\u8981\u65b0\u5efa2\u4e2aJava\u6587\u4ef6\uff0cWebChooseActionListener\uff0cCustomClickWebView</p>"},{"location":"android/ui/view/webView/long-click-pop-menu/#_2","title":"\u5b9a\u4e49\u76d1\u542c\u5668","text":"<p>\u76d1\u542c\u5668WebChooseActionListener\uff0c\u7528\u6765\u4f20\u8f93\u7528\u6237\u7684\u9009\u62e9\u3002</p> <pre><code>public interface WebChooseActionListener {\n\n    /**\n     * @param itemTitle \u9009\u9879\u7684\u6807\u9898\n     * @param txt       \u9009\u4e2d\u7684\u6587\u5b57\n     */\n    void onChosen(String itemTitle, String txt);\n}\n</code></pre> <p><code>txt</code>\u662f\u7528\u6237\u5728WebView\u4e0a\u9009\u4e2d\u7684\u6587\u5b57\u3002\u5982\u4f55\u83b7\u53d6\u5230\u9009\u4e2d\u7684\u6587\u5b57\u5462\uff1f \u672c\u4f8b\u4e2d\u7528js\u65b9\u6cd5\u6765\u83b7\u53d6\u3002</p>"},{"location":"android/ui/view/webView/long-click-pop-menu/#webview","title":"\u81ea\u5b9a\u4e49WebView","text":""},{"location":"android/ui/view/webView/long-click-pop-menu/#jsjava","title":"js\u548cJava\u7684\u4ea4\u4e92","text":"<p>\u5b9a\u4e49CustomJsInterface(\u672c\u4f8b\u4e2d\u628a\u5b83\u653e\u5728\u4e86CustomClickWebView\u91cc)\uff0c\u5176\u4e2d\u7ed9<code>chooseAction</code>\u6dfb\u52a0\u6ce8\u89e3<code>@JavascriptInterface</code>\uff0c\u5c06\u5176\u5b9a\u4e49\u4e3a\u6c9f\u901a\u7684\u6865\u6881\u3002 js\u4e2d\u4f1a\u8c03\u7528\u8fd9\u4e2a<code>chooseAction</code>\u65b9\u6cd5\u3002</p> <p>\u4e3a\u4e86\u83b7\u53d6\u7528\u6237\u5728WebView\u4e0a\u9009\u4e2d\u7684\u6587\u5b57\uff0c\u9700\u8981\u6267\u884cjs\u4ee3\u7801\uff0c\u53c2\u8003<code>exeSelectTextJs</code>\u65b9\u6cd5\u3002 js\u4ee3\u7801\u4e2d\u7684<code>RFJSInterface</code>\uff0c\u548cJava\u4e2d<code>addJavascriptInterface</code>\u4f20\u5165\u7684\u540d\u5b57\u5fc5\u987b\u4e00\u81f4\u3002 <pre><code>addJavascriptInterface(new CustomJsInterface(this), \"RFJSInterface\");\n</code></pre> js\u4ee3\u7801\u4e2d<code>\"RFJSInterface.chooseAction(txt,title);\"</code>\u5c31\u662f\u5728\u8c03\u7528Java\u4e2d\u5b9a\u4e49\u7684\u65b9\u6cd5\u3002</p>"},{"location":"android/ui/view/webView/long-click-pop-menu/#_3","title":"\u63a7\u5236\u83dc\u5355","text":"<p>\u60f3\u8981\u63a7\u5236WebView\u4e2d\u5f39\u51fa\u7684\u83dc\u5355\uff0c\u9700\u8981\u590d\u5199<code>startActionMode</code>\u65b9\u6cd5\uff0c\u628a\u9ed8\u8ba4\u7684\u83dc\u5355\u66ff\u6362\u6210\u81ea\u5b9a\u4e49\u7684\u83dc\u5355\u3002\u8c03\u7528<code>Menu.add()</code>\u65b9\u6cd5\u6dfb\u52a0\u9009\u9879\u3002</p> <p>\u81ea\u5b9a\u4e49\u7684\u83dc\u5355\u9009\u9879\uff0c\u4ece\u5916\u9762\u4f20\u8fdb\u6765\u3002</p> <pre><code>@Override\npublic ActionMode startActionMode(ActionMode.Callback callback) {\n    ActionMode actionMode = super.startActionMode(callback);\n    return resolveActionMode(actionMode);\n}\n\n@Override\npublic ActionMode startActionMode(ActionMode.Callback callback, int type) {\n    ActionMode actionMode = super.startActionMode(callback, type);\n    return resolveActionMode(actionMode);\n}\n\nprivate ActionMode resolveActionMode(ActionMode actionMode) {\n    if (actionMode != null) {\n        final Menu menu = actionMode.getMenu();\n        mCurActionMode = actionMode;\n        menu.clear();\n        for (int i = 0; i &lt; mMenuItemNameList.size(); i++) {\n            menu.add(mMenuItemNameList.get(i));\n        }\n        for (int i = 0; i &lt; menu.size(); i++) {\n            MenuItem menuItem = menu.getItem(i);\n            menuItem.setOnMenuItemClickListener(new MenuItem.OnMenuItemClickListener() {\n                @Override\n                public boolean onMenuItemClick(MenuItem item) {\n                    exeSelectTextJs((String) item.getTitle());\n                    releaseAction();\n                    return true;\n                }\n            });\n        }\n    }\n    mCurActionMode = actionMode;\n    return actionMode;\n}\n</code></pre> <p>CustomClickWebView\u4ee3\u7801\u5982\u4e0b <pre><code>import android.content.Context;\nimport android.util.AttributeSet;\nimport android.view.ActionMode;\nimport android.view.Menu;\nimport android.view.MenuItem;\nimport android.webkit.JavascriptInterface;\nimport android.webkit.WebView;\nimport java.util.ArrayList;\nimport java.util.List;\n\npublic class CustomClickWebView extends WebView {\n    private ActionMode mCurActionMode;\n    private List&lt;String&gt; mMenuItemNameList = new ArrayList&lt;&gt;();\n    private WebChooseActionListener mWebChooseActionListener;\n\n    public CustomClickWebView(Context context) {\n        super(context);\n    }\n\n    public CustomClickWebView(Context context, AttributeSet attrs) {\n        super(context, attrs);\n    }\n\n    public CustomClickWebView(Context context, AttributeSet attrs, int defStyleAttr) {\n        super(context, attrs, defStyleAttr);\n    }\n\n    @Override\n    public ActionMode startActionMode(ActionMode.Callback callback) {\n        ActionMode actionMode = super.startActionMode(callback);\n        return resolveActionMode(actionMode);\n    }\n\n    @Override\n    public ActionMode startActionMode(ActionMode.Callback callback, int type) {\n        ActionMode actionMode = super.startActionMode(callback, type);\n        return resolveActionMode(actionMode);\n    }\n\n    private ActionMode resolveActionMode(ActionMode actionMode) {\n        if (actionMode != null) {\n            final Menu menu = actionMode.getMenu();\n            mCurActionMode = actionMode;\n            menu.clear();\n            for (int i = 0; i &lt; mMenuItemNameList.size(); i++) {\n                menu.add(mMenuItemNameList.get(i));\n            }\n            for (int i = 0; i &lt; menu.size(); i++) {\n                MenuItem menuItem = menu.getItem(i);\n                menuItem.setOnMenuItemClickListener(new MenuItem.OnMenuItemClickListener() {\n                    @Override\n                    public boolean onMenuItemClick(MenuItem item) {\n                        exeSelectTextJs((String) item.getTitle());\n                        releaseAction();\n                        return true;\n                    }\n                });\n            }\n        }\n        mCurActionMode = actionMode;\n        return actionMode;\n    }\n\n    private void releaseAction() {\n        if (mCurActionMode != null) {\n            mCurActionMode.finish();\n            mCurActionMode = null;\n        }\n    }\n\n    private void exeSelectTextJs(String title) {\n        String js = \"(function getSelectedText() {\" +\n                \"var txt;\" +\n                \"var title = \\\"\" + title + \"\\\";\" +\n                \"if (window.getSelection) {\" +\n                \"txt = window.getSelection().toString();\" +\n                \"} else if (window.document.getSelection) {\" +\n                \"txt = window.document.getSelection().toString();\" +\n                \"} else if (window.document.selection) {\" +\n                \"txt = window.document.selection.createRange().text;\" +\n                \"}\" +\n                \"RFJSInterface.chooseAction(txt,title);\" +\n                \"})()\";\n        evaluateJavascript(\"javascript:\" + js, null);\n    }\n\n    /**\n     * \u5728\u5916\u90e8\u8c03\u7528\n     */\n    public void linkJSInterface() {\n        addJavascriptInterface(new CustomJsInterface(this), \"RFJSInterface\");\n    }\n\n    /**\n     * @param actionList \u5f39\u51fa\u83dc\u5355\n     */\n    public void setActionList(List&lt;String&gt; actionList) {\n        mMenuItemNameList = actionList;\n    }\n\n    public void setActionSelectListener(WebChooseActionListener webChooseActionListener) {\n        this.mWebChooseActionListener = webChooseActionListener;\n    }\n\n    /**\n     * \u9690\u85cf\u6d88\u5931Action\n     */\n    public void dismissAction() {\n        releaseAction();\n    }\n\n    /**\n     * js\u9009\u4e2d\u7684\u56de\u6389\u63a5\u53e3\n     */\n    private class CustomJsInterface {\n\n        CustomClickWebView webView;\n\n        CustomJsInterface(CustomClickWebView c) {\n            webView = c;\n        }\n\n        /**\n         * @param value \u9009\u4e2d\u7684\u6587\u5b57\n         * @param title \u83dc\u5355\u6807\u9898\n         */\n        @JavascriptInterface\n        public void chooseAction(final String value, final String title) {\n            if (mWebChooseActionListener != null) {\n                mWebChooseActionListener.onChosen(title, value);\n            }\n        }\n    }\n}\n</code></pre></p>"},{"location":"android/ui/view/webView/long-click-pop-menu/#_4","title":"\u4f7f\u7528","text":"<p>layout\u4e2d\u4f7f\u7528\u8fd9\u4e2aCustomClickWebView <pre><code>&lt;com.rustfisher.tutorial2020.web.longmenu.CustomClickWebView\n    android:id=\"@+id/web1\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\" /&gt;\n</code></pre></p> <p>Activity\u4e2d\u8fdb\u884c\u521d\u59cb\u5316\u914d\u7f6e <pre><code>mWv1.getSettings().setJavaScriptEnabled(true);   // \u5141\u8bb8\u4f7f\u7528js\nmWv1.setActionList(Arrays.asList(\"\u590d\u5236\", \"\u7ffb\u8bd1\"));// \u81ea\u5b9a\u4e49\u83dc\u5355\u9009\u9879\nmWv1.getSettings().setBlockNetworkImage(false);\nmWv1.linkJSInterface(); // \u628ajs\u63a5\u53e3\u6dfb\u52a0\u8fdb\u53bb\n\n// \u8bbe\u7f6e\u76d1\u542c\u5668\uff0c\u83b7\u53d6\u70b9\u51fb\u5230\u7684\u83dc\u5355\u548c\u9009\u4e2d\u7684\u6587\u5b57\nmWv1.setActionSelectListener(new WebChooseActionListener() {\n    @Override\n    public void onChosen(String title, String selectText) {\n        Toast.makeText(getApplicationContext(), \"(\" + title + \") -&gt; \" + selectText, Toast.LENGTH_SHORT).show();\n    }\n});\n</code></pre></p> <p>\u8fd0\u884c\u540e\u53ef\u4ee5\u770b\u5230\u7ed3\u679c\u3002</p> <p>\u91cd\u5199<code>startActionMode</code>\u7684\u505a\u6cd5\u5728x5 WebView\u4e0a\u5e76\u4e0d\u8d77\u4f5c\u7528\u3002</p>"},{"location":"android/ui/view/webView/webView-in-NestedScrollView-empty-bottom/","title":"WebView\u5728NestedScrollView\u4e2d\u9ad8\u5ea6\u4e0d\u7a33\u5b9a","text":"<p>WebView\u5728NestedScrollView\u4e2d\u9ad8\u5ea6\u4e0d\u7a33\u5b9a\uff0c\u9996\u6b21\u52a0\u8f7d\u540e\uff0cwebView\u5e95\u90e8\u4f1a\u6709\u4e00\u5927\u5757\u7a7a\u767d\u533a\u57df\u3002</p> <p>\u672c\u6587\u4e2d\u4f7f\u7528\u7684\u662f<code>com.tencent.smtt.sdk.WebView</code></p> <p>layout\u5c42\u7ea7\u5982\u4e0b\u3002NestedScrollView\u5305\u7740\u4e00\u4e2aLinearLayout\uff0c\u7136\u540e\u518d\u5305\u7740WebView\u3002 <pre><code>&lt;androidx.core.widget.NestedScrollView\n    android:id=\"@+id/fisher_nest\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"&gt;\n\n    &lt;LinearLayout\n        android:layout_width=\"match_parent\"\n        android:layout_height=\"wrap_content\"\n        android:orientation=\"vertical\"&gt;\n        &lt;!-- \u5176\u4ed6view --&gt;\n        &lt;com.tencent.smtt.sdk.WebView\n            android:id=\"@+id/fisher_web\"\n            android:layout_width=\"match_parent\"\n            android:layout_height=\"wrap_content\"\n            android:background=\"@color/transparent\" /&gt;\n\n        &lt;!-- \u5176\u4ed6view --&gt;\n    &lt;/LinearLayout&gt;\n&lt;/androidx.core.widget.NestedScrollView&gt;\n</code></pre></p> <p>\u52a0\u8f7d\u7684\u662fhtml\u6587\u672c\u6570\u636e\uff0c\u4f7f\u7528\u7684\u52a0\u8f7d\u65b9\u5f0f\u5982\u4e0b <pre><code>wv.loadDataWithBaseURL(null, \"&lt;html&gt;html\u6587\u672c\u6570\u636e&lt;/html&gt;\", \"text/html\", \"UTF-8\", null);\n</code></pre></p> <p>\u9996\u6b21\u52a0\u8f7d\u540e\u4f1a\u53d1\u73b0webView\u5e95\u90e8\u6709\u4e00\u5927\u5757\u7a7a\u767d\u3002\u5047\u8bbe\u6587\u672c\u9700\u8981\u7684\u9ad8\u5ea6\u662f1000px\uff0c\u4f46\u5b9e\u9645\u5c55\u793a\u9ad8\u5ea6\u662f4000px\u3002 \u800c\u66ff\u6362html\u5185\u5bb9\u518d\u6b21\u52a0\u8f7d\u540e\uff0cwebView\u9ad8\u5ea6\u4f1a\u53d8\u77ee\u4e00\u4e9b\u3002</p> <p>\u4e3a\u4e86\u89c4\u907f\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u91c7\u7528\u52a0\u8f7d\u7a7a\u6587\u672c + \u52a8\u6001\u6d4b\u91cf\u9ad8\u5ea6\u7684\u65b9\u5f0f\u3002</p>"},{"location":"android/ui/view/webView/webView-in-NestedScrollView-empty-bottom/#_1","title":"\u9884\u52a0\u8f7d\u7a7a\u6587\u672c","text":"<p><code>wv</code>\u662fWebView\u3002 \u5728\u52a0\u8f7d\u76ee\u6807\u6587\u672c\u4e4b\u524d\uff0c\u5148\u52a0\u8f7d\u4e00\u4e2a\u4e2d\u95f4\u4fe1\u606f\u3002\u7136\u540e\u5ef6\u65f6\u663e\u793a\u76ee\u6807\u6587\u672c\u3002</p> <pre><code>// \u5148\u663e\u793a\u70b9\u5176\u4ed6\u7684\u4fe1\u606f\nwv.loadDataWithBaseURL(null, \"&lt;html&gt;&lt;body&gt;&lt;div id='whole'&gt;welcome to an.rustfisher.com&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;\", \n    \"text/html\", \"UTF-8\", null);\nmHandler.postDelayed(new Runnable() {\n    @Override\n    public void run() {\n        // \u663e\u793a\u76ee\u6807\u6587\u672c\n    }\n}, 700);\n</code></pre>"},{"location":"android/ui/view/webView/webView-in-NestedScrollView-empty-bottom/#js","title":"js\u63a5\u53e3","text":"<p>html\u6587\u672c\u4e2d\uff0c\u7ed9\u5185\u5bb9\u6700\u5916\u5c42\u5305\u4e0a\u4e00\u4e2a<code>&lt;div&gt;</code>\uff0c\u5e76\u6253\u4e0a\u6807\u793a\u3002</p> <p>\u4f8b\u5982 <pre><code>&lt;html&gt;\n    &lt;body&gt;\n        &lt;div id='whole'&gt;\u8fd9\u91cc\u662f\u6211\u4eec\u7684\u76ee\u6807\u4fe1\u606f - an.rustfisher.com&lt;/div&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre></p> <p>\u65b0\u5efa\u76d1\u542c\u5668<code>JSActionListener</code>\u3002\u5b9a\u4e49\u65b9\u6cd5<code>onResize(float height)</code>\u3002 <pre><code>public abstract class JSActionListener {\n    public void onResize(float height) {\n\n    }\n}\n</code></pre></p> <p>\u65b0\u5efa<code>JSAction</code>\u7c7b\uff0c\u91cc\u9762\u589e\u52a0js\u63a5\u53e3\u65b9\u6cd5\uff0c\u9700\u8981\u4f7f\u7528<code>@JavascriptInterface</code>\u6ce8\u89e3\u3002 <pre><code>public class JSAction {\n    public static final String JS_INTERFACE_NAME = \"android\"; // \u63d0\u4f9b\u7ed9js\n    private JSActionListener listener;\n    private Handler mHandler = new Handler(Looper.getMainLooper());\n\n    public JSAction(JSActionListener listener) {\n        this.listener = listener;\n    }\n\n    @JavascriptInterface\n    public void resize(final float height) {\n        mHandler.post(new Runnable() {\n            @Override\n            public void run() {\n                listener.onResize(height);\n            }\n        });\n    }\n}\n</code></pre></p> <p>js\u63a5\u53e3\u540d\u79f0\u662f<code>resize</code>\uff0c\u540e\u9762\u8981\u7528js\u6765\u8c03\u7528\u5b83\u3002</p>"},{"location":"android/ui/view/webView/webView-in-NestedScrollView-empty-bottom/#webview","title":"\u914d\u7f6eWebView","text":"<p>\u5206\u4e3a2\u6b65\u3002\u9996\u5148\u628a\u524d\u9762\u5b9a\u4e49\u597d\u7684\u63a5\u53e3\u7528\u8d77\u6765\u3002js\u8981\u548cJava\u8fdb\u884c\u6c9f\u901a\u3002</p> <p>webView\u9700\u8981\u5141\u8bb8js\u65b9\u6cd5\u3002<code>setJavaScriptEnabled</code>\u5df2\u7ecfdeprecated\uff0c\u4f46\u8fd9\u91cc\u4e3a\u4e86\u65b9\u4fbf\u7ee7\u7eed\u4f7f\u7528\u3002</p>"},{"location":"android/ui/view/webView/webView-in-NestedScrollView-empty-bottom/#js_1","title":"\u6dfb\u52a0js\u63a5\u53e3","text":"<pre><code>WebSettings webSettings = wv.getSettings();\nwebSettings.setJavaScriptEnabled(true);\nwv.addJavascriptInterface(new JSAction(new JSActionListener() {\n    @Override\n    public void onResize(final float height) {\n        super.onResize(height);\n        LinearLayout.LayoutParams lp = (LinearLayout.LayoutParams) wv.getLayoutParams();\n        lp.height = (int) (height * getResources().getDisplayMetrics().density);\n        wv.setLayoutParams(lp);\n    }\n}), JSAction.JS_INTERFACE_NAME);\n</code></pre>"},{"location":"android/ui/view/webView/webView-in-NestedScrollView-empty-bottom/#_2","title":"\u9875\u9762\u52a0\u8f7d\u5b8c\u6210","text":"<p>\u76d1\u542c\u5230\u9875\u9762\u52a0\u8f7d\u5b8c\u6bd5\u540e\uff0c\u8ba9webView\u53bb\u8c03\u7528js\u65b9\u6cd5\u3002</p> <ul> <li>android\u5c31\u662f\u524d\u9762\u5b9a\u4e49\u7684<code>JSAction.JS_INTERFACE_NAME</code>\u3002</li> <li><code>document.getElementById(\\\"whole\\\").offsetHeight</code> \u80fd\u62ff\u5230id\u4e3a<code>whole</code>\u7684\u5143\u7d20\u7684\u9ad8\u5ea6\u3002<ul> <li>\u8fd9\u91cc\u4e0d\u5b9a\u4e49id\u5e94\u8be5\u4e5f\u53ef\u4ee5\uff0c\u76f4\u63a5\u7528<code>document.body.getBoundingClientRect()</code>\u5e94\u8be5\u4e5f\u884c\u3002</li> </ul> </li> </ul> <pre><code>wv.setWebViewClient(new WebViewClient() {\n    @Override\n    public void onPageFinished(WebView view, String url) {\n        wv.loadUrl(\"javascript:android.resize(document.getElementById(\\\"whole\\\").offsetHeight)\");\n        super.onPageFinished(view, url);\n    }\n});\n</code></pre> <p>\u8fd0\u884c\u8868\u73b0\u662f\uff0c\u5148\u663e\u793a<code>welcome to an.rustfisher.com</code>\u5b57\u6837\uff0c\u7136\u540e\u518d\u663e\u793a\u76ee\u6807\u6587\u672c\u6570\u636e\u3002</p> <p>\u66f4\u8fdb\u4e00\u6b65\u7684\u505a\u6cd5\u662f\uff0c\u5728<code>onPageFinished</code>\u76d1\u542c\u5230\u4e2d\u95f4\u6570\u636e\u663e\u793a\u5b8c\u6bd5\u540e\uff0c\u518d\u53bb\u52a0\u8f7d\u76ee\u6807\u6570\u636e\u3002</p>"},{"location":"android/ui/view/webView/wv-use/","title":"Android WebView\u5404\u9879\u4f7f\u7528\u8bf4\u660e","text":"2023-3-30 \u66f4\u65b0\u4f8b\u5b50 <ul> <li>2023-3-30 \u66f4\u65b0\u4f8b\u5b50</li> <li>2022-1-16 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u8bb0\u5f55\u4e00\u4e9bwebview\u7684\u8bbe\u7f6e\u548c\u64cd\u4f5c\u3002</p>"},{"location":"android/ui/view/webView/wv-use/#webview","title":"\u7981\u6b62webview\u5904\u7406\u957f\u6309\u4e8b\u4ef6","text":"<p>\u8bbe\u7f6eOnLongClickListener\u628a\u957f\u6309\u4e8b\u4ef6\u6d88\u8d39\u6389\u3002</p> <pre><code>web.setOnLongClickListener(new View.OnLongClickListener() {\n    @Override\n    public boolean onLongClick(View v) {\n        return true;\n    }\n});\n</code></pre>"},{"location":"android/ui/view/webView/wv-use/#_1","title":"\u6539\u53d8\u5b57\u4f53\u5927\u5c0f","text":"<p>\u5b57\u4f53\u5927\u5c0f\u7684\u679a\u4e3e\u3002 <pre><code>    public static enum TextSize {\n        SMALLEST(50),\n        SMALLER(75),\n        NORMAL(100),\n        LARGER(125),\n        LARGEST(150);\n\n        int value;\n\n        private TextSize(int var3) {\n            this.value = var3;\n        }\n    }\n</code></pre></p> <p>\u83b7\u53d6<code>WebSettings</code>\uff0c\u7136\u540e\u8bbe\u7f6e\u5b57\u4f53\u5927\u5c0f\u3002 <pre><code>WebSettings st = wv.getSettings();\nst.setTextSize(WebSettings.TextSize.LARGER);\n</code></pre></p>"},{"location":"android/ui/view/webView/wv-use/#m3u8","title":"m3u8\u89c6\u9891","text":"<p>Android webview\u64ad\u653e\u4e0d\u4e86m3u8\u89c6\u9891\u3002</p>"},{"location":"android/ui/view/webView/wv-use/#notallowederror-play-can-only-be-initiated-by-a-user-gesture","title":"NotAllowedError: play can only be initiated by a user gesture","text":"<p>\u8bbe\u7f6ewebview <pre><code>webViewSettings.setMediaPlaybackRequiresUserGesture(false);\n</code></pre></p>"},{"location":"android/ui/view/webView/wv-use/#webviewurl","title":"webview\u6253\u5f00URL\uff0c\u8df3\u53bb\u4e86\u7cfb\u7edf\u81ea\u5e26\u7684\u6d4f\u89c8\u5668","text":"<p>\u8fd9\u53ef\u80fd\u662f\u7531\u4e8e\u5728Android WebView\u4e2d\u6ca1\u6709\u6b63\u786e\u914d\u7f6eWebSettings\u6216WebViewClient\u6240\u5bfc\u81f4\u7684\u3002\u8bf7\u5c1d\u8bd5\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <p>1.\u786e\u4fdd\u5df2\u542f\u7528JavaScript\uff1a</p> <pre><code>WebSettings webSettings = webView.getSettings();\nwebSettings.setJavaScriptEnabled(true);\n</code></pre> <p>2.\u8bbe\u7f6e\u4e00\u4e2a\u65b0\u7684WebViewClient\uff1a</p> <pre><code>webView.setWebViewClient(new WebViewClient() {\n    @Override\n    public boolean shouldOverrideUrlLoading(WebView view, String url) {\n        view.loadUrl(url);\n        return true;\n    }\n});\n</code></pre> <p>\u5982\u679c\u4e0a\u8ff0\u65b9\u6cd5\u4ecd\u65e0\u6cd5\u89e3\u51b3\u95ee\u9898\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u6dfb\u52a0\u4ee5\u4e0b\u6807\u8bb0\u4ee5\u786e\u4fddWebView\u4e0d\u4f1a\u8df3\u8f6c\u5230\u7cfb\u7edf\u81ea\u5e26\u7684\u6d4f\u89c8\u5668\uff1a</p> <pre><code>webView.setWebViewClient(new WebViewClient(){\n    @Override\n    public boolean shouldOverrideUrlLoading(WebView view, WebResourceRequest request) {\n        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {\n            view.loadUrl(request.getUrl().toString());\n        }\n        else {\n            view.loadUrl(request.toString());\n        }\n        return false;\n    }\n});\n\nwebView.setWebChromeClient(new WebChromeClient() {\n    @Override\n    public void onPermissionRequest(PermissionRequest request) {\n        request.grant(request.getResources());\n    }\n});\n\nwebView.getSettings().setJavaScriptEnabled(true);\nwebView.getSettings().setDomStorageEnabled(true);\nwebView.getSettings().setAllowFileAccess(true);\nwebView.getSettings().setAllowContentAccess(true);\nwebView.getSettings().setAllowUniversalAccessFromFileURLs(true);\nwebView.getSettings().setAllowFileAccessFromFileURLs(true);\n</code></pre>"},{"location":"android/ui/view/webView/wv-use/#_2","title":"\u53c2\u8003","text":"<ul> <li>DOMException: play() can only be initiated by a user gesture</li> </ul>"},{"location":"android/ui/widget/popupwindow/edit-text-cannot-eidt/","title":"PopupWindow\u4e2dEditText\u65e0\u6cd5\u7f16\u8f91\uff0c\u65e0\u6cd5\u5f39\u51fa\u8f6f\u952e\u76d8","text":"<p>\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u9700\u8981\u5bf9PopupWindow\u8fdb\u884c\u8bbe\u7f6e\u3002\u8bbe\u7f6epopupWindow\u5141\u8bb8\u83b7\u5f97\u5173\u6ce8\u3002 \u65b0\u5efa\u5bf9\u8c61\u65f6\u8bbe\u7f6efocusable=true\uff0c\u6216<code>popupWindow.setFocusable(true)</code>\u3002</p> <pre><code>popupWindow = new PopupWindow(contentView, ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.WRAP_CONTENT, true);\npopupWindow.setOutsideTouchable(true);\npopupWindow.setFocusable(true);\n\npopupWindow.setInputMethodMode(PopupWindow.INPUT_METHOD_NEEDED);\npopupWindow.setSoftInputMode(WindowManager.LayoutParams.SOFT_INPUT_ADJUST_RESIZE);\n</code></pre>"},{"location":"android/ui/widget/seekbar/seekbar-custom-thumb-animation/","title":"Android SeekBar \u81ea\u5b9a\u4e49thumb\uff0cthumb\u65cb\u8f6c\u52a8\u753b\u6548\u679c","text":"\u66f4\u65b0\u65e5\u671f: 2021-11-18 <ul> <li>2021-11-18 \u589e\u52a0\u6548\u679c</li> <li>2018-11-20 \u521b\u5efa\u6587\u6863</li> </ul>"},{"location":"android/ui/widget/seekbar/seekbar-custom-thumb-animation/#_1","title":"\u7b80\u4ecb","text":"<p>\u67d0\u4e9b\u97f3\u4e50\u64ad\u653e\u6216\u8005\u89c6\u9891\u64ad\u653e\u7684\u754c\u9762\u4e0a\uff0c\u8d44\u6e90\u8fd8\u5728\u52a0\u8f7d\u65f6\uff0c\u8fdb\u5ea6\u6761\u7684\u539f\u70b9\uff08thumb\uff09\u4f1a\u663e\u793a\u4e00\u4e2a\u8f6c\u5708\u7684\u6548\u679c\u3002 \u8d44\u6e90\u52a0\u8f7d\u5b8c\u6210\u540e\uff0c\u53c8\u5207\u6362\u56de\u9759\u6001\u6548\u679c\u3002\u8fd9\u4e2a\u6548\u679c\u589e\u5f3a\u4e86\u7528\u6237\u4f53\u9a8c\u3002</p> <p>\u4e00\u822c\u6765\u8bf4\u6709\u7f8e\u672f\u4eba\u5458\u8d1f\u8d23\u8bbe\u8ba1\u548c\u5207\u56fe\u3002\u5c1d\u8bd5\u5b9e\u73b0\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4f7f\u7528drawable\uff0c\u6765\u6a21\u62df\u5b9e\u73b0\u8fd9\u4e2a\u8f6c\u5708\u7684\u6548\u679c\u3002</p>"},{"location":"android/ui/widget/seekbar/seekbar-custom-thumb-animation/#_2","title":"\u793a\u4f8b","text":""},{"location":"android/ui/widget/seekbar/seekbar-custom-thumb-animation/#dimensxml","title":"dimens.xml","text":"<p>\u4e3a\u65b9\u4fbf\u7ba1\u7406\uff0c\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e9b\u5c3a\u5bf8\u8bbe\u7f6e <pre><code>&lt;dimen name=\"audio_course_item_seek_bar_progress_height\"&gt;6dp&lt;/dimen&gt;\n&lt;dimen name=\"audio_course_item_seek_bar_radius\"&gt;2dp&lt;/dimen&gt;\n&lt;dimen name=\"audio_seek_bar_thumb_size\"&gt;20dp&lt;/dimen&gt;\n&lt;dimen name=\"audio_seek_bar_thumb_ring_width\"&gt;4dp&lt;/dimen&gt;\n</code></pre></p>"},{"location":"android/ui/widget/seekbar/seekbar-custom-thumb-animation/#drawable","title":"drawable","text":"<p>\u6211\u4eec\u4e00\u5171\u8981\u6dfb\u52a04\u4e2adrawable\u6587\u4ef6\u3002\u5206\u522b\u662f2\u79cdthumb\uff0c1\u4e2a\u52a8\u753b\uff0c1\u4e2a\u8fdb\u5ea6\u6761\u201c\u5e95\u5ea7\u201d\u3002 <pre><code>shape_thumb_round_1.xml # \u9759\u6001thumb\nlayers_seek_bar_progress_1.xml\nlayers_thumb_ring_sweep_1.xml\nrotate_thumb_1.xml\n</code></pre></p>"},{"location":"android/ui/widget/seekbar/seekbar-custom-thumb-animation/#shape_thumb_round_1xml","title":"shape_thumb_round_1.xml","text":"<p>\u7528solid\u548cstroke\u505a\u51fa\u7684\u5706\u73af\u6548\u679c <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;shape xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:shape=\"oval\"&gt;\n    &lt;solid android:color=\"#ffffff\" /&gt;\n    &lt;stroke\n        android:width=\"@dimen/audio_seek_bar_thumb_ring_width\"\n        android:color=\"#7095fc\" /&gt;\n    &lt;size\n        android:width=\"@dimen/audio_seek_bar_thumb_size\"\n        android:height=\"@dimen/audio_seek_bar_thumb_size\" /&gt;\n&lt;/shape&gt;\n</code></pre></p>"},{"location":"android/ui/widget/seekbar/seekbar-custom-thumb-animation/#layers_thumb_ring_sweep_1xml","title":"layers_thumb_ring_sweep_1.xml","text":"<p>\u8fd9\u662f\u51c6\u5907\u62ff\u6765\u8f6c\u5708\u7684thumb\u3002\u4f7f\u7528layer-list\uff0c\u53e0\u52a0\u591a\u5c42\u6548\u679c\u3002 \u5e95\u90e8\u662f\u4e00\u4e2a\u534a\u767d\u8272\u7684\u5706\uff08<code>android:shape=\"oval\"</code>\uff09\u3002 \u518d\u53e0\u52a0\u4e0a\u4e00\u5c42\u5706\u73af\uff08<code>android:shape=\"ring\"</code>\uff09\uff0c\u4f7f\u7528\u4e86\u6e10\u53d8\u8272\uff0c\u589e\u52a0\u52a8\u611f\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layer-list xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n    &lt;item&gt;\n        &lt;shape android:shape=\"oval\"&gt;\n            &lt;size\n                android:width=\"@dimen/audio_seek_bar_thumb_size\"\n                android:height=\"@dimen/audio_seek_bar_thumb_size\" /&gt;\n            &lt;solid android:color=\"#ffffff\" /&gt;\n        &lt;/shape&gt;\n    &lt;/item&gt;\n    &lt;item&gt;\n        &lt;shape\n            android:innerRadius=\"4dp\"\n            android:thicknessRatio=\"6\"\n            android:shape=\"ring\"\n            android:useLevel=\"false\"&gt;\n            &lt;gradient\n                android:endColor=\"#ffffff\"\n                android:startColor=\"#7095fc\"\n                android:type=\"sweep\" /&gt;\n            &lt;size\n                android:width=\"@dimen/audio_seek_bar_thumb_size\"\n                android:height=\"@dimen/audio_seek_bar_thumb_size\" /&gt;\n        &lt;/shape&gt;\n    &lt;/item&gt;\n&lt;/layer-list&gt;\n</code></pre></p>"},{"location":"android/ui/widget/seekbar/seekbar-custom-thumb-animation/#rotate_thumb_1xml","title":"rotate_thumb_1.xml","text":"<p>\u5b9a\u4e49\u65cb\u8f6c\u6548\u679c\u3002\u6ce8\u610f\u5b83\u7684<code>drawable</code>\u4f7f\u7528\u4e86\u4e0a\u9762\u5b9a\u4e49\u7684layers_thumb_ring_sweep_1.xml\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;rotate xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:drawable=\"@drawable/layers_thumb_ring_sweep_1\"\n    android:duration=\"100\"\n    android:fromDegrees=\"0\"\n    android:pivotX=\"50%\"\n    android:pivotY=\"50%\"\n    android:toDegrees=\"-360\" /&gt;\n</code></pre> \u65cb\u8f6c\u53c2\u6570<code>android:toDegrees</code>\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u5b9a\u4e49\u3002</p>"},{"location":"android/ui/widget/seekbar/seekbar-custom-thumb-animation/#layers_seek_bar_progress_1xml","title":"layers_seek_bar_progress_1.xml","text":"<p>\u5b9a\u4e49\u8fdb\u5ea6\u6761\u7684\u6837\u5f0f\u3002\u8fd9\u4e2a\u662f\u201c\u5e95\u5ea7\u201d\u3002\u989c\u8272\u8981\u548c\u4e0a\u9762\u7684\u5339\u914d\uff0c\u770b\u8d77\u6765\u597d\u770b\u4e00\u70b9\u3002 <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;layer-list xmlns:android=\"http://schemas.android.com/apk/res/android\"&gt;\n    &lt;item android:id=\"@android:id/background\"&gt;\n        &lt;shape&gt;\n            &lt;size\n                android:width=\"5dp\"\n                android:height=\"@dimen/audio_course_item_seek_bar_progress_height\" /&gt;\n            &lt;solid android:color=\"#e1e5e8\" /&gt;\n        &lt;/shape&gt;\n    &lt;/item&gt;\n    &lt;item android:id=\"@android:id/secondaryProgress\"&gt;\n        &lt;clip&gt;\n            &lt;shape&gt;\n                &lt;solid android:color=\"#b7bdc8\" /&gt;\n            &lt;/shape&gt;\n        &lt;/clip&gt;\n    &lt;/item&gt;\n    &lt;item android:id=\"@android:id/progress\"&gt;\n        &lt;clip&gt;\n            &lt;shape&gt;\n                &lt;gradient\n                    android:angle=\"0\"\n                    android:centerColor=\"#b8cafd\"\n                    android:endColor=\"#86a4fd\"\n                    android:startColor=\"#eef2ff\" /&gt;\n            &lt;/shape&gt;\n        &lt;/clip&gt;\n    &lt;/item&gt;\n&lt;/layer-list&gt;\n</code></pre></p>"},{"location":"android/ui/widget/seekbar/seekbar-custom-thumb-animation/#layout","title":"layout","text":"<p>\u4e0a\u9762\u7684\u8d44\u6e90\u6587\u4ef6\u51c6\u5907\u5b8c\u6bd5\u540e\u3002\u5728\u6211\u4eec\u7684\u5e03\u5c40\u4e2d\u6dfb\u52a0\u4e00\u4e2aSeekBar</p> <ul> <li><code>android:maxHeight</code>\u548c<code>android:minHeight</code>\u9700\u8981\u8bbe\u7f6e</li> <li><code>android:progressDrawable</code> \u7528\u524d\u9762\u5b9a\u4e49\u597d\u7684\u201c\u5e95\u5ea7\u201d</li> <li><code>android:thumb</code> \u5148\u4f7f\u7528\u9759\u6001\u7684\u6837\u5f0f</li> </ul> <pre><code>&lt;SeekBar\n    android:id=\"@+id/play_sb\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"wrap_content\"\n    android:layout_marginTop=\"16dp\"\n    android:background=\"@null\"\n    android:maxHeight=\"@dimen/audio_course_item_seek_bar_progress_height\"\n    android:minHeight=\"@dimen/audio_course_item_seek_bar_progress_height\"\n    android:progress=\"40\"\n    android:progressDrawable=\"@drawable/layers_seek_bar_progress_1\"\n    android:thumb=\"@drawable/shape_thumb_round_1\"\n    app:layout_constraintTop_toTopOf=\"parent\" /&gt;\n</code></pre>"},{"location":"android/ui/widget/seekbar/seekbar-custom-thumb-animation/#activity","title":"Activity\u4e2d\u8c03\u7528","text":"<p>\u7531Activity\u6765\u6301\u6709Drawable\u53d8\u91cf\u548c\u52a8\u753b\u3002\u4f8b\u5b50\u4e2d\u4f7f\u7528\u4e86dataBinding\u3002 <pre><code>private RotateDrawable mRotateThumbDrawable; //  \u52a0\u8f7d\u4e2d\u7684thumb\uff0c\u7531Activity\u6765\u6301\u6709\u8fd9\u4e2adrawable\nprivate Drawable mSolidThumb;\nprivate ObjectAnimator mThumbAnimator; // \u63a7\u5236\u52a8\u753b\n// ...\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        mBinding = DataBindingUtil.setContentView(this, R.layout.act_seekbar_1);// ...\n        mRotateThumbDrawable = (RotateDrawable) AppCompatResources.getDrawable(getApplicationContext(), R.drawable.rotate_thumb_1);\n        mSolidThumb = AppCompatResources.getDrawable(getApplicationContext(), R.drawable.shape_thumb_round_1);\n    }\n</code></pre> Drawable\u5bf9\u8c61\u7531activity\u76f4\u63a5\u6301\u6709\uff0c\u64cd\u4f5c\u8d77\u6765\u6bd4\u8f83\u65b9\u4fbf\u3002</p> <p>\u6539\u53d8seekbar\u7684thumb\uff0c\u4f7f\u7528\u65b9\u6cd5<code>setThumb(Drawable thumb)</code></p> <p>\u4f7f\u7528\u9759\u6001\u7684thumb <pre><code>mBinding.playSb.setThumb(mSolidThumb);\n</code></pre></p> <p>\u4f7f\u7528\u8f6c\u5708\u5708\u7684\u6548\u679c\uff0c\u5148<code>setThumb</code>\uff0c\u5e76\u4e14\u9700\u8981\u542f\u52a8\u52a8\u753b <pre><code>mBinding.playSb.setThumb(mRotateThumbDrawable);\nmThumbAnimator = ObjectAnimator.ofInt(mRotateThumbDrawable, \"level\", 0, 10000);\nmThumbAnimator.setDuration(1000);\nmThumbAnimator.setRepeatCount(ValueAnimator.INFINITE);\nmThumbAnimator.setInterpolator(new LinearInterpolator());\nmThumbAnimator.start();\n</code></pre></p> <p>\u6548\u679c\u5982\u4e0b\u56fe</p> <p></p> <p>\u53ef\u4ee5\u5728\u9759\u6001\u548c\u52a8\u6001\u4e4b\u95f4\u76f8\u4e92\u5207\u6362\u3002</p> <p>\u79bb\u5f00\u9875\u9762\u65f6\u8bb0\u5f97\u5173\u95ed\u52a8\u753b <pre><code>@Override\nprotected void onDestroy() {\n    if (null != mThumbAnimator) {\n        mThumbAnimator.cancel();\n    }\n    super.onDestroy();\n}\n</code></pre></p>"},{"location":"android/ui/widget/seekbar/seekbar-custom-thumb-animation/#_3","title":"\u5c0f\u7ed3","text":"<p>\u8981\u5b9e\u73b0\u8f6c\u5708\u7684\u6548\u679c\u3002\u4e3b\u8981\u8fd8\u662f\u76f4\u63a5\u64cd\u4f5cdrawable\u5bf9\u8c61\uff0c\u628a\u52a8\u753b\u52a0\u8fdb\u53bb\u3002 <code>setThumb(Drawable thumb)</code>\u65b9\u6cd5\u63a5\u53d7\u7684\u662fDrawable\u5bf9\u8c61\uff0c\u90a3\u4e48\u6211\u4eec\u7684\u601d\u8def\u5c31\u662f\u4ece\u63a7\u5236Drawable\u8fd9\u70b9\u4e0b\u624b\u3002</p> <p>\u5168\u90e8\u4f7f\u7528drawable\u53ef\u4ee5\u8fbe\u5230\u6587\u4e2d\u7684\u6548\u679c\u3002\u6709\u6761\u4ef6\u7684\u4e5f\u53ef\u4ee5\u4f7f\u7528\u56fe\u7247\u8d44\u6e90\u3002\u505a\u51fa\u66f4\u4e30\u5bcc\u7684\u6548\u679c\u3002</p> <p>\u53c2\u8003\uff1a</p> <ul> <li>\u4f7f\u7528<code>layer-list</code>\u7684\u73af\u5f62drawable https://stackoverflow.com/questions/30676208/how-to-create-ring-shape-drawable-in-android/30677289</li> <li>https://stackoverflow.com/questions/15083811/programmatically-rotate-drawable-or-view</li> <li>https://stackoverflow.com/questions/5872257/how-do-i-use-rotatedrawable/17123794</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a \u6398\u91d1 cnblog </p>"},{"location":"android/ui/widget/toast/custom-toast/","title":"Android \u81ea\u5b9a\u4e49Toast","text":"\u66f4\u65b0\u65e5\u671f 2022-9-5 <ul> <li>2022-9-5 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u7cfb\u7edf\u81ea\u5e26\u7684Toast\u4e00\u822c\u662f\u7070\u8272\u80cc\u666f\uff0c\u9ed1\u8272\u6587\u5b57\u3002\u6709\u65f6\u5019\u6211\u4eec\u9700\u8981\u505a\u4e00\u4e9b\u81ea\u5b9a\u4e49\u7684\u80cc\u666f\u548c\u989c\u8272\u7684Toast\u3002</p> <p>\u53ef\u4ee5\u4f9d\u65e7\u4f7f\u7528Toast\u7c7b\u548c\u5b83\u7684\u673a\u5236\uff0c\u4f46\u628a\u6211\u4eec\u81ea\u5df1\u7684ui\u66ff\u6362\u8fdb\u53bb\u3002</p>"},{"location":"android/ui/widget/toast/custom-toast/#toast","title":"\u81ea\u5b9a\u4e49\u80cc\u666f\u548c\u6587\u5b57\u989c\u8272\u5927\u5c0f\u7684Toast","text":"<p>\u8fd9\u91cc\u7ed9\u4e00\u4e2a\u81ea\u5b9a\u4e49\u80cc\u666f\u548c\u6587\u5b57\u989c\u8272\u5927\u5c0f\u7684\u4f8b\u5b50\u3002</p>"},{"location":"android/ui/widget/toast/custom-toast/#_1","title":"\u80cc\u666f","text":"<p>\u5148\u5728drawable\u91cc\u5f04\u4e00\u4e2a\u80cc\u666fbg_my_toast.xml <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;shape xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:shape=\"rectangle\"&gt;\n    &lt;corners android:radius=\"25dp\" /&gt;\n    &lt;solid android:color=\"#A9EAEAEA\" /&gt;\n&lt;/shape&gt;\n</code></pre></p>"},{"location":"android/ui/widget/toast/custom-toast/#layout","title":"layout","text":"<p>\u81ea\u5b9a\u4e49\u4e00\u4e2alayout <pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    android:background=\"@drawable/bg_my_toast\"\n    android:orientation=\"vertical\"&gt;\n\n    &lt;TextView\n        android:id=\"@+id/tv1\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_gravity=\"center\"\n        android:layout_margin=\"12dp\"\n        android:gravity=\"center\"\n        android:minWidth=\"120dp\"\n        android:text=\"Warning\"\n        android:textColor=\"#C2185B\"\n        android:textSize=\"18sp\" /&gt;\n&lt;/LinearLayout&gt;\n</code></pre></p> <p>\u4ece\u8fd9\u91cc\u6211\u4eec\u4e5f\u53ef\u4ee5\u770b\u51fa\uff0c\u9664\u4e86TextView\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u591a\u653e\u70b9\u4e1c\u897f\u8fdb\u53bb\u3002</p>"},{"location":"android/ui/widget/toast/custom-toast/#_2","title":"\u8c03\u7528\u65b9\u5f0f","text":"<p>\u9996\u5148\u6839\u636elayout\u52a0\u8f7dview\uff0c\u7136\u540e\u628aview\u4ea4\u7ed9toast\u3002</p> <p>\u8fd9\u91cc\u7684Context\u6211\u4eec\u4f20\u5165Activity <pre><code>public static void myToast(Context context, String msg) {\n    View view = LayoutInflater.from(context).inflate(R.layout.toast_layout, null);\n    TextView tv1 = view.findViewById(R.id.tv1);\n    tv1.setText(msg);\n    Toast toast = new Toast(context);\n    toast.setGravity(Gravity.BOTTOM | Gravity.CENTER, 0, 440);\n    toast.setDuration(Toast.LENGTH_SHORT);\n    toast.setView(view);\n    toast.show();\n}\n</code></pre></p>"},{"location":"android/util/base64/use-base64/","title":"Android\u4e2d\u4f7f\u7528base64","text":"\u66f4\u65b0\u5185\u5bb9: 2023-07-10 <ul> <li>2023-07-10 \u914d\u7f6e</li> <li>2022-8-10 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u6211\u4eec\u4f7f\u7528 <code>android.util.Base64</code> \u5305</p>"},{"location":"android/util/base64/use-base64/#_1","title":"\u7f16\u7801","text":"<p><pre><code>import android.util.Base64;\n\nbyte[] byteArr; // \u8fd9\u4e2a\u662f\u8981\u7f16\u7801\u5b57\u8282\u6570\u7ec4\nBase64.encodeToString(byteArr, Base64.NO_WRAP);\n</code></pre> \u4f8b\u5982\u6211\u4eec\u628a\u4e00\u4e2a\u6587\u4ef6\u7f16\u7801\uff0c\u4f20\u5165\u7684\u662f\u6587\u4ef6\u7684\u5b57\u8282\u6570\u7ec4\u5373\u53ef\u3002\u9664\u4e86\u6587\u4ef6\u7684\u5b57\u8282\u6570\u7ec4\uff0c\u4e5f\u53ef\u4ee5\u62ff\u56fe\u7247\u4e4b\u7c7b\u7684\u3002</p> <p>\u7f16\u7801\u5f97\u5230\u4e00\u4e2aString\uff0c\u53ef\u4ee5\u653e\u5230json\u91cc\u4f20\u7ed9\u670d\u52a1\u5668\u3002</p> <p>Android\u4e0a\u4f20\u6587\u4ef6</p> <p>\u5176\u5b9e\u6587\u4ef6base64\u5f97\u5230\u5b57\u7b26\u4e32\u540e\u4e0a\u4f20\u6587\u4ef6\u7ed9\u670d\u52a1\u5668\u7684\u505a\u6cd5\u5e76\u4e0d\u5e38\u89c1\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u53c2\u8003OKHTTP\u4e2d\u4e0a\u4f20\u6587\u4ef6\u7684\u65b9\u6cd5\uff0c\u7528<code>@Multipart</code>\u6765\u89e3\u51b3\u95ee\u9898\u3002</p> <p>\u5177\u4f53\u8fd8\u662f\u5f97\u770b\u670d\u52a1\u7aef\u5982\u4f55\u63a5\u6536\u6587\u4ef6\u3002</p>"},{"location":"android/util/base64/use-base64/#_2","title":"\u89e3\u7801","text":"<p>\u4f7f\u7528<code>decode(String str, int flags)</code>\u65b9\u6cd5 <pre><code>byte[] byteArr = Base64.decode(inputStr, Base64.NO_WRAP);\n</code></pre></p>"},{"location":"android/util/base64/use-base64/#no_wrap-default","title":"NO_WRAP DEFAULT","text":"<p>DEFAULT\u6a21\u5f0f\u9047\u5230\u957f\u5ea6\u8d85\u8fc776\u7684\u5b57\u7b26\u4e32\u5c31\u4f1a\u52a0\u56de\u8f66\uff0c\u5982\u679c\u76f4\u63a5\u653e\u8fdbJSON\u4e2d\u5c31\u7834\u574f\u6389\u683c\u5f0f\u4e86\u3002\u540e\u53f0\u670d\u52a1\u4e0d\u63a5\u53d7\u3002</p> <p>\u4f8b\u5982\u6709\u6362\u884c\u7684base64\uff08\u622a\u56fe\u4ec5\u663e\u793a\u90e8\u5206\u5185\u5bb9\uff09\uff1a</p> <p></p> <p>\u53ef\u9009\u7528NO_WRAP\u6a21\u5f0f\u907f\u514d\u8fd9\u4e2a\u60c5\u51b5 <pre><code>byte[] byteArr = Base64.decode(inputStr, Base64.NO_WRAP);\n</code></pre></p>"},{"location":"android/zip/unzip-file-use-ZipFile/","title":"\u4f7f\u7528ZipFile\u8fdb\u884c\u89e3\u538b","text":"<p>\u672c\u6587\u4f7f\u7528Kotlin\u5b9e\u73b0</p> <p>Android\u4e2d\u4f7f\u7528ZipFile\u4e0e\u76f8\u5173\u7c7b\u6765\u8fdb\u884c\u6587\u4ef6\u89e3\u538b\u64cd\u4f5c\u3002</p> <ul> <li><code>java.util.zip.ZipEntry</code> \u63cf\u8ff0zip\u4e2d\u7684\u6587\u4ef6</li> <li><code>java.util.zip.ZipFile</code>  \u63cf\u8ff0zip\u6587\u4ef6</li> <li><code>java.util.zip.ZipInputStream</code> \u5305\u542bZipEntry\u4fe1\u606f</li> </ul>"},{"location":"android/zip/unzip-file-use-ZipFile/#assetszip","title":"\u89e3\u538bassets\u91cc\u7684zip","text":"<p>\u672c\u4f8b\u5904\u7406assets\u4e2d\u7684zip\u6587\u4ef6\u3002\u4f8b\u5b50\u4e2d\u89e3\u538b\u5f97\u5230\u4e00\u4efd\u7f51\u9875\u6587\u4ef6\u3002</p> <p>ZipFile\u9700\u8981\u4e00\u4e2aFile\u5bf9\u8c61\u3002\u800cassets\u4e2d\u7684\u6587\u4ef6\u4e0d\u80fd\u76f4\u63a5\u5f53\u6210File\u6765\u7528\u3002 \u7b2c\u4e00\u6b65\u6211\u4eec\u5148\u628a\u76ee\u6807zip\u590d\u5236\u4e00\u4efd\u51fa\u6765\u3002\u4ee5\u4e0b\u662f\u6267\u884c\u590d\u5236\u64cd\u4f5c\u7684\u4ee3\u7801\u3002 <pre><code>val tempFile = File(targetLocation, \"tmp-$assetsZipName.zip\")\ntry {\n    val inputStream = assets.open(assetsZipName)\n    if (tempFile.exists()) {\n        tempFile.delete()\n    }\n    tempFile.createNewFile()\n    val copyOs: OutputStream = FileOutputStream(tempFile)\n    val tmp = ByteArray(1024)\n    var len: Int\n    while (((inputStream.read(tmp)).also { len = it }) != -1) {\n        copyOs.write(tmp, 0, len)\n    }\n    copyOs.flush()\n    copyOs.close()\n    inputStream.close()\n    Log.d(TAG, \"\u4e34\u65f6\u6587\u4ef6\u590d\u5236\u5b8c\u6bd5\")\n} catch (e: Exception) {\n    Log.e(TAG, \"unzipAssetsFile: \", e)\n    return\n}\n</code></pre> \u5982\u679c\u6587\u4ef6\u5b58\u653e\u5728app\u5185\u90e8\u5b58\u50a8\u6216\u8005SD\u5361\uff0c\u5c31\u4e0d\u7528\u8fd9\u4e48\u9ebb\u70e6\u3002</p> <p>\u5f97\u5230\u4e34\u65f6zip\u540e\uff0c\u4f7f\u7528\u4e34\u65f6zip\u6765\u8fdb\u884c\u89e3\u538b\u64cd\u4f5c\u3002</p> <p>\u901a\u8fc7\u6587\u4ef6\u5f97\u5230ZipInputStream\uff0c\u5b83\u5e26\u6709\u538b\u7f29\u6587\u4ef6\u5185\u90e8\u7684\u5404\u4e2a\u6587\u4ef6\u7684\u4fe1\u606f\u3002\u7528ZipEntry\u6765\u63cf\u8ff0\u3002</p> <p>\u62ff\u5230ZipFile\u5bf9\u8c61\uff0c\u7528<code>getInputStream(entry)</code>\u65b9\u6cd5\uff0c\u5f97\u5230\u6bcf\u4e00\u4e2a\u6587\u4ef6\uff08\u76ee\u5f55\uff09\u7684\u8f93\u5165\u6d41\u3002\u7136\u540e\u7528\u6d41\u6765\u590d\u5236\u5404\u4e2a\u538b\u7f29\u7684\u6587\u4ef6\u3002 <pre><code>val zipInputStream = ZipInputStream(FileInputStream(tempFile))\nval zipFile = ZipFile(tempFile)\nvar entry: ZipEntry?\n\nwhile (zipInputStream.nextEntry.also { entry = it } != null) {\n    val outFile = File(targetLocation, entry!!.name)\n    Log.d(TAG, \"\u5f53\u524d\u6587\u4ef6: $entry -&gt; $outFile\")\n    if (outFile.parentFile != null &amp;&amp; !outFile.parentFile!!.exists()) {\n        outFile.parentFile!!.mkdir()\n    }\n\n    if (!outFile.exists()) {\n        if (entry!!.isDirectory) {\n            outFile.mkdirs()\n            continue\n        } else {\n            outFile.createNewFile()\n        }\n    }\n\n    val bis = BufferedInputStream(zipFile.getInputStream(entry))\n    val bos = BufferedOutputStream(FileOutputStream(outFile))\n    val entryTmpArr = ByteArray(1024)\n    while (true) {\n        val readLen = bis.read(entryTmpArr)\n        if (readLen == -1) {\n            break\n        }\n        bos.write(entryTmpArr, 0, readLen)\n    }\n    bos.close()\n    bis.close()\n    Log.d(TAG, \"\u89e3\u538b\u5f97\u5230\u6587\u4ef6 $outFile\")\n}\n</code></pre></p> <p>\u6574\u4e2a\u65b9\u6cd5\u4ee3\u7801\u5982\u4e0b <pre><code>/**\n * \u89e3\u538bassets\u91cc\u6307\u5b9a\u7684\u67d0\u4e2azip\n */\nprivate fun unzipAssetsFile(assetsZipName: String, targetLocation: String) {\n    Log.d(TAG, \"[unzipAssetsFile] targetLocation: $targetLocation\")\n    val targetDir = File(targetLocation)\n    if (!targetDir.exists()) {\n        targetDir.mkdirs()\n    }\n    val tempFile = File(targetLocation, \"tmp-$assetsZipName.zip\")\n    try {\n        val inputStream = assets.open(assetsZipName)\n        if (tempFile.exists()) {\n            tempFile.delete()\n        }\n        tempFile.createNewFile()\n        val copyOs: OutputStream = FileOutputStream(tempFile)\n        val tmp = ByteArray(1024)\n        var len: Int\n        while (((inputStream.read(tmp)).also { len = it }) != -1) {\n            copyOs.write(tmp, 0, len)\n        }\n        copyOs.flush()\n        copyOs.close()\n        inputStream.close()\n        Log.d(TAG, \"\u4e34\u65f6\u6587\u4ef6\u590d\u5236\u5b8c\u6bd5\")\n    } catch (e: Exception) {\n        Log.e(TAG, \"unzipAssetsFile: \", e)\n        return\n    }\n\n    val zipInputStream = ZipInputStream(FileInputStream(tempFile))\n    val zipFile = ZipFile(tempFile)\n    var entry: ZipEntry?\n\n    while (zipInputStream.nextEntry.also { entry = it } != null) {\n        val outFile = File(targetLocation, entry!!.name)\n        Log.d(TAG, \"\u5f53\u524d\u6587\u4ef6: $entry -&gt; $outFile\")\n        if (outFile.parentFile != null &amp;&amp; !outFile.parentFile!!.exists()) {\n            outFile.parentFile!!.mkdir()\n        }\n\n        if (!outFile.exists()) {\n            if (entry!!.isDirectory) {\n                outFile.mkdirs()\n                continue\n            } else {\n                outFile.createNewFile()\n            }\n        }\n\n        val bis = BufferedInputStream(zipFile.getInputStream(entry))\n        val bos = BufferedOutputStream(FileOutputStream(outFile))\n        val entryTmpArr = ByteArray(1024)\n        while (true) {\n            val readLen = bis.read(entryTmpArr)\n            if (readLen == -1) {\n                break\n            }\n            bos.write(entryTmpArr, 0, readLen)\n        }\n        bos.close()\n        bis.close()\n        Log.d(TAG, \"\u89e3\u538b\u5f97\u5230\u6587\u4ef6 $outFile\")\n    }\n    val delTmp = tempFile.delete()\n    Log.d(TAG, \"\u89e3\u538b\u5b8c\u6bd5 \u5220\u9664\u4e34\u65f6\u6587\u4ef6$delTmp\")\n}\n</code></pre></p>"},{"location":"android/zip/unzip-file-use-ZipFile/#zip","title":"\u7535\u8111\u538b\u7f29zip","text":"<p>mac\u4e0a\u5982\u679c\u5728Finder\u91cc\u8fdb\u884c\u538b\u7f29\uff0c\u53ef\u80fd\u5728\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u7cfb\u7edf\u521b\u5efa\u4e86\u4e00\u4e2a<code>__MACOS</code>\u7684\u76ee\u5f55\u3002 \u4e3a\u4e86\u907f\u514d\u8fd9\u4e2a\u76ee\u5f55\u51fa\u73b0\u3002\u6211\u4eec\u53ef\u4ee5\u7528zip\u547d\u4ee4\u6765\u538b\u7f29\u3002 <pre><code>zip -r target.zip sourceDir\n</code></pre></p> <p></p>"},{"location":"android/zip/zip-string/","title":"Android \u538b\u7f29\u5b57\u7b26\u4e32","text":"<p>Android\u7aef\u53ef\u4ee5\u5bf9\u5b57\u7b26\u4e32\u8fdb\u884c\u538b\u7f29\u3002 \u5728\u8fdb\u884c\u5927\u91cf\u7b80\u5355\u6587\u672c\u4f20\u8f93\u65f6\uff0c\u53ef\u4ee5\u5148\u538b\u7f29\u5b57\u7b26\u4e32\u518d\u53d1\u9001\u3002\u63a5\u6536\u7aef\u63a5\u6536\u540e\u518d\u89e3\u538b\u3002\u4e5f\u53ef\u4ee5\u5c06\u5b57\u7b26\u4e32\u538b\u7f29\u540e\u5b58\u5165\u6570\u636e\u5e93\u4e2d\u3002</p> <p>\u4f7f\u7528\u5230\u7684\u7c7b\u5e93</p> <ul> <li>GZIPInputStream</li> <li>GZIPOutputStream</li> </ul>"},{"location":"android/zip/zip-string/#_1","title":"\u4ee3\u7801\u793a\u4f8b","text":"<pre><code>import java.io.ByteArrayInputStream;\nimport java.io.ByteArrayOutputStream;\nimport java.io.IOException;\nimport java.util.zip.GZIPInputStream;\nimport java.util.zip.GZIPOutputStream;\n\npublic class StrZipUtil {\n\n    /**\n     * @param input \u9700\u8981\u538b\u7f29\u7684\u5b57\u7b26\u4e32\n     * @return \u538b\u7f29\u540e\u7684\u5b57\u7b26\u4e32\n     * @throws IOException IO\n     */\n    public static String compress(String input) throws IOException {\n        if (input == null || input.length() == 0) {\n            return input;\n        }\n        ByteArrayOutputStream out = new ByteArrayOutputStream();\n        GZIPOutputStream gzipOs = new GZIPOutputStream(out);\n        gzipOs.write(input.getBytes());\n        gzipOs.close();\n        return out.toString(\"ISO-8859-1\");\n    }\n\n    /**\n     * @param zippedStr \u538b\u7f29\u540e\u7684\u5b57\u7b26\u4e32\n     * @return \u89e3\u538b\u7f29\u540e\u7684\n     * @throws IOException IO\n     */\n    public static String uncompress(String zippedStr) throws IOException {\n        if (zippedStr == null || zippedStr.length() == 0) {\n            return zippedStr;\n        }\n        ByteArrayOutputStream out = new ByteArrayOutputStream();\n        ByteArrayInputStream in = new ByteArrayInputStream(zippedStr\n                .getBytes(\"ISO-8859-1\"));\n        GZIPInputStream gzipIs = new GZIPInputStream(in);\n        byte[] buffer = new byte[256];\n        int n;\n        while ((n = gzipIs.read(buffer)) &gt;= 0) {\n            out.write(buffer, 0, n);\n        }\n        // toString()\u4f7f\u7528\u5e73\u53f0\u9ed8\u8ba4\u7f16\u7801\uff0c\u4e5f\u53ef\u4ee5\u663e\u5f0f\u7684\u6307\u5b9a\u5982toString(\"GBK\")\n        return out.toString();\n    }\n}\n</code></pre> <p>\u7ea2\u7c73\u624b\u673a\u6d4b\u8bd5\u8f93\u51fa <pre><code>08-09 13:16:53.388 32248-32267/com.rustfisher.ndkproj D/rustApp: \u5f00\u59cb\u5b58\u5165\u6570\u636e\u5e93 ori1 len=304304\n08-09 13:16:53.418 32248-32267/com.rustfisher.ndkproj D/rustApp: \u5df2\u5b58\u5165\u6570\u636e\u5e93  ori1 len=304304 , \u8017\u65f6\u7ea637 ms\n08-09 13:16:53.418 32248-32267/com.rustfisher.ndkproj D/rustApp: \u5f00\u59cb\u538b\u7f29  ori1 len=304304\n08-09 13:16:53.438 32248-32267/com.rustfisher.ndkproj D/rustApp: \u538b\u7f29\u5b8c\u6bd5  zip1 len=1112 , \u8017\u65f6\u7ea619 ms\n08-09 13:16:53.438 32248-32267/com.rustfisher.ndkproj D/rustApp: \u5b58\u538b\u7f29\u540e\u7684\u6570\u636e\u8fdb\u6570\u636e\u5e93 zip1.length=1112\n08-09 13:16:53.448 32248-32267/com.rustfisher.ndkproj D/rustApp: \u538b\u7f29\u540e\u7684\u6570\u636e\u5df2\u8fdb\u6570\u636e\u5e93 zip1.length=1112 , \u8017\u65f6\u7ea68 ms\n08-09 13:16:53.448 32248-32267/com.rustfisher.ndkproj D/rustApp: \u89e3\u538b\u5f00\u59cb\n08-09 13:16:53.488 32248-32267/com.rustfisher.ndkproj D/rustApp: \u89e3\u538b\u5b8c\u6bd5 \u8017\u65f6\u7ea636 ms\n</code></pre> \u5b58\u50a8\u65f6\u95f4\u53d7\u5b58\u50a8\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u5f71\u54cd\u3002\u5b57\u7b26\u4e32\u957f\u5ea6\u4e0e\u5b58\u50a8\u8017\u65f6\u6b63\u76f8\u5173\u3002   </p> <p>\u8363\u8000\u624b\u673a\u6d4b\u8bd5 <pre><code>08-09 10:38:42.759 23075-23109/com.rustfisher D/rustApp: \u5f00\u59cb\u538b\u7f29  ori1 len=304304\n08-09 10:38:42.764 23075-23109/com.rustfisher D/rustApp: \u538b\u7f29\u5b8c\u6bd5  zip1 len=1112\n08-09 10:38:42.764 23075-23109/com.rustfisher D/rustApp: \u89e3\u538b\u5f00\u59cb\n08-09 10:38:42.789 23075-23109/com.rustfisher D/rustApp: \u89e3\u538b\u5b8c\u6bd5 \n</code></pre> \u6b64\u4f8b\u4e2d\uff0c\u8363\u8000\u538b\u7f29\u8017\u65f6\u7ea65ms\uff0c\u89e3\u538b\u8017\u65f6\u7ea625ms\u3002  </p> <p>\u53ef\u4ee5\u770b\u51fa\uff0c\u538b\u7f29\u540e\u4e0e\u539f\u957f\u5ea6\u4e4b\u6bd4 1112/304304\uff0c \u7ea60.365% \u538b\u7f29\u548c\u89e3\u538b\u7f29\u8017\u65f6\u89c6\u624b\u673a\u60c5\u51b5\u800c\u5b9a\u3002</p>"},{"location":"apollo/apollo-docker-run-dev-fat/","title":"Apollo\u591a\u73af\u5883docker\u90e8\u7f72","text":"\u66f4\u65b0\u65e5\u671f 2022-08-18 <ul> <li>2022-08-18 \u4fee\u6539\u5730\u5740\u8bf4\u660e</li> <li>2022-08-17 \u589e\u52a0\u8bf4\u660e</li> <li>2022-7-21 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883 <ul> <li>centos 7</li> <li>MySQL 5.7</li> <li>Docker 18.03.1-ce </li> <li>apollo 1.9.2</li> </ul> <p>Apollo\uff08\u963f\u6ce2\u7f57\uff09\u662f\u4e00\u6b3e\u53ef\u9760\u7684\u5206\u5e03\u5f0f\u914d\u7f6e\u7ba1\u7406\u4e2d\u5fc3\uff0c\u8bde\u751f\u4e8e\u643a\u7a0b\u6846\u67b6\u7814\u53d1\u90e8\uff0c\u80fd\u591f\u96c6\u4e2d\u5316\u7ba1\u7406\u5e94\u7528\u4e0d\u540c\u73af\u5883\u3001\u4e0d\u540c\u96c6\u7fa4\u7684\u914d\u7f6e\uff0c \u914d\u7f6e\u4fee\u6539\u540e\u80fd\u591f\u5b9e\u65f6\u63a8\u9001\u5230\u5e94\u7528\u7aef\uff0c\u5e76\u4e14\u5177\u5907\u89c4\u8303\u7684\u6743\u9650\u3001\u6d41\u7a0b\u6cbb\u7406\u7b49\u7279\u6027\uff0c\u9002\u7528\u4e8e\u5fae\u670d\u52a1\u914d\u7f6e\u7ba1\u7406\u573a\u666f\u3002</p> <p>\u670d\u52a1\u7aef\u57fa\u4e8eSpring Boot\u548cSpring Cloud\u5f00\u53d1\uff0c\u6253\u5305\u540e\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c\uff0c\u4e0d\u9700\u8981\u989d\u5916\u5b89\u88c5Tomcat\u7b49\u5e94\u7528\u5bb9\u5668\u3002</p> <p>\u6211\u4eec\u4f7f\u7528docker\u90e8\u7f72apollo\uff0c\u9700\u8981\u90e8\u7f722\u4e2a\u73af\u5883\uff1aDEV\u3001FAT\u3002\u5047\u8bbe\u90e8\u7f72\u5728\u670d\u52a1\u5668 x.x.x.1 \u4e0a\u3002</p> <p>\u6700\u540e\u90e8\u7f72\u4e865\u4e2a\u8fdb\u7a0b</p> <ul> <li>apollo-portal</li> <li>apollo-adminservice-AnRFDev-FAT</li> <li>apollo-configservice-AnRFDev-FAT</li> <li>apollo-adminservice-AnRFDev-DEV</li> <li>apollo-configservice-AnRFDev-DEV</li> </ul>"},{"location":"apollo/apollo-docker-run-dev-fat/#_1","title":"\u6570\u636e\u5e93\u51c6\u5907","text":"<p>\u5148\u628a\u57fa\u7840\u7684\u4e1c\u897f\u5f04\u597d\u3002\u8fd9\u91cc\u4f7f\u7528\u7684\u662fMySQL 5.7\uff0c\u6570\u636e\u5e93\u90e8\u7f72\u8fc7\u7a0b\u7565\u3002\u6570\u636e\u5e93\u53ef\u4ee5\u8fd0\u884c\u5728\u5176\u4ed6\u670d\u52a1\u5668\uff0c\u6216\u8005\u672c\u5730\u670d\u52a1\u5668\u3002\u8fd9\u91cc\u5047\u8bbeMySQL\u5728\u540c\u4e00\u4e2a\u670d\u52a1\u5668\u4e0a\u3002</p> <p>\u5728mysql\u91cc\u521d\u59cb\u53163\u4e2a\u6570\u636e\u5e93\u3002\u6211\u4eec\u9700\u8981\u7684\u662f1\u4e2aportal\uff0c2\u4e2aconfig\u3002</p> <p>sql\u6587\u4ef6\u53c2\u8003github\uff1a</p> <ul> <li>apolloportaldb.sql</li> <li>apolloconfigdb.sql</li> </ul> <p>\u73af\u5883\u4e0d\u540c\u7684\u8bdd\u53ef\u4ee5\u4fee\u6539\u6570\u636e\u5e93\u540d\u5b57\u3002\u628a apolloconfigdb.sql \u91cc\u9762\u7684\u6570\u636e\u5e93\u540d\u5b57\u6539\u4e3a <code>ApolloConfigDBDEV</code> \u6216\u8005 <code>ApolloConfigDBFAT</code></p> <p>\u6211\u4eec\u53ef\u4ee5\u7528workbench\u6267\u884csql\uff0c\u5f97\u52303\u4e2a\u6570\u636e\u5e93\u3002\u5206\u522b\u662f\uff1a</p> <ul> <li>ApolloConfigDBDEV</li> <li>ApolloConfigDBFAT</li> <li>ApolloPortalDB</li> </ul>"},{"location":"apollo/apollo-docker-run-dev-fat/#_2","title":"\u6570\u636e\u5e93\u914d\u7f6e","text":"<p>\u8981\u628aConfig\u6570\u636e\u5e93\u91cc\u7684<code>eureka.service.url</code>\u914d\u7f6e\u6b63\u786e\u3002\u6211\u4eec\u76f4\u63a5\u4fee\u6539\u6570\u636e\u5e93\u91cc\u7684\u503c\u3002</p> <ul> <li>DEV\u4f7f\u7528\u7aef\u53e3<ul> <li>config: 8091</li> <li>admin:  8090</li> </ul> </li> <li>FAT\u4f7f\u7528\u7aef\u53e3<ul> <li>config: 8093</li> <li>admin:  8092</li> </ul> </li> </ul>"},{"location":"apollo/apollo-docker-run-dev-fat/#dev","title":"DEV","text":"<p><code>ApolloConfigDBDEV.ServerConfg</code></p> key value eureka.service.url http://x.x.x.1:8091/eureka/"},{"location":"apollo/apollo-docker-run-dev-fat/#fat","title":"FAT","text":"<p><code>ApolloConfigDBFAT.ServerConfg</code></p> key value eureka.service.url http://x.x.x.1:8093/eureka/"},{"location":"apollo/apollo-docker-run-dev-fat/#dev_1","title":"\u90e8\u7f72 DEV \u73af\u5883","text":""},{"location":"apollo/apollo-docker-run-dev-fat/#dev-configservice","title":"DEV configservice","text":"<p>\u9996\u9009\u83b7\u53d6\u955c\u50cf <code>apollo-configservice:1.9.2</code></p> <pre><code>docker pull apolloconfig/apollo-configservice:1.9.2\n</code></pre> <p>\u542f\u52a8DEV\u73af\u5883\u7684configservice</p> <pre><code>docker run -p 8091:8080 \\\n    -e SPRING_DATASOURCE_URL=\"jdbc:mysql://x.x.x.1:3317/ApolloConfigDBDEV?characterEncoding=utf8\" \\\n    -e SPRING_DATASOURCE_USERNAME=root -e SPRING_DATASOURCE_PASSWORD=&lt;\u4f60\u7684\u6570\u636e\u5e93\u5bc6\u7801&gt; \\\n    -d -v /root/rustfisher/apollo/dev/config/logs:/opt/logs --name apollo-configservice-AnRFDev-DEV apolloconfig/apollo-configservice:1.9.2\n</code></pre>"},{"location":"apollo/apollo-docker-run-dev-fat/#home-page-url","title":"\u4fee\u6539<code>Home Page Url</code>","text":"<p>\u8fd9\u6b65\u5fc5\u987b\u505a\uff0c\u5426\u5219\u7528\u7684\u662f\u5bb9\u5668\u7684ip\uff0c\u522b\u4eba\u8fde\u4e0d\u4e0a\u3002</p> <p>\u8fdb\u5165\u5bb9\u5668\u53bb\u6539 startup.sh <pre><code>docker exec -it apollo-configservice-AnRFDev-DEV bash\n\nvi apollo-configservice/scripts/startup.sh \n</code></pre></p> <p>\u6dfb\u52a0Java\u9009\u9879<pre><code>export JAVA_OPTS=\"$JAVA_OPTS -Deureka.instance.homePageUrl=http://x.x.x.1:8091\"\n</code></pre> \u7aef\u53e3\u8981\u5bf9\u5e94docker\u6620\u5c04\u51fa\u53bb\u7684\u3002</p> <p>\u4fdd\u5b58\u811a\u672c\u540e\uff0c\u9000\u51fa\u5bb9\u5668\u3002\u7136\u540e\u91cd\u542f\u5bb9\u5668\u3002</p>"},{"location":"apollo/apollo-docker-run-dev-fat/#dev-adminservice","title":"DEV adminservice","text":"<p>\u83b7\u53d6docker\u955c\u50cf <code>apollo-adminservice:1.9.2</code> <pre><code>docker pull apolloconfig/apollo-adminservice:1.9.2\n</code></pre></p> \u542f\u52a8adminservice<pre><code>docker run -p 8090:8090 \\\n    -e SPRING_DATASOURCE_URL=\"jdbc:mysql://x.x.x.1:3317/ApolloConfigDBDEV?characterEncoding=utf8\" \\\n    -e SPRING_DATASOURCE_USERNAME=root -e SPRING_DATASOURCE_PASSWORD=&lt;\u4f60\u7684\u6570\u636e\u5e93\u5bc6\u7801&gt; \\\n    -d -v /root/rustfisher/apollo/dev/config/admin/logs:/opt/logs --name apollo-adminservice-AnRFDev-DEV apolloconfig/apollo-adminservice:1.9.2\n</code></pre>"},{"location":"apollo/apollo-docker-run-dev-fat/#home-page-url_1","title":"\u4fee\u6539 Home Page Url","text":"<p>\u548c\u4e0a\u9762\u7684\u7c7b\u4f3c\uff0c\u8fdb\u5165\u5bb9\u5668\u53bb\u4fee\u6539\u542f\u52a8\u811a\u672c startup.sh</p> <pre><code>docker exec -it apollo-adminservice-AnRFDev-DEV bash\n\nvi apollo-adminservice/scripts/startup.sh\n</code></pre> \u6dfb\u52a0\u7684\u914d\u7f6e<pre><code>export JAVA_OPTS=\"$JAVA_OPTS -Deureka.instance.homePageUrl=http://x.x.x.1:8090\"\n</code></pre> <p>\u4fdd\u5b58\u811a\u672c\u540e\uff0c\u9000\u51fa\u5bb9\u5668\u3002\u7136\u540e\u91cd\u542f\u5bb9\u5668\u3002</p>"},{"location":"apollo/apollo-docker-run-dev-fat/#fat_1","title":"\u90e8\u7f72 FAT \u73af\u5883","text":"<p>\u65b9\u6cd5\u4e0e\u4e0a\u9762DEV\u7684\u7c7b\u4f3c\uff0c\u4f46\u662f\u8981\u4fee\u6539\u5bf9\u5e94\u7aef\u53e3\u548c\u8def\u5f84\u3002</p>"},{"location":"apollo/apollo-docker-run-dev-fat/#portal","title":"\u90e8\u7f72portal","text":"<p>\u6211\u4eec\u524d\u9762\u5148\u628aconfig\u548cadmin\u670d\u52a1\u90e8\u7f72\u597d\u3002\u6700\u540e\u6765\u90e8\u7f72portal\u670d\u52a1\u3002</p> <p>\u83b7\u53d6<code>apollo-portal:1.9.2</code> <pre><code>docker pull apolloconfig/apollo-portal:1.9.2\n</code></pre></p> \u90e8\u7f72portal<pre><code>docker run -p 8070:8070 \\\n    -e SPRING_DATASOURCE_URL=\"jdbc:mysql://x.x.x.1:3317/ApolloPortalDB?characterEncoding=utf8\" \\\n    -e SPRING_DATASOURCE_USERNAME=root -e SPRING_DATASOURCE_PASSWORD=&lt;\u4f60\u7684\u6570\u636e\u5e93\u5bc6\u7801&gt; \\\n    -e APOLLO_PORTAL_ENVS=dev,fat \\\n    -e DEV_META=http://x.x.x.1:8091 -e FAT_META=http://x.x.x.1:8093 \\\n    -d -v /root/rustfisher/apollo/portal/logs:/opt/logs --name apollo-portal apolloconfig/apollo-portal:1.9.2\n</code></pre> <p>\u90e8\u7f72OK\u540e\uff0c\u6253\u5f00\u6d4f\u89c8\u5668\u67e5\u770b portal: http://x.x.x.1:8070/</p> <p>\u9ed8\u8ba4\u8d26\u53f7 apollo/admin</p>"},{"location":"apollo/apollo-docker-run-dev-fat/#_3","title":"\u7aef\u53e3\u5f00\u653e","text":"<p>\u67d0\u4e9b\u4e91\u670d\u52a1\u5668\u4f1a\u8bbe\u7f6e\u6709\u5b89\u5168\u7ec4\uff0c\u9700\u8981\u53bb\u63a7\u5236\u53f0\u4fee\u6539\u5b89\u5168\u7ec4\u89c4\u5219\uff0c\u5141\u8bb8\u4e00\u4e0b\u6211\u4eec\u7528\u5230\u7684\u7aef\u53e3\u3002</p> <p>\u540c\u65f6\u8fd8\u9700\u8981\u68c0\u67e5\u670d\u52a1\u5668\u4e0a\u7684\u9632\u706b\u5899\uff0cufw\u6216\u8005\u662ffirewall</p>"},{"location":"apollo/apollo-docker-run-dev-fat/#firewall","title":"firewall\u7b80\u5355\u4f7f\u7528","text":"<p>\u6dfb\u52a0\u5141\u8bb8\u7684\u7aef\u53e3 <pre><code>firewall-cmd --zone=public --add-port=22/tcp --permanent\n</code></pre> \u5176\u4e2d\u2013permanent\u7684\u4f5c\u7528\u662f\u4f7f\u8bbe\u7f6e\u6c38\u4e45\u751f\u6548\uff0c\u4e0d\u52a0\u7684\u8bdd\u673a\u5668\u91cd\u542f\u4e4b\u540e\u5931\u6548</p> <p>\u91cd\u65b0\u8f7d\u5165\u4e00\u4e0b\u9632\u706b\u5899\u8bbe\u7f6e\uff0c\u4f7f\u8bbe\u7f6e\u7acb\u5373\u751f\u6548\uff0c\u6267\u884c\u4e0b\u547d\u4ee4\uff0c\u8bbe\u7f6e\u624d\u4f1a\u751f\u6548 <pre><code>firewall-cmd --reload\n</code></pre></p> <p>\u53ef\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u67e5\u770b\u662f\u5426\u751f\u6548 <pre><code>firewall-cmd --zone=public --query-port=22/tcp\n</code></pre></p> <p>\u5982\u4e0b\u547d\u4ee4\u53ef\u67e5\u770b\u5f53\u524d\u7cfb\u7edf\u6253\u5f00\u7684\u6240\u6709\u7aef\u53e3 <pre><code>firewall-cmd --zone=public --list-ports\n</code></pre></p>"},{"location":"apollo/apollo-docker-run-dev-fat/#_4","title":"\u9ed8\u8ba4\u5bc6\u7801","text":"<p>\u90e8\u7f72\u6210\u529f\u540e\uff0c\u5230portal\u7684\u9875\u9762\uff0c\u6539\u6389\u9ed8\u8ba4\u7684\u5bc6\u7801</p> <p>\u7ba1\u7406\u5458\u5de5\u5177 - \u7528\u6237\u7ba1\u7406</p>"},{"location":"apollo/apollo-docker-run-dev-fat/#_5","title":"\u4fee\u6539\u542f\u52a8\u914d\u7f6e","text":"<p>docker\u542f\u52a8\u955c\u50cf\u540e\uff0c\u60f3\u8981\u4fee\u6539\u542f\u52a8\u914d\u7f6e\u6bd4\u8f83\u9ebb\u70e6\u3002\u6211\u4eec\u53ef\u4ee5\u4eceApollo\u7684\u542f\u52a8\u811a\u672c\u5165\u624b\u3002</p>"},{"location":"apollo/apollo-docker-run-dev-fat/#_6","title":"\u4fee\u6539\u6570\u636e\u5e93\u5bc6\u7801","text":"<p>\u5047\u8bbeApollo\u7528\u7684\u6570\u636e\u5e93\u5bc6\u7801\u4fee\u6539\u4e86\uff0c\u800c\u6211\u4eec\u524d\u9762\u7528\u7684\u662f-e\u53c2\u6570\u586b\u7684\u5bc6\u7801\u3002</p> <p>\u53ef\u4ee5\u8fdb\u5bb9\u5668\u91cc\uff0c\u4fee\u6539\u542f\u52a8\u914d\u7f6escripts/startup.sh\uff0c\u5728\u539f\u6765\u7684\u8bbe\u7f6e\u5bc6\u7801\u4e0b\u6dfb\u52a0\u6211\u4eec\u7684\u914d\u7f6e</p> <pre><code>export SPRING_DATASOURCE_PASSWORD=\"\u65b0\u7684\u5bc6\u7801\"\n</code></pre>"},{"location":"apollo/apollo-docker-run-dev-fat/#dev_2","title":"\u4fee\u6539DEV\u73af\u5883\u5730\u5740","text":"<p>\u5047\u8bbe\u8981\u4fee\u6539DEV\u7684\u5730\u5740</p> <p>\u4e00\u65b9\u9762\u8981\u53bb\u6570\u636e\u5e93\u91cc\u4fee\u6539 <code>ApolloConfigDBDEV.ServerConfg</code> \uff0c\u6539\u6210\u65b0\u7684\u5730\u5740</p> <p>\u7136\u540e\u8fdb\u5165portal\u5bb9\u5668\u91cc\uff0c\u7ed9 <code>apollo-portal/scripts/startup.sh</code> \u589e\u52a0\u53c2\u6570 <pre><code>export DEV_META=\"http://&lt;\u65b0\u7684\u5730\u5740&gt;:&lt;\u7aef\u53e3&gt;\"\n</code></pre></p> <p>FAT\u73af\u5883\u540c\u7406</p>"},{"location":"apollo/apollo-docker-run-dev-fat/#_7","title":"\u53c2\u8003","text":"<ul> <li>apollo\u90e8\u7f72\u6b65\u9aa4</li> </ul>"},{"location":"apollo/apollo-docker-run-dev-fat/#_8","title":"\u6269\u5c55\u9605\u8bfb","text":"<ul> <li>Redis docker \u4e3b\u4ece\u6a21\u5f0f\u4e0e\u54e8\u5175sentinel</li> <li>\u5e38\u89c1\u7684nginx\u914d\u7f6e\uff0c\u670d\u52a1\u914d\u7f6e\uff0c\u8d1f\u8f7d\u5747\u8861\uff0cssl</li> <li>netstat\u67e5\u770b\u7f51\u7edc\u72b6\u6001</li> </ul>"},{"location":"cocos/creator/ccc-drag-anywhere/","title":"Cocos Creator \u62d6\u52a8\u6548\u679c","text":"\u66f4\u65b0\u65e5\u671f\uff1a2020-12-28 <ul> <li>\u521b\u5efa\u6587\u6863\uff1a2020-12-28</li> </ul> <p>\u6211\u4eec\u8981\u5b9e\u73b0\u7684\u6548\u679c\u662f\uff0c\u6309\u4f4f\u5e76\u62d6\u52a8\u4e00\u4e2a\u5c0f\u7269\u4f53\uff0c\u7269\u4f53\u8ddf\u968f\u624b\u6307\uff08\u9f20\u6807\uff09\u79fb\u52a8\u3002</p> <p>\u4ee3\u7801DragToAnywhere.ts <pre><code>@ccclass\nexport default class DragToAnywhere extends cc.Component {\n\n    @property(cc.Label)\n    label: cc.Label = null;\n\n    start () {\n\n    }\n\n    onEnable() {\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this._onTouchEnd, this);\n    }\n\n    onDisable() {\n        this.node.off(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this);\n        this.node.off(cc.Node.EventType.TOUCH_END, this._onTouchEnd, this);\n    }\n\n    // update (dt) {}\n\n    _onTouchMove(touchEvent) {\n        let location = touchEvent.getLocation();\n        this.node.position = this.node.parent.convertToNodeSpaceAR(location); // \u786e\u5b9a\u4f4d\u7f6e\n    }\n\n    _onTouchEnd(touchEvent) {\n        // \u653e\u4e0b\n    }\n}\n</code></pre></p> <p>\u628aDragToAnywhere.ts\u6302\u5728\u9884\u5236\u4f53\u4e0a\u3002\u5728\u573a\u666f\u4e2d\u521b\u5efa\u9884\u5236\u4f53\u5bf9\u8c61\u3002 <pre><code>let node1 = cc.instantiate(this.drag_item);\nthis.node.addChild(node1);\nnode1.x = 100;\nnode1.y = 100;\nnode1.getComponent(DragToAnywhere).label.string = '\u6c34\u661f';\n</code></pre></p> <p></p>","tags":["Cocos Creator"]},{"location":"cocos/creator/ccc-drag-to-target/","title":"Cocos Creator \u62d6\u52a8\u53bb\u6307\u5b9a\u533a\u57df","text":"\u66f4\u65b0\u65e5\u671f\uff1a2020-12-30 <ul> <li>\u521b\u5efa\u6587\u6863\uff1a2020-12-30</li> </ul> <p>\u6211\u4eec\u8981\u5b9e\u73b0\u7684\u6548\u679c\u662f\uff0c\u6309\u4f4f\u5e76\u62d6\u52a8\u4e00\u4e2a\u5c0f\u7269\u4f53\uff0c\u7269\u4f53\u8ddf\u968f\u624b\u6307\uff08\u9f20\u6807\uff09\u79fb\u52a8\u3002 \u62d6\u5230\u6307\u5b9a\u4f4d\u7f6e\u653e\u4e0b\u3002\u5982\u679c\u6ca1\u6709\u5230\u6307\u5b9a\u4f4d\u7f6e\uff0c\u5219\u56de\u5230\u4e0a\u4e00\u4e2a\u4f4d\u7f6e\u3002</p> <p>\u65b0\u5efa\u811a\u672cDragToTarget.ts\uff0c\u6302\u5230\u9884\u5236\u4f53\u4e0a\u3002 <pre><code>const { ccclass, property } = cc._decorator;\n@ccclass\nexport default class DragToTarget extends cc.Component {\n\n    @property(cc.Label)\n    nameLabel: cc.Label = null;\n\n    @property(cc.Node)\n    targetOfDragList: cc.Node[] = [];\n\n    _oldPos = null; // \u4e0a\u4e00\u4e2a\u4f4d\u7f6e\n\n    start() {\n        this._oldPos = this.node.position;\n    }\n\n    onEnable() {\n        this.node.on(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this);\n        this.node.on(cc.Node.EventType.TOUCH_END, this._onTouchEnd, this);\n    }\n\n    onDisable() {\n        this.node.off(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this);\n        this.node.off(cc.Node.EventType.TOUCH_END, this._onTouchEnd, this);\n    }\n\n    // update (dt) {}\n\n    _onTouchMove(touchEvent) {\n        let location = touchEvent.getLocation();\n        this.node.position = this.node.parent.convertToNodeSpaceAR(location); // \u786e\u5b9a\u4f4d\u7f6e\n    }\n\n    _onTouchEnd(touchEvent) {\n        if (this.targetOfDragList.length === 0) {\n            return; // \u6ca1\u6709\u76ee\u6807\u4f4d\u7f6e\n        }\n        let inTarget = false;\n        for (const targetNode of this.targetOfDragList) {\n            if (this._withinTarget(targetNode, touchEvent)) {\n                inTarget = true;\n                break;\n            }\n        }\n        if (!inTarget) {\n            this.node.position = this._oldPos; // \u56de\u53bb\n        }\n    }\n\n    // \u5224\u65ad\u89e6\u6478\u4e8b\u4ef6\u662f\u5426\u5728\u69fd\u4f4d\u91cc\n    _withinTarget(targetNode: cc.Node, touchEvent) {\n        let rect = targetNode.getBoundingBox();\n        let location = touchEvent.getLocation();\n        let point = targetNode.parent.convertToNodeSpaceAR(location);\n        return rect.contains(point);\n    }\n}\n</code></pre> \u601d\u8def\u4e0e\u4e4b\u524d\u7684\u62d6\u52a8\u7c7b\u4f3c\u3002 \u5728\u6700\u540e<code>TOUCH_END</code>\u7684\u65f6\u5019\uff0c\u5224\u65ad\u81ea\u5df1\u662f\u5426\u5728\u76ee\u6807\u533a\u57df\u5185\u3002 \u5982\u679c\u4e0d\u5728\u5219\u8fd4\u56de\u4e0a\u4e00\u4e2a\u5750\u6807\u3002</p> <p>\u5728\u573a\u666f\u4e2d\u4f7f\u7528 <pre><code>import DragToTarget from \"./DragToTarget\";\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class DragToControl extends cc.Component {\n\n    @property(cc.Prefab)\n    drag_to_item: cc.Prefab = null;\n\n    @property(cc.Node)\n    dragTargets: cc.Node[] = [];\n\n    itemNum = 1;\n\n    start() {\n        this.createItem();\n    }\n\n    // update (dt) {}\n\n    createItem() {\n        let d = cc.instantiate(this.drag_to_item);\n        this.node.addChild(d);\n        let dragTo = d.getComponent(DragToTarget);\n        dragTo.targetOfDragList = this.dragTargets; // \u8bbe\u7f6e\u76ee\u7684\u5730\n        dragTo.nameLabel.string = '' + this.itemNum++;\n    }\n}\n</code></pre></p> <p></p>","tags":["Cocos Creator"]},{"location":"cocos/creator/ccc-postion-and-cvt/","title":"Cocos Creator \u5750\u6807\u4e0e\u8f6c\u6362","text":"\u66f4\u65b0\u65e5\u671f\uff1a2020-12-29 <ul> <li>\u521b\u5efa\u6587\u6863\uff1a2020-12-29</li> </ul> <p>ccc\u7684\u5750\u6807\u7cfb</p> <p>ccc\u63d0\u4f9b\u4e86api\uff0c\u5728\u4e16\u754c\u5750\u6807\u548c\u672c\u5730\u5750\u6807\u4e4b\u95f4\u53ef\u4ee5\u76f8\u4e92\u8f6c\u6362\u3002</p> <pre><code>let postion = node.position; // postion\u662f\u5728\u7236\u8282\u70b9\u4e2d\u7684\u5750\u6807\ncc.log(name, 'position (', postion.x.toFixed(2), ',', postion.y.toFixed(2), ')');\n\nlet worldPos = node.parent.convertToWorldSpaceAR(node.position); // \u4e16\u754c\u5750\u6807\ncc.log(name, '\u4e16\u754c\u5750\u6807(', worldPos.x.toFixed(2), ',', worldPos.y.toFixed(2), ')');\n</code></pre> <p><code>node.position</code>\u662f\u672c\u5730\u5750\u6807\uff0c\u4e5f\u5c31\u662f\u5728\u7236\u8282\u70b9\u4e2d\u7684\u5750\u6807\u3002 \u8ba9\u7236\u8282\u70b9\u8c03\u7528<code>convertToWorldSpaceAR</code>\u65b9\u6cd5\uff0c\u628a\u8282\u70b9\u7684\u672c\u5730\u5750\u6807\u8f6c\u6362\u4e3a\u4e16\u754c\u5750\u6807\u3002</p> <p></p> <ul> <li><code>p</code>\u662f\u672c\u5730\u5750\u6807</li> <li><code>w</code>\u662f\u4e16\u754c\u5750\u6807</li> </ul> <p>\u4ee3\u7801\u53c2\u8003CCCTry</p>","tags":["Cocos Creator"]},{"location":"cocos/creator/ccc-touch-event/","title":"Cocos Creator \u89e6\u6478\u4e8b\u4ef6\u7a7f\u900f","text":"\u66f4\u65b0\u65e5\u671f\uff1a2020-12-26 <ul> <li>\u521b\u5efa\u6587\u6863\uff1a2020-12-26</li> </ul>","tags":["Cocos Creator"]},{"location":"cocos/creator/ccc-touch-event/#_1","title":"\u89e6\u6478\u4e8b\u4ef6","text":"<p>\u5047\u8bbe\u7ed9\u6574\u4e2aCanvas\u6dfb\u52a0\u4e86\u4e8b\u4ef6\u76d1\u542c\u3002\u7528\u7f51\u9875\u6a21\u62df\u65f6\uff0c\u9f20\u6807\u79fb\u52a8\uff0c\u70b9\u51fb\u5b50node\u90fd\u4f1a\u76d1\u542c\u5230\u3002 <pre><code>    start() {\n        this._cfgTouchField();\n    }\n\n    _onTouchFieldDown(e) {\n        cc.log('table', '_onTouchFieldDown');\n    }\n\n    _onTouchFieldMove(e) {\n        cc.log('table', '_onTouchFieldMove');\n    }\n\n    _onTouchFieldEnd(e) {\n        cc.log('table', '_onTouchFieldEnd');\n    }\n\n    _cfgTouchField() {\n        this.node.on(cc.Node.EventType.MOUSE_DOWN, this._onTouchFieldDown, this);\n        this.node.on(cc.Node.EventType.MOUSE_MOVE, this._onTouchFieldMove, this);\n        this.node.on(cc.Node.EventType.MOUSE_LEAVE, this._onTouchFieldEnd, this);\n        this.node.on(cc.Node.EventType.MOUSE_UP, this._onTouchFieldEnd, this);\n    }\n</code></pre></p> <p>\u7f51\u9875\u6a21\u62df\uff0c\u9f20\u6807\u4ece\u7a7a\u767d\u5730\u65b9\u79fb\u5165Toggle\u7684\u8303\u56f4\u65f6\uff0c\u4f1a\u89e6\u53d1\u4e00\u6b21<code>cc.Node.EventType.MOUSE_LEAVE</code>\uff1b \u7136\u540e\u53c8\u662f<code>cc.Node.EventType.MOUSE_MOVE</code></p>","tags":["Cocos Creator"]},{"location":"cocos/creator/g/dev-2d-game/","title":"\u5f00\u53d1\u8bb0\u5f55","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-2-7 <ul> <li>2022-2-7\uff1a\u79fb\u52a8\u76f8\u673a\uff0c\u52a8\u753b\u6548\u679c</li> <li>2022-2-3\uff1a\u521b\u5efa\u6587\u6863</li> </ul> <p>\u5f00\u53d1\u4e2d\u7684\u4e00\u4e2a2D\u793a\u4f8b</p>"},{"location":"cocos/creator/g/dev-2d-game/#ccrigidbody2d","title":"\u91cd\u529b <code>cc.RigidBody2D</code>","text":"<p><code>cc.RigidBody2D</code> \u53d7\u91cd\u529b\u5f71\u54cd</p> <p>Type\u8bbe\u7f6e\u6210Dynamic\uff0c\u4f1a\u53d7\u91cd\u529b\u843d\u4e0b\u3002\u8bbe\u7f6e\u6210Static\u5219\u4e0d\u4f1a\u843d\u4e0b\u3002</p>"},{"location":"cocos/creator/g/dev-2d-game/#ccpolygoncollider2d","title":"\u78b0\u649e <code>cc.PolygonCollider2D</code>","text":"<p>\u52a0\u4e0a\u8fd9\u4e2a\u7ec4\u4ef6\u540e\uff0c\u53ef\u4ee5\u9009\u62e9Editing\u7f16\u8f91\u78b0\u649e\u8fb9\u754c\u3002</p>"},{"location":"cocos/creator/g/dev-2d-game/#_2","title":"\u5de6\u53f3\u79fb\u52a8\u811a\u672c","text":"<p>\u63a7\u5236\u8282\u70b9\u5de6\u53f3\u79fb\u52a8\uff0c\u76d1\u542c\u952e\u76d8\u6309\u952e\u4e8b\u4ef6</p> <pre><code>import { _decorator, Component, Node, input, Input, EventTouch, EventKeyboard, KeyCode, Vec3 } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('Player')\nexport class Player extends Component {\n\n    private curPos: Vec3 = new Vec3();\n\n    horSpeed = 0; // \u5de6\u53f3\u79fb\u52a8\u901f\u5ea6\n\n    onLoad() {\n        input.on(Input.EventType.KEY_DOWN, this.onKeyDown, this);\n        input.on(Input.EventType.KEY_UP, this.onKeyUp, this);\n    }\n\n    start() {\n    }\n\n    update(deltaTime: number) {\n        this.node.getPosition(this.curPos);\n        this.curPos.x = this.horSpeed * deltaTime + this.curPos.x;\n        this.node.setPosition(this.curPos);\n    }\n\n\n    onDestroy() {\n        input.off(Input.EventType.KEY_DOWN, this.onKeyDown, this);\n        input.off(Input.EventType.KEY_UP, this.onKeyUp, this);\n    }\n\n    onKeyDown(event: EventKeyboard) {\n        switch (event.keyCode) {\n            case KeyCode.KEY_A:\n                this.horSpeed = -100;\n                break;\n            case KeyCode.KEY_D:\n                this.horSpeed = 100;\n                break;\n        }\n    }\n\n    onKeyUp(event: EventKeyboard) {\n        switch (event.keyCode) {\n            case KeyCode.KEY_A:\n                if (this.horSpeed &lt; 0) {\n                    this.horSpeed = 0;\n                }\n                break;\n            case KeyCode.KEY_D:\n                if (this.horSpeed &gt; 0) {\n                    this.horSpeed = 0;\n                }\n                break;\n        }\n    }\n}\n</code></pre>"},{"location":"cocos/creator/g/dev-2d-game/#_3","title":"\u52a8\u753b","text":"<p>\u51c6\u5907\u51e0\u5f20\u56fe\u7247\uff0c\u9009\u5b9a\u4e00\u4e2a\u8282\u70b9\uff08\u6216\u8005\u9884\u5236\u4f53\uff09\uff0c\u5236\u4f5c\u52a8\u753b\u6548\u679c</p> <p>\u70b9\u51fb\u9762\u677f\u7684\u300c\u52a8\u753b\u7f16\u8f91\u5668\u300d</p> <p>\u52a8\u753b\u6587\u4ef6\u4e00\u822c\u662f<code>.anim</code>\u7ed3\u5c3e</p> <p>\u52a8\u753b\u6302\u8f7d\u5728\u8282\u70b9\u4e0a\uff0c\u591a\u4e2a\u52a8\u753b\uff0c\u9700\u8981\u8bbe\u7f6eclip\u6570\u91cf</p> <p>\u52a0\u8f7d\u4f7f\u7528\u52a8\u753b\u6548\u679c\uff0c\u4f1a\u7528\u5230AnimationComponent</p> <pre><code>import { _decorator, Component, AnimationComponent } from 'cc';\n\nvar animCom = this.getComponent(AnimationComponent);\nanimCom.play('cowRight'); // \u52a8\u753b\u7684\u540d\u5b57\n</code></pre> <p>\u505c\u6b62\u52a8\u753b\uff0c\u4f1a\u505c\u5728\u5f53\u524d\u64ad\u653e\u90a3\u4e00\u5e27 <pre><code>import { _decorator, Component, AnimationComponent } from 'cc';\n\nvar animCom = this.getComponent(AnimationComponent); // \u5047\u8bbe\u662f\u5f53\u524d\u8282\u70b9\nanimCom.stop();\n</code></pre></p>"},{"location":"cocos/creator/g/dev-2d-game/#tiledmap","title":"TiledMap","text":"<p>Tiled\u5b98\u7f51</p> <p>Cocos Creator \u914d\u5408Tiled\u5730\u56fe\u7684\u4f7f\u7528 - cnblog</p> <p>tmx\uff0c\u56fe\u7247\u6587\u4ef6\uff0ctsx\uff0c\u90fd\u653e\u5728\u4e00\u4e2a\u76ee\u5f55\u4e0b\u3002\u8fd9\u6837\u6bd4\u8f83\u7b80\u5355\u3002</p>"},{"location":"cocos/creator/g/dev-2d-game/#_4","title":"\u76f8\u673a","text":"<p>\u8bbe\u7f6e\u76f8\u673a\u7684\u8303\u56f4</p> <p>Canvas AlignCanvasWithScreen \u53d6\u6d88</p> <p>Camera OrthoHeight \u8bbe\u7f6e\u6570\u503c\u5c0f\u4e00\u70b9\uff0c\u8ba9\u9ed8\u8ba4\u76f8\u673a\u8303\u56f4\u4e0d\u80fd\u8986\u76d6\u6574\u4e2acanvas</p> <p>\u79fb\u52a8\u76f8\u673a <pre><code>private mCameraPos = new Vec3();\n// --- \nconst xGap = 70; // \u4ee5\u540e\u8fd9\u4e2a\u518d\u6539\u6210\u52a8\u6001\u8ba1\u7b97\nconst yGap = 60;\nconst self = this;\nthis.node.on(Input.EventType.TOUCH_START, function (event) {\n    self.mainCamera.node.getPosition(self.mCameraPos); // \u8bb0\u5f55\u5f53\u524d\u76f8\u673a\u4f4d\u7f6e\n}.bind(this));\nthis.node.on(Input.EventType.TOUCH_MOVE, function (event) {\n    self.mCameraPos.x -= event.getDeltaX();\n    self.mCameraPos.y -= event.getDeltaY();\n    // \u9650\u5236\u76f8\u673a\u79fb\u52a8\u8303\u56f4\n    self.mCameraPos.x = Math.max(-xGap, self.mCameraPos.x);\n    self.mCameraPos.x = Math.min(xGap, self.mCameraPos.x);\n\n    self.mCameraPos.y = Math.max(-yGap, self.mCameraPos.y);\n    self.mCameraPos.y = Math.min(yGap, self.mCameraPos.y);\n\n    self.mainCamera.node.setPosition(self.mCameraPos);\n}.bind(this));\n</code></pre></p>"},{"location":"db/note-mongodb-mysql/","title":"MongoDB\u548cMySQL\u7684\u5bf9\u6bd4","text":"\u66f4\u65b0\u65e5\u671f: 2023-3-17 <ul> <li>2023-3-17 \u521b\u5efa\u6587\u6863</li> </ul> <p>MongoDB\u548cMySQL\u90fd\u662f\u6d41\u884c\u7684\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u5b83\u4eec\u5404\u6709\u4f18\u7f3a\u70b9\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u53ef\u80fd\u7684\u6bd4\u8f83\uff1a</p>","tags":["MySQL","MongoDB"]},{"location":"db/note-mongodb-mysql/#mongodb","title":"MongoDB\u7684\u4f18\u70b9","text":"<ul> <li>\u7075\u6d3b\u6027\uff1aMongoDB\u662f\u6587\u6863\u6570\u636e\u5e93\uff0c\u4e0d\u9700\u8981\u9884\u5b9a\u4e49\u6a21\u5f0f\uff0c\u53ef\u4ee5\u5feb\u901f\u9002\u5e94\u4e0d\u65ad\u53d8\u5316\u7684\u6570\u636e\u9700\u6c42\u3002</li> <li>\u6269\u5c55\u6027\uff1aMongoDB\u53ef\u4ee5\u5728\u591a\u4e2a\u670d\u52a1\u5668\u4e0a\u6c34\u5e73\u6269\u5c55\uff0c\u5e76\u652f\u6301\u81ea\u52a8\u5206\u7247\uff0c\u53ef\u4ee5\u8f7b\u677e\u5904\u7406\u5927\u578b\u6570\u636e\u96c6\u5408\u3002</li> <li>\u6027\u80fd\uff1a\u7531\u4e8e\u5176\u67b6\u6784\u548c\u5b58\u50a8\u5f15\u64ce\u7684\u8bbe\u8ba1\uff0cMongoDB\u901a\u5e38\u53ef\u4ee5\u63d0\u4f9b\u66f4\u5feb\u7684\u8bfb\u5199\u548c\u67e5\u8be2\u6027\u80fd\u3002</li> <li>\u5927\u6570\u636e\uff1aMongoDB\u62e5\u6709\u5185\u7f6e\u7684MapReduce\u548c\u805a\u5408\u529f\u80fd\uff0c\u4f7f\u5f97\u5bf9\u5927\u91cf\u6570\u636e\u8fdb\u884c\u7edf\u8ba1\u548c\u8ba1\u7b97\u66f4\u52a0\u5bb9\u6613\u3002</li> </ul>","tags":["MySQL","MongoDB"]},{"location":"db/note-mongodb-mysql/#mongodb_1","title":"MongoDB\u7684\u7f3a\u70b9","text":"<ul> <li>\u4e8b\u52a1\u6027\uff1aMongoDB\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u4e0d\u652f\u6301\u4e8b\u52a1\uff0c\u56e0\u6b64\u4e0d\u9002\u7528\u4e8e\u5177\u6709\u5f3a\u4e00\u81f4\u6027\u8981\u6c42\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</li> <li>\u5b58\u50a8\u7a7a\u95f4\uff1aMongoDB\u4f7f\u7528\u7684\u6587\u6863\u683c\u5f0f\u53ef\u80fd\u4f1a\u5728\u5b58\u50a8\u5927\u91cf\u76f8\u4f3c\u6570\u636e\u65f6\u5bfc\u81f4\u91cd\u590d\u4fe1\u606f\uff0c\u4ece\u800c\u6d6a\u8d39\u5b58\u50a8\u7a7a\u95f4\u3002</li> <li>\u7ecf\u9a8c\u8981\u6c42\uff1aMongoDB\u7684\u4f7f\u7528\u65b9\u5f0f\u548c\u5f00\u53d1\u6280\u5de7\u4e0e\u4f20\u7edf\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e0d\u540c\uff0c\u9700\u8981\u7279\u5b9a\u7684\u77e5\u8bc6\u548c\u6280\u80fd\u3002</li> </ul>","tags":["MySQL","MongoDB"]},{"location":"db/note-mongodb-mysql/#mysql","title":"MySQL\u7684\u4f18\u70b9","text":"<ul> <li>\u53ef\u9760\u6027\uff1aMySQL\u662f\u6210\u719f\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93\u7ba1\u7406\u7cfb\u7edf\uff0c\u5177\u6709\u5e7f\u6cdb\u7684\u5e94\u7528\u573a\u666f\uff0c\u5e76\u4eab\u6709\u826f\u597d\u7684\u58f0\u8a89\u3002</li> <li>\u4e8b\u52a1\u6027\uff1aMySQL\u652f\u6301ACID\u4e8b\u52a1\uff0c\u53ef\u4ee5\u786e\u4fdd\u6570\u636e\u7684\u4e00\u81f4\u6027\u548c\u5b8c\u6574\u6027\u3002</li> <li>\u652f\u6301SQL\uff1aMySQL\u4f7f\u7528\u6807\u51c6\u7684SQL\u8bed\u8a00\uff0c\u6613\u4e8e\u5b66\u4e60\u548c\u4f7f\u7528\u3002</li> <li>\u793e\u533a\u652f\u6301\uff1aMySQL\u5177\u6709\u5e9e\u5927\u7684\u7528\u6237\u793e\u533a\u548c\u751f\u6001\u7cfb\u7edf\uff0c\u53ef\u83b7\u5f97\u5927\u91cf\u7684\u5e2e\u52a9\u548c\u8d44\u6e90\u3002</li> </ul>","tags":["MySQL","MongoDB"]},{"location":"db/note-mongodb-mysql/#mysql_1","title":"MySQL\u7684\u7f3a\u70b9","text":"<ul> <li>\u7f29\u653e\u6027\uff1aMySQL\u5728\u5904\u7406\u5927\u91cf\u6570\u636e\u65f6\u9700\u8981\u66f4\u591a\u7684\u786c\u4ef6\u8d44\u6e90\uff0c\u5e76\u4e14\u53ef\u80fd\u9700\u8981\u66f4\u590d\u6742\u7684\u67b6\u6784\u6765\u7ef4\u62a4\u6027\u80fd\u3002</li> <li>\u786c\u4ef6\u8981\u6c42\uff1aMySQL\u53ef\u80fd\u9700\u8981\u66f4\u9ad8\u7ea7\u522b\u7684\u786c\u4ef6\u6765\u652f\u6301\u5927\u578b\u90e8\u7f72\u3002</li> <li>\u76f8\u5bf9\u590d\u6742\uff1aMySQL\u76f8\u5bf9\u4e8e\u6587\u6863\u6570\u636e\u5e93\u9700\u8981\u66f4\u591a\u7684\u524d\u671f\u89c4\u5212\u548c\u914d\u7f6e\uff0c\u4e0d\u592a\u9002\u5408\u975e\u6280\u672f\u4eba\u5458\u4f7f\u7528\u3002</li> </ul>","tags":["MySQL","MongoDB"]},{"location":"db/note-mongodb-mysql/#_1","title":"\u5c0f\u7ed3","text":"<p>\u603b\u7684\u6765\u8bf4\uff0c\u9009\u62e9\u54ea\u79cd\u7c7b\u578b\u7684\u6570\u636e\u5e93\u53d6\u51b3\u4e8e\u60a8\u7684\u5177\u4f53\u9700\u6c42\u3002\u5982\u679c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u5feb\u901f\u6269\u5c55\u3001\u5904\u7406\u5927\u91cf\u975e\u7ed3\u6784\u5316\u6570\u636e\u6216\u6570\u636e\u6539\u53d8\u9891\u7e41\uff0c\u5219MongoDB\u53ef\u80fd\u662f\u66f4\u597d\u7684\u9009\u62e9\u3002\u5982\u679c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u9700\u8981ACID\u4e8b\u52a1\u6027\u6216\u5177\u6709\u590d\u6742\u7684\u67e5\u8be2\u548c\u5206\u6790\u9700\u6c42\uff0c\u5219MySQL\u53ef\u80fd\u662f\u66f4\u597d\u7684\u9009\u62e9\u3002</p>","tags":["MySQL","MongoDB"]},{"location":"db/mysql/docker-mysql-modify-pwd/","title":"docker MySQL \u4fee\u6539\u5bc6\u7801","text":"\u66f4\u65b0\u65e5\u671f\uff1a 2022-08-30 <ul> <li>2022-08-30 \u6dfb\u52a0\u8bf4\u660e</li> <li>2022-08-17 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883 <ul> <li>centOS 7.9</li> <li>docker 18.03.1-ce</li> <li>MySQL 5.7</li> </ul> <p>\u672c\u6587\u6f14\u793a\u4fee\u6539docker mysql\u7684\u5bc6\u7801\u3002</p>","tags":["MySQL"]},{"location":"db/mysql/docker-mysql-modify-pwd/#_1","title":"\u64cd\u4f5c\u6b65\u9aa4","text":"","tags":["MySQL"]},{"location":"db/mysql/docker-mysql-modify-pwd/#mysql","title":"\u8fdb\u5165mysql\u5bb9\u5668","text":"<p>\u5148<code>docker ps</code>\u770b\u4e00\u4e0bmysql\u5bb9\u5668\u7684\u4fe1\u606f</p> <p>\u7136\u540e\u8fdb\u5165\u5bb9\u5668 <pre><code>docker exec -it mysql5.7 /bin/bash\n</code></pre></p>","tags":["MySQL"]},{"location":"db/mysql/docker-mysql-modify-pwd/#mysql_1","title":"\u8fdb\u5165mysql","text":"<p>\u6b64\u65f6\u5728\u5bb9\u5668\u5185 <pre><code>mysql -u root -p\n</code></pre> \u8f93\u5165\u539f\u6765\u7684\u5bc6\u7801</p> <p>\u8fdb\u6765\u540e\uff0c\u9009\u62e9mysql <pre><code>use mysql;\n</code></pre></p>","tags":["MySQL"]},{"location":"db/mysql/docker-mysql-modify-pwd/#_2","title":"\u4fee\u6539\u5bc6\u7801","text":"<p>\u4f7f\u7528\u5982\u4e0b\u6307\u4ee4 <pre><code>ALTER USER 'root'@'%' IDENTIFIED BY 'yourPassword' PASSWORD EXPIRE NEVER;\n</code></pre></p>","tags":["MySQL"]},{"location":"db/mysql/docker-mysql-modify-pwd/#mysql_2","title":"\u9000\u51faMySQL","text":"<p><code>ctrl + d</code> \u6216\u8005\u8f93\u5165 <code>exit;</code> \u9000\u51faMySQL</p> <p>\u91cd\u65b0\u8fde\u63a5\u4ee5\u9a8c\u8bc1\u5bc6\u7801\u662f\u5426\u4fee\u6539\u6210\u529f</p>","tags":["MySQL"]},{"location":"db/mysql/docker-mysql-modify-pwd/#root","title":"\u4fee\u6539root\u767b\u5f55\u5bc6\u7801","text":"<p>\u8fdb\u5165\u5bb9\u5668\u5185\uff0c\u518d\u8fdb\u5165mysql <code>mysql -u root -p</code></p> <p>\u7136\u540e\u4fee\u6539root\u7684\u767b\u5f55\u5bc6\u7801 <pre><code>use mysql;\nset password for root@localhost = password('\u4f60\u7684\u65b0\u5bc6\u7801');\nflush privileges;\n</code></pre></p>","tags":["MySQL"]},{"location":"designPattern/Adapter-Pattern/","title":"\u9002\u914d\u5668\u6a21\u5f0f Adapter Pattern - Java\u5b9e\u73b0","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Adapter-Pattern/#_1","title":"\u5b9a\u4e49","text":"<p>\u5c06\u4e00\u4e2a\u7c7b\u7684\u63a5\u53e3\u53d8\u6362\u6210\u5ba2\u6237\u7aef\u9501\u671f\u5f85\u7684\u53e6\u4e00\u79cd\u63a5\u53e3\uff0c\u4ece\u800c\u4f7f\u539f\u672c\u56e0\u63a5\u53e3\u4e0d\u5339\u914d\u800c\u65e0\u6cd5\u5de5\u4f5c\u5728\u4e00\u8d77\u7684\u4e24\u4e2a\u7c7b\u80fd\u591f\u5728\u4e00\u8d77\u5de5\u4f5c\u3002 \u4e5f\u53eb\u4f5c\u53d8\u538b\u5668\u6a21\u5f0f\uff0c\u4ea6\u79f0\u5305\u88c5\u6a21\u5f0f\uff0c\u4f46\u5305\u88c5\u6a21\u5f0f\u4e0d\u6b62\u4e00\u4e2a\u3002 \u7b80\u5355\u800c\u8a00\uff0c\u9002\u914d\u5668\u6a21\u5f0f\u5c31\u662f\u628a\u4e00\u4e2a\u63a5\u53e3\u6216\u7c7b\u8f6c\u6362\u6210\u5176\u4ed6\u7684\u63a5\u53e3\u6216\u7c7b\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Adapter-Pattern/#_2","title":"\u5e94\u7528","text":"<p>\u4f18\u70b9\uff1a</p> <ul> <li>\u53ef\u4ee5\u8ba9\u6ca1\u6709\u4efb\u4f55\u5173\u7cfb\u7684\u7c7b\u5728\u4e00\u8d77\u8fd0\u884c</li> <li>\u589e\u52a0\u4e86\u7c7b\u7684\u900f\u660e\u6027</li> <li>\u63d0\u9ad8\u4e86\u7c7b\u7684\u590d\u7528\u5ea6</li> <li>\u7075\u6d3b\u5ea6\u597d</li> </ul> <p>\u6ce8\u610f\u4e8b\u9879\uff1a\u5728\u8be6\u7ec6\u9636\u6bb5\u4e0d\u8981\u8003\u8651\u9002\u914d\u5668\u6a21\u5f0f\uff0c\u5b83\u4e3b\u8981\u662f\u7528\u6765\u89e3\u51b3\u6b63\u5728\u670d\u5f79\u7684\u9879\u76ee\u95ee\u9898</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Adapter-Pattern/#_3","title":"\u4ee3\u7801\u793a\u4f8b","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Adapter-Pattern/#_4","title":"\u5411\u5df2\u8fd0\u884c\u7684\u7cfb\u7edf\u6dfb\u52a0\u65b0\u589e\u7684\u7528\u6237\u7c7b\u578b","text":"<p>\u6587\u4ef6\u76ee\u5f55\u5982\u4e0b <pre><code>adapter/\n\u251c\u2500\u2500 sadapter  // \u65b0\u589e\u7684\u9002\u914d\u5668\u4ee3\u7801\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 SecondUserAdapter.java\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 SecondUserAddress.java\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 SecondUser.java\n\u251c\u2500\u2500 stable    // \u5df2\u7ecf\u5728\u8fd0\u884c\u7684\u4ee3\u7801\uff0c\u4e0d\u53ef\u53d8\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 FirstUser.java\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 IFirstUser.java\n\u251c\u2500\u2500 TestAdapter.java // \u6d4b\u8bd5\u4ee3\u7801\n\u2514\u2500\u2500 updated   // \u7b2c\u4e09\u65b9\u63d0\u4f9b\u7684\u63a5\u53e3\uff0c\u4e0d\u53ef\u53d8\n    \u251c\u2500\u2500 ISecondUserAddress.java\n    \u2514\u2500\u2500 ISecondUser.java\n</code></pre></p> <p>\u9996\u5148\u770b\u5df2\u7ecf\u5728\u8fd0\u884c\u7684\u90e8\u5206 \uff08stable\uff09 <pre><code>public interface IFirstUser {\n    void printInfo();\n}\npublic class FirstUser implements IFirstUser {\n\n    private String username;\n\n    public FirstUser(String username) {\n        this.username = username;\n    }\n\n    @Override\n    public void printInfo() {\n        System.out.println(this.username);\n    }\n}\n</code></pre></p> <p>\u518d\u770b\u6309\u9700\u6c42\u6dfb\u52a0\u7684\u90e8\u5206 \uff08updated\uff09 <pre><code>public interface ISecondUser {\n    void printUsername();\n}\npublic interface ISecondUserAddress {\n    void printAddress();\n}\n</code></pre></p> <p>\u4e3a\u6b64\u65b0\u5efa\u7684\u9002\u914d\u5668 \uff08sadapter\uff09 \u5206\u522b\u65b0\u5efa2\u4e2a\u7c7b\u6765\u5b9e\u73b0\u63a5\u53e3 <pre><code>public class SecondUser implements ISecondUser {\n\n    private String username;\n\n    public SecondUser(String name) {\n        this.username = name;\n    }\n\n    @Override\n    public void printUsername() {\n        System.out.print(username + \" \");\n    }\n}\n\npublic class SecondUserAddress implements ISecondUserAddress {\n\n    private String addr;\n\n    public SecondUserAddress(String address) {\n        this.addr = address;\n    }\n\n    @Override\n    public void printAddress() {\n        System.out.print(this.addr);\n    }\n}\n</code></pre></p> <p>\u9002\u914d\u5668\u6301\u6709\u8fd9\u4e24\u4e2a\u63a5\u53e3\u7684\u5f15\u7528\uff0c\u5e76\u5b9e\u73b0\u539f\u6709\u7684\u63a5\u53e3 <pre><code>public class SecondUserAdapter implements IFirstUser {\n\n    private ISecondUser iSecondUser;\n    private ISecondUserAddress iSecondUserAddress;\n\n    public SecondUserAdapter(ISecondUser iSecondUser, ISecondUserAddress iSecondUserAddress) {\n        this.iSecondUser = iSecondUser;\n        this.iSecondUserAddress = iSecondUserAddress;\n    }\n\n    @Override\n    public void printInfo() {\n        iSecondUser.printUsername();\n        iSecondUserAddress.printAddress();\n    }\n}\n</code></pre></p> <p>\u9002\u914d\u5668\u6784\u5efa\u5b8c\u6bd5\uff0c\u6d4b\u8bd5\u4ee3\u7801 <pre><code>IFirstUser user1 = new FirstUser(\"User1\");\nuser1.printInfo();\nSecondUserAdapter userAdapter = \n    new SecondUserAdapter(new SecondUser(\"SUser2\"),new SecondUserAddress(\"5 street\"));\nuserAdapter.printInfo();\n</code></pre></p> <p>\u8f93\u51fa <pre><code>User1\nSUser2 5 street\n</code></pre> \u6700\u5438\u5f15\u4eba\u7684\u5730\u65b9\u5c31\u662f\u9002\u914d\u5668\u5b9e\u73b0\u4e86\u539f\u6709\u7684\u63a5\u53e3\u3002\u9700\u6c42\u53d8\u5316\u65f6\uff0c\u53ef\u5c3d\u91cf\u5c11\u7684\u6539\u52a8\u5df2\u6709\u4ee3\u7801\u3002</p> <p>Android\u4e2d\u7684\u5217\u8868\u63a7\u4ef6RecyclerView\u4f7f\u7528\u4e86\u9002\u914d\u5668\u7684\u65b9\u5f0f\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Bridge-Pattern/","title":"\u6865\u63a5\u6a21\u5f0f Bridge Pattern","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Bridge-Pattern/#_1","title":"\u5b9a\u4e49","text":"<p>\u5c06\u62bd\u8c61\u548c\u5b9e\u73b0\u89e3\u8026\uff0c\u4f7f\u5f97\u4e24\u8005\u53ef\u4ee5\u72ec\u7acb\u5730\u53d8\u5316</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Bridge-Pattern/#_2","title":"\u4ee3\u7801\u793a\u4f8b","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Bridge-Pattern/#_3","title":"\u5de5\u5382\u751f\u4ea7\u4ea7\u54c1\u6a21\u62df","text":"<p>\u6a21\u62df\u5de5\u5382\u751f\u4ea7\u9500\u552e\u4ea7\u54c1 \u6587\u4ef6\u76ee\u5f55 <pre><code>bridge/\n|-- Client.java             // \u6d4b\u8bd5\u4ee3\u7801\n|-- factory\n|   |-- CanFactory.java     // \u7f50\u5934\u5de5\u5382\n|   `-- ModernFactory.java  // \u73b0\u4ee3\u5316\u5de5\u5382\n|-- Factory.java            // \u5de5\u5382\u7684\u62bd\u8c61\u7c7b\n|-- product\n|   |-- Can.java            // \u4ea7\u54c1\u5177\u4f53\u7c7b \u7f50\u5934\n|   `-- Toy.java            // \u4ea7\u54c1\u5177\u4f53\u7c7b \u73a9\u5177\n`-- Product.java            // \u4ea7\u54c1\u7684\u62bd\u8c61\u7c7b\n</code></pre></p> <p>\u4ea7\u54c1\u7c7b\u76f8\u5173\u4ee3\u7801 <pre><code>public abstract class Product {\n\n    protected void made() {\n        System.out.println(getClass().getSimpleName() + \" has been made\");\n    }\n    protected void  sold() {\n        System.out.println(getClass().getSimpleName() + \" has been sold\");\n    }\n\n}\n\npublic class Can extends Product {\n\n    @Override\n    public void made() {\n        super.made();\n    }\n\n    @Override\n    public void sold() {\n        super.sold();\n    }\n}\n\npublic class Toy extends Product {\n    @Override\n    public void made() {\n        super.made();\n    }\n\n    @Override\n    public void sold() {\n        super.sold();\n    }\n}\n</code></pre></p> <p>\u5de5\u5382\u76f8\u5173\u4ee3\u7801 <pre><code>public abstract class Factory {\n\n    private Product product; // \u5f15\u7528\u62bd\u8c61\u7684\u4ea7\u54c1\u7c7b\n\n    public Factory(Product p) {\n        this.product = p;\n    }\n\n    public void makeMoney() {\n        product.made();\n        product.sold();\n    }\n}\n\npublic class CanFactory extends Factory {\n\n    // \u53ea\u63a5\u53d7Can\u7c7b\n    public CanFactory(Can p) {\n        super(p);\n    }\n\n    @Override\n    public void makeMoney() {\n        super.makeMoney();\n        System.out.println(getClass().getSimpleName() + \" make money!\");\n    }\n}\n\npublic class ModernFactory extends Factory {\n    // \u53ea\u8981\u662fProduct\u5373\u53ef\u751f\u4ea7\n    public ModernFactory(Product p) {\n        super(p);\n    }\n\n    @Override\n    public void makeMoney() {\n        super.makeMoney();\n        System.out.println(\"ModernFactory make money!\");\n    }\n}\n</code></pre> \u7f50\u5934\u5de5\u5382<code>CanFactory</code>\u53ea\u80fd\u751f\u4ea7\u7f50\u5934<code>Can</code>\u3002\u800c\u73b0\u4ee3\u5de5\u5382<code>ModernFactory</code>\u53ef\u4ee5\u751f\u4ea7<code>Product</code>\uff0c\u7f50\u5934\u6216\u8005\u73a9\u5177<code>Toy</code>\u90fd\u53ef\u4ee5\u3002</p> <p>\u6d4b\u8bd5\u4e0e\u8f93\u51fa <pre><code>Can can = new Can();\nCanFactory canFactory = new CanFactory(can);\ncanFactory.makeMoney();\nModernFactory modernFactory = new ModernFactory(new Toy());\nmodernFactory.makeMoney();\n/*\nCan has been made\nCan has been sold\nCanFactory make money!\nToy has been made\nToy has been sold\nModernFactory make money!\n*/\n</code></pre></p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Builder-Pattern/","title":"\u5efa\u9020\u8005\u6a21\u5f0f Builder Pattern","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Builder-Pattern/#_1","title":"\u5b9a\u4e49","text":"<p>\u4e5f\u53eb\u4f5c\u751f\u6210\u5668\u6a21\u5f0f\u3002 Separate the construction of a complex object from its representation  so that the same construction process can create different representations.</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Builder-Pattern/#_2","title":"\u4f18\u70b9","text":"<ul> <li>\u5c01\u88c5\u6027\uff1a\u5ba2\u6237\u7aef\u4e0d\u5fc5\u77e5\u9053\u6a21\u578b\u5185\u90e8\u7ec6\u8282</li> <li>\u5efa\u9020\u8005\u72ec\u7acb\uff0c\u6613\u4e8e\u6269\u5c55</li> <li>\u4fbf\u4e8e\u63a7\u5236\u7ec6\u8282\u98ce\u9669 - \u53ef\u5bf9\u5efa\u9020\u8005\u8fdb\u884c\u5355\u72ec\u7684\u7ec6\u5316</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Builder-Pattern/#_3","title":"\u4f7f\u7528\u573a\u666f","text":"<ul> <li>\u76f8\u540c\u7684\u65b9\u6cd5\uff0c\u4e0d\u540c\u7684\u6267\u884c\u987a\u5e8f\uff0c\u4ea7\u751f\u4e0d\u540c\u7684\u4e8b\u4ef6\u7ed3\u679c\u7684\u573a\u666f</li> <li>\u4ea7\u54c1\u7c7b\u975e\u5e38\u590d\u6742\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u8fdb\u884c\u591a\u9879\u914d\u7f6e</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Builder-Pattern/#_4","title":"\u793a\u4f8b","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Builder-Pattern/#aosp-alertdialogbuilder","title":"AOSP\u4e2d\u7684 <code>AlertDialog.Builder</code>","text":"<p>android-25  </p> <p><code>AlertDialog</code>\u662fAndroid APP\u5f00\u53d1\u4e2d\u5e38\u7528\u7684\u4e00\u4e2a\u7c7b\u3002\u91c7\u7528\u4e86Builder\u6a21\u5f0f\u3002\u901a\u8fc7builder\u53ef\u4ee5\u5bf9dialog\u8fdb\u884c\u914d\u7f6e\u3002\u5176\u4e2ddialog\u7684\u5404\u9879\u5c5e\u6027\u53ef\u4ee5\u8bbe\u7f6e\u9ed8\u8ba4\u503c\u3002 <pre><code>public class AlertDialog extends Dialog implements DialogInterface {\n    public static class Builder {\n        public Builder(Context context) {}\n        public Builder setTitle(CharSequence title) {}\n        public Builder setMessage(@StringRes int messageId) {}\n        public Builder setPositiveButton(@StringRes int textId, final OnClickListener listener) {}\n        public Builder setNegativeButton(@StringRes int textId, final OnClickListener listener) {}\n        public Builder setCancelable(boolean cancelable) {}\n        // ..................................................\n        public AlertDialog create() {} //\u521b\u5efadialog\n        public AlertDialog show() {} // \u521b\u5efa\u5e76\u663e\u793a\u771f\u6b63\u7684dialog\n    }\n}\n</code></pre></p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Command-pattern/","title":"\u547d\u4ee4\u6a21\u5f0f","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Command-pattern/#_2","title":"\u5b9a\u4e49","text":"<p>\u5c06\u4e00\u4e2a\u8bf7\u6c42\u5c01\u88c5\u6210\u4e00\u4e2a\u5bf9\u8c61\u3002\u4ece\u800c\u8ba9\u4f60\u4f7f\u7528\u4e0d\u540c\u7684\u8bf7\u6c42\u628a\u5ba2\u6237\u7aef\u53c2\u6570\u5316\uff0c\u5bf9\u8bf7\u6c42\u6392\u961f\u6216\u8005\u8bb0\u5f55\u8bf7\u6c42\u65e5 \u5fd7\uff0c\u53ef\u4ee5\u63d0\u4f9b\u547d\u4ee4\u7684\u64a4\u9500\u548c\u6062\u590d\u529f\u80fd\u3002</p> <p>\u8fd9\u662f\u4e2a\u9ad8\u5185\u805a\u7684\u6a21\u5f0f\u3002</p> <p>\u628a\u8bf7\u6c42\u65b9\u548c\u6267\u884c\u65b9\u5206\u5f00\u4e86\u3002\u5185\u805a\u5230\u4e86\u547d\u4ee4\u91cc\u9762\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Command-pattern/#_3","title":"\u4f18\u7f3a\u70b9","text":"<p>\u4f18\u70b9\uff1a</p> <ul> <li>\u7c7b\u95f4\u89e3\u8026 - \u8c03\u7528\u8005\u548c\u63a5\u53d7\u8005\u89d2\u8272\u4e4b\u95f4\u6ca1\u6709\u4efb\u4f55\u4f9d\u8d56\u5173\u7cfb</li> <li>\u6613\u4e8e\u6269\u5c55</li> <li>\u53ef\u4ee5\u7ed3\u5408\u5176\u4ed6\u6a21\u5f0f</li> </ul> <p>\u7f3a\u70b9\u662fCommand\u547d\u4ee4\u7c7b\u5bb9\u6613\u81a8\u80c0</p> <p>\u9ad8\u5c42\u6b21\u7684\u6a21\u5757\u4e0d\u9700\u8981\u77e5\u9053\u63a5\u6536\u8005\uff08\u6267\u884c\u8005\uff09\u662f\u8c01\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Command-pattern/#_4","title":"\u4ee3\u7801\u793a\u4f8b","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Command-pattern/#_5","title":"\u7bee\u7403\u961f\u8bad\u7ec3\u6307\u4ee4","text":"<p>\u4ee5\u7bee\u7403\u8bad\u7ec3\u4e3a\u4f8b\uff0c\u5b9a\u4e49\u4e00\u4e9b\u547d\u4ee4 <pre><code>command/\n|-- cmd\n|   |-- Command.java // \u547d\u4ee4\u62bd\u8c61\u7c7b - \u5728\u8fd9\u91cc\u662f\u6218\u672f\n|   |-- InsideCommand.java // \u6253\u5185\u7ebf\n|   `-- ThreePointCommand.java // \u4e09\u5206\u6218\u672f\n|-- Coach.java // \u6559\u7ec3\n|-- player     \n|   |-- Center.java // \u4e2d\u950b\n|   |-- Player.java // \u8fd0\u52a8\u5458\u62bd\u8c61\u7c7b\n|   |-- PointGuard.java    // \u63a7\u536b\n|   `-- SmallForward.java  // \u5c0f\u524d\u950b\n`-- TestMain.java // \u6d4b\u8bd5\u4ee3\u7801\n</code></pre></p> <p>\u5148\u770b\u6307\u4ee4\u62bd\u8c61\u7c7b\uff0c\u91cc\u9762\u6709\u5bf9\u5177\u4f53\u63a5\u6536\u8005\u7684\u5f15\u7528 <pre><code>public abstract class Command {\n\n    // \u80fd\u591f\u8c03\u52a8\u7684\u4eba\u5458\n    protected Center center = new Center();\n    protected PointGuard pointGuard = new PointGuard();\n    protected SmallForward smallForward = new SmallForward();\n\n    public abstract void execute();\n}\n</code></pre></p> <p>\u8fd0\u52a8\u5458\u62bd\u8c61\u7c7b\u3002\u8fd0\u52a8\u5458\u80fd\u6267\u884c\u4e00\u4e9b\u52a8\u4f5c\u3002 <pre><code>public abstract class Player {\n\n    public abstract void run();\n\n    public abstract void shoot();\n\n    public abstract void passBall();\n\n    public abstract void catchBall();\n\n    public abstract void dunk();\n}\n</code></pre></p> <p>\u6559\u7ec3\u7c7b\uff0c\u5c31\u662f\u6307\u6325\u8005 <pre><code>public class Coach {\n    private Command command;\n\n    public void setCommand(Command command) {\n        this.command = command;\n    }\n\n    public void action() {\n        this.command.execute();\n    }\n}\n</code></pre></p> <p>\u4ee5\u4e0b\u662f\u5404\u4e2a\u4eba\u5458\u7c7b <pre><code>public class Center extends Player {\n    @Override\n    public void run() {\n        System.out.println(\"Center is running.\");\n    }\n\n    @Override\n    public void shoot() {\n        System.out.println(\"Center shoots the ball\");\n    }\n\n    @Override\n    public void passBall() {\n        System.out.println(\"Center passes ball\");\n    }\n\n    @Override\n    public void catchBall() {\n        System.out.println(\"Center got the ball\");\n    }\n\n    @Override\n    public void dunk() {\n        System.out.println(\"Center dunk!\");\n    }\n}\n\npublic class PointGuard extends Player {\n    @Override\n    public void run() {\n        System.out.println(\"PointGuard is running.\");\n    }\n\n    @Override\n    public void shoot() {\n        System.out.println(\"PointGuard shoots the ball\");\n    }\n\n    @Override\n    public void passBall() {\n        System.out.println(\"PointGuard passes ball\");\n    }\n\n    @Override\n    public void catchBall() {\n        System.out.println(\"PointGuard got the ball\");\n    }\n\n    @Override\n    public void dunk() {\n        System.out.println(\"PointGuard dunk!\");\n    }\n}\n\npublic class SmallForward extends Player {\n    @Override\n    public void run() {\n        System.out.println(\"SmallForward is running.\");\n    }\n\n    @Override\n    public void shoot() {\n        System.out.println(\"SmallForward shoots the ball.\");\n    }\n\n    @Override\n    public void passBall() {\n        System.out.println(\"SmallForward passes the ball.\");\n    }\n\n    @Override\n    public void catchBall() {\n        System.out.println(\"SmallForward got the ball.\");\n    }\n\n    @Override\n    public void dunk() {\n        System.out.println(\"SmallForward dunk.\");\n    }\n}\n</code></pre></p> <p>\u4ee5\u4e0b\u662f\u7b80\u5355\u76842\u4e2a\u547d\u4ee4\uff08\u6218\u672f\uff09 <pre><code>public class InsideCommand extends Command {\n    public InsideCommand() {\n\n    }\n    @Override\n    public void execute() {\n        System.out.println(getClass().getSimpleName() + \":\");\n        super.pointGuard.catchBall();\n        super.center.run();\n        super.pointGuard.passBall();\n        super.center.catchBall();\n        super.center.dunk();\n    }\n}\n\npublic class ThreePointCommand extends Command {\n    public ThreePointCommand() {\n\n    }\n    @Override\n    public void execute() {\n        System.out.println(getClass().getSimpleName() + \":\");\n        super.center.passBall();\n        super.pointGuard.catchBall();\n        super.smallForward.run();\n        super.pointGuard.passBall();\n        super.smallForward.catchBall();\n        super.pointGuard.run();\n        super.smallForward.passBall();\n        super.pointGuard.catchBall();\n        super.pointGuard.shoot();\n    }\n}\n</code></pre></p> <p>\u6d4b\u8bd5\u4ee3\u7801\u3002\u5b9a\u4e49\u4e00\u4e2a\u6559\u7ec3\uff0c\u7136\u540e\u628a\u6218\u672f\u5b9e\u4f8b\u4ea4\u7ed9\u6559\u7ec3\uff0c\u6559\u7ec3\u6307\u6325\u961f\u5458\u6267\u884c\u6218\u672f <pre><code>Coach coach = new Coach();\nCommand command1 = new InsideCommand();\nCommand command2 = new ThreePointCommand();\ncoach.setCommand(command1);\ncoach.action();\nSystem.out.println(\"------------------------------\");\ncoach.setCommand(command2);\ncoach.action();\n</code></pre></p> <p>\u8f93\u51fa <pre><code>InsideCommand:\nPointGuard got the ball\nCenter is running.\nPointGuard passes ball\nCenter got the ball\nCenter dunk!\n------------------------------\nThreePointCommand:\nCenter passes ball\nPointGuard got the ball\nSmallForward is running.\nPointGuard passes ball\nSmallForward got the ball.\nPointGuard is running.\nSmallForward passes the ball.\nPointGuard got the ball\nPointGuard shoots the ball\n</code></pre></p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Command-pattern/#_6","title":"\u601d\u8003","text":"<p>\u9664\u4e86\u4e0a\u9762\u53d1\u9001\u547d\u4ee4\u7684\u4f8b\u5b50\uff0c\u5728\u5b9e\u9645\u5de5\u4f5c\u4e2d\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u9047\u52301\u5957UI\u754c\u9762\u9700\u8981\u591a\u79cd\u4e1a\u52a1\u903b\u8f91\u7684\u573a\u666f\u3002 \u6b64\u65f6\u4e5f\u53ef\u4ee5\u628a\u914d\u7f6e\u4fe1\u606f\u5305\u88c5\u6210\u4e00\u4e2a\u201c\u547d\u4ee4\u201d\uff0c\u4f20\u5165\u76ee\u6807\u754c\u9762\u3002</p> <p>\u53c2\u8003\uff1a  \u300a\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u7985\u300b  \u79e6\u5c0f\u6ce2</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Decoration_Java/","title":"\u88c5\u9970\u8005\u6a21\u5f0f","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Decoration_Java/#_2","title":"\u5b9a\u4e49","text":"<p>\u52a8\u6001\u7684\u7ed9\u4e00\u4e2a\u5bf9\u8c61\u6dfb\u52a0\u4e00\u4e9b\u989d\u5916\u7684\u804c\u8d23\u3002\u5c31\u589e\u52a0\u529f\u80fd\u6765\u8bf4\uff0c\u88c5\u9970\u6a21\u5f0f\u6bd4\u751f\u6210\u5b50\u7c7b\u66f4\u52a0\u7075\u6d3b\u3002 \u5728\u4e0d\u5fc5\u6539\u53d8\u539f\u7c7b\u6587\u4ef6\u548c\u4f7f\u7528\u7ee7\u627f\u7684\u60c5\u51b5\u4e0b\uff0c\u52a8\u6001\u5730\u6269\u5c55\u4e00\u4e2a\u5bf9\u8c61\u7684\u529f\u80fd\u3002</p> <p>\u88c5\u9970\u8005\u4e0e\u88ab\u88c5\u9970\u8005\u62e5\u6709\u5171\u540c\u7684\u8d85\u7c7b\uff0c\u7ee7\u627f\u7684\u76ee\u7684\u662f\u7ee7\u627f\u7c7b\u578b\uff0c\u800c\u4e0d\u662f\u884c\u4e3a</p> <p>\u88c5\u9970\u6a21\u5f0f\u4e2d\uff0c\u5fc5\u7136\u6709\u4e00\u4e2a\u6700\u57fa\u672c\u3001\u6700\u6838\u5fc3\u3001\u6700\u539f\u59cb\u7684\u63a5\u53e3\u6216\u62bd\u8c61\u7c7b\u5145\u5f53Component\u62bd\u8c61\u6784\u4ef6\u3002</p> <p>\u88c5\u9970\u6a21\u5f0f\u7684\u901a\u7528\u7ed3\u6784 <pre><code>Component              // \u6700\u57fa\u672c\u7684\u62bd\u8c61\u6784\u4ef6\uff0c\u63a5\u53e3\u6216\u62bd\u8c61\u7c7b\n    Operation()\nConcreteComponent      // \u5177\u4f53\u7684\u6784\u4ef6\nDecorator              // \u62bd\u8c61\u7684\u88c5\u9970\u8005\nConcreteComponent      // \u5177\u4f53\u7684\u88c5\u9970\u8005\n</code></pre></p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Decoration_Java/#_3","title":"\u4f18\u7f3a\u70b9\u548c\u5e94\u7528\u573a\u666f","text":"<p>\u4f18\u70b9\uff1a</p> <ul> <li>\u88c5\u9970\u7c7b\u548c\u88ab\u88c5\u9970\u7c7b\u53ef\u4ee5\u72ec\u7acb\u53d1\u5c55\uff0c\u4e0d\u4f1a\u8026\u5408</li> <li>\u88c5\u9970\u6a21\u5f0f\u662f\u7ee7\u627f\u5173\u7cfb\u7684\u4e00\u4e2a\u66ff\u4ee3\u65b9\u6848</li> <li>\u88c5\u9970\u6a21\u5f0f\u53ef\u4ee5\u52a8\u6001\u5730\u6269\u5c55\u4e00\u4e2a\u7c7b\uff08\u6269\u5c55\u6027\u597d\uff09</li> </ul> <p>\u7f3a\u70b9\uff1a\u591a\u5c42\u7684\u88c5\u9970\u662f\u6bd4\u8f83\u590d\u6742\u7684\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Decoration_Java/#_4","title":"\u5e94\u7528\u573a\u666f","text":"<p>\u4e3b\u8981\u573a\u666f\u5c31\u662f\u80fd\u53d1\u6325\u4f18\u70b9\u7684\u5730\u65b9</p> <ul> <li>\u6269\u5c55\u4e00\u4e2a\u7c7b\u7684\u529f\u80fd\uff0c\u6216\u7ed9\u4e00\u4e2a\u7c7b\u589e\u52a0\u9644\u52a0\u529f\u80fd</li> <li>\u52a8\u6001\u5730\u589e\u52a0\u6216\u64a4\u9500\u4e00\u4e2a\u7c7b\u7684\u529f\u80fd</li> <li>\u9700\u8981\u4e3a\u4e00\u6279\u5144\u5f1f\u7c7b\u8fdb\u884c\u6539\u88c5\u6216\u52a0\u88c5\u529f\u80fd</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Decoration_Java/#_5","title":"\u4ee3\u7801\u793a\u4f8b","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Decoration_Java/#worker","title":"worker\u793a\u4f8b","text":"<p>AWorker\u79f0\u4e3a\u88c5\u9970\u8005 Plumber\u79f0\u4e3a\u88ab\u88c5\u9970\u8005</p> <p>\u5148\u5b9a\u4e49\u4e00\u4e2a Plumber\uff0c\u63a5\u7740\u5c06\u5176\u4f20\u5165 AWorker \u4e2d\uff1b\u8fd9\u6837\u5f97\u5230\u7684\u662fAWorker-Plumber Carpenter \u540c\u7406\u3002\u8fd9\u91cc\u88c5\u9970\u8005\u7684\u65b9\u6cd5\u4e2d\u8c03\u7528\u7684\u662f\u4f20\u5165\u5bf9\u8c61\u7684\u7c7b\u7684\u65b9\u6cd5\u3002</p> <pre><code>/**\n * Decoration test\n */\npublic class Decoration {\n\n    public static void main(String args[]) {\n        Plumber plumber = new Plumber();\n        AWorker aWorker = new AWorker(plumber);\n        aWorker.doSomeWork();\n        Carpenter carpenter = new Carpenter();\n        BWorker bCarpenter = new BWorker(carpenter);\n        bCarpenter.doSomeWork();\n    }\n}\n\ninterface Worker {\n    void doSomeWork();\n}\n\nclass Plumber implements Worker {\n    public void doSomeWork() {\n        System.out.println(\"Plumber do some work!\");\n    }\n}\n\nclass Carpenter implements Worker {\n    public void doSomeWork() {\n        System.out.println(\"Carpenter do some work!\");\n    }\n}\n\nclass AWorker implements Worker {\n    private Worker tempWorker;\n\n    public AWorker(Worker worker) {\n        tempWorker = worker;\n    }\n\n    public void doSomeWork() {\n        System.out.println(\"Hello,I am a A worker\");\n        tempWorker.doSomeWork();// use the Worker class method\n    }\n}\n\n// use temp Worker, avoid \"this\"\nclass BWorker implements Worker {\n    private Worker worker;\n\n    public BWorker(Worker worker) {\n        this.worker = worker;\n    }\n\n    public void doSomeWork() {\n        System.out.println(\"Hello,I am a B worker\");\n        worker.doSomeWork();\n    }\n}\n</code></pre> <p>\u8f93\u51fa\uff1a <pre><code>Hello,I am a A worker\nPlumber do some work!\nHello,I am a B worker\nCarpenter do some work!\n</code></pre></p> <p>\u53c2\u8003\uff1a  \u300a\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u7985\u300b  \u79e6\u5c0f\u6ce2</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Facade-Pattern/","title":"\u95e8\u9762\u6a21\u5f0f","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Facade-Pattern/#_2","title":"\u5b9a\u4e49","text":"<p>\u4e5f\u53eb\u4f5c\u5916\u89c2\u6a21\u5f0f\uff0c\u662f\u4e00\u79cd\u6bd4\u8f83\u5e38\u89c1\u7684\u5c01\u88c5\u6a21\u5f0f\u3002 \u8981\u6c42\u4e00\u4e2a\u5b50\u7cfb\u7edf\u7684\u5916\u90e8\u4e0e\u5176\u5185\u90e8\u7684\u901a\u4fe1\u5fc5\u987b\u901a\u8fc7\u4e00\u4e2a\u7edf\u4e00\u7684\u5bf9\u8c61\u8fdb\u884c\u3002\u95e8\u9762\u6a21\u5f0f\u63d0\u4f9b\u4e00\u4e2a\u9ad8\u5c42\u6b21 \u7684\u63a5\u53e3\uff0c\u4f7f\u5f97\u5b50\u7cfb\u7edf\u66f4\u6613\u4e8e\u4f7f\u7528\u3002</p> <p>\u5c31\u50cf\u6211\u4eec\u628a\u4e00\u4e9b\u5e38\u7528\u7684\u65b9\u6cd5\u5c01\u88c5\u6210<code>Utils</code>\u7c7b\uff0c\u628a\u7b97\u6cd5\u76f8\u5173\u7684\u64cd\u4f5c\u5c01\u88c5\u6210<code>Algorithm</code>\u7c7b  </p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Facade-Pattern/#_3","title":"\u95e8\u9762\u6a21\u5f0f\u7684\u5e94\u7528","text":"<p>\u4f18\u70b9\uff1a</p> <ul> <li>\u51cf\u5c11\u7cfb\u7edf\u7684\u76f8\u4e92\u4f9d\u8d56</li> <li>\u63d0\u9ad8\u4e86\u7075\u6d3b\u6027\u3002\u4e0d\u7ba1\u5b50\u7cfb\u7edf\u5185\u90e8\u5982\u4f55\u53d8\u5316\uff0c\u53ea\u8981\u4e0d\u5f71\u54cd\u95e8\u9762\u5bf9\u8c61\u5373\u53ef\u3002</li> <li>\u63d0\u9ad8\u5b89\u5168\u6027</li> </ul> <p>\u7f3a\u70b9\uff1a\u4e0d\u6ee1\u8db3\u5f00\u95ed\u539f\u5219\uff0c\u5bf9\u4fee\u6539\u5173\u95ed\uff0c\u5bf9\u6269\u5c55\u5f00\u653e\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Facade-Pattern/#_4","title":"\u4f7f\u7528\u573a\u666f","text":"<ul> <li>\u4e3a\u4e00\u4e2a\u590d\u6742\u7684\u6a21\u5757\u6216\u5b50\u7cfb\u7edf\u63d0\u4f9b\u4e00\u4e2a\u4f9b\u5916\u754c\u8bbf\u95ee\u7684\u63a5\u53e3</li> <li>\u5b50\u7cfb\u7edf\u76f8\u5bf9\u72ec\u7acb\u2014\u2014\u5916\u754c\u5bf9\u5b50\u7cfb\u7edf\u7684\u8bbf\u95ee\u53ea\u9700\u8981\u8c03\u7528\u65b9\u6cd5\u5373\u53ef</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Facade-Pattern/#_5","title":"\u95e8\u9762\u6a21\u5f0f\u7684\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u4e00\u4e2a\u5b50\u7cfb\u7edf\u53ef\u4ee5\u6709\u591a\u4e2a\u95e8\u9762</li> <li>\u5b50\u7cfb\u7edf\u53ef\u4ee5\u63d0\u4f9b\u4e0d\u540c\u7684\u8bbf\u95ee\u8def\u5f84</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Facade-Pattern/#_6","title":"\u95e8\u9762\u4e0d\u53c2\u4e0e\u7cfb\u7edf\u5185\u7684\u4e1a\u52a1\u903b\u8f91","text":"<p>\u63d0\u4f9b\u7ed9\u5916\u90e8\u7684public\u65b9\u6cd5\u4e0d\u5e94\u8be5\u88ab\u53e6\u4e00\u4e2apublic\u65b9\u6cd5\u6267\u884c</p> <p>\u53c2\u8003\uff1a  \u300a\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u7985\u300b  \u79e6\u5c0f\u6ce2</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Factory_method_Java/","title":"\u5de5\u5382\u65b9\u6cd5","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Factory_method_Java/#_2","title":"\u4f7f\u7528\u573a\u666f","text":"<p>\u5ba2\u6237\u4ee3\u7801\u4e0d\u77e5\u9053\u8be5\u5bf9\u51e0\u4e2a\u7c7b\u4e2d\u7684\u54ea\u4e00\u4e2a\u7c7b\u8fdb\u884c\u5b9e\u4f8b\u5316\u3002\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u5b9a\u4e49\u4e00\u4e2a\u7528\u4e8e \u521b\u5efa\u5bf9\u8c61\u7684\u63a5\u53e3\uff0c\u540c\u65f6\u63a7\u5236\u5bf9\u54ea\u4e2a\u7c7b\u8fdb\u884c\u5b9e\u4f8b\u5316\u3002</p> <p>\u6240\u6709\u9700\u8981\u751f\u6210\u5bf9\u8c61\u7684\u5730\u65b9\u90fd\u53ef\u4ee5\u4f7f\u7528\u6b64\u65b9\u6cd5\u3002\u8981\u614e\u91cd\u8003\u8651\u662f\u5426\u8981\u589e\u52a0\u4e00\u4e2a\u5de5\u5382\u7c7b\u8fdb\u884c\u7ba1\u7406\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Factory_method_Java/#_3","title":"\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u7684\u7279\u5f81","text":"<ul> <li>\u8be5\u65b9\u6cd5\u521b\u5efa\u4e86\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61</li> <li>\u8be5\u65b9\u6cd5\u7684\u8fd4\u56de\u7c7b\u578b\u4e3a\u4e00\u4e2a\u62bd\u8c61\u7c7b\u6216\u63a5\u53e3</li> <li>\u6709\u82e5\u5e72\u4e2a\u7c7b\u5b9e\u73b0\u4e86\u4e0a\u8ff0\u62bd\u8c61\u6a21\u578b</li> </ul> <p>\u5de5\u5382\u65b9\u6cd5\u5230\u5e95\u5b9e\u4f8b\u5316\u4ec0\u4e48\u6837\u7684\u7c7b\u53d6\u51b3\u4e8e\u5ba2\u6237\u4ee3\u7801\u8c03\u7528\u7684\u65f6\u54ea\u4e00\u4e2a\u7c7b\u7684\u5de5\u5382\u65b9\u6cd5\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Factory_method_Java/#_4","title":"\u4f8b\u5b50","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Factory_method_Java/#arraysaslist","title":"Arrays.asList()\u5e76\u4e0d\u7b26\u5408\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u7684\u8bbe\u8ba1\u610f\u56fe","text":"<p>\u867d\u7136Arrays.asList()\u65b9\u6cd5\u5b9e\u4f8b\u5316\u4e86\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5e76\u4e14\u5176\u8fd4\u56de\u7c7b\u578b\u4e3a\u4e00\u4e2a\u63a5\u53e3\uff0c\u4f46\u662f\u6b64\u65b9\u6cd5\u4e3a\u6240\u6709\u7528\u6237\u90fd\u5b9e\u4f8b \u5316\u4e86\u540c\u4e00\u4e2a\u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u5e76\u4e0d\u7b26\u5408\u5de5\u5382\u65b9\u6cd5\u7684\u8bbe\u8ba1\u610f\u56fe\u3002\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u7684\u6838\u5fc3\u662f\uff0c\u8ba9\u5bf9\u8c61\u7684\u521b\u5efa\u8005\u4ee3\u66ff\u7528\u6237\u786e\u5b9a\u5e94\u8be5\u5b9e\u4f8b\u5316\u54ea\u4e00\u4e2a\u7c7b\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Factory_method_Java/#tostring","title":"toString()\u65b9\u6cd5\u5e76\u4e0d\u5c5e\u4e8e\u5de5\u5382\u65b9\u6cd5","text":"<p>toString()\u65b9\u6cd5\u603b\u662f\u8fd4\u56de\u4e00\u4e2aString\u5bf9\u8c61\u3002\u5b9e\u73b0\u4e86toString()\u65b9\u6cd5\u7684\u7c7b\u5e76\u4e0d\u80fd\u51b3\u5b9a\u5b9e\u4f8b\u5316\u4ec0\u4e48\u6837\u7684\u7c7b\u3002 \u56e0\u800c\u8fd9\u4e0d\u662f\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u7684\u4e00\u4e2a\u4f8b\u5b50\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Factory_method_Java/#_5","title":"\u5178\u578b\u4f8b\u5b50\uff1a\u8fed\u4ee3\u5668","text":"<p>\u901a\u5e38iterator()\u65b9\u6cd5\u672c\u4e8b\u662f\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u7684\u4e00\u4e2a\u5f88\u597d\u7684\u4f8b\u5b50\u3002\u8be5\u65b9\u6cd5\u8ba9\u8c03\u7528\u65b9\u65e0\u9700\u4e86\u89e3\u6240\u8981\u5b9e\u4f8b\u5316\u7684\u7c7b\u3002 Java JDK\uff08\u4f8b\u59821.8.0\uff09\u4e2d\u6240\u6709\u96c6\u5408\u7c7b\u90fd\u8981\u5b9e\u73b0Collection\u63a5\u53e3\uff0c\u8be5\u63a5\u53e3\u5305\u542b\u4e00\u4e2aiterator()\u65b9\u6cd5\u3002</p> <p>\u4ee5JDK1.8.0\u4e3a\u4f8b Iterator\u63a5\u53e3\u5982\u4e0b <pre><code>public interface Iterator&lt;E&gt; {\n\n    boolean hasNext();\n    E next();\n    default void remove() {\n        throw new UnsupportedOperationException(\"remove\");\n    }\n    default void forEachRemaining(Consumer&lt;? super E&gt; action) {\n        Objects.requireNonNull(action);\n        while (hasNext())\n            action.accept(next());\n    }\n}\n</code></pre> ArrayList\u4e2d\u7684iterator()\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2aItr\u5bf9\u8c61 <pre><code>public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt;\n        implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable\n{      \n    public Iterator&lt;E&gt; iterator() {\n            return new Itr();\n    }\n    private class Itr implements Iterator&lt;E&gt; {\n            // ......\n    }\n}\n</code></pre> LinkedList\u7684iterator()\u8fd4\u56de\u7684\u662f\u53e6\u4e00\u79cd\u5bf9\u8c61\u3002 <code>LinkedList&lt;E&gt;</code> &lt;-- <code>AbstractSequentialList&lt;E&gt;</code> &lt;-- <code>AbstractList&lt;E&gt;</code> <pre><code>public ListIterator&lt;E&gt; listIterator() {\n    return listIterator(0);\n}\npublic ListIterator&lt;E&gt; listIterator(final int index) {\n    rangeCheckForAdd(index);\n\n    return new ListItr(index);\n}\nprivate class ListItr extends Itr implements ListIterator&lt;E&gt; {\n    // ......\n}\nprivate class Itr implements Iterator&lt;E&gt; {\n    // ......\n}\n</code></pre>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Factory_method_Java/#_6","title":"\u5de5\u5382\u65b9\u6cd5\u6a21\u5f0f\u7684\u6269\u5c55","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Factory_method_Java/#_7","title":"\u7f29\u5c0f\u4e3a\u7b80\u5355\u5de5\u5382\u6a21\u5f0f","text":"<p>\u4e00\u4e2a\u6a21\u5757\u4ec5\u9700\u8981\u4e00\u4e2a\u5de5\u5382\u7c7b\uff0c\u6ca1\u6709\u5fc5\u8981\u5b9e\u4f8b\u5316\u8fd9\u4e2a\u5de5\u5382\u7c7b\uff0c\u6dfb\u52a0\u4f7f\u7528\u751f\u4ea7\u201c\u4ea7\u54c1\u201d\u5bf9\u8c61\u7684\u9759\u6001\u65b9\u6cd5\u5373\u53ef\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Factory_method_Java/#_8","title":"\u5347\u7ea7\u4e3a\u591a\u4e2a\u5de5\u5382\u7c7b","text":"<p>\u60c5\u51b5\uff1a\u521d\u59cb\u5316\u4e00\u4e2a\u5bf9\u8c61\u5f88\u8d39\u7cbe\u529b\uff0c\u6240\u6709\u4ea7\u54c1\u7c7b\u653e\u5230\u4e00\u4e2a\u5de5\u5382\u65b9\u6cd5\u4e2d\u8fdb\u884c\u521d\u59cb\u5316\u4f1a\u4f7f\u4ee3\u7801\u7ed3\u6784\u4e0d\u6e05\u6670\u3002</p> <p>\u5bf9\u7b56\uff1a\u4f7f\u7528\u591a\u4e2a\u5de5\u5382\u7c7b\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Factory_method_Java/#lazy-initialization","title":"\u5ef6\u8fdf\u521d\u59cb\u5316\uff08Lazy initialization\uff09","text":"<p>\u4e00\u4e2a\u5bf9\u8c61\u88ab\u6d88\u8d39\u5b8c\u6bd5\u540e\uff0c\u5e76\u4e0d\u7acb\u523b\u91ca\u653e\uff0c\u5de5\u5382\u7c7b\u4fdd\u6301\u5176\u521d\u59cb\u72b6\u6001\uff0c\u7b49\u5f85\u518d\u6b21\u88ab\u4f7f\u7528\u3002 \u7ebf\u7a0b\u6c60\u7684\u8bbe\u8ba1\u601d\u60f3\u662f\u5426\u6ee1\u8db3\u6b64\u6761\u4ef6\uff1f</p> <p>\u53c2\u8003</p> <p>\u300a\u8bbe\u8ba1\u6a21\u5f0fJava\u624b\u518c\u300b Steven Jhon Metsker</p> <p>\u300a\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u7985\u300b  \u79e6\u5c0f\u6ce2</p> <p>JDK1.8</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Flyweight-Pattern/","title":"\u4eab\u5143\u6a21\u5f0f Flyweight Pattern","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Flyweight-Pattern/#_1","title":"\u5b9a\u4e49","text":"<p>\u4f7f\u7528\u5171\u4eab\u5bf9\u8c61\u53ef\u6709\u6548\u5730\u652f\u6301\u5927\u91cf\u7684\u7ec6\u7c92\u5ea6\u7684\u5bf9\u8c61\u3002</p> <p>\u4eab\u5143\u6a21\u5f0f\u662f\u6c60\u6280\u672f\u7684\u91cd\u8981\u5b9e\u73b0\u65b9\u5f0f\u3002 \u7ec6\u7c92\u5ea6\u7684\u5bf9\u8c61\uff0c\u5c06\u8fd9\u4e9b\u5bf9\u8c61\u7684\u4fe1\u606f\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff1a\u5185\u90e8\u72b6\u6001\u548c\u5916\u90e8\u72b6\u6001</p> <ul> <li>\u5185\u90e8\u72b6\u6001 \u5bf9\u8c61\u53ef\u4ee5\u5171\u4eab\u51fa\u6765\u7684\u4fe1\u606f\uff0c\u4e0d\u4f1a\u968f\u7740\u73af\u5883\u6539\u53d8\u800c\u6539\u53d8</li> <li>\u5916\u90e8\u72b6\u6001 \u662f\u5bf9\u8c61\u5f97\u4ee5\u4f9d\u8d56\u7684\u4e00\u4e2a\u6807\u8bb0\uff0c\u4e0d\u53ef\u5171\u4eab\u7684\u72b6\u6001\uff1b\u5982\u552f\u4e00\u7684\u7d22\u5f15\u503c</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Flyweight-Pattern/#_2","title":"\u4f18\u7f3a\u70b9","text":"<p>\u4eab\u5143\u6a21\u5f0f\u4f7f\u5f97\u7cfb\u7edf\u66f4\u52a0\u590d\u6742\u3002\u4e3a\u4e86\u4f7f\u5bf9\u8c61\u53ef\u4ee5\u5171\u4eab\uff0c\u9700\u8981\u5c06\u4e00\u4e9b\u72b6\u6001\u5916\u90e8\u5316\uff0c\u8fd9\u4f7f\u5f97\u7a0b\u5e8f\u7684\u903b\u8f91\u590d\u6742\u5316\u3002 \u4eab\u5143\u6a21\u5f0f\u5c06\u4eab\u5143\u5bf9\u8c61\u7684\u72b6\u6001\u5916\u90e8\u5316\uff0c\u800c\u8bfb\u53d6\u5916\u90e8\u72b6\u6001\u4f7f\u5f97\u8fd0\u884c\u65f6\u95f4\u7a0d\u5fae\u53d8\u957f\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Flyweight-Pattern/#_3","title":"\u4f7f\u7528\u573a\u666f","text":"<ul> <li>\u4e00\u4e2a\u7cfb\u7edf\u6709\u5927\u91cf\u7684\u5bf9\u8c61\u3002</li> <li>\u8fd9\u4e9b\u5bf9\u8c61\u8017\u8d39\u5927\u91cf\u7684\u5185\u5b58\u3002</li> <li>\u8fd9\u4e9b\u5bf9\u8c61\u7684\u72b6\u6001\u4e2d\u7684\u5927\u90e8\u5206\u90fd\u53ef\u4ee5\u5916\u90e8\u5316\u3002</li> <li>\u8fd9\u4e9b\u5bf9\u8c61\u53ef\u4ee5\u6309\u7167\u5185\u8574\u72b6\u6001\u5206\u6210\u5f88\u591a\u7684\u7ec4\uff0c\u5f53\u628a\u5916\u8574\u5bf9\u8c61\u4ece\u5bf9\u8c61\u4e2d\u5254\u9664\u65f6\uff0c\u6bcf\u4e00\u4e2a\u7ec4\u90fd\u53ef\u4ee5\u4ec5\u7528\u4e00\u4e2a\u5bf9\u8c61\u4ee3\u66ff\u3002</li> <li>\u8f6f\u4ef6\u7cfb\u7edf\u4e0d\u4f9d\u8d56\u4e8e\u8fd9\u4e9b\u5bf9\u8c61\u7684\u8eab\u4efd\uff0c\u6362\u8a00\u4e4b\uff0c\u8fd9\u4e9b\u5bf9\u8c61\u53ef\u4ee5\u662f\u4e0d\u53ef\u5206\u8fa8\u7684\u3002</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Iterator_Java/","title":"\u8fed\u4ee3\u5668 Iterator","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> <li>2015-4-25\uff1a\u521b\u5efa\u6587\u6863</li> </ul> <p>\u53ef\u4ee5\u8fd9\u6837\u8bf4\uff0c\u8fed\u4ee3\u5668\u7edf\u4e00\u4e86\u5bf9\u5bb9\u5668\u7684\u8bbf\u95ee\u65b9\u5f0f\u3002</p> <p>\u8003\u8651\u8fd9\u6837\u7684\u60c5\u666f\uff1a\u539f\u672c\u662f\u5bf9\u7740List\u7f16\u7801\uff0c\u4f46\u662f\u540e\u6765\u53d1\u73b0\u9700\u8981\u628a\u76f8\u540c\u7684\u4ee3\u7801\u7528\u4e8eSet\u3002\u6211\u4eec\u9700\u8981\u4e00\u79cd\u4e0d\u5173\u5fc3\u5bb9\u5668\u7c7b\u578b\u800c\u80fd\u591f\u901a\u7528\u7684\u5bb9\u5668\u8bbf\u95ee\u65b9\u6cd5\u3002</p> <p>Iterator\u6a21\u5f0f\u662f\u7528\u4e8e\u904d\u5386\u96c6\u5408\u7c7b\u7684\u6807\u51c6\u8bbf\u95ee\u65b9\u6cd5\u3002 \u5b83\u53ef\u4ee5\u628a\u8bbf\u95ee\u903b\u8f91\u4ece\u4e0d\u540c\u7c7b\u578b\u7684\u96c6\u5408\u7c7b\u4e2d\u62bd\u8c61\u51fa\u6765\uff0c\u4ece\u800c\u907f\u514d\u5411\u5ba2\u6237\u7aef\u66b4\u9732\u96c6\u5408\u7684\u5185\u90e8\u7ed3\u6784\u3002 \u8fed\u4ee3\u5668\u662f\u4e00\u4e2a\u5bf9\u8c61\uff0c\u5b83\u7684\u5de5\u4f5c\u662f\u904d\u5386\u5e76\u9009\u4e2d\u5e8f\u5217\u4e2d\u7684\u5bf9\u8c61\uff0c\u800c\u5ba2\u6237\u7aef\u7a0b\u5e8f\u5458\u4e0d\u5fc5\u77e5\u9053\u6216\u5173\u5fc3\u8be5\u5e8f\u5217\u5e95\u5c42\u7684\u7ed3\u6784\u3002 \u80fd\u5c06\u904d\u5386\u5e8f\u5217\u7684\u64cd\u4f5c\u4e0e\u5e8f\u5217\u5e95\u5c42\u7684\u673a\u6784\u5206\u79bb\u3002\u800c\u4e14\uff0c\u521b\u5efa\u8fed\u4ee3\u5668\u7684\u4ee3\u4ef7\u5f88\u5c0f\u3002</p> <pre><code>List&lt;Integer&gt; list = new LinkedList&lt;&gt;();\nfor (int i = 1; i &lt; 6; i++) {\n    list.add(i);\n}\nIterator iterator = list.iterator();\nSystem.out.println(\"iterator \u672c\u8eab\uff1a \" + iterator);\nSystem.out.println(iterator.next());\nwhile (iterator.hasNext()) {\n    System.out.print(iterator.next() + \" \");\n}\n</code></pre> <p>\u8f93\u51fa\uff1a <pre><code>iterator \u672c\u8eab\uff1a java.util.LinkedList$ListItr@1540e19d\n1\n2 3 4 5\n</code></pre></p> <p>\u5c3d\u91cf\u4f7f\u7528Java\u4e2d\u63d0\u4f9b\u7684Iterator\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Listener_pattern_practice_in_Java_Android/","title":"\u76d1\u542c\u8005\u6a21\u5f0f - \u5728Java\u4e0eAndroid\u4e2d\u7684\u4f7f\u7528","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-20 <ul> <li>2022-6-20 \u66f4\u65b0\u683c\u5f0f</li> <li>2022-6-1  \u66f4\u65b0\u683c\u5f0f</li> </ul> <p>\u76d1\u542c\u8005\u6a21\u5f0f\uff08\u89c2\u5bdf\u8005\u6a21\u5f0f\uff09\u80fd\u964d\u4f4e\u5bf9\u8c61\u4e4b\u95f4\u8026\u5408\u7a0b\u5ea6\u3002\u4e3a\u4e24\u4e2a\u76f8\u4e92\u4f9d\u8d56\u8c03\u7528\u7684\u7c7b\u8fdb\u884c\u89e3\u8026\u3002</p> <p>\u4fbf\u4e8e\u8fdb\u884c\u6a21\u5757\u5316\u5f00\u53d1\u5de5\u4f5c\u3002\u4e0d\u540c\u6a21\u5757\u7684\u5f00\u53d1\u8005\u53ef\u4ee5\u4e13\u6ce8\u4e8e\u81ea\u8eab\u7684\u4ee3\u7801\u3002   </p> <p>\u76d1\u542c\u8005\u7528\u6765\u76d1\u542c\u81ea\u5df2\u611f\u5174\u8da3\u7684\u4e8b\u4ef6\uff0c\u5f53\u6536\u5230\u81ea\u5df2\u611f\u5174\u8da3\u7684\u4e8b\u4ef6\u65f6\u6267\u884c\u81ea\u5b9a\u4e49\u7684\u64cd\u4f5c\u3002 \u5728\u67d0\u4e9b\u6570\u636e\u53d8\u5316\u65f6\uff0c\u5176\u4ed6\u7684\u7c7b\u505a\u51fa\u4e00\u4e9b\u54cd\u5e94\u3002\u5904\u7406\u6570\u636e\uff08\u6216\u8005\u5206\u53d1\u4e8b\u4ef6\uff09\u7684\u7c7b\u4e3b\u52a8\u6295\u9001\u6d88\u606f\uff0c\u611f\u5174\u8da3\u7684\u7c7b\u4e3b\u52a8\u201c\u8ba2\u9605\u201d\u6d88\u606f\u3002</p> <p>\u76d1\u542c\u8005\u6a21\u5f0f\u5728Android\u4e2d\u6709\u5927\u91cf\u7684\u8fd0\u7528\uff0c\u76f8\u4fe1\u5927\u5bb6\u90fd\u4e0d\u4f1a\u611f\u5230\u964c\u751f\u3002\u5728Android\u5f00\u53d1\u4e2d\uff0cButton\u63a7\u4ef6\u7684\u70b9\u51fb\u4e8b\u4ef6\u5c31\u662f\u76d1\u542c\u8005\u6a21\u5f0f\u6700\u5e38\u89c1\u7684\u4f8b\u5b50\u3002  </p> <p>\u5f53Button\u88ab\u70b9\u51fb\uff0c\u6267\u884c\u4e86 <code>OnClickListener.onClick</code>\u3002 Activity\u4e2d\u7ed9\u8fd9\u4e2aButton\u8bbe\u7f6e\u4e86\u81ea\u5df1\u5b9e\u73b0\u7684<code>OnClickListener</code>\uff0c\u5e76\u590d\u5199\u4e86<code>onClick</code>\u65b9\u6cd5\uff0c\u5c31\u80fd\u6267\u884c\u81ea\u5b9a\u4e49\u64cd\u4f5c\u4e86\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Listener_pattern_practice_in_Java_Android/#java","title":"Java\u4ee3\u7801\u5b9e\u4f8b","text":"<p>\u4e0b\u9762\u6765\u7528Java\u6765\u5b9e\u73b0\u76d1\u542c\u8005\u6a21\u5f0f\u3002 \u8fd9\u4e2a\u4f8b\u5b50\u662f\u7ed9\u201c\u8ba1\u7b97\u7c7b\u201d\u6301\u7eed\u5730\u4f20\u5165\u6570\u636e\uff0c\u5904\u7406\u597d\u6570\u636e\u540e\uff0c\u53d1\u51fa\u7ed3\u679c\u3002\u611f\u5174\u8da3\u7684\u7c7b\u63a5\u6536\u7ed3\u679c\u3002 2\u4e2a\u6587\u4ef6\uff1a<code>AlgoCalculator.java</code>\uff1b<code>MainUser.java</code> </p> <ul> <li><code>AlgoCalculator.java</code>\u662f\u8ba1\u7b97\u90e8\u5206\uff0c\u63a5\u6536\u6570\u636e\u5e76\u8fdb\u884c\u8ba1\u7b97\u3002\u5e76\u5c06\u7ed3\u679c\u4f20\u9012\u51fa\u53bb\u3002</li> <li><code>MainUser.java</code>\u662f\u8c03\u7528\u65b9\uff0c\u5c06\u57fa\u672c\u6570\u636e\u4f20\u5165AlgoCalculator\u5e76\u76d1\u542c\u7ed3\u679c\u3002</li> </ul> <pre><code>package com.algo;\n\nimport java.util.LinkedList;\nimport java.util.List;\n\npublic class AlgoCalculator {\n\n    private List&lt;short[]&gt; mDataBuffer = new LinkedList&lt;&gt;();\n\n    public AlgoCalculator() {\n\n    }\n\n    // \u5b9a\u4e49\u4e00\u4e2aListener\u63a5\u53e3\uff1b\u53ef\u5c06\u4e00\u4e2aboolean\u503c\u4f20\u9012\u51fa\u53bb\n    public interface ResultChangeListener {\n        void onChange(boolean found);\n    }\n\n    private ResultChangeListener resultChangeListener;\n    // \u8c03\u7528\u65b9\u80fd\u591f\u8bbe\u7f6e\u5e76\u5b9e\u73b0\u8fd9\u4e2a\u63a5\u53e3\n    public void setResultChangedListener(ResultChangeListener resultChangedListener) {\n        this.resultChangeListener = resultChangedListener;\n    }\n    // \u4f20\u8f93\u6570\u636e\n    public void setDataStream(short[] data) {\n        checkData(data);// \u5904\u7406\u6570\u636e\u65b9\u6cd5\n    }\n\n    // \u5904\u7406\u6570\u636e\uff0c\u5e76\u9001\u51fa\u7ed3\u679c\n    private void checkData(short[] data) {\n        if (data.length == 0) {\n            return;\n        }\n        long sum = 0;\n        for (short b : data) {\n            sum += b;\n        }\n        if (sum &gt; 40) {\n            resultChangeListener.onChange(true); // \u6570\u636e\u5904\u7406\u7ed3\u679c\n        } else {\n            resultChangeListener.onChange(false);\n        }\n    }\n}\n</code></pre> <p>\u4e3b\u7a0b\u5e8f\uff1b\u8c03\u7528\u65b9\u4f20\u5165\u6570\u636e\uff0c\u83b7\u53d6\u7ed3\u679c <pre><code>import com.algo.AlgoCalculator;\n\npublic class MainUser {\n    public static void main(String[] args) {\n        AlgoCalculator algoCalculator = new AlgoCalculator(); // \u521d\u59cb\u5316\n\n        // \u8bbe\u7f6e\u76d1\u542c\u5668\uff0c\u5e76\u5728\u91cc\u9762\u589e\u52a0\u8981\u6267\u884c\u7684\u52a8\u4f5c\n        algoCalculator.setResultChangedListener(new AlgoCalculator.ResultChangeListener() {\n            @Override\n            public void onChange(boolean found) {\n                System.out.println(\"result: \" + found);\n            }\n        });\n        short[] data1 = {1, 2, 3,};\n        short[] data2 = {10, 20, 30};\n        short[] data3 = {6, 7, 8};\n        short[] data4 = {1, 1, 1};\n        // \u4f20\u5165\u6570\u636e\n        algoCalculator.setDataStream(data1);    // output false\n        algoCalculator.setDataStream(data2);    // output true\n        algoCalculator.setDataStream(data3);    // output false\n        algoCalculator.setDataStream(data4);    // output false\n    }\n}\n</code></pre> \u5728\u53e6\u5916\u7684\u7c7b\u91cc\uff0c\u80fd\u591f\u5f88\u65b9\u4fbf\u5730\u8c03\u7528<code>AlgoCalculator</code>\u7684\u8ba1\u7b97\u80fd\u529b\u5e76\u83b7\u53d6\u8ba1\u7b97\u7ed3\u679c\u3002 \u5728\u8fd9\u91cc\uff0c\u6bcf\u4f20\u5165\u4e00\u6b21\u6570\u636e\uff0c\u5c31\u80fd\u83b7\u53d6\u4e00\u4e2a\u7ed3\u679c\u3002\u5982\u679c\u6bcf\u79d2\u949f\u4f20\u5165\u4e00\u6b21\u6570\u636e\uff0c\u6bcf\u79d2\u949f\u5c31\u80fd\u83b7\u53d6\u4e00\u4e2a\u7ed3\u679c\u3002 \u6211\u4eec\u53ef\u4ee5\u628a\u590d\u6742\u7684\u7b97\u6cd5\u5c01\u88c5\u8d77\u6765\uff0c\u5ba2\u6237\u7aef\u53ea\u9700\u8981\u4f20\u5165\u6570\u636e\uff0c\u5373\u53ef\u83b7\u5f97\uff08\u76d1\u542c\u5230\uff09\u7ed3\u679c\u3002  </p> <p>\u5f88\u591a\u573a\u666f\u4e2d\u90fd\u4f7f\u7528\u4e86\u76d1\u542c\u8005\u6a21\u5f0f\u3002\u5f00\u53d1\u8005\u4e5f\u53ef\u80fd\u5728\u4e0d\u77e5\u4e0d\u89c9\u4e2d\u5c31\u8fd0\u7528\u4e86\u8fd9\u4e2a\u6a21\u5f0f\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Listener_pattern_practice_in_Java_Android/#android","title":"Android\u4e2d\u4f7f\u7528\u76d1\u542c\u5668","text":"<p>\u6700\u5e38\u89c1\u7684\u4f8b\u5b50\u662f\u7ed9Button\u8bbe\u7f6e\u70b9\u51fb\u4e8b\u4ef6\u76d1\u542c\u5668\u3002 \u7c7b\u4f3c\u4e0a\u4e2a\u4f8b\u5b50\uff0c\u8bbe\u8ba1\u4e00\u4e2a\u63a5\u53e3\u5f53\u505a\u76d1\u542c\u5668\u3002Android\u4e2d\u56de\u8c03\u65f6\u53ef\u4ee5\u5229\u7528handler\uff0c\u63a7\u5236\u8c03\u7528\u7684\u7ebf\u7a0b\u3002 <pre><code>private Handler mMainHandler;\n\nmMainHandler = new Handler(Looper.getMainLooper());// \u5728\u4e3b\u7ebf\u7a0b\u4e2d\u8fd0\u884c\n\nprivate void notifySthChange(final int state) {\n    mMainHandler.post(new Runnable() {\n        @Override\n        public void run() {\n            ArrayList&lt;SListener&gt; list = new ArrayList&lt;&gt;(mListeners);\n            for (SListener l : list) {\n                l.OnSthChanged(state);\n            }\n        }\n    });\n}\n</code></pre> \u5728\u56de\u8c03\u4e2d\u53ef\u4ee5\u76f4\u63a5\u66f4\u65b0UI\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Mediator-Pattern/","title":"\u4e2d\u4ecb\u8005\u6a21\u5f0f Mediator Pattern","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Mediator-Pattern/#_1","title":"\u5b9a\u4e49","text":"<p>\u7528\u4e00\u4e2a\u4e2d\u4ecb\u5bf9\u8c61\u5c01\u88c5\u4e00\u7cfb\u5217\u7684\u5bf9\u8c61\u4ea4\u4e92\uff0c\u4e2d\u4ecb\u8005\u4f7f\u5404\u5bf9\u8c61\u4e0d\u9700\u8981\u663e\u793a\u5730\u4e92\u76f8\u4f5c\u7528\uff0c \u4ece\u800c\u8fbe\u5230\u677e\u8026\u5408\u7684\u76ee\u7684\u3002</p> <p>\u7531\u4ee5\u4e0b\u51e0\u4e2a\u90e8\u5206\u7ec4\u6210</p> <ul> <li>mediator \u62bd\u8c61\u4e2d\u4ecb\u8005 - \u7528\u4e8e\u534f\u8c03\u5404\u4e2a\u540c\u4e8b\u4e4b\u95f4\u7684\u4ea4\u4e92</li> <li>Concrete mediator \u5177\u4f53\u4e2d\u4ecb\u8005\u89d2\u8272 - \u4f9d\u8d56\u4e8e\u5404\u4e2a\u540c\u4e8b\u7c7b</li> <li>Colleague \u540c\u4e8b\u89d2\u8272\uff08\u8981\u88ab\u5c01\u88c5\u7684\u5bf9\u8c61\uff09</li> </ul> <p>\u6bcf\u4e2a\u540c\u4e8b\u89d2\u8272\u90fd\u77e5\u9053\u4e2d\u4ecb\u8005\u89d2\u8272\uff0c\u4f46\u4e0d\u4e0e\u5176\u4ed6\u540c\u4e8b\u8fdb\u884c\u4ea4\u4e92\uff0c\u800c\u662f\u901a\u8fc7\u4e2d\u4ecb\u8005\u6765\u8c03\u5ea6\u3002 \u540c\u4e8b\u7c7b\u7684\u884c\u4e3a\u5206\u4e3a2\u79cd\uff1a \u4e00\u79cd\u662f\u540c\u4e8b\u672c\u8eab\u7684\u884c\u4e3a\uff0c\u6bd4\u5982\u6539\u53d8\u5bf9\u8c61\u672c\u8eab\u7684\u72b6\u6001\uff0c\u5904\u7406\u81ea\u5df1\u7684\u884c\u4e3a\u7b49\u7b49\uff0c\u53eb\u81ea\u53d1\u884c\u4e3a\uff08Self-Method\uff09 \u7b2c\u4e8c\u79cd\u662f\u5fc5\u987b\u4f9d\u8d56\u4e2d\u4ecb\u8005\u624d\u80fd\u5b8c\u6210\u7684\u884c\u4e3a\uff0c\u53eb\u505a\u4f9d\u8d56\u65b9\u6cd5\uff08Dep-Method\uff09</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Mediator-Pattern/#_2","title":"\u4f18\u7f3a\u70b9","text":"<p>\u4f18\u70b9\u662f\u51cf\u5c11\u7c7b\u95f4\u7684\u4f9d\u8d56\uff0c\u628a\u539f\u6765\u7684\u4e00\u5bf9\u591a\u7684\u4f9d\u8d56\u5173\u7cfb\u6539\u53d8\u6210\u4e86\u4e00\u5bf9\u4e00\u7684\u4f9d\u8d56\u3002\u964d\u4f4e\u8026\u5408\u3002 \u7f3a\u70b9\u662f\u4e2d\u4ecb\u8005\u4f1a\u53d8\u5f97\u5f88\u5e9e\u5927\uff0c\u903b\u8f91\u590d\u6742\u3002  </p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Mediator-Pattern/#_3","title":"\u5e94\u7528\u573a\u666f","text":"<p>\u673a\u573a\u8c03\u5ea6\u4e2d\u5fc3\uff1bMVC\u6846\u67b6\u4e2d\u7684Controller\uff1b\u4e2d\u4ecb\u670d\u52a1\uff0c\u4f8b\u5982\u73b0\u5b9e\u4e2d\u7684\u79df\u623f\u4e2d\u4ecb\u7b49\u7b49</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Mediator-Pattern/#_4","title":"\u8fdb\u9500\u5b58\u7cfb\u7edf\u6a21\u62df\u4ee3\u7801\u793a\u4f8b","text":"<p>\u540c\u4e8b\u7c7b\u67093\u4e2a\u89d2\u8272\uff1a\u9500\u552e\uff0c\u91c7\u8d2d\uff0c\u5e93\u5b58 \u4e00\u4e2a\u534f\u8c03\u8005\uff0c\u53ef\u4ee5\u770b\u4f5c\u662f\u8c03\u5ea6\u5458\uff08\u6216\u7ecf\u7406\uff09  </p> <p>\u6587\u4ef6\u76ee\u5f55 <pre><code>AbstractMediator  // \u62bd\u8c61\u534f\u8c03\u8005\u7c7b\nAbstractColleague // \u62bd\u8c61\u540c\u4e8b\u7c7b\nCompany           // \u5b9a\u4e49\u4e86\u4e00\u4e9b\u5e38\u91cf\u503c\nStock             // \u5e93\u5b58\nMediator          // \u5177\u4f53\u7684\u534f\u8c03\u8005\nPurchase          // \u5177\u4f53\u7684\u91c7\u8d2d\nSale              // \u5177\u4f53\u7684\u9500\u552e\n</code></pre></p> <p>\u62bd\u8c61\u540c\u4e8b\u7c7b<code>AbstractColleague.java</code>\uff0c\u6301\u6709\u62bd\u8c61\u4e2d\u4ecb\u8005\u7684\u5f15\u7528 <pre><code>public abstract class AbstractColleague {\n    protected AbstractMediator mediator;\n\n    public AbstractColleague(AbstractMediator _mediator) {\n        this.mediator = _mediator;\n    }\n\n}\n</code></pre></p> <p>\u62bd\u8c61\u4e2d\u4ecb\u8005\u7c7b<code>AbstractMediator.java</code>\uff0c\u6301\u6709\u5177\u4f53\u540c\u4e8b\u7c7b\u7684\u5f15\u7528 <pre><code>public abstract class AbstractMediator {\n    protected Purchase purchase;\n    protected Sale sale;\n    protected Stock stock;\n    public AbstractMediator() {\n        purchase = new Purchase(this); // \u521d\u59cb\u5316\u65f6\u81ea\u884c\u5b9e\u4f8b\u5316\u540c\u4e8b\u7c7b\n        sale = new Sale(this);\n        stock = new Stock(this);\n    }\n    protected abstract void execute(String type, Object... objects);\n}\n</code></pre></p> <p>\u5b9a\u4e49\u4e00\u4e9b\u5e38\u91cf <pre><code>public final class Company {\n    public static final String SALE_SELL = \"sale.sell\";\n    public static final String PURCHASE_BUY = \"purchase.buy\";\n    public static final String STOCK_CLEAR = \"stock.clear\";\n}\n</code></pre></p> <p>\u91c7\u8d2d\u5458\u7c7b\uff0c\u8d1f\u8d23\u91c7\u8d2d\u7535\u8111\uff0c\u4e5f\u53ef\u4ee5\u505c\u6b62\u91c7\u8d2d <pre><code>public class Purchase extends AbstractColleague {\n\n    public Purchase(AbstractMediator mediator) {\n        super(mediator);\n    }\n\n    public void buyComputer(int number) {\n        super.mediator.execute(Company.PURCHASE_BUY, number);\n    }\n\n    public void refuseToBuyComputer() {\n        System.out.println(\"\u91c7\u8d2d\u5458\u4e0d\u518d\u91c7\u8d2d\u7535\u8111\");\n    }\n}\n</code></pre></p> <p>\u5e93\u5b58\u7c7b\uff1b\u5e93\u5b58\u6570\u91cf\u4f1a\u589e\u52a0\u6216\u51cf\u5c11 <pre><code>public class Stock extends AbstractColleague {\n\n    public Stock(AbstractMediator mediator) {\n        super(mediator);\n    }\n\n    // \u5e93\u5b58\u6570\u91cf\u662f\u5168\u5c40\u552f\u4e00\u7684 \u5b9e\u9645\u9879\u76ee\u4e2d\u8981\u6ce8\u610f\u5e76\u53d1\u95ee\u9898\n    private static int computerCount = 100; \n\n    public void increase(int number) {\n        computerCount += number;\n        System.out.println(\"\u589e\u52a0\u540e\uff0c\u5e93\u5b58\u7535\u8111\u6570\u91cf\u4e3a \" + computerCount);\n    }\n\n    public void decrease(int number) {\n        computerCount -= number;\n        System.out.println(\"\u51cf\u5c11\u540e\uff0c\u5e93\u5b58\u7535\u8111\u6570\u91cf\u4e3a \" + computerCount);\n    }\n\n    public int getComputerCount() {\n        return computerCount;\n    }\n\n    public void clearStock() {\n        System.out.println(\"\u8981\u6e05\u7406\u7684\u7535\u8111\u5e93\u5b58\u4e3a \" + computerCount);\n        super.mediator.execute(Company.STOCK_CLEAR);\n    }\n\n}\n</code></pre></p> <p>\u9500\u552e\u7c7b\uff0c\u80fd\u5356\u51fa\u7535\u8111\uff0c\u83b7\u53d6\u5230\u5356\u51fa\u901f\u5ea6\uff08\u8fd9\u91cc\u662f\u968f\u673a\u503c\uff09 <pre><code>public class Sale extends AbstractColleague {\n\n    public Sale(AbstractMediator mediator) {\n        super(mediator);\n    }\n\n    public void sellComputer(int number) {\n        System.out.println(\"\u5356\u51fa\u7535\u8111\u53f0\u6570 \" + number);\n        super.mediator.execute(Company.SALE_SELL, number);\n    }\n\n    public int getSaleStatusPercent() {\n        Random random = new Random(System.currentTimeMillis());\n        int saleStatus = random.nextInt(100);\n        System.out.println(\"\u5356\u7535\u8111\u7684\u901f\u5ea6 \" + saleStatus + \"%\");\n        return saleStatus;\n    }\n\n    public void offSale() {\n        System.out.println(\"\u9500\u552e\u5458\u5f00\u59cb\u6253\u6298\u9500\u552e\");\n    }\n}\n</code></pre></p> <p>\u5177\u4f53\u7684\u4e2d\u4ecb\u8005\u7c7b;\u5904\u7406\u4efb\u52a1\u7684\u5730\u65b9 <pre><code>public class Mediator extends AbstractMediator {\n\n    @Override\n    protected void execute(String type, Object... objects) {\n        if (Company.PURCHASE_BUY.equals(type)) {\n            this.buyComputerIn((Integer) objects[0]);\n        } else if (Company.SALE_SELL.equals(type)) {\n            this.sellComputer((Integer) objects[0]);\n        } else if (Company.STOCK_CLEAR.equals(type)) {\n            this.clearStock();\n        }\n    }\n\n    // \u5728\u8fd9\u91cc\u53ef\u4ee5\u5236\u5b9a\u8fdb\u9500\u7b56\u7565\n    private void buyComputerIn(int number) {\n        int percent = super.sale.getSaleStatusPercent();\n        if (percent &gt; 80) {\n            System.out.println(\"\u9500\u552e\u72b6\u6001\u4e0d\u9519\uff0c\u518d\u91c7\u8d2d\u7535\u8111 \" + number + \"\u53f0\");\n            super.stock.increase(number);\n        } else {\n            int buyIn = number / 2;\n            System.out.println(\"\u9500\u552e\u4e0d\u5982\u4eba\u610f  \u8865\u5145\u91c7\u8d2d\u7535\u8111 \" + buyIn + \" \");\n            super.stock.increase(buyIn);\n        }\n    }\n\n    private void sellComputer(int number) {\n        if (super.stock.getComputerCount() &lt; number) {\n            // \u5e93\u5b58\u4e0d\u8db3  \u5148\u91c7\u8d2d\u4e00\u4e9b\u56de\u6765\u518d\u5356\n            super.purchase.buyComputer(number);\n        }\n        super.stock.decrease(number);\n    }\n\n    // \u6e05\u7a7a\u5e93\u5b58\n    private void clearStock() {\n        super.sale.offSale();\n        super.purchase.refuseToBuyComputer();\n    }\n\n}\n</code></pre></p> <p>\u6d4b\u8bd5\u8fd0\u884c <pre><code>AbstractMediator mediator = new Mediator();\nPurchase purchase = new Purchase(mediator);\nSale sale = new Sale(mediator);\nStock stock = new Stock(mediator);\n\nSystem.out.println(\"main \u4e2d\u7684stock  \" + stock.toString());\nSystem.out.println(\"mediator \u4e2d\u7684stock  \" + mediator.stock.toString());\n\npurchase.buyComputer(120);\nsale.sellComputer(140);\nstock.clearStock();\n</code></pre> \u5148\u5b9a\u4e49\u51fa\u4e2d\u4ecb\u8005\uff0c\u63a5\u7740\u628a\u4e2d\u4ecb\u8005\u4f20\u5165\u540c\u4e8b\u7c7b\u4e2d\u3002\u540c\u4e8b\u7c7b\u8fdb\u884c\u64cd\u4f5c\u65f6\uff0c\u4f1a\u901a\u8fc7\u4e2d\u4ecb\u8005\u4e0e\u5176\u4ed6\u540c\u4e8b\u4ea4\u4e92\u3002 \u8fd9\u91cc\u5fc5\u987b\u8981\u6ce8\u610f\uff0c\u4e2d\u4ecb\u8005\u5f15\u7528\u7684\u540c\u4e8b\u5b9e\u4f8b\u548c\u5916\u9762new\u51fa\u6765\u7684\u540c\u4e8b\u5b9e\u4f8b\u4e0d\u4e00\u6837 \u8fd0\u884c\u7ed3\u679c</p> \u6267\u884c\u8f93\u51fa<pre><code>main \u4e2d\u7684stock  pattern.mediator.Stock@1b6d3586\nmediator \u4e2d\u7684stock  pattern.mediator.Stock@4554617c\n\u5356\u7535\u8111\u7684\u901f\u5ea6 87%\n\u9500\u552e\u72b6\u6001\u4e0d\u9519\uff0c\u518d\u91c7\u8d2d\u7535\u8111 120\u53f0\n\u589e\u52a0\u540e\uff0c\u5e93\u5b58\u7535\u8111\u6570\u91cf\u4e3a 220\n\u5356\u51fa\u7535\u8111\u53f0\u6570 140\n\u51cf\u5c11\u540e\uff0c\u5e93\u5b58\u7535\u8111\u6570\u91cf\u4e3a 80\n\u8981\u6e05\u7406\u7684\u7535\u8111\u5e93\u5b58\u4e3a 80\n\u9500\u552e\u5458\u5f00\u59cb\u6253\u6298\u9500\u552e\n\u91c7\u8d2d\u5458\u4e0d\u518d\u91c7\u8d2d\u7535\u8111\n</code></pre> <p>\u53c2\u8003\uff1a \u300a\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u7985\u300b  \u79e6\u5c0f\u6ce2</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Memento-Pattern/","title":"\u5907\u5fd8\u5f55\u6a21\u5f0f Memento Pattern","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Memento-Pattern/#_1","title":"\u5b9a\u4e49","text":"<p>\u5728\u4e0d\u7834\u574f\u5c01\u88c5\u6027\u7684\u524d\u63d0\u4e0b\uff0c\u6355\u83b7\u4e00\u4e2a\u5bf9\u8c61\u7684\u5185\u90e8\u72b6\u6001\uff0c\u5e76\u5728\u8be5\u5bf9\u8c61\u4e4b\u5916\u4fdd\u5b58\u8fd9\u4e2a\u72b6\u6001\u3002 \u8fd9\u6837\u5c31\u53ef\u4ee5\u5c06\u8be5\u5bf9\u8c61\u6062\u590d\u5230\u539f\u5148\u4fdd\u5b58\u7684\u72b6\u6001\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Memento-Pattern/#_2","title":"\u5907\u5fd8\u5f55\u6a21\u5f0f\u7684\u5e94\u7528","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Memento-Pattern/#_3","title":"\u4f7f\u7528\u573a\u666f","text":"<ul> <li>\u9700\u8981\u4fdd\u5b58\u548c\u6062\u590d\u6570\u636e\u7684\u76f8\u5173\u72b6\u6001\u573a\u666f</li> <li>\u63d0\u4f9b\u4e00\u4e2a\u53ef\u56de\u6eda\uff08rollback\uff09\u7684\u64cd\u4f5c</li> <li>\u9700\u8981\u76d1\u63a7\u7684\u526f\u672c\u573a\u666f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Memento-Pattern/#_4","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u5907\u5fd8\u5f55\u7684\u751f\u547d\u5468\u671f\uff1b\u8981\u4e3b\u52a8\u7ba1\u7406\u5907\u5fd8\u5f55\u7684\u58f0\u660e\u5468\u671f</li> <li>\u5907\u5fd8\u5f55\u7684\u6027\u80fd\uff1b\u4e0d\u8981\u5728\u9891\u7e41\u5efa\u7acb\u5907\u4efd\u7684\u573a\u666f\u4e2d\u4f7f\u7528\u5907\u5fd8\u5f55\u6a21\u5f0f\uff1b\u9996\u5148\u8981\u63a7\u5236\u5907\u5fd8\u5f55\u5efa\u7acb\u7684\u5bf9\u8c61\u6570\u91cf\uff0c\u5176\u6b21\u8981\u8003\u8651\u7cfb\u7edf\u7684\u627f\u53d7\u80fd\u529b\u3002</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Memento-Pattern/#_5","title":"\u6269\u5c55","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Memento-Pattern/#clone","title":"clone\u65b9\u5f0f\u7684\u5907\u5fd8\u5f55","text":"<p>\u4f7f\u7528\u590d\u5236\u7684\u65b9\u5f0f\u4ea7\u751f\u4e00\u4e2a\u5bf9\u8c61\u7684\u5185\u90e8\u72b6\u6001\u3002 \u8fd9\u65f6\u53ef\u4ee5\u4e0d\u7528\u5907\u5fd8\u5f55\u7ba1\u7406\u8005\uff0c\u53d1\u8d77\u8005\u53ef\u4ee5\u81ea\u5df1\u6301\u6709\u81ea\u5df1\u7684\u5907\u4efd\u72b6\u6001\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Memento-Pattern/#_6","title":"\u591a\u72b6\u6001\u7684\u5907\u5fd8\u5f55\u6a21\u5f0f","text":"<p>\u53ef\u4ee5\u5c06\u72b6\u6001\u5b58\u5165HashMap\u4e2d</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Memento-Pattern/#_7","title":"\u4ee3\u7801\u793a\u4f8b","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Memento-Pattern/#1","title":"\u5907\u5fd8\u5f55\u793a\u4f8b1","text":"<p>\u6587\u4ef6\u76ee\u5f55 <pre><code>memento/\n|-- IMemento.java       // \u5907\u5fd8\u5f55\u63a5\u53e3\n|-- MementoManager.java // \u5907\u5fd8\u5f55\u7ba1\u7406\u8005\n|-- TestMemento.java    // \u6d4b\u8bd5\u4ee3\u7801\n`-- Worker.java         // \u5de5\u4f5c\u8005\uff08\u9700\u8981\u5907\u5fd8\u7684\u7c7b\uff09\n</code></pre></p> <p>\u9996\u5148\u770b\u5907\u5fd8\u5f55\u63a5\u53e3\u3002\u8fd9\u4e2a\u63a5\u53e3\u6ca1\u6709\u65b9\u6cd5\u3002 <pre><code>public interface IMemento {\n}\n</code></pre></p> <p>\u5907\u5fd8\u5f55\u7ba1\u7406\u8005\uff0c\u7ba1\u7406\u7740<code>IMemento</code> <pre><code>public class MementoManager {\n    private IMemento memento;\n\n    public IMemento getMemento() {\n        return memento;\n    }\n\n    public void setMemento(IMemento memento) {\n        this.memento = memento;\n    }\n}\n</code></pre></p> <p><code>Worker</code>\u5185\u90e8\u6709\u4e00\u4e2a\u5907\u5fd8\u5f55 <pre><code>public class Worker {\n\n    private String name = \"default worker\";\n    private String state = \"origin state\";\n\n    public Worker(String name) {\n        this.name = name;\n    }\n\n    public void stateChange() {\n        state = \"fury state\";\n    }\n\n    public String getState() {\n        return state;\n    }\n\n    public void setState(String state) {\n        this.state = state;\n    }\n\n    public Memento createMemento() {\n        return new Memento(this.state);\n    }\n\n    public void loadMemento(IMemento memento) {\n        this.setState(((Memento) memento).getState());\n    }\n\n    public void printState() {\n        System.out.println(this.name + \", \" + this.state);\n    }\n\n    private class Memento implements IMemento {\n\n        private String state = \"\";\n\n        public Memento(String state) {\n            this.state = state;\n        }\n\n        public String getState() {\n            return state;\n        }\n\n        public void setState(String state) {\n            this.state = state;\n        }\n    }\n}\n</code></pre></p> <p>\u6d4b\u8bd5\u4ee3\u7801 <pre><code>Worker worker = new Worker(\"Tom\");\nworker.printState();\nMementoManager mementoManager = new MementoManager();\nmementoManager.setMemento(worker.createMemento());   // \u5907\u4efd\u72b6\u6001\nworker.stateChange(); // \u66f4\u6539\u72b6\u6001\nworker.printState();\nworker.loadMemento(mementoManager.getMemento());     // \u6062\u590d\u72b6\u6001\nworker.printState();\n</code></pre></p> <p>output \u6267\u884c\u8f93\u51fa<pre><code>Tom, origin state\nTom, fury state\nTom, origin state\n</code></pre></p> <p>\u53c2\u8003\u8d44\u6599\uff1a\u300a\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u7985\u300b  \u79e6\u5c0f\u6ce2</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Prototype-Pattern/","title":"\u539f\u578b\u6a21\u5f0f Prototype Pattern","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> </ul> <p>\u4f7f\u7528Java\u3002\u6b64\u6a21\u5f0f\u4e3b\u8981\u9760clone\u65b9\u6cd5\u5b9e\u73b0\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Prototype-Pattern/#_1","title":"\u539f\u578b\u6a21\u5f0f\u7684\u5b9a\u4e49","text":"<p>Specify the kinds of objects to create using a prototypical instance,  and create new objects by copying this prototype.</p> <p>\u6838\u5fc3\u65b9\u5f0f\u5c31\u662f\u590d\u5236\uff08clone\uff09</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Prototype-Pattern/#_2","title":"\u4f18\u70b9","text":"<ul> <li>\u6027\u80fd\u4f18\u826f\u3002\u6bd4\u76f4\u63a5new\u4e00\u4e2a\u5bf9\u8c61\u8981\u597d\u3002</li> <li>\u9003\u907f\u6784\u9020\u51fd\u6570\u7684\u7ea6\u675f\uff08\u4e5f\u53ef\u80fd\u662f\u7f3a\u70b9\uff09\u3002\u76f4\u63a5\u5728\u5185\u5b58\u4e2dclone\uff0c\u4e0d\u4f1a\u6267\u884c\u6784\u9020\u51fd\u6570\u3002</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Prototype-Pattern/#_3","title":"\u4f7f\u7528\u573a\u666f","text":"<ul> <li>\u8d44\u6e90\u4f18\u5316\u573a\u666f\u3002\u7c7b\u521d\u59cb\u5316\u9700\u8981\u6d88\u8017\u975e\u5e38\u591a\u7684\u8d44\u6e90\u65f6\uff0c\u6bd4\u5982\u6570\u636e\u3001\u786c\u4ef6\u7b49</li> <li>\u6027\u80fd\u548c\u5b89\u5168\u6709\u8981\u6c42\u3002new\u4e00\u4e2a\u5bf9\u8c61\u9700\u8981\u7e41\u7410\u7684\u6570\u636e\u51c6\u5907\u6216\u8bbf\u95ee\u6743\u9650\u65f6\uff0c\u53ef\u4f7f\u7528\u6b64\u6a21\u5f0f</li> <li>\u4e00\u4e2a\u5bf9\u8c61\u591a\u4e2a\u4fee\u6539\u8005\u7684\u573a\u666f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Prototype-Pattern/#_4","title":"\u6ce8\u610f\u4e8b\u9879","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Prototype-Pattern/#_5","title":"\u6784\u9020\u51fd\u6570\u4e0d\u4f1a\u6267\u884c","text":"<p>Object\u7c7b\u7684clone\u65b9\u6cd5\u7684\u539f\u7406\u662f\u4ece\u5185\u5b58\u4e2d\uff08\u5806\u5185\u5b58\uff09\u4ee5\u4e8c\u8fdb\u5236\u6d41\u7684\u65b9\u5f0f\u8fdb\u884c\u62f7\u8d1d\uff0c \u91cd\u65b0\u5206\u914d\u4e00\u4e2a\u5185\u5b58\u5757\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Prototype-Pattern/#_6","title":"\u6d45\u62f7\u8d1d\u548c\u6df1\u62f7\u8d1d","text":"<p>Object\u63d0\u4f9b\u7684clone\u65b9\u6cd5\u53ea\u62f7\u8d1d\u672c\u5bf9\u8c61\uff0c\u5bf9\u8c61\u5185\u90e8\u7684\u6570\u7ec4\u3001\u5f15\u7528\u5bf9\u8c61\u7b49\u90fd\u4e0d\u62f7\u8d1d\uff0c\u8fd8\u662f\u6307\u5411 \u539f\u751f\u5bf9\u8c61\u7684\u5185\u90e8\u5143\u7d20\u5730\u5740\u3002\u79f0\u4e4b\u4e3a\u201c\u6d45\u62f7\u8d1d\u201d\u3002 \u6df1\u62f7\u8d1d\u662f\u6307\u5c06\u7c7b\u7684\u79c1\u6709\u53d8\u91cf\u4e5f\u8fdb\u884c\u4e86\u72ec\u7acb\u7684\u62f7\u8d1d\u3002</p> <p>\u6d45\u62f7\u8d1d\u548c\u6df1\u62f7\u8d1d\u5efa\u8bae\u4e0d\u8981\u6df7\u5408\u4f7f\u7528\u3002</p> <p>\u539f\u578b\u6a21\u5f0f\u5148\u4ea7\u751f\u51fa\u4e00\u4e2a\u5305\u542b\u5927\u91cf\u5171\u6709\u4fe1\u606f\u7684\u7c7b\uff0c\u7136\u540e\u53ef\u4ee5\u62f7\u8d1d\u51fa\u526f\u672c\uff0c\u4fee\u6b63\u7ec6\u8282\u4fe1\u606f\uff0c\u5efa\u7acb\u4e86\u4e00\u4e2a\u5b8c\u6574 \u7684\u4e2a\u6027\u5bf9\u8c61\u3002</p> <p>\u53c2\u8003\uff1a \u300a\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u7985\u300b  \u79e6\u5c0f\u6ce2</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Proxy-Pattern/","title":"\u4ee3\u7406\u6a21\u5f0f Proxy Pattern","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Proxy-Pattern/#_1","title":"\u5b9a\u4e49","text":"<p>\u4e3a\u5176\u4ed6\u5bf9\u8c61\u63d0\u4f9b\u4e00\u79cd\u4ee3\u7406\u4ee5\u63a7\u5236\u5bf9\u8fd9\u4e2a\u5bf9\u8c61\u7684\u8bbf\u95ee\u3002 \u4e5f\u53eb\u59d4\u6258\u6a21\u5f0f\u3002\u8bb8\u591a\u5176\u4ed6\u6a21\u5f0f\uff0c\u5982\u72b6\u6001\u6a21\u5f0f\u3001\u7b56\u7565\u6a21\u5f0f\u3001\u8bbf\u95ee\u8005\u6a21\u5f0f\u672c\u8d28\u4e0a\u662f\u5728\u66f4\u7279\u6b8a\u7684\u573a\u5408\u91c7\u7528\u4e86\u59d4\u6258\u6a21\u5f0f\u3002</p> <p>\u4e3b\u8981\u6709\u4e09\u4e2a\u89d2\u8272\uff1a</p> <ul> <li>Subject\u62bd\u8c61\u4e3b\u9898\u89d2\u8272\u3002 \u53ef\u4ee5\u662f\u62bd\u8c61\u7c7b\u6216\u63a5\u53e3\uff0c\u662f\u4e00\u4e2a\u6700\u666e\u901a\u7684\u4e1a\u52a1\u7c7b\u578b\u5b9a\u4e49\uff0c\u65e0\u7279\u6b8a\u8981\u6c42\u3002</li> <li>RealSubject\u5177\u4f53\u4e3b\u9898\u89d2\u8272\u3002 \u4e5f\u53eb\u88ab\u59d4\u6258\u89d2\u8272\u3001\u88ab\u4ee3\u7406\u89d2\u8272\u3002\u662f\u5177\u4f53\u4e1a\u52a1\u7684\u6267\u884c\u8005\u3002</li> <li>Proxy\u4ee3\u7406\u4e3b\u9898\u89d2\u8272\u3002 \u4e5f\u53eb\u59d4\u6258\u7c7b\u3001\u4ee3\u7406\u7c7b\u3002\u8d1f\u8d23\u5bf9\u771f\u5b9e\u89d2\u8272\u7684\u5e94\u7528\uff0c\u53ef\u4ee5\u6dfb\u52a0\u81ea\u5b9a\u4e49\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982\u9884\u64cd\u4f5c\u548c\u5584\u540e\u5904\u7406\u3002</li> </ul> <p>RealSubject\u548cProxy\u90fd\u5b9e\u73b0\u6216\u7ee7\u627fSubject\u62bd\u8c61\u4e3b\u9898\u89d2\u8272\u3002\uff08\u4e2a\u4eba\u503e\u5411\u4e8e\u63a5\u53e3\uff0c\u4f46\u8981\u770b\u5b9e\u9645\u60c5\u51b5\u6765\u5b9a\uff09</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Proxy-Pattern/#_2","title":"\u4f18\u70b9","text":"<ul> <li>\u804c\u8d23\u6e05\u6670 - \u771f\u5b9e\u89d2\u8272\u53ea\u8d1f\u8d23\u5b9e\u73b0\u5b9e\u9645\u7684\u4e1a\u52a1\u903b\u8f91\uff0c\u4e0d\u7528\u5173\u7cfb\u5176\u4ed6\u4e8b\u52a1\u3002\u4ee3\u7406\u53ef\u4ee5\u5b8c\u6210\u66f4\u591a\u5de5\u4f5c\u3002</li> <li>\u9ad8\u6269\u5c55\u6027 - \u53ea\u8981\u5b9e\u73b0\u4e86\u63a5\u53e3\uff0c\u5177\u4f53\u4e3b\u9898\u89d2\u8272\u7684\u5b9e\u73b0\u53ef\u4ee5\u9ad8\u5ea6\u5730\u6539\u53d8\uff0c\u800c\u4e0d\u7528\u6539\u4ee3\u7406\u3002</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Proxy-Pattern/#_3","title":"\u6269\u5c55","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Proxy-Pattern/#_4","title":"\u666e\u901a\u4ee3\u7406","text":"<p>\u8981\u6c42\u5ba2\u6237\u7aef\u53ea\u80fd\u8bbf\u95ee\u4ee3\u7406\u89d2\u8272\uff0c\u800c\u4e0d\u80fd\u8bbf\u95ee\u771f\u5b9e\u89d2\u8272\u3002 \u5b9e\u9645\u5de5\u4f5c\u4e2d\uff0c\u4e00\u822c\u901a\u8fc7\u7ea6\u5b9a\u6765\u7981\u6b62new\u4e00\u4e2a\u771f\u5b9e\u89d2\u8272\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Proxy-Pattern/#_5","title":"\u666e\u901a\u4ee3\u7406\u793a\u4f8b","text":"<p>\u6587\u4ef6\u76ee\u5f55 <pre><code>IBaseFunction.java\nRealUser.java\nUserProxy.java\n</code></pre></p> <p>\u62bd\u8c61\u4e3b\u9898\u89d2\u8272 <code>IBaseFunction.java</code> <pre><code>public interface IBaseFunction {\n    void talk();\n}\n</code></pre></p> <p>\u5177\u4f53\u4e3b\u9898\u89d2\u8272<code>RealUser.java</code> <pre><code>public class RealUser implements IBaseFunction {\n    @Override\n    public void talk() {\n        System.out.println(\"Real user talk sth.\");\n    }\n}\n</code></pre></p> <p>\u4ee3\u7406\u4e3b\u9898\u89d2\u8272 <code>UserProxy.java</code> \u53ef\u4ee5\u6267\u884c\u81ea\u5b9a\u4e49\u7684\u9884\u64cd\u4f5c\u548c\u540e\u7eed\u5904\u7406\u64cd\u4f5c\u3002 <pre><code>public class UserProxy implements IBaseFunction {\n\n    private RealUser realUser;\n\n    public UserProxy() {\n        if (this.realUser == null) {\n            this.realUser = new RealUser();\n        }\n    }\n\n    @Override\n    public void talk() {\n        prepare();\n        this.realUser.talk();\n        finishWork();\n    }\n\n    private void prepare() {\n        System.out.println(\"Proxy is preparing...\");\n    }\n\n    private void finishWork() {\n        System.out.println(\"Proxy has done\");\n    }\n}\n</code></pre></p> <p>\u6d4b\u8bd5\u793a\u4f8b <pre><code>    UserProxy userProxy = new UserProxy();\n    userProxy.talk();\n</code></pre> \u8f93\u51fa <pre><code>Proxy is preparing...\nReal user talk sth.\nProxy has done\n</code></pre></p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Proxy-Pattern/#_6","title":"\u5f3a\u5236\u4ee3\u7406","text":"<p>\u4ece\u771f\u5b9e\u89d2\u8272\u627e\u5230\u4ee3\u7406\u89d2\u8272\uff0c\u4e0d\u5141\u8bb8\u76f4\u63a5\u64cd\u4f5c\u771f\u5b9e\u89d2\u8272\u3002\u771f\u5b9e\u89d2\u8272\u7ba1\u7406\u4ee3\u7406\u89d2\u8272\u3002 \u9ad8\u5c42\u6a21\u5757\u53ea\u8981\u8c03\u7528getProxy\uff08\u83b7\u53d6\u4ee3\u7406\uff09\u5c31\u53ef\u4ee5\u8bbf\u95ee\u771f\u5b9e\u89d2\u8272\u7684\u6240\u6709\u65b9\u6cd5\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Proxy-Pattern/#_7","title":"\u5f3a\u5236\u4ee3\u7406\u4ee3\u7801\u793a\u4f8b","text":"<p>\u6587\u4ef6\u76ee\u5f55\u3002\u8fd9\u91cc\u4ee5Robot\u7c7b\u4e3a\u771f\u5b9e\u89d2\u8272\u3002 <pre><code>IRobot.java\nRobot.java\nRobotProxy.java\n</code></pre></p> <p><code>IRobot</code> \u5b9a\u4e49\u4e863\u4e2a\u884c\u4e3a <pre><code>public interface IRobot {\n\n    void login(String name, String password);\n\n    void walk();\n\n    void fly();\n}\n</code></pre></p> <p><code>RobotProxy</code> \u4ee3\u7406\u4e2d\u6709\u4e00\u4e9b\u51c6\u5907\u5de5\u4f5c\u3002 <pre><code>public class RobotProxy implements IRobot {\n\n    private IRobot realRobot = null;\n\n    public RobotProxy(IRobot _robot) {\n        this.realRobot = _robot;\n    }\n\n    @Override\n    public void login(String name, String password) {\n        this.realRobot.login(name, password);\n    }\n\n    @Override\n    public void walk() {\n        System.out.println(\"Proxy prepares to walk\");\n        this.realRobot.walk();\n    }\n\n    @Override\n    public void fly() {\n        System.out.println(\"Proxy prepares to fly\");\n        this.realRobot.fly();\n    }\n}\n</code></pre></p> <p>\u771f\u5b9e\u89d2\u8272<code>Robot</code>\uff0c\u4f1a\u68c0\u67e5\u662f\u5426\u7ed9\u81ea\u5df1\u8bbe\u7f6e\u4e86\u4ee3\u7406\u3002\u5982\u679c\u6ca1\u6709\u4ee3\u7406\uff0c\u5219\u4e0d\u80fd\u64cd\u4f5c\u3002 \u771f\u5b9e\u89d2\u8272<code>Robot</code>\u6709\u81ea\u5df1\u7684name\uff0c\u63d0\u4f9b\u7528\u6237\u767b\u5f55\u529f\u80fd<code>login(String name, String password)</code> <pre><code>public class Robot implements IRobot {\n\n    private String name = \"\";\n    private IRobot proxy = null;\n\n    public Robot(String _name) {\n        this.name = _name;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    // get own proxy\n    public IRobot getProxy() {\n        this.proxy = new RobotProxy(this);\n        return this.proxy;\n    }\n\n    private boolean isProxyWorking() {\n        return null != this.proxy;\n    }\n\n    @Override\n    public void login(String name, String password) {\n        if (isProxyWorking()) {\n            printf(\"user login: \" + name);\n        } else {\n            outError();\n        }\n    }\n\n    @Override\n    public void walk() {\n        if (isProxyWorking()) {\n            printf(this.name + \" is walking.\");\n        } else {\n            outError();\n        }\n    }\n\n    @Override\n    public void fly() {\n        if (isProxyWorking()) {\n            printf(this.name + \" is flying.\");\n        } else {\n            outError();\n        }\n    }\n\n    private void printf(String msg) {\n        System.out.println(msg);\n    }\n\n    private void outError() {\n        printf(this.name + \": DENY! Please use proxy!\");\n    }\n\n}\n</code></pre></p> <p>\u6d4b\u8bd5\u4ee3\u7801\uff1anew\u4e00\u4e2a\u540d\u4e3a\"Wall-E\"\u7684Robot\uff0c\u4e0d\u540c\u7684\u7528\u6237\u8bd5\u56fe\u64cd\u4f5c\u8fd9\u4e2aRobot  \u7b2c\u4e00\u6b21\u5c1d\u8bd5\u76f4\u63a5\u64cd\u4f5c\uff0c\u4f1a\u5f97\u5230\u5931\u8d25\u4fe1\u606f\u3002\u7136\u540e\u83b7\u53d6robot\u7684\u4ee3\u7406robotProxy\u8fdb\u884c\u64cd\u4f5c\u3002 <pre><code>private static void testRobotProxy() {\n    Robot robot = new Robot(\"Wall-E\");\n    robot.login(\"Tom\", \"pwd\");\n    robot.walk();\n    robot.fly();\n    System.out.println(\"\");\n    RobotProxy robotProxy = (RobotProxy) robot.getProxy();\n    robotProxy.login(\"Jerry\", \"123\");\n    robotProxy.walk();\n    robotProxy.fly();\n}\n</code></pre></p> <p>\u8f93\u51fa <pre><code>Wall-E: DENY! Please use proxy!\nWall-E: DENY! Please use proxy!\nWall-E: DENY! Please use proxy!\n\nuser login: Jerry\nProxy prepares to walk\nWall-E is walking.\nProxy prepares to fly\nWall-E is flying.\n</code></pre></p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Proxy-Pattern/#_8","title":"\u4ee3\u7406\u6269\u5c55\u5b9e\u73b0\u4e0d\u540c\u4efb\u52a1","text":"<p>\u4ee3\u7406\u7c7b\u4e0d\u4ec5\u4ec5\u53ef\u4ee5\u5b9e\u73b0\u4e3b\u4f53\u63a5\u53e3\uff0c\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u5176\u4ed6\u63a5\u53e3\u5b8c\u6210\u4e0d\u540c\u7684\u4efb\u52a1\u3002\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u81ea\u5df1\u7684\u804c\u8d23\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Proxy-Pattern/#_9","title":"\u57fa\u4e8e\u5f3a\u5236\u4ee3\u7406\u6269\u5c55\u4ee3\u7406\u7c7b\u7684\u529f\u80fd\u4ee3\u7801","text":"<p>\u65b0\u589e\u63a5\u53e3 <pre><code>public interface IMessage {\n    String say(String msg);\n}\n</code></pre></p> <p>\u4ee3\u7406\u7c7b\u589e\u52a0\u5b9e\u73b0\u63a5\u53e3 <pre><code>public class RobotProxy implements IRobot, IMessage {\n\n    private IRobot realRobot = null;\n\n    public RobotProxy(IRobot _robot) {\n        this.realRobot = _robot;\n    }\n\n    @Override\n    public void login(String name, String password) {\n        this.realRobot.login(name, password);\n    }\n\n    @Override\n    public void walk() {\n        System.out.println(\"Proxy prepares to walk\");\n        this.realRobot.walk();\n    }\n\n    @Override\n    public void fly() {\n        System.out.println(\"Proxy prepares to fly\");\n        this.realRobot.fly();\n        say(\"Proxy: Flying high!\");\n    }\n\n    @Override\n    public String say(String msg) {\n        System.out.println(msg);\n        return msg;\n    }\n}\n</code></pre></p> <p>\u8fd0\u884c\u7ed3\u679c\uff08\u90e8\u5206\uff09 <pre><code>user login: Jerry\nProxy prepares to walk\nWall-E is walking.\nProxy prepares to fly\nWall-E is flying.\nProxy: Flying high!\n</code></pre></p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Proxy-Pattern/#_10","title":"\u52a8\u6001\u4ee3\u7406","text":"<p>\u5728\u5b9e\u73b0\u9636\u6bb5\u4e0d\u7528\u5173\u5fc3\u4ee3\u7406\u8c01\uff0c\u800c\u5728\u8fd0\u884c\u9636\u6bb5\u624d\u6307\u5b9a\u4ee3\u7406\u54ea\u4e00\u4e2a\u5bf9\u8c61\u3002 AOP\uff08Aspect Oriented Programming\uff09\u7684\u6838\u5fc3</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Proxy-Pattern/#_11","title":"\u52a8\u6001\u4ee3\u7406\u4ee3\u7801\u793a\u4f8b","text":"<p>\u6587\u4ef6\u76ee\u5f55 <pre><code>IVehicle\nTank\nVehicleIH\n</code></pre></p> <p>\u5b9a\u4e49\u8f66\u8f86\u63a5\u53e3 <code>IVehicle</code> <pre><code>public interface IVehicle {\n\n    void getIn(String username);\n\n    void forward();\n\n    void shoot();\n}\n</code></pre></p> <p>\u5b9a\u4e49\u4e00\u4e2a\u7c7b <code>Tank</code> \u5b9e\u73b0 <code>IVehicle</code> \u63a5\u53e3\u3002\u8fd9\u662f\u771f\u5b9e\u89d2\u8272\u3002 <pre><code>public class Tank implements IVehicle {\n\n    private String name = \"\";\n\n    public Tank(String _name) {\n        this.name = _name;\n    }\n\n    @Override\n    public void getIn(String username) {\n        System.out.println(username + \" got in tank\");\n    }\n\n    @Override\n    public void forward() {\n        System.out.println(this.name + \" forward\");\n    }\n\n    @Override\n    public void shoot() {\n        System.out.println(this.name + \" shoot!\");\n    }\n}\n</code></pre></p> <p>\u52a8\u6001\u4ee3\u7406\u7c7b\uff0c\u5b9e\u73b0<code>InvocationHandler</code>\u63a5\u53e3 \u5224\u65ad\u4f7f\u7528\u7684\u65b9\u6cd5\u540d\uff0c\u5e76\u53d1\u51fa\u81ea\u5b9a\u4e49\u901a\u77e5 <pre><code>import java.lang.reflect.InvocationHandler;\nimport java.lang.reflect.Method;\n\npublic class VehicleIH implements InvocationHandler {\n    Class cls = null;\n    Object obj = null;\n\n    public VehicleIH(Object _obj) {\n        this.obj = _obj;\n    }\n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        String methodName = method.getName();\n        if (methodName.equalsIgnoreCase(\"getIn\")) {\n            System.out.println(\"VehicleIH: Somebody got in!\");\n        } else if (methodName.equalsIgnoreCase(\"forward\")) {\n            System.out.println(\"VehicleIH: Forward!\");\n        }\n        return method.invoke(this.obj, args);\n    }\n}\n</code></pre></p> <p>\u6d4b\u8bd5\u4ee3\u7801 <pre><code>IVehicle tank = new Tank(\"59\");\nInvocationHandler handler = new VehicleIH(tank);\nClassLoader cl = handler.getClass().getClassLoader();\nIVehicle proxy = (IVehicle) \n    Proxy.newProxyInstance(cl, new Class[]{IVehicle.class}, handler);\nproxy.getIn(\"Conductor Liu\");\nproxy.forward();\nproxy.shoot();\n</code></pre></p> <p>\u8f93\u51fa <pre><code>VehicleIH: Somebody got in!\nConductor Liu got in tank\nVehicleIH: Forward!\n59 forward\n59 shoot!\n</code></pre></p> <p>\u53c2\u8003\uff1a \u300a\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u7985\u300b  \u79e6\u5c0f\u6ce2</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Responsibility-Chain-Pattern/","title":"\u8d23\u4efb\u94fe\u6a21\u5f0f Responsibility Chain Pattern","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Responsibility-Chain-Pattern/#_1","title":"\u5b9a\u4e49","text":"<p>\u4f7f\u591a\u4e2a\u5bf9\u8c61\u90fd\u6709\u673a\u4f1a\u5904\u7406\u8bf7\u6c42\uff0c\u4ece\u800c\u907f\u514d\u4e86\u8bf7\u6c42\u7684\u53d1\u9001\u8005\u548c\u63a5\u53d7\u8005\u4e4b\u95f4\u7684\u8026\u5408\u5173\u7cfb\u3002 \u5c06\u8fd9\u4e9b\u5bf9\u8c61\u8fde\u6210\u4e00\u6761\u94fe\uff0c\u5e76\u6cbf\u7740\u8fd9\u6761\u94fe\u4f20\u9012\u8be5\u8bf7\u6c42\uff0c\u76f4\u5230\u6709\u5bf9\u8c61\u5904\u7406\u5b83\u4e3a\u6b62\u3002 Avoid coupling the sender of a request to its receiver by giving more than  one object a chance to handle the request. Chain the receiving objects and  pass the request along the chain until an object handles it.</p> <p>\u6bcf\u4e2a\u5904\u7406\u8005\u90fd\u5fc5\u987b\u5224\u65ad\u8bf7\u6c42\uff0c\u5982\u679c\u7b26\u5408\u6761\u4ef6\u5219\u8fdb\u884c\u5904\u7406\uff0c\u5426\u5219\u5c31\u4ea4\u7ed9\u4e0b\u4e00\u4e2a\u5904\u7406\u8005\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Responsibility-Chain-Pattern/#_2","title":"\u4f18\u7f3a\u70b9","text":"<p>\u6709\u70b9\u662f\u5c06\u8bf7\u6c42\u548c\u5904\u7406\u5206\u5f00\u3002\u8bf7\u6c42\u8005\u53ef\u4ee5\u4e0d\u77e5\u9053\u662f\u8c01\u5904\u7406\u7684\uff0c\u5904\u7406\u8005\u53ef\u4ee5\u4e0d\u77e5\u9053\u8bf7\u6c42\u7684\u5168\u8c8c\u3002</p> <p>\u7f3a\u70b9\uff1a\u6027\u80fd\u53ef\u80fd\u4f1a\u4e0d\u597d\uff0c\u6bcf\u4e2a\u8bf7\u6c42\u90fd\u662f\u9010\u6b21\u5f80\u540e\u5904\u7406\u3002\u8c03\u8bd5\u4e0d\u7b97\u65b9\u4fbf\u3002</p> <p>\u5904\u7406\u8005\u94fe\u4e2d\u7684\u8282\u70b9\u9700\u8981\u63a7\u5236\uff0c\u4e0d\u80fd\u51fa\u73b0\u8fc7\u957f\u7684\u60c5\u51b5\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Responsibility-Chain-Pattern/#_3","title":"\u4ee3\u7801\u793a\u4f8b","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Responsibility-Chain-Pattern/#1","title":"\u94fe\u5f0f\u5904\u7406\u793a\u4f8b1","text":"<p>\u5b9a\u4e49\u4e00\u4e2a\u5904\u7406\u4efb\u52a1\u7684\u62bd\u8c61\u7c7b<code>Handler</code> <pre><code>public abstract class Handler {\n\n    private Handler nextHandler;\n\n    public final Response handleMessage(Request request) {\n        Response response = new Response(Response.ERROR);\n        if (this.getHandlerLevel().equals(request.getRequestLevel())) {\n            response = this.deal(request);\n        } else {\n            if (null != this.nextHandler) {\n                response = this.nextHandler.handleMessage(request);\n            } else {\n                System.out.println(\"WARNING: no handler to: \" + request.toString());\n            }\n        }\n        return response;\n    }\n\n    public void setNextHandler(Handler handler) {\n        this.nextHandler = handler;\n    }\n\n    protected abstract Level getHandlerLevel();\n\n    protected abstract Response deal(Request request);\n\n}\n</code></pre> \u5b9a\u4e49\u4e86\u4e00\u4e2a\u8bf7\u6c42\u7684\u5904\u7406\u65b9\u6cd5<code>handleMessage</code> <code>setNextHandler</code>\u662f\u94fe\u7684\u7f16\u6392\u65b9\u6cd5\uff0c\u8bbe\u7f6e\u4e0b\u4e00\u4e2a\u5904\u7406\u8005 <code>getHandlerLevel</code>\u548c<code>deal</code>\u662f\u5177\u4f53\u7684\u8bf7\u6c42\u8005\u5fc5\u987b\u5b9e\u73b0\u7684\u65b9\u6cd5</p> <p>\u6838\u5fc3\u6587\u4ef6 <pre><code>ResponsibilityChain/\n|-- define\n|   |-- Handler.java        // \u62bd\u8c61\u7684\u5904\u7406\u8005\n|   |-- Level.java          // \u4efb\u52a1\u7b49\u7ea7\u5b9a\u4e49\n|   |-- Request.java        // \u8bf7\u6c42\n|   `-- Response.java       // \u56de\u5e94\uff0c\u5904\u7406\u7ed3\u679c\n|-- handler                 // \u5177\u4f53\u7684\u5904\u7406\u8005\n|   |-- Level1Manager.java\n|   |-- Level2Manager.java\n|   `-- Level3Manager.java\n`-- TestMain.java           // \u6d4b\u8bd5\u4ee3\u7801\n</code></pre></p> <p><code>define</code> \u5305\u5185\u7684 <code>Level</code>\uff0c <code>Request</code>\uff0c <code>Response</code> \u7c7b <pre><code>public class Level {\n\n    private int intLevel;\n\n    public Level(int levelInt) {\n        this.intLevel = levelInt;\n    }\n\n    public int getIntLevel() {\n        return intLevel;\n    }\n\n    @Override\n    public boolean equals(Object obj) {\n        if (obj == null) {\n            return false;\n        }\n        if (obj instanceof Level) {\n            Level other = (Level) obj;\n            return other.getIntLevel() == this.getIntLevel();\n        }\n        return false;\n    }\n}\n\npublic class Request {\n\n    private String name;\n    private Level requestLevel;\n\n    public Request(Level level, String name) {\n        this.requestLevel = level;\n        this.name = name;\n    }\n\n    public Level getRequestLevel() {\n        return this.requestLevel;\n    }\n\n    public String getName() {\n        return name;\n    }\n\n    @Override\n    public String toString() {\n        return String.format(Locale.ENGLISH, \"[%s, %d]\", name, getRequestLevel().getIntLevel());\n    }\n}\n\npublic class Response {\n\n    public static final String ERROR = \"NO_RESPONSE\";\n\n    private String resStr = ERROR;\n\n    public Response(String res) {\n        this.resStr = res;\n    }\n\n    public String getResStr() {\n        return resStr;\n    }\n\n    public void printRes() {\n        System.out.println(resStr);\n    }\n}\n</code></pre></p> <p>\u5177\u4f53\u7684\u5904\u7406\u8005\u7c7b\u5728<code>handler</code>\u5305\u5185 <pre><code>public class Level1Manager extends Handler {\n\n    private Level level = new Level(1);\n\n    @Override\n    protected Level getHandlerLevel() {\n        return level;\n    }\n\n    @Override\n    protected Response deal(Request request) {\n        return new Response(this.getClass().getSimpleName() + \" handled this request\");\n    }\n\n}\n\npublic class Level2Manager extends Handler {\n\n    private Level level = new Level(2);\n\n    @Override\n    protected Level getHandlerLevel() {\n        return this.level;\n    }\n\n    @Override\n    protected Response deal(Request request) {\n        return new Response(this.getClass().getSimpleName() + \" handled \" + request.toString());\n    }\n}\n\npublic class Level3Manager extends Handler {\n\n    private Level level = new Level(3);\n\n    @Override\n    protected Level getHandlerLevel() {\n        return this.level;\n    }\n\n    @Override\n    protected Response deal(Request request) {\n        return new Response(this.getClass().getSimpleName() + \" handled \" + request.toString());\n    }\n}\n</code></pre></p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/Responsibility-Chain-Pattern/#_4","title":"\u6d4b\u8bd5\u4ee3\u7801","text":"<p>\u5148\u5b9a\u4e49\u5177\u4f53\u7684\u5904\u7406\u8005\uff0c\u5e76\u6784\u5efa\u5904\u7406\u94fe \u5b9a\u4e49\u4e0d\u540c\u7684\u8bf7\u6c42\uff0c\u5904\u7406\u8005\u5904\u7406\u8fd9\u4e9b\u8bf7\u6c42 <pre><code>Level1Manager level1Manager = new Level1Manager();\nLevel2Manager level2Manager = new Level2Manager();\nLevel3Manager level3Manager = new Level3Manager();\n\nlevel1Manager.setNextHandler(level2Manager);\nlevel2Manager.setNextHandler(level3Manager);\n\nRequest request1 = new Request(new Level(1), \"OA-1\");\nRequest request2 = new Request(new Level(2), \"OA-2\");\nRequest request3 = new Request(new Level(3), \"OA-3\");\nlevel1Manager.handleMessage(request2).printRes();\nlevel2Manager.handleMessage(request1).printRes();\nlevel3Manager.handleMessage(request3).printRes();\n</code></pre></p> <p>\u8f93\u51fa <pre><code>Level2Manager handled [OA-2, 2]\nWARNING: no handler to: [OA-1, 1]\nNO_RESPONSE\nLevel3Manager handled [OA-3, 3]\n</code></pre></p> <p>\u53c2\u8003\uff1a\u300a\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u7985\u300b  \u79e6\u5c0f\u6ce2</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f"]},{"location":"designPattern/State-Pattern/","title":"\u72b6\u6001\u6a21\u5f0f State Pattern","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/State-Pattern/#_1","title":"\u5b9a\u4e49","text":"<p>\u5f53\u4e00\u4e2a\u5bf9\u8c61\u5185\u5728\u72b6\u6001\u6539\u53d8\u65f6\u5141\u8bb8\u5176\u6539\u53d8\u884c\u4e3a\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u770b\u8d77\u6765\u60f3\u6539\u53d8\u4e86\u5176\u7c7b\u3002</p> <p>\u72b6\u6001\u6a21\u5f0f\u7684\u6838\u5fc3\u662f\u5c01\u88c5\uff0c\u72b6\u6001\u7684\u53d8\u66f4\u5f15\u8d77\u4e86\u884c\u4e3a\u7684\u53d8\u66f4\uff0c\u4ece\u5916\u90e8\u770b\u8d77\u6765\u5c31\u597d\u50cf\u8fd9\u4e2a\u5bf9\u8c61\u5bf9\u5e94\u7684 \u7c7b\u53d1\u751f\u4e86\u6539\u53d8\u4e00\u6837\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/State-Pattern/#_2","title":"\u5e94\u7528","text":"<p>\u4f18\u70b9\uff1a</p> <ul> <li>\u7ed3\u6784\u6e05\u6670\uff0c\u907f\u514d\u4e86\u8fc7\u591a\u7684if..else\u6216switch</li> <li>\u9075\u5faa\u4e86\u5f00\u95ed\u539f\u5219\u548c\u5355\u4e00\u804c\u8d23\u539f\u5219\uff0c\u6bcf\u4e2a\u72b6\u6001\u90fd\u662f\u4e00\u4e2a\u5b50\u7c7b</li> <li>\u5c01\u88c5\u6027\u597d\uff0c\u72b6\u6001\u53d8\u6362\u653e\u7f6e\u5230\u7c7b\u7684\u5185\u90e8\u5b9e\u73b0</li> </ul> <p>\u7f3a\u70b9\uff1a</p> <ul> <li>\u5b50\u7c7b\u6570\u91cf\u4f1a\u592a\u591a</li> </ul> <p>\u4f7f\u7528\u573a\u666f\uff1a \u884c\u4e3a\u968f\u72b6\u6001\u6539\u53d8\u800c\u6539\u53d8\u7684\u573a\u666f \u6761\u4ef6\u3001\u5206\u652f\u8bed\u53e5\u7684\u66ff\u4ee3\u8005</p> <p>\u5728\u5199\u63a7\u5236\u65e0\u4eba\u673a\u7684\u72b6\u6001\u7684\u5fc3\u5f97\uff1a\u8981\u8ba9\u72b6\u6001\u4e4b\u95f4\u7684\u8df3\u8f6c\u5f62\u6210\u4e00\u4e2a\u95ed\u73af\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/State-Pattern/#_3","title":"\u4ee3\u7801\u793a\u4f8b","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/State-Pattern/#_4","title":"\u6a21\u62df\u7535\u68af\u793a\u4f8b","text":"<p>\u6a21\u62df\u4e00\u90e8\u7535\u68af\u3002\u7535\u68af\u6709\u591a\u79cd\u72b6\u6001\u3002 \u4ee3\u7801\u76ee\u5f55 <pre><code>LiftContext             // \u64cd\u63a7\u8005\nLiftState               // \u72b6\u6001\u62bd\u8c61\u7c7b\nClosingState            // \u5173\u95e8\nOpeningState            // \u5f00\u95e8\nRunningState            // \u4e0a\u4e0b\u8fd0\u884c\nStoppingAndCloseState   // \u505c\u6b62\u5e76\u4e14\u95e8\u5173\u7740\nStoppingAndOpenState    // \u505c\u6b62\u5e76\u4e14\u95e8\u5f00\u7740\n</code></pre></p> <p>\u5404\u4e2a\u72b6\u6001\u7684\u4ee3\u7801 <pre><code>public abstract class LiftState {\n\n    protected LiftContext liftContext;\n\n    public void setLiftContext(LiftContext liftContext) {\n        this.liftContext = liftContext;\n    }\n\n    public abstract void openDoor();\n\n    public abstract void closeDoor();\n\n    public abstract void run();\n\n    public abstract void stop();\n}\n\npublic class ClosingState extends LiftState {\n    @Override\n    public void openDoor() {\n        super.liftContext.setLiftState(LiftContext.OPENING_STATE);\n        super.liftContext.openDoor();\n    }\n\n    @Override\n    public void closeDoor() {\n        System.out.println(\"Close door\");\n    }\n\n    @Override\n    public void run() {\n        super.liftContext.setLiftState(LiftContext.RUNNING_STATE);\n        super.liftContext.run();\n    }\n\n    @Override\n    public void stop() {\n        super.liftContext.setLiftState(LiftContext.STOPPING_AND_CLOSE_STATE);\n        super.liftContext.stop();\n    }\n}\n\npublic class OpeningState extends LiftState {\n    @Override\n    public void openDoor() {\n        System.out.println(\"open the door\");\n    }\n\n    @Override\n    public void closeDoor() {\n        super.liftContext.setLiftState(LiftContext.CLOSING_STATE);\n        super.liftContext.closeDoor();\n    }\n\n    @Override\n    public void run() {\n        System.out.println(\"(Opening, I can not run)\"); // can't run now\n    }\n\n    @Override\n    public void stop() {\n        // already stopped, do nothing. But door is open\n    }\n}\n\npublic class RunningState extends LiftState {\n    @Override\n    public void openDoor() {\n        System.out.println(\"(Running, can't open door)\");\n    }\n\n    @Override\n    public void closeDoor() {\n        System.out.println(\"(Running, the door is already closed)\");\n    }\n\n    @Override\n    public void run() {\n        System.out.println(\"Running up or down...\");\n    }\n\n    @Override\n    public void stop() {\n        super.liftContext.setLiftState(LiftContext.STOPPING_AND_CLOSE_STATE);\n        super.liftContext.stop();\n    }\n}\n\npublic class StoppingAndCloseState extends LiftState {\n    @Override\n    public void openDoor() {\n        super.liftContext.setLiftState(LiftContext.STOPPING_AND_OPEN_STATE);\n        super.liftContext.openDoor();\n    }\n\n    @Override\n    public void closeDoor() {\n        System.out.println(\"close the door\");\n    }\n\n    @Override\n    public void run() {\n        super.liftContext.setLiftState(LiftContext.RUNNING_STATE);\n        super.liftContext.run();\n    }\n\n    @Override\n    public void stop() {\n        System.out.println(\"Stop and door is close\");\n    }\n}\n\npublic class StoppingAndOpenState extends LiftState {\n    @Override\n    public void openDoor() {\n        System.out.println(\"open the door\");\n    }\n\n    @Override\n    public void closeDoor() {\n        super.liftContext.setLiftState(LiftContext.STOPPING_AND_CLOSE_STATE);\n        super.liftContext.closeDoor();\n    }\n\n    @Override\n    public void run() {\n        System.out.println(\"(can't run, please close the door first!)\");\n    }\n\n    @Override\n    public void stop() {\n        System.out.println(\"(already open)\");\n    }\n}\n</code></pre></p> <p>\u7535\u68afContext\u4ee3\u7801\uff1b\u4f9d\u8d56\u4e8e\u5404\u4e2a\u5177\u4f53\u72b6\u6001\u7c7b <pre><code>public class LiftContext {\n\n    public final static OpeningState OPENING_STATE = new OpeningState();\n    public final static ClosingState CLOSING_STATE = new ClosingState();\n    public final static RunningState RUNNING_STATE = new RunningState();\n    public final static StoppingAndCloseState STOPPING_AND_CLOSE_STATE = new StoppingAndCloseState();\n    public final static StoppingAndOpenState STOPPING_AND_OPEN_STATE = new StoppingAndOpenState();\n\n    private LiftState liftState;\n\n    public LiftState getLiftState() {\n        return liftState;\n    }\n\n    public void setLiftState(LiftState liftState) {\n        this.liftState = liftState;\n        this.liftState.setLiftContext(this);\n    }\n\n    public void openDoor() {\n        this.liftState.openDoor();\n    }\n\n    public void closeDoor() {\n        this.liftState.closeDoor();\n    }\n\n    public void run() {\n        this.liftState.run();\n    }\n\n    public void stop() {\n        this.liftState.stop();\n    }\n}\n</code></pre></p> <p>\u6d4b\u8bd5\u4ee3\u7801\uff0c\u6a21\u62df\u7535\u68af\u7684\u4e00\u6bb5\u8fd0\u884c\u72b6\u6001 <pre><code>LiftContext liftContext = new LiftContext();\nliftContext.setLiftState(LiftContext.STOPPING_AND_CLOSE_STATE);\nliftContext.closeDoor();\nliftContext.openDoor();// somebody goes in\nliftContext.closeDoor();\nliftContext.run();\nliftContext.stop();\nliftContext.openDoor();// somebody leaves\nliftContext.run();\nliftContext.stop();\nliftContext.closeDoor();\nliftContext.run();\nliftContext.openDoor();\n\n/* \u63a7\u5236\u53f0\u8f93\u51fa\nclose the door\nopen the door\nclose the door\nRunning up or down...\nStop and door is close\nopen the door\n(can't run, please close the door first!)\n(already open)\nclose the door\nRunning up or down...\n(Running, can't open door)\n*/\n</code></pre></p> <p>\u53c2\u8003\uff1a\u300a\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u7985\u300b  \u79e6\u5c0f\u6ce2</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Strategy-Pattern/","title":"\u7b56\u7565\u6a21\u5f0f Strategy Pattern","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Strategy-Pattern/#_1","title":"\u5b9a\u4e49","text":"<p>Define a family of algorithm, encapsulate each one, and make them  interchangeable.</p> <p>\u5b9a\u4e49\u4e00\u7ec4\u7b97\u6cd5\uff0c\u5e76\u5c06\u6bcf\u4e2a\u7b97\u6cd5\u90fd\u5c01\u88c5\u8d77\u6765\uff0c\u5e76\u4e14\u4f7f\u5b83\u4eec\u4e4b\u95f4\u53ef\u4ee5\u4e92\u76f8\u66ff\u6362\u3002</p> <p>\u5e38\u89c1\u7ed3\u6784 <pre><code>Strategy            // \u62bd\u8c61\u7684\u7b56\u7565\u89d2\u8272\nConcreteStrategy    // \u5177\u4f53\u7684\u7b56\u7565\u7c7b\nContext             // \u6301\u6709\u7b56\u7565\u5b9e\u4f8b\n</code></pre></p> <p>\u7b56\u7565\u6a21\u5f0f\u7684\u91cd\u70b9\u662f\u5c01\u88c5\u89d2\u8272\uff0c\u501f\u7528\u4e86\u4ee3\u7406\u6a21\u5f0f\u7684\u601d\u8def\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Strategy-Pattern/#_2","title":"\u5e94\u7528","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Strategy-Pattern/#_3","title":"\u4f18\u70b9","text":"<ul> <li>\u7b97\u6cd5\u53ef\u4ee5\u81ea\u7531\u5207\u6362</li> <li>\u907f\u514d\u4f7f\u7528\u591a\u91cd\u6761\u4ef6\u5224\u65ad</li> <li>\u6269\u5c55\u6027\u826f\u597d</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Strategy-Pattern/#_4","title":"\u7f3a\u70b9","text":"<ul> <li>\u7b56\u7565\u7c7b\u6570\u91cf\u589e\u591a  \u6bcf\u4e00\u4e2a\u7b56\u7565\u90fd\u662f\u4e00\u4e2a\u7c7b\uff0c\u590d\u7528\u7684\u53ef\u80fd\u6027\u5c0f\uff0c\u7c7b\u6570\u91cf\u5f88\u591a</li> <li>\u6240\u6709\u7684\u7b56\u7565\u7c7b\u90fd\u9700\u8981\u5bf9\u5916\u66b4\u9732</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Strategy-Pattern/#_5","title":"\u4f7f\u7528\u573a\u666f","text":"<ul> <li>\u591a\u4e2a\u7c7b\u53ea\u6709\u5728\u7b97\u6cd5\u6216\u8005\u884c\u4e3a\u4e0a\u7a0d\u6709\u4e0d\u540c\u7684\u573a\u666f</li> <li>\u7b97\u6cd5\u9700\u8981\u81ea\u7531\u5207\u6362\u7684\u573a\u666f</li> <li>\u9700\u8981\u5c4f\u853d\u7b97\u6cd5\u89c4\u5219\u7684\u573a\u666f</li> </ul> <p>\u6ce8\u610f\u4e8b\u9879\uff0c\u5982\u679c\u7cfb\u7edf\u4e2d\u7684\u4e00\u4e2a\u7b56\u7565\u5bb6\u65cf\u7684\u5177\u4f53\u7b56\u7565\u6570\u91cf\u8d85\u8fc74\u4e2a\uff0c\u5219\u9700\u8003\u8651\u4f7f\u7528\u6df7\u5408\u6a21\u5f0f\uff0c\u89e3\u51b3\u7b56\u7565\u7c7b \u81a8\u80c0\u548c\u5bf9\u5916\u66b4\u9732\u7684\u95ee\u9898\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Strategy-Pattern/#_6","title":"\u4ee3\u7801\u793a\u4f8b","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Strategy-Pattern/#_7","title":"\u7b56\u7565\u6a21\u5f0f\u793a\u4f8b","text":"<p>\u6587\u4ef6\u76ee\u5f55 <pre><code>strategy/\n|-- Add.java            // \u5177\u4f53\u7684\u7b56\u7565\n|-- Division.java       // \u5177\u4f53\u7684\u7b56\u7565\n|-- IStrategy.java      // \u7b56\u7565\u63a5\u53e3\n|-- Minus.java          // \u5177\u4f53\u7684\u7b56\u7565\n|-- Paper.java          // \u6d4b\u8bd5\u4ee3\u7801\n`-- StrategyContext.java// \u4e0a\u4e0b\u6587\u89d2\u8272\uff0c\u627f\u4e0a\u542f\u4e0b\n</code></pre></p> <p>\u9996\u5148\u770b\u7b56\u7565\u63a5\u53e3\u7c7b\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2a\u65b9\u6cd5 <pre><code>public interface IStrategy {\n\n    float compute(float a, float b);\n\n}\n</code></pre></p> <p>\u4e0a\u4e0b\u6587\u7c7b\uff0c\u5c4f\u853d\u4e86\u9ad8\u5c42\u6a21\u5757\u5bf9\u7b56\u7565\u3001\u7b97\u6cd5\u7684\u76f4\u63a5\u8bbf\u95ee <pre><code>public class StrategyContext {\n    private IStrategy strategy;\n\n    public void setStrategy(IStrategy strategy) {\n        this.strategy = strategy;\n    }\n\n    public StrategyContext(IStrategy strategy) {\n        this.strategy = strategy;\n    }\n\n    public float calculate(float a, float b) {\n       return this.strategy.compute(a, b);\n    }\n\n}\n</code></pre></p> <p>\u5177\u4f53\u7684\u7b56\u7565\u7c7b <pre><code>public class Add implements IStrategy {\n    @Override\n    public float compute(float a, float b) {\n        return a + b;\n    }\n}\npublic class Minus implements IStrategy {\n    @Override\n    public float compute(float a, float b) {\n        return a - b;\n    }\n}\npublic class Division implements IStrategy {\n    @Override\n    public float compute(float a, float b) {\n        return a / b;\n    }\n}\n</code></pre></p> <p>\u6d4b\u8bd5\u4ee3\u7801 <pre><code>StrategyContext context = new StrategyContext(new Add());\nSystem.out.println(\"Add Res = \" + context.calculate(1, 3));\ncontext.setStrategy(new Minus());\nSystem.out.println(\"Minus Res = \" + context.calculate(14, 8));\ncontext.setStrategy(new Division());\nSystem.out.println(\"Division Res = \" + context.calculate(12, 5));\n</code></pre></p> <p>output <pre><code>Add Res = 4.0\nMinus Res = 6.0\nDivision Res = 2.4\n</code></pre></p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Strategy-Pattern/#_8","title":"\u679a\u4e3e\u7b56\u7565\u793a\u4f8b","text":"<p>\u4f7f\u7528\u679a\u4e3e\u7c7b\u6765\u5c01\u88c5\u7b56\u7565\u3002 <pre><code>public enum Calculator {\n    ADD(\"+\") {\n        public float exec(float a, float b) {\n            return a + b;\n        }\n    },\n    SUB(\"-\") {\n        public float exec(float a, float b) {\n            return a - b;\n        }\n    };\n    String value;\n\n    Calculator(String _value) {\n        this.value = _value;\n    }\n\n    public String getValue() {\n        return value;\n    }\n\n    public abstract float exec(float a, float b);\n}\n</code></pre></p> <p>\u6d4b\u8bd5\u4ee3\u7801\u548c\u8f93\u51fa <pre><code>    System.out.println(\"ENUM ADD Res = \" + Calculator.ADD.exec(12, 5));\n    System.out.println(\"ENUM SUB Res = \" + Calculator.SUB.exec(2, 5));\n\n// output\nENUM ADD Res = 17.0\nENUM SUB Res = -3.0\n</code></pre></p> <p>\u53c2\u8003\uff1a\u300a\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u7985\u300b  \u79e6\u5c0f\u6ce2</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Template-Method-Pattern_Java/","title":"\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f Template Method Pattern","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Template-Method-Pattern_Java/#_1","title":"\u5b9a\u4e49","text":"<p>Define the skeleton of an algorithm in an openration, deferring  some steps to subclasses.Template Method lets subclasses redifine  centain steps of an algorithm without changing the algorithm's structure.</p> <p>\u57fa\u672c\u65b9\u6cd5\uff1a \u4e5f\u53eb\u57fa\u672c\u64cd\u4f5c\uff0c\u7531\u5b50\u7c7b\u5b9e\u73b0\uff0c\u5e76\u4e14\u5728\u6a21\u677f\u65b9\u6cd5\u4e2d\u88ab\u8c03\u7528\u3002</p> <p>\u6a21\u677f\u65b9\u6cd5\uff1a \u53ef\u4ee5\u6709\u4e00\u4e2a\u6216\u51e0\u4e2a\uff0c\u4e00\u822c\u662f\u4e00\u4e2a\u5177\u4f53\u7684\u65b9\u6cd5\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u6846\u67b6\uff0c\u5b9e\u73b0\u5bf9\u57fa\u672c\u65b9\u6cd5\u7684\u8c03\u5ea6\uff0c\u5b8c\u6210\u56fa\u5b9a\u7684\u903b\u8f91\u3002</p> <p>\u4e3a\u9632\u6b62\u6076\u610f\u7684\u64cd\u4f5c\uff0c\u4e00\u822c\u6a21\u677f\u65b9\u6cd5\u90fd\u52a0\u4e0afinal\u5173\u952e\u5b57\uff0c\u4e0d\u5141\u8bb8\u88ab\u8986\u5199\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Template-Method-Pattern_Java/#_2","title":"\u5e94\u7528","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Template-Method-Pattern_Java/#_3","title":"\u4f18\u70b9","text":"<ul> <li>\u5c01\u88c5\u4e0d\u53d8\u90e8\u5206\uff0c\u6269\u5c55\u53ef\u53d8\u90e8\u5206</li> <li>\u63d0\u53d6\u516c\u5171\u90e8\u5206\u4ee3\u7801\uff0c\u4fbf\u4e8e\u7ef4\u62a4</li> <li>\u884c\u4e3a\u7531\u7236\u7c7b\u63a7\u5236\uff0c\u5b50\u7c7b\u5b9e\u73b0</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Template-Method-Pattern_Java/#_4","title":"\u4f7f\u7528\u573a\u666f","text":"<ul> <li>\u591a\u4e2a\u5b50\u7c7b\u6709\u516c\u6709\u7684\u65b9\u6cd5\uff0c\u5e76\u4e14\u57fa\u672c\u903b\u8f91\u76f8\u540c</li> <li>\u91cd\u8981\u3001\u590d\u6742\u7684\u7b97\u6cd5\uff0c\u53ef\u4ee5\u628a\u6838\u5fc3\u7b97\u6cd5\u8bbe\u8ba1\u4e3a\u6a21\u677f\u65b9\u6cd5\uff0c\u7ec6\u8282\u7531\u5b50\u7c7b\u5b9e\u73b0</li> <li>\uff08\u91cd\u6784\u65f6\uff09\u628a\u76f8\u540c\u4ee3\u7801\u63d0\u53d6\u5230\u7236\u7c7b\u4e2d\uff0c\u7136\u540e\u901a\u8fc7\u94a9\u5b50\u51fd\u6570\u7ea6\u675f\u5176\u884c\u4e3a</li> </ul> <p>\u7236\u7c7b\u4e2d\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e9b\u5c5e\u6027\uff0c\u5b50\u7c7b\u53ef\u4ee5\u53bb\u8986\u76d6\u8fd9\u4e9b\u5c5e\u6027\u6765\u6539\u53d8\u884c\u4e3a\u3002</p> <p>\u53c2\u8003\uff1a\u300a\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u7985\u300b  \u79e6\u5c0f\u6ce2</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Visitor-Pattern/","title":"\u8bbf\u95ee\u8005\u6a21\u5f0f Visitor Pattern","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-6-1 <ul> <li>2022-6-1\uff1a\u66f4\u65b0\u683c\u5f0f</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Visitor-Pattern/#_1","title":"\u5b9a\u4e49","text":"<p>\u5c01\u88c5\u4e00\u4e9b\u4f5c\u7528\u4e8e\u67d0\u79cd\u6570\u636e\u7ed3\u6784\u4e2d\u7684\u5404\u5143\u7d20\u7684\u64cd\u4f5c\uff0c\u5b83\u53ef\u4ee5\u5728\u4e0d\u6539\u53d8\u6570\u636e\u7ed3\u6784\u7684\u524d\u63d0\u4e0b\u5b9a\u4e49\u4f5c\u7528\u4e8e\u8fd9\u4e9b\u5143\u7d20\u7684\u65b0\u7684\u64cd\u4f5c\u3002</p> <p>\u901a\u7528\u6e90\u7801\u7ed3\u6784 <pre><code>IVisitor        // \u8bbf\u95ee\u8005\u63a5\u53e3\nVisitor         // \u5177\u4f53\u8bbf\u95ee\u8005\nElement         // \u62bd\u8c61\u5143\u7d20\u7c7b\nConcreteElement1// \u5177\u4f53\u5143\u7d20\u7c7b1\nConcreteElement2// \u5177\u4f53\u5143\u7d20\u7c7b2\nObjectStructure // \u7ed3\u6784\u5bf9\u8c61 - \u6682\u65f6\u7528\u4e8e\u4ea7\u751f\u5177\u4f53\u5143\u7d20\n</code></pre></p> <p>\u5143\u7d20\u62bd\u8c61\u7c7b\u548c\u5177\u4f53\u5143\u7d20\u7c7b <pre><code>public abstract class Element {\n\n    public abstract void doSomething();\n\n    public abstract void accept(IVisitor visitor); // \u4f9d\u8d56\u8bbf\u95ee\u8005\u63a5\u53e3\n\n}\n\n// \u5177\u4f53\u5143\u7d20\u7c7b1\npublic class ConcreteElement1 extends Element {\n    @Override\n    public void doSomething() {\n        // \u4e1a\u52a1\u903b\u8f91\u653e\u8fd9\u91cc\n        System.out.println(getClass().getSimpleName() + \" do something.\");\n    }\n\n    @Override\n    public void accept(IVisitor visitor) {\n        visitor.visit(this); // \u5c06\u81ea\u8eab\u4f20\u5165\u6765\u8bbf\u8005\n    }\n}\npublic class ConcreteElement2 extends Element {\n    @Override\n    public void doSomething() {\n        System.out.println(getClass().getSimpleName() + \" do something.\");\n    }\n\n    @Override\n    public void accept(IVisitor visitor) {\n        visitor.visit(this); // \u5c06\u81ea\u8eab\u4f20\u5165\u6765\u8bbf\u8005\n    }\n}\n</code></pre></p> <p>\u8bbf\u95ee\u8005\u63a5\u53e3\uff0c\u4f9d\u8d56\u4e86\u5177\u4f53\u7684\u5143\u7d20\u7c7b <pre><code>public interface IVisitor {\n\n    void visit(ConcreteElement1 element1);\n\n    void visit(ConcreteElement2 element2);\n}\n\npublic class Visitor implements IVisitor {\n\n    @Override\n    public void visit(ConcreteElement1 element1) {\n        element1.doSomething(); // \u5b9e\u73b0\u5177\u4f53\u7684\u8bbf\u95ee\u64cd\u4f5c\n    }\n\n    @Override\n    public void visit(ConcreteElement2 element2) {\n        element2.doSomething();\n    }\n}\n</code></pre></p> <p>\u7ed3\u6784\u5bf9\u8c61 - \u6682\u65f6\u7528\u4e8e\u4ea7\u751f\u5177\u4f53\u5143\u7d20 <pre><code>// \u751f\u6210\u5177\u4f53\u7684\u5143\u7d20\u7c7b\npublic class ObjectStructure {\n    public static Element createElement() {\n        Random random = new Random();// \u968f\u673a\u4ea7\u751f\u4e00\u4e9b\u5177\u4f53\u5143\u7d20\u7c7b\u5b9e\u4f8b\n        if (random.nextInt(100) &gt; 50) {\n            return new ConcreteElement1();\n        } else {\n            return new ConcreteElement2();\n        }\n    }\n}\n</code></pre></p> <p>\u6d4b\u8bd5\u4ee3\u7801 <pre><code>Visitor visitor = new Visitor();\nfor (int i = 0; i &lt; 4; i++) {\n    Element el = ObjectStructure.createElement();\n    el.accept(visitor);\n}\n\n/*\n output\n ConcreteElement1 do something.\n ConcreteElement2 do something.\n ConcreteElement2 do something.\n ConcreteElement2 do something.\n */\n</code></pre></p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Visitor-Pattern/#_2","title":"\u8bbf\u95ee\u8005\u6a21\u5f0f\u7684\u5e94\u7528","text":"","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Visitor-Pattern/#_3","title":"\u4f18\u70b9","text":"<ul> <li>\u7b26\u5408\u5355\u4e00\u804c\u8d23\u539f\u5219 \u5177\u4f53\u5143\u7d20\u89d2\u8272\u8d1f\u8d23\u6570\u636e\u7684\u52a0\u8f7d\uff0c\u800c\u8bbf\u95ee\u8005\u8d1f\u8d23\u6570\u636e\u7684\u5c55\u73b0\u3002</li> <li>\u6269\u5c55\u6027\u597d\uff0c\u7075\u6d3b\u6027\u9ad8 \u804c\u8d23\u5206\u5f00\uff0c\u8bbf\u95ee\u8005\u53ef\u4ee5\u7075\u6d3b\u7684\u6269\u5c55\u65b9\u6cd5</li> </ul>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Visitor-Pattern/#_4","title":"\u7f3a\u70b9","text":"<p>\u5177\u4f53\u5143\u7d20\u5bf9\u8bbf\u95ee\u8005\u516c\u5e03\u7ec6\u8282 \u8bbf\u95ee\u8005\u8981\u8bbf\u95ee\u4e00\u4e2a\u7c7b\u5c31\u5fc5\u7136\u8981\u6c42\u8fd9\u4e2a\u7c7b\u516c\u5e03\u4e00\u4e9b\u65b9\u6cd5\u548c\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u8bbf\u95ee\u8005\u5173\u6ce8\u4e86\u5176\u4ed6\u7c7b\u7684\u5185\u90e8 \u7ec6\u8282\uff0c\u8fd9\u662f\u8fea\u7c73\u7279\u6cd5\u5219\u4e0d\u5efa\u8bae\u7684</p> <p>\u5177\u4f53\u5143\u7d20\u53d8\u66f4\u6bd4\u8f83\u56f0\u96be  \u5982\u679c\u5177\u4f53\u5143\u7d20\u589e\u52a0\u5c5e\u6027\uff0c\u5bf9\u5e94\u7684\u6240\u6709visitor\u4e5f\u8981\u4fee\u6539</p> <p>\u8fdd\u80cc\u4e86\u4f9d\u8d56\u5012\u7f6e\u539f\u5219 \u8bbf\u95ee\u8005\u4f9d\u8d56\u7684\u662f\u5177\u4f53\u5143\u7d20\u800c\u4e0d\u662f\u62bd\u8c61\u5143\u7d20\uff0c\u7834\u574f\u4e86\u4f9d\u8d56\u5012\u7f6e\u539f\u5219\u3002</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"designPattern/Visitor-Pattern/#_5","title":"\u4f7f\u7528\u573a\u666f","text":"<p>\u4e00\u4e2a\u5bf9\u8c61\u7ed3\u6784\u5305\u542b\u5f88\u591a\u7c7b\u5bf9\u8c61\uff0c\u5b83\u4eec\u6709\u4e0d\u540c\u7684\u63a5\u53e3\uff0c\u800c\u9700\u8981\u5bf9\u8fd9\u4e9b\u5bf9\u8c61\u5b9e\u65bd\u4e00\u4e9b\u4f9d\u8d56\u5176\u5177\u4f53\u7c7b\u7684\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u8fed\u4ee3\u5668\u6a21\u5f0f\u5df2\u4e0d\u80fd\u80dc\u4efb\u7684\u573a\u666f\u3002</p> <p>\u9700\u8981\u5bf9\u4e00\u4e2a\u5bf9\u8c61\u7ed3\u6784\u4e2d\u7684\u5bf9\u8c61\u8fdb\u884c\u5f88\u591a\u4e0d\u540c\u5e76\u4e14\u4e0d\u76f8\u5173\u7684\u64cd\u4f5c\u3002</p> <p>\u603b\u7ed3\uff1a\u4e1a\u52a1\u89c4\u5219\u8981\u6c42\u904d\u5386\u591a\u4e2a\u4e0d\u540c\u7684\u5bf9\u8c61\u3002</p> <p>\u53c2\u8003\uff1a\u300a\u8bbe\u8ba1\u6a21\u5f0f\u4e4b\u7985\u300b  \u79e6\u5c0f\u6ce2</p>","tags":["\u8bbe\u8ba1\u6a21\u5f0f","Java"]},{"location":"embedded/base/what-is-float-NaN-Inf/","title":"float\u7c7b\u578b\u4e2dNaN\u548cInf\u662f\u4ec0\u4e48\uff1f","text":"\u66f4\u65b0\u65e5\u671f: 2022-10-2 <ul> <li>2022-10-2 \u66f4\u65b0\u683c\u5f0f</li> <li>2022-09-30 \u521b\u5efa\u6587\u6863</li> </ul> <p>Cyber &amp; Robot \u6388\u6743\u53d1\u5e03</p> <p>\u505a\u5d4c\u5165\u5f0f\u7684\u540c\u5b66\u5e94\u8be5\u77e5\u9053\uff0cc\u8bed\u8a00\u4e2dint\u7684\u5927\u5c0f\uff0c\u662f\u548c\u5e73\u53f0\u6709\u5173\u7684\uff0c\u6709\u7684\u53604\u5b57\u8282\uff0c\u6709\u7684\u53602\u5b57\u8282\u3002</p> <p>\u6240\u4ee5\u6211\u4eec\u5bf9\u6709\u671f\u671b\u957f\u5ea6\u7684\u53d8\u91cf\uff0c\u5f88\u5c11\u76f4\u63a5\u7528int\u5b9a\u4e49\uff0c\u800c\u66f4\u591a\u7528uint8_t, uint16_t, uint32_t\u3002</p> <p>\u4f46\u5230\u4e86float\uff0c\u6211\u4eec\u4e3a\u4ec0\u4e48\u6ca1\u6709float16_t, float32_t\u8fd9\u6837\u7684\u7c7b\u578b\u5462\uff1f\u56e0\u4e3afloat\u662f\u6709\u6807\u51c6\u7684\uff0c\u5c31\u662f32\u4f4d\u53604\u5b57\u8282\uff0c\u8fd9\u5c31\u662fIEEE-754\u6807\u51c6\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/base/what-is-float-NaN-Inf/#ieee-754","title":"IEEE-754\u6807\u51c6","text":"<p>\u7b80\u5355\u7684\u8bf4\u4e00\u4e0b\u5427\uff0c\u8bf4\u592a\u7ec6\u5f88\u67af\u71e5\u3002IEEE-754\u6807\u51c6\u5c06float\u5206\u6210\u4e86\u4e09\u90e8\u5206\uff0c\u7b26\u53f7\u4f4d\uff08S\uff09\u3001\u6307\u6570\uff08E\uff09\u548c\u5c3e\u6570\uff08F\uff09\uff0c\u4e00\u51714\u5b57\u8282\uff0c32\u4f4d\u3002</p> \u7b26\u53f7\u4f4d \u6307\u6570 \u5c3e\u6570 S EEEEEEEE FFFFFFFFFFFFFFFFFFFFFFF 1\u4f4d 8\u4f4d 23\u4f4d <ul> <li>\u7b26\u53f7\u4f4d\uff1a0\u4e3a\u6b63\uff0c1\u4e3a\u8d1f\u3002</li> <li>\u6307\u6570\uff1a\u7528\u8865\u7801\u8868\u793a\uff0c\u53ef\u8868\u793a[-127, 128]\u7684\u6307\u6570\u3002</li> <li>\u5c3e\u6570\uff1a\u7528\u4e8c\u8fdb\u5236\u8868\u793a\u5c0f\u6570\u90e8\u5206\u3002</li> </ul> <p>\u597d\uff0c\u4e86\u89e3\u5230\u8fd9\u91cc\u5c31\u5dee\u4e0d\u591a\u4e86\u3002\u5f53\u7136\u8fd9\u91cc\u8bf4\u7684\u90fd\u662ffloat\uff0c\u4e5f\u5c31\u662f\u5355\u7cbe\u5ea6\u6d6e\u70b9\u6570\u3002\u8fd8\u6709\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u6570\uff0c\u4e5f\u5c31\u662fdouble\u3002</p> <p>\u4e00\u822c\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0c\u6211\u4eec\u5c31\u7b97\u5728\u5185\u5b58\u4e2d\u8bfb\u5230\u6d6e\u70b9\u6570\uff0c\u4e5f\u4e0d\u4f1a\u76f4\u63a5\u901a\u8fc716\u8fdb\u5236\u8f6c2\u8fdb\u5236\u518d\u8fd8\u539f\u6210\u6d6e\u70b9\u6570\uff0c\u6700\u65b9\u4fbf\u7684\u8fd8\u662f\u4f7f\u7528\u5728\u7ebf\u8f6c\u6362\u5de5\u5177\u5566\u3002</p> <p>\u4e0b\u9762\u8fdb\u5165\u6b63\u9898\uff0c\u8bb2\u4e00\u4e9b\u7279\u6b8a\u503c\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/base/what-is-float-NaN-Inf/#_1","title":"\u96f6\u503c","text":"<p>\u6307\u6570\u5168\u4e3a0\uff0c\u5c3e\u6570\u5168\u4e3a0\uff0c\u7b26\u53f7\u4f4d\u4efb\u610f\uff0c\u4e8e\u662f\u6709\u4e860\u548c-0\uff0c\u4e140==-0\u3002\u6240\u4ee5\u5f53\u6211\u4eec\u4f7f\u7528<code>memset()</code>\u7684\u65f6\u5019\uff0c\u662f\u80fd\u7ed9float\u521d\u59cb\u5316\u62100\u7684\u3002</p> \u7b26\u53f7\u4f4d \u6307\u6570 \u5c3e\u6570 S EEEEEEEE FFFFFFFFFFFFFFFFFFFFFFF 0/1 00000000 0000000 00000000 00000000","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/base/what-is-float-NaN-Inf/#nan","title":"NaN","text":"<p>\u6307\u6570\u5168\u4e3a1\uff0c\u5c3e\u6570\u975e0\u3002</p> \u7b26\u53f7\u4f4d \u6307\u6570 \u5c3e\u6570 S EEEEEEEE FFFFFFFFFFFFFFFFFFFFFFF 0/1 11111111 1111111 11111111 11111111 <p>NaN\u662fNot A Number\u7684\u610f\u601d\uff0c\u5728\u672a\u5b9a\u4e49\u7684\u7b97\u672f\u8fd0\u7b97\u7ed3\u679c\u4f1a\u51fa\u73b0\uff0c\u6bd4\u5982x/0\u3002\u6ce8\u610f\uff0c\u8bf4\u660e\u662f\u5c3e\u6570\u975e0\uff0c\u8868\u683c\u4e2d\u586b\u7684\u5168\u662f1\uff0c\u4f46\u5b9e\u9645\u4ee5\u5404\u5e73\u53f0\u5b9e\u73b0\u4e3a\u51c6\uff0c\u4ee3\u7801\u5224\u65ad\u5982\u4e0b\uff1a</p> <pre><code>if((fnum&amp;0x7F800000)==0x7F800000 &amp;&amp; (fnum&amp;0x7FFFFF)!=0) {\n    printf(\"is NaN\\n\");\n}\n</code></pre>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/base/what-is-float-NaN-Inf/#infinity","title":"\u65e0\u7a77\u503c\uff08Infinity\uff09","text":"<p>\u6307\u6570\u5168\u4e3a1\uff0c\u5c3e\u6570\u5168\u4e3a0\uff0c\u7b26\u53f7\u4f4d\u4efb\u610f\uff0c\u6709\u6b63\u65e0\u7a77\u548c\u8d1f\u65e0\u7a77\u3002</p> \u7b26\u53f7\u4f4d \u6307\u6570 \u5c3e\u6570 S EEEEEEEE FFFFFFFFFFFFFFFFFFFFFFF 0/1 11111111 0000000 00000000 00000000 <p>\u4ee3\u7801\u5224\u65ad\u5982\u4e0b\uff1a</p> <pre><code>if(fnum==0x7F800000) {\n    printf(\"is +Inf\\n\");\n}\nelse if(fnum==0xFF800000) {\n    printf(\"is -Inf\\n\");\n}\n</code></pre>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/base/what-is-float-NaN-Inf/#c","title":"\u6807\u51c6c\u5e93\u4e2d\u7684\u652f\u6301","text":"<pre><code>#include &lt;math.h&gt;\n\nvoid float_test(void)\n{\n    float num1 = 1.256f;\n    float num2 = NAN;\n    float num3 = INFINITY;\n    float num4 = num1/0;\n\n    printf(\"num1:%f isnan:%d isinf:%d\\n\", num1, isnan(num1), isinf(num1));\n    printf(\"num2:%f isnan:%d isinf:%d\\n\", num2, isnan(num2), isinf(num2));\n    printf(\"num3:%f isnan:%d isinf:%d\\n\", num3, isnan(num3), isinf(num3));\n    printf(\"num4:%f isnan:%d isinf:%d\\n\", num4, isnan(num4), isinf(num4));\n}\n</code></pre>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/base/what-is-float-NaN-Inf/#_2","title":"\u6700\u540e\u591a\u8bf4\u51e0\u53e5","text":"<p>\u6709\u4e00\u4e2a\u6709\u8da3\u7684\u5730\u65b9\uff0c\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\u7528\u4e86<code>printf</code>\u6253\u5370<code>%f</code>\uff0c\u9996\u5148\u5f88\u591a\u5d4c\u5165\u5f0f\u5de5\u7a0b\u90fd\u4e0d\u63a8\u8350\u4f7f\u7528c\u5e93\u5b9e\u73b0\u7684printf\uff0c\u7136\u540e\u662f\u5404\u79cd\u5404\u6837\u7684\u5176\u4ed6\u5e93\u63d0\u4f9b\u4e86printf\u7684\u5b9e\u73b0\u3002</p> <p>\u7136\u540e\u5462\uff0c\u6709\u7684\u5e93\u5176\u5b9e\u4e0d\u652f\u6301<code>%f</code>\u7684\u683c\u5f0f\uff0c\u6bd5\u7adf\u5728\u6709\u7684\u82af\u7247\u4e0a\uff0c\u6d6e\u70b9\u6570\u90fd\u662f\u8981\u6c42\u5c3d\u91cf\u5c11\u4f7f\u7528\u7684\u3002</p> <p>\u518d\u7136\u540e\uff0c\u6709\u7684\u5e93\u652f\u6301\u4e86\u6d6e\u70b9\u6253\u5370\uff0c\u4f46\u5bf9NaN\u3001\u65e0\u7a77\u6570\uff0c\u5e76\u4e0d\u80fd\u6253\u5370\u51fa<code>\"NaN / Inf\"</code>\u4e4b\u7c7b\u7684\u5b57\u6837\u3002</p> <p>\u800c\u4f1a\u6253\u5370\u6210\u4e00\u4e2a\u770b\u8d77\u6765\u5947\u602a\u7684\u6d6e\u70b9\u6570\uff0c\u4f46\u662f\u653e\u5728\u4e00\u5806\u6df7\u4e71\u7684\u6570\u636e\u91cc\uff0c\u53ef\u80fd\u4e5f\u4e0d\u663e\u5f97\u5947\u602a\u4e86\u3002</p> <p>\u6240\u4ee5\u5927\u5bb6\u53ef\u4ee5\u5728\u81ea\u5df1\u5e38\u7528\u7684\u9879\u76ee\u5e73\u53f0\u4e0a\u8bd5\u8bd5\u4e0a\u9762\u7684\u4ee3\u7801\uff0c\u770b\u770b<code>printf</code>\u7684\u652f\u6301\u7a0b\u5ea6\u600e\u4e48\u6837\u3002</p> <p>\u5f53\u7136\uff0c\u4ee5\u540e\u6709\u7a7a\u6211\u4e5f\u4f1a\u51fa\u4e00\u7bc7\u6587\u7ae0\u4e13\u95e8\u8bb2\u600e\u4e48\u5b9e\u73b0<code>printf</code>\u7684\u3002\u5c31\u6bd4\u5982\u60f3\u5077\u61d2\uff0c\u4ee5\u4e3a\u5f15\u5165<code>SEGGER_RTT_printf</code>\u5c31\u80fd\u89e3\u51b3\u8c03\u8bd5\u4fe1\u606f\u6253\u5370\u7684\u95ee\u9898\uff0c\u5374\u53d1\u73b0\u4e0d\u652f\u6301\u6d6e\u70b9\u6253\u5370\uff0c\u4e5f\u662f\u633a\u9057\u61be\u7684\u3002</p> <p><code>printf(\"\u5173\u6ce8\u8fd9\u91cc\uff0c\u83b7\u53d6\u9996\u53d1 segmentfault.com/u/yinyineal/articles \\n\");</code></p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-binary-cvt/","title":"\u5d4c\u5165\u5f0f\u9879\u76ee\u4e2d\u6253\u9020\u81ea\u5df1\u7684utils\u5e93-\u4e8c\u8fdb\u5236\u8f6c\u6362","text":"\u66f4\u65b0\u65e5\u671f: 2022-08-10 <ul> <li>2022-08-10 \u66f4\u65b0</li> </ul> <p>Cyber &amp; Robot \u6388\u6743\u53d1\u5e03</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-binary-cvt/#_1","title":"\u524d\u8a00","text":"<p>\u5728\u5d4c\u5165\u5f0f\u5f00\u53d1\u4e2d\uff0c\u4e0d\u53ef\u907f\u514d\u8981\u548c\u9a71\u52a8\u6253\u4ea4\u9053\u3002\u5f88\u591a\u5916\u8bbe\u7684\u5bc4\u5b58\u5668\u90fd\u662f\u4f7f\u75282\u8fdb\u5236\u5f62\u5f0f\u8fdb\u884c\u914d\u7f6e\u7684\u3002</p> <p>\u5982\u679c\u6bcf\u6b21\u914d\u5bc4\u5b58\u5668\uff0c\u6216\u56de\u987e\u4ee5\u524d\u4ee3\u7801\uff0c\u5bf9\u774016\u8fdb\u5236\u51ed\u501f\u5927\u8111\u6216\u8005\u8ba1\u7b97\u5668\u6765\u505a2\u8fdb\u5236\u8f6c\u6362\uff0c\u5c31\u4f1a\u975e\u5e38\u9ebb\u70e6\u3002\u90a3\u4e48\u4f55\u4e0d\u5199\u4e00\u4e9b\u4ee3\u7801\uff0c\u8ba92\u8fdb\u5236\u770b\u8d77\u6765\u66f4\u76f4\u89c2\u5462\u3002</p> <p>\u867d\u7136GCC\u662f\u652f\u63010b\u5f00\u5934\u7684\u8bed\u6cd5\u7684\uff08\u53c2\u80030x\uff09\uff0c\u4f46\u8fc7\u4e8e\u4f9d\u8d56\u4f1a\u964d\u4f4e\u53ef\u79fb\u690d\u6027\uff0c\u4e0d\u5982\u81ea\u5df1\u624b\u5199\u4e00\u4e2a\u5427\u3002</p> <p></p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-binary-cvt/#_2","title":"\u5b9e\u73b0","text":"<p>\u4e0b\u9762\u76f4\u63a5\u8d34\u4ee3\u7801\uff1a <pre><code>#define BIN(n)              ((0x##n&gt;&gt;21 &amp; 0x80) | \\\n                             (0x##n&gt;&gt;18 &amp; 0x40) | \\\n                             (0x##n&gt;&gt;15 &amp; 0x20) | \\\n                             (0x##n&gt;&gt;12 &amp; 0x10) | \\\n                              (0x##n&gt;&gt;9 &amp; 0x08) | \\\n                              (0x##n&gt;&gt;6 &amp; 0x04) | \\\n                              (0x##n&gt;&gt;3 &amp; 0x02) | \\\n                                 (0x##n &amp; 0x01) )\n</code></pre></p> <p>\u793a\u4f8b\uff1a <pre><code>uint8_t val = BIN(10100101);\nprintf(\"val:%X\\n\", val);\n</code></pre></p> <p>\u7ed3\u679c\uff1a <pre><code>val:A5\n</code></pre></p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-binary-cvt/#_3","title":"\u4ee3\u7801\u5206\u6790","text":"<pre><code>uint8_t val = BIN(10100101)\n\n// \u5b8f\u5c55\u5f00\n((0x10100101&gt;&gt;21 &amp; 0x80) | \\\n (0x10100101&gt;&gt;18 &amp; 0x40) | \\\n (0x10100101&gt;&gt;15 &amp; 0x20) | \\\n (0x10100101&gt;&gt;12 &amp; 0x10) | \\\n  (0x10100101&gt;&gt;9 &amp; 0x08) | \\\n  (0x10100101&gt;&gt;6 &amp; 0x04) | \\\n  (0x10100101&gt;&gt;3 &amp; 0x02) | \\\n     (0x10100101 &amp; 0x01) )\n\n// \u75282\u8fdb\u5236\u8868\u793a\n((0x10100101&gt;&gt;21 &amp; 0b10000000) | \\\n (0x10100101&gt;&gt;18 &amp; 0b01000000) | \\\n (0x10100101&gt;&gt;15 &amp; 0b00100000) | \\\n (0x10100101&gt;&gt;12 &amp; 0b00010000) | \\\n  (0x10100101&gt;&gt;9 &amp; 0b00001000) | \\\n  (0x10100101&gt;&gt;6 &amp; 0b00000100) | \\\n  (0x10100101&gt;&gt;3 &amp; 0b00000010) | \\\n     (0x10100101 &amp; 0b00000001) )\n</code></pre> <p>\u6ce8\u610f\uff1a\u6b64\u65f610100101\u662f\u4e00\u4e2a16\u8fdb\u5236\u7684\u6570\u5b57\uff0c\u5404\u4f4d\u6570\u636e\u5982\u4e0b\uff1a</p> <p> <pre><code>// 2\u8fdb\u5236\u8868\u793a\u548c\u79fb\u4f4d\u8fc7\u7a0b\n0b00010000000100000000000100000001 &gt;&gt; 21 &amp; 0b10000000 = 0b00010000000 &amp; 0b10000000                      = 0b10000000\n0b00010000000100000000000100000001 &gt;&gt; 18 &amp; 0b01000000 = 0b00010000000100 &amp; 0b01000000                   = 0b00000000\n0b00010000000100000000000100000001 &gt;&gt; 15 &amp; 0b00100000 = 0b00010000000100000 &amp; 0b00100000                = 0b00100000\n0b00010000000100000000000100000001 &gt;&gt; 12 &amp; 0b00010000 = 0b00010000000100000000 &amp; 0b00010000             = 0b00000000\n0b00010000000100000000000100000001 &gt;&gt;  9 &amp; 0b00001000 = 0b00010000000100000000000 &amp; 0b00001000          = 0b00000000\n0b00010000000100000000000100000001 &gt;&gt;  6 &amp; 0b00000100 = 0b00010000000100000000000100 &amp; 0b00000100       = 0b00000100\n0b00010000000100000000000100000001 &gt;&gt;  3 &amp; 0b00000010 = 0b00010000000100000000000100000 &amp; 0b00000010    = 0b00000000\n0b00010000000100000000000100000001       &amp; 0b00000001 = 0b00010000000100000000000100000001 &amp; 0b00000001 = 0b00000001\n</code></pre></p> <p>\u6700\u540e\u5404\u4f4d\u76f8\u52a0\uff08\u4e0e\uff09\uff0c\u662f\u4e0d\u662f\u7ec4\u5408\u5f97\u52300b10100101(0xA5)\u4e86\uff1f</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-binary-cvt/#_4","title":"\u8bfe\u5916\u5c0f\u77e5\u8bc6","text":"<p>\u4e0d\u77e5\u9053\u5927\u5bb6\u5bf9\u5b8f\u5b9a\u4e49\u7684#\u53f7\u8bed\u6cd5\u662f\u5426\u8fd8\u6709\u5370\u8c61\uff0c\u8fd9\u91cc\u4e00\u8d77\u590d\u4e60\u4e00\u4e0b\uff1a <pre><code>/*\n  \u5355\u4e2a#\n  \u4f5c\u7528\u662f\u5c06#\u540e\u9762\u7684\u53c2\u6570\u8f6c\u6210\u5b57\u7b26\u4e32\n*/\n#define PRINT_VAR(a) printf(\"%s:%d\\n\", #a, a)\nuint8_t length = 123;\nPRINT_VAR(length);\n// \u8f93\u51fa\uff1alength:123\n\n/*\n  \u4e24\u4e2a##\n  \u4f5c\u7528\u662f\u8fde\u63a5##\u524d\u540e\u4e24\u90e8\u5206\u5185\u5bb9\n*/\n#define VAR_DEF(a) int _var_##a\n#define VAR(a) _var_##a\n\nVAR_DEF(length);\nVAR(length) = 123;\nprintf(\"length:%d\\n\", VAR(length));\n// \u8f93\u51fa\uff1alength:123\n</code></pre></p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-binary-cvt/#_5","title":"\u5e94\u7528","text":"<p>\u968f\u610f\u6253\u5f00\u4e00\u4e2a\u4f20\u611f\u5668\u7684\u6570\u636e\u624b\u518c\uff0c\u91cc\u9762\u5bf9\u5bc4\u5b58\u5668\u7684\u914d\u7f6e\u8bf4\u660e\u957f\u8fd9\u6837:</p> <p></p> <p>\u7528\u4e0a\u521a\u624d\u7684\u4ee3\u7801\uff0c\u505a\u5982\u4e0b\u914d\u7f6e\uff1a</p> <p>\u9640\u87ba\u4eea\u8f93\u51fa\u901f\u7387\uff1a104Hz(0100)</p> <p>\u9640\u87ba\u4eea\u91cf\u7a0b\uff1a1000dps(10)</p> <p>\u53e6\u5916\u4e00\u4e2a\u4e0d\u7ba1\u5b83\uff0c\u4fdd\u6301\u9ed8\u8ba4\u4e3a0\u3002 <pre><code>uint8_t ctrl2_g_config = BIN(01001000);\ni2c_reg_write(&amp;dev, 0x11, ctrl2_g_config);\n</code></pre> \u662f\u4e0d\u662f\u6bd4\u51990x48\u76f4\u89c2\u591a\u4e86\uff0c\u540c\u65f6\u4e5f\u65b9\u4fbf\u4e0b\u6b21\u4fee\u6539\u914d\u7f6e\u3002 <pre><code>uint8_t ctrl2_g_config = 0x48;\ni2c_reg_write(&amp;dev, 0x11, ctrl2_g_config);\n</code></pre></p> <p>\u518d\u628a\u5bc4\u5b58\u5668\u6ce8\u91ca\u5199\u5728\u4ee3\u7801\u4e0a\uff0c\u4e0b\u6b21\u7ef4\u62a4\u4ee3\u7801\u4e00\u76ee\u4e86\u7136\u3002 <pre><code>/*\n  ODR_G [7:4] Gyroscope output data rate selection. Default value: 0000\n           ODR_G0 ODR [Hz] when G_HM_MODE = 1   ODR [Hz] when G_HM_MODE = 0\n  0 0 0 0: Power down Power down\n  0 0 0 1: 12.5 Hz (low power)                  12.5 Hz (high performance)\n  0 0 1 0: 26 Hz (low power)                    26 Hz (high performance)\n  0 0 1 1: 52 Hz (low power)                    52 Hz (high performance)\n  0 1 0 0: 104 Hz (normal mode)                 104 Hz (high performance)\n  0 1 0 1: 208 Hz (normal mode)                 208 Hz (high performance)\n  0 1 1 0: 416 Hz (high performance)            416 Hz (high performance)\n  0 1 1 1: 833 Hz (high performance)            833 Hz (high performance)\n  1 0 0 0: 1.66 kHz (high performance)          1.66 kHz (high performance)\n  1 0 0 1: 3.33 kHz (high performance           3.33 kHz (high performance)\n  1 0 1 0: 6.66 kHz (high performance           6.66 kHz (high performance)\n  1 0 1 1: Not available                        Not available\n\n  FS_G [3:2] Gyroscope full-scale selection. Default value: 00\n  (00: 245 dps; 01: 500 dps; 10: 1000 dps; 11: 2000 dps)\n\n  FS_125[1] Gyroscope full-scale at 125 dps. Default value: 0\n  (0: disabled; 1: enabled)\n\n  Reserve[0] 0\n*/\nuint8_t ctrl2_g_config = BIN(01001000);\ni2c_reg_write(&amp;dev, 0x11, ctrl2_g_config);\n</code></pre></p> <p>\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6b64\u65b9\u6cd5\u4ec5\u652f\u63018\u4f4d2\u8fdb\u5236\u7684\u8868\u793a\uff0c\u8981\u652f\u630116\u4f4d\u300132\u4f4d\u76842\u8fdb\u5236\uff0c\u4e00\u662f\u53c2\u6570\u5b58\u50a8\u5b57\u8282\u4f1a\u8d8532\u4f4d\uff1b\u4e8c\u662f\u5b58\u5728\u5b57\u8282\u5e8f\u7684\u95ee\u9898\u3002\u6709\u5174\u8da3\u7684\u670b\u53cb\u53ef\u4ee5\u81ea\u5df1\u6269\u5c55\u5b9e\u73b0\u4e00\u4e0b\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-binary-cvt/#end","title":"End","text":"<p>\u672c\u7bc7\u6587\u7ae0\u53ea\u6709\u4e00\u884c\u4ee3\u7801\uff0c\u4f46\u5374\u662f\u5d4c\u5165\u5f0f\u5f00\u53d1\u4e2d\u4e00\u4e2a\u975e\u5e38\u6709\u7528\u7684\u5de5\u5177\uff0c\u901a\u8fc7\u8fd9\u4e2a\u5de5\u5177\uff0c\u53ef\u4ee5\u8282\u7701\u5f88\u591a\u65f6\u95f4\u3002 c\u8bed\u8a00\u7684\u5f00\u53d1\uff0c\u81ea\u8eab\u7684\u8bed\u6cd5\u7cd6\u5e76\u4e0d\u591a\uff0c\u800c\u5d4c\u5165\u5f0f\u7684\u5f00\u53d1\u4e2d\uff0cIDE\u5e26\u6765\u7684\u8f85\u52a9\u6548\u679c\u66f4\u532e\u4e4f\u3002\u6240\u4ee5\u4e3a\u4e86\u63d0\u5347\u6548\u7387\uff0c\u5efa\u8bae\u5927\u5bb6\u6536\u96c6\u81ea\u5df1\u5e38\u7528\u7684\u5de5\u5177\u4ee3\u7801\uff0c\u6574\u7406\u6210\u6a21\u5757\uff0c\u591a\u6b21\u590d\u7528\u8d77\u6765\uff0c\u8fd9\u4e5f\u662f\u6807\u9898utils\u5e93\u7684\u7531\u6765\u3002 \u6253\u9020utils\u5e93\u4f1a\u662f\u4e00\u7cfb\u5217\u7684\u6587\u7ae0\uff0c\u4f1a\u8ddf\u5927\u5bb6\u5206\u4eab\u6709\u7528\u7684\u4ee3\u7801\u3002\u591a\u6570\u4f1a\u4ee5\u5b8f\u5b9a\u4e49\u7684\u65b9\u5f0f\u5b9e\u73b0\uff0c\u4e5f\u4f1a\u6709c\u4ee3\u7801\u7ea7\u522b\u7684\u5b9e\u73b0\u3002\u671f\u5f85\u6211\u4eec\u4e0b\u4e00\u6b21\u89c1\u9762\u3002</p> <p>\u672c\u6587\u4e5f\u53d1\u5e03\u5728</p> <p>segmentfault</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-enum-tostring/","title":"\u5d4c\u5165\u5f0f\u9879\u76ee\u4e2d\u6253\u9020\u81ea\u5df1\u7684utils\u5e93-ENUM\u8f6c\u5b57\u7b26\u4e32","text":"\u66f4\u65b0\u65e5\u671f: 2022-08-10 <ul> <li>2022-08-10 \u66f4\u65b0</li> </ul> <p>Cyber &amp; Robot \u6388\u6743\u53d1\u5e03</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-enum-tostring/#_1","title":"\u524d\u8a00","text":"<p>\u4e0d\u77e5\u9053\u5927\u5bb6\u5728\u8c03\u8bd5\u7684\u65f6\u5019\uff0c\u662f\u5426\u7ecf\u5e38\u9700\u8981\u5c06\u4e00\u4e9b\u7c7b\u578b\u53d8\u91cf\u7684\u540d\u79f0\u6253\u5370\u51fa\u6765\u5462\u3002</p> <p>\u8fd9\u91cc\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7edf\u4e00\u7684\u65b9\u6cd5\uff0c\u5728\u4f7f\u7528\u65f6\u53ea\u9700\u8981\u5f88\u5c11\u7684\u4ee3\u7801\u91cf\uff0c\u5c31\u53ef\u4ee5\u628a\u5b8f\u5b9a\u4e49\u3001\u679a\u4e3e\u7684\u53d8\u91cf\u540d\u79f0\u6253\u5370\u51fa\u6765\u4e86\u3002\u4e0b\u9762\u5148\u4e0a\u4ee3\u7801\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-enum-tostring/#_2","title":"\u5b9e\u73b0","text":"<p>utils.h <pre><code>typedef struct {\n    int32_t val;\n    char* name;\n} Enumerate;\n\nchar* enumerate_to_string(Enumerate* enumerate, uint8_t total, int32_t val);\n\n#define ENUMERATE_DEF(object) static Enumerate _ENUM_##object[]\n#define ENUMERATE_ITEM(val) {val, #val}\n\n#define ENUM_TO_STRING(object, val) enumerate_to_string(_ENUM_##object, ARRAY_LENGTH(_ENUM_##object), val)\n\n#define ARRAY_LENGTH(array) (sizeof(array) / sizeof(array[0]))\n</code></pre></p> <p>\u8fd9\u6b21\u7684\u4ee3\u7801\u56e0\u4e3a\u8981\u904d\u5386\u6570\u7ec4\uff0c\u5df2\u7ecf\u4e0d\u80fd\u7528\u7b80\u5355\u7684\u5b8f\u5b9a\u4e49\u6765\u5b8c\u5168\u5b9e\u73b0\u4e86\u3002</p> <p>utils.c <pre><code>char* enumerate_to_string(Enumerate* enumerate, uint8_t total, int32_t val)\n{\n    for(uint8_t i=0; i&lt;total; i++) {\n        if(enumerate[i].val == val) {\n            return enumerate[i].name;\n        }\n    }\n    return \"EnumUnknow\";\n}\n</code></pre></p> <p>\u8001\u89c4\u77e9\uff0c\u793a\u4f8b\uff1a <pre><code>enum {\n    UNDEFINED = 0,\n    OBJECT,\n    ARRAY,\n    STRING,\n    NUMBER,\n    FLOAT,\n    BOOL,\n};\n\nENUMERATE_DEF(JsonTypeStr) = {\n    ENUMERATE_ITEM(UNDEFINED),\n    ENUMERATE_ITEM(OBJECT),\n    ENUMERATE_ITEM(ARRAY),\n    ENUMERATE_ITEM(STRING),\n    ENUMERATE_ITEM(NUMBER),\n    ENUMERATE_ITEM(FLOAT),\n    ENUMERATE_ITEM(BOOL),\n};\n\nuint8_t json_type = ARRAY;\nprintf(\"json_type:%s(%d)\\n\", ENUM_TO_STRING(JsonTypeStr, json_type), json_type);\n</code></pre></p> <p>\u7ed3\u679c\uff1a <pre><code>json_type:ARRAY(2)\n</code></pre></p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-enum-tostring/#_3","title":"\u4ee3\u7801\u5206\u6790","text":"<p>\u8fd9\u91cc\u7684\u601d\u8def\uff0c\u662f\u91cd\u65b0\u5b9a\u4e49\u4e00\u4e2a\u7ed3\u6784\u4f53\u6570\u7ec4\uff0c\u5728\u8fd9\u4e2a\u7ed3\u6784\u4f53\u91cc\u4fdd\u5b58\u679a\u4e3e\u503c\uff0c\u548c\u503c\u7684\u540d\u5b57\u3002\u5728\u4f7f\u7528\u65f6\uff0c\u904d\u5386\u6574\u4e2a\u6570\u7ec4\uff0c\u627e\u5230\u5bf9\u5e94\u503c\u7684\u540d\u5b57\u3002</p> <p>\u540c\u65f6\u4e3a\u4e86\u51cf\u5c11\u624b\u5199\u4ee3\u7801\u7684\u6570\u91cf\uff0c\u5229\u7528\u5b8f\u5b9a\u4e49\u7684\u7279\u6027\uff0c\u5c06\u503c\u7684\u6587\u672c\u540d\u79f0\u76f4\u63a5\u8f6c\u6210\u4e86\u5b57\u7b26\u4e32\uff0c\u5c31\u4e0d\u7528\u624b\u52a8\u518d\u53bb\u5199\u4e00\u904d\u540d\u79f0\u7684\u5b57\u7b26\u4e32\u4e86\u3002</p> <p>\u4f7f\u7528\u4e0a\u4fdd\u7559\u4e86\u539f\u6765c\u8bed\u8a00\u4e2d\u5b9a\u4e49\u679a\u4e3e\u7684\u8bed\u6cd5\uff0c\u7528 <code>xxx={a1,a2,a3};</code> \u7684\u65b9\u5f0f\uff0c\u4f7f\u4ee3\u7801\u9605\u8bfb\u66f4\u7b26\u5408\u4e60\u60ef\u3002</p> <p>\u5728\u8ba1\u7b97\u6570\u7ec4\u957f\u5ea6\u65b9\u9762\uff0cc\u8bed\u8a00\u4e0d\u6bd4\u5176\u4ed6\u8bed\u8a00\uff0cjava\u7684<code>array.length()</code>\uff0cpython\u7684<code>len(list)</code>\uff0c\u90fd\u53ef\u4ee5\u5feb\u901f\u51c6\u786e\u5f97\u5230\u6570\u7ec4\u957f\u5ea6\u3002c\u8bed\u8a00\u4e2d\u5219\u9700\u8981\u8fd9\u6837\u6765\u8ba1\u7b97\uff1a <pre><code>size_t array_len = sizeof(array) / sizeof(item);\n</code></pre></p> <p>\u7528\u6570\u7ec4\u5360\u7684\u5185\u5b58\u5927\u5c0f\uff0c\u9664\u4ee5\u6bcf\u4e2a\u9879\u5360\u7684\u5185\u5b58\u5927\u5c0f\uff0c\u5c31\u80fd\u5f97\u5230\u4e00\u5171\u6709\u591a\u5c11\u4e2a\u9879\uff0c\u5c31\u662f\u6570\u7ec4\u957f\u5ea6\u4e86\u3002\u5728\u4f20\u9012\u7684\u53c2\u6570\u90fd\u662f\u6570\u7ec4\u7684\u524d\u63d0\u4e0b\uff0c\u4f7f\u7528\u7b2c\u4e00\u4e2a\u5143\u7d20\u53ef\u4ee5\u7b80\u5316\u4ee3\u7801\uff1a <pre><code>size_t array_len = sizeof(array) / sizeof(array[0]);\n</code></pre></p> <p>\u8fd9\u79cd\u7528\u6cd5\u6709\u4e00\u5b9a\u7684\u9690\u60a3\uff0c\u6ca1\u6709\u5bf9\u4f20\u5165\u7684\u53c2\u6570\u505a\u68c0\u67e5\uff0c\u6240\u4ee5\u4e5f\u662f\u6ca1\u6709\u5927\u9762\u79ef\u63a8\u5e7f\u4f7f\u7528\u7684\u539f\u56e0\u5427\u3002</p> <p>\u540c\u65f6\u8981\u6ce8\u610f\u7684\uff0csizeof\u662f\u4e00\u4e2a\u64cd\u4f5c\u7b26\uff0c\u548c=\uff0c+\u8fd9\u4e9b\u662f\u4e00\u6837\u7684\uff0c\u5e76\u4e0d\u662f\u51fd\u6570\uff0c\u5982\u679c\u8981\u8ba1\u7b97\u4e00\u4e2a\u6570\u7ec4\u7684\u5927\u5c0f\uff0c\u9700\u8981\u4f20\u5165\u6b63\u786e\u7684\u540d\u5b57\uff0c\u901a\u8fc7\u4f20\u5165\u6307\u5411\u6570\u7ec4\u7684\u6307\u9488\u662f\u4e0d\u884c\u7684\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-enum-tostring/#_4","title":"\u5c0f\u77e5\u8bc6","text":"<p>\u5728\u58f0\u660e\u65f6\uff0c\u5b8f\u5b9a\u4e49\u5c55\u5f00\u540e\u589e\u52a0\u4e86\u7279\u5b9a\u7684\u524d\u7f00\uff0c\u8fd9\u6837\u53ef\u4ee5\u6709\u6548\u907f\u514d\u548c\u5176\u4ed6\u53d8\u91cf\u547d\u540d\u91cd\u590d\uff0c\u4f7f\u672c\u53d8\u91cf\u66f4\u63a5\u8fd1\u4e1a\u52a1\uff0c\u66f4\u65b9\u4fbf\u8f93\u5165\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-enum-tostring/#_5","title":"\u5e94\u7528","text":"<p>\u5c31\u62ff\u84dd\u7259\u65ad\u5f00\u539f\u56e0\u6765\u4e3e\u4f8b\u5427\uff0c\u8fd0\u884c\u5728ESP32\u5e73\u53f0\u3002</p> <p>\u84dd\u7259\u65ad\u5f00\u539f\u56e0\u5728 idf\\components\\bt\\host\\bluedroid\\api\\include\\api\\esp_gatt_defs.h \u4e2d\u5b9a\u4e49\u4e86\uff1a</p> <pre><code>/**\n * @brief Gatt Connection reason enum\n */\ntypedef enum {\n    ESP_GATT_CONN_UNKNOWN = 0,                      /*!&lt; Gatt connection unknown */               /* relate to BTA_GATT_CONN_UNKNOWN in bta/bta_gatt_api.h */\n    ESP_GATT_CONN_L2C_FAILURE = 1,                  /*!&lt; General L2cap failure  */                /* relate to BTA_GATT_CONN_L2C_FAILURE in bta/bta_gatt_api.h */\n    ESP_GATT_CONN_TIMEOUT = 0x08,                   /*!&lt; Connection timeout  */                   /* relate to BTA_GATT_CONN_TIMEOUT in bta/bta_gatt_api.h */\n    ESP_GATT_CONN_TERMINATE_PEER_USER = 0x13,       /*!&lt; Connection terminate by peer user  */    /* relate to BTA_GATT_CONN_TERMINATE_PEER_USER in bta/bta_gatt_api.h */\n    ESP_GATT_CONN_TERMINATE_LOCAL_HOST = 0x16,      /*!&lt; Connection terminated by local host */    /* relate to BTA_GATT_CONN_TERMINATE_LOCAL_HOST in bta/bta_gatt_api.h */\n    ESP_GATT_CONN_FAIL_ESTABLISH = 0x3e,            /*!&lt; Connection fail to establish  */         /* relate to BTA_GATT_CONN_FAIL_ESTABLISH in bta/bta_gatt_api.h */\n    ESP_GATT_CONN_LMP_TIMEOUT = 0x22,               /*!&lt; Connection fail for LMP response tout */ /* relate to BTA_GATT_CONN_LMP_TIMEOUT in bta/bta_gatt_api.h */\n    ESP_GATT_CONN_CONN_CANCEL = 0x0100,             /*!&lt; L2CAP connection cancelled  */           /* relate to BTA_GATT_CONN_CONN_CANCEL in bta/bta_gatt_api.h */\n    ESP_GATT_CONN_NONE = 0x0101                     /*!&lt; No connection to cancel  */              /* relate to BTA_GATT_CONN_NONE in bta/bta_gatt_api.h */\n} esp_gatt_conn_reason_t;\n</code></pre> <p>\u6211\u4eec\u6765\u4e3a\u5b83\u6dfb\u52a0\u5b57\u7b26\u4e32\uff1a\uff08\u4e0a\u9762\u5b9a\u4e49\u539f\u6837\u590d\u5236\u51fa\u6765\uff0c\u518d\u505a\u5c11\u8bb8\u66ff\u6362\u5220\u51cf\u5373\u53ef\uff09 <pre><code>ENUMERATE_DEF(BleConnReasonStr) = {\n    ENUMERATE_ITEM(ESP_GATT_CONN_UNKNOWN),\n    ENUMERATE_ITEM(ESP_GATT_CONN_L2C_FAILURE),\n    ENUMERATE_ITEM(ESP_GATT_CONN_TIMEOUT),\n    ENUMERATE_ITEM(ESP_GATT_CONN_TERMINATE_PEER_USER),\n    ENUMERATE_ITEM(ESP_GATT_CONN_TERMINATE_LOCAL_HOST),\n    ENUMERATE_ITEM(ESP_GATT_CONN_FAIL_ESTABLISH),\n    ENUMERATE_ITEM(ESP_GATT_CONN_LMP_TIMEOUT),\n    ENUMERATE_ITEM(ESP_GATT_CONN_CONN_CANCEL),\n    ENUMERATE_ITEM(ESP_GATT_CONN_NONE),\n};\n</code></pre></p> <p>\u5728\u5de5\u7a0b\u4e2d\u5e94\u7528\uff1a <pre><code>// \u84dd\u7259\u4e8b\u4ef6\u56de\u8c03\u51fd\u6570\nstatic void gattc_profile_event_handler(esp_gattc_cb_event_t event, esp_gatt_if_t gattc_if, esp_ble_gattc_cb_param_t *param)\n{\n    esp_ble_gattc_cb_param_t *p_data = (esp_ble_gattc_cb_param_t *)param;\n\n    switch (event) {\n    case ESP_GATTC_DISCONNECT_EVT: //\u65ad\u8fde\u4e8b\u4ef6\n        //\u6253\u5370\u4e8b\u4ef6\u539f\u56e0\n        ESP_LOGI(TAG, \"ESP_GATTC_DISCONNECT_EVT, reason = %s(%x)\", ENUM_TO_STRING(BleConnReasonStr, p_data-&gt;disconnect.reason), p_data-&gt;disconnect.reason);\n        break;\n    default:\n        break;\n    }\n}\n</code></pre></p> <p>\u5b9e\u9645\u6253\u5370\u4f1a\u957f\u8fd9\u6837\uff1a <pre><code>I (1126378) BLE: ESP_GATTC_DISCONNECT_EVT, reason = ESP_GATT_CONN_TIMEOUT(8)\n</code></pre></p> <p>\u662f\u4e0d\u662f\u5f88\u65b9\u4fbf\uff0c\u8fd9\u6837\u770b\u65e5\u5fd7\u5c31\u4e00\u76ee\u4e86\u7136\uff0c\u4e0d\u7528\u5bf9\u7740\u9519\u8bef\u7801\u518d\u53bb\u5bf9\u7167\u5b9a\u4e49\u3002\u4f7f\u7528\u65f6\u4e5f\u4e0d\u9700\u8981\u989d\u5916\u518d\u5199\u6570\u5b57\u8f6c\u5b57\u7b26\u4e32\u7684\u51fd\u6570\uff0c\u5728\u5f88\u591a\u5730\u65b9\u6dfb\u52a0\u5c31\u80fd\u4f7f\u7528\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-enum-tostring/#end","title":"End","text":"<p>\u8fd9\u7bc7\u6587\u7ae0\u8fd8\u559c\u6b22\u5417\uff0c\u6211\u4eec\u4e0b\u6b21\u89c1\u3002</p> <p>\u672c\u6587\u4e5f\u53d1\u5e03\u5728</p> <p>segmentfault</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-for-chips-base-time-space-cal/","title":"\u5d4c\u5165\u5f0f\u9879\u76ee\u4e2d\u6253\u9020\u81ea\u5df1\u7684utils\u5e93-\u4e0d\u540c\u82af\u7247\u7684\u57fa\u7840\u65f6\u7a7a\u5f00\u9500\u8ba1\u7b97","text":"\u66f4\u65b0\u65e5\u671f: 2022-08-10 <ul> <li>2022-08-10 \u66f4\u65b0</li> </ul> <p>Cyber &amp; Robot \u6388\u6743\u53d1\u5e03</p> <p>\u6700\u8fd1\u53c8\u91cd\u65b0\u7ffb\u770b\u4e86\u300a\u7f16\u7a0b\u73e0\u7391\u300b\u8fd9\u672c\u4e66\uff0c\u91cc\u9762\u7740\u91cd\u5bf9\u5de5\u7a0b\u5316\u5904\u7406\u8fdb\u884c\u4e86\u8bb2\u89e3\uff0c\u5199\u5f97\u5f88\u597d\u3002</p> <p>\u5370\u8c61\u6700\u6df1\u7684\u4e00\u4e2a\u4f8b\u5b50\uff0c\u4f5c\u8005\u62ff\u5e03\u9c81\u514b\u6797\u5927\u6865\u4e3e\u4f8b\uff0c20\u4e16\u7eaa40\u5e74\u4ee3\u524d\uff0c\u6709\u5f88\u591a\u60ac\u7d22\u6865\u4f1a\u56e0\u4e3a\u98ce\u66b4\u65ad\u88c2\u3002\u800c\u8981\u5bf9\u8fd9\u79cd\u6c14\u52a8\u4e0a\u5347\u73b0\u8c61\u505a\u6b63\u786e\u7684\u6570\u5b66\u5efa\u6a21\u548c\u5de5\u7a0b\u8ba1\u7b97\uff0c\u8981\u7b49\u523010\u5e74\u540e\u3002\u800c\u540c\u4e00\u65f6\u671f\u7684\u5e03\u9c81\u514b\u6797\u5927\u6865\u5374\u6ca1\u6709\u65ad\u88c2\uff0c\u5de5\u7a0b\u5e08John Roebling\u8bf4\uff0c\u4ed6\u77e5\u9053\u6c14\u52a8\u4e0a\u5347\u73b0\u8c61\u7684\u5b58\u5728\uff0c\u4f46\u662f\u53c8\u65e0\u6cd5\u4ece\u672c\u8d28\u4e0a\u53bb\u6b63\u786e\u5904\u7406\u5b83\uff08\u5efa\u6a21\uff09\uff0c\u4e8e\u662f\u4ed6\u6309\u7167\u6240\u9700\u5f3a\u5ea6\u76846\u500d\u8bbe\u8ba1\u4e86\u5927\u6865\u3002\u6700\u540e\u4f5c\u8005\u5efa\u8bae\u6211\u4eec\uff0c\u4ee52\u30014\u62166\u7684\u7cfb\u6570\u6765\u964d\u4f4e\u5bf9\u6027\u80fd\u7684\u4f30\u8ba1\u3002\u5176\u5b9e\u5c31\u662f\u8981\u9884\u7559\u8db3\u591f\u7684\u6027\u80fd\u3002\u4f5c\u8005\u6700\u540e\u8bf4\uff1a\u201c\u6211\u4eec\u662f\u548cJohn Roebling\u4e00\u6837\u7684\u5de5\u7a0b\u5e08\u5417\uff1f\u6211\u5f88\u6000\u7591\u201d\u3002</p> <p>\u8a00\u5f52\u6b63\u4f20\uff0c\u4e66\u4e2d\u63d0\u5230\u4e86\u65f6\u7a7a\u5f00\u9500\u6a21\u578b\uff0c\u7528\u4e8e\u5bf9\u4ee3\u7801\u4e2d\u65f6\u7a7a\u5f00\u9500\u505a\u8ba1\u7b97\uff0c\u53ef\u4ee5\u65b9\u4fbf\u7684\u7528\u4e8e\u4ee3\u7801\u6027\u80fd\u4f30\u8ba1\u548c\u4ee3\u7801\u4f18\u5316\u3002</p> <p>\u672c\u6587\u5bf9\u6b64\u4ee3\u7801\u505a\u4e86\u6574\u7406\uff0c\u53ef\u4ee5\u52a0\u5165\u5230utils\u5e93\u4e2d\uff0c\u5e76\u4e14\u53ef\u5728<code>ESP32</code>\u548c<code>STM32F103C8</code>\u4e0a\u8fd0\u884c\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-for-chips-base-time-space-cal/#_1","title":"\u57fa\u672c\u7c7b\u578b\u7684\u7a7a\u95f4\u5360\u7528","text":"<p><pre><code>#define SIZE_MEASURE(T) \\\ndo { \\\n    printf(\"sizeof(%s)=%d\\n\", #T, sizeof(T)); \\\n} while (0)\n\nvoid platform_base_type_size_measure(void)\n{\n    printf(\"\\nplatform_base_type_size_measure\\n\");\n    SIZE_MEASURE(char);\n    SIZE_MEASURE(short);\n    SIZE_MEASURE(int);\n    SIZE_MEASURE(long);\n    SIZE_MEASURE(long long);\n    SIZE_MEASURE(float);\n    SIZE_MEASURE(double);\n    SIZE_MEASURE(int*);\n}\n</code></pre> \u8fd9\u91cc\u7528\u5230\u4e86\u524d\u9762\u7684\u77e5\u8bc6\u70b9\uff0c\u5b8f\u5b9a\u4e49\u53c2\u6570\u524d\u52a0#\uff0c\u53ef\u4ee5\u8f6c\u6362\u4e3a\u5b57\u7b26\u4e32\u3002</p> <p>\u7ed3\u679c\uff1a <pre><code>platform_base_type_size_measure\nsizeof(char)=1\nsizeof(short)=2\nsizeof(int)=4\nsizeof(long)=4\nsizeof(long long)=8\nsizeof(float)=4\nsizeof(double)=8\nsizeof(int*)=4\n</code></pre></p> <p>\u56e0\u4e3aesp32\u548cstm32\u90fd\u662f32\u4f4d\u5e73\u53f0\uff0c\u6240\u4ee5int\u662f4\u5b57\u8282\uff0c\u6307\u9488\u4e5f\u662f4\u5b57\u8282\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-for-chips-base-time-space-cal/#malloc","title":"\u7ed3\u6784\u4f53\u5bf9\u9f50\u548cmalloc\u5360\u7528\u7a7a\u95f4","text":"<pre><code>typedef struct{char c;} structc;\ntypedef struct {int i; char c;} structic;\ntypedef struct {int i; struct structip *p;} structip;\ntypedef struct {double d; char c;} structdc;\ntypedef struct {char c; double d;} structcd;\ntypedef struct {char c; double d; char cc;} structcdc;\ntypedef struct {int i; int ii; int iii;} structiii;\ntypedef struct {int i; int ii; char c;} structiic;\ntypedef struct {char c[12];} struct12;\ntypedef struct {char c[13];} struct13;\ntypedef struct {char c[28];} struct28;\ntypedef struct {char c[29];} struct29;\n\n#define SIZE_MALLOC_MEASURE(T) \\\ndo { \\\n    printf(\"%s%c\\t\", #T, strlen(#T)&lt;8?'\\t':' '); \\\n    printf(\"%d\\t\", sizeof(T)); \\\n    int lastp = 0; \\\n    for(int i=0; i&lt;11; i++) { \\\n        T* p = (T*)malloc(sizeof(T)); \\\n        uint32_t thisp = (uint32_t)p; \\\n        if(lastp != 0) \\\n            printf(\" %d\", thisp - lastp); \\\n        lastp = thisp; \\\n    } \\\n    printf(\"\\n\"); \\\n} while (0)\n\nvoid platform_struct_size_measure(void)\n{\n    printf(\"\\nstruct\\t\\tsizeof\\t malloc size\\n\");\n    SIZE_MALLOC_MEASURE(int);\n    SIZE_MALLOC_MEASURE(structc);\n    SIZE_MALLOC_MEASURE(structic);\n    SIZE_MALLOC_MEASURE(structip);\n    SIZE_MALLOC_MEASURE(structdc);\n    SIZE_MALLOC_MEASURE(structcd);\n    SIZE_MALLOC_MEASURE(structcdc);\n    SIZE_MALLOC_MEASURE(structiii);\n    SIZE_MALLOC_MEASURE(structiic);\n    SIZE_MALLOC_MEASURE(struct12);\n    SIZE_MALLOC_MEASURE(struct13);\n    SIZE_MALLOC_MEASURE(struct28);\n    SIZE_MALLOC_MEASURE(struct29);\n}\n</code></pre> <p>\u547d\u540d\u89c4\u5219\u4e3a\uff1ac:chart i:int d:double\uff0c\u5e76\u4e14\u4e92\u76f8\u62fc\u63a5\u3002</p> <p>\u7ed3\u679c\uff1a <pre><code>struct          sizeof   malloc size\nint             4        16 267900 16 16 16 16 16 16 16 16\nstructc         1        16 16 16 16 16 16 16 16 16 16\nstructic        8        16 16 16 16 16 16 16 16 16 16\nstructip        8        16 16 16 16 16 16 16 16 16 16\nstructdc        16       20 20 20 20 20 524 20 20 20 20\nstructcd        16       20 20 20 20 20 20 20 20 20 20\nstructcdc       24       28 28 28 28 28 28 28 28 28 28\nstructiii       12       16 16 16 16 16 16 16 16 16 16\nstructiic       12       16 16 16 16 16 16 16 16 16 16\nstruct12        12       16 16 16 16 16 16 16 16 16 16\nstruct13        13       20 20 20 20 20 20 20 20 20 20\nstruct28        28       32 32 32 32 32 32 32 32 32 32\nstruct29        29       36 36 36 36 36 36 36 36 36 36\n</code></pre> \u53ef\u4ee5\u770b\u5230\uff0c\u7ed3\u6784\u4f53\u4f1a\u8fdb\u884c\u5bf9\u9f50\u8865\u5168\uff0c\u6709double\u4f1a\u8865\u9f508\u5b57\u8282\u3002\u6240\u4ee5\u60f3\u5728\u901a\u4fe1\u4ee3\u7801\u4e2d\u901a\u8fc7\u7ed3\u6784\u4f53\u8f6c\u6362\u534f\u8bae\uff0c\u8bb0\u5f97\u4f7f\u7528#pragma pack(1)\u63091\u5b57\u8282\u5bf9\u9f50\u3002</p> <p>malloc\u5728\u7533\u8bf7\u5185\u5b58\u65f6\uff0c\u4e5f\u4f1a\u6709\u591a\u4f59\u7684\u7a7a\u95f4\u5360\u7528\uff0c\u5e76\u4e14\u4e0d\u4e00\u5b9a\u662f\u7ebf\u6027\u589e\u957f\uff0c\u8fd9\u4e0emalloc\u7684\u5b9e\u73b0\u65b9\u5f0f\u6709\u5173\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-for-chips-base-time-space-cal/#_2","title":"\u6574\u5f62\u8fd0\u7b97\u7b26\u65f6\u95f4\u6d88\u8017","text":"<pre><code>#define INT_TIME_MEASURE(OP, n) \\\ndo { \\\n    printf(\"%s%c\\t\", #OP, strlen(#OP)&lt;8?'\\t':' '); \\\n    int64_t timesum = 0; \\\n    for(int ttt=0; ttt&lt;5; ttt++) { \\\n        int64_t start = esp_timer_get_time(); \\\n        for(int i=1; i&lt;=n; i++) { \\\n            for(int j=1; j&lt;=n; j++) { \\\n                OP; \\\n            } \\\n        } \\\n        int64_t t = esp_timer_get_time() - start; \\\n        printf(\"%lld \", t); \\\n        timesum += t; \\\n    } \\\n    printf(\"\\t%lld\\n\", 1000*timesum / (n*n*5)); \\\n} while (0)\n\nvoid platform_int_time_measure(void)\n{\n    int loop_n = 500;\n    printf(\"\\nplatform_int_time_measure (n=%d)\\n\", loop_n);\n    printf(\"oprate\\t\\ttime(us)\\t\\ttime avg(ns)\\n\");\n    volatile int k = 0;\n    INT_TIME_MEASURE({}, loop_n);\n    INT_TIME_MEASURE(k++, loop_n);\n    INT_TIME_MEASURE(k=i+j, loop_n);\n    INT_TIME_MEASURE(k=i-j, loop_n);\n    INT_TIME_MEASURE(k=i*j, loop_n);\n    INT_TIME_MEASURE(k=i/j, loop_n);\n    INT_TIME_MEASURE(k=i%j, loop_n);\n    INT_TIME_MEASURE(k=i&amp;j, loop_n);\n    INT_TIME_MEASURE(k=i|j, loop_n);\n}\n</code></pre> <p>\u56e0\u4e3a\u6d89\u53ca\u5230\u65f6\u95f4\u8ba1\u7b97\uff0c\u5f97\u4f7f\u7528\u8ba1\u65f6\u51fd\u6570\uff0c\u8fd9\u91cc\u662fESP32\u7684\u5b9e\u73b0\u65b9\u5f0f\u3002\u7531\u4e8e\u8fd0\u884c\u901f\u5ea6\u5f88\u5feb\uff0c\u5b9a\u65f6\u5668\u5206\u8fa8\u7387\u4e0d\u9ad8\uff0c\u6240\u4ee5\u91c7\u7528\u591a\u6b21\u8fd0\u884c\u53d6\u5e73\u5747\u503c\u7684\u65b9\u5f0f\u3002</p> <p>\u7ed3\u679c\uff1a <pre><code>//ESP32\nplatform_int_time_measure (n=500)\noprate          time(us)                        time avg(ns)\n{}              1 1 1 1 1       0\nk++             11473 11475 11471 11471 11471   45\nk=i+j           7306 7305 7301 7305 7305        29\nk=i-j           7302 7305 7304 7305 7301        29\nk=i*j           9390 9390 9390 9390 9390        37\nk=i/j           9621 9620 9620 9621 9621        38\nk=i%j           10664 10663 10662 10662 10662   42\nk=i&amp;j           8347 8346 8346 8346 8343        33\nk=i|j           8347 8346 8347 8346 8346        33\n\n//STM32F103C8\nplatform_int_time_measure (n=500)\noprate      time(us)                         time avg(ns)\n{}          27290 27290 27280 27280 27290   109\nk++        39150 39150 39150 39150 39150    156\nk=i+j       39060 39060 39070 39070 39070   156\nk=i-j       35110 35110 35110 35110 35100   140\nk=i*j       35180 35180 35180 35180 35180   140\nk=i/j       44410 44410 44410 44410 44410   177\nk=i%j       63790 63790 63790 63790 63790   255\nk=i&amp;j       39060 39070 39070 39060 39060   156\nk=i|j       46820 46820 46820 46820 46830   187\n</code></pre> ESP32\u7684\u81ea\u589e\u8fd0\u7b97\u6bd4\u8f83\u8017\u65f6\uff0c\u6709\u70b9\u5947\u602a\u3002STM32\u4e0a\u81ea\u589e\u548c\u52a0\u6cd5\u662f\u4e00\u6837\u7684\u3002</p> <p>ESP32\u7684\u9664\u6cd5\u6ca1\u6709\u66f4\u8017\u65f6\uff0cSTM32\u7684\u9664\u6cd5\u662f\u66f4\u8017\u65f6\u7684\u3002</p> <p>\u5e73\u65f6\u6ca1\u6ce8\u610f\u5230\u7684\u662f\uff0c\u6c42\u4f59\u8fd0\u7b97\u975e\u5e38\u8017\u65f6\u3002\u4e0e\u8fd0\u7b97\u4e5f\u4e0d\u80fd\u8bf4\u7701\u65f6\u95f4\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-for-chips-base-time-space-cal/#_3","title":"\u6d6e\u70b9\u8fd0\u7b97\u7b26\u65f6\u95f4\u6d88\u8017","text":"<pre><code>#define FLOAT_TIME_MEASURE(OP, n) \\\ndo { \\\n    printf(\"%s%c\\t\", #OP, strlen(#OP)&lt;8?'\\t':' '); \\\n    int64_t timesum = 0; \\\n    volatile float fi,fj; \\\n    for(int ttt=0; ttt&lt;5; ttt++) { \\\n        int64_t start = esp_timer_get_time(); \\\n        for(int i=1; i&lt;=n; i++) { \\\n            fi = i; \\\n            for(int j=1; j&lt;=n; j++) { \\\n                fj = j; \\\n                OP; \\\n            } \\\n        } \\\n        int64_t t = esp_timer_get_time() - start; \\\n        printf(\"%lld \", t); \\\n        timesum += t; \\\n    } \\\n    printf(\"\\t%lld\\n\", 1000*timesum / (n*n*5)); \\\n} while (0)\n\nvoid platform_float_time_measure(void)\n{\n    int loop_n = 100;\n    printf(\"\\nplatform_float_time_measure (n=%d)\\n\", loop_n);\n    printf(\"oprate\\t\\ttime(us)\\t\\ttime avg(ns)\\n\");\n    volatile float fk = 0;\n    FLOAT_TIME_MEASURE({}, loop_n);\n    FLOAT_TIME_MEASURE(fk=fi+fj, loop_n);\n    FLOAT_TIME_MEASURE(fk=fi-fj, loop_n);\n    FLOAT_TIME_MEASURE(fk=fi*fj, loop_n);\n    FLOAT_TIME_MEASURE(fk=fi/fj, loop_n);\n}\n</code></pre> <p>\u7ed3\u679c\uff1a <pre><code>//ESP32\nplatform_float_time_measure (n=100)\noprate          time(us)                        time avg(ns)\n{}              1685 1683 1683 1683 1683        168\nfk=fi+fj        3941 3935 3939 3936 3935        393\nfk=fi-fj        4516 4511 4514 4510 4514        451\nfk=fi*fj        4293 4291 4295 4291 4295        429\nfk=fi/fj        14036 14037 14034 14033 14037   1403\n\n//STM32\nplatform_float_time_measure (n=100)\noprate      time(us)                         time avg(ns)\n{}          6000 6010 6000 6000 6010    600\nfk=fi+fj    15670 15680 15680 15680 15680   1567\nfk=fi-fj    14760 14760 14760 14760 14760   1476\nfk=fi*fj    13920 13920 13920 13920 13920   1392\nfk=fi/fj    20790 20790 20790 20790 20790   2079\n</code></pre> \u8fc7\u7a0b\u4e2d\u9700\u8981\u5148\u5c06\u6574\u6570\u8d4b\u503c\u7ed9\u6d6e\u70b9\uff0c\u6d88\u8017\u4e86\u4e0d\u5c11\u65f6\u95f4\u3002\u6240\u4ee5\u9700\u8981\u51cf\u53bb\u7a7a\u8fd0\u884c\u7684\u65f6\u95f4\u3002\u5373\u4f7f\u662f\u5e26FPU\u7684ESP32\uff0c\u4f9d\u7136\u6d88\u8017\u4e0d\u5c11\u65f6\u95f4\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-for-chips-base-time-space-cal/#_4","title":"\u6570\u7ec4\u8fd0\u7b97\u7b26\u65f6\u95f4\u6d88\u8017","text":"<pre><code>void platform_array_time_measure(void)\n{\n    int loop_n = 500;\n    printf(\"\\nplatform_array_time_measure (n=%d)\\n\", loop_n);\n    printf(\"oprate\\t\\ttime(us)\\t\\ttime avg(ns)\\n\");\n    volatile int k = 0;\n    int x[loop_n+1];\n    INT_TIME_MEASURE(k=i+j, loop_n);\n    INT_TIME_MEASURE(k=x[i]+j, loop_n);\n    INT_TIME_MEASURE(k=i+x[j], loop_n);\n    INT_TIME_MEASURE(k=x[i]+x[j], loop_n);\n}\n</code></pre> <p>\u76f4\u63a5\u4f7f\u7528\u6574\u6570\u7684\u5b8f\uff0c\u7ed3\u679c\u548c\u6574\u6570\u64cd\u4f5c\u5dee\u5f02\u4e0d\u5927 <pre><code>platform_array_time_measure (n=500)\noprate          time(us)                        time avg(ns)\nk=i+j           7302 7304 7304 7301 7304        29\nk=x[i]+j        7313 7313 7309 7312 7313        29\nk=i+x[j]        10431 10429 10430 10430 10430   41\nk=x[i]+x[j]     10432 10432 10432 10432 10432   41\n</code></pre></p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-for-chips-base-time-space-cal/#_5","title":"\u64cd\u4f5c\u7b26\u548c\u6570\u5b66\u5e93\u65f6\u95f4\u6d88\u8017","text":"<pre><code>void platform_function_time_measure(void)\n{\n    int loop_n = 100;\n    printf(\"\\nplatform_function_time_measure (n=%d)\\n\", loop_n);\n    printf(\"oprate\\t\\ttime(us)\\t\\ttime avg(ns)\\n\");\n    volatile int k = 0;\n    volatile float fk = 0;\n    INT_TIME_MEASURE(k=(i&gt;j)?i:j, loop_n);\n    INT_TIME_MEASURE(rand(), loop_n);\n    FLOAT_TIME_MEASURE(fk=sqrt(j+fi), loop_n);\n    FLOAT_TIME_MEASURE(fk=sin(j+fi), loop_n);\n    // FLOAT_TIME_MEASURE(fk=sinh(j+fi), loop_n);\n    // FLOAT_TIME_MEASURE(fk=asin(j+fi), loop_n);\n    // FLOAT_TIME_MEASURE(fk=cos(j+fi), loop_n);\n    // FLOAT_TIME_MEASURE(fk=tan(j+fi), loop_n);\n}\n</code></pre> <p>\u7ed3\u679c\uff1a</p> <p><pre><code>platform_function_time_measure (n=100)\noprate          time(us)                        time avg(ns)\nk=(i&gt;j)?i:j     337 336 336 336 336             33\nrand()          3763 3753 3756 3752 3756        375\nfk=sqrt(j+fi)   58442 58416 58417 58419 58416   5842\nfk=sin(j+fi)    111011 110967 110970 110967 110971      11097\n</code></pre> \u5f00\u65b9\u6ca1\u6709\u60f3\u8c61\u4e2d\u7684\u8017\u65f6\uff0c\u4e09\u89d2\u51fd\u6570\u8017\u65f6\u771f\u7684\u5927\u3002\u5982\u679c\u5bf9\u7cbe\u5ea6\u8981\u6c42\u4e0d\u9ad8\uff0c\u5982\u547c\u5438\u706f\u4ec0\u4e48\u7684\uff0c\u5f3a\u70c8\u5efa\u8bae\u4f7f\u7528\u5feb\u901f\u4e09\u89d2\u51fd\u6570\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-for-chips-base-time-space-cal/#malloc_1","title":"malloc\u65f6\u95f4\u6d88\u8017","text":"<pre><code>#define ALLOC_TIME_MEASURE(OP, n) \\\ndo { \\\n    printf(\"%s%c\\t\", #OP, strlen(#OP)&lt;8?'\\t':' '); \\\n    int64_t timesum = 0; \\\n    int64_t start = esp_timer_get_time(); \\\n    for(int i=1; i&lt;=n; i++) { \\\n        OP; \\\n    } \\\n    int64_t t = esp_timer_get_time() - start; \\\n    printf(\"%lld \", t); \\\n    timesum += t; \\\n    printf(\"\\t\\t%lld\\n\", 1000*timesum / (n)); \\\n} while (0)\n\n#define ALLOC_FREE_MEASURE(OP, n) \\\ndo { \\\n    printf(\"%s%c\\t\\t\", #OP, strlen(#OP)&lt;8?'\\t':' '); \\\n    int64_t timesum = 0; \\\n    int64_t start = esp_timer_get_time(); \\\n    for(int i=1; i&lt;=n; i++) { \\\n        OP; \\\n    } \\\n    int64_t t = esp_timer_get_time() - start; \\\n    printf(\"%lld \", t); \\\n    timesum += t; \\\n    printf(\"\\t\\t%lld\\n\", 1000*timesum / (n)); \\\n} while (0)\n\nvoid platform_alloc_time_measure(void)\n{\n    int loop_n = 100;\n    printf(\"\\nplatform_alloc_time_measure (n=%d)\\n\", loop_n);\n    printf(\"oprate\\t\\t\\ttime(us)\\ttime avg(ns)\\n\");\n    volatile int* k[loop_n+1];\n    ALLOC_TIME_MEASURE(k[i]=malloc(16), loop_n);\n    ALLOC_FREE_MEASURE(free(k[i]), loop_n);\n    ALLOC_TIME_MEASURE(k[i]=malloc(100), loop_n);\n    ALLOC_FREE_MEASURE(free(k[i]), loop_n);\n    ALLOC_TIME_MEASURE(k[i]=malloc(2000), loop_n);\n    ALLOC_FREE_MEASURE(free(k[i]), loop_n);\n}\n</code></pre> <p>\u7ed3\u679c\uff1a</p> <pre><code>platform_alloc_time_measure (n=100)\noprate                  time(us)        time avg(ns)\nk[i]=malloc(16)         317             3170\nfree(k[i])              195             1950\nk[i]=malloc(100)        317             3170\nfree(k[i])              194             1940\nk[i]=malloc(2000)       613             6130\nfree(k[i])              189             1890\n</code></pre> <p>free\u8017\u65f6\u6bd4\u8f83\u7a33\u5b9a\u3002malloc\u8017\u65f6\u4f1a\u968f\u7740\u7a7a\u95f4\u589e\u5927\u800c\u589e\u5927\uff0c\u4f46\u4e5f\u4e0d\u662f\u7ebf\u6027\u5173\u7cfb\u3002\u5e76\u4e14\u8fd9\u4e24\u4e2a\u7684\u8017\u65f6\u4e5f\u4e0d\u80fd\u5ffd\u7565\u4e0d\u8ba1\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/dev/utils-for-chips-base-time-space-cal/#end","title":"End","text":"<p>\u901a\u8fc7\u8fd9\u4e9b\u5bf9\u6bd4\uff0c\u4ee5\u524d\u5ffd\u89c6\u7684malloc\u548cfree\uff0c\u5176\u5b9e\u4e5f\u662f\u65f6\u95f4\u7a7a\u95f4\u6d88\u8017\u5927\u6237\u3002\u6c42\u4f59\u8fd0\u7b97\u4e0e\u8fd0\u7b97\u4e5f\u503c\u5f97\u6ce8\u610f\u3002</p> <p>\u6709\u4e86\u8fd9\u4e9b\u7a7a\u95f4\u548c\u65f6\u95f4\u6d88\u8017\u7684\u5bf9\u6bd4\uff0c\u76f8\u4fe1\u5927\u5bb6\u5c31\u53ef\u4ee5\u5bf9\u81ea\u5df1\u4f7f\u7528\u7684\u5e73\u53f0\u6709\u4e86\u66f4\u8fdb\u4e00\u6b65\u7684\u4e86\u89e3\u3002\u540c\u65f6\u5728\u4ee5\u540e\u9700\u8981\u4f18\u5316\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u4e5f\u80fd\u6709\u4e00\u4e2a\u660e\u786e\u7684\u65b9\u5411\u3002</p> <p>\u672c\u6587\u4e5f\u53d1\u5e03\u5728</p> <p>segmentfault</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-Bootloader-rtfsc-rboot-1/","title":"ESP8266 Bootloader\u5f00\u6e90\u4ee3\u7801\u89e3\u6790\u4e4brboot\uff08\u4e00\uff09","text":"\u66f4\u65b0\u65e5\u671f: 2022-08-10 <ul> <li>2022-08-10 \u66f4\u65b0</li> </ul> <p>Cyber &amp; Robot \u6388\u6743\u53d1\u5e03</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-Bootloader-rtfsc-rboot-1/#_1","title":"\u524d\u8a00","text":"<p>\u5728\u975eLinux\u7684\u5d4c\u5165\u5f0f\u5f00\u53d1\u4e2d\uff0c\u81ea\u5df1\u624b\u5199Bootloader\u662f\u5f88\u6b63\u5e38\u7684\u4e8b\u3002\u56e0\u4e3a\u53ef\u4ee5\u5b9a\u5236\u81ea\u5df1\u60f3\u8981\u7684\u529f\u80fd\u3002\u6bd4\u5982\u5b9a\u5236\u81ea\u5df1\u7684Bootloader\u901a\u4fe1\u63a5\u53e3\uff08UART\u3001I2C\u3001SPI\uff09\uff0c\u901a\u4fe1\u534f\u8bae\uff0c\u751a\u81f3\u66f4\u9ad8\u7ea7\u7684\u56fa\u4ef6\u5907\u4efd\u56de\u9000\u7b49\u529f\u80fd\u3002\u4f46\u662f\u4f7f\u7528ESP8266\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u6574\u4e2a\u82af\u7247\u7684\u7a0b\u5e8f\u662f\u600e\u4e48\u8dd1\u8d77\u6765\u7684\u90fd\u4e00\u77e5\u534a\u89e3\uff08\u6240\u4ee5\u6211\u5199\u4e86\u8fd9\u7bc7\u6587\u7ae0\uff1aESP8266\u67b6\u6784\u63a2\u7d22-\u8fd0\u884c\u7684\u8d77\u59cb</p> <p>\u5b98\u65b9\u63d0\u4f9b\u4e86Bootloader\u548c\u5b8c\u6574\u7684\u63a5\u53e3\uff0c\u4f46\u662f\u662f\u95ed\u6e90\u7684\uff1b\u5b98\u65b9Bootloader\u867d\u7136\u6709\u505a\u56fa\u4ef6\u5907\u4efd\uff0c\u4f46\u662f\u6ca1\u6709\u56fa\u4ef6\u56de\u6eda\uff0c\u7b49\u7b49\u8fd9\u4e9b\u95ee\u9898\u3002\u6240\u4ee5\u8fd9\u65f6\u5019rboot\u51fa\u73b0\u4e86\u3002</p> <p>\u6211\u4eec\u6709\u5f88\u591a\u539f\u56e0\u4e0d\u80fd\u4ece\u65e0\u5230\u6709\u5199\u4e00\u4e2a\u81ea\u5df1\u7684Bootloader\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u501f\u9274\uff0c\u77e5\u9053rboot\u600e\u4e48\u8fd0\u4f5c\u540e\uff0c\u5c31\u80fd\u591f\u901a\u8fc7\u4fee\u6539\uff0c\u88c1\u526a\uff0c\u505a\u51fa\u81ea\u5df1\u60f3\u8981\u7684Bootloader\u3002\u6240\u4ee5\u8fd9\u7bc7\u6587\u7ae0\u4e0d\u4f1a\u82b1\u5927\u529b\u6c14\u53bb\u5206\u6790rboot\u7684\u7279\u6027\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff0c\u7740\u91cd\u4e8e\u600e\u4e48\u5199\u4e00\u4e2aESP8266\u4e0a\u6700\u57fa\u7840\u7684Bootloader\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-Bootloader-rtfsc-rboot-1/#_2","title":"\u5de5\u7a0b\u76ee\u5f55","text":"<p>\u5148\u7ed9\u51farboot\u7684github\u5730\u5740\uff1ahttps://github.com/raburton/rboot</p> <p>\u7f16\u8bd1\u540e\uff0c\u662f\u50cf\u4e0b\u9762\u8fd9\u6837 <pre><code>.\n\u251c\u2500\u2500 appcode\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 rboot-api.c\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 rboot-api.h\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 rboot-bigflash.c\n\u251c\u2500\u2500 build\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 rboot.elf\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 rboot-hex2a.h\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 rboot.o\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 rboot-stage2a.elf\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 rboot-stage2a.o\n\u251c\u2500\u2500 eagle.app.v6.ld\n\u251c\u2500\u2500 eagle.rom.addr.v6.ld\n\u251c\u2500\u2500 firmware\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 rboot.bin\n\u251c\u2500\u2500 license.txt\n\u251c\u2500\u2500 Makefile\n\u251c\u2500\u2500 rboot.c\n\u251c\u2500\u2500 rboot.h\n\u251c\u2500\u2500 rboot-private.h\n\u251c\u2500\u2500 rboot-stage2a.c\n\u251c\u2500\u2500 rboot-stage2a.ld\n\u251c\u2500\u2500 readme-api.txt\n\u251c\u2500\u2500 readme.md\n\u251c\u2500\u2500 testload1.c\n\u2514\u2500\u2500 testload2.c\n</code></pre> \u5176\u4e2d\uff0crboot.c rboot-stage2a.c\u5c31\u662f\u6211\u4eec\u60f3\u8981\u7684\u4ee3\u7801\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-Bootloader-rtfsc-rboot-1/#_3","title":"\u8fd0\u884c\u6d41\u7a0b","text":"<p>rboot.c\u7684ENTRY\u662fcall_user_start\uff0c\u6211\u4eec\u770b\u770b\u8fd0\u884c\u6d41\u7a0b\uff1a\uff08c\u8bed\u8a00\u7248\u548c\u6c47\u7f16\u7248\u529f\u80fd\u4e00\u6837\uff0c\u770bc\u8bed\u8a00\u4ee3\u7801\u4fbf\u4e8e\u7406\u89e3\uff09 <pre><code>void call_user_start(void) {\n    uint32_t addr;\n    stage2a *loader;\n\n    addr = find_image();\n    if (addr != 0) {\n        loader = (stage2a*)entry_addr;      //rboot-stage2a.c\u4e2d\u7684call_user_start\n        loader(addr);\n    }\n}\n</code></pre></p> <p>\u4ece\u914d\u7f6e\u53c2\u6570\u4e2d\u627e\u5230\u5e94\u7528\u56fa\u4ef6\u7684\u5730\u5740\uff0c\u7136\u540e\u8c03\u7528entry_addr\u5904\u7684\u51fd\u6570\u6267\u884c\u3002</p> <p>entry_addr\u5728rboot-hex2a.h\u4e2d\u5b9a\u4e49\uff1a <pre><code>const uint32_t entry_addr = 0x4010fcb4;   //\u88abrboot.c\u4e2d\u7684call_user_start\u91cc\u8c03\u7528\n\nconst uint32_t _text_addr = 0x4010fc00;\nconst uint32_t _text_len = 192;\nconst uint8_t  _text_data[] = {\n  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n  0x00, 0x10, 0x00, 0x00, 0x1c, 0x4b, 0x00, 0x40, 0x12, 0xc1, 0xc0, 0xc9, 0xe1, 0x8b, 0x31, 0xcd,\n  0x02, 0x0c, 0x84, 0xe9, 0xc1, 0xf9, 0xb1, 0x09, 0xf1, 0xd9, 0xd1, 0xc2, 0xcc, 0x08, 0x01, 0xf9,\n  0xff, 0xc0, 0x00, 0x00, 0xf8, 0x31, 0xe2, 0x01, 0x09, 0x86, 0x10, 0x00, 0x2d, 0x0c, 0x3d, 0x01,\n  0x0c, 0x84, 0x01, 0xf4, 0xff, 0xc0, 0x00, 0x00, 0x8b, 0xcc, 0x78, 0x01, 0xd8, 0x11, 0x46, 0x09,\n  0x00, 0x21, 0xef, 0xff, 0x5d, 0x0d, 0xd7, 0xb2, 0x02, 0x20, 0x52, 0x20, 0x2d, 0x0c, 0x3d, 0x07,\n  0x4d, 0x05, 0x59, 0x51, 0x79, 0x41, 0x01, 0xeb, 0xff, 0xc0, 0x00, 0x00, 0x58, 0x51, 0x78, 0x41,\n  0x5a, 0xcc, 0x5a, 0x77, 0x50, 0xdd, 0xc0, 0x56, 0x6d, 0xfd, 0x0b, 0x6e, 0x60, 0xe0, 0x74, 0x56,\n  0x9e, 0xfb, 0x08, 0xf1, 0x2d, 0x0f, 0xc8, 0xe1, 0xd8, 0xd1, 0xe8, 0xc1, 0xf8, 0xb1, 0x12, 0xc1,\n  0x40, 0x0d, 0xf0, 0x00, 0xfd, 0x00, 0x05, 0xf8, 0xff, 0x0d, 0x0f, 0xa0, 0x02, 0x00, 0x0d, 0xf0,\n};\n</code></pre> \u5bf9\u6bd4entry_addr\u548c_text_addr\u5173\u7cfb\uff0c\u518d\u6839\u636e_text_addr\u548c_text_data\u7684\u540d\u5b57\u5173\u7cfb\uff08\u624b\u52a8\u72d7\u5934\uff09\uff0c\u77e5\u9053entry_addr\u7684\u4ee3\u7801\u5c31\u5728_text_data\u4e2d\u3002rboot-hex2a.h\u7531rboot-stage2a.c\u751f\u6210\u7684\uff0ccall_user_start\u5728rboot-stage2a.ld\u4e2d\u5b9a\u4e49\u4e3aENTRY\uff1a <pre><code>/*  Default entry point:  */\nENTRY(call_user_start)\n</code></pre> rboot-stage2a.c\u7684\u4ee3\u7801\uff1a <pre><code>void call_user_start(uint32_t readpos) {\n    usercode* user;\n    user = load_rom(readpos);\n    user();\n}\n</code></pre></p> <p>\u4eceflash\u4e2d\u8bfb\u53d6\u4ee3\u7801\uff0c\u7136\u540e\u6267\u884c\u3002</p> <p>\u6240\u4ee5\u6574\u4e2arboot\u6d41\u7a0b\u5c31\u662f\uff1a\u4ece\u914d\u7f6e\u53c2\u6570\u4e2d\u627e\u5230\u5e94\u7528\u56fa\u4ef6\u7684\u5730\u5740\uff0c\u7136\u540e\u8c03\u7528rboot-stage2a\u4e2d\u7684\u51fd\u6570\u4eceflash\u4e2d\u8bfb\u53d6\u4ee3\u7801\uff0c\u7136\u540e\u6267\u884c\u3002</p> <p>\u8fd9\u6837\u8bf4\u4e0b\u6765\uff0c\u6d41\u7a0b\u662f\u901a\u4e86\uff0c\u4f46\u662f\u8fc7\u7a0b\u4e00\u70b9\u90fd\u7ecf\u4e0d\u8d77\u63a8\u6572\u554a\u3002\u90a3\u4e48\u4e0b\u9762\u6765\u8ba4\u771f\u5206\u6790rboot-stage2a.c\u7684\u4ee3\u7801\u600e\u4e48\u5173\u8054\u5230rboot.c\u4e2d\u7684\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-Bootloader-rtfsc-rboot-1/#_4","title":"\u7f16\u8bd1\u5206\u6790","text":"<p>\u6211\u4eec\u5148\u770bMakefile\u3002 <pre><code>all: $(RBOOT_BUILD_BASE) $(RBOOT_FW_BASE) $(RBOOT_FW_BASE)/rboot.bin\n\n$(RBOOT_BUILD_BASE)/rboot.o: rboot.c rboot-private.h rboot.h $(RBOOT_BUILD_BASE)/rboot-hex2a.h\n    @echo \"CC $&lt;\"\n    $(Q) $(CC) $(CFLAGS) -I$(RBOOT_BUILD_BASE) -c $&lt; -o $@\n\n$(RBOOT_BUILD_BASE)/rboot-hex2a.h: $(RBOOT_BUILD_BASE)/rboot-stage2a.elf\n    @echo \"E2 $@\"\n    $(Q) $(ESPTOOL2) -quiet -header $&lt; $@ .text  \n\n$(RBOOT_BUILD_BASE)/rboot-stage2a.elf: $(RBOOT_BUILD_BASE)/rboot-stage2a.o\n    @echo \"LD $@\"\n    $(Q) $(LD) -Trboot-stage2a.ld $(LDFLAGS) -Wl,--start-group $^ -Wl,--end-group -o $@\n</code></pre> \u987a\u5e8f\u6709\u6240\u8c03\u6574\u3002\u4f46\u6700\u7ec8rboot-stage2a.c\u53d8\u6210\u4e86rboot-hex2a.h\u5305\u542b\u5728rboot.c\u4e2d\u3002</p> <p>\u8fd9\u91cc\u6709\u4e24\u4e2a\u5173\u952e\u7684\u5730\u65b9\uff1a</p> <ol> <li>rboot-stage2a.elf\u901a\u8fc7ESPTOOL2\u53d8\u6210\u4e86rboot-hex2a.h</li> <li>rboot-stage2a.c\u6700\u7ec8\u53d8\u6210\u4e86rboot-hex2a.h</li> </ol> <p>\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u7528\u5230\u4e86esptool2\uff0c\u5148\u628aesptool2\u4e0b\u8f7d\u4e0b\u6765\uff1ahttps://github.com/raburton/esptool2</p> <p>\u76f4\u5954\u4e3b\u9898\uff0cesptool2.c\u6587\u4ef6\u4e2d\uff0c\u4f7f\u7528-header\u53c2\u6570\u5c31\u662f\u628aelf\u6587\u4ef6\u53d8\u6210.h\u5934\u6587\u4ef6 <pre><code>// load elf file\nelf = LoadElf(elffile);\nif (!elf) {\n    goto end_function;\n}\n\n// open output file\noutfile = fopen(imagefile, \"wb\");\nif(outfile == NULL) {\n    error(\"Error: Failed to open output file '%s' for writing.\\r\\n\", imagefile);\n    goto end_function;\n}\n\n// add entry point\nfprintf(outfile, \"const uint32_t entry_addr = 0x%08x;\\r\\n\", elf-&gt;header.e_entry);\n\n// add sections\nfor (i = 0; i &lt; numsec; i++) {\n    // get elf section header\n    sect = GetElfSection(elf, sections[i]);\n    if(!sect) {\n        error(\"Error: Section '%s' not found in elf file.\\r\\n\", sections[i]);\n        goto end_function;\n    }\n\n    // simple name fix name\n    strncpy(name, sect-&gt;name, 31);\n    len = strlen(name);\n    for (j = 0; j &lt; len; j++) {\n        if (name[j] == '.') name[j] = '_';\n    }\n\n    // add address, length and start the data block\n    debug(\"Adding section '%s', addr: 0x%08x, size: %d.\\r\\n\", sections[i], sect-&gt;address, sect-&gt;size);\n    fprintf(outfile, \"\\r\\nconst uint32_t %s_addr = 0x%08x;\\r\\nconst uint32_t %s_len = %d;\\r\\nconst uint8_t  %s_data[] = {\",\n        name, sect-&gt;address, name, sect-&gt;size, name);\n\n    // get elf section binary data\n    bindata = GetElfSectionData(elf, sect);\n    if (!bindata) {\n        goto end_function;\n    }\n\n    // add the data and finish off the block\n    for (j = 0; j &lt; sect-&gt;size; j++) {\n        if (j % 16 == 0) fprintf(outfile, \"\\r\\n  0x%02x,\", bindata[j]);\n        else fprintf(outfile, \" 0x%02x,\", bindata[j]);\n    }\n    fprintf(outfile, \"\\r\\n};\\r\\n\");\n    free(bindata);\n    bindata = 0;\n}\n</code></pre></p> <p>\u7136\u540e\u5bf9\u6bd4rboot-hex2a.h\u6587\u4ef6\uff0c\u662f\u4e0d\u662f\u8fd9\u6837\u8f6c\u8fc7\u6765\u7684\uff1a <pre><code>const uint32_t entry_addr = 0x4010fcb4;\n\nconst uint32_t _text_addr = 0x4010fc00;\nconst uint32_t _text_len = 192;\nconst uint8_t  _text_data[] = {\n  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n  0x00, 0x10, 0x00, 0x00, 0x1c, 0x4b, 0x00, 0x40, 0x12, 0xc1, 0xc0, 0xc9, 0xe1, 0x8b, 0x31, 0xcd,\n  0x02, 0x0c, 0x84, 0xe9, 0xc1, 0xf9, 0xb1, 0x09, 0xf1, 0xd9, 0xd1, 0xc2, 0xcc, 0x08, 0x01, 0xf9,\n  0xff, 0xc0, 0x00, 0x00, 0xf8, 0x31, 0xe2, 0x01, 0x09, 0x86, 0x10, 0x00, 0x2d, 0x0c, 0x3d, 0x01,\n  0x0c, 0x84, 0x01, 0xf4, 0xff, 0xc0, 0x00, 0x00, 0x8b, 0xcc, 0x78, 0x01, 0xd8, 0x11, 0x46, 0x09,\n  0x00, 0x21, 0xef, 0xff, 0x5d, 0x0d, 0xd7, 0xb2, 0x02, 0x20, 0x52, 0x20, 0x2d, 0x0c, 0x3d, 0x07,\n  0x4d, 0x05, 0x59, 0x51, 0x79, 0x41, 0x01, 0xeb, 0xff, 0xc0, 0x00, 0x00, 0x58, 0x51, 0x78, 0x41,\n  0x5a, 0xcc, 0x5a, 0x77, 0x50, 0xdd, 0xc0, 0x56, 0x6d, 0xfd, 0x0b, 0x6e, 0x60, 0xe0, 0x74, 0x56,\n  0x9e, 0xfb, 0x08, 0xf1, 0x2d, 0x0f, 0xc8, 0xe1, 0xd8, 0xd1, 0xe8, 0xc1, 0xf8, 0xb1, 0x12, 0xc1,\n  0x40, 0x0d, 0xf0, 0x00, 0xfd, 0x00, 0x05, 0xf8, 0xff, 0x0d, 0x0f, 0xa0, 0x02, 0x00, 0x0d, 0xf0,\n};\n</code></pre></p> <p>entry_addr\u662felf\u6587\u4ef6\u4e2d\u7684\u5165\u53e3\u5730\u5740\u3002</p> <p>\u4e4b\u540e\u5219\u662f.text\u6bb5\u7684\u5730\u5740\u957f\u5ea6\u5185\u5bb9\u3002</p> <p>\u4f46\u8fd9\u580616\u8fdb\u5236\u6570\u5b57\uff0c\u6211\u4eec\u4e5f\u4e0d\u80fd\u786e\u5b9a\u5c31\u662f\u4ee3\u7801\u7f16\u8bd1\u51fa\u6765\u7684\u3002\u4e0d\u6015\uff0c\u6211\u4eec\u6709\u529e\u6cd5\u3002\u5728ESP8266\u7f16\u8bd1\u540e\uff0c\u4f1a\u751f\u6210\u4e00\u4e2aeagle.dump\u6587\u4ef6\uff0c\u6211\u4eec\u540c\u6837\u53ef\u4ee5\u628arboot-stage2a.elf\u91cc\u7684\u4fe1\u606f\u5f04\u51fa\u6765\u3002</p> <p>\u7a0d\u5fae\u4fee\u6539Makefile\u6587\u4ef6 <pre><code>ifndef XTENSA_BINDIR\nCC := xtensa-lx106-elf-gcc\nLD := xtensa-lx106-elf-gcc\nOBJDUMP := xtensa-lx106-elf-objdump    #\u52a0\u4e0a\nelse\nCC := $(addprefix $(XTENSA_BINDIR)/,xtensa-lx106-elf-gcc)\nLD := $(addprefix $(XTENSA_BINDIR)/,xtensa-lx106-elf-gcc)\nOBJDUMP := $(addprefix $(XTENSA_BINDIR)/,xtensa-lx106-elf-objdump)   #\u52a0\u4e0a\nendif\n\n$(RBOOT_BUILD_BASE)/rboot-hex2a.h: $(RBOOT_BUILD_BASE)/rboot-stage2a.elf\n    @echo \"E2 $@\"\n    $(Q) $(OBJDUMP) -x -s -d $&lt; &gt; $(RBOOT_BUILD_BASE)/rboot-stage2a.dump   #\u52a0\u4e0a\n    $(Q) $(ESPTOOL2) -quiet -header $&lt; $@ .text\n</code></pre></p> <p>\u91cd\u65b0\u7f16\u8bd1\uff0c\u5c31\u80fd\u751f\u6210rboot-stage2a.dump\u6587\u4ef6\u4e86\u3002 <pre><code>make clean\nmake\n</code></pre></p> <p>rboot-stage2a.dump\uff1a\uff08\u6ce8\u610f\u770b\u91cc\u9762\u52a0\u7684\u6ce8\u91ca\uff09 <pre><code>build/rboot-stage2a.elf:     file format elf32-xtensa-le\nbuild/rboot-stage2a.elf\narchitecture: xtensa, flags 0x00000112:\nEXEC_P, HAS_SYMS, D_PAGED\nstart address 0x4010fcb4    #\u548centry_addr\u5bf9\u5e94\n\nContents of section .text:   #.text\u6bb5\u5185\u5bb9\u548c_text_data[]\u5bf9\u5e94\n 4010fc00 00000000 00000000 00000000 00000000  ................\n 4010fc10 00000000 00000000 00000000 00000000  ................\n 4010fc20 00000000 00000000 00000000 00000000  ................\n 4010fc30 00100000 1c4b0040 12c1c0c9 e18b31cd  .....K.@......1.\n 4010fc40 020c84e9 c1f9b109 f1d9d1c2 cc0801f9  ................\n 4010fc50 ffc00000 f831e201 09861000 2d0c3d01  .....1......-.=.\n 4010fc60 0c8401f4 ffc00000 8bcc7801 d8114609  ..........x...F.\n 4010fc70 0021efff 5d0dd7b2 02205220 2d0c3d07  .!..].... R -.=.\n 4010fc80 4d055951 794101eb ffc00000 58517841  M.YQyA......XQxA\n 4010fc90 5acc5a77 50ddc056 6dfd0b6e 60e07456  Z.ZwP..Vm..n`.tV\n 4010fca0 9efb08f1 2d0fc8e1 d8d1e8c1 f8b112c1  ....-...........\n 4010fcb0 400df000 fd0005f8 ff0d0fa0 02000df0  @...............\n\n4010fcb4 &lt;call_user_start&gt;:     #entry_addr\u6267\u884c\u7684\u4ee3\u7801\n4010fcb4:   00fd        mov.n   a15, a0          #\u6ce8\u610f\u8fd9\u4e2a\u5730\u5740\n4010fcb6:   fff805          call0   4010fc38 &lt;load_rom&gt;\n4010fcb9:   0f0d        mov.n   a0, a15\n4010fcbb:   0002a0          jx  a2\n4010fcbe:   f00d        ret.n \n</code></pre></p> <p>call_user_start\u5728rboot-stage2a.ld\u4e2d\u5b9a\u4e49\u4e3aENTRY\uff1a <pre><code>EMORY\n{\n  dport0_0_seg :                        org = 0x3FF00000, len = 0x10\n  dram0_0_seg :                         org = 0x3FFE8000, len = 0x14000\n  iram1_0_seg :                         org = 0x4010FC00, len = 0x400\n  irom0_0_seg :                         org = 0x40240000, len = 0x3C000\n}\n\nPHDRS\n{\n  dport0_0_phdr PT_LOAD;\n  dram0_0_phdr PT_LOAD;\n  dram0_0_bss_phdr PT_LOAD;\n  iram1_0_phdr PT_LOAD;\n  irom0_0_phdr PT_LOAD;\n}\n\n\n/*  Default entry point:  */\nENTRY(call_user_start)\nEXTERN(_DebugExceptionVector)\nEXTERN(_DoubleExceptionVector)\nEXTERN(_KernelExceptionVector)\nEXTERN(_NMIExceptionVector)\nEXTERN(_UserExceptionVector)\nPROVIDE(_memmap_vecbase_reset = 0x40000000);\n</code></pre></p> <p>\u5230\u4e86\u8fd9\u91cc\uff0c\u5e94\u8be5\u5c31\u80fd\u5f04\u6e05\u695arboot-stage2a.c\u662f\u5982\u4f55\u7f16\u8bd1\uff0c\u5e76\u4e14\u5982\u679c\u548crboot-hex2a.h\u5bf9\u5e94\u8d77\u6765\u7684\u4e86\u3002</p> <p>\u4f46\u4e3a\u4ec0\u4e48\u8981\u641e\u90a3\u4e48\u9ebb\u70e6\uff1f</p> <p>\u56e0\u4e3arboot.c\u8fd8\u6709\u4e00\u5904\u5de7\u5999\u7684\u5730\u65b9\uff1a <pre><code>// copy the loader to top of iram\nets_memcpy((void*)_text_addr, _text_data, _text_len);\n</code></pre></p> <p>rboot-stage2a.c\u901a\u8fc7\u5de5\u5177\u8f6c\u6362\u6210rboot-hex2a.h\uff0c\u5c31\u662f\u4e3a\u4e86\u80fd\u5c06\u8fd9\u6bb5\u4ee3\u7801\u52a0\u8f7d\u5230iram\u4e2d\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-Bootloader-rtfsc-rboot-1/#_5","title":"\u5c0f\u7ed3","text":"<p>\u8fd9\u7bc7\u6587\u7ae0\u4e3b\u8981\u5bf9rboot\u76ee\u5f55\u8fdb\u884c\u4e86\u89e3\uff0c\u5927\u6982\u4e86\u89e3\u4e86\u52a0\u8f7d\u6d41\u7a0b\uff0c\u540c\u65f6\u6839\u636e\u7f16\u8bd1\u8fc7\u7a0b\u5c06\u91cd\u8981\u7684\u4e24\u4e2a\u7a0b\u5e8f\u6587\u4ef6\u4e32\u4e86\u8d77\u6765\u3002rboot\u7684\u8bbe\u8ba1\u8fd8\u662f\u6bd4\u8f83\u5de7\u5999\u7684\u3002\u6211\u4eec\u4e0b\u7bc7\u6587\u7ae0\u4f1a\u5bf9\u6574\u4e2a\u52a0\u8f7d\u6d41\u7a0b\u505a\u8be6\u7ec6\u8bb2\u89e3\u3002</p> <p>\u672c\u6587\u4e5f\u53d1\u5e03\u5728</p> <p>segmentfault</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-Bootloader-rtfsc-rboot-2/","title":"ESP8266 Bootloader\u5f00\u6e90\u4ee3\u7801\u89e3\u6790\u4e4brboot\uff08\u4e8c\uff09","text":"\u66f4\u65b0\u65e5\u671f: 2022-08-10 <ul> <li>2022-08-10 \u66f4\u65b0</li> </ul> <p>Cyber &amp; Robot \u6388\u6743\u53d1\u5e03</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-Bootloader-rtfsc-rboot-2/#_1","title":"\u56de\u987e","text":"<p>ESP8266 Bootloader\u5f00\u6e90\u4ee3\u7801\u89e3\u6790\u4e4brboot\uff08\u4e00\uff09</p> <p>\u4e0a\u4e00\u7bc7\u8bf4\u4e86rboot\u7684\u52a0\u8f7d\u6d41\u7a0b\uff0c\u4e3b\u8981\u7684\u662f\u901a\u8fc7makefile\u5c06\u4e24\u4e2a\u7a0b\u5e8f\u6587\u4ef6\u4e32\u4e86\u8d77\u6765\u3002\u8fd9\u7bc7\u6587\u7ae0\u4f1a\u5bf9\u6574\u4e2a\u52a0\u8f7d\u6d41\u7a0b\u505a\u8be6\u7ec6\u8bb2\u89e3\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-Bootloader-rtfsc-rboot-2/#_2","title":"\u6570\u636e\u7ed3\u6784","text":"<pre><code>typedef struct {\n    /* magic\u662f\u5e38\u7528\u7684\u540d\u79f0\uff0c\u7528\u6765\u6807\u8bc6\u8fd9\u662f\u4e2a\u7ed3\u6784\u4f53\uff0c\u901a\u5e38\u5b58\u5728flash\u4e0a\uff0c\u5e76\u4e14\u5df2\u7ecf\u88ab\u521d\u59cb\u5316\u4e86 */\n    uint8_t magic;           ///&lt; Our magic, identifies rBoot configuration - should be BOOT_CONFIG_MAGIC\n    /* \u7528\u6765\u8bf4\u660e\u5f53\u524d\u7684\u6570\u636e\u7ed3\u6784\u9002\u7528\u4e8e\u54ea\u4e2a\u7248\u672c\uff0c\u4e0d\u540c\u7248\u672c\u5e38\u9700\u8981\u8003\u8651\u517c\u5bb9\u6027\u95ee\u9898 */\n    uint8_t version;         ///&lt; Version of configuration structure - should be BOOT_CONFIG_VERSION\n    /* \u5f53\u524drboot\u7684\u542f\u52a8\u6a21\u5f0f */\n    uint8_t mode;            ///&lt; Boot loader mode (MODE_STANDARD | MODE_GPIO_ROM | MODE_GPIO_SKIP)\n    /* \u5f53\u524d\u9009\u62e9\u7684ROM\u533a\uff0c\u4f46\u8868\u793a\u7684\u662f\u63a5\u4e0b\u6765\u8981\u542f\u52a8\u7684ROM\u533a */\n    uint8_t current_rom;     ///&lt; Currently selected ROM (will be used for next standard boot)\n    /* MODE_GPIO_ROM\u6a21\u5f0f\u4e0b\u9009\u62e9\u7684ROM\u533a */\n    uint8_t gpio_rom;        ///&lt; ROM to use for GPIO boot (hardware switch) with mode set to MODE_GPIO_ROM\n    /* \u53ef\u7528\u7684ROM\u603b\u6570 */\n    uint8_t count;           ///&lt; Quantity of ROMs available to boot\n    /* \u5360\u4f4d\uff0c\u4f7f\u524d\u9762\u957f\u5ea6\u591f32\u4f4d\u6574\u6570 */\n    uint8_t unused[2];       ///&lt; Padding (not used)\n    /* \u6bcf\u4e2aROM\u533a\u7684\u5730\u5740 */\n    uint32_t roms[MAX_ROMS]; ///&lt; Flash addresses of each ROM\n#ifdef BOOT_CONFIG_CHKSUM\n    /* \u672c\u7ed3\u6784\u4f53\u7684\u6821\u9a8c\u503c */\n    uint8_t chksum;          ///&lt; Checksum of this configuration structure (if BOOT_CONFIG_CHKSUM defined)\n#endif\n} rboot_config;\n</code></pre> <p>\u5176\u5b9e\u81ea\u8eab\u7684\u6ce8\u91ca\u5c31\u5f88\u8be6\u7ec6\u4e86\u3002</p> <p>\u901a\u5e38\u505aBootloader\u7684\u8bdd\uff0c\u90fd\u4f1a\u7ef4\u62a4\u81ea\u5df1\u7684\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u8fd9\u4e2a\u7ed3\u6784\u4f53\u4e2d\u653e\u7740boot\u914d\u7f6e\u548c\u4fe1\u606f\uff0c\u5e76\u4e14\u5b58\u653e\u5728flash\u4e2d\uff08\u6389\u7535\u4fdd\u5b58\uff09\u3002\u8fd9\u6837\u505a\u6709\u51e0\u4e2a\u76ee\u7684\uff1a</p> <ol> <li>\u77e5\u9053\u4f7f\u7528\u54ea\u4e2aROM\u533a\u8fdb\u884c\u542f\u52a8</li> <li>\u53ef\u4ee5\u914d\u7f6eROM\u533a\u5730\u5740\uff08\u66f4\u7075\u6d3b\uff09</li> <li>\u4fdd\u5b58\u7248\u672c\u4fe1\u606f\uff0c\u4f7f\u66f4\u6613\u517c\u5bb9</li> <li>\u53ef\u4ee5\u77e5\u9053\u5f53\u524d\u6570\u636e\u662f\u5426\u6b63\u786e\uff0c\u6709\u65e0\u635f\u574f</li> </ol>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-Bootloader-rtfsc-rboot-2/#_3","title":"\u68c0\u67e5\u56fa\u4ef6","text":"<p>\u5982\u679c\u628auint32_t find_image(void)\u51fd\u6570\u7b80\u5316\uff0c\u662f\u8fd9\u6837\u7684\uff1a <pre><code>uint32_t NOINLINE find_image(void) {\n\n    uint8_t flag;\n    uint32_t loadAddr;\n    uint32_t flashsize;\n    int32_t romToBoot;\n    uint8_t updateConfig = 0;\n    uint8_t buffer[SECTOR_SIZE];\n\n    rboot_config *romconf = (rboot_config*)buffer;\n    rom_header *header = (rom_header*)buffer;\n\n    ets_printf(\"\\r\\nrBoot v1.4.2 - richardaburton@gmail.com\\r\\n\");\n\n    // read boot config\n    SPIRead(BOOT_CONFIG_SECTOR * SECTOR_SIZE, buffer, SECTOR_SIZE);\n    // fresh install or old version?\n    if (romconf-&gt;magic != BOOT_CONFIG_MAGIC || romconf-&gt;version != BOOT_CONFIG_VERSION\n        ) {\n        // create a default config for a standard 2 rom setup\n        ets_printf(\"Writing default boot config.\\r\\n\");\n        // write new config sector\n    }\n\n    // try rom selected in the config, unless overriden by gpio/temp boot\n    romToBoot = romconf-&gt;current_rom;\n\n    // check valid rom number\n    // gpio/temp boots will have already validated this\n    if (romconf-&gt;current_rom &gt;= romconf-&gt;count) {\n        // if invalid rom selected try rom 0\n        ets_printf(\"Invalid rom selected, defaulting to 0.\\r\\n\");\n    }\n\n    // check rom is valid\n    loadAddr = check_image(romconf-&gt;roms[romToBoot]);\n\n    // check we have a good rom\n    while (loadAddr == 0) {\n        ets_printf(\"Rom %d at %x is bad.\\r\\n\", romToBoot, romconf-&gt;roms[romToBoot]);\n        // for normal mode try each previous rom\n        // until we find a good one or run out\n        updateConfig = 1;\n        romToBoot--;\n        if (romToBoot &lt; 0) romToBoot = romconf-&gt;count - 1;\n        if (romToBoot == romconf-&gt;current_rom) {\n            // tried them all and all are bad!\n            ets_printf(\"No good rom available.\\r\\n\");\n            return 0;\n        }\n        loadAddr = check_image(romconf-&gt;roms[romToBoot]);\n    }\n\n    // re-write config, if required\n    if (updateConfig) {\n        romconf-&gt;current_rom = romToBoot;\n\n        SPIEraseSector(BOOT_CONFIG_SECTOR);\n        SPIWrite(BOOT_CONFIG_SECTOR * SECTOR_SIZE, buffer, SECTOR_SIZE);\n    }\n\n    ets_printf(\"Booting rom %d at %x, load addr %x.\\r\\n\", romToBoot, romconf-&gt;roms[romToBoot], loadAddr);\n    // copy the loader to top of iram\n    ets_memcpy((void*)_text_addr, _text_data, _text_len);\n    // return address to load from\n    return loadAddr;\n\n}\n</code></pre></p> <p>\u5f88\u5927\u4e00\u90e8\u5206\u5728\u505a\u6709\u6548\u6027\u5224\u65ad\uff0c\u7b80\u5316\u6d41\u7a0b\u5982\u4e0b\uff1a <pre><code>if(romconf-&gt;magic != BOOT_CONFIG_MAGIC) {\n    return;\n}\nif(romconf-&gt;version != BOOT_CONFIG_VERSION) {\n    return;\n}\nif(romconf-&gt;current_rom &gt;= romconf-&gt;count) {\n    return;\n}\n\nfor(int i=0; i&lt;romconf-&gt;count; i++) {\n    loadAddr = check_image(romconf-&gt;roms[i]);\n    if(loadAddr != 0) {\n        break;\n    }\n}\nif(loadAddr == 0) {\n    return;\n}\n\nloader(loadAddr);\n</code></pre></p> <p>\u5176\u4e2dcheck_image\u4e3b\u8981\u662f\u68c0\u6d4b\u4e86ESP8266\u56fa\u4ef6\u672c\u8eab\u7684\u6709\u6548\u6027\u3002</p> <p>ESP8266\u751f\u6210\u7684bin\u6587\u4ef6\u4e2d\uff0c\u5176\u5b9e\u662f\u5305\u542b\u4e86\u4e00\u4e9b\u5916\u90e8\u4fe1\u606f\u7684\uff0c\u5982flash\u6a21\u5f0f\uff0cflash\u901f\u5ea6\u7b49\uff0c\u8fd8\u7528\u4f7f\u7528boot\u7684\u7248\u672c\uff0c\u8fd8\u6709\u6700\u4e3b\u8981\u7684\u662f\u751f\u6210\u6587\u4ef6\u7684\u5404\u6bb5\u7684\u4fe1\u606f\u3002ESP8266\u6709\u4e00\u4e9b\u5386\u53f2\u7248\u672c\u7684boot\uff0c\u6240\u4ee5\u683c\u5f0f\u4e5f\u7a0d\u6709\u533a\u522b\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-Bootloader-rtfsc-rboot-2/#_4","title":"\u52a0\u8f7d\u56fa\u4ef6","text":"<p>rboot-stage2a.c\u4e2d\uff1a <pre><code>usercode* NOINLINE load_rom(uint32_t readpos) {\n\n    uint8_t sectcount;\n    uint8_t *writepos;\n    uint32_t remaining;\n    usercode* usercode;\n\n    rom_header header;\n    section_header section;\n\n    // read rom header\n    SPIRead(readpos, &amp;header, sizeof(rom_header));\n    readpos += sizeof(rom_header);\n\n    // create function pointer for entry point\n    usercode = header.entry;\n\n    // copy all the sections\n    for (sectcount = header.count; sectcount &gt; 0; sectcount--) {\n\n        // read section header\n        SPIRead(readpos, &amp;section, sizeof(section_header));\n        readpos += sizeof(section_header);\n\n        // get section address and length\n        writepos = section.address;\n        remaining = section.length;\n\n        while (remaining &gt; 0) {\n            // work out how much to read, up to 16 bytes at a time\n            uint32_t readlen = (remaining &lt; READ_SIZE) ? remaining : READ_SIZE;\n            // read the block\n            SPIRead(readpos, writepos, readlen);\n            readpos += readlen;\n            // increment next write position\n            writepos += readlen;\n            // decrement remaining count\n            remaining -= readlen;\n        }\n    }\n\n    return usercode;\n}\n</code></pre></p> <p>\u524d\u9762\u8bf4\u5230\uff0cESP8266\u751f\u6210\u7684bin\u6587\u4ef6\u4e2d\u5305\u542b\u4e86\u5404\u6bb5\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u6bb5\u5730\u5740\u3001\u5927\u5c0f\u548c\u5185\u5bb9\u3002load_rom\u4fbf\u662f\u904d\u5386bin\u6587\u4ef6\u4e2d\u6240\u6709\u7684\u6bb5\uff0c\u4eceflash\u4e2d\u8bfb\u53d6\uff0c\u5e76\u52a0\u8f7d\u5230\u5bf9\u5e94\u5730\u5740\u4e2d\u3002\u800c\u5982\u679c\u6ca1\u6709Bootloader\u7684\u8bdd\uff0c\u8fd9\u4e2a\u5de5\u4f5c\u662f\u5728ROM\u4ee3\u7801\u4e2d\u6267\u884c\u7684\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-Bootloader-rtfsc-rboot-2/#end","title":"End","text":"<p>\u5230\u8fd9\u91cc\uff0crboot\u7684\u52a0\u8f7d\u56fa\u4ef6\u6d41\u7a0b\u5c31\u8bb2\u5b8c\u4e86\u3002</p> <p>rboot\u8fd8\u6709\u4e0d\u5c11\u7279\u6027\uff0c\u5982GPIO\u9009\u62e9ROM\uff0c\u52a0\u8f7d\u591a\u4e2aROM\u7b49\uff0c\u8fd9\u4e9b\u529f\u80fd\u4e0d\u592a\u5e38\u7528\uff0c\u8fd9\u91cc\u5c31\u4e0d\u6253\u7b97\u8bf4\u4e86\u3002\u6709\u9700\u8981\u7684\u53ef\u4ee5\u5728\u8bc4\u8bba\u533a\u7559\u8a00\uff0c\u6211\u4e5f\u4f1a\u89c6\u60c5\u51b5\u7ee7\u7eed\u5199\u4e0b\u53bb\u7684\u3002</p> <p>\u90a3\u4e48\u4e0b\u4e00\u7bc7\uff0c\u5c31\u662f\u5199zboot\u5566\uff0c\u4f5c\u8005\u8bf4\u662f\u57fa\u4e8erboot\u4e0a\u505a\u4e86\u6539\u8fdb\uff0c\u6709\u4e86rboot\u7684\u57fa\u7840\u540e\uff0c\u89e3\u8bfb\u8d77\u6765\u5e94\u8be5\u4e0d\u4f1a\u592a\u96be\uff0c\u5927\u5bb6\u4e00\u8d77\u52a0\u6cb9\u554a\u3002</p> <p>\u672c\u6587\u4e5f\u53d1\u5e03\u5728</p> <p>segmentfault</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-struc-start/","title":"ESP8266\u67b6\u6784\u63a2\u7d22-\u8fd0\u884c\u7684\u8d77\u59cb","text":"\u66f4\u65b0\u65e5\u671f: 2022-08-10 <ul> <li>2022-08-10 \u66f4\u65b0</li> </ul> <p>Cyber &amp; Robot \u6388\u6743\u53d1\u5e03</p> <p>\u90fd2020\u5e74\u4e86\uff0c\u60f3\u5fc5\u5927\u5bb6\u5bf9ESP8266\u90fd\u5f88\u719f\u4e86\uff0c\u6ca1\u7528\u8fc7\u81f3\u5c11\u4e5f\u542c\u8bf4\u8fc7\u3002\u6240\u4ee5\u629b\u5f00\u4e30\u5bcc\u6709\u8da3\u7684\u5404\u79cd\u5e94\u7528\uff0c\u4e0b\u9762\u6765\u8bf4\u4e00\u8bf4\u5f88\u5c11\u4eba\u8ba8\u8bba\u7684ESP8266\u7684\u67b6\u6784\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-struc-start/#_1","title":"\u67b6\u6784","text":"<p>ESP8266\u96c6\u6210\uf9ba\u589e\u5f3a\u7248\u7684\u8d85\u4f4e\u529f\u8017Tensilica\u2019s Xtensa L106 32-bit\u5185\u6838\u5904\u7406\ufa38\u3002\u4e3a\u4ec0\u4e48\u8bf4\u589e\u5f3a\u7248\u5462\uff0c\u56e0\u4e3aTensilica\u5904\u7406\u5668\u7684\u7279\u70b9\uff0c\u5c31\u662f\u5de5\u7a0b\u5e08\u53ef\u4ee5\u5bf9\u5185\u6838IP\u505a\u5b9a\u5236\u5316\uff0c\u4e50\u946b\u8d2d\u4e70IP\u540e\uff0c\u7ee7\u7eed\u8fdb\u884c\u4f18\u5316\uff0c\u5f62\u6210\u4e86\u589e\u5f3a\u7248\u3002</p> <p>\u8be5\u5904\u7406\u5668\u4f7f\u7528RISC\u6307\u4ee4\u96c6\uff0cCPU\u65f6\u949f\u901f\u5ea6\u6700\u2fbc\u53ef\u8fbe160MHz\uff0c\u82af\u2f5a\u5185\u7f6e\u4e86\u5b58\u50a8\u63a7\u5236\ufa38\uff0c\u5305\u542bROM\u548cSRAM\u3002\u4f46\u8fd9\u4e2aROM\u5462\uff0c\u56fa\u5316\u4e00\u4e9b\u5e95\u5c42\u4ee3\u7801\uff0c\u7528\u6237\u662f\u4fee\u6539\u4e0d\u4e86\u7684\uff0c\u7528\u6237\u7a0b\u5e8f\u5fc5\u987b\u7531\u5916\u90e8Flash\u5b58\u50a8\uff0c\uf9e4\u8bba\u4e0a\u6700\u5927\u53ef\u652f\u630116MB\u7684\u5b58\u50a8\u3002</p> <p>\u6240\u4ee5\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u4e70ESP8266\u6a21\u5757\u65f6\uff0c\u90fd\u8981\u770b\u7528\u7684\u591a\u5927\u7684Flash\uff0c\u4f7f\u7528SDK\u5f00\u53d1\u65b9\u5f0f\u7684\u8bdd\uff0c\u4ece\u7f16\u8bd1\u5230\u4e0b\u8f7d\u90fd\u8981\u9009\u62e9\u6b63\u786e\u7684Flash\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-struc-start/#_2","title":"\u4ee3\u7801\u548c\u5185\u5b58\u7684\u5b58\u50a8\u5206\u914d","text":"<p>\u719f\u6089\u8ba1\u7b97\u673a\u539f\u7406\u7684\u90fd\u77e5\u9053\uff0c\u8ba1\u7b97\u673a\u7684\u672c\u8d28\u5c31\u662f\u8ba1\u7b97\uff0c\u901a\u8fc7\u6267\u884c\u4e0d\u540c\u7684\u6307\u4ee4\uff0c\u64cd\u4f5c\u4e0d\u540c\u7684\u6570\u636e\u6765\u5f97\u5230\u4e0d\u540c\u7684\u6570\u636e\u7ed3\u679c\u3002</p> <p>\u6307\u4ee4\u5728\u4ee3\u7801\u4e2d\u53ef\u4ee5\u8ba4\u4e3a\u662f\u4e0d\u540c\u7684\u8bed\u53e5\uff0c\u6570\u636e\u5c31\u662f\u4e0d\u540c\u7684\u53d8\u91cf\u3002\u5728\u5355\u7247\u673a\u4e2d\uff0c\u4e00\u822c\u6307\u4ee4\u5b58\u5728ROM\u4e2d\uff0c\u6570\u636e\u53d8\u91cf\u5b58\u5728RAM\u4e2d\u3002\u6709\u8fd9\u4e24\u4e2a\u6982\u5ff5\u540e\uff0c\u518d\u770b\u770bESP8266\u8fd9\u6b3e\u82af\u7247\u3002</p> <p>ESP8266\u7247\u4e0a\u6709\u56fa\u5316\u7684ROM\uff0c\u9700\u8981\u7528\u6237\u5916\u7f6eFlash\u6765\u5b58\u50a8\u7a0b\u5e8f\u3002\u5728\u7269\u7406\u4e0a\u6709 64KB \u7684 iRAM\uff0c96KB \u7684 dRAM\u3002</p> <p>\u5176\u4e2d\uff1a</p> <ul> <li>iRAM\uff1ainstruction RAM\uff0c\u7528\u6765\u5b58\u653e\u6307\u4ee4\uff0c\u4f4d\u4e8e 0x40100000 \u5f00\u59cb\u7684 64KB \u7a7a\u95f4\u3002</li> <li>dRAM\uff1adata RAM\uff0c\u7528\u6765\u5b58\u653e\u6570\u636e\uff0c\u4f4d\u4e8e 0x3FFE8000 \u5f00\u59cb\u7684\u7a7a\u95f4\u3002</li> </ul> <p>\u6240\u4ee5ESP8266\u4e00\u5171\u6709\u8fd9\u4e48\u51e0\u4e2a\u5b58\u50a8\u7684\u5730\u65b9\uff1a\u7247\u4e0aROM\u3001\u7247\u4e0aiRAM\u3001\u7247\u4e0adRAM\uff0c\u7247\u5916Flash\u3002</p> \u5b58\u50a8\u533a \u4f5c\u7528 \u7247\u4e0aROM \u56fa\u5316\u82af\u7247\u5e95\u5c42\u4ee3\u7801\uff0c\u7528\u6237\u65e0\u6cd5\u6539\u52a8 \u7247\u4e0aiRAM \u5b58\u653e\u6307\u4ee4\uff0c\u7528\u4e8e\u6267\u884c\u7a0b\u5e8f \u7247\u4e0adRAM \u5b58\u653e\u6570\u636e \u7247\u5916Flash \u5b58\u653e\u7528\u6237\u4ee3\u7801\u3001\u7528\u6237\u6570\u636e\u7b49 <p>\u77e5\u9053iRAM\u540e\uff0c\u5c31\u77e5\u9053\u6211\u4eecFlash\u7684\u5730\u4f4d\u5e76\u4e0d\u600e\u6837\u3002\u4ee3\u7801\u5e76\u4e0d\u662f\u76f4\u63a5\u5728Flash\u4e0a\u53d6\u6307\u4ee4\u8fd0\u884c\u7684\uff0c\u800c\u662f\u52a0\u8f7d\u5230iRAM\u4e2d\u6765\u8fd0\u884c\u7684\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-struc-start/#_3","title":"\u4ee3\u7801\u5f00\u59cb\u7684\u5730\u65b9","text":"<p>ESP8266\u4e2d\u6240\u6709\u4ee3\u7801\u90fd\u662f\u52a0\u8f7d\u5230iRAM\u540e\u8fd0\u884c\u7684\uff0c\u53ea\u662f\u6709\u7684\u63d0\u524d\u52a0\u8f7d\uff08IRAM\u6bb5\uff09\uff0c\u6709\u7684\u7528\u65f6\u52a0\u8f7d\uff08IROM\u6bb5\uff09\u3002IROM\u6bb5\u4f7f\u7528\u90e8\u5206\u79f0\u4e3aCache\uff0cIRAM\u6bb5\u4e3a\u771fiRAM\u3002</p> <p>ESP8266\u6709\u4e2a\u7279\u6b8a\u7684Cache\u6982\u5ff5\u3002\u5728\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e2d\uff0cCache\u662f\u4e3a\u4e86\u89e3\u51b3CPU\u8bfb\u5185\u5b58\u901f\u5ea6\u8fc7\u6162\u800c\u8bbe\u7f6e\u7684\u3002</p> <p>Cache\u6bd4\u5185\u5b58\u7684\u8bfb\u53d6\u901f\u5ea6\u66f4\u5feb\uff0c\u4f46\u6bd4\u5bc4\u5b58\u5668\u8bfb\u53d6\u901f\u5ea6\u6162\u3002\u901a\u5e38Cache\u53ea\u662f\u5c0f\u7a7a\u95f4\u5b58\u50a8\uff0c\u7528\u6765\u7f13\u5b58CPU\u8bfb\u53d6\u8fc7\u7684\u5185\u5b58\u6570\u636e\u3002</p> <p>ESP8266\u4e2d\u7684Cache\u4f7f\u7528\u4e86iRAM\uff0ciRAM\u5171\u670964k\uff0c\u5206\u4e86\u4e00\u534a\uff0832k\uff09\u7ed9Cache\u3002ESP8266\u7684\u5e95\u5c42\u542f\u52a8\u540e\uff0c\u4f1a\u5c06\u5bf9\u5e94Flash\u7684\u7a7a\u95f4\u6620\u5c04\u5230Cache\u7a7a\u95f4\u3002</p> <p>\u7528\u6237\u4ee3\u7801\u662f\u5b58\u5728\u5916\u7f6eFlash\u7684\uff0c\u90a3\u4e48\u82af\u7247\u542f\u52a8\u540e\uff0cIRAM\u6bb5\u52a0\u8f7d\u5230iRAM\u4e2d\uff0c\u5e95\u5c42\u4ee3\u7801\uff08\u524d\u9762\u8bf4\u7684\u56fa\u5316ROM\u5185\uff09\u4e5f\u4f1a\u5c06Flash\u7a7a\u95f4\u6620\u5c04\u5230Cache\u4e2d\u3002</p> <p>\u56e0\u4e3aCache\u7684\u7a7a\u95f4\u8fdc\u5c0f\u4e8eFlash\uff0c\u6240\u4ee5\u4f7f\u7528\u4e86\u7279\u6b8a\u7684\u6620\u5c04\u6280\u672f\u53ef\u4ee5\u5c06\u6700\u59271M+1M\u7684Flash\u6620\u5c04\u523032K\u7684cache\u4e2d\u3002\u800c\u54ea\u4e9b\u4ee3\u7801\u9700\u8981\u52a0\u8f7d\u5230iRAM\uff0c\u54ea\u4e9b\u8fd8\u662f\u653e\u5728Cache\u4e2d\u8fd0\u884c\uff0c\u5219\u662f\u5728\u94fe\u63a5\u65f6\uff0c\u901a\u8fc7\u6307\u5b9a\u4e0d\u540c\u7684\u6bb5\u6765\u533a\u5206\u3002</p> <p>\u5199\u8fc7\u4ee3\u7801\u7684\u670b\u53cb\u5c31\u77e5\u9053\u4e86\uff0c\u5728NONOS SDK\u4e2d\uff0c\u9700\u8981ICACHE_FLASH_ATTR\u6765\u5b9a\u4e49\u51fd\u6570\uff0c\u4ee5\u4f7f\u4ee3\u7801\u4e0d\u5360\u7528iRAM\u7a7a\u95f4\u3002\u5728RTOS SDK\u4e2d\uff0c\u4f7f\u7528IRAM_ATTR\u5b9a\u4e49\u51fd\u6570\uff0c\u5c06\u9700\u8981\u9891\u7e41\u8fd0\u884c\uff0c\u8bb2\u7a76\u6548\u7387\u7684\u51fd\u6570\u653e\u5230iRAM\u4e2d\u3002\u8fd9\u4e2a\u4fbf\u662fiRAM\u548ciROM\u7684\u533a\u522b\u5f15\u8d77\u7684\u3002</p> <p>\u597d\u4e86\uff0c\u5230\u4e86\u8fd9\u91cc\uff0c\u6211\u4eec\u5c31\u77e5\u9053\u4ee3\u7801\u7f16\u8bd1\u751f\u6210\u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u70e7\u5f55\u5230Flash\u540e\uff0c\u662f\u600e\u4e48\u7531ESP8266\u6267\u884c\u8d77\u6765\u7684\u4e86\u3002\u522b\u8d70\u5f00\uff0c\u4e0b\u9762\u6709\u5f69\u86cb\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-struc-start/#rom","title":"ROM\u7684\u5e95\u5c42","text":"<p>ROM\u7684\u5e95\u5c42\u662f\u770b\u4e0d\u89c1\u7684\uff0c\u4f46\u662f\u65e2\u7136\u6211\u4eec\u80fd\u7528\u5230\uff0c\u90a3\u5c31\u6709\u5b83\u7684\u75d5\u8ff9</p> <p>https://github.com/espressif/ESP8266_NONOS_SDK/blob/master/ld/eagle.rom.addr.v6.ld</p> <p><pre><code>PROVIDE ( ets_memcmp = 0x400018d4 );\nPROVIDE ( ets_memcpy = 0x400018b4 );\nPROVIDE ( ets_memmove = 0x400018c4 );\nPROVIDE ( ets_memset = 0x400018a4 );\nPROVIDE ( ets_post = 0x40000e24 );\nPROVIDE ( ets_printf = 0x400024cc );\nPROVIDE ( ets_putc = 0x40002be8 );\nPROVIDE ( ets_rtc_int_register = 0x40002a40 );\n</code></pre> \u8fd9\u4efdld\u6587\u4ef6\u91cc\uff0c\u5c31\u63cf\u8ff0\u4e86\u5e95\u5c42\u51fd\u6570\u5728ROM\u4e2d\u7684\u5730\u5740\uff0c\u4e5f\u544a\u8bc9\u6211\u4eec\uff0c\u5230\u5e95\u63d0\u4f9b\u4e86\u591a\u5c11\u529f\u80fd\u3002</p> <p>\u4f46NONOS SDK\u5b98\u65b9\u4e5f\u5df2\u7ecf\u505c\u6b62\u66f4\u65b0\u4e86\uff0c\u5728RTOS SDK\u4e2d\uff0c\u5e95\u5c42\u51fd\u6570\u4f5c\u7528\u4e5f\u9010\u6e10\u5728\u6de1\u5316\uff0c\u50cf\u64cd\u4f5c\u5916\u8bbe\u7684\u90fd\u6539\u6210\u4e86\u5728\u7528\u6237\u4ee3\u7801\u91cc\u7f16\u5199\u7684\u5f62\u5f0f\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-struc-start/#nonos-sdkirom","title":"NONOS SDK\u9ed8\u8ba4\u94fe\u63a5\u5230iROM\u4e2d","text":"<p>\u4e0d\u77e5\u9053\u73b0\u5728\u8fd8\u6709\u591a\u5c11\u4eba\u5728\u4f7f\u7528NONOS SDK\u505a\u5f00\u53d1\uff0c\u65e2\u7136\u8fd9\u7bc7\u6587\u7ae0\u8bf4\u5230\u4e86\u4ee3\u7801\u5b58\u653e\uff0c\u90a3\u5c31\u8bf4\u4e00\u4e0b\u5427\u3002</p> <p>\u5728NONOS SDK\u4e2d\uff0c\u7528\u6237\u4ee3\u7801\u7f16\u8bd1\u94fe\u63a5\u540e\uff0c\u4f1a\u9ed8\u8ba4\u653e\u5230iRAM\u4e2d\uff0c\u6240\u4ee5\u9700\u8981\u7528\u6237\u624b\u52a8\u589e\u52a0ICACHE_FLASH_ATTR\u6765\u4fee\u9970\u3002\u4f46\u95ee\u9898\u662fiRAM\u7a7a\u95f4\u53ea\u670932k\uff0c\u662f\u975e\u5e38\u6709\u9650\u7684\u3002</p> <p>\u5982\u679c\u90fd\u662f\u81ea\u5df1\u4ece0\u5f00\u59cb\u5199\u7684\u4ee3\u7801\uff0c\u90a3\u4e5f\u6ca1\u4ec0\u4e48\u3002\u4f46\u662f\u5982\u679c\u662f\u8981\u5f15\u7528\u522b\u4eba\u7684\u5e93\uff0c\u6216\u8005\u662f\u81ea\u5df1\u5199\u7684\u4ee3\u7801\u8981\u5c01\u88c5\u6210\u5e93\u7ed9\u5176\u4ed6\u5730\u65b9\u4f7f\u7528\uff0c\u8fd9\u65f6\u5c31\u5f88\u9ebb\u70e6\u4e86\uff0c\u56e0\u4e3a\u5176\u4ed6\u5e73\u53f0\u90fd\u4e0d\u7528\u8fd9\u6837\u5b9a\u4e49\u3002\u90a3\u4e48\u6709\u6ca1\u6709\u89e3\u51b3\u529e\u6cd5\u5462\uff0c\u6709\u3002</p> <p>\u5728SDK\u4e2d\u627e\u5230./ld/eagle.app.v6.ld\u6587\u4ef6\u3002</p> <p>\u5728<code>.irom0.text : ALIGN(4)</code>\u6bb5\u4e0b\u505a\u5982\u4e0b\u4fee\u6539\u5373\u53ef\u3002 <pre><code>  .irom0.text : ALIGN(4)\n  {\n    _irom0_text_start = ABSOLUTE(.);\n\n    *libuser.a:(.literal.* .text.*)   /* \u589e\u52a0\u6b64\u884c */\n    *libat.a:(.literal.* .text.*)\n    *libcrypto.a:(.literal.* .text.*)\n\n    ... ...\n\n    _irom0_text_end = ABSOLUTE(.);\n  } &gt;irom0_0_seg :irom0_0_phdr\n</code></pre> \u7528\u6237\u4ee3\u7801\u7f16\u8bd1\u540e\uff0c\u4f1a\u751f\u6210libuser.a\u6587\u4ef6\uff0c\u6240\u4ee5\u8fd9\u4e2a\u6587\u4ef6\u91cc\u90fd\u662f\u7528\u6237\u4ee3\u7801\u3002\u65b0\u589e\u8bed\u53e5\u5c31\u662f\u5c06\u7528\u6237\u4ee3\u7801\u4e2d\u7c7b\u5e38\u91cf\u548c\u4ee3\u7801\u6307\u4ee4\u90fd\u653e\u5230iROM\u4e2d\u3002</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"embedded/wifi/ESP8266-struc-start/#end","title":"End","text":"<p>\u5173\u4e8eESP8266\u67b6\u6784\u548c\u4ee3\u7801\u5982\u4f55\u5f00\u59cb\u8fd0\u884c\u7684\u4e1c\u897f\u5c31\u5230\u8fd9\u91cc\u4e86\u3002</p> <p>\u5f69\u86cb\u4e4b\u540e\uff0c\u5f53\u7136\u662f\u4e0b\u96c6\u9884\u544a\u5566\u3002</p> <p>\u4e0b\u6b21\u53ef\u80fd\u4f1a\u6839\u636e\u5f00\u6e90\u7684 Bootloader\u4ee3\u7801\uff0c\u6765\u8ddf\u7740\u89e3\u6790\u4e00\u904d\u54e6\u3002</p> <p>\u9635\u5bb9\u5982\u4e0b\uff0c\u6709\u6ca1\u6709\u70b9\u671f\u5f85\u5462\uff1f</p> <ul> <li>rboot\uff1ahttps://github.com/raburton/rboot</li> <li>zboot\uff1ahttps://github.com/zorxx/zboot</li> <li>esp-bootloader:https://github.com/tuanpmt/esp-bootloader</li> </ul> <p>\u672c\u6587\u4e5f\u53d1\u5e03\u5728</p> <p>segmentfault</p>","tags":["\u5d4c\u5165\u5f0f"]},{"location":"fun/http-code/","title":"HTTP\u72b6\u6001\u7801","text":"<p>\u6765\u6e90\u7f51\u7edc\uff0c\u4fb5\u5220</p> <p>HTTP\u72b6\u6001\u7801\u88ab\u5206\u6210\u4e865\u5927\u7c7b\u3002\u672c\u6587\u5bf9\u6bcf\u4e00\u7c7b\u5e38\u89c1\u7684\u72b6\u6001\u7801\u8fdb\u884c\u603b\u7ed3\u3002</p> <p>\u5217\u51fa\u7684\u662f<code>HTTP/1.1</code>\u89c4\u8303\u63a8\u8350\u4f7f\u7528\u7684\u539f\u56e0\u77ed\u8bed\u3002</p>","tags":["http"]},{"location":"fun/http-code/#100199","title":"100~199 \u4fe1\u606f\u6027\u72b6\u6001\u7801","text":"\u72b6\u6001\u7801 \u539f\u56e0\u77ed\u8bed \u63cf\u8ff0 (\u56fe\u6587\u65e0\u5173) 100 Continue \u8bf4\u660e\u6536\u5230\u4e86\u8bf7\u6c42\u7684\u521d\u59cb\u90e8\u5206\uff0c\u8bf7\u5ba2\u6237\u7aef\u7ee7\u7eed\u3002 101 Switching Protocols \u8bf4\u660e\u670d\u52a1\u5668\u6b63\u5728\u6839\u636e\u5ba2\u6237\u7aef\u7684\u6307\u5b9a\uff0c\u5c06\u534f\u8bae\u5207\u6362\u6210Update\u9996\u90e8\u6240\u5217\u7684\u534f\u8bae *","tags":["http"]},{"location":"fun/http-code/#200299","title":"200~299 \u6210\u529f\u72b6\u6001\u7801","text":"\u72b6\u6001\u7801 \u539f\u56e0\u77ed\u8bed \u63cf\u8ff0 (\u56fe\u6587\u65e0\u5173) 200 OK OK 201 Created * 202 Accepted * 203 Non-Authoritative Information * 204 No Content * 205 Reset Content * 206 Partical Content *","tags":["http"]},{"location":"fun/http-code/#300399","title":"300~399 \u91cd\u5b9a\u5411\u72b6\u6001\u7801","text":"\u72b6\u6001\u7801 \u539f\u56e0\u77ed\u8bed \u63cf\u8ff0 (\u56fe\u6587\u65e0\u5173) 300 Multiple Choices \u5ba2\u6237\u7aef\u8bf7\u6c42\u4e00\u4e2a\u5b9e\u9645\u6307\u5411\u591a\u4e2a\u8d44\u6e90\u7684URL\u65f6\u4f1a\u8fd4\u56de\u8fd9\u4e2a\u72b6\u6001\u7801\uff0c\u6bd4\u5982\u670d\u52a1\u5668\u4e0a\u6709\u67d0\u4e2aHTML\u6587\u6863\u7684\u82f1\u8bed\u548c\u6cd5\u8bed\u7248\u672c\u3002\u670d\u52a1\u5668\u53ef\u4ee5\u5728location\u9996\u90e8\u5305\u542b\u9996\u9009URL\u3002 301 Moved Permanently \u5728\u8bf7\u6c42\u7684URL\u5df2\u88ab\u79fb\u9664\u65f6\u4f7f\u7528\u3002\u54cd\u5e94\u7684Location\u9996\u90e8\u4e2d\u5e94\u8be5\u5305\u542b\u8d44\u6e90\u73b0\u5728\u6240\u5904\u7684URL\u3002 302 Found \u4e0e301\u7c7b\u4f3c\uff0c\u4f46\u5ba2\u6237\u7aef\u5e94\u8be5\u4f7f\u7528Location\u9996\u90e8\u7ed9\u51fa\u7684URL\u6765\u4e34\u65f6\u5b9a\u4f4d\u8d44\u6e90\u3002 304 Not Modified \u6709\u6761\u4ef6\u7684\u9996\u90e8\u3002\u5982\u679c\u5ba2\u6237\u7aef\u53d1\u8d77\u4e86\u4e00\u4e2a\u6761\u4ef6GET\u8bf7\u6c42\uff0c\u800c\u6700\u8fd1\u8d44\u6e90\u672a\u88ab\u4fee\u6539\uff0c\u5c31\u53ef\u4ee5\u7528\u8fd9\u4e2a\u72b6\u6001\u7801\u6765\u8bf4\u6ca1\u8d44\u6e90\u672a\u88ab\u4fee\u6539\u3002\u5e26\u6709\u8fd9\u4e2a\u72b6\u6001\u7801\u7684\u54cd\u5e94\u4e0d\u5e94\u8be5\u5305\u542b\u5b9e\u4f53\u7684\u4e3b\u4f53\u90e8\u5206\u3002 *","tags":["http"]},{"location":"fun/http-code/#400499","title":"400~499 \u5ba2\u6237\u7aef\u9519\u8bef\u72b6\u6001\u7801","text":"\u72b6\u6001\u7801 \u539f\u56e0\u77ed\u8bed \u63cf\u8ff0 (\u56fe\u6587\u65e0\u5173) 400 Bad Request \u544a\u77e5\u5ba2\u6237\u7aef\u53d1\u9001\u4e86\u4e00\u4e2a\u9519\u8bef\u7684\u8bf7\u6c42\u3002 401 Unauthorized \u672a\u8ba4\u8bc1\u3002 403 Forbidden \u8bf7\u6c42\u88ab\u670d\u52a1\u5668\u62d2\u7edd\u3002 404 Not Found \u670d\u52a1\u5668\u65e0\u6cd5\u627e\u5230\u6240\u8bf7\u6c42\u7684URL\u3002 405 Method Not Allowed \u53d1\u8d77\u7684\u8bf7\u6c42\u4e2d\u5e26\u6709\u6240\u8bf7\u6c42\u7684URL\u4e0d\u652f\u6301\u7684\u65b9\u6cd5\u65f6\uff0c\u4f7f\u7528\u6b64\u72b6\u6001\u7801\u3002\u5e94\u8be5\u5728\u54cd\u5e94\u4e2d\u5305\u542bAllow\u9996\u90e8\uff0c\u4ee5\u544a\u77e5\u5ba2\u6237\u7aef\u5bf9\u6240\u8bf7\u6c42\u7684\u8d44\u6e90\u53ef\u4ee5\u4f7f\u7528\u54ea\u4e9b\u65b9\u6cd5\u3002 406 Not Acceptable \u670d\u52a1\u5668\u6ca1\u6709\u4e0e\u5ba2\u6237\u7aef\u53ef\u63a5\u53d7\u7684URL\u76f8\u5339\u914d\u7684\u8d44\u6e90\u65f6\uff0c\u4f7f\u7528\u6b64\u4ee3\u7801\u3002 408 Request Timeout \u5982\u679c\u5ba2\u6237\u7aef\u5b8c\u6210\u8bf7\u6c42\u6240\u82b1\u7684\u65f6\u95f4\u592a\u957f\uff0c\u670d\u52a1\u5668\u53ef\u4ee5\u56de\u9001\u6b64\u72b6\u6001\u7801\uff0c\u5e76\u5173\u95ed\u8fde\u63a5\u3002 410 Gone \u4e0e404\u7c7b\u4f3c\uff0c\u53ea\u662f\u670d\u52a1\u5668\u66fe\u7ecf\u6709\u8fc7\u6b64\u8d44\u6e90\u3002 411 Length Required \u670d\u52a1\u5668\u8981\u6c42Content-Length\u9996\u90e8\u3002 412 Precondition Failed \u5ba2\u6237\u7aef\u53d1\u8d77\u4e86\u6761\u4ef6\u8bf7\u6c42\uff0c\u4e14\u5176\u4e2d\u4e00\u4e2a\u6761\u4ef6\u5931\u8d25\u4e86\u3002 415 Unsupported Media Type \u670d\u52a1\u5668\u65e0\u6cd5\u7406\u89e3\u6216\u65e0\u6cd5\u652f\u6301\u5ba2\u6237\u7aef\u6240\u53d1\u5b9e\u4f53\u7684\u5185\u5bb9\u7c7b\u578b\u3002 416 Requested Range Not Satisfiable \u8bf7\u6c42\u62a5\u6587\u6240\u8bf7\u6c42\u7684\u662f\u6307\u5b9a\u8d44\u6e90\u7684\u67d0\u4e2a\u8303\u56f4\uff0c\u800c\u6b64\u8303\u56f4\u65e0\u6548\u6216\u65e0\u6cd5\u6ee1\u8db3\u3002 418 I'm a teapot","tags":["http"]},{"location":"fun/http-code/#500599","title":"500~599 \u670d\u52a1\u5668\u9519\u8bef\u72b6\u6001\u7801","text":"\u72b6\u6001\u7801 \u539f\u56e0\u77ed\u8bed \u63cf\u8ff0 (\u56fe\u6587\u65e0\u5173) 500 Internal Server Error \u670d\u52a1\u5668\u9047\u5230\u4e00\u4e2a\u59a8\u788d\u5b83\u4e3a\u8bf7\u6c42\u63d0\u4f9b\u670d\u52a1\u7684\u9519\u8bef 501 Not Implement \u5ba2\u6237\u7aef\u53d1\u8d77\u7684\u8bf7\u6c42\u8d85\u8fc7\u670d\u52a1\u5668\u80fd\u529b\u8303\u56f4 503 Service Unavailable \u670d\u52a1\u5668\u73b0\u5728\u65e0\u6cd5\u4e3a\u8bf7\u6c42\u63d0\u4f9b\u670d\u52a1\uff0c\u4f46\u5c06\u6765\u53ef\u4ee5 504 Gateway Timeout \u4e0e408\u7c7b\u4f3c\uff0c\u53ea\u662f\u8fd9\u91cc\u7684\u54cd\u5e94\u6765\u81ea\u4e00\u4e2a\u7f51\u5173\u6216\u4ee3\u7406 505 HTTP Version Not Supported \u670d\u52a1\u5668\u6536\u5230\u7684\u8bf7\u6c42\u4f7f\u7528\u4e86\u5b83\u65e0\u6cd5\u6216\u4e0d\u613f\u652f\u6301\u7684\u534f\u8bae\u7248\u672c *","tags":["http"]},{"location":"fun/joke-1/","title":"\u7f16\u7a0b\u7b11\u8bdd","text":"<p>\u6765\u6e90\u7f51\u7edc\uff0c\u4fb5\u5220</p> <p>\u4e00\u4e2aSEO\u5de5\u7a0b\u5e08\u8d70\u8fdb\u4e86\u4e00\u5bb6\u9152\u5427\u3001\u9152\u9986\u3001\u9152\u94fa\u3001\u9152\u8086\u3001\u5c0f\u9152\u5427\u3001\u5c0f\u9152\u9986\u3001\u9152\u5e97\u3001\u9910\u9986\u3001\u9910\u5385\u3001\u5564\u9152\u3001\u7ea2\u9152\u3001\u9e21\u5c3e\u9152\u3001\u767d\u9152\u3001\u4e8c\u9505\u5934\u3001\u4f0f\u7279\u52a0\u3001\u5a01\u58eb\u5fcc\u3002</p> <p>\u4e00\u4e2aTCP\u6570\u636e\u5305\u8d70\u8fdb\u4e86\u4e00\u5bb6\u9152\u5427\uff0c\u8bf4\uff1a\u201c\u6211\u8981\u4e00\u676f\u5564\u9152\u201d\u3002 \u9152\u4fdd\u95ee\uff1a\u201c\u4f60\u786e\u8ba4\u8981\u4e00\u676f\u5564\u9152\u5417\uff1f\u201d TCP\u6570\u636e\u5305\u8bf4\uff1a\u201c\u6211\u786e\u5b9a\u8981\u4e00\u676f\u5564\u9152\u201d\u3002</p> <p>\u4e00\u4e2aUDP\u6570\u636e\u5305\u8d70\u8fdb\u4e86\u4e00\u5bb6\u9152\u5427\u3002 \u4e00\u4e2aUDP\u6570\u636e\u5305\u8d70\u8fdb\u4e86\u4e00\u5bb6\u9152\u5427\u3002 \u4e00\u4e2aUDP</p> <p>\u4e00\u4e2aBitTorrent\u6570\u636e\u5305\u8d70\u8fdb\u4e86\u4e00\u5bb6\u9152\u5427\uff0c\u8868\u793a\u81ea\u5df1\u60f3\u8981\u5564\u9152\u3002 \u9152\u9986\u91cc\u6240\u6709\u6709\u5564\u9152\u7684\u4eba\u90fd\u7ed9\u4ed6\u5012\u4e86\u4e00\u70b9\u70b9\u3002</p> <p>\u4e24\u4e2a\u7a0b\u5e8f\u5458\u8d70\u8fdb\u4e86\u4e00\u5bb6\u9152\u5427\uff0c\u4e00\u4e2a\u7a0b\u5e8f\u5458\u8bf4\uff1a\u201c\u6211\u8981\u4e00\u676f\u5564\u9152\uff0c\u5564\u9152\u4e0a\u9762\u52a0\u4e2a\u96ea\u9876\uff08float\uff09\u201d\u3002 \u53e6\u4e00\u4e2a\u7a0b\u5e8f\u5458\u8bf4\uff1a\u201c\u4f60\u8fd8\u662f\u6362\u6210double\u6bd4\u8f83\u597d\u3002\u201d</p> <p>\u6709\u4eba\u9a82\u4e86\u67d0\u4e2ac++\u7a0b\u5e8f\u5458\uff1a\u201cgo to hell!\u201d \u3002 \u7a0b\u5e8f\u5458\u975e\u5e38\u7684\u96be\u8fc7\uff0c\u4ed6\u611f\u89c9\u8fd9\u53e5\u8bdd\u5b9e\u5728\u662f\u592a\u96be\u542c\u4e86\uff0c\u5c24\u5176\u662f\u90a3\u4e2a\u201cgo to\u201d\u3002</p> <p>\u95ee\uff1aUDP\u7b11\u8bdd\u6700\u6709\u610f\u601d\u7684\u5730\u65b9\u5728\u54ea\u91cc\uff1f \u7b54\uff1a\u522b\u4eba\u542c\u4e0d\u61c2\u4e5f\u65e0\u6240\u8c13\u3002</p> <p></p> <p></p> <p>\u5f53\u4f60\u6478\u9c7c\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u9c7c\u4e5f\u5728\u6478\u4f60</p>","tags":["fun"]},{"location":"fun/joke-2/","title":"\u7a0b\u5e8f\u5458\u6bb5\u5b50","text":"\u6765\u6e90\uff1a\u77e5\u4e4e <p>\u4f5c\u8005\uff1a\u533f\u540d\u7528\u6237 \u94fe\u63a5\uff1ahttps://www.zhihu.com/question/267978646/answer/332517368</p> <p>\u5927\u5bb6\u559d\u7684\u662f\u5564\u9152\u3002\u8fd9\u65f6\u4f60\u5165\u5ea7\u4e86\u3002</p> <p>\u4f60\u7ed9\u81ea\u5df1\u5012\u4e86\u676f\u53ef\u4e50\uff0c\u8fd9\u53eb\u4f4e\u914d\u7f6e\u3002</p> <p>\u4f60\u7ed9\u81ea\u5df2\u5012\u4e86\u676f\u5564\u9152\uff0c\u8fd9\u53eb\u6807\u51c6\u914d\u7f6e\u3002</p> <p>\u4f60\u7ed9\u81ea\u5df1\u5012\u4e86\u676f\u8336\u6c34\uff0c\u8fd9\u8336\u7684\u989c\u8272\u8fd8\u8ddf\u5564\u9152\u4e00\u6837\uff0c\u8fd9\u53eb\u6728\u9a6c\u3002</p> <p>\u4f60\u7ed9\u81ea\u5df1\u5012\u4e86\u676f\u53ef\u4e50\uff0c\u8fd8\u6ef4\u4e86\u51e0\u6ef4\u918b\uff0c\u4e0d\u4ec5\u989c\u8272\u8ddf\u5564\u9152\u4e00\u6837\uff0c\u800c\u4e14\u4e0d\u5192\u70ed\u6c14\u8fd8\u6709\u6ce1\u6ce1\uff0c\u8fd9\u53eb\u8d85\u7ea7\u6728\u9a6c\u3002</p> <p>\u4f60\u7684\u540c\u4e8b\u7ed9\u4f60\u5012\u4e86\u676f\u767d\u9152\uff0c\u8fd9\u53eb\u63a8\u8350\u914d\u7f6e\u3002</p> <p>\u4eba\u5230\u9f50\u4e86\uff0c\u9152\u5e2d\u5f00\u59cb\u4e86\u3002</p> <p>\u4f60\u5148\u4e00\u4e2a\u4eba\u559d\u4e86\u4e00\u5c0f\u53e3\uff0c\u8fd9\u53eb\u5355\u5143\u6d4b\u8bd5\u3002</p> <p>\u4f60\u8ddf\u65c1\u8fb9\u7684\u4eba\u8bf4\u54e5\u4eec\u54b1\u4eec\u968f\u610f\uff0c\u8fd9\u53eb\u4ea4\u53c9\u6d4b\u8bd5\u3002</p> <p>\u4f46\u662f\u4ed6\u8bf4\u4e0d\u884c\uff0c\u8fd9\u676f\u8981\u5e72\u4e86\uff0c\u8fd9\u53eb\u538b\u529b\u6d4b\u8bd5\u3002</p> <p>\u4e8e\u662f\u4f60\u8bf4\u90a3\u5c31\u5927\u5bb6\u4e00\u8d77\u6765\u5427\uff0c\u8fd9\u53eb\u5185\u90e8\u6d4b\u8bd5\u3002</p> <p>\u8fd9\u4e2a\u65f6\u5019boss\u5411\u5168\u573a\u4e3e\u676f\u4e86\uff0c\u8fd9\u53eb\u516c\u5f00\u6d4b\u8bd5\u3002</p> <p>\u83dc\u8fc7\u4e09\u5de1\uff0c\u4f60\u5c31\u4e0d\u8ddf\u4ed6\u4eec\u5ba2\u6c14\u4e86\u3002</p> <p>\u4f60\u5411\u5bf9\u9762\u7684\u4eba\u656c\u9152\uff0c\u8fd9\u53ebp2p.</p> <p>\u4f60\u5411\u5bf9\u9762\u7684\u4eba\u656c\u9152\uff0c\u4ed6\u56de\u656c\u4f60\uff0c\u4f60\u53c8\u518d\u656c\u4ed6\u2026\u2026\uff0c\u8fd9\u53ebtcp.</p> <p>\u4f60\u5411\u4e00\u684c\u4eba\u6328\u4e2a\u656c\u9152\uff0c\u8fd9\u53eb\u4ee4\u724c\u73af\u3002</p> <p>\u4f60\u8bf4\u53ea\u8981\u662f\u5144\u5f1f\u5c31\u5e72\u4e86\u8fd9\u676f\uff0c\u8fd9\u53eb\u5e7f\u64ad\u3002</p> <p>\u53ef\u662f\u4f60\u7684\u4e0a\u53f8jj\u542c\u4e86\u4e0d\u9ad8\u5174\u4e86\uff0c\u53ea\u6709\u5144\u5f1f\u4e48\uff0c\u7f5a\u9152\u4e09\u676f\u3002\u8fd9\u53eb\u70b8\u5f39\u3002</p> <p>\u53ef\u662f\u4f60\u7684\u4e0b\u7ea7mm\u542c\u4e86\u4e0d\u9ad8\u5174\u4e86\uff0c\u6211\u559d\u4e00\u53e3\uff0c\u4f60\u559d\u4e00\u676f\uff0c\u8fd9\u53eb\u6076\u610f\u653b\u51fb\u3002</p> <p>\u6709\u4e00\u4e2a\u4eba\u8fc7\u6765\u5411\u8fd9\u684c\u656c\u9152\uff0c\u4f60\u8bf4\u4e0d\u884c\u4f60\u5148\u8fc7\u4e86\u6211\u8fd9\u5173\uff0c\u8fd9\u53eb\u9632\u706b\u5899\u3002</p> <p>\u4f60\u7684\u5c0f\u5f1f\u4eec\u8fc7\u6765\u656c\u4f60\u9152\uff0c\u8fd9\u53eb\u4e00\u5bf9\u591a\u3002</p> <p>\u4f60\u662fboss\uff0c\u6240\u6709\u4eba\u8fc7\u6765\u656c\u4f60\u9152\uff0c\u8fd9\u53eb\u670d\u52a1\u5668\u3002</p> <p>\u9152\u662f\u4e00\u6837\u7684\uff0c\u53ef\u662f\u559d\u9152\u7684\u4eba\u662f\u4e0d\u540c\u7684\u3002</p> <p>\u4f60\u8d8a\u559d\u8138\u8d8a\u7ea2\uff0c\u8fd9\u53eb\u9891\u7e41\u5206\u914d\u91ca\u653e\u8d44\u6e90\u3002</p> <p>\u4f60\u8d8a\u559d\u8138\u8d8a\u767d\uff0c\u8fd9\u53eb\u8d44\u6e90\u4e0d\u91ca\u653e\u3002</p> <p>\u4f60\u5df2\u7ecf\u9189\u4e86\uff0c\u5374\u8bf4\u6211\u8fd8\u80fd\u559d\uff0c\u53eb\u505a\u8d44\u6e90\u989d\u5ea6\u4e0d\u8db3\u3002</p> <p>\u4f60\u660e\u660e\u80fd\u559d\uff0c\u5374\u8bf4\u6211\u5df2\u7ecf\u9189\u4e86\uff0c\u53eb\u505a\u8d44\u6e90\u4fdd\u7559\u3002</p> <p>\u4f60\u559d\u4e00\u6bb5\u65f6\u95f4\u5c31\u4e0a\u5395\u6240\uff0c\u8fd9\u53ebcache\u3002</p> <p>\u9152\u8fc7\u4e09\u5de1\uff0c\u4f60\u4e5f\u8be5\u6d3b\u52a8\u6d3b\u52a8\u4e86\u3002</p> <p>\u4f60\u4e00\u684c\u4e00\u684c\u7684\u8d70\uff0c\u8fd9\u53eb\u8f6e\u5de1\u3002</p> <p>\u4f60\u7a81\u7136\u770b\u5230\u67d0\u4e00\u684c\u7684\u6f02\u4eaemm\uff0c\u8d70\u4e86\u8fc7\u53bb\uff0c\u8fd9\u53eb\u4f18\u5148\u7ea7\u3002</p> <p>\u4f60\u53bb\u4e86\u5750\u4e0b\u6765\u5c31\u4e0d\u6253\u7b97\u8d70\u4e86\uff0c\u8fd9\u53eb\u6b7b\u5faa\u73af\u3002</p> <p>\u4f60\u7684\u8001\u5927\u4e3e\u676f\u9080\u4f60\u8fc7\u53bb\uff0c\u4f60\u53ea\u597d\u8fc7\u53bb\uff0c\u8fd9\u53eb\u6fc0\u6d3b\u4e8b\u4ef6\u3002</p> <p>\u4f60\u5411\u4e00\u684c\u656c\u9152\uff0c\u4ed6\u4eec\u8bf4\u4e0d\u884c\u4e0d\u884c\u6211\u4eec\u90fd\u559d\u767d\u7684\uff0c\u4e8e\u662f\u4f60\u4e5f\u559d\u767d\u7684\uff0c\u8fd9\u53eb\u672c\u5730\u5316\u3002</p> <p>\u4f60\u5411boss\u656c\u9152\uff0c\u53ef\u662fboss\u88ab\u56f4\u4e86\u8d77\u6765\uff0c\u4f60\u53ea\u80fd\u7ad9\u5728\u5916\u5708\uff0c\u8fd9\u53eb\u6392\u961f\u3002</p> <p>\u4f60\u7ec8\u4e8e\u5230\u4e86\u5185\u5708\uff0c\u5c0f\u5fc3\u7ffc\u7ffc\u7684\u5411\u524d\u4e00\u6b65\uff0c\u8fd9\u53eb\u8bbf\u95ee\u4e34\u754c\u533a\u3002</p> <p>\u4f60\u62cd\u7740boss\u7684\u80a9\u8180\u8bf4\u54e5\u4eec\u54b1\u4eec\u559d\u4e00\u676f\uff0c\u8fd9\u53eb\u8d8a\u754c\u3002</p> <p>\u4f60\u4e0d\u77e5\u559d\u4e86\u51e0\u5708\u4e86\uff0c\u53ea\u4f1a\u8bf4\u4e24\u4e2a\u5b57\uff0c\u5e72\u4e86\uff0c\u8fd9\u53ebudp\u3002</p> <p>\u53ef\u662f\u8fd8\u6709\u4eba\u62ff\u7740\u9152\u74f6\u8dd1\u8fc7\u6765\u8bf4\uff0c\u521a\u624d\u90fd\u6ca1\u8ddf\u4f60\u559d\uff0c\u8fd9\u53eb\u4e22\u5305\u3002</p> <p>\u559d\u9152\u559d\u5230\u6700\u540e\u7684\u7ed3\u679c\u90fd\u4e00\u6837</p> <p>\u4f60\u7a81\u7136\u8dd1\u5411\u5395\u6240\uff0c\u8fd9\u53eb\u6355\u83b7\u5f02\u5e38\u3002</p> <p>\u4f60\u5728\u5395\u6240\u5410\u4e86\uff0c\u53cd\u800c\u89c9\u5f97\u72b6\u6001\u4e0d\u9519\uff0c\u8fd9\u53eb\u6e05\u7a7a\u5185\u5b58\u3002</p> <p>\u4f60\u5728\u53f0\u9762\u4e0a\u5410\u4e86\uff0c\u89c9\u5f97\u5f88\u60ed\u6127\uff0c\u8fd9\u53eb\u7a0b\u5e8f\u5f02\u5e38\u3002</p> <p>\u4f60\u5728boss\u9762\u524d\u5410\u4e86\uff0c\u89c9\u5f97\u5f88\u5bb3\u6015\uff0c\u8fd9\u53eb\u7cfb\u7edf\u5d29\u6e83\u3002</p> <p>\u4f60\u5410\u5230\u4e86boss\u8eab\u4e0a\uff0c\u53ea\u80fd\u7d22\u6027\u6655\u5012\u4e86\uff0c\u8fd9\u53eb\u786c\u4ef6\u4f11\u514b\u3002</p> <p>\u5728\uff1f</p> <p></p> <p>\u5f53\u4f60\u6478\u9c7c\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u9c7c\u4e5f\u5728\u6478\u4f60</p>","tags":["fun"]},{"location":"fun/joke-3/","title":"\u7a0b\u5e8f\u5458\u6bb5\u5b503","text":"<p>\u6765\u6e90\u7f51\u7edc\uff0c\u4fb5\u5220</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u8d70\u8fdb\u4e00\u5bb6\u9152\u5427\uff0c\u8981\u4e86\u4e00\u676f\u5564\u9152</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u8d70\u8fdb\u4e00\u5bb6\u9152\u5427\uff0c\u8981\u4e86\u4e00\u676f\u5496\u5561</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u8d70\u8fdb\u4e00\u5bb6\u9152\u5427\uff0c\u8981\u4e860.7\u676f\u5564\u9152</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u8d70\u8fdb\u4e00\u5bb6\u9152\u5427\uff0c\u8981\u4e86-1\u676f\u5564\u9152</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u8d70\u8fdb\u4e00\u5bb6\u9152\u5427\uff0c\u8981\u4e862^32\u676f\u5564\u9152</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u8d70\u8fdb\u4e00\u5bb6\u9152\u5427\uff0c\u8981\u4e86\u4e00\u676f\u6d17\u811a\u6c34</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u8d70\u8fdb\u4e00\u5bb6\u9152\u5427\uff0c\u8981\u4e86\u4e00\u676f\u8725\u8734</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u8d70\u8fdb\u4e00\u5bb6\u9152\u5427\uff0c\u8981\u4e86\u4e00\u4efdasdfQwer@24dg!&amp;*(@</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u8d70\u8fdb\u4e00\u5bb6\u9152\u5427\uff0c\u4ec0\u4e48\u4e5f\u6ca1\u8981</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u8d70\u8fdb\u5bb6\u9152\u5427\uff0c\u53c8\u8d70\u51fa\u53bb\u53c8\u4ece\u7a97\u6237\u8fdb\u6765\u53c8\u4ece\u540e\u95e8\u51fa\u53bb\u4ece\u4e0b\u6c34\u9053\u94bb\u8fdb\u6765</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u8d70\u8fdb\u5bb6\u9152\u5427\uff0c\u53c8\u8d70\u51fa\u53bb\u53c8\u8fdb\u6765\u53c8\u51fa\u53bb\u53c8\u8fdb\u6765\u53c8\u51fa\u53bb\uff0c\u6700\u540e\u5728\u5916\u9762\u628a\u8001\u677f\u6253\u4e86\u4e00\u987f</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u8d70\u8fdb\u4e00</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u8d70\u8fdb\u4e00\u5bb6\u9152\u5427\uff0c\u8981\u4e86\u4e00\u676f\u70eb\u70eb\u70eb\u7684\u951f\u65a4\u62f7</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u8d70\u8fdb\u4e00\u5bb6\u9152\u5427\uff0c\u8981\u4e86NaN\u676fNull</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u51b2\u8fdb\u4e00\u5bb6\u9152\u5427\uff0c\u8981\u4e86500T\u5564\u9152\u5496\u5561\u6d17\u811a\u6c34\u91ce\u732b\u72fc\u7259\u68d2\u5976\u8336</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u628a\u9152\u5427\u62c6\u4e86</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u5316\u88c5\u6210\u8001\u677f\u8d70\u8fdb\u4e00\u5bb6\u9152\u5427\uff0c\u8981\u4e86500\u676f\u5564\u9152\uff0c\u5e76\u4e14\u4e0d\u4ed8\u94b1\u4e00\u4e07\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u5728\u9152\u5427\u5916\u547c\u5578\u800c\u8fc7</p> <p>\u4e00\u4e2a\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u8d70\u8fdb\u4e00\u5bb6\u9152\u5427\uff0c\u8981\u4e86\u4e00\u676f\u5564\u9152';DROPTABLE \u9152\u5427'</p> <p>\u6d4b\u8bd5\u5de5\u7a0b\u5e08\u4eec\u6ee1\u610f\u5730\u79bb\u5f00\u4e86\u9152\u5427</p> <p>\u7136\u540e\u4e00\u540d\u987e\u5ba2\u70b9\u4e86\u4e00\u4efd\u7092\u996d\uff0c\u9152\u5427\u70b8\u4e86</p> <p></p> <p>\u5f53\u4f60\u6478\u9c7c\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u9c7c\u4e5f\u5728\u6478\u4f60</p>","tags":["fun"]},{"location":"fun/joke-4/","title":"\u7a0b\u5e8f\u5458\u6bb5\u5b504","text":"<p>\u6765\u6e90\u7f51\u7edc\uff0c\u4fb5\u5220</p> <p></p> <p></p> <p>\u5f53\u4f60\u6478\u9c7c\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u9c7c\u4e5f\u5728\u6478\u4f60</p>","tags":["fun"]},{"location":"fun/joke-5/","title":"\u7a0b\u5e8f\u7b11\u8bdd\uff0c\u6c99\u96d5\u56fe5","text":"<p>\u6765\u6e90\u7f51\u7edc\uff0c\u4fb5\u5220</p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p></p> <p>\u5f53\u4f60\u6478\u9c7c\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u9c7c\u4e5f\u5728\u6478\u4f60</p>","tags":["fun"]},{"location":"git/git-tips/","title":"Git \u7684\u5947\u6280\u6deb\u5de7:see_no_evil:","text":"\u539f\u6587\u4f5c\u8005 <p>https://github.com/521xueweihan/git-tips</p> <p>Git \u5e38\u7528\u547d\u4ee4\u96c6\u5408\uff0cFork \u81ea tips \u9879\u76ee</p> <p>Git \u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u7248\u672c\u7ba1\u7406\u5de5\u5177\uff0c\u7248\u672c\u7ba1\u7406\u5de5\u5177\u5c31\u662f\u5927\u5bb6\u5728\u5199\u4e1c\u897f\u7684\u65f6\u5019\u90fd\u7528\u8fc7 \u56de\u64a4\u8fd9\u4e2a\u529f\u80fd\uff0c\u4f46\u662f\u56de\u64a4\u53ea\u80fd\u56de\u64a4\u51e0\u6b65\uff0c\u5047\u5982\u60f3\u8981\u627e\u56de\u6211\u4e09\u5929\u4e4b\u524d\u7684\u4fee\u6539\uff0c\u5149\u7528\u56de\u64a4\u662f\u627e\u4e0d\u56de\u6765\u7684\u3002\u800c\u7248\u672c\u7ba1\u7406\u5de5\u5177\u80fd\u8bb0\u5f55\u6bcf\u6b21\u7684\u4fee\u6539\uff0c\u53ea\u8981\u63d0\u4ea4\u5230\u7248\u672c\u4ed3\u5e93\uff0c\u5c31\u53ef\u4ee5\u627e\u5230\u4e4b\u524d\u4efb\u4f55\u65f6\u523b\u7684\u72b6\u6001\uff08\u6587\u672c\u72b6\u6001\uff09\u3002</p> <p>\u4e0b\u9762\u7684\u5185\u5bb9\u5c31\u662f\u5217\u4e3e\u4e86\u5e38\u7528\u7684 Git \u547d\u4ee4\u548c\u4e00\u4e9b\u5c0f\u6280\u5de7\uff0c\u53ef\u4ee5\u901a\u8fc7\u9875\u9762\u5185\u67e5\u627e\u7684\u65b9\u5f0f <code>Ctrl/Command+f</code> \u8fdb\u884c\u5feb\u901f\u67e5\u627e\u3002</p>"},{"location":"git/git-tips/#_1","title":"\u5f00\u5377\u5fc5\u8bfb","text":"<p>\u5982\u679c\u4e4b\u524d\u672a\u4f7f\u7528\u8fc7 Git\uff0c\u53ef\u4ee5\u5b66\u4e60 Git \u5c0f\u767d\u6559\u7a0b\u5165\u95e8</p> <ol> <li>\u4e00\u5b9a\u8981\u5148\u6d4b\u8bd5\u547d\u4ee4\u7684\u6548\u679c\u540e\uff0c\u518d\u7528\u4e8e\u5de5\u4f5c\u73af\u5883\u4e2d\uff0c\u4ee5\u9632\u9020\u6210\u4e0d\u80fd\u5f25\u8865\u7684\u540e\u679c\uff01\u5230\u65f6\u5019\u522b\u62ff\u7740\u780d\u5200\u6765\u627e\u6211</li> <li>\u6240\u6709\u7684\u547d\u4ee4\u90fd\u5728 <code>git version 2.7.4 (Apple Git-66)</code> \u4e0b\u6d4b\u8bd5\u901a\u8fc7</li> <li>\u7edf\u4e00\u6982\u5ff5\uff1a<ul> <li>\u5de5\u4f5c\u533a\uff1a\u6539\u52a8\uff08\u589e\u5220\u6587\u4ef6\u548c\u5185\u5bb9\uff09</li> <li>\u6682\u5b58\u533a\uff1a\u8f93\u5165\u547d\u4ee4\uff1a<code>git add \u6539\u52a8\u7684\u6587\u4ef6\u540d</code>\uff0c\u6b64\u6b21\u6539\u52a8\u5c31\u653e\u5230\u4e86 \u2018\u6682\u5b58\u533a\u2019</li> <li>\u672c\u5730\u4ed3\u5e93(\u7b80\u79f0\uff1a\u672c\u5730)\uff1a\u8f93\u5165\u547d\u4ee4\uff1a<code>git commit \u6b64\u6b21\u4fee\u6539\u7684\u63cf\u8ff0</code>\uff0c\u6b64\u6b21\u6539\u52a8\u5c31\u653e\u5230\u4e86\u672c\u5730\u4ed3\u5e93\uff0c\u6bcf\u4e2a commit\uff0c\u6211\u53eb\u5b83\u4e3a\u4e00\u4e2a\u7248\u672c\u3002</li> <li>\u8fdc\u7a0b\u4ed3\u5e93(\u7b80\u79f0\uff1a\u8fdc\u7a0b)\uff1a\u8f93\u5165\u547d\u4ee4\uff1a<code>git push \u8fdc\u7a0b\u4ed3\u5e93</code>\uff0c\u6b64\u6b21\u6539\u52a8\u5c31\u653e\u5230\u4e86\u8fdc\u7a0b\u4ed3\u5e93\uff08GitHub \u7b49)</li> <li>commit-id\uff1a\u8f93\u51fa\u547d\u4ee4\uff1a<code>git log</code>\uff0c\u6700\u4e0a\u9762\u90a3\u884c <code>commit xxxxxx</code>\uff0c\u540e\u9762\u7684\u5b57\u7b26\u4e32\u5c31\u662f commit-id</li> </ul> </li> <li>\u5982\u679c\u559c\u6b22\u8fd9\u4e2a\u9879\u76ee\uff0c\u6b22\u8fce Star\u3001\u63d0\u4ea4 Pr\u3001\u53cd\u9988\u95ee\u9898\ud83d\ude0a</li> </ol>"},{"location":"git/git-tips/#_2","title":"\u5c55\u793a\u5e2e\u52a9\u4fe1\u606f","text":"<p><pre><code>git help -g\n</code></pre> The command output as below:</p> <pre><code>The common Git guides are:\n   attributes          Defining attributes per path\n   cli                 Git command-line interface and conventions\n   core-tutorial       A Git core tutorial for developers\n   cvs-migration       Git for CVS users\n   diffcore            Tweaking diff output\n   everyday            A useful minimum set of commands for Everyday Git\n   glossary            A Git Glossary\n   hooks               Hooks used by Git\n   ignore              Specifies intentionally untracked files to ignore\n   modules             Defining submodule properties\n   namespaces          Git namespaces\n   repository-layout    Git Repository Layout\n   revisions           Specifying revisions and ranges for Git\n   tutorial            A tutorial introduction to Git\n   tutorial-2          A tutorial introduction to Git: part two\n   workflows           An overview of recommended workflows with Git\n\n'git help -a' and 'git help -g' list available subcommands and some concept guides. See 'git help &lt;command&gt;' or 'git help &lt;concept&gt;' to read about a specific subcommand or concept.\n</code></pre>"},{"location":"git/git-tips/#_3","title":"\u56de\u5230\u8fdc\u7a0b\u4ed3\u5e93\u7684\u72b6\u6001","text":"<p>\u629b\u5f03\u672c\u5730\u6240\u6709\u7684\u4fee\u6539\uff0c\u56de\u5230\u8fdc\u7a0b\u4ed3\u5e93\u7684\u72b6\u6001\u3002 <pre><code>git fetch --all &amp;&amp; git reset --hard origin/master\n</code></pre></p>"},{"location":"git/git-tips/#commit","title":"\u91cd\u8bbe\u7b2c\u4e00\u4e2a commit","text":"<p>\u4e5f\u5c31\u662f\u628a\u6240\u6709\u7684\u6539\u52a8\u90fd\u91cd\u65b0\u653e\u56de\u5de5\u4f5c\u533a\uff0c\u5e76\u6e05\u7a7a\u6240\u6709\u7684 commit\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u91cd\u65b0\u63d0\u4ea4\u7b2c\u4e00\u4e2a commit \u4e86</p> <pre><code>git update-ref -d HEAD\n</code></pre>"},{"location":"git/git-tips/#_4","title":"\u67e5\u770b\u51b2\u7a81\u6587\u4ef6\u5217\u8868","text":"<p>\u5c55\u793a\u5de5\u4f5c\u533a\u7684\u51b2\u7a81\u6587\u4ef6\u5217\u8868 <pre><code>git diff --name-only --diff-filter=U\n</code></pre></p>"},{"location":"git/git-tips/#_5","title":"\u5c55\u793a\u5de5\u4f5c\u533a\u548c\u6682\u5b58\u533a\u7684\u4e0d\u540c","text":"<p>\u8f93\u51fa\u5de5\u4f5c\u533a\u548c\u6682\u5b58\u533a\u7684 different (\u4e0d\u540c)\u3002</p> <pre><code>git diff\n</code></pre> <p>\u8fd8\u53ef\u4ee5\u5c55\u793a\u672c\u5730\u4ed3\u5e93\u4e2d\u4efb\u610f\u4e24\u4e2a commit \u4e4b\u95f4\u7684\u6587\u4ef6\u53d8\u52a8\uff1a <pre><code>git diff &lt;commit-id&gt; &lt;commit-id&gt;\n</code></pre></p>"},{"location":"git/git-tips/#_6","title":"\u5c55\u793a\u6682\u5b58\u533a\u548c\u6700\u8fd1\u7248\u672c\u7684\u4e0d\u540c","text":"<p>\u8f93\u51fa\u6682\u5b58\u533a\u548c\u672c\u5730\u6700\u8fd1\u7684\u7248\u672c (commit) \u7684 different (\u4e0d\u540c)\u3002 <pre><code>git diff --cached\n</code></pre></p>"},{"location":"git/git-tips/#_7","title":"\u5c55\u793a\u6682\u5b58\u533a\u3001\u5de5\u4f5c\u533a\u548c\u6700\u8fd1\u7248\u672c\u7684\u4e0d\u540c","text":"<p>\u8f93\u51fa\u5de5\u4f5c\u533a\u3001\u6682\u5b58\u533a \u548c\u672c\u5730\u6700\u8fd1\u7684\u7248\u672c (commit) \u7684 different (\u4e0d\u540c)\u3002</p> <pre><code>git diff HEAD\n</code></pre>"},{"location":"git/git-tips/#_8","title":"\u5feb\u901f\u5207\u6362\u5230\u4e0a\u4e00\u4e2a\u5206\u652f","text":"<pre><code>git checkout -\n</code></pre>"},{"location":"git/git-tips/#master","title":"\u5220\u9664\u5df2\u7ecf\u5408\u5e76\u5230 master \u7684\u5206\u652f","text":"<pre><code>git branch --merged master | grep -v '^\\*\\|  master' | xargs -n 1 git branch -d\n</code></pre>"},{"location":"git/git-tips/#_9","title":"\u5c55\u793a\u672c\u5730\u5206\u652f\u5173\u8054\u8fdc\u7a0b\u4ed3\u5e93\u7684\u60c5\u51b5","text":"<pre><code>git branch -vv\n</code></pre>"},{"location":"git/git-tips/#_10","title":"\u5173\u8054\u8fdc\u7a0b\u5206\u652f","text":"<p>\u5173\u8054\u4e4b\u540e\uff0c<code>git branch -vv</code> \u5c31\u53ef\u4ee5\u5c55\u793a\u5173\u8054\u7684\u8fdc\u7a0b\u5206\u652f\u540d\u4e86\uff0c\u540c\u65f6\u63a8\u9001\u5230\u8fdc\u7a0b\u4ed3\u5e93\u76f4\u63a5\uff1a<code>git push</code>\uff0c\u4e0d\u9700\u8981\u6307\u5b9a\u8fdc\u7a0b\u4ed3\u5e93\u4e86\u3002 <pre><code>git branch -u origin/mybranch\n</code></pre></p> <p>\u6216\u8005\u5728 push \u65f6\u52a0\u4e0a <code>-u</code> \u53c2\u6570 <pre><code>git push origin/mybranch -u\n</code></pre></p>"},{"location":"git/git-tips/#_11","title":"\u5217\u51fa\u6240\u6709\u8fdc\u7a0b\u5206\u652f","text":"<p>-r \u53c2\u6570\u76f8\u5f53\u4e8e\uff1aremote <pre><code>git branch -r\n</code></pre></p>"},{"location":"git/git-tips/#_12","title":"\u5217\u51fa\u672c\u5730\u548c\u8fdc\u7a0b\u5206\u652f","text":"<p>-a \u53c2\u6570\u76f8\u5f53\u4e8e\uff1aall <pre><code>git branch -a\n</code></pre></p>"},{"location":"git/git-tips/#_13","title":"\u67e5\u770b\u8fdc\u7a0b\u5206\u652f\u548c\u672c\u5730\u5206\u652f\u7684\u5bf9\u5e94\u5173\u7cfb","text":"<pre><code>git remote show origin\n</code></pre>"},{"location":"git/git-tips/#_14","title":"\u8fdc\u7a0b\u5220\u9664\u4e86\u5206\u652f\u672c\u5730\u4e5f\u60f3\u5220\u9664","text":"<pre><code>git remote prune origin\n</code></pre>"},{"location":"git/git-tips/#_15","title":"\u521b\u5efa\u5e76\u5207\u6362\u5230\u672c\u5730\u5206\u652f","text":"<pre><code>git checkout -b &lt;branch-name&gt;\n</code></pre>"},{"location":"git/git-tips/#_16","title":"\u4ece\u8fdc\u7a0b\u5206\u652f\u4e2d\u521b\u5efa\u5e76\u5207\u6362\u5230\u672c\u5730\u5206\u652f","text":"<pre><code>git checkout -b &lt;branch-name&gt; origin/&lt;branch-name&gt;\n</code></pre>"},{"location":"git/git-tips/#_17","title":"\u5220\u9664\u672c\u5730\u5206\u652f","text":"<pre><code>git branch -d &lt;local-branchname&gt;\n</code></pre>"},{"location":"git/git-tips/#_18","title":"\u5220\u9664\u8fdc\u7a0b\u5206\u652f","text":"<pre><code>git push origin --delete &lt;remote-branchname&gt;\n</code></pre> <p>\u6216\u8005</p> <pre><code>git push origin :&lt;remote-branchname&gt;\n</code></pre>"},{"location":"git/git-tips/#_19","title":"\u91cd\u547d\u540d\u672c\u5730\u5206\u652f","text":"<pre><code>git branch -m &lt;new-branch-name&gt;\n</code></pre>"},{"location":"git/git-tips/#_20","title":"\u67e5\u770b\u6807\u7b7e","text":"<p><pre><code>git tag\n</code></pre> \u5c55\u793a\u5f53\u524d\u5206\u652f\u7684\u6700\u8fd1\u7684 tag</p> <pre><code>git describe --tags --abbrev=0\n</code></pre>"},{"location":"git/git-tips/#_21","title":"\u67e5\u770b\u6807\u7b7e\u8be6\u7ec6\u4fe1\u606f","text":"<pre><code>git tag -ln\n</code></pre>"},{"location":"git/git-tips/#_22","title":"\u672c\u5730\u521b\u5efa\u6807\u7b7e","text":"<pre><code>git tag &lt;version-number&gt;\n</code></pre> <p>\u9ed8\u8ba4 tag \u662f\u6253\u5728\u6700\u8fd1\u7684\u4e00\u6b21 commit \u4e0a\uff0c\u5982\u679c\u9700\u8981\u6307\u5b9a commit \u6253 tag\uff1a <pre><code>$ git tag -a &lt;version-number&gt; -m \"v1.0 \u53d1\u5e03(\u63cf\u8ff0)\" &lt;commit-id&gt;\n</code></pre></p>"},{"location":"git/git-tips/#_23","title":"\u63a8\u9001\u6807\u7b7e\u5230\u8fdc\u7a0b\u4ed3\u5e93","text":"<p>\u9996\u5148\u8981\u4fdd\u8bc1\u672c\u5730\u521b\u5efa\u597d\u4e86\u6807\u7b7e\u624d\u53ef\u4ee5\u63a8\u9001\u6807\u7b7e\u5230\u8fdc\u7a0b\u4ed3\u5e93\uff1a</p> <pre><code>git push origin &lt;local-version-number&gt;\n</code></pre> <p>\u4e00\u6b21\u6027\u63a8\u9001\u6240\u6709\u6807\u7b7e\uff0c\u540c\u6b65\u5230\u8fdc\u7a0b\u4ed3\u5e93\uff1a</p> <pre><code>git push origin --tags\n</code></pre>"},{"location":"git/git-tips/#_24","title":"\u5220\u9664\u672c\u5730\u6807\u7b7e","text":"<pre><code>git tag -d &lt;tag-name&gt;\n</code></pre>"},{"location":"git/git-tips/#_25","title":"\u5220\u9664\u8fdc\u7a0b\u6807\u7b7e","text":"<pre><code>git push origin --delete tag &lt;tagname&gt;\n</code></pre>"},{"location":"git/git-tips/#_26","title":"\u5207\u56de\u5230\u67d0\u4e2a\u6807\u7b7e","text":"<p>\u4e00\u822c\u4e0a\u7ebf\u4e4b\u524d\u90fd\u4f1a\u6253 tag\uff0c\u5c31\u662f\u4e3a\u4e86\u9632\u6b62\u4e0a\u7ebf\u540e\u51fa\u73b0\u95ee\u9898\uff0c\u65b9\u4fbf\u5feb\u901f\u56de\u9000\u5230\u4e0a\u4e00\u7248\u672c\u3002\u4e0b\u9762\u7684\u547d\u4ee4\u662f\u56de\u5230\u67d0\u4e00\u6807\u7b7e\u4e0b\u7684\u72b6\u6001\uff1a <pre><code>git checkout -b branch_name tag_name\n</code></pre></p>"},{"location":"git/git-tips/#_27","title":"\u653e\u5f03\u5de5\u4f5c\u533a\u7684\u4fee\u6539","text":"<pre><code>git checkout &lt;file-name&gt;\n</code></pre> <p>\u653e\u5f03\u6240\u6709\u4fee\u6539\uff1a <pre><code>git checkout .\n</code></pre></p>"},{"location":"git/git-tips/#_28","title":"\u6062\u590d\u5220\u9664\u7684\u6587\u4ef6","text":"<pre><code>git rev-list -n 1 HEAD -- &lt;file_path&gt; #\u5f97\u5230 deleting_commit\n\ngit checkout &lt;deleting_commit&gt;^ -- &lt;file_path&gt; #\u56de\u5230\u5220\u9664\u6587\u4ef6 deleting_commit \u4e4b\u524d\u7684\u72b6\u6001\n</code></pre>"},{"location":"git/git-tips/#commit-commit","title":"\u4ee5\u65b0\u589e\u4e00\u4e2a commit \u7684\u65b9\u5f0f\u8fd8\u539f\u67d0\u4e00\u4e2a commit \u7684\u4fee\u6539","text":"<pre><code>git revert &lt;commit-id&gt;\n</code></pre>"},{"location":"git/git-tips/#commit-commit_1","title":"\u56de\u5230\u67d0\u4e2a commit \u7684\u72b6\u6001\uff0c\u5e76\u5220\u9664\u540e\u9762\u7684 commit","text":"<p>\u548c revert \u7684\u533a\u522b\uff1areset \u547d\u4ee4\u4f1a\u62b9\u53bb\u67d0\u4e2a commit id \u4e4b\u540e\u7684\u6240\u6709 commit</p> <pre><code>git reset &lt;commit-id&gt;  #\u9ed8\u8ba4\u5c31\u662f-mixed\u53c2\u6570\u3002\n\ngit reset --mixed HEAD^  #\u56de\u9000\u81f3\u4e0a\u4e2a\u7248\u672c\uff0c\u5b83\u5c06\u91cd\u7f6eHEAD\u5230\u53e6\u5916\u4e00\u4e2acommit,\u5e76\u4e14\u91cd\u7f6e\u6682\u5b58\u533a\u4ee5\u4fbf\u548cHEAD\u76f8\u5339\u914d\uff0c\u4f46\u662f\u4e5f\u5230\u6b64\u4e3a\u6b62\u3002\u5de5\u4f5c\u533a\u4e0d\u4f1a\u88ab\u66f4\u6539\u3002\n\ngit reset --soft HEAD~3  #\u56de\u9000\u81f3\u4e09\u4e2a\u7248\u672c\u4e4b\u524d\uff0c\u53ea\u56de\u9000\u4e86commit\u7684\u4fe1\u606f\uff0c\u6682\u5b58\u533a\u548c\u5de5\u4f5c\u533a\u4e0e\u56de\u9000\u4e4b\u524d\u4fdd\u6301\u4e00\u81f4\u3002\u5982\u679c\u8fd8\u8981\u63d0\u4ea4\uff0c\u76f4\u63a5commit\u5373\u53ef \u00a0\n\ngit reset --hard &lt;commit-id&gt;  #\u5f7b\u5e95\u56de\u9000\u5230\u6307\u5b9acommit-id\u7684\u72b6\u6001\uff0c\u6682\u5b58\u533a\u548c\u5de5\u4f5c\u533a\u4e5f\u4f1a\u53d8\u4e3a\u6307\u5b9acommit-id\u7248\u672c\u7684\u5185\u5bb9\n</code></pre>"},{"location":"git/git-tips/#commit_1","title":"\u4fee\u6539\u4e0a\u4e00\u4e2a commit \u7684\u63cf\u8ff0","text":"<p>\u5982\u679c\u6682\u5b58\u533a\u6709\u6539\u52a8\uff0c\u540c\u65f6\u4e5f\u4f1a\u5c06\u6682\u5b58\u533a\u7684\u6539\u52a8\u63d0\u4ea4\u5230\u4e0a\u4e00\u4e2a commit</p> <pre><code>git commit --amend\n</code></pre>"},{"location":"git/git-tips/#commit_2","title":"\u67e5\u770b commit \u5386\u53f2","text":"<pre><code>git log\n</code></pre>"},{"location":"git/git-tips/#_29","title":"\u67e5\u770b\u67d0\u6bb5\u4ee3\u7801\u662f\u8c01\u5199\u7684","text":"<p>blame \u7684\u610f\u601d\u4e3a\u2018\u8d23\u602a\u2019\uff0c\u4f60\u61c2\u7684\u3002</p> <pre><code>git blame &lt;file-name&gt;\n</code></pre>"},{"location":"git/git-tips/#head-git","title":"\u663e\u793a\u672c\u5730\u66f4\u65b0\u8fc7 HEAD \u7684 git \u547d\u4ee4\u8bb0\u5f55","text":"<p>\u6bcf\u6b21\u66f4\u65b0\u4e86 HEAD \u7684 git \u547d\u4ee4\u6bd4\u5982 commit\u3001amend\u3001cherry-pick\u3001reset\u3001revert \u7b49\u90fd\u4f1a\u88ab\u8bb0\u5f55\u4e0b\u6765\uff08\u4e0d\u9650\u5206\u652f\uff09\uff0c\u5c31\u50cf shell \u7684 history \u4e00\u6837\u3002 \u8fd9\u6837\u4f60\u53ef\u4ee5 reset \u5230\u4efb\u4f55\u4e00\u6b21\u66f4\u65b0\u4e86 HEAD \u7684\u64cd\u4f5c\u4e4b\u540e\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u56de\u5230\u5f53\u524d\u5206\u652f\u4e0b\u7684\u67d0\u4e2a commit \u4e4b\u540e\u7684\u72b6\u6001\u3002</p> <pre><code>git reflog\n</code></pre>"},{"location":"git/git-tips/#_30","title":"\u4fee\u6539\u4f5c\u8005\u540d","text":"<pre><code>git commit --amend --author='Author Name &lt;email@address.com&gt;'\n</code></pre>"},{"location":"git/git-tips/#url","title":"\u4fee\u6539\u8fdc\u7a0b\u4ed3\u5e93\u7684 url","text":"<pre><code>git remote set-url origin &lt;URL&gt;\n</code></pre>"},{"location":"git/git-tips/#_31","title":"\u589e\u52a0\u8fdc\u7a0b\u4ed3\u5e93","text":"<pre><code>git remote add origin &lt;remote-url&gt;\n</code></pre>"},{"location":"git/git-tips/#_32","title":"\u5217\u51fa\u6240\u6709\u8fdc\u7a0b\u4ed3\u5e93","text":"<pre><code>git remote\n</code></pre>"},{"location":"git/git-tips/#_33","title":"\u67e5\u770b\u4e24\u4e2a\u661f\u671f\u5185\u7684\u6539\u52a8","text":"<pre><code>git whatchanged --since='2 weeks ago'\n</code></pre>"},{"location":"git/git-tips/#a-commit-b","title":"\u628a A \u5206\u652f\u7684\u67d0\u4e00\u4e2a commit\uff0c\u653e\u5230 B \u5206\u652f\u4e0a","text":"<p>\u8fd9\u4e2a\u8fc7\u7a0b\u9700\u8981 <code>cherry-pick</code> \u547d\u4ee4\uff0c\u53c2\u8003</p> <pre><code>git checkout &lt;branch-name&gt; &amp;&amp; git cherry-pick &lt;commit-id&gt;\n</code></pre>"},{"location":"git/git-tips/#git","title":"\u7ed9 git \u547d\u4ee4\u8d77\u522b\u540d","text":"<p>\u7b80\u5316\u547d\u4ee4</p> <pre><code>git config --global alias.&lt;handle&gt; &lt;command&gt;\n\n\u6bd4\u5982\uff1agit status \u6539\u6210 git st\uff0c\u8fd9\u6837\u53ef\u4ee5\u7b80\u5316\u547d\u4ee4\n\ngit config --global alias.st status\n</code></pre>"},{"location":"git/git-tips/#commit_3","title":"\u5b58\u50a8\u5f53\u524d\u7684\u4fee\u6539\uff0c\u4f46\u4e0d\u7528\u63d0\u4ea4 commit","text":"<p>\u8be6\u89e3\u53ef\u4ee5\u53c2\u8003\u5ed6\u96ea\u5cf0\u8001\u5e08\u7684 git \u6559\u7a0b <pre><code>git stash\n</code></pre></p>"},{"location":"git/git-tips/#untracked","title":"\u4fdd\u5b58\u5f53\u524d\u72b6\u6001\uff0c\u5305\u62ec untracked \u7684\u6587\u4ef6","text":"<p>untracked \u6587\u4ef6\uff1a\u65b0\u5efa\u7684\u6587\u4ef6 <pre><code>git stash -u\n</code></pre></p>"},{"location":"git/git-tips/#stashes","title":"\u5c55\u793a\u6240\u6709 stashes","text":"<pre><code>git stash list\n</code></pre>"},{"location":"git/git-tips/#stash","title":"\u56de\u5230\u67d0\u4e2a stash \u7684\u72b6\u6001","text":"<pre><code>git stash apply &lt;stash@{n}&gt;\n</code></pre>"},{"location":"git/git-tips/#stash-stash","title":"\u56de\u5230\u6700\u540e\u4e00\u4e2a stash \u7684\u72b6\u6001\uff0c\u5e76\u5220\u9664\u8fd9\u4e2a stash","text":"<pre><code>git stash pop\n</code></pre>"},{"location":"git/git-tips/#stash_1","title":"\u5220\u9664\u6240\u6709\u7684 stash","text":"<pre><code>git stash clear\n</code></pre>"},{"location":"git/git-tips/#stash_2","title":"\u4ece stash \u4e2d\u62ff\u51fa\u67d0\u4e2a\u6587\u4ef6\u7684\u4fee\u6539","text":"<pre><code>git checkout &lt;stash@{n}&gt; -- &lt;file-path&gt;\n</code></pre>"},{"location":"git/git-tips/#tracked","title":"\u5c55\u793a\u6240\u6709 tracked \u7684\u6587\u4ef6","text":"<pre><code>git ls-files -t\n</code></pre>"},{"location":"git/git-tips/#untracked_1","title":"\u5c55\u793a\u6240\u6709 untracked \u7684\u6587\u4ef6","text":"<pre><code>git ls-files --others\n</code></pre>"},{"location":"git/git-tips/#_34","title":"\u5c55\u793a\u6240\u6709\u5ffd\u7565\u7684\u6587\u4ef6","text":"<pre><code>git ls-files --others -i --exclude-standard\n</code></pre>"},{"location":"git/git-tips/#untracked_2","title":"\u5f3a\u5236\u5220\u9664 untracked \u7684\u6587\u4ef6","text":"<p>\u53ef\u4ee5\u7528\u6765\u5220\u9664\u65b0\u5efa\u7684\u6587\u4ef6\u3002\u5982\u679c\u4e0d\u6307\u5b9a\u6587\u4ef6\u6587\u4ef6\u540d\uff0c\u5219\u6e05\u7a7a\u6240\u6709\u5de5\u4f5c\u7684 untracked \u6587\u4ef6\u3002<code>clean</code> \u547d\u4ee4\uff0c\u6ce8\u610f\u4e24\u70b9\uff1a 1. clean \u540e\uff0c\u5220\u9664\u7684\u6587\u4ef6\u65e0\u6cd5\u627e\u56de 2. \u4e0d\u4f1a\u5f71\u54cd tracked \u7684\u6587\u4ef6\u7684\u6539\u52a8\uff0c\u53ea\u4f1a\u5220\u9664 untracked \u7684\u6587\u4ef6</p> <pre><code>git clean &lt;file-name&gt; -f\n</code></pre>"},{"location":"git/git-tips/#untracked_3","title":"\u5f3a\u5236\u5220\u9664 untracked \u7684\u76ee\u5f55","text":"<p>\u53ef\u4ee5\u7528\u6765\u5220\u9664\u65b0\u5efa\u7684\u76ee\u5f55\uff0c\u6ce8\u610f:\u8fd9\u4e2a\u547d\u4ee4\u4e5f\u53ef\u4ee5\u7528\u6765\u5220\u9664 untracked \u7684\u6587\u4ef6\u3002\u8be6\u60c5\u89c1\u4e0a\u4e00\u6761</p> <pre><code>git clean &lt;directory-name&gt; -df\n</code></pre>"},{"location":"git/git-tips/#commit_4","title":"\u5c55\u793a\u7b80\u5316\u7684 commit \u5386\u53f2","text":"<pre><code>git log --pretty=oneline --graph --decorate --all\n</code></pre>"},{"location":"git/git-tips/#_35","title":"\u628a\u67d0\u4e00\u4e2a\u5206\u652f\u5bfc\u51fa\u6210\u4e00\u4e2a\u6587\u4ef6","text":"<pre><code>git bundle create &lt;file&gt; &lt;branch-name&gt;\n</code></pre>"},{"location":"git/git-tips/#_36","title":"\u4ece\u5305\u4e2d\u5bfc\u5165\u5206\u652f","text":"<p>\u65b0\u5efa\u4e00\u4e2a\u5206\u652f\uff0c\u5206\u652f\u5185\u5bb9\u5c31\u662f\u4e0a\u9762 <code>git bundle create</code> \u547d\u4ee4\u5bfc\u51fa\u7684\u5185\u5bb9</p> <pre><code>git clone repo.bundle &lt;repo-dir&gt; -b &lt;branch-name&gt;\n</code></pre>"},{"location":"git/git-tips/#rebase-stash","title":"\u6267\u884c rebase \u4e4b\u524d\u81ea\u52a8 stash","text":"<pre><code>git rebase --autostash\n</code></pre>"},{"location":"git/git-tips/#id","title":"\u4ece\u8fdc\u7a0b\u4ed3\u5e93\u6839\u636e ID\uff0c\u62c9\u4e0b\u67d0\u4e00\u72b6\u6001\uff0c\u5230\u672c\u5730\u5206\u652f","text":"<pre><code>git fetch origin pull/&lt;id&gt;/head:&lt;branch-name&gt;\n</code></pre>"},{"location":"git/git-tips/#_37","title":"\u8be6\u7ec6\u5c55\u793a\u4e00\u884c\u4e2d\u7684\u4fee\u6539","text":"<pre><code>git diff --word-diff\n</code></pre>"},{"location":"git/git-tips/#gitignore","title":"\u6e05\u9664 gitignore \u6587\u4ef6\u4e2d\u8bb0\u5f55\u7684\u6587\u4ef6","text":"<pre><code>git clean -X -f\n</code></pre>"},{"location":"git/git-tips/#alias-configs","title":"\u5c55\u793a\u6240\u6709 alias \u548c configs","text":"<p>\u6ce8\u610f\uff1a config \u5206\u4e3a\uff1a\u5f53\u524d\u76ee\u5f55\uff08local\uff09\u548c\u5168\u5c40\uff08golbal\uff09\u7684 config\uff0c\u9ed8\u8ba4\u4e3a\u5f53\u524d\u76ee\u5f55\u7684 config</p> <pre><code>git config --local --list (\u5f53\u524d\u76ee\u5f55)\ngit config --global --list (\u5168\u5c40)\n</code></pre>"},{"location":"git/git-tips/#_38","title":"\u5c55\u793a\u5ffd\u7565\u7684\u6587\u4ef6","text":"<pre><code>git status --ignored\n</code></pre>"},{"location":"git/git-tips/#commit-branch1-branch2-commit","title":"commit \u5386\u53f2\u4e2d\u663e\u793a Branch1 \u6709\u7684\uff0c\u4f46\u662f Branch2 \u6ca1\u6709 commit","text":"<pre><code>git log Branch1 ^Branch2\n</code></pre>"},{"location":"git/git-tips/#commit-log-gpg","title":"\u5728 commit log \u4e2d\u663e\u793a GPG \u7b7e\u540d","text":"<pre><code>git log --show-signature\n</code></pre>"},{"location":"git/git-tips/#_39","title":"\u5220\u9664\u5168\u5c40\u8bbe\u7f6e","text":"<pre><code>git config --global --unset &lt;entry-name&gt;\n</code></pre>"},{"location":"git/git-tips/#commit_5","title":"\u65b0\u5efa\u5e76\u5207\u6362\u5230\u65b0\u5206\u652f\u4e0a\uff0c\u540c\u65f6\u8fd9\u4e2a\u5206\u652f\u6ca1\u6709\u4efb\u4f55 commit","text":"<p>\u76f8\u5f53\u4e8e\u4fdd\u5b58\u4fee\u6539\uff0c\u4f46\u662f\u91cd\u5199 commit \u5386\u53f2</p> <pre><code>git checkout --orphan &lt;branch-name&gt;\n</code></pre>"},{"location":"git/git-tips/#_40","title":"\u5c55\u793a\u4efb\u610f\u5206\u652f\u67d0\u4e00\u6587\u4ef6\u7684\u5185\u5bb9","text":"<pre><code>git show &lt;branch-name&gt;:&lt;file-name&gt;\n</code></pre>"},{"location":"git/git-tips/#clone","title":"clone \u4e0b\u6765\u6307\u5b9a\u7684\u5355\u4e00\u5206\u652f","text":"<pre><code>git clone -b &lt;branch-name&gt; --single-branch https://github.com/user/repo.git\n</code></pre>"},{"location":"git/git-tips/#clone_1","title":"clone \u6700\u65b0\u4e00\u6b21\u63d0\u4ea4","text":"<p>\u53ea\u4f1a clone \u6700\u8fd1\u4e00\u6b21\u63d0\u4ea4\uff0c\u5c06\u51cf\u5c11 clone \u65f6\u95f4</p> <pre><code>git clone --depth=1 https://github.com/user/repo.git\n</code></pre>"},{"location":"git/git-tips/#_41","title":"\u5ffd\u7565\u67d0\u4e2a\u6587\u4ef6\u7684\u6539\u52a8","text":"<p>\u5173\u95ed track \u6307\u5b9a\u6587\u4ef6\u7684\u6539\u52a8\uff0c\u4e5f\u5c31\u662f Git \u5c06\u4e0d\u4f1a\u5728\u8bb0\u5f55\u8fd9\u4e2a\u6587\u4ef6\u7684\u6539\u52a8</p> <pre><code>git update-index --assume-unchanged path/to/file\n</code></pre> <p>\u6062\u590d track \u6307\u5b9a\u6587\u4ef6\u7684\u6539\u52a8</p> <pre><code>git update-index --no-assume-unchanged path/to/file\n</code></pre>"},{"location":"git/git-tips/#_42","title":"\u5ffd\u7565\u6587\u4ef6\u7684\u6743\u9650\u53d8\u5316","text":"<p>\u4e0d\u518d\u5c06\u6587\u4ef6\u7684\u6743\u9650\u53d8\u5316\u89c6\u4f5c\u6539\u52a8</p> <pre><code>git config core.fileMode false\n</code></pre>"},{"location":"git/git-tips/#git_1","title":"\u4ee5\u6700\u540e\u63d0\u4ea4\u7684\u987a\u5e8f\u5217\u51fa\u6240\u6709 Git \u5206\u652f","text":"<p>\u6700\u65b0\u7684\u653e\u5728\u6700\u4e0a\u9762</p> <pre><code>git for-each-ref --sort=-committerdate --format='%(refname:short)' refs/heads/\n</code></pre>"},{"location":"git/git-tips/#commit-log","title":"\u5728 commit log \u4e2d\u67e5\u627e\u76f8\u5173\u5185\u5bb9","text":"<p>\u901a\u8fc7 grep \u67e5\u627e\uff0cgiven-text\uff1a\u6240\u9700\u8981\u67e5\u627e\u7684\u5b57\u6bb5</p> <pre><code>git log --all --grep='&lt;given-text&gt;'\n</code></pre>"},{"location":"git/git-tips/#file","title":"\u628a\u6682\u5b58\u533a\u7684\u6307\u5b9a file \u653e\u5230\u5de5\u4f5c\u533a\u4e2d","text":"<p>\u4e0d\u6dfb\u52a0\u53c2\u6570\uff0c\u9ed8\u8ba4\u662f <code>-mixed</code></p> <pre><code>git reset &lt;file-name&gt;\n</code></pre>"},{"location":"git/git-tips/#_43","title":"\u5f3a\u5236\u63a8\u9001","text":"<pre><code>git push -f &lt;remote-name&gt; &lt;branch-name&gt;\n</code></pre>"},{"location":"git/git-tips/#git-http-socks","title":"git \u914d\u7f6e http \u548c socks \u4ee3\u7406","text":"<pre><code>git config --global https.proxy 'http://127.0.0.1:8001'   # \u9002\u7528\u4e8e privoxy \u5c06 socks \u534f\u8bae\u8f6c\u4e3a http \u534f\u8bae\u7684 http \u7aef\u53e3\ngit config --global http.proxy 'http://127.0.0.1:8001'\ngit config --global socks.proxy \"127.0.0.1:1080\"\n</code></pre>"},{"location":"git/git-tips/#git-ssh","title":"git \u914d\u7f6e ssh \u4ee3\u7406","text":"<pre><code>$ cat ~/.ssh/config\nHost gitlab.com\nProxyCommand nc -X 5 -x 127.0.0.1:1080 %h %p    # \u76f4\u63a5\u4f7f\u7528 shadowsocks \u63d0\u4f9b\u7684 socks5 \u4ee3\u7406\u7aef\u53e3\n\nHost github.com\nProxyCommand nc -X 5 -x 127.0.0.1:1080 %h %p    \n</code></pre>"},{"location":"git/git-tips/#_44","title":"\u8111\u56fe","text":""},{"location":"git/git-tips/#commit_6","title":"\u4f18\u96c5\u7684Commit\u4fe1\u606f","text":"<p>\u4f7f\u7528Angular\u56e2\u961f\u63d0\u4ea4\u89c4\u8303</p> <p>\u4e3b\u8981\u6709\u4ee5\u4e0b\u7ec4\u6210</p> <ul> <li>\u6807\u9898\u884c: \u5fc5\u586b, \u63cf\u8ff0\u4e3b\u8981\u4fee\u6539\u7c7b\u578b\u548c\u5185\u5bb9</li> <li>\u4e3b\u9898\u5185\u5bb9: \u63cf\u8ff0\u4e3a\u4ec0\u4e48\u4fee\u6539, \u505a\u4e86\u4ec0\u4e48\u6837\u7684\u4fee\u6539, \u4ee5\u53ca\u5f00\u53d1\u7684\u601d\u8def\u7b49\u7b49</li> <li>\u9875\u811a\u6ce8\u91ca: \u653e Breaking Changes \u6216 Closed Issues</li> </ul> <p>\u5e38\u7528\u7684\u4fee\u6539\u9879</p> <ul> <li>type: commit \u7684\u7c7b\u578b</li> <li>feat: \u65b0\u7279\u6027</li> <li>fix: \u4fee\u6539\u95ee\u9898</li> <li>refactor: \u4ee3\u7801\u91cd\u6784</li> <li>docs: \u6587\u6863\u4fee\u6539</li> <li>style: \u4ee3\u7801\u683c\u5f0f\u4fee\u6539, \u6ce8\u610f\u4e0d\u662f css \u4fee\u6539</li> <li>test: \u6d4b\u8bd5\u7528\u4f8b\u4fee\u6539</li> <li>chore: \u5176\u4ed6\u4fee\u6539, \u6bd4\u5982\u6784\u5efa\u6d41\u7a0b, \u4f9d\u8d56\u7ba1\u7406.</li> <li>scope: commit \u5f71\u54cd\u7684\u8303\u56f4, \u6bd4\u5982: route, component, utils, build...</li> <li>subject: commit \u7684\u6982\u8ff0</li> <li>body: commit \u5177\u4f53\u4fee\u6539\u5185\u5bb9, \u53ef\u4ee5\u5206\u4e3a\u591a\u884c</li> <li>footer: \u4e00\u4e9b\u5907\u6ce8, \u901a\u5e38\u662f BREAKING CHANGE \u6216\u4fee\u590d\u7684 bug \u7684\u94fe\u63a5.</li> </ul>"},{"location":"git/git-tips/#commit_7","title":"commit\u5de5\u5177","text":"<p>\u53ef\u4ee5\u4f7f\u7528cz-cli\u5de5\u5177\u4ee3\u66ff <code>git commit</code></p> <p>\u5168\u5c40\u5b89\u88c5</p> <p><pre><code>npm install -g commitizen cz-conventional-changelog\n\necho '{ \"path\": \"cz-conventional-changelog\" }' &gt; ~/.czrc\n</code></pre> \u5168\u5c40\u5b89\u88c5\u540e\u4f7f\u7528 <code>git cz</code> \u4ee3\u66ff <code>git commit</code>\u5c31\u53ef\u4ee5\u4e86,\u5982\u4e0b\u56fe</p> <p></p>"},{"location":"ios/duns-apple-2022/","title":"\u9093\u767d\u6c0f\u7f16\u53f7\u7533\u8bf7 DUNS","text":"\u66f4\u65b0\u65e5\u671f 2022-12-20 <ul> <li>2022-12-20 \u521b\u5efa\u6587\u6863</li> </ul>","tags":["iOS"]},{"location":"ios/duns-apple-2022/#_1","title":"\u7b80\u4ecb","text":"<p>D-U-N-S \u7f16\u53f7\u3002\u9093\u767d\u6c0f\u7801\u662f\u4e00\u79cd\u4f01\u4e1a\u7684\u8eab\u4efd\u8bc6\u522b\u7801 \uff08\u5c31\u50cf\u662f\u4e2a\u4eba\u7684\u8eab\u4efd\u8bc1\uff09\uff0c\u88ab\u5e7f\u6cdb\u5e94\u7528\u4e8e\u4f01\u4e1a\u8bc6\u522b\u3001\u5546\u4e1a\u4fe1\u606f\u7684\u7ec4\u7ec7\u53ca\u6574\u7406\u3002\u53ef\u4ee5\u5e2e\u52a9\u8bc6\u522b\u548c\u8fc5\u901f\u5b9a\u4f4d\u5168\u74032.4\u4ebf\u5bb6\u4f01\u4e1a\u7684\u4fe1\u606f\u3002\u4e5f\u662f\u7533\u8bf7Apple\u516c\u53f8\u5f00\u53d1\u8005\u8d26\u53f7\u7684\u5fc5\u8981\u6761\u4ef6\u3002</p>","tags":["iOS"]},{"location":"ios/duns-apple-2022/#_2","title":"\u6d41\u7a0b","text":"<p>\u9093\u767d\u6c0f\u7533\u8bf7\u5730\u5740 https://support.dnb.com/Support_Home \uff0c\u7533\u8bf7\u540e\u6709\u90ae\u4ef6\u6765\uff0c\u5f15\u5bfc\u53bb  https://www.dnbone.com/apple \u586b\u8868\u6ce8\u518c\u7533\u8bf7\u3002</p> <p></p>","tags":["iOS"]},{"location":"ios/basic/go-page/","title":"iOS\u9875\u9762\u8df3\u8f6c\u65b9\u5f0f\u7684\u51e0\u79cd\u65b9\u5f0f","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-3-2 <ul> <li>2022-3-2 \u521b\u5efa\u6587\u6863</li> </ul>","tags":["iOS"]},{"location":"ios/basic/go-page/#storyboardvc","title":"\u540c\u4e00\u4e2aStoryboard\u4e0d\u540cVC","text":"<p>\u540c\u4e00\u4e2aStoryboard\u91cc\u7684\u4e0d\u540c\u7684VC</p> <p>\u9700\u8981\u7528\u5230segue\u3002\u7528button\u8fde\u7ebf\uff0c\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684segue</p> <p>sb\u4e2d\u8fde\u7ebf</p> <pre><code>- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {\n    // segue.identifier\uff1a\u83b7\u53d6\u8fde\u7ebf\u7684ID\n    if ([segue.identifier isEqualToString:@\"goPlayPage\"]) {\n        PlayChooseVC *p = segue.destinationViewController;\n    }\n}\n</code></pre>","tags":["iOS"]},{"location":"ios/basic/go-page/#storyboard-storyboard","title":"storyboard -&gt; storyboard","text":"<p>\u8df3\u53bb\u53e6\u4e00\u4e2astoryboard</p>","tags":["iOS"]},{"location":"ios/basic/go-page/#storyboard-xib","title":"storyboard -&gt; xib","text":"","tags":["iOS"]},{"location":"ios/basic/go-page/#storyboard","title":"\u524d\u5f80storyboard\u7684\u754c\u9762","text":"<p><code>TargetStoryboard.storyboard</code>\u7684\u4e00\u4e2aVC\u662f<code>FirstVC</code></p> <p>\u8981\u8f93\u5165storyboard\u7684\u540d\u5b57\u521b\u5efa\u51fa<code>UIStoryboard</code>\u7684\u5bf9\u8c61\uff0c\u518d\u62ff\u5230<code>UIViewController</code> <pre><code>UIStoryboard *targetSb = [UIStoryboard storyboardWithName:@\"TargetStoryboard\" bundle:nil]; // storyboard\u7684\u540d\u79f0\nUIViewController *firstVC = [targetSb instantiateViewControllerWithIdentifier:@\"FirstVC\"];\n[self.navigationController pushViewController:firstVC animated:YES];\n</code></pre></p> <p>\u4ece<code>AppDelegate.m</code>\u6253\u5f00storyboard\u91cc\u7684\u754c\u9762\u4e5f\u662f\u7c7b\u4f3c\u64cd\u4f5c</p>","tags":["iOS"]},{"location":"ios/basic/go-page/#xib-xib","title":"xib -&gt; xib","text":"","tags":["iOS"]},{"location":"ios/lib/a-lib-missing-arch/","title":".a is missing one or more architectures required by this target: arm64","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-2-18 <ul> <li>2022-2-18 \u66f4\u65b0\u683c\u5f0f</li> <li>2022-1-20 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883 <ul> <li>Xcode13</li> <li>macOS Big Sur 11.4</li> </ul>","tags":["iOS"]},{"location":"ios/lib/a-lib-missing-arch/#_1","title":"\u95ee\u9898\u63cf\u8ff0","text":"<p>\u5de5\u7a0b\u8bbe\u7f6e<code>Architectures</code>\uff1a<code>Standard Architectures\uff08arm64, armv7\uff09</code></p> <p>\u5f15\u7528\u4e86libcrypto.a\uff0c\u6253\u5305\u7684\u65f6\u5019\u62a5\u9519</p> <p>The linked library 'libcrypto.a' is missing one or more architectures required by this target: arm64.</p> <p>\u5982\u679c\u7ed9\u5de5\u7a0b<code>EXCLUDED_ARCHS</code>\u52a0\u4e0a<code>arm64</code>\uff0c\u7f16\u8bd1\u62a5\u9519</p> <p>The linked library 'libcrypto.a' is missing one or more architectures required by this target: armv7.</p> <p>\u6587\u4ef6\u8def\u5f84\u6b63\u786e\u3002\u8fd9\u4e48\u770b\u5b83arm64\u548carmv7\u90fd\u4e0d\u652f\u6301\u3002</p>","tags":["iOS"]},{"location":"ios/lib/a-lib-missing-arch/#_2","title":"\u6392\u67e5","text":"<p>\u4f7f\u7528<code>lipo -info</code>\u547d\u4ee4\u68c0\u67e5\uff0c\u53d1\u73b0\u5b83\u662fx86_64\u67b6\u6784\u7684 <pre><code>lipo -info libcrypto.a\nNon-fat file: /Users/rustfisher/Downloads/libcrypto.a is architecture: x86_64\n</code></pre></p> <p>\u90a3\u4e48\u6211\u4eec\u6709\u5fc5\u8981\u7528\u53e6\u4e00\u4e2a\u6587\u4ef6\u6765\u66ff\u6362</p>","tags":["iOS"]},{"location":"ios/lib/a-lib-missing-arch/#_3","title":"\u5904\u7406","text":"","tags":["iOS"]},{"location":"ios/lib/a-lib-missing-arch/#openssl","title":"\u7f16\u8bd1OpenSSL","text":"<p>\u5728GitHub\u4e0a\u627e\u5230\u76f8\u5e94\u5de5\u7a0bOpenSSL-for-iPhone\uff0cclone\u5230\u672c\u5730\u76ee\u5f55<code>OpenSSL-for-iPhone</code></p> <p>\u6839\u636e\u4ed3\u5e93\u8bf4\u660e\uff0c\u4e0b\u8f7d\u4ee3\u7801\u540e\u8fd0\u884c\u811a\u672c\u7f16\u8bd1 <pre><code>OpenSSL-for-iPhone $ ./build-libssl.sh\nBuild options\n  OpenSSL version: 1.1.1d\n  Targets: ios-sim-cross-x86_64 ios64-cross-arm64 ios64-cross-arm64e tvos-sim-cross-x86_64 tvos64-cross-arm64\n  iOS SDK: 15.0\n  tvOS SDK: 15.0\n  Number of make threads: 8\n  Configure options:  no-deprecated\n</code></pre></p> <p>\u7ecf\u8fc7\u4e00\u6bb5\u65f6\u95f4\u7684\u7f16\u8bd1\uff0c\u5f97\u5230\u5e93\u6587\u4ef6\u3002\u67e5\u770b\u5b83\u4eec\u652f\u6301\u7684\u67b6\u6784\u60c5\u51b5 <pre><code>OpenSSL-for-iPhone $ xcrun -sdk iphoneos lipo -info ./lib/*.a\nArchitectures in the fat file: ./lib/libcrypto-tvOS.a are: x86_64 arm64 \nArchitectures in the fat file: ./lib/libcrypto.a are: x86_64 arm64 arm64e \nArchitectures in the fat file: ./lib/libssl-tvOS.a are: x86_64 arm64 \nArchitectures in the fat file: ./lib/libssl.a are: x86_64 arm64 arm64e \n</code></pre></p>","tags":["iOS"]},{"location":"ios/lib/a-lib-missing-arch/#_4","title":"\u66ff\u6362","text":"<p>\u7f16\u8bd1\u5f97\u5230\u4e86libcrypto.a\uff0c\u53ef\u4ee5\u628aarm64\u548carm64e\u67b6\u6784\u62c6\u51fa\u6765 <pre><code>lipo -extract arm64 -extract arm64e libcrypto.a -output libcrypto.arm64.a\n</code></pre></p> <p>\u628a\u6700\u540e\u8fd9\u4e2a\u6587\u4ef6\u91cd\u547d\u540d\uff0c\u66ff\u6362\u8fdb\u5de5\u7a0b\u5373\u53ef\u3002</p> <p>\u5de5\u7a0b\u7f16\u8bd1\u5f97\u5230\u7684.a\u5e93\uff0c\u4eceXcode\u70b9\u51fb\u6253\u5f00finder\u6bd4\u8f83\u597d\u627e\uff0c\u4f4d\u7f6e\u6bd4\u5982 <pre><code>/Users/rustfisher/Library/Developer/Xcode/DerivedData/ucstcplib-dsjhrxtmlntksrhhanoqjzbjnrqo/Build/Products/Release-iphoneos/mylib.a\n</code></pre></p>","tags":["iOS"]},{"location":"ios/lib/a-lib-missing-arch/#_5","title":"\u5c0f\u7ed3","text":"<p>\u9047\u5230\u7c7b\u4f3c\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u5148\u4ece\u68c0\u67e5\u5e93\u6587\u4ef6\u652f\u6301\u67b6\u6784\u7684\u60c5\u51b5\u3002\u719f\u7ec3\u638c\u63e1lipo\u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u4ece\u6e90\u5934\u67e5\u51fa\u95ee\u9898\u3002</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample1/","title":"iOS TableView Storyboard\u793a\u4f8b \u663e\u793a\u5217\u8868","text":"\u66f4\u65b0\u65e5\u671f 2022-2-17 <ul> <li>2022-2-17 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883\u4e0e\u5de5\u5177 <ul> <li>Xcode13</li> <li>iOS 14.4</li> <li>Swift</li> </ul>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample1/#_1","title":"\u7b80\u4ecb\u4e0e\u76ee\u7684","text":"<p>\u5217\u8868\u662f\u4e00\u79cd\u5e38\u89c1\u7684\u73b0\u5b9e\u4fe1\u606f\u548c\u6570\u636e\u7684\u65b9\u5f0f\u3002\u6bd4\u5982\u901a\u4fe1\u5f55\uff0c\u6d88\u606f\uff0c\u6587\u7ae0\u76ee\u5f55\u548c\u7b80\u4ecb\u3002\u540c\u4e00\u7c7b\uff08\u6216\u8005\u591a\u7c7b\uff09\u4fe1\u606f\u653e\u5728\u4e00\u4e2a\u5217\u8868\u4e2d\u3002</p> <p>\u672c\u6587\u4ecb\u7ecd\u5728iOS\u5f00\u53d1\u4e2d\uff0c\u5728storyboard\u4e2d\u4f7f\u7528Table View Controller\uff0c\u5b9e\u73b0\u4e00\u4e2a\u5217\u8868\u3002</p> <p>\u4f7f\u7528storyboard\u8fc7\u7a0b\u4e2d\u6709\u5927\u91cf\u7684\u9f20\u6807\u64cd\u4f5c\u3002\u4e0b\u9762\u662f\u64cd\u4f5c\u548c\u4ee3\u7801\u3002</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample1/#table-view-controller","title":"\u6dfb\u52a0Table View Controller","text":"<p>\u65b0\u5efa\u4e00\u4e2astoryboard\u8d77\u540d\u53eb<code>TableViewSample1.storyboard</code></p> <p></p> <p>\u5220\u9664\u81ea\u52a8\u751f\u6210\u7684<code>View Controller Scene</code></p> <p></p> <p>\u5220\u9664\u540e\u5de6\u8fb9\u680f\u663e\u793a<code>No Scenes</code></p> <p>\u6309<code>Library</code>\u6309\u94ae\uff08\u4e5f\u5c31\u662f\u53f3\u4e0a\u65b9\u7684+\u53f7\uff09\uff0c\u8f93\u5165<code>table</code>\u627e\u5230<code>Table View Controller</code></p> <p></p> <p>\u628a\u5b83\u62d6\u5230\u754c\u9762\u7a7a\u767d\u5904\uff0c\u6dfb\u52a0\u6210\u529f</p> <p></p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample1/#_2","title":"\u7f16\u8f91\u5b50\u9879\u6837\u5f0f","text":"<p>\u9009\u4e2d<code>Table View Cell</code>\uff0c\u8c03\u6574\u5b50\u9879\uff08cell\uff09\u7684\u9ad8\u5ea6\uff0c\u4fbf\u4e8e\u540e\u7eed\u8bbe\u8ba1</p> <p></p> <p>\u5148\u6dfb\u52a0\u4e00\u4e2a\u6309\u94ae\u5230\u5b50\u9879\u4e2d</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample1/#cellid","title":"\u8bbe\u7f6ecell\u7684id","text":"<p>\u6307\u5b9aCell\u7684id\uff0c\u8fd9\u91cc\u586b<code>SampleListCell</code>\u3002\u540e\u9762\u5199View Controller\u7684\u65f6\u5019\u4f1a\u7528\u5230\u8fd9\u4e2a\u5b57\u7b26\u4e32\u3002app\u9700\u8981\u6839\u636e\u8fd9\u4e2aid\u6765\u627e\u5230\u5bf9\u5e94\u7684cell\u3002</p> <p></p> <p>\u5982\u679c\u8fd9\u91cc\u5f04\u9519\uff0capp\u8fd0\u884c\u4f1a\u62a5\u9519</p> <pre><code>Terminating app due to uncaught exception 'NSInternalInconsistencyException', \nreason: 'unable to dequeue a cell with identifier sampleDataCell - must register a nib or a class for the identifier or connect a prototype cell in a storyboard'\n</code></pre>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample1/#_3","title":"\u6dfb\u52a0\u6309\u94ae","text":"<p>\u5148\u8bbe\u7f6e\u5b83\u7684\u5927\u5c0f</p> <p></p> <p>\u628a\u5b83\u91cc\u9762\u9ed8\u8ba4\u7684\u6587\u5b57\u5220\u6389\u3002\u7ed9\u5b83\u8bbe\u7f6e\u6837\u5f0f\u3002</p> <ul> <li>Background\u8bbe\u7f6e\u4e3aCustom</li> <li>Corner Radius\u8bbe\u4e3a44</li> <li>Stroke \u9009\u4e2a\u989c\u8272\uff0c\u8fd9\u91cc\u9009\u7684\u662f<code>AccentColor</code></li> </ul> <p></p> <p>\u73b0\u5728\u663e\u793a\u7684\u662f\u4e00\u4e2a\u5706\u5708\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u8bbe\u7f6e\u6309\u94ae\u81ea\u8eab\u7684\u7ea6\u675f\uff0c\u8ba9\u5b83\u80fd\u4fdd\u6301\u8fd9\u4e2a\u6837\u5b50\u3002</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample1/#_4","title":"\u6309\u94ae\u7ea6\u675f","text":"<p>\u7ed9\u6309\u94ae\u6dfb\u52a0\u7ea6\u675f</p> <ul> <li>\u53d6\u6d88<code>Constrain to margins</code></li> <li>\u52fe\u9009<code>Width</code>\uff0c\u8bbe\u7f6e\u4e3a44\uff0c\u5373\u56fa\u5b9a\u5bbd\u5ea6</li> <li>\u52fe\u9009<code>Aspect Ratio</code></li> </ul> <p></p> <p>\u70b9\u51fb\u6dfb\u52a0\u6309\u94ae\uff0c\u89c2\u5bdfButton\u90a3\u4e00\u680f\uff0c\u53ef\u4ee5\u770b\u5230\u6dfb\u52a0\u7684\u7ea6\u675f\u6761\u4ef6</p> <p></p> <p>\u63a5\u4e0b\u6765\u7ed9\u6309\u94ae\u6dfb\u52a0\u7ea6\u675f\uff0c\u5148\u8ba9\u5b83\u7ad6\u76f4\u65b9\u5411\u5c45\u4e2d\u3002</p> <p>\u9009\u4e2d\u8fd9\u4e2a\u6309\u94ae\uff0c\u7136\u540e\u5728\u4e0b\u65b9\u5de5\u5177\u680f\u627e\u5230\u5bf9\u9f50\u9009\u9879\u3002\u52fe\u4e0a<code>Vertically in Container</code>\uff0c\u504f\u79fb\u91cf\u8bbe\u7f6e\u4e3a0\u3002\u70b9\u51fb<code>Add 1 Constraint</code>\u6309\u94ae\u6dfb\u52a0\u8fd9\u4e2a\u7ea6\u675f</p> <p></p> <p>\u89c2\u5bdf\u4fa7\u8fb9\u680f\uff0c\u53ef\u4ee5\u770b\u5230\u6dfb\u52a0\u4e0a\u7684\u7ea6\u675f<code>Button.centerY = centerY</code>\u3002</p> <p></p> <p>\u770b\u5230\u4e0a\u9762\u90a3\u4e2a\u7ea2\u8272\u5c0f\u7bad\u5934\uff0cXcode\u63d0\u793a\u8bf4\u8fd8\u8981\u52a0\u4e00\u4e2ax\u65b9\u5411\u7684\u7ea6\u675f\u3002</p> <p>\u5728\u5de6\u8fb9\u680f\u9f20\u6807\u53f3\u952e\u6309\u4f4f<code>Button</code>\uff0c\u62d6\u52a8\u5230<code>Content View</code>\u4e0a\u9762\u7136\u540e\u653e\u5f00\uff0c\u53ef\u4ee5\u770b\u5230\u5f39\u51fa\u83dc\u5355</p> <p></p> <p>\u5728\u83dc\u5355\u4e2d\u9009\u62e9<code>Leading space to Container</code>\uff0c\u751f\u6210\u4e00\u4e2a\u7ea6\u675f\u3002</p> <p>\u7136\u540e\u53ef\u4ee5\u8bbe\u7f6e\u8ddd\u79bb\u53c2\u6570\uff0c\u5148\u627e\u5230\u8bbe\u7f6e\u6309\u94ae</p> <p></p> <p>\u5728\u5f39\u51fa\u7684\u7a97\u53e3\u4e2d\uff0c\u586b\u5165\u6570\u503c\u3002\u8fd9\u91cc\u7684\u662fStandard\u3002\u8fd9\u91cc\u7684\u6570\u503c\u53ef\u4ee5\u8c03\u6574\u6210\u4f60\u559c\u6b22\u7684\u3002</p> <p></p> <p>\u6b64\u65f6\u7684\u8bbe\u8ba1\u9884\u89c8\u56fe\u5982\u4e0b</p> <p></p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample1/#label","title":"\u6dfb\u52a0Label","text":"<p>\u6dfb\u52a02\u4e2aLabel\u6765\u663e\u793a\u6587\u5b57\u4fe1\u606f</p> <p>\u6dfb\u52a0\u4e00\u4e2aLabel\u663e\u793a\u6807\u9898\u3002\u6309\u524d\u9762\u7684\u65b9\u6cd5\u62d6\u5165\u4e00\u4e2aLabel\uff0c\u7136\u540e\u53ef\u4ee5\u5728\u9884\u89c8\u56fe\u4e2d\u53f3\u952e\u6309\u4f4fLabel\uff0c\u62d6\u52a8\u5230\u6309\u94ae\u8eab\u4e0a\u3002</p> <p></p> <p>\u5728\u83dc\u5355\u4e2d\u9009\u62e9<code>Horizontal Standard Spacing</code>\uff0c\u786e\u5b9a\u5b83\u5230\u6309\u94ae\u7684\u8ddd\u79bb\u3002\u6dfb\u52a0\u540e\u5982\u4e0b\u56fe\u3002</p> <p></p> <p>\u7136\u540e\u6dfb\u52a0\u7ea6\u675f\u786e\u5b9a\u6807\u9898Label\u4e0a\u65b9\uff08top\uff09\u4e0e\u6309\u94ae\u9876\u90e8\u5bf9\u9f50\u3002\u6807\u9898Label\u53f3\u8fb9\uff08trailing\uff09\u548c\u7236view\u8bbe\u7f6e\u8ddd\u79bb\u3002</p> <p></p> <p>\u518d\u6dfb\u52a0\u4e2a\u526f\u6807\u9898label\u3002\u5de6\u8fb9\u680f\u540c\u65f6\u9009\u4e2d\u8fd92\u4e2alabel</p> <p></p> <p>\u7ed9\u5b83\u4eec\u6dfb\u52a0\u4e00\u4e2a\u5de6\u5bf9\u9f50\u7684\u7ea6\u675f\u3002\u52fe\u9009<code>leading Edges</code>\uff0c\u6570\u503c\u4e3a0</p> <p></p> <p>\u7136\u540e\u7ed9\u526f\u6807\u9898label\u6dfb\u52a0\u53f3\u8fb9\uff08\u5c3e\u90e8 trialing\uff09\u7ea6\u675f\u548cx\u65b9\u5411\u7ea6\u675f\u5373\u53ef\u3002\u987a\u4fbf\u628a\u5b57\u4f53\u6539\u5c0f\u4e00\u70b9\u3002</p> <p></p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample1/#_5","title":"\u4ee3\u7801\u63a7\u5236","text":"<p>\u6211\u4eec\u5148\u5047\u8bbe\u4e00\u4e2a\u9700\u8981\u5c55\u793a\u7684\u6570\u636e\u7c7b\u578b</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample1/#_6","title":"\u6570\u636e","text":"<p>\u65b0\u5efa\u4e00\u4e2a<code>SampleEntity.swift</code>\u6765\u4ee3\u8868\u6570\u636e</p> <p><pre><code>import Foundation\n\nstruct SampleEntity {\n    var title: String\n    var desc: String\n    var isComplete: Bool = false\n}\n\nextension SampleEntity {\n    static var testData = [\n        SampleEntity(title: \"iOS\u5165\u95e8\u5f00\u53d11\", desc: \"https://an.rustfisher.com\"),\n        SampleEntity(title: \"iOS\u5165\u95e8\u5f00\u53d12\", desc: \"\u65b0\u624b\u5165\u95e8\u7b2c2\u7ad9\"),\n        SampleEntity(title: \"iOS\u5165\u95e8\u5f00\u53d13\", desc: \"\u65b0\u624b\u5165\u95e8\u7b2c3\u7ad9\"),\n        SampleEntity(title: \"iOS\u5165\u95e8\u5f00\u53d14\", desc: \"\u65b0\u624b\u5165\u95e8\u7b2c4\u7ad9\"),\n        SampleEntity(title: \"Android\", desc: \"https://an.rustfisher.com\"),\n        SampleEntity(title: \"Java\", desc: \"https://an.rustfisher.com\")\n    ]\n}\n</code></pre> \u5728extension\u4e2d\u521b\u5efa\u4e00\u4e9b\u5b9e\u4f8b\u6570\u636e\uff0c\u5c3d\u91cf\u591a\u5199\u4e00\u4e9b\u6570\u636e</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample1/#cell","title":"\u5b50\u9879Cell\u7684\u63a7\u5236","text":"<p>\u65b0\u5efa\u4e00\u4e2a\u7c7b\u7ee7\u627f<code>UITableViewCell</code>\u3002\u65b0\u5efaswift\u6587\u4ef6<code>SampleListCell.swift</code>\uff0c\u91cc\u9762\u5b9a\u4e49\u4e00\u4e2a\u7c7b</p> <pre><code>import UIKit\n\nclass SampleListCell : UITableViewCell {\n\n}\n</code></pre> <p>\u5b50\u9879\u4e2d\u6709\u4e00\u4e2a\u6309\u94ae\uff0c\u7ed9\u5b83\u51c6\u5907\u4e00\u4e2a\u70b9\u51fb\u4e8b\u4ef6</p> <pre><code>import UIKit\n\nclass SampleListCell : UITableViewCell {\n    typealias DoneAction = () -&gt; Void // \u6dfb\u52a0\u8fd9\u91cc\n}\n</code></pre> <p>\u9009\u62e9Tabel View Cell\uff0c\u9009\u62e9\u5b83\u7684\u7c7b\u4e3a\u6211\u4eec\u521b\u5efa\u7684<code>SampleListCell</code></p> <p></p> <p>\u9009\u62e9\u4e86Custom\u7c7b\u4e4b\u540e\uff0c\u63a5\u4e0b\u6765\u9700\u8981\u5728storyboard\u4e0a\u8fdb\u884c\u62d6\u62fd\u64cd\u4f5c\uff0c\u628a\u6309\u94ae\u548c\u6807\u9898\u7684label\u62d6\u8fdb\u6765\u3002</p> <p>\u8fd9\u91cc\u5982\u679c\u53d1\u73b0\u62d6\u8fc7\u53bb\u6ca1\u6709\u6548\u679c\uff0c\u53ef\u4ee5\u91cd\u542f\u4e00\u4e0bXcode\u3002</p> <p>\u5148\u6253\u5f00\u53f3\u4fa7\u4e00\u4e2a\u65b0Editor\uff0c\u5c4f\u5e55\u4e0a\u540c\u65f6\u663e\u793a\u4ee3\u7801\u548cstoryboard</p> <p></p> <p>\u586b\u5165\u53d8\u91cf\u540d\uff0c\u7136\u540e\u70b9\u51fb<code>Connect</code>\u6309\u94ae\uff0c\u5f97\u5230\u53d8\u91cf</p> <p></p> <p>\u7528\u540c\u6837\u7684\u64cd\u4f5c\u65b9\u6cd5\uff0c\u628a2\u4e2alabel\u62d6\u8fc7\u6765</p> <p></p> <p>\u63a5\u4e0b\u6765\u6dfb\u52a0\u4e00\u4e2a\u6309\u94ae\u70b9\u51fb\u4e8b\u4ef6\u7684\u65b9\u6cd5\u3002\u5229\u7528\u5230\u524d\u9762\u8bbe\u5b9a\u597d\u7684<code>DoneAction</code></p> <p><pre><code>// an.rustfisher.com\nclass SampleListCell : UITableViewCell {\n\n    @IBOutlet weak var doneBtn: UIButton!\n\n    @IBOutlet weak var titleLabel: UILabel!\n\n    @IBOutlet weak var subtitleLabel: UILabel!\n\n    typealias DoneAction = () -&gt; Void\n    var doneAction: DoneAction? // \u65b0\u589e\u53d8\u91cf\n\n    @IBAction func onClickDoneBtn(_ sender: UIButton) {\n        doneAction?() // \u6267\u884c\u65b9\u6cd5\n    }\n}\n</code></pre> <code>onClickDoneBtn</code>\u524d\u9762\u4f1a\u51fa\u73b0\u4e00\u4e2a\u5708\u5708\u3002\u9f20\u6807\u5de6\u952e\u6309\u4f4f\u7136\u540e\u62d6\u52a8\u5230Button\u4e0a\uff0c\u5373\u53ef\u5efa\u7acb\u8fde\u63a5\u3002</p> <p></p> <p>\u4e0a\u9762\u662f\u5148\u5199<code>@IBAction</code>\u4ee3\u7801\uff0c\u518d\u62d6\u5230\u9762\u677f\u4e0a\u3002\u53cd\u8fc7\u6765\u64cd\u4f5c\u4e5f\u53ef\u4ee5\u3002</p> <p>\u5230\u6b64\u5b50\u9879\u7684\u63a7\u5236\u5df2\u7ecf\u51c6\u5907\u597d\u4e86\u3002\u6211\u4eec\u6765\u770b\u5217\u8868\u9875\u3002</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample1/#uitableviewcontroller","title":"\u5217\u8868\u9875 UITableViewController","text":"<p>\u65b0\u5efa<code>SampleListVC.swift</code>\u6587\u4ef6\u3002\u65b0\u5efa<code>SampleListVC</code>\u7c7b\u7ee7\u627f<code>UITableViewController</code></p> <pre><code>//\n//  SampleListVC.swift\n//  by RustFisher on 2022/2/16.\n//\n\nimport UIKit\n\nclass SampleListVC: UITableViewController {\n\n}\n</code></pre> <p>\u5c06\u8fd9\u4e2acontroller\u7c7b\u8bbe\u7f6e\u4e3aCustom Class</p> <p></p> <p>Custom Class\u9009\u62e9<code>SampleListVC</code></p> <p></p> <p>\u5148\u66f4\u6539app\u7684\u9ed8\u8ba4storyboard\u3002</p> <p>\u9879\u76ee\u91cc\u6709\u591a\u4e2astoryboard\uff0capp\u5165\u53e3\u662f<code>Main.storyboard</code>\uff0c\u6211\u4eec\u8981\u628a\u5165\u53e3\u6539\u4e3a<code>TableViewSample1.storyboard</code></p> <p>\u5728<code>TableViewSample1.storyboard</code>\u754c\u9762\uff0c\u52fe\u9009<code>Is Initial View Controller</code></p> <p></p> <p>\u7136\u540e\u627e\u5230\u9879\u76ee\u7684<code>Info.plist</code>\uff0c\u4fee\u6539\u914d\u7f6e<code>Storyboard Name</code>\u4e3a<code>TableViewSample1</code></p> <p></p> <p>\u8fd0\u884capp\u53ef\u4ee5\u770b\u5230\u6548\u679c</p> \u8fd0\u884c\u6548\u679c\u56fe-\u7a7a\u767d\u5217\u8868 <p></p> <p>\u7ee7\u7eed\u5904\u7406<code>SampleListVC</code>\uff0c\u8ba9\u5b83\u663e\u793a\u6211\u4eec\u7684\u6a21\u62df\u6570\u636e</p> <p>\u521b\u5efa<code>extension</code>\uff0c\u5b9a\u4e49\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u590d\u5199\u65b9\u6cd5<code>tableView</code>\uff0c\u786e\u5b9a\u6570\u636e\u6570\u91cf <pre><code>extension SampleListVC {\n    static let sampleDataCellId = \"sampleDataCell\"\n\n    override func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int {\n        return SampleEntity.testData.count\n    }\n}\n</code></pre></p> <p>\u590d\u5199\u8fd4\u56de<code>UITableViewCell</code>\u7684<code>tableView</code>\u65b9\u6cd5\u3002\u5728\u91cc\u9762\u63a7\u5236\u5b50\u9879ui\uff0c\u88c5\u8f7d\u6570\u636e\u3002 \u6b64\u65f6\u7684<code>SampleListVC</code>\u4ee3\u7801\u5982\u4e0b</p> \u5c55\u793a\u6570\u636e\u7684SampleListVC <pre><code>import UIKit\n\nclass SampleListVC: UITableViewController {\n\n}\n\nextension SampleListVC {\n    static let sampleDataCellId = \"SampleListCell\"\n\n    override func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int {\n        return SampleEntity.testData.count\n    }\n\n    // \u65b0\u589e\u65b9\u6cd5 \u5904\u7406Cell\n    override func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell {\n        guard let cell = tableView.dequeueReusableCell(withIdentifier: Self.sampleDataCellId, for: indexPath) as? SampleListCell else {\n            fatalError(\"\u627e\u4e0d\u5230SampleListCell\")\n        }\n        let dataEntity = SampleEntity.testData[indexPath.row]\n        let image = dataEntity.isComplete ?\n            UIImage(systemName: \"circle.fill\"):UIImage(systemName: \"circle\")\n        cell.doneBtn.setBackgroundImage(image, for: .normal)\n        cell.titleLabel.text = dataEntity.title\n        cell.subtitleLabel.text = dataEntity.desc\n        // \u51c6\u5907\u5904\u7406\u70b9\u51fb\u4e8b\u4ef6\n        return cell\n    }\n}\n</code></pre> <p>\u8fd0\u884capp</p> \u88c5\u8f7d\u4e86\u6570\u636e\u7684\u5217\u8868\u9875 <p></p> <p>\u73b0\u5728\u6765\u589e\u52a0\u70b9\u51fb\u4e8b\u4ef6\u3002\u7ed9Cell\u7684<code>doneAction</code>\u8d4b\u4e88\u65b9\u6cd5\u3002 <pre><code>cell.doneAction = {\n    SampleEntity.testData[indexPath.row].isComplete.toggle()\n    tableView.reloadRows(at: [indexPath], with: .none)\n}\n</code></pre> \u5c06<code>isComplete</code>\u53d6\u53cd\uff0c\u7136\u540e\u8c03\u7528<code>tableView.reloadRows</code>\u5237\u65b0\u6307\u5b9a\u884c\u3002</p> <p>\u589e\u52a0\u70b9\u51fb\u4e8b\u4ef6\u7684<code>SampleListVC</code>\u4ee3\u7801\u5982\u4e0b <pre><code>import UIKit\n\nclass SampleListVC: UITableViewController {\n\n}\n\nextension SampleListVC {\n    static let sampleDataCellId = \"SampleListCell\"\n\n    override func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int {\n        return SampleEntity.testData.count\n    }\n\n    override func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell {\n        guard let cell = tableView.dequeueReusableCell(withIdentifier: Self.sampleDataCellId, for: indexPath) as? SampleListCell else {\n            fatalError(\"\u627e\u4e0d\u5230SampleListCell\")\n        }\n        let dataEntity = SampleEntity.testData[indexPath.row]\n        let image = dataEntity.isComplete ?\n            UIImage(systemName: \"circle.fill\"):UIImage(systemName: \"circle\")\n        cell.doneBtn.setBackgroundImage(image, for: .normal)\n        cell.titleLabel.text = dataEntity.title\n        cell.subtitleLabel.text = dataEntity.desc\n        cell.doneAction = {\n            SampleEntity.testData[indexPath.row].isComplete.toggle()\n            tableView.reloadRows(at: [indexPath], with: .none)\n        }\n        return cell\n    }\n}\n</code></pre></p> \u8fd0\u884c\u6548\u679c <p></p> <p>\u53ef\u4ee5\u770b\u5230\u6709\u4e2a\u9634\u5f71\u3002\u5176\u5b9e\u90a3\u4e2a\u662f\u9ad8\u4eae\uff08highlight\uff09\u3002\u6a21\u62df\u5668\u4e0a\u65e0\u6cd5\u54cd\u5e94\u70b9\u51fb\u3002\u771f\u673a\u4e0a\u53ef\u4ee5\u3002</p> <p>\u6700\u540e\u8c03\u6574\u4e00\u4e0bui\u7684\u5c3a\u5bf8\uff0c\u589e\u52a0\u4e00\u4e9b\u6d4b\u8bd5\u6570\u636e</p> \u8fd0\u884c\u6548\u679c <p></p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample1/#_7","title":"\u5c0f\u7ed3","text":"<p>\u672c\u6587\u4ecb\u7ecd\u4e86\u5728storyboard\u4e2d\u4f7f\u7528TableView\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684\u5217\u8868\u3002\u7528\u56fe\u5c55\u793a\u4e86\u4e00\u4e9b\u64cd\u4f5c\u3002</p> <p>\u53cd\u590d\u7ec3\u4e60\u57fa\u7840\u6027\u7684\u4e1c\u897f\uff0c\u63d0\u9ad8\u719f\u7ec3\u5ea6\u3002\u4ee5\u540e\u5c31\u4e0d\u4f1a\u5728\u7b80\u5355\u95ee\u9898\u4e0a\u82b1\u8d39\u592a\u591a\u65f6\u95f4\u3002</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample1/#_8","title":"\u53c2\u8003","text":"<ul> <li>Swift\u57fa\u7840 | swiftgg.gitbook</li> </ul> <p>\u4f7f\u7528storyboard\u4e0eTableView\u7684\u4e00\u4e2aToDo\u4f8b\u5b50</p> <ul> <li>1.\u5f00\u59cb\u5728storyboard\u4e2d\u4f7f\u7528TableView</li> <li>2.\u663e\u793a\u6570\u636e\u8be6\u60c5\uff0c\u663e\u793a\u4e00\u4e2a\u5217\u8868</li> <li>3.\u5f15\u5165data source\u6765\u663e\u793a\u5217\u8868</li> <li>4.\u67e5\u770b\u8be6\u60c5\uff0c\u4ece\u5217\u8868\u70b9\u8fdb\u53bb\u67e5\u770b\u67d0\u4e00\u4e2a\u6570\u636e</li> <li>5.\u7f16\u8f91\u6807\u9898\u548c\u4fdd\u5b58</li> </ul>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample2/","title":"iOS TableView Storyboard\u793a\u4f8b \u663e\u793a\u8be6\u60c5","text":"\u66f4\u65b0\u65e5\u671f 2022-2-17 <ul> <li>2022-2-17 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883\u4e0e\u5de5\u5177 <ul> <li>Xcode13</li> <li>iOS 14.4</li> <li>Swift</li> </ul> <p>\u4e66\u63a5\u4e0a\u6587\uff0c\u6211\u4eec\u5df2\u7ecf\u7528Table View\u5c55\u793a\u4e86\u4e00\u4e2a\u5217\u8868\u3002 \u73b0\u5728\u6211\u4eec\u628a\u5176\u4e2d\u7684\u5b50\u9879\u4fe1\u606f\u663e\u793a\u51fa\u6765\u3002\u4e5f\u662f\u7528TableView\u5c55\u793a\u8be6\u7ec6\u4fe1\u606f\u3002</p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u5728\u524d\u9762\u7684\u57fa\u7840\u4e0a\uff0c\u589e\u52a0\u4e00\u4e2a\u663e\u793a\u8be6\u60c5\u7684\u9875\u9762\u3002\u70b9\u51fb\u5217\u8868\u91cc\u7684\u9009\u9879\uff08cell\uff09\uff0c\u6253\u5f00\u4e00\u4e2a\u65b0\u7684\u8be6\u60c5\u9875\u3002</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample2/#sampleentity","title":"\u4fee\u6539\u6570\u636e\u7c7b<code>SampleEntity</code>","text":"<p>\u589e\u52a0\u4e00\u4e2a<code>Date</code>\u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u7528\u6765\u4ee3\u8868\u66f4\u65b0\u65f6\u95f4 <pre><code>import Foundation\n\nstruct SampleEntity {\n    var title: String\n    var desc: String\n    var isComplete: Bool = false\n    var updatedDate: Date // \u6b64\u6b21\u6dfb\u52a0\u7684\u53d8\u91cf\n}\n\nextension SampleEntity {\n    static var testData = [\n        SampleEntity(title: \"iOS\u5165\u95e8\u5f00\u53d12\", desc: \"https://an.rustfisher.com\", updatedDate: Date().addingTimeInterval(800.0)),\n        // \u5176\u4ed6\u7684\u793a\u4f8b\u6570\u636e...\n    ]\n}\n</code></pre></p> <p><code>Date().addingTimeInterval</code>\u7528\u6765\u751f\u6210\u65f6\u95f4</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample2/#tableviewsample1storyboard","title":"\u4fee\u6539<code>TableViewSample1.storyboard</code>","text":"<p>\u539f\u6765\u7684<code>TableViewSample1.storyboard</code>\u91cc\u53ea\u6709\u4e00\u4e2a<code>SampleListVC</code></p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample2/#navigation-controller","title":"Navigation Controller","text":"<p>\u9009\u4e2dScene\uff0c\u7136\u540e\u70b9\u53f3\u4e0b\u89d2\u7684\u6309\u94ae\u300cEmbed in\u300d</p> <p></p> <p>\u5728\u5f39\u51fa\u7a97\u53e3\u4e2d\u9009\u62e9\u300cNavigation Controller\u300d\uff0c\u4f1a\u6dfb\u52a0\u4e00\u4e2aNavigation Controller Theme\uff0c\u5982\u4e0b\u56fe\u6240\u793a</p> <p></p> <p>\u6b64\u65f6\u6211\u4eec\u8fd0\u884c\u4e00\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230\u5217\u8868\u4e0a\u65b9\u591a\u4e86\u4e00\u4e2a\u201c\u5b9e\u5fc3\u201d\u7684\u533a\u57df</p> <p></p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample2/#table-view-controller","title":"\u65b0\u7684Table View Controller","text":"<p>\u6309\u53f3\u4e0a\u89d2\u7684Library\u6309\u94ae\u300c+\u300d\uff0c\u62d6\u4e00\u4e2aTable View Controller\u51fa\u6765\u3002\u7136\u540e\u5c06\u539f\u6765\u7684TableViewCell\uff08\u8fd9\u91cc\u662fSampleListCell\uff09\u94fe\u63a5\u5230\u65b0\u9875\u9762\u4e0a\u3002</p> <p>\u9009\u62e9 Selection Segue - Show\uff0c\u5efa\u7acb\u4e00\u4e2a\u8fde\u63a5</p> <p></p> <p>\u8fde\u63a5\u540e\u5982\u4e0b\u3002\u7bad\u5934\u6307\u7684\u5c31\u662f\u6211\u4eec\u521a\u5efa\u7acb\u7684segue\u8fde\u63a5\u3002</p> <p></p> <p>\u6b64\u65f6\u53ef\u4ee5\u8fd0\u884c\u4e00\u4e0bapp\uff0c\u70b9\u51fb\u9009\u9879\u53ef\u4ee5\u8df3\u8f6c\u53bb\u53e6\u4e00\u4e2a\u9875\u9762\u4e86\u3002\u5f53\u7136\u73b0\u5728\u662f\u6ca1\u6709\u6570\u636e\u7684\u3002 \u6211\u4eec\u63a5\u4e0b\u6765\u5148\u89e3\u51b3\u8be6\u60c5\u9875\u663e\u793a\u6570\u636e\u95ee\u9898\uff0c\u7136\u540e\u5728\u89e3\u51b3\u7684\u4f20\u9001\u6570\u636e\u95ee\u9898\u3002\u70b9\u51fb\u54ea\u4e2a\uff0c\u5c31\u628a\u54ea\u4e2a\u6570\u636e\u4f20\u7ed9\u4e0b\u4e00\u4e2a\u9875\u9762\u3002</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample2/#sampledetailvcswift","title":"<code>SampleDetailVC.swift</code>","text":"<p>\u65b0\u5efa<code>SampleDetailVC.swift</code>\u6587\u4ef6\uff0c\u51c6\u5907\u7528\u5b83\u6765\u63a7\u5236\u521a\u624d\u7684\u9875\u9762\u3002 \u5bfc\u5165UIKit\uff0c\u65b0\u5efa\u7c7b<code>SampleDetailVC</code>\u7ee7\u627f\u81ea<code>UITableViewController</code></p> \u65b0\u5efaSampleDetailVC <pre><code>import UIKit\n\nclass SampleDetailVC: UITableViewController {\n\n}\n</code></pre> <p>\u5728<code>SampleDetailVC</code>\u91cc\u52a0\u4e00\u4e2a<code>DetailRow</code>\u679a\u4e3e\uff08enum\uff09\uff0ccell\u663e\u793a\u4fe1\u606f\u7684\u65f6\u5019\u7528\u5230\u5b83\u3002</p> <pre><code>class SampleDetailVC: UITableViewController {\n    enum DetailRow: Int, CaseIterable { // \u663e\u793a\u65f6\u5019\u7528\u7684\n        case title // \u6807\u9898\n        case desc  // \u6587\u5b57\u63cf\u8ff0\n        case time  // \u65f6\u95f4\n    }\n}\n</code></pre> <p>\u7ed9<code>DetailRow</code>\u6dfb\u52a0\u4e00\u4e9b\u65b9\u6cd5\u3002 <pre><code>func getTxt(for d: SampleEntity?) -&gt; String? {\n    switch self {\n    case .title:\n        return d?.title\n    case .desc:\n        return d?.desc\n    case .time:\n        return d?.updatedDate.description // \u5148\u62ff\u5b57\u7b26\u4e32\u63cf\u8ff0\n    }\n}\n\nvar headImg: UIImage? { // \u8fd9\u91cc\u662fvar\n    switch self {\n    case .title:\n        return nil // \u6807\u9898\u4e0d\u7528\u5c0f\u56fe\u6807\n    case .desc:\n        return UIImage(systemName: \"square.and.pencil\")\n    case .time:\n        return UIImage(systemName: \"clock\")\n    }\n}\n</code></pre></p> <p><code>SampleDetailVC</code>\u6301\u6709\u4e00\u4e2a<code>SampleEntity</code>\u5bf9\u8c61\uff0c\u7528<code>cfg</code>\u65b9\u6cd5\u4ece\u5916\u9762\u4f20\u8fdb\u6765 <pre><code>class SampleDetailVC: UITableViewController {\n    enum DetailRow: Int, CaseIterable { /**/ }\n\n    var detailEntity: SampleEntity?\n    func cfg(with inputEntity: SampleEntity) {\n        self.detailEntity = inputEntity\n    }\n}\n</code></pre> \u73b0\u5728<code>SampleDetailVC</code>\u7c7b\u7684\u4e3b\u4f53\u57fa\u672c\u5b8c\u5de5\uff0c\u6211\u4eec\u6765\u5f04\u6269\u5c55\u90e8\u5206\u3002</p> <p>\u548c\u4e0a\u4e00\u7bc7\uff08\u663e\u793a\u5217\u8868\uff09\u7c7b\u4f3c\uff0c\u8981\u5728TableView\u4e2d\u663e\u793a\u9879\u76ee\uff0c\u9700\u8981\u590d\u5199\u65b9\u6cd5<code>tableView</code></p> <p><pre><code>class SampleDetailVC: UITableViewController { /* ... */ }\n\nextension SampleDetailVC {\n    static let detailCellId = \"DetailCellId\" // \u7b49\u4e0b\u586b\u5230storyboard\u91ccCell\u5bf9\u5e94\u7684\u5730\u65b9\n\n    override func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int {\n        return SampleEntity.testData.count // \u793a\u4f8b\u6570\u636e\u7684\u6570\u91cf\n    }\n\n    override func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell {\n        let cell = tableView.dequeueReusableCell(withIdentifier: Self.detailCellId, for: indexPath)\n        let row = DetailRow(rawValue: indexPath.row)\n        cell.textLabel?.text = row?.getTxt(for: detailEntity) // \u8fd9\u91ccdetail Entity\u5b9a\u4e49\u5728\u4e0a\u9762\u7684\u7c7b\u91cc\n        cell.imageView?.image = row?.headImg\n        return cell\n    }\n}\n</code></pre> \u5c55\u793a\u7684\u4ee3\u7801OK\u4e86\u3002\u628astoryboard\u91cc\u7684\u9875\u9762\u548c<code>SampleDetailVC</code>\u5173\u8054\u8d77\u6765\u3002</p> <p></p> <p>\u6ce8\u610f\u300cTable View Cell\u300d\u7684\u300cStyle\u300d\u8981\u9009<code>basic</code>\u3002\u6211\u4eec\u6ca1\u6709\u81ea\u5b9a\u4e49Cell\uff0c\u7528\u7684\u662f\u81ea\u5e26\u7684\u3002\u8bb0\u5f97id\u8981\u586b\u5bf9\u3002</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample2/#_1","title":"\u4f20\u6570\u636e","text":"<p>\u63a5\u4e0b\u6765\u56de\u5230<code>SampleListVC</code></p> <p>\u8bbe\u5b9aid\uff0c\u7528\u6765\u6807\u8bb0\u8df3\u8f6c</p> <p>\u590d\u5199<code>prepare</code>\u65b9\u6cd5\uff0c\u5982\u679c\u662f\u8981\u53bb\u8be6\u60c5\u9875\u7684\u8df3\u8f6c\uff0c\u628acell\u5bf9\u5e94\u7684\u6570\u636e\u53d6\u51fa\u6765\u4ea4\u7ed9\u76ee\u6807\u9875\u9762<code>SampleDetailVC</code> <pre><code>import UIKit\n\nclass SampleListVC: UITableViewController {\n    static let showDetailSegueId = \"ShowDetailSegueId\" // \u6807\u8bb0\u8df3\u8f6c segue\n\n    override func prepare(for segue: UIStoryboardSegue, sender: Any?) {\n        if segue.identifier == Self.showDetailSegueId,\n           let destination = segue.destination as? SampleDetailVC,\n           let cell = sender as? UITableViewCell,\n           let indexPath = tableView.indexPath(for: cell) {\n            let entity = SampleEntity.testData[indexPath.row] // \u53d6\u51fa\u6570\u636e\n            destination.cfg(with: entity)\n        }\n    }\n}\n</code></pre></p> <p>\u8bbe\u5b9a\u8df3\u8f6c\u7684id </p> <p>\u8fd0\u884c\u8d77\u6765\u5c31\u80fd\u770b\u5230\u6548\u679c\u4e86</p> <p></p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample2/#_2","title":"\u5c0f\u7ed3","text":"<p>\u6211\u4eec\u4f7f\u7528\u4e86basic\u7684Cell\uff0c\u6ca1\u6709\u81ea\u5df1\u8bbe\u8ba1\u5b9e\u73b0\u3002\u8fd9\u4e2a\u793a\u4f8b\u5c55\u793a\u4e86enum\u7684\u4e00\u79cd\u7528\u6cd5\u3002 \u4f7f\u7528Table View Cell\u548c\u8df3\u8f6c\u8fde\u63a5\uff08segue\uff09\u7684\u65f6\u5019\uff0c\u8981\u6ce8\u610f\u8bbe\u7f6eidentifier\u3002</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample2/#_3","title":"\u53c2\u8003","text":"<ul> <li>swift enum</li> <li>TableView Storyboard\u793a\u4f8b \u663e\u793a\u5217\u8868</li> </ul> <p>\u4f7f\u7528storyboard\u4e0eTableView\u7684\u4e00\u4e2aToDo\u4f8b\u5b50</p> <ul> <li>1.\u5f00\u59cb\u5728storyboard\u4e2d\u4f7f\u7528TableView</li> <li>2.\u663e\u793a\u6570\u636e\u8be6\u60c5\uff0c\u663e\u793a\u4e00\u4e2a\u5217\u8868</li> <li>3.\u5f15\u5165data source\u6765\u663e\u793a\u5217\u8868</li> <li>4.\u67e5\u770b\u8be6\u60c5\uff0c\u4ece\u5217\u8868\u70b9\u8fdb\u53bb\u67e5\u770b\u67d0\u4e00\u4e2a\u6570\u636e</li> <li>5.\u7f16\u8f91\u6807\u9898\u548c\u4fdd\u5b58</li> </ul>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample3/","title":"iOS TableView Storyboard\u793a\u4f8b - \u5217\u8868\u9875\u4f7f\u7528UITableViewDataSource","text":"\u66f4\u65b0\u65e5\u671f 2022-2-18 <ul> <li>2022-2-18 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883\u4e0e\u5de5\u5177 <ul> <li>Xcode13</li> <li>iOS 14.4</li> <li>Swift</li> </ul> <p>\u672c\u6587\u5728\u663e\u793a\u5217\u8868\u793a\u4f8b\u57fa\u7840\u4e0a\u8fdb\u884c\u4fee\u6539\u3002\u5f15\u5165<code>UITableViewDataSource</code>\u4f7f\u7528\u3002</p> <p>\u4e3b\u8981\u4fee\u6539\u90fd\u5728\u5217\u8868\u9875\u3002</p> <p>\u4e00\u5171\u6d89\u53ca4\u4e2aswift\u6587\u4ef6:</p> <ul> <li>SampleEntity.swift</li> <li>SampleListCell.swift</li> <li>SampleListDataSource.swift # \u65b0\u6587\u4ef6</li> <li>SampleListVC.swift</li> </ul>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample3/#sampleentity","title":"SampleEntity","text":"<p>\u9996\u5148<code>SampleEntity</code>\u4fdd\u6301\u4e0d\u53d8</p> <pre><code>import Foundation // an.rustfisher.com\n\nstruct SampleEntity {\n    var title: String\n    var desc: String\n    var isComplete: Bool = false\n    var updatedDate: Date\n}\n\nextension SampleEntity {\n    static var testData = [\n        SampleEntity(title: \"iOS\u5165\u95e8\u5f00\u53d13\", desc: \"https://an.rustfisher.com\", updatedDate: Date().addingTimeInterval(800.0)),\n        // \u6d4b\u8bd5\u6570\u636e..\n    ]\n}\n</code></pre>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample3/#samplelistcell","title":"SampleListCell","text":"<p>\u6570\u636e\u7c7b<code>SampleEntity</code>\u6ca1\u6709\u53d8\uff0c\u6211\u4eec\u6539\u53d8\u4e00\u4e0b\u63a7\u5236Cell\u7684UI\u7684<code>SampleListCell</code></p> <pre><code>import UIKit\n\n// an.rustfisher.com\nclass SampleListCell : UITableViewCell {\n\n    @IBOutlet weak var doneBtn: UIButton!\n\n    @IBOutlet weak var titleLabel: UILabel!\n\n    @IBOutlet weak var subtitleLabel: UILabel!\n\n    typealias DoneAction = () -&gt; Void\n\n    private var doneAction: DoneAction? // \u6539\u6210private\n\n    @IBAction func onClickDoneBtn(_ sender: UIButton) {\n        doneAction?()\n    }\n\n    // \u65b0\u589e\u4e00\u4e2a\u65b9\u6cd5\u7528\u6765\u4f20\u9001\u6570\u636e\n    func cfg(title:String, subtitle:String, isDone:Bool, inputDoneBtnAction: @escaping DoneAction) {\n        // \u5728\u91cc\u9762\u63a7\u5236ui\n        titleLabel.text = title\n        subtitleLabel.text = subtitle\n        let image = isDone ? UIImage(systemName: \"circle.fill\") : UIImage(systemName: \"circle\")\n        doneBtn.setBackgroundImage(image, for: .normal)\n        self.doneAction = inputDoneBtnAction\n    }\n}\n</code></pre> <p>\u9996\u5148\u662f\u7ed9<code>doneAction</code>\u52a0\u4e0a<code>private</code>\uff0c\u7f29\u5c0f\u8bbf\u95ee\u8303\u56f4\u3002</p> <p>swift\u4e2d\u53ef\u89c1\u8303\u56f4\uff08\u8bbf\u95ee\u8303\u56f4\uff09\u6709\u5982\u4e0b3\u79cd\uff1a</p> <ul> <li><code>public</code> \u4efb\u4f55\u4f4d\u7f6e\u7684\u4ee3\u7801\u90fd\u53ef\u4ee5\u8bbf\u95ee\uff0c\u975e\u5e38\u5f00\u653e</li> <li><code>internal</code> \uff08\u9ed8\u8ba4\u7684\uff09\u5728\u540c\u4e00\u4e2a\u6a21\u5757\u5185\u7684\u4ee3\u7801\u53ef\u4ee5\u8bbf\u95ee\u3002\u540c\u4e00\u4e2a\u6a21\u5757\u6307\u7684\u662f\u540c\u4e00\u4e2a\u5e94\u7528\u6216\u8005framework\u3002</li> <li><code>private</code> \u672c\u7c7b\u4e2d\u81ea\u5df1\u7684\u4ee3\u7801\uff0c\u6216\u8005\u662fextension\u4e2d\u7684\u4ee3\u7801\u53ef\u4ee5\u8bbf\u95ee\u3002</li> </ul> <p>\u589e\u52a0<code>cfg</code>\u65b9\u6cd5\uff0c\u4ece\u5916\u9762\u4f20\u5165\u8981\u663e\u793a\u7684\u6570\u636e\u3002\u6ce8\u610f\u53c2\u6570\u4e2d\u4e0d\u8981\u5fd8\u8bb0<code>@escaping DoneAction</code>\u3002</p> <p>\u73b0\u5728\u7684<code>SampleListCell</code>\u66f4\u50cf\u4e00\u4e2a\u7eaf\u7cb9\u7684\u7ec4\u4ef6\u3002</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample3/#samplelistdatasource","title":"SampleListDataSource","text":"<p>\u65b0\u5efa<code>SampleListDataSource.swift</code>\uff0c<code>SampleListDataSource</code>\u7c7b\u7ee7\u627f\u81ea<code>NSObject</code>\u3002</p> <p><pre><code>import UIKit\n\nclass SampleListDataSource: NSObject {\n\n}\n\nextension SampleListDataSource: UITableViewDataSource {\n    static let sampleDataCellId = \"SampleListCell\"\n\n    // \u5df2\u7ecf\u5220\u53bb\u8fd9\u91cc\u7684 override\n    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int {\n        return SampleEntity.testData.count\n    }\n\n    // \u5df2\u7ecf\u5220\u53bb\u8fd9\u91cc\u7684 override\n    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell {\n        guard let cell = tableView.dequeueReusableCell(withIdentifier: Self.sampleDataCellId, for: indexPath) as? SampleListCell else {\n            fatalError(\"\u627e\u4e0d\u5230SampleListCell\")\n        }\n        let dataEntity = SampleEntity.testData[indexPath.row]\n        cell.cfg(title: dataEntity.title, subtitle: dataEntity.desc, isDone: dataEntity.isComplete,\n                 inputDoneBtnAction: {\n                    SampleEntity.testData[indexPath.row].isComplete.toggle()\n                    tableView.reloadRows(at: [indexPath], with: .none)\n        })\n        return cell\n    }\n}\n</code></pre> <code>extension SampleListDataSource</code>\u91cc\u9762\u7684\u4ee3\u7801\u662f\u4ece\u539f\u6765\u7684<code>SampleListVC</code>\u91cc\u79fb\u52a8\u8fc7\u6765\u7684\u3002</p> <p>\u8fd9\u4e2a\u7c7b\u7684\u4f5c\u7528\u662f\u63a7\u5236\u8be6\u60c5\u7684\u663e\u793a\u3002</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample3/#samplelistvc","title":"SampleListVC","text":"<p>\u4e0b\u9762\u662f<code>SampleListVC</code> <pre><code>import UIKit\n\nclass SampleListVC: UITableViewController {\n    static let showDetailSegueId = \"ShowDetailSegueId\"\n\n    private var sampleListDataSource: SampleListDataSource? // \u6301\u6709 dataSource\n\n    override func prepare(for segue: UIStoryboardSegue, sender: Any?) {\n        if segue.identifier == Self.showDetailSegueId,\n           let destination = segue.destination as? SampleDetailVC,\n           let cell = sender as? UITableViewCell,\n           let indexPath = tableView.indexPath(for: cell) {\n            let entity = SampleEntity.testData[indexPath.row] // \u53d6\u51fa\u6570\u636e\n            destination.cfg(with: entity)\n        }\n    }\n\n    override func viewDidLoad() {\n        super.viewDidLoad()\n        sampleListDataSource = SampleListDataSource() // \u521d\u59cb\u5316\n        tableView.dataSource = sampleListDataSource // \u4ea4\u7ed9tableView\n    }\n}\n\n// \u628aextension SampleListVC\u7684\u4ee3\u7801\u79fb\u52a8\u53bb\u4e86extension SampleListDataSource\n</code></pre></p> <p>\u6211\u4eec\u628a<code>extension SampleListVC</code>\u7684\u4ee3\u7801\u79fb\u52a8\u53bb\u4e86<code>extension SampleListDataSource</code>\u3002</p> <p><code>SampleListVC</code>\u6301\u6709\u4e00\u4e2a<code>sampleListDataSource</code>\u53d8\u91cf\uff0c\u590d\u5199<code>viewDidLoad()</code>\uff0c\u5728\u9875\u9762\u52a0\u8f7d\u7684\u65f6\u5019\u521b\u5efa\u4e00\u4e2a<code>SampleListDataSource()</code>\uff0c\u5e76\u628a\u5b83\u4ea4\u7ed9<code>tableView</code></p> <p>\u81f3\u6b64\uff0c\u8fd0\u884capp\u8bd5\u4e00\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230\u6548\u679c\u3002</p> <p></p> <p>\u4f7f\u7528storyboard\u4e0eTableView\u7684\u4e00\u4e2aToDo\u4f8b\u5b50</p> <ul> <li>1.\u5f00\u59cb\u5728storyboard\u4e2d\u4f7f\u7528TableView</li> <li>2.\u663e\u793a\u6570\u636e\u8be6\u60c5\uff0c\u663e\u793a\u4e00\u4e2a\u5217\u8868</li> <li>3.\u5f15\u5165data source\u6765\u663e\u793a\u5217\u8868</li> <li>4.\u67e5\u770b\u8be6\u60c5\uff0c\u4ece\u5217\u8868\u70b9\u8fdb\u53bb\u67e5\u770b\u67d0\u4e00\u4e2a\u6570\u636e</li> <li>5.\u7f16\u8f91\u6807\u9898\u548c\u4fdd\u5b58</li> </ul>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample4-ds/","title":"iOS TableView Storyboard\u793a\u4f8b\uff0c\u8be6\u60c5\u9875DataSource","text":"\u66f4\u65b0\u65e5\u671f 2022-2-22 <ul> <li>2022-2-22 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883\u4e0e\u5de5\u5177 <ul> <li>Xcode13</li> <li>iOS 14.4</li> <li>Swift</li> </ul> <p>\u672c\u6587\u5728\u663e\u793a\u8be6\u60c5\u793a\u4f8b\u57fa\u7840\u4e0a\u8fdb\u884c\u4fee\u6539\u3002\u5f15\u5165<code>UITableViewDataSource</code>\u7684\u4f7f\u7528\u3002</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample4-ds/#_1","title":"\u6570\u636e\u7c7b","text":"<p>\u6570\u636e\u7c7b\u8fd8\u662f<code>SampleEntity.swift</code>\u4e0d\u53d8\uff0c\u8be6\u60c5\u9875\u5c31\u662f\u8981\u628a\u5b83\u91cc\u9762\u7684\u4e00\u4e9b\u6570\u636e\u5c55\u793a\u51fa\u6765 <pre><code>// SampleEntity.swift\nimport Foundation\n\nstruct SampleEntity {\n    var title: String\n    var desc: String\n    var isComplete: Bool = false\n    var updatedDate: Date\n}\n\nextension SampleEntity {\n    static var testData = [\n        SampleEntity(title: \"iOS\u5165\u95e8\u5f00\u53d13\", desc: \"https://an.rustfisher.com\", updatedDate: Date().addingTimeInterval(800.0)),\n        // \u5176\u4ed6\u6a21\u62df\u6570\u636e...\n    ]\n}\n</code></pre></p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample4-ds/#uitableviewdatasource","title":"UITableViewDataSource","text":"<p>\u6211\u4eec\u65b0\u5efa\u4e00\u4e2aswift\u6587\u4ef6<code>SampleDetailViewDataSource.swift</code>\u3002\u521b\u5efa<code>SampleDetailViewDataSource</code>\u7c7b\u7ee7\u627f<code>NSObject</code>\u3002</p> <p>\u628a\u524d\u9762\u63a7\u5236ui\u663e\u793a\u7684\u4ee3\u7801\u642c\u8fc7\u6765\u3002\u5148\u628a<code>DetailRow</code>\u642c\u8fdb\u6765\u3002</p> <p><code>SampleDetailViewDataSource</code>\u9700\u8981\u6301\u6709\u4e00\u4e2a<code>SampleEntity</code>\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u5728<code>init</code>\u7684\u65f6\u5019\u4f20\u8fdb\u6765\u3002</p> <p>\u65b0\u5efa<code>extension SampleDetailViewDataSource</code>\u7ee7\u627f<code>UITableViewDataSource</code>\u3002</p> <p>\u524d\u9762<code>SampleDetailVC</code>\u7684<code>tableView</code>\u65b9\u6cd5\u642c\u8fdb<code>extension SampleDetailViewDataSource</code>\u3002\u6ce8\u610f\u5220\u6389<code>override</code>\u3002 <code>tableView</code>\u65b9\u6cd5\u91cc\u9762\u7528\u7684\u662f\u4f20\u8fdb\u6765\u7684<code>SampleEntity</code>\u5bf9\u8c61\u3002</p> <p>\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b <pre><code>// SampleDetailViewDataSource.swift\nimport UIKit\n\n// \u67e5\u770b\u8be6\u60c5\nclass SampleDetailViewDataSource: NSObject {\n    enum DetailRow: Int, CaseIterable { // \u663e\u793a\u65f6\u5019\u7528\u7684\n        case title // \u6807\u9898\n        case desc  // \u6587\u5b57\u63cf\u8ff0\n        case time  // \u65f6\u95f4\n\n        func getTxt(for d: SampleEntity?) -&gt; String? {\n            switch self {\n            case .title:\n                return d?.title\n            case .desc:\n                return d?.desc\n            case .time:\n                return d?.updatedDate.description // \u5148\u62ff\u5b57\u7b26\u4e32\u63cf\u8ff0\n            }\n        }\n\n        var headImg: UIImage? { // \u8fd9\u91cc\u662fvar\n            switch self {\n            case .title:\n                return nil // \u6807\u9898\u4e0d\u7528\u5c0f\u56fe\u6807\n            case .desc:\n                return UIImage(systemName: \"square.and.pencil\")\n            case .time:\n                return UIImage(systemName: \"clock\")\n            }\n        }\n    }\n\n    private var entity: SampleEntity\n\n    init(entity: SampleEntity) {\n        self.entity = entity\n        super.init()\n    }\n}\n\nextension SampleDetailViewDataSource: UITableViewDataSource {\n    static let detailCellId = \"DetailCellId\"\n\n    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int {\n        return SampleEntity.testData.count // \u793a\u4f8b\u6570\u636e\u7684\u6570\u91cf\n    }\n\n    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell {\n        let cell = tableView.dequeueReusableCell(withIdentifier: Self.detailCellId, for: indexPath)\n        let row = DetailRow(rawValue: indexPath.row)\n        cell.textLabel?.text = row?.getTxt(for: entity) // \u8fd9\u91ccdetail Entity\u5b9a\u4e49\u5728\u4e0a\u9762\u7684\u7c7b\u91cc\n        cell.imageView?.image = row?.headImg\n        return cell\n    }\n}\n</code></pre></p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample4-ds/#view-controller","title":"View Controller","text":"<p>\u6539\u9020\u4e00\u4e0b<code>SampleDetailVC</code>\u3002\u6301\u6709\u4e00\u4e2a<code>SampleDetailViewDataSource</code>\u5bf9\u8c61\uff0c\u5728\u9875\u9762\u52a0\u8f7d\u540e\u521b\u5efa\u5bf9\u8c61\uff0c\u5e76\u628a\u81ea\u5df1\u7684<code>SampleEntity</code>\u4f20\u8fdb\u53bb\u3002 <pre><code>// SampleDetailVC.swift\nimport UIKit\n\nclass SampleDetailVC: UITableViewController {\n    var detailEntity: SampleEntity?\n    private var dataSource: SampleDetailViewDataSource?\n\n    func cfg(with inputEntity: SampleEntity) {\n        self.detailEntity = inputEntity\n    }\n\n    override func viewDidLoad() {\n        guard let detailEntity = detailEntity else {\n            print(\"\u6ca1\u6709\u4f20\u5165\u8be6\u60c5\u4fe1\u606f\")\n            return\n        }\n        dataSource = SampleDetailViewDataSource(entity: detailEntity)\n        tableView.dataSource = dataSource\n    }\n}\n</code></pre></p> <p></p> <p>\u4f7f\u7528storyboard\u4e0eTableView\u7684\u4e00\u4e2aToDo\u4f8b\u5b50</p> <ul> <li>1.\u5f00\u59cb\u5728storyboard\u4e2d\u4f7f\u7528TableView</li> <li>2.\u663e\u793a\u6570\u636e\u8be6\u60c5\uff0c\u663e\u793a\u4e00\u4e2a\u5217\u8868</li> <li>3.\u5f15\u5165data source\u6765\u663e\u793a\u5217\u8868</li> <li>4.\u67e5\u770b\u8be6\u60c5\uff0c\u4ece\u5217\u8868\u70b9\u8fdb\u53bb\u67e5\u770b\u67d0\u4e00\u4e2a\u6570\u636e</li> <li>5.\u7f16\u8f91\u6807\u9898\u548c\u4fdd\u5b58</li> </ul>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample5-edit/","title":"iOS TableView Storyboard\u793a\u4f8b\uff0c\u7f16\u8f91\u8be6\u60c5","text":"\u66f4\u65b0\u65e5\u671f 2022-2-24 <ul> <li>2022-2-24 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883\u4e0e\u5de5\u5177 <ul> <li>Xcode13</li> <li>iOS 14.4</li> <li>Swift</li> </ul> <p>\u524d\u9762\u6211\u4eec\u80fd\u591f\u67e5\u770b\u6570\u636e\u5217\u8868\uff0c\u53ef\u4ee5\u70b9\u8fdb\u53bb\u67e5\u770b\u67d0\u4e00\u4e2a\u6570\u636e\u7684\u8be6\u7ec6\u4fe1\u606f\u3002\u73b0\u5728\u6211\u4eec\u6765\u65b0\u589e\u4e00\u4e2a\u529f\u80fd\uff0c\u7f16\u8f91\u67d0\u4e00\u4e2a\u4fe1\u606f\u3002</p> <p>\u6211\u4eec\u7528\u4e00\u4e2aVC\uff08View Controller\uff09\u548c2\u4e2aData Source\u6765\u5b9e\u73b0\u67e5\u770b\u548c\u7f16\u8f91\u8be6\u60c5\u7684\u529f\u80fd\u3002</p> <p>\u672c\u6587\u5728\u663e\u793a\u8be6\u60c5\u793a\u4f8b\u57fa\u7840\u4e0a\u8fdb\u884c\u4fee\u6539\u3002</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample5-edit/#_1","title":"\u6570\u636e\u7c7b","text":"<p>\u6570\u636e\u7c7b\u8fd8\u662f<code>SampleEntity.swift</code>\u4e0d\u53d8\uff0c\u8be6\u60c5\u9875\u5c31\u662f\u8981\u628a\u5b83\u91cc\u9762\u7684\u4e00\u4e9b\u6570\u636e\u5c55\u793a\u51fa\u6765 <pre><code>// SampleEntity.swift\nimport Foundation\n\nstruct SampleEntity {\n    var title: String\n    var desc: String\n    var isComplete: Bool = false\n    var updatedDate: Date\n}\n\nextension SampleEntity {\n    static var testData = [\n        SampleEntity(title: \"iOS\u5165\u95e8\u5f00\u53d13\", desc: \"https://an.rustfisher.com\", updatedDate: Date().addingTimeInterval(800.0)),\n        // \u5176\u4ed6\u6a21\u62df\u6570\u636e...\n    ]\n}\n</code></pre></p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample5-edit/#_2","title":"\u53ef\u7f16\u8f91\u7684\u6807\u9898","text":"<p>\u5148\u6765\u7f16\u8f91\u6807\u9898<code>title</code>\uff0c\u65f6\u95f4<code>updatedDate</code>\u548c\u63cf\u8ff0<code>desc</code>\u653e\u540e\u9762\u5904\u7406\u3002</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample5-edit/#editentitytitlecell","title":"EditEntityTitleCell","text":"<p>\u65b0\u5efa<code>EditEntityTitleCell.swift</code>\u6587\u4ef6\uff0c\u51c6\u5907\u7528\u6765\u63a7\u5236\u7f16\u8f91\u6807\u9898\u7684\u90e8\u5206</p> <pre><code>//EditEntityTitleCell.swift\nimport UIKit\n\nclass EditEntityTitleCell: UITableViewCell {\n    typealias TitleChanged = (String) -&gt; Void\n\n    @IBOutlet var editTitle: UITextField!\n\n    private var titleChanged: TitleChanged?\n\n    func cfg(titleText: String, changed: @escaping TitleChanged) {\n        editTitle.text = titleText\n        self.titleChanged = changed\n    }\n}\n\nextension EditEntityTitleCell: UITextFieldDelegate {\n    // \u76d1\u542c\u6587\u5b57\u8f93\u5165\u53d8\u5316\n    func textField(_ textField: UITextField, shouldChangeCharactersIn range:NSRange, replacementString string:String) -&gt; Bool {\n        if let originText = textField.text {\n            let title = (originText as NSString).replacingCharacters(in: range, with: string)\n            titleChanged?(title)\n        }\n        return true\n    }\n}\n</code></pre> <ul> <li><code>typealias TitleChanged</code> \u7528\u6765\u5411\u5916\u4f20\u9001\u6807\u9898\u5185\u5bb9\u6539\u53d8\u7684\u4e8b\u4ef6</li> <li><code>UITextFieldDelegate</code> \u76d1\u542c\u7528\u6237\u8f93\u5165\u7684\u6587\u5b57</li> <li><code>@IBOutlet var editTitle: UITextField!</code> \u9700\u8981\u8fde\u63a5\u5230storyboard\u4e0a</li> </ul> <p>\u4ece\u4e0a\u9762\u6211\u4eec\u5c31\u5f97\u77e5\uff0c\u9700\u8981TextField\u8fd9\u4e2a\u63a7\u4ef6\u6765\u8ba9\u7528\u6237\u8f93\u5165\u6587\u5b57</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample5-edit/#storyboard","title":"storyboard\u64cd\u4f5c","text":"<p>\u6253\u5f00\u6211\u4eec\u7684<code>TableViewSample1.storyboard</code>\uff0c\u51c6\u5907\u64cd\u4f5c<code>Sample DetailVC Scene</code>\u8fd9\u4e2a\u754c\u9762\u3002</p> <p>1\uff09 \u628aTable View\u7684Prototype Cells\u7684\u6570\u91cf\u6539\u62102\u3002\u8fd9\u4e2a\u540e\u9762\u505a\u5230\u9009\u62e9\u65e5\u671f\u7684\u65f6\u5019\u8fd8\u4f1a\u518d\u6539</p> <p></p> <p>\u4fee\u6539\u540e\uff0c\u754c\u9762\u4e0aprototype\u4f1a\u591a\u51fa\u4e00\u884c\u6765\u3002\u8fd9\u4e00\u884c\u5728\u540e\u9762\u5c31\u662fsection\u3002\u4e00\u4e2asection\u53ef\u4ee5\u4e0d\u53ea\u67091\u884c\u3002</p> <p>2\uff09 \u628a\u5b83\u7684 Identifier \u548c Custom Class \u90fd\u8bbe\u7f6e\u4e3a<code>EditEntityTitleCell</code></p> <p></p> <p></p> <p>3\uff09 \u5728\u65b0\u51fa\u73b0\u7684EditEntityTitleCell\u91cc\u653e\u8fdb\u4e00\u4e2aText Field\uff0c\u5e76\u7ed9\u5b83\u8bbe\u7f6e\u597d\u7ea6\u675f\u6761\u4ef6</p> <p></p> <p>4\uff09 \u628a\u8fd9\u4e2aText Field\u548c<code>EditEntityTitleCell</code>\u91cc\u7684<code>@IBOutlet var editTitle</code>\u8fde\u63a5\u8d77\u6765</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample5-edit/#data-source","title":"\u7f16\u8f91\u7528\u7684 data source","text":"<p>\u65b0\u5efa\u6587\u4ef6<code>SampleDetailEditDS.swift</code>\u7528\u6765\u5904\u7406\u7f16\u8f91\u65f6\u7684\u903b\u8f91\u3002DS\u8868\u793adata source\u3002 <pre><code>// SampleDetailEditDS.swift\nimport UIKit\n\n// \u7f16\u8f91\u8be6\u60c5\nclass SampleDetailEditDS: NSObject {\n    typealias EntityChangeAction = (SampleEntity) -&gt; Void\n\n    private var entity: SampleEntity // \u4ece\u5916\u9762\u4f20\u8fdb\u6765\n    private var entityChangeAction: EntityChangeAction?\n\n    enum EntitySection: Int, CaseIterable {\n        case title\n\n        // \u7f16\u8f91\u65f6\u7684\u5c0f\u6807\u9898\n        var smallTitle: String {\n            switch self {\n            case .title:\n                return \"\u7f16\u8f91\u6807\u9898\"\n            }\n        }\n\n        // \u7ed9storyboard\u91cc\u5224\u65ad\u7528\n        func cellID(for row: Int) -&gt; String {\n            switch self {\n            case .title:\n                return \"EditEntityTitleCell\"\n            }\n        }\n\n        // \u8981\u663e\u793a\u591a\u5c11\u884c\n        var numRows: Int {\n            switch self {\n            case .title: return 1\n            }\n        }\n    }\n\n    init(entity: SampleEntity, changeAction: @escaping EntityChangeAction) {\n        self.entity = entity\n        self.entityChangeAction = changeAction\n    }\n\n    private func dequeueAndCfgCell(for indexPath: IndexPath, from tableView: UITableView) -&gt; UITableViewCell {\n        guard let section = EntitySection(rawValue: indexPath.section) else {\n            print(\"\u51fa\u9519\u4e86\")\n            fatalError(\"\u8be6\u60c5\u9875\u7f16\u8f91\u65f6\u51fa\u9519\")\n        }\n        let sectionId = section.cellID(for: indexPath.row)\n        let cell = tableView.dequeueReusableCell(withIdentifier: sectionId, for: indexPath)\n\n        switch section {\n        case .title:\n            if let titleCell = cell as? EditEntityTitleCell {\n                titleCell.cfg(titleText: entity.title) { title in\n                    self.entity.title = title\n                    self.entityChangeAction?(self.entity)\n                }\n            }\n        }\n        return cell\n    }\n}\n\nextension SampleDetailEditDS: UITableViewDataSource {\n\n    // \u62ff\u5230cell\n    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell {\n        return dequeueAndCfgCell(for: indexPath, from: tableView)\n    }\n\n    // \u603b\u5171\u5c55\u793a\u591a\u5c11\u4e2asection(\u90e8\u5206)\n    func numberOfSections(in tableView: UITableView) -&gt; Int {\n        return EntitySection.allCases.count\n    }\n\n    // \u6bcf\u4e2asection\u6709\u591a\u5c11\u884c\n    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int {\n        return EntitySection(rawValue: section)?.numRows ?? 0\n    }\n\n    // \u5c55\u793a\u5c0f\u6807\u9898\n    func tableView(_ tableView: UITableView, titleForHeaderInSection section: Int) -&gt; String? {\n        return EntitySection(rawValue: section)?.smallTitle ?? \"\"\n    }   \n}\n</code></pre> \u4ece\u5916\u9762\u4f20\u8fdb\u6765\u4e00\u4e2a<code>entity: SampleEntity</code>\uff0c\u8fd9\u662f\u6211\u4eec\u8981\u7f16\u8f91\u7684\u4e3b\u89d2\u3002</p> <p><code>typealias EntityChangeAction</code>\u8d1f\u8d23\u76d1\u542c\uff0c\u6570\u636e\u6539\u53d8\u540e\u901a\u8fc7\u5b83\u4f20\u51fa\u53bb\u3002</p> <p><code>enum EntitySection</code>\u91cc\u76ee\u524d\u53ea\u6709\u4e00\u4e2a<code>title</code>\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u76ee\u524d\u53ea\u4fee\u6539\u6570\u636e\u7684\u6807\u9898\u3002</p> <p>\u770b\u5230<code>extension SampleDetailEditDS</code></p> <p>\u7528<code>numberOfSections</code>\u6765\u63a7\u5236\u8981\u5c55\u793a\u591a\u5c11\u4e2asection\uff08\u90e8\u5206\uff09\u3002\u73b0\u5728\u53ea\u6709<code>title</code>\u8fd9\u4e00\u4e2a\u90e8\u5206\u3002</p> <p>\u53ef\u4ee5\u7528<code>titleForHeaderInSection</code>\u6765\u5c55\u793asection\u7684\u5c0f\u6807\u9898\u3002</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample5-edit/#sampledetailvc","title":"SampleDetailVC \u6539\u9020","text":"<p>\u4fee\u6539<code>SampleDetailVC.swift</code> <pre><code>import UIKit\n\nclass SampleDetailVC: UITableViewController {\n    typealias SampleEntityChangeAction = (SampleEntity) -&gt; Void // \u76d1\u542c\u4fdd\u5b58\n\n    var detailEntity: SampleEntity? // \u4f20\u8fdb\u6765\u7684\u6570\u636e\n    var tmpDetailEntity: SampleEntity? // \u7f16\u8f91\u4e2d\u7684\u6570\u636e\n\n    private var dataSource: UITableViewDataSource?\n    private var entityChangeAction: SampleEntityChangeAction?\n\n    func cfg(with inputEntity: SampleEntity, entityChangeAction: @escaping SampleEntityChangeAction) {\n        self.detailEntity = inputEntity\n        self.entityChangeAction = entityChangeAction\n    }\n\n    override func viewDidLoad() {\n        super.viewDidLoad()\n        setEditing(false, animated: false)\n        navigationItem.setRightBarButton(editButtonItem, animated: false)\n        tableView.register(UITableViewCell.self, forCellReuseIdentifier: \"aa\") // \u6682\u65f6\u7684\u6807\u8bb0aa\n    }\n\n    override func setEditing(_ editing: Bool, animated: Bool) {\n        super.setEditing(editing, animated: animated)\n        guard let detailEntity = detailEntity else {\n            print(\"ERROR\")\n            return\n        }\n        if editing {\n            dataSource = SampleDetailEditDS(entity: detailEntity) {\n                detailEntity in\n                self.tmpDetailEntity = detailEntity\n                self.editButtonItem.isEnabled = true\n            }\n            navigationItem.title = NSLocalizedString(\"\u7f16\u8f91\u8be6\u60c5\", comment: \"\u6807\u9898\")\n            navigationItem.leftBarButtonItem = UIBarButtonItem(barButtonSystemItem: .cancel, target: self, action: #selector(cancelButtonTrigger))\n        } else {\n            if let tmpDetailEntity = tmpDetailEntity { // \u4ece\u7f16\u8f91\u90a3\u4fdd\u5b58\u56de\u6765\u7684\n                self.detailEntity = tmpDetailEntity\n                self.tmpDetailEntity = nil\n                self.entityChangeAction?(tmpDetailEntity) // \u901a\u77e5\u5916\u9762\u6709\u65b0\u4fdd\u5b58\u7684\n                dataSource = SampleDetailViewDataSource(entity: tmpDetailEntity)\n            } else {\n                dataSource = SampleDetailViewDataSource(entity: detailEntity)\n            }\n            navigationItem.title = NSLocalizedString(\"\u67e5\u770b\u8be6\u60c5\", comment: \"\u6807\u9898\")\n            navigationItem.leftBarButtonItem = nil\n            editButtonItem.isEnabled = true\n        }\n        tableView.dataSource = dataSource\n        tableView.reloadData()\n    }\n\n    @objc // \u548c\u524d\u9762\u7684#selector\u5bf9\u5e94\n    func cancelButtonTrigger() {\n        self.tmpDetailEntity = nil\n        setEditing(false, animated: true)\n    }\n}\n</code></pre></p> <p><code>typealias SampleEntityChangeAction</code>\u662f\u4fee\u6539\u4fdd\u5b58\u540e\u7684\u76d1\u542c</p> <p><code>tmpDetailEntity</code>\u662f\u7f16\u8f91\u4e2d\u7684\u6570\u636e</p> <p>\u754c\u9762\u52a0\u8f7d\u7684\u65f6\u5019\uff0c<code>setEditing(false, animated: false)</code>\u8bbe\u5b9a\u4e3a\u4e0d\u7f16\u8f91\uff0c\u4e5f\u5c31\u662f\u67e5\u770b\u6a21\u5f0f</p> <p>\u5728<code>setEditing</code>\u65b9\u6cd5\u91cc\uff0c\u5982\u679c\u662f\u5728\u7f16\u8f91\u72b6\u6001\uff0c\u5219\u4f7f\u7528<code>SampleDetailEditDS</code></p> <p>\u53d6\u6d88\u7f16\u8f91\u7684\u65f6\u5019<code>cancelButtonTrigger</code>\uff0c\u8bbe\u7f6e\u4e34\u65f6\u6570\u636e\u4e3a\u7a7a<code>self.tmpDetailEntity = nil</code>\uff0c\u4e5f\u5c31\u662f\u820d\u5f03\u4e34\u65f6\u6570\u636e\u56de\u5230\u67e5\u770b\u72b6\u6001</p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample5-edit/#samplelistdatasource","title":"SampleListDataSource","text":"<p>\u65b0\u589e\u4e00\u4e2a<code>update</code>\u65b9\u6cd5\uff0c\u7528\u6765\u66f4\u65b0\u6570\u636e\u3002\u8fd9\u91cc\u7684\u6570\u636e\u8fd8\u662f\u6682\u5b58\u5728<code>testData</code>\u91cc\u3002 <pre><code>import UIKit\n\nclass SampleListDataSource: NSObject {\n    // \u66f4\u65b0\u67d0\u4e00\u4e2a\u6570\u636e\n    func update(_ entity: SampleEntity, at row: Int) {\n        SampleEntity.testData[row] = entity\n    }\n}\n\nextension SampleListDataSource: UITableViewDataSource {\n    static let sampleDataCellId = \"SampleListCell\"\n\n    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int {\n        return SampleEntity.testData.count\n    }\n\n    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell {\n        guard let cell = tableView.dequeueReusableCell(withIdentifier: Self.sampleDataCellId, for: indexPath) as? SampleListCell else {\n            fatalError(\"\u627e\u4e0d\u5230SampleListCell\")\n        }\n        let dataEntity = SampleEntity.testData[indexPath.row]\n        cell.cfg(title: dataEntity.title, subtitle: dataEntity.desc, isDone: dataEntity.isComplete,\n                 inputDoneBtnAction: {\n                    SampleEntity.testData[indexPath.row].isComplete.toggle()\n                    tableView.reloadRows(at: [indexPath], with: .none)\n        })\n        return cell\n    }\n}\n</code></pre></p>","tags":["iOS"]},{"location":"ios/uikit/tableview/table-view-storyboard-sample5-edit/#samplelistvc","title":"SampleListVC","text":"<p>\u4fee\u6539\u540e\u7684\u6570\u636e\u8c03\u7528<code>sampleListDataSource?.update</code>\u8fdb\u884c\u66f4\u65b0 <pre><code>import UIKit\n\nclass SampleListVC: UITableViewController {\n    static let showDetailSegueId = \"ShowDetailSegueId\"\n\n    private var sampleListDataSource: SampleListDataSource? // \u6301\u6709 dataSource\n\n    override func prepare(for segue: UIStoryboardSegue, sender: Any?) {\n        if segue.identifier == Self.showDetailSegueId,\n           let destination = segue.destination as? SampleDetailVC,\n           let cell = sender as? UITableViewCell,\n           let indexPath = tableView.indexPath(for: cell) {\n            let entity = SampleEntity.testData[indexPath.row] // \u53d6\u51fa\u6570\u636e\n            destination.cfg(with: entity) { entity in\n                // \u8be6\u60c5\u88ab\u4fee\u6539\u4e86 \u8981\u66f4\u65b0\u4e00\u4e0b\u5217\u8868\n                self.sampleListDataSource?.update(entity, at: indexPath.row)\n                self.tableView.reloadRows(at: [indexPath], with: .automatic)\n            }\n        }\n    }\n\n    override func viewDidLoad() {\n        super.viewDidLoad()\n        sampleListDataSource = SampleListDataSource() // \u521d\u59cb\u5316\n        tableView.dataSource = sampleListDataSource // \u4ea4\u7ed9tableView\n    }\n}\n</code></pre> \u66f4\u65b0\u540e\u8bb0\u5f97<code>reloadRows</code></p> <p>\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u4fee\u6539<code>SampleEntity</code>\u7684<code>title</code>\u8fd9\u4e2a\u53d8\u91cf\u4e86\u3002</p> <p> </p> <p>\u540e\u9762\u8981\u4fee\u6539\u65f6\u95f4\u548c\u5907\u6ce8\uff0c\u4e5f\u662f\u7528\u7c7b\u4f3c\u7684\u65b9\u6cd5\u3002\u65b0\u5efacell\u6765\u63a7\u5236\u5e76\u628a\u6570\u636e\u4f20\u9001\u56de\u53bb\u3002</p> <p></p> <p>\u4f7f\u7528storyboard\u4e0eTableView\u7684\u4e00\u4e2aToDo\u4f8b\u5b50</p> <ul> <li>1.\u5f00\u59cb\u5728storyboard\u4e2d\u4f7f\u7528TableView</li> <li>2.\u663e\u793a\u6570\u636e\u8be6\u60c5\uff0c\u663e\u793a\u4e00\u4e2a\u5217\u8868</li> <li>3.\u5f15\u5165data source\u6765\u663e\u793a\u5217\u8868</li> <li>4.\u67e5\u770b\u8be6\u60c5\uff0c\u4ece\u5217\u8868\u70b9\u8fdb\u53bb\u67e5\u770b\u67d0\u4e00\u4e2a\u6570\u636e</li> <li>5.\u7f16\u8f91\u6807\u9898\u548c\u4fdd\u5b58</li> </ul>","tags":["iOS"]},{"location":"ios/uikit/tableview/case/table-view-and-other-cell/","title":"iOS \u6dfb\u52a0TableView\u5230\u9875\u9762\u4e2d\uff0c\u4f7f\u7528storyboard\u81ea\u5b9a\u4e49cell","text":"\u66f4\u65b0\u65e5\u671f 2022-3-4 <ul> <li>2022-3-4 \u66f4\u65b0\u56fe\u7247</li> <li>2022-3-3 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883\u4e0e\u5de5\u5177 <ul> <li>Xcode13</li> <li>iOS 14.4</li> <li>OC</li> </ul> <p>\u524d\u9762\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528TableView\u7b80\u5355\u5730\u663e\u793a\u4e00\u5217\u6570\u636e\u3002 \u73b0\u5728\u6211\u4eec\u81ea\u5b9a\u4e49cell\uff0c\u628a\u5217\u8868\u6539\u9020\u6210\u6211\u4eec\u60f3\u8981\u7684\u6837\u5b50\u3002</p> \u6700\u540e\u6548\u679c\u56fe <p></p>"},{"location":"ios/uikit/tableview/case/table-view-and-other-cell/#storyboard","title":"storyboard","text":"<p>\u5728storyboard\u4e2d\u64cd\u4f5cTable View\u3002\u628a\u5b83\u7684Prototype Cells\u6539\u62101\uff08\u4e4b\u524d\u662f0\uff09\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\u9875\u9762\u4e0a\u51fa\u73b0\u4e86\u4e00\u4e2a\u65b0\u7684Cell\u3002\u5f85\u4f1a\u6211\u4eec\u5728\u5b83\u4e0a\u9762\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>\u62d6\u8fdb\u53bb2\u4e2alabel\uff0c\u4e00\u4e2aimage\uff0c\u8fd8\u67093\u4e2abutton\u3002\u7ed9\u5de5\u7a0b\u6dfb\u52a0\u4e00\u4e9b\u56fe\u7247\uff08\u53ef\u81ea\u5df1\u9009\u62e9\uff09\u3002</p> <p></p> <p>\u4f7f\u7528Button\u7684\u65f6\u5019\uff0cImage\u9009\u62e9\u4e86\u56fe\u7247\u540e\uff0c\u8981\u6ce8\u610f\u5b83\u7684View - Tint\u4f1a\u6539\u53d8\u6700\u540e\u663e\u793a\u7684\u989c\u8272\u3002 \u8fd9\u91cc\u4e0d\u60f3\u8ba9button\u663e\u793a\u6587\u5b57\uff0c\u53ea\u663e\u793a\u56fe\u7247\u3002button\u53ef\u4ee5\u8bbe\u8ba1\u6210\u4f60\u60f3\u8981\u7684\u6837\u5f0f\u3002</p> <p>\u8fd9\u91cc\u7701\u7565\u8bbe\u7f6e\u7ea6\u675f\u7684\u8fc7\u7a0b\u3002</p>"},{"location":"ios/uikit/tableview/case/table-view-and-other-cell/#data1cell","title":"Data1Cell","text":"<p>\u65b0\u5efaOC\u6587\u4ef6Data1Cell.h\u548cData1Cell.m\uff0c\u8fd9\u662fCell\u7684\u63a7\u5236\u7c7b\uff0c\u7ee7\u627f<code>UITableViewCell</code>\u3002</p> <p>Data1Cell.m\u6587\u4ef6\u91cc\u4e0d\u9700\u8981\u4ec0\u4e48\u64cd\u4f5c <pre><code>// Data1Cell.m\n#import \"Data1Cell.h\"\n\n@implementation Data1Cell\n\n@end\n</code></pre></p> <p>Data1Cell.h\u91cc\u9700\u8981\u6709\u5bf9\u754c\u9762\u5143\u7d20\u7684\u5f15\u7528 <pre><code>// Data1Cell.h\n#import &lt;UIKit/UIKit.h&gt;\n\nNS_ASSUME_NONNULL_BEGIN\n\n@interface Data1Cell : UITableViewCell\n\n@property (weak, nonatomic) IBOutlet UIImageView *iv;\n@property (weak, nonatomic) IBOutlet UILabel *titleLb;\n@property (weak, nonatomic) IBOutlet UIButton *btn1;\n@property (weak, nonatomic) IBOutlet UIButton *btn2;\n@property (weak, nonatomic) IBOutlet UIButton *btn3;\n\n@end\n\nNS_ASSUME_NONNULL_END\n</code></pre> \u628astoryboard\u91ccCell\u7684Custom Class\u6539\u6210<code>Data1Cell</code>\uff0cTable View Cell\u7684Identifier\u4e5f\u6539\u4e3a<code>Data1Cell</code>\u3002</p> <p></p> <p>\u8fd9\u4e9b<code>IBOutlet</code>\u53ef\u4ee5\u662f\u4ecestoryboard\u91cc\u62d6\u8fc7\u6765\u7684\u3002\u4e5f\u53ef\u4ee5\u5148\u5199\u597d\uff0c\u7136\u540e\u518d\u8fde\u8d77\u6765\u3002</p>"},{"location":"ios/uikit/tableview/case/table-view-and-other-cell/#gopage2vc","title":"GoPage2VC","text":"<p>\u5728GoPage2VC.m\u4e2d\u4f7f\u7528\u5b9a\u4e49\u597d\u7684<code>GoPage2VC</code>\u3002</p> <p>\u4e0b\u9762\u662fGoPage2VC.m\u5b8c\u6574\u4ee3\u7801 <pre><code>#import \"GoPage2VC.h\"\n#import \"Data1Cell.h\"\n\nstatic NSString *DataCellID = @\"Data1Cell\";\n\n@implementation GoPage2VC: UIViewController\n\n@synthesize list = _list;\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n    self.timeLb.text = [NSString stringWithFormat:@\"\u6253\u5f00\u65f6\u95f4: %@\",[self getCurrentTime]];\n\n    NSArray* dataArr = [[NSArray alloc] initWithObjects:@\"an.rustfisher.com\",\n                        @\"RustFisher\", @\"AnRFDev\", @\"iOS\", @\"iOS\u5165\u95e8\u5b66\u4e60\", @\"rustfisher.com\",\n                        @\"Java\", @\"\u601d\u60f3\", @\"\u8bbe\u8ba1\u6a21\u5f0f\", @\"Python\u5165\u95e8\u5b66\u4e60\", @\"\u5de5\u7a0b\",\n                        @\"\u4e00\u53f7\", @\"\u4e8c\u53f7\", @\"\u4e09\u53f7\", @\"iOS\u5165\u95e8\u5b66\u4e60\", @\"rustfisher.com\",\n                        @\"Swift\", nil];\n    self.list = dataArr;\n}\n\n- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {\n    return self.list.count;\n}\n\n// \u5904\u7406cell\n- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {\n    Data1Cell* cell = [tableView dequeueReusableCellWithIdentifier:DataCellID];\n    if(cell == nil) {\n        cell = [[Data1Cell alloc] init];\n    }\n    NSString *data = [self.list objectAtIndex:indexPath.row];\n    cell.titleLb.text = data;\n    cell.btn1.titleLabel.text = nil;\n    cell.btn2.titleLabel.text = nil;\n    cell.btn3.titleLabel.text = nil;\n\n    if (indexPath.row % 2 == 0) {\n        cell.iv.image = [UIImage imageNamed:@\"itemIv1\"];\n    } else {\n        cell.iv.image = [UIImage imageNamed:@\"itemIv2\"];\n    }\n    [cell.btn1 addTarget:self action:@selector(clickBtn1:) forControlEvents:UIControlEventTouchUpInside];\n    [cell.btn2 addTarget:self action:@selector(clickBtn2:) forControlEvents:UIControlEventTouchUpInside];\n    [cell.btn3 addTarget:self action:@selector(clickBtn3:) forControlEvents:UIControlEventTouchUpInside];\n    cell.btn1.tag = indexPath.row;\n    cell.btn2.tag = indexPath.row;\n    cell.btn3.tag = indexPath.row;\n    return cell;\n}\n\n- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {\n    NSString *rowString = [self.list objectAtIndex:[indexPath row]];\n    UIAlertController* alert = [UIAlertController alertControllerWithTitle:@\"\u70b9\u51fb\u4e86\"\n                                   message:rowString\n                                   preferredStyle:UIAlertControllerStyleAlert];\n    [alert addAction:[UIAlertAction actionWithTitle:@\"\u786e\u5b9a\" style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) {\n        NSLog(@\"\u9ed8\u8ba4\u64cd\u4f5c\");\n    }]];\n    [self presentViewController:alert animated:YES completion:nil];\n}\n\n-(NSString*)getCurrentTime {\n    NSDateFormatter *formatter = [[NSDateFormatter alloc] init];\n    [formatter setDateFormat:@\"YYYY-MM-dd HH:mm:ss\"];\n    NSDate *datenow = [NSDate date];\n    NSString *currentTimeString = [formatter stringFromDate:datenow];\n    return currentTimeString;\n}\n\n-(void)clickBtn1:(UIButton *)btn {\n    NSString* show = [NSString stringWithFormat:@\"%@\",[self.list objectAtIndex:btn.tag]];\n    [self popDialog:@\"\u70b9\u51fb\u4e86\u6309\u94ae1\" content:show];\n}\n\n-(void)clickBtn2:(UIButton *)btn {\n    NSString* show = [NSString stringWithFormat:@\"%@\",[self.list objectAtIndex:btn.tag]];\n    [self popDialog:@\"\u70b9\u51fb\u4e86\u6309\u94ae2\" content:show];\n}\n\n-(void)clickBtn3:(UIButton *)btn {\n    NSString* show = [NSString stringWithFormat:@\"%@\",[self.list objectAtIndex:btn.tag]];\n    [self popDialog:@\"\u70b9\u51fb\u4e86\u6309\u94ae3\" content:show];\n}\n\n-(void)popDialog:(NSString*) title content:(NSString*) str {\n    UIAlertController* alert = [UIAlertController alertControllerWithTitle:title\n                                   message:str\n                                   preferredStyle:UIAlertControllerStyleAlert];\n    [alert addAction:[UIAlertAction actionWithTitle:@\"\u786e\u5b9a\" style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) {\n        NSLog(@\"ok\");\n    }]];\n    [self presentViewController:alert animated:YES completion:nil];\n}\n@end\n</code></pre> \u6d4b\u8bd5\u6570\u636e\u8fd8\u662f\u653e\u5728<code>list</code>\u91cc\u9762\u3002<code>numberOfRowsInSection</code>\u8fd4\u56de\u7684\u662f<code>list</code>\u7684\u6570\u636e\u4e2a\u6570\u3002</p> <p>\u8ba9\u6309\u94ae\u4e0d\u663e\u793a\u6587\u5b57 <code>cell.btn1.titleLabel.text = nil;</code>\u3002</p>"},{"location":"ios/uikit/tableview/case/table-view-and-other-cell/#cellforrowatindexpath","title":"cellForRowAtIndexPath","text":"<p>\u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u5904\u7406Cell\u3002\u6211\u4eec\u4f7f\u7528\u7684\u4e0d\u518d\u662f\u9ed8\u8ba4\u6837\u5f0f\uff0c\u800c\u662f<code>Data1Cell</code>\u3002</p> <p>\u8bbe\u7f6ecell\u663e\u793a\u7684\u6587\u5b57\u548c\u56fe\u7247\u3002\u8bbe\u7f6e\u6309\u94ae\u7684\u70b9\u51fb\u4e8b\u4ef6\u548c\u4f20\u5165\u6570\u503c\u3002</p>"},{"location":"ios/uikit/tableview/case/table-view-and-other-cell/#button","title":"button\u70b9\u51fb\u4e8b\u4ef6","text":"<p>button\u7684\u70b9\u51fb\u4e8b\u4ef6\u4f7f\u7528<code>addTarget</code>\u65b9\u6cd5\u3002\u4e3a\u4e86\u533a\u5206\u70b9\u51fb\u5230\u54ea\u4e2a\u6570\u636e\uff0c\u628a\u89e6\u53d1\u7684\u884c\u4f20\u7ed9\u6309\u94ae\u7684<code>tag</code>\u4f5c\u4e3a\u6807\u8bb0\u3002 <pre><code>[cell.btn1 addTarget:self action:@selector(clickBtn1:) forControlEvents:UIControlEventTouchUpInside];\ncell.btn1.tag = indexPath.row;\n</code></pre></p> <p>\u8fd9\u6837\u5728\u63a5\u6536\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5224\u65ad\u51fa\u662f\u54ea\u4e00\u884c\u7684\u54ea\u4e00\u4e2a\u6309\u94ae\u88ab\u70b9\u51fb\u4e86\u3002 <pre><code>-(void)clickBtn1:(UIButton *)btn {\n    NSString* show = [NSString stringWithFormat:@\"%@\",[self.list objectAtIndex:btn.tag]];\n    [self popDialog:@\"\u70b9\u51fb\u4e86\u6309\u94ae1\" content:show];\n}\n</code></pre></p> <p><code>popDialog</code>\u65b9\u6cd5\u7528\u6765\u5f39\u7a97\uff0c\u8c03\u8bd5\u65f6\u5019\u66f4\u76f4\u89c2\u4e00\u4e9b\u3002</p> <p>\u8fd93\u4e2a\u6309\u94ae\u7684\u70b9\u51fb\u4e8b\u4ef6\u548cCell\u672c\u4f53\u7684\u70b9\u51fb\u4e8b\u4ef6\u662f\u5206\u5f00\u7684\u3002\u70b9\u51fb\u6309\u94ae\u4f1a\u5f39\u51fa\u6309\u94ae\u7684\u5f39\u7a97\uff0c\u70b9cell\u672c\u4f53\u5219\u5f39\u51fa\u4e4b\u524d\u7684\u7a97\u53e3\u3002</p> <p>\u8fd0\u884c\u5230iPhone\u4e0a\uff0c\u53ef\u4ee5\u770b\u5230\u6700\u540e\u6548\u679c</p> \u8fd0\u884c\u6548\u679c <p> </p>"},{"location":"ios/uikit/tableview/case/table-view-and-other-cell/#_1","title":"\u53c2\u8003","text":"<ul> <li>iOS \u6dfb\u52a0TableView\u5230\u9875\u9762\u4e2d\uff0c\u4f7f\u7528storyboard</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a</p>"},{"location":"ios/uikit/tableview/case/table-view-and-other/","title":"iOS \u6dfb\u52a0TableView\u5230\u9875\u9762\u4e2d\uff0c\u4f7f\u7528storyboard","text":"\u66f4\u65b0\u65e5\u671f 2022-3-3 <ul> <li>2022-3-2 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883\u4e0e\u5de5\u5177 <ul> <li>Xcode13</li> <li>iOS 14.4</li> <li>OC</li> </ul> <p>\u60f3\u5728\u4e00\u4e2a\u9875\u9762\u4e0b\u65b9\u663e\u793a\u5217\u8868\uff0c\u4e0a\u9762\u663e\u793a\u5176\u4ed6\u4e1c\u897f\u3002storyboard\u4e2d\u5df2\u7ecf\u6709\u4e00\u4e2aVC\u4e86\u3002\u6574\u4e2a\u9875\u9762\u4e00\u5f00\u59cb\u5e76\u4e0d\u662fTable View Controller\u3002 \u6211\u4eec\u9700\u8981\u6dfb\u52a0\u4e00\u4e2aTable View\u5230\u60f3\u8981\u7684\u5730\u65b9\u3002</p>"},{"location":"ios/uikit/tableview/case/table-view-and-other/#_1","title":"\u7b80\u5355\u98ce\u683c\u5217\u8868","text":"<p>\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u98ce\u683c\u7684\u5217\u8868\uff0c\u663e\u793a\u4e00\u884c\u6587\u5b57\u3002</p> <p>\u5148\u6765\u770bOC\u4ee3\u7801\u90e8\u5206</p>"},{"location":"ios/uikit/tableview/case/table-view-and-other/#gopage2vc","title":"GoPage2VC","text":"<p>\u6211\u4eec\u65b0\u5efa<code>GoPage2VC</code>\u6765\u63a7\u5236\u754c\u9762\u3002</p>"},{"location":"ios/uikit/tableview/case/table-view-and-other/#_2","title":"\u5934\u6587\u4ef6","text":"<p>\u65b0\u5efaOC\u6587\u4ef6\uff0c\u5934\u6587\u4ef6<code>GoPage2VC.h</code>\u4ee3\u7801\u5982\u4e0b <pre><code>// GoPage2VC.h\n#import &lt;UIKit/UIKit.h&gt;\n\nNS_ASSUME_NONNULL_BEGIN\n\n@interface GoPage2VC: UIViewController&lt;UITableViewDelegate, UITableViewDataSource&gt;\n\n@property (weak, nonatomic) IBOutlet UILabel *timeLb;\n\n@property (strong, nonatomic) NSArray *list;\n\n@end\n\nNS_ASSUME_NONNULL_END\n</code></pre> <code>GoPage2VC</code>\u7ee7\u627f<code>UIViewController</code>\uff0c\u5e76\u4e14\u9700\u8981<code>UITableViewDataSource</code>\u3002</p> <p><code>timeLb</code>\u7528\u6765\u663e\u793a\u81ea\u5b9a\u4e49\u6587\u5b57\u3002</p> <p><code>NSArray *list</code>\u88c5\u7740\u6211\u4eec\u8981\u663e\u793a\u7684\u6570\u636e\u3002</p>"},{"location":"ios/uikit/tableview/case/table-view-and-other/#m","title":"m\u6587\u4ef6","text":"<p><code>GoPage2VC.m</code>\u5b9e\u73b0\u529f\u80fd <pre><code>// GoPage2VC.m\n#import \"GoPage2VC.h\"\nstatic NSString *DataCellID = @\"dataCellID\"; // \u7ed9cell\u7528\u7684\n\n@implementation GoPage2VC: UIViewController\n\n@synthesize list = _list;\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n    self.timeLb.text = [NSString stringWithFormat:@\"\u6253\u5f00\u65f6\u95f4: %@\",[self getCurrentTime]];\n\n    NSArray* dataArr = [[NSArray alloc] initWithObjects:@\"an.rustfisher.com\",\n                        @\"RustFisher\", @\"AnRFDev\", @\"iOS\", @\"iOS\u5165\u95e8\u5b66\u4e60\", @\"rustfisher.com\",\n                        @\"Swift\", nil];\n    self.list = dataArr;\n}\n\n- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {\n    return self.list.count;\n}\n\n// \u5904\u7406cell\n- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {\n    UITableViewCell* cell = [tableView dequeueReusableCellWithIdentifier:DataCellID];\n    if(cell == nil) {\n        cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:DataCellID];\n    }\n    cell.textLabel.text = [self.list objectAtIndex:indexPath.row];\n    return cell;\n}\n\n-(NSString*)getCurrentTime {\n    NSDateFormatter *formatter = [[NSDateFormatter alloc] init];\n    [formatter setDateFormat:@\"YYYY-MM-dd HH:mm:ss\"];\n    NSDate *datenow = [NSDate date];\n    NSString *currentTimeString = [formatter stringFromDate:datenow];\n    return currentTimeString;\n}\n\n@end\n</code></pre> \u5148\u81ea\u5b9a\u4e00\u4e2a\u53d8\u91cf<code>@synthesize list = _list;</code>\u6307\u5411\u6211\u4eec\u7684\u6570\u636e\u3002</p> <p>\u5728<code>viewDidLoad</code>\u4e2d\u6211\u4eec\u653e\u5165\u6d4b\u8bd5\u6570\u636e\u3002</p> <p>\u5217\u8868\u76f8\u5173\uff1a</p> <ul> <li><code>numberOfRowsInSection</code>\u65b9\u6cd5\u4e2d\u6307\u5b9a\u4e86\u6570\u636e\u7684\u6570\u91cf</li> <li><code>cellForRowAtIndexPath</code>\u65b9\u6cd5\u91cc\u91cd\u7528\u6216\u8005\u65b0\u5efa\u4e00\u4e2acell\u3002<ul> <li>\u8fd9\u91cc\u7528\u7684\u662f\u9ed8\u8ba4\u7684\u6837\u5f0f<code>UITableViewCellStyleDefault</code>\uff0c\u5b83\u5e26\u6709\u4e00\u4e2a<code>textLabel</code></li> <li>\u628a\u5bf9\u5e94\u7684\u6570\u636e\u4ea4\u7ed9cell\u5373\u53ef</li> </ul> </li> </ul>"},{"location":"ios/uikit/tableview/case/table-view-and-other/#mainstoryboard","title":"Main.storyboard","text":"<p>\u63a5\u4e0b\u6765\u64cd\u4f5cstoryboard\u3002Main.storyboard\u91cc\u6709\u4e00\u4e2a\u754c\u9762\uff08scene\uff09\u3002\u9700\u8981\u628a\u5b83\u7684\u7c7b\u8bbe\u7f6e\u6210<code>GoPage2VC</code>\u3002</p> <p></p> <p>\u9875\u9762\u4e0b\u65b9\u62d6\u5165\u4e00\u4e2aTable View\uff0c\u8bbe\u7f6e\u597d\u7ea6\u675f\uff0c\u8ba9\u5b83\u8d34\u7740\u5e95\u90e8\u3002</p> <p>\u9875\u9762\u4e0a\u65b9\u653e2\u4e2alabel\uff0c\u663e\u793a\u4e00\u4e9b\u6587\u5b57\u3002\u628a<code>\u6253\u5f00\u65f6\u95f4</code>\u7684label\u548c<code>GoPage2VC.h</code>\u91cc\u9762\u7684<code>*timeLb</code>\u8fde\u8d77\u6765\u3002</p> <p>\u63a5\u4e0b\u6765\u91cd\u70b9\u5904\u7406Table View\u3002</p> <p>\u53f3\u952e\u70b9Table View\u5e76\u6309\u4f4f\u62d6\u52a8\uff0c\u62d6\u5230VC\u4e0a\uff08\u7ea2\u8272\u7bad\u5934\uff09\uff0c\u6216\u8005\u662f\u62d6\u5230\u9ec4\u8272\u5706\u5708\u7684\u5730\u65b9\uff08\u84dd\u8272\u7bad\u5934\uff09\u3002</p> <p></p> <p>\u5176\u5b9e\u5c31\u662f\u8ba9TableView\u7684datasource\u5173\u8054\u5230<code>GoPage2VC</code></p> <p></p> <p>\u73b0\u5728Table View\u7684Prototype Cells\u6570\u503c\u4e3a0\uff0c\u56e0\u4e3a\u6211\u4eec\u7528\u7684\u8fd8\u662f\u9ed8\u8ba4\u6837\u5f0f<code>UITableViewCellStyleDefault</code>\u3002</p> <p>\u8fd0\u884c\u4e00\u4e0b\u53ef\u4ee5\u770b\u5230\u6548\u679c\uff08iPhone7\uff09</p> \u8fd0\u884c\u6548\u679c1 <p></p>"},{"location":"ios/uikit/tableview/case/table-view-and-other/#_3","title":"\u6dfb\u52a0\u56fe\u6807","text":"<p>\u5f80\u5de5\u7a0b\u7684Assets.xcassets\u91cc\u52a02\u4e2a\u5c0f\u56fe\u6807\u3002</p> <p>\u5728<code>GoPage2VC.m</code>\u91cc\uff0c\u4f7f\u7528\u5c0f\u56fe\u6807\u3002 <pre><code>// GoPage2VC.m\n\n- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {\n    UITableViewCell* cell = [tableView dequeueReusableCellWithIdentifier:DataCellID];\n    if(cell == nil) {\n        cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:DataCellID];\n    }\n    cell.textLabel.text = [self.list objectAtIndex:indexPath.row];\n    if (indexPath.row % 2 == 0) {\n        cell.imageView.image = [UIImage imageNamed:@\"itemIv1\"];\n    } else {\n        cell.imageView.image = [UIImage imageNamed:@\"itemIv2\"];\n    }\n    return cell;\n}\n</code></pre> \u9ed8\u8ba4\u6837\u5f0f\u7684cell\u5e26\u6709<code>imageView</code>\u3002\u6211\u4eec\u628a\u56fe\u7247\u4ea4\u7ed9cell\u6765\u663e\u793a\u3002</p> <p>\u589e\u52a0\u4e00\u4e9b\u6d4b\u8bd5\u6570\u636e\uff0c\u8fd0\u884c\u53ef\u4ee5\u770b\u5230\u6548\u679c</p> \u8fd0\u884c\u6548\u679c2 <p></p>"},{"location":"ios/uikit/tableview/case/table-view-and-other/#_4","title":"\u5b50\u9879\u70b9\u51fb","text":"<p>\u5728<code>GoPage2VC.m</code>\u4e2d\u590d\u5199<code>didSelectRowAtIndexPath</code>\u65b9\u6cd5\uff0c\u5728\u8fd9\u91cc\u54cd\u5e94\u7528\u6237\u70b9\u51fb\u5b50\u9879\u3002 <pre><code>// GoPage2VC.m\n\n- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath {\n    NSString *rowString = [self.list objectAtIndex:[indexPath row]];\n    UIAlertController* alert = [UIAlertController alertControllerWithTitle:@\"\u70b9\u51fb\u4e86\"\n                                   message:rowString\n                                   preferredStyle:UIAlertControllerStyleAlert];\n    [alert addAction:[UIAlertAction actionWithTitle:@\"\u786e\u5b9a\" style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) {\n        NSLog(@\"\u9ed8\u8ba4\u64cd\u4f5c\");\n    }]];\n    [self presentViewController:alert animated:YES completion:nil];\n}\n</code></pre> \u91cc\u9762\u4f7f\u7528<code>UIAlertController</code>\u5f39\u51fa\u4e00\u4e2a\u7a97\u53e3\u3002\u6216\u8005\u6253\u4e2alog\u4e5f\u884c\u3002</p> <p>\u8fd0\u884c\u8d77\u6765\u70b9\u51fb\u53d1\u73b0\u6ca1\u6709\u53cd\u5e94\u3002\u68c0\u67e5storyboard\uff0c\u53d1\u73b0\u8981\u628aTable View\u7684delegate\u5173\u8054\u5230<code>GoPage2VC</code>\u3002 \u6211\u4eec\u53ef\u4ee5\u4ece\u53f3\u8fb9\u680fOutlets\u90a3\u91cc\u628adelegate\u62d6\u5230<code>GoPage2VC</code>\u4e0a\u3002</p> <p></p> <p>\u518d\u8fd0\u884c\u5230iPhone7\u4e0a</p> \u70b9\u51fb\u5f39\u51fa <p></p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u53ef\u4ee5\u81ea\u5b9a\u4e49cell TableView\u81ea\u5b9a\u4e49cell</p>"},{"location":"ios/uikit/tableview/case/table-view-and-other/#_5","title":"\u53c2\u8003","text":"<ul> <li>uialertcontroller - developer.apple</li> <li>\u201cthis class is not key value coding-compliant for the xxx\u201d - CSDN</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91</p>"},{"location":"ios/xcode/basic-use/","title":"Xcode \u57fa\u672c\u64cd\u4f5c","text":"\u66f4\u65b0\u65e5\u671f 2022-6-10 <ul> <li>2022-6-10 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u6301\u7eed\u66f4\u65b0\u4e2d</p> <p>\u8bb0\u5f55\u4e00\u4e9bXcode\u7684\u57fa\u672c\u64cd\u4f5c</p>","tags":["iOS","Xcode"]},{"location":"ios/xcode/basic-use/#_1","title":"\u683c\u5f0f\u5316\u4ee3\u7801","text":"<p>\u52062\u6b65\uff0c\u9700\u8981\u5148\u9009\u62e9\u4ee3\u7801\u7136\u540e\u518d\u6267\u884c\u683c\u5f0f\u5316</p> <ul> <li>1) \u2318 + A : \u9009\u62e9\u5f53\u524d\u6587\u4ef6\u5168\u90e8\u4ee3\u7801</li> <li>2) \u2303 + I : \u6267\u884c\u6574\u7406</li> </ul> <p>\u6267\u884c\u6548\u679c\u4e00\u822c\u3002\u4e0d\u80fd\u6539\u53d8\u5927\u62ec\u53f7\u662f\u5426\u6362\u884c\u3002</p>","tags":["iOS","Xcode"]},{"location":"ios/xcode/basic-use/#_2","title":"\u62d6\u5165\u6a21\u5757","text":"<p>\u5c06\u53e6\u4e00\u4e2a\u5de5\u7a0b\u7684<code>.xcodeproj</code>\u6587\u4ef6\u62d6\u62fd\u5230\u672c\u5de5\u7a0b\u7684Xcode\u6587\u4ef6\u76ee\u5f55\u5e95\u4e0b\u3002</p>","tags":["iOS","Xcode"]},{"location":"java/intro/","title":"Java\u7efc\u8ff0","text":"\u66f4\u65b0\u65e5\u671f 2022-2-21 <ul> <li>2022-2-21 \u66f4\u65b0\u7b80\u4ecb\u5185\u5bb9</li> <li>2020-8-1 \u521b\u5efa\u6587\u6863</li> </ul>"},{"location":"java/intro/#_1","title":"\u7b80\u4ecb","text":"<p>Java\u662f\u4e00\u79cd\u7f16\u7a0b\u8bed\u8a00\u30021996\u5e74Sun Microsystems\u516c\u53f8\u53d1\u5e03\u4e86Java\u7684\u7b2c\u4e00\u4e2a\u7248\u672c\u3002\u65f6\u81f3\u4eca\u65e5\uff082022\u5e74\uff09\uff0cJava\u65e9\u5df2\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u5e73\u53f0\uff0c\u6709\u5e9e\u5927\u7684\u4ee3\u7801\u5e93\uff0c\u5305\u542b\u4e86\u5f88\u591a\u53ef\u91cd\u7528\u7684\u4ee3\u7801\uff0c\u5f88\u591a\u5f00\u7bb1\u5373\u7528\u7684\u7b2c\u4e09\u65b9\u5e93\uff0c\u6709\u7740\u826f\u597d\u7684\u53ef\u79fb\u690d\u6027\u3002</p> <p>1991\u5e74\uff0c\u5728\u5f53\u65f6\u7684Sun\u516c\u53f8\uff0cPatrick Naughton\u548c\u4ed6\u7684\u4f19\u4f34James Gosling\uff08\u8bf7\u8bb0\u4f4f\u8fd9\u4e2a\u540d\u5b57\uff09\u5e26\u9886\u7684\u5de5\u7a0b\u5e08\u5c0f\u7ec4\u60f3\u8981\u8bbe\u8ba1\u4e00\u79cd\u5c0f\u578b\u7684\u8ba1\u7b97\u673a\u8bed\u8a00\u3002\u7528\u4e8e\u5f53\u65f6\u7684\u6d88\u8d39\u8bbe\u5907\u3002\u800c\u5f53\u65f6\u7684\u8bbe\u5907\u5904\u7406\u80fd\u529b\u548c\u5185\u5b58\u90fd\u5f88\u6709\u9650\uff08\u7528\u4eca\u5929\u7684\u773c\u5149\u770b\u90a3\u662f\u76f8\u5f53\u6709\u9650\uff09\uff0c\u5f00\u53d1\u8bed\u8a00\u5fc5\u987b\u8981\u975e\u5e38\u5c0f\u5e76\u4e14\u7d27\u51d1\u3002\u800c\u4e0d\u540c\u7684\u8bbe\u5907\u5382\u5546\u4f1a\u9009\u62e9\u4e0d\u540c\u7684CPU\uff0c\u56e0\u6b64\u8fd9\u4e2a\u8bed\u8a00\u4e0d\u80fd\u548c\u7279\u5b9aCPU\u7ed1\u5b9a\u5728\u4e00\u8d77\u3002\u8fd9\u4e2a\u9879\u76ee\u88ab\u547d\u540d\u4e3a\u201cGreen\u201d\u3002 \u539f\u5148Gosling\u628a\u8fd9\u95e8\u8bed\u8a00\u547d\u540d\u4e3a\u201cOak\u201d\uff0c\u4f46\u53d1\u73b0\u8fd9\u5df2\u7ecf\u662f\u53e6\u4e00\u79cd\u8bed\u8a00\u7684\u540d\u5b57\uff0c\u4e8e\u662fSun\u516c\u53f8\u5c06\u5176\u6539\u540d\u4e3a \u2014\u2014 Java\u3002</p> <p>\u968f\u7740\u4e92\u8054\u7f51\u7684\u53d1\u5c55\uff0cJava\u4e5f\u5728\u53d1\u5c55\u58ee\u5927\u3002Sun\u63a8\u51fa\u4e86\u7528\u4e8e\u624b\u673a\u7b49\u5d4c\u5165\u5f0f\u8bbe\u5907\u7684\u201c\u5fae\u578b\u7248\u201d\uff0c\u548c\u7528\u4e8e\u670d\u52a1\u5668\u5904\u7406\u7684\u201c\u4f01\u4e1a\u7248\u201d\u3002</p> <p>2009\u5e74\uff0cSun Microsystems\u88abOracle\u6536\u8d2d\u3002</p> <p>2010\u5e744\u6708\uff0cGosling\u79bb\u5f00Oracle\u3002</p> <p>2011\u5e74\uff0cOracle\u53d1\u5e03\u4e86Java 7\u3002</p> <p>2014\u5e74\uff0cJava 8 \u53d1\u5e03\u3002</p> <p>2017\u5e74\uff0cJava 9 \u53d1\u5e03\u3002</p> <p>2018\u5e74\uff0cJava 10 \u53d1\u5e03\u3002</p> <p>2018\u5e749\u6708\uff0cJava 11 \uff0818.9 LTS\uff09 \u6b63\u5f0f\u53d1\u5e03\u3002</p> <p>\u7531\u4e8e\u5386\u53f2\u539f\u56e0\uff0cAndroid\u4f7f\u7528Java\u6765\u5f00\u53d1App\u3002\u8bb8\u591aAndroid\u5e94\u7528\u5f00\u53d1\u8005\u4f7f\u7528Java\u8bed\u8a00\u3002\u5f53\u7136\u73b0\u5728\u5f00\u53d1\u8005\u4e5f\u53ef\u4ee5\u7528Kotlin\u6765\u5f00\u53d1\u5e94\u7528\u3002 Java\u88ab\u7f16\u8bd1\u6210\u5b57\u8282\u7801\u540e\uff0c\u7531Java\u865a\u62df\u673a\u6267\u884c\u3002\u7c7b\u4f3c\u7684\uff0cKotlin\u4e5f\u53ef\u88ab\u7f16\u8bd1\u4e3a\u5b57\u8282\u7801\u3002</p> <p>\u76ee\u524dAndroid\u7684Framework\u5c42\u4e3b\u8981\u7528Java\u7f16\u5199\u7684\u3002</p>"},{"location":"java/intro/#_2","title":"\u9762\u5411\u5bf9\u8c61","text":"<p>\u9762\u5411\u5bf9\u8c61\u662f\u4e00\u79cd\u7a0b\u5e8f\u8bbe\u8ba1\u6280\u672f\u3002\u5b83\u5c06\u91cd\u70b9\u653e\u5728\u6570\u636e\uff08\u5373\u5bf9\u8c61\uff09\u548c\u5bf9\u8c61\u7684\u63a5\u53e3\uff08\u529f\u80fd\uff09\u4e0a\u3002</p>"},{"location":"java/intro/#_3","title":"\u8bbe\u8ba1\u6a21\u5f0f","text":"<p>\u8bbe\u8ba1\u6a21\u5f0f\u5728Android\u5e94\u7528\u5f00\u53d1\u4e2d\u6709\u7740\u5e7f\u6cdb\u7684\u5e94\u7528\u3002</p>"},{"location":"java/intro/#_4","title":"\u53c2\u8003","text":"<ul> <li>\u300aJava\u6838\u5fc3\u6280\u672f \u53771 \u57fa\u7840\u77e5\u8bc6\u300b\uff0c Core Java Volume I - Fundamentals by Cay S. Horstmann, Gary Cornell</li> </ul>"},{"location":"java/anotation/Java-annotation-intro/","title":"Java \u6ce8\u89e3\u4f7f\u7528\u4e0e\u7b80\u5355\u8bf4\u660e","text":"<p>\u53c2\u8003\u4e66\u7c4d\uff1a Core Java, Volume II - Advanced Features 8th Edition </p>"},{"location":"java/anotation/Java-annotation-intro/#_1","title":"\u4f7f\u7528\u6ce8\u89e3","text":"<p>\u6ce8\u89e3\u662f\u90a3\u4e9b\u63d2\u5165\u5230\u6e90\u4ee3\u7801\u4e2d\u7528\u4e8e\u67d0\u79cd\u5de5\u5177\u5904\u7406\u7684\u6807\u7b7e\u3002\u8fd9\u4e9b\u6807\u7b7e\u53ef\u4ee5\u5728\u6e90\u7801\u5c42\u6b21\u4e0a\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>\u6ce8\u89e3\u7684\u4f7f\u7528\u8fd8\u662f\u5f88\u5e7f\u6cdb\u7684\uff0c\u53ef\u80fd\u7528\u6cd5\u6709\uff1a</p> <ul> <li>\u9644\u5c5e\u6587\u4ef6\u7684\u81ea\u52a8\u751f\u6210\uff0c\u4f8b\u5982\u90e8\u7f72\u63cf\u8ff0\u7b26\u6216\u8005bean\u4fe1\u606f\u7c7b</li> <li>\u6d4b\u8bd5\u3001\u65e5\u5fd7\u3001\u4e8b\u7269\u8bed\u4e49\u7b49\u4ee3\u7801\u7684\u81ea\u52a8\u751f\u6210</li> </ul> <p>\u5728Java\u4e2d\uff0c\u6ce8\u89e3\u662f\u5f53\u505a\u4e00\u4e2a\u4fee\u9970\u7b26\u6765\u4f7f\u7528\u7684\uff0c\u5b83\u88ab\u7f6e\u4e8e\u88ab\u6ce8\u89e3\u9879\u524d\uff0c\u4e2d\u95f4\u6ca1\u6709\u5206\u53f7\u3002</p> <p>\u6bcf\u4e2a\u6ce8\u89e3\u90fd\u5fc5\u987b\u901a\u8fc7\u4e00\u4e2a\u6ce8\u89e3\u63a5\u53e3\u6765\u5b9a\u4e49\u3002\u8fd9\u4e9b\u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5\u4e0e\u6ce8\u89e3\u4e2d\u7684\u5143\u7d20\u76f8\u5bf9\u5e94\u3002</p>"},{"location":"java/anotation/Java-annotation-intro/#_2","title":"\u4f7f\u7528\u5b9e\u4f8b\uff1a\u6ce8\u89e3\u4e8b\u4ef6\u5904\u7406\u5668","text":"<p>\u4ee5GUI\u4e3a\u4f8b\uff0c\u8bbe\u7f6e\u6309\u94ae\u7684\u70b9\u51fb\u76d1\u542c\u4e8b\u4ef6\u3002\u8fd9\u4e2a\u4f8b\u5b50\u867d\u4e0d\u5b8c\u5584\uff0c\u4f46\u7b80\u5355\u8bf4\u660e\u4e86\u6ce8\u89e3\u7684\u7528\u6cd5\u3002</p> <p>\u6587\u4ef6\u5982\u4e0b\uff1a <pre><code>annotationdemo/\n\u251c\u2500\u2500 ActionListenerFor.java\n\u251c\u2500\u2500 ActionListenerInstaller.java\n\u2514\u2500\u2500 ButtonTest.java\n</code></pre></p> <p>\u4e0b\u9762\u662f\u6240\u6709\u6587\u4ef6\u7684\u4ee3\u7801</p> <p><code>ButtonTest.java</code> \u663e\u793a\u4e00\u4e2a\u5e26\u6709\u6309\u94ae\u7684\u754c\u9762</p> <pre><code>package annotationdemo;\n\nimport javax.swing.*;\nimport java.awt.*;\n\n/**\n * For annotation test\n */\npublic class ButtonTest {\n    public static void main(String[] args) {\n        ButtonFrame btnFrame = new ButtonFrame();\n        btnFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);\n        btnFrame.setVisible(true);\n    }\n\n    static class ButtonFrame extends JFrame {\n        private JPanel panel;\n        private JButton yellowBtn;\n        private JButton blueBtn;\n        private JButton redBtn;\n\n        public ButtonFrame() {\n            setTitle(\"ButtonTest\");\n            setSize(300, 200);\n\n            panel = new JPanel();\n            add(panel);\n\n            yellowBtn = new JButton(\"Yellow\");\n            blueBtn = new JButton(\"blue\");\n            redBtn = new JButton(\"red\");\n\n            panel.add(yellowBtn);\n            panel.add(blueBtn);\n            panel.add(redBtn);\n\n            ActionListenerInstaller.processAnnotations(this);\n\n        }\n\n        @ActionListenerFor(source = \"yellowBtn\", level = 1)\n        public void yellowBg() {\n            panel.setBackground(Color.YELLOW);\n        }\n\n        @ActionListenerFor(level = 2, source = \"blueBtn\")\n        public void blueBg() {\n            panel.setBackground(Color.BLUE);\n        }\n\n        @ActionListenerFor(source = \"redBtn\")\n        public void redBg() {\n            panel.setBackground(Color.RED);\n        }\n\n    }\n\n}\n</code></pre> <p>\u6211\u4eec\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u6ce8\u89e3\u6765\u4ee3\u66ff<code>addActionListener</code> \u4e0a\u9762\u7684level\u6709\u9ed8\u8ba4\u503c0\uff0c\u4e0d\u8bbe\u7f6e\u4e5f\u53ef\u4ee5\u30022\u4e2a\u5143\u7d20\u8c01\u5148\u8c01\u540e\u90fd\u6ca1\u5173\u7cfb\u3002</p> <p><code>ActionListenerInstaller</code> - \u5206\u6790\u6ce8\u89e3\u4ee5\u53ca\u5b89\u88c5\u884c\u4e3a\u76d1\u542c\u5668\u7684\u673a\u5236</p> <pre><code>package annotationdemo;\n\nimport java.awt.event.ActionListener;\nimport java.lang.reflect.*;\n\n/**\n * Install action listener\n */\npublic class ActionListenerInstaller {\n\n    public static void processAnnotations(Object obj) {\n        try {\n            Class cl = obj.getClass();\n            for (Method m : cl.getDeclaredMethods()) {\n                ActionListenerFor a = m.getAnnotation(ActionListenerFor.class);\n                if (null != a) {\n                    Field f = cl.getDeclaredField(a.source());\n                    f.setAccessible(true);\n                    addListener(f.get(obj), obj, m);\n                    a.level();// \u53ef\u4ee5\u83b7\u53d6\u5b9a\u4e49\u7684level\n                }\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    public static void addListener(Object source, final Object param, final Method m) throws NoSuchMethodException,\n            InvocationTargetException, IllegalAccessException {\n\n        InvocationHandler handler = new InvocationHandler() {\n            @Override\n            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n                return m.invoke(param);\n            }\n        };\n\n        Object listener = Proxy.newProxyInstance(null,\n                new Class[]{java.awt.event.ActionListener.class},\n                handler);\n        Method adder = source.getClass().getMethod(\"addActionListener\", ActionListener.class);\n        adder.invoke(source, listener);\n\n    }\n}\n</code></pre> <p><code>processAnnotations</code>\u65b9\u6cd5\u679a\u4e3e\u51fa\u67d0\u4e2a\u5bf9\u8c61\u63a5\u6536\u5230\u7684\u6240\u6709\u65b9\u6cd5\u3002\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5148\u83b7\u53d6<code>ActionListenerFor</code> \u5bf9\u8c61\uff0c\u7136\u540e\u518d\u8fdb\u884c\u5904\u7406\u3002</p> <p><code>ActionListenerFor.java</code> \u5b9a\u4e49\u6211\u4eec\u60f3\u8981\u7684\u6ce8\u89e3</p> <pre><code>package annotationdemo;\n\nimport java.lang.annotation.ElementType;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.RetentionPolicy;\nimport java.lang.annotation.Target;\n\n@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface ActionListenerFor {\n    String source();\n    int level() default 0;\n}\n</code></pre> <p><code>Target</code>\u548c<code>Retention</code>\u662f\u5143\u6ce8\u89e3\u3002\u5b83\u4eec\u6ce8\u89e3\u4e86<code>ActionListenerFor</code>\u6ce8\u89e3\uff0c\u5373\u5c06<code>ActionListenerFor</code> \u6ce8\u89e3\u6807\u8bc6\u6210\u4e00\u4e2a\u53ea\u80fd\u8fd0\u7528\u5230\u65b9\u6cd5\u4e0a\u7684\u6ce8\u89e3\uff0c\u5e76\u4e14\u5f53\u7c7b\u6587\u4ef6\u8f7d\u5165\u5230\u865a\u62df\u673a\u65f6\uff0c\u4ecd\u53ef\u4ee5\u4fdd\u7559\u4e0b\u6765\u3002</p>"},{"location":"java/anotation/Java-annotation-intro/#_3","title":"\u6ce8\u89e3\u8bed\u6cd5","text":"<p>\u6a21\u4eff\u524d\u9762\u7684\u4f8b\u5b50\u5373\u53ef</p> <p>\u4e00\u4e2a\u6ce8\u89e3\u662f\u7531\u4e00\u4e2a\u6ce8\u89e3\u63a5\u53e3\u6765\u5b9a\u4e49\u7684\uff1a <pre><code>modifiers @interface AnnotaionName {\n    element declaration1\n    element declaration2\n    ......\n}\n</code></pre> \u6bcf\u4e2a\u5143\u7d20\u58f0\u660e\u7684\u5f62\u5f0f <code>type elementName();</code> \u6216\u8005 <code>type elementName() default value;</code></p> <p>\u6ce8\u89e3\u7684\u5143\u7d20\u4e3a\u4e0b\u4f8b\u4e4b\u4e00\uff1a</p> <ul> <li>\u4e00\u4e2a\u57fa\u672c\u7c7b\u578b\uff08int short long byte char double float boolean\uff09</li> <li>\u4e00\u4e2aString</li> <li>\u4e00\u4e2aClass\uff08\u5177\u6709\u4e00\u4e2a\u53ef\u4f9b\u9009\u62e9\u7684\u7c7b\u578b\u53c2\u6570\uff0c\u4f8b\u5982Class&lt;? extends MyClass&gt;\uff09</li> <li>\u4e00\u4e2aenum\u7c7b\u578b</li> <li>\u4e00\u4e2a\u6ce8\u89e3\u7c7b\u578b</li> <li>\u4e00\u4e2a\u7531\u524d\u9762\u6240\u63cf\u8ff0\u7c7b\u578b\u7ec4\u6210\u7684\u6570\u7ec4\uff08\u6570\u7ec4\u7ec4\u6210\u7684\u6570\u7ec4\u4e0d\u662f\u5408\u6cd5\u7684\u5143\u7d20\u7c7b\u578b\uff09</li> </ul> <p>\u56e0\u6ce8\u89e3\u662f\u7531\u7f16\u8bd1\u5668\u8ba1\u7b97\u800c\u6765\uff0c\u56e0\u6b64\uff0c\u6240\u6709\u5143\u7d20\u5fc5\u987b\u662f\u7f16\u8bd1\u671f\u5e38\u91cf</p>"},{"location":"java/anotation/Java-annotation-intro/#androidfindviewbyid","title":"Android\u4e2d\u4f7f\u7528\u6ce8\u89e3\u4ee3\u66fffindViewById","text":"<p>\u51c6\u59072\u4e2a\u6587\u4ef6</p> <p><code>FindView</code>\u662f\u6211\u4eec\u7684\u6ce8\u89e3 <pre><code>@Target(ElementType.FIELD)\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface FindView {\n    int idValue() default 0;\n}\n</code></pre></p> <p>\u5e2e\u52a9\u7c7b<code>FindViewHelper</code> <pre><code>public class FindViewHelper {\n    public static void initFindView(Activity activity) {\n        Class&lt;Activity&gt; clz = (Class&lt;Activity&gt;) activity.getClass();\n        Field[] fields = clz.getDeclaredFields();\n        for (Field field : fields) {\n            if (field.isAnnotationPresent(FindView.class)) {\n                FindView inject = field.getAnnotation(FindView.class);\n                int id = inject.idValue();\n                if (0 != id) {\n                    field.setAccessible(true);\n                    try {\n                        field.set(activity, activity.findViewById(id));\n                    } catch (IllegalAccessException e) {\n                        e.printStackTrace();\n                    }\n                }\n            }\n        }\n    }\n}\n</code></pre></p> <p>\u5728<code>AnnotationDemoActivity</code>\u4e2d\u4f7f\u7528\u6ce8\u89e3 <pre><code>public class AnnotationDemoActivity extends Activity {\n\n    @FindView(idValue = R.id.tv)\n    TextView mTv1;\n    @FindView(idValue = R.id.btn)\n    Button mBtn1;\n\n    @Override\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.act_a_demo);\n        FindViewHelper.initFindView(this);\n\n        mTv1.setText(\"\u5df2\u7ecf\u88ab\u6ce8\u89e3\u7684\u65b9\u5f0f\u62ff\u5230\u4e86\");\n        mBtn1.setText(\"\u6ce8\u89e3\");\n    }\n}\n</code></pre></p>"},{"location":"java/basic/java-basic-note/","title":"Java\u57fa\u7840","text":""},{"location":"java/basic/java-basic-note/#_1","title":"\u6574\u578b\u4e0e\u6d6e\u70b9\u578b\u8303\u56f4","text":"<p>Java\u6574\u578b</p> \u7c7b\u578b \u5b58\u50a8\u9700\u6c42 \u53d6\u503c\u8303\u56f4 int 4\u5b57\u8282 -2147483648 ~ 2147483647\uff08\u8d85\u8fc720\u4ebf\uff09 short 2\u5b57\u8282 -32 768 ~ 32767 long 8\u5b57\u8282 -9 223 372 036 854 775 808 ~ 9 223 372 036 854 775 807 byte 1\u5b57\u8282 - 128 ~ 127 <p>\u6d6e\u70b9\u7c7b\u578b</p> \u7c7b\u578b \u5b58\u50a8\u9700\u6c42 \u53d6\u503c\u8303\u56f4 float 4\u5b57\u8282 \u5927\u7ea6\u00b13.402 823 47E + 38F\uff08\u6709\u6548\u4f4d\u6570\u4e3a6\uff5e7\u4f4d\uff09 double 8\u5b57\u8282 \u5927\u7ea6\u00b11.797 693 134 862 315 70E + 308\uff08\u6709\u6548\u4f4d\u657015\u4f4d\uff09"},{"location":"java/basic/java-basic-note/#java4","title":"Java\u63a7\u5236\u53ef\u89c1\u6027\u76844\u4e2a\u8bbf\u95ee\u4fee\u9970\u7b26","text":"\u4fee\u9970\u7b26 \u7c7b\u5185\u90e8 \u672c\u5305 \u5b50\u7c7b \u5916\u90e8\u5305 public \u221a \u221a \u221a \u221a protected \u221a \u221a \u221a x default \u221a \u221a x x private \u221a x x x <p>\u5f52\u7eb3</p> <ul> <li>\u4ec5\u5bf9\u672c\u7c7b\u53ef\u89c1 \u2014\u2014 private</li> <li>\u5bf9\u6240\u6709\u7c7b\u53ef\u89c1 \u2014\u2014 public</li> <li>\u5bf9\u672c\u5305\u548c\u6240\u6709\u5b50\u7c7b\u53ef\u89c1 \u2014\u2014 protected</li> <li>\u5bf9\u672c\u5305\u53ef\u89c1 \u2014\u2014 \u9ed8\u8ba4\uff0c\u6240\u8c13\u9ed8\u8ba4\u662f\u6307\u6ca1\u6709\u4efb\u4f55\u4fee\u9970\u7b26\u7684\u60c5\u51b5\uff0c\u8fd9\u79cd\u65b9\u5f0f\u901a\u5e38\u4e0d\u7528\u3002</li> </ul>"},{"location":"java/basic/java-env-dev/","title":"Java\u5f00\u53d1\u73af\u5883","text":"\u66f4\u65b0\u65e5\u671f 2022-2-24 <ul> <li>2022-2-24 \u521b\u5efa\u6587\u6863</li> </ul>"},{"location":"java/basic/java-env-dev/#macos","title":"macOS","text":"<p>\u67e5\u8be2java\u7248\u672c <pre><code>~ $ java -version\njava version \"1.8.0_291\"\nJava(TM) SE Runtime Environment (build 1.8.0_291-b10)\nJava HotSpot(TM) 64-Bit Server VM (build 25.291-b10, mixed mode)\n</code></pre></p> <p>\u7528<code>whereis</code>\u547d\u4ee4\u67e5\u8be2java\u7684\u4f4d\u7f6e <pre><code>~/ws/javaPlayground $ whereis java\n/usr/bin/java\n</code></pre></p>"},{"location":"java/basic/java-env-dev/#_1","title":"\uff08\u9009\u505a\uff09\u7f16\u8bd1\u548c\u6267\u884c","text":"<p>\u65b0\u5efa\u4e00\u4e2ajava\u6587\u4ef6First.java\uff0c\u586b\u5165\u4ee5\u4e0b\u4ee3\u7801 <pre><code>public class First {\n\n    public static void main(String[] args) {\n        System.out.println(\"an.rustfisher.com\");       \n    }\n}\n</code></pre></p> <p>\u7528\u7ec8\u7aef\u7f16\u8bd1\u548c\u6267\u884c <pre><code>~/ws/javaPlayground $ javac First.java \n~/ws/javaPlayground $ java First\nan.rustfisher.com\n</code></pre> javac\u662f\u7f16\u8bd1\uff0c\u5f97\u5230First.class\u6587\u4ef6</p> <p>java\u6267\u884c\u7f16\u8bd1\u5f97\u5230\u7684\u6587\u4ef6\uff0c\u6267\u884c\u7684\u65f6\u5019\u4e0d\u7528\u5e26\u4e0a\u540e\u7f00</p>"},{"location":"java/basic/java-env-dev/#ide","title":"IDE","text":"<p>\u6211\u4eec\u6bd4\u8f83\u63a8\u8350\u4f7f\u7528\u4e00\u4e9bIDE\u6765\u8fdb\u884cJava\u5f00\u53d1\uff0c\u6bd4\u5982IntelliJ IDEA\u3002</p> <p></p> <p>\u7528vs code\u4e5f\u884c\uff0c\u5c31\u662f\u8981\u591a\u4e0b\u8f7d\u4e00\u4e9b\u63d2\u4ef6\u3002</p>"},{"location":"java/calendar/Java-Calendar-use/","title":"Java - Calendar\u4f7f\u7528","text":""},{"location":"java/calendar/Java-Calendar-use/#_1","title":"\u6309\u65e5\u8ba1\u7b97\u5e74\u9f84","text":"<pre><code>import java.util.Calendar;\n\n    // \u7531\u51fa\u751f\u65e5\u671f\u8ba1\u7b97\u5e74\u9f84\n    public static int getAgeByBirthday(int yearBirth, int monthBirth, int dayOfMonthBirth) {\n        Calendar cal = Calendar.getInstance();\n        int yearNow = cal.get(Calendar.YEAR);\n        int monthNow = cal.get(Calendar.MONTH) + 1; // \u83b7\u53d6\u6708\u4efd\u7684\u65f6\u5019\u8981\u6ce8\u610f +1\n        int dayOfMonthNow = cal.get(Calendar.DAY_OF_MONTH);\n        int age = yearNow - yearBirth;\n        if (monthNow &lt;= monthBirth) {\n            if (monthNow == monthBirth) {\n                if (dayOfMonthNow &lt; dayOfMonthBirth) {\n                    age--;\n                }\n            } else {\n                age--;\n            }\n        }\n        if (age &lt; 0) {\n            return 0;\n        }\n        return age;\n    }\n\n    public static void main(String[] args) {\n        System.out.println(\"Today: \" + Calendar.getInstance().getTime());  // Today: Mon Aug 27 17:10:02 CST 2018\n        System.out.println(\"age: \" + getAgeByBirthday(1988, 8, 23));       // age: 30\n        System.out.println(\"age: \" + getAgeByBirthday(1990, 8, 23));       // age: 28\n        System.out.println(\"age: \" + getAgeByBirthday(1991, 8, 23));       // age: 27\n        System.out.println(\"age: \" + getAgeByBirthday(2000, 8, 26));       // age: 18\n        System.out.println(\"age: \" + getAgeByBirthday(2000, 8, 27));       // age: 18\n        System.out.println(\"age: \" + getAgeByBirthday(2018, 8, 28));       // age: 0\n        System.out.println(\"age: \" + getAgeByBirthday(2019, 8, 23));       // age: 0\n    }\n</code></pre>"},{"location":"java/class/abs-class-vs-interface/","title":"\u63a5\u53e3\u4e0e\u62bd\u8c61\u7c7b","text":"<p>\u63a5\u53e3\u4e0e\u62bd\u8c61\u7c7b\u7684\u533a\u522b\uff1a</p> <ul> <li>\u7c7b(class)\u662f\u6784\u9020\u5bf9\u8c61\u7684\u6a21\u677f\u6216\u84dd\u56fe\u3002</li> <li>\u62bd\u8c61\u7c7b\u4f5c\u4e3a\u6d3e\u751f\u5176\u5b83\u7c7b\u7684\u57fa\u7c7b\uff0c\u800c\u4e0d\u4f5c\u4e3a\u60f3\u4f7f\u7528\u7684\u7279\u5b9a\u7684\u5b9e\u4f8b\u7c7b\u3002</li> <li>\u62bd\u8c61\u65b9\u6cd5\u5145\u5f53\u7740\u5360\u4f4d\u7684\u89d2\u8272\uff0c\u5b83\u4eec\u7684\u5177\u4f53\u5b9e\u73b0\u5728\u5b50\u7c7b\u4e2d\u3002</li> <li>\u6bcf\u4e2a\u7c7b\u53ea\u80fd\u6269\u5c55\u4e8e\u4e00\u4e2a\u7c7b\uff08\u5355\u7ee7\u627f\uff09\u3002</li> <li>\u63a5\u53e3(interface)\u4e3b\u8981\u7528\u6765\u63cf\u8ff0\u7c7b\u5177\u6709\u4ec0\u4e48\u529f\u80fd\uff0c\u800c\u4e0d\u7ed9\u51fa\u6bcf\u4e2a\u529f\u80fd\u7684\u5177\u4f53\u5b9e\u73b0\u3002</li> </ul> <p>\u4e00\u4e2a\u7c7b\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u6216\u591a\u4e2a\u63a5\u53e3\u3002</p> <ul> <li>\u63a5\u53e3\u4e0d\u662f\u7c7b\u3002</li> <li>\u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5\u90fd\u81ea\u52a8\u5730\u8bbe\u7f6e\u4e3a<code>public</code>\u3002</li> <li>\u63a5\u53e3\u4e2d\u7684\u57df\u81ea\u52a8\u8bbe\u7f6e\u4e3a<code>public static final</code>\u3002</li> </ul> <p>\u53c2\u8003 http://www.javaworld.com/article/2077421/learn-java/abstract-classes-vs-interfaces.html</p> <p>\u62e9\u63a5\u53e3\u548c\u62bd\u8c61\u7c7b\u662f\u4e0d\u662f\u4e00\u4e2a\u975e\u6b64\u5373\u5f7c\u7684\u547d\u9898\u3002\u5982\u679c\u4f60\u9700\u8981\u4fee\u6539\u4f60\u7684\u8bbe\u8ba1\uff0c\u4f7f\u7528\u63a5\u53e3\u3002\u7136\u800c\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u62bd\u8c61\u7c7b\u6765\u63d0\u4f9b\u4e00\u4e9b \u9ed8\u8ba4\u7684\u65b9\u6cd5\u3002\u5728\u5e94\u7528\u6846\u67b6\u4e2d\uff0c\u62bd\u8c61\u7c7b\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\u3002</p> <p>\u62bd\u8c61\u7c7b\u8ba9\u4f60\u5b9a\u4e49\u4e00\u4e9b\u64cd\u4f5c\uff1b\u5e76\u4e14\u5f3a\u8feb\u5b50\u7c7b\u53bb\u63d0\u4f9b\u53e6\u5916\u7684\u65b9\u6cd5\u3002\u6bd4\u5982\uff0c\u4f60\u6709\u4e00\u4e2a\u5e94\u7528\u6846\u67b6\uff0c\u4e00\u4e2a\u62bd\u8c61\u7c7b\u53ef\u4ee5\u63d0\u4f9b\u50cf\u662f\u5904\u7406 \u6d88\u606f\u548c\u4e8b\u4ef6\u7684\u9ed8\u8ba4\u670d\u52a1\u3002\u8fd9\u4e9b\u670d\u52a1\u5141\u8bb8\u4f60\u7684\u5e94\u7528\u8fde\u63a5\u5230\u5e94\u7528\u6846\u67b6\u3002\u7136\u800c\uff0c\u4e00\u4e9b\u5e94\u7528\u72ec\u6709\u7684\u529f\u80fd\u53ea\u80fd\u5728\u4f60\u7684\u5e94\u7528\u4e2d\u4f7f\u7528\u3002 \u72ec\u6709\u7684\u529f\u80fd\u6bd4\u5982\u5e94\u7528\u4f9d\u8d56\u7684\u542f\u52a8\u548c\u5173\u95ed\u4efb\u52a1\u3002\u62bd\u8c61\u7c7b\u53ef\u4ee5\u58f0\u660e\u62bd\u8c61\u7684\u5173\u95ed\u548c\u542f\u52a8\u65b9\u6cd5\uff0c\u800c\u4e0d\u7528\u518d\u81ea\u5df1\u5b9a\u4e49\u3002\u57fa\u7840\u7c7b\u77e5\u9053\u5b83 \u9700\u8981\u8fd9\u4e9b\u65b9\u6cd5\uff0c\u4f46\u4f60\u7684\u5b50\u7c7b\u4e0d\u77e5\u9053\u5982\u4f55\u53bb\u5b9e\u73b0\u90a3\u4e9b\u65b9\u6cd5\uff0c\u53ea\u77e5\u9053\u5fc5\u987b\u7ee7\u627f\u8fd9\u4e9b\u52a8\u4f5c\u3002\u9700\u8981\u542f\u52a8\u65f6\uff0c\u62bd\u8c61\u7c7b\u80fd\u8c03\u7528\u542f\u52a8\u65b9\u6cd5\u3002 \u5f53\u57fa\u7c7b\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\uff0cJava\u8c03\u7528\u5b50\u7c7b\u590d\u5199\u7684\u65b9\u6cd5\u3002</p> <p>\u5f88\u591a\u5f00\u53d1\u8005\u5fd8\u8bb0\u4e86\u5b9a\u4e49\u4e86\u62bd\u8c61\u65b9\u6cd5\u7684\u7c7b\u4e5f\u80fd\u591f\u8c03\u7528\u8fd9\u4e9b\u65b9\u6cd5\u3002\u62bd\u8c61\u7c7b\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u65b9\u6cd5\u6765\u521b\u5efa\u8ba1\u5212\u7684\u7ee7\u627f\u5c42\u6b21\u7ed3\u6784\u3002 \u5b83\u4eec\u5bf9\u4e8e\u7c7b\u7ee7\u627f\u4e2d\u7684\u975e\u53f6\u5c42\u6b21\u662f\u4e00\u4e2a\u597d\u7684\u9009\u62e9\u3002</p>"},{"location":"java/class/class-basic/","title":"Java\u7c7b\u7684\u57fa\u7840\uff0cclass\u57fa\u7840","text":""},{"location":"java/class/class-basic/#java-object","title":"Java Object\u7c7b\u6709\u54ea\u4e9b\u65b9\u6cd5\uff1f","text":"<p>Object\u7c7b\u4e2d\u7684\u65b9\u6cd5\u6709\uff1agetClass()\uff0chashCode()\uff0cequals(Object obj)\uff0cprotected Object clone()\uff0ctoString()\uff0c notify()\uff0cnotifyAll()\uff0cwait(long millis)\uff0cwait(long millis, int nanos)\uff0cwait()\uff0cprotected void finalize()</p> <ul> <li>getClass()\u8fd4\u56deRuntime\u4e2d\u8fd9\u4e2a\u5bf9\u8c61\u7684\u7c7b</li> <li>hashCode()\u8ba1\u7b97\u51fa\u8fd9\u4e2a\u5bf9\u8c61\u7684hash\u503c</li> <li>equals(Object obj)\u5224\u65ad2\u4e2a\u5bf9\u8c61\u662f\u5426\u76f8\u540c</li> <li>clone()\u5f97\u5230\u5f53\u524d\u5bf9\u8c61\u7684\u526f\u672c\u3002\u4f1a\u5148\u68c0\u67e5\u5f53\u524d\u7c7b\u662f\u5426\u5b9e\u73b0\u4e86Cloneable\u63a5\u53e3\uff0c\u5426\u5219\u629b\u51faCloneNotSupportedException\u5f02\u5e38\u3002</li> <li>toString()\u7c7b\u7684string\u8868\u793a\uff0c\u53ef\u590d\u5199\u5e76\u8f93\u51fa\u81ea\u5df1\u611f\u5174\u8da3\u7684\u4fe1\u606f</li> <li>wait()\u8ba9\u5f53\u524d\u7ebf\u7a0b\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\uff0c\u76f4\u5230\u88ab\u5524\u9192\u6216\u662f\u8fbe\u5230\u9884\u5b9a\u7684\u4e00\u6bb5\u65f6\u95f4</li> <li>notify()\u5524\u91921\u4e2a\u5728\u7b49\u5f85\u7684\u7ebf\u7a0b\uff0c\u53bb\u7ade\u4e89\u5bf9\u8c61\u7684\u9501\uff1b\u5982\u679c\u6709\u591a\u4e2a\u7ebf\u7a0b\u90fd\u5728\u8fd9\u4e2a\u5bf9\u8c61\u4e2d\u7b49\u5f85\uff0c\u9009\u62e9\u5176\u4e2d\u4e00\u4e2a\u7ebf\u7a0b\u5524\u9192\uff1b\u88ab\u9009\u4e2d\u7684\u7ebf\u7a0b\u7531\u5177\u4f53\u5b9e\u73b0\u65b9\u5f0f\u51b3\u5b9a</li> <li>notifyAll()\u5524\u9192\u6240\u6709\u5728\u8fd9\u4e2a\u5bf9\u8c61\u4e2d\u7b49\u5f85\u7684\u7ebf\u7a0b\uff0c\u53bb\u7ade\u4e89\u5bf9\u8c61\u7684\u9501</li> <li>finalize()\u7531\u5783\u573e\u56de\u6536\u5668\u8c03\u7528\uff0c\u56de\u6536\u8d44\u6e90</li> </ul>"},{"location":"java/class/class-basic/#objectnotifynotifyall","title":"Object\u7c7bnotify\u548cnotifyAll\u7684\u533a\u522b\uff1f","text":"<p>notify\u4f1a\u6839\u636eJVM\u5177\u4f53\u5b9e\u73b0\uff0c\u5524\u9192\u591a\u4e2a\u7ebf\u7a0b\u4e2d\u7684\u5176\u4e2d\u4e00\u4e2a\uff1b notifyAll\u4f1a\u5524\u9192\u5728\u9501\u7684\u7b49\u5f85\u6c60\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\uff0c\u7ee7\u7eed\u6267\u884c\u3002</p>"},{"location":"java/class/class-basic/#_1","title":"\u62bd\u8c61\u7c7b\u80fd\u5426\u5b9e\u4f8b\u5316\uff1f","text":"<p>\u62bd\u8c61\u7c7b\u53ef\u4ee5\u5b9e\u4f8b\u5316\uff0c\u53ea\u662f\u65b9\u5f0f\u548c\u666e\u901a\u7c7b\u4e0d\u540c\u3002\u5b9e\u4f8b\u5316\u65f6\u9700\u8981\u5b9e\u73b0\u62bd\u8c61\u65b9\u6cd5\u3002 <pre><code>    static abstract class AbsClass {\n        void print(String input) {\n            System.out.println(\"AbsClass print: \" + input);\n        }\n    }\n\n    public static void main(String[] args) {\n        AbsClass absClass1 = new AbsClass() {\n        };\n        absClass1.print(\"demo1\");\n        AbsClass absClass2 = new AbsClass() {\n            @Override\n            void print(String input) {\n                super.print(input);\n                System.out.println(\"absClass2 print: \" + input);\n            }\n        };\n        absClass2.print(\"demo2\");\n    }\n\n/*****\nAbsClass print: demo1\nAbsClass print: demo2\nabsClass2 print: demo2\n******/\n</code></pre></p> <p>\u7c7b\u7684\u521d\u59cb\u5316\u987a\u5e8f\u4f9d\u6b21\u662f\uff08\u9759\u6001\u53d8\u91cf\u3001\u9759\u6001\u4ee3\u7801\u5757\uff09&gt;\uff08\u53d8\u91cf\u3001\u4ee3\u7801\u5757\uff09&gt;\u6784\u9020\u65b9\u6cd5</p>"},{"location":"java/class/class-basic/#java3class","title":"\u4e00\u4e2aJava\u6587\u4ef6\u67093\u4e2a\u7c7b\uff0c\u7f16\u8bd1\u540e\u6709\u51e0\u4e2aclass\u6587\u4ef6","text":"<p>\u7f16\u8bd1\u540e\u67093\u4e2aclass\u6587\u4ef6\u3002 \u6709\u51e0\u4e2a\u7c7b\u5c31\u6709\u51e0\u4e2aclass\u6587\u4ef6\u3002</p>"},{"location":"java/class/class-basic/#overload","title":"\u91cd\u8f7d\uff08Overload\uff09","text":"<p>\u8981\u91cd\u8f7d\u4e00\u4e2a\u65b9\u6cd5\uff0c\u9664\u4e86\u8981\u4e0e\u539f\u65b9\u6cd5\u5177\u6709\u76f8\u540c\u7684\u7b80\u5355\u540d\u79f0\u4e4b\u5916\uff0c\u8fd8\u8981\u6c42\u5fc5\u987b\u62e5\u6709\u4e00\u4e2a\u4e0e\u539f\u65b9\u6cd5\u4e0d\u540c\u7684\u7279\u5f81\u7b7e\u540d\u3002\u7279\u5f81\u7b7e\u540d\u5c31\u662f\u4e00\u4e2a\u65b9\u6cd5\u4e2d\u5404\u4e2a\u53c2\u6570\u5728\u5e38\u91cf\u6c60\u4e2d\u7684\u5b57\u6bb5\u7b26\u53f7\u5f15\u7528\u7684\u96c6\u5408\uff0c\u4e5f\u5c31\u662f\u56e0\u4e3a\u8fd4\u56de\u503c\u4e0d\u4f1a\u5305\u542b\u5728\u7279\u5f81\u7b7e\u540d\u4e2d\uff0c\u56e0\u6b64Java\u8bed\u8a00\u91cc\u9762\u662f\u65e0\u6cd5\u4ec5\u4ec5\u4f9d\u9760\u8fd4\u56de\u503c\u7684\u4e0d\u540c\u6765\u5bf9\u4e00\u4e2a\u5df2\u6709\u65b9\u6cd5\u8fdb\u884c\u91cd\u8f7d\u7684\u3002</p> <p>Java\u4ee3\u7801\u7684\u65b9\u6cd5\u7279\u5f81\u7b7e\u540d\u53ea\u5305\u62ec\u4e86\u65b9\u6cd5\u540d\u79f0\u3001\u53c2\u6570\u987a\u5e8f\u53ca\u53c2\u6570\u7c7b\u578b\uff1b\u800c\u5b57\u8282\u7801\u7684\u7279\u5f81\u7b7e\u540d\u8fd8\u5305\u62ec\u65b9\u6cd5\u8fd4\u56de\u503c\u4ee5\u53ca\u53d7\u67e5\u5f02\u5e38\u8868\u3002</p>"},{"location":"java/class/class-init-step/","title":"Java\u7c7b\u521d\u59cb\u5316\u987a\u5e8f","text":"<p>\u7c7b\u521d\u59cb\u5316\u9636\u6bb5\u662f\u7c7b\u52a0\u8f7d\u8fc7\u7a0b\u7684\u6700\u540e\u4e00\u6b65\u3002\u521d\u59cb\u5316\u9636\u6bb5\uff0c\u5f00\u59cb\u6267\u884cJava\u4ee3\u7801\uff08\u6216\u8005\u8bf4\u5b57\u8282\u7801\uff09\u3002</p> <p>\u521d\u59cb\u5316\u9636\u6bb5\u662f\u6267\u884c<code>&lt;clinit&gt;()</code>\u65b9\u6cd5\u7684\u8fc7\u7a0b\u3002\u8fd9\u4e2a\u65b9\u6cd5\u7531\u7f16\u8bd1\u5668\u81ea\u52a8\u6536\u96c6\u7c7b\u4e2d\u7684\u6240\u6709\u7c7b\u53d8\u91cf\u7684\u8d4b\u503c\u52a8\u4f5c\u548c\u9759\u6001\u8bed\u53e5\u5757\u4e2d\u7684\u8bed\u53e5\u5408\u5e76\u4ea7\u751f\u7684\u3002\u7f16\u8bd1\u5668\u6536\u96c6\u7684\u987a\u5e8f\u662f\u7531\u8bed\u53e5\u5728\u6e90\u6587\u4ef6\u4e2d\u51fa\u73b0\u7684\u987a\u5e8f\u51b3\u5b9a\u7684\u3002 \u5982\u679c\u591a\u4e2a\u7ebf\u7a0b\u53bb\u540c\u65f6\u53bb\u521d\u59cb\u5316\u4e00\u4e2a\u7c7b\uff0c\u90a3\u4e48\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u53bb\u6267\u884c\u8fd9\u4e2a\u7c7b\u7684<code>&lt;clinit&gt;()</code>\u65b9\u6cd5\uff0c\u5176\u4ed6\u7ebf\u7a0b\u90fd\u4f1a\u963b\u585e\u7b49\u5f85\uff0c\u76f4\u5230\u6d3b\u52a8\u7ebf\u7a0b<code>&lt;clinit&gt;()</code>\u65b9\u6cd5\u6267\u884c\u5b8c\u6bd5\u3002 \u540c\u4e00\u4e2a\u7c7b\u52a0\u8f7d\u5668\u4e0b\uff0c\u4e00\u4e2a\u7c7b\u578b\u53ea\u4f1a\u521d\u59cb\u5316\u4e00\u6b21\u3002</p> <p>\u987a\u5e8f\u662f\uff1a</p> <ul> <li>\u57fa\u7c7b</li> <li>\u9759\u6001\u4ee3\u7801\u5757</li> <li>\u9759\u6001\u6210\u5458\u5b57\u6bb5\uff08\u6309\u5148\u540e\u987a\u5e8f\uff09</li> <li>\u5b50\u7c7b\uff08\u6d3e\u751f\u7c7b\uff09</li> <li>\u9759\u6001\u4ee3\u7801\u5757</li> <li>\u9759\u6001\u6210\u5458\u53d8\u91cf</li> </ul>"},{"location":"java/class/equals-and-equal/","title":"Java equals\u65b9\u6cd5\u4e0e<code>==</code>\u7684\u533a\u522b","text":"<p>equals\u8868\u793a\u5bf9\u8c61\u5185\u5bb9\u76f8\u7b49\u3002<code>==</code>\u8868\u793a\u503c\u76f8\u7b49\u3002</p> <p><code>==</code>\u64cd\u4f5c\u7b26\u7684\u4f5c\u7528\uff1a\u6bd4\u8f83\u4e24\u4e2a\uff08\u6570\uff09\u503c\u662f\u5426\u76f8\u7b49\u3002\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7528 <code>==</code> \u5bf9\u4e8e\u5f15\u7528\u6570\u636e\u7c7b\u578b\uff0c\u5bf9\u8c61\u3002\u5224\u65ad\u4e24\u4e2a\u5f15\u7528\u662f\u5426\u6307\u5411\u5806\u5185\u5b58\u4e2d\u7684\u540c\u6837\u5730\u5740\u3002 \u5224\u65ad\u4e24\u4e2a\u5f15\u7528\u6570\u636e\u7c7b\u578b\u7684\u5185\u5bb9\u662f\u5426\u76f8\u7b49\uff0c\u4e0d\u7528<code>==</code>\u3002 <pre><code>User u1 = new User();\nUser u2 = new User();\nUser u3 = u1;        //u1\u548cu3\u6307\u5411\u7684\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61\n</code></pre></p>"},{"location":"java/class/equals-and-equal/#_1","title":"\u4ec0\u4e48\u662f\u5bf9\u8c61\u5185\u5bb9\u76f8\u7b49\uff1f","text":"<p>\u4e24\u4e2a\u5bf9\u8c61\u7c7b\u578b\u76f8\u540c\uff08\u53ef\u4ee5\u4f7f\u7528instanceof\u64cd\u4f5c\u7b26\u8fdb\u884c\u6bd4\u8f83\uff09\uff1b\u5e76\u4e14\u4e24\u4e2a\u5bf9\u8c61\u7684\u6210\u5458\u53d8\u91cf\u7684\u503c\u5b8c\u5168\u76f8\u540c\u3002 <pre><code>public class JavaEqual {\n\n    public static void main(String args[]) {\n        User u1 = new User();\n        User u2 = new User();\n        User u3 = u1;  //u1\u548cu3\u6307\u5411\u7684\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61\n        System.out.println(\"u1 = u3? \" + (u1 == u3));// true\n        System.out.println(\"u2 = u1? \" + (u2 == u1));// false\n\n        u1.name = \"Tom\";  //\u7ed9\u5404\u4e2a\u5bf9\u8c61\u90fd\u8d4b\u4e88\u4e86\u5185\u5bb9\n        u1.age = 3;\n        u2.name = \"u2\";\n        u2.age = 8;\n        u3.name = \"Tom\";\n        u3.age = 3;\n        //\u8d4b\u4e88\u5185\u5bb9\u540e\u518d\u8fdb\u884cequals\u6bd4\u8f83\uff0c\u5c31\u4e0d\u4f1a\u51fa\u73b0\u7a7a\u6307\u9488\u7684\u95ee\u9898\n        System.out.println(u1.equals(u2));// false\n        System.out.println(u1.equals(u3));// true\n    }\n}\n\nclass User {\n    String name;\n    int age;\n\n    public boolean equals(Object obj) {\n        if (this == obj) //\u80fd\u8c03\u7528\u8fd9\u4e2aequals\u7684\u662fUser\u7c7b\u578b\n            return true; //\u8fd9\u91cc\u7684this\u5c31\u662fUser\u7c7b\u578b\n        if (obj instanceof User) {\n            User u = (User) obj;        //\u5411\u4e0b\u8f6c\u578b\u4e3aUser\u578b\n            return (this.age == u.age &amp;&amp; this.name.equals(u.name));\n        } else\n            return false;\n    }\n}\n</code></pre></p>"},{"location":"java/class/equals-and-equal/#equals","title":"\u8986\u76d6equals\u65f6\u9700\u8981\u9075\u5b88\u7684\u901a\u7528\u7ea6\u5b9a","text":"<p>\u8986\u76d6equals\u65b9\u6cd5\u770b\u8d77\u6765\u4f3c\u4e4e\u5f88\u7b80\u5355\uff0c\u4f46\u662f\u5982\u679c\u8986\u76d6\u4e0d\u5f53\u4f1a\u5bfc\u81f4\u9519\u8bef\uff0c\u5e76\u4e14\u540e\u679c\u76f8\u5f53\u4e25\u91cd\u3002 \u300aEffective Java\u300b\u4e00\u4e66\u4e2d\u63d0\u5230\u201c\u6700\u5bb9\u6613\u907f\u514d\u8fd9\u7c7b\u95ee\u9898\u7684\u529e\u6cd5\u5c31\u662f\u4e0d\u8986\u76d6equals\u65b9\u6cd5\u201d\uff0c\u7c7b\u7684\u6bcf\u4e2a\u5b9e\u4f8b\u90fd\u53ea\u4e0e\u5b83\u81ea\u8eab\u76f8\u7b49\u3002 \u5982\u679c\u6ee1\u8db3\u4e86\u4ee5\u4e0b\u4efb\u4f55\u4e00\u4e2a\u6761\u4ef6\uff0c\u8fd9\u5c31\u6b63\u662f\u6240\u671f\u671b\u7684\u7ed3\u679c\uff1a</p> <ul> <li>\u7c7b\u7684\u6bcf\u4e2a\u5b9e\u4f8b\u672c\u8d28\u4e0a\u90fd\u662f\u552f\u4e00\u7684\u3002\u5bf9\u4e8e\u4ee3\u8868\u6d3b\u52a8\u5b9e\u4f53\u800c\u4e0d\u662f\u503c\u7684\u7c7b\u6765\u8bf4\u5374\u662f\u5982\u6b64\uff0c\u4f8b\u5982Thread\u3002Object\u63d0\u4f9b\u7684equals\u5b9e\u73b0\u5bf9\u4e8e\u8fd9\u4e9b\u7c7b\u6765\u8bf4\u6b63\u662f\u6b63\u786e\u7684\u884c\u4e3a\u3002</li> <li>\u4e0d\u5173\u5fc3\u7c7b\u662f\u5426\u63d0\u4f9b\u4e86\u201c\u903b\u8f91\u76f8\u7b49\u201d\u7684\u6d4b\u8bd5\u529f\u80fd\u3002\u5047\u5982Random\u8986\u76d6\u4e86equals\uff0c\u4ee5\u68c0\u67e5\u4e24\u4e2aRandom\u5b9e\u4f8b\u662f\u5426\u4ea7\u751f\u76f8\u540c\u7684\u968f\u673a\u6570\u5e8f\u5217\uff0c\u4f46\u662f\u8bbe\u8ba1\u8005\u5e76\u4e0d\u8ba4\u4e3a\u5ba2\u6237\u9700\u8981\u6216\u8005\u671f\u671b\u8fd9\u6837\u7684\u529f\u80fd\u3002\u8fd9\u65f6\uff0c\u4eceObject\u7ee7\u627f\u5f97\u5230\u7684equals\u5b9e\u73b0\u5df2\u7ecf\u8db3\u591f\u4e86\u3002</li> <li>\u8d85\u7c7b\u5df2\u7ecf\u8986\u76d6\u4e86equals\uff0c\u4ece\u8d85\u7c7b\u7ee7\u627f\u8fc7\u6765\u7684\u884c\u4e3a\u5bf9\u4e8e\u5b50\u7c7b\u4e5f\u662f\u5408\u9002\u7684\u3002\u5927\u591a\u6570\u7684Set\u5b9e\u73b0\u90fd\u4eceAbstractSet\u7ee7\u627fequals\u5b9e\u73b0\uff0cList\u5b9e\u73b0\u4eceAbstractList\u7ee7\u627fequals\u5b9e\u73b0\uff0cMap\u5b9e\u73b0\u4eceAbstractMap\u7ee7\u627fequals\u5b9e\u73b0\u3002</li> <li>\u7c7b\u662f\u79c1\u6709\u7684\u6216\u8005\u662f\u5305\u7ea7\u79c1\u6709\u7684\uff0c\u53ef\u4ee5\u786e\u5b9a\u5b83\u7684equals\u65b9\u6cd5\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u8c03\u7528\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u65e0\u7591\u662f\u5e94\u8be5\u8986\u76d6equals\u65b9\u6cd5\u7684\uff0c\u4ee5\u9632\u6b62\u5b83\u88ab\u610f\u5916\u8c03\u7528</li> </ul> <pre><code>@Override\npublic boolean equals(Object o){\n  throw new AssertionError(); //Method is never called\n}\n</code></pre>"},{"location":"java/class/equals-and-equal/#equals_1","title":"\u5728\u8986\u76d6equals\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u4f60\u5fc5\u987b\u8981\u9075\u5b88\u5b83\u7684\u901a\u7528\u7ea6\u5b9a\u3002","text":"<p>\u4e0b\u9762\u662f\u7ea6\u5b9a\u7684\u5185\u5bb9\uff0c\u6765\u81eaObject\u7684\u89c4\u8303[JavaSE6]</p> <ul> <li>\u81ea\u53cd\u6027\uff1a\u5bf9\u4e8e\u4efb\u4f55\u975enull\u7684\u5f15\u7528\u503cx\uff0cx.equals(x)\u5fc5\u987b\u8fd4\u56detrue\u3002</li> <li>\u5bf9\u79f0\u6027\uff1a\u5bf9\u4e8e\u4efb\u4f55\u975enull\u7684\u5f15\u7528\u503cx\u548cy\uff0c\u5f53\u4e14\u4ec5\u5f53y.equals(x)\u8fd4\u56detrue\u65f6\uff0cx.equals(y)\u5fc5\u987b\u8fd4\u56detrue</li> <li>\u4f20\u9012\u6027\uff1a\u5bf9\u4e8e\u4efb\u4f55\u975enull\u7684\u5f15\u7528\u503cx\u3001y\u548cz\uff0c\u5982\u679c<code>x.equals(y)==true</code>\uff0c\u5e76\u4e14<code>y.equals(z)==true</code>\uff0c\u90a3\u4e48<code>x.equals(z)==true</code>\u3002</li> <li>\u4e00\u81f4\u6027\uff1a\u5bf9\u4e8e\u4efb\u4f55\u975enull\u7684\u5f15\u7528\u503cx\u548cy\uff0c\u53ea\u8981equals\u7684\u6bd4\u8f83\u64cd\u4f5c\u5728\u5bf9\u8c61\u4e2d\u6240\u7528\u7684\u4fe1\u606f\u6ca1\u6709\u88ab\u4fee\u6539\uff0c\u591a\u6b21\u8c03\u7528\u8be5x.equals(y)\u5c31\u4f1a\u4e00\u76f4\u5730\u8fd4\u56detrue\uff0c\u6216\u8005\u4e00\u81f4\u5730\u8fd4\u56defalse\u3002</li> <li>\u5bf9\u4e8e\u4efb\u4f55\u975enull\u7684\u5f15\u7528\u503cx\uff0cx.equals(null)\u5fc5\u987b\u8fd4\u56defalse\u3002</li> </ul> <p>\u7ed3\u5408\u4ee5\u4e0a\u8981\u6c42\uff0c\u5f97\u51fa\u4e86\u4ee5\u4e0b\u5b9e\u73b0\u9ad8\u8d28\u91cfequals\u65b9\u6cd5\u7684\u8bc0\u7a8d\uff1a</p> <ul> <li>\u4f7f\u7528<code>==</code>\u7b26\u53f7\u68c0\u67e5\u201c\u53c2\u6570\u662f\u5426\u4e3a\u8fd9\u4e2a\u5bf9\u8c61\u7684\u5f15\u7528\u201d\u3002\u5982\u679c\u662f\uff0c\u5219\u8fd4\u56detrue\u3002\u8fd9\u53ea\u4e0d\u8fc7\u662f\u4e00\u79cd\u6027\u80fd\u4f18\u5316\uff0c\u5982\u679c\u6bd4\u8f83\u64cd\u4f5c\u6709\u53ef\u80fd\u5f88\u6602\u8d35\uff0c\u5c31\u503c\u5f97\u8fd9\u4e48\u505a\u3002</li> <li>\u4f7f\u7528instanceof\u64cd\u4f5c\u7b26\u68c0\u67e5\u201c\u53c2\u6570\u662f\u5426\u4e3a\u6b63\u786e\u7684\u7c7b\u578b\u201d\u3002\u5982\u679c\u4e0d\u662f\uff0c\u5219\u8fd4\u56defalse\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u6240\u8c13\u201c\u6b63\u786e\u7684\u7c7b\u578b\u201d\u662f\u6307equals\u65b9\u6cd5\u6240\u5728\u7684\u90a3\u4e2a\u7c7b\u3002</li> <li>\u628a\u53c2\u6570\u8f6c\u6362\u6210\u6b63\u786e\u7684\u7c7b\u578b\u3002\u56e0\u4e3a\u8f6c\u6362\u4e4b\u524d\u8fdb\u884c\u8fc7instanceof\u6d4b\u8bd5\uff0c\u6240\u4ee5\u786e\u4fdd\u4f1a\u6210\u529f\u3002</li> <li>\u5bf9\u4e8e\u8be5\u7c7b\u4e2d\u7684\u6bcf\u4e2a\u201c\u5173\u952e\u201d\u57df\uff0c\u68c0\u67e5\u53c2\u6570\u4e2d\u7684\u57df\u662f\u5426\u4e0e\u8be5\u5bf9\u8c61\u4e2d\u5bf9\u5e94\u7684\u57df\u76f8\u5339\u914d\u3002\u5982\u679c\u8fd9\u4e9b\u6d4b\u8bd5\u5168\u90e8\u6210\u529f\uff0c\u5219\u8fd4\u56detrue;\u5426\u5219\u8fd4\u56defalse\u3002</li> <li>\u5f53\u7f16\u5199\u5b8c\u6210\u4e86equals\u65b9\u6cd5\u4e4b\u540e\uff0c\u68c0\u67e5\u201c\u5bf9\u79f0\u6027\u201d\u3001\u201c\u4f20\u9012\u6027\u201d\u3001\u201c\u4e00\u81f4\u6027\u201d\u3002</li> </ul> <p>\u6ce8\u610f\uff1a\u8986\u76d6equals\u65f6\u603b\u8981\u8986\u76d6hashCode\uff0c\u53c2\u8003\u300aEffective Java\u300b</p> <p>\u4e0d\u8981\u4f01\u56fe\u8ba9equals\u65b9\u6cd5\u8fc7\u4e8e\u667a\u80fd\u3002</p> <p>\u4e0d\u8981\u5c06equals\u58f0\u660e\u4e2d\u7684Object\u5bf9\u8c61\u66ff\u6362\u4e3a\u5176\u4ed6\u7684\u7c7b\u578b\uff08\u56e0\u4e3a\u8fd9\u6837\u6211\u4eec\u5e76\u6ca1\u6709\u8986\u76d6Object\u4e2d\u7684equals\u65b9\u6cd5\u54e6\uff09</p> <p>\u4e00\u4e2a\u5f88\u5e38\u89c1\u7684\u9519\u8bef\u6839\u6e90\u5728\u4e8e\u6ca1\u6709\u8986\u76d6hashCode\u65b9\u6cd5\u3002\u5728\u6bcf\u4e2a\u8986\u76d6\u4e86equals\u65b9\u6cd5\u7684\u7c7b\u4e2d\uff0c\u4e5f\u5fc5\u987b\u8986\u76d6hashCode\u65b9\u6cd5\u3002\u5982\u679c\u4e0d\u8fd9\u6837\u505a\u7684\u8bdd\uff0c\u5c31\u4f1a\u8fdd\u53cdObject.hashCode\u7684\u901a\u7528\u7ea6\u5b9a\uff0c\u4ece\u800c\u5bfc\u81f4\u8be5\u7c7b\u65e0\u6cd5\u7ed3\u5408\u6240\u6709\u57fa\u4e8e\u6563\u5217\u7684\u96c6\u5408\u4e00\u8d77\u6b63\u5e38\u8fd0\u4f5c\uff0c\u8fd9\u6837\u7684\u96c6\u5408\u5305\u62ecHashMap\u3001HashSet\u548cHashtable\u3002</p> <p>\u5728\u5e94\u7528\u7a0b\u5e8f\u7684\u6267\u884c\u671f\u95f4\uff0c\u53ea\u8981\u5bf9\u8c61\u7684equals\u65b9\u6cd5\u7684\u6bd4\u8f83\u64cd\u4f5c\u6240\u7528\u5230\u7684\u4fe1\u606f\u6ca1\u6709\u88ab\u4fee\u6539\uff0c\u90a3\u4e48\u5bf9\u8fd9\u540c\u4e00\u4e2a\u5bf9\u8c61\u8c03\u7528\u591a\u6b21\uff0chashCode\u65b9\u6cd5\u90fd\u5fc5\u987b\u59cb\u7ec8\u5982\u4e00\u5730\u8fd4\u56de\u540c\u4e00\u4e2a\u6574\u6570\u3002\u5728\u540c\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u591a\u6b21\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u6bcf\u6b21\u6267\u884c\u6240\u8fd4\u56de\u7684\u6574\u6570\u53ef\u4ee5\u4e0d\u4e00\u81f4\u3002</p> <p>\u5982\u679c\u4e24\u4e2a\u5bf9\u8c61\u6839\u636eequals()\u65b9\u6cd5\u6bd4\u8f83\u662f\u76f8\u7b49\u7684\uff0c\u90a3\u4e48\u8c03\u7528\u8fd9\u4e24\u4e2a\u5bf9\u8c61\u4e2d\u4efb\u610f\u4e00\u4e2a\u5bf9\u8c61\u7684hashCode\u65b9\u6cd5\u90fd\u5fc5\u987b\u4ea7\u751f\u540c\u6837\u7684\u6574\u6570\u7ed3\u679c\u3002</p> <p>\u5982\u679c\u4e24\u4e2a\u5bf9\u8c61\u6839\u636eequals()\u65b9\u6cd5\u6bd4\u8f83\u662f\u4e0d\u76f8\u7b49\u7684\uff0c\u90a3\u4e48\u8c03\u7528\u8fd9\u4e24\u4e2a\u5bf9\u8c61\u4e2d\u4efb\u610f\u4e00\u4e2a\u5bf9\u8c61\u7684hashCode\u65b9\u6cd5\uff0c\u5219\u4e0d\u4e00\u5b9a\u8981\u4ea7\u751f\u76f8\u540c\u7684\u6574\u6570\u7ed3\u679c\u3002\u4f46\u662f\u7a0b\u5e8f\u5458\u5e94\u8be5\u77e5\u9053\uff0c\u7ed9\u4e0d\u76f8\u7b49\u7684\u5bf9\u8c61\u4ea7\u751f\u622a\u7136\u4e0d\u540c\u7684\u6574\u6570\u7ed3\u679c\uff0c\u6709\u53ef\u80fd\u63d0\u9ad8\u6563\u5217\u8868\u7684\u6027\u80fd\u3002</p>"},{"location":"java/concept/oo/","title":"\u9762\u5411\u5bf9\u8c61\u7684\u7279\u5f81","text":""},{"location":"java/concept/oo/#_2","title":"\u62bd\u8c61\uff0c\u5c01\u88c5\uff0c\u7ee7\u627f\uff0c\u591a\u6001","text":"<p>\u9762\u5411\u5bf9\u8c61\u7684\u7279\u5f81\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\uff1a</p> <ul> <li>\u62bd\u8c61\uff1a\u62bd\u8c61\u662f\u5c06\u4e00\u7c7b\u5bf9\u8c61\u7684\u5171\u540c\u7279\u5f81\u603b\u7ed3\u51fa\u6765\u6784\u9020\u7c7b\u7684\u8fc7\u7a0b\uff0c\u5305\u62ec\u6570\u636e\u62bd\u8c61\u548c\u884c\u4e3a\u62bd\u8c61\u4e24\u65b9\u9762\u3002\u62bd\u8c61\u53ea\u5173\u6ce8\u5bf9\u8c61\u6709\u54ea\u4e9b\u5c5e\u6027\u548c\u884c\u4e3a\uff0c\u5e76\u4e0d\u5173\u6ce8\u8fd9\u4e9b\u884c\u4e3a\u7684\u7ec6\u8282\u662f\u4ec0\u4e48\u3002</li> <li>\u7ee7\u627f\uff1a\u7ee7\u627f\u662f\u4ece\u5df2\u6709\u7c7b\u5f97\u5230\u7ee7\u627f\u4fe1\u606f\u521b\u5efa\u65b0\u7c7b\u7684\u8fc7\u7a0b\u3002\u63d0\u4f9b\u7ee7\u627f\u4fe1\u606f\u7684\u7c7b\u88ab\u79f0\u4e3a\u7236\u7c7b\uff08\u8d85\u7c7b\u3001\u57fa\u7c7b\uff09\uff1b\u5f97\u5230\u7ee7\u627f\u4fe1\u606f\u7684\u7c7b\u88ab\u79f0\u4e3a\u5b50\u7c7b\uff08\u6d3e\u751f\u7c7b\uff09\u3002\u7ee7\u627f\u8ba9\u53d8\u5316\u4e2d\u7684\u8f6f\u4ef6\u7cfb\u7edf\u6709\u4e86\u4e00\u5b9a\u7684\u5ef6\u7eed\u6027\uff0c\u540c\u65f6\u7ee7\u627f\u4e5f\u662f\u5c01\u88c5\u7a0b\u5e8f\u4e2d\u53ef\u53d8\u56e0\u7d20\u7684\u91cd\u8981\u624b\u6bb5\uff08\u5982\u679c\u4e0d\u80fd\u7406\u89e3\u8bf7\u9605\u8bfb\u960e\u5b8f\u535a\u58eb\u7684\u300aJava\u4e0e\u6a21\u5f0f\u300b\u6216\u300a\u8bbe\u8ba1\u6a21\u5f0f\u7cbe\u89e3\u300b\u4e2d\u5173\u4e8e\u6865\u6881\u6a21\u5f0f\u7684\u90e8\u5206\uff09\u3002</li> <li>\u5c01\u88c5\uff1a\u901a\u5e38\u8ba4\u4e3a\u5c01\u88c5\u662f\u628a\u6570\u636e\u548c\u64cd\u4f5c\u6570\u636e\u7684\u65b9\u6cd5\u7ed1\u5b9a\u8d77\u6765\uff0c\u5bf9\u6570\u636e\u7684\u8bbf\u95ee\u53ea\u80fd\u901a\u8fc7\u5df2\u5b9a\u4e49\u7684\u63a5\u53e3\u3002\u9762\u5411\u5bf9\u8c61\u7684\u672c\u8d28\u5c31\u662f\u5c06\u73b0\u5b9e\u4e16\u754c\u63cf\u7ed8\u6210\u4e00\u7cfb\u5217\u5b8c\u5168\u81ea\u6cbb\u3001\u5c01\u95ed\u7684\u5bf9\u8c61\u3002\u6211\u4eec\u5728\u7c7b\u4e2d\u7f16\u5199\u7684\u65b9\u6cd5\u5c31\u662f\u5bf9\u5b9e\u73b0\u7ec6\u8282\u7684\u4e00\u79cd\u5c01\u88c5\uff1b\u6211\u4eec\u7f16\u5199\u4e00\u4e2a\u7c7b\u5c31\u662f\u5bf9\u6570\u636e\u548c\u6570\u636e\u64cd\u4f5c\u7684\u5c01\u88c5\u3002\u53ef\u4ee5\u8bf4\uff0c\u5c01\u88c5\u5c31\u662f\u9690\u85cf\u4e00\u5207\u53ef\u9690\u85cf\u7684\u4e1c\u897f\uff0c\u53ea\u5411\u5916\u754c\u63d0\u4f9b\u6700\u7b80\u5355\u7684\u7f16\u7a0b\u63a5\u53e3\u3002</li> <li>\u591a\u6001\u6027\uff1a\u7a0b\u5e8f\u4e2d\u5b9a\u4e49\u7684\u5f15\u7528\u53d8\u91cf\u6240\u6307\u5411\u7684\u5177\u4f53\u7c7b\u578b\u548c\u901a\u8fc7\u8be5\u5f15\u7528\u53d8\u91cf\u53d1\u51fa\u7684\u65b9\u6cd5\u8c03\u7528\u5728\u7f16\u7a0b\u65f6\u5e76\u4e0d\u786e\u5b9a\uff0c\u800c\u662f\u5728\u7a0b\u5e8f\u8fd0\u884c\u671f\u95f4\u624d\u786e\u5b9a\uff1b\u4e0d\u4fee\u6539\u7a0b\u5e8f\u4ee3\u7801\u5c31\u53ef\u4ee5\u6539\u53d8\u7a0b\u5e8f\u8fd0\u884c\u65f6\u6240\u7ed1\u5b9a\u7684\u5177\u4f53\u4ee3\u7801\uff0c\u8ba9\u7a0b\u5e8f\u53ef\u4ee5\u9009\u62e9\u591a\u4e2a\u8fd0\u884c\u72b6\u6001</li> </ul>"},{"location":"java/concept/oo/#_3","title":"\u591a\u6001","text":"<p>\u591a\u6001\u5c31\u662f\u6307\u7a0b\u5e8f\u4e2d\u5b9a\u4e49\u7684\u5f15\u7528\u53d8\u91cf\u6240\u6307\u5411\u7684\u5177\u4f53\u7c7b\u578b\u548c\u901a\u8fc7\u8be5\u5f15\u7528\u53d8\u91cf\u53d1\u51fa\u7684\u65b9\u6cd5\u8c03\u7528\u5728\u7f16\u7a0b\u65f6\u5e76\u4e0d\u786e\u5b9a\uff0c\u800c\u662f\u5728\u7a0b\u5e8f\u8fd0\u884c\u671f\u95f4\u624d\u786e\u5b9a\u3002\u5373\u4e00\u4e2a\u5f15\u7528\u53d8\u91cf\u5230\u5e95\u4f1a\u6307\u5411\u54ea\u4e2a\u7c7b\u7684\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u8be5\u5f15\u7528\u53d8\u91cf\u53d1\u51fa\u7684\u65b9\u6cd5\u8c03\u7528\u5230\u5e95\u662f\u54ea\u4e2a\u7c7b\u4e2d\u5b9e\u73b0\u7684\u65b9\u6cd5\uff0c\u5fc5\u987b\u5728\u7531\u7a0b\u5e8f\u8fd0\u884c\u671f\u95f4\u624d\u80fd\u51b3\u5b9a\u3002</p> <p>\u56e0\u4e3a\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u624d\u786e\u5b9a\u5177\u4f53\u7684\u7c7b\uff0c\u8fd9\u6837\uff0c\u4e0d\u7528\u4fee\u6539\u6e90\u7a0b\u5e8f\u4ee3\u7801\uff0c\u5c31\u53ef\u4ee5\u8ba9\u5f15\u7528\u53d8\u91cf\u7ed1\u5b9a\u5230\u5404\u79cd\u4e0d\u540c\u7684\u7c7b\u5b9e\u73b0\u4e0a\uff0c\u8be5\u5f15\u7528\u8c03\u7528\u7684\u5177\u4f53\u65b9\u6cd5\u4e5f\u968f\u4e4b\u6539\u53d8\u3002\u5373\u4e0d\u4fee\u6539\u7a0b\u5e8f\u4ee3\u7801\u5c31\u53ef\u4ee5\u6539\u53d8\u7a0b\u5e8f\u8fd0\u884c\u65f6\u6240\u7ed1\u5b9a\u7684\u5177\u4f53\u4ee3\u7801\uff0c\u8ba9\u7a0b\u5e8f\u53ef\u4ee5\u9009\u62e9\u591a\u4e2a\u8fd0\u884c\u72b6\u6001\uff0c\u8fd9\u5c31\u662f\u591a\u6001\u6027\u3002</p>"},{"location":"java/concurrent/Java-read-write-lock-use/","title":"Java \u8bfb\u5199\u9501","text":"<p>\u53ef\u540c\u65f6\u8bfb\uff0c\u8bfb\u7684\u65f6\u5019\u4e0d\u80fd\u5199\uff0c\u5199\u7684\u65f6\u5019\u4e0d\u80fd\u8bfb\u3002\u8bfb-\u5199\u9501\u5b9e\u73b0\u7684\u52a0\u9501\u7b56\u7565\u4e2d\uff0c\u5141\u8bb8\u591a\u4e2a\u8bfb\u64cd\u4f5c\u540c\u65f6\u8fdb\u884c\uff0c\u4f46\u6bcf\u6b21\u53ea\u5141\u8bb8\u4e00\u4e2a\u5199\u64cd\u4f5c\u3002</p>"},{"location":"java/concurrent/Java-read-write-lock-use/#reentrantreadwritelockmap","title":"\u4f7f\u7528<code>ReentrantReadWriteLock</code>\u5c01\u88c5\u7684<code>Map</code>\u793a\u4f8b","text":"<p><code>ReentrantReadWriteLock</code>\u5728\u6784\u9020\u65f6\u53ef\u4ee5\u9009\u62e9\u662f\u5426\u4e3a\u516c\u5e73\u9501\u3002 \u8fd9\u91cc\u7ed9\u51fa\u4e00\u4e2a<code>ReentrantReadWriteLock</code>\u5c01\u88c5\u7684<code>Map</code>\u7684\u793a\u4f8b\u3002</p> <p><pre><code>import java.util.Map;\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReadWriteLock;\nimport java.util.concurrent.locks.ReentrantReadWriteLock;\n\n/**\n * \u4f7f\u7528ReentrantReadWriteLock\u5c01\u88c5\u7684Map\n */\npublic class ReadWriteMap&lt;K, V&gt; {\n    private final Map&lt;K, V&gt; map; // \u5f53\u7136\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c01\u88c5\u4e00\u4e9b\u522b\u7684\u96c6\u5408\u7c7b\n    private final ReadWriteLock lock = new ReentrantReadWriteLock();\n    private final Lock r = lock.readLock();\n    private final Lock w = lock.writeLock();\n\n    public ReadWriteMap(Map&lt;K, V&gt; map) {\n        this.map = map;\n    }\n\n    public V put(K key, V value) {\n        w.lock();\n        System.out.println(Thread.currentThread() + \" is putting.\"); // for debug\n        try {\n            return map.put(key, value);\n        } finally {\n            w.unlock();\n        }\n    }\n\n    public V get(Object key) {\n        r.lock();\n        try {\n            return map.get(key);\n        } finally {\n            r.unlock();\n        }\n    }\n\n}\n</code></pre> \u5bf9<code>remove()</code>\uff0c<code>putAll()</code>\uff0c<code>clear()</code>\u7b49\u65b9\u6cd5\u6267\u884c\u76f8\u540c\u7684\u64cd\u4f5c\u3002</p> <p>\u6d4b\u8bd5\u4ee3\u7801 <pre><code>public class ReadWriteLockDemo {\n\n    public static void main(String[] args) {\n        final ReadWriteMap&lt;String, String&gt; map = new ReadWriteMap&lt;&gt;(new HashMap&lt;&gt;());\n        map.put(\"one\", \"init value\");\n        for (int i = 1; i &lt;= 4; i++) {\n            new WorkThread(map).start();\n        }\n    }\n\n    // \u6a21\u62df\u5de5\u4f5c\u7684\u7ebf\u7a0b\n    static class WorkThread extends Thread {\n\n        private ReadWriteMap&lt;String, String&gt; map;\n\n        public WorkThread(ReadWriteMap&lt;String, String&gt; map) {\n            this.map = map;\n        }\n\n        @Override\n        public void run() {\n            for (int i = 1; i &lt;= 2; i++) {\n                try {\n                    System.out.println(this.toString() + \" read out: \" + map.get(\"one\"));\n                    map.put(\"one\", this.toString() + System.currentTimeMillis());\n                    Thread.sleep(2);\n                    System.out.println(this.toString() + \" read out: \" + map.get(\"one\"));\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n\n}\n\n/* \u90e8\u5206\u8f93\u51fa\nThread[main,5,main] is putting.\nThread[Thread-1,5,main] read out: init value\nThread[Thread-2,5,main] read out: init value\nThread[Thread-1,5,main] is putting.\nThread[Thread-2,5,main] is putting.\nThread[Thread-3,5,main] read out: Thread[Thread-2,5,main]1536664817446\nThread[Thread-3,5,main] is putting.\nThread[Thread-0,5,main] read out: Thread[Thread-3,5,main]1536664817446\nThread[Thread-0,5,main] is putting.\nThread[Thread-2,5,main] read out: Thread[Thread-0,5,main]1536664817447\nThread[Thread-2,5,main] read out: Thread[Thread-0,5,main]1536664817447\nThread[Thread-3,5,main] read out: Thread[Thread-0,5,main]1536664817447\n*/\n</code></pre></p> <p>ReentrantLock\u4e0d\u80fd\u5b8c\u5168\u66ff\u4ee3synchronized\uff0c\u53ea\u6709\u5728synchronized\u65e0\u6cd5\u6ee1\u8db3\u9700\u6c42\u65f6\uff0c\u624d\u5e94\u8be5\u4f7f\u7528\u5b83\u3002</p> <p>\u8bfb-\u5199\u9501\u5141\u8bb8\u591a\u4e2a\u8bfb\u7ebf\u7a0b\u5e76\u53d1\u5730\u8bbf\u95ee\u88ab\u4fdd\u62a4\u7684\u5bf9\u8c61\uff0c\u5f53\u8bbf\u95ee\u4ee5\u8bfb\u53d6\u64cd\u4f5c\u4e3a\u4e3b\u7684\u6570\u636e\u7ed3\u6784\u65f6\uff0c \u5b83\u80fd\u63d0\u9ad8\u7a0b\u5e8f\u7684\u53ef\u4f38\u7f29\u6027\u3002</p>"},{"location":"java/concurrent/Java-read-write-lock-use/#_1","title":"\u53c2\u8003","text":"<ul> <li>\u300aJava\u5e76\u53d1\u7f16\u7a0b\u5b9e\u6218\u300b Java Concurrency in Practice</li> </ul>"},{"location":"java/container/Java-Container/","title":"Java\u96c6\u5408\u7c7b","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-5-18 <ul> <li>2022-5-18 \u66f4\u65b0\u683c\u5f0f</li> <li>2022-1-18 \u4fee\u6539\u8bf4\u660e</li> <li>2015-04-28 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u5de5\u5177\u4e0e\u73af\u5883\uff1a</p> <ul> <li>jdk1.7.0_79</li> <li>idea</li> </ul> <p>Java\u96c6\u5408\u7c7b\u53ef\u5206\u4e3a\u4e24\u5927\u7c7b\uff0c\u4e00\u7c7b\u662f\u7ee7\u627f\u6216\u5b9e\u73b0Collection\u63a5\u53e3\uff0c\u8fd9\u7c7b\u96c6\u5408\u5305\u542bList\u3001Set\u548cQueue\u7b49\u96c6\u5408\u7c7b\u3002\u53e6\u4e00\u7c7b\u662f\u7ee7\u627f\u6216\u5b9e\u73b0Map\u63a5\u53e3\uff0c\u8fd9\u4e3b\u8981\u5305\u542b\u4e86\u54c8\u5e0c\u8868\u76f8\u5173\u7684\u96c6\u5408\u7c7b\u3002</p>"},{"location":"java/container/Java-Container/#collectionmap","title":"\u57fa\u672c\u7ed3\u6784\uff1aCollection\u4e0eMap","text":"<p>\u4e24\u4e2a\u4e0d\u540c\u7684\u6982\u5ff5\uff1a</p> <p>Collection \u4e00\u4e2a\u72ec\u7acb\u5143\u7d20\u7684\u5e8f\u5217\uff0c\u8fd9\u4e9b\u5143\u7d20\u90fd\u670d\u4ece\u4e00\u6761\u6216\u591a\u6761\u89c4\u5219\u3002List\u5fc5\u987b\u6309\u7167\u63d2\u5165\u7684\u987a\u5e8f\u4fdd\u6301\u5143\u7d20\uff1bSet\u4e0d\u80fd\u6709\u91cd\u590d\u5143\u7d20\u3002Queue\u6309\u7167\u6392\u961f\u89c4\u5219\u6765\u786e\u5b9a\u5bf9\u8c61\u4ea7\u751f\u7684\u987a\u5e8f\u3002</p> <p>Map \u4e00\u7ec4\u6210\u5bf9\u7684\u201c\u952e\u503c\u5bf9\u201d\u5bf9\u8c61\uff0c\u5141\u8bb8\u4f60\u4f7f\u7528\u952e\u6765\u67e5\u627e\u503c\u3002ArrayList\u5141\u8bb8\u4f60\u4f7f\u7528\u6570\u5b57\u6765\u67e5\u627e\u503c\uff0c\u56e0\u6b64\u67d0\u79cd\u610f\u4e49\u4e0a\u8bb2\uff0c \u5b83\u5c06\u6570\u5b57\u548c\u5bf9\u8c61\u5173\u8054\u5728\u4e00\u8d77\u3002\u6620\u5c04\u8868\u5141\u8bb8\u6211\u4eec\u4f7f\u7528\u53e6\u4e00\u4e2a\u5bf9\u8c61\u6765\u67e5\u627e\u67d0\u4e2a\u5bf9\u8c61\uff0c\u4e5f\u88ab\u79f0\u4e3a\u201c\u5173\u8054\u6570\u7ec4\u201d\uff1b \u6216\u8005\u88ab\u79f0\u4e3a\u201c\u5b57\u5178\u201d\uff0c\u56e0\u4e3a\u53ef\u4ee5\u4f7f\u7528\u952e\u5bf9\u8c61\u6765\u67e5\u627e\u503c\u5bf9\u8c61</p> <p>Collection\u76f8\u5173\u7684\u7c7b</p> <p></p> <p>Map\u76f8\u5173\u7684\u7c7b</p> <p></p> <p>Java\u6709\u591a\u79cd\u65b9\u5f0f\u4fdd\u5b58\u5bf9\u8c61\uff08\u5bf9\u8c61\u7684\u5f15\u7528\uff09\u3002</p> <p>\u5bb9\u5668\u7c7b\uff1aList    Set    Queue    Map  </p> <p>\u5bb9\u5668\u7684\u4e00\u4e9b\u7279\u6027\uff1aSet\u5bf9\u4e8e\u6bcf\u4e2a\u503c\u90fd\u53ea\u4fdd\u5b58\u4e00\u4e2a\u5bf9\u8c61\uff0cMap\u5141\u8bb8\u5c06\u67d0\u4e9b\u5bf9\u8c61\u4e0e\u5176\u4ed6\u4e00\u4e9b\u5bf9\u8c61\u5173\u8054\u8d77\u6765\u3002</p> <p>\u4f8b\u5982<code>ArrayList</code>\u4fdd\u5b58\u7684\u662f<code>Object</code>\u3002\u5728\u4f7f\u7528<code>get()</code>\u65b9\u6cd5\u53d6\u51fa\u5bf9\u8c61\u65f6\uff0c\u5fc5\u987b\u5c06\u5176\u8f6c\u578b\u4e3a\u4fdd\u5b58\u7684\u5bf9\u8c61\u3002 <pre><code>import java.util.ArrayList;\n\n/**\n * Created by Rust Fisher on 15-10-28.\n */\nclass Apple {\n    private static long counter;\n    private final long id = counter++;\n    public long id() {return id;}\n}\nclass Gala extends Apple{}\nclass RedFuShi extends Apple {}\nclass Orange {\n    private static long counter;\n    private final long id = counter++;\n    /*\u590d\u5199toString\u65b9\u6cd5*/\n    @Override\n    public String toString() {\n        return \"Orange{\" +\n                \"id=\" + id +\n                '}';\n    }\n}\n\nclass Gerbil {\n    private static int counter;\n    private final int gerbilNumber = counter++;\n    public void hop(){\n        System.out.println(gerbilNumber + \" is jumping\");\n    }\n}\n\npublic class ApplesAndOrangeWithoutGenerics {\n    public static void main(String args[]){\n        ArrayList&lt;Apple&gt; apples = new ArrayList&lt;Apple&gt;();/*\u4f7f\u7528\u6cdb\u578b\u6765\u521b\u5efa*/\n        for (int i = 0;i &lt; 3;i++){\n            apples.add(new Apple());/*\u6dfb\u52a0Apple*/\n        }\n        apples.add(new Gala());/*\u53ef\u4ee5\u5c06Apple\u7684\u5b50\u7c7b\u6dfb\u52a0\u5230\u5bb9\u5668\u4e2d*/\n        apples.add(new RedFuShi());\n        apples.add(new Gala());\n        for (int i = 0;i &lt; apples.size();i++){\n            System.out.print((apples.get(i)).id() + \"\\t\");\n        }\n        System.out.println();\n        for (int i = 0; i &lt; 2;i++) {\n            System.out.print(new Orange() + \" \");\n        }\n        System.out.println();\n        for (Apple a : apples){\n            System.out.print(a + \", \");\n        }\n        System.out.println();\n\n        ArrayList&lt;Gerbil&gt; gerbils = new ArrayList&lt;Gerbil&gt;();\n        for (int i = 0;i &lt; 3;i++){\n            gerbils.add(new Gerbil());\n        }\n\n        for (int i = 0;i &lt; gerbils.size();i++){\n            gerbils.get(i).hop();\n        }\n    }\n}\n</code></pre></p> <p>\u8f93\u51fa\uff1a <pre><code>0   1   2   3   4   5\nOrange{id=0} Orange{id=1}\nApple@2b125a40, Apple@41e335d7, Apple@2be3d80c, Gala@7b7d1256, RedFuShi@503f0b70, Gala@6e1f5438,\n0 is jumping\n1 is jumping\n2 is jumping\n</code></pre></p> <p><code>Apple@56c2c65b</code> \u7a0b\u5e8f\u8f93\u51fa\u662f\u4eceObject\u9ed8\u8ba4\u7684toString\u65b9\u6cd5\u4ea7\u751f\u7684\uff0c\u8be5\u65b9\u6cd5\u6253\u5370\u7c7b\u540d\uff0c\u540e\u9762\u8ddf\u968f\u8be5\u5bf9\u8c61\u7684\u6563\u5217\u7801\uff08\u7531<code>hashCode()</code>\u65b9\u6cd5\u4ea7\u751f\uff09\u7684\u65e0\u7b26\u53f7\u5341\u516d\u8fdb\u5236\u8868\u793a\u3002</p> <pre><code>import java.util.ArrayList;\nimport java.util.Collection;\nimport java.util.HashSet;\n\npublic class SimpleCollection {\n    public static void main(String args[]) {\n        /* \u7528Integer\u5bf9\u8c61\u586b\u5145\u4e86\u4e00\u4e2aCollection */\n        Collection&lt;Integer&gt; c = new HashSet&lt;Integer&gt;() {};\n        Collection&lt;Integer&gt; a = new ArrayList&lt;Integer&gt;() {};\n        for (int i = 0;i &lt; 10;i++){\n            c.add(i);/* Set\u4e0d\u5b58\u653e\u91cd\u590d\u7684\u503c */\n            c.add(i);\n            a.add(i);/* List\u4e0d\u5173\u5fc3\u662f\u5426\u91cd\u590d */\n            a.add(i);\n        }\n        for (Integer i : c){\n            System.out.print(i + \" \");\n        } /* \u6240\u6709\u7684Collection\u90fd\u652f\u6301foreach\u8bed\u53e5 */\n        System.out.println();\n        for (Integer i : a){\n            System.out.print(i + \" \");\n        }\n    }\n}\n</code></pre> <p>\u8f93\u51fa\uff1a <pre><code>0 1 2 3 4 5 6 7 8 9\n0 0 1 1 2 2 3 3 4 4 5 5 6 6 7 7 8 8 9 9\n</code></pre></p>"},{"location":"java/container/Java-Container/#_1","title":"\u6dfb\u52a0\u4e00\u7ec4\u5143\u7d20","text":"<p>\u53ef\u5728Collection\u4e2d\u6dfb\u52a0\u4e00\u7ec4\u5143\u7d20\u3002<code>Collections.addAll()</code>\u65b9\u6cd5\u63a5\u53d7\u4e00\u4e2aCollection\u5bf9\u8c61\u3002 <code>Arrays.asList()</code>\u65b9\u6cd5\u63a5\u53d7\u4e00\u4e2a\u6570\u7ec4\u6216\u4e00\u4e2a\u90fd\u597d\u5206\u9694\u7684\u5143\u7d20\u5217\u8868\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u4e00\u4e2aList\u5bf9\u8c61\u3002 <pre><code>import java.util.*;\n\npublic class AddingGroup {\n    public static void main(String args[]) {\n        Collection&lt;Integer&gt; collection =\n                new ArrayList&lt;&gt;(Arrays.asList(1,2,3,4,5));\n        Integer moreInts[] = {6,7,8,9,10};\n        collection.addAll(Arrays.asList(moreInts));\n        /* \u6dfb\u52a0\u5143\u7d20collection */\n        Collections.addAll(collection,20,30,40);\n        /* \u6dfb\u52a0\u6570\u7ec4 */\n        Collections.addAll(collection,moreInts);\n        for (Integer i : collection){\n            System.out.print(i + \" \");\n        }\n        System.out.println();\n        List&lt;Integer&gt; list = Arrays.asList(31,32,33,34);\n        for (Integer i : list) System.out.print(i + \" \");\n        list.set(1,99);/* \u4fee\u6539\u503c */\n        System.out.println();\n        for (Integer i : list) System.out.print(i + \" \");\n    }\n}\n</code></pre> \u8f93\u51fa\uff1a <pre><code>1 2 3 4 5 6 7 8 9 10 20 30 40 6 7 8 9 10\n31 32 33 34\n31 99 33 34\n</code></pre></p>"},{"location":"java/container/Java-Container/#_2","title":"\u5bb9\u5668\u7684\u6253\u5370","text":"<p>\u5fc5\u987b\u4f7f\u7528Arrays.toString()\u6765\u4ea7\u751f\u6570\u7ec4\u7684\u53ef\u6253\u5370\u8868\u793a \u4e0d\u590d\u5199toString()\u4e5f\u53ef\u4ee5\u5f97\u5230\u53ef\u8bfb\u6027\u597d\u7684\u6253\u5370\u7ed3\u679c\uff1bMap\u4e0eCollection\u6253\u5370\u98ce\u683c\u4e0d\u540c  \u4ee5\u4e0b\u4e3a\u6253\u5370\u793a\u4f8b\uff1a <pre><code>import java.util.*;\n\n/**\n * \u751f\u6210\u540d\u5b57\u7684\u7c7b\n */\nclass GenerateMovieName {\n    int key = 0;\n    public String next() {\n        switch (key){\n            case 0:\n                key++;\n                return \"ONE\";\n            case 1:\n                key++;\n                return \"We were solders\";\n            case 2:\n                key++;\n                return \"Big\";\n            case 3:\n                key++;\n                return \"Wind speaker\";\n            case 4:\n                key++;\n                return \"La\";\n            default:\n            case 5:\n                key = 0;\n                return \"New\";\n        }\n    }\n    /* \u7528\u4e8e\u586b\u5145\u6570\u7ec4 */\n    public void loadNames(String names[]){\n        for (int i = 0;i &lt; names.length;i++){\n            names[i] = next();\n        }\n    }\n    /* \u7528\u4e8e\u586b\u5145\u5bb9\u5668 */\n    public Collection fill(Collection&lt;String&gt; c, int n){\n        for (int i = 0;i &lt; n;i++){\n            c.add(next());\n        }\n        return c;\n    }\n}\n\npublic class PrintingContainers {\n    static Collection fill(Collection&lt;String&gt; collection){\n        collection.add(\"rat\");\n        collection.add(\"cat\");\n        collection.add(\"dog\");\n        collection.add(\"dog\");\n        collection.add(\"house\");\n        return collection;\n    }\n    static Map fill(Map&lt;String, String&gt; map){\n        map.put(\"rat\", \"Jerry\");\n        map.put(\"cat\", \"Tom\");\n        map.put(\"dog\", \"Hou\");\n        map.put(\"dog\", \"Spot\");\n        map.put(\"house\", \"Home\");\n        return map;\n    }\n\n    public static void main(String args[]){\n        System.out.println(\"ArrayList \" + fill(new ArrayList&lt;String&gt;()));\n        System.out.println(\"LinkedList \" + fill(new LinkedList&lt;String&gt;()));\n        System.out.println(\"HashSet \" + fill(new HashSet&lt;String&gt;()));\n        System.out.println(\"TreeSet \" + fill(new TreeSet&lt;String&gt;()));\n        System.out.println(\"TreeMap \" + fill(new TreeMap&lt;String, String&gt;()));\n        System.out.println(\"HashMap \" + fill(new HashMap&lt;String, String&gt;()));\n        System.out.println(\"LinkedHashMap \" + fill(new LinkedHashMap&lt;String, String&gt;()));\n        System.out.println();\n        GenerateMovieName gener = new GenerateMovieName();\n        String names[] = new String[10];\n        gener.loadNames(names);\n        System.out.println(gener.fill(new ArrayList&lt;String&gt;(), 8));\n        System.out.println(gener.fill(new LinkedList&lt;String&gt;(), 8));\n        System.out.println(gener.fill(new HashSet&lt;String&gt;(), 8));\n        System.out.println(gener.fill(new TreeSet&lt;String&gt;(), 8));\n        for (int i = 0;i &lt; names.length;i++) System.out.print(names[i] + \", \");\n    }\n}\n</code></pre> \u8f93\u51fa\uff1a <pre><code>ArrayList [rat, cat, dog, dog, house]\nLinkedList [rat, cat, dog, dog, house]\nHashSet [cat, house, dog, rat]\nTreeSet [cat, dog, house, rat]\nTreeMap {cat=Tom, dog=Spot, house=Home, rat=Jerry}\nHashMap {cat=Tom, house=Home, dog=Spot, rat=Jerry}\nLinkedHashMap {rat=Jerry, cat=Tom, dog=Spot, house=Home}\n\n[La, New, ONE, We were solders, Big, Wind speaker, La, New]\n[ONE, We were solders, Big, Wind speaker, La, New, ONE, We were solders]\n[Wind speaker, We were solders, ONE, Big, New, La]\n[Big, La, New, ONE, We were solders, Wind speaker]\nONE, We were solders, Big, Wind speaker, La, New, ONE, We were solders, Big, Wind speaker,\n</code></pre> HashMap\u63d0\u4f9b\u4e86\u6700\u5feb\u7684\u67e5\u627e\u6280\u672f</p>"},{"location":"java/container/Java-Container/#list","title":"List","text":"<p>\u4e24\u79cd\u7c7b\u578b\u7684List\uff1a</p> <ul> <li>\u57fa\u672c\u7684ArrayList\uff0c\u5728List\u4e2d\u95f4\u63d2\u5165\u548c\u79fb\u9664\u5143\u7d20\u8f83\u6162</li> <li>LinkedList\uff0c\u968f\u673a\u8bbf\u95ee\u8f83\u6162</li> </ul>"},{"location":"java/container/Java-Container/#_3","title":"\u8fed\u4ee3\u5668","text":"<p>\u8fed\u4ee3\u5668\uff0c\u904d\u5386\u5e76\u9009\u62e9\u5e8f\u5217\u4e2d\u7684\u5bf9\u8c61\u3002 \u8fed\u4ee3\u5668\u521b\u5efa\u7684\u4ee3\u4ef7\u5c0f\uff0c\u5e38\u88ab\u79f0\u4e3a\u8f7b\u91cf\u7ea7\u5bf9\u8c61\u3002 <pre><code>import java.util.*;\n\npublic class SimpleIteration {\n    /**\n     * \u4f7f\u7528iterator\u6765\u904d\u5386\u5e8f\u5217\n     * @param it\n     */\n    public static void display(Iterator&lt;Integer&gt; it) {\n        while (it.hasNext()){\n            Integer i = it.next();\n            System.out.print(i + \" \");\n        }\n        System.out.println();\n    }\n    public static void main(String args[]) {\n        List&lt;Integer&gt; numbers = new ArrayList&lt;Integer&gt;();\n        Collections.addAll(numbers,1,2,3,4,5,6,7,8,9,10);\n        Iterator&lt;Integer&gt; it = numbers.iterator();/* \u5b9a\u4e49iterator */\n        while (it.hasNext()){\n            Integer i = it.next();\n            System.out.print(i + \" \");\n        }//\u8f93\u51fa\uff1a1 2 3 4 5 6 7 8 9 10\n        System.out.println();\n        for (Integer i : numbers){\n            System.out.print(i + \" \");\n        }//\u8f93\u51fa\uff1a1 2 3 4 5 6 7 8 9 10\n        it = numbers.iterator();/* \u91cd\u7f6e\u4e00\u4e0b */\n        for (int i = 0;i &lt; 4;i++){\n            it.next();\n            it.remove();/* iterator\u4e5f\u53ef\u64cd\u4f5c\u5143\u7d20 */\n        }\n        System.out.println();\n        System.out.println(\"numbers:\" + numbers);\n        //\u8f93\u51fa\uff1anumbers:[5, 6, 7, 8, 9, 10]\n        display(numbers.iterator());/* \u76f4\u63a5\u8f93\u5165Iterator */\n        //\u8f93\u51fa\uff1a5 6 7 8 9 10\n    }\n}\n</code></pre> \u65b9\u6cd5display()\u4e0d\u5305\u542b\u4efb\u4f55\u5173\u4e8e\u5b83\u6240\u904d\u5386\u7684\u5e8f\u5217\u7684\u7c7b\u578b\u4fe1\u606f\uff0c\u5c06\u904d\u5386\u5e8f\u5217\u7684\u64cd\u4f5c\u4e0e\u5e8f\u5217\u5e95\u5c42\u7684\u7ed3\u6784\u5206\u79bb\u3002</p>"},{"location":"java/container/Java-Container/#listiterator","title":"ListIterator","text":"<p>ListIterator\u662f\u4e00\u4e2a\u66f4\u52a0\u5f3a\u5927\u7684Iterator\u7684\u5b50\u7c7b\uff0c\u53ea\u80fd\u7528\u4e8e\u5404\u79cdList\u7c7b\u7684\u8bbf\u95ee\u3002\u53ef\u53cc\u5411\u79fb\u52a8\u3002 hasPrevious()\u67e5\u770b\u524d\u9762\u8fd8\u6709\u6ca1\u6709\u5143\u7d20\uff1b previous()\u53d6\u5f97\u5f53\u524d\u7684\u5143\u7d20 <pre><code>import java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.ListIterator;\n\npublic class ListIteration {\n\n    public static void main(String args[]) {\n        List&lt;String&gt; str = new ArrayList&lt;String&gt;();\n        Collections.addAll(str,\"ab\",\"cd\",\"ef\",\"gh\",\"xyz\");\n        ListIterator lit = str.listIterator();\n        while (lit.hasNext()){\n            System.out.print(lit.next() + \", \" + lit.nextIndex()\n                    + \", \" + lit.previousIndex());\n            System.out.println();\n        }\n        while (lit.hasPrevious()){\n            System.out.print(lit.previous() + \" \");/* \u5012\u7740\u6253\u5370 */\n        }\n        System.out.println();\n        System.out.println(str);\n        lit = str.listIterator(3);/* \u4ece\u6307\u5b9a\u4e0b\u6807\u5f00\u59cb */\n        while (lit.hasNext()){\n            lit.next();\n            lit.set(\"SET\");/* \u66ff\u6362\u5143\u7d20 */\n        }\n        System.out.println(str);\n        /*********************************************************/\n        /**\n         * \u628anum1\u5012\u7740\u63a5\u5230num2\u540e\u9762\n         */\n        List&lt;Integer&gt; num1 = new ArrayList&lt;&gt;();\n        List&lt;Integer&gt; num2 = new ArrayList&lt;&gt;();\n        Collections.addAll(num1,1,2,3,4,5);/* \u521d\u59cb\u5316 */\n        Collections.addAll(num2,6,7,8,9,10);\n        ListIterator it = num1.listIterator();\n        it = num1.listIterator(num1.size());/* \u628ait\u79fb\u5230num1\u7684\u672b\u5c3e */\n        while (it.hasPrevious()){\n            num2.add(num1.get(it.previousIndex()));\n            it.previous();\n        }\n        System.out.println(num2);\n    }\n}\n</code></pre> \u8f93\u51fa\uff1a <pre><code>ab, 1, 0\ncd, 2, 1\nef, 3, 2\ngh, 4, 3\nxyz, 5, 4\nxyz gh ef cd ab\n[ab, cd, ef, gh, xyz]\n[ab, cd, ef, SET, SET]\n[6, 7, 8, 9, 10, 5, 4, 3, 2, 1]\n</code></pre></p>"},{"location":"java/container/Java-Container/#linkedlist","title":"LinkedList","text":"<p>\u53ef\u4ee5\u6210\u4e3a\u4e00\u4e2aQueue\u5b9e\u73b0\u3002</p> <p>Java\u4ee3\u7801\uff1a <pre><code>import java.util.*;\n\n/**\n * \u719f\u6089LinkedList\u7684\u7279\u6027\n */\npublic class LinkedListFeatures {\n    public static void main(String args[]){\n        /*********************************************************************/\n        /*\n        * \u719f\u6089\u4e00\u4e0b\u64cd\u4f5c\n        */\n        LinkedList&lt;Integer&gt; numbers = new LinkedList&lt;Integer&gt;();\n        Collections.addAll(numbers,0,1,2,3,4,5,6,7,8,9,10);\n        System.out.println(\"numbers: \" + numbers);\n        System.out.println(\"numbers.getFirst(): \" + numbers.getFirst());/* \u8fd4\u56de\u5934\u90e8 */\n        System.out.println(\"numbers.element(): \" + numbers.element());/* \u8fd4\u56de\u5934\u90e8 */\n        System.out.println(\"numbers.peek(): \" + numbers.peek());\n        System.out.println(\"numbers.remove(): \" + numbers.remove());\n        System.out.println(\"numbers.removeFirst(): \" + numbers.removeFirst());\n        System.out.println(\"numbers.poll(): \" + numbers.poll());\n        System.out.println(\"numbers: \" + numbers);\n        numbers.addFirst(0);\n        System.out.println(\"numbers after addFirst(0): \" + numbers);\n        numbers.offer(1);\n        System.out.println(\"numbers after offer(1): \" + numbers);\n        numbers.addLast(99);\n        System.out.println(\"numbers after addLast(99): \" + numbers);\n        System.out.println(\"numbers.removeLast() : \" + numbers.removeLast());\n        /*********************************************************************/\n        /*\n        * \u5728LinkedList\u4e2d\u63d2\u5165\u5bf9\u8c61\n        */\n        LinkedList&lt;Integer&gt; em =\n                new LinkedList&lt;&gt;(Arrays.asList(10,20,30,40,50,60,70,80,90,100));\n        System.out.println(\"/**********************************************/\");\n        System.out.println(\"new LinkedList: \" + em);\n        ListIterator it = em.listIterator();\n        System.out.println(\"it.previousIndex() == \" + it.previousIndex());\n        it = em.listIterator(7);/* \u6839\u636e\u4e0b\u6807\u6765\u8bbe\u5b9ait */\n        System.out.println(it.previousIndex() + \" -- \" + it.previous());\n        it.add(77);/* \u63d2\u5165\u4e00\u4e2aInteger */\n        System.out.println(\"After insert LinkedList: \" + em);\n        System.out.println(\"em.get(0) == \" + em.get(0));\n    }\n}\n</code></pre></p> <p>\u8f93\u51fa\u7ed3\u679c\uff1a <pre><code>numbers: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\nnumbers.getFirst(): 0\nnumbers.element(): 0\nnumbers.peek(): 0\nnumbers.remove(): 0\nnumbers.removeFirst(): 1\nnumbers.poll(): 2\nnumbers: [3, 4, 5, 6, 7, 8, 9, 10]\nnumbers after addFirst(0): [0, 3, 4, 5, 6, 7, 8, 9, 10]\nnumbers after offer(1): [0, 3, 4, 5, 6, 7, 8, 9, 10, 1]\nnumbers after addLast(99): [0, 3, 4, 5, 6, 7, 8, 9, 10, 1, 99]\nnumbers.removeLast() : 99\n/**********************************************/\nnew LinkedList: [10, 20, 30, 40, 50, 60, 70, 80, 90, 100]\nit.previousIndex() == -1\n6 -- 70\nAfter insert LinkedList: [10, 20, 30, 40, 50, 60, 77, 70, 80, 90, 100]\nem.get(0) == 10\n</code></pre></p> <p></p>"},{"location":"java/container/Java-Container/#stack","title":"Stack","text":"<p>\u6808\uff0cLIFO</p> <p>LinkedList\u5177\u6709\u80fd\u591f\u76f4\u63a5\u5b9e\u73b0\u6808\u7684\u6240\u6709\u529f\u80fd\u7684\u65b9\u6cd5\uff0c\u53ef\u76f4\u63a5\u5f53\u505a\u6808\u6765\u4f7f\u7528\uff1b \u7528LinkedList\u5b9e\u73b0\u4e00\u4e2a\u6808\uff0c\u5b58\u653e\u5728\u53e6\u4e00\u4e2a\u76ee\u5f55\u4e0b\uff1a <pre><code>package com.rust.util;\n\nimport java.util.LinkedList;\n\npublic class Stack&lt;T&gt; {\n    private LinkedList&lt;T&gt; storage = new LinkedList&lt;T&gt;();\n    public void push(T v) {storage.addFirst(v);}\n    public T peek() {return storage.getFirst();}\n    public T pop() {return storage.removeFirst();}\n    public boolean empty() {return storage.isEmpty();}\n    public String toString() {return storage.toString();}\n}\n</code></pre></p> <p>\u6d4b\u8bd5\u4e00\u4e0b\u8fd9\u4e2a\u7c7b\uff0c\u5f15\u5165\u5305\u540d\uff0c\u4e0d\u8981\u4e0ejava.util\u7684\u51b2\u7a81 <pre><code>import com.rust.util.Stack;\n\npublic class StackTest {\n    public static void main(String args[]) {\n        Stack&lt;String&gt; stack = new Stack&lt;String&gt;();\n        for (String s : \"Don't worry , be happy\".split(\" \")) {\n            stack.push(s);\n        }\n        while (!stack.empty()) {\n            System.out.print(stack.pop() + \" \");\n        }\n        System.out.println();\n        /****************************************************/\n        Stack&lt;String&gt; wordStack = new Stack&lt;String&gt;();\n        String expretion =\n                \"+U+n+c---+e+r+t---+a-+i-+n+t+y---+-+r+u--+l+e+s---\";/* \u89e3\u6790\u8fd9\u6bb5\u5b57\u7b26 */\n        for (int i = 0; i &lt; expretion.length(); i++) {\n            if (expretion.charAt(i) == '+') {\n                wordStack.push(expretion.charAt(i + 1) + \"\");\n            } else if (expretion.charAt(i) == '-'){\n                System.out.print(wordStack.pop() + \"\");\n            }\n        }\n    }\n}\n</code></pre> \u8f93\u51fa\uff1a <pre><code>happy be , worry Don't\ncnUtreaiytn-ursel\n</code></pre></p>"},{"location":"java/container/Java-Container/#set","title":"Set","text":"<p>\u4e0d\u4fdd\u5b58\u91cd\u590d\u7684\u5143\u7d20\u3002\u5e38\u7528\u4e8e\u6d4b\u8bd5\u5f52\u5c5e\u6027\uff0c\u5f88\u5bb9\u6613\u5730\u8be2\u95ee\u67d0\u4e2a\u5bf9\u8c61\u662f\u5426\u5b58\u5728\u4e0e\u67d0\u4e2aSet\u4e2d\u3002 \u5b9e\u9645\u4e0aSet\u5c31\u662fCollection\uff0c\u53ea\u662f\u884c\u4e3a\u4e0d\u540c\u3002 HashSet\u4f7f\u7528\u4e86\u6563\u5217\u3002TreeSet\u5c06\u5143\u7d20\u5b58\u50a8\u5728\u7ea2\u9ed1\u6811\u6570\u636e\u7ed3\u6784\u4e2d\u3002 \u4f7f\u7528contains()\u6d4b\u8bd5Set\u7684\u5f52\u5c5e\u6027 <pre><code>import java.util.Collections;\nimport java.util.HashSet;\nimport java.util.Set;\n\n/**\n * \u64cd\u4f5cHashSet\n */\npublic class SetOperations {\n    public static void main(String args[]){\n        Set&lt;String&gt; set1 = new HashSet&lt;&gt;();/* HashSet \u7684\u7528\u6cd5 */\n        Collections.addAll(set1,\"A B C D E F G H I J K\".split(\" \"));\n        set1.add(\"M\");\n        System.out.println(\"H: \" + set1.contains(\"H\"));\n        System.out.println(\"M: \" + set1.contains(\"M\"));\n        Set&lt;String&gt; set2 = new HashSet&lt;&gt;();\n        Collections.addAll(set2,\"H I J K\".split(\" \"));\n        System.out.println(\"set2 in set1 ? \" + set1.containsAll(set2));\n        set1.remove(\"H\");\n        System.out.println(\"After remove set1: \" + set1);\n        System.out.println(\"set2 in set1 ? \" + set1.containsAll(set2));\n        set1.removeAll(set2);\n        System.out.println(\"Remove set2 from set1: \" + set1);\n        Collections.addAll(set1,\"X Y Z\".split(\" \"));\n        System.out.println(\"X Y Z added to set1 : \" + set1);\n    }\n}\n</code></pre> \u8f93\u51fa\uff1a <pre><code>H: true\nM: true\nset2 in set1 ? true\nAfter remove set1: [D, E, F, G, A, B, C, M, I, J, K]\nset2 in set1 ? false\nRemove set2 from set1: [D, E, F, G, A, B, C, M]\nX Y Z added to set1 : [D, E, F, G, A, B, C, M, Y, X, Z]\n</code></pre></p>"},{"location":"java/container/Java-Container/#map","title":"Map","text":"<p>\u80fd\u5c06\u5bf9\u8c61\u6620\u5c04\u5230\u5176\u4ed6\u5bf9\u8c61\u3002 \u4e00\u4e2a\u7a0b\u5e8f\uff0c\u68c0\u67e5Java\u7684Random\u7c7b\u7684\u968f\u673a\u6027\u3002 <pre><code>import java.util.HashMap;\nimport java.util.Map;\nimport java.util.Random;\n\npublic class Statistics {\n    public static void main(String args[]) {\n        Random rand = new Random(47);\n        Map&lt;Integer, Integer&gt; m =\n                new HashMap&lt;Integer, Integer&gt;();\n        for (int i = 0; i &lt; 10000; i++) {\n            int r = rand.nextInt(20);\n            Integer freq = m.get(r);\n            m.put(r, freq == null ? 1 : freq + 1);\n        }\n        for (int i = 0; i &lt; 10; i++)\n            System.out.print(i + \"=\" + m.get(i) + \"; \");\n        System.out.println();\n        for (int i = 10; i &lt; m.size(); i++)\n            System.out.print(i + \"=\" + m.get(i) + \"; \");\n    }\n}\n</code></pre> \u5982\u679c\u952e\u4e0d\u5728\u5bb9\u5668\u4e2d\uff0cget()\u65b9\u6cd5\u5c06\u8fd4\u56denull\uff08\u8fd9\u8868\u793a\u7b2c\u4e00\u6b21\u627e\uff09\u3002</p> <p>Map\u4e0e\u6570\u7ec4\u548c\u5176\u4ed6\u7684Collection\u4e00\u6837\uff0c\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u6269\u5c55\u5230\u591a\u7ef4\uff0c\u800c\u6211\u4eec\u53ea\u9700\u5c06\u5176\u503c\u8bbe\u7f6e\u4e3aMap\u3002 \u56e0\u6b64\uff0c\u6211\u4eec\u80fd\u591f\u5f88\u5bb9\u6613\u5730\u5c06\u5bb9\u5668\u7ec4\u5408\u8d77\u6765\u4ece\u800c\u5feb\u901f\u5730\u751f\u6210\u5f3a\u5927\u7684\u6570\u636e\u7ed3\u6784\u3002</p>"},{"location":"java/container/Java-Container/#queue","title":"Queue","text":"<p>FIFO\u3002\u961f\u5217\u5e38\u88ab\u5f53\u505a\u4e00\u79cd\u53ef\u9760\u7684\u5c06\u5bf9\u8c61\u4ece\u7a0b\u5e8f\u7684\u67d0\u4e2a\u533a\u57df\u4f20\u8f93\u5230\u53e6\u4e00\u4e2a\u533a\u57df\u7684\u9014\u5f84\u3002 \u961f\u5217\u5728\u5e76\u53d1\u7f16\u7a0b\u4e2d\u7279\u522b\u91cd\u8981\u3002\u5b83\u4eec\u53ef\u4ee5\u5b89\u5168\u5730\u5c06\u5bf9\u8c61\u4ece\u4e00\u4e2a\u4efb\u52a1\u4f20\u9001\u5230\u53e6\u4e00\u4e2a\u4efb\u52a1\u3002 LinkedList\u53ef\u4ee5\u7528\u4f5cQueue\u7684\u4e00\u79cd\u5b9e\u73b0\u3002\u901a\u8fc7\u5c06LinkedList\u5411\u4e0a\u8f6c\u578b\u4e3aQueue <pre><code>import java.util.LinkedList;\nimport java.util.Queue;\nimport java.util.Random;\n\npublic class QueueDemo {\n    public static void printQ(Queue queue){\n        while (queue.peek() != null){\n            System.out.print(queue.remove() + \" \");\n        }\n        System.out.println();\n    }\n    public static void main(String args[]){\n        Queue&lt;Integer&gt; queue = new LinkedList&lt;&gt;();\n        Random rand = new Random(47);\n        for (int i = 0; i &lt; 10; i++){\n            queue.offer(rand.nextInt(i + 10));\n        }\n        printQ(queue);\n        Queue&lt;Character&gt; qc = new LinkedList&lt;&gt;();\n        for (char c : \"Berrytail\".toCharArray()){\n            qc.offer(c);\n        }\n        printQ(qc);\n    }\n}\n</code></pre> \u8f93\u51fa\uff1a <pre><code>8 1 1 1 5 14 3 1 0 1\nB e r r y t a i l\n</code></pre> offer()\u65b9\u6cd5\u662f\u4e0eQueue\u76f8\u5173\u7684\u65b9\u6cd5\u4e4b\u4e00\uff0c\u5b83\u5728\u5141\u8bb8\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06\u4e00\u4e2a\u5143\u7d20\u63d2\u5165\u5230\u961f\u5c3e\uff0c\u6216\u8005\u8fd4\u56defalse\u3002 peek()\u548celement()\u65b9\u6cd5\u90fd\u5c06\u5728\u4e0d\u79fb\u9664\u7684\u60c5\u51b5\u4e0b\u8fd4\u56de\u961f\u5934\u3002peek\u65b9\u6cd5\u5728\u961f\u5217\u4e3a\u7a7a\u65f6\u8fd4\u56denull\uff0celement\u65b9\u6cd5\u4f1a\u629b\u51faNoSuchElementExceptio\u5f02\u5e38\u3002 poll()\u548cremove()\u65b9\u6cd5\u5c06\u79fb\u9664\u5e76\u8fd4\u56de\u961f\u5934\uff0c\u4f46\u662fpoll\u65b9\u6cd5\u5728\u961f\u5217\u4e3a\u7a7a\u65f6\u8fd4\u56denull\uff0cremove\u5219\u629b\u51fa\u5f02\u5e38</p>"},{"location":"java/container/Java-Container/#priorityqueue","title":"PriorityQueue","text":"<p>\u4f18\u5148\u7ea7\u961f\u5217\u58f0\u660e\u4e0b\u4e00\u4e2a\u5f39\u51fa\u5143\u7d20\u662f\u6700\u9700\u8981\u7684\u5143\u7d20\uff08\u5177\u6709\u6700\u9ad8\u4f18\u5148\u7ea7\uff09\u3002 \u5f53\u5728PriorityQueue\u4e0a\u8c03\u7528offer()\u65b9\u6cd5\u6765\u63d2\u5165\u4e00\u4e2a\u5bf9\u8c61\u65f6\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u4f1a\u5728\u961f\u5217\u4e2d\u88ab\u6392\u5e8f\u3002 \u9ed8\u8ba4\u7684\u6392\u5e8f\u5c06\u4f7f\u7528\u5bf9\u8c61\u5728\u961f\u5217\u4e2d\u7684\u81ea\u7136\u987a\u5e8f\uff0c\u53ef\u63d0\u4f9bComparator\u6765\u4fee\u6539\u8fd9\u4e2a\u987a\u5e8f\u3002 PriorityQueue\u53ef\u4ee5\u786e\u4fdd\u4f60\u5728\u8c03\u7528peek()\u3001 poll()\u548c remove()\u65b9\u6cd5\u65f6\uff0c\u83b7\u53d6\u7684\u5143\u7d20\u662f\u961f\u5217\u4e2d\u4f18\u5148\u7ea7\u6700\u9ad8\u7684\u5143\u7d20\u3002 PriorityQueue\u4e0eInteger\u548cString\u8fd9\u6837\u7684\u5185\u7f6e\u7c7b\u578b\u4e00\u8d77\u5de5\u4f5c\uff0c\u793a\u4f8b\uff1a <pre><code>import java.util.*;\n\npublic class PriorityQueueDemo {\n    public static void main(String args[]) {\n        PriorityQueue&lt;Integer&gt; priorityQueue =\n                new PriorityQueue&lt;&gt;();\n        Random rand = new Random(47);\n        for (int i = 0; i &lt; 10; i++) {\n            priorityQueue.offer(rand.nextInt(i + 10));\n        }/* \u4f7f\u7528\u524d\u4e00\u4e2a\u7c7b\u91cc\u9762\u7684\u6253\u5370\u65b9\u6cd5 */\n        QueueDemo.printQ(priorityQueue);/* \u968f\u673a\u6570\u6253\u51fa\u6765\u5df2\u88ab\u6392\u597d\u5e8f */\n        List&lt;Integer&gt; ints = Arrays.asList(22,33,21,1,5,7,33,61,43);\n        priorityQueue = new PriorityQueue&lt;&gt;(ints);\n        QueueDemo.printQ(priorityQueue);/* \u6253\u51fa\u6765\u7684\u6570\u5b57\u90fd\u88ab\u6392\u597d\u5e8f\u4e86 */\n        priorityQueue = new PriorityQueue&lt;&gt;(ints.size(), Collections.reverseOrder());/* \u5012\u5e8f */\n        priorityQueue.addAll(ints);\n        QueueDemo.printQ(priorityQueue);/* \u8f93\u51fa\u5df2\u662f\u5012\u5e8f\uff0c\u4ece\u5927\u5230\u5c0f */\n\n        String fact = \"EDUCATION SHOULD ESCHEW\";\n        List&lt;String&gt; str = Arrays.asList(fact.split(\"\"));/* \u5207\u5f00 */\n        PriorityQueue&lt;String&gt; strPQ = new PriorityQueue&lt;&gt;(str);\n        QueueDemo.printQ(strPQ);/* \u6253\u5370\u51fa\u5355\u4e2a\u5b57\u7b26\uff0c\u5305\u62ec\u7a7a\u683c */\n        strPQ = new PriorityQueue&lt;&gt;(str.size(), Collections.reverseOrder());/* \u8bbe\u7f6e\u5012\u5e8f */\n        strPQ.addAll(str);\n        QueueDemo.printQ(strPQ);\n    }\n}\n</code></pre> \u8f93\u51fa\uff1a <pre><code>0 1 1 1 1 1 3 5 8 14\n1 5 7 21 22 33 33 43 61\n61 43 33 33 22 21 7 5 1\n     A C C D D E E E H H I L N O O S S T U U W\nW U U T S S O O N L I H H E E E D D C C A      \n</code></pre> \u53ef\u4ee5\u770b\u5230\uff0c\u9ed8\u8ba4\u987a\u5e8f\uff0c\u7a7a\u683c\u6392\u5728\u5b57\u6bcd\u7684\u524d\u9762\uff1b\u987a\u5e8f\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570\u8bbe\u5b9a\uff1b\u91cd\u590d\u662f\u5141\u8bb8\u7684\uff1b</p>"},{"location":"java/container/Java-Container/#_4","title":"\u4f18\u5148\u7ea7\u961f\u5217","text":"<p>to-do\u5217\u8868\uff0c\u8be5\u5217\u8868\u4e2d\u6bcf\u4e2a\u5bf9\u8c61\u90fd\u5305\u542b\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4e00\u4e2a\u4e3b\u8981\u4f18\u5148\u7ea7\uff0c\u4e00\u4e2a\u6b21\u8981\u4f18\u5148\u7ea7\u503c\u3002 \u8be5\u5217\u8868\u7684\u6392\u5e8f\u987a\u5e8f\u4e5f\u662f\u901a\u8fc7\u5b9e\u73b0Comparable\u800c\u8fdb\u884c\u63a7\u5236\u7684</p> <p><pre><code>package com.rust.containers;\n\nimport java.util.PriorityQueue;\n\npublic class ToDoList extends PriorityQueue&lt;ToDoList.ToDoItem&gt; {\n    static class ToDoItem implements Comparable&lt;ToDoItem&gt; {\n        private char primary;   /* \u6392\u5e8f\u7684\u9996\u8981\u8c03\u6761\u4ef6 */\n        private int secondary;  /* \u6b21\u8981\u6761\u4ef6 */\n        private String item;    /* \u9879\u76ee\u540d\u79f0 */\n\n        public ToDoItem(String td, char pri, int sec) {\n            primary = pri;\n            secondary = sec;\n            item = td;\n        }\n\n        /**\n         * \u6bd4\u8f83\u65b9\u6cd5\uff0c\u6839\u636e\u6761\u4ef6\u6765\u6bd4\u8f83\n         * @param arg\n         * @return\n         */\n        public int compareTo(ToDoItem arg) {\n            if (primary &gt; arg.primary)\n                return +1;\n            if (primary == arg.primary) {\n                if (secondary &gt; arg.secondary) {\n                    return +1;\n                } else if (secondary == arg.secondary) {\n                    return 0;\n                }\n            }\n            return -1;\n        }\n\n        public String toString() {\n            return Character.toString(primary) +\n                    secondary + \": \" + item;\n        }\n    }\n\n    /**\n     * \u8f93\u51653\u4e2a\u53c2\u6570\n     * @param td - \u9879\u76ee\u540d\u79f0\n     * @param pri - \u9996\u8981\u6761\u4ef6\n     * @param sec - \u6b21\u8981\u6761\u4ef6\n     */\n    public void add(String td, char pri, int sec) {\n        super.add(new ToDoItem(td, pri, sec));\n    }\n\n    public static void main(String args[]) {\n        ToDoList toDoList = new ToDoList();\n        toDoList.add(\"\u6254\u5783\u573e\", 'C', 4);\n        toDoList.add(\"\u5582\u72d7\", 'A', 2);\n        toDoList.add(\"\u559d\u6c34\", 'B', 1);\n        toDoList.add(\"\u6d47\u82b1\", 'A', 3);\n        toDoList.add(\"\u626b\u5730\", 'C', 6);\n        toDoList.add(\"\u5237\u7259\", 'B', 5);\n        while (!toDoList.isEmpty()){\n            System.out.println(toDoList.remove());\n        }\n    }\n}\n</code></pre> \u8f93\u51fa\uff1a <pre><code>A2: \u5582\u72d7\nA3: \u6d47\u82b1\nB1: \u559d\u6c34\nB5: \u5237\u7259\nC4: \u6254\u5783\u573e\nC6: \u626b\u5730\n</code></pre></p> <p>\u7ec3\u4e60\u9898\uff1a\u521b\u5efa\u4e00\u4e2a\u7c7b\uff0c\u5305\u542b\u4e00\u4e2aInteger\uff0c\u65b0\u5efa\u7c7b\u65f6\u968f\u673a\u4ea7\u751f\u4e00\u4e2a\u6570\uff1b\u5c06\u5176\u591a\u4e2a\u5bf9\u8c61\u4f20\u5165PriorityQueue\u4e2d\uff0c\u518d\u8f93\u51fa\u89c2\u5bdf <pre><code>package com.rust.containers;\n\nimport java.util.PriorityQueue;\nimport java.util.Random;\n\n/***********************************\n * Exercise 11\n * Create a class that contains an Integer that is\n * initialized to a value between 0 and 100 using\n * java.util.Random. Implement Comparable using this\n * Integer field. Fill a PriorityQueue with objects of\n * your class, and extract the values using poll() to\n * show that it produces the expected order.\n ***********************************************/\nclass Item implements Comparable&lt;Item&gt; {\n    private static final Random rnd = new Random(47);\n    private Integer priority = rnd.nextInt(101);\n\n    @Override\n    public int compareTo(Item o) {\n        return priority &lt; o.priority ? -1 :\n                priority == o.priority ? 0 : 1;\n    }\n\n    @Override\n    public String toString() {\n        return \"Item{\" +\n                \"priority=\" + priority +\n                '}';\n    }\n}\n\npublic class E11_PriorityQueue {\n    public static void main(String args[]) {\n        PriorityQueue&lt;Item&gt; queue = new PriorityQueue&lt;&gt;();\n        for (int i = 0; i &lt; 10; i++) {\n            queue.add(new Item());\n        }\n        Item item;\n        while ((item = queue.poll()) != null) {\n            System.out.println(item);\n        }\n    }\n}\n</code></pre> \u8f93\u51fa\uff1a <pre><code>Item{priority=15}\nItem{priority=17}\nItem{priority=18}\nItem{priority=20}\nItem{priority=22}\nItem{priority=62}\nItem{priority=65}\nItem{priority=67}\nItem{priority=95}\nItem{priority=100}\n</code></pre></p>"},{"location":"java/container/Java-Container/#_5","title":"\u53cc\u5411\u961f\u5217","text":"<p>\u53ef\u4ee5\u5728\u4efb\u4f55\u4e00\u7aef\u6dfb\u52a0\u6216\u79fb\u9664\u5143\u7d20\u3002\u5728LinkedList\u4e2d\u5305\u542b\u652f\u6301\u53cc\u5411\u961f\u5217\u7684\u65b9\u6cd5\uff0c\u4f7f\u7528\u7ec4\u5408\u6765\u521b\u5efa\u4e00\u4e2aDeque\u7c7b\uff0c\u5e76\u76f4\u63a5\u4eceLinkedList\u4e2d\u66b4\u9732\u76f8\u5173\u7684\u65b9\u6cd5\u3002 <pre><code>package com.rust.util;\n\nimport java.util.LinkedList;\n\npublic class Deque&lt;T&gt; {\n    private LinkedList&lt;T&gt; deque = new LinkedList&lt;T&gt;();\n\n    public void addFirst(T e) {\n        deque.addFirst(e);\n    }\n\n    public void addLast(T e) {\n        deque.addLast(e);\n    }\n\n    public T getFirst() {\n        return deque.getFirst();\n    }\n\n    public T getLast() {\n        return deque.getLast();\n    }\n\n    public T removeFirst() {\n        return deque.removeFirst();\n    }\n\n    public T removeLast() {\n        return deque.removeLast();\n    }\n\n    public int size() {\n        return deque.size();\n    }\n\n    public String toString() {\n        return deque.toString();\n    }\n}\n</code></pre></p> <p><pre><code>package com.rust.containers;\n\nimport com.rust.util.Deque;\n\npublic class DequeTest {\n    static void fillTest(Deque&lt;Integer&gt; deque) {\n        for (int i = 20; i &lt; 27; i++) {\n            deque.addFirst(i);\n        }\n\n        for (int i = 50; i &lt; 57; i++) {\n            deque.addLast(i);\n        }\n\n    }\n\n    public static void main(String args[]) {\n        Deque&lt;Integer&gt; deque = new Deque&lt;&gt;();\n        fillTest(deque);\n        System.out.println(deque);\n        while (deque.size() != 0) {\n            System.out.print(deque.removeFirst() + \" \");/* \u4ece\u5934\u5f00\u59cb */\n        }\n        fillTest(deque);\n        System.out.println();\n        while (deque.size() != 0) {\n            System.out.print(deque.removeLast() + \" \");/* \u4ece\u5c3e\u5f00\u59cb */\n        }\n\n    }\n}\n</code></pre> \u8f93\u51fa\uff1a <pre><code>[26, 25, 24, 23, 22, 21, 20, 50, 51, 52, 53, 54, 55, 56]\n26 25 24 23 22 21 20 50 51 52 53 54 55 56\n56 55 54 53 52 51 50 20 21 22 23 24 25 26\n</code></pre></p>"},{"location":"java/container/Java-Container/#collectioniterator","title":"Collection\u548cIterator","text":"<p>\u4f7f\u7528\u63a5\u53e3\u63cf\u8ff0\uff0c\u80fd\u521b\u5efa\u66f4\u901a\u7528\u7684\u4ee3\u7801\u3002\u9488\u5bf9\u63a5\u53e3\u800c\u975e\u5177\u4f53\u5b9e\u73b0\u6765\u7f16\u7801\uff0c\u53ef\u4ee5\u5e94\u7528\u4e0e\u66f4\u591a\u7684\u5bf9\u8c61\u7c7b\u578b\u3002 <pre><code>import java.util.*;\n\npublic class InterfaceVsIterator {\n    /**\n     * \u8fd9\u79cd\u65b9\u6cd5\u8026\u5408\u5ea6\u66f4\u4f4e\n     * @param it - Iterator\n     */\n    public static void display(Iterator&lt;Integer&gt; it) {\n        while (it.hasNext()) {\n            Integer i = it.next();\n            System.out.print(i + \" \");\n        }\n        System.out.println();\n    }\n\n    public static void display(Collection&lt;Integer&gt; nums) {\n        for (Integer n : nums) {\n            System.out.print(n + \" \");\n        }\n        System.out.println();\n    }\n\n    public static void main(String args[]) {\n        List&lt;Integer&gt; numsList = new ArrayList&lt;&gt;();\n        Collections.addAll(numsList, 1, 2, 3, 4, 5, 6, 7);\n        Set&lt;Integer&gt; numsSet = new HashSet&lt;&gt;();\n        Collections.addAll(numsSet, 1, 2, 3, 4, 5, 6, 7);\n        Map&lt;String, Integer&gt; numsMap =\n                new LinkedHashMap&lt;&gt;();\n        String names[] = (\"Ralph Eric David Lucy Sam\").split(\" \");\n        for (int i = 0; i &lt; names.length; i++) {\n            numsMap.put(names[i], numsList.get(i));\n        }\n        display(numsList);/* \u6253\u5370\u503c */\n        display(numsSet);\n        display(numsSet.iterator());\n        display(numsList.iterator());\n        System.out.println(numsMap);\n        System.out.println(numsMap.keySet());/* \u8f93\u51fakey */\n        display(numsMap.values());/* \u8f93\u51fa\u503c */\n        display(numsMap.values().iterator());\n    }\n}\n</code></pre> \u8f93\u51fa\uff1a <pre><code>1 2 3 4 5 6 7\n1 2 3 4 5 6 7\n1 2 3 4 5 6 7\n1 2 3 4 5 6 7\n{Ralph=1, Eric=2, David=3, Lucy=4, Sam=5}\n[Ralph, Eric, David, Lucy, Sam]\n1 2 3 4 5\n1 2 3 4 5\n</code></pre></p>"},{"location":"java/container/Java-Container/#foreach","title":"Foreach\u4e0e\u8fed\u4ee3\u5668","text":"<p>foreach\u8bed\u6cd5\u53ef\u5e94\u7528\u4e0e\u4efb\u4f55Collection\u5bf9\u8c61 iterable\u7684\u63a5\u53e3\uff0c\u5305\u542b\u4e00\u4e2a\u80fd\u591f\u4ea7\u751fIterator\u7684iterator()\u65b9\u6cd5\uff0c\u5e76\u4e14Iterable\u63a5\u53e3\u88abforeach\u7528\u6765\u5728\u5e8f\u5217\u4e2d\u79fb\u52a8 <pre><code>import java.util.Iterator;\nimport java.util.Map;\n\npublic class IterableClass implements Iterable&lt;String&gt; {\n    protected String words[] = (\"And this is how we know\").split(\" \");\n    @Override\n    public Iterator&lt;String&gt; iterator() {\n        return new Iterator&lt;String&gt;() {\n            private int index = 0;\n            @Override\n            public boolean hasNext() {/* \u5148\u5224\u65ad\u8fd8\u6709\u6ca1\u6709\u540e\u7eed\u7684 */\n                return index &lt; words.length;\n            }\n\n            @Override\n            public String next() {/* \u7136\u540e\u8fd4\u56de\u503c */\n                return words[index++];\n            }\n\n            @Override\n            public void remove() {\n\n            }\n        };\n    }\n    public static void main(String args[]){\n        for (String s : new IterableClass()){\n            System.out.print(s + \" \");\n        }\n\n        /* \u6253\u5370\u51fa\u7cfb\u7edf\u7684\u73af\u5883\u4fe1\u606f */\n        for (Map.Entry entry : System.getenv().entrySet()){\n            System.out.println(entry.getKey() + \": \" + entry.getValue());\n        }\n        /* System.getenv()\u8fd4\u56de\u4e00\u4e2aMap\uff0centrySet()\u4ea7\u751f\u4e00\u4e2a\u7531Map.Entry\u7684\u5143\u7d20\u6784\u6210\u7684Set */\n        /* \u5e76\u4e14\u8fd9\u4e2aSet\u662f\u4e00\u4e2aIterable\uff0c\u53ef\u7528\u4e8eforeach\u5faa\u73af */\n    }\n}\n</code></pre> \u90e8\u5206\u8f93\u51fa\uff1a <pre><code>And this is how we know\n</code></pre></p>"},{"location":"java/container/Java-Container/#_6","title":"\u9002\u914d\u5668\u65b9\u6cd5\u60ef\u7528\u6cd5","text":"<p>\u5047\u5982\u8981\u5411\u524d\u6216\u8005\u5411\u540e\u8fed\u4ee3\u4e00\u4e2a\u5355\u8bcd\u5217\u8868\u3002\u4f7f\u7528\u9002\u914d\u5668\u65b9\u6cd5\u3002\u5728\u9ed8\u8ba4\u7684\u524d\u5411\u8fed\u4ee3\u5668\u57fa\u7840\u4e0a\uff0c\u6dfb\u52a0\u4ea7\u751f\u53cd\u54cd\u8fed\u4ee3\u5668\u7684\u80fd\u529b\u3002\u6dfb\u52a0\u4e00\u4e2a\u80fd\u591f\u4ea7\u751fIterable\u5bf9\u8c61\u7684\u65b9\u6cd5\uff0c\u8be5\u5bf9\u8c61\u53ef\u4ee5\u7528\u4e8eforeach\u8bed\u53e5\u3002 <pre><code>import java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.Collection;\nimport java.util.Iterator;\n\nclass ReversibleArrayList&lt;T&gt; extends ArrayList&lt;T&gt; {\n    public ReversibleArrayList(Collection&lt;T&gt; c) {\n        super(c);\n    }\n\n    public Iterable&lt;T&gt; reversed() {\n        return new Iterable&lt;T&gt;() {\n            @Override\n            public Iterator&lt;T&gt; iterator() {\n                return new Iterator&lt;T&gt;() {\n                    int current = size() - 1;/* \u4ece\u5c3e\u5f00\u59cb */\n\n                    @Override\n                    public boolean hasNext() {\n                        return current &gt; -1;/* \u662f\u5426\u5230\u5934\uff1f */\n                    }\n\n                    @Override\n                    public T next() {\n                        return get(current--);/* \u5411\u524d\u53d6\u503c */\n                    }\n\n                    @Override\n                    public void remove() {\n                    }\n                };\n            }\n        };\n    }\n}\n\npublic class AdapterMethodIdiom {\n    public static void main(String args[]) {\n        ReversibleArrayList&lt;String&gt; ral =\n                new ReversibleArrayList&lt;String&gt;(\n                        Arrays.asList((\"That is how we do it\").split(\" \"))\n                );\n        for (String s : ral){/* \u987a\u5e8f\u8f93\u51fa */\n            System.out.print(s + \" \");\n        }\n        System.out.println();\n        for (String s : ral.reversed()){/* \u5012\u5e8f\u8f93\u51fa */\n            System.out.print(s + \" \");\n        }\n    }\n}\n</code></pre></p> <p>\u8f93\u51fa\uff1a <pre><code>That is how we do it\nit do we how is That\n</code></pre></p> <p>\u5728\u524d\u6587\u7684IterableClass.java\u793a\u4f8b\u4e2d\u6dfb\u52a0\u4e24\u79cd\u9002\u914d\u5668\u65b9\u6cd5\uff0c\u5199\u4e00\u4e2a\u7c7b\u7ee7\u627fIterableClass \u65b0\u589e\u65b9\u6cd5reversed() \u548c randomized() \u518d\u7814\u7a76\u4e00\u4e0bCollection.shuffle()\u5bf9\u539f\u6570\u7ec4\u987a\u5e8f\u7684\u5f71\u54cd <pre><code>import java.util.*;\n\npublic class MultiIterableClass extends IterableClass {\n    /**\n     * \u65b0\u589e\u65b9\u6cd5\uff0c\u5012\u5e8f\u8f93\u51fa\n     * @return Iterable\n     */\n    public Iterable&lt;String&gt; reversed() {\n        return new Iterable&lt;String&gt;() {\n            @Override\n            public Iterator&lt;String&gt; iterator() {\n                return new Iterator&lt;String&gt;() {\n                    int current = words.length - 1;\n                    @Override\n                    public boolean hasNext() {\n                        return current &gt; -1;\n                    }\n\n                    @Override\n                    public String next() {\n                        return words[current--];\n                    }\n\n                    @Override\n                    public void remove() {\n\n                    }\n                };\n            }\n        };\n    }\n\n    /**\n     * \u65b0\u589e\u65b9\u6cd5\uff0c\u4e71\u5e8f\u8f93\u51fa\n     * @return Iterable\n     */\n    public Iterable&lt;String&gt; randomized(){\n        return new Iterable&lt;String&gt;() {/* \u8fd4\u56de\u88ab\u6253\u4e71\u7684List\u4e2d\u7684Iterator */\n            @Override\n            public Iterator&lt;String&gt; iterator() {\n                List&lt;String&gt; shuffled =\n                        new ArrayList&lt;&gt;(Arrays.asList(words));\n                Collections.shuffle(shuffled,new Random(47));\n                return shuffled.iterator();\n            }\n        };\n    }\n\n    public static void main(String args[]){\n        MultiIterableClass mic = new MultiIterableClass();\n        for (String s : mic.reversed()){\n            System.out.print(s + \" \");/* \u5012\u5e8f\u8f93\u51fa */\n        }\n        System.out.println();\n        for (String s : mic){\n            System.out.print(s + \" \");/* \u987a\u5e8f\uff08\u9ed8\u8ba4\uff09\u8f93\u51fa*/\n        }\n        System.out.println();\n        for (String s : mic.randomized()){\n            System.out.print(s + \" \");/* \u4e71\u5e8f\uff08\u968f\u673a\uff09\u8f93\u51fa*/\n        }\n        System.out.println();\n        /* Collection.shuffle()\u65b9\u6cd5\u6ca1\u6709\u5f71\u54cd\u5230\u539f\u6765\u7684\u6570\u7ec4\uff0c\u53ea\u662f\u6253\u4e71\u4e86shuffled\u4e2d\u7684\u5f15\u7528 */\n        Random rand = new Random(47);\n        Integer ia[] = {1,2,3,4,5,6,7,8,9,10};\n        List&lt;Integer&gt; list1 = new ArrayList&lt;&gt;(Arrays.asList(ia));/* \u6784\u9020\u4e86\u4e00\u4e2a\u65b0\u7684ArrayList&lt;&gt; */\n        System.out.println(\"list1 before shuffling: \" + list1);\n        Collections.shuffle(list1,rand);\n        System.out.println(\"list1 after shuffling: \" + list1);\n        System.out.println(\"ia array: \" + Arrays.toString(ia));/* ia\u7684\u987a\u5e8f\u6ca1\u6709\u6539\u53d8 */\n\n        List&lt;Integer&gt; list2 = Arrays.asList(ia);/* \u76f4\u63a5\u4f7f\u7528Arrays.asList(ia)\u7684\u7ed3\u679c */\n        System.out.println(\"list2 before shuffling: \" + list2);\n        Collections.shuffle(list2,rand);\n        System.out.println(\"list2 after shuffling: \" + list2);\n        System.out.println(\"ia array: \" + Arrays.toString(ia));/* \u6253\u4e71\u539f\u6765ia\u7684\u987a\u5e8f */\n    }\n}\n</code></pre> \u8f93\u51fa: <pre><code>know we how is this And\nAnd this is how we know\nthis we how know And is\nlist1 before shuffling: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\nlist1 after shuffling: [4, 6, 3, 1, 8, 7, 2, 5, 10, 9]\nia array: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\nlist2 before shuffling: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\nlist2 after shuffling: [9, 1, 6, 3, 7, 2, 5, 10, 4, 8]\nia array: [9, 1, 6, 3, 7, 2, 5, 10, 4, 8]\n</code></pre></p>"},{"location":"java/container/Java-Container/#_7","title":"\u5c0f\u7ed3","text":"<p>Java\u63d0\u4f9b\u4e86\u5927\u91cf\u7684\u6301\u6709\u5bf9\u8c61\u7684\u65b9\u5f0f</p> <ol> <li>\u6570\u7ec4\u5c06\u6570\u5b57\u4e0e\u5bf9\u8c61\u8054\u7cfb\u8d77\u6765\u3002\u4f46\u6570\u7ec4\u4e00\u65e6\u751f\u6210\uff0c\u5bb9\u91cf\u4e0d\u80fd\u6539\u53d8\u3002</li> <li>Collection\u4fdd\u5b58\u5355\u4e00\u7684\u5143\u7d20\uff0c\u800cMap\u4fdd\u5b58\u76f8\u5173\u8054\u7684\u952e\u503c\u5bf9\u3002</li> <li>List\u4e5f\u5efa\u7acb\u4e86\u6570\u5b57\u4e0e\u5bf9\u8c61\u7684\u5173\u8054\uff0c\u80fd\u591f\u81ea\u52a8\u6269\u5145\u5bb9\u91cf\u3002</li> <li>\u82e5\u8981\u8fdb\u884c\u5927\u91cf\u7684\u968f\u673a\u8bbf\u95ee\uff0c\u4f7f\u7528ArrayList\uff1b\u7ecf\u5e38\u63d2\u5165\u6216\u5220\u9664\u5143\u7d20\uff0c\u4f7f\u7528LinkedList\u3002</li> <li>\u5404\u79cdQueue\u4e0e\u6808\u7684\u884c\u4e3a\uff0c\u7531LinkedList\u63d0\u4f9b\u652f\u6301\u3002</li> </ol>"},{"location":"java/container/Java-Container/#_8","title":"\u586b\u5145\u5bb9\u5668","text":"<p><code>fill()</code>\u65b9\u6cd5\uff0c\u590d\u5236\u540c\u4e00\u4e2a\u5bf9\u8c61\u5f15\u7528\u6765\u586b\u5145\u6574\u4e2a\u5bb9\u5668\uff0c\u53ea\u5bf9List\u5bf9\u8c61\u6709\u7528\u3002\u53ea\u80fd\u66ff\u6362List\u4e2d\u5b58\u5728\u7684\u5143\u7d20\uff0c\u4e0d\u80fd\u6dfb\u52a0\u65b0\u7684\u5143\u7d20\u3002</p> <pre><code> package com.rust.containers;\n\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\n\nclass StringAddress {\n    private String s;\n\n    public StringAddress(String s) {\n        this.s = s;\n    }\n\n    public String toString() {\n        return /*super.toString() + \" \" + */s;/* \u5bf9\u8c61\u7684\u6563\u5217\u7801\u5c31\u4e0d\u8f93\u51fa\u4e86 */\n    }\n}\n\npublic class FillingLists {\n    public static void main(String args[]) {\n        List&lt;StringAddress&gt; list = new ArrayList&lt;StringAddress&gt;(\n                Collections.nCopies(3, new StringAddress(\"Hello\"))\n        );/* \u586b\u5145list */\n        System.out.println(list);\n        Collections.fill(list, new StringAddress(\"World\"));/* \u586b\u5145\uff0c\u66ff\u6362\u6389\u539f\u6709\u7684\u5143\u7d20 */\n        System.out.println(list);/* \u586b\u5145\u540e\uff0c\u6240\u6709\u5f15\u7528\u90fd\u88ab\u8bbe\u7f6e\u4e3a\u6307\u5411\u76f8\u540c\u7684\u5bf9\u8c61 */\n    }\n}\n</code></pre> <p>\u8f93\u51fa\uff1a <pre><code>[Hello, Hello, Hello]\n[World, World, World]\n</code></pre></p>"},{"location":"java/container/Java-Container/#collection","title":"Collection\u7684\u529f\u80fd\u65b9\u6cd5","text":"<p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>package com.rust.containers;\n\nimport java.util.*;\n\npublic class CollectionMethods {\n    public static void main(String args[]) {\n        Collection&lt;String&gt; c = new ArrayList&lt;String&gt;();\n        Collections.addAll(c, (\"ONE TWO THREE FOUR FIVE\")\n                .toLowerCase().split(\" \"));\n        c.add(\"ten\");\n        c.add(\"zero\");\n        System.out.println(\"c = \" + c);\n        /* \u6839\u636eASCII\u7801\u6765\u627e\u5927\u5c0f\u503c */\n        System.out.println(\"Collections.max(c) = \" + Collections.max(c));\n        System.out.println(\"Collections.min(c) = \" + Collections.min(c));\n        Collection&lt;String&gt; c2 = new ArrayList&lt;String&gt;();\n        c2.addAll(Arrays.asList((\"morning noon night\").split(\" \")));\n        c.addAll(c2);/* \u628ac2\u6dfb\u52a0\u5230c\u91cc\u9762\u53bb */\n        System.out.println(\"c = \" + c);\n        c.remove(\"one\");\n        c.remove(\"zero\");/* \u5220\u6389\u4e24\u4e2a\u5143\u7d20 */\n        System.out.println(\"c = \" + c);\n        String val = \"ten\";\n        System.out.println(\"c.contains(\" + val + \") ? \" + c.contains(val));\n        c.removeAll(c2);/* \u4ecec\u4e2d\u628ac2\u5168\u90e8\u5220\u6389 */\n        System.out.println(\"c2 = \" + c2);\n        Collection&lt;String&gt; c3 = ((List&lt;String&gt;) c).subList(2, 4);\n        c2.retainAll(c3);/* c2\u4e2d\u4ec5\u4fdd\u5b58c2\u548cc3\u5171\u540c\u5b58\u5728\u7684\u5143\u7d20 */\n        System.out.println(\"c3 = \" + c3);\n        System.out.println(\"c2.isEmpty() ? \" + c2.isEmpty());\n    }\n}\n</code></pre></p> <p>\u8f93\u51fa <pre><code>c = [one, two, three, four, five, ten, zero]\nCollections.max(c) = zero\nCollections.min(c) = five\nc = [one, two, three, four, five, ten, zero, morning, noon, night]\nc = [two, three, four, five, ten, morning, noon, night]\nc.contains(ten) ? true\nc2 = [morning, noon, night]\nc3 = [four, five]\nc2.isEmpty() ? true\n</code></pre></p>"},{"location":"java/container/Java-Container/#set_1","title":"Set\u548c\u5b58\u50a8\u987a\u5e8f","text":"<p>Set\u4e0d\u4fdd\u5b58\u91cd\u590d\u5143\u7d20\u3002HashSet\u901f\u5ea6\u5feb\u3002 \u4e3a\u4e86\u4f7f\u7528\u7279\u5b9a\u7684Set\u5b9e\u73b0\u7c7b\u578b\u800c\u5fc5\u987b\u5b9a\u4e49\u65b9\u6cd5</p> <pre><code>package com.rust.containers;\n\nimport java.util.Collections;\nimport java.util.Iterator;\nimport java.util.SortedSet;\nimport java.util.TreeSet;\n\npublic class SortedSetDemo {\n    public static void main(String args[]) {\n        SortedSet&lt;String&gt; sortedSet = new TreeSet&lt;&gt;();\n        Collections.addAll(sortedSet,\n                (\"one two three four five six seven eight nine\").split(\" \"));\n        System.out.println(\"/* SortedSet\u7684\u610f\u601d\u662f\u201c\u6309\u5bf9\u8c61\u7684\u6bd4\u8f83\u51fd\u6570\u5bf9\u5143\u7d20\u6392\u5e8f\u201d\uff0c\\n\" +\n                \" * \u800c\u4e0d\u662f\u6307\u201c\u5143\u7d20\u63d2\u5165\u7684\u6b21\u5e8f\u201d\uff1b\u63d2\u5165\u987a\u5e8f\u53ef\u4ee5\u7528LinkedHashSet\u6765\u4fdd\u5b58*/\");\n        System.out.println(sortedSet);\n        String low = sortedSet.first();\n        String high = sortedSet.last();\n        System.out.println(\"low : \" + low);\n        System.out.println(\"high : \" + high);\n        Iterator&lt;String&gt; it = sortedSet.iterator();\n        for (int i = 0; i &lt;= 6; i++) {\n            if (i == 3) low = it.next();\n            if (i == 6) high = it.next();\n            else it.next();\n        }\n        System.out.println(\"after low : \" + low);\n        System.out.println(\"after high : \" + high);\n        System.out.println(\"sortedSet.subSet(low,high) = \" + sortedSet.subSet(low, high));\n        /* \u8ddf\u5728low\u540e\u9762\u7684\u5143\u7d20\uff0c\u5305\u62eclow*/\n        System.out.println(\"tailSet(low)  = \" + sortedSet.tailSet(low));\n        /* high\u4e4b\u524d\u7684\u5143\u7d20\uff0c\u4e0d\u5305\u62echigh*/\n        System.out.println(\"headSet(high) = \" + sortedSet.headSet(high));\n    }\n}\n</code></pre> <p>\u8f93\u51fa\uff1a <pre><code>/* SortedSet\u7684\u610f\u601d\u662f\u201c\u6309\u5bf9\u8c61\u7684\u6bd4\u8f83\u51fd\u6570\u5bf9\u5143\u7d20\u6392\u5e8f\u201d\uff0c\n * \u800c\u4e0d\u662f\u6307\u201c\u5143\u7d20\u63d2\u5165\u7684\u6b21\u5e8f\u201d\uff1b\u63d2\u5165\u987a\u5e8f\u53ef\u4ee5\u7528LinkedHashSet\u6765\u4fdd\u5b58*/\n[eight, five, four, nine, one, seven, six, three, two]\nlow : eight\nhigh : two\nafter low : nine\nafter high : three\nsortedSet.subSet(low,high) = [nine, one, seven, six]\ntailSet(low)  = [nine, one, seven, six, three, two]\nheadSet(high) = [eight, five, four, nine, one, seven, six]\n</code></pre></p>"},{"location":"java/container/list/Java-ArrayList-intro/","title":"Java ArrayList\u6269\u5bb9\u7b56\u7565","text":""},{"location":"java/container/list/Java-ArrayList-intro/#java-arraylist","title":"Java ArrayList\u6269\u5bb9\u7b56\u7565","text":"<p><code>java.util.ArrayList</code>\u662f\u4e2a\u56fa\u5b9a\u5927\u5c0f\u7684\u5bf9\u8c61\uff0c\u6301\u6709\u4e00\u4e2a\u5f15\u7528\u6307\u5411\u4e00\u4e2a\u6570\u7ec4\uff0c\u771f\u6b63\u8d1f\u8d23\u5b58\u50a8\u5143\u7d20\u5185\u5bb9\u7684\u662f\u8fd9\u4e2a\u6570\u7ec4\u3002 \u5f53\u9700\u8981\u6269\u5bb9\u65f6\uff0c\u6269\u5bb9\u7684\u662f\u8fd9\u4e2a\u6570\u7ec4\u3002</p> <ul> <li>\u8ba1\u7b97\u51fa\u65b0\u7684\u5bb9\u91cf<code>capacity</code>\uff0c\u65b0\u521b\u5efa\u4e00\u4e2a\u5bb9\u91cf\u66f4\u5927\u7684\u6570\u7ec4</li> <li>\u628a\u539f\u6570\u7ec4\u7684\u5185\u5bb9\u62f7\u8d1d\u5230\u65b0\u6570\u7ec4\u53bb</li> <li>\u628a\u65b0\u6570\u7ec4\u7684\u5f15\u7528\u8d4b\u503c\u5230<code>ArrayList</code>\u5bf9\u8c61\u7684<code>elementData</code>\u5b57\u6bb5\u4e0a\uff0c\u5b8c\u6210\u6269\u5bb9</li> </ul>"},{"location":"java/container/list/Java-ArrayList-intro/#arraylistvector","title":"ArrayList\u4e0eVector\u7684\u4e3b\u8981\u533a\u522b","text":"<p>ArrayList\u5728Java1.2\u65f6\u88ab\u5f15\u5165\uff0c\u7528\u4e8e\u66ff\u6362<code>Vector</code>\u3002 <code>Vector</code>\u7ebf\u7a0b\u5b89\u5168\uff0c<code>ArrayList</code>\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002 \u5b83\u4eec\u5747\u4e3a\u7ebf\u6027\u8fde\u7eed\u5b58\u50a8\u7a7a\u95f4\uff08\u6570\u7ec4\u5b9e\u73b0\uff09\u3002 <code>ArrayList</code>\u6269\u5bb9\u65f6\u81ea\u52a8\u8ba1\u7b97\u589e\u957f\u503c\u3002<code>Vector</code>\u5b58\u50a8\u7a7a\u95f4\u53ef\u4ee5\u589e\u957f\uff0c\u4e5f\u53ef\u4ee5\u6536\u7f29\u3002</p> <p>\u9996\u5148\u770b\u8fd9\u4e24\u7c7b\u90fd\u5b9e\u73b0List\u63a5\u53e3\uff0c\u800cList\u63a5\u53e3\u4e00\u5171\u6709\u4e09\u4e2a\u5b9e\u73b0\u7c7b\uff0c\u5206\u522b\u662f<code>ArrayList</code>\u3001<code>Vector</code>\u548c<code>LinkedList</code>\u3002List\u7528\u4e8e\u5b58\u653e\u591a\u4e2a\u5143\u7d20\uff0c\u80fd\u591f\u7ef4\u62a4\u5143\u7d20\u7684\u6b21\u5e8f\uff0c\u5e76\u4e14\u5141\u8bb8\u5143\u7d20\u7684\u91cd\u590d\u30023\u4e2a\u5177\u4f53\u5b9e\u73b0\u7c7b\u7684\u76f8\u5173\u533a\u522b\u5982\u4e0b\uff1a</p> <ul> <li><code>ArrayList</code>\u662f\u6700\u5e38\u7528\u7684List\u5b9e\u73b0\u7c7b\uff0c\u5185\u90e8\u662f\u901a\u8fc7\u6570\u7ec4\u5b9e\u73b0\u7684\uff0c\u5b83\u5141\u8bb8\u5bf9\u5143\u7d20\u8fdb\u884c\u5feb\u901f\u968f\u673a\u8bbf\u95ee\u3002\u6570\u7ec4\u7684\u7f3a\u70b9\u662f\u6bcf\u4e2a\u5143\u7d20\u4e4b\u95f4\u4e0d\u80fd\u6709\u95f4\u9694\uff0c\u5f53\u6570\u7ec4\u5927\u5c0f\u4e0d\u6ee1\u8db3\u65f6\u9700\u8981\u589e\u52a0\u5b58\u50a8\u80fd\u529b\uff0c\u5c31\u8981\u8bb2\u5df2\u7ecf\u6709\u6570\u7ec4\u7684\u6570\u636e\u590d\u5236\u5230\u65b0\u7684\u5b58\u50a8\u7a7a\u95f4\u4e2d\u3002\u5f53\u4ece<code>ArrayList</code>\u7684\u4e2d\u95f4\u4f4d\u7f6e\u63d2\u5165\u6216\u8005\u5220\u9664\u5143\u7d20\u65f6\uff0c\u9700\u8981\u5bf9\u6570\u7ec4\u8fdb\u884c\u590d\u5236\u3001\u79fb\u52a8\u3001\u4ee3\u4ef7\u6bd4\u8f83\u9ad8\u3002\u56e0\u6b64\uff0c\u5b83\u9002\u5408\u968f\u673a\u67e5\u627e\u548c\u904d\u5386\uff0c\u4e0d\u9002\u5408\u63d2\u5165\u548c\u5220\u9664\u3002</li> <li><code>Vector</code>\u4e0e<code>ArrayList</code>\u4e00\u6837\uff0c\u4e5f\u662f\u901a\u8fc7\u6570\u7ec4\u5b9e\u73b0\u7684\uff0c\u4e0d\u540c\u7684\u662f\u5b83\u652f\u6301\u7ebf\u7a0b\u7684\u540c\u6b65\uff0c\u5373\u67d0\u4e00\u65f6\u523b\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u80fd\u591f\u5199<code>Vector</code>\uff0c\u907f\u514d\u591a\u7ebf\u7a0b\u540c\u65f6\u5199\u800c\u5f15\u8d77\u7684\u4e0d\u4e00\u81f4\u6027\uff0c\u4f46\u5b9e\u73b0\u540c\u6b65\u9700\u8981\u5f88\u9ad8\u7684\u82b1\u8d39\uff0c\u56e0\u6b64\uff0c\u8bbf\u95ee\u5b83\u6bd4\u8bbf\u95eeArrayList\u6162\u3002</li> <li><code>LinkedList</code>\u662f\u7528\u94fe\u8868\u7ed3\u6784\u5b58\u50a8\u6570\u636e\u7684\uff0c\u5f88\u9002\u5408\u6570\u636e\u7684\u52a8\u6001\u63d2\u5165\u548c\u5220\u9664\uff0c\u968f\u673a\u8bbf\u95ee\u548c\u904d\u5386\u901f\u5ea6\u6bd4\u8f83\u6162\u3002\u53e6\u5916\uff0c\u4ed6\u8fd8\u63d0\u4f9b\u4e86List\u63a5\u53e3\u4e2d\u6ca1\u6709\u5b9a\u4e49\u7684\u65b9\u6cd5\uff0c\u4e13\u95e8\u7528\u4e8e\u64cd\u4f5c\u8868\u5934\u548c\u8868\u5c3e\u5143\u7d20\uff0c\u53ef\u4ee5\u5f53\u4f5c\u5806\u6808\u3001\u961f\u5217\u548c\u53cc\u5411\u961f\u5217\u4f7f\u7528\u3002</li> </ul>"},{"location":"java/container/list/Java-ArrayList-intro/#forarraylist","title":"\u53ef\u4ee5\u7528for\u5faa\u73af\u76f4\u63a5\u5220\u9664ArrayList\u7684\u7279\u5b9a\u5143\u7d20\u5417\uff1f\u53ef\u80fd\u4f1a\u51fa\u73b0\u4ec0\u4e48\u95ee\u9898\uff1f\u600e\u6837\u89e3\u51b3\uff1f","text":"<p>for\u5faa\u73af\u76f4\u63a5\u5220\u9664\u7684\u7279\u5b9a\u5143\u7d20\uff0clist\u4e2d\u5143\u7d20\u7684\u4e0b\u6807\u4f1a\u53d8\u3002ArrayList\u7684size\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u6709\u53ef\u80fd\u4f1a\u62a5\u4e0b\u6807\u8d8a\u754c\u5f02\u5e38\uff08indexOutOfRange\uff09\u3002</p> <p>\u6bd4\u5982\u5f53\u4f60\u5220\u9664\u7b2c1\u4e2a\u5143\u7d20\u540e\uff0c\u7ee7\u7eed\u6839\u636e\u7d22\u5f15\u8bbf\u95ee\u7b2c2\u4e2a\u5143\u7d20\u65f6\uff0c\u56e0\u4e3a\u5220\u9664\u7684\u5173\u7cfb\u540e\u9762\u7684\u5143\u7d20\u90fd\u5f80\u524d\u79fb\u52a8\u4e86\u4e00\u4f4d\uff0c\u6240\u4ee5\u5b9e\u9645\u8bbf\u95ee\u7684\u662f\u7b2c3\u4e2a\u5143\u7d20\u3002</p> <p>\u5982\u679c\u5220\u9664\u67d01\u4e2a\u7279\u5b9a\u5143\u7d20\uff0cfor\u5faa\u73af\u4e2d\u627e\u5230\u8be5\u5143\u7d20\u5e76\u5220\u9664\u540e\uff0cbreak\u8df3\u51fa\u5faa\u73af\u3002</p> <p>\u5982\u679c\u5220\u9664\u591a\u4e2a\u7279\u5b9a\u5143\u7d20\uff0cfor\u5faa\u73af\u4e2d\u6ce8\u610f\u6267\u884c\u5220\u9664\u64cd\u4f5c\u540e\u4e0b\u6807\u7684\u53d8\u5316\uff0c\u66f4\u6539for\u5faa\u73af\u7684\u5faa\u73af\u6b21\u6570\u503c\u3002</p>"},{"location":"java/container/list/Java-ArrayList-intro/#arraylisthashmap","title":"ArrayList\u8ddfHashMap\u662f\u5426\u7ebf\u7a0b\u5b89\u5168\uff0c\u5982\u4f55\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168","text":"<p>ArrayList\u8ddfHashMap\u90fd\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002</p> <p>\u4e3a\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff0c\u9700\u8981\u7ed9\u5b83\u4eec\u52a0\u4e0a\u540c\u6b65\u673a\u5236\u3002\u6bd4\u5982\u4f7f\u7528<code>synchronized</code>\uff0c\u6216\u662f\u52a0\u9501\u3002</p>"},{"location":"java/container/map/Java-HashMap-source-code/","title":"Java HashMap \u7b80\u4ecb\u4e0e\u5de5\u4f5c\u539f\u7406","text":"<p>\u6d89\u53ca\u4ee5\u4e0b\u95ee\u9898\uff1a</p> <ul> <li>Hashmap\u7684hash\u7b97\u6cd5</li> <li>HashMap\u4e0eHashTable\u7684\u533a\u522b</li> <li>HashMap\u4e0eHashTable\u7684key\u80fd\u5426\u4e3anull\uff1f</li> <li>HashMap\u662f\u5982\u4f55\u5b58\u50a8null key\u7684\uff1f</li> <li>hash\u51b2\u7a81\u65f6\u5982\u4f55\u89e3\u51b3</li> </ul>"},{"location":"java/container/map/Java-HashMap-source-code/#_1","title":"\u672c\u6587\u6982\u8981","text":"<p>\u94fe\u8868\u548c\u6570\u7ec4\u53ef\u4ee5\u6309\u7167\u4eba\u4eec\u7684\u610f\u613f\u6392\u5217\u5143\u7d20\u7684\u6b21\u5e8f\u3002\u4f46\u82e5\u60f3\u67e5\u770b\u67d0\u4e2a\u6307\u5b9a\u7684\u5143\u7d20\uff0c\u5374\u5fd8\u8bb0\u4e86\u4f4d\u7f6e\uff0c\u5c31\u53ef\u80fd\u9700\u8981\u8bbf\u95ee\u6240\u6709\u5143\u7d20\uff0c\u76f4\u5230\u627e\u5230\u4e3a\u6b62\u3002 \u5927\u591a\u6570Java\u5f00\u53d1\u8005\u90fd\u4f1a\u7528\u5230Map\uff0c\u5c24\u5176\u662fHashMap\u3002\u4f7f\u7528HashMap\u53ef\u4ee5\u7b80\u5355\u9ad8\u6548\u5730\u5b58\u53d6\u6570\u636e\u3002</p>"},{"location":"java/container/map/Java-HashMap-source-code/#_2","title":"\u5185\u90e8\u5b58\u50a8\u673a\u5236","text":"<p>HashMap\u5b9e\u73b0\u4e86Map\u63a5\u53e3\uff0c\u63a5\u53e3\u7684\u4e3b\u8981\u65b9\u6cd5\u67094\u4e2a\uff1a <ul> <li>V put(K key, V value)</li> <li>V get(Object key)</li> <li>V remove(Object key)</li> <li>Boolean containsKey(Object key)</li> </ul> <p>HashMap\u4f7f\u7528\u5185\u90e8\u7c7bEntry\u6765\u8f85\u52a9\u5b58\u50a8\u6570\u636e\u3002\u9664\u4e86key\u548cvalue\u5916\uff0cEntry\u7c7b\u4e24\u4e2a\u53e6\u5916\u7684\u4e3b\u8981\u5c5e\u6027\uff1a <ul> <li>\u5bf9\u53e6\u4e00\u4e2aentry\u7684\u5f15\u7528<code>next</code>\uff1b\u7528\u4e8e\u5b9e\u73b0\u94fe\u8868linkedList\u7684\u529f\u80fd</li> <li>\u4ee3\u8868key\u7684hashValue\u7684\u503c</li> </ul> <p>Java7\u4e2d<code>Entry</code>\u7c7b\u90e8\u5206\u6e90\u7801</p> <pre><code>static class Entry&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; {\n        final K key;\n        V value;\n        Entry&lt;K,V&gt; next;\n        int hash;\n\u2026\n}\n</code></pre> <p>Java8\u4e2d\u540c\u6837\u7528\u4e8e\u8f85\u52a9\u5b58\u50a8\u6570\u636e\u7684\u8fd8\u6709\u6811\u8282\u70b9\u7c7b<code>TreeNode&lt;K,V&gt;</code></p> <pre><code>    static final class TreeNode&lt;K,V&gt; extends LinkedHashMap.Entry&lt;K,V&gt;\n</code></pre> <p>HashMap\u6301\u6709\u88c5\u8f7dentry\u7684\u6570\u7ec4table <code>transient Node&lt;K,V&gt;[] table;</code>\u3002\u9ed8\u8ba4\u957f\u5ea6\u4e3a16\u3002\u9996\u6b21\u4f7f\u7528\u65f6\u4f1a\u521d\u59cb\u5316\uff0c\u5fc5\u8981\u65f6\u91cd\u65b0\u5206\u914d\u5927\u5c0f\u3002\u957f\u5ea6\u662f2\u7684\u6b21\u65b9\u3002\u6570\u7ec4table\u4e2d\u5b58\u653e\u7684\u662fLinkedList\u7684\u5934\u90e8\u6216\u8005\u4e8c\u53c9\u6811\u7684\u6839\u8282\u70b9\u3002 \u4e5f\u53ef\u4ee5\u628a\u8fd9\u6837\u7684LinkedList\u79f0\u4e3abucket\u3002</p> <p>table\u7684\u5b58\u50a8\u7ed3\u6784\uff0c\u5229\u7528\u94fe\u8868</p> <p></p> <p>\u6216\u8005\u4e8c\u53c9\u6811\u7ed3\u6784</p> <p></p> <p>\u5f53\u8c03\u7528get\u6216\u8005put\u65b9\u6cd5\u65f6\uff0c\u65b9\u6cd5\u4f1a\u8ba1\u7b97\u51fakey\u5bf9\u5e94\u7684bucket\u5b58\u5728table\u4e2d\u7684\u4e0b\u6807\u3002\u7136\u540e\u53bb\u904d\u5386list\u5bfb\u627e\u76ee\u6807key\u5bf9\u8c61\u3002\u4f7f\u7528key\u5bf9\u8c61\u7c7b\u7684equals\u65b9\u6cd5\u6765\u5224\u5b9a\u5bf9\u8c61\u662f\u5426\u76f8\u7b49\u3002</p> <p>\u5bf9\u4e8eget\u65b9\u6cd5\uff0c\u82e5map\u4e2d\u4e0d\u5b58\u5728\u76f8\u5e94\u7684key\uff0c\u5219\u8fd4\u56denull\u3002</p> <p>\u5bf9\u4e8e<code>put(K key, V value)</code>\u65b9\u6cd5\uff0c\u82e5\u5df2\u7ecf\u6709value\u5b58\u5728\uff0c\u5219\u8986\u76d6\u6389\u539f\u6765\u7684value\u3002\u5982\u679c\u4e0d\u5b58\u5728\u65e7\u7684value\uff0c\u5219\u65b0\u5efa\u4e00\u4e2aentry\u5e76\u5b58\u5165\u3002\u65b0\u7684entry\u4f1a\u6210\u4e3a\u5bf9\u5e94bucket\u7684\u5934\u90e8\u3002</p> <p>\u90a3\u4e48bucket\u7684\u4e0b\u6807\u662f\u5982\u4f55\u786e\u5b9a\u7684\u5462\uff1f\u4e3b\u8981\u5206\u4e3a3\u4e2a\u6b65\u9aa4\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b65\uff0c\u83b7\u53d6key\u5bf9\u8c61\u7684hashcode\uff1b</li> <li>\u7b2c\u4e8c\u6b65\uff0c\u6839\u636e\u7b2c\u4e00\u6b65\u83b7\u5f97\u7684hashcode\uff0c\u518d\u6563\u5217\u4e00\u6b21(rehash)\u83b7\u5f97\u518d\u6563\u5217\u503c\uff1b\u8fd9\u4e00\u6b65\u662f\u4e3a\u4e86\u9632\u6b62\u6240\u6709\u7684\u6570\u636e\u90fd\u88ab\u5b58\u653e\u5230table\u6570\u7ec4\u540c\u4e00\u4e2a\u5730\u65b9\uff1b</li> <li>\u7b2c\u4e09\u6b65\uff0c\u4f7f\u7528\u518d\u6563\u5217\u503c\u4e0etable\u6570\u7ec4\u5f53\u524d\u957f\u5ea6\u51cf\u4e00\u8fdb\u884c\u4f4d\u8fd0\u7b97(bit-masks)\u3002\u8fd9\u4e00\u6b65\u4fdd\u8bc1\u4e86\u8ba1\u7b97\u51fa\u6765\u7684\u4e0b\u6807\u4e0d\u4f1a\u8d85\u51fatable\u6570\u7ec4\u7684\u8303\u56f4\u3002</li> </ul> <p>Java7\u548cJava8\u6e90\u7801\u4e2d\u8ba1\u7b97table\u6570\u7ec4\u4e0b\u6807\u503c\u7684\u4e3b\u8981\u51fd\u6570 <pre><code>// the \"rehash\" function in JAVA 7 that takes the hashcode of the key\nstatic int hash(int h) {\n    h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12);\n    return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4);\n}\n// the \"rehash\" function in JAVA 8 that directly takes the key\nstatic final int hash(Object key) {\n    int h;\n    return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);\n    }\n// the function that returns the index from the rehashed hash\nstatic int indexFor(int h, int length) {\n    return h &amp; (length-1);\n}\n</code></pre></p> <p>\u4e3a\u4e86\u66f4\u9ad8\u6548\uff0ctable\u6570\u7ec4\u7684\u957f\u5ea6\u8bbe\u5b9a\u4e3a2\u7684\u6b21\u65b9\u3002\u8fd9\u4e0e\u518d\u6563\u5217\u540e\uff0c<code>indexFor</code>\u65b9\u6cd5\u7684\u4f4d\u8fd0\u7b97\u6709\u5173\u3002<code>indexFor</code>\u65b9\u6cd5\u5c06\u4e0b\u6807\u9650\u5b9a\u5728table\u6570\u7ec4\u7684\u8303\u56f4\u5185\u3002</p> <p>\u5982\u679c\u6570\u7ec4\u957f\u5ea6length = 17\uff0c\u90a3\u4e48\u51cf\u4e00\u540e\u5f97\u523016\uff0c\u4e8c\u8fdb\u5236\u4f4d\u4e3a0\u2026010000\u3002\u4e0eh\u8fdb\u884c\u4f4d\u4e0e\u8fd0\u7b97\u540e\uff0c\u53ea\u80fd\u5f97\u52300\u62161\u8fd9\u4e24\u4e2a\u4e0b\u6807\u503c\u3002\u8fd9\u610f\u5473\u7740\u957f\u5ea6\u4e3a17\u7684\u6570\u7ec4\u53ea\u4f7f\u7528\u4e862\u4e2a\u4f4d\u7f6e\u3002</p> <p>\u4f46\u5982\u679c\u6570\u7ec4\u957f\u5ea6\u4e3a2\u76844\u6b21\u65b9\uff0c\u537316\u3002\u5728<code>indexFor</code>\u65b9\u6cd5\u8fdb\u884c\u8fd0\u7b97\u7684\u662f15\uff0c\u4e8c\u8fdb\u5236\u4f4d\u4f4d0\u2026001111\u3002\u4e0e\u8fd0\u7b97\u540e\u7684\u5230\u7684\u7ed3\u679c\u8303\u56f4\u662f0\u523015\uff0c\u80fd\u5b8c\u5168\u5229\u7528\u5230\u6570\u7ec4\u7684\u4f4d\u7f6e\u3002</p>"},{"location":"java/container/map/Java-HashMap-source-code/#_3","title":"\u81ea\u52a8\u6269\u5bb9\u673a\u5236","text":"<p>\u4e3a\u4e86\u9632\u6b62\u5185\u90e8\u6570\u7ec4\u4e2d\u7684\u94fe\u8868\u8fc7\u5927\u8fc7\u957f\uff0cHashMap\u4e2d\u6709\u81ea\u52a8\u6269\u5bb9\u7684\u673a\u5236\u3002\u4e3b\u8981\u662f\u8c03\u6574\u4e86\u5185\u7f6e\u6570\u7ec4table\u7684\u5927\u5c0f\u3002\u6bcf\u6b21\u6269\u5bb9\u64cd\u4f5c\u4f1a\u589e\u59271\u500d\u3002</p> <p>\u4ece\u5176\u4e2d\u4e00\u4e2a\u6784\u9020\u51fd\u6570\u6765\u770b<code>HashMap(int initialCapacity, float loadFactor)</code>\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u5b9a\u4e49\u521d\u59cb\u5927\u5c0f\u548c\u88c5\u8f7d\u56e0\u6570loadFactor\u3002</p> <p>\u6570\u7ec4\u9ed8\u8ba4\u7684\u957f\u5ea6\u4e3a16\uff0c\u88c5\u8f7d\u56e0\u6570\u9ed8\u8ba4\u4e3a0.75\u3002</p> <p>\u6bcf\u6b21\u6267\u884cput\u64cd\u4f5c\uff0c\u4f1a\u5148\u68c0\u67e5\u662f\u5426\u9700\u8981\u6269\u5145\u5185\u7f6e\u6570\u7ec4\u3002\u4e3a\u6b64\uff0cHashMap\u4f7f\u7528\u4e862\u4e2a\u6570\u636e\uff1a</p> <ul> <li>map\u7684\u5927\u5c0fsize\u3002\u4ee3\u8868\u7740map\u4e2d\u5b58\u50a8\u7684entry\u4e2a\u6570\u3002\u6bcf\u6b21\u6dfb\u52a0\u6216\u79fb\u9664\u8282\u70b9\u90fd\u4f1a\u66f4\u65b0\u8fd9\u4e2a\u6570\u5b57\u3002</li> <li>\u4e00\u4e2a\u9608\u503c\uff1a\u5b9a\u4e49\u4e3a\u6570\u7ec4\u957f\u5ea6\u4e58\u4ee5\u88c5\u8f7d\u56e0\u6570\u3002\u6269\u5bb9\u540e\u4f1a\u91cd\u65b0\u8ba1\u7b97\u8fd9\u4e2a\u9608\u503c\u3002</li> </ul> <p>\u6dfb\u52a0entry\u524d\uff0c\u68c0\u67e5size\u662f\u5426\u5927\u4e8e\u9608\u503c\u3002\u82e5\u6ee1\u8db3\u5927\u4e8e\u9608\u503c\u7684\u6761\u4ef6\uff0c\u5219\u91cd\u65b0\u521b\u5efa\u4e00\u4e2a2\u500d\u5927\u5c0f\u7684\u65b0table\u6570\u7ec4\u3002\u82e5\u521b\u5efa\u4e86\u65b0table\u6570\u7ec4\uff0c\u4f1a\u7ed9\u5f53\u524d\u6240\u6709\u7684entry\u91cd\u65b0\u8ba1\u7b97\u4e0b\u6807\uff0c\u653e\u8fdb\u65b0\u6570\u7ec4\u4e2d\u3002\u5e76\u629b\u5f03\u539ftable\u6570\u7ec4\u3002\u539f\u6765\u5728\u540c\u4e00\u4e2abucket\uff08LinkedList\uff09\u4e2d\u7684entry\uff0c\u91cd\u65b0\u8ba1\u7b97\u4e0b\u6807\u540e\u53ef\u80fd\u4f1a\u88ab\u653e\u5230\u4e0d\u540c\u7684\u4f4d\u7f6e\u4e0a\u3002</p> <p></p> <p>HashMap\u4e2d\u5e76\u6ca1\u6709\u63d0\u4f9b\u51cf\u5c0ftable\u6570\u7ec4\u7684\u65b9\u6cd5\u3002</p>"},{"location":"java/container/map/Java-HashMap-source-code/#_4","title":"\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898","text":"<p>\u6211\u4eec\u77e5\u9053\uff0cHashMap\u5e76\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u5b83\u91cc\u9762\u6ca1\u6709\u540c\u6b65\u673a\u5236\u3002</p> <p>\u5728\u6269\u5bb9\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u884cput\u6216\u8005get\u64cd\u4f5c\uff0c\u6b64\u65f6\u8ba1\u7b97\u5f97\u5230\u7684table\u7684\u4e0b\u6807\u503c\u53ef\u80fd\u5c31\u4e0d\u5bf9\u3002\u66f4\u7cdf\u7cd5\u7684\u60c5\u51b5\u662f\uff0c\u82e52\u4e2a\u7ebf\u7a0b\u540c\u65f6\u6267\u884cput\u65b9\u6cd5\uff0c\u800c\u6b64\u65f6HashMap\u5224\u65ad\u9700\u8981\u8fdb\u884c\u81ea\u52a8\u6269\u5bb9\uff0cmap\u5185\u90e8\u7684LinkedList\u53ef\u80fd\u4f1a\u4ea7\u751f\u73af\u3002\u90a3\u4e48\u8c03\u7528get\u65b9\u6cd5\u65f6\uff0c\u6709\u53ef\u80fd\u4f1a\u6389\u8fdb\u6b7b\u5faa\u73af\u4e2d\u3002</p> <p>\u800cHashTable\u5185\u7f6e\u4e86\u540c\u6b65\u673a\u5236\u3002</p> <p>\u4eceJava5\u5f00\u59cb\uff0cJava\u63d0\u4f9b\u4e86\u9002\u7528\u4e8e\u591a\u7ebf\u7a0b\u73af\u5883\u7684<code>ConcurrentHashMap</code>\u3002</p> <p>Java 7 ConcurrentHashMap\u4f7f\u7528\u4e86\u5206\u6bb5\u9501\uff1bJava 8\u4f7f\u7528\u4e86CAS\u3002</p>"},{"location":"java/container/map/Java-HashMap-source-code/#key","title":"key\u5bf9\u8c61\u53d8\u5316\u53ef\u80fd\u4f1a\u9020\u6210\u6570\u636e\u4e22\u5931\u95ee\u9898","text":"<p>\u5bf9\u4e8eHashMap\u6765\u8bf4\uff0c\u4f7f\u7528String\u6216Integer\u6765\u4f5c\u4e3akey\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u5b9e\u8df5\u3002\u5982\u679c\u4f7f\u7528\u4e86\u81ea\u5b9a\u4e49\u7684\u7c7b\u6765\u4f5c\u4e3akey\uff0c\u4fee\u6539\u4e86key\u7684\u5bf9\u8c61\u540e\u6709\u53ef\u80fd\u4f1a\u9020\u6210\u4e22\u5931\u6570\u636e\u7684\u95ee\u9898\u3002</p> <p>key\u5bf9\u8c61\u88ab\u4fee\u6539\u540e\uff0c\u5b83\u7684hash\u503c\u5f88\u53ef\u80fd\u4f1a\u53d1\u751f\u53d8\u5316\u3002HashMap\u4e2d\u7684entry\u5e76\u4e0d\u80fd\u968f\u4e4b\u6539\u53d8\uff0c\u5b58\u50a8\u7684\u662f\u4e0a\u4e00\u6b21put\u64cd\u4f5c\u7684hash\u503c\u3002\u67e5\u8be2\u64cd\u4f5c\u65f6\u5f88\u53ef\u80fd\u5c31\u627e\u4e0d\u5230\u5f53\u521d\u5b58\u653e\u7684\u90a3\u4e2avalue\u3002</p>"},{"location":"java/container/map/Java-HashMap-source-code/#java8hashmap","title":"Java8\u5bf9HashMap\u7684\u6539\u8fdb","text":"<p>\u8282\u70b9\u53ef\u4ee5\u88ab\u8f6c\u6362\u6210\u6811\u8282\u70b9TreeNode\u3002\u4f7f\u7528\u7ea2\u9ed1\u6811\u7ed3\u6784\u6765\u5b58\u653e\u8282\u70b9\u3002\u67e5\u8be2\u65f6\u95f4\u662fO(logn)\u3002</p> <p>table\u6570\u7ec4\u53ef\u4ee5\u540c\u65f6\u5b58\u50a8Node\u548cTreeNode\u3002</p> <p>\u5982\u679cLinkedList\u8282\u70b9\u6570\u91cf\u8d85\u8fc78\u4e2a\uff0c\u5219\u8f6c\u6362\u6210\u7ea2\u9ed1\u6811\u3002</p> <p>\u5982\u679c\u8282\u70b9\u6570\u91cf\u5c0f\u4e8e6\u4e2a\uff0c\u5219\u8f6c\u6362\u6210\u94fe\u8868\u3002</p> <p></p>"},{"location":"java/container/map/Java-HashMap-source-code/#_5","title":"\u6027\u80fd\u95ee\u9898","text":""},{"location":"java/container/map/Java-HashMap-source-code/#_6","title":"\u5206\u5e03\u662f\u5426\u5747\u8861","text":"<p>HashMap\u6839\u636ekey\u7684hash\u503c\u6765\u8ba1\u7b97\u51fa\u5bf9\u5e94table\u6570\u7ec4\u7684\u4e0b\u6807\u3002\u6bd4\u8f83\u597d\u7684\u60c5\u51b5\u662f\u8ba9\u5143\u7d20\u80fd\u5747\u5300\u5730\u5229\u7528table\u6570\u7ec4\u3002</p> <p>\u53ef\u4ee5\u5728\u907f\u514dhash\u51b2\u7a81\u7684\u60c5\u51b5\u4e0b\uff0c\u8003\u8651\u590d\u5199hashCode\u65b9\u6cd5\u548cequals\u65b9\u6cd5\u3002\u5c3d\u53ef\u80fd\u5229\u7528table\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u4e2a\u4f4d\u7f6e\u3002</p>"},{"location":"java/container/map/Java-HashMap-source-code/#_7","title":"\u81ea\u52a8\u6269\u5bb9","text":"<p>\u5982\u679c\u8981\u5b58\u50a8\u5927\u91cf\u7684\u6570\u636e\uff0c\u9700\u8981\u9884\u4f30\u4e00\u4e0b\u6570\u636e\u6570\u91cf\uff0c\u9009\u62e9\u4e00\u4e2a\u5408\u9002\u7684\u521d\u59cb\u5bb9\u91cf\u503c\u3002</p> <p>\u5b58\u50a8\u5927\u91cf\u6570\u636e\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u89e6\u53d1\u591a\u6b21\u81ea\u52a8\u6269\u5bb9\u3002\u8fd9\u4e9b\u6269\u5bb9\u8fc7\u7a0b\u9700\u8981\u6d88\u8017\u65f6\u95f4\u3002</p> <p>\u800c\u5982\u679c\u521d\u59cb\u8bbe\u7f6e\u7684\u5bb9\u91cf\u8fc7\u5927\uff0c\u5219\u53ef\u80fd\u4f1a\u6d6a\u8d39\u5185\u5b58\u7a7a\u95f4\u3002</p>"},{"location":"java/container/map/Java-HashMap-source-code/#hashmap","title":"HashMap\u6e90\u7801\u7b80\u4ecb","text":"<p>\u6620\u5c04\u8868\uff08Map\uff09\u6570\u636e\u7ed3\u6784\u3002\u6620\u5c04\u8868\u7528\u6765\u5b58\u653e\u952e\u503c\u5bf9\u3002\u5982\u679c\u63d0\u4f9b\u4e86\u952e\uff0c\u5c31\u80fd\u67e5\u627e\u5230\u503c\u3002 Java\u7c7b\u5e93\u4e3a\u6620\u5c04\u8868\u63d0\u4f9b\u4e86\u4e24\u4e2a\u901a\u7528\u7684\u5b9e\u73b0\uff1aHashMap\u548cTreeMap\u3002\u8fd9\u4e24\u4e2a\u7c7b\u90fd\u5b9e\u73b0\u4e86Map\u63a5\u53e3\u3002</p> <p>HashMap\u91c7\u53d6\u7684\u5b58\u50a8\u65b9\u5f0f\u4e3a\uff1a\u94fe\u8868\u6570\u7ec4\u6216\u4e8c\u53c9\u6811\u6570\u7ec4\u3002 \u6563\u5217\u6620\u5c04\u8868\u5bf9\u952e\u8fdb\u884c\u6563\u5217\uff0c\u6570\u6620\u5c04\u8868\u7684\u6574\u4f53\u987a\u5e8f\u5bf9\u5143\u7d20\u8fdb\u884c\u6392\u5e8f\uff0c\u5e76\u5c06\u5176\u7ec4\u7ec7\u6210\u641c\u7d22\u6811\u3002 \u6563\u5217\u6216\u6bd4\u8f83\u51fd\u6570\u53ea\u80fd\u5de6\u53f3\u4e0e\u952e\u3002\u4e0e\u952e\u5173\u8054\u7684\u503c\u4e0d\u80fd\u8fdb\u884c\u6563\u5217\u6216\u6bd4\u8f83\u3002</p> <p>\u6bcf\u5f53\u5f80\u6620\u5c04\u8868\u4e2d\u6dfb\u52a0\u6216\u68c0\u7d22\u5bf9\u8c61\u65f6\uff0c\u5fc5\u987b\u540c\u65f6\u63d0\u4f9b\u4e00\u4e2a\u952e\u3002\u5373\u901a\u8fc7Key\u67e5\u627eValue\u3002 \u952e\u5fc5\u987b\u662f\u552f\u4e00\u7684\u3002\u4e0d\u80fd\u5bf9\u540c\u4e00\u4e2a\u952e\u5b58\u653e\u4e24\u4e2a\u503c\u3002\u5982\u679c\u5bf9\u540c\u4e00\u4e2a\u952e\u4e24\u6b21\u8c03\u7528put\u65b9\u6cd5\uff0c\u540e\u4e00\u4e2a\u503c\u5c06\u4f1a\u53d6\u4ee3\u7b2c\u4e00\u4e2a\u503c\u3002</p> <p>HashMap \u7ee7\u627f\u4e8eAbstractMap\uff0c\u5b9e\u73b0\u4e86Map\u3001Cloneable\u3001java.io.Serializable\u63a5\u53e3\u3002  HashMap \u7684\u5b9e\u73b0\u4e0d\u662f\u540c\u6b65\u7684\uff0c\u8fd9\u610f\u5473\u7740\u5b83\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002\u5b83\u7684key\u3001value\u90fd\u53ef\u4ee5\u4e3anull\u3002\u6b64\u5916\uff0cHashMap\u4e2d\u7684\u6620\u5c04\u4e0d\u662f\u6709\u5e8f\u7684\u3002 </p> <p>\u4e0b\u9762\u662f\u6784\u9020\u51fd\u6570 <pre><code>    public HashMap()\n    public HashMap(int initialCapacity)\n    public HashMap(int initialCapacity, float loadFactor)\n\n    // \u5305\u542b \"\u5b50Map\" \u7684\u6784\u9020\u51fd\u6570 \n    public HashMap(Map&lt;? extends K, ? extends V&gt; map)\n</code></pre> \u7528\u7ed9\u5b9a\u7684\u5bb9\u91cf\u548c\u88c5\u586b\u56e0\u5b50\u6784\u9020\u4e00\u4e2a\u7a7a\u6563\u5217\u6620\u5c04\u8868\u3002 \u88c5\u586b\u56e0\u5b50\u662f\u4e00\u4e2a0.0~1.0\u4e4b\u95f4\u7684\u6570\u503c\u3002\u8fd9\u6570\u503c\u51b3\u5b9a\u6563\u5217\u8868\u586b\u5145\u7684\u767e\u5206\u6bd4\u3002\u9ed8\u8ba4\u88c5\u586b\u56e0\u5b50\u662f0.75\u3002 \u4e00\u65e6\u5230\u4e86\u8fd9\u4e2a\u767e\u5206\u6bd4\uff0c\u5c31\u8981\u5c06\u5176\u518d\u6563\u5217\uff08rehashed\uff09\u5230\u66f4\u5927\u7684\u8868\u4e2d\uff0c\u5e76\u5c06\u73b0\u6709\u5143\u7d20\u63d2\u5165\u65b0\u8868\uff0c\u5e76\u820d\u5f03\u539f\u6765\u7684\u8868\u3002</p>"},{"location":"java/container/map/Java-HashMap-source-code/#hashmap_1","title":"HashMap \u5de5\u4f5c\u539f\u7406","text":"<ul> <li>JDK 1.8</li> </ul> <p>HashMap \u7ee7\u627f AbstractMap\uff0c\u5b9e\u73b0\u4e86Map\u3001Cloneable\u3001java.io.Serializable\u63a5\u53e3 <pre><code>public class HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt;\n    implements Map&lt;K,V&gt;, Cloneable, Serializable\n</code></pre></p>"},{"location":"java/container/map/Java-HashMap-source-code/#_8","title":"\u5e38\u91cf\u5b9a\u4e49","text":"<p>\u9ed8\u8ba4\u5bb9\u91cf\u5fc5\u987b\u662f2\u7684\u6b21\u65b9\uff0c\u8fd9\u91cc\u662f16 <code>static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // aka 16</code></p> <p>\u6700\u5927\u5bb9\u91cf\u5fc5\u987b\u5c0f\u4e8e\u7b49\u4e8e 1&lt;&lt;30 \u3002\u82e5\u8bbe\u7f6e\u7684\u5bb9\u91cf\u5927\u4e8e\u6700\u5927\u5bb9\u91cf\uff0c\u5c06\u5176\u9650\u5236\u5728\u6700\u5927\u5bb9\u91cf\u3002 <code>static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;</code></p> <p>\u8d85\u8fc7\u6b64\u9608\u503c\uff0c\u5c06\u67d0\u4e2a\u5143\u7d20\u7684\u94fe\u8868\u7ed3\u6784\u8f6c\u6362\u6210\u6811\u7ed3\u6784 <code>static final int TREEIFY_THRESHOLD = 8;</code></p> <p>\u5c0f\u4e8e\u7b49\u4e8e\u6b64\u9608\u503c\uff0c\u5c06\u4e8c\u53c9\u6811\u7ed3\u6784\u8f6c\u6362\u6210\u94fe\u8868\u7ed3\u6784 <code>static final int UNTREEIFY_THRESHOLD = 6;</code></p>"},{"location":"java/container/map/Java-HashMap-source-code/#_9","title":"\u72b6\u6001\u53d8\u91cf","text":"<p>\u5df2\u5b58\u50a8\u7684\u952e\u503c\u5bf9\u6570\u91cf\uff0cmap\u4e2d\u6709\u591a\u5c11\u4e2a\u5143\u7d20 <code>transient int size;</code></p> <p>\u5f53\u5b58\u50a8\u7684\u6570\u91cf\u8fbe\u5230\u6b64\u503c\u540e\uff0c\u9700\u8981\u91cd\u65b0\u5206\u914d\u5927\u5c0f(capacity * load factor) <code>int threshold;</code></p> <p>\u6b64HashMap\u7684\u7ed3\u6784\u88ab\u4fee\u6539\u7684\u6b21\u6570 <code>transient int modCount;</code></p> <p>\u5b58\u50a8\u6570\u636e\u7684\u6570\u7ec4\u3002\u5fc5\u8981\u65f6\u4f1a\u91cd\u65b0\u5206\u914d\u7a7a\u95f4\u3002\u957f\u5ea6\u6c38\u8fdc\u662f2\u7684\u6b21\u65b9\u3002\u4e0d\u9700\u8981\u5e8f\u5217\u5316\u3002 \u5b83\u7684\u957f\u5ea6\u4f1a\u53c2\u4e0e\u5b58\u5165\u5143\u7d20\u7d22\u5f15\u7684\u8ba1\u7b97\u3002\u5047\u8bbe\u957f\u5ea6n\u4e3a\u9ed8\u8ba4\u768416\uff0c\u90a3\u4e48\u901a\u8fc7<code>(n - 1) &amp; hash</code>\u8ba1\u7b97\u5f97\u5230\u7684\u7d22\u5f15\u8303\u56f4\u662f[0, 15] \u88c5\u8f7d\u8282\u70b9\u7684\u6570\u7ec4table\u3002\u9996\u6b21\u4f7f\u7528\u65f6\u4f1a\u521d\u59cb\u5316\uff0c\u5fc5\u8981\u65f6\u91cd\u65b0\u5206\u914d\u5927\u5c0f\u3002\u957f\u5ea6\u662f2\u7684\u6b21\u65b9\u3002 <code>transient Node&lt;K,V&gt;[] table;</code></p> <p>table\u7684\u5b58\u50a8\u7ed3\u6784\uff0c\u5229\u7528\u94fe\u8868 </p> <p>\u6216\u8005\u4e8c\u53c9\u6811\u7ed3\u6784 </p> <p>\u94fe\u8868\u7ed3\u6784\u548c\u4e8c\u53c9\u6811\u7ed3\u6784\u4f1a\u6839\u636e\u5b9e\u9645\u4f7f\u7528\u60c5\u51b5\u4e92\u76f8\u8f6c\u6362\u3002\u5177\u4f53\u53c2\u89c1<code>UNTREEIFY_THRESHOLD</code>\u4e0e<code>TREEIFY_THRESHOLD</code>\u3002</p>"},{"location":"java/container/map/Java-HashMap-source-code/#_10","title":"\u6784\u9020\u51fd\u6570","text":"<p>\u5e26\u5bb9\u91cf\u548c\u88c5\u8f7d\u56e0\u5b50\u7684\u6784\u9020\u51fd\u6570\u3002\u68c0\u67e5\u8f93\u5165\u7684\u5bb9\u91cf\u503c\uff0c\u5c06\u5176\u9650\u5236\u57280\u5230\u6700\u5927\u5bb9\u91cf\u4e4b\u95f4\u3002\u68c0\u67e5\u88c5\u8f7d\u56e0\u5b50\u3002 <pre><code>    public HashMap(int initialCapacity, float loadFactor) {\n        if (initialCapacity &lt; 0)\n            throw new IllegalArgumentException(\"Illegal initial capacity: \" +\n                                               initialCapacity);\n        if (initialCapacity &gt; MAXIMUM_CAPACITY)\n            initialCapacity = MAXIMUM_CAPACITY;\n        if (loadFactor &lt;= 0 || Float.isNaN(loadFactor))\n            throw new IllegalArgumentException(\"Illegal load factor: \" +\n                                               loadFactor);\n        this.loadFactor = loadFactor;\n        this.threshold = tableSizeFor(initialCapacity);\n    }\n</code></pre></p>"},{"location":"java/container/map/Java-HashMap-source-code/#_11","title":"\u65b9\u6cd5\u4ecb\u7ecd","text":""},{"location":"java/container/map/Java-HashMap-source-code/#keyhash","title":"\u83b7\u53d6key\u5bf9\u8c61\u7684hash\u503c","text":"<p>\u83b7\u53d6key\u5bf9\u8c61\u7684hash\u503c\uff0c\u5c06\u5176\u9ad8\u4f4d\u4e0e\u4f4e\u4f4d\u8fdb\u884c\u4ea6\u6216\uff08XOR\uff09\u8ba1\u7b97\u3002 <pre><code>    static final int hash(Object key) {\n        int h;\n        return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);\n    }\n</code></pre></p> <p>\u521b\u5efa\u4e00\u4e2a\u5e38\u89c4\u8282\u70b9 <pre><code>    // Create a regular (non-tree) node\n    Node&lt;K,V&gt; newNode(int hash, K key, V value, Node&lt;K,V&gt; next) {\n        return new Node&lt;&gt;(hash, key, value, next);\n    }\n</code></pre></p> <p>\u521d\u59cb\u5316\u6216\u8ba9table\u7684\u5c3a\u5bf8\u653e\u5927\u4e00\u500d <code>final Node&lt;K,V&gt;[] resize()</code></p> <p>LinkedHashMap\u7528\u7684\u56de\u8c03 <pre><code>    // Callbacks to allow LinkedHashMap post-actions\n    void afterNodeAccess(Node&lt;K,V&gt; p) { }\n    void afterNodeInsertion(boolean evict) { }\n    void afterNodeRemoval(Node&lt;K,V&gt; p) { }\n</code></pre></p>"},{"location":"java/container/map/Java-HashMap-source-code/#putk-key-v-value","title":"<code>put(K key, V value)</code>\u65b9\u6cd5\u6d41\u7a0b","text":"<p>\u8c03\u7528put\u65b9\u6cd5\u65f6\uff0c\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f</p> <p>\u6dfb\u52a0\u952e\u503c\u5bf9\u7684\u65b9\u6cd5\u3002\u91cd\u70b9\u770b<code>putVal</code>\u65b9\u6cd5\u3002\u5c06\u5c1d\u8bd5\u63d2\u5165\u7684\u952e\u503c\u5bf9\u6682\u65f6\u79f0\u4e3a<code>\u76ee\u6807\u5143\u7d20</code>\u3002 * \u68c0\u67e5table\u5b9e\u4f8b\u662f\u5426\u5b58\u5728\uff0c\u83b7\u53d6table\u7684\u957f\u5ea6 * \u68c0\u67e5\u8f93\u5165\u7684hash\u503c\uff0c\u8ba1\u7b97\u5f97\u5230\u7d22\u5f15\u503c     * \u82e5table\u4e2d\u5bf9\u5e94\u7d22\u5f15\u503c\u4e2d\u6ca1\u6709\u5143\u7d20\uff0c\u63d2\u5165\u65b0\u5efa\u7684\u5143\u7d20     * \u68c0\u67e5\u5f53\u524d\u662f\u5426\u9700\u8981\u6269\u5145\u5bb9\u91cf * \u5c1d\u8bd5\u66f4\u65b0\u73b0\u6709\u7684\u5143\u7d20 * \u82e5\u4f7f\u7528\u4e86\u4e8c\u53c9\u6811\u7ed3\u6784\uff0c\u8c03\u7528\u4e8c\u53c9\u6811\u8282\u70b9\u7c7b\u7684\u63d2\u5165\u65b9\u6cd5<code>putTreeVal</code> * \u904d\u5386\u5185\u90e8\u5143\u7d20\uff0c\u63d2\u5165\u65b0\u503c\u6216\u66f4\u65b0\u539f\u6709\u503c * \u68c0\u67e5\u662f\u5426\u8981\u6269\u5927\u5b58\u50a8\u7a7a\u95f4 <pre><code>    public V put(K key, V value) {\n        return putVal(hash(key), key, value, false, true);\n    }\n\n    /**\n     * @param onlyIfAbsent \u82e5\u4e3atrue\uff0c\u5219\u4e0d\u6539\u53d8\u5df2\u6709\u7684\u503c\n     * @param evict \u82e5\u4e3afalse\uff0ctable\u5904\u4e8e\u521b\u5efa\u72b6\u6001\n     */\n    final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict)\n</code></pre></p> <p>\u5b9e\u4f8b <code>HashMap&lt;String, String&gt;</code>\u521d\u59cb\u5316\u5e76\u8c03\u7528put\u65b9\u6cd5 <pre><code>        HashMap&lt;String, String&gt; strMap = new HashMap&lt;&gt;();\n        strMap.put(\"one\", \"value\");\n        strMap.put(\"two\", \"value\");\n        strMap.put(\"three\", \"value\");\n        System.out.println(\"hash(\\\"one\\\") = \" + hash(\"one\"));\n        System.out.println(\"hash(\\\"two\\\") = \" + hash(\"two\"));\n        System.out.println(\"hash(\\\"three\\\") = \" + hash(\"three\"));\n\n/*\nhash(\"one\") = 110183\nhash(\"two\") = 115277\nhash(\"three\") = 110338829\n*/\n</code></pre> \u5df2\u77e5<code>\"one\"</code>\u7684hash\u503c\u662f110183\uff0c\u901a\u8fc7<code>(n - 1) &amp; hash</code>\u8ba1\u7b97\u5b58\u50a8\u7d22\u5f15\u3002 \u9ed8\u8ba4\u5bb9\u91cfn=16\uff0c\u8ba1\u7b97\u5f97\u5230\u7d22\u5f15\u662f7\u3002\u4ee5\u6b64\u7c7b\u63a8\u3002</p>"},{"location":"java/container/map/Java-HashMap-source-code/#get","title":"<code>get</code> \u65b9\u6cd5\u6d41\u7a0b","text":"<p>\u8ba1\u7b97\u8f93\u5165key\u5bf9\u8c61\u7684hash\u503c\uff0c\u6839\u636ehash\u503c\u67e5\u627e\u3002 \u82e5map\u4e2d\u4e0d\u5b58\u5728\u76f8\u5e94\u7684key\uff0c\u5219\u8fd4\u56denull\u3002</p> <pre><code>    public V get(Object key) {\n        Node&lt;K,V&gt; e;\n        return (e = getNode(hash(key), key)) == null ? null : e.value;\n    }\n</code></pre>"},{"location":"java/container/map/Java-HashMap-source-code/#_12","title":"\u4ece\u6e90\u7801\u4e2d\u5b66\u5230\u7684\u5b9e\u7528\u65b9\u6cd5","text":"<p>hash\u4f18\u5316\u51fd\u6570\uff0c\u201c\u6270\u52a8\u51fd\u6570\u201d <pre><code>    public static int hash(Object key) {\n        int h;\n        return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);\n    }\n</code></pre></p> <p>\u5927\u4e8e\u4e14\u6700\u63a5\u8fd1\u8f93\u5165\u503c\u76842\u7684\u6b21\u65b9\u6570 <pre><code>    /**\n     * Returns a power of two size for the given target capacity.\n     * MAXIMUM_CAPACITY \u662f\u4e0a\u9650\n     */\n    public static int tableSizeFor(int cap) {\n        int n = cap - 1;\n        n |= n &gt;&gt;&gt; 1;\n        n |= n &gt;&gt;&gt; 2;\n        n |= n &gt;&gt;&gt; 4;\n        n |= n &gt;&gt;&gt; 8;\n        n |= n &gt;&gt;&gt; 16;\n        return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;\n    }\n</code></pre></p>"},{"location":"java/container/map/Java-HashMap-source-code/#hashmaphashtable","title":"HashMap\u4e0eHashTable\u7684\u533a\u522b","text":"<p>\u76f8\u540c\u70b9\uff1a HashMap\u662f\u57fa\u4e8e\u54c8\u5e0c\u8868\u5b9e\u73b0\u7684\uff0c\u6bcf\u4e00\u4e2a\u5143\u7d20\u662f\u4e00\u4e2akey-value\u5bf9\uff0c\u5176\u5185\u90e8\u901a\u8fc7\u5355\u94fe\u8868\u89e3\u51b3\u51b2\u7a81\u95ee\u9898\uff0c\u5bb9\u91cf\u4e0d\u8db3\uff08\u8d85\u8fc7\u4e86\u9600\u503c\uff09\u65f6\uff0c\u540c\u6837\u4f1a\u81ea\u52a8\u589e\u957f\u3002 HashMap\u662f\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u53ef\u4ee5\u91c7\u7528concurrent\u5e76\u53d1\u5305\u4e0b\u7684concurrentHashMap\u3002 HashMap \u5b9e\u73b0\u4e86Serializable\u63a5\u53e3\uff0c\u652f\u6301\u5e8f\u5217\u5316\uff1b\u4e5f\u5b9e\u73b0\u4e86Cloneable\u63a5\u53e3\uff0c\u80fd\u88ab\u514b\u9686\u3002</p> <p>Hashtable\u540c\u6837\u662f\u57fa\u4e8e\u54c8\u5e0c\u8868\u5b9e\u73b0\u7684\uff0c\u540c\u6837\u6bcf\u4e2a\u5143\u7d20\u662f\u4e00\u4e2akey-value\u5bf9\uff0c\u5176\u5185\u90e8\u4e5f\u662f\u901a\u8fc7\u5355\u94fe\u8868\u89e3\u51b3\u51b2\u7a81\u95ee\u9898\uff0c\u5bb9\u91cf\u4e0d\u8db3\uff08\u8d85\u8fc7\u4e86\u9600\u503c\uff09\u65f6\uff0c\u540c\u6837\u4f1a\u81ea\u52a8\u589e\u957f\u3002 Hashtable\u4e5f\u662fJDK1.0\u5f15\u5165\u7684\u7c7b\uff0c\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u80fd\u7528\u4e8e\u591a\u7ebf\u7a0b\u73af\u5883\u4e2d\u3002 Hashtable\u540c\u6837\u5b9e\u73b0\u4e86Serializable\u63a5\u53e3\uff0c\u5b83\u652f\u6301\u5e8f\u5217\u5316\uff0c\u5b9e\u73b0\u4e86Cloneable\u63a5\u53e3\uff0c\u80fd\u88ab\u514b\u9686\u3002</p> <p>\u533a\u522b\uff1a 1\u3001\u7ee7\u627f\u7684\u7236\u7c7b\u4e0d\u540c Hashtable\u7ee7\u627f\u81eaDictionary\u7c7b\uff0c\u800cHashMap\u7ee7\u627f\u81eaAbstractMap\u7c7b\u3002\u4f46\u4e8c\u8005\u90fd\u5b9e\u73b0\u4e86Map\u63a5\u53e3\u3002</p> <p>2\u3001\u7ebf\u7a0b\u5b89\u5168\u6027\u4e0d\u540c javadoc\u4e2d\u5173\u4e8ehashmap\u7684\u4e00\u6bb5\u63cf\u8ff0\u5982\u4e0b\uff1a\u6b64\u5b9e\u73b0\u4e0d\u662f\u540c\u6b65\u7684\u3002\u5982\u679c\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bbf\u95ee\u4e00\u4e2a\u54c8\u5e0c\u6620\u5c04\uff0c\u800c\u5176\u4e2d\u81f3\u5c11\u4e00\u4e2a\u7ebf\u7a0b\u4ece\u7ed3\u6784\u4e0a\u4fee\u6539\u4e86\u8be5\u6620\u5c04\uff0c\u5219\u5b83\u5fc5\u987b\u4fdd\u6301\u5916\u90e8\u540c\u6b65\u3002 Hashtable \u4e2d\u7684\u65b9\u6cd5\u662fSynchronize\u7684\uff0c\u800cHashMap\u4e2d\u7684\u65b9\u6cd5\u5728\u7f3a\u7701\u60c5\u51b5\u4e0b\u662f\u975eSynchronize\u7684\u3002 \u5728\u591a\u7ebf\u7a0b\u5e76\u53d1\u7684\u73af\u5883\u4e0b\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528Hashtable\uff0c\u4e0d\u9700\u8981\u81ea\u5df1\u4e3a\u5b83\u7684\u65b9\u6cd5\u5b9e\u73b0\u540c\u6b65\uff0c\u4f46\u4f7f\u7528HashMap\u65f6\u5c31\u5fc5\u987b\u8981\u81ea\u5df1\u589e\u52a0\u540c\u6b65\u5904\u7406\u3002</p>"},{"location":"java/container/map/Java-HashMap-source-code/#hashmaphashtablekeynull","title":"HashMap\u4e0eHashTable\u7684key\u80fd\u5426\u4e3anull\uff1f","text":"<p>HashMap\u5bf9\u8c61\u7684key\u3001value\u503c\u5747\u53ef\u4e3anull\u3002 HashTable\u5bf9\u8c61\u7684key\u3001value\u503c\u5747\u4e0d\u53ef\u4e3anull\u3002</p> <p>HashTable\u5bf9\u4e3a\u7a7a\u7684key\u548cvalue\u505a\u4e86\u5904\u7406\uff0c\u4f1a\u629b\u51faNullPointerException</p>"},{"location":"java/container/map/Java-HashMap-source-code/#hashmapnull-key","title":"HashMap\u662f\u5982\u4f55\u5b58\u50a8null key\u7684\uff1f","text":"<p>hashMap\u662f\u6839\u636ekey\u7684hashCode\u8ba1\u7b97\u51fa\u7d22\u5f15\u503c\u6765\u5bfb\u627e\u5b58\u653e\u4f4d\u7f6e\u7684\u3002\u82e5key\u4e3anull\uff0chash\u503c\u8bb0\u4e3a0\uff1b\u7136\u540e\u7ee7\u7eed\u63d2\u5165\u65b9\u6cd5\u3002</p>"},{"location":"java/container/map/Java-HashMap-source-code/#hashhashmap","title":"hash\u51b2\u7a81\u65f6HashMap\u5982\u4f55\u5904\u7406","text":"<p>HashMap\u4e2d\u7ef4\u62a4\u7740Node\u6570\u7ec4<code>Node&lt;K,V&gt;[]</code>\uff0c\u5176\u4e2d\u7684Node\u662f\u94fe\u8868\u8282\u70b9\u6216\u8005\u662f\u4e8c\u53c9\u6811\u8282\u70b9\u3002 \u5982\u679c\u53d1\u751fhash\u51b2\u7a81\uff0c\u8ba1\u7b97\u51fa\u6765\u7684\u6570\u7ec4\u4e0b\u6807\u662f\u540c\u4e00\u4e2a\u3002\u65b0\u589e\u7684\u8282\u70b9\u4f1a\u52a0\u5165\u8be5\u4f4d\u7f6e\u7684\u94fe\u8868\u6216\u4e8c\u53c9\u6811\u4e2d\u3002</p>"},{"location":"java/container/map/Java-HashMap-source-code/#_13","title":"\u53c2\u8003","text":"<ul> <li>\u300aJava\u6838\u5fc3\u6280\u672f \u53771 \u57fa\u7840\u77e5\u8bc6\uff08\u539f\u4e66\u7b2c9\u7248\uff09\u300b</li> <li>Java HashMap \u5de5\u4f5c\u539f\u7406 - coding-geek</li> <li>Java <code>TreeMap</code> \u7b80\u4ecb\u4e0e\u5206\u6790 https://www.ibm.com/developerworks/cn/java/j-lo-tree/index.html</li> </ul>"},{"location":"java/container/map/Java-LinkedHashMap-code/","title":"Java LinkedHashMap \u5b9e\u73b0\u539f\u7406","text":"\u66f4\u65b0\u65e5\u671f 2020-5-25 <ul> <li>2020-5-25 \u521b\u5efa</li> </ul>"},{"location":"java/container/map/Java-LinkedHashMap-code/#linkedhashmap","title":"LinkedHashMap \u6982\u8ff0","text":"<p>HashMap \u662f\u65e0\u5e8f\u7684\uff0cHashMap \u5728 put \u7684\u65f6\u5019\u662f\u6839\u636e key \u7684 hashcode \u8fdb\u884c hash \u7136\u540e\u653e\u5165\u5bf9\u5e94\u7684\u5730\u65b9\u3002\u6240\u4ee5\u5728\u6309\u7167\u4e00\u5b9a\u987a\u5e8f put \u8fdb HashMap \u4e2d\uff0c\u7136\u540e\u904d\u5386\u51fa HashMap \u7684\u987a\u5e8f\u8ddf put \u7684\u987a\u5e8f\u4e0d\u540c\uff08\u9664\u975e\u5728 put \u7684\u65f6\u5019 key \u5df2\u7ecf\u6309\u7167 hashcode \u6392\u5e8f\u53f7\u4e86\uff0c\u8fd9\u79cd\u51e0\u7387\u975e\u5e38\u5c0f\uff09</p> <p>JAVA \u5728 JDK1.4 \u4ee5\u540e\u63d0\u4f9b\u4e86 LinkedHashMap \u6765\u5e2e\u52a9\u6211\u4eec\u5b9e\u73b0\u4e86\u6709\u5e8f\u7684 HashMap\uff01 LinkedHashMap \u662f HashMap \u7684\u4e00\u4e2a\u5b50\u7c7b\uff0c\u5b83\u4fdd\u7559\u63d2\u5165\u7684\u987a\u5e8f\uff0c\u5982\u679c\u9700\u8981\u8f93\u51fa\u7684\u987a\u5e8f\u548c\u8f93\u5165\u65f6\u7684\u76f8\u540c\uff0c\u90a3\u4e48\u5c31\u9009\u7528 LinkedHashMap\u3002</p> <p>LinkedHashMap \u662f Map \u63a5\u53e3\u7684\u54c8\u5e0c\u8868\u548c\u94fe\u63a5\u5217\u8868\u5b9e\u73b0\uff0c\u5177\u6709\u53ef\u9884\u77e5\u7684\u8fed\u4ee3\u987a\u5e8f\u3002\u6b64\u5b9e\u73b0\u63d0\u4f9b\u6240\u6709\u53ef\u9009\u7684\u6620\u5c04\u64cd\u4f5c\uff0c\u5e76\u5141\u8bb8\u4f7f\u7528 null \u503c\u548c null \u952e\u3002\u6b64\u7c7b\u4e0d\u4fdd\u8bc1\u6620\u5c04\u7684\u987a\u5e8f\uff0c\u7279\u522b\u662f\u5b83\u4e0d\u4fdd\u8bc1\u8be5\u987a\u5e8f\u6052\u4e45\u4e0d\u53d8\u3002</p> <p>LinkedHashMap \u5b9e\u73b0\u4e0e HashMap \u7684\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff0cLinkedHashMap \u7ef4\u62a4\u7740\u4e00\u4e2a\u8fd0\u884c\u4e8e\u6240\u6709\u6761\u76ee\u7684\u53cc\u91cd\u94fe\u63a5\u5217\u8868\u3002\u6b64\u94fe\u63a5\u5217\u8868\u5b9a\u4e49\u4e86\u8fed\u4ee3\u987a\u5e8f\uff0c\u8be5\u8fed\u4ee3\u987a\u5e8f\u53ef\u4ee5\u662f\u63d2\u5165\u987a\u5e8f\u6216\u8005\u662f\u8bbf\u95ee\u987a\u5e8f\u3002 \u6ce8\u610f\uff0c\u6b64\u5b9e\u73b0\u4e0d\u662f\u540c\u6b65\u7684\u3002\u5982\u679c\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bbf\u95ee\u94fe\u63a5\u7684\u54c8\u5e0c\u6620\u5c04\uff0c\u800c\u5176\u4e2d\u81f3\u5c11\u4e00\u4e2a\u7ebf\u7a0b\u4ece\u7ed3\u6784\u4e0a\u4fee\u6539\u4e86\u8be5\u6620\u5c04\uff0c\u5219\u5b83\u5fc5\u987b\u4fdd\u6301\u5916\u90e8\u540c\u6b65\u3002 \u6839\u636e\u94fe\u8868\u4e2d\u5143\u7d20\u7684\u987a\u5e8f\u53ef\u4ee5\u5206\u4e3a\uff1a\u6309\u63d2\u5165\u987a\u5e8f\u7684\u94fe\u8868\uff0c\u548c\u6309\u8bbf\u95ee\u987a\u5e8f(\u8c03\u7528 get \u65b9\u6cd5)\u7684\u94fe\u8868\u3002\u9ed8\u8ba4\u662f\u6309\u63d2\u5165\u987a\u5e8f\u6392\u5e8f\uff0c\u5982\u679c\u6307\u5b9a\u6309\u8bbf\u95ee\u987a\u5e8f\u6392\u5e8f\uff0c\u90a3\u4e48\u8c03\u7528get\u65b9\u6cd5\u540e\uff0c\u4f1a\u5c06\u8fd9\u6b21\u8bbf\u95ee\u7684\u5143\u7d20\u79fb\u81f3\u94fe\u8868\u5c3e\u90e8\uff0c\u4e0d\u65ad\u8bbf\u95ee\u53ef\u4ee5\u5f62\u6210\u6309\u8bbf\u95ee\u987a\u5e8f\u6392\u5e8f\u7684\u94fe\u8868\u3002</p>"},{"location":"java/container/map/Java-LinkedHashMap-code/#linkedhashmap_1","title":"LinkedHashMap\u7684\u4f7f\u7528","text":"<p>\u6211\u5728\u6700\u5f00\u59cb\u5b66\u4e60 LinkedHashMap \u7684\u65f6\u5019\uff0c\u770b\u5230\u8bbf\u95ee\u987a\u5e8f\u3001\u63d2\u5165\u987a\u5e8f\u7b49\u7b49\uff0c\u6709\u70b9\u6655\u4e86\uff0c\u968f\u7740\u540e\u7eed\u7684\u5b66\u4e60\u624d\u6162\u6162\u61c2\u5f97\u5176\u4e2d\u539f\u7406\uff0c\u6240\u4ee5\u6211\u4f1a\u5148\u5728\u8fdb\u884c\u505a\u51e0\u4e2a demo \u6765\u6f14\u793a\u4e00\u4e0b LinkedHashMap \u7684\u4f7f\u7528\u3002\u770b\u61c2\u4e86\u5176\u6548\u679c\uff0c\u7136\u540e\u518d\u6765\u7814\u7a76\u5176\u539f\u7406\u3002</p>"},{"location":"java/container/map/Java-LinkedHashMap-code/#hashmap","title":"HashMap","text":"<p>\u770b\u4e0b\u9762\u8fd9\u4e2a\u4ee3\u7801\uff1a <pre><code>public static void main(String[] args) {\n    Map&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();\n    map.put(\"apple\", \"\u82f9\u679c\");\n    map.put(\"watermelon\", \"\u897f\u74dc\");\n    map.put(\"banana\", \"\u9999\u8549\");\n    map.put(\"peach\", \"\u6843\u5b50\");\n\n    Iterator iter = map.entrySet().iterator();\n    while (iter.hasNext()) {\n        Map.Entry entry = (Map.Entry) iter.next();\n        System.out.println(entry.getKey() + \"=\" + entry.getValue());\n    }\n}\n</code></pre></p> <p>\u4e00\u4e2a\u6bd4\u8f83\u7b80\u5355\u7684\u6d4b\u8bd5 HashMap \u7684\u4ee3\u7801\uff0c\u901a\u8fc7\u63a7\u5236\u53f0\u7684\u8f93\u51fa\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230 HashMap \u662f\u6ca1\u6709\u987a\u5e8f\u7684\u3002 <pre><code>banana=\u9999\u8549\napple=\u82f9\u679c\npeach=\u6843\u5b50\nwatermelon=\u897f\u74dc\n</code></pre></p>"},{"location":"java/container/map/Java-LinkedHashMap-code/#linkedhashmap_2","title":"LinkedHashMap","text":"<p>\u4f7f\u7528LinkedHashMap\uff0c\u5728\u6784\u9020\u51fd\u6570\u4e2d\u6307\u5b9a<code>accessOrder</code>\u4e3afalse\u3002\u5373\u6309\u63d2\u5165\u987a\u5e8f\u6392\u5e8f\u3002 <pre><code>Map&lt;String, String&gt; map = new LinkedHashMap&lt;&gt;(16, 0.75f, false);\nmap.put(\"one\", \"1\");\nmap.put(\"two\", \"2\");\nmap.put(\"three\", \"3\");\nmap.put(\"four\", \"4\");\n\nmap.get(\"three\");\nmap.get(\"one\");\n\nIterator iter = map.entrySet().iterator();\nwhile (iter.hasNext()) {\n    Map.Entry entry = (Map.Entry) iter.next();\n    System.out.print(\"{\" + entry.getKey() + \" : \" + entry.getValue() + \"}  \");\n}\n// {one : 1}  {two : 2}  {three : 3}  {four : 4} \n</code></pre> \u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u5176\u8f93\u51fa\u987a\u5e8f\u662f\u5b8c\u6210\u6309\u7167\u63d2\u5165\u987a\u5e8f\u7684\uff01\u4e5f\u5c31\u662f\u6211\u4eec\u4e0a\u9762\u6240\u8bf4\u7684\u4fdd\u7559\u4e86\u63d2\u5165\u7684\u987a\u5e8f\u3002</p> <p>\u6309\u8bbf\u95ee\u987a\u5e8f\u8fdb\u884c\u6392\u5e8f\u3002\u5728\u6784\u9020\u51fd\u6570\u4e2d\u6307\u5b9a<code>accessOrder</code>\u4e3atrue\u3002 <pre><code>Map&lt;String, String&gt; map = new LinkedHashMap&lt;&gt;(16, 0.75f, true);\nmap.put(\"one\", \"1\");\nmap.put(\"two\", \"2\");\nmap.put(\"three\", \"3\");\nmap.put(\"four\", \"4\");\n\nmap.get(\"three\");\nmap.get(\"one\");\n\nIterator iter = map.entrySet().iterator();\nwhile (iter.hasNext()) {\n    Map.Entry entry = (Map.Entry) iter.next();\n    System.out.print(\"{\" + entry.getKey() + \" : \" + entry.getValue() + \"}  \");\n}\n</code></pre></p> <p>\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\u6700\u540e\u8bbf\u95ee\u7684\u662f\u201done\u201d\uff0c\u8f93\u51fa\u7ed3\u679c\uff1a <pre><code>{two : 2}  {four : 4}  {three : 3}  {one : 1}  \n</code></pre> \u8fd9\u4e5f\u5c31\u662f\u6211\u4eec\u4e4b\u524d\u63d0\u5230\u8fc7\u7684\uff0cLinkedHashMap \u53ef\u4ee5\u9009\u62e9\u6309\u7167\u8bbf\u95ee\u987a\u5e8f\u8fdb\u884c\u6392\u5e8f\u3002</p>"},{"location":"java/container/map/Java-LinkedHashMap-code/#linkedhashmap_3","title":"LinkedHashMap \u7684\u5b9e\u73b0","text":"<p>\u6e90\u7801\u6765\u81eaJDK1.8</p> <p>\u5bf9\u4e8e LinkedHashMap \u800c\u8a00\uff0c\u5b83\u7ee7\u627f\u4e0e HashMap(<code>public class LinkedHashMap&lt;K,V&gt; extends HashMap&lt;K,V&gt; implements Map&lt;K,V&gt;</code>)\u3001\u5e95\u5c42\u4f7f\u7528\u54c8\u5e0c\u8868\u4e0e\u53cc\u5411\u94fe\u8868\u6765\u4fdd\u5b58\u6240\u6709\u5143\u7d20\u3002\u5176\u57fa\u672c\u64cd\u4f5c\u4e0e\u7236\u7c7b HashMap \u76f8\u4f3c\uff0c\u5b83\u901a\u8fc7\u91cd\u5199\u7236\u7c7b\u76f8\u5173\u7684\u65b9\u6cd5\uff0c\u6765\u5b9e\u73b0\u81ea\u5df1\u7684\u94fe\u63a5\u5217\u8868\u7279\u6027\u3002\u4e0b\u9762\u6211\u4eec\u6765\u5206\u6790 LinkedHashMap \u7684\u6e90\u4ee3\u7801\uff1a</p>"},{"location":"java/container/map/Java-LinkedHashMap-code/#_1","title":"\u6210\u5458\u53d8\u91cf","text":"<p>LinkedHashMap \u91c7\u7528\u7684 hash \u7b97\u6cd5\u548c HashMap \u76f8\u540c\uff0c\u4f46\u662f\u5b83\u91cd\u65b0\u5b9a\u4e49\u4e86\u6570\u7ec4\u4e2d\u4fdd\u5b58\u7684\u5143\u7d20 Entry\uff0c\u8be5 Entry \u9664\u4e86\u4fdd\u5b58\u5f53\u524d\u5bf9\u8c61\u7684\u5f15\u7528\u5916\uff0c\u8fd8\u4fdd\u5b58\u4e86\u5176\u4e0a\u4e00\u4e2a\u5143\u7d20 before \u548c\u4e0b\u4e00\u4e2a\u5143\u7d20 after \u7684\u5f15\u7528\uff0c\u4ece\u800c\u5728\u54c8\u5e0c\u8868\u7684\u57fa\u7840\u4e0a\u53c8\u6784\u6210\u4e86\u53cc\u5411\u94fe\u63a5\u5217\u8868\u3002\u770b\u6e90\u4ee3\u7801\uff1a <pre><code>/**\n* The iteration ordering method for this linked hash map: &lt;tt&gt;true&lt;/tt&gt;\n* for access-order, &lt;tt&gt;false&lt;/tt&gt; for insertion-order.\n*/\nfinal boolean accessOrder; // \u5982\u679c\u4e3atrue\uff0c\u5219\u6309\u7167\u8bbf\u95ee\u987a\u5e8f\uff1b\u5982\u679c\u4e3afalse\uff0c\u5219\u6309\u7167\u63d2\u5165\u987a\u5e8f\u3002\n\n/**\n* The head (eldest) of the doubly linked list.\n*/\ntransient LinkedHashMap.Entry&lt;K,V&gt; head;\n\n/**\n* The tail (youngest) of the doubly linked list.\n*/\ntransient LinkedHashMap.Entry&lt;K,V&gt; tail;\n\n/**\n* LinkedHashMap\u7684Entry\u9759\u6001\u5185\u90e8\u7c7b\u3002\n* \u7ee7\u627fHashMap\u7684Node\u5143\u7d20\uff0c\u5176\u4e2d\u4fdd\u5b58\u4e86\u5176\u4e0a\u4e00\u4e2a\u5143\u7d20before\u548c\u4e0b\u4e00\u4e2a\u5143\u7d20after\u7684\u5f15\u7528\u3002\n*/\nstatic class Entry&lt;K,V&gt; extends HashMap.Node&lt;K,V&gt; {\n    Entry&lt;K,V&gt; before, after;\n    Entry(int hash, K key, V value, Node&lt;K,V&gt; next) {\n        super(hash, key, value, next);\n    }\n}\n</code></pre> LinkedHashMap \u4e2d\u7684 Entry \u7ee7\u627f\u4e86 HashMap\u4e2d\u7684 Node\uff0c\u4f46\u662f\u5176\u589e\u52a0\u4e86 before \u548c after \u7684\u5f15\u7528\uff0c\u6307\u7684\u662f\u4e0a\u4e00\u4e2a\u5143\u7d20\u548c\u4e0b\u4e00\u4e2a\u5143\u7d20\u7684\u5f15\u7528\u3002</p>"},{"location":"java/container/map/Java-LinkedHashMap-code/#_2","title":"\u521d\u59cb\u5316","text":"<p>\u901a\u8fc7\u6e90\u4ee3\u7801\u53ef\u4ee5\u770b\u51fa\uff0c\u5728 LinkedHashMap \u7684\u6784\u9020\u65b9\u6cd5\u4e2d\uff0c\u5b9e\u9645\u8c03\u7528\u4e86\u7236\u7c7b HashMap \u7684\u76f8\u5173\u6784\u9020\u65b9\u6cd5\u6765\u6784\u9020\u4e00\u4e2a\u5e95\u5c42\u5b58\u653e\u7684 table \u6570\u7ec4\uff0c\u4f46\u989d\u5916\u53ef\u4ee5\u589e\u52a0 accessOrder \u8fd9\u4e2a\u53c2\u6570\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e\uff0c\u9ed8\u8ba4\u4e3a false\uff0c\u4ee3\u8868\u6309\u7167\u63d2\u5165\u987a\u5e8f\u8fdb\u884c\u8fed\u4ee3\uff1b\u5f53\u7136\u53ef\u4ee5\u663e\u5f0f\u8bbe\u7f6e\u4e3a true\uff0c\u4ee3\u8868\u4ee5\u8bbf\u95ee\u987a\u5e8f\u8fdb\u884c\u8fed\u4ee3\u3002\u5982\uff1a <pre><code>public LinkedHashMap(int initialCapacity, float loadFactor,boolean accessOrder) {\n    super(initialCapacity, loadFactor);\n    this.accessOrder = accessOrder;\n}\n</code></pre></p>"},{"location":"java/container/map/Java-LinkedHashMap-code/#_3","title":"\u5b58\u50a8","text":"<p>LinkedHashMap \u5e76\u672a\u91cd\u5199\u7236\u7c7b HashMap \u7684 put \u65b9\u6cd5\u3002 HashMap\u4e2d\u63d0\u4f9b\u4e863\u4e2a\u65b9\u6cd5\u7ed9LinkedHashMap\u3002 <pre><code>// Callbacks to allow LinkedHashMap post-actions\nvoid afterNodeAccess(Node&lt;K,V&gt; p) { }\nvoid afterNodeInsertion(boolean evict) { }\nvoid afterNodeRemoval(Node&lt;K,V&gt; p) { }\n</code></pre> afterNodeRemoval\u662f\u628a\u8282\u70b9\u4ece\u94fe\u8868\u4e2d\u5220\u53bb\u3002 LinkedHashMap\u91cd\u5199\u4e86afterNodeInsertion\u65b9\u6cd5\u3002\u63d2\u5165\u65b0\u8282\u70b9\u540e\uff0c\u6709\u53ef\u80fd\u4f1a\u5220\u6389\u201c\u6700\u8001\u201d\u7684\u8282\u70b9\u3002 afterNodeAccess\u65b9\u6cd5\u5219\u662f\u628a\u65b0\u63d2\u5165\u7684\u8282\u70b9\u79fb\u5230\u961f\u5c3e\u3002 <pre><code>void afterNodeInsertion(boolean evict) { // possibly remove eldest\n    LinkedHashMap.Entry&lt;K,V&gt; first;\n    if (evict &amp;&amp; (first = head) != null &amp;&amp; removeEldestEntry(first)) {\n        K key = first.key;\n        removeNode(hash(key), key, null, false, true);\n    }\n}\n\nvoid afterNodeAccess(Node&lt;K,V&gt; e) { // move node to last\n    LinkedHashMap.Entry&lt;K,V&gt; last;\n    if (accessOrder &amp;&amp; (last = tail) != e) {\n        LinkedHashMap.Entry&lt;K,V&gt; p =\n            (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after;\n        p.after = null;\n        if (b == null)\n            head = a;\n        else\n            b.after = a;\n        if (a != null)\n            a.before = b;\n        else\n            last = b;\n        if (last == null)\n            head = p;\n        else {\n            p.before = last;\n            last.after = p;\n        }\n        tail = p;\n        ++modCount;\n    }\n}\n</code></pre></p>"},{"location":"java/container/map/Java-LinkedHashMap-code/#_4","title":"\u8bfb\u53d6","text":"<p>LinkedHashMap \u91cd\u5199\u4e86\u7236\u7c7b HashMap \u7684 get \u65b9\u6cd5\uff0c\u5b9e\u9645\u5728\u8c03\u7528\u7236\u7c7bgetNode() \u65b9\u6cd5\u53d6\u5f97\u67e5\u627e\u7684\u5143\u7d20\u540e\uff0c\u5982\u679c accessOrder \u4e3a true \u65f6\uff0c\u6267\u884cafterNodeAccess\u65b9\u6cd5\u3002\u7531\u4e8e\u7684\u94fe\u8868\u7684\u589e\u52a0\u3001\u5220\u9664\u64cd\u4f5c\u662f\u5e38\u91cf\u7ea7\u7684\uff0c\u5bf9\u6027\u80fd\u5f71\u54cd\u5c0f\u3002 <pre><code>public V get(Object key) {\n    Node&lt;K,V&gt; e;\n    if ((e = getNode(hash(key), key)) == null)\n        return null;\n    if (accessOrder)\n        afterNodeAccess(e);\n    return e.value;\n}\n</code></pre></p>"},{"location":"java/container/map/Java-LinkedHashMap-code/#_5","title":"\u6392\u5e8f\u6a21\u5f0f","text":"<p>LinkedHashMap boolean\u53d8\u91cf accessOrder\u3002True\u6309\u8bbf\u95ee\u987a\u5e8f\u6392\u5e8f\uff1b\u4e3a false\u6309\u63d2\u5165\u987a\u5e8f\u3002\u9ed8\u8ba4\u4e3afalse\u3002</p> <p>\u8be5\u54c8\u5e0c\u6620\u5c04\u7684\u8fed\u4ee3\u987a\u5e8f\u5c31\u662f\u6700\u540e\u8bbf\u95ee\u5176\u6761\u76ee\u7684\u987a\u5e8f\uff0c\u8fd9\u79cd\u6620\u5c04\u5f88\u9002\u5408\u6784\u5efa LRU \u7f13\u5b58\u3002Android\u4e2d\u63d0\u4f9b\u4e86\u57fa\u4e8eLinkedHashMap \u6784\u5efa\u7684 LRU \u7f13\u5b58\u7c7b LRUCache\u3002</p>"},{"location":"java/container/map/Java-LinkedHashMap-code/#_6","title":"\u603b\u7ed3","text":"<p>\u5176\u5b9e LinkedHashMap \u51e0\u4e4e\u548c HashMap \u4e00\u6837\u3002\u5b83\u7684\u8282\u70b9\u7c7b\u5b9e\u73b0\u4e86\u53cc\u5411\u94fe\u8868\uff0c\u53ef\u4ee5\u652f\u6301\u6309\u63d2\u5165\u987a\u5e8f\u6216\u8bbf\u95ee\u987a\u5e8f\u6392\u5e8f\u7684\u64cd\u4f5c\u3002</p> <p>\u53c2\u8003</p> <ul> <li>http://wiki.jikexueyuan.com/project/java-collection/linkedhashmap.html</li> </ul>"},{"location":"java/container/map/Java-read-write-properties/","title":"Java Properties\uff0c\u8bfb\u53d6\u4f7f\u7528","text":"<p>Java \u8bfb\u5199Properties\u914d\u7f6e\u6587\u4ef6</p>"},{"location":"java/container/map/Java-read-write-properties/#propertiesproperties","title":"Properties\u7c7b\u4e0eProperties\u914d\u7f6e\u6587\u4ef6","text":"<p>Properties\u7c7b\u7ee7\u627f\u81eaHashtable\u7c7b\u5e76\u4e14\u5b9e\u73b0\u4e86Map\u63a5\u53e3\uff0c\u4e5f\u662f\u4f7f\u7528\u4e00\u79cd\u952e\u503c\u5bf9\u7684\u5f62\u5f0f\u6765\u4fdd\u5b58\u5c5e\u6027\u96c6\u3002\u4e0d\u8fc7Properties\u6709\u7279\u6b8a\u7684\u5730\u65b9\uff0c\u5c31\u662f\u5b83\u7684\u952e\u548c\u503c\u90fd\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\u3002</p> <p>Properties \u7c7b\u88ab\u8bb8\u591aJava\u7c7b\u4f7f\u7528\u3002\u4f8b\u5982\uff0c\u5728\u83b7\u53d6\u73af\u5883\u53d8\u91cf\u65f6\u5b83\u5c31\u4f5c\u4e3a<code>System.getProperties()</code>\u65b9\u6cd5\u7684\u8fd4\u56de\u503c\u3002</p>"},{"location":"java/container/map/Java-read-write-properties/#properties","title":"Properties\u4e2d\u7684\u4e3b\u8981\u65b9\u6cd5","text":""},{"location":"java/container/map/Java-read-write-properties/#loadinputstream-instream","title":"load(InputStream inStream)","text":"<p>\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u4ece.properties\u5c5e\u6027\u6587\u4ef6\u5bf9\u5e94\u7684\u6587\u4ef6\u8f93\u5165\u6d41\u4e2d\uff0c\u52a0\u8f7d\u5c5e\u6027\u5217\u8868\u5230Properties\u7c7b\u5bf9\u8c61\u3002\u5982\u4e0b\u9762\u7684\u4ee3\u7801\uff1a <pre><code>// \u8bfb\u53d6\u5c5e\u6027\u6587\u4ef6a.properties\nInputStream in = new BufferedInputStream(new FileInputStream(\"a.properties\"));\nprop.load(in); // \u52a0\u8f7d\u5c5e\u6027\u5217\u8868\nfor (String key : prop.stringPropertyNames()) {\n    System.out.println(key + \":\" + prop.getProperty(key));\n}\nin.close();\n</code></pre></p>"},{"location":"java/container/map/Java-read-write-properties/#storeoutputstream-out-string-comments","title":"store(OutputStream out, String comments)","text":"<p>\u8fd9\u4e2a\u65b9\u6cd5\u5c06Properties\u7c7b\u5bf9\u8c61\u7684\u5c5e\u6027\u5217\u8868\u4fdd\u5b58\u5230\u8f93\u51fa\u6d41\u4e2d\u3002\u5982\u4e0b\u9762\u7684\u4ee3\u7801\uff1a <pre><code>// \u4fdd\u5b58\u5c5e\u6027\u5230b.properties\u6587\u4ef6\nFileOutputStream bFile = new FileOutputStream(\"b.properties\", true); // true\u8868\u793a\u8ffd\u52a0\u6253\u5f00\nprop.setProperty(\"phone\", \"10086\");\nprop.store(bFile, \"The New properties file\\nWritten by Rust\");\nbFile.close();\n</code></pre> comments \u8868\u793a\u6ce8\u91ca\u4fe1\u606f\uff1b\u6ce8\u91ca\u4fe1\u606f\u540e\u9762\u662f\u5c5e\u6027\u6587\u4ef6\u7684\u5f53\u524d\u4fdd\u5b58\u65f6\u95f4\u4fe1\u606f\u3002</p>"},{"location":"java/container/map/Java-read-write-properties/#getpropertysetproperty","title":"getProperty/setProperty","text":"<p>\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u662f\u5206\u522b\u662f\u83b7\u53d6\u548c\u8bbe\u7f6e\u5c5e\u6027\u4fe1\u606f\u3002 <pre><code>public static void main(String[] args) {\n    Properties prop = new Properties();\n    try {\n        // \u8bfb\u53d6\u5c5e\u6027\u6587\u4ef6a.properties\n        InputStream in = new BufferedInputStream(new FileInputStream(\"a.properties\"));\n        prop.load(in); // \u52a0\u8f7d\u5c5e\u6027\u5217\u8868\n        for (String key : prop.stringPropertyNames()) {\n            System.out.println(key + \":\" + prop.getProperty(key));\n        }\n        in.close();\n\n        // \u4fdd\u5b58\u5c5e\u6027\u5230b.properties\u6587\u4ef6\n        FileOutputStream bFile = new FileOutputStream(\"b.properties\", true);//true\u8868\u793a\u8ffd\u52a0\u6253\u5f00\n        prop.setProperty(\"phone\", \"10086\");\n        prop.store(bFile, \"The New properties file\\nWritten by Rust\");\n        bFile.close();\n\n        FileOutputStream cFile = new FileOutputStream(\"c.properties\", false);\n        prop.store(cFile, null);\n        cFile.close();\n    } catch (Exception e) {\n        System.out.println(e);\n    }\n}\n</code></pre></p> <p>\u8fd0\u884c\u7ed3\u679c\u5982\u4e0b <pre><code>a.properties\nname=root\npass=liu\nkey=value\n</code></pre></p> <pre><code>b.properties\n#The New properties file\n#Written by Rust\n#Thu May 23 22:34:36 GMT+08:00 2019\nphone=10086\nname=root\nkey=value\npass=liu\n</code></pre> <pre><code>c.properties\n#Thu May 23 22:34:36 GMT+08:00 2019\nphone=10086\nname=root\nkey=value\npass=liu\n</code></pre>"},{"location":"java/interface/java-interface-and-abstract-class/","title":"\u63a5\u53e3\u4e0e\u62bd\u8c61\u7c7b","text":"<ul> <li>\u7c7b(class)\u662f\u6784\u9020\u5bf9\u8c61\u7684\u6a21\u677f\u6216\u84dd\u56fe\u3002</li> <li>\u62bd\u8c61\u7c7b\u4f5c\u4e3a\u6d3e\u751f\u5176\u5b83\u7c7b\u7684\u57fa\u7c7b\uff0c\u800c\u4e0d\u4f5c\u4e3a\u60f3\u4f7f\u7528\u7684\u7279\u5b9a\u7684\u5b9e\u4f8b\u7c7b\u3002</li> <li>\u62bd\u8c61\u65b9\u6cd5\u5145\u5f53\u7740\u5360\u4f4d\u7684\u89d2\u8272\uff0c\u5b83\u4eec\u7684\u5177\u4f53\u5b9e\u73b0\u5728\u5b50\u7c7b\u4e2d\u3002</li> <li>\u6bcf\u4e2a\u7c7b\u53ea\u80fd\u6269\u5c55\u4e8e\u4e00\u4e2a\u7c7b\uff08\u5355\u7ee7\u627f\uff09\u3002</li> <li>\u63a5\u53e3(interface)\u4e3b\u8981\u7528\u6765\u63cf\u8ff0\u7c7b\u5177\u6709\u4ec0\u4e48\u529f\u80fd\uff0c\u800c\u4e0d\u7ed9\u51fa\u6bcf\u4e2a\u529f\u80fd\u7684\u5177\u4f53\u5b9e\u73b0\u3002</li> </ul> <p>\u4e00\u4e2a\u7c7b\u53ef\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u6216\u591a\u4e2a\u63a5\u53e3\u3002</p> <ul> <li>\u63a5\u53e3\u4e0d\u662f\u7c7b\u3002</li> <li>\u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5\u90fd\u81ea\u52a8\u5730\u8bbe\u7f6e\u4e3a<code>public</code>\u3002</li> <li>\u63a5\u53e3\u4e2d\u7684\u57df\u81ea\u52a8\u8bbe\u7f6e\u4e3a<code>public static final</code>\u3002</li> </ul> <p>\u9009\u62e9\u63a5\u53e3\u548c\u62bd\u8c61\u7c7b\u662f\u4e0d\u662f\u4e00\u4e2a\u975e\u6b64\u5373\u5f7c\u7684\u547d\u9898\u3002\u5982\u679c\u4f60\u9700\u8981\u4fee\u6539\u4f60\u7684\u8bbe\u8ba1\uff0c\u4f7f\u7528\u63a5\u53e3\u3002\u7136\u800c\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u62bd\u8c61\u7c7b\u6765\u63d0\u4f9b\u4e00\u4e9b\u9ed8\u8ba4\u7684\u65b9\u6cd5\u3002\u5728\u5e94\u7528\u6846\u67b6\u4e2d\uff0c\u62bd\u8c61\u7c7b\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\u3002</p> <p>\u62bd\u8c61\u7c7b\u8ba9\u4f60\u5b9a\u4e49\u4e00\u4e9b\u64cd\u4f5c\uff1b\u5e76\u4e14\u5f3a\u8feb\u5b50\u7c7b\u53bb\u63d0\u4f9b\u53e6\u5916\u7684\u65b9\u6cd5\u3002\u6bd4\u5982\uff0c\u4f60\u6709\u4e00\u4e2a\u5e94\u7528\u6846\u67b6\uff0c\u4e00\u4e2a\u62bd\u8c61\u7c7b\u53ef\u4ee5\u63d0\u4f9b\u50cf\u662f\u5904\u7406\u6d88\u606f\u548c\u4e8b\u4ef6\u7684\u9ed8\u8ba4\u670d\u52a1\u3002\u8fd9\u4e9b\u670d\u52a1\u5141\u8bb8\u4f60\u7684\u5e94\u7528\u8fde\u63a5\u5230\u5e94\u7528\u6846\u67b6\u3002\u7136\u800c\uff0c\u4e00\u4e9b\u5e94\u7528\u72ec\u6709\u7684\u529f\u80fd\u53ea\u80fd\u5728\u4f60\u7684\u5e94\u7528\u4e2d\u4f7f\u7528\u3002 \u72ec\u6709\u7684\u529f\u80fd\u6bd4\u5982\u5e94\u7528\u4f9d\u8d56\u7684\u542f\u52a8\u548c\u5173\u95ed\u4efb\u52a1\u3002\u62bd\u8c61\u7c7b\u53ef\u4ee5\u58f0\u660e\u62bd\u8c61\u7684\u5173\u95ed\u548c\u542f\u52a8\u65b9\u6cd5\uff0c\u800c\u4e0d\u7528\u518d\u81ea\u5df1\u5b9a\u4e49\u3002\u57fa\u7840\u7c7b\u77e5\u9053\u5b83\u9700\u8981\u8fd9\u4e9b\u65b9\u6cd5\uff0c\u4f46\u4f60\u7684\u5b50\u7c7b\u4e0d\u77e5\u9053\u5982\u4f55\u53bb\u5b9e\u73b0\u90a3\u4e9b\u65b9\u6cd5\uff0c\u53ea\u77e5\u9053\u5fc5\u987b\u7ee7\u627f\u8fd9\u4e9b\u52a8\u4f5c\u3002\u9700\u8981\u542f\u52a8\u65f6\uff0c\u62bd\u8c61\u7c7b\u80fd\u8c03\u7528\u542f\u52a8\u65b9\u6cd5\u3002 \u5f53\u57fa\u7c7b\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\uff0cJava\u8c03\u7528\u5b50\u7c7b\u590d\u5199\u7684\u65b9\u6cd5\u3002</p> <p>\u5f88\u591a\u5f00\u53d1\u8005\u5fd8\u8bb0\u4e86\u5b9a\u4e49\u4e86\u62bd\u8c61\u65b9\u6cd5\u7684\u7c7b\u4e5f\u80fd\u591f\u8c03\u7528\u8fd9\u4e9b\u65b9\u6cd5\u3002\u62bd\u8c61\u7c7b\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u65b9\u6cd5\u6765\u521b\u5efa\u8ba1\u5212\u7684\u7ee7\u627f\u5c42\u6b21\u7ed3\u6784\u3002 \u5b83\u4eec\u5bf9\u4e8e\u7c7b\u7ee7\u627f\u4e2d\u7684\u975e\u53f6\u5c42\u6b21\u662f\u4e00\u4e2a\u597d\u7684\u9009\u62e9\u3002</p> <p>http://www.javaworld.com/article/2077421/learn-java/abstract-classes-vs-interfaces.html</p>"},{"location":"java/io/Java-read-write-file/","title":"Java\u8bfb\u5199\u6587\u4ef6","text":"<p>\u8bfb\u5199\u6587\u4ef6\u529f\u80fd\u6211\u4eec\u4e00\u822c\u4f7f\u7528Stream\uff08\u6d41\uff09\u6765\u5b9e\u73b0\u3002</p>"},{"location":"java/io/Java-read-write-file/#printwriter","title":"\u4f7f\u7528PrintWriter","text":"<p>\u4f7f\u7528PrintWriter\uff0c\u5199\u5165\u5b57\u8282\u3002 <pre><code>    private static void writeToFile(File outputDir, String filename, byte[] bytes) {\n        try {\n            File outFile = new File(outputDir, filename);\n            if (outFile.exists()) {\n                outFile.delete();\n            }\n            outFile.createNewFile();\n            PrintWriter printWriter = new PrintWriter(new FileOutputStream(outFile));\n            for (int j = 0; j &lt; bytes.length; j++) {\n                printWriter.print(Integer.toHexString(bytes[j] &amp; 0xff));\n                if (j &lt; bytes.length - 1) {\n                    printWriter.print(\"\\n\");\n                }\n            }\n            printWriter.flush();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n</code></pre></p> <p>FileWriter\u5199\u6587\u4ef6\uff0c\u5199\u5165\u5b57\u7b26\u4e32 <pre><code>    try {\n        FileWriter fileWriter = new FileWriter(fftFile, true);\n        for (int j = 0; j &lt; nums.length; j++) {\n            fileWriter.write(String.valueOf(fftCovert[j]));\n            if ((j + 1) % (128) == 0) {\n                fileWriter.write(\"\\r\\n\");\n                fileWriter.flush();\n            } else {\n                fileWriter.write(\",\");\n            }\n        }\n        fileWriter.flush();\n        fileWriter.close();\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n</code></pre></p>"},{"location":"java/io/Java-read-write-file/#hexcsv","title":"\u8bfbHex\u5199CSV","text":"<p>data\u76ee\u5f55\u4e0b\u6709little-endian bin\u6587\u4ef6\uff0c2\u4e2a\u5b57\u8282\u4ee3\u8868\u4e00\u4e2a\u6570\u5b57\u3002 bin\u5b58\u50a8\u7684\u6570\u636e\u683c\u5f0f\u53ef\u81ea\u5df1\u5b9a\u4e49\u3002\u76f8\u540c\u7684\u65b9\u6cd5\u53ef\u4ee5\u76f4\u63a5\u5e94\u7528\u5230Android\u4e2d\u3002</p> <pre><code>`-- networkProj\n    |-- data\n    |-- networkProj.iml\n    |-- out\n    `-- src\n</code></pre> <p>\u5b9e\u73b0\u65b9\u6cd5</p> <pre><code>private static void convertFiles() {\n    File folder = new File(\"data\"); // data folder\n    log(\"--------- Read little-endian data from bin file ---------\");\n    if (!folder.exists()) {\n        log(\"folder is not exist!\");\n        return;\n    }\n    File outputFolder = new File(folder.getAbsolutePath() + File.separator + \"output\");\n    if (!outputFolder.exists()) {\n        boolean newOutput = outputFolder.mkdir();\n        log(\"New output folder  \" + newOutput);\n    }\n    File[] files = folder.listFiles();\n    if (files != null) {\n        log(\"folder is  \" + folder.getAbsolutePath());\n        for (File f : files) {\n            log(\"\\t\" + f.getName());\n        }\n    } else {\n        log(\"Nothing in this folder\");\n        return;\n    }\n\n    for (File currentFile : files) {\n        if (!currentFile.isFile()) {\n            return;\n        }\n        String fileName = currentFile.getName();\n        fileName = fileName.substring(0, fileName.length() - 4); // delete suffix\n        File csvFile = new File(outputFolder.getAbsolutePath() + File.separator + fileName + \".csv\");\n        if (csvFile.exists()) {\n            boolean deRes = csvFile.delete();\n            log(\"Delete old csv: \" + deRes);\n        }\n        byte[] readBytes = new byte[512];\n        try {\n            boolean newCsv = csvFile.createNewFile();\n            log(csvFile.getAbsolutePath() + \" \" + newCsv);\n            FileOutputStream csvFos = new FileOutputStream(csvFile);\n            InputStream in = new FileInputStream(currentFile);\n            while (in.read(readBytes) != -1) {\n                int[] csvData = convertBytesToInts(readBytes);\n                for (int d : csvData) {\n                    csvFos.write(String.valueOf(d).getBytes());\n                    csvFos.write(\"\\n\".getBytes());\n                }\n            }\n            csvFos.flush();\n            csvFos.close();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n\n// little-endian; 2 bytes -&gt; 1 int\nprivate static int[] convertBytesToInts(byte[] inputData) {\n    int[] rawData = new int[inputData.length / 2];\n    int rawIndex = 0;\n    for (int i = 0; i &lt; inputData.length; i += 2) {\n        int raw = (0xff &amp; inputData[i + 1]) * 256 + (0xff &amp; inputData[i]);\n        if (raw &gt;= 32768) {\n            raw -= 65536;\n        }\n        rawData[rawIndex] = raw;\n        rawIndex++;\n    }\n    return rawData;\n}\n\nprivate static void log(String l) {\n    System.out.println(l);\n}\n</code></pre> <p>\u63a7\u5236\u53f0\u8f93\u51fa</p> <pre><code>--------- Read little-endian data from bin file ---------\nNew output folder  true\nfolder is  G:\\javaProj\\networkProj\\data\n    data20170215_180621.bin\n    output\nG:\\javaProj\\networkProj\\data\\output\\data20170215_180621.csv true\n</code></pre>"},{"location":"java/io/Java-read-write-xls/","title":"Java \u8bfb\u5199xls\u6587\u4ef6","text":"<ul> <li>win7_x64</li> <li>IDEA</li> </ul>"},{"location":"java/io/Java-read-write-xls/#javaxlsjxljar","title":"Java\u8bfb\u5199xls\u6587\u4ef6\uff0c\u4f7f\u7528\u5e93<code>jxl.jar</code>","text":"<p>\u8bfb\u5199xls\u6587\u4ef6\uff0c\u8fd9\u91cc\u662f\u5728\u77e5\u9053\u8868\u683c\u683c\u5f0f\u7684\u524d\u63d0\u4e0b\u8fdb\u884c\u64cd\u4f5c\u7684\u3002 \u76ee\u524d\u65e0\u6cd5\u64cd\u4f5cxlsx\u6587\u4ef6</p>"},{"location":"java/io/Java-read-write-xls/#_1","title":"\u51c6\u5907\u5de5\u4f5c","text":"<p>\u5c06\u5e93<code>jxl.jar</code>\u6dfb\u52a0\u5230\u5de5\u7a0b\u4f9d\u8d56\u4e2d  </p>"},{"location":"java/io/Java-read-write-xls/#java","title":"Java\u4ee3\u7801\u793a\u4f8b","text":""},{"location":"java/io/Java-read-write-xls/#_2","title":"\u793a\u4f8b\uff1a\u4ece\u51e0\u4e2a\u6587\u4ef6\u4e2d\u8bfb\u53d6\u6570\u636e\u5e76\u6c47\u603b\u5230\u4e00\u4e2a\u6587\u4ef6\u4e2d","text":"<p>\u8868\u683c\u4e2d\u7684\u6570\u636e\u89c4\u5b9a\u4e3a\uff1a\u9996\u884c\u4e3a\u6807\u9898\uff0c\u4ee5\u4e0b\u662f\u6570\u636e\u548c\u540d\u79f0\uff1b\u4f8b\u5982 <pre><code>\u5355\u4f4d\u540d \u91d1\u989d\n\u5355\u4f4d1 948.34\n\u5355\u4f4d2 4324\n\u5355\u4f4d5 324\n</code></pre></p> <p>\u51c6\u5907\u597d\u8868\u683c\u6587\u4ef6\uff0c\u653e\u5728\u6307\u5b9a\u76ee\u5f55\u4e0b</p> <p>\u793a\u4f8b\u8fc7\u7a0b\u5927\u81f4\u4e3a\uff1a\u5728\u6307\u5b9a\u76ee\u5f55\u627e\u5230\u6240\u6709xls\u6587\u4ef6\uff1b\u904d\u5386\u6240\u6709\u6587\u4ef6\uff0c\u8bfb\u53d6 \u51fa\u6240\u6709\u7684\u5355\u4f4d\u540d\u79f0\uff1b\u5c06\u5355\u4f4d\u540d\u79f0\u6392\u5e8f\uff1b\u518d\u904d\u5386\u4e00\u6b21\u6240\u6709\u6587\u4ef6\uff0c\u5c06\u6bcf\u4e2a \u6587\u4ef6\u4e2d\u5355\u4f4d\u5bf9\u5e94\u7684\u91d1\u989d\u8bfb\u51fa\u5e76\u5b58\u50a8\uff1b\u6700\u540e\u5199\u5230\u8f93\u51fa\u8868\u683c\u4e2d\u3002</p> <pre><code>final String wsFileDir = \"H:/OtherWorkDocs/ws\"; // \u539f\u59cb\u6570\u636e\u5b58\u653e\u7684\u76ee\u5f55\nfinal String resFilePath = \"H:/OtherWorkDocs/output/jan_feb_mar_sum.xls\";\nRWExcel rwExcel = new RWExcel(); // \u64cd\u4f5cxls\u7684\u5b9e\u4f8b\n// \u83b7\u53d6\u6240\u6709\u7684\u540d\u79f0\u5e76\u6392\u5e8f\nTreeSet&lt;String&gt; nameSet = rwExcel.getNameSet(wsFileDir);\n// \u5c06\u540d\u79f0\u4e0e\u4e0b\u6807\u5b58\u5165map\u4e2d\nHashMap&lt;String, Integer&gt; nameRowHashMap = rwExcel.getNameRowHashMap(nameSet);\n\nFile wsDir = new File(wsFileDir); // \u6e90\u6587\u4ef6\u76ee\u5f55\nFile[] sourceFiles = wsDir.listFiles();\n\n// \u5b58\u50a8\u5355\u4f4d\u540d\u79f0\u4e0e\u91d1\u989d\u5bf9\u5e94\u7684\u6570\u636e\nList&lt;HashMap&lt;String, Float&gt;&gt; dataList = new ArrayList&lt;&gt;(10);\nif (sourceFiles != null) {\n    for (File sF : sourceFiles) {\n        // \u88c5\u8f7d\u6570\u636e\n        dataList.add(rwExcel.getSourceData(sF.getAbsolutePath()));\n    }\n}\n// \u539f\u59cb\u6570\u636e\u5df2\u7ecf\u5168\u90e8\u8bfb\u51fa\u6765\uff0c\u548c\u540d\u79f0\u4e00\u6b21\u6027\u5168\u90e8\u5199\u5165\nrwExcel.writeAllToResFile(resFilePath, nameRowHashMap, dataList);\n\n// \u8865\u5145\u6807\u9898\u680f\u7684\u6807\u9898\nif (null != sourceFiles) {\n    int col = 1; // \u8d77\u59cb\u5217\u7684\u5e8f\u53f7\n    for (File f : sourceFiles) {\n        String fileName = f.getName();\n        String name = fileName.substring(0, fileName.length() - 4);\n        rwExcel.updateContent(resFilePath, name, 0, col);\n        col++;\n    }\n}\n</code></pre>"},{"location":"java/io/Java-read-write-xls/#java_1","title":"Java\u4ee3\u7801","text":"<p>\u65b0\u5efa\u4e00\u4e2a\u7c7b<code>RWExcel</code>\u6765\u64cd\u4f5cxls\u6587\u4ef6\u3002 <pre><code>public class RWExcel {\n\n    /**\n     * \u5b58\u50a8\u540d\u79f0\n     */\n    private TreeSet&lt;String&gt; nameTreeSet = new TreeSet&lt;&gt;();\n\n    /**\n     * \u540d\u79f0\u4ee5\u53ca\u6392\u5217\u7684\u4e0b\u6807\u53f7\n     */\n    private HashMap&lt;String, Integer&gt; nameRowMap = new HashMap&lt;&gt;();\n\n    public TreeSet&lt;String&gt; getNameSet(String wsPath) {\n        try {\n            File wsDir = new File(wsPath);\n            if (wsDir.exists() &amp;&amp; wsDir.isDirectory()) {\n                println(\"\u5de5\u4f5c\u76ee\u5f55\u5b58\u5728\");\n                File[] files = wsDir.listFiles();\n                if (files != null &amp;&amp; files.length &gt; 0) {\n                    for (File cFile : files) {\n                        getNamesFromFile(cFile, this.nameTreeSet);\n                    }\n                }\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        this.nameTreeSet.comparator();\n        return this.nameTreeSet;\n    }\n\n    /**\n     * \u5c06\u540d\u79f0Set\u6392\u5e8f\u540e\u5b58\u5165HashMap\n     * \u4e0b\u6807\u4ece1\u5f00\u59cb\n     */\n    public HashMap&lt;String, Integer&gt; getNameRowHashMap(TreeSet&lt;String&gt; nameSet) {\n        nameSet.comparator();\n        int index = 1;\n        for (String name : nameSet) {\n            this.nameRowMap.put(name, index);\n            index++;\n        }\n        return this.nameRowMap;\n    }\n\n    /**\n     * \u6240\u6709\u6570\u636e\u5b58\u5165\u8868\u683c\n     */\n    public void writeAllToResFile(String resFilePath, Map&lt;String, Integer&gt; nameMap, List&lt;HashMap&lt;String, Float&gt;&gt; dataList) {\n        File resFile = new File(resFilePath);\n        if (!resFile.exists()) {\n            try {\n                resFile.createNewFile();\n            } catch (IOException e) {\n                e.printStackTrace();\n            }\n        }\n        if (resFile.exists()) {\n            try {\n                // \u5148\u5199\u540d\u79f0\n                WritableWorkbook wwb = Workbook.createWorkbook(resFile);\n                WritableSheet ws = wwb.createSheet(\"sum\", 0);\n                Label label = new Label(0, 0, \"\u5355\u4f4d\u540d\u79f0\");\n                ws.addCell(label);\n                for (Map.Entry&lt;String, Integer&gt; entry : nameMap.entrySet()) {\n                    Label nameLabel = new Label(0, entry.getValue(), entry.getKey());\n                    ws.addCell(nameLabel);\n                    for (int j = 0; j &lt; dataList.size(); j++) {\n                        Number zeroCell = new Number(j + 1, entry.getValue(), 0);\n                        ws.addCell(zeroCell);\n                    }\n                }\n\n                for (int dataColumn = 0; dataColumn &lt; dataList.size(); dataColumn++) {\n                    HashMap&lt;String, Float&gt; dataMap = dataList.get(dataColumn);\n                    // \u904d\u5386\u8fd9\u4e2amap \u5c06\u6240\u6709\u7684\u6570\u636e\u5bf9\u5e94\u586b\u5165\n                    for (Map.Entry&lt;String, Float&gt; dataEntry : dataMap.entrySet()) {\n                        int row = nameRowMap.get(dataEntry.getKey());\n                        Number numberCell = new Number(dataColumn + 1, row, dataEntry.getValue());\n                        ws.addCell(numberCell);\n                    }\n                }\n                wwb.write();\n                wwb.close();\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n        }\n    }\n\n    private void getNamesFromFile(File inputFile, TreeSet&lt;String&gt; hashSet) throws IOException, BiffException {\n        Workbook workbook;\n        InputStream is = new FileInputStream(inputFile);\n        workbook = Workbook.getWorkbook(is);\n        Sheet sheet0 = workbook.getSheet(0);\n        int columnSum = sheet0.getColumns(); // \u603b\u5217\u6570\n        int rsRows = sheet0.getRows();       // \u603b\u884c\u6570\n\n        // \u4ece1\u4e0b\u6807\u5f00\u59cb\n        for (int i = 1; i &lt; rsRows; i++) {\n            Cell cell = sheet0.getCell(0, i);\n            if (!isEmpty(cell.getContents())) {\n                hashSet.add(cell.getContents());\n            }\n        }\n        println(\"\u6b64\u6587\u4ef6\u884c\u6570\u51cf\u4e00 = \" + (rsRows - 1) + \" , \u5f53\u524d\u83b7\u53d6\u5230\u7684\u6240\u6709\u5355\u4f4d\u6570    \" + hashSet.size());\n    }\n\n    /**\n     * \u4ece\u539f\u59cb\u6570\u636e\u4e2d\u8bfb\u53d6\u5e76\u5339\u914d\u7684\u5b58\u5165\u7ed3\u679c\u6587\u4ef6\u4e2d\n     */\n    private HashMap&lt;String, Float&gt; getSourceData(String source) {\n        File sFile = new File(source);\n        if (!sFile.exists()) {\n            System.out.println(\"\u539f\u59cb\u6587\u4ef6\u4e0d\u5b58\u5728  \u590d\u5236\u5931\u8d25!\");\n            return null;\n        }\n        // \u8bfb\u53d6\u6e90\u6587\u4ef6\u4e2d\u7684\u6240\u6709\u6570\u636e &lt;\u5355\u4f4d\u540d\u79f0, \u6570\u503c&gt;\n        HashMap&lt;String, Float&gt; sourceHashMap = new HashMap&lt;&gt;();\n        try {\n            Workbook sourceWs = Workbook.getWorkbook(sFile);\n            Sheet sSheet0 = sourceWs.getSheet(0);\n            int sTotalRows = sSheet0.getRows();       // \u603b\u884c\u6570\n            for (int i = 1; i &lt; sTotalRows; i++) {\n                Cell cellKey = sSheet0.getCell(0, i);\n                Cell cellValue = sSheet0.getCell(1, i);\n                if (!isEmpty(cellKey.getContents()) &amp;&amp; !isEmpty(cellValue.getContents())) {\n                    sourceHashMap.put(cellKey.getContents(), Float.valueOf(cellValue.getContents()));\n                }\n            }\n            println(source + \" \u8bfb\u53d6\u5230\u7684\u6570\u636e\u6570\u91cf = \" + sourceHashMap.size());\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n        return sourceHashMap;\n    }\n\n    public void updateContent(String filePath, String input, int row, int column) {\n        File file = new File(filePath);\n        if (!file.exists()) {\n            System.out.println(filePath + \" does not exist!\");\n            return;\n        }\n        try {\n            Workbook sourceWb = Workbook.getWorkbook(file);\n            WritableWorkbook wwb = Workbook.createWorkbook(file, sourceWb);\n            WritableSheet wSheet0 = wwb.getSheet(0);\n            Label label = new Label(column, row, input);\n            wSheet0.addCell(label);\n            wwb.write();\n            wwb.close();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    public RWExcel() {\n\n    }\n\n    private static boolean isEmpty(String str) {\n        if (null == str) {\n            return true;\n        }\n        return str.isEmpty();\n    }\n\n    private static void println(String in) {\n        System.out.println(in);\n    }\n\n}\n</code></pre></p>"},{"location":"java/io/Java-read-write-xls/#_3","title":"\u793a\u4f8b\u8fd0\u884c\u7ed3\u679c","text":"<p>\u5f97\u5230\u4ee5\u4e0b\u7ed3\u679c\uff08\u793a\u4f8b\uff09 <pre><code>\u5355\u4f4d\u540d\u79f0    1\u6708\u603b\u91d1\u989d   2\u6708\u603b\u91d1\u989d   3\u6708\u603b\u91d1\u989d\n\u5355\u4f4d1 0   59.29999924 948.3400269\n\u5355\u4f4d10    0   0   494.2000122\n\u5355\u4f4d11    0   0   11.19999981\n\u5355\u4f4d12    0   0   1.25\n\u5355\u4f4d15    49.36000061 0   0\n\u5355\u4f4d2 0   0   4324\n\u5355\u4f4d24    0   34  0\n\u5355\u4f4d5 0   23123   324\n\u5355\u4f4d6 0   161.2599945 0\n</code></pre></p>"},{"location":"java/reg/extract-between/","title":"\u63d0\u53d6\u7279\u5b9a\u5b57\u7b26","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-5-30 <ul> <li>2022-5-30\uff1a \u66f4\u65b0\u793a\u4f8b</li> </ul> <p>\u63d0\u53d6\u7279\u5b9a\u5b57\u7b26\uff0c\u4f8b\u5982\u4ece<code>123abc123</code>\u4e2d\u63d0\u53d6\u51fa<code>abc</code>\u3002 \u6b63\u5219\u8868\u8fbe\u5f0f\u9700\u8981\u4f7f\u7528\u5c0f\u62ec\u53f7\u3002</p>"},{"location":"java/reg/extract-between/#_2","title":"\u63d0\u53d6\u7279\u5b9a\u7b26\u53f7\u5185\u7684\u5b57\u7b26","text":"<p>\u4f8b\u5982\u4ece<code>[[Rust]]</code>\u4e2d\u63d0\u53d6\u51fa<code>Rust</code>\u3002\u524d\u540e\u7684\u4e2d\u62ec\u53f7\u5f53\u4f5c\u662f\u6807\u8bb0\u7269\u3002</p> <p>\u9700\u8981\u7c7b\u4f3c<code>\\\\[\\\\[(.*?)\\\\]\\\\]</code>\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u4e2d\u62ec\u53f7\u9700\u8981\u8f6c\u4e49\u3002\u522b\u5fd8\u4e86\u6700\u91cc\u9762\u7684\u5c0f\u62ec\u53f7\u3002</p> <p>\u8c03\u7528<code>matcher.find()</code>\u4e4b\u540e\uff0c\u8c03\u7528<code>matcher.group()</code>\u53ef\u5f97\u5230\u5305\u542b\u4e24\u8fb9\u7b26\u53f7\u7684\u5b57\u7b26\u4e32\u3002 \u8c03\u7528<code>matcher.group(1)</code>\u53ef\u5f97\u5230\u5185\u90e8\u7684\u5b57\u7b26\u4e32\u3002</p>"},{"location":"java/reg/extract-between/#1","title":"\u4e2d\u62ec\u53f7\u793a\u4f8b1","text":"<p>\u6d4b\u8bd5\u4ee3\u7801\u3002\u6ce8\u610f\u8f6c\u4e49\u7b26\u53f7\u7684\u4e2a\u6570\u3002 <pre><code>import java.util.regex.Matcher;\nimport java.util.regex.Pattern;\n\n    public static void main(String[] args) {\n        final String[] regs = {\"\\\\[[(.*?)]\\\\]\", \"\\\\[\\\\[(.*?)\\\\]\\\\]\", \"\\\\[(.*?)\\\\]\"};\n        final String[] strs = {\"[[Rust]]\", \"[[[Fisher]]]\", \"[[abc]\", \"[abc]]\", \"[[abc\", \"[[[[abc]]\"};\n        System.out.println(\"\u6b63\u5219\u8868\u8fbe\u5f0f\u6709 \" + regs.length + \"\u4e2a\uff1b\" + \"\u5f85\u68c0\u6d4b\u7684\u5b57\u7b26\u4e32\u6709 \" + strs.length + \"\u4e2a\");\n        for (String s : strs) {\n            for (String r : regs) {\n                extractTextFrom(r, s);\n            }\n            System.out.println();\n        }\n    }\n\n    private static void extractTextFrom(String reg, String txt) {\n        if (!txt.matches(reg)) {\n            System.out.println(txt + \" \u4e0d\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f \" + reg);\n            return;\n        }\n        Pattern pattern = Pattern.compile(reg);\n        Matcher matcher = pattern.matcher(txt);\n        while (matcher.find()) {\n            System.out.println(txt + \" \u4f7f\u7528\u6b63\u5219 \" + reg + \" group()  == \" + matcher.group());\n            System.out.println(txt + \" \u4f7f\u7528\u6b63\u5219 \" + reg + \" group(1) == \" + matcher.group(1));\n        }\n    }\n</code></pre></p> <p>\u8fd0\u884c\u7ed3\u679c <pre><code>\u6b63\u5219\u8868\u8fbe\u5f0f\u6709 3\u4e2a\uff1b\u5f85\u68c0\u6d4b\u7684\u5b57\u7b26\u4e32\u6709 6\u4e2a\n[[Rust]] \u4e0d\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f \\[[(.*?)]\\]\n[[Rust]] \u4f7f\u7528\u6b63\u5219 \\[\\[(.*?)\\]\\] group()  == [[Rust]]\n[[Rust]] \u4f7f\u7528\u6b63\u5219 \\[\\[(.*?)\\]\\] group(1) ==   Rust\n[[Rust]] \u4f7f\u7528\u6b63\u5219 \\[(.*?)\\] group()  == [[Rust]\n[[Rust]] \u4f7f\u7528\u6b63\u5219 \\[(.*?)\\] group(1) ==   [Rust\n\n[[[Fisher]]] \u4e0d\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f \\[[(.*?)]\\]\n[[[Fisher]]] \u4f7f\u7528\u6b63\u5219 \\[\\[(.*?)\\]\\] group()  == [[[Fisher]]\n[[[Fisher]]] \u4f7f\u7528\u6b63\u5219 \\[\\[(.*?)\\]\\] group(1) ==   [Fisher\n[[[Fisher]]] \u4f7f\u7528\u6b63\u5219 \\[(.*?)\\] group()  == [[[Fisher]\n[[[Fisher]]] \u4f7f\u7528\u6b63\u5219 \\[(.*?)\\] group(1) ==   [[Fisher\n\n[[abc] \u4e0d\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f \\[[(.*?)]\\]\n[[abc] \u4e0d\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f \\[\\[(.*?)\\]\\]\n[[abc] \u4f7f\u7528\u6b63\u5219 \\[(.*?)\\] group()  == [[abc]\n[[abc] \u4f7f\u7528\u6b63\u5219 \\[(.*?)\\] group(1) ==   [abc\n\n[abc]] \u4e0d\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f \\[[(.*?)]\\]\n[abc]] \u4e0d\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f \\[\\[(.*?)\\]\\]\n[abc]] \u4f7f\u7528\u6b63\u5219 \\[(.*?)\\] group()  == [abc]\n[abc]] \u4f7f\u7528\u6b63\u5219 \\[(.*?)\\] group(1) ==   abc\n\n[[abc \u4e0d\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f \\[[(.*?)]\\]\n[[abc \u4e0d\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f \\[\\[(.*?)\\]\\]\n[[abc \u4e0d\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f \\[(.*?)\\]\n\n[[[[abc]] \u4e0d\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f \\[[(.*?)]\\]\n[[[[abc]] \u4f7f\u7528\u6b63\u5219 \\[\\[(.*?)\\]\\] group()  == [[[[abc]]\n[[[[abc]] \u4f7f\u7528\u6b63\u5219 \\[\\[(.*?)\\]\\] group(1) ==   [[abc\n[[[[abc]] \u4f7f\u7528\u6b63\u5219 \\[(.*?)\\] group()  == [[[[abc]\n[[[[abc]] \u4f7f\u7528\u6b63\u5219 \\[(.*?)\\] group(1) ==   [[[abc\n</code></pre></p> <p>\u8981\u7279\u522b\u6ce8\u610fJava\u4ee3\u7801\u4e2d\u8f6c\u4e49\u7b26\u53f7\u7684\u4e2a\u6570\uff0c\u548c\u540e\u9762log\u6253\u5370\u51fa\u6765\u8f6c\u4e49\u7b26\u53f7\u7684\u4e2a\u6570</p>"},{"location":"java/reg/extract-between/#_3","title":"\u6839\u636e\u89c4\u5219\u63d0\u53d6","text":"<p>\u6839\u636e\u89c4\u5219\u63d0\u53d6\u51fa\u5b57\u7b26\u4e32\u3002\u9700\u8981\u7528\u5c0f\u62ec\u53f7\u628a\u89c4\u5219\u5305\u56f4\u8d77\u6765\u3002</p>"},{"location":"java/reg/extract-between/#_4","title":"\u63d0\u53d6\u975e\u5b57\u6bcd\u5305\u56f4\u7684\u5b57\u6bcd","text":"<p>\u4ece [\u975e\u5b57\u6bcd \u5b57\u6bcd \u975e\u5b57\u6bcd] \u4e2d\u63d0\u53d6\u51fa\u5b57\u6bcd\u4e32\u3002\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f<code>\"[^a-zA-Z]{0,}([a-zA-Z]{1,})[^a-zA-Z]{0,}\"</code>\u3002</p> <ul> <li><code>[a-zA-Z]</code>\u8868\u793a26\u4e2a\u5b57\u6bcd\uff08\u5305\u62ec\u5927\u5c0f\u5199\uff09</li> <li><code>[^a-zA-Z]</code>\u8868\u793a26\u4e2a\u5b57\u6bcd\u4e4b\u5916</li> <li><code>[^a-zA-Z]{0,}</code> \u8868\u793a0\u6b21\u6216\u4e0d\u9650\u6b21\u6570\u5339\u914d\u5b57\u6bcd\uff1b<code>{0,}</code> \u53ef\u7528\u661f\u53f7<code>*</code>\u4ee3\u66ff</li> <li><code>([a-zA-Z]{1,})</code>\u5c0f\u62ec\u53f7\u8868\u793a\u63d0\u53d6\u81f3\u5c11\u51fa\u73b01\u6b21\u7684\u5b57\u6bcd\uff1b<code>{1,}</code>\u53ef\u7528\u52a0\u53f7<code>+</code>\u4ee3\u66ff</li> <li>\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u53ea\u67091\u4e2a\u5c0f\u62ec\u53f7\uff0c\u6211\u4eec\u53ef\u4ee5\u8c03\u7528<code>matcher.group(1)</code>\u83b7\u53d6\u63d0\u53d6\u7ed3\u679c</li> </ul> <p>\u6d4b\u8bd5\u4ee3\u7801 <pre><code>    public static void main(String[] args) {\n        final String[] regs = {\n                \"[^a-zA-Z]{0,}([a-zA-Z]{1,})[^a-zA-Z]{0,}\"\n        };\n        final String[] textArr = {\"!\", \"!!!\", \"?!Rust\", \"Fisher:'\", \"?!thanks!?\", \"&lt;&lt;how&gt;&gt;\"};\n        for (String r : regs) {\n            for (String s : textArr) {\n                extractTextFrom(r, s);\n                System.out.println();\n            }\n        }\n    }\n\n    private static void extractTextFrom(String reg, String txt) {\n        if (!txt.matches(reg)) {\n            System.out.println(txt + \" not matches \" + reg + \"\\n\");\n            return;\n        }\n        Pattern pattern = Pattern.compile(reg);\n        Matcher matcher = pattern.matcher(txt);\n        while (matcher.find()) {\n            System.out.println(txt + \" for \" + reg + \" group()  == \" + matcher.group());\n            for (int i = 0; i &lt;= matcher.groupCount(); i++) {\n                System.out.println(txt + \" for \" + reg + \" group(\" + i + \")  == \" + matcher.group(i));\n            }\n        }\n    }\n</code></pre></p> <p>\u8fd0\u884c\u7ed3\u679c <pre><code>! not matches [^a-zA-Z]{0,}([a-zA-Z]{1,})[^a-zA-Z]{0,}\n\n\n!!! not matches [^a-zA-Z]{0,}([a-zA-Z]{1,})[^a-zA-Z]{0,}\n\n\n?!Rust for [^a-zA-Z]{0,}([a-zA-Z]{1,})[^a-zA-Z]{0,} group()  == ?!Rust\n?!Rust for [^a-zA-Z]{0,}([a-zA-Z]{1,})[^a-zA-Z]{0,} group(0)  == ?!Rust\n?!Rust for [^a-zA-Z]{0,}([a-zA-Z]{1,})[^a-zA-Z]{0,} group(1)  == Rust\n\nFisher:' for [^a-zA-Z]{0,}([a-zA-Z]{1,})[^a-zA-Z]{0,} group()  == Fisher:'\nFisher:' for [^a-zA-Z]{0,}([a-zA-Z]{1,})[^a-zA-Z]{0,} group(0)  == Fisher:'\nFisher:' for [^a-zA-Z]{0,}([a-zA-Z]{1,})[^a-zA-Z]{0,} group(1)  == Fisher\n\n?!thanks!? for [^a-zA-Z]{0,}([a-zA-Z]{1,})[^a-zA-Z]{0,} group()  == ?!thanks!?\n?!thanks!? for [^a-zA-Z]{0,}([a-zA-Z]{1,})[^a-zA-Z]{0,} group(0)  == ?!thanks!?\n?!thanks!? for [^a-zA-Z]{0,}([a-zA-Z]{1,})[^a-zA-Z]{0,} group(1)  == thanks\n\n&lt;&lt;how&gt;&gt; for [^a-zA-Z]{0,}([a-zA-Z]{1,})[^a-zA-Z]{0,} group()  == &lt;&lt;how&gt;&gt;\n&lt;&lt;how&gt;&gt; for [^a-zA-Z]{0,}([a-zA-Z]{1,})[^a-zA-Z]{0,} group(0)  == &lt;&lt;how&gt;&gt;\n&lt;&lt;how&gt;&gt; for [^a-zA-Z]{0,}([a-zA-Z]{1,})[^a-zA-Z]{0,} group(1)  == how\n</code></pre></p> <p>\u53e6\u4e00\u4e2a\u4f8b\u5b50</p>"},{"location":"java/reg/find-samples/","title":"\u67e5\u627e\u7279\u5b9a\u5b57\u7b26\u4e32","text":"<p>\u5217\u4e3e\u51fa\u591a\u79cd\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u8f93\u5165\u4e0d\u540c\u7684\u5b57\u7b26\u4e32\uff0c\u8f93\u51fa\u5339\u914d\u7ed3\u679c\u3002</p>"},{"location":"java/reg/find-samples/#_2","title":"\u5c16\u62ec\u53f7&lt;&lt;&gt;&gt;\u5339\u914d\u793a\u4f8b","text":"<p>\u6d4b\u8bd5\u7528\u7684\u4ee3\u7801\uff0c\u6b63\u5219\u8868\u8fbe\u5f0f\u6d89\u53ca\u5230\u5c16\u62ec\u53f7\u3002 <pre><code>    public static void main(String[] args) {\n        final String[] regs = {\"&lt;&lt;&gt;&gt;\", \"&lt;&lt;.&gt;&gt;\", \"&lt;&lt;*&gt;&gt;\", \"&lt;&lt;?&gt;&gt;\", \"&lt;&lt;.*?&gt;&gt;\", \".*&lt;&lt;.*?&gt;&gt;.*\"};\n        final String[] strs = {\"&lt;&lt;&gt;&gt;\", \"&lt;&lt;abc&gt;&gt;\", \"abc&gt;&gt;\", \"&lt;&lt;abc\", \"&lt;&lt;\" ,\"&gt;&gt;\", \"+;&lt;&lt;hello&gt;&gt;\", \"+;&lt;&lt;hello&gt;&gt;:'\", \"&lt;&lt;hello&gt;&gt;...\"};\n        for (String s : strs) {\n            for (String r :regs) {\n                findMatch(r, s);\n            }\n            System.out.println();\n        }\n    }\n\n    private static void findMatch(String reg, String text) {\n        System.out.println(text + \" matches \" + reg + \" : \" + text.matches(reg));\n    }\n</code></pre></p> <p>\u8fd0\u884c\u7ed3\u679c <pre><code>&lt;&lt;&gt;&gt; matches &lt;&lt;&gt;&gt; : true\n&lt;&lt;&gt;&gt; matches &lt;&lt;.&gt;&gt; : false\n&lt;&lt;&gt;&gt; matches &lt;&lt;*&gt;&gt; : true\n&lt;&lt;&gt;&gt; matches &lt;&lt;?&gt;&gt; : true\n&lt;&lt;&gt;&gt; matches &lt;&lt;.*?&gt;&gt; : true\n&lt;&lt;&gt;&gt; matches .*&lt;&lt;.*?&gt;&gt;.* : true\n\n&lt;&lt;abc&gt;&gt; matches &lt;&lt;&gt;&gt; : false\n&lt;&lt;abc&gt;&gt; matches &lt;&lt;.&gt;&gt; : false\n&lt;&lt;abc&gt;&gt; matches &lt;&lt;*&gt;&gt; : false\n&lt;&lt;abc&gt;&gt; matches &lt;&lt;?&gt;&gt; : false\n&lt;&lt;abc&gt;&gt; matches &lt;&lt;.*?&gt;&gt; : true\n&lt;&lt;abc&gt;&gt; matches .*&lt;&lt;.*?&gt;&gt;.* : true\n\nabc&gt;&gt; matches &lt;&lt;&gt;&gt; : false\nabc&gt;&gt; matches &lt;&lt;.&gt;&gt; : false\nabc&gt;&gt; matches &lt;&lt;*&gt;&gt; : false\nabc&gt;&gt; matches &lt;&lt;?&gt;&gt; : false\nabc&gt;&gt; matches &lt;&lt;.*?&gt;&gt; : false\nabc&gt;&gt; matches .*&lt;&lt;.*?&gt;&gt;.* : false\n\n&lt;&lt;abc matches &lt;&lt;&gt;&gt; : false\n&lt;&lt;abc matches &lt;&lt;.&gt;&gt; : false\n&lt;&lt;abc matches &lt;&lt;*&gt;&gt; : false\n&lt;&lt;abc matches &lt;&lt;?&gt;&gt; : false\n&lt;&lt;abc matches &lt;&lt;.*?&gt;&gt; : false\n&lt;&lt;abc matches .*&lt;&lt;.*?&gt;&gt;.* : false\n\n&lt;&lt; matches &lt;&lt;&gt;&gt; : false\n&lt;&lt; matches &lt;&lt;.&gt;&gt; : false\n&lt;&lt; matches &lt;&lt;*&gt;&gt; : false\n&lt;&lt; matches &lt;&lt;?&gt;&gt; : false\n&lt;&lt; matches &lt;&lt;.*?&gt;&gt; : false\n&lt;&lt; matches .*&lt;&lt;.*?&gt;&gt;.* : false\n\n&gt;&gt; matches &lt;&lt;&gt;&gt; : false\n&gt;&gt; matches &lt;&lt;.&gt;&gt; : false\n&gt;&gt; matches &lt;&lt;*&gt;&gt; : false\n&gt;&gt; matches &lt;&lt;?&gt;&gt; : false\n&gt;&gt; matches &lt;&lt;.*?&gt;&gt; : false\n&gt;&gt; matches .*&lt;&lt;.*?&gt;&gt;.* : false\n\n+;&lt;&lt;hello&gt;&gt; matches &lt;&lt;&gt;&gt; : false\n+;&lt;&lt;hello&gt;&gt; matches &lt;&lt;.&gt;&gt; : false\n+;&lt;&lt;hello&gt;&gt; matches &lt;&lt;*&gt;&gt; : false\n+;&lt;&lt;hello&gt;&gt; matches &lt;&lt;?&gt;&gt; : false\n+;&lt;&lt;hello&gt;&gt; matches &lt;&lt;.*?&gt;&gt; : false\n+;&lt;&lt;hello&gt;&gt; matches .*&lt;&lt;.*?&gt;&gt;.* : true\n\n+;&lt;&lt;hello&gt;&gt;:' matches &lt;&lt;&gt;&gt; : false\n+;&lt;&lt;hello&gt;&gt;:' matches &lt;&lt;.&gt;&gt; : false\n+;&lt;&lt;hello&gt;&gt;:' matches &lt;&lt;*&gt;&gt; : false\n+;&lt;&lt;hello&gt;&gt;:' matches &lt;&lt;?&gt;&gt; : false\n+;&lt;&lt;hello&gt;&gt;:' matches &lt;&lt;.*?&gt;&gt; : false\n+;&lt;&lt;hello&gt;&gt;:' matches .*&lt;&lt;.*?&gt;&gt;.* : true\n\n&lt;&lt;hello&gt;&gt;... matches &lt;&lt;&gt;&gt; : false\n&lt;&lt;hello&gt;&gt;... matches &lt;&lt;.&gt;&gt; : false\n&lt;&lt;hello&gt;&gt;... matches &lt;&lt;*&gt;&gt; : false\n&lt;&lt;hello&gt;&gt;... matches &lt;&lt;?&gt;&gt; : false\n&lt;&lt;hello&gt;&gt;... matches &lt;&lt;.*?&gt;&gt; : false\n&lt;&lt;hello&gt;&gt;... matches .*&lt;&lt;.*?&gt;&gt;.* : true\n</code></pre></p>"},{"location":"java/reg/find-samples/#_3","title":"\u975e\u5b57\u6bcd\u4e2d\u95f4\u627e\u5230\u82f1\u6587\u5355\u8bcd","text":"<p>demo</p>"},{"location":"java/reg/reg_use/","title":"\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f","text":""},{"location":"java/reg/reg_use/#_2","title":"\u5feb\u6377\u7b26\u53f7","text":"<ul> <li><code>\\d</code>\u8868\u793a<code>[0\u20149]</code></li> <li><code>\\D</code>\u8868\u793a<code>[^0\u20149]</code></li> <li><code>\\w</code>\u8868\u793a<code>[0\u20149A\u2014Z_a\u2014z]</code></li> <li><code>\\W</code>\u8868\u793a<code>[^0\u20149A\u2014Z_a\u2014z]</code></li> <li><code>\\s</code>\u8868\u793a<code>[\\t\\n\\r\\f]</code></li> <li><code>\\S</code>\u8868\u793a<code>[^\\t\\n\\r\\f]</code></li> </ul>"},{"location":"java/reg/reg_use/#_3","title":"\u4f7f\u7528\u793a\u4f8b","text":""},{"location":"java/reg/reg_use/#_4","title":"\u5339\u914d\u7b26\u53f7","text":"<p>\u5b57\u7b26\u4e32\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u5339\u914d\uff0c\u68c0\u67e5\u662f\u5426\u7b26\u53f7 <pre><code>    private boolean strEndsWithMark(String s) {\n        if (!TextUtils.isEmpty(s)) {\n            String e = s.substring(s.length() - 1);\n            return e.matches(\"[`~!@#$%^&amp;*()+=|{}':;',\\\\\\\\[\\\\\\\\].&lt;&gt;/?~\uff01@#\uffe5%\u2026\u2026&amp;*\uff08\uff09\u2014\u2014+|{}\u3010\u3011\u2018\uff1b\uff1a\u201d\u201c\u2019\u3002\uff0c\u3001\uff1f'\u2019]\");\n        }\n        return false;\n    }\n</code></pre></p>"},{"location":"java/reg/reg_use/#1","title":"\u81f3\u5c11\u67091\u4e2a\u6c49\u5b57","text":"<p>\u6c49\u5b57\u6b63\u5219\u8868\u8fbe\u5f0f\u662f<code>[\\u4e00-\\u9fa5]</code>\u3002\u5728Java\u4e2d\u9700\u8981<code>\\\\</code>\u6765\u8868\u793a<code>\\</code>\u3002 \u6211\u4eec\u7528Pattern\u548cMatcher\u6765\u5bfb\u627e\u7b26\u5408\u6761\u4ef6\u7684\u5b57\u7b26\u3002 <pre><code>String reg = \"[\\\\u4e00-\\\\u9fa5]\" // \u4ee3\u7801\u4e2d\\\u9700\u8981\u8f6c\u4e49\nboolean res = Pattern.compile(reg).matcher(input).find();\n</code></pre></p> <p>idea\u8f93\u51fa\u3002\u8f93\u51fa\u7684\u65f6\u5019\u6ce8\u610f\u53cd\u659c\u6760\u663e\u793a\u7684\u6570\u91cf\u3002 <pre><code>reg: [\\u4e00-\\u9fa5]\ninput: \u4f60\u597d           ; reg: [\\u4e00-\\u9fa5] =&gt; true\ninput: \u4f60\u597d.txt       ; reg: [\\u4e00-\\u9fa5] =&gt; true\ninput: \u4f60\u597d.log       ; reg: [\\u4e00-\\u9fa5] =&gt; true\ninput: a\u4f60a\u597da.txt    ; reg: [\\u4e00-\\u9fa5] =&gt; true\ninput: a\u4f60a\u597da.txt    ; reg: [\\u4e00-\\u9fa5] =&gt; true\ninput: a.xtxt       ; reg: [\\u4e00-\\u9fa5] =&gt; false\ninput: abctxtlog    ; reg: [\\u4e00-\\u9fa5] =&gt; false\ninput: xx.xlog      ; reg: [\\u4e00-\\u9fa5] =&gt; false\n</code></pre></p>"},{"location":"java/reg/reg_use/#_5","title":"\u4ee5\u67d0\u6bb5\u5b57\u7b26\u7ed3\u5c3e","text":"<p>Java\u4e2d\u7684\u6b63\u5219\uff0c\u9700\u8981\u7528<code>\\.</code>\u6765\u4ee3\u8868\u70b9\u53f7 <code>.</code> \u3002</p> <ul> <li><code>$</code> \u5339\u914d\u8f93\u5165\u5b57\u7b26\u4e32\u7ed3\u5c3e\u7684\u4f4d\u7f6e\u3002\u5982\u679c\u8bbe\u7f6e\u4e86 RegExp \u5bf9\u8c61\u7684 Multiline \u5c5e\u6027\uff0c$ \u8fd8\u4f1a\u4e0e\"\\n\"\u6216\"\\r\"\u4e4b\u524d\u7684\u4f4d\u7f6e\u5339\u914d\u3002</li> <li><code>\\.txt</code> \u8868\u793a\u8981\u7b26\u5408<code>.txt</code>\u6761\u4ef6\uff0c\u5373 <code>\u70b9</code> \u548c <code>txt</code></li> </ul> <p>\u4ee5<code>.txt</code>\u4e3a\u7ed3\u5c3e\uff0cJava\u4e2d\u6b63\u5219\u8868\u8fbe\u5f0f\u5982\u4e0b\uff0c\u6ce8\u610f\u8fd92\u4e2a\u53cd\u659c\u6760<code>\\\\</code> <pre><code>\"\\\\.txt$\"\n</code></pre></p> <p>\u67e5\u8be2\u7684Java\u4ee3\u7801\u5982\u4e0b\uff0c\u7528Pattern\u548cMatcher\u6765\u5bfb\u627e\u3002 <pre><code>boolean res = Pattern.compile(reg).matcher(input).find();\n</code></pre></p> <p>\u8f93\u51fa\u793a\u4f8b\u3002\u8f93\u51fa\u7684\u65f6\u5019\u6ce8\u610f\u53cd\u659c\u6760\u663e\u793a\u7684\u6570\u91cf\u3002 <pre><code>reg: \\.txt$\ninput: \u4f60\u597d           ; reg: \\.txt$    =&gt; false\ninput: \u4f60\u597d.txt       ; reg: \\.txt$    =&gt; true\ninput: \u4f60\u597d.log       ; reg: \\.txt$    =&gt; false\ninput: a\u4f60a\u597da.txt    ; reg: \\.txt$    =&gt; true\ninput: a.xtxt       ; reg: \\.txt$    =&gt; false\ninput: abctxtlog    ; reg: \\.txt$    =&gt; false\ninput: xx.xlog      ; reg: \\.txt$    =&gt; false\ninput: txt.log      ; reg: \\.txt$    =&gt; false\ninput: log.txt      ; reg: \\.txt$    =&gt; true\ninput: .txt.log     ; reg: \\.txt$    =&gt; false\ninput: .log.txt     ; reg: \\.txt$    =&gt; true\n</code></pre></p> <p>\u8fd9\u91cc\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u53ea\u8bbe\u5b9a\u4e861\u4e2a\u6761\u4ef6\uff1a\u4ee5xx\u4e3a\u7ed3\u5c3e\u3002</p> <p>\u540c\u7406\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u5bb9\u6613\u5f97\u51fa<code>.log</code>\uff0c<code>.png</code>,<code>.jpg</code>\u7ed3\u5c3e\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</p>"},{"location":"java/reg/split-samples/","title":"Java\u6b63\u5219\u8868\u8fbe\u5f0f\u5206\u9694\uff0c\u63d2\u5165\u5b57\u7b26\u4e32","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-10-10 <ul> <li>2022-10-10\uff1a \u521b\u5efa\u6587\u6863</li> </ul>"},{"location":"java/reg/split-samples/#_1","title":"\u6570\u5b57\u6309\u5343\u5206\u4f4d\u5206\u5272\u63d2\u5165\u9017\u53f7","text":"<p>\u4f8b\u5982 </p> <p>12345 -&gt; 12,345</p> <p>1234567890 -&gt; 1,234,567,890</p> <p>\u7ed9\u5b9a\u4e00\u4e2a\u6574\u6570\u5b57\u7b26\u4e32\uff0c\u4ece\u53f3\u5f80\u5de6\uff0c\u6bcf3\u4e2a\u6570\u5b57\u52a0\u4e00\u4e2a\u9017\u53f7</p> <p>java\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528\u65b9\u6cd5 <code>replaceAll</code> <pre><code>private static void extractTextFrom(String reg, String txt) {\n    String res = txt.replaceAll(reg, \",\");\n    System.out.printf(Locale.CHINA, \"%-10s \u4f7f\u7528\u6b63\u5219 %s -&gt; %s%n\", txt, reg, res);\n}\n</code></pre></p>"},{"location":"java/reg/split-samples/#1","title":"\u63d2\u51651\u4e2a\u9017\u53f7","text":"<p>java\u4e2d\u4f7f\u7528\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u4e3a <code>(?=\\\\d{3}$)</code></p> <p>\u6ce8\u610f\u8f6c\u4e49\u7b26</p> \u63d2\u51651\u4e2a\u9017\u53f7\uff0c\u8f93\u51fa\u7ed3\u679c<pre><code>12         \u4f7f\u7528\u6b63\u5219 (?=\\d{3}$) -&gt; 12\n123        \u4f7f\u7528\u6b63\u5219 (?=\\d{3}$) -&gt; ,123\n1234       \u4f7f\u7528\u6b63\u5219 (?=\\d{3}$) -&gt; 1,234\n12345      \u4f7f\u7528\u6b63\u5219 (?=\\d{3}$) -&gt; 12,345\n123456     \u4f7f\u7528\u6b63\u5219 (?=\\d{3}$) -&gt; 123,456\n1234567890 \u4f7f\u7528\u6b63\u5219 (?=\\d{3}$) -&gt; 1234567,890\n</code></pre>"},{"location":"java/reg/split-samples/#_2","title":"\u63d2\u5165\u591a\u4e2a\u9017\u53f7","text":"<p>java\u4e2d\u4f7f\u7528\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u4e3a <code>(?=(\\\\d{3})+$)</code></p> <p>\u76f8\u6bd4\u4e4b\u524d\u7684\uff0c\u6bcf3\u4e2a\u6570\u5b57\u8868\u8fbe\u91cc\uff0c\u7528\u5c0f\u62ec\u53f7\u62ec\u8d77\u6765\u4e86\uff0c\u540e\u9762\u591a\u4e86\u4e2a <code>+</code> \u53f7</p> \u63d2\u5165\u591a\u4e2a\u9017\u53f7\uff0c\u8f93\u51fa\u7ed3\u679c<pre><code>12         \u4f7f\u7528\u6b63\u5219 (?=\\d{3}$) -&gt; 12\n123        \u4f7f\u7528\u6b63\u5219 (?=\\d{3}$) -&gt; ,123\n1234       \u4f7f\u7528\u6b63\u5219 (?=\\d{3}$) -&gt; 1,234\n12345      \u4f7f\u7528\u6b63\u5219 (?=\\d{3}$) -&gt; 12,345\n123456     \u4f7f\u7528\u6b63\u5219 (?=\\d{3}$) -&gt; 123,456\n1234567890 \u4f7f\u7528\u6b63\u5219 (?=\\d{3}$) -&gt; 1234567,890\n</code></pre>"},{"location":"java/reg/split-samples/#_3","title":"\u53bb\u6389\u5f00\u5934\u7684\u9017\u53f7","text":"<p>java\u4e2d\u4f7f\u7528\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u4e3a <code>(?!^)(?=(\\\\d{3})+$)</code></p> <p>\u7ed3\u5408<code>(?!^)</code>\uff0c\u5373\u4ece\u540e\u5f80\u524d\u6bcf\u4e09\u4e2a\u6570\u5b57\u7684\u4f4d\u7f6e\u524d\u6dfb\u52a0\u9017\u53f7\uff0c\u4f46\u662f\u8fd9\u4e2a\u4f4d\u7f6e\u4e0d\u80fd\u662f^\u9996\u4f4d\u3002</p> \u63d2\u5165\u591a\u4e2a\u9017\u53f7\uff0c\u8f93\u51fa\u7ed3\u679c<pre><code>12         \u4f7f\u7528\u6b63\u5219 (?!^)(?=(\\d{3})+$) -&gt; 12\n123        \u4f7f\u7528\u6b63\u5219 (?!^)(?=(\\d{3})+$) -&gt; 123\n1234       \u4f7f\u7528\u6b63\u5219 (?!^)(?=(\\d{3})+$) -&gt; 1,234\n12345      \u4f7f\u7528\u6b63\u5219 (?!^)(?=(\\d{3})+$) -&gt; 12,345\n123456     \u4f7f\u7528\u6b63\u5219 (?!^)(?=(\\d{3})+$) -&gt; 123,456\n1234567890 \u4f7f\u7528\u6b63\u5219 (?!^)(?=(\\d{3})+$) -&gt; 1,234,567,890\n</code></pre> <p>\u793a\u4f8b\u7684\u5b8c\u6574\u6d4b\u8bd5\u4ee3\u7801\u5982\u4e0b \u6d4b\u8bd5\u4ee3\u7801<pre><code>import java.util.Locale;\n\npublic class RegReplace {\n    public static void main(String[] args) {\n        final String[] regs = {\"(?=\\\\d{3}$)\",\n                \"(?=(\\\\d{3})+$)\",\n                \"(?!^)(?=(\\\\d{3})+$)\"}; // (1)\n        final String[] strs = {\"12\", \"123\", \"1234\", \"12345\", \"123456\", \"1234567890\"};\n        System.out.println(\"\u6b63\u5219\u8868\u8fbe\u5f0f\u6709 \" + regs.length + \"\u4e2a\uff1b\" + \"\u5f85\u68c0\u6d4b\u7684\u5b57\u7b26\u4e32\u6709 \"\n                + strs.length + \"\u4e2a\");\n        for (String r : regs) {\n            for (String s : strs) {\n                extractTextFrom(r, s);\n            }\n            System.out.println();\n        }\n    }\n\n    private static void extractTextFrom(String reg, String txt) {\n        String res = txt.replaceAll(reg, \",\");\n        System.out.printf(Locale.CHINA, \"%-10s \u4f7f\u7528\u6b63\u5219 %s -&gt; %s%n\", txt, reg, res);\n    }\n}\n</code></pre></p> <ol> <li>\u6ce8\u610f\u5b57\u7b26\u4e32\u91cc\u7684\u8f6c\u4e49\u7b26</li> </ol> <p>\u4ee3\u7801\u622a\u56fe</p> <p></p>"},{"location":"java/reg/split-samples/#3-4-4","title":"\u624b\u673a\u53f7\u53d8\u62103-4-4\u7ed3\u6784","text":"<p>\u9488\u5bf9\u56fd\u5185\u7684\u624b\u673a\u53f7\u3002\u5047\u8bbe\u624b\u673a\u53f7 <code>13800000000</code> \uff0c\u53d8\u6210 <code>138-0000-0000</code></p> <p>\u53c2\u8003\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u4ece\u53f3\u5f80\u5de6\uff0c\u6bcf4\u4e2a\u6570\u5b57\uff0c\u52a0\u4e00\u4e2a\u5206\u9694\u7b26</p> <p>java\u4ee3\u7801\u4e2d\u4f7f\u7528\u7684\u6b63\u5219 <code>(?=(\\\\d{4})+$)</code></p> <p>\u548c\u4e0a\u9762\u4e00\u6837\uff0c\u8981\u6ce8\u610f\u8f6c\u4e49\u7b26\u3002 java\u4ee3\u7801\u4e2d\u7684\u8f6c\u4e49\u7b26\u548c\u8f93\u51fa\u7ed3\u679c\u7684\u8981\u533a\u5206</p> \u6d4b\u8bd5\u4ee3\u7801<pre><code>import java.util.Locale;\n\npublic class RegPhoneNumber {\n    public static void main(String[] args) {\n        String reg = \"(?=(\\\\d{4})+$)\";\n        extractTextFrom(reg, \"13812345678\", \",\");\n        extractTextFrom(reg, \"18100000000\", \"-\");\n    }\n\n    private static void extractTextFrom(String reg, String txt, String replaceText) {\n        String res = txt.replaceAll(reg, replaceText);\n        System.out.printf(Locale.CHINA, \"%-10s \u4f7f\u7528\u6b63\u5219 %s -&gt; %s%n\", txt, reg, res);\n    }\n}\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c</p> <pre><code>13812345678 \u4f7f\u7528\u6b63\u5219 (?=(\\d{4})+$) -&gt; 138,1234,5678\n18100000000 \u4f7f\u7528\u6b63\u5219 (?=(\\d{4})+$) -&gt; 181-0000-0000\n</code></pre>"},{"location":"java/reg/code/extract-en-between-not-en/","title":"\u4f8b\u5b501","text":"<p>\u4ece\u975e\u5b57\u6bcd\u4e2d\u95f4\u63d0\u53d6\u51fa\u5b57\u6bcd\u3002\u5e76\u4e14\u628a\u5b57\u7b26\u4e32\u5206\u62103\u622a\u3002</p> <pre><code>public class SpiltText {\n\n    private static Pattern GET_EN_PATTERN = Pattern.compile(\"[^a-zA-Z]*([a-zA-Z]+)[^a-zA-Z]*\");\n\n    public static void main(String[] args) {\n        trySplit(\"\");\n        trySplit(\"RustFisher\");\n        trySplit(\"..Rust\");\n        trySplit(\"Fisher..\");\n        trySplit(\"..&lt;&lt;Hello&gt;&gt;..\");\n    }\n\n    private static String[] splitText(String text) {\n        String[] res = new String[3];\n        String en = null;\n        Matcher matcher = GET_EN_PATTERN.matcher(text);\n        while (matcher.find()) {\n            en = matcher.group(1);\n            res[1] = en;\n        }\n\n        if (en != null &amp;&amp; en.length() &gt; 0) {\n            int markLeftEnd = text.indexOf(en);\n            if (markLeftEnd &gt; 0) {\n                res[0] = text.substring(0, markLeftEnd);\n            }\n            if (markLeftEnd + en.length() &lt; text.length()) {\n                res[2] = text.substring(markLeftEnd + en.length());\n            }\n        } else {\n            res[0] = text;\n        }\n        return res;\n    }\n\n    private static void trySplit(String s) {\n        String[] ret = splitText(s);\n        System.out.print(s + \"  --&gt;  \");\n        for (int i = 0; i &lt; ret.length; i++) {\n            System.out.print(ret[i]);\n            if (i + 1 &lt; ret.length) {\n                System.out.print(\"  ||  \");\n            }\n        }\n        System.out.println();\n    }\n\n}\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c <pre><code>  --&gt;    ||  null  ||  null\nRustFisher  --&gt;  null  ||  RustFisher  ||  null\n..Rust  --&gt;  ..  ||  Rust  ||  null\nFisher..  --&gt;  null  ||  Fisher  ||  ..\n..&lt;&lt;Hello&gt;&gt;..  --&gt;  ..&lt;&lt;  ||  Hello  ||  &gt;&gt;..\n</code></pre></p>"},{"location":"java/reg/code/find-en-word-between-not-word/","title":"\u4f8b\u5b502","text":"<p>\u4ece\u975e\u5b57\u6bcd\u4e2d\u95f4\u627e\u5230\u82f1\u6587\u5355\u8bcd\u3002\u7ed9\u5b9a\u7684\u5b57\u7b26\u4e32\u4f8b\u5982<code>.!?Hello</code>\uff0c<code>Fisher:'</code>\uff0c<code>it's</code>\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7279\u6b8a\u7684\u5355\u8bcd\uff0c\u4f8b\u5982\u7b2c\u4e00<code>1st</code>\uff0c\u7b2c\u4e8c<code>2nd</code>\uff0c\u6570\u5b57\u4e5f\u662f\u5355\u8bcd\u7684\u4e00\u90e8\u5206\u3002 \u6216\u8005\u662f\u5e26\u6709\u5355\u5f15\u53f7\u7684\u5355\u8bcd\uff0c\u4f8b\u5982<code>it's</code>\u3002</p> <p><code>\\w</code>\u8868\u793a<code>[0\u20149A\u2014Za\u2014z]</code>\uff0c\u5373\u6570\u5b57\u6216\u8005\u5b57\u6bcd\u3002 \u8fd9\u91cc\u4e3a\u4e86\u5339\u914d\u5230\u5e26\u5f15\u53f7\u7684\u5355\u8bcd\uff0c\u4f7f\u7528\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u662f<code>REG1 = \"[^\\\\w]*([0-9a-zA-Z']+)[^\\\\w]*\"</code>\u3002 \u627e\u5230\u88ab\u5176\u4ed6\u5b57\u7b26\u5305\u56f4\u7684\u82f1\u6587\u5355\u8bcd\u3002\u8fd9\u4e2a\u8868\u8fbe\u5f0f\u8fd8\u662f\u6709\u7455\u75b5\u3002</p> <p>\u8fd0\u884c\u7ed3\u679c <pre><code>! \u4e0d\u5339\u914d [^\\w]*([0-9a-zA-Z']+)[^\\w]*\n\n!!! \u4e0d\u5339\u914d [^\\w]*([0-9a-zA-Z']+)[^\\w]*\n\n\u8f93\u5165: ?!Rust ; \u6b63\u5219\u8868\u8fbe\u5f0f: [^\\w]*([0-9a-zA-Z']+)[^\\w]* ; group(0)  == ?!Rust\n\u8f93\u5165: ?!Rust ; \u6b63\u5219\u8868\u8fbe\u5f0f: [^\\w]*([0-9a-zA-Z']+)[^\\w]* ; group(1)  == Rust\n\n\u8f93\u5165: Fisher:' ; \u6b63\u5219\u8868\u8fbe\u5f0f: [^\\w]*([0-9a-zA-Z']+)[^\\w]* ; group(0)  == Fisher:'\n\u8f93\u5165: Fisher:' ; \u6b63\u5219\u8868\u8fbe\u5f0f: [^\\w]*([0-9a-zA-Z']+)[^\\w]* ; group(1)  == Fisher\n\n\u8f93\u5165: ?!THANKS!? ; \u6b63\u5219\u8868\u8fbe\u5f0f: [^\\w]*([0-9a-zA-Z']+)[^\\w]* ; group(0)  == ?!THANKS!?\n\u8f93\u5165: ?!THANKS!? ; \u6b63\u5219\u8868\u8fbe\u5f0f: [^\\w]*([0-9a-zA-Z']+)[^\\w]* ; group(1)  == THANKS\n\n\u8f93\u5165: &lt;&lt;how&gt;&gt; ; \u6b63\u5219\u8868\u8fbe\u5f0f: [^\\w]*([0-9a-zA-Z']+)[^\\w]* ; group(0)  == &lt;&lt;how&gt;&gt;\n\u8f93\u5165: &lt;&lt;how&gt;&gt; ; \u6b63\u5219\u8868\u8fbe\u5f0f: [^\\w]*([0-9a-zA-Z']+)[^\\w]* ; group(1)  == how\n\n\u8f93\u5165: ?1st? ; \u6b63\u5219\u8868\u8fbe\u5f0f: [^\\w]*([0-9a-zA-Z']+)[^\\w]* ; group(0)  == ?1st?\n\u8f93\u5165: ?1st? ; \u6b63\u5219\u8868\u8fbe\u5f0f: [^\\w]*([0-9a-zA-Z']+)[^\\w]* ; group(1)  == 1st\n\n\u8f93\u5165: ?21st! ; \u6b63\u5219\u8868\u8fbe\u5f0f: [^\\w]*([0-9a-zA-Z']+)[^\\w]* ; group(0)  == ?21st!\n\u8f93\u5165: ?21st! ; \u6b63\u5219\u8868\u8fbe\u5f0f: [^\\w]*([0-9a-zA-Z']+)[^\\w]* ; group(1)  == 21st\n\n\u8f93\u5165: ?it's! ; \u6b63\u5219\u8868\u8fbe\u5f0f: [^\\w]*([0-9a-zA-Z']+)[^\\w]* ; group(0)  == ?it's!\n\u8f93\u5165: ?it's! ; \u6b63\u5219\u8868\u8fbe\u5f0f: [^\\w]*([0-9a-zA-Z']+)[^\\w]* ; group(1)  == it's\n</code></pre></p> <p>\u793a\u4f8b\u4ee3\u7801 <pre><code>public class ExtractEnWordBetweenMarks {\n\n    private static final String REG1 = \"[^\\\\w]*([0-9a-zA-Z']+)[^\\\\w]*\";\n    private static Pattern pattern = Pattern.compile(REG1);\n\n    public static void main(String[] args) {\n        System.out.println(\"\u4ece [\u975e\u5b57\u6bcd \u5b57\u6bcd \u975e\u5b57\u6bcd] \u4e2d\u63d0\u53d6\u51fa\u82f1\u6587\u5355\u8bcd\");\n        final String[] regs = {\n                REG1\n        };\n        final String[] textArr = {\"!\", \"!!!\", \"?!Rust\", \"Fisher:'\", \"?!THANKS!?\", \"&lt;&lt;how&gt;&gt;\", \"?1st?\", \"?21st!\", \"?it's!\"};\n        for (String r : regs) {\n            for (String s : textArr) {\n                extractTextFrom(r, s);\n                System.out.println();\n            }\n        }\n    }\n\n    private static void extractTextFrom(String reg, String txt) {\n        if (!txt.matches(reg)) {\n            System.out.println(txt + \" \u4e0d\u5339\u914d \" + reg);\n            return;\n        }\n        Pattern pattern = Pattern.compile(reg);\n        Matcher matcher = pattern.matcher(txt);\n        while (matcher.find()) {\n            for (int i = 0; i &lt;= matcher.groupCount(); i++) {\n                System.out.println(\"\u8f93\u5165: \"+txt + \" ; \u6b63\u5219\u8868\u8fbe\u5f0f: \" + reg + \" ; group(\" + i + \")  == \" + matcher.group(i));\n            }\n        }\n    }\n}\n</code></pre></p> <p>\u4fee\u6539\u6b63\u5219\u8868\u8fbe\u5f0f\u4e3a<code>[^\\w]*([0-9a-zA-Z'\"]+)[^\\w]*</code>\u3002\u9664\u4e86\u652f\u6301\u5355\u5f15\u53f7\uff0c\u4e5f\u652f\u6301\u53cc\u5f15\u53f7<code>\"</code>\u3002</p> <p>\u9700\u8981\u652f\u6301\u7684\u7b26\u53f7\uff0c\u53ef\u4ee5\u6309\u7167\u4e0a\u9762\u7684\u6837\u5b50\u6dfb\u52a0\u3002</p>"},{"location":"java/security/Java-encrypt-note/","title":"Java\u4f7f\u7528\u52a0\u5bc6\u7b97\u6cd5","text":"\u66f4\u65b0\u5185\u5bb9: 2022-8-10 <ul> <li>2022-8-10 \u66f4\u65b0\u5185\u5bb9</li> </ul>"},{"location":"java/security/Java-encrypt-note/#md5","title":"MD5","text":"<p>\u4e00\u79cd\u5e94\u7528\u5e7f\u6cdb\u7684\u4ea7\u751f128\u4f4dhash\u503c\u7684\u7b97\u6cd5\u3002</p> <p><pre><code>public static String getMD5(String string) {\n    byte[] hash;\n    try {\n        hash = MessageDigest.getInstance(\"MD5\").digest(string.getBytes(\"UTF-8\"));\n    } catch (NoSuchAlgorithmException e) {\n        throw new RuntimeException(\"Huh, MD5 should be supported?\", e);\n    } catch (UnsupportedEncodingException e) {\n        throw new RuntimeException(\"Huh, UTF-8 should be supported?\", e);\n    }\n\n    StringBuilder hex = new StringBuilder(hash.length * 2);\n    for (byte b : hash) {\n        if ((b &amp; 0xFF) &lt; 0x10)\n            hex.append(\"0\");\n        hex.append(Integer.toHexString(b &amp; 0xFF));\n    }\n    return hex.toString();\n}\n</code></pre> \u540c\u6837\u7684\u4ee3\u7801\u53ef\u4ee5\u5728Android\u4e2d\u4f7f\u7528</p> <p>\u4f8b\u5982\u5bf9\u6587\u4ef6\u8ba1\u7b97md5\uff0c\u9700\u8981\u5148\u62ff\u5230\u6587\u4ef6\u7684\u5b57\u8282\u6570\u7ec4 \u4f20\u5165byte\u6570\u7ec4<pre><code>import java.security.MessageDigest;\nimport java.security.NoSuchAlgorithmException;\n\npublic static String getMD5(byte[] bytes) {\n    byte[] hash;\n    try {\n        hash = MessageDigest.getInstance(\"MD5\").digest(bytes);\n    } catch (NoSuchAlgorithmException e) {\n        throw new RuntimeException(\"Huh, MD5 should be supported?\", e);\n    }\n    StringBuilder hex = new StringBuilder(hash.length * 2);\n    for (byte b : hash) {\n        if ((b &amp; 0xFF) &lt; 0x10)\n            hex.append(\"0\");\n        hex.append(Integer.toHexString(b &amp; 0xFF));\n    }\n    return hex.toString();\n}\n</code></pre></p>"},{"location":"java/swing/Java-Swing-use1/","title":"Swing \u7b80\u4ecb","text":"<p>\u5982\u679c\u6709Android app\u5f00\u53d1\u7ecf\u9a8c\uff0c\u5feb\u901f\u4e0a\u624bSwing\u4e0d\u662f\u95ee\u9898\u3002UI\u65b9\u9762\u6709\u76f8\u4f3c\u7684\u5730\u65b9\u3002 \u7b80\u5355\u7684\u51e0\u884c\u4ee3\u7801\u5c31\u80fd\u629b\u51fa\u4e00\u4e2a\u6846\u6846\uff0c\u8bb0\u5f55\u4e00\u4e0b\u64cd\u4f5c\u8fc7\u7a0b\u3002</p>"},{"location":"java/swing/Java-Swing-use1/#1","title":"1.\u5148\u663e\u793a\u4e00\u4e2a\u6846\u6846","text":"<p>EraseBlockGame\u7c7b\u662f\u4e3b\u7c7b\uff0c\u5305\u542b\u4e86main\u5165\u53e3\uff0c\u7ee7\u627f\u81ea JFrame <pre><code>public class EraseBlockGame extends JFrame{\n......\n    public EraseBlockGame(String GameTitle){  // \u6784\u9020\u65b9\u6cd5\n        super(GameTitle);\n        setSize(408, 640);\n        setLocationRelativeTo(null);// place in the center of screen\n        ......\n        setVisible(true);s\n    }\n}\n</code></pre> \u8bbe\u7f6e\u7a97\u53e3\u5927\u5c0f\uff0c\u8bbe\u7f6e\u7a97\u53e3\u5728\u5c4f\u5e55\u4e0a\u7684\u4f4d\u7f6e\uff0c\u7a97\u53e3\u53ef\u89c1 <pre><code>    public static void main(String args[]){\n        EraseBlockGame e = new EraseBlockGame(\"Erase Block Game\");\n    }\n</code></pre> \u8fd0\u884c\u4e00\u4e0b\u7a0b\u5e8f\uff0c\u5f39\u51fa\u4e00\u4e2a\u7a97\u53e3\uff1b\u7a97\u53e3\u540d\u79f0\u4e3aErase Block Game</p>"},{"location":"java/swing/Java-Swing-use1/#2","title":"2.\u83dc\u5355\u680f","text":"<p>\u83dc\u5355\u680f\u6709\u83dc\u5355\u6309\u94ae\uff0c\u4ee5\u53ca\u83dc\u5355\u9009\u9879 <pre><code>import javax.swing.JFrame;\nimport javax.swing.JMenu;\nimport javax.swing.JMenuBar;\nimport javax.swing.JMenuItem;\n</code></pre> * JMenuBar \u662f\u6574\u4e2a\u83dc\u5355 * JMenu \u662f\u83dc\u5355\u680f\u4e0a\u7684\u5355\u4e2a\u6309\u94ae * JMenuItem \u70b9\u5f00\u5355\u4e2a\u9910\u5355\u952e\uff0c\u5f39\u51fa\u7684\u5b50\u9009\u9879item</p> <p><pre><code>public class EraseBlockGame extends JFrame{\n    private static final long serialVersionUID = 1L;\n    private JMenuBar menuBar = new JMenuBar();\n    private JMenu mGame = new JMenu(\"Game\");\n    private JMenuItem miNewGame = new JMenuItem(\"New game\");\n    private JMenuItem miExit = new JMenuItem(\"Exit\");\n    ......\n}\n</code></pre> \u5982\u679c\u591a\u51e0\u4e2a\u9009\u9879\uff0c\u603b\u662fnew\u4f3c\u4e4e\u4e0d\u5927\u597d\uff0c\u7528\u7b80\u5355\u5de5\u5382\u6765\u4ee3\u66ffnew \u5b9a\u4e49JMenuFactory\uff0c\u91cc\u9762\u6709\u521b\u5efaJMenu\u7684\u65b9\u6cd5 <pre><code>package com.rust.util;\n\nimport javax.swing.JMenu;\n\npublic class JMenuFactory {\n    JMenu menu;\n    public JMenuFactory(){\n\n    }\n    public JMenu createMenu(String title){\n        JMenu menu = new JMenu(title);\n        return menu;\n    }\n}\n</code></pre> \u540c\u6837\u5b9a\u4e49JMenuItemFactory <pre><code>package com.rust.util;\n\nimport javax.swing.JMenuItem;\n\npublic class JMenuItemFactory {\n    JMenuItem item;\n    public JMenuItemFactory(){\n\n    }\n    public JMenuItem createMenuItem(String title){\n        item = new JMenuItem(title);\n        return item;\n    }\n}\n</code></pre> \u539f\u6765\u7684new\u5c31\u53ef\u4ee5\u66ff\u6362\u4e3a <pre><code>    private JMenu mGame;\n    private JMenu mControl;\n    private JMenu mInfo;\n    private JMenuItem miNewGame;\n    private JMenuItem miExit;\n    ......\n        mGame = menuFactory.createMenu(\"Game\");\n        mControl = menuFactory.createMenu(\"Control\");\n        mInfo = menuFactory.createMenu(\"Info\");\n        miNewGame = miFactory.createMenuItem(\"New game\");\n        miExit = miFactory.createMenuItem(\"Exit\");\n</code></pre></p> <p>\u5728\u6784\u9020\u51fd\u6570\u4e2d\u7ed9\u83dc\u5355item\u6dfb\u52a0ActionListener\uff0c\u548cAndroid app\u7684Button\u5dee\u4e0d\u591a <pre><code>        miNewGame.addActionListener(new ActionListener() {\n            @Override\n            public void actionPerformed(ActionEvent e) {\n\n            }\n        });\n        miExit.addActionListener(new ActionListener() {\n            @Override\n            public void actionPerformed(ActionEvent e) {\n                System.exit(0);\n            }\n        });\n\n        mGame.add(miNewGame);//\u8fd9\u91cc\u6dfb\u52a0\u7684\u987a\u5e8f\u5c31\u662f\u6392\u5217\u7684\u987a\u5e8f\n        mGame.add(miExit);//\u5f80menu\u4e2d\u6dfb\u52a0\u5b50\u9879\n\n        menuBar.add(mGame);\n        menuBar.add(mControl);//\u8fd9\u91cc\u6dfb\u52a0\u7684\u987a\u5e8f\u5c31\u662f\u6392\u5217\u7684\u987a\u5e8f\n\n        setJMenuBar(menuBar);\n</code></pre> \u5982\u6b64\u770b\u6765\uff0cSwing\u6d3b\u5728\u4e86Android\u4e2d</p>"},{"location":"java/swing/Java-Swing-use1/#3","title":"3.\u653e\u7f6e\u6309\u94ae","text":"<p>\u6b64\u65f6\u754c\u9762\u4e0a\u53ea\u6709\u4e00\u4e9b\u83dc\u5355\u6309\u952e\uff0c\u591a\u6446\u51e0\u4e2a\u6309\u94ae\u4e0a\u53bb\u770b\u770b</p> <p>\u5b9a\u4e49\u4e00\u4e2a\u63a7\u5236\u9762\u677f\u7c7bControlBoard \u7ee7\u627f\u81ea JPanel <pre><code>/**\n * \u63a7\u5236\u9762\u677f\uff0c\u63d0\u4f9b\u5f88\u591a\u5feb\u6377\u7684\u63a7\u5236\u529f\u80fd\n * @author Rust Fisher\n */\npublic class ControlBoard extends JPanel{\n    private JButton btnStart;\n    private JButton btnStop;\n    private JButton btnPause;\n    private JButton btnReset;\n    private JButton btnExit;\n    /*\u5b9a\u4e49\u4e00\u4e2a\u6309\u94ae\u533a\u57dfareaButton\uff0c\u7528\u6765\u5b58\u653ebtn*/\n    private JPanel areaButton = new JPanel(new GridLayout(5, 1));\n\n    private EraseBlockGame game;\n    /*\u6309\u94ae\u533a\u57df\u7684\u6846\u6846*/\n    private Border border = new EtchedBorder(EtchedBorder.RAISED, Color.WHITE,Color.gray);\n\n    public ControlBoard(final EraseBlockGame game){\n        setLayout(new GridLayout(3,1,0,1));\n        this.game = game;//\u7528\u4e8e\u63a7\u5236\n\n        btnStart = new JButton(\"Start\");\n        btnStart.setEnabled(true);\n        btnStop = new JButton(\"Stop\");\n        btnStop.setEnabled(false);\n        btnPause = new JButton(\"Pause\");\n        btnPause.setEnabled(false);\n        btnReset = new JButton(\"Reset\");\n        btnReset.setEnabled(true);\n        btnExit = new JButton(\"Exit\");\n        btnExit.setEnabled(true);\n\n        areaButton.add(btnStart);\n        areaButton.add(btnPause);\n        areaButton.add(btnStop);\n        areaButton.add(btnReset);\n        areaButton.add(btnExit);\n\n        areaButton.setBorder(border);\n\n        add(areaButton);// \u628a\u6309\u94ae\u533a\u6dfb\u52a0\u5230\u63a7\u5236\u9762\u677f\u4e0a\n        btnStart.addActionListener(new ActionListener() {\n            @Override\n            public void actionPerformed(ActionEvent e) {\n                // go go go\n\n            }\n        });\n        btnExit.addActionListener(new ActionListener() {\n            @Override\n            public void actionPerformed(ActionEvent e) {\n                System.exit(0);//886\n            }\n        });\n    }\n......\n}\n</code></pre> \u5728EraseBlockGame\u7c7b\u91cc\u52a0\u8f7d\u6309\u94ae\u533a\u57df <pre><code>public class EraseBlockGame extends JFrame{\n......\n    private ControlBoard controlBoard;\n\n    public EraseBlockGame(String title){\n        ......\n        Container container = getContentPane();\n        controlBoard = new ControlBoard(this);\n        container.add(controlBoard, BorderLayout.EAST);//\u6dfb\u52a0\u63a7\u5236\u9762\u677f\n        ......\n    }\n}\n</code></pre> \u4e8e\u662f\u6309\u94ae\u5c31\u88ab\u88c5\u5230\u7a0b\u5e8f\u4e0a\u4e86</p> <p>\u5176\u4ed6\u7684\u5c31\u5148\u4e0d\u7ea0\u7ed3\u4e86\uff0cSwing\u4e86\u89e3\u4e2a\u5927\u6982\u5c31\u597d\uff1b\u53ef\u4ee5\u591a\u770b\u770bandroid\u5f00\u53d1</p>"},{"location":"java/thread/thread-class-intro/","title":"Java\u591a\u7ebf\u7a0b\u4ecb\u7ecd","text":"\u66f4\u65b0\u65e5\u671f: 2021-9-6 <ul> <li>2021-9-6 \u521b\u5efa\u6587\u6863</li> </ul> \u8fd0\u884c\u73af\u5883\u4e0e\u5de5\u5177 <ul> <li>jdk1.8.0</li> <li>macOS 11.4</li> <li>IDEA</li> </ul> <p>\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u5728\u540c\u4e00\u65f6\u523b\u8fd0\u884c\u591a\u4e2a\u7a0b\u5e8f\u3002\u4f8b\u5982\u4e00\u8fb9\u64ad\u653e\u97f3\u4e50\uff0c\u4e00\u8fb9\u4e0b\u8f7d\u6587\u4ef6\u548c\u6d4f\u89c8\u7f51\u9875\u3002\u64cd\u4f5c\u7cfb\u7edf\u5c06cpu\u7684\u65f6\u95f4\u7247\u5206\u914d\u7ed9\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u7ed9\u4eba\u4e00\u79cd\u5e76\u884c\u5904\u7406\u7684\u611f\u89c9\u3002</p> <p>\u4e00\u4e2a\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u53ef\u4ee5\u540c\u65f6\u6267\u884c\u591a\u4e2a\u4efb\u52a1\u3002\u901a\u5e38\uff0c\u6bcf\u4e00\u4e2a\u4efb\u52a1\u79f0\u4e3a\u4e00\u4e2a\u7ebf\u7a0b\uff08thread\uff09\uff0c\u5b83\u662f\u7ebf\u7a0b\u63a7\u5236\u7684\u7b80\u79f0\u3002\u53ef\u4ee5\u540c\u65f6\u8fd0\u884c\u4e00\u4e2a\u4ee5\u4e0a\u7ebf\u7a0b\u7684\u7a0b\u5e8f\u6210\u4e3a\u591a\u7ebf\u7a0b\u7a0b\u5e8f\uff08multithreaded\uff09\u3002</p> <p>\u591a\u8fdb\u7a0b\u548c\u591a\u7ebf\u7a0b\u6709\u54ea\u4e9b\u533a\u522b\u5462\uff1f</p> <p>\u672c\u8d28\u533a\u522b\u5728\u4e8e\u8fdb\u7a0b\u6bcf\u4e2a\u8fdb\u7a0b\u6709\u81ea\u5df1\u7684\u4e00\u6574\u5957\u53d8\u91cf\uff0c\u800c\u7ebf\u7a0b\u5219\u5171\u4eab\u6570\u636e\u3002 \u7ebf\u7a0b\u6bd4\u8fdb\u7a0b\u66f4\u8f7b\u91cf\u7ea7\uff0c\u521b\u5efa\u3001\u9500\u6bc1\u4e00\u4e2a\u7ebf\u7a0b\u6bd4\u542f\u52a8\u65b0\u8fdb\u7a0b\u7684\u5f00\u9500\u8981\u5c0f\u3002</p> <p>\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u591a\u7ebf\u7a0b\u975e\u5e38\u6709\u7528\u3002\u4f8b\u5982\u5e94\u7528\u4e00\u8fb9\u5904\u7406\u7528\u6237\u7684\u8f93\u5165\u6307\u4ee4\uff0c\u4e00\u904d\u8054\u7f51\u83b7\u53d6\u6570\u636e\u3002</p> <p>\u672c\u6587\u6211\u4eec\u4ecb\u7ecdJava\u4e2d\u7684Thread\u7c7b\u3002</p>"},{"location":"java/thread/thread-class-intro/#thread","title":"Thread","text":"<p>Thread\u7c7b\u5c5e\u4e8e<code>java.lang</code>\u5305\u3002</p> <p>\u8981\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u5f88\u7b80\u5355\uff0c\u65b0\u5efa\u4e00\u4e2aThread\u5bf9\u8c61\uff0c\u5e76\u4f20\u5165\u4e00\u4e2aRunnable\uff0c\u5b9e\u73b0<code>run()</code>\u65b9\u6cd5\u3002 \u8c03\u7528<code>start()</code>\u65b9\u6cd5\u542f\u52a8\u7ebf\u7a0b\u3002</p> JavaJava lambda <pre><code>Thread t1 = new Thread(new Runnable() {\n    @Override\n    public void run() {\n        System.out.println(\"rustfisher said: hello\");\n    }\n});\nt1.start();\n</code></pre> <pre><code>Thread t1 = new Thread(() -&gt; System.out.println(\"rustfisher said: hello\"));\nt1.start();\n</code></pre> \u4e0d\u8981\u76f4\u63a5\u8c03\u7528run()\u65b9\u6cd5 <p>\u76f4\u63a5\u8c03\u7528<code>run()</code>\u65b9\u6cd5\u4e0d\u4f1a\u542f\u52a8\u65b0\u7684\u7ebf\u7a0b\uff0c\u800c\u662f\u76f4\u63a5\u5728\u5f53\u524d\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\u3002</p> <p>\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u4f7f\u7528\u4e86<code>Thread.sleep()</code>\u65b9\u6cd5\u7684\u4f8b\u5b50\u3002</p> <pre><code>Thread t1 = new Thread(() -&gt; {\n    for (String a : \"rustfisher said: hello\".split(\"\")) {\n        try {\n            Thread.sleep(100);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        System.out.print(a);\n    }\n});\nt1.start();\n</code></pre> <p><code>sleep(int)</code>\u65b9\u6cd5\u4f1a\u8ba9\u7ebf\u7a0b\u7761\u7720\u4e00\u4e2a\u6307\u5b9a\u7684\u65f6\u95f4\uff08\u5355\u4f4d\u6beb\u79d2\uff09\u3002\u5e76\u4e14\u9700\u8981try-catch\u6355\u83b7<code>InterruptedException</code>\u5f02\u5e38\u3002</p>"},{"location":"java/thread/thread-class-intro/#_1","title":"\u4e2d\u65ad\u7ebf\u7a0b","text":"<p>\u5f53<code>run()</code>\u65b9\u6cd5\u6267\u884c\u5b8c\u6700\u540e\u4e00\u6761\u8bed\u53e5\u540e\uff0c\u6216\u8005<code>return</code>\uff0c\u6216\u8005\u51fa\u73b0\u4e86\u672a\u6355\u83b7\u7684\u5f02\u5e38\uff0c\u7ebf\u7a0b\u5c06\u4f1a\u7ec8\u6b62\u3002</p> <p>\u4f7f\u7528Thread\u7684<code>interrupt</code>\u65b9\u6cd5\u4e5f\u53ef\u4ee5\u7ec8\u6b62\u7ebf\u7a0b\u3002\u8c03\u7528<code>interrupt</code>\u65b9\u6cd5\u65f6\uff0c\u4f1a\u4fee\u6539\u7ebf\u7a0b\u7684\u4e2d\u65ad\u72b6\u6001\u4e3a<code>true</code>\u3002 \u7528<code>isInterrupted()</code>\u53ef\u4ee5\u67e5\u770b\u7ebf\u7a0b\u7684\u4e2d\u65ad\u72b6\u6001\u3002</p> <p>\u4f46\u5982\u679c\u7ebf\u7a0b\u88ab\u963b\u585e\u4e86\uff0c\u5c31\u6ca1\u6cd5\u68c0\u6d4b\u4e2d\u65ad\u72b6\u6001\u3002\u5f53\u5728\u4e00\u4e2a\u88ab\u963b\u585e\u7684\u7ebf\u7a0b\uff08sleep\u6216\u8005wait\uff09\u4e0a\u8c03\u7528<code>interrupt</code>\u65b9\u6cd5\uff0c\u963b\u585e\u8c03\u7528\u5c06\u4f1a\u88ab<code>InterruptedException</code>\u4e2d\u65ad\u3002</p> <p>\u88ab\u4e2d\u65ad\u7684\u7ebf\u7a0b\u53ef\u4ee5\u51b3\u5b9a\u5982\u4f55\u54cd\u5e94\u4e2d\u65ad\u3002\u53ef\u4ee5\u7b80\u5355\u5730\u5c06\u4e2d\u65ad\u4f5c\u4e3a\u4e00\u4e2a\u7ec8\u6b62\u8bf7\u6c42\u3002\u6bd4\u5982\u6211\u4eec\u4e3b\u52a8\u6355\u83b7<code>InterruptedException</code>\u3002</p> <p><pre><code>Thread t2 = new Thread(() -&gt; {\n    for (String a : \"rustfisher said: hello\".split(\"\")) {\n        try {\n            Thread.sleep(200);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n            System.out.println(\"\u88ab\u4e2d\u65ad \u9000\u51fa\u7ebf\u7a0b\");\n            return;\n        }\n        System.out.print(a);\n    }\n});\nt2.start();\n\nnew Thread(() -&gt; {\n    try {\n        Thread.sleep(1000);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n    t2.interrupt();\n}).start();\n</code></pre> \u4e0a\u9762\u8fd9\u4e2a\u5c0f\u4f8b\u5b50\u5c55\u793a\u4e86\u7528<code>interrupt()</code>\u6765\u4e2d\u65ad\u7ebf\u7a0b<code>t2</code>\u3002\u800c\u7ebf\u7a0b<code>t2</code>\u7684<code>run()</code>\u65b9\u6cd5\u4e2d\u6355\u83b7<code>InterruptedException</code>\u540e\uff0c\u53ef\u4ee5\u8fdb\u884c\u81ea\u5df1\u7684\u5904\u7406\u3002</p>"},{"location":"java/thread/thread-class-intro/#_2","title":"\u7ebf\u7a0b\u7684\u72b6\u6001","text":"<p>\u7ebf\u7a0b\u67096\u79cd\u72b6\u6001\uff0c\u7528\u679a\u4e3e\u7c7bState\u6765\u8868\u793a\uff1a</p> <ul> <li>NEW\uff08\u65b0\u521b\u5efa\uff09</li> <li>RUNNABLE\uff08\u53ef\u8fd0\u884c\uff09</li> <li>BLOCKED\uff08\u88ab\u963b\u585e\uff09</li> <li>WAITING\uff08\u7b49\u5f85\uff09</li> <li>TIMED_WAITING\uff08\u8ba1\u65f6\u7b49\u5f85\uff09</li> <li>TERMINATED\uff08\u88ab\u7ec8\u6b62\uff09</li> </ul> <p>\u7528<code>getState()</code>\u65b9\u6cd5\u53ef\u4ee5\u83b7\u53d6\u5230\u7ebf\u7a0b\u7684\u72b6\u6001\u3002</p>"},{"location":"java/thread/thread-class-intro/#_3","title":"\u65b0\u521b\u5efa\u7ebf\u7a0b","text":"<p>new\u4e00\u4e2a\u7ebf\u7a0b\u7684\u65f6\u5019\uff0c\u7ebf\u7a0b\u8fd8\u6ca1\u5f00\u59cb\u8fd0\u884c\uff0c\u6b64\u65f6\u662fNEW\uff08\u65b0\u521b\u5efa\uff09\u72b6\u6001\u3002\u5728\u7ebf\u7a0b\u53ef\u4ee5\u8fd0\u884c\u524d\uff0c\u8fd8\u6709\u4e00\u4e9b\u5de5\u4f5c\u8981\u505a\u3002</p>"},{"location":"java/thread/thread-class-intro/#_4","title":"\u53ef\u8fd0\u884c\u7ebf\u7a0b","text":"<p>\u4e00\u65e6\u8c03\u7528<code>start()</code>\u65b9\u6cd5\uff0c\u7ebf\u7a0b\u5904\u4e8eRUNNABLE\uff08\u53ef\u8fd0\u884c\uff09\u72b6\u6001\u3002\u8c03\u7528<code>start()</code>\u540e\u5e76\u4e0d\u4fdd\u8bc1\u7ebf\u7a0b\u4f1a\u7acb\u523b\u8fd0\u884c\uff0c\u800c\u662f\u8981\u770b\u64cd\u4f5c\u7cfb\u7edf\u7684\u5b89\u6392\u3002</p> <p>\u4e00\u4e2a\u7ebf\u7a0b\u5f00\u59cb\u8fd0\u884c\u540e\uff0c\u5b83\u4e0d\u4e00\u5b9a\u65f6\u523b\u5904\u4e8e\u8fd0\u884c\u72b6\u6001\u3002\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u8ba9\u5176\u4ed6\u7ebf\u7a0b\u83b7\u5f97\u8fd0\u884c\u673a\u4f1a\u3002\u4e00\u4e2a\u53ef\u8fd0\u884c\u7684\u7ebf\u7a0b\u53ef\u80fd\u6b63\u5728\u8fd0\u884c\u4e5f\u53ef\u80fd\u6ca1\u5728\u8fd0\u884c\u3002</p>"},{"location":"java/thread/thread-class-intro/#_5","title":"\u88ab\u963b\u585e\u548c\u7b49\u5f85","text":"<p>\u7ebf\u7a0b\u5904\u4e8e\u88ab\u963b\u585e\u548c\u7b49\u5f85\u72b6\u6001\u65f6\uff0c\u5b83\u6682\u65f6\u4e0d\u6d3b\u52a8\u3002\u4e0d\u8fd0\u884c\u4ee3\u7801\uff0c\u4e14\u53ea\u6d88\u8017\u6700\u5c11\u7684\u8d44\u6e90\u3002\u76f4\u5230\u7ebf\u7a0b\u8c03\u5ea6\u5668\u91cd\u65b0\u6fc0\u6d3b\u5b83\u3002</p> <ul> <li>\u4e00\u4e2a\u7ebf\u7a0b\u8bd5\u56fe\u83b7\u53d6\u4e00\u4e2a\u5185\u90e8\u7684\u5bf9\u8c61\u9501\uff0c\u800c\u8be5\u9501\u88ab\u5176\u4ed6\u7ebf\u7a0b\u6301\u6709\uff0c\u5219\u8fd9\u4e2a\u7ebf\u7a0b\u8fdb\u5165\u963b\u585e\u72b6\u6001\u3002\u5f53\u8fd9\u4e2a\u9501\u88ab\u91ca\u653e\uff0c\u5e76\u4e14\u7ebf\u7a0b\u8c03\u5ea6\u5668\u5141\u8bb8\u8fd9\u4e2a\u7ebf\u7a0b\u6301\u6709\u5b83\uff0c\u8be5\u7ebf\u7a0b\u53d8\u6210\u975e\u963b\u585e\u72b6\u6001\u3002</li> <li>\u5f53\u7ebf\u7a0b\u7b49\u5f85\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u901a\u77e5\u8c03\u5ea6\u5668\uff0c\u5b83\u81ea\u5df1\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\u3002\u4f8b\u5982\u8c03\u7528<code>Object.wait()</code>\u6216\u8005<code>Thread.join()</code>\u65b9\u6cd5\u3002</li> <li>\u5e26\u6709\u8d85\u65f6\u53c2\u6570\u7684\u65b9\u6cd5\u53ef\u8ba9\u7ebf\u7a0b\u8fdb\u5165\u8d85\u65f6\u7b49\u5f85\u72b6\u6001\u3002\u4f8b\u5982<code>Thread.sleep()</code>\uff0c<code>Object.wait(long)</code>\uff0c<code>Thread.join(long)</code>\uff0c<code>Lock.tryLock(long time, TimeUnit unit)</code></li> </ul> <p></p> <p>\u4e0a\u9762\u8fd9\u4e2a\u56fe\u5c55\u793a\u4e86\u72b6\u6001\u4e4b\u95f4\u7684\u5207\u6362\u3002</p>"},{"location":"java/thread/thread-class-intro/#_6","title":"\u88ab\u7ec8\u6b62","text":"<p>\u7ec8\u6b62\u7684\u539f\u56e0\uff1a</p> <ul> <li>run\u65b9\u6cd5\u6b63\u5e38\u9000\u51fa</li> <li>\u51fa\u73b0\u4e86\u6ca1\u6709\u6355\u83b7\u7684\u5f02\u5e38\u800c\u7ec8\u6b62\u4e86run\u65b9\u6cd5</li> </ul>"},{"location":"java/thread/thread-class-intro/#_7","title":"\u7ebf\u7a0b\u5c5e\u6027","text":"<p>\u7ebf\u7a0b\u4f18\u5148\u7ea7\uff0c\u5b88\u62a4\u7ebf\u7a0b\uff0c\u7ebf\u7a0b\u7ec4\u4ee5\u53ca\u5904\u7406\u672a\u6355\u83b7\u5f02\u5e38\u7684\u5904\u7406\u5668\u3002</p>"},{"location":"java/thread/thread-class-intro/#_8","title":"\u7ebf\u7a0b\u4f18\u5148\u7ea7","text":"<p>Java\u4e2d\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u4e00\u4e2a\u4f18\u5148\u7ea7\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7ebf\u7a0b\u7ee7\u627f\u5b83\u7684\u7236\u7ebf\u7a0b\u7684\u4f18\u5148\u7ea7\u3002 \u53ef\u7528<code>setPriority(int)</code>\u65b9\u6cd5\u8bbe\u7f6e\u4f18\u5148\u7ea7\u3002\u4f18\u5148\u7ea7\u6700\u5927\u4e3a<code>MAX_PRIORITY = 10</code>\uff0c\u6700\u5c0f\u4e3a<code>MIN_PRIORITY = 1</code>\uff0c\u666e\u901a\u7684\u662f<code>NORM_PRIORITY = 5</code>\u3002 \u7ebf\u7a0b\u8c03\u5ea6\u5668\u6709\u673a\u4f1a\u9009\u65b0\u7ebf\u7a0b\u662f\uff0c\u4f1a\u4f18\u5148\u9009\u9ad8\u4f18\u5148\u7ea7\u7684\u7ebf\u7a0b\u3002</p>"},{"location":"java/thread/thread-class-intro/#_9","title":"\u5b88\u62a4\u7ebf\u7a0b","text":"<p>\u8c03\u7528<code>setDaemon(true)</code>\u53ef\u4ee5\u5207\u6362\u4e3a\u5b88\u62a4\u7ebf\u7a0b\uff08daemon thread\uff09\u3002\u5b88\u62a4\u7ebf\u7a0b\u7684\u7528\u9014\u662f\u4e3a\u5176\u4ed6\u7ebf\u7a0b\u63d0\u4f9b\u670d\u52a1\u3002\u4f8b\u5982\u8ba1\u65f6\u7ebf\u7a0b\u3002 \u5f53\u53ea\u5269\u4e0b\u5b88\u62a4\u7ebf\u7a0b\u65f6\uff0c\u865a\u62df\u673a\u5c31\u9000\u51fa\u4e86\u3002</p> <p>\u5b88\u62a4\u7ebf\u7a0b\u4e0d\u5e94\u8be5\u53bb\u8bbf\u95ee\u56fa\u6709\u8d44\u6e90\uff0c\u5982\u6587\u4ef6\u548c\u6570\u636e\u5e93\u3002</p>"},{"location":"java/thread/thread-class-intro/#_10","title":"\u672a\u6355\u83b7\u5f02\u5e38\u5904\u7406\u5668","text":"<p><code>run()</code>\u65b9\u6cd5\u91cc\u629b\u51fa\u4e00\u4e2a\u672a\u6355\u83b7\u5f02\u5e38\uff0c\u5728\u7ebf\u7a0b\u6b7b\u4ea1\u524d\uff0c\u5f02\u5e38\u88ab\u4f20\u9012\u5230\u4e00\u4e2a\u7528\u4e8e\u672a\u6355\u83b7\u5f02\u5e38\u7684\u5904\u7406\u5668\u3002 \u8981\u4f7f\u7528\u8fd9\u4e2a\u5904\u7406\u5668\uff0c\u9700\u8981\u5b9e\u73b0\u63a5\u53e3<code>Thread.UncaughtExceptionHandler</code>\uff0c\u5e76\u4e14\u7528<code>setUncaughtExceptionHandler(Thread.UncaughtExceptionHandler)</code>\u65b9\u6cd5\u628a\u5b83\u4ea4\u7ed9\u7ebf\u7a0b\u3002 <pre><code>Thread t3 = new Thread(() -&gt; {\n    try {\n        Thread.sleep(5);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n        return;\n    }\n    int x = 0, y = 3;\n    int z = y / x; // \u6545\u610f\u5f04\u4e00\u4e2a\u5f02\u5e38\n});\nt3.setUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler() {\n    @Override\n    public void uncaughtException(Thread t, Throwable e) {\n        System.out.println(t + \"\u6709\u672a\u6355\u83b7\u5f02\u5e38\");\n        e.printStackTrace();\n    }\n});\nt3.start();\n</code></pre></p> <p>\u8fd0\u884c\u540e\uff0c<code>run()</code>\u65b9\u6cd5\u91cc\u629b\u51fa<code>ArithmeticException</code>\u5f02\u5e38 <pre><code>Thread[Thread-0,5,main]\u6709\u672a\u6355\u83b7\u5f02\u5e38\njava.lang.ArithmeticException: / by zero\n    at Main.lambda$main$0(Main.java:15)\n    at java.lang.Thread.run(Thread.java:748)\n</code></pre></p> <p>\u4e5f\u53ef\u4ee5\u7528\u9759\u6001\u65b9\u6cd5<code>Thread.setDefaultUncaughtExceptionHandler(Thread.UncaughtExceptionHandler)</code>\u7ed9\u6240\u6709\u7684\u7ebf\u7a0b\u5b89\u88c5\u4e00\u4e2a\u9ed8\u8ba4\u5904\u7406\u5668\u3002\u53ef\u4ee5\u5728\u8fd9\u4e2a\u9ed8\u8ba4\u5904\u7406\u5668\u91cc\u505a\u4e00\u4e9b\u5de5\u4f5c\uff0c\u4f8b\u5982\u8bb0\u5f55\u65e5\u5fd7\u3002</p> <p>ThreadGroup\u4ee3\u8868\u7740\u4e00\u7ec4\u7ebf\u7a0b\u3002\u4e5f\u53ef\u4ee5\u5305\u542b\u53e6\u5916\u7684\u7ebf\u7a0b\u7ec4\u3002</p> <p>ThreadGroup\u7c7b\u5b9e\u73b0\u4e86UncaughtExceptionHandler\u63a5\u53e3\u3002\u5b83\u7684<code>uncaughtException(Thread t, Throwable e)</code>\u65b9\u6cd5\u4f1a\u6709\u5982\u4e0b\u64cd\u4f5c</p> <ul> <li>\u5982\u679c\u8be5\u7ebf\u7a0b\u7ec4\u6709\u7236\u7ebf\u7a0b\u7ec4\uff0c\u5219\u7236\u7ebf\u7a0b\u7ec4\u7684<code>uncaughtException</code>\u88ab\u8c03\u7528\u3002</li> <li>\u5426\u5219\uff0c\u5982\u679c<code>Thread.getDefaultUncaughtExceptionHandler()</code>\u8fd4\u56de\u4e00\u4e2a\u975e\u7a7a\u5904\u7406\u5668\uff0c\u5219\u4f7f\u7528\u8fd9\u4e2a\u5904\u7406\u5668\u3002</li> <li>\u5426\u5219\uff0c\u5982\u679c\u629b\u51fa\u7684Throwable\u662fThreadDeath\u5bf9\u8c61\uff0c\u5c31\u4ec0\u4e48\u4e5f\u4e0d\u505a\u3002</li> <li>\u5426\u5219\uff0c\u7ebf\u7a0b\u7684\u540d\u5b57\u548cThrowable\u7684\u6808\u8e2a\u8ff9\u8f93\u51fa\u5230<code>System.err</code>\u4e0a\u3002</li> </ul> <p>\u53c2\u8003\u4e66\u7c4d\uff1a Core Java, Volume II - Advanced Features 7th Edition</p> <p>\u5efa\u8bae\u53c2\u8003\uff1a Concurrent Programming in Java</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u534e\u4e3a\u4e91\u793e\u533a \u6398\u91d1</p>"},{"location":"kotlin/basic/basic-syntax/","title":"\u6982\u5ff5\u4ecb\u7ecd","text":"\u66f4\u65b0\u65e5\u671f: 2021-8-18 <ul> <li>2021-8-18: \u65b0\u5efa\u6587\u6863</li> </ul> <p>\u672c\u6587\u4ecb\u7ecdKotlin\u4e2d\u7684\u4e00\u4e9b\u6982\u5ff5\u3002\u4f8b\u5982\u5305\uff0c\u7a0b\u5e8f\u5165\u53e3\uff0c\u53d8\u91cf\uff0c\u8f93\u51fa\uff0c\u65b9\u6cd5\uff08\u51fd\u6570\uff09\u7b49\u7b49\u3002</p> <p>\u6709\u4e9b\u5730\u65b9\u4f1a\u548cJava\u8fdb\u884c\u5bf9\u6bd4\u3002\u65b9\u4fbf\u7406\u89e3\u3002</p>"},{"location":"kotlin/basic/basic-syntax/#_2","title":"\u5305\u7684\u5b9a\u4e49\u548c\u4f7f\u7528","text":"<p>\u5305\u7684\u5b9a\u4e49\u5e94\u8be5\u5199\u5728\u6587\u4ef6\u7684\u9876\u90e8\u3002 <pre><code>package com.rustfisher.ktpractice.intro\n\nimport kotlin.text.*\n\n// ...\n</code></pre> Kotlin\u5e76\u4e0d\u8981\u6c42\u5305\u540d\u548c\u6587\u4ef6\u5b58\u653e\u4f4d\u7f6e\u4e25\u683c\u5bf9\u5e94\u3002</p>"},{"location":"kotlin/basic/basic-syntax/#_3","title":"\u7a0b\u5e8f\u5165\u53e3","text":"<p>Kotlin\u5e94\u7528\u7684\u7a0b\u5e8f\u5165\u53e3\u662f<code>main</code>\u65b9\u6cd5\u3002 <pre><code>fun main() {\n    // ..\n}\n</code></pre></p> <p>\u53e6\u4e00\u4e2amain\u65b9\u6cd5\u5e26\u6709\u53c2\u6570\u3002 <pre><code>fun main(args: Array&lt;String&gt;) {\n    // ...\n}\n</code></pre></p>"},{"location":"kotlin/basic/basic-syntax/#_4","title":"\u6807\u51c6\u8f93\u51fa","text":"<p><code>print</code>\u65b9\u6cd5\u5c06\u4f20\u5165\u7684\u53d8\u91cf\u6253\u5370\u5230\u6807\u51c6\u8f93\u5165\u6d41\u3002 <pre><code>print(\"Rust \")\nprint(\"Fisher\")\n</code></pre></p> <p><code>println</code>\u6253\u5370\u4f20\u5165\u53d8\u91cf\u5e76\u4e14\u5728\u6700\u540e\u6dfb\u52a0\u4e00\u4e2a\u6362\u884c\u3002 <pre><code>println(\"an.rustfisher.com\")\nprintln(42)\n</code></pre></p>"},{"location":"kotlin/basic/basic-syntax/#_5","title":"\u65b9\u6cd5","text":"<p>\u4e0b\u9762\u662f\u4e00\u4e2a\u63a5\u53d72\u4e2aInt\u53c2\u6570\uff0c\u8fd4\u56deInt\u7684\u65b9\u6cd5\u3002 <pre><code>fun sum(a: Int, b: Int): Int {\n    return a + b\n}\n</code></pre></p> <p>\u65b9\u6cd5\u4e3b\u4f53\u53ef\u4ee5\u662f\u4e00\u4e2a\u8868\u8fbe\u5f0f\u3002\u5b83\u7684\u8fd4\u56de\u503c\u53ef\u4ee5\u88ab\u63a8\u65ad\u51fa\u6765\u3002 <pre><code>fun sum(a: Int, b: Int) = a + b\n</code></pre></p> <p>\u65b9\u6cd5\u53ef\u4ee5\u6ca1\u6709\u8fd4\u56de\u503c\uff0c\u6216\u8005\u8bf4\u662f\u8fd4\u56de\u4e00\u4e2a\u65e0\u610f\u4e49\u7684\u503c(Unit)\u3002 <pre><code>fun printSum(a: Int, b: Int): Unit {\n    println(\"sum of $a and $b is ${a + b}\")\n}\n</code></pre></p> <p><code>Unit</code>\u53ef\u4ee5\u5ffd\u7565\u4e0d\u5199\u3002 <pre><code>fun printSum(a: Int, b: Int) {\n    println(\"sum of $a and $b is ${a + b}\")\n}\n</code></pre></p> <p>\u66f4\u591a\u8bf7\u53c2\u8003\u65b9\u6cd5\u8bf4\u660e</p>"},{"location":"kotlin/basic/basic-syntax/#_6","title":"\u53d8\u91cf","text":"<p>\u53ea\u80fd\u8bfb\u7684\u53d8\u91cf\u9700\u8981\u7528\u5173\u952e\u5b57<code>val</code>\u3002\u5b83\u4eec\u53ea\u80fd\u88ab\u8d4b\u503c1\u6b21\u3002 <pre><code>val a: Int = 1 // \u76f4\u63a5\u8d4b\u503c\nval b = 2      // \u81ea\u52a8\u63a8\u6d4b\u51fa\u662fInt\u7c7b\u578b\nval c: Int     // \u5f53\u6ca1\u6709\u8d4b\u521d\u59cb\u503c\u65f6\uff0c\u9700\u8981\u58f0\u660e\u7c7b\u578bType required when no initializer is provided\nc = 3          // \u8fd9\u91cc\u662f\u63a8\u8fdf\u8d4b\u503c\n</code></pre></p> <p>\u53ef\u4ee5\u591a\u6b21\u8d4b\u503c\u7684\u53d8\u91cf\u7528\u5173\u952e\u5b57<code>var</code> <pre><code>var x = 5 // \u81ea\u52a8\u63a8\u6d4b\u51fa\u662fInt\u578b\nx += 1\n</code></pre></p> <p>\u53ef\u4ee5\u5728\u9876\u90e8\u58f0\u660e\u53d8\u91cf <pre><code>val PI = 3.14\nvar x = 0\n\nfun incrementX() { \n    x += 1\n}\n</code></pre></p>"},{"location":"kotlin/basic/basic-syntax/#_7","title":"\u521b\u5efa\u7c7b\u4e0e\u5b9e\u4f8b","text":"<p>\u5b9a\u4e49\u4e00\u4e2a\u7c7b\uff0c\u4f7f\u7528<code>class</code>\u5173\u952e\u5b57 <pre><code>class Fisher\n</code></pre></p> <p>\u7c7b\u7684\u5c5e\u6027\u53ef\u4ee5\u653e\u5728\u5b9a\u4e49\u4e2d\u6216\u8005\u7c7b\u91cc\u3002\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u7c7b<code>Rectangle</code>\uff0c\u63cf\u8ff0\u957f\u65b9\u5f62\u3002 <pre><code>class Rectangle(var height: Double, var length: Double) {\n    var perimeter = (height + length) * 2\n}\n</code></pre></p> <p>\u9ed8\u8ba4\u6784\u9020\u5668\u4e2d\u7684\u53d8\u91cf\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u3002\u8fd9\u91cc\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u9762\u79ef\u53d8\u91cf<code>perimeter</code> <pre><code>val rectangle = Rectangle(5.0, 2.0)\nprintln(\"The perimeter is ${rectangle.perimeter}\")\n</code></pre></p> <p>\u5bf9\u4e8ekotlin v.1.4.30\uff0c\u7c7b\u7684\u7ee7\u627f\u7528\u5192\u53f7<code>:</code>\u6765\u8868\u793a\u3002\u7c7b\u9ed8\u8ba4\u90fd\u662ffinal\u7684\uff0c\u4e0d\u53ef\u7ee7\u627f\u3002\u4e3a\u4e86\u7ee7\u627f\uff0c\u7528<code>open</code>\u8ba9\u8fd9\u4e2a\u7c7b\u80fd\u88ab\u7ee7\u627f\u3002 <pre><code>open class Shape\nclass Rectangle(var height: Double, var length: Double): Shape {\n    var perimeter = (height + length) * 2\n}\n</code></pre></p>"},{"location":"kotlin/basic/basic-syntax/#_8","title":"\u6ce8\u91ca","text":"<p>\u548c\u5176\u4ed6\u73b0\u4ee3\u7f16\u7a0b\u8bed\u8a00\u7c7b\u4f3c\uff0c\u7528<code>//</code>\u6216\u8005<code>/**/</code>\u6765\u6ce8\u91ca</p> <pre><code>// \u8fd9\u91cc\u662f\u6ce8\u91ca RustFisher\n</code></pre> <pre><code>/**\n * \u8fd9\u662f\u6ce8\u91ca\n */\n/* \u8fd9\u4e5f\u662f\u6ce8\u91ca */\n</code></pre>"},{"location":"kotlin/basic/basic-syntax/#string-tempplates","title":"\u5b57\u7b26\u4e32\u6a21\u7248(String tempplates)","text":"<p>\u76f4\u63a5\u4f7f\u7528\u53d8\u91cf\uff0c\u7528<code>$</code></p> <p>\u8981\u4f7f\u7528\u8868\u8fbe\u5f0f\uff0c\u9700\u8981\u7528\u5927\u62ec\u53f7<code>${}</code></p> <pre><code>var a = 1\n// \u7b80\u5355\u4f7f\u7528$\nval s1 = \"a is $a\" \n\na = 2\n// \u4f7f\u7528\u65b9\u6cd5\nval s2 = \"${s1.replace(\"is\", \"was\")}, but now is $a\"\n</code></pre>"},{"location":"kotlin/basic/basic-syntax/#_9","title":"\u6761\u4ef6\u8868\u8fbe\u5f0f","text":"<pre><code>fun getMax(a: Int, b: Int): Int {\n    if (a &gt; b) {\n        return a\n    } else {\n        return b\n    }\n}\n</code></pre> <p>Kotlin\u4e2d\uff0c<code>if</code>\u4e5f\u53ef\u4ee5\u5199\u6210\u4e00\u4e2a\u8868\u8fbe\u5f0f <pre><code>fun getMax(a: Int, b: Int) = if (a &gt; b) a else b\n</code></pre></p>"},{"location":"kotlin/basic/basic-syntax/#for","title":"for\u5faa\u73af","text":"<p>\u4f7f\u7528<code>in</code> <pre><code>val items = listOf(\"apple\", \"banana\", \"kiwifruit\")\nfor (item in items) {\n    println(item)\n}\n</code></pre></p> <p>\u4f7f\u7528\u4e0b\u6807 <pre><code>val items = listOf(\"apple\", \"banana\", \"kiwifruit\")\nfor (index in items.indices) {\n    println(\"item at $index is ${items[index]}\")\n}\n</code></pre></p> <pre><code>for (i in 1..3) {\n    println(i)\n}\nfor (i in 6 downTo 0 step 2) {\n    println(i)\n}\n</code></pre>"},{"location":"kotlin/basic/basic-syntax/#while","title":"while\u5faa\u73af","text":"<pre><code>val items = listOf(\"apple\", \"banana\", \"kiwifruit\")\nvar index = 0\nwhile (index &lt; items.size) {\n    println(\"item at $index is ${items[index]}\")\n    index++\n}\n</code></pre>"},{"location":"kotlin/basic/basic-syntax/#when","title":"when\u8868\u8fbe\u5f0f","text":"<p><code>when</code>\u770b\u8d77\u6765\u6709\u70b9\u50cfJava\u91cc\u7684<code>witch</code>\uff0c\u4f46\u8fd9\u4e24\u4e2a\u662f\u4e0d\u540c\u7684\u4e1c\u897f\u3002 <pre><code>fun describe(obj: Any): String =\n    when (obj) {\n        1          -&gt; \"One\"\n        \"Hello\"    -&gt; \"Greeting\"\n        is Long    -&gt; \"Long\"\n        !is String -&gt; \"Not a string\"\n        else       -&gt; \"Unknown\"\n    }\n</code></pre></p>"},{"location":"kotlin/basic/basic-syntax/#_10","title":"\u8303\u56f4","text":"<p>\u68c0\u67e5\u4e00\u4e2a\u6570\u5b57\u662f\u5426\u5728\u8303\u56f4\u4e2d\uff0c\u4f7f\u7528<code>in</code>\u64cd\u4f5c <pre><code>val x = 10\nval y = 9\nif (x in 1..y+1) {\n    println(\"\u5728\u8303\u56f4\u5185\")\n}\n</code></pre></p> <p>\u68c0\u67e5\u4e00\u4e2a\u6570\u662f\u5426\u8d85\u51fa\u4e86\u8303\u56f4 <pre><code>val list = listOf(\"a\", \"b\", \"c\")\n\nif (-1 !in 0..list.lastIndex) {\n    println(\"-1 \u8d85\u51fa\u4e86\u8303\u56f4\")\n}\nif (list.size !in list.indices) {\n    println(\"list\u7684size\u4e5f\u8d85\u51fa\u4e86\u4e0b\u6807\u8303\u56f4\")\n}\n</code></pre></p> <p>\u904d\u5386\u4e00\u4e2a\u8303\u56f4 <pre><code>for (x in 1..5) {\n    print(x)\n}\n</code></pre></p> <p>\u6307\u5b9a\u6b65\u8fdb\u503c <pre><code>for (x in 1..10 step 2) {\n    print(x)\n}\nprintln()\nfor (x in 9 downTo 0 step 3) {\n    print(x)\n}\n</code></pre></p>"},{"location":"kotlin/basic/basic-syntax/#_11","title":"\u96c6\u5408","text":"<p>\u904d\u5386\u4e00\u4e2a\u96c6\u5408 <pre><code>for (item in items) {\n    println(item)\n}\n</code></pre></p> <p>\u68c0\u67e5\u96c6\u5408\u4e2d\u662f\u5426\u5305\u542b\u67d0\u4e2a\u5bf9\u8c61\uff0c\u7528<code>in</code>\u64cd\u4f5c <pre><code>when {\n    \"orange\" in items -&gt; println(\"juicy\")\n    \"apple\" in items -&gt; println(\"apple is fine too\")\n}\n</code></pre></p> <p>\u7528lambda\u8868\u8fbe\u5f0f\u5bf9\u96c6\u5408\u8fdb\u884cfilter\u548cmap\u64cd\u4f5c <pre><code>val fruits = listOf(\"banana\", \"avocado\", \"apple\", \"kiwifruit\")\nfruits\n    .filter { it.startsWith(\"a\") }\n    .sortedBy { it }\n    .map { it.toUpperCase() }\n    .forEach { println(it) }\n</code></pre></p>"},{"location":"kotlin/basic/basic-syntax/#nullnull","title":"\u53ef\u4e3anull\u7684\u503c\u548cnull\u68c0\u67e5","text":"<p>\u53ef\u4ee5\u4e3anull\u7684\u53d8\u91cf\uff0c\u540e\u9762\u9700\u8981\u4e00\u4e2a\u95ee\u53f7<code>?</code></p> <p>\u4e0b\u9762\u8fd9\u4e2a\u65b9\u6cd5\u8fd4\u56deInt\u6216\u8005null <pre><code>fun parseInt(str: String): Int? {\n    // ...\n}\n</code></pre></p> <p>\u4f7f\u7528\u53ef\u80fd\u8fd4\u56denull\u7684\u65b9\u6cd5\uff08\u4e0a\u9762\u90a3\u4e2a\u65b9\u6cd5\uff09 <pre><code>fun printProduct(arg1: String, arg2: String) {\n    val x = parseInt(arg1)\n    val y = parseInt(arg2)\n\n    // Using `x * y` yields error because they may hold nulls.\n    if (x != null &amp;&amp; y != null) {\n        // x \u548c y \u7ecf\u8fc7null\u68c0\u6d4b\u540e\u81ea\u52a8\u53d8\u6210\u4e86\u975enull\u503c\n        println(x * y)\n    }\n    else {\n        println(\"'$arg1' or '$arg2' \u4e0d\u662f\u6570\u5b57\")\n    }    \n}\n</code></pre></p> <p>\u6216\u8005\u5199\u505a <pre><code>// ...\nif (x == null) {\n    println(\"\u53c2\u6570\u9519\u8bef arg1: '$arg1'\")\n    return\n}\nif (y == null) {\n    println(\"\u53c2\u6570\u9519\u8bef arg2: '$arg2'\")\n    return\n}\n\n// x \u548c y \u7ecf\u8fc7null\u68c0\u6d4b\u540e\u81ea\u52a8\u53d8\u6210\u4e86\u975enull\u503c\nprintln(x * y)\n</code></pre></p>"},{"location":"kotlin/basic/basic-syntax/#_12","title":"\u7c7b\u578b\u68c0\u67e5\u548c\u81ea\u52a8\u8f6c\u6362","text":"<p>\u7528<code>is</code>\u6765\u68c0\u67e5\u67d0\u4e2a\u5bf9\u8c61\u662f\u4e0d\u662f\u67d0\u4e2a\u7c7b\u578b\u3002 \u5982\u679c\u786e\u5b9a\u67d0\u4e2a\u4e0d\u53ef\u53d8\u7684\u53d8\u91cf\u7684\u7c7b\u578b\uff0c\u90a3\u540e\u9762\u4f7f\u7528\u5b83\u7684\u65f6\u5019\u4e0d\u7528\u518d\u663e\u5f0f\u8f6c\u6362 <pre><code>fun getStringLength(obj: Any): Int? {\n    if (obj is String) {\n        // obj\u5df2\u7ecf\u81ea\u52a8\u8f6c\u6362\u4e3aString\u7c7b\u578b\n        return obj.length\n    }\n\n    // \u8fd9\u91cc\u7684obj\u4ecd\u7136\u662fAny\u7c7b\u578b\n    return null\n}\n</code></pre></p> <p>\u6216\u8005\u7528<code>!is</code> <pre><code>fun getStringLength(obj: Any): Int? {\n    if (obj !is String) return null\n\n    // \u8fd9\u91cc\u7684obj\u5df2\u7ecf\u81ea\u52a8\u8f6c\u6362\u4e3aString\u7c7b\u578b\n    return obj.length\n}\n</code></pre></p> <p>\u518d\u6362\u4e2a\u5199\u6cd5 <pre><code>fun getStringLength(obj: Any): Int? {\n    // \u8fd9\u91cc\u9762\u7684obj\u5df2\u7ecf\u81ea\u52a8\u8f6c\u6362\u4e3aString\u7c7b\u578b\n    if (obj is String &amp;&amp; obj.length &gt; 0) {\n        return obj.length\n    }\n\n    return null\n}\n</code></pre></p>"},{"location":"kotlin/basic/functions/","title":"\u65b9\u6cd5fun","text":"\u66f4\u65b0\u65e5\u671f: 2021-10-29 <ul> <li>2021-10-29: \u65b0\u5efa\u6587\u6863</li> </ul> <p>\u672c\u6587\u4ecb\u7ecdKotlin\u65b9\u6cd5\u7684\u4f7f\u7528\uff0c\u65b9\u6cd5\u7684\u53c2\u6570\u548c\u8fd4\u56de\u503c\u3002</p> <p>\u58f0\u660e\u65b9\u6cd5\uff08\u51fd\u6570\uff09\u9700\u8981\u7528\u5230\u5173\u952e\u5b57<code>fun</code>\u3002\u58f0\u660e\u65b9\u6cd5\u7684\u8fd4\u56de\u7c7b\u578b\uff0c\u9700\u8981\u7528\u5192\u53f7<code>:</code>\u3002</p> <pre><code>fun double(x: Int): Int {\n    return 2 * x\n}\n</code></pre>"},{"location":"kotlin/basic/functions/#_1","title":"\u8fd4\u56de\u503c","text":""},{"location":"kotlin/basic/functions/#unit","title":"\u8fd4\u56de<code>Unit</code>","text":"<p>\u5148\u770b\u4e0b\u9762\u8fd9\u4e2a\u65b9\u6cd5\u3002\u63a5\u53d71\u4e2aString\u53c2\u6570\uff0c\u8fd4\u56de\u503c\u662f<code>Unit</code> <pre><code>fun printMessage(message: String): Unit {\n    println(message)\n}\n</code></pre></p> <p>\u67e5\u770b<code>Unit</code>\u7684\u6e90\u4ee3\u7801\u3002\u6211\u4eec\u5f97\u77e5<code>Unit</code>\u5bf9\u5e94\u7684\u662fJava\u4e2d\u7684<code>void</code>\u3002 <pre><code>package kotlin\n\n/**\n * The type with only one value: the `Unit` object. This type corresponds to the `void` type in Java.\n */\npublic object Unit {\n    override fun toString() = \"kotlin.Unit\"\n}\n</code></pre></p> <p>\u5982\u679c\u7701\u7565<code>Unit</code>\uff0c\u53ef\u4ee5\u5199\u6210\u4e0b\u9762\u8fd9\u6837 <pre><code>fun printMessage(message: String) {\n    println(message)\n}\n</code></pre></p>"},{"location":"kotlin/basic/functions/#_2","title":"\u8fd4\u56de\u7c7b\u578b","text":"<p>\u8fd4\u56de\u7c7b\u578b\u7531\u5192\u53f7:\u6307\u5b9a</p> <p><code>sum</code>\u65b9\u6cd5\u8fd4\u56deInt\u7c7b\u578b\u3002 <pre><code>fun sum(x: Int, y: Int): Int {\n    return x + y\n}\n</code></pre></p> <p>\u8fd4\u56de\u7c7b\u578b\u7684\u63a8\u65ad\u3002<code>multiply</code>\u65b9\u6cd5\u6ca1\u6709\u7528\u5192\u53f7\u58f0\u660e\u8fd4\u56de\u7c7b\u578b\u3002\u53c2\u6570\u662f2\u4e2aInt\uff0c\u8fd4\u56de\u7c7b\u578b\u4e5f\u662fInt\u3002 <pre><code>fun multiply(x: Int, y: Int) = x * y\n</code></pre></p> <p><code>multiply2</code>\u65b9\u6cd5x\u53c2\u6570\u662fFloat\uff0c\u63a8\u65ad\u51fa\u8fd4\u56de\u7684\u662fFloat\u3002 <pre><code>fun multiply2(x: Float, y: Int) = x * y\n</code></pre></p>"},{"location":"kotlin/basic/functions/#_3","title":"\u53c2\u6570\u4e0e\u9ed8\u8ba4\u503c","text":"<p>\u65b9\u6cd5\u7684\u53c2\u6570\u53ef\u4ee5\u5b9a\u4e49\u9ed8\u8ba4\u503c\u3002\u8fd9\u70b9\u548cPython\u7c7b\u4f3c\u3002 <pre><code>fun printMessageWithPrefix(message: String, prefix: String = \"Info\") {\n    println(\"[$prefix] $message\")\n}\n</code></pre> \u4e0a\u9762\u7684prefix\u9ed8\u8ba4\u503c\u4e3a\"Info\"\u3002</p>"},{"location":"kotlin/basic/functions/#_4","title":"\u65b9\u6cd5\u8c03\u7528","text":"<p>\u5728main\u51fd\u6570\u4e2d\u8c03\u7528\u4e0a\u9762\u63d0\u5230\u7684\u65b9\u6cd5\u3002 <pre><code>package com.rustfisher.ktpractice.intro\n\nfun printMessage(message: String): Unit {\n    println(message)\n}\n\nfun printMessageWithPrefix(message: String, prefix: String = \"Info\") {\n    println(\"[$prefix] $message\")\n}\n\nfun sum(x: Int, y: Int): Int {\n    return x + y\n}\n\nfun multiply(x: Int, y: Int) = x * y\n\nfun multiply2(x: Float, y: Int) = x * y\n\nfun main(args: Array&lt;String&gt;) {\n    printMessage(\"RustFisher\")\n    printMessageWithPrefix(\"Fisher\", \"Rust\")\n    printMessageWithPrefix(\"Rust\")\n    printMessageWithPrefix(prefix = \"Rust\", message = \"Fisher\")\n    println(sum(40, 2))\n    println(\"multiply\u8fd4\u56de\u7c7b\u578b ${multiply(2, 21).javaClass}\")\n    println(\"multiply2\u8fd4\u56de\u7c7b\u578b ${multiply2(2f, 21).javaClass}\")\n}\n</code></pre></p> <p>\u8f93\u51fa <pre><code>RustFisher\n[Rust] Fisher\n[Info] Rust\n[Rust] Fisher\n42\nmultiply\u8fd4\u56de\u7c7b\u578b int\nmultiply2\u8fd4\u56de\u7c7b\u578b float\n</code></pre></p>"},{"location":"kotlin/basic/idioms/","title":"\u5e38\u7528\u5199\u6cd5","text":"<p>\u672c\u6587\u7efc\u5408\u4e86\u4e00\u4e9bKotlin\u4e2d\u5e38\u89c1\u7684\u7528\u6cd5\u3002\u76f8\u5f53\u4e8e\u662f\u5c0f\u8d34\u58eb\u96c6\u5408\u3002\u6587\u4e2d\u7684\u4ee3\u7801\u5199\u6cd5\u4e0d\u4e00\u5b9a\u662f\u6700\u597d\u7684\u3002\u8bf7\u6839\u636e\u9879\u76ee\u5b9e\u9645\u9700\u8981\u6765\u4f7f\u7528\u3002</p>"},{"location":"kotlin/basic/idioms/#_1","title":"\u65b9\u6cd5\u53c2\u6570\u7684\u9ed8\u8ba4\u503c","text":"<p>\u53ef\u4ee5\u7ed9\u65b9\u6cd5\u7684\u53c2\u6570\u6307\u5b9a\u9ed8\u8ba4\u503c <pre><code>fun someFunction(a: Int = 0, b: String = \"\") { /* \u65b9\u6cd5\u5b9e\u73b0 */ }\n</code></pre></p>"},{"location":"kotlin/basic/idioms/#_2","title":"\u8fc7\u6ee4\u5217\u8868","text":"<p>\u627e\u51fa\u5217\u8868\u4e2d\u6ee1\u8db3\u67d0\u4e2a\u6761\u4ef6\u7684\u6240\u6709\u5143\u7d20\u3002\u4f7f\u7528<code>filter</code>\u65b9\u6cd5\u3002\u5176\u4e2dx\u662f\u81ea\u5df1\u5b9a\u4e49\u7684\u53c2\u6570\u540d\u3002 <pre><code>val list = Arrays.asList(1, 2, 3, 4, 5, 6, 7)\nval bigger = list.filter { x -&gt; x &gt; 5 }\nprintln(bigger) // [6, 7]\n</code></pre></p> <p>\u6216\u8005\u5728<code>filter</code>\u4e2d\u7528<code>it</code> <pre><code>val list = Arrays.asList(1, 2, 3, 4, 5, 6, 7)\nval bigger = list.filter { it &gt; 2 }\nprintln(bigger) // [3, 4, 5, 6, 7]\n</code></pre></p>"},{"location":"kotlin/basic/idioms/#_3","title":"\u68c0\u67e5\u67d0\u4e2a\u5143\u7d20\u662f\u5426\u5728\u96c6\u5408\u91cc","text":"<p>\u4f7f\u7528<code>in</code> <pre><code>val nameList = Arrays.asList(\"Tom\", \"Rust Fisher\", \"Jerry\")\nif (\"Rust Fisher\" in nameList) {\n    println(\"Rust Fisher\u5728\u5217\u8868\u4e2d\")\n}\nif (\"David\" !in nameList) {\n    println(\"David\u4e0d\u5728\u5217\u8868\u4e2d\")\n}\n</code></pre></p>"},{"location":"kotlin/basic/idioms/#string","title":"String\u63d2\u503c","text":"<p>\u7528<code>$</code>\u628aString\u53d8\u91cf\u63d2\u5165\u5b57\u7b26\u4e32\u91cc <pre><code>val firstName = \"Rust\"\nval lastName = \"Fisher\"\nprintln(\"$firstName $lastName\")\n</code></pre></p>"},{"location":"kotlin/basic/idioms/#_4","title":"\u53ea\u53ef\u8bfb\u7684\u5217\u8868","text":"<p>\u53ea\u80fd\u8bfb\uff0c\u4e0d\u80fd\u5199\u7684\u5217\u8868\u3002\u7528<code>listOf</code>\u65b9\u6cd5\u3002</p> <p><pre><code>val readOnlyList = listOf(\"a\", \"b\")\n</code></pre> \u4e0a\u9762\u5f97\u5230\u7684<code>readOnlyList</code>\u662f\u6ca1\u6709add\u76f8\u5173\u65b9\u6cd5\u7684\u3002</p>"},{"location":"kotlin/basic/idioms/#map","title":"\u53ea\u53ef\u8bfb\u7684map","text":"<p>\u4f7f\u7528<code>mapOf</code>\u65b9\u6cd5\u5f97\u5230\u53ea\u8bfb\u7684map\u3002 <pre><code>val map = mapOf(\"a\" to 1, \"b\" to 2, \"c\" to 3)\n</code></pre></p>"},{"location":"kotlin/basic/idioms/#while","title":"while\u5faa\u73af\u8bfb\u5199\u6d41","text":"<p>\u6d41\u8bfb\u5199\u7684\u65f6\u5019\uff0c\u6211\u4eec\u7ecf\u5e38\u4f7f\u7528while\u6765\u5904\u7406\u3002</p> <p>Java\u7c7b\u4f3c\u5982\u4e0b\u5199\u6cd5 <pre><code>int len = 0;\nwhile((len = inputStream.read(tmp)) != -1) { /* \u6d41\u64cd\u4f5c */ }\n</code></pre></p> <p>kotlin\u4e2d\uff0c\u4f7f\u7528<code>also</code> <pre><code>while (((inputStream.read(tmp)).also { len = it }) != -1) { /* \u6d41\u64cd\u4f5c */ }\n</code></pre></p>"},{"location":"kotlin/basic/kotlin-common-patterns-in-android/","title":"Android \u5f00\u53d1\u4e2d\u4f7f\u7528\u5e38\u89c1\u7684 Kotlin \u6a21\u5f0f","text":"\u66f4\u65b0\u65e5\u671f 2022-8-23 <ul> <li>2022-8-23 \u66f4\u65b0\u4ecb\u7ecd</li> </ul> <p>\u672c\u4e3b\u9898\u91cd\u70b9\u4ecb\u7ecd Kotlin \u8bed\u8a00\u5728 Android \u5f00\u53d1\u8fc7\u7a0b\u4e2d\u6700\u6709\u7528\u7684\u4e00\u4e9b\u65b9\u9762\u3002</p>"},{"location":"kotlin/basic/kotlin-common-patterns-in-android/#fragment","title":"\u4f7f\u7528 Fragment","text":"<p>\u4e0b\u9762\u51e0\u90e8\u5206\u4f7f\u7528 Fragment \u4f5c\u4e3a\u793a\u4f8b\u6765\u7a81\u51fa Kotlin \u7684\u4e00\u4e9b\u6700\u4f73\u529f\u80fd\u3002</p>"},{"location":"kotlin/basic/kotlin-common-patterns-in-android/#_1","title":"\u7ee7\u627f","text":"<p>\u60a8\u53ef\u4ee5\u4f7f\u7528 class \u5173\u952e\u5b57\u5728 Kotlin \u4e2d\u58f0\u660e\u7c7b\u3002\u5728\u4ee5\u4e0b\u793a\u4f8b\u4e2d\uff0cLoginFragment \u662f Fragment \u7684\u5b50\u7c7b\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u5728\u5b50\u7c7b\u4e0e\u5176\u7236\u7c7b\u4e4b\u95f4\u4f7f\u7528 : \u8fd0\u7b97\u7b26\u6765\u6307\u793a\u7ee7\u627f\uff1a <pre><code>class LoginFragment : Fragment()\n</code></pre></p> <p>\u5728\u6b64\u7c7b\u58f0\u660e\u4e2d\uff0cLoginFragment \u8d1f\u8d23\u8c03\u7528\u5176\u8d85\u7c7b Fragment \u7684\u6784\u9020\u51fd\u6570\u3002</p> <p>\u5728 LoginFragment \u4e2d\uff0c\u60a8\u53ef\u4ee5\u66ff\u6362\u8bb8\u591a\u751f\u547d\u5468\u671f\u56de\u8c03\u6765\u54cd\u5e94 Fragment \u4e2d\u7684\u72b6\u6001\u53d8\u5316\u3002\u8981\u66ff\u6362\u51fd\u6570\uff0c\u8bf7\u4f7f\u7528 override \u5173\u952e\u5b57\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a <pre><code>override fun onCreateView(\n            inflater: LayoutInflater,\n            container: ViewGroup?,\n            savedInstanceState: Bundle?\n    ): View? {\n        return inflater.inflate(R.layout.login_fragment, container, false)\n    }\n</code></pre></p> <p>\u8981\u5f15\u7528\u7236\u7c7b\u4e2d\u7684\u51fd\u6570\uff0c\u8bf7\u4f7f\u7528 super \u5173\u952e\u5b57\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a <pre><code>override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n        super.onViewCreated(view, savedInstanceState)\n    }\n</code></pre></p>"},{"location":"kotlin/basic/kotlin-common-patterns-in-android/#null","title":"\u53ef\u4e3a null \u6027\u548c\u521d\u59cb\u5316","text":"<p>\u5728\u524d\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u66ff\u6362\u65b9\u6cd5\u4e2d\u67d0\u4e9b\u53c2\u6570\u7684\u7c7b\u578b\u4ee5\u95ee\u53f7 <code>?</code> \u4e3a\u540e\u7f00\u3002\u8fd9\u8868\u793a\u4e3a\u8fd9\u4e9b\u53c2\u6570\u4f20\u9012\u7684\u5b9e\u9645\u53c2\u6570\u53ef\u4ee5\u4e3a null\u3002\u8bf7\u52a1\u5fc5\u5b89\u5168\u5730\u5904\u7406\u5176\u53ef\u4e3a null \u6027\u3002</p> <p>\u5728 Kotlin \u4e2d\uff0c\u60a8\u5fc5\u987b\u5728\u58f0\u660e\u5bf9\u8c61\u65f6\u521d\u59cb\u5316\u5bf9\u8c61\u7684\u5c5e\u6027\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5f53\u60a8\u83b7\u53d6\u7c7b\u7684\u5b9e\u4f8b\u65f6\uff0c\u53ef\u4ee5\u7acb\u5373\u5f15\u7528\u5b83\u7684\u4efb\u4f55\u53ef\u8bbf\u95ee\u5c5e\u6027\u3002\u4e0d\u8fc7\uff0c\u5728\u8c03\u7528 <code>Fragment#onCreateView</code> \u4e4b\u524d\uff0cFragment \u4e2d\u7684 View \u5bf9\u8c61\u5c1a\u672a\u51c6\u5907\u597d\u8fdb\u884c\u6269\u5145\uff0c\u6240\u4ee5\u60a8\u9700\u8981\u4e00\u79cd\u65b9\u6cd5\u6765\u63a8\u8fdf View \u7684\u5c5e\u6027\u521d\u59cb\u5316\u3002</p> <p>\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>lateinit</code> \u63a8\u8fdf\u5c5e\u6027\u521d\u59cb\u5316\u3002\u4f7f\u7528 <code>lateinit</code> \u65f6\uff0c\u60a8\u5e94\u5c3d\u5feb\u521d\u59cb\u5316\u5c5e\u6027\u3002</p> <p>\u4ee5\u4e0b\u793a\u4f8b\u6f14\u793a\u4e86\u5982\u4f55\u4f7f\u7528 <code>lateinit</code> \u5728 <code>onViewCreated</code> \u4e2d\u5206\u914d View \u5bf9\u8c61\uff1a <pre><code>class LoginFragment : Fragment() {\n\n    private lateinit var usernameEditText: EditText\n    private lateinit var passwordEditText: EditText\n    private lateinit var loginButton: Button\n    private lateinit var statusTextView: TextView\n\n    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n        super.onViewCreated(view, savedInstanceState)\n\n        usernameEditText = view.findViewById(R.id.username_edit_text)\n        passwordEditText = view.findViewById(R.id.password_edit_text)\n        loginButton = view.findViewById(R.id.login_button)\n        statusTextView = view.findViewById(R.id.status_text_view)\n    }\n    // ...\n}\n</code></pre></p> <p>\u6ce8\u610f\uff1a\u5982\u679c\u60a8\u5728\u521d\u59cb\u5316\u5c5e\u6027\u4e4b\u524d\u5bf9\u5176\u8fdb\u884c\u8bbf\u95ee\uff0cKotlin \u4f1a\u629b\u51fa UninitializedPropertyAccessException\u3002</p>"},{"location":"kotlin/basic/kotlin-common-patterns-in-android/#sam","title":"SAM \u8f6c\u6362","text":"<p>\u60a8\u53ef\u4ee5\u901a\u8fc7\u5b9e\u73b0 <code>OnClickListener</code> \u63a5\u53e3\u6765\u76d1\u542c Android \u4e2d\u7684\u70b9\u51fb\u4e8b\u4ef6\u3002Button \u5bf9\u8c61\u5305\u542b\u4e00\u4e2a <code>setOnClickListener()</code> \u51fd\u6570\uff0c\u8be5\u51fd\u6570\u63a5\u53d7 <code>OnClickListener</code> \u7684\u5b9e\u73b0\u3002</p> <p><code>OnClickListener</code> \u5177\u6709\u5355\u4e00\u62bd\u8c61\u65b9\u6cd5 <code>onClick()</code>\uff0c\u60a8\u5fc5\u987b\u5b9e\u73b0\u8be5\u65b9\u6cd5\u3002\u56e0\u4e3a <code>setOnClickListener()</code> \u59cb\u7ec8\u5c06 <code>OnClickListener</code> \u5f53\u4f5c\u53c2\u6570\uff0c\u53c8\u56e0\u4e3a <code>OnClickListener</code> \u59cb\u7ec8\u90fd\u6709\u76f8\u540c\u7684\u5355\u4e00\u62bd\u8c61\u65b9\u6cd5\uff0c\u6240\u4ee5\u6b64\u5b9e\u73b0\u5728 Kotlin \u4e2d\u53ef\u4ee5\u4f7f\u7528\u533f\u540d\u51fd\u6570\u6765\u8868\u793a\u3002\u6b64\u8fc7\u7a0b\u79f0\u4e3a\u5355\u4e00\u62bd\u8c61\u65b9\u6cd5\u8f6c\u6362\u6216 SAM \u8f6c\u6362\u3002</p> <p>SAM \u8f6c\u6362\u53ef\u4f7f\u4ee3\u7801\u660e\u663e\u53d8\u5f97\u66f4\u7b80\u6d01\u3002\u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u7528 SAM \u8f6c\u6362\u6765\u4e3a Button \u5b9e\u73b0 <code>OnClickListener</code>\uff1a <pre><code>loginButton.setOnClickListener {\n    val authSuccessful: Boolean = viewModel.authenticate(\n            usernameEditText.text.toString(),\n            passwordEditText.text.toString()\n    )\n    if (authSuccessful) {\n        // Navigate to next screen\n    } else {\n        statusTextView.text = requireContext().getString(R.string.auth_failed)\n    }\n}\n</code></pre></p> <p>\u5f53\u7528\u6237\u70b9\u51fb loginButton \u65f6\uff0c\u4f1a\u6267\u884c\u4f20\u9012\u7ed9 <code>setOnClickListener()</code> \u7684\u533f\u540d\u51fd\u6570\u4e2d\u7684\u4ee3\u7801\u3002</p> <p>\u70b9\u51fb\u56de\u8c03\u65b9\u6cd5\u662f<code>OnClickListener.onClick(View view)</code>\uff0c\u5b83\u6709\u4e00\u4e2a\u53c2\u6570View\u3002 \u800c\u6211\u4eec\u4f7f\u7528Kotlin\u65f6\uff0c\u53ef\u4ee5\u7528\u5b83\u9ed8\u8ba4\u7684\u53c2\u6570\u540d<code>it</code>\u3002 <pre><code>tv1 = view.findViewById(R.id.tv1)\ntv1.setOnClickListener {\n    Log.d(lt, \"click \" + it)\n}\n</code></pre></p>"},{"location":"kotlin/basic/kotlin-common-patterns-in-android/#_2","title":"\u4f34\u751f\u5bf9\u8c61","text":"<p>\u4f34\u751f\u5bf9\u8c61\u63d0\u4f9b\u4e86\u4e00\u79cd\u673a\u5236\uff0c\u7528\u4e8e\u5b9a\u4e49\u5728\u6982\u5ff5\u4e0a\u4e0e\u67d0\u4e2a\u7c7b\u578b\u76f8\u5173\u4f46\u4e0d\u4e0e\u67d0\u4e2a\u7279\u5b9a\u5bf9\u8c61\u5173\u8054\u7684\u53d8\u91cf\u6216\u51fd\u6570\u3002\u4f34\u751f\u5bf9\u8c61\u7c7b\u4f3c\u4e8e\u5bf9\u53d8\u91cf\u548c\u65b9\u6cd5\u4f7f\u7528 Java \u7684 <code>static</code> \u5173\u952e\u5b57\u3002</p> <p>\u5728\u4ee5\u4e0b\u793a\u4f8b\u4e2d\uff0cTAG \u662f\u4e00\u4e2a String \u5e38\u91cf\u3002\u60a8\u4e0d\u9700\u8981\u4e3a\u6bcf\u4e2a <code>KotlinGuideFragment</code> \u5b9e\u4f8b\u5b9a\u4e49\u4e00\u4e2a\u552f\u4e00\u7684 String \u5b9e\u4f8b\uff0c\u56e0\u6b64\u60a8\u5e94\u5728\u4f34\u751f\u5bf9\u8c61\u4e2d\u5b9a\u4e49\u5b83\uff1a <pre><code>class KotlinGuideFragment : Fragment() {\n    // ...\n    companion object {\n        fun newInstance() = KotlinGuideFragment()\n        private const val TAG = \"rustApp\"\n    }\n}\n</code></pre></p> <p>\u60a8\u53ef\u4ee5\u5728\u6587\u4ef6\u7684\u9876\u7ea7\u5b9a\u4e49 TAG\uff0c\u4f46\u6587\u4ef6\u4e2d\u53ef\u80fd\u6709\u5927\u91cf\u7684\u53d8\u91cf\u3001\u51fd\u6570\u548c\u7c7b\u4e5f\u662f\u5728\u9876\u7ea7\u5b9a\u4e49\u7684\u3002\u4f34\u751f\u5bf9\u8c61\u6709\u52a9\u4e8e\u8fde\u63a5\u53d8\u91cf\u3001\u51fd\u6570\u548c\u7c7b\u5b9a\u4e49\uff0c\u800c\u65e0\u9700\u5f15\u7528\u8be5\u7c7b\u7684\u4efb\u4f55\u7279\u5b9a\u5b9e\u4f8b\u3002</p>"},{"location":"kotlin/basic/kotlin-common-patterns-in-android/#_3","title":"\u5c5e\u6027\u59d4\u6258","text":"<p>\u521d\u59cb\u5316\u5c5e\u6027\u65f6\uff0c\u60a8\u53ef\u80fd\u4f1a\u91cd\u590d Android \u7684\u4e00\u4e9b\u6bd4\u8f83\u5e38\u89c1\u7684\u6a21\u5f0f\uff0c\u5982\u5728 Fragment \u4e2d\u8bbf\u95ee ViewModel\u3002\u4e3a\u907f\u514d\u8fc7\u591a\u7684\u91cd\u590d\u4ee3\u7801\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 Kotlin \u7684\u5c5e\u6027\u59d4\u6258\u8bed\u6cd5\u3002 <pre><code>private val viewModel: LoginViewModel by viewModels()\n</code></pre></p> <p>\u5c5e\u6027\u59d4\u6258\u63d0\u4f9b\u4e86\u4e00\u79cd\u53ef\u5728\u60a8\u7684\u6574\u4e2a\u5e94\u7528\u4e2d\u91cd\u590d\u4f7f\u7528\u7684\u901a\u7528\u5b9e\u73b0\u3002Android KTX \u4e3a\u60a8\u63d0\u4f9b\u4e86\u4e00\u4e9b\u5c5e\u6027\u59d4\u6258\u3002\u4f8b\u5982\uff0cviewModels \u53ef\u68c0\u7d22\u8303\u56f4\u9650\u5b9a\u4e3a\u5f53\u524d Fragment \u7684 ViewModel\u3002</p> <p>\u5c5e\u6027\u59d4\u6258\u4f7f\u7528\u53cd\u5c04\uff0c\u8fd9\u6837\u4f1a\u589e\u52a0\u4e00\u4e9b\u6027\u80fd\u5f00\u9500\u3002\u8fd9\u79cd\u4ee3\u4ef7\u6362\u6765\u7684\u662f\u7b80\u6d01\u7684\u8bed\u6cd5\uff0c\u53ef\u8ba9\u60a8\u8282\u7701\u5f00\u53d1\u65f6\u95f4\u3002</p>"},{"location":"kotlin/basic/kotlin-common-patterns-in-android/#null_1","title":"\u53ef\u4e3a null \u6027","text":"<p>Kotlin \u63d0\u4f9b\u4e86\u4e25\u683c\u7684\u53ef\u4e3a null \u6027\u89c4\u5219\uff0c\u53ef\u5728\u60a8\u7684\u6574\u4e2a\u5e94\u7528\u4e2d\u7ef4\u62a4\u7c7b\u578b\u5b89\u5168\u3002\u5728 Kotlin \u4e2d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5bf9\u5bf9\u8c61\u7684\u5f15\u7528\u4e0d\u80fd\u5305\u542b null \u503c\u3002\u8981\u4e3a\u53d8\u91cf\u8d4b\u4e88 null \u503c\uff0c\u60a8\u5fc5\u987b\u901a\u8fc7\u5c06 ? \u6dfb\u52a0\u5230\u57fa\u672c\u7c7b\u578b\u7684\u672b\u5c3e\u6765\u58f0\u660e\u53ef\u4e3a null \u53d8\u91cf\u7c7b\u578b\u3002</p> <p>\u4e3e\u4f8b\u6765\u8bf4\uff0c\u4ee5\u4e0b\u8868\u8fbe\u5f0f\u5728 Kotlin \u4e2d\u662f\u8fdd\u53cd\u89c4\u5219\u7684\u3002name \u7684\u7c7b\u578b\u4e3a String\uff0c\u4e0d\u53ef\u4e3a null\uff1a <pre><code>val name: String = null\n</code></pre></p> <p>\u8981\u5141\u8bb8 null \u503c\uff0c\u60a8\u5fc5\u987b\u4f7f\u7528\u53ef\u4e3a null String \u7c7b\u578b String?\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a <pre><code>val name: String? = null\n</code></pre></p>"},{"location":"kotlin/basic/kotlin-common-patterns-in-android/#_4","title":"\u4e92\u64cd\u4f5c\u6027","text":"<p>Kotlin \u7684\u4e25\u683c\u89c4\u5219\u53ef\u4f7f\u4ee3\u7801\u66f4\u5b89\u5168\u4e14\u66f4\u7b80\u6d01\u3002\u8fd9\u4e9b\u89c4\u5219\u53ef\u964d\u4f4e\u4f1a\u5bfc\u81f4\u5e94\u7528\u5d29\u6e83\u7684 NullPointerException \u51fa\u73b0\u7684\u51e0\u7387\u3002\u6b64\u5916\uff0c\u5b83\u4eec\u8fd8\u53ef\u51cf\u5c11\u60a8\u9700\u8981\u5728\u4ee3\u7801\u4e2d\u8fdb\u884c\u7684 null \u68c0\u67e5\u7684\u6b21\u6570\u3002</p> <p>\u901a\u5e38\uff0c\u5728\u7f16\u5199 Android \u5e94\u7528\u65f6\uff0c\u60a8\u8fd8\u5fc5\u987b\u8c03\u7528\u975e Kotlin \u4ee3\u7801\uff0c\u56e0\u4e3a\u5927\u591a\u6570 Android API \u90fd\u662f\u7528 Java \u7f16\u7a0b\u8bed\u8a00\u7f16\u5199\u7684\u3002</p> <p>\u53ef\u4e3a null \u6027\u662f Java \u548c Kotlin \u5728\u884c\u4e3a\u4e0a\u6709\u6240\u4e0d\u540c\u7684\u4e00\u4e2a\u4e3b\u8981\u65b9\u9762\u3002Java \u5bf9\u53ef\u4e3a null \u6027\u8bed\u6cd5\u7684\u8981\u6c42\u4e0d\u90a3\u4e48\u4e25\u683c\u3002</p> <p>\u4e3e\u4f8b\u6765\u8bf4\uff0c<code>Account</code> \u7c7b\u5177\u6709\u4e00\u4e9b\u5c5e\u6027\uff0c\u5305\u62ec\u4e00\u4e2a\u540d\u4e3a name \u7684 String \u5c5e\u6027\u3002Kotlin \u5236\u5b9a\u4e86\u4e0e\u53ef\u4e3a null \u6027\u6709\u5173\u7684\u89c4\u5219\uff0cJava \u6ca1\u6709\u5236\u5b9a\u8fd9\u6837\u7684\u89c4\u5219\uff0c\u800c\u662f\u4f9d\u8d56\u4e8e\u53ef\u9009\u7684\u53ef\u4e3a null \u6027\u6ce8\u89e3\u6765\u660e\u786e\u58f0\u660e\u60a8\u662f\u5426\u53ef\u4ee5\u8d4b\u4e88 null \u503c\u3002</p> <p>\u7531\u4e8e Android \u6846\u67b6\u4e3b\u8981\u662f\u7528 Java \u7f16\u5199\u7684\uff0c\u56e0\u6b64\u5728\u8c03\u7528\u6ca1\u6709\u53ef\u4e3a null \u6027\u6ce8\u89e3\u7684 API \u65f6\uff0c\u60a8\u53ef\u80fd\u4f1a\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\u3002</p>"},{"location":"kotlin/basic/kotlin-common-patterns-in-android/#_5","title":"\u5e73\u53f0\u7c7b\u578b","text":"<p>\u5982\u679c\u60a8\u4f7f\u7528 Kotlin \u5f15\u7528\u5728 Java Account \u7c7b\u4e2d\u5b9a\u4e49\u7684\u4e0d\u5e26\u6ce8\u89e3\u7684 name \u6210\u5458\uff0c\u7f16\u8bd1\u5668\u5c06\u4e0d\u77e5\u9053 <code>String</code> \u6620\u5c04\u5230 Kotlin \u4e2d\u7684 <code>String</code> \u8fd8\u662f <code>String?</code>\u3002\u8fd9\u79cd\u4e0d\u660e\u786e\u901a\u8fc7\u5e73\u53f0\u7c7b\u578b <code>String!</code> \u6765\u8868\u793a\u3002</p> <p><code>String!</code> \u5bf9 Kotlin \u7f16\u8bd1\u5668\u6765\u8bf4\u6ca1\u6709\u7279\u6b8a\u7684\u542b\u4e49\u3002<code>String!</code>\u53ef\u4ee5\u8868\u793a <code>String</code> \u6216 <code>String?</code>\uff0c\u7f16\u8bd1\u5668\u53ef\u8ba9\u60a8\u8d4b\u4e88\u4efb\u4e00\u7c7b\u578b\u7684\u503c\u3002\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u60a8\u5c06\u7c7b\u578b\u8868\u793a\u4e3a <code>String</code> \u5e76\u8d4b\u4e88 null \u503c\uff0c\u5219\u7cfb\u7edf\u53ef\u80fd\u4f1a\u629b\u51fa NullPointerException\u3002</p> <p>\u8981\u89e3\u51b3\u6b64\u95ee\u9898\uff0c\u6bcf\u5f53\u60a8\u7528 Java \u7f16\u5199\u4ee3\u7801\u65f6\uff0c\u90fd\u5e94\u4f7f\u7528\u53ef\u4e3a null \u6027\u6ce8\u89e3\u3002\u8fd9\u4e9b\u6ce8\u89e3\u5bf9 Java \u548c Kotlin \u5f00\u53d1\u8005\u90fd\u6709\u5e2e\u52a9\u3002</p> <p>\u4f8b\u5982\uff0c\u4e0b\u9762\u662f\u5728 Java \u4e2d\u5b9a\u4e49\u7684 <code>Account</code> \u7c7b\uff1a <pre><code>public class Account implements Parcelable {\n    public final String name;\n    public final String type;\n    private final @Nullable String accessId;\n\n    // ...\n}\n</code></pre></p> <p>\u5176\u4e2d\u4e00\u4e2a\u6210\u5458\u53d8\u91cf <code>accessId</code> \u5e26\u6709 <code>@Nullable</code> \u6ce8\u89e3\uff0c\u8fd9\u8868\u793a\u5b83\u53ef\u4ee5\u6301\u6709 null \u503c\u3002\u4e8e\u662f\uff0cKotlin \u4f1a\u5c06 accessId \u89c6\u4e3a <code>String?</code>\u3002</p> <p>\u8981\u6307\u660e\u53d8\u91cf\u7edd\u4e0d\u80fd\u4e3a null\uff0c\u8bf7\u4f7f\u7528 <code>@NonNull</code> \u6ce8\u89e3\uff1a <pre><code>public class Account implements Parcelable {\n        public final @NonNull String name;\n        ...\n    }\n</code></pre></p> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cname \u5728 Kotlin \u4e2d\u88ab\u89c6\u4e3a\u4e0d\u53ef\u4e3a null String\u3002</p> <p>\u53ef\u4e3a null \u6027\u6ce8\u89e3\u5305\u542b\u5728\u6240\u6709\u65b0\u589e\u7684 Android API \u4ee5\u53ca\u8bb8\u591a\u73b0\u6709\u7684 Android API \u4e2d\u3002\u8bb8\u591a Java \u5e93\u5df2\u6dfb\u52a0\u53ef\u4e3a null \u6027\u6ce8\u89e3\uff0c\u4ee5\u4fbf\u4e3a Kotlin \u548c Java \u5f00\u53d1\u8005\u63d0\u4f9b\u66f4\u597d\u7684\u652f\u6301\u3002</p>"},{"location":"kotlin/basic/kotlin-common-patterns-in-android/#null_2","title":"\u5904\u7406\u53ef\u4e3a null \u6027","text":"<p>\u5982\u679c\u60a8\u4e0d\u786e\u5b9a Java \u7c7b\u578b\uff0c\u5219\u5e94\u5c06\u5176\u89c6\u4e3a\u53ef\u4e3a null\u3002\u4e3e\u4f8b\u6765\u8bf4\uff0cAccount \u7c7b\u7684 name \u6210\u5458\u4e0d\u5e26\u6ce8\u89e3\uff0c\u56e0\u6b64\u60a8\u5e94\u5047\u5b9a\u5b83\u662f\u4e00\u4e2a\u53ef\u4e3a null String\u3002</p> <p>\u5982\u679c\u60a8\u8981\u4fee\u526a name \u4ee5\u4f7f\u5176\u503c\u4e0d\u5305\u542b\u524d\u5bfc\u6216\u5c3e\u968f\u7a7a\u683c\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 Kotlin \u7684 trim \u51fd\u6570\u3002\u60a8\u53ef\u4ee5\u901a\u8fc7\u51e0\u79cd\u4e0d\u540c\u7684\u65b9\u5f0f\u5b89\u5168\u5730\u4fee\u526a String?\u3002\u5176\u4e2d\u4e00\u79cd\u65b9\u5f0f\u662f\u4f7f\u7528\u975e null \u65ad\u8a00\u8fd0\u7b97\u7b26 <code>!!</code>\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a <pre><code>val account = Account(\"name\", \"type\")\nval accountName = account.name!!.trim()\n</code></pre></p> <p><code>!!</code>\u8fd0\u7b97\u7b26\u5c06\u5176\u5de6\u4fa7\u7684\u6240\u6709\u5185\u5bb9\u89c6\u4e3a\u975e null\uff0c\u56e0\u6b64\uff0c\u5728\u672c\u4f8b\u4e2d\uff0c\u60a8\u5c06 name \u89c6\u4e3a\u975e null String\u3002 \u5982\u679c\u5b83\u5de6\u4fa7\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u4e3a null\uff0c\u5219\u60a8\u7684\u5e94\u7528\u4f1a\u629b\u51fa NullPointerException\u3002 \u6b64\u8fd0\u7b97\u7b26\u7b80\u5355\u5feb\u6377\uff0c\u4f46\u5e94\u8c28\u614e\u4f7f\u7528\uff0c\u56e0\u4e3a\u5b83\u4f1a\u5c06 NullPointerException \u7684\u5b9e\u4f8b\u91cd\u65b0\u5f15\u5165\u60a8\u7684\u4ee3\u7801\u3002</p> <p>\u66f4\u5b89\u5168\u7684\u9009\u62e9\u662f\u4f7f\u7528\u5b89\u5168\u8c03\u7528\u8fd0\u7b97\u7b26 <code>?.</code>\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a <pre><code>val account = Account(\"name\", \"type\")\nval accountName = account.name?.trim()\n</code></pre></p> <p>\u4f7f\u7528\u5b89\u5168\u8c03\u7528\u8fd0\u7b97\u7b26\u65f6\uff0c\u5982\u679c name \u4e0d\u4e3a null\uff0c\u5219 <code>name?.trim()</code> \u7684\u7ed3\u679c\u662f\u4e00\u4e2a\u4e0d\u5e26\u524d\u5bfc\u6216\u5c3e\u968f\u7a7a\u683c\u7684\u540d\u79f0\u503c\u3002\u5982\u679c name \u4e3a null\uff0c\u5219 <code>name?.trim()</code> \u7684\u7ed3\u679c\u4e3a null\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5728\u6267\u884c\u6b64\u8bed\u53e5\u65f6\uff0c\u60a8\u7684\u5e94\u7528\u6c38\u8fdc\u4e0d\u4f1a\u629b\u51fa NullPointerException\u3002</p> <p>\u867d\u7136\u5b89\u5168\u8c03\u7528\u8fd0\u7b97\u7b26\u53ef\u4f7f\u60a8\u907f\u514d\u6f5c\u5728\u7684 NullPointerException\uff0c\u4f46\u5b83\u4f1a\u5c06 null \u503c\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u8bed\u53e5\u3002\u60a8\u53ef\u4ee5\u4f7f\u7528 Elvis \u8fd0\u7b97\u7b26 (<code>?:</code>) \u6765\u7d27\u63a5\u7740\u5904\u7406 null \u503c\u7684\u60c5\u51b5\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a <pre><code>val account = Account(\"name\", \"type\")\nval accountName = account.name?.trim() ?: \"Default name\"\n</code></pre></p> <p>\u5982\u679c Elvis \u8fd0\u7b97\u7b26\u5de6\u4fa7\u8868\u8fbe\u5f0f\u7684\u7ed3\u679c\u4e3a null\uff0c\u5219\u4f1a\u5c06\u53f3\u4fa7\u7684\u503c\u8d4b\u4e88 <code>accountName</code>\u3002\u6b64\u65b9\u6cd5\u5bf9\u4e8e\u63d0\u4f9b\u672c\u6765\u4e3a null \u7684\u9ed8\u8ba4\u503c\u5f88\u6709\u7528\u3002</p> <p>\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528 Elvis \u8fd0\u7b97\u7b26\u63d0\u524d\u4ece\u51fd\u6570\u8fd4\u56de\u7ed3\u679c\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a <pre><code>fun validateAccount(account: Account?) {\n    val accountName = account?.name?.trim() ?: \"Default name\"\n\n    // account cannot be null beyond this point\n    account ?: return\n    // ...\n}\n</code></pre></p>"},{"location":"kotlin/basic/kotlin-common-patterns-in-android/#android-api","title":"Android API \u53d8\u66f4","text":"<p>Android API \u53d8\u5f97\u8d8a\u6765\u8d8a\u652f\u6301 Kotlin\u3002Android \u7684\u8bb8\u591a\u6700\u5e38\u89c1\u7684 API\uff08\u5305\u62ec AppCompatActivity \u548c Fragment\uff09\u5305\u542b\u53ef\u4e3a null \u6027\u6ce8\u89e3\uff0c\u5e76\u4e14\u67d0\u4e9b\u8c03\u7528\uff08\u5982 <code>Fragment#getContext</code>\uff09\u5177\u6709\u66f4\u652f\u6301 Kotlin \u7684\u66ff\u4ee3\u8c03\u7528\u3002</p> <p>\u4f8b\u5982\uff0c\u8bbf\u95ee Fragment \u7684 Context \u51e0\u4e4e\u603b\u662f\u4e0d\u4e3a null\uff0c\u56e0\u4e3a\u60a8\u5728 Fragment \u4e2d\u8fdb\u884c\u7684\u5927\u591a\u6570\u8c03\u7528\u90fd\u662f\u5728 Fragment \u9644\u52a0\u5230 Activity\uff08Context \u7684\u5b50\u7c7b\uff09\u65f6\u53d1\u751f\u7684\u3002\u5373\u4fbf\u5982\u6b64\uff0c<code>Fragment#getContext</code> \u5e76\u4e0d\u603b\u662f\u8fd4\u56de\u975e null \u503c\uff0c\u56e0\u4e3a\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b Fragment \u672a\u9644\u52a0\u5230 Activity\u3002\u56e0\u6b64\uff0c<code>Fragment#getContext</code> \u7684\u8fd4\u56de\u7c7b\u578b\u53ef\u4e3a null\u3002</p> <p>\u7531\u4e8e\u4ece <code>Fragment#getContext</code> \u8fd4\u56de\u7684 Context \u53ef\u4e3a null\uff08\u5e76\u4e14\u5e26\u6709 <code>@Nullable</code> \u6ce8\u89e3\uff09\uff0c\u56e0\u6b64\u60a8\u5fc5\u987b\u5728 Kotlin \u4ee3\u7801\u4e2d\u5c06\u5176\u89c6\u4e3a <code>Context?</code>\u3002\u8fd9\u610f\u5473\u7740\uff0c\u5728\u8bbf\u95ee\u5176\u5c5e\u6027\u548c\u51fd\u6570\u4e4b\u524d\uff0c\u9700\u8981\u5e94\u7528\u524d\u9762\u63d0\u5230\u7684\u67d0\u4e2a\u8fd0\u7b97\u7b26\u6765\u5904\u7406\u53ef\u4e3a null \u6027\u95ee\u9898\u3002 \u5bf9\u4e8e\u4e00\u4e9b\u8fd9\u6837\u7684\u60c5\u51b5\uff0cAndroid \u5305\u542b\u53ef\u63d0\u4f9b\u8fd9\u79cd\u4fbf\u5229\u7684\u66ff\u4ee3 API\u3002\u4f8b\u5982\uff0c<code>Fragment#requireContext</code> \u4f1a\u8fd4\u56de\u975e null Context\uff0c\u5982\u679c\u5728 Context \u5c06\u4e3a null \u65f6\u8c03\u7528\u5b83\uff0c\u5219\u4f1a\u629b\u51fa IllegalStateException\u3002\u8fd9\u6837\uff0c\u60a8\u5c31\u53ef\u4ee5\u5c06\u751f\u6210\u7684 Context \u89c6\u4e3a\u975e null \u503c\uff0c\u800c\u65e0\u9700\u4f7f\u7528\u5b89\u5168\u8c03\u7528\u8fd0\u7b97\u7b26\u6216\u5176\u4ed6\u89e3\u51b3\u65b9\u6cd5\u3002</p>"},{"location":"kotlin/basic/kotlin-common-patterns-in-android/#_6","title":"\u5c5e\u6027\u521d\u59cb\u5316","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cKotlin \u4e2d\u7684\u5c5e\u6027\u5e76\u672a\u521d\u59cb\u5316\u3002\u5f53\u521d\u59cb\u5316\u5c5e\u6027\u7684\u5c01\u95ed\u7c7b\u65f6\uff0c\u5fc5\u987b\u521d\u59cb\u5316\u5c5e\u6027\u3002</p> <p>\u60a8\u53ef\u4ee5\u901a\u8fc7\u51e0\u79cd\u4e0d\u540c\u7684\u65b9\u5f0f\u6765\u521d\u59cb\u5316\u5c5e\u6027\u3002\u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u901a\u8fc7\u5728\u7c7b\u58f0\u660e\u4e2d\u4e3a index \u53d8\u91cf\u8d4b\u503c\u6765\u521d\u59cb\u5316\u8be5\u53d8\u91cf\uff1a <pre><code>class LoginFragment : Fragment() {\n    val index: Int = 12\n}\n</code></pre></p> <p>\u6b64\u521d\u59cb\u5316\u4e5f\u53ef\u4ee5\u5728\u521d\u59cb\u5316\u5f0f\u5757\u4e2d\u8fdb\u884c\u5b9a\u4e49\uff1a <pre><code>class LoginFragment : Fragment() {\n    val index: Int\n\n    init {\n        index = 12\n    }\n}\n</code></pre></p> <p>\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u5728\u6784\u5efa LoginFragment \u65f6\u521d\u59cb\u5316 index\u3002</p> <p>\u4e0d\u8fc7\uff0c\u67d0\u4e9b\u5c5e\u6027\u53ef\u80fd\u65e0\u6cd5\u5728\u5bf9\u8c61\u6784\u5efa\u671f\u95f4\u8fdb\u884c\u521d\u59cb\u5316\u3002\u4f8b\u5982\uff0c\u60a8\u53ef\u80fd\u8981\u4ece Fragment \u4e2d\u5f15\u7528 View\uff0c\u8fd9\u610f\u5473\u7740\uff0c\u5fc5\u987b\u5148\u6269\u5145\u5e03\u5c40\u3002\u6784\u5efa Fragment \u65f6\u4e0d\u4f1a\u53d1\u751f\u6269\u5145\uff0c\u800c\u662f\u5728\u8c03\u7528 <code>Fragment#onCreateView</code> \u65f6\u8fdb\u884c\u6269\u5145\u3002</p> <p>\u5e94\u5bf9\u8fd9\u79cd\u60c5\u51b5\u7684\u4e00\u79cd\u65b9\u6cd5\u662f\u5c06\u89c6\u56fe\u58f0\u660e\u4e3a\u53ef\u4e3a null \u5e76\u5c3d\u5feb\u5bf9\u5176\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a <pre><code>class LoginFragment : Fragment() {\n        private var statusTextView: TextView? = null\n\n        override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n                super.onViewCreated(view, savedInstanceState)\n\n                statusTextView = view.findViewById(R.id.status_text_view)\n                statusTextView?.setText(R.string.auth_failed)\n        }\n    }\n</code></pre></p> <p>\u867d\u7136\u8fd9\u6837\u53ef\u4ee5\u53d1\u6325\u9884\u671f\u7684\u4f5c\u7528\uff0c\u4f46\u73b0\u5728\u6bcf\u5f53\u5f15\u7528 View \u65f6\uff0c\u90fd\u5fc5\u987b\u7ba1\u7406\u5176\u53ef\u4e3a null \u6027\u3002\u66f4\u597d\u7684\u89e3\u51b3\u65b9\u6848\u662f\u5bf9 View \u521d\u59cb\u5316\u4f7f\u7528 lateinit\uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u6240\u793a\uff1a <pre><code>class LoginFragment : Fragment() {\n        private lateinit var statusTextView: TextView\n\n        override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n                super.onViewCreated(view, savedInstanceState)\n\n                statusTextView = view.findViewById(R.id.status_text_view)\n                statusTextView.setText(R.string.auth_failed)\n        }\n    }\n</code></pre></p> <p>\u901a\u8fc7 lateinit \u5173\u952e\u5b57\uff0c\u60a8\u53ef\u4ee5\u907f\u514d\u5728\u6784\u5efa\u5bf9\u8c61\u65f6\u521d\u59cb\u5316\u5c5e\u6027\u3002 \u5982\u679c\u5728\u5c5e\u6027\u8fdb\u884c\u521d\u59cb\u5316\u4e4b\u524d\u5bf9\u5176\u8fdb\u884c\u4e86\u5f15\u7528\uff0cKotlin \u4f1a\u629b\u51fa UninitializedPropertyAccessException\uff0c\u56e0\u6b64\u8bf7\u52a1\u5fc5\u5c3d\u5feb\u521d\u59cb\u5316\u5c5e\u6027\u3002</p> <p>\u6ce8\u610f\uff1a\u8bf8\u5982\u6570\u636e\u7ed1\u5b9a\u4e4b\u7c7b\u7684\u89c6\u56fe\u7ed1\u5b9a\u89e3\u51b3\u65b9\u6848\u53ef\u4ee5\u6d88\u9664\u5bf9 findViewById \u7684\u624b\u52a8\u8c03\u7528\uff0c\u8fd9\u4e9b\u89e3\u51b3\u65b9\u6848\u6709\u52a9\u4e8e\u51cf\u5c11\u60a8\u9700\u8981\u8003\u8651\u7684 null \u5b89\u5168\u95ee\u9898\u6570\u3002</p>"},{"location":"kotlin/basic/intro/hello-world/","title":"Kotlin\u65b0\u5efa\u9879\u76ee","text":"\u66f4\u65b0\u65e5\u671f 2021-11-16 <ul> <li>2021-11-16 \u66f4\u65b0\u683c\u5f0f</li> <li>2021-4-8 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u6211\u4eec\u4f7f\u7528IntelliJ IDEA\uff0c\u65b0\u5efa\u4e00\u4e2aKotlin\u9879\u76ee\u3002</p> \u65b0\u5efa\u4e00\u4e2aKotlin\u9879\u76ee <p></p> \u914d\u7f6e <p></p>"},{"location":"kotlin/basic/intro/hello-world/#hello-world","title":"Hello World","text":"<pre><code>package com.rustfisher.ktpractice.intro\n\nfun main(args: Array&lt;String&gt;) {\n    println(\"Hello World - fun main(args: Array&lt;String&gt;)\")\n}\n</code></pre> <p>\u901a\u5e38Koltin\u4ee3\u7801\u5199\u5728\u5305\uff08packages\uff09\u91cc\u3002</p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u9009\u62e9\u662f\u5426\u5b9a\u4e49\u5305\u3002\u5982\u679c\u4ee3\u7801\u4e0d\u5728\u5305\u91cc\uff0c\u90a3\u4e48\u5b83\u5f52\u5c5e\u4e8e\u9ed8\u8ba4\u7684\u5305\u3002</p> <p>Kotlin\u5e94\u7528\u7684\u5165\u53e3\u662f\u4e3b\u51fd\u6570<code>main</code>\u3002</p> <p>\u5728Kotlin 1.3\u91cc\uff0c\u4e3b\u51fd\u6570\u53ef\u4ee5\u4e0d\u5e26\u4efb\u4f55\u53c2\u6570\u3002\u4e3b\u51fd\u6570\u6ca1\u6709\u8fd4\u56de\u503c\u3002 <pre><code>fun main() {\n    println(\"Hello world - fun main()\")\n}\n</code></pre></p> <p>\u5728Kotlin1.3\u4e4b\u524d\uff0c\u4e3b\u51fd\u6570\u5fc5\u987b\u6709<code>Array&lt;String&gt;</code>\u53c2\u6570\u3002\u8fd9\u70b9\u548cJava\u7c7b\u4f3c\u3002 <pre><code>fun main(args: Array&lt;String&gt;) {\n    println(\"Hello World - fun main(args: Array&lt;String&gt;)\")\n}\n</code></pre></p> <p>\u5982\u56fe\uff0c\u5f53\u4e24\u79cdmain\u51fd\u6570\u540c\u65f6\u5b58\u5728\u65f6\uff0c\u4ee5\u5e26\u6709<code>Array&lt;String&gt;</code>\u53c2\u6570\u7684\u65b9\u6cd5\u4e3a\u4e3b\u3002</p> \u4e24\u79cdmain\u51fd\u6570\u540c\u65f6\u5b58\u5728 <p>"},{"location":"kotlin/basic/intro/hello-world/#_1","title":"\u53d8\u91cf","text":"<p>\u7528var\u6765\u58f0\u660e\u53ef\u53d8\u7684\u53d8\u91cf\u3002</p> <p>\u7528val\u6765\u58f0\u660e\u4e0d\u53ef\u53d8\u7684\u53d8\u91cf\u3002</p> <pre><code>package com.rustfisher.ktpractice.intro\n\nvar firstName: String = \"Rust\"\nval lastName = \"Fisher\"\n\nfun main(args: Array&lt;String&gt;) {\n    println(\"$firstName $lastName\")\n}\n</code></pre>"},{"location":"kotlin/breif/kt-first/","title":"Kotlin\u7cfb\u5217\u7b80\u4ecb","text":"\u66f4\u65b0\u65e5\u671f 2021-9-22 <ul> <li>2021-9-22 \u66f4\u65b0\u94fe\u63a5</li> <li>2021-4-4 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4e3aAndroid\u5f00\u53d1\u8005\u51c6\u5907\u7684Kotlin\u7b80\u660e\u6559\u7a0b\u3002\u76ee\u7684\u662f\u8ba9Android\u5f00\u53d1\u8005\u5feb\u901f\u5730\u638c\u63e1Kotlin\u5b9e\u7528\u6280\u5de7\u3002\u76ee\u524d\u672c\u7cfb\u5217\u8fd8\u5728\u5efa\u8bbe\u4e2d\uff082021-9\uff09\u3002</p> <p>\u7ed3\u5408\u4f8b\u5b50\uff0c\u4ecb\u7ecdKotlin\u4e2d\u7684\u5404\u4e2a\u6982\u5ff5\uff0c\u5e38\u89c1\u7528\u6cd5\u548c\u4e00\u4e9b\u6ce8\u610f\u4e8b\u9879\u3002</p> <p>\u57282019\u5e74Google I/O\u5927\u4f1a\u4e0a\uff0cGoogle\u5ba3\u5e03\u4eca\u540e\u5c06\u4f18\u5148\u91c7\u7528Kotlin\u8fdb\u884cAndroid\u5f00\u53d1\u3002</p> <p>Kotlin \u662f\u4e00\u79cd\u5bcc\u6709\u8868\u73b0\u529b\u4e14\u7b80\u6d01\u7684\u7f16\u7a0b\u8bed\u8a00\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u51cf\u5c11\u5e38\u89c1\u4ee3\u7801\u9519\u8bef\uff0c\u8fd8\u53ef\u4ee5\u8f7b\u677e\u96c6\u6210\u5230\u73b0\u6709\u5e94\u7528\u4e2d\u3002</p> <p>\u5982\u679c\u60a8\u60f3\u6784\u5efa Android \u5e94\u7528\uff0c\u5efa\u8bae\u60a8\u4ece Kotlin \u5f00\u59cb\u7740\u624b\uff0c\u5145\u5206\u5229\u7528\u4e00\u6d41\u7684 Kotlin \u529f\u80fd\u3002</p> <p>Google\u5217\u4e3e\u7684Kotlin\u7684\u4f18\u52bf</p> <ul> <li>\u5bcc\u6709\u8868\u73b0\u529b\u4e14\u7b80\u6d01\uff1a\u60a8\u53ef\u4ee5\u4f7f\u7528\u66f4\u5c11\u7684\u4ee3\u7801\u5b9e\u73b0\u66f4\u591a\u7684\u529f\u80fd\u3002\u8868\u8fbe\u81ea\u5df1\u7684\u60f3\u6cd5\uff0c\u5c11\u7f16\u5199\u6837\u677f\u4ee3\u7801\u3002\u5728\u4f7f\u7528Kotlin\u7684\u4e13\u4e1a\u5f00\u53d1\u8005\u4e2d\uff0c\u670967%\u7684\u4eba\u53cd\u6620\u5176\u5de5\u4f5c\u6548\u7387\u6709\u6240\u63d0\u9ad8\u3002</li> <li>\u66f4\u5b89\u5168\u7684\u4ee3\u7801\uff1aKotlin\u6709\u8bb8\u591a\u8bed\u8a00\u529f\u80fd\uff0c\u53ef\u5e2e\u52a9\u60a8\u907f\u514dnull\u6307\u9488\u5f02\u5e38\u7b49\u5e38\u89c1\u7f16\u7a0b\u9519\u8bef\u3002\u5305\u542bKotlin\u4ee3\u7801\u7684Android\u5e94\u7528\u53d1\u751f\u5d29\u6e83\u7684\u53ef\u80fd\u6027\u964d\u4f4e\u4e8620%\u3002</li> <li>\u53ef\u4e92\u64cd\u4f5c\uff1a\u60a8\u53ef\u4ee5\u5728Kotlin\u4ee3\u7801\u4e2d\u8c03\u7528Java\u4ee3\u7801\uff0c\u6216\u8005\u5728Java\u4ee3\u7801\u4e2d\u8c03\u7528Kotlin\u4ee3\u7801\u3002Kotlin\u53ef\u5b8c\u5168\u4e0eJava\u7f16\u7a0b\u8bed\u8a00\u4e92\u64cd\u4f5c\uff0c\u56e0\u6b64\u60a8\u53ef\u4ee5\u6839\u636e\u9700\u8981\u5728\u9879\u76ee\u4e2d\u6dfb\u52a0\u4efb\u610f\u6570\u91cf\u7684Kotlin\u4ee3\u7801\u3002</li> <li>\u7ed3\u6784\u5316\u5e76\u53d1\uff1aKotlin\u534f\u7a0b\u8ba9\u5f02\u6b65\u4ee3\u7801\u50cf\u963b\u585e\u4ee3\u7801\u4e00\u6837\u6613\u4e8e\u4f7f\u7528\u3002\u534f\u7a0b\u53ef\u5927\u5e45\u7b80\u5316\u540e\u53f0\u4efb\u52a1\u7ba1\u7406\uff0c\u4f8b\u5982\u7f51\u7edc\u8c03\u7528\u3001\u672c\u5730\u6570\u636e\u8bbf\u95ee\u7b49\u4efb\u52a1\u7684\u7ba1\u7406\u3002</li> </ul> <p>\u66f4\u91cd\u8981\u7684\u662f\uff0cJetpack Compose\u4ec5\u652f\u6301Kotlin\uff0c\u800c\u4e0d\u518d\u652f\u6301Java\u3002 Google\u63d0\u5230\u591a\u5e73\u53f0\u9879\u76ee\u53ef\u4f7f\u7528Kotlin\u6765\u5f00\u53d1\u3002</p>"},{"location":"kotlin/breif/kt-first/#_1","title":"\u7cfb\u5217\u5927\u7eb2","text":"\u9898\u76ee \u8bf4\u660e Hello World \u65b0\u5efa\u9879\u76ee\uff0c\u505a\u597d\u51c6\u5907 \u6982\u5ff5\u6c47\u603b Kotlin\u4e2d\u7684\u4e00\u4e9b\u6982\u5ff5\u3002\u4f8b\u5982\u5305\uff0c\u7a0b\u5e8f\u5165\u53e3\uff0c\u53d8\u91cf\uff0c\u8f93\u51fa\uff0c\u65b9\u6cd5\uff08\u51fd\u6570\uff09\u7b49\u7b49\u3002 <p> \ud83d\udc31 Hello world   \ud83d\udd17 kotlincn.net   \ud83d\udcd6 Kotlin\u534f\u7a0b </p>"},{"location":"kotlin/coroutines/cancel-timeout/","title":"Kotlin\u534f\u7a0b\u53d6\u6d88\u4e0e\u8d85\u65f6","text":"\u66f4\u65b0\u65e5\u671f 2021-9-27 <ul> <li>2021-9-27 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883 <ul> <li>IntelliJ IDEA 2021.2.2 (Community Edition)</li> <li>Kotlin: 212-1.5.10-release-IJ5284.40</li> </ul> <p>Kotlin\u534f\u7a0b\u7cfb\u5217\u76ee\u5f55</p> <ol> <li>Kotlin\u534f\u7a0b\u5165\u95e8 \u2014\u2014 \u7b2c\u4e00\u4e2a\u4f8b\u5b50\uff0c\u542f\u52a8\u534f\u7a0b</li> <li>Kotlin\u534f\u7a0b\u57fa\u7840 \u2014\u2014 \u963b\u585e\u4e0e\u975e\u963b\u585e\uff0c\u7b49\u5f85\uff0c\u4f5c\u7528\u57df\u6784\u5efa\u5668</li> <li>Kotlin\u534f\u7a0b\u53d6\u6d88\u4e0e\u8d85\u65f6 \u2014\u2014 \u53d6\u6d88\u7684\u6761\u4ef6\uff0c\u8d85\u65f6\u8bbe\u5b9a </li> </ol> <p></p> <p>\u8fd9\u91cc\u4ecb\u7ecd\u534f\u7a0b\u7684\u8d85\u65f6\u548c\u53d6\u6d88\u3002</p>"},{"location":"kotlin/coroutines/cancel-timeout/#_1","title":"\u53d6\u6d88","text":"<p>\u6211\u4eec\u53ef\u4ee5\u542f\u52a8\u534f\u7a0b\uff0c\u4e5f\u53ef\u4ee5\u5728\u534f\u7a0b\u5c1a\u672a\u7ed3\u675f\u65f6\uff0c\u4e3b\u52a8\u53d6\u6d88\u534f\u7a0b\u3002</p> <p>\u4f8b\u5982\u5728Android\u5e94\u7528\u4e2d\uff0c\u4e00\u4e2a\u754c\u9762\u7684ViewModel\u542f\u52a8\u4e86\u534f\u7a0b\uff0c\u800c\u8fd9\u4e2a\u754c\u9762\u8981\u5173\u95ed\u9000\u51fa\u4e86\u3002\u90a3\u4e48\u6211\u4eec\u9700\u8981\u628a\u534f\u7a0b\u4e5f\u53d6\u6d88\u6389\u3002</p> <p><code>launch</code>\u51fd\u6570\u8fd4\u56de\u7684Job\u5373\u662f\u534f\u7a0b\u5bf9\u8c61\u3002\u8c03\u7528<code>job.cancel()</code>\u51fd\u6570\u5373\u53ef\u53d6\u6d88\u534f\u7a0b\u3002</p> <pre><code>import kotlinx.coroutines.*\n\nfun main() = runBlocking {\n    val job = GlobalScope.launch {\n        repeat(100) { i -&gt;\n            println(\"\u4f11\u7720\u6b21\u6570 $i\")\n            delay(500)\n        }\n    }\n    val t1 = System.currentTimeMillis()\n    delay(1200)\n    println(\"[rustfisher] \u7b49\u5f85\u5b8c\u6bd5\u51c6\u5907\u9000\u51fa t1:$t1\")\n    job.cancel()\n    job.join()\n    println(\"Bye~ \u8017\u65f6: ${System.currentTimeMillis() - t1}\u6beb\u79d2\")\n}\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c <pre><code>\u4f11\u7720\u6b21\u6570 0\n\u4f11\u7720\u6b21\u6570 1\n\u4f11\u7720\u6b21\u6570 2\n[rustfisher] \u7b49\u5f85\u5b8c\u6bd5\u51c6\u5907\u9000\u51fa t1:1632750920587\nBye~ \u8017\u65f6: 1218\u6beb\u79d2\n</code></pre></p> <p>\u8c03\u7528<code>job.cancel()</code>\uff0c\u901a\u8fc7log\u53ef\u4ee5\u770b\u51fa\u5728\u5b83\u6ca1\u6709\u8f93\u51fa\u4e86\uff0c\u56e0\u4e3a\u5b83\u88ab\u53d6\u6d88\u4e86\u3002</p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u8c03\u7528Job\u7684<code>cancelAndJoin()</code>\u65b9\u6cd5\u6765\u4ee3\u66ff\u4e0a\u9762\u4ee3\u7801\u4e2d\u7684<code>cancel()</code>\u548c<code>join()</code>\u3002</p> <pre><code>// Job.kt \u90e8\u5206\u6e90\u7801\npublic suspend fun Job.cancelAndJoin() {\n    cancel()\n    return join()\n}\n</code></pre>"},{"location":"kotlin/coroutines/cancel-timeout/#_2","title":"\u68c0\u67e5\u53d6\u6d88\u60c5\u51b5","text":"<p>\u534f\u7a0b\u5728\u534f\u4f5c\u7684\u60c5\u51b5\u4e0b\u624d\u80fd\u88ab\u53d6\u6d88\u3002<code>kotlinx.coroutines</code>\u4e2d\u7684\u6302\u8d77\u51fd\u6570\u90fd\u662f\u53ef\u88ab\u53d6\u6d88\u7684\u3002</p>"},{"location":"kotlin/coroutines/cancel-timeout/#_3","title":"\u65e0\u6cd5\u53d6\u6d88","text":"<p>\u5982\u679c\u534f\u7a0b\u5728\u6267\u884c\u8ba1\u7b97\u4efb\u52a1\uff0c\u5e76\u4e14\u6ca1\u68c0\u67e5\u53d6\u6d88\u7684\u8bdd\uff0c\u90a3\u6211\u4eec\u7684\u53d6\u6d88\u5c1d\u8bd5\u4f1a\u5931\u8d25\u3002\u6bd4\u5982\u4e0b\u9762\u7684\u4ee3\u7801</p> <p><pre><code>import kotlinx.coroutines.*\n\nfun main() = runBlocking {\n    val startTime = System.currentTimeMillis()\n    val job = launch(Dispatchers.Default) {\n        var nextPrintTime = startTime\n        var i = 0 // \u6a21\u62df\u7684\u63a7\u5236\u5faa\u73af\u6570\u91cf\n        while (i &lt; 5) { // \u6a21\u62df\u8017\u65f6\u8ba1\u7b97\n            if (System.currentTimeMillis() &gt;= nextPrintTime) {\n                println(\"[job] \u6a21\u62df\u8017\u65f6\u8ba1\u7b97\u4e2d ${i++} ...\")\n                nextPrintTime += 500L\n            }\n        }\n    }\n    delay(800) // \u7b49\u5f85\u4e00\u4f1a\n    println(\"[rustfisher] \u5c1d\u8bd5\u53d6\u6d88\u534f\u7a0b\")\n    job.cancelAndJoin()\n    println(\"\u7a0b\u5e8f\u9000\u51fa bye~\")\n}\n</code></pre> \u8fd0\u884clog <pre><code>[job] \u6a21\u62df\u8017\u65f6\u8ba1\u7b97\u4e2d 0 ...\n[job] \u6a21\u62df\u8017\u65f6\u8ba1\u7b97\u4e2d 1 ...\n[rustfisher] \u5c1d\u8bd5\u53d6\u6d88\u534f\u7a0b\n[job] \u6a21\u62df\u8017\u65f6\u8ba1\u7b97\u4e2d 2 ...\n[job] \u6a21\u62df\u8017\u65f6\u8ba1\u7b97\u4e2d 3 ...\n[job] \u6a21\u62df\u8017\u65f6\u8ba1\u7b97\u4e2d 4 ...\n\u7a0b\u5e8f\u9000\u51fa bye~\n</code></pre></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6a21\u62df\u8017\u65f6\u8ba1\u7b97\u76f4\u52304\uff0c\u6574\u4e2a\u7a0b\u5e8f\u9000\u51fa\u3002\u800c\u8c03\u7528<code>cancelAndJoin()</code>\u5e76\u6ca1\u6709\u6210\u529f\u53d6\u6d88\u6389\u534f\u7a0b\u3002</p>"},{"location":"kotlin/coroutines/cancel-timeout/#_4","title":"\u53ef\u4ee5\u53d6\u6d88","text":"<p>\u8ba9\u534f\u7a0b\u53ef\u88ab\u53d6\u6d88\u7684\u65b9\u6cd5</p> <ul> <li>\u5b9a\u671f\u8c03\u7528\u6302\u8d77\u51fd\u6570\u6765\u68c0\u67e5\u53d6\u6d88\uff0c\u4f8b\u5982<code>yield</code></li> <li>\u663e\u5f0f\u7684\u68c0\u67e5\u53d6\u6d88\u72b6\u6001\uff0c\u4f8b\u5982\u68c0\u67e5<code>isActive</code>\u53d8\u91cf</li> </ul> <p>\u5bf9\u4e0a\u9762\u7684\u4ee3\u7801\u8fdb\u884c\u4e00\u4e9b\u6539\u8fdb\u3002\u628a<code>while (i &lt; 5)</code>\u5faa\u73af\u4e2d\u7684\u6761\u4ef6\u6539\u6210<code>while (isActive)</code>\u3002\u4fee\u6539\u540e\u7684\u4ee3\u7801\u5982\u4e0b</p> <p><pre><code>import kotlinx.coroutines.*\n\nfun main() = runBlocking {\n    val startTime = System.currentTimeMillis()\n    val job = launch(Dispatchers.Default) {\n        var nextPrintTime = startTime\n        var i = 0\n        while (isActive) { // \u6a21\u62df\u8017\u65f6\u8ba1\u7b97\n            if (System.currentTimeMillis() &gt;= nextPrintTime) {\n                println(\"[job] \u6a21\u62df\u8017\u65f6\u8ba1\u7b97\u4e2d ${i++} ...\")\n                nextPrintTime += 500L\n            }\n        }\n    }\n    delay(800) // \u7b49\u5f85\u4e00\u4f1a\n    println(\"[rustfisher] \u5c1d\u8bd5\u53d6\u6d88\u534f\u7a0b\")\n    job.cancelAndJoin()\n    println(\"\u7a0b\u5e8f\u9000\u51fa bye~\")\n}\n</code></pre> \u8fd0\u884c\u7ed3\u679c <pre><code>[job] \u6a21\u62df\u8017\u65f6\u8ba1\u7b97\u4e2d 0 ...\n[job] \u6a21\u62df\u8017\u65f6\u8ba1\u7b97\u4e2d 1 ...\n[rustfisher] \u5c1d\u8bd5\u53d6\u6d88\u534f\u7a0b\n\u7a0b\u5e8f\u9000\u51fa bye~\n</code></pre> \u4ecelog\u4e2d\u770b\u5230\uff0c\u5c1d\u8bd5\u53d6\u6d88\u534f\u7a0b\u540e\uff0c\u534f\u7a0b\u4e0d\u518d\u8fdb\u884c\u8ba1\u7b97\u3002</p>"},{"location":"kotlin/coroutines/cancel-timeout/#finally","title":"\u5728finally\u5757\u4e2d\u91ca\u653e\u8d44\u6e90","text":"<p>\u53d6\u6d88\u534f\u7a0b\u65f6\uff0c\u6302\u8d77\u51fd\u6570\u80fd\u629b\u51faCancellationException\u3002\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528try-catch-finally\u6765\u5904\u7406\u3002\u5e76\u4e14\u5728finally\u5757\u4e2d\u91ca\u653e\u8d44\u6e90\u3002</p> <p><pre><code>fun main() = runBlocking {\n    val job = launch {\n        try {\n            repeat(1000) { i -&gt;\n                println(\"[job]\u6a21\u62df\u8ba1\u7b97\u6b21\u6570 $i ...\")\n                delay(300L)\n            }\n        } catch (e: CancellationException) {\n            println(\"[job] CancellationException ${e.message}\")\n        } finally {\n            println(\"[job][finally] \u91ca\u653e\u8d44\u6e90..\")\n        }\n    }\n    delay(800) // \u7b49\u5f85\u4e00\u4f1a\n    println(\"[rustfisher] \u5c1d\u8bd5\u53d6\u6d88\u534f\u7a0b\")\n    job.cancelAndJoin()\n    println(\"[rustfisher] \u7a0b\u5e8f\u9000\u51fa bye~\")\n}\n</code></pre> \u8fd0\u884clog <pre><code>[job]\u6a21\u62df\u8ba1\u7b97\u6b21\u6570 0 ...\n[job]\u6a21\u62df\u8ba1\u7b97\u6b21\u6570 1 ...\n[job]\u6a21\u62df\u8ba1\u7b97\u6b21\u6570 2 ...\n[rustfisher] \u5c1d\u8bd5\u53d6\u6d88\u534f\u7a0b\n[job] CancellationException StandaloneCoroutine was cancelled\n[job][finally] \u91ca\u653e\u8d44\u6e90..\n[rustfisher] \u7a0b\u5e8f\u9000\u51fa bye~\n</code></pre></p>"},{"location":"kotlin/coroutines/cancel-timeout/#_5","title":"\u8fd0\u884c\u4e0d\u80fd\u53d6\u6d88\u7684\u4ee3\u7801\u5757","text":"<p>\u8ba9\u534f\u7a0b\u53d6\u6d88\u540e\uff0c\u6211\u4eec\u53ef\u80fd\u8981\u6267\u884c\u5173\u95ed\u6587\u4ef6\u7b49\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u9700\u8981\u6267\u884c\u3002\u53ef\u4ee5\u628a\u8fd9\u4e9b\u64cd\u4f5c\u5305\u5728<code>withContext(NonCancellable) { }</code>\u4e2d\u3002 <pre><code>val job = launch {\n    try {\n        repeat(1000) { i -&gt;\n            println(\"[job]\u6a21\u62df\u8ba1\u7b97\u6b21\u6570 $i ...\")\n            delay(300L)\n        }\n    } catch (e: CancellationException) {\n        println(\"[job] CancellationException ${e.message}\")\n    } finally {\n        withContext(NonCancellable) {\n            println(\"[job][finally] \u8fdb\u5165NonCancellable\")\n            delay(1000) // \u5047\u8bbe\u8fd9\u91cc\u8fd8\u6709\u4e00\u4e9b\u8017\u65f6\u64cd\u4f5c\n            println(\"[job][finally] NonCancellable\u5b8c\u6bd5\")\n        }\n        println(\"[job][finally] \u7ed3\u675f\")\n    }\n}\ndelay(800) // \u7b49\u5f85\u4e00\u4f1a\nprintln(\"[rustfisher] \u5c1d\u8bd5\u53d6\u6d88\u534f\u7a0b\")\njob.cancelAndJoin()\nprintln(\"[rustfisher] \u7a0b\u5e8f\u9000\u51fa bye~\")\n</code></pre></p> <p>\u8fd0\u884clog <pre><code>[job]\u6a21\u62df\u8ba1\u7b97\u6b21\u6570 0 ...\n[job]\u6a21\u62df\u8ba1\u7b97\u6b21\u6570 1 ...\n[job]\u6a21\u62df\u8ba1\u7b97\u6b21\u6570 2 ...\n[rustfisher] \u5c1d\u8bd5\u53d6\u6d88\u534f\u7a0b\n[job] CancellationException StandaloneCoroutine was cancelled\n[job][finally] \u8fdb\u5165NonCancellable\n[job][finally] NonCancellable\u5b8c\u6bd5\n[job][finally] \u7ed3\u675f\n[rustfisher] \u7a0b\u5e8f\u9000\u51fa bye~\n</code></pre></p> <p>\u6ce8\u610f\uff1aNonCancellable\u53ea\u80fd\u4e0e<code>withContext</code>\u642d\u914d\u4f7f\u7528\u3002</p>"},{"location":"kotlin/coroutines/cancel-timeout/#_6","title":"\u8d85\u65f6","text":"<p>\u6211\u4eec\u53ef\u4ee5\u7528<code>withTimeout(long)</code>\u6765\u6307\u5b9a\u8d85\u65f6\u65f6\u95f4\u3002</p> <p>\u4f8b\u5982\u4e0b\u9762\u4ee3\u7801\uff0c\u6307\u5b9a\u4e86\u8d85\u65f6\u65f6\u95f4 <pre><code>import kotlinx.coroutines.*\n\nfun main() = runBlocking&lt;Unit&gt; {\n    launch {\n        withTimeout(1300L) {\n            val startTime = System.currentTimeMillis()\n            repeat(1000) { i -&gt;\n                println(\"[job] \u8fd0\u884c: $i, \u7d2f\u79ef\u8fd0\u884c\u65f6\u95f4: ${System.currentTimeMillis() - startTime}\u6beb\u79d2\")\n                delay(500L)\n            }\n        }\n    }\n}\n</code></pre> \u8fd0\u884clog <pre><code>[job] \u8fd0\u884c: 0, \u7d2f\u79ef\u8fd0\u884c\u65f6\u95f4: 0\u6beb\u79d2\n[job] \u8fd0\u884c: 1, \u7d2f\u79ef\u8fd0\u884c\u65f6\u95f4: 506\u6beb\u79d2\n[job] \u8fd0\u884c: 2, \u7d2f\u79ef\u8fd0\u884c\u65f6\u95f4: 1011\u6beb\u79d2\n</code></pre></p> <p>\u5728\u539f\u6765\u4ee3\u7801\u4e0a\u52a0\u4e0atry-catch\uff0c\u89c2\u5bdf\u8d85\u65f6\u629b\u51fa\u7684\u5f02\u5e38 <pre><code>fun main() = runBlocking&lt;Unit&gt; {\n    launch {\n        try {\n            withTimeout(400L) {\n                val startTime = System.currentTimeMillis()\n                repeat(1000) { i -&gt;\n                    println(\"[job] \u8fd0\u884c: $i, \u7d2f\u79ef\u8fd0\u884c\u65f6\u95f4: ${System.currentTimeMillis() - startTime}\u6beb\u79d2\")\n                    delay(100L)\n                }\n            }\n        } catch (e: Exception) {\n            println(\"\u5f02\u5e38: $e\")\n        }\n    }\n}\n</code></pre> \u8fd0\u884clog <pre><code>[job] \u8fd0\u884c: 0, \u7d2f\u79ef\u8fd0\u884c\u65f6\u95f4: 0\u6beb\u79d2\n[job] \u8fd0\u884c: 1, \u7d2f\u79ef\u8fd0\u884c\u65f6\u95f4: 105\u6beb\u79d2\n[job] \u8fd0\u884c: 2, \u7d2f\u79ef\u8fd0\u884c\u65f6\u95f4: 209\u6beb\u79d2\n[job] \u8fd0\u884c: 3, \u7d2f\u79ef\u8fd0\u884c\u65f6\u95f4: 312\u6beb\u79d2\n\u5f02\u5e38: kotlinx.coroutines.TimeoutCancellationException: Timed out waiting for 400 ms\n</code></pre> \u53ef\u4ee5\u770b\u5230\u8d85\u65f6\u629b\u51fa\u7684\u662fTimeoutCancellationException\uff0c\u5b83\u662fCancellationException\u7684\u5b50\u7c7b\u3002 \u524d\u9762\u7684\u4ee3\u7801\u6ca1\u5728\u63a7\u5236\u53f0\u770b\u5230\u8fd9\u4e2a\u5f02\u5e38\uff0c\u662f\u56e0\u4e3a\u5728\u88ab\u53d6\u6d88\u7684\u534f\u7a0b\u4e2dCancellationException\u88ab\u8ba4\u4e3a\u662f\u534f\u7a0b\u6267\u884c\u7ed3\u675f\u7684\u6b63\u5e38\u539f\u56e0\u3002\u6211\u4eec\u53ef\u4ee5\u4e3b\u52a8\u6355\u83b7\u5b83\u3002</p> <p><code>withTimeoutOrNull</code>\u65b9\u6cd5\u4f1a\u5728\u8d85\u65f6\u540e\u8fd4\u56denull\uff0c\u5982\u679c\u6210\u529f\u6267\u884c\u5219\u8fd4\u56de\u6211\u4eec\u6307\u5b9a\u7684\u4e1c\u897f\uff0c\u5982\u4e0b\u9762\u4ee3\u7801 <pre><code>fun main() = runBlocking&lt;Unit&gt; {\n    launch {\n        val result1 = withTimeoutOrNull(1300L) {\n            repeat(1000) { i -&gt;\n                println(\"[job1] \u8fd0\u884c $i ...\")\n                delay(500L)\n            }\n            \"[1] Done\" // \u6839\u636e\u8d85\u65f6\u8bbe\u7f6e \u6267\u884c\u4e0d\u5230\u8fd9\u91cc\n        }\n        println(\"Result1: $result1\")\n\n        val result2 = withTimeoutOrNull(1300L) {\n            repeat(2) { i -&gt;\n                println(\"[job2] \u8fd0\u884c $i ...\")\n                delay(500L)\n            }\n            \"[2] Done\" // \u6210\u529f\u6267\u884c\u5b8c\u6bd5\u540e\u5230\u8fd9\u91cc\n        }\n        println(\"Result2: $result2\")\n    }\n}\n</code></pre></p> <p>\u8fd0\u884clog <pre><code>[job1] \u8fd0\u884c 0 ...\n[job1] \u8fd0\u884c 1 ...\n[job1] \u8fd0\u884c 2 ...\nResult1: null\n[job2] \u8fd0\u884c 0 ...\n[job2] \u8fd0\u884c 1 ...\nResult2: [2] Done\n</code></pre></p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a</p>"},{"location":"kotlin/coroutines/basic/b2/","title":"Kotlin\u534f\u7a0b\u57fa\u7840","text":"\u66f4\u65b0\u65e5\u671f 2021-9-23 <ul> <li>2021-9-23 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883 <ul> <li>IntelliJ IDEA 2021.2.2 (Community Edition)</li> <li>Kotlin: 212-1.5.10-release-IJ5284.40</li> </ul> <p>Kotlin\u534f\u7a0b\u7cfb\u5217\u76ee\u5f55</p> <ol> <li>Kotlin\u534f\u7a0b\u5165\u95e8 \u2014\u2014 \u7b2c\u4e00\u4e2a\u4f8b\u5b50\uff0c\u542f\u52a8\u534f\u7a0b</li> <li>Kotlin\u534f\u7a0b\u57fa\u7840 \u2014\u2014 \u963b\u585e\u4e0e\u975e\u963b\u585e\uff0c\u7b49\u5f85\uff0c\u4f5c\u7528\u57df\u6784\u5efa\u5668</li> <li>Kotlin\u534f\u7a0b\u53d6\u6d88\u4e0e\u8d85\u65f6 \u2014\u2014 \u53d6\u6d88\u7684\u6761\u4ef6\uff0c\u8d85\u65f6\u8bbe\u5b9a </li> </ol> <p></p> <p>\u6211\u4eec\u5df2\u7ecf\u901a\u8fc7\u7b2c\u4e00\u4e2a\u4f8b\u5b50\u5b66\u4f1a\u4e86\u542f\u52a8\u534f\u7a0b\uff0c\u8fd9\u91cc\u4ecb\u7ecd\u4e00\u4e9b\u534f\u7a0b\u7684\u57fa\u7840\u77e5\u8bc6\u3002</p>"},{"location":"kotlin/coroutines/basic/b2/#_1","title":"\u963b\u585e\u4e0e\u975e\u963b\u585e","text":""},{"location":"kotlin/coroutines/basic/b2/#runblocking","title":"runBlocking","text":"<p><code>delay</code>\u662f\u975e\u963b\u585e\u7684\uff0c<code>Thread.sleep</code>\u662f\u963b\u585e\u7684\u3002\u663e\u5f0f\u4f7f\u7528 <code>runBlocking</code> \u534f\u7a0b\u6784\u5efa\u5668\u6765\u963b\u585e\u3002 <pre><code>import kotlinx.coroutines.*\n\nfun main() {\n    GlobalScope.launch { // \u5728\u540e\u53f0\u542f\u52a8\u4e00\u4e2a\u65b0\u7684\u534f\u7a0b\u5e76\u7ee7\u7eed\n        delay(200)\n        \"rustfisher.com\".forEach {\n            print(it)\n            delay(280)\n        }\n    }\n    println(\"\u4e3b\u7ebf\u7a0b\u4e2d\u7684\u4ee3\u7801\u4f1a\u7acb\u5373\u6267\u884c\")\n    runBlocking {     // \u8fd9\u4e2a\u8868\u8fbe\u5f0f\u963b\u585e\u4e86\u4e3b\u7ebf\u7a0b\n        delay(3000L)  //\u963b\u585e\u4e3b\u7ebf\u7a0b\u9632\u6b62\u8fc7\u5feb\u9000\u51fa\n    }\n    println(\"\\n\u793a\u4f8b\u7ed3\u675f\")\n}\n</code></pre> \u53ef\u4ee5\u770b\u5230\uff0c<code>runBlocking</code>\u91cc\u4f7f\u7528\u4e86<code>delay</code>\u6765\u5ef6\u8fdf\u3002\u7528\u4e86<code>runBlocking</code>\u7684\u4e3b\u7ebf\u7a0b\u4f1a\u4e00\u76f4\u963b\u585e\u76f4\u5230<code>runBlocking</code>\u5185\u90e8\u7684\u534f\u7a0b\u6267\u884c\u5b8c\u6bd5\u3002 \u4e5f\u5c31\u662f<code>runBlocking{ delay }</code>\u5b9e\u73b0\u4e86\u963b\u585e\u7684\u6548\u679c\u3002</p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u7528<code>runBlocking</code>\u6765\u5305\u88c5\u4e3b\u51fd\u6570\u3002 <pre><code>import kotlinx.coroutines.*\n\nfun main() = runBlocking {\n    delay(100) // \u5728\u8fd9\u91cc\u53ef\u4ee5\u7528delay\u4e86\n\n    GlobalScope.launch {\n        delay(100)\n        println(\"Fisher\")\n    }\n    print(\"Rust \")\n    delay(3000)\n}\n</code></pre> <code>runBlocking&lt;Unit&gt;</code>\u4e2d\u7684<code>&lt;Unit&gt;</code>\u76ee\u524d\u53ef\u4ee5\u7701\u7565\u3002</p> <p><code>runBlocking</code>\u4e5f\u53ef\u7528\u5728\u6d4b\u8bd5\u4e2d</p> <pre><code>// \u5f15\u5165junit\ndependencies {\n    implementation(\"junit:junit:4.13.1\")\n}\n</code></pre>"},{"location":"kotlin/coroutines/basic/b2/#_2","title":"\u5355\u5143\u6d4b\u8bd5","text":"<p>\u4f7f\u7528<code>@Test</code>\u8bbe\u7f6e\u6d4b\u8bd5 <pre><code>import org.junit.Test\nimport kotlinx.coroutines.*\n\nclass C3Test {\n\n    @Test\n    fun test1() = runBlocking {\n        println(\"[rustfisher] junit\u6d4b\u8bd5\u5f00\u59cb ${System.currentTimeMillis()}\")\n        delay(1234)\n        println(\"[rustfisher] junit\u6d4b\u8bd5\u7ed3\u675f ${System.currentTimeMillis()}\")\n    }\n}\n</code></pre> \u8fd0\u884c\u7ed3\u679c <pre><code>[rustfisher] junit\u6d4b\u8bd5\u5f00\u59cb 1632401800686\n[rustfisher] junit\u6d4b\u8bd5\u7ed3\u675f 1632401801928\n</code></pre></p> <p>IDEA\u53ef\u80fd\u4f1a\u63d0\u793a<code>no tasks available</code>\u3002\u9700\u8981\u628a\u6d4b\u8bd5\u9009\u9879\u6539\u4e3aIDEA\uff0c\u5982\u4e0b\u56fe\u3002</p> \u66f4\u6539\u8bbe\u7f6e <p></p>"},{"location":"kotlin/coroutines/basic/b2/#_3","title":"\u7b49\u5f85","text":"<p>\u6709\u65f6\u5019\u9700\u8981\u7b49\u5f85\u534f\u7a0b\u6267\u884c\u5b8c\u6bd5\u3002\u53ef\u4ee5\u7528<code>join()</code>\u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u6682\u505c\u5f53\u524d\u7684\u534f\u7a0b\uff0c\u76f4\u5230\u6267\u884c\u5b8c\u6bd5\u3002\u9700\u8981\u7528<code>main() = runBlocking</code>\u3002 <pre><code>import kotlinx.coroutines.*\n\nfun main() = runBlocking {\n    println(\"[rustfisher]\u6d4b\u8bd5\u7b49\u5f85\")\n    val job1 = GlobalScope.launch {\n        println(\"job1 start\")\n        delay(300)\n        println(\"job1 done\")\n    }\n    val job2 = GlobalScope.launch {\n        println(\"job2 start\")\n        delay(800)\n        println(\"job2 done\")\n    }\n\n    job2.join()\n    job1.join() // \u7b49\u5f85\n    println(\"\u6d4b\u8bd5\u7ed3\u675f\")\n}\n</code></pre> \u8fd0\u884clog <pre><code>[rustfisher]\u6d4b\u8bd5\u7b49\u5f85\njob1 start\njob2 start\njob1 done\njob2 done\n\u6d4b\u8bd5\u7ed3\u675f\n</code></pre></p>"},{"location":"kotlin/coroutines/basic/b2/#_4","title":"\u7ed3\u6784\u5316\u7684\u5e76\u53d1","text":"<p>\u7528<code>GlobalScope.launch</code>\u65f6\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a\u9876\u5c42\u534f\u7a0b\u3002\u4e4b\u524d\u7684\u4f8b\u5b50\u6211\u4eec\u4e5f\u77e5\u9053\uff0c\u5b83\u4e0d\u4f7f\u7528\u4e3b\u7ebf\u7a0b\u3002\u65b0\u521b\u7684\u534f\u7a0b\u867d\u7136\u8f7b\u91cf\uff0c\u4f46\u4ecd\u4f1a\u6d88\u8017\u4e00\u4e9b\u5185\u5b58\u8d44\u6e90\u3002\u5982\u679c\u5fd8\u8bb0\u4fdd\u6301\u5bf9\u65b0\u542f\u52a8\u7684\u534f\u7a0b\u7684\u5f15\u7528\uff0c\u5b83\u8fd8\u4f1a\u7ee7\u7eed\u8fd0\u884c\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u5728\u4ee3\u7801\u4e2d\u4f7f\u7528\u7ed3\u6784\u5316\u5e76\u53d1\u3002</p> <p>\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528<code>runBlocking</code>\u534f\u7a0b\u6784\u5efa\u5668\u5c06<code>main</code>\u51fd\u6570\u8f6c\u6362\u4e3a\u534f\u7a0b\u3002\u5728\u91cc\u9762\uff08\u4f5c\u7528\u57df\uff09\u542f\u52a8\u7684\u534f\u7a0b\u4e0d\u9700\u663e\u5f0f\u4f7f\u7528<code>join</code>\u3002</p> <p>\u89c2\u5bdf\u4e0b\u9762\u7684\u4f8b\u5b50\uff1a <pre><code>import kotlinx.coroutines.*\n\nfun main() = runBlocking&lt;Unit&gt; {\n    println(\"\u4e3b\u7ebf\u7a0bid ${Thread.currentThread().id}\")\n    launch { // \u5728 runBlocking \u4f5c\u7528\u57df\u4e2d\u542f\u52a8\u4e00\u4e2a\u65b0\u534f\u7a0b1\n        println(\"\u534f\u7a0b1\u6240\u5728\u7ebf\u7a0bid ${Thread.currentThread().id}\")\n        delay(300)\n        println(\"\u534f\u7a0b1\u6267\u884c\u5b8c\u6bd5\")\n    }\n    launch { // \u5728 runBlocking \u4f5c\u7528\u57df\u4e2d\u542f\u52a8\u4e00\u4e2a\u65b0\u534f\u7a0b2\n        println(\"\u534f\u7a0b2\u6240\u5728\u7ebf\u7a0bid ${Thread.currentThread().id}\")\n        delay(500)\n        println(\"\u534f\u7a0b2\u6267\u884c\u5b8c\u6bd5\")\n    }\n    println(\"\u4e3b\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\")\n}\n</code></pre></p> <p>\u8fd0\u884clog <pre><code>\u4e3b\u7ebf\u7a0bid 1\n\u4e3b\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\n\u534f\u7a0b1\u6240\u5728\u7ebf\u7a0bid 1\n\u534f\u7a0b2\u6240\u5728\u7ebf\u7a0bid 1\n\u534f\u7a0b1\u6267\u884c\u5b8c\u6bd5\n\u534f\u7a0b2\u6267\u884c\u5b8c\u6bd5\n</code></pre></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e0d\u7528\u50cf\u4e4b\u524d\u90a3\u6837\u8c03\u7528<code>Thread.sleep</code>\u6216\u8005<code>delay</code>\u8ba9\u4e3b\u7ebf\u7a0b\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff0c\u9632\u6b62\u865a\u62df\u673a\u9000\u51fa\u3002</p> <p>\u7a0b\u5e8f\u4f1a\u7b49\u5f85\u5b83\u6240\u6709\u7684\u534f\u7a0b\u6267\u884c\u5b8c\u6bd5\uff0c\u7136\u540e\u771f\u6b63\u9000\u51fa\u3002</p>"},{"location":"kotlin/coroutines/basic/b2/#_5","title":"\u4f5c\u7528\u57df\u6784\u5efa\u5668","text":"<p>\u4f7f\u7528 <code>coroutineScope</code> \u6784\u5efa\u5668\u58f0\u660e\u81ea\u5df1\u7684\u4f5c\u7528\u57df\u3002\u5b83\u4f1a\u521b\u5efa\u4e00\u4e2a\u534f\u7a0b\u4f5c\u7528\u57df\uff0c\u5e76\u4e14\u4f1a\u7b49\u5f85\u6240\u6709\u5df2\u542f\u52a8\u5b50\u534f\u7a0b\u6267\u884c\u5b8c\u6bd5\u3002</p> <p><code>runBlocking</code> \u4e0e <code>coroutineScope</code> \u770b\u8d77\u6765\u7c7b\u4f3c\uff0c\u56e0\u4e3a\u5b83\u4eec\u90fd\u4f1a\u7b49\u5f85\u5176\u534f\u7a0b\u4f53\u4ee5\u53ca\u6240\u6709\u5b50\u534f\u7a0b\u7ed3\u675f\u3002\u4e3b\u8981\u533a\u522b\u5728\u4e8e\uff1a</p> <ul> <li><code>runBlocking</code> \u65b9\u6cd5\u4f1a\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\u6765\u7b49\u5f85\uff0c\u662f\u5e38\u89c4\u51fd\u6570</li> <li><code>coroutineScope</code> \u53ea\u662f\u6302\u8d77\uff0c\u4f1a\u91ca\u653e\u5e95\u5c42\u7ebf\u7a0b\u7528\u4e8e\u5176\u4ed6\u7528\u9014\uff0c\u662f\u6302\u8d77\u51fd\u6570</li> </ul> <p>\u4e0b\u9762\u8fd9\u4e2a\u793a\u4f8b\u5c55\u793a\u4e86\u4f5c\u7528\u57df\u6784\u5efa\u5668\u7684\u7279\u70b9\u3002<code>main</code>\u662f\u4e00\u4e2a\u4f5c\u7528\u57df\u3002 <pre><code>import kotlinx.coroutines.*\n\nfun main() = runBlocking { // this: CoroutineScope\n    launch {\n        delay(200L)\n        println(\"\u534f\u7a0b1 t${Thread.currentThread().id}\")\n    }\n\n    coroutineScope { // \u521b\u5efa\u4e00\u4e2a\u534f\u7a0b\u4f5c\u7528\u57df\n        launch {\n            delay(500L)\n            println(\"\u5185\u90e8\u534f\u7a0b2-1 t${Thread.currentThread().id}\")\n        }\n\n        delay(100L)\n        println(\"\u534f\u7a0b2 t${Thread.currentThread().id}\")\n    }\n\n    println(\"\u4e3b\u4efb\u52a1\u5b8c\u6bd5\")\n}\n</code></pre></p> <p>\u8fd0\u884clog <pre><code>\u534f\u7a0b2 t1\n\u534f\u7a0b1 t1\n\u5185\u90e8\u534f\u7a0b2-1t1\n\u4e3b\u4efb\u52a1\u5b8c\u6bd5\n</code></pre></p>"},{"location":"kotlin/coroutines/basic/b2/#_6","title":"\u63d0\u53d6\u51fd\u6570\u91cd\u6784","text":"<p>\u5c06<code>launch { \u2026\u2026 }</code>\u5185\u90e8\u7684\u4ee3\u7801\u5757\u63d0\u53d6\u5230\u72ec\u7acb\u7684\u51fd\u6570\u4e2d\u3002\u63d0\u53d6\u51fa\u6765\u7684\u51fd\u6570\u9700\u8981 suspend \u4fee\u9970\u7b26\uff0c\u5b83\u662f\u6302\u8d77\u51fd\u6570\u3002</p> <p><pre><code>import kotlinx.coroutines.delay\nimport kotlinx.coroutines.launch\nimport kotlinx.coroutines.runBlocking\n\nfun main() = runBlocking&lt;Unit&gt; {\n    launch { r1() }\n    println(\"DONE\")\n}\n\n// \u6302\u8d77\u51fd\u6570\nsuspend fun r1() {\n    delay(300)\n    println(\"[rustfisher] \u63d0\u53d6\u51fa\u6765\u7684\u51fd\u6570\")\n}\n</code></pre> log <pre><code>DONE\n[rustfisher] \u63d0\u53d6\u51fa\u6765\u7684\u51fd\u6570\n</code></pre></p>"},{"location":"kotlin/coroutines/basic/b2/#_7","title":"\u534f\u7a0b\u662f\u8f7b\u91cf\u7684","text":"<p>\u6211\u4eec\u524d\u9762\u4e5f\u8bd5\u8fc7\uff0c\u521b\u5efa\u975e\u5e38\u591a\u7684\u534f\u7a0b\uff0c\u7a0b\u5e8f\u8fd0\u884cOK\u3002</p> <p>\u4e0b\u9762\u7684\u4ee3\u7801\u53ef\u4ee5\u8f93\u51fa\u5f88\u591a\u7684\u70b9 <pre><code>import kotlinx.coroutines.*\n\nfun main() = runBlocking {\n    for (t in 1..10000) {\n        launch {\n            delay(t * 500L)\n            print(\".\")\n        }\n    }\n}\n</code></pre></p>"},{"location":"kotlin/coroutines/basic/b2/#_8","title":"\u5168\u5c40\u534f\u7a0b\u50cf\u5b88\u62a4\u7ebf\u7a0b","text":"<p>\u6211\u4eec\u5728\u7ebf\u7a0b\u4ecb\u7ecd\u4e2d\u77e5\u9053\uff0c\u5982\u679c\u8fdb\u7a0b\u4e2d\u53ea\u5269\u4e0b\u4e86\u5b88\u62a4\u7ebf\u7a0b\uff0c\u90a3\u4e48\u865a\u62df\u673a\u4f1a\u9000\u51fa\u3002 \u524d\u6587\u90a3\u4e2a\u6253\u5370<code>rustfisher.com</code>\u7684\u4f8b\u5b50\uff0c\u5176\u5b9e\u4e5f\u80fd\u770b\u5230\uff0c\u5b57\u7b26\u6ca1\u6253\u5370\u5b8c\u7a0b\u5e8f\u5c31\u7ed3\u675f\u4e86\u3002</p> <p>\u5728 GlobalScope \u4e2d\u542f\u52a8\u7684\u6d3b\u52a8\u534f\u7a0b\u5e76\u4e0d\u4f1a\u4f7f\u8fdb\u7a0b\u4fdd\u6d3b\u3002\u5b83\u4eec\u5c31\u50cf\u5b88\u62a4\u7ebf\u7a0b\u3002</p> <p>\u518d\u4e3e\u4e00\u4e2a\u4f8b\u5b50 <pre><code>import kotlinx.coroutines.*\n\nfun main() = runBlocking {\n    GlobalScope.launch {\n        for (i in 1..1000000) {\n            delay(200)\n            println(\"\u534f\u7a0b\u6267\u884c: $i\")\n        }\n    }\n\n    delay(1000)\n    println(\"Bye~\")\n}\n</code></pre></p> <p>log <pre><code>\u534f\u7a0b\u6267\u884c: 1\n\u534f\u7a0b\u6267\u884c: 2\n\u534f\u7a0b\u6267\u884c: 3\n\u534f\u7a0b\u6267\u884c: 4\nBye~\n</code></pre></p> <p>\u6700\u540e\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u5168\u6587\u7684\u601d\u8def</p> <p></p>"},{"location":"kotlin/coroutines/basic/b2/#_9","title":"\u53c2\u8003","text":"<ul> <li>Kotlin\u534f\u7a0b\u5165\u95e8</li> <li>\u7ebf\u7a0b\u4ecb\u7ecd Thread</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u534e\u4e3a\u4e91\u793e\u533a \u6398\u91d1</p>"},{"location":"kotlin/coroutines/basic/first/","title":"Kotlin\u534f\u7a0b\u5165\u95e8","text":"\u66f4\u65b0\u65e5\u671f 2021-9-22 <ul> <li>2021-9-22 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883 <ul> <li>IntelliJ IDEA 2021.2.2 (Community Edition)</li> <li>Kotlin: 212-1.5.10-release-IJ5284.40</li> </ul> <p>Kotlin\u534f\u7a0b\u7cfb\u5217\u76ee\u5f55</p> <ol> <li>Kotlin\u534f\u7a0b\u5165\u95e8 \u2014\u2014 \u7b2c\u4e00\u4e2a\u4f8b\u5b50\uff0c\u542f\u52a8\u534f\u7a0b</li> <li>Kotlin\u534f\u7a0b\u57fa\u7840 \u2014\u2014 \u963b\u585e\u4e0e\u975e\u963b\u585e\uff0c\u7b49\u5f85\uff0c\u4f5c\u7528\u57df\u6784\u5efa\u5668</li> <li>Kotlin\u534f\u7a0b\u53d6\u6d88\u4e0e\u8d85\u65f6 \u2014\u2014 \u53d6\u6d88\u7684\u6761\u4ef6\uff0c\u8d85\u65f6\u8bbe\u5b9a </li> </ol> <p></p> <p>\u4ecb\u7ecdKotlin\u4e2d\u7684\u534f\u7a0b\u3002\u7528\u4e00\u4e2a\u4f8b\u5b50\u6765\u5c55\u793a\u534f\u7a0b\u7684\u57fa\u672c\u7528\u6cd5\u3002</p>"},{"location":"kotlin/coroutines/basic/first/#_1","title":"\u7b2c\u4e00\u4e2a\u4f8b\u5b50","text":""},{"location":"kotlin/coroutines/basic/first/#_2","title":"\u65b0\u5efa\u5de5\u7a0b","text":"<p>\u6211\u4eec\u4f7f\u7528\u7684\u662f\u793e\u533a\u7248IntelliJ IDEA 2021.2.2\u3002\u65b0\u5efa\u4e00\u4e2aKotlin\u5de5\u7a0b\u7528\u6765\u6d4b\u8bd5\u3002</p> \u65b0\u5efa\u5de5\u7a0b <p></p>"},{"location":"kotlin/coroutines/basic/first/#_3","title":"\u5f15\u5165\u534f\u7a0b","text":"<p>\u9879\u76ee\u7528gradle\u8fdb\u884c\u7ba1\u7406\uff0c\u6211\u4eec\u5728Github\u4e0a\u627e\u5230\u534f\u7a0b\u7684\u4f9d\u8d56\u3002</p> <pre><code>dependencies {\n    implementation(\"org.jetbrains.kotlinx:kotlinx-coroutines-core:1.5.2\")\n}\n</code></pre> <p>\u4fee\u6539\u9879\u76ee\u7684gradle\u914d\u7f6e\u3002\u628a\u4f9d\u8d56\u6dfb\u52a0\u8fdb\u53bb\u3002</p> gradle <p></p>"},{"location":"kotlin/coroutines/basic/first/#_4","title":"\u4ee3\u7801\u793a\u4f8b","text":"<p>\u521b\u5efa\u4e00\u4e2a\u7c7b\u7136\u540e\u5728<code>main</code>\u65b9\u6cd5\u4e2d\u5199\u534f\u7a0b\u7684\u76f8\u5173\u4ee3\u7801\u3002</p> <pre><code>import kotlinx.coroutines.GlobalScope\nimport kotlinx.coroutines.delay\nimport kotlinx.coroutines.launch\n\nfun main() {\n    GlobalScope.launch { // \u5728\u540e\u53f0\u542f\u52a8\u4e00\u4e2a\u65b0\u7684\u534f\u7a0b\u5e76\u7ee7\u7eed\n        delay(300)       // \u7b49\u5f85300\u6beb\u79d2\n        \"rustfisher.com\".forEach {\n            print(it)\n            delay(200)   // \u6bcf\u6b21\u6253\u5370\u90fd\u7b49\u5f85\u4e00\u4e0b\n        }\n    }\n    println(\"RustFisher\")\n    Thread.sleep(3000) // \u963b\u585e\u4e3b\u7ebf\u7a0b\u9632\u6b62\u8fc7\u5feb\u9000\u51fa\n}\n</code></pre> \u4ee3\u7801\u8fd0\u884c\u7ed3\u679c <p></p> <p>\u672c\u8d28\u4e0a\uff0c\u534f\u7a0b\u662f\u8f7b\u91cf\u7ea7\u7684\u7ebf\u7a0b\u3002</p> <p>\u6211\u4eec\u7528GlobalScope\u542f\u52a8\u4e86\u4e00\u4e2a\u65b0\u7684\u534f\u7a0b\uff0c\u8fd9\u610f\u5473\u7740\u65b0\u534f\u7a0b\u7684\u751f\u547d\u5468\u671f\u53ea\u53d7\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u751f\u547d\u5468\u671f\u9650\u5236\u3002</p> <p>\u53ef\u4ee5\u5c06 <code>GlobalScope.launch { \u2026\u2026 }</code> \u66ff\u6362\u4e3a <code>thread { \u2026\u2026 }</code>\uff0c\u5e76\u5c06 <code>delay(\u2026\u2026)</code> \u66ff\u6362\u4e3a <code>Thread.sleep(\u2026\u2026)</code> \u8fbe\u5230\u540c\u6837\u76ee\u7684\u3002\u6ce8\u610f\u5bfc\u5165\u5305<code>kotlin.concurrent.thread</code></p> \u534f\u7a0b\u6362\u6210\u7ebf\u7a0b <pre><code>import java.lang.Thread.sleep\nimport kotlin.concurrent.thread\n\nfun main() {\n    thread {\n        sleep(300)\n        \"rustfisher.com\".forEach {\n            print(it)\n            sleep(200)\n        }\n    }\n    println(\"RustFisher\")\n    sleep(3000) // \u963b\u585e\u4e3b\u7ebf\u7a0b\u9632\u6b62\u8fc7\u5feb\u9000\u51fa\n}\n</code></pre> <p>\u5982\u679c<code>thread{}</code>\u4e2d\u542b\u6709<code>delay</code>\uff0c\u7f16\u8bd1\u5668\u4f1a\u62a5\u9519</p> delay\u62a5\u9519 <p>Suspend function 'delay' should be called only from a coroutine or another suspend function</p> <p>\u56e0\u4e3a<code>delay</code>\u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u6302\u8d77\u51fd\u6570\uff0c\u5b83\u4e0d\u4f1a\u9020\u6210\u7ebf\u7a0b\u963b\u585e\uff0c\u4f46\u662f\u4f1a\u6302\u8d77\u534f\u7a0b\uff0c\u5e76\u4e14\u53ea\u80fd\u5728\u534f\u7a0b\u4e2d\u4f7f\u7528\u3002</p> <p>\u81f3\u6b64\uff0c\u5c0f\u7ed3\u4e00\u4e0b\u7b2c\u4e00\u4e2a\u534f\u7a0b\u793a\u4f8b</p> <ul> <li>gradle\u5f15\u5165\u534f\u7a0b<code>kotlinx-coroutines-core</code></li> <li><code>GlobalScope.launch</code>\u542f\u52a8\u534f\u7a0b</li> <li>\u534f\u7a0b\u4e2d\u7684\u6302\u8d77\u51fd\u6570<code>delay(long)</code>\u53ef\u4ee5\u8fbe\u5230\u5ef6\u65f6\u7684\u6548\u679c\uff0c\u5e76\u4e14\u5b83\u53ea\u80fd\u5728\u534f\u7a0b\u4e2d\u4f7f\u7528</li> </ul>"},{"location":"kotlin/coroutines/basic/first/#_5","title":"\u534f\u7a0b\u6240\u5728\u7ebf\u7a0b","text":"<p>\u672c\u8d28\u4e0a\u534f\u7a0b\u662f\u8f7b\u91cf\u7ea7\u7684\u7ebf\u7a0b\u3002\u6211\u4eec\u89c2\u5bdf\u4e00\u4e0b\u534f\u7a0b\u6240\u5904\u7684\u7ebf\u7a0b\u4fe1\u606f\u3002</p> \u89c2\u5bdf\u7ebf\u7a0b\u4fe1\u606f <pre><code>import kotlinx.coroutines.GlobalScope\nimport kotlinx.coroutines.launch\nimport java.lang.Thread.sleep\n\nfun main() {\n    println(\"main\u7ebf\u7a0b\u4fe1\u606f ${Thread.currentThread().id}\")\n    for (i in 1..3) { // \u591a\u542f\u52a8\u51e0\u6b21\u534f\u7a0b\n        GlobalScope.launch {\n            println(\"\u534f\u7a0b\u542f\u52a8#$i \u6240\u5728\u7ebf\u7a0bid: ${Thread.currentThread().id}\")\n        }\n    }\n    sleep(2000) // \u963b\u585e\u4e3b\u7ebf\u7a0b\u9632\u6b62\u8fc7\u5feb\u9000\u51fa\n    println(\"RustFisher \u793a\u4f8b\u7ed3\u675f\")\n}\n</code></pre> \u8fd0\u884clog\u5982\u4e0b <pre><code>main\u7ebf\u7a0b\u4fe1\u606f 1\n\u534f\u7a0b\u542f\u52a8#1 \u6240\u5728\u7ebf\u7a0bid: 11\n\u534f\u7a0b\u542f\u52a8#3 \u6240\u5728\u7ebf\u7a0bid: 14\n\u534f\u7a0b\u542f\u52a8#2 \u6240\u5728\u7ebf\u7a0bid: 13\nRustFisher \u793a\u4f8b\u7ed3\u675f\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u591a\u6b21\u542f\u52a8\u534f\u7a0b\uff0c\u8fd9\u4e9b\u534f\u7a0b\u5b83\u4eec\u4e0d\u4e00\u5b9a\u5728\u540c\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u3002\u4e5f\u5c31\u662f\u8bf4\u6709\u5728\u540c\u4e00\u4e2a\u7ebf\u7a0b\u7684\u53ef\u80fd\u6027\u3002</p> <p>\u4e8e\u662f\u8bd5\u8bd5\u75af\u72c2\u5730\u542f\u52a8\u534f\u7a0b\uff0c\u628a\u5faa\u73af\u6b21\u6570\u52a0\u5927<code>for (i in 1..3000)</code>\u3002\u89c2\u5bdflog\u53ef\u4ee5\u770b\u51fa\uff0c\u6709\u91cd\u590d\u7684\u7ebf\u7a0bid\u3002</p> <p></p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u534e\u4e3a\u4e91\u793e\u533a \u6398\u91d1</p>"},{"location":"linux/shell/for-use/","title":"shell for \u5faa\u73af\u8bed\u53e5\u7684\u4f7f\u7528","text":"\u66f4\u65b0\u65e5\u671f 2023-5-24 <ul> <li>2023-5-24 \u589e\u52a0\u6309\u65e5\u671f\u521b\u5efa\u6587\u6863\u548c\u79fb\u52a8\u6587\u4ef6\u7684\u4f8b\u5b50</li> <li>2022-3-14 \u521b\u5efa\u6587\u6863</li> </ul> <p>Shell\u91cc\u7684for\u5faa\u73af\u8bed\u53e5\u5199\u6cd5\u3002\u6211\u4eec\u5206\u522b\u7528\u547d\u4ee4\u884c\u548cshell\u811a\u672c\u6765\u8fdb\u884c\u6f14\u793a\u3002</p> <p>\u5e38\u89c1\u7684\u4e00\u79cdfor\u7ed3\u6784\u5982\u4e0b\u3002for\u91cc\u9762\u8981\u8ddf\u7740<code>do</code>\u548c<code>done</code>\u5173\u952e\u5b57\u3002</p> <pre><code>for i in {1..3}\ndo\n    echo YES $i # \u8fd9\u91cc\u662f\u5faa\u73af\u4f53\ndone\n</code></pre>","tags":["Linux"]},{"location":"linux/shell/for-use/#_1","title":"\u6570\u5b57\u8303\u56f4","text":"<p>\u6570\u5b57\u8303\u56f4\uff0c\u4f8b\u5982\u4ece1\u52303\uff0c\u4ece1\u5230100\u3002</p>","tags":["Linux"]},{"location":"linux/shell/for-use/#for-in","title":"for in","text":"<p>for in \u7684\u5199\u6cd5\uff0c\u5b9a\u4e49<code>i</code>\u4e3a\u53d8\u91cf\uff0c\u4f7f\u7528\u5927\u62ec\u53f7\u6765\u6307\u5b9a\u8303\u56f4\u3002\u8303\u56f4\u7684\u6570\u5b57\u4e4b\u95f4\u67092\u4e2a\u70b9<code>..</code>\u3002\u4f8b\u5982<code>{1..3}</code> <pre><code>$ for i in {1..3};do echo now is $i; done\nnow is 1\nnow is 2\nnow is 3\n</code></pre> \u4e0a\u9762\u662f\u547d\u4ee4\u884c\uff0c\u4e00\u884c\u628a\u6240\u6709\u7684\u6307\u4ee4\u5199\u5b8c\u3002\u4e5f\u53ef\u4ee5\u518d\u52a0\u4e00\u884c\u4ee3\u7801\uff0c\u540c\u6837\u7528\u5206\u53f7<code>;</code>\u6765\u5206\u9694\u3002 <pre><code>$ for i in {1..3};do echo now is $i;echo rustfisher.com; done\nnow is 1\nrustfisher.com\nnow is 2\nrustfisher.com\nnow is 3\nrustfisher.com\n</code></pre></p> <p>\u6216\u8005\u5199\u6210\u811a\u672c\u3002\u5176\u5b9e\u5c31\u662f\u62c6\u6210\u51e0\u884c\u3002 <pre><code>#!/bin/bash  \n\nfor i in {1..3}\ndo\n    echo now is $i\n    echo rustfisher.com\ndone\n</code></pre></p> <p>\u524d\u9762\u6211\u4eec\u7528\u7684\u662f\u5927\u62ec\u53f7\u6765\u6307\u5b9a\u5faa\u73af\u8303\u56f4\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u7528<code>$(seq 1 3)</code>\u3002 \u5f00\u5934\u4f9d\u65e7\u662f<code>for i in</code> <pre><code>$ for i in $(seq 1 3);do echo now is $i;echo rustfisher.com; done\nnow is 1\nrustfisher.com\nnow is 2\nrustfisher.com\nnow is 3\nrustfisher.com\n</code></pre></p> <p>\u5199\u6210\u811a\u672c\u5982\u4e0b <pre><code>#!/bin/bash  \n\nfor i in $(seq 1 3)\ndo \n    echo now is $i\n    echo rustfisher.com\ndone\n</code></pre></p> <p>\u5b9e\u9645\u4e0a\u6211\u4eec\u4f7f\u7528\u4e86<code>seq</code>\u547d\u4ee4\u3002seq\u540e\u9762\u63a52\u4e2a\u6570\u5b57\uff0c\u53ef\u4ee5\u8f93\u51fa\u8fd9\u4e2a\u8303\u56f4\u5185\u7684\u6570\u5b57\u3002 <pre><code>$ seq 1 5\n1\n2\n3\n4\n5\n~ $ seq 5 1\n5\n4\n3\n2\n1\n</code></pre></p>","tags":["Linux"]},{"location":"linux/shell/for-use/#fori1i3i","title":"for((i=1;i&lt;=3;i++))","text":"<p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u5199\u6210\u50cfJava/C\u8bed\u8a00\u91cc\u7684for\u5faa\u73af\u90a3\u6837\u3002\u4f46\u8981\u6ce8\u610f\u8fd9\u91cc\u7684for\u67092\u5c42\u5c0f\u62ec\u53f7\u3002 <pre><code>$ for((i=1;i&lt;=3;i++));do echo -n now is [$i] ;echo rustfisher.com; done\nnow is [1]rustfisher.com\nnow is [2]rustfisher.com\nnow is [3]rustfisher.com\n</code></pre></p> <p>\u66f4\u6539\u4e00\u4e0b\u6b65\u8fdb\u503c\uff0c\u6539\u4e3a<code>i+=2</code> <pre><code>for((i=1;i&lt;=3;i+=2));do echo -n now is [$i] ;echo rustfisher.com; done\nnow is [1]rustfisher.com\nnow is [3]rustfisher.com\n</code></pre></p> <p>\u6216\u8005\u52a0\u4e0a\u4e00\u4e9b\u5c0f\u8fd0\u7b97\uff0c\u7528<code>expr</code>\u52a0\u4e0a\u6211\u4eec\u60f3\u8981\u7684\u8fd0\u7b97\u3002\u6ce8\u610f<code>$i</code>\u4e0e<code>\\*</code>\u548c<code>3</code>\u4e4b\u95f4\u8981\u6709\u7a7a\u683c\u3002 <pre><code>$ for((i=1;i&lt;=3;i+=2));do echo -n $(expr $i \\* 3) ' ' ;echo rustfisher.com; done\n3  rustfisher.com\n9  rustfisher.com\n</code></pre> \u540e\u9762\u52a0\u7684\u7a7a\u683c\u662f\u4e3a\u4e86\u9694\u5f00\u597d\u770b\u4e00\u4e9b\u3002</p> <p>\u5728shell\u811a\u672c\u4e2d\uff0c\u6211\u4eec\u6709\u65f6\u5019\u4f1a\u5b9a\u4e49\u53d8\u91cf\u3002\u53d8\u91cf\u4e5f\u53ef\u4ee5\u4f5c\u4e3afor\u5faa\u73af\u7684\u8303\u56f4\u3002 <pre><code>#!/bin/bash  \n\nstartNum=1\nendNum=3\n\nfor i in $(seq $startNum $endNum)\ndo\n    echo current is $i\ndone\n</code></pre> \u6211\u4eec\u5b9a\u4e492\u4e2a\u53d8\u91cf<code>startNum</code>\u4e0e<code>endNum</code>\u3002\u8981\u4f7f\u7528\u5b83\u4eec\u7684\u503c\u65f6\uff0c\u9700\u8981\u52a0\u4e0a<code>$</code>\u7b26\u53f7\u3002</p>","tags":["Linux"]},{"location":"linux/shell/for-use/#_2","title":"\u5b57\u7b26\u5faa\u73af","text":"<p>for\u5faa\u73af\u53ef\u4ee5\u4e0e\u4e00\u4e9b\u6307\u4ee4\u7ed3\u5408\u8d77\u6765\uff0c\u83b7\u53d6\u6307\u4ee4\u4e2d\u7684\u7ed3\u679c\u3002</p>","tags":["Linux"]},{"location":"linux/shell/for-use/#for-i-in-ls","title":"for i in <code>ls</code>","text":"<p>\u5148\u7528\u547d\u4ee4\u884c\u770b\u4e00\u4e2a\u6548\u679c\uff0cfor\u4e0els\u7ed3\u5408\u4f7f\u7528 <pre><code>$ for i in `ls`; do echo $i ; done\nfor1.sh\n</code></pre> \u5f53\u524d\u76ee\u5f55\u91cc\u53ea\u67091\u4e2a\u6587\u4ef6\u3002</p> <p>\u5982\u679c\u662f<code>ls -a</code>\u547d\u4ee4\uff0c\u8f93\u51fa\u4f1a\u66f4\u591a\u3002 <pre><code>$ for i in `ls -a`; do echo $i ; done\n.\n..\nfor1.sh\n</code></pre></p> <p>\u6362\u4e00\u4e2a\u76ee\u5f55\uff0c\u6211\u4eec\u53ef\u4ee5\u8f93\u51fa\u6240\u6709png\u6587\u4ef6\u7684\u6587\u4ef6\u540d <pre><code>$ for i in `ls *.png`; do echo $i ; done\nandroid-cover-2.png\nfish.png\nic_book_blue.png\nic_tools_gear.png\nic_web.png\nkotlin-android-1.png\npython-logo.png\nts-blue-1.png\n</code></pre></p>","tags":["Linux"]},{"location":"linux/shell/for-use/#for-i-in-ll","title":"for i in <code>ll</code>","text":"<p>\u6362\u6210<code>ll</code>\u547d\u4ee4\uff0c\u8f93\u51fa\u66f4\u52a0\u4e30\u5bcc <pre><code>$ for i in `ll`; do echo $i ; done\ntotal\n8\n-rw-r--r--\n1\nrustfisher\nstaff\n183\n6\n19\n21:25\nfor1.sh\n</code></pre></p> <p>\u6211\u4eec\u77e5\u9053<code>ll</code>\u547d\u4ee4\u4f1a\u8f93\u51fa\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u4fe1\u606f <pre><code>$ ll\ntotal 8\n-rw-r--r--  1 rustfisher  staff  183  6 19 21:25 for1.sh\n</code></pre></p> <p>\u7ed3\u5408for\u5faa\u73af\u53ef\u4ee5\u770b\u51fa\uff0cfor\u5faa\u73af\u662f\u83b7\u53d6\u4e86\u7a7a\u683c\u6216\u6362\u884c\u4e3a\u95f4\u9694\u7684\u5b57\u7b26\u4e32\u3002</p> <p>\u663e\u793a\u5404\u4e2a\u5b50\u76ee\u5f55\u91ccmd\u6587\u4ef6\u7684\u4e2a\u6570 <pre><code>for i in `ls`; do echo $i; find $i -name \"*.md\" | wc -l; done\n</code></pre></p>","tags":["Linux"]},{"location":"linux/shell/for-use/#_3","title":"\u5b57\u7b26\u4e32\u53d8\u91cf","text":"<p>\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5728\u811a\u672c\u4e2d\u5c1d\u8bd5\u4e00\u4e9b\uff0cfor\u5faa\u73af\u914d\u5408\u5b57\u7b26\u4e32 <pre><code>#!/bin/bash  \n\nword=\"Welcome      to rustfisher.com\"\nfor i in $word\ndo\n    echo $i\ndone\n</code></pre></p> <p><code>word</code>\u4e2d\u95f4\u6709\u5f88\u591a\u4e2a\u7a7a\u683c\uff0c\u4f46\u8f93\u51fa\u7684\u4f9d\u65e7\u662f\u8fd93\u884c\u3002 <pre><code>Welcome\nto\nrustfisher.com\n</code></pre></p> <p>\u8fdb\u4e00\u6b65\u6269\u5c55\uff0c\u5b9a\u4e493\u4e2a\u53d8\u91cf\uff0c\u90fd\u4f5c\u4e3afor in\u7684\u53c2\u6570 <pre><code>#!/bin/bash  \n\nword1=\"Welcome        to rustfisher.com\"\nword2=\"Hello world\"\nword3=\"\u6211\u5f88\u597d\"\nfor i in $word1 $word2 $word3\ndo\n    echo $i\ndone\n</code></pre></p> <p>\u8f93\u51fa <pre><code>Welcome\nto\nrustfisher.com\nHello\nworld\n\u6211\u5f88\u597d\n</code></pre></p>","tags":["Linux"]},{"location":"linux/shell/for-use/#_4","title":"\u76ee\u5f55","text":"<p>\u4f8b\u5982\u67e5\u627e\u67d0\u4e2a\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u3002</p> <p>\u5f53\u524d\u76ee\u5f55\u4e2d\u6709\u4e00\u4e2aimg\u76ee\u5f55\uff0c\u91cc\u9762\u6709\u4e00\u4e9b\u56fe\u7247\u3002\u6211\u4eec\u5728for in \u540e\u9762\u7528<code>img/*</code>\u6765\u8868\u793a\u67e5\u627e\u8fd9\u4e2a\u76ee\u5f55\u4e2d\u6240\u6709\u6587\u4ef6\u3002 <pre><code>$ for i in img/*; do echo $i ; done\nimg/android-2botsm.jpg\nimg/android-cover-2.png\n</code></pre></p> <p>\u5982\u679c\u53ea\u60f3\u770bpng\u6587\u4ef6\uff0c\u8def\u5f84\u5199\u4e3a<code>img/*.png</code>\u3002 <pre><code>$ for i in img/*.png; do echo $i ; done\nimg/android-cover-2.png\n</code></pre></p> <p>\u4ece\u4e0a\u9762\u7684\u4f8b\u5b50\u53ef\u4ee5\u770b\u51fa\uff0cfor in\u7ed3\u6784\u7528\u7684\u5341\u5206\u9891\u7e41\u3002</p>","tags":["Linux"]},{"location":"linux/shell/for-use/#_5","title":"\u6279\u91cf\u521b\u5efa\u76ee\u5f55","text":"<p>\u6bd4\u5982\u6309\u65e5\u671f\u6765\u521b\u5efa\u76ee\u5f55\uff0c\u4e0b\u9762\u4f8b\u5b50\u7ed95\u6708\u6bcf\u4e00\u5929\u90fd\u5efa\u4e00\u4e2a\u76ee\u5f55 <pre><code>for i in {1..31}; do mkdir -p 2023-05-$(printf \"%02d\" $i); done\n</code></pre></p>","tags":["Linux"]},{"location":"linux/shell/for-use/#_6","title":"\u6279\u91cf\u79fb\u52a8\u6587\u4ef6\u5230\u6587\u4ef6\u5939\u91cc","text":"<p>\u4f8b\u5982\u6587\u4ef6\u540d\u4e2d\u5e26\u6709\u65e5\u671f\u4fe1\u606f\uff0c\u628a5\u6708\u67d0\u5929\u7684\u6587\u4ef6\u79fb\u52a8\u5230\u5bf9\u5e94\u65e5\u671f\u7684\u76ee\u5f55\u4e2d <pre><code>for i in {1..31}; do mv *_202305$(printf \"%02d\" $i)* 2023-05-$(printf \"%02d\" $i); done\n</code></pre></p>","tags":["Linux"]},{"location":"linux/usr/awk-use/","title":"Linux awk","text":"\u66f4\u65b0\u65e5\u671f 2022-3-9 <ul> <li>2022-3-9 \u66f4\u65b0\u8bf4\u660e</li> <li>2015-12-16 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u7528awk\u6765\u7edf\u8ba1\u67d0\u4e2a\u6587\u672c\u4e2d\u5355\u8bcd\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u5e76\u4ee5\u4e00\u5b9a\u7684\u683c\u5f0f\u8f93\u51fa\u7ed3\u6784</p>","tags":["Linux"]},{"location":"linux/usr/awk-use/#_1","title":"\u7528\u6cd5\u4ecb\u7ecd","text":"<p>\u901a\u5e38\uff0cawk\u9010\u884c\u5904\u7406\u6587\u672c\u3002awk\u6bcf\u63a5\u6536\u6587\u4ef6\u7684\u4e00\u884c\uff0c\u7136\u540e\u6267\u884c\u76f8\u5e94\u7684\u547d\u4ee4\u6765\u5904\u7406\u3002</p> <p>\u7528legal\u6587\u4ef6\u6765\u505a\u793a\u4f8b <pre><code>$ cat /etc/legal\n\nThe programs included with the Ubuntu system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\nUbuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by\napplicable law.\n</code></pre></p> <p>\u6ca1\u6709\u8fd9\u4e2a\u6587\u4ef6\u7684\u8bdd\u7528<code>/etc/bashrc</code>\u4e5f\u884c\uff0c\u6216\u8005\u5176\u4ed6\u6587\u4ef6</p>","tags":["Linux"]},{"location":"linux/usr/awk-use/#law","title":"\u641c\u7d22\u7edf\u8ba1\u5355\u8bcd\u201claw\u201d\u7684\u4e2a\u6570","text":"<pre><code>$ awk -F : '/law/{count++} END{print \"the count is \",count}' /etc/legal\nthe count is  1\n</code></pre> <p><code>count</code>\u7528\u6765\u8ba1\u6570</p> <p><code>END</code> \u8868\u793a\u641c\u7d22\u5b8c\u6bd5\u540e\u6267\u884c\u7684\u547d\u4ee4</p>","tags":["Linux"]},{"location":"linux/usr/awk-use/#the","title":"\u7edf\u8ba1\u5355\u8bcd\u201cthe\u201d\u7684\u4e2a\u6570","text":"<p><pre><code>$ awk -F : '/the/{count++} END{print \"the count is \",count}' /etc/legal\nthe count is  3\n</code></pre> \u627e\u5230\u6307\u5b9a\u5355\u8bcd\uff0c\u81ea\u5b9a\u4e49\u53d8\u91cf<code>count</code>\u81ea\u589e\uff0c\u6700\u540e\u8f93\u51fa\u8bed\u53e5\u548ccount\u503c</p> <p>\u547d\u4ee4sort\uff0c\u628a\u5404\u884c\u6309\u9996\u5b57\u6bcd\u6392\u5217\u987a\u5e8f\u91cd\u65b0\u6392\u5217\u8d77\u6765</p> <ul> <li><code>sort -nr</code>\uff0c\u6bcf\u884c\u90fd\u4ee5\u6570\u5b57\u5f00\u5934\uff0c\u6309\u6570\u5b57\u4ece\u8fbe\u5230\u5c0f\uff0c\u6392\u5217\u5404\u884c</li> <li><code>uniq -c</code>\uff0c\u7edf\u8ba1\u5404\u884c\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u5e76\u628a\u6b21\u6570\u6253\u5370\u5728\u6bcf\u884c\u524d\u7aef</li> <li>awk\u53c2\u6570 <code>NF</code> \uff0c\u6d4f\u89c8\u8bb0\u5f55\u7684\u57df\u7684\u4e2a\u6570</li> </ul> <p><code>awk</code>\uff0c<code>uniq</code>\u548c<code>sort</code>\u547d\u4ee4\u7ed3\u5408\u8d77\u6765\u4f7f\u7528\uff0c\u4e2d\u95f4\u9700\u8981\u7528\u7ad6\u7ebf<code>|</code>\uff0c\u6574\u4f53\u5982\u4e0b <pre><code>awk -F' ' '{for(i=1;i&lt;=NF;i=i+1){print $i}}' /etc/legal |\nsort|uniq -c|sort -nr|awk -F' ' '{printf(\"%s %s\\n\",$2,$1)}'\n</code></pre> \u7edf\u8ba1<code>/etc/legal</code>\u4e2d\u5355\u8bcd\u51fa\u73b0\u6b21\u6570\uff0c\u5e76\u4ee5\u201c\u5355\u8bcd \u6b21\u6570\u201d\u683c\u5f0f\u8f93\u51fa\u7ed3\u679c</p>","tags":["Linux"]},{"location":"linux/usr/curl-use/","title":"Linux curl \u4f7f\u7528","text":"\u66f4\u65b0\u65e5\u671f: 2022-09-30 <ul> <li>2022-09-30 \u589e\u52a0\u793a\u4f8b</li> <li>2022-08-16 \u521b\u5efa\u6587\u6863</li> </ul>","tags":["Linux"]},{"location":"linux/usr/curl-use/#_1","title":"\u4f7f\u7528\u65b9\u6cd5","text":"","tags":["Linux"]},{"location":"linux/usr/curl-use/#get","title":"GET\u8bf7\u6c42","text":"<p>\u9ed8\u8ba4\u662fGET\u8bf7\u6c42</p> <p>\u4f8b\u5982 <pre><code>curl www.baidu.com\n\n&lt;!DOCTYPE html&gt;\n&lt;!--STATUS OK--&gt;&lt;html&gt; &lt;head&gt;&lt;meta http-equiv=content-type content=text/html;charset=utf-8&gt;&lt;meta http-equiv=X-UA-Compatible content=IE=Edge&gt;&lt;meta content=always name=referrer&gt;&lt;link rel=stylesheet type=text/css............\n</code></pre></p>","tags":["Linux"]},{"location":"linux/usr/curl-use/#post","title":"POST\u8bf7\u6c42","text":"<p>POST\u65b9\u6cd5\u9700\u8981\u52a0\u4e0a<code>-X 'POST'</code>\u3002</p> <p>\u4f8b\u5982\u4e0b\u9762\u7684POST\u8bf7\u6c42 <pre><code>curl -X 'POST' \\\n  'http://1.2.3.4:86/api/v1/an/rustfisher/com' \\\n  -H 'accept: */*' \\\n  -H 'Content-Type: application/json-patch+json' \\\n  -H 'Authorization: Bearer &lt;\u4f60\u7684token&gt;' \\\n  -d '{&lt;\u4f60\u7684\u53c2\u6570&gt;}'\n</code></pre></p>","tags":["Linux"]},{"location":"linux/usr/curl-use/#-i","title":"\u67e5\u770b\u54cd\u5e94\u4fe1\u606f -I","text":"<p>\u4f8b\u5982\u67e5\u770bAccept-Ranges\uff0cContent-Length\uff0cContent-Type \u7b49\u7b49\u54cd\u5e94\u4fe1\u606f <pre><code>curl -I baidu.com\nHTTP/1.1 200 OK\nDate: Fri, 30 Sep 2022 09:45:20 GMT\nServer: Apache\nLast-Modified: Tue, 12 Jan 2010 13:48:00 GMT\nETag: \"51-47cf7e6ee8400\"\nAccept-Ranges: bytes\nContent-Length: 81\nCache-Control: max-age=86400\nExpires: Sat, 01 Oct 2022 09:45:20 GMT\nConnection: Keep-Alive\nContent-Type: text/html\n</code></pre></p>","tags":["Linux"]},{"location":"linux/usr/curl-use/#_2","title":"\u7528\u4f8b","text":"<p>\u4e00\u4e9b\u5e38\u89c1\u7684\u4f8b\u5b50</p>","tags":["Linux"]},{"location":"linux/usr/curl-use/#ip","title":"\u67e5\u770bIP\u4fe1\u606f","text":"<p>\u8bbf\u95eecip.cc\u67e5\u770b\u672c\u5730IP\u4fe1\u606f</p> \u67e5\u770bIP\u4fe1\u606f<pre><code>curl cip.cc\n</code></pre> \u8fd4\u56de\u4fe1\u606f<pre><code>IP  : 1.2.3.4\n\u5730\u5740  : \u4e2d\u56fd  an.rustfisher.com\n\u8fd0\u8425\u5546 : \u7535\u4fe1\n\n\u6570\u636e\u4e8c : xx\u5e02 | \u7535\u4fe1\n\n\u6570\u636e\u4e09 : \n\nURL : http://www.cip.cc/1.2.3.4\n</code></pre>","tags":["Linux"]},{"location":"linux/usr/find-use/","title":"linux find","text":"\u66f4\u65b0\u65e5\u671f 2022-3-17 <ul> <li>2022-3-17 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u8bb0\u5f55\u5f88\u591a\u5e38\u7528\u7684find\u4f7f\u7528\u65b9\u5f0f</p> <pre><code>usage: find [-H | -L | -P] [-EXdsx] [-f path] path ... [expression]\n       find [-H | -L | -P] [-EXdsx] -f path [path ...] [expression]\n</code></pre> <p>\u6bd4\u5982\u8fd9\u6837\u4f1a\u627e\u51fa\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6 <pre><code>find .\n</code></pre></p> <p>\u627e\u4ee5<code>.txt</code>\u4e3a\u7ed3\u5c3e\u7684\u6587\u4ef6\uff08\u627etxt\u6587\u4ef6\uff09 <pre><code>find . -name *.txt\n</code></pre></p> <p>\u627e\u5230\u6587\u4ef6\u540e\u6267\u884c\u7279\u5b9a\u64cd\u4f5c\uff0c\u9700\u8981\u7528\u4e0a<code>-exec</code></p> <p>\u6bd4\u5982\u5220\u9664\uff5e\u7ed3\u5c3e\u7684\u6587\u4ef6 <pre><code>find . -name \"*~\" -type f -print -exec rm -rf {} \\;\n</code></pre></p> <p>\u5220\u9664\u6587\u4ef6\u540d\u6709\u7279\u5b9a\u5b57\u7b26\u7684\u6587\u4ef6 <pre><code>find . -name \"*abcd*\" -exec rm -f {} \\;\n</code></pre></p> <p>\u4fee\u6539\u6267\u884c\u547d\u4ee4\u548c\u6587\u4ef6\u7c7b\u578b\uff0c\u5b89\u88c5\u76ee\u5f55\u4e0b\u6240\u6709apk\u6587\u4ef6 <pre><code>find . -name \"*.apk\" -type f -print -exec adb install {} \\;\n</code></pre></p> <p>\u627e\u5230\u6240\u6709\u7684json\u6587\u4ef6\u5e76\u4e14\u5220\u9664 <pre><code>find . -name \"*.json\" -exec rm {} \\;\n</code></pre></p> <p>\u5220\u9664\u6307\u5b9a\u76ee\u5f55\uff0c\u6bd4\u5982\u5220\u9664\u6240\u6709\u7684git\u76ee\u5f55 <pre><code>find . -type d -iname \".git\" -exec rm -rf {} \\;\n</code></pre> <code>-type d</code>\u610f\u601d\u662f\u6307\u5b9a\u7c7b\u578b\u4e3a\u76ee\u5f55\uff08\u6587\u4ef6\u5939\uff09</p> <p>\u627e\u5230\u5f53\u524d\u76ee\u5f55\u4e0b\u6240\u6709\u7684apk\u5e76\u5b89\u88c5 <pre><code>find . -name \"*.apk\" -exec adb install {} \\;\n</code></pre></p>","tags":["Linux"]},{"location":"linux/usr/grep-use/","title":"Linux grep","text":"\u66f4\u65b0\u65e5\u671f 2022-3-10 <ul> <li>2022-3-14 \u66f4\u65b0\u7528\u4f8b</li> <li>2022-3-10 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u901a\u5e38\u6211\u4eec\u53ef\u4ee5\u8fd9\u6837\u7528 <pre><code>grep -nr \"\u9700\u8981\u641c\u7d22\u7684\u6587\u672c\" .\n</code></pre></p> <p>\u5728\u5f53\u524d\u76ee\u5f55\u548c\u5b50\u76ee\u5f55\u641c\u7d22\u60f3\u8981\u7684\u6587\u672c\u3002\u6700\u540e\u7684\u90a3\u4e2a\u70b9<code>.</code>\u5373\u8868\u793a\u5f53\u524d\u76ee\u5f55\u3002</p> <p><code>-nr</code> \u4e2d\uff1a</p> <ul> <li><code>n</code> \u8868\u793a\u663e\u793a\u884c\u6570</li> <li><code>r</code> \u8868\u793a\u9012\u5f52\uff0c\u5373\u641c\u7d22\u5b50\u76ee\u5f55</li> </ul>","tags":["Linux"]},{"location":"linux/usr/grep-use/#grep","title":"grep \u641c\u7d22\uff0c\u600e\u6837\u6392\u9664\u67d0\u4e9b\u76ee\u5f55\uff1f","text":"<p>\u4f7f\u7528 <code>--exclude-dir</code> \u9009\u9879\u3002</p> <p>\u8bed\u6cd5: <pre><code>--exclude-dir=DIR\n</code></pre></p> <p>Exclude directories matching the pattern DIR from recursive searches.</p>","tags":["Linux"]},{"location":"linux/usr/grep-use/#_1","title":"\u5355\u4e2a\u76ee\u5f55\u793a\u4f8b","text":"<p><code>-R</code>\u662f\u8868\u793a\u542f\u7528\u6b63\u5219 <pre><code>grep -E \"http\"  ./ -R --exclude-dir=.git\n</code></pre></p>","tags":["Linux"]},{"location":"linux/usr/grep-use/#_2","title":"\u591a\u4e2a\u76ee\u5f55\u793a\u4f8b","text":"<pre><code>grep -E \"http\"  . -R --exclude-dir={.git,res,bin}\n</code></pre>","tags":["Linux"]},{"location":"linux/usr/grep-use/#_3","title":"\u591a\u4e2a\u6587\u4ef6\u793a\u4f8b","text":"","tags":["Linux"]},{"location":"linux/usr/grep-use/#java-js","title":"\u6392\u9664\u6269\u5c55\u540d\u4e3a java \u548c js \u7684\u6587\u4ef6","text":"<pre><code>grep -E \"http\"  . -R --exclude=*.{java,js}\n</code></pre>","tags":["Linux"]},{"location":"linux/usr/grep-use/#javamd-js","title":"\u6392\u9664\u6269\u5c55\u540d\u4e3a java\uff0cmd~ \u548c js \u7684\u6587\u4ef6","text":"<p><pre><code>~/wd/rustNote/Linux_note$ grep -E DIR -R --exclude=*.{java,js,md~}\ngrep_note.md:    --exclude-dir=DIR\ngrep_note.md:       Exclude directories matching the pattern DIR from recursive searches.\n</code></pre> \u6392\u9664\u6269\u5c55\u540d\u4e3ajava\uff0c js \u548c md~ \u7684\u6587\u4ef6</p> <p>\u6392\u9664\u4e00\u4e9b\u6587\u4ef6\uff0c\u5e76\u4e14\u663e\u793a\u884c\u53f7<code>-n</code> <pre><code>grep -n -E \"org/webrtc/\" . -R --exclude=*.{java,ninja,TOC,so,o,jar}\n</code></pre></p>","tags":["Linux"]},{"location":"linux/usr/grep-use/#linux-unix-grep","title":"\u5982\u4f55\u5728 Linux \u7cfb\u7edf\u548c\u7c7b Unix \u7684\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u4f7f\u7528\u5e26\u6b63\u5219\u8868\u8fbe\u5f0f\u7684 grep \u547d\u4ee4\u5462\uff1f","text":"<p>Linux \u7cfb\u7edf\u81ea\u5e26\u4e86\u652f\u6301\u62d3\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u7684 GNU \u7248\u672c grep \u5de5\u5177\u3002\u6240\u6709\u7684 Linux \u7cfb\u7edf\u4e2d\u9ed8\u8ba4\u5b89\u88c5\u7684\u90fd\u662f GNU \u7248 grep \u3002 grep \u547d\u4ee4\u88ab\u7528\u6765\u68c0\u7d22\u4e00\u53f0\u670d\u52a1\u5668\u6216\u5de5\u4f5c\u7ad9\u4e0a\u4efb\u4f55\u4f4d\u7f6e\u7684\u6587\u672c\u4fe1\u606f\u3002</p>","tags":["Linux"]},{"location":"linux/usr/grep-use/#_4","title":"\u5feb\u901f\u4e86\u89e3\u6b63\u5219\u8868\u8fbe\u5f0f","text":"","tags":["Linux"]},{"location":"linux/usr/grep-use/#_5","title":"\u5982\u4f55\u5339\u914d\u4f60\u8981\u67e5\u627e\u7684\u5185\u5bb9\uff1f","text":"<p>\u6b63\u5219\u8868\u8fbe\u5f0f\u53ea\u4e0d\u8fc7\u662f\u6bcf\u4e2a\u8f93\u5165\u884c\u5339\u914d\u7684\u6a21\u5f0f\u3002\u6a21\u5f0f\u662f\u4e00\u4e2a\u5b57\u7b26\u5e8f\u5217\u3002\u4e0b\u9762\u90fd\u662f\u8303\u4f8b\uff1a</p> <p>\u4f8b\u5982\uff1a<code>^w1\u201d\u3001\u201cw1|w2\u201d\u3001\u201c[^ ]</code>\u3002</p> <p>\u5728 <code>/etc/passswd</code> \u4e2d\u68c0\u7d22 <code>vivek</code> \uff1a <code>grep vivek /etc/passwd</code></p> <p>\u8f93\u51fa\u7ed3\u679c\u6848\u4f8b\uff1a <pre><code>vivek:x:1000:1000:Vivek Gite,,,:/home/vivek:/bin/bash\nvivekgite:x:1001:1001::/home/vivekgite:/bin/sh\ngitevivek:x:1002:1002::/home/gitevivek:/bin/sh\n</code></pre> \u5728\u4efb\u4f55\u60c5\u51b5\u4e0b\u90fd\u641c\u7d22 \u2018vivek\u2019  (\u5373\u4e0d\u533a\u5206\u5927\u5c0f)\uff1a<code>grep -i -w vivek /etc/passwd</code> \u4e0d\u533a\u5206\u5927\u5c0f\u5199\u5730\u68c0\u7d22 \u2018vivek\u2019 \u548c \u2018raj\u2019 \uff1a <code>grep -E -i -w 'vivek|raj' /etc/passwd</code> \u5728\u6700\u540e\u4e00\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u4f7f\u7528\u4e86\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u6a21\u5f0f\u3002</p> <p>\u56fa\u5b9a\u68c0\u7d22\u5185\u5bb9\u7684\u4f4d\u7f6e\uff1a \u4f60\u53ef\u4ee5\u4f7f\u7528 ^ \u548c $ \u7b26\u53f7\u5f3a\u5236\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\u5206\u522b\u5339\u914d\u4e00\u884c\u7684\u5f00\u59cb\u6216\u7ed3\u675f\u7684\u4f4d\u7f6e\u3002 \u4e0b\u9762\u7684\u793a\u4f8b\u663e\u793a\u4ee5 \u2018vivek\u2019 \u5f00\u5934\u7684\u6587\u672c\uff1a <code>grep ^vivek /etc/passwd</code> \u8f93\u51fa\u7ed3\u679c\u793a\u4f8b\uff1a <pre><code>vivek:x:1000:1000:Vivek Gite,,,:/home/vivek:/bin/bash\nvivekgite:x:1001:1001::/home/vivekgite:/bin/sh\n</code></pre></p> <p>\u4ee5<code>#!</code>\u5f00\u5934\u7684\u884c <pre><code>rustfisher@rust-pc:~/note/Linux_note$ grep '^#!' *\norganize_so_names.sh:#! /bin/sh\nsort_ranking_solution.md:#! /bin/sh\n</code></pre></p> <p>\u4f60\u53ef\u4ee5\u53ea\u663e\u793a\u4ee5 vivek \u5f00\u5934\u7684\u6587\u672c\u884c\u3002\u4e3e\u4f8b\u8bf4\u5c31\u662f\u4e0d\u663e\u793a vivekgite , vivekg \u8fd9\u6837\u5355\u8bcd\u5f00\u5934\u7684\u3002 <code>grep -w ^vivek /etc/passwd</code></p> <p>\u68c0\u7d22\u4ee5 \u2018foo\u2019 \u7ed3\u5c3e\u7684\u6587\u672c\u683c\u5f0f\uff1a<code>grep 'foo$' FILENAME</code></p> <p>\u4f60\u8fd8\u53ef\u4ee5\u7528\u4e0b\u9762\u8fd9\u6837\u7684\u65b9\u5f0f\u641c\u7d22\u7a7a\u767d\u884c\uff1a<code>grep '^$' FILENAME</code></p>","tags":["Linux"]},{"location":"linux/usr/grep-use/#_6","title":"\u5982\u4f55\u5339\u914d\u5177\u4f53\u5b57\u7b26\uff1f","text":"<p>\u5339\u914d \u2018Vivek\u2019 \u6216 \u2018vivek\u2019 \uff1a<code>grep '[vV]ivek' FILENAME</code></p> <p>\u6216\u8005\u53ef\u4ee5\u8fd9\u6837\uff1a<code>grep '[vV][iI][Vv][Ee][kK]' FILENAME</code></p> <p>\u4f60\u53ef\u4ee5\u5339\u914d\u6570\u5b57\uff08\u4f8b\u5982\u5339\u914d vivek1 \u6216 Vivek2 \uff09\uff1a<code>grep -w '[vV]ivek[0-9]' FILENAME</code></p> <p>\u4f60\u53ef\u4ee5\u5339\u914d\u4e24\u4f4d\u6570\uff08\u4f8b\u5982\u5339\u914d foo11 \uff0c foo12 \uff09\uff1a<code>grep 'foo[0-9][0-9]' FILENAME</code></p> <p>\u4e0d\u4ec5\u4ec5\u662f\u6570\u5b57\uff0c\u4f60\u53ef\u4ee5\u5339\u914d\u5b57\u6bcd\uff1a<code>grep '[A-Za-z]' FILENAME</code></p> <p>\u663e\u793a\u6240\u6709\u5305\u542b \u201cw\u201d \u6216 \u201cn\u201d \u5b57\u6bcd\u7684\u6587\u672c\u884c\uff1a<code>grep [wn] FILENAME</code></p> <p>\u5728\u62ec\u53f7\u5185\u7684\u8868\u8fbe\u5f0f\u4e2d\uff0c\u5728\u201c [: \u201d\u548c\u201c :] \u201d\u4e2d\u6240\u9644\u7684\u5b57\u7b26\u7c7b\u7684\u540d\u79f0\uff1a\u4ee3\u8868\u5c5e\u4e8e\u8be5\u7c7b\u7684\u6240\u6709\u5b57\u7b26\u7684\u5217\u8868\u3002\u6807\u51c6\u5b57\u7b26\u7c7b\u540d\u79f0\uff1a</p> <ul> <li>[:alnum:] \u2013 \u5b57\u6bcd\u6570\u5b57\u5b57\u7b26</li> <li>[:alpha:] \u2013 \u5b57\u6bcd\u987a\u5e8f</li> <li>[:blank:] \u2013 \u7a7a\u683c\u548c\u5236\u8868\u7b26</li> <li>[:digit:] \u2013 \u6570\u5b57\uff1a \u20180 1 2 3 4 5 6 7 8 9\u2019</li> <li>[:lower:] \u2013 \u5c0f\u5199\u5b57\u6bcd\uff1a\u2018a b c d e f \u2019</li> <li>[:space:] \u2013 \u7279\u6b8a\u5b57\u7b26\uff1a\u5236\u8868\u7b26\uff0c\u6362\u884c\u7b26\uff0c\u5782\u76f4\u5236\u8868\u7b26\u3001\u6362\u9875\uff0c\u56de\u8f66\uff0c\u548c\u7a7a\u95f4</li> <li>[:upper:] \u2013 \u5927\u5199\u5b57\u6bcd\uff1a\u2018A B C D E F G H I J K L M N O P Q R S T U V W X Y Z\u2019</li> </ul> <p>\u5728\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5339\u914d\u6240\u6709\u5927\u5199\u5b57\u6bcd\uff1a<code>grep '[:upper:]' FILENAME</code></p>","tags":["Linux"]},{"location":"linux/usr/grep-use/#_7","title":"\u5982\u4f55\u4f7f\u7528\u901a\u914d\u7b26\uff1f","text":"<p>\u4f60\u53ef\u4ee5\u7528 \u201c.\u201d \u6765\u4ee3\u66ff\u5355\u4e2a\u5b57\u7b26\u3002\u5728\u4e0b\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u67e5\u8be2\u4e86\u6240\u6709\u4ee5\u5b57\u6bcd \u201cb\u201d \u5f00\u5934\u3001\u5b57\u6bcd \u201ct\u201d \u7ed3\u5c3e\u7684\u4e09\u4e2a\u5b57\u7b26\u7684\u5355\u8bcd\u3002 <code>grep '\\&lt;b.t\\&gt;' FILENAME</code> \u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c <code>\\&lt;</code> \u5728\u5355\u8bcd\u7684\u5f00\u59cb\u4f4d\u7f6e\u5339\u914d\u7a7a\u683c\u5b57\u7b26\u4e32 <code>\\&gt;</code> \u5728\u5355\u8bcd\u7684\u7ed3\u5c3e\u5339\u914d\u7a7a\u683c\u5b57\u7b26\u4e32 \u68c0\u7d22\u5e76\u8f93\u51fa\u6240\u6709\u4e24\u4e2a\u5b57\u6bcd\u7684\u7ed3\u679c\uff1a<code>grep '^..$' FILENAME</code> \u68c0\u7d22\u5e76\u663e\u793a\u6240\u6709\u4ee5 \u2018.\u2019 \u548c\u6570\u5b57\u5f00\u5934\u7684\u7ed3\u679c\uff1a<code>grep '^\\.[0-9]' FILENAME</code> \u8f6c\u4e49\u5b57\u7b26\u2019.\u2019 \u6b63\u5219\u8868\u8fbe\u5f0f\u67e5\u627e IP \u5730\u5740 192.168.1.254 \u5c06\u4e0d\u80fd\u83b7\u5f97\u9884\u671f\u7684\u7ed3\u679c\uff1a<code>grep '192.168.1.254' /etc/hosts</code> \u5176\u4e2d\u4e09\u4e2a\u70b9\u90fd\u9700\u8981\u88ab\u8f6c\u4e49\uff1a<code>grep '192\\.168\\.1\\.254' /etc/hosts</code></p> <p>\u4ee5\u4e0b\u793a\u4f8b\u5c06\u53ea\u5339\u914d\u4e00\u4e2a\u5730\u5740\uff1a <code>egrep '[[:digit:]]{1,3}\\.[[:digit:]]{1,3}\\.[[:digit:]]{1,3}\\.[[:digit:]]{1,3}' FILENAME</code></p> <p>\u4ee5\u4e0b\u5c06\u4e0d\u5206\u5927\u5c0f\u5199\u5730\u5339\u914d\u5355\u8bcd Linux \u6216 Unix \uff1a<code>egrep -i '^(linux|unix)' FILENAME</code></p>","tags":["Linux"]},{"location":"linux/usr/grep-use/#grep_1","title":"\u6df1\u5165\u63a2\u7d22 grep \u9ad8\u7ea7\u67e5\u627e\u6a21\u5f0f","text":"","tags":["Linux"]},{"location":"linux/usr/grep-use/#-","title":"\u5982\u4f55\u68c0\u7d22\u4e00\u4e2a\u5177\u6709\u4ee5 \u2018-\u2018 \u5f00\u5934\u7684\u7684\u6a21\u5f0f\uff1f","text":"<p>\u4f7f\u7528 -e \u9009\u9879\u641c\u7d22\u6240\u6709\u5339\u914d \u2018\u2013test\u2013\u2018 \u7684\u7ed3\u679c\u3002grep \u4f1a\u5c1d\u8bd5\u628a \u2018\u2013test\u2013\u2018 \u4f5c\u4e3a\u4e00\u4e2a\u9009\u9879\u89e3\u6790\uff1a <code>grep -e '--test--' FILENAME</code></p>","tags":["Linux"]},{"location":"linux/usr/grep-use/#grep-or","title":"\u5982\u4f55\u5728grep\u4e2d\u4f7f\u7528 OR \u7684\u903b\u8f91\u8fd0\u7b97 \uff1f","text":"<p><code>grep -E 'word1|word2' FILENAME</code> \u6216\u8005 <code>egrep 'word1|word2' FILENAME</code> \u6216\u8005\u53ef\u4ee5\u8fd9\u6837\u505a<code>grep 'word1\\|word2' FILENAME</code></p>","tags":["Linux"]},{"location":"linux/usr/grep-use/#grep-and","title":"\u5982\u4f55\u5728grep\u4e2d\u4f7f\u7528 AND \u7684\u903b\u8f91\u8fd0\u7b97 \uff1f","text":"<p>\u6309\u7167\u4e0b\u9762\u7684\u8bed\u6cd5\u663e\u793a\u6240\u6709\u5305\u542b\u4e86\u5355\u8bcd \u2018word1\u2032 \u548c \u2018word2\u2032 \u7684\u7ed3\u679c\uff1a <code>grep 'word1' FILENAME | grep 'word2'</code></p> <p>\u6216\u8005\u53ef\u4ee5\u8fd9\u6837\uff1a<code>grep 'foo.*bar\\|word3.*word4' FILENAME</code></p>","tags":["Linux"]},{"location":"linux/usr/grep-use/#_8","title":"\u5982\u4f55\u6d4b\u8bd5\u5e8f\u5217\uff1f","text":"<p>\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u8bed\u6cd5\u6d4b\u8bd5\u4e00\u4e2a\u5b57\u7b26\u5728\u5e8f\u5217\u4e2d\u7684\u91cd\u590d\u7684\u6b21\u6570\uff1a</p> <ul> <li>{N}</li> <li>{N,}</li> <li>{min,max}</li> </ul> <p>\u5339\u914d\u5305\u542b\u4e24\u4e2a\u5b57\u6bcd v \u7684\u5b57\u7b26\u4e32\u7ed3\u679c\uff1a<code>egrep \"v{2}\" FILENAME</code></p> <p>\u4e0b\u9762\u7684\u4f8b\u5b50\u4e2d\u5c06\u68c0\u7d22\u6587\u4ef6\u5185\u5305\u542b \u201ccol\u201d \u548c \u201ccool\u201d \u7684\u5b57\u7b26\u4e32\u7ed3\u679c\uff1a<code>egrep 'co{1,2}l' FILENAME</code></p> <p>\u641c\u7d22<code>pattern</code>\u6216<code>patern</code> <pre><code>rust@rust-pc:~/note/Linux_note$ egrep 'pat{1,2}ern' *\ngrep_note.md:Exclude directories matching the pattern DIR from recursive searches.\ngrep_note.md:grep_note.md:      Exclude directories matching the pattern DIR from recursive searches.\n</code></pre> \u4e0b\u9762\u7684\u4f8b\u5b50\u4e2d\u5c06\u5339\u914d\u81f3\u5c11\u542b\u67093\u4e2a\u5b57\u6bcd c \u7684\u7ed3\u679c\uff1a<code>egrep 'c{3,}' FILENAME</code></p> <p>\u4e0b\u9762\u7684\u793a\u4f8b\u5c06\u5339\u914d \u201c91-1234567890\u2033 \u683c\u5f0f\u7684\u624b\u673a\u53f7\u7801\uff08\u5373 \u201c\u4e24\u4f4d\u6570\u5b57-\u5341\u4f4d\u6570\u5b57\u201d\uff09 <code>grep \"[[:digit:]]\\{2\\}[ -]\\?[[:digit:]]\\{10\\}\" FILENAME</code></p>","tags":["Linux"]},{"location":"linux/usr/grep-use/#grep_2","title":"\u5982\u4f55\u4f7f grep \u7684\u8f93\u51fa\u7ed3\u679c\u9ad8\u4eae\u6807\u6ce8\uff1f","text":"<p>\u4f7f\u7528\u4e0b\u9762\u4f8b\u5b50\u7684\u8bed\u6cd5\uff1a<code>grep --color regex FILENAME</code></p>","tags":["Linux"]},{"location":"linux/usr/grep-use/#grep_3","title":"\u5982\u4f55\u4f7f grep \u7684\u8f93\u51fa\u53ea\u663e\u793a\u5339\u914d\u7684\u90e8\u5206\u800c\u4e0d\u662f\u6574\u884c\uff1f","text":"<p>\u4f7f\u7528\u4e0b\u9762\u4f8b\u5b50\u7684\u8bed\u6cd5\uff1a<code>grep -o regex FILENAME</code></p>","tags":["Linux"]},{"location":"linux/usr/grep-use/#_9","title":"\u7edf\u8ba1\u884c\u6570","text":"<pre><code>grep \"\" -r . | wc -l\n</code></pre>","tags":["Linux"]},{"location":"linux/usr/ls-use/","title":"Linux ls \u67e5\u770b\u6587\u4ef6","text":"\u66f4\u65b0\u65e5\u671f 2023-3-1 <ul> <li>2023-3-1 \u66f4\u65b0\u4f8b\u5b50</li> <li>2023-2-27 \u521b\u5efa\u6587\u6863</li> </ul> <p>Linux\u4e2d\u6700\u57fa\u7840\u7684\u64cd\u4f5c\u4e4b\u4e00\u3002\u67e5\u770b\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u3002</p>","tags":["Linux"]},{"location":"linux/usr/ls-use/#ls","title":"ls \u67e5\u770b\u5f53\u524d\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6","text":"<p>\u76f4\u63a5\u8f93\u5165ls</p> \u76f4\u63a5\u8f93\u5165ls <pre><code>$ ls\nabout           fun         media           ruankao\nabout.md        git         n           server\nandroid         index.md        nestjs          sip\napollo          ios         nginx           stylesheets\ncocos           java            pyqt            tags.md\ndb          kotlin          python          tech-note-index.md\ndesignPattern       linux           recent-post.md      webrtc\nembedded        lua         redis                web\n</code></pre>","tags":["Linux"]},{"location":"linux/usr/ls-use/#ls-l","title":"ls -l \u7ad6\u7740\u663e\u793a\u66f4\u591a\u4fe1\u606f","text":"ls -l <pre><code>$ ls -l\ntotal 64\ndrwxr-xr-x@ 15 rustfisher  staff    480  1 17 12:38 about\n-rw-r--r--   1 rustfisher  staff   2403  1 17 17:46 about.md\ndrwxr-xr-x@ 42 rustfisher  staff   1344  8 16  2022 android\ndrwxr-xr-x   3 rustfisher  staff     96  7 21  2022 apollo\ndrwxr-xr-x   4 rustfisher  staff    128  1 23  2022 cocos\ndrwxr-xr-x   3 rustfisher  staff     96  8 17  2022 db\ndrwxr-xr-x@ 21 rustfisher  staff    672  8 16  2022 designPattern\ndrwxr-xr-x   6 rustfisher  staff    192 10  2 08:08 embedded\ndrwxr-xr-x  11 rustfisher  staff    352  9 27 12:52 fun\ndrwxr-xr-x   4 rustfisher  staff    128  1 22 14:21 git\n-rw-r--r--   1 rustfisher  staff    772  1 18 09:39 index.md\ndrwxr-xr-x  11 rustfisher  staff    352 12 21 09:10 ios\ndrwxr-xr-x@ 17 rustfisher  staff    544  2  3  2022 java\ndrwxr-xr-x@  5 rustfisher  staff    160 12  1  2021 kotlin\ndrwxr-xr-x   4 rustfisher  staff    128  3 14  2022 linux\ndrwxr-xr-x   3 rustfisher  staff     96 11 22 10:03 lua\ndrwxr-xr-x   6 rustfisher  staff    192  4 24  2022 media\ndrwxr-xr-x   3 rustfisher  staff     96 12 19 15:02 n\ndrwxr-xr-x  11 rustfisher  staff    352  5  7  2022 nestjs\ndrwxr-xr-x   3 rustfisher  staff     96  7 29  2022 nginx\ndrwxr-xr-x  13 rustfisher  staff    416  8 22  2022 pyqt\ndrwxr-xr-x  11 rustfisher  staff    352  5  5  2022 python\n-rw-r--r--   1 rustfisher  staff   7238  2 27 08:44 recent-post.md\ndrwxr-xr-x   3 rustfisher  staff     96  6 29  2022 redis\ndrwxr-xr-x   3 rustfisher  staff     96  4 14  2022 ruankao\ndrwxr-xr-x   3 rustfisher  staff     96  8 17  2022 server\ndrwxr-xr-x   3 rustfisher  staff     96 10 12 15:26 sip\ndrwxr-xr-x@  6 rustfisher  staff    192  7  8  2022 stylesheets\n-rw-r--r--   1 rustfisher  staff     53 10 12 09:16 tags.md\n-rw-r--r--   1 rustfisher  staff  11399  1 17 17:54 tech-note-index.md\ndrwxr-xr-x  12 rustfisher  staff    384  9  1 14:41 webrtc\n</code></pre>","tags":["Linux"]},{"location":"linux/usr/ls-use/#ls_1","title":"ls \u53ea\u770b\u76ee\u5f55","text":"<p>\u4f7f\u7528 <code>-d</code> \u53c2\u6570\uff0c\u5e76\u4e14\u52a0\u4e0a <code>*/</code></p> <p>\u4f8b\u5982\uff1a</p> <pre><code>$ ls -d */\n2023-02-09/  2023-02-11/  2023-02-13/  2023-02-15/\n</code></pre>","tags":["Linux"]},{"location":"linux/usr/ls-use/#_1","title":"\u67e5\u770b\u6307\u5b9a\u6587\u4ef6","text":"<p>ls\u52a0\u6307\u5b9a\u7684\u6587\u4ef6</p> <pre><code>$ ls tags.md\ntags.md\n</code></pre>","tags":["Linux"]},{"location":"linux/usr/ls-use/#_2","title":"\u901a\u914d\u7b26","text":"<pre><code>$ ls  *.md\nact_lifecycle.md            simple_launcher.md\nactivity-tran-animation.md      start-activity-and-send-params.md\nfloating-scale-act.md           start-activity-for-result.md\nlaunch-mode-task-stack.md       uninstall-app.md\nlaunch-send-parcelable.md       view-global-layout-listen.md\noverview.md\n</code></pre>","tags":["Linux"]},{"location":"linux/usr/ls-use/#_3","title":"\u67e5\u770b\u6307\u5b9a\u76ee\u5f55","text":"<p>ls\u52a0\u6307\u5b9a\u7684\u76ee\u5f55\uff0c\u53ef\u4ee5\u67e5\u770b\u91cc\u9762\u7684\u6587\u4ef6</p> <pre><code>$ ls webrtc/\nandroid         media           src\ncapture         peerconnection      turn\nintro           some-reference.md   web-samples\n</code></pre>","tags":["Linux"]},{"location":"linux/usr/mkdir-use/","title":"Linux mkdir","text":"\u66f4\u65b0\u65e5\u671f 2022-12-07 <ul> <li>2022-12-07 \u521b\u5efa\u6587\u6863</li> </ul>","tags":["Linux"]},{"location":"linux/usr/mkdir-use/#_1","title":"\u57fa\u672c\u7528\u6cd5","text":"","tags":["Linux"]},{"location":"linux/usr/mkdir-use/#_2","title":"\u521b\u5efa\u5355\u5c42\u76ee\u5f55","text":"<p>mkdir rustfisherDir1</p>","tags":["Linux"]},{"location":"linux/usr/mkdir-use/#_3","title":"\u521b\u5efa\u76ee\u5f55\u4ee5\u53ca\u5b50\u76ee\u5f55\uff08\u591a\u5c42\uff09","text":"<p>mkdir -p an/rustfisher/dir1/dir2</p>","tags":["Linux"]},{"location":"linux/usr/netstat-use/","title":"Linux\u4f7f\u7528netstat\u67e5\u770b\u7f51\u7edc\u72b6\u6001","text":"\u66f4\u65b0\u65e5\u671f 2023-8-8 <ul> <li>2023-8-8 \u4fee\u6539\u5c0f\u6807\u9898</li> <li>2022-8-8 \u589e\u52a0\u6269\u5c55\u9605\u8bfb</li> <li>2022-7-14 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u67e5\u770b\u672c\u673a\u7684\u7f51\u7edc\u72b6\u6001\u3002\u4f7f\u7528netstat\u67e5\u770b\u7f51\u7edc\u72b6\u6001\u3002\u663e\u793a\u7cfb\u7edf\u7aef\u53e3\u4f7f\u7528\u60c5\u51b5\u3002UDP\u7c7b\u578b\u7684\u7aef\u53e3\u3002TCP\u7c7b\u578b\u7684\u7aef\u53e3\u3002\u53ea\u663e\u793a\u6240\u6709\u76d1\u542c\u7aef\u53e3\u3002\u53ea\u663e\u793a\u6240\u6709\u76d1\u542ctcp\u7aef\u53e3\u3002</p> <p>\u547d\u4ee4\u4f7f\u7528\u4e3e\u4f8b</p> \u547d\u4ee4 \u8bf4\u660e netstat -anp \u663e\u793a\u7cfb\u7edf\u7aef\u53e3\u4f7f\u7528\u60c5\u51b5 netstat -nupl UDP\u7c7b\u578b\u7684\u7aef\u53e3 netstat -ntpl TCP\u7c7b\u578b\u7684\u7aef\u53e3 netstat -l \u53ea\u663e\u793a\u6240\u6709\u76d1\u542c\u7aef\u53e3 netstat -lt \u53ea\u663e\u793a\u6240\u6709\u76d1\u542ctcp\u7aef\u53e3 <p>\u8f93\u5165\u547d\u4ee4\u540e\uff0c\u8f93\u51fa\u91cc\u5305\u542b\u7740\u534f\u8bae\u3001\u672c\u5730\u5730\u5740\u3001\u5916\u90e8\u5730\u5740\u53ca\u72b6\u6001\u4fe1\u606f</p> Proto Local Address Foreign Address State \u534f\u8bae \u672c\u5730\u5730\u5740 \u5916\u90e8\u5730\u5740 \u72b6\u6001 <p>\u5404\u5c5e\u6027\u5c06\u5728\u540e\u6587\u4ecb\u7ecd\u3002</p> <p>\u7ec4\u5408\u547d\u4ee4</p> <p><code>netstat -na | grep ESTABLISHED | wc -l</code> \u7edf\u8ba1\u5df2\u8fde\u63a5\u4e0a\u7684\uff0c\u72b6\u6001\u4e3a\"established\"</p>","tags":["Linux"]},{"location":"linux/usr/netstat-use/#netstat-anp","title":"\u663e\u793a\u7cfb\u7edf\u7aef\u53e3\u4f7f\u7528\u60c5\u51b5 netstat -anp","text":"netstat -anp <p>\u622a\u53d6\u90e8\u5206\u7ed3\u679c \u663e\u793a\u7cfb\u7edf\u7aef\u53e3\u4f7f\u7528\u60c5\u51b5<pre><code>$ netstat -anp\n(Not all processes could be identified, non-owned process info\nwill not be shown, you would have to be root to see it all.)\nActive Internet connections (servers and established)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      -               \ntcp        0      0 0.0.0.0:3478            0.0.0.0:*               LISTEN      -               \ntcp        0      0 0.0.0.0:3478            0.0.0.0:*               LISTEN      -               \ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -               \ntcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      -               \ntcp        0      0 172.16.16.13:37432      169.254.0.55:5574       ESTABLISHED -               \ntcp        0    600 172.16.16.13:22         222.216.195.223:17351   ESTABLISHED -               \ntcp6       0      0 :::9010                 :::*                    LISTEN      8708/main.js    \nActive UNIX domain sockets (servers and established)\nProto RefCnt Flags       Type       State         I-Node   PID/Program name    Path\nunix  2      [ ]         DGRAM                    19037    1744/systemd        /run/user/500/systemd/notify\nunix  2      [ ACC ]     STREAM     LISTENING     13532    -                   /var/lib/lxd/unix.socket\nunix  2      [ ACC ]     STREAM     LISTENING     19038    1744/systemd        /run/user/500/systemd/private\nunix  2      [ ACC ]     SEQPACKET  LISTENING     9722     -                   /run/udev/control\nunix  2      [ ]         DGRAM                    71848026 -                   /usr/local/qcloud/YunJing/conf/ydrpc_3\nunix  3      [ ]         DGRAM                    9712     -                   /run/systemd/notify\n</code></pre></p>","tags":["Linux"]},{"location":"linux/usr/netstat-use/#udp-netstat-nupl","title":"\u67e5\u770bUDP\u7c7b\u578b\u7684\u7aef\u53e3 netstat -nupl","text":"netstat -nupl \u67e5\u770bUDP\u7c7b\u578b\u7684\u7aef\u53e3<pre><code>$ netstat -nupl\n(Not all processes could be identified, non-owned process info\nwill not be shown, you would have to be root to see it all.)\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\nudp        0      0 0.0.0.0:3478            0.0.0.0:*                           -               \nudp        0      0 0.0.0.0:3478            0.0.0.0:*                           -               \nudp        0      0 0.0.0.0:68              0.0.0.0:*                           -               \nudp        0      0 172.16.16.13:123        0.0.0.0:*                           -               \nudp        0      0 127.0.0.1:123           0.0.0.0:*                           -               \nudp        0      0 0.0.0.0:123             0.0.0.0:*                           -               \nudp6       0      0 :::123                  :::*                                -    \n</code></pre>","tags":["Linux"]},{"location":"linux/usr/netstat-use/#tcp-netstat-ntpl","title":"\u67e5\u770bTCP\u7c7b\u578b\u7684\u7aef\u53e3 netstat -ntpl","text":"netstat -ntpl <p>\u622a\u53d6\u90e8\u5206\u7ed3\u679c \u67e5\u770bTCP\u7c7b\u578b\u7684\u7aef\u53e3<pre><code>$ netstat -ntpl\n(Not all processes could be identified, non-owned process info\nwill not be shown, you would have to be root to see it all.)\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      -               \ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -               \ntcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      -               \ntcp6       0      0 :::9010                 :::*                    LISTEN      8708/main.js    \ntcp6       0      0 :::22                   :::*                    LISTEN      -               \n</code></pre></p>","tags":["Linux"]},{"location":"linux/usr/netstat-use/#netstat-l","title":"\u53ea\u663e\u793a\u6240\u6709\u76d1\u542c\u7aef\u53e3 netstat -l","text":"netstat -l <p>\u90e8\u5206\u7ed3\u679c \u53ea\u663e\u793a\u6240\u6709\u76d1\u542c\u7aef\u53e3<pre><code>$ netstat -l\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State      \ntcp        0      0 *:http                  *:*                     LISTEN     \ntcp        0      0 *:3478                  *:*                     LISTEN     \ntcp        0      0 *:3478                  *:*                     LISTEN     \ntcp        0      0 *:ssh                   *:*                     LISTEN     \ntcp        0      0 *:https                 *:*                     LISTEN     \ntcp6       0      0 [::]:9010               [::]:*                  LISTEN     \ntcp6       0      0 [::]:ssh                [::]:*                  LISTEN     \nudp        0      0 *:3478                  *:*                                \nudp        0      0 *:3478                  *:*                                \nudp        0      0 *:bootpc                *:*                                \nudp        0      0 172.16.16.13:ntp        *:*                                \nudp        0      0 localhost.localdoma:ntp *:*                                \nudp        0      0 *:ntp                   *:*                                \nudp6       0      0 [::]:ntp                [::]:*                             \nActive UNIX domain sockets (only servers)\nProto RefCnt Flags       Type       State         I-Node   Path\nunix  2      [ ACC ]     STREAM     LISTENING     13532    /var/lib/lxd/unix.socket\nunix  2      [ ACC ]     STREAM     LISTENING     19038    /run/user/500/systemd/private\n</code></pre></p>","tags":["Linux"]},{"location":"linux/usr/netstat-use/#tcp-netstat-lt","title":"\u53ea\u663e\u793a\u6240\u6709\u76d1\u542ctcp\u7aef\u53e3 netstat -lt","text":"netstat -lt <p>\u90e8\u5206\u7ed3\u679c \u53ea\u663e\u793a\u6240\u6709\u76d1\u542c\u7aef\u53e3<pre><code>$ netstat -lt\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State      \ntcp        0      0 *:http                  *:*                     LISTEN     \ntcp        0      0 *:3478                  *:*                     LISTEN     \ntcp        0      0 *:3478                  *:*                     LISTEN     \ntcp        0      0 *:ssh                   *:*                     LISTEN     \ntcp        0      0 *:https                 *:*                     LISTEN     \ntcp6       0      0 [::]:9010               [::]:*                  LISTEN     \ntcp6       0      0 [::]:ssh                [::]:*                  LISTEN     \n</code></pre></p>","tags":["Linux"]},{"location":"linux/usr/netstat-use/#_1","title":"\u5404\u5c5e\u6027\u4ecb\u7ecd","text":"<p>\u5404\u4e2a\u5c5e\u6027\uff08\u6807\u9898\uff09\u542b\u4e49\u662f\u4ec0\u4e48\uff1f</p>","tags":["Linux"]},{"location":"linux/usr/netstat-use/#proto","title":"Proto \u534f\u8bae\u540d","text":"<p>\u6bd4\u5982tcp\uff0cudp</p>","tags":["Linux"]},{"location":"linux/usr/netstat-use/#recv-q","title":"Recv-Q \u672c\u5730\u7f13\u51b2\u961f\u5217","text":"<p>\u8868\u793a\u672c\u5730\u7f13\u51b2\u4e2d\u7684\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u8fd8\u6ca1\u6709\u88ab\u8fdb\u7a0b\u53d6\u8d70\u3002</p> <p>\u4e00\u822c\u6765\u8bf4\u8fd9\u91cc\u7684\u503c\u662f0</p>","tags":["Linux"]},{"location":"linux/usr/netstat-use/#send-q","title":"Send-Q \u53d1\u9001\u7f13\u5b58\u961f\u5217","text":"<p>\u5bf9\u65b9\u8fd8\u6ca1\u6536\u5230\u6570\u636e\uff0c\u6216\u8005\u8fd8\u6ca1ack\u7684\u6570\u636e\uff0c\u8fd8\u5728\u672c\u5730\u7f13\u51b2\u533a\u4e2d\u3002 \u5982\u679c\u8fd9\u91cc\u4e0d\u80fd\u5f88\u5feb\u6e05\u96f6\uff0c\u53ef\u80fd\u662f\u6211\u65b9\u53d1\u9001\u8fc7\u5feb\uff0c\u6216\u8005\u5bf9\u65b9\u63a5\u6536\u592a\u6162\u3002</p> <p>\u4e00\u822c\u6765\u8bf4\u8fd9\u91cc\u7684\u503c\u662f0</p>","tags":["Linux"]},{"location":"linux/usr/netstat-use/#local-address","title":"Local Address \u672c\u5730\u5730\u5740","text":"<p><code>0.0.0.0:80</code> \u8868\u793a\u76d1\u542c\u672c\u5730\u670d\u52a1\u5668\u4e0a\u6240\u6709ip\u768480\u7aef\u53e3\uff080.0.0.0\u8868\u793a\u6240\u6709ip\uff09</p> <p><code>:::9010</code> \u8868\u793a\u76d1\u542c\u672c\u5730\u670d\u52a1\u5668\u4e0a\u6240\u6709ip\u76849010\u7aef\u53e3\u3002\u8fd9\u91cc\u662fIPv6\u5730\u5740\u3002</p> <p><code>:::</code> \u67093\u4e2a\u5192\u53f7\u3002\u524d2\u4e2a\u662f<code>0:0:0:0:0:0:0:0</code>\u7684\u7f29\u5199\u3002\u8868\u793a\u672c\u5730\u6240\u6709IPv6\u5730\u5740\u3002 \u7b2c\u4e09\u4e2a\u5192\u53f7\u662fIP\u548c\u7aef\u53e3\u7684\u5206\u9694\u7b26\u53f7\u3002</p> <p><code>127.0.0.1:123</code> \u8868\u793a\u76d1\u542c\u672c\u673a\u7684loopback\uff08\u56de\u73af\u5730\u5740\uff09\u5730\u5740\u7684123\u7aef\u53e3\u3002</p> <p>\u5f62\u5982<code>::1:9011</code>\uff0c\u8868\u793a\u76d1\u542cIPv6\u7684\u56de\u73af\u5730\u5740\u76849011\u7aef\u53e3\u3002</p>","tags":["Linux"]},{"location":"linux/usr/netstat-use/#foreign-address","title":"Foreign Address \u5916\u90e8\u5730\u5740","text":"<p>\u4e0e\u672c\u5730\u670d\u52a1\u5668\u901a\u4fe1\u7684\u53e6\u5916\u7684\u5730\u5740\uff0c\u663e\u793a\u89c4\u5219\u548c\u4e0a\u9762\u672c\u5730\u5730\u5740\u7684\u76f8\u540c\u3002</p>","tags":["Linux"]},{"location":"linux/usr/netstat-use/#state","title":"State \u72b6\u6001","text":"<p>\u7f51\u7edc\u94fe\u8def\u7684\u72b6\u6001\u3002\u5e38\u89c1 LISTEN\uff0cESTABLISHED \u7b49\u7b49</p> <ul> <li>LISTEN \u6253\u5f00\u76d1\u542c\u540e\u72b6\u6001\u4e3aLISTEN\uff0c\u7b49\u5f85\u5176\u4ed6\u673a\u5668\u524d\u6765\u8fde\u63a5</li> <li>ESTABLISHED \u94fe\u63a5\u5df2\u5efa\u7acb\uff0c\u53cc\u65b9\u53ef\u4ee5\u8fdb\u884c\u6216\u6b63\u5728\u6570\u636e\u4ea4\u4e92</li> </ul>","tags":["Linux"]},{"location":"linux/usr/netstat-use/#pidprogram","title":"PID\uff08Program\uff09","text":"<p>\u8fdb\u7a0bid\uff0c\u8868\u793a\u4f7f\u7528\u8fd9\u4e2a\u8fde\u63a5\u7684\u8fdb\u7a0b</p>","tags":["Linux"]},{"location":"linux/usr/netstat-use/#_2","title":"\u6269\u5c55\u9605\u8bfb","text":"<ul> <li>Linux awk\u547d\u4ee4\u7684\u4f7f\u7528\uff0c\u9010\u884c\u5904\u7406\u6587\u672c\uff0c\u641c\u7d22\u7edf\u8ba1\u5355\u8bcd\u4e2a\u6570</li> <li>find\u7684\u4f7f\u7528\uff0c\u5bfb\u627e\u7279\u5b9a\u6587\u4ef6</li> <li>grep \u641c\u7d22\u5b57\u7b26\u4e32</li> <li>Shell for \u5faa\u73af\u8bed\u53e5</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a cnblogs segmentfault CSDN</p>","tags":["Linux"]},{"location":"lua/start/lua-base/","title":"Lua \u57fa\u7840\u64cd\u4f5c","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-12-6 <ul> <li>2022-12-6 \u4ea4\u4e92\u6a21\u5f0f</li> <li>2022-11-24 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883\u548c\u5de5\u5177 <ul> <li>macOS 12.3.1</li> <li>VSCode 1.73.1</li> </ul> <p>\u524d\u9762\u6211\u4eec\u5728Mac\u4e0a\u5b89\u88c5\u4e86lua\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u4ecb\u7ecd\u4e00\u4e9b\u57fa\u7840\u64cd\u4f5c\u3002</p>","tags":["Lua"]},{"location":"lua/start/lua-base/#hello","title":"hello","text":"<p>\u65b0\u5efa\u6587\u4ef6test.lua\uff0c\u8f93\u5165\u4ee5\u4e0b\u4ee3\u7801 test.lua<pre><code>print(\"hello an.rustfisher.com\")\n</code></pre></p> <p>\u5728vscode\u7684\u7ec8\u7aef\uff08\u6216\u8005\u7535\u8111\u7ec8\u7aef\uff09\uff0c\u6267\u884c <pre><code>$ lua test.lua \nhello an.rustfisher.com\n</code></pre></p>","tags":["Lua"]},{"location":"lua/start/lua-base/#_1","title":"\u65b9\u6cd5","text":"<p>\u5199\u4e00\u4e2a\u9012\u5f52\u7684\u9636\u4e58\u65b9\u6cd5 test.lua<pre><code>-- \u4e00\u4e2a\u9012\u5f52\u7684\u9636\u4e58\u65b9\u6cd5 \nfunction fact(n)\n    if n == 0 then\n        return 1\n    else\n        return n * fact(n - 1)\n    end\nend\n\nprint('\u8bf7\u8f93\u5165\u4e00\u4e2a\u6b63\u6570')\ninputNum = io.read()\nprint('\u8f93\u5165\u7684\u662f:', inputNum)\nprint('\u8ba1\u7b97\u7ed3\u679c:', fact(inputNum))\n</code></pre></p> \u6267\u884c<pre><code>$ lua test.lua \n\u8bf7\u8f93\u5165\u4e00\u4e2a\u6b63\u6570\n9\n\u8f93\u5165\u7684\u662f:       9\n\u8ba1\u7b97\u7ed3\u679c:       362880.0\n</code></pre> <p><code>io.read()</code>\u53ef\u4ee5\u63a5\u53d7\u7528\u6237\u8f93\u5165</p>","tags":["Lua"]},{"location":"lua/start/lua-base/#lua_1","title":"\u4ea4\u4e92\u6a21\u5f0f\u8fd0\u884cLua","text":"<p>\u4ea4\u4e92\u6a21\u5f0f\u8fd0\u884c Lua\uff0c\u4e0d\u5e26\u53c2\u6570\u8fd0\u884c Lua</p> <p></p> \u4ea4\u4e92\u6a21\u5f0f\u8f93\u5165<pre><code>&gt; print(\"Hello an.rustfisher.com\")\nHello an.rustfisher.com\n&gt; a=\"hello\" b = 3\n&gt; print(a, b)\nhello   3\n&gt; t={}\n&gt; t[\"a\"] = \"Hello\"\n&gt; t[\"b\"] = \"an.rustfisher.com\"\n&gt; print(t)\ntable: 0x6000005a0140\n&gt; print(t.a, t[\"b\"])\nHello   an.rustfisher.com\n&gt; \n</code></pre> \u4ea4\u4e92\u6a21\u5f0f\u8f93\u5165 <p></p>","tags":["Lua"]},{"location":"lua/start/lua-simple-start-mac/","title":"Lua Mac\u7f16\u8bd1\u5b89\u88c5","text":"\u66f4\u65b0\u65e5\u671f\uff1a2022-12-6 <ul> <li>2022-12-6 \u66f4\u65b0\u5185\u5bb9</li> <li>2022-11-24 \u66f4\u65b0\u8bf4\u660e</li> <li>2022-11-22 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883\u548c\u5de5\u5177 <ul> <li>macOS 12.3.1</li> <li>VSCode 1.73.1</li> </ul>","tags":["Lua"]},{"location":"lua/start/lua-simple-start-mac/#_1","title":"\u4e0b\u8f7d\u7f16\u8bd1","text":"","tags":["Lua"]},{"location":"lua/start/lua-simple-start-mac/#lua-536","title":"\u4e0b\u8f7d\u5e76\u7f16\u8bd1lua-5.3.6","text":"<p>\u4e0b\u8f7d\u4e00\u4e2a5.3\u7248\u672clua\uff1a https://www.lua.org/versions.html#5.3</p> <p>\u89e3\u538b lua-5.3.6.tar.gz\uff0c\u5f97\u5230 lua-5.3.6</p> <p>\u5177\u4f53\u76ee\u5f55\u4e3a <code>/Users/rustfisher/Downloads/lua/lua-5.3.6</code></p> <p>\u7f16\u8bd1\u6307\u5b9amacosx\u7248\u672c <pre><code>cd lua-5.3.6\nmake macosx\n</code></pre></p> <p>\u5f97\u5230\u7684lua\u6587\u4ef6\u5728 <code>/Users/rustfisher/Downloads/lua/lua-5.3.6/src/lua</code> \u67e5\u770b\u7248\u672c\u53f7<pre><code>~/Downloads/lua/lua-5.3.6 $ ./src/lua -v\nLua 5.3.6  Copyright (C) 1994-2020 Lua.org, PUC-Rio\n</code></pre></p>","tags":["Lua"]},{"location":"lua/start/lua-simple-start-mac/#_2","title":"\u73af\u5883\u53d8\u91cf","text":"<p>\u73af\u5883\u53d8\u91cf\u914d\u7f6e .bash_profile <pre><code>~ $ vim .bash_profile\n</code></pre></p> <p>\u6dfb\u52a0lua\u7684\u8def\u5f84\u7ed9 PATH <pre><code># lua path\nexport PATH=${PATH}:/Users/rustfisher/Downloads/lua/lua-5.3.6/src/\n</code></pre></p> <p>\u65b0\u5efa\u4e00\u4e2a\u7ec8\u7aef\uff0c\u8f93\u5165lua <pre><code>~ $ lua\nLua 5.4.4  Copyright (C) 1994-2022 Lua.org, PUC-Rio\n&gt; \n</code></pre></p> \u67e5\u770bluac\u7248\u672c<pre><code>$ luac -v\nLua 5.3.6  Copyright (C) 1994-2020 Lua.org, PUC-Rio\n</code></pre> \u67e5\u770blua\u8def\u5f84<pre><code>~ $ whereis lua\nlua: /Users/rustfisher/Downloads/lua/lua-5.3.6/src//lua\n</code></pre>","tags":["Lua"]},{"location":"lua/start/lua-simple-start-mac/#vscode","title":"vscode","text":"<p>\u88c5\u597dlua\u540e\uff0c\u542f\u52a8vscode\u3002\u65b0\u5efa\u4e00\u4e2a\u6d4b\u8bd5\u6587\u4ef6 test.lua</p> <pre><code>print(\"hello rustfisher\")\n\ndemo = {\n    [\"now\"] = 2022,\n    ['addr'] = \"an.rustfisher.com\"\n}\n\nprint(demo.addr)\nprint('now:', demo.now)\n</code></pre> <p>\u8fd0\u884clua\u6587\u4ef6\uff0c\u63a7\u5236\u53f0\u8f93\u51fa <pre><code>hello rustfisher\nan.rustfisher.com\nnow:    2022\n</code></pre></p>","tags":["Lua"]},{"location":"media/audio/some-audio-video-media-format/","title":"\u5e38\u89c1\u97f3\u89c6\u9891\u7f16\u7801\u683c\u5f0f","text":"","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#_2","title":"\u5e38\u89c1\u97f3\u9891\u683c\u5f0f","text":"","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#mp3","title":"MP3","text":"<p>\u5168\u79f0 MPEG Audio Layer3\u3002 MP3\u662f\u5229\u7528MPEG Audio Layer 3\u7684\u6280\u672f\uff0c\u5c06\u97f3\u4e50\u4ee51:10\u751a\u81f31:12 \u7684\u538b\u7f29\u7387\uff0c\u538b\u7f29\u6210\u5bb9\u91cf\u8f83\u5c0f\u7684\u6587\u4ef6\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u80fd\u591f\u5728\u97f3\u8d28\u4e22\u5931\u5f88\u5c0f\u7684\u60c5\u51b5\u4e0b\u628a\u6587\u4ef6\u538b\u7f29\u5230\u66f4\u5c0f\u7684\u7a0b\u5ea6\u3002 \u800c\u4e14\u8fd8\u975e\u5e38\u597d\u7684\u4fdd\u6301\u4e86\u539f\u6765\u7684\u97f3\u8d28\u3002</p> <p>\u538b\u7f29\u7387\uff1a10~12\u500d</p> <p>\u4f18\u70b9\uff1a\u538b\u7f29\u6bd4\u9ad8\uff0c\u9002\u5408\u7528\u4e8e\u4e92\u8054\u7f51\u4e0a\u7684\u4f20\u64ad</p> <p>\u7f3a\u70b9\uff1a MP3 \u5728 128KBitrate \u53ca\u4ee5\u4e0b\u65f6\uff0c\u4f1a\u51fa\u73b0\u660e\u663e\u7684\u9ad8\u9891\u4e22\u5931</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#aac","title":"AAC\u9ad8\u7ea7\u97f3\u9891\u7f16\u7801","text":"<p>Advanced Audio Coding\u3002\u4e00\u79cd\u4e13\u4e3a\u58f0\u97f3\u6570\u636e\u8bbe\u8ba1\u7684\u6587\u4ef6\u538b\u7f29\u683c\u5f0f\uff0c\u4e0eMP3\u4e0d\u540c\uff0c\u5b83\u91c7\u7528\u4e86\u5168\u65b0\u7684\u7b97\u6cd5\u8fdb\u884c\u7f16\u7801\uff0c\u66f4\u52a0\u9ad8\u6548\uff0c\u5177\u6709\u66f4\u9ad8\u7684\u201c\u6027\u4ef7\u6bd4\u201d\u3002 \u5229\u7528AAC\u683c\u5f0f\uff0c\u53ef\u4f7f\u4eba\u611f\u89c9\u58f0\u97f3\u8d28\u91cf\u6ca1\u6709\u660e\u663e\u964d\u4f4eaac\u6807\u5fd7\u7684\u524d\u63d0\u4e0b\uff0c\u66f4\u52a0\u5c0f\u5de7\u3002 AAC\u5c5e\u4e8e\u6709\u635f\u538b\u7f29\u7684\u683c\u5f0f\uff0c\u4e0e\u65f6\u4e0b\u6d41\u884c\u7684APE\u3001FLAC\u7b49\u65e0\u635f\u683c\u5f0f\u76f8\u6bd4\u97f3\u8d28\u5b58\u5728\u201c\u672c\u8d28\u4e0a\u201d\u7684\u5dee\u8ddd\u3002</p> <p>\u52a0\u4e4b\uff0c\u4f20\u8f93\u901f\u5ea6\u66f4\u5feb\u7684USB3.0\u548c16G\u4ee5\u4e0a\u5927\u5bb9\u91cfMP3\u6b63\u5728\u52a0\u901f\u666e\u53ca\uff0c\u4e5f\u4f7f\u5f97AAC\u5934\u4e0a\u201c\u5c0f\u5de7\u201d\u7684\u5149\u73af\u4e0d\u590d\u5b58\u5728\u4e86\u3002</p> <p>\u4f18\u70b9\uff1a\u652f\u6301\u591a\u79cd\u97f3\u9891\u58f0\u9053\u7ec4\u5408\uff0c\u63d0\u4f9b\u4f18\u8d28\u7684\u97f3\u8d28\u3002</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#wma","title":"WMA","text":"<p>WMA\u7684\u5168\u79f0\u662fWindows Media Audio\uff0c\u662f\u5fae\u8f6f\u529b\u63a8\u7684\u4e00\u79cd\u97f3\u9891\u683c\u5f0f\u3002 WMA\u683c\u5f0f\u662f\u4ee5\u51cf\u5c11\u6570\u636e\u6d41\u91cf\u4f46\u4fdd\u6301\u97f3\u8d28\u7684\u65b9\u6cd5\u6765\u8fbe\u5230\u66f4\u9ad8\u7684\u538b\u7f29\u7387\u76ee\u7684\uff0c\u5176\u538b\u7f29\u7387\u4e00\u822c\u53ef\u4ee5\u8fbe\u52301:18\uff0c\u751f\u6210\u7684\u6587\u4ef6\u5927\u5c0f\u53ea\u6709\u76f8\u5e94MP3\u6587\u4ef6\u7684\u4e00\u534a\u3002</p> <p>\u538b\u7f29\u7387\uff1a10~12\u500d</p> <p>\u7f3a\u70b9\uff1a\u5728\u9ad8\u6bd4\u7387\u7684\u6e32\u67d3\u80fd\u529b\u4f4e\u4e0b\uff0c\u540c\u97f3\u6e90\u7684\u4e00\u4e2a320KBPS\u7684MP3\u4e0e\u6bd4\u8f83192KBPS\u7684WMA\u76f8\u6bd4\uff0c\u97f3\u8d28\u548c\u6e32\u67d3\u529b\u5f88\u5bb9\u6613\u5206\u522b\u51fa\u662f\u524d\u8005\u8f83\u4f18\u3002\u56e0\u4e3a\uff1a \u5f53 Bitrate \u5c0f\u4e8e 128K \u65f6\uff0c WMA \u6700\u4e3a\u51fa\u8272\u4e14\u7f16\u7801\u540e\u5f97\u5230\u7684\u97f3\u9891\u6587\u4ef6\u5f88\u5c0f\u3002 \u5f53 Bitrate \u5927\u4e8e 128K \u65f6\uff0c WMA \u97f3\u8d28\u635f\u5931\u8fc7\u5927\u3002</p> <p>\u4f18\u70b9\uff1aWMA\u8fd8\u53ef\u4ee5\u901a\u8fc7DRM\uff08Digital Rights Management\uff09\u65b9\u6848\u52a0\u5165\u9632\u6b62\u62f7\u8d1d\uff0c\u6216\u8005\u52a0\u5165\u9650\u5236\u64ad\u653e\u65f6\u95f4\u548c\u64ad\u653e\u6b21\u6570\uff0c\u751a\u81f3\u662f\u64ad\u653e\u673a\u5668\u7684\u9650\u5236\uff0c\u53ef\u6709\u529b\u5730\u9632\u6b62\u76d7\u7248\u3002</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#wav","title":"WAV","text":"<p>WAV\u662f\u5f55\u97f3\u65f6\u7528\u7684\u6807\u51c6\u7684windows\u6587\u4ef6\u683c\u5f0f\uff0c\u6587\u4ef6\u7684\u6269\u5c55\u540d\u4e3a\u201c.wav\u201d\uff0cWAVE\u6587\u4ef6\u4f5c\u4e3a\u6700\u7ecf\u5178\u7684Windows\u591a\u5a92\u4f53\u97f3\u9891\u683c\u5f0f\uff0c\u5e94\u7528\u975e\u5e38\u5e7f\u6cdb\u3002 \u58f0\u9053\u6709\u5355\u58f0\u9053\u548c\u7acb\u4f53\u58f0\u4e4b\u5206\uff0c\u91c7\u6837\u9891\u7387\u4e00\u822c\u670911kHz\u300122kHz\u548c44kHz\u4e09\u79cd\u3002</p> <p>WAVE\u6587\u4ef6\u6240\u5360\u5bb9\u91cf =\uff08\u91c7\u6837\u9891\u7387\u00d7\u91c7\u6837\u4f4d\u6570\u00d7\u58f0\u9053\uff09\u00d7 \u65f6\u95f4/8\uff081\u5b57\u8282=8bit\uff09\u3002</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#atrac","title":"ATRAC","text":"<p>ATRAC\u538b\u7f29\u6280\u672f\u4e3b\u8981\u662f\u5229\u7528\u4e86\u4eba\u8033\u7684\u853d\u906e\u6548\u5e94\uff0c\u5728\u5fc3\u7406\u58f0\u5b66\u539f\u7406\u4e0a\uff0c\u5728\u8fdb\u884c\u97f3\u9891\u5f55\u5165\u7684\u540c\u65f6\uff0c\u6709\u8bb8\u591a\u5916\u90e8\u7684\u9891\u6bb5\u540c\u65f6\u4e5f\u4f1a\u88ab\u5f55\u5165\uff0c\u5f53\u4eba\u8033\u540c\u65f6\u542c\u5230\u4e24\u4e2a\u4e0d\u540c\u9891\u7387\u3001\u4e0d\u540c\u97f3\u91cf\u7684\u58f0\u97f3\u65f6\uff0c\u97f3\u91cf\u8f83\u5c0f\u7684\u4f4e\u9891\u53ca\u97f3\u91cf\u8f83\u5c0f\u7684\u9ad8\u9891\u8fde\u540c\u4e0d\u4e3a\u4eba\u8033\u6240\u5bdf\u89c9\u7684\u9891\u6bb5\u4fe1\u53f7\u90fd\u4f1a\u88ab\u81ea\u52a8\u51cf\u5f31\u6216\u5ffd\u7565\u4e0d\u4e88\u8bb0\u5f55\uff0c\u56e0\u6b64\u53c8\u53ef\u4ee5\u79f0\u4e3a\u9002\u5e94\u6027\u53d8\u6362\u58f0\u7801\u6280\u672f\uff0c\u7531\u4e8e\u8fd1\u5e74\u4f86\u7f16\u7801\u538b\u7f29\u6280\u672f\uff08ATRAC\u7684\u7248\u672c\uff09\u8d8a\u4f86\u8d8a\u6210\u719f\uff0c\u6240\u4ee5\u7ecf\u8fc7\u7f16\u7801\u89e3\u7801\u8fc7\u7a0b\u540e\u7684\u58f0\u97f3\u4ecd\u76f4\u903cCD\u3002</p> <p>ATRAC\u5c0616\u6bd4\u727944.1KHz\u7684\u6570\u5b57\u4fe1\u53f7\u4ee5\u9891\u7387\u54cd\u5e94\u8f74\u5206\u621052\u4e2a\u533a\u6bb5\uff08\u5728\u4f4e\u9891\u65f6\u5206\u5272\u8f83\u7ec6\u800c\u5728\u9ad8\u9891\u65f6\u5206\u5272\u8f83\u7c97\uff09\uff0c\u6839\u636e\u58f0\u97f3\u5fc3\u7406\u5b66\u7684\u539f\u7406\uff0c\u5c06\u58f0\u97f3\u4fe1\u53f7\u4e2d\u4eba\u8033\u542c\u4e0d\u5230\u548c\u5bf9\u4eba\u7684\u542c\u529b\u5f71\u54cd\u4e0d\u5927\u7684\u4fe1\u606f\u7ed9\u5254\u9664\u51fa\u53bb\u800c\u8fbe\u5230\u7f29\u5c0f\u58f0\u97f3\u6587\u4ef6\u7684\u76ee\u7684\u3002\u5229\u7528\u8fd9\u79cd\u539f\u7406\uff0cATRAC\u53ef\u4ee5\u5c06\u5f55\u97f3\u7684\u8d44\u6599\u91cf\u538b\u7f29\u4e3a\u539f\u6765\u7684\u4e94\u5206\u4e4b\u4e00\uff08\u5373\u538b\u7f29\u6bd4\u4e3a1\uff1a5\uff09\u3002</p> <p>\u538b\u7f29\u7387\uff1a5\u500d</p> <p>\u7279\u70b9\uff1a\u81ea\u52a8\u51cf\u5f31\u6216\u8005\u5ffd\u7565\u5916\u90e8\u9891\u6bb5\u7684\u6742\u97f3</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#plac","title":"PLAC","text":"<p>FLAC\u4e0eMP3\u4e0d\u540c\uff0cMP3\u662f\u97f3\u9891\u538b\u7f29\u7f16\u7801\uff0c\u4f46FLAC\u662f\u65e0\u635f\u538b\u7f29\uff0c\u4e5f\u5c31\u662f\u8bf4\u97f3\u9891\u4ee5FLAC\u7f16\u7801\u538b\u7f29\u540e\u4e0d\u4f1a\u4e22\u5931\u4efb\u4f55\u4fe1\u606f\uff0c\u5c06FLAC\u6587\u4ef6\u8fd8\u539f\u4e3aWAV\u6587\u4ef6\u540e\uff0c\u4e0e\u538b\u7f29\u524d\u7684WAV\u6587\u4ef6\u5185\u5bb9\u76f8\u540cOGG</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#ogg","title":"OGG","text":"<p>OGG\u683c\u5f0f\u7684\u5168\u79f0\u5e94\u8be5\u662fOGG Vobis\u3002\u5b83\u662f\u4e00\u79cd\u65b0\u7684\u97f3\u9891\u538b\u7f29\u683c\u5f0f\uff0c\u7c7b\u4f3c\u4e8eMP3\u7b49\u73b0\u6709\u7684\u97f3\u4e50\u683c\u5f0f\u3002\u4f46\u6709\u4e00\u70b9\u4e0d\u540c\u7684\u662f\uff0c\u5b83\u662f\u5b8c\u5168\u514d\u8d39\u3001\u5f00\u653e\u548c\u6ca1\u6709\u4e13\u5229\u9650\u5236\u7684\u3002OGG Vobis\u6709\u4e00\u4e2a\u5f88\u51fa\u4f17\u7684\u7279\u70b9\uff0c\u5c31\u662f\u652f\u6301\u591a\u58f0\u9053\uff0c</p> <p>OGG Vobis\u5728\u538b\u7f29\u6280\u672f\u4e0a\u6bd4MP3\u597d\uff0c\u800c\u4e14\u5b83\u7684\u591a\u58f0\u9053\uff0c\u514d\u8d39\uff0c\u5f00\u6e90\u8fd9\u4e9b\u7279\u70b9\uff0c\u4f7f\u5b83\u5f88\u6709\u53ef\u80fd\u6210\u4e3a\u4e00\u4e2a\u6d41\u884c\u7684\u8d8b\u52bf\uff0c\u8fd9\u4e5f\u6b63\u662f\u4e00\u4e9bMP3\u64ad\u653e\u5668\u5bf9\u5176\u652f\u6301\u7684\u539f\u56e0</p> <p>\u53ef\u4ee5\u5bf9\u6240\u6709\u7684\u58f0\u9053\u8fdb\u884c\u7f16\u7801\uff0c\u800c\u4e0d\u662fMP3\u53ea\u80fd\u7f16\u78012\u4e2a\u58f0\u9053\u3002\u591a\u58f0\u9053\u97f3\u4e50\u7684\u5174\u8d77\uff0c\u7ed9\u97f3\u4e50\u6b23\u8d4f\u5e26\u6765\u4e86\u9769\u547d\u6027\u7684\u53d8\u5316\uff0c\u5c24\u5176\u5728\u6b23\u8d4f\u4ea4\u54cd\u65f6\uff0c\u4f1a\u5e26\u6765\u66f4\u591a\u4e34\u573a\u611f\u3002\u8fd9\u573a\u9769\u547d\u6027\u7684\u53d8\u5316\u662fMP3\u65e0\u6cd5\u9002\u5e94\u7684\u3002</p> <p>\u5728\u4ee5\u540e\u7684\u64ad\u653e\u6280\u672f\u4e0d\u65ad\u63d0\u9ad8\u4ee5\u540e\uff0c\u800c\u4e14\u4eba\u4eec\u5bf9\u97f3\u8d28\u8981\u6c42\u4e0d\u65ad\u63d0\u9ad8\uff0cOgg\u7684\u4f18\u52bf\u5c06\u66f4\u52a0\u660e\u663e\u3002</p> <p>\u4f18\u70b9\uff1a\u5b8c\u5168\u514d\u8d39\u3002\u5f00\u653e\u6ca1\u6709\u4e13\u5229\u9650\u5236\u3002\u652f\u6301\u591a\u58f0\u9053</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#ape","title":"APE","text":"<p>APE\u7684\u672c\u8d28\uff0c\u5176\u5b9e\u5b83\u662f\u4e00\u79cd\u65e0\u635f\u538b\u7f29\u97f3\u9891\u683c\u5f0f\u3002 \u5e9e\u5927\u7684WAV\u97f3\u9891\u6587\u4ef6\u53ef\u4ee5\u901a\u8fc7Monkey's Audio\u8fd9\u4e2a\u8f6f\u4ef6\u8fdb\u884c\u201c\u7626\u8eab\u201d\u538b\u7f29\u4e3aAPE\u3002 \u6709\u65f6\u5019\u5b83\u88ab\u7528\u505a\u7f51\u7edc\u97f3\u9891\u6587\u4ef6\u4f20\u8f93\uff0c\u56e0\u4e3a\u88ab\u538b\u7f29\u540e\u7684APE\u6587\u4ef6\u5bb9\u91cf\u8981\u6bd4WAV\u6e90\u6587\u4ef6\u5c0f\u4e00\u534a\u591a\uff0c\u53ef\u4ee5\u8282\u7ea6\u4f20\u8f93\u6240\u7528\u7684\u65f6\u95f4\u3002 \u66f4\u91cd\u8981\u7684\u662f\uff0c\u901a\u8fc7Monkey's Audio\u89e3\u538b\u7f29\u8fd8\u539f\u4ee5\u540e\u5f97\u5230\u7684WAV\u6587\u4ef6\u53ef\u4ee5\u505a\u5230\u4e0e\u538b\u7f29\u524d\u7684\u6e90\u6587\u4ef6\u5b8c\u5168\u4e00\u81f4\u3002 \u6240\u4ee5APE\u88ab\u8a89\u4e3a\u201c\u65e0\u635f\u97f3\u9891\u538b\u7f29\u683c\u5f0f\u201d</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#_3","title":"\u5404\u79cd\u7f16\u7801\u6bd4\u8f83","text":"","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#1","title":"1.\u538b\u7f29\u6bd4\u6bd4\u8f83","text":"<p>aac&gt;ogg&gt;mp3(wma)&gt;ape&gt;flac&gt;wav\uff08\u540c\u4e00\u97f3\u6e90\u6761\u4ef6\u4e0b\uff09</p> <p>mp3\u548cwma\u4ee5192kbps\u4e3a\u5206\u754c\u7ebf\uff0c192kbps\u4ee5\u4e0amp3\u597d\uff0c192kbps\u4ee5\u4e0bwma\u597d\u3002</p> <p>WMA\uff0810~12\uff09\uff0cAPE(\u65e0\u635f\u538b\u7f29\uff0c\u4f46\u5e9e\u5927\u7684WAV\u53ef\u4ee5\u7626\u8eab\u4e3aAPE)\uff0c</p> <p>ATRAC(1:5)\uff0cMP3(10~12)\uff0cAAC(18~20)</p> <p>FLAC(1:2)</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#2","title":"2.\u97f3\u8d28\u6bd4\u8f83","text":"<p>wav=flac=ape &gt; aac &gt; ogg &gt; mp3 &gt; wma</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#3","title":"3.\u786c\u4ef6\u652f\u6301\u6bd4\u8f83","text":"<p>MP3\u64ad\u653e\u5668\uff1amp3 &gt; wma &gt; wav &gt; flac &gt; ape aac ogg</p> <p>\u624b\u673a\uff1amp3 &gt; wma &gt; aac wav &gt; flac ogg &gt; ape</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#_4","title":"\u5404\u79cd\u7f16\u7801\u6bd4\u8f83","text":"\u79cd\u7c7b \u538b\u7f29\u6bd4 \u652f\u6301\u58f0\u9053\u6570 \u4f18\u70b9 \u7f3a\u70b9 MP3 10~12 2\u4e2a\u58f0\u9053 \u538b\u7f29\u6bd4\u9ad8\uff0c\u9002\u5408\u7528\u4e8e\u4e92\u8054\u7f51\u4e0a\u7684\u4f20\u64ad \u5728 128KBitrate \u53ca\u4ee5\u4e0b\u65f6\uff0c\u4f1a\u51fa\u73b0\u660e\u663e\u7684\u9ad8\u9891\u4e22\u5931 WMA 10~12 \u5f53 Bitrate \u5c0f\u4e8e 128K \u65f6\uff0c WMA \u6700\u4e3a\u51fa\u8272\u4e14\u7f16\u7801\u540e\u5f97\u5230\u7684\u97f3\u9891\u6587\u4ef6\u5f88\u5c0f\u3002 \u5f53 Bitrate \u5927\u4e8e 128K \u65f6\uff0c WMA \u97f3\u8d28\u635f\u5931\u8fc7\u5927\u3002 OGG \u652f\u6301\u591a\u58f0\u9053 OGG Vobis\u5728\u538b\u7f29\u6280\u672f\u4e0a\u6bd4MP3\u597d\uff0c\u800c\u4e14\u5b83\u7684\u591a\u58f0\u9053 AAC 18~20 \u652f\u6301\u591a\u58f0\u9053 \u652f\u6301\u591a\u79cd\u97f3\u9891\u58f0\u9053\u7ec4\u5408\uff0c\u63d0\u4f9b\u4f18\u8d28\u7684\u97f3\u8d28 \u4e0e\u65f6\u4e0b\u6d41\u884c\u7684APE\u3001FLAC\u7b49\u65e0\u635f\u683c\u5f0f\u76f8\u6bd4\u97f3\u8d28\u5b58\u5728\u201c\u672c\u8d28\u4e0a\u201d\u7684\u5dee\u8ddd\u3002\u52a0\u4e4b\uff0c\u4f20\u8f93\u901f\u5ea6\u66f4\u5feb\u7684USB3.0\u548c16G\u4ee5\u4e0a\u5927\u5bb9\u91cfMP3\u6b63\u5728\u52a0\u901f\u666e\u53ca\uff0c\u4e5f\u4f7f\u5f97AAC\u5934\u4e0a\u201c\u5c0f\u5de7\u201d\u7684\u5149\u73af\u4e0d\u590d\u5b58\u5728\u4e86\u3002 APE \u65e0\u635f\u538b\u7f29 \u7528\u505a\u7f51\u7edc\u97f3\u9891\u6587\u4ef6\u4f20\u8f93\uff0c\u56e0\u4e3a\u88ab\u538b\u7f29\u540e\u7684APE\u6587\u4ef6\u5bb9\u91cf\u8981\u6bd4WAV\u6e90\u6587\u4ef6\u5c0f\u4e00\u534a\u591a\uff0c\u53ef\u4ee5\u8282\u7ea6\u4f20\u8f93\u6240\u7528\u7684\u65f6\u95f4\u3002 FLAC 2 WAV \u65e0\u635f\u538b\u7f29 \u5355\u58f0\u9053\u548c\u7acb\u4f53\u58f0 WAVE\u6587\u4ef6\u4f5c\u4e3a\u6700\u7ecf\u5178\u7684Windows\u591a\u5a92\u4f53\u97f3\u9891\u683c\u5f0f","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#_5","title":"\u5e38\u89c1\u7684\u89c6\u9891\u7f16\u7801\u683c\u5f0f","text":"<p>\u6240\u8c13\u89c6\u9891\u7f16\u7801\u65b9\u5f0f\u5c31\u662f\u6307\u901a\u8fc7\u7279\u5b9a\u7684\u538b\u7f29\u6280\u672f\uff0c\u5c06\u67d0\u4e2a\u89c6\u9891\u683c\u5f0f\u7684\u6587\u4ef6\u8f6c\u6362\u6210\u53e6\u4e00\u79cd\u89c6\u9891\u683c\u5f0f\u6587\u4ef6\u7684\u65b9\u5f0f\u3002</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#_6","title":"\u89c6\u9891\u4f20\u8f93\u4e2d\u7684\u7f16\u7801\u6807\u51c6","text":"<ol> <li>\u56fd\u9645\u7535\u8054\u7684H.264</li> <li>\u56fd\u9645\u6807\u51c6\u5316\u7ec4\u7ec7\u8fd0\u52a8\u56fe\u50cf\u4e13\u5bb6\u7ec4\u7684MPEG\u7cfb\u5217\u6807\u51c6</li> <li>\u5fae\u8f6f\u516c\u53f8\u7684WMV</li> <li>Apple\u516c\u53f8\u7684 QuickTime</li> <li>google\u529b\u63a8\u7684WebM\u683c\u5f0f</li> </ol> <p>\u9ad8\u6e05\u89c6\u9891\u7684\u7f16\u7801\u683c\u5f0f\u6709\u4e94\u79cd\uff0c\u5373H.264\u3001MPEG-4\u3001MPEG-2\u3001WMA-HD\u4ee5\u53caVC-1\u3002</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#h264","title":"H.264","text":"<p>H.264\u662f\u7531\u56fd\u9645\u7535\u4fe1\u8054\u76df\uff08iTU-T\uff09\u6240\u5236\u5b9a\u7684\u65b0\u4e00\u4ee3\u7684\u89c6\u9891\u538b\u7f29\u683c\u5f0f\u3002 H.264\u7684\u6570\u636e\u538b\u7f29\u6bd4\u80fd\u6bd4\u5f53\u524dDVD\u7cfb\u7edf\u4e2d\u4f7f\u7528\u7684 MPEG-2\u9ad82\uff5e3\u500d\uff0c\u6bd4MPEG-4\u9ad81.5\uff5e2\u500d\u3002\u6b63\u56e0\u4e3a\u5982\u6b64\uff0c\u7ecf\u8fc7H.264\u538b\u7f29\u7684\u89c6\u9891\u6570\u636e\uff0c\u5728\u7f51\u7edc\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u6240\u9700\u8981\u7684\u5e26\u5bbd\u66f4\u5c11\uff0c\u4e5f\u66f4\u52a0\u7ecf\u6d4e.</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#_7","title":"\u7f3a\u70b9\uff1a","text":"<ol> <li>\u4e0eMPEG-4\u4e00\u6837\uff0c\u7ecf\u8fc7H.264\u538b\u7f29\u7684\u89c6\u9891\u6587\u4ef6\u4e00\u822c\u4e5f\u662f\u91c7\u7528avi \u4f5c\u4e3a\u5176\u540e\u7f00\u540d\uff0c\u540c\u6837\u4e0d\u5bb9\u6613\u8fa8\u8ba4\uff0c\u53ea\u80fd\u901a\u8fc7\u89e3\u7801\u5668\u6765\u81ea\u5df1\u8bc6\u522b\u3002</li> <li>H.264\u7f16\u7801\u7684\u5f71\u7247\u5728\u64ad\u653e\u7684\u65f6\u5019\u5bf9\u786c\u4ef6\u7cfb\u7edf\u4e5f\u63d0\u51fa\u4e86\u975e\u5e38\u9ad8\u7684\u8981\u6c42\u3002</li> </ol> <p>\u636e\u76f8\u5173\u8d44\u6599\u663e\u793a\uff0cH.264\u7684\u5f71\u7247\u5728\u7f16\u7801\u7684\u8fc7\u7a0b\u4e2d\u590d\u6742\u5ea6\u662fMPEG2\u768410\u500d\uff0c\u89e3\u7801\u7684\u590d\u6742\u5ea6\u662fMPEG2\u76843\u500d\uff0c\u8fd9\u5bf9\u4e8eCPU\u6765\u8bf4\u662f\u5f88\u6c89\u91cd\u7684\u8d1f\u62c5\uff0c\u800c\u663e\u5361\u82af\u7247\u5982\u679c\u8981\u6574\u5408\u786c\u4ef6\u89e3\u7801\u6a21\u5757\uff0c\u5176\u96be\u5ea6\u4e5f\u968f\u4e4b\u52a0\u5927</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#_8","title":"\u4f18\u70b9\uff1a","text":"<ol> <li>H.264 \u4f7f\u56fe\u50cf\u538b\u7f29\u6280\u672f\u4e0a\u5347\u5230\u4e86\u4e00\u4e2a\u66f4\u9ad8\u7684\u9636\u6bb5\uff0c\u80fd\u591f\u5728\u8f83\u4f4e\u5e26\u5bbd\u4e0a\u63d0\u4f9b\u9ad8\u8d28\u91cf\u7684\u56fe\u50cf\u4f20\u8f93\uff0c\u8be5\u4f18\u70b9\u975e\u5e38\u9002\u5408\u56fd\u5185\u8fd0\u8425\u5546\u7528\u6237\u91cf\u5927\u3001\u63a5\u5165\u7f51/\u9aa8\u5e72\u7f51\u5e26\u5bbd\u76f8\u5bf9\u6709\u9650\u7684\u72b6\u51b5\u3002</li> </ol>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#_9","title":"\u7279\u70b9\uff1a","text":"<ol> <li>\u66f4\u9ad8\u7684\u7f16\u7801\u6548\u7387</li> <li>\u9ad8\u8d28\u91cf\u7684\u89c6\u9891\u753b\u9762</li> <li>\u63d0\u9ad8\u7f51\u7edc\u9002\u5e94\u80fd\u529b\uff1aH.264\u53ef\u4ee5\u5de5\u4f5c\u5728\u5b9e\u65f6\u901a\u4fe1\u5e94\u7528\uff08\u5982\u89c6\u9891\u4f1a\u8bae\uff09\u4f4e\u5ef6\u65f6\u6a21\u5f0f\u4e0b\uff0c\u4e5f\u53ef\u4ee5\u5de5\u4f5c\u5728\u6ca1\u6709\u5ef6\u65f6\u7684\u89c6\u9891\u5b58\u50a8\u6216\u89c6\u9891\u6d41\u670d\u52a1\u5668\u4e2d\u3002</li> <li>\u91c7\u7528\u6df7\u5408\u7f16\u7801\u7ed3\u6784</li> <li>\u9519\u8bef\u6062\u590d\u529f\u80fd\uff1aH.264\u63d0\u4f9b\u4e86\u89e3\u51b3\u7f51\u7edc\u4f20\u8f93\u5305\u4e22\u5931\u7684\u95ee\u9898\u7684\u5de5\u5177\uff0c\u9002\u7528\u4e8e\u5728\u9ad8\u8bef\u7801\u7387\u4f20\u8f93\u7684\u65e0\u7ebf\u7f51\u7edc\u4e2d\u4f20\u8f93\u89c6\u9891\u6570\u636e\u3002</li> <li>\u8f83\u9ad8\u7684\u590d\u6742\u5ea6\uff1a264\u6027\u80fd\u7684\u6539\u8fdb\u662f\u4ee5\u589e\u52a0\u590d\u6742\u6027\u4e3a\u4ee3\u4ef7\u800c\u83b7\u5f97\u7684\u3002\u636e\u4f30\u8ba1\uff0cH.264\u7f16\u7801\u7684\u8ba1\u7b97\u590d\u6742\u5ea6\u5927\u7ea6\u76f8\u5f53\u4e8eH.263\u76843\u500d\uff0c\u89e3\u7801\u590d\u6742\u5ea6\u5927\u7ea6\u76f8\u5f53\u4e8eH.263\u76842\u500d\u3002</li> </ol>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#mpeg4","title":"MPEG4","text":"<p>\u7531\u4e8eMPEG4\u53ea\u5904\u7406\u56fe\u50cf\u5e27\u4e0e\u5e27\u4e4b\u95f4\u6709\u5dee\u5f02\u7684\u5143\u7d20\uff0c\u800c\u820d\u5f03\u76f8\u540c\u7684\u5143\u7d20\uff0c\u56e0\u6b64\u5927\u5927\u51cf\u5c11\u4e86\u5408\u6210\u591a\u5a92\u4f53\u6587\u4ef6\u7684\u4f53\u79ef\u3002 \u5e94\u7528MPEG4\u6280\u672f\u7684\u5f71\u97f3\u6587\u4ef6\u6700\u663e\u8457\u7279\u70b9\u5c31\u662f\u538b\u7f29\u7387\u9ad8\u4e14\u6210\u50cf\u6e05\u6670\uff0c\u4e00\u822c\u6765\u8bf4\uff0c\u4e00\u5c0f\u65f6\u7684\u5f71\u50cf\u53ef\u4ee5\u88ab\u538b\u7f29\u4e3a350M\u5de6\u53f3\u7684\u6570\u636e\uff0c\u800c\u4e00\u90e8\u9ad8\u6e05\u6670\u5ea6\u7684DVD\u7535\u5f71, \u53ef\u4ee5\u538b\u7f29\u6210\u4e24\u5f20\u751a\u81f3\u4e00\u5f20650M CD\u5149\u789f\u6765\u5b58\u50a8\u3002</p> <p>MPEG-4\u4e0d\u4ec5\u53ef\u63d0\u4f9b\u9ad8\u538b\u7f29\u7387\uff0c\u540c\u65f6\u4e5f\u53ef\u5b9e\u73b0\u66f4\u597d\u7684\u591a\u5a92\u4f53\u5185\u5bb9\u4e92\u52a8\u6027\u53ca\u5168\u65b9\u4f4d\u7684\u5b58\u53d6\u6027\uff0c\u5b83\u91c7\u7528\u5f00\u653e\u7684\u7f16\u7801\u7cfb\u7edf\uff0c\u53ef\u968f\u65f6\u52a0\u5165\u65b0\u7684\u7f16\u7801\u7b97\u6cd5\u6a21\u5757\uff0c\u540c\u65f6\u4e5f\u53ef\u6839\u636e\u4e0d\u540c\u5e94\u7528\u9700\u6c42\u73b0\u573a\u914d\u7f6e\u89e3\u7801\u5668\uff0c\u4ee5\u652f\u6301\u591a\u79cd\u591a\u5a92\u4f53\u5e94\u7528\u3002</p> <p>\u4f18\u70b9:</p> <ol> <li>\u5177\u6709\u5f88\u597d\u7684\u517c\u5bb9\u6027\uff1b</li> <li>MPEG-4\u6bd4\u5176\u4ed6\u7b97\u6cd5\u63d0\u4f9b\u66f4\u597d\u7684\u538b\u7f29\u6bd4\uff0c\u6700\u9ad8\u8fbe200\uff1a1\uff1b</li> <li>MPEG-4\u5728\u63d0\u4f9b\u9ad8\u538b\u7f29\u6bd4\u7684\u540c\u65f6\uff0c\u5bf9\u6570\u636e\u7684\u635f\u5931\u5f88\u5c0f\u3002\u6240\u4ee5\uff0cmpeg-4\u7684\u5e94\u7528\u80fd\u5927\u5e45\u5ea6\u7684\u964d\u4f4e\u5f55\u50cf\u5b58\u50a8\u5bb9\u91cf\uff0c\u83b7\u5f97\u8f83\u9ad8\u7684\u5f55\u50cf\u6e05\u6670\u5ea6\uff0c\u7279\u522b\u9002\u7528\u4e8e\u957f\u65f6\u95f4\u5b9e\u65f6\u5f55\u50cf\u7684\u9700\u6c42\uff0c\u540c\u65f6\u5177\u5907\u5728\u4f4e\u5e26\u5bbd\u4e0a\u4f18\u826f\u7684\u7f51\u7edc\u4f20\u8f93\u80fd\u529b\u3002</li> <li>\u91c7\u7528\u5f00\u653e\u7684\u7f16\u7801\u7cfb\u7edf,\u53ef\u4ee5\u52a0\u5165\u65b0\u7684\u7f16\u7801\u7b97\u6cd5\u6a21\u5757.</li> </ol>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#vc-1","title":"VC-1","text":"<p>VC-1\u662f\u8f6f\u4ef6\u5de8\u5934\u5fae\u8f6f\u529b\u63a8\u7684\u4e00\u79cd\u89c6\u9891\u7f16\u7801\u7684\u683c\u5f0f</p> <p>\u603b\u7684\u6765\u8bf4\uff0c\u4ece\u538b\u7f29\u6bd4\u4e0a\u6765\u770b\uff0cH.264\u7684\u538b\u7f29\u6bd4\u7387\u66f4\u9ad8\u4e00\u4e9b\uff0c\u4e5f\u5c31\u662f\u540c\u6837\u7684\u89c6\u9891\uff0c\u901a\u8fc7H.264\u7f16\u7801\u7b97\u6cd5\u538b\u51fa\u6765\u7684\u89c6\u9891\u5bb9\u91cf\u8981\u6bd4VC-1\u7684\u66f4\u5c0f\uff0c\u4f46\u662fVC-1\u683c\u5f0f\u7684\u89c6\u9891\u5728\u89e3\u7801\u8ba1\u7b97\u65b9\u9762\u5219\u66f4\u5c0f\u4e00\u4e9b\uff0c\u4e00\u822c\u901a\u8fc7\u9ad8\u6027\u80fd\u7684CPU\u5c31\u53ef\u4ee5\u5f88\u6d41\u7545\u7684\u89c2\u770b\u9ad8\u6e05\u89c6\u9891\u3002\uff08H.264\u5bf9\u786c\u4ef6\u7684\u8981\u6c42\u6bd4\u8f83\u9ad8\uff09</p> <p>VC-1\u76ee\u524d\u7684\u6c14\u52bf\u4f9d\u7136\u5f31\u4e8eH.264\uff0c\u4e5f\u5f31\u4e8eMPEG-4\uff0c\u4e00\u65b9\u9762\u662fVC-1\u5728\u6280\u672f\u5c42\u9762\u4e0a\u7684\u5b9e\u9645\u8868\u73b0\u4e0eH.264\u65e0\u592a\u5927\u5dee\u5f02\uff0cVC-1\u540c\u6837\u4ee5MPEG-4\u4e3a\u57fa\u7840\uff0c\u4f46\u5e76\u6ca1\u6709\u7279\u522b\u7684\u7a81\u51fa\u70b9\u6216\u4f18\u8d8a\u6027\uff0c\u8fd0\u8425\u5546\u4ece\u6280\u672f\u89d2\u5ea6\u8003\u8651\u6ca1\u6709\u5fc5\u8981\u975e\u9009\u62e9VC-1\u3002 \u53e6\u5916\uff0c\u4ece\u6388\u6743\u89d2\u5ea6\u6765\u770bVC-1\u662f\u5426\u6709\u4f18\u52bf\u5462\uff1f\u7b54\u6848\u662f\u4e09\u8005\u4e2d\u6700\u4e0d\u5229\u7684\uff0c\u788d\u4e8eMicrosoft\u4e00\u8d2f\u7684\u63a8\u884c\u7b56\u7565\uff0cVC-1\u7684\u6388\u6743\u6765\u6e90\u4ec5\u53ea\u4e00\u5bb6\uff0c\u6388\u6743\u4ef7\u683c\u4e0e\u65b9\u5f0f\u8c03\u6574\uff0c\u4ee5\u53ca\u540e\u7eed\u7248\u672c\u7684\u6539\u8fdb\u65b9\u5411\uff0c\u90fd\u7531\u5fae\u8f6f\u4e00\u624b\u638c\u63e1\uff0c\u65e0\u4eba\u80fd\u5de6\u53f3\uff0c\u773c\u524d\u4e3a\u4e0eMPGE-4\u3001H.264\u7b49\u7ade\u4e89\uff0cVC-1\u6388\u6743\u81ea\u7136\u4e0d\u6562\u8fc7\u9ad8\uff0c\u4f46\u8fd0\u8425\u5546\u4f9d\u7136\u5bf9\u672a\u6765\u662f\u5426\u4f1a\u6da8\u4ef7\u8868\u793a\u62c5\u5fc3\u3002</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#mpeg-2","title":"MPEG-2","text":"<p>\u76ee\u524d\u7684MPEG-2\u7684\u89c6\u9891\u5728\u84dd\u5149\u65f6\u4ee3\u4e00\u6837\u662f\u5f97\u5230\u4e86\u91cd\u7528\uff0cMPEG-2\u4e0d\u662fMPEG-1\u7684\u7b80\u5355\u5347\u7ea7\uff0cMPEG-2\u5728\u7cfb\u7edf\u548c\u4f20\u9001\u65b9\u9762\u4f5c\u4e86\u66f4\u52a0\u8be6\u7ec6\u7684\u89c4\u5b9a\u548c\u8fdb\u4e00\u6b65\u7684\u5b8c\u5584\u3002MPEG-2\u7279\u522b\u9002\u7528\u4e8e\u5e7f\u64ad\u7ea7\u7684\u6570\u5b57\u7535\u89c6\u7684\u7f16\u7801\u548c\u4f20\u9001\uff0c\u88ab\u8ba4\u5b9a\u4e3aSDTV\u548cHDTV\u7684\u7f16\u7801\u6807\u51c6\u3002DVD\u5f71\u789f\u5c31\u662f\u91c7\u7528MPEG-2\u538b\u7f29\u6807\u51c6\u3002</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/audio/some-audio-video-media-format/#_10","title":"\u5404\u79cd\u89c6\u9891\u7f16\u7801\u683c\u5f0f\u6027\u80fd\u6bd4\u8f83","text":"\u6027\u80fd MPEG2 MPEG4 H264 VC-1 \u538b\u7f29\u6bd4(MPEG2\u4e3a1) 100% 50%~60% 25%~40% 30%~40% \u5bf9\u786c\u4ef6\u7684\u8981\u6c42 \u6700\u4f4e \u8f83\u4f4e \u6700\u9ad8 \u8f83\u9ad8 \u6388\u6743\u6210\u672c \u6700\u4f4e \u8f83\u9ad8 \u6700\u4f4e \u8f83\u4f4e \u753b\u9762\u8d28\u91cf \u4e00\u822c \u8f83\u597d \u6700\u597d \u6700\u597d \u9002\u7528\u573a\u666f \u9002\u7528\u4e8e\u5e7f\u64ad\u7ea7\u7684\u6570\u5b57\u7535\u89c6\u7684\u7f16\u7801\u548c\u4f20\u9001\uff0c\u88ab\u8ba4\u5b9a\u4e3aSDTV\u548cHDTV\u7684\u7f16\u7801\u6807\u51c6\u3002DVD\u5f71\u789f\u5c31\u662f\u91c7\u7528MPEG-2\u538b\u7f29\u6807\u51c6\u3002 MPEG-4\u5728\u63d0\u4f9b\u9ad8\u538b\u7f29\u6bd4\u7684\u540c\u65f6\uff0c\u5bf9\u6570\u636e\u7684\u635f\u5931\u5f88\u5c0f\u3002\u6240\u4ee5\uff0cmpeg-4\u7684\u5e94\u7528\u80fd\u5927 \u5e45\u5ea6\u7684\u964d\u4f4e\u5f55\u50cf\u5b58\u50a8\u5bb9\u91cf\uff0c\u83b7\u5f97\u8f83\u9ad8\u7684\u5f55\u50cf\u6e05\u6670\u5ea6\uff0c\u7279\u522b\u9002\u7528\u4e8e\u957f\u65f6\u95f4\u5b9e\u65f6\u5f55\u50cf\u7684\u9700\u6c42 H.264\u53ef\u4ee5\u5de5\u4f5c\u5728\u5b9e\u65f6\u901a\u4fe1\u5e94\u7528\uff08\u5982\u89c6\u9891\u4f1a\u8bae\uff09\u4f4e\u5ef6\u65f6\u6a21\u5f0f\u4e0b\uff0c\u4e5f\u53ef\u4ee5\u5de5\u4f5c\u5728\u6ca1\u6709\u5ef6\u65f6\u7684\u89c6\u9891\u5b58\u50a8\u6216\u89c6\u9891\u6d41\u670d\u52a1\u5668\u4e2d\u3002 \u9ad8\u538b\u7f29\u6bd4,\u753b\u9762\u8d28\u91cf\u597d\u4f46\u662f\u5bf9\u786c\u4ef6\u8981\u6c42\u6ca1\u6709H264\u9ad8\u7684\u573a\u666f","tags":["\u97f3\u89c6\u9891"]},{"location":"media/color/yuv-intro/","title":"YUV\u7b80\u4ecb","text":"\u66f4\u65b0\u65f6\u95f4: 2022-10-12 <ul> <li>2022-10-12: \u4fee\u6539\u8bf4\u660e</li> <li>2021-12-30: \u4fee\u6539\u8bf4\u660e</li> </ul> <p>\u5bf9\u4e8e\u89c6\u9891\u5e27\u7684\u88f8\u6570\u636e\u8868\u793a\uff0c\u5176\u5b9e\u66f4\u591a\u7684\u662fYUV\u6570\u636e\u683c\u5f0f\u7684\u8868\u793a\uff0cYUV\u4e3b\u8981\u5e94\u7528\u4e8e\u4f18\u5316\u5f69\u8272\u89c6\u9891\u4fe1\u53f7\u7684\u4f20\u8f93\uff0c\u4f7f\u5176\u5411\u540e\u517c\u5bb9\u8001\u5f0f\u9ed1\u767d\u7535\u89c6\u3002\u4e0eRGB\u89c6\u9891\u4fe1\u53f7\u4f20\u8f93\u76f8\u6bd4\uff0c\u5b83\u6700\u5927\u7684\u4f18\u70b9\u5728\u4e8e\u53ea\u9700\u8981\u5360\u7528\u6781\u5c11\u7684\u9891\u5bbd\uff08RGB\u8981\u6c42\u4e09\u4e2a\u72ec\u7acb\u7684\u89c6\u9891\u4fe1\u53f7\u540c\u65f6\u4f20\u8f93\uff09\u3002</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/color/yuv-intro/#color-space","title":"\u989c\u8272\u7a7a\u95f4 color space","text":"<p>\u5728\u7535\u8111\u56fe\u5f62\u4e2d\u6211\u4eec\u5e38\u4f1a\u9047\u5230RGB\u989c\u8272\u3002RGB\u4e2d\u7684\u7ea2\u7eff\u84dd\u76f4\u63a5\u5206\u522b\u5bf9\u5e94\u4e86\u53ef\u89c1\u5149\u7684\u90e8\u5206\u3002 RGB\u503c\u80fd\u5efa\u7acb\u4e00\u4e2a\u7cbe\u786e\u7684\u6570\u5b57\u5750\u6807\u7cfb\u7edf\uff0c\u79f0\u4f5c\u989c\u8272\u7a7a\u95f4\uff08color space\uff09\u3002\u7ea2\u8272\u90e8\u5206\u5b9a\u4e49\u4e86\u5750\u6807\u7cfb\u4e2d\u7684\u4e00\u4e2a\u8f74\u3002 \u5176\u6b21\u662f\u7eff\u8272\u548c\u84dd\u8272\u3002\u5982\u4e0b\u56fe\u6240\u793a\u3002\u6240\u6709\u6709\u6548\u7684RGB\u503c\u90fd\u5728\u8fd9\u4e2a\u989c\u8272\u7a7a\u95f4\u91cc\u3002</p> <p>\u4f8b\u5982\u6d0b\u7ea2\u8272\uff08pure magenta\uff09\u662f 100% blue\uff0c100% red\uff0c \u548c 0% green.</p> <p></p> <p>RGB\u662f\u4ee3\u8868\u989c\u8272\u7684\u4e00\u79cd\u65b9\u5f0f\u3002\u5176\u5b83\u5750\u6807\u7cfb\u4e5f\u53ef\u4ee5\u4ee3\u8868\u989c\u8272\u3002  </p> <p>YUV\u662f\u4e00\u79cd\u989c\u8272\u7f16\u7801\u65b9\u6cd5\u3002\u6570\u5b57\u89c6\u9891\u5e38\u7528YUV\u683c\u5f0f\u6765\u538b\u7f29\u3002</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/color/yuv-intro/#yuv_1","title":"YUV\u5b9a\u4e49","text":"<p>YUV\u662f\u5c06\u4eae\u5ea6\u4fe1\u606f\u548c\u989c\u8272\u4fe1\u606f\u5206\u522b\u7f16\u7801\u7684\u4e00\u7cfb\u5217\u989c\u8272\u7a7a\u95f4\u7684\u7edf\u79f0\u3002\u548cRGB\u76f8\u4f3c\uff0cYUV\u4f7f\u75283\u4e2a\u503c\u6765\u8868\u793a\u989c\u8272\u3002 \u8fd93\u4e2a\u503c\u79f0\u4e3aY'\uff0cU\uff0c\u548cV\u3002\uff08\u4e8b\u5b9e\u4e0a\uff0c<code>YUV</code>\u8fd9\u4e2a\u79f0\u547c\u5728\u7535\u8111\u89c6\u9891\u4e2d\u603b\u662f\u6307\u4ee3<code>Y'CbCr</code>\u3002\u7136\u800c\u5728\u672c\u6587\u4e2d<code>YUV</code>\u7ecf\u5e38\u7528\u6765\u6307\u4ee3\u548c<code>Y'CbCr</code>\u76f8\u540c\u539f\u7406\u7684\u989c\u8272\u7a7a\u95f4\uff09</p> <p>YUV\u7c7b\u4f3cRGB\uff0c\u90fd\u80fd\u4ee3\u8868\u989c\u8272\uff0c\u8868\u793a\u989c\u8272\u3002</p> <p><code>Y'</code>\u90e8\u5206\uff0c\u4e5f\u79f0\u4f5cluma\uff0c\u4ee3\u8868\u989c\u8272\u4e2d\u7684<code>\u4eae\u5ea6\u503c</code>\u3002\u8fd9\u4e2a\u8bb0\u53f7\uff08<code>'</code>\uff09\u662f\u7528\u6765\u4e0e\u79f0\u4e3a<code>Y</code>\u7684luminance\uff08\u4eae\u5ea6\uff09\u4f5c\u533a\u522b\u7684\u3002</p> <p>luminance\u53ef\u4ece\u7ebf\u6027RGB\u503c\u4e2d\u5bfc\u51fa\uff0cluma\u4ece\u975e\u7ebf\u6027\uff08gamma-corrected\uff09RGB\u503c\u4e2d\u5bfc\u51fa\u3002 luminance\u66f4\u63a5\u8fd1\u771f\u5b9e\u4eae\u5ea6\uff0c\u4f46luma\u5728\u6280\u672f\u4e0a\u66f4\u5e38\u7528\u3002 \u70b9\u8bb0\u53f7\uff08<code>'</code>\uff09\u901a\u5e38\u88ab\u5ffd\u7565\uff0c\u4f46YUV\u989c\u8272\u7a7a\u95f4\u603b\u662f\u4f7f\u7528luma\u3002\u540e\u6587\u4f1a\u6df7\u7528<code>Y</code>\u4e0e<code>Y'</code>\u3002</p> <p>\u6807\u51c6\u5b9a\u4e49\u7535\u89c6\u4e2d\uff0cluma\u8ba1\u7b97\u516c\u5f0f\u4e3a\uff1a <pre><code>Y' = 0.299R + 0.587G + 0.114B\n</code></pre> \u8fd9\u4e2a\u516c\u5f0f\u63ed\u793a\u4e86\u4eba\u773c\u5bf9\u4e8e\u7279\u5b9a\u6ce2\u957f\u7684\u5149\u66f4\u4e3a\u654f\u611f\u3002\u84dd\u8272\u662f\u6700\u6697\u6de1\u7684\uff0c\u7eff\u8272\u662f\u6700\u660e\u4eae\u7684\uff0c\u7ea2\u8272\u5904\u4e8e\u4e24\u8005\u4e4b\u95f4\u3002 \u8fd9\u4e2a\u516c\u5f0f\u4e5f\u5f71\u54cd\u4e86\u65e9\u671f\u7535\u89c6\u4f7f\u7528\u7684\u8367\u5149\u7c89\u3002</p> <p>\u73b0\u4ee3\u7535\u89c6\u6280\u672f\u4f7f\u7528\u4e86\u66f4\u65b0\u7684\u516c\u5f0f\uff0c\u7528\u4e8e\u9ad8\u6e05\u7535\u89c6 <pre><code>Y' = 0.2125R + 0.7154G + 0.0721B\n</code></pre> \u516c\u5f0f\u76f8\u5173\u5b9a\u4e49\u53ef\u67e5\u8be2<code>ITU-R BT.601</code></p> <p>U\u548cV\u90e8\u5206\uff0c\u79f0\u4e3a\u8272\u5ea6\u503c\u6216\u989c\u8272\u533a\u5206\u503c\u3002\u7531\u4ee5\u4e0b\u516c\u5f0f\u8ba1\u7b97\uff1a <pre><code>U = B - Y'\nV = R - Y'\n</code></pre> <code>YUV</code>\u80fd\u591f\u5b8c\u6574\u5730\u8fd8\u539f\u56deRBG\u503c\u3002\u4f20\u8f93\u6765\u7684<code>YUV</code>\uff0c\u80fd\u8f6c\u6362\u4e3a\u76f8\u5e94\u7684\u989c\u8272\u503c\u3002</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/color/yuv-intro/#_1","title":"\u91c7\u6837\u65b9\u5f0f","text":"<p>\u91c7\u6837\u901a\u5e38\u75283\u90e8\u5206\u7684\u6bd4\u4f8b\u8868\u793a<code>J:a:b</code>\uff08\u4f8b\u59824:2:2\uff09\u3002\u5982\u679c\u6709alpha\u901a\u9053\uff0c\u4e5f\u75284\u4e2a\u6570\u7684\u6bd4\u4f8b\uff08\u4f8b\u59824:2:2:4\uff09\u3002</p> <p>\u6982\u5ff5\u4e0a\u6765\u8bf4\uff0c\u6211\u4eec\u8003\u8651\u7684\u662fJ\u4e2a\u50cf\u7d20\u5bbd\uff0c2\u4e2a\u50cf\u7d20\u9ad8\u7684\u533a\u57df\u3002</p> <ul> <li>J: \u6c34\u5e73\u91c7\u6837\u7684\u53c2\u8003\uff0c\u4e5f\u53ef\u4ee5\u8bf4\u662f\u5bbd\u5ea6\uff0c\u901a\u5e38\u662f4</li> <li>a: \u7b2c\u4e00\u884cJ\u4e2a\u50cf\u7d20\u7684\u8272\u5ea6\u4e2a\u6570\uff08Cr, Cb\uff09</li> <li>b: \u7b2c\u4e00\u884c\u548c\u7b2c\u4e8c\u884c\u6709\u5dee\u522b\u7684\u8272\u5ea6\u4e2a\u6570\uff08Cr, Cb\uff09\u3002\u6ce8\u610fb\u7684\u503c\u901a\u5e38\u4e3a0\u6216\u8005\u7b49\u4e8ea\u3002</li> </ul> <p>\u4e3b\u6d41\u7684\u91c7\u6837\u65b9\u5f0f\u6709\u4e09\u79cd\uff1aYUV4:4:4\uff0cYUV4:2:2\uff0cYUV4:2:0</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/color/yuv-intro/#yuv444","title":"<code>YUV4:4:4</code>","text":"<p>\u7b2c\u4e00\u884c\u67094\u7ec4UV\u3002\u7b2c\u4e8c\u884c\u6709\u53e6\u5916\u76844\u7ec4UV\u3002\u8fd9\u4e5f\u53eb\u505a\u201c\u5168\u91c7\u6837\u201d\u3002</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/color/yuv-intro/#yuv422","title":"<code>YUV4:2:2</code>","text":"<p>\u7b2c\u4e00\u884c\u67092\u7ec4UV\u3002\u7b2c\u4e8c\u884c\u6709\u53e6\u59162\u7ec4UV\u3002</p> <p>\u770b\u8d77\u6765\u5c31\u50cf\u662f2\u4e2a\u50cf\u7d20\u70b9\u5171\u75281\u7ec4UV\uff081\u4e2aU\u548c1\u4e2aV\uff09</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/color/yuv-intro/#yuv420","title":"<code>YUV4:2:0</code>","text":"<p>\u6211\u4eec\u770b\u865a\u7ebf\u6846\u5185\u3002\u7b2c\u4e00\u884c\u67092\u7ec4UV\u3002\u7b2c\u4e8c\u884c\u6ca1\u6709\u81ea\u5df1\u7684UV\uff0c\u7528\u7684UV\u548c\u7b2c\u4e00\u884c\u76f8\u540c\u3002</p> <p>\u770b\u8d77\u6765\u5c31\u50cf\u662f4\u4e2a\u50cf\u7d20\u5171\u75281\u7ec4UV\u3002</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/color/yuv-intro/#yuv_2","title":"YUV\u7684\u4f18\u70b9","text":"<p>\u7531\u4e8e\u5386\u53f2\u539f\u56e0\uff0c\u6a21\u62df\u7535\u89c6\u90e8\u5206\u4f7f\u7528\u4e86YUV\u683c\u5f0f\u3002\u6a21\u62df\u5f69\u8272\u7535\u89c6\u4fe1\u53f7\u80fd\u591f\u517c\u5bb9\u4ee5\u524d\u7684\u9ed1\u767d\u7535\u89c6\u3002 \u5f69\u8272\u7535\u89c6\u4fe1\u53f7\u643a\u5e26\u7740\u8272\u5ea6\u503c\uff08U\u548cV\uff09\u4e0e\u7070\u5ea6\u503c\u3002\u9ed1\u767d\u7535\u89c6\u5ffd\u7565\u8272\u5ea6\u503c\uff0c\u663e\u793a\u51fa\u7070\u5ea6\u56fe\u7247\u3002 \u5f69\u8272\u7535\u89c6\u53ef\u4ee5\u63d0\u53d6\u51fa\u8272\u5ea6\u4fe1\u606f\u5e76\u5c06\u4fe1\u53f7\u8fd8\u539f\u56deRGB\u3002</p> <p>\u5728\u4eca\u5929YUV\u6709\u7740\u53e6\u4e00\u4e2a\u4f18\u70b9\u3002\u76f8\u6bd4\u4e8e\u4eae\u5ea6\u7684\u53d8\u6362\uff0c\u4eba\u773c\u5bf9\u4e8e\u8272\u5f69\u7684\u53d8\u6362\u66f4\u8fdf\u949d\u3002\u90a3\u4e48\u4e00\u5f20\u56fe\u7247\u4e2d\uff0c\u53ef\u4ee5\u5c11\u5b58\u653e\u4e00\u4e9b\u8272\u5ea6\u4fe1\u606f\u3002 \u4f8b\u5982\uff0c\u6700\u5f00\u59cb1\u4e2a\u50cf\u7d20\u6709Y'UV\u8fd93\u4e2a\u503c\u3002\u53ef\u4ee5\u5c06\u540c\u6c34\u5e73\u7ebf\uff08horizontal resolution\uff09\u4e0a\u7684\u8272\u5ea6\u503c\u7684\u6570\u91cf\u964d\u4e3a\u4eae\u5ea6\u503c\u6570\u91cf\u7684\u4e00\u534a\u3002</p> <p>\u6362\u8a00\u4e4b\uff0c\u4e00\u884c\u50cf\u7d20\u4e2d\uff0c\u6bcf2\u4e2a\u4eae\u5ea6\u503c\u5171\u75281\u4e2aU\u548cV\u503c\u3002 \u5047\u8bbe\u6bcf\u4e2a\u503c\u662f8\u4f4d\uff0c\u5219\u6bcf2\u4e2a\u50cf\u7d20\u9700\u89814\u4e2a\u5b57\u8282\u6765\u8868\u793a\uff082\u4e2aY'\uff0c1\u4e2aU\u548c1\u4e2aV\uff09\u3002\u5e73\u5747\u4e0b\u6765\u6bcf\u4e2a\u50cf\u7d20\u752816\u4f4d\u6765\u8868\u793a\u3002 \u76f8\u5f53\u4e8e\u635f\u5931\u4e8630%\u768424\u4f4dRGB\u7f16\u7801\u3002</p> <p>\u4e0a\u9762\u7684\u5c0f\u4f8b\u5b50\uff1a\u6700\u5f00\u59cb2\u4e2a\u50cf\u7d20\u5171\u9700\u89816\u4e2a\u5b57\u8282\uff082\u5957Y'UV\uff09\u3002\u73b0\u57282\u4e2a\u50cf\u7d20\u5171\u9700\u89814\u4e2a\u5b57\u8282\uff082\u4e2aY'\uff0c1\u4e2aU\u548c1\u4e2aV\uff09\u3002</p> <p>YUV\u5e76\u6ca1\u6709\u538b\u7f29RGB\u4fe1\u606f\u3002\u9664\u975e\u8272\u5ea6\u503c\u88ab\u964d\u4f4e\u91c7\u6837\u7387\u3002\u4e00\u4e2aYUV\u50cf\u7d20\u548c\u4e00\u4e2aRGB\u50cf\u7d20\u6709\u7740\u76f8\u540c\u7684\u5927\u5c0f\u3002 \u4eceRGB\u6362\u7b97\u6210YUV\u5e76\u6ca1\u6709\u635f\u5931\u4fe1\u606f\u3002\u82e5\u6ca1\u6709\u964d\u91c7\u6837\u7387\uff0c\u4e00\u4e2aYUV\u50cf\u7d20\u53ef\u4ee5\u65e0\u635f\u5730\u8f6c\u6362\u56deRGB\u50cf\u7d20\u3002 \u964d\u4f4e\u91c7\u6837\u7387\u4f1a\u635f\u5931\u4e00\u4e9b\u989c\u8272\u4fe1\u606f\u4f46\u80fd\u8ba9YUV\u56fe\u50cf\u66f4\u5c0f\u3002\u5982\u679c\u5904\u7406\u5f97\u5f53\uff0c\u8fd9\u79cd\u635f\u5931\u662f\u53ef\u4ee5\u63a5\u53d7\u7684\u3002</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/color/yuv-intro/#yuv_3","title":"\u8ba1\u7b97\u673a\u89c6\u9891\u4e2d\u7684YUV","text":"<p>\u4e0a\u9762\u7684YUV\u5e76\u4e0d\u662f\u6570\u5b57\u89c6\u9891\u4e2d\u6700\u51c6\u786e\u7684\u8f6c\u6362\u65b9\u5f0f\u3002\u6570\u5b57\u89c6\u9891\u901a\u5e38\u4f7f\u7528\u4e00\u79cd\u79f0\u4e3a<code>Y'CbCr</code>\u7684YUV\u683c\u5f0f\u3002 \u901a\u5e38\uff0c<code>Y'CbCr</code>\u5bf9\u4e8eYUV\u7684\u8303\u56f4\u662f\uff1a <pre><code>Y'     16\u2013235\nCb/Cr  16\u2013240, with 128 representing zero\n</code></pre> \u4e0a\u9762\u8fd9\u4e9b\u8303\u56f4\u4ee58\u4f4d<code>Y'CbCr</code>\u4e3a\u524d\u63d0\u3002 \u63a5\u4e0b\u6765\u662f<code>Y'CbCr</code>\u7684\u8ba1\u7b97\u8fc7\u7a0b\uff0c\u4f7f\u7528BT.601\u7684luma\u5b9a\u4e49\u3002</p> <ol> <li>RGB\u503c\u8303\u56f4\u662f[0,1]\u3002\u6362\u8a00\u4e4b\u7eaf\u9ed1\u662f0\uff0c\u7eaf\u767d\u662f1.\u8fd9\u4e9b\u662f\u975e\u7ebf\u6027\u7684RGB\u503c\u3002</li> <li>\u8ba1\u7b97luma\u3002BT.601\u4e2d\uff0c<code>Y' = 0.299R + 0.587G + 0.114B</code>\uff0c\u5982\u524d\u6587\u6240\u8ff0\u3002</li> <li>\u8ba1\u7b97\u8272\u5ea6\u503c(B - Y') \u548c (R - Y')\u3002\u8fd9\u4e9b\u503c\u8303\u56f4\uff0c (B - Y')\u8303\u56f4\u662f +/- 0.886\uff1b(R - Y')\u8303\u56f4\u662f+/- 0.701</li> <li>\u7f29\u653e\u8272\u5ea6\u503c <pre><code>Pb = (0.5 / (1 - 0.114)) \u00d7 (B - Y')\nPr = (0.5 / (1 - 0.299)) \u00d7 (R - Y')\n</code></pre> \u8fd9\u91cc\u7684\u7f29\u653e\u56e0\u5b50\u7684\u8bbe\u8ba1\u76ee\u7684\u662f\u4e3a\u4e86\u8ba1\u7b97\u5f97\u5230\u540c\u6837\u7684\u8303\u56f4\uff0c+/- 0.5\u3002 \u5b83\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u79f0\u4e3a<code>Y'PbPr</code>\u7684YUV\u989c\u8272\u7a7a\u95f4\u3002\u8fd9\u79cd\u989c\u8272\u7a7a\u95f4\u7528\u4e8e\u6a21\u62df\u4fe1\u53f7\u89c6\u9891\u3002</li> <li>\u901a\u8fc7<code>Y'PbPr</code>\u8ba1\u7b97\u51fa<code>Y'CbCr</code> <pre><code>Y' = 16 + 219 \u00d7 Y'\nCb = 128 + 224 \u00d7 Pb\nCr = 128 + 224 \u00d7 Pr\n</code></pre> \u8ba1\u7b97\u5f97\u5230\u7684\u503c\u7684\u53d6\u503c\u8303\u56f4\u5c31\u662f\u524d\u9762\u6240\u5217\u7684<code>Y'CbCr</code>\u8303\u56f4\u3002\u5f53\u7136\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5c06RGB\u503c\u8f6c\u6362\u4e3a<code>Y'CbCr</code>\u3002</li> </ol>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/color/yuv-intro/#_2","title":"\u53c2\u8003","text":"<ul> <li>About YUV Video - MSDN</li> <li>Recommended 8-Bit YUV Formats for Video Rendering - MSDN</li> <li>\u989c\u8272\u91c7\u6837 Chroma subsampling - wikipedia</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a csdn</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/info/media-open-source-projects/","title":"\u97f3\u89c6\u9891\u7684\u4e00\u4e9b\u5f00\u6e90\u9879\u76ee","text":"\u66f4\u65b0\u5185\u5bb9: 2023-08-03 <ul> <li>2023-08-03 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4f5c\u8005\u4fe1\u606f</p> <p>\u4f5c\u8005\uff1a\u58f0\u7f51</p> <p>\u94fe\u63a5\uff1ahttps://juejin.cn/post/6844903606559195149</p> <p>\u5b9e\u65f6\u97f3\u89c6\u9891\u7684\u5f00\u53d1\u5b66\u4e60\u6709\u5f88\u591a\u53ef\u4ee5\u53c2\u8003\u7684\u5f00\u6e90\u9879\u76ee\u3002\u4e00\u4e2a\u5b9e\u65f6\u97f3\u89c6\u9891\u5e94\u7528\u5171\u5305\u62ec\u51e0\u4e2a\u73af\u8282\uff1a\u91c7\u96c6\u3001\u7f16\u7801\u3001\u524d\u540e\u5904\u7406\u3001\u4f20\u8f93\u3001\u89e3\u7801\u3001\u7f13\u51b2\u3001\u6e32\u67d3\u7b49\u5f88\u591a\u73af\u8282\u3002\u6bcf\u4e00\u4e2a\u7ec6\u5206\u73af\u8282\uff0c\u8fd8\u6709\u66f4\u7ec6\u5206\u7684\u6280\u672f\u6a21\u5757\u3002\u6bd4\u5982\uff0c\u524d\u540e\u5904\u7406\u73af\u8282\u6709\u7f8e\u989c\u3001\u6ee4\u955c\u3001\u56de\u58f0\u6d88\u9664\u3001\u566a\u58f0\u6291\u5236\u7b49\uff0c\u91c7\u96c6\u6709\u9ea6\u514b\u98ce\u9635\u5217\u7b49\uff0c\u7f16\u89e3\u7801\u6709VP8\u3001VP9\u3001H.264\u3001H.265\u7b49\u3002</p> <p></p> <p>\u6211\u4eec\u4eca\u5929\u6c47\u603b\u4e86\u4e00\u4e9b\u80fd\u5e2e\u52a9\u5230\u6b63\u5728\u5b66\u4e60\u6216\u8fdb\u884c\u97f3\u89c6\u9891\u5f00\u53d1\u7684\u5b9e\u65f6\u97f3\u89c6\u9891\u5f00\u53d1\u8005\u4eec\u7684\u5f00\u6e90\u9879\u76ee\u4e0e\u51e0\u4e2a\u4e5f\u5728\u4e3a\u5f00\u6e90\u793e\u533a\u8d21\u732e\u529b\u91cf\u7684\u5546\u4e1a\u670d\u52a1\u3002\u8fd9\u4e9b\u9879\u76ee\u5206\u4e3a\u51e0\u7c7b\uff1a\u97f3\u89c6\u9891\u7f16\u89e3\u7801\u7c7b\u3001\u89c6\u9891\u524d\u540e\u5904\u7406\u3001\u670d\u52a1\u7aef\u7c7b\u7b49\u3002</p>"},{"location":"media/info/media-open-source-projects/#_2","title":"\u97f3\u89c6\u9891\u7f16\u89e3\u7801\u7c7b\u5f00\u6e90\u9879\u76ee","text":"<p>\u89c6\u9891\u7f16\u89e3\u7801\u7684\u4f5c\u7528\uff0c\u5c31\u662f\u5728\u8bbe\u5907\u7684\u6444\u50cf\u5934\u91c7\u96c6\u753b\u9762\u548c\u524d\u5904\u7406\u540e\uff0c\u5c06\u56fe\u50cf\u8fdb\u884c\u538b\u7f29\uff0c\u8fdb\u884c\u6570\u5b57\u7f16\u7801\uff0c\u7528\u4e8e\u4f20\u8f93\u3002\u7f16\u89e3\u7801\u5668\u7684\u4f18\u52a3\u57fa\u672c\u5728\u4e8e\uff1a\u538b\u7f29\u6548\u7387\u7684\u9ad8\u4f4e\uff0c\u901f\u5ea6\u548c\u529f\u8017\u3002</p> <p>\u76ee\u524d\uff0c\u4e3b\u6d41\u7684\u89c6\u9891\u7f16\u7801\u5668\u5206\u4e3a3\u4e2a\u7cfb\u5217\uff1aVPx\uff08VP8\uff0cVP9\uff09\uff0cH.26x\uff08H.264\uff0cH.265\uff09\uff0cAVS\uff08AVS1.0\uff0cAVS2.0\uff09\u3002VPx\u7cfb\u5217\u662f\u7531Google\u5f00\u6e90\u7684\u89c6\u9891\u7f16\u89e3\u7801\u6807\u51c6\u3002\u5728\u4fdd\u8bc1\u76f8\u540c\u8d28\u91cf\u60c5\u51b5\u4e0b\uff0cVP9\u76f8\u6bd4VP8\u7801\u7387\u51cf\u5c11\u7ea650%\u3002H.26x\u7cfb\u5217\u5728\u786c\u4ef6\u652f\u6301\u4e0a\u6bd4\u8f83\u5e7f\u6cdb\uff0cH.265\u7684\u7f16\u7801\u6548\u7387\u80fd\u6bd4\u4e0a\u4e00\u4ee3\u63d0\u9ad8\u4e8630-50%\uff0c\u4f46\u662f\u590d\u6742\u5ea6\u548c\u529f\u8017\u4f1a\u6bd4\u4e0a\u4e00\u4ee3\u5927\u5f88\u591a\uff0c\u6240\u4ee5\u7eaf\u8f6f\u4ef6\u7f16\u7801\u5b9e\u73b0\u7684\u8bdd\u6709\u4e00\u5b9a\u74f6\u9888\uff0c\u73b0\u6709\u7684\u6280\u672f\u4e0b\uff0c\u8fd8\u662f\u9700\u8981\u4f9d\u9760\u786c\u4ef6\u7f16\u89e3\u7801\u4e3a\u4e3b\u3002AVS\u662f\u6211\u56fd\u5177\u5907\u81ea\u4e3b\u77e5\u8bc6\u4ea7\u6743\u7684\u7b2c\u4e8c\u4ee3\u4fe1\u6e90\u7f16\u7801\u6807\u51c6\uff0c\u76ee\u524d\u5df2\u7ecf\u53d1\u5c55\u5230\u7b2c\u4e8c\u4ee3\u3002</p>"},{"location":"media/info/media-open-source-projects/#webrtc","title":"WebRTC","text":"<p>\u9996\u5148\u4f1a\u7528\u5230\u7684\u80af\u5b9a\u662fWebRTC\uff0c\u662f\u4e00\u4e2a\u652f\u6301\u7f51\u9875\u6d4f\u89c8\u5668\u8fdb\u884c\u5b9e\u65f6\u8bed\u97f3\u5bf9\u8bdd\u6216\u89c6\u9891\u5bf9\u8bdd\u7684\u5f00\u6e90\u9879\u76ee\u3002\u5b83\u63d0\u4f9b\u4e86\u5305\u62ec\u97f3\u89c6\u9891\u7684\u91c7\u96c6\u3001\u7f16\u89e3\u7801\u3001\u7f51\u7edc\u4f20\u8f93\u3001\u663e\u793a\u7b49\u529f\u80fd\u3002\u5982\u679c\u4f60\u60f3\u57fa\u4e8eWebRTC\u5f00\u53d1\u5b9e\u65f6\u97f3\u89c6\u9891\u5e94\u7528\uff0c\u9700\u8981\u6ce8\u610f\uff0c\u7531\u4e8eWebRTC\u7f3a\u5c11\u670d\u52a1\u7aef\u8bbe\u8ba1\u548c\u90e8\u7f72\u65b9\u6848\uff0c\u4f60\u8fd8\u9700\u8981\u5c06WebRTC\u4e0eJanus\u7b49\u670d\u52a1\u7aef\u7c7b\u5f00\u6e90\u9879\u76ee\u7ed3\u5408\u5373\u53ef\u3002</p> <p>\u5b98\u7f51\u5730\u5740\uff1awebrtc.org/</p>"},{"location":"media/info/media-open-source-projects/#x264","title":"x264","text":"<p>H.264\u662f\u76ee\u524d\u5e94\u7528\u6700\u5e7f\u7684\u7801\u6d41\u6807\u51c6\u3002x264\u5219\u662f\u80fd\u591f\u4ea7\u751f\u7b26\u5408H.264\u6807\u51c6\u7684\u7801\u6d41\u7684\u7f16\u7801\u5668\uff0c\u5b83\u53ef\u4ee5\u5c06\u89c6\u9891\u6d41\u7f16\u7801\u4e3aH.264\u3001MPEG-4 AVC\u683c\u5f0f\u3002\u5b83\u63d0\u4f9b\u4e86\u547d\u4ee4\u884c\u63a5\u53e3\u4e0eAPI\uff0c\u524d\u8005\u88ab\u7528\u4e8e\u4e00\u4e9b\u56fe\u5f62\u7528\u6237\u63a5\u53e3\u4f8b\u5982Straxrip\u3001MeGUI\uff0c\u540e\u8005\u5219\u88abFFmpeg\u3001Handbrake\u7b49\u8c03\u7528\u3002\u5f53\u7136\uff0c\u65e2\u7136\u6709x264\uff0c\u5c31\u6709\u5bf9\u5e94HEVC/H.265\u7684x265\u3002</p> <p>\u5b98\u7f51\u5730\u5740\uff1a https://www.videolan.org/developers/x264.html</p>"},{"location":"media/info/media-open-source-projects/#ffmpeg","title":"FFmpeg","text":"<p>FFmpeg\u5927\u5bb6\u5e94\u8be5\u4e0d\u964c\u751f\uff0c\u63d0\u4f9b\u4e86\u7f16\u7801\u3001\u89e3\u7801\u3001\u8f6c\u6362\u3001\u5c01\u88c5\u7b49\u529f\u80fd\uff0c\u4ee5\u53ca\u526a\u88c1\u3001\u7f29\u653e\u3001\u8272\u57df\u7b49\u540e\u671f\u5904\u7406\uff0c\u652f\u6301\u51e0\u4e4e\u76ee\u524d\u6240\u6709\u97f3\u89c6\u9891\u7f16\u7801\u6807\u51c6\uff08\u7531\u4e8e\u683c\u5f0f\u4f17\u591a\uff0c\u6211\u4eec\u5c31\u4e0d\u4e00\u4e00\u5217\u5217\u4e3e\u4e86\uff0c\u53ef\u4ee5\u5728Wikipedia\u4e2d\u627e\u5230\uff09\u3002</p> <p>\u540c\u65f6\uff0cFFmpeg\u8fd8\u884d\u751f\u51fa\u4e86libav\u9879\u76ee\uff0c\u4ece\u4e2d\u8bde\u751f\u4e86\u89c6\u9891\u89e3\u7801\u5668LAV\uff0c\u8bb8\u591a\u64ad\u653e\u8f6f\u4ef6\u90fd\u53ef\u8c03\u7528LAV\u8fdb\u884c\u89e3\u7801\uff0c\u5e76\u4e14LAV\u672c\u8eab\u4e5f\u652f\u6301\u5229\u7528\u663e\u5361\u8fdb\u884c\u89c6\u9891\u786c\u89e3\u3002\u5f88\u591a\u4e3b\u6d41\u89c6\u9891\u64ad\u653e\u5668\u4e2d\u90fd\u4ee5FFmpeg\u4f5c\u4e3a\u5185\u6838\u64ad\u653e\u5668\u3002\u4e0d\u4ec5\u4ec5\u662f\u89c6\u9891\u64ad\u653e\u5668\uff0c\u5c31\u8fdeChrome\u8fd9\u7c7b\u53ef\u4ee5\u64ad\u653e\u7f51\u9875\u89c6\u9891\u7684\u6d4f\u89c8\u5668\u4e5f\u53d7\u76ca\u4e8eFFmpeg\u3002\u5f88\u591a\u5f00\u53d1\u8005\u4e5f\u57fa\u4e8eFFmpeg\u505a\u8fc7\u5f88\u591a\u5f00\u53d1\u5e76\u5f00\u6e90\u51fa\u6765\uff0c\u6bd4\u5982\u5927\u795e\u96f7\u9704\u9a85\uff08\u4ee3\u7801\u53ef\u89c1\u4ed6\u7684sourceforge\uff09\u3002</p> <p>\u5b98\u7f51\u5730\u5740\uff1affmpeg.org/</p>"},{"location":"media/info/media-open-source-projects/#ijkplayer","title":"ijkplayer","text":"<p>\u5728\u4ecb\u7ecdijkplayer\u4e4b\u524d\uff0c\u8981\u5148\u63d0\u5230ffplay\u3002ffplay\u662f\u4e00\u4e2a\u4f7f\u7528\u4e86FFmpeg\u548csdl\u5e93\u7684\u53ef\u79fb\u690d\u7684\u5a92\u4f53\u64ad\u653e\u5668\u3002ijkplay\u662fBilibili\u5f00\u6e90\u7684\u57fa\u4e8effplay.c\u5b9e\u73b0\u7684\u8f7b\u91cf\u7ea7iOS/Android\u89c6\u9891\u64ad\u653e\u5668\uff0cAPI\u6613\u4e8e\u96c6\u6210\uff0c\u4e14\u7f16\u8bd1\u914d\u7f6e\u53ef\u88c1\u526a\uff0c\u5229\u4e8e\u63a7\u5236\u5b89\u88c5\u5305\u5927\u5c0f\u3002</p> <p>\u5728\u7f16\u89e3\u7801\u65b9\u9762\uff0cijkplayer\u652f\u6301\u89c6\u9891\u8f6f\u89e3\u548c\u786c\u89e3\uff0c\u53ef\u4ee5\u5728\u64ad\u653e\u524d\u914d\u7f6e\uff0c\u4f46\u5728\u64ad\u653e\u8fc7\u7a0b\u4e2d\u5219\u4e0d\u80fd\u5207\u6362\u3002iOS\u548cAndroid\u4e0a\u89c6\u9891\u786c\u89e3\u53ef\u5206\u522b\u4f7f\u7528\u5927\u5bb6\u719f\u6089\u7684VideoToolbox\u548cMediaCodec\u3002\u4f46ijkplayer\u5bf9\u97f3\u9891\u4ec5\u652f\u6301\u8f6f\u89e3\u3002</p> <p>Github\u5730\u5740\uff1a https://github.com/Bilibili/ijkplayer</p>"},{"location":"media/info/media-open-source-projects/#jsmpeg","title":"JSMpeg","text":"<p>JSMpeg\u662f\u4e00\u4e2a\u57fa\u4e8eJavaScript\u7684MPEG1\u89c6\u9891\u7684\u89e3\u7801\u5668\u3002\u5982\u679c\u8981\u505aH5\u7aef\u7684\u89c6\u9891\u76f4\u64ad\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528JSMpeg\u5728\u79fb\u52a8\u7aef\u8fdb\u884c\u89e3\u7801\u3002\u5728H5\u7aef\u505a\u97f3\u89c6\u9891\u76f4\u64ad\uff0c\u53ef\u4ee5\u4f7f\u7528JSMpeg\u8fdb\u884c\u89c6\u9891\u89e3\u7801\uff0c\u8fd9\u4e5f\u662f\u6700\u8fd1\u6bd4\u8f83\u706b\u7684H5\u6293\u5a03\u5a03\u7684\u4e3b\u6d41\u7b56\u7565\u3002</p> <p>Github\u5730\u5740\uff1a https://github.com/phoboslab/jsmpeg</p>"},{"location":"media/info/media-open-source-projects/#opus","title":"Opus","text":"<p>Opus\u662f\u7528C\u8bed\u8a00\u5f00\u53d1\u7684\u4e00\u4e2a\u9ad8\u7075\u6d3b\u5ea6\u7684\u97f3\u9891\u7f16\u7801\u5668\uff0c\u9488\u5bf9ARM\u3001x86\u6709\u7279\u6b8a\u4f18\u5316\uff0cfix-point\u5b9e\u73b0\u3002Opus\u5728\u5404\u65b9\u9762\u90fd\u6709\u7740\u660e\u663e\u4f18\u52bf\u3002\u5b83\u540c\u65f6\u652f\u6301\u8bed\u97f3\u4e0e\u97f3\u4e50\u7684\u7f16\u7801\uff0c\u6bd4\u7279\u7387\u4e3a6k-510k\u3002\u5b83\u878d\u5408\u4e86SILK\u7f16\u7801\u65b9\u6cd5\u548cCELT\u7f16\u7801\u65b9\u6cd5\u3002SILK\u539f\u672c\u88ab\u7528\u4e8eSkype\u4e2d\uff0c\u57fa\u4e8e\u8bed\u97f3\u4fe1\u53f7\u7684\u7ebf\u6027\u9884\u6d4b\u5206\u6790\uff08LPC\uff09\uff0c\u5bf9\u97f3\u4e50\u652f\u6301\u5e76\u4e0d\u597d\u3002\u800cCELT\u5c3d\u7ba1\u9002\u7528\u4e8e\u5168\u5e26\u5bbd\u97f3\u9891\uff0c\u4f46\u5bf9\u4f4e\u6bd4\u7279\u7387\u8bed\u97f3\u7684\u7f16\u7801\u6548\u7387\u4e0d\u9ad8\uff0c\u6240\u4ee5\u4e24\u8005\u5728Opus\u4e2d\u5f62\u6210\u4e86\u4e92\u8865\u3002</p> <p></p> <p>Opus\u662f\u201c\u53d6\u4ee3\u201d\u4e86Speex\u3002\u4f46\u662fSpeex\u4e2d\u6709\u7684\u529f\u80fd\uff0cOpus\u5374\u6ca1\u6709\uff0c\u6bd4\u5982\u56de\u58f0\u6d88\u9664\u3002\u8fd9\u4e2a\u529f\u80fd\u5df2\u7ecf\u4ece\u7f16\u7801\u5668\u4e2d\u72ec\u7acb\u51fa\u6765\u3002\u6240\u4ee5\u5982\u679c\u60f3\u5b9e\u73b0\u597d\u7684\u56de\u58f0\u6d88\u9664\uff0c\u53ef\u4ee5\u914d\u5408WebRTC\u7684AEC\u548cAECM\u6a21\u5757\u505a\u4e8c\u6b21\u5f00\u53d1\u3002</p> <p>\u5b98\u7f51\u5730\u5740\uff1aopus-codec.org/</p>"},{"location":"media/info/media-open-source-projects/#live555","title":"live555","text":"<p>live555\u662f\u4e00\u4e2aC++\u6d41\u5a92\u4f53\u5f00\u6e90\u9879\u76ee\uff0c\u5176\u4e2d\u4e0d\u4ec5\u5305\u62ec\u4e86\u4f20\u8f93\u534f\u8bae\uff08SIP\u3001RTP\uff09\u3001\u97f3\u89c6\u9891\u7f16\u7801\u5668\uff08H.264\u3001MPEG4\uff09\u7b49\uff0c\u8fd8\u5305\u62ec\u6d41\u5a92\u4f53\u670d\u52a1\u5668\u7684\u4f8b\u5b50\uff0c\u662f\u6d41\u5a92\u4f53\u9879\u76ee\u7684\u9996\u9009\uff0c\u91cc\u9762\u7684\u4f20\u8f93\u6a21\u5757\u662f\u975e\u5e38\u503c\u5f97\u89c6\u9891\u4f1a\u8bae\u5f00\u53d1\u4f5c\u4e3a\u53c2\u8003\u7684\u3002</p> <p>\u5b98\u7f51\u5730\u5740\uff1awww.live555.com/</p>"},{"location":"media/info/media-open-source-projects/#_3","title":"\u97f3\u89c6\u9891\u524d\u540e\u5904\u7406\u5f00\u6e90\u9879\u76ee","text":"<p>\u524d\u540e\u5904\u7406\u5305\u542b\u5f88\u591a\u7ec6\u5206\u6280\u672f\uff0c\u5e94\u7528\u6b63\u786e\u7684\u8bdd\uff0c\u5bf9\u89c6\u9891\u8d28\u91cf\u6216\u591a\u6216\u5c11\u90fd\u6709\u63d0\u5347\u3002\u4e0d\u8fc7\u6bcf\u589e\u52a0\u4e00\u4e2a\u5904\u7406\u73af\u8282\uff0c\u5fc5\u7136\u4f1a\u589e\u52a0\u8fd0\u7b97\u91cf\u4e0e\u5ef6\u65f6\uff0c\u6240\u4ee5\u5982\u4f55\u53d6\u820d\uff0c\u8fd8\u8981\u5927\u5bb6\u5404\u81ea\u659f\u914c\u3002</p>"},{"location":"media/info/media-open-source-projects/#seetaface","title":"Seetaface","text":"<p>Seetaface\u662f\u7531\u4e2d\u79d1\u9662\u5c71\u4e16\u5149\u8001\u5e08\u5f00\u6e90\u7684\u4e00\u5957\u5b8c\u6574\u7684\u4eba\u8138\u68c0\u6d4b\uff0c\u4eba\u8138\u5bf9\u9f50\u548c\u4eba\u8138\u9a8c\u8bc1\u65b9\u6848\u3002\u4ee3\u7801\u57fa\u4e8eC++\u5b9e\u73b0\uff0c\u5f00\u6e90\u534f\u8bae\u4e3aBSD-2\uff0c\u53ef\u4f9b\u5b66\u672f\u754c\u548c\u5de5\u4e1a\u754c\u514d\u8d39\u4f7f\u7528\u3002\u4e14\u4e0d\u4f9d\u8d56\u4e8e\u4efb\u4f55\u7b2c\u4e09\u65b9\u7684\u5e93\u51fd\u6570\uff0c\u5728\u4f7f\u7528\u5bf9\u9f50\u597d\u7684LFW\u56fe\u7247\u4e0a\uff0c\u68c0\u6d4b\u5bf9\u9f50\u5168\u90e8\u4f7f\u7528\u8be5\u5f00\u6e90\u8f6f\u4ef6\u7684\u60c5\u51b5\u4e0b\u53ef\u8fbe\u523097.1%\u3002</p> <p>Github\u5730\u5740\uff1a https://github.com/seetaface/SeetaFaceEngine</p>"},{"location":"media/info/media-open-source-projects/#gpuimage","title":"GPUImage","text":"<p>\u73b0\u5728\u5728iOS\u7aef\u505a\u7f8e\u989c\u6548\u679c\u3001\u52a0\u6c34\u5370\uff0c\u57fa\u672c\u90fd\u4f1a\u91c7\u7528GPUImage\uff0c\u5b83\u5185\u7f6e\u4e86125\u79cd\u6e32\u67d3\u6548\u679c, \u8fd8\u652f\u6301\u811a\u672c\u81ea\u5b9a\u4e49\u3002\u8be5\u9879\u76ee\u5b9e\u73b0\u4e86\u56fe\u7247\u6ee4\u955c\u3001\u6444\u50cf\u5934\u5b9e\u65f6\u6ee4\u955c\u3002\u5b83\u4f18\u52bf\u5728\u4e8e\u5904\u7406\u6548\u679c\u662f\u57fa\u4e8eGPU\u5b9e\u73b0\uff0c\u76f8\u5bf9\u4e8eCPU\u5904\u7406\u6027\u80fd\u66f4\u9ad8\u3002</p> <p>Github\u5730\u5740\uff1a https://github.com/BradLarson/GPUImage</p>"},{"location":"media/info/media-open-source-projects/#open-nsfw-model","title":"Open nsfw model","text":"<p>Open nsfw model\u662f\u96c5\u864e\u5f00\u6e90\u9879\u76ee\uff0c\u5168\u540d\u662fOpen Not suitable for work model\uff0c\u4e13\u95e8\u9274\u522b\u4e0d\u9002\u5408\u5de5\u4f5c\u65f6\u95f4\u6d4f\u89c8\u7684\u56fe\u7247\uff08\u8a00\u800c\u8a00\u4e4b\u5c31\u662f\u5c0f\u9ec4\u56fe\uff09\u3002\u5b83\u662f\u57fa\u4e8eCaffe\u6846\u67b6\u8bad\u7ec3\u7684\u6a21\u578b\uff0c\u7528\u4e8e\u97f3\u89c6\u9891\u540e\u5904\u7406\u3002\u4e0d\u8fc7\uff0c\u5b83\u8fd8\u4e0d\u80fd\u9274\u522b\u6050\u6016\u3001\u8840\u8165\u56fe\u7247\u3002</p> <p>Github\u5730\u5740\uff1a https://github.com/yahoo/open_nsfw</p>"},{"location":"media/info/media-open-source-projects/#soundtouch","title":"Soundtouch","text":"<p>Soundtouch\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u97f3\u9891\u5904\u7406\u6846\u67b6\uff0c\u4e3b\u8981\u529f\u80fd\u5bf9\u97f3\u9891\u53d8\u901f\u3001\u53d8\u8c03\uff0c\u5b9e\u73b0\u53d8\u58f0\u7684\u6548\u679c\u3002\u540c\u65f6\uff0c\u5b83\u4e5f\u80fd\u5bf9\u5a92\u4f53\u6d41\u5b9e\u65f6\u5904\u7406\u3002\u91c7\u752832\u4f4d\u6d6e\u70b9\u6216\u800516\u4f4d\u5b9a\u70b9\uff0c\u652f\u6301\u5355\u58f0\u9053\u6216\u8005\u53cc\u58f0\u9053\uff0c\u91c7\u6837\u7387\u8303\u56f4\u4e3a8k - 48k\u3002</p> <p>\u5b98\u7f51\u5730\u5740\uff1awww.surina.net/soundtouch/</p>"},{"location":"media/info/media-open-source-projects/#_4","title":"\u670d\u52a1\u7aef\u7c7b\u5f00\u6e90\u9879\u76ee","text":"<p>\u6b63\u5982\u5f00\u59cb\u65f6\u6211\u4eec\u6240\u8bf4\uff0cWebRTC\u7f3a\u5c11\u670d\u52a1\u7aef\u7684\u8bbe\u8ba1\u4e0e\u90e8\u7f72\uff0c\u5229\u7528MCU\u3001SFU\u5b9e\u73b0\u591a\u4eba\u804a\u5929\uff0c\u63d0\u9ad8\u4f20\u8f93\u8d28\u91cf\uff0c\u90fd\u9700\u8981\u5f00\u53d1\u8005\u81ea\u5df1\u52a8\u624b\u3002\u800c\u4e0b\u9762\u8fd9\u4e9b\u5f00\u6e90\u9879\u76ee\u80fd\u591f\u5e2e\u5230\u4f60\u3002</p>"},{"location":"media/info/media-open-source-projects/#jitsi","title":"Jitsi","text":"<p>Jitsi\u662f\u5f00\u6e90\u7684\u89c6\u9891\u4f1a\u8bae\u7cfb\u7edf\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5728\u7ebf\u89c6\u9891\u4f1a\u8bae\uff0c\u6587\u6863\u5171\u4eab\u548c\u5373\u65f6\u6d88\u606f\u7684\u5206\u4eab\u3002\u5b83\u652f\u6301\u7f51\u7edc\u89c6\u9891\u4f1a\u8bae\uff0c\u4f7f\u7528SFU\u6a21\u5f0f\u5b9e\u73b0\u89c6\u9891\u8def\u7531\u5668\u529f\u80fd\u3002\u5f00\u53d1\u8bed\u8a00\u662fJava\u3002\u5b83\u652f\u6301SIP\u5e10\u53f7\u6ce8\u518c\u7535\u8bdd\u547c\u53eb\u3002\u4e0d\u4ec5\u652f\u6301\u5355\u673a\u672c\u5730\u5b89\u88c5\u65b9\u5f0f\uff0c\u8fd8\u652f\u6301\u4e91\u5e73\u53f0\u5b89\u88c5\u3002</p> <p>\u5b98\u7f51\u5730\u5740\uff1ajitsi.org/</p>"},{"location":"media/info/media-open-source-projects/#jssip","title":"JsSIP","text":"<p>JsSIP\u662f\u57fa\u4e8eWebRTC\u7684JavaScript SIP\u534f\u8bae\u5b9e\u73b0\u7684\u5e93\uff0c\u53ef\u4ee5\u5728\u6d4f\u89c8\u5668\u548cNode.js\u4e2d\u8fd0\u884c\u3002\u5b83\u53ef\u4ee5\u4e0e OverSIP\u3001Kamailio\u3001Asterisk\u3001OfficeSIP\u7b49SIP Server\u4e00\u8d77\u8fd0\u884c\u3002</p> <p>Github\u5730\u5740\uff1a https://github.com/versatica/JsSIP</p>"},{"location":"media/info/media-open-source-projects/#srs","title":"SRS","text":"<p>SRS\u662f\u4e00\u4e2a\u91c7\u7528MIT\u534f\u8bae\u6388\u6743\u7684\u56fd\u4ea7\u7684\u7b80\u5355\u7684RTMP/HLS \u76f4\u64ad\u670d\u52a1\u5668\u3002\u6700\u65b0\u7248\u8fd8\u652f\u6301FLV\u6a21\u5f0f\uff0c\u540c\u65f6\u5177\u5907\u4e86RTMP\u7684\u5b9e\u65f6\u6027\uff0c\u4ee5\u53caHLS\u4e2d\u5c5e\u4e8eHTTP\u534f\u8bae\u5bf9\u5404\u79cd\u7f51\u7edc\u73af\u5883\u9ad8\u5ea6\u9002\u5e94\u6027\uff0c\u5e76\u4e14\u652f\u6301\u66f4\u591a\u64ad\u653e\u5668\u3002\u5b83\u7684\u529f\u80fd\u4e0enginx-rtmp-module\u7c7b\u4f3c, \u53ef\u4ee5\u5b9e\u73b0RTMP/HLS\u7684\u5206\u53d1\u3002</p> <p>Github\u5730\u5740\uff1agithub.com/ossrs/srs</p>"},{"location":"media/info/media-open-source-projects/#jrtplib","title":"JRTPLIB","text":"<p>JRTPLIB \u662f\u4e00\u4e2a\u5f00\u6e90\u7684 RTP\u534f\u8bae\u5b9e\u73b0\u5e93\uff0c\u652f\u6301Windows\u548cunix\u5e73\u53f0\u3002\u5b83\u652f\u6301\u591a\u7ebf\u7a0b\uff0c\u5904\u7406\u6027\u80fd\u8f83\u597d\u3002\u5b83\u8fd8\u652f\u6301RFC3550\u3001UDP IPV6\uff0c\u652f\u6301\u81ea\u5b9a\u4e49\u6269\u5c55\u4f20\u8f93\u534f\u8bae\u3002\u4f46\u5b83\u4e0d\u652f\u6301TCP\u4f20\u8f93\uff0c\u8fd9\u9700\u8981\u5f00\u53d1\u8005\u81ea\u5df1\u6765\u5b9e\u73b0\u3002\u540c\u65f6\uff0c\u5b83\u4e5f\u4e0d\u652f\u6301\u97f3\u89c6\u9891\u7684\u5206\u5305\uff0c\u4ee3\u7801\u8981\u4f60\u81ea\u5df1\u6765\u5b9e\u73b0\u3002</p> <p>Github\u5730\u5740\uff1a https://github.com/j0r1/JRTPLIB</p>"},{"location":"media/info/media-open-source-projects/#opal","title":"OPAL","text":"<p>OPAL\u662fOpenH323\u7684\u4e0b\u4e00\u4e2a\u7248\u672c\uff0c\u7ee7\u627f\u4e86Openh323\u534f\u8bae\uff0c\u5176\u65b0\u5305\u542b\u4e86SIP\u534f\u8bae\u6808\uff0c\u662f\u5b9e\u73b0SIP\u534f\u8bae\u7684\u9996\u9009\uff0c\u7f3a\u70b9\u662f\u53c2\u8003\u4f8b\u5b50\u8f83\u5c11\u3002</p> <p>\u4ee3\u7801\u5730\u5740\uff1a http://sourceforge.net/projects/opalvoip/files/</p>"},{"location":"media/info/media-open-source-projects/#kurento","title":"Kurento","text":"<p>Kurento\u662f\u4e00\u4e2a\u57fa\u4e8eWebRTC\u7684\u5a92\u4f53\u670d\u52a1\u7aef\uff0c\u5e76\u5305\u542b\u4e86\u4e00\u7cfb\u5217API\uff0c\u53ef\u4ee5\u7b80\u5316web\u4e0e\u79fb\u52a8\u7aef\u5b9e\u65f6\u89c6\u9891\u5e94\u7528\u7684\u5f00\u53d1\u3002</p> <p>Github\u5730\u5740\uff1agithub.com/Kurento</p>"},{"location":"media/info/media-open-source-projects/#janus","title":"Janus","text":"<p>Janus\u662f\u4e00\u4e2aWebRTC\u5a92\u4f53\u7f51\u5173\u3002\u4e0d\u8bba\u662f\u505a\u6d41\u5a92\u4f53\u3001\u89c6\u9891\u4f1a\u8bae\u3001\u5f55\u5236\u3001\u7f51\u5173\uff0c\u90fd\u53ef\u4ee5\u57fa\u4e8eJanus\u6765\u5b9e\u73b0\u3002</p> <p>Github\u5730\u5740\uff1a https://janus.conf.meetecho.com/</p>"},{"location":"media/info/media-open-source-projects/#_5","title":"\u5176\u5b83\u5546\u4e1a\u670d\u52a1","text":""},{"location":"media/info/media-open-source-projects/#callstatsio","title":"Callstats.io","text":"<p>\u5b9e\u65f6\u901a\u4fe1\u8fc7\u7a0b\u4e2d\u7684\uff0c\u5ef6\u65f6\u3001\u4e22\u5305\u3001\u63a5\u901a\u7387\u3001\u6389\u7ebf\u7387\u7b49\u8d28\u91cf\u95ee\u9898\uff0c\u90fd\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\u3002\u5546\u7528\u9879\u76ee\u5c24\u5176\u9700\u8981\u5173\u6ce8\u3002Callstats\u662f\u4e00\u5bb6\u901a\u8fc7\u5bf9WebRTC\u547c\u53eb\u8fdb\u884c\u4e13\u4e1a\u76d1\u6d4b\uff0c\u6765\u5e2e\u52a9\u7528\u6237\u641c\u96c6\u901a\u8baf\u6570\u636e\uff0c\u63d0\u5347\u901a\u8bdd\u8d28\u91cf\u7684\u670d\u52a1\u5546\u3002</p> <p>Callstats\u4e5f\u901a\u8fc7Github\u5f00\u653e\u5f88\u591a\u6848\u4f8b\uff0c\u53ef\u4f9b\u4f7f\u7528Jitsi-videobridge,\u3001turn-server\u3001JsSIP\u7684\u5f00\u53d1\u8005\u53c2\u8003\u3002</p> <p>Github\u5730\u5740\uff1a https://github.com/callstats-io</p>"},{"location":"media/info/media-open-source-projects/#meetecho","title":"Meetecho","text":"<p>Meetecho\u662f\u8457\u540d\u7684\u5f00\u6e90WebRTC\u7f51\u5173\u9879\u76eeJanus\u7684\u5f00\u53d1\u8005\u3002\u4ed6\u4eec\u8fd8\u63d0\u4f9b\u57fa\u4e8eJanus\u5f00\u53d1\u7684\u6280\u672f\u54a8\u8be2\u4e0e\u90e8\u7f72\u670d\u52a1\u3001\u5efa\u7acb\u89c6\u9891\u4f1a\u8bae\u76f4\u64ad\u4e0e\u5f55\u5236\u670d\u52a1\u7b49\u3002</p> <p>Github\u5730\u5740\uff1a https://github.com/carlhuda/janus</p>"},{"location":"media/info/media-open-source-projects/#agora","title":"\u58f0\u7f51Agora","text":"<p>\u58f0\u7f51\u63d0\u4f9b\u4e86\u4ece\u7f16\u89e3\u7801\u5230\u7aef\u5230\u7aef\u4f20\u8f93\u7684\u5168\u5957\u670d\u52a1\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u63a5\u5165\u4e0a\u6587\u6240\u8ff0\u7684\u97f3\u89c6\u9891\u524d\u540e\u5904\u7406\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u914d\u5408\u4f7f\u7528\u58f0\u7f51SDK\u53ef\u4ee5\u5efa\u7acb\u9ad8\u8d28\u91cf\u7684\u5b9e\u65f6\u97f3\u89c6\u9891\u5e94\u7528\u3002\u5728Web\u7aef\uff0cAgora Web SDK\u53ef\u4ee5\u5e2e\u52a9WebRTC\u5f00\u53d1\u8005\u89e3\u51b3\u670d\u52a1\u7aef\u4f20\u8f93\u4e2d\u4f1a\u9047\u5230\u7684\u5361\u987f\u3001\u5ef6\u65f6\u3001\u56de\u58f0\u3001\u591a\u4eba\u89c6\u9891\u4e0d\u7a33\u5b9a\u7b49\u95ee\u9898\u3002\u540c\u65f6\uff0c\u58f0\u7f51SDK\u8fd8\u5bf9\u591a\u4e2a\u7cfb\u7edf\u5e73\u53f0\u7684\u5e94\u7528\u63d0\u4f9b\u5b9e\u65f6\u97f3\u89c6\u9891\u901a\u8baf\u670d\u52a1\u3002 \u58f0\u7f51\u5728Github\u4e0a\u6709\u8bb8\u591a\u53ef\u4f9b\u5f00\u53d1\u8005\u53c2\u8003\u3001\u5b9e\u8df5\u7684demo\u6e90\u7801\uff0c\u8986\u76d6\u4e86\u4ece\u7f51\u9875\u7aef\u3001iOS\u5230Android\u5e73\u53f0\uff0c\u4ee5\u53ca\u97f3\u89c6\u9891\u76f4\u64ad\u3001\u6e38\u620f\u8fde\u9ea6\u3001\u4f01\u4e1a\u4f1a\u8bae\u3001AR\u3001\u76f4\u64ad\u7b54\u9898\u3001\u5c0f\u7a0b\u5e8f\u7b49\u591a\u79cd\u5b9e\u65f6\u4e92\u52a8\u5e94\u7528\u573a\u666f\u3002</p> <p>Github\u5730\u5740\uff1a https://github.com/AgoraIO-Community</p> <p></p> <p>\u6211\u4eec\u5728\u8fd9\u91cc\u5217\u51fa\u4e8618\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u4ee5\u53ca3\u4e2a\u80fd\u6709\u6548\u4fdd\u8bc1\u5b9e\u65f6\u97f3\u89c6\u9891\u4f20\u8f93\u8d28\u91cf\u7684\u670d\u52a1\u3002\u4e0d\u8fc7\u7bc7\u5e45\u6709\u9650\uff0c\u8fd8\u6709\u5f88\u591a\u5f00\u6e90\u9879\u76ee\u6211\u4eec\u6ca1\u6709\u8be6\u7ec6\u5217\u51fa\uff0c\u6bd4\u5982\u5728\u97f3\u89c6\u9891\u65b9\u9762\uff0cXiph.org\u7684Speex\u3001FLAC\uff0c\u8fd8\u6709Xvid\u3001libvpx\u3001Lagarith\u3001Daala\u3001Thor\u7b49\u3002\u6b22\u8fce\u5927\u5bb6\u7ee7\u7eed\u8865\u5145\u3002</p>"},{"location":"media/video/yuv-save-format/","title":"YUV\u5b58\u50a8\u65b9\u5f0f","text":"\u66f4\u65b0\u65e5\u671f: 2021-12-30 <ul> <li>2021-12-30: \u521b\u5efa\u6587\u6863</li> </ul> <p>\u524d\u9762\u6211\u4eec\u4e86\u89e3\u4e86YUV\u7684\u6982\u5ff5\u548c\u91c7\u6837\u65b9\u5f0f\u3002 \u57fa\u4e8e\u91c7\u6837\u65b9\u5f0f\uff0c\u672c\u6587\u4ecb\u7ecdYUV\u5b58\u50a8\u65b9\u5f0f\u3002</p> <p>\u4e3a\u8868\u793a\u65b9\u4fbf\uff0c\u672c\u6587\u6df7\u7528<code>Y</code>\u4e0e<code>Y'</code></p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/video/yuv-save-format/#yuv420p","title":"YUV420P","text":"<p>\u5148\u5b58\u653eY\uff0c\u7136\u540e\u662fU\uff0c\u6700\u540e\u662fV\u3002 Plane\u6a21\u5f0f\uff0c\u5373\u5e73\u9762\u6a21\u5f0f\uff0c\u4e0d\u5c06YUV\u6570\u636e\u4ea4\u9519\u5b58\u50a8\uff0c\u800c\u662f\u5148\u5b58\u653e\u6240\u6709\u7684Y\u5206\u91cf\uff0c\u7136\u540e\u5b58\u50a8\u6240\u6709\u7684U\uff08Cb\uff09\u5206\u91cf\uff0c\u6700\u540e\u5b58\u50a8\u6240\u6709\u7684V\uff08Cr\uff09\u5206\u91cf\u3002</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/video/yuv-save-format/#yu12","title":"YU12","text":"<p>YU12 \u5373 I420 \uff0c\u4e5f\u53eb IYUV \uff0c\u5c5e\u4e8eYUV420P\u3002</p> <p><pre><code>yyyyyyyy yyyyyyyy yyyyyyyy yyyyyyyy yyyyyyyy yyyyyyyy yyyyyyyy yyyyyyyy   (w*h)\nuuuuuuuu uuuuuuuu                                                         (w*h/4)\nvvvvvvvv vvvvvvvv                                                         (w*h/4)\n</code></pre> <code>w*h</code>\u8868\u793a\u5bbd\u4e58\u4ee5\u9ad8\u3002</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/video/yuv-save-format/#yv12","title":"YV12","text":"<p>\u548c\u524d\u9762\u7684YU12\u6709\u4e9b\u8bb8\u4e0d\u540c\uff0c\u5b83\u7684V\u5728U\u524d\u9762</p> <pre><code>YYYYYYYY\nVV\nUU\n</code></pre>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/video/yuv-save-format/#yuv420sp","title":"YUV420SP","text":"<p>\u9996\u5148\u662f\u6240\u6709Y\u503c\uff0c\u7136\u540e\u662fUV\u6216\u8005VU\u4ea4\u66ff\u5b58\u50a8\u3002\u662f<code>two-plane</code>\u6a21\u5f0f\u3002Y\u548cUV\u5206\u4e3a\u4e24\u4e2aplane\uff0c\u4f46\u662fUV(CbCr)\u4e3a\u4ea4\u9519\u5b58\u50a8\uff0c\u800c\u4e0d\u662f\u5206\u4e3a\u4e09\u4e2a\u5e73\u9762\u3002</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/video/yuv-save-format/#nv12","title":"NV12","text":"<p>\u5148\u5b58y\uff0c\u7136\u540euv\u4ea4\u66ff\uff0cu\u5728\u524d\uff0cv\u5728\u540e</p> <pre><code>yyyyyyyy yyyyyyyy yyyyyyyy yyyyyyyy yyyyyyyy yyyyyyyy yyyyyyyy yyyyyyyy   (w*h)\nuvuvuvuv uvuvuvuv uvuvuvuv uvuvuvuv                                       (w*h/2)\n</code></pre>","tags":["\u97f3\u89c6\u9891"]},{"location":"media/video/yuv-save-format/#nv21","title":"NV21","text":"<p>\u5148\u5b58y\uff0c\u7136\u540evu\u4ea4\u66ff\uff0cv\u5728\u524d\uff0cu\u5728\u540e</p> <pre><code>yyyyyyyy yyyyyyyy yyyyyyyy yyyyyyyy yyyyyyyy yyyyyyyy yyyyyyyy yyyyyyyy\nvuvuvuvu vuvuvuvu vuvuvuvu vuvuvuvu\n</code></pre> <p>nv21\u662fAndroid\u4e2dandroid.hardware.Camera\u7684\u9ed8\u8ba4\u8f93\u51fa\u683c\u5f0f\u3002 android.hardware.camera2\u63a8\u8350\u4f7f\u7528<code>YUV_420_888</code>\u683c\u5f0f\u3002</p>","tags":["\u97f3\u89c6\u9891"]},{"location":"nestjs/mp-wx-http-status-code/","title":"NestJS\u8fd4\u56de\u72b6\u6001\u7801\u9020\u6210\u5fae\u4fe1\u516c\u4f17\u53f7\u201c\u8be5\u516c\u4f17\u53f7\u63d0\u4f9b\u7684\u670d\u52a1\u51fa\u73b0\u6545\u969c\u201d","text":"\u66f4\u65b0\u65e5\u671f 2023-2-17 <ul> <li>2023-2-17 \u66f4\u65b0\u683c\u5f0f</li> <li>2021-8-3 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4f7f\u7528NestJS\u5199\u7684\u540e\u53f0\u670d\u52a1\uff0c\u8fd0\u884c\u5728Ubuntu\u4e0a\u3002</p>","tags":["NestJS"]},{"location":"nestjs/mp-wx-http-status-code/#bug","title":"bug\u63cf\u8ff0","text":"<p>\u6211\u4eec\u4f7f\u7528NestJS\u5199\u540e\u53f0\u4ee3\u7801\uff0c\u7ed9\u5fae\u4fe1\u516c\u4f17\u53f7\u63d0\u4f9b\u670d\u52a1\u3002 \u7528\u6237\u7ed9\u516c\u4f17\u53f7\u53d1\u6d88\u606f\u65f6\uff0c\u516c\u4f17\u53f7\u4f1a\u663e\u793a\u201c\u8be5\u516c\u4f17\u53f7\u63d0\u4f9b\u7684\u670d\u52a1\u51fa\u73b0\u6545\u969c\u201d\u3002 \u867d\u7136\u540e\u53f0\u4ee3\u7801\u53ef\u4ee5\u6b63\u5e38\u5904\u7406\u4e1a\u52a1\uff0c\u4f46\u8fd9\u4e2a\u63d0\u793a\u975e\u5e38\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\u3002</p>","tags":["NestJS"]},{"location":"nestjs/mp-wx-http-status-code/#_1","title":"\u68c0\u67e5","text":"<p>\u6839\u636e\u5fae\u4fe1\u516c\u4f17\u53f7\u6587\u6863\u7ed9\u7684\u63d0\u793a\uff0c\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u662f\u6ca1\u6709\u7ed9\u5fae\u4fe1\u670d\u52a1\u5668\u8fd4\u56de\u6b63\u786e\u7684\u4fe1\u606f\u3002</p> <p>\u5fae\u4fe1\u670d\u52a1\u5668\u9700\u8981\u7684\u662f<code>success</code>\u6216\u8005\u7a7a\u7684\u5b57\u7b26\u4e32\u3002\u4e0d\u80fd\u662fjson\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u3002 \u641c\u4e86\u4e00\u4e0b\u5176\u4ed6\u6587\u7ae0\uff0c\u6709\u7684\u8bf4xml\u91cc\u4e5f\u4e0d\u80fd\u5e26\u6709\u7a7a\u683c\uff1b\u6709\u7684\u8bf4\u516c\u4f17\u53f7\u7ed1\u5b9a\u4e86\u7b2c\u4e09\u65b9\u5e73\u53f0\uff0c\u8981\u53bb\u89e3\u7ed1\u3002 \u4f46\u8fd9\u4e9b\u548c\u6211\u4eec\u7684\u60c5\u51b5\u4e0d\u4e00\u81f4\u3002</p> <p>\u7ed9\u516c\u4f17\u53f7\u7684\u63a5\u53e3\u662f\u9ed8\u8ba4\u8fd4\u56de<code>success</code>\u7684\u3002</p> <p>\u67e5\u770b\u8fd0\u884clog\uff0c\u53d1\u73b0\u7528\u6237\u53d1\u90011\u6761\u6d88\u606f\u7ed9\u516c\u4f17\u53f7\uff0c\u6211\u4eec\u7684\u670d\u52a1\u7aef\u4f1a\u6536\u52304\u6761\u4e00\u6a21\u4e00\u6837\u7684\u6d88\u606f\u3002 \u8fd94\u6761\u6d88\u606f\u7684MsgId\u662f\u4e00\u6837\u7684\u3002\u7f51\u4e0a\u4e5f\u6709\u4eba\u63d0\u4f9b\u4e86\u9632\u6b62\u91cd\u590d\u6d88\u606f\u7684\u529e\u6cd5\u3002</p> <p>\u4e8e\u662f\u5c1d\u8bd5\u4ee5\u4e0b\u65b9\u6cd5</p> <ul> <li>\u7ef4\u62a4\u4e00\u4e2amap\uff0ckey\u662fMsgId\u3002</li> <li>\u63a5\u6536\u5230\u6d88\u606f\u540e\uff0c\u5982\u679c\u53d1\u73b0\u662f\u91cd\u590d\u7684MsgId\uff0c\u5219\u7acb\u523b\u8fd4\u56de<code>success</code>\uff08\u6216\u8005\u7a7a\u5b57\u7b26\u4e32\uff09\u3002</li> </ul> <p>\u4f46\u662f\u95ee\u9898\u4f9d\u65e7\u6ca1\u6709\u89e3\u51b3\u3002</p> <p>\u5fae\u4fe1\u670d\u52a1\u5668\u8ba4\u4e3a\u5b83\u6ca1\u6709\u62ff\u5230\u6b63\u786e\u7684\u8fd4\u56de\u503c\uff0c\u4e8e\u662f\u8d70\u4e86\u91cd\u8bd5\u7684\u6d41\u7a0b\u3002 \u6211\u4eecubuntu\u670d\u52a1\u5668\u4e0a\u4f7f\u7528\u4e86nginx\uff0c\u4e8e\u662f\u6211\u4eec\u67e5\u770bnginx\u7684log <pre><code>81.69.1.1 - - [03/Aug/2021:09:41:25 +0800] \"POST /mywxserve/?signature=sign1111&amp;timestamp=1627954885&amp;nonce=1832145745&amp;openid=qqq HTTP/1.1\" 201 0 \"-\" \"Mozilla/4.0\"\n81.69.1.1 - - [03/Aug/2021:09:41:26 +0800] \"POST /mywxserve/?signature=sign1111&amp;timestamp=1627954885&amp;nonce=1832145745&amp;openid=qqq HTTP/1.1\" 201 7 \"-\" \"Mozilla/4.0\"\n81.69.1.1 - - [03/Aug/2021:09:41:26 +0800] \"POST /mywxserve/?signature=sign1111&amp;timestamp=1627954885&amp;nonce=1832145745&amp;openid=qqq HTTP/1.1\" 201 7 \"-\" \"Mozilla/4.0\"\n42.192.1.1 - - [03/Aug/2021:09:41:26 +0800] \"POST /mywxserve/?signature=sign1111&amp;timestamp=1627954885&amp;nonce=1832145745&amp;openid=qqq HTTP/1.1\" 201 7 \"-\" \"Mozilla/4.0\"\n</code></pre> \u53ef\u4ee5\u770b\u5230\u67092\u4e2aip\u5730\u5740\uff0c\u53d1\u6765\u4e863+1\u6b21\u8bf7\u6c42\u3002\u770b\u5230nginx\u8fd4\u56de\u7684\u72b6\u6001\u7801\u90fd\u662f201\u3002 (ip\u5730\u5740\u548c\u4fe1\u606f\u6a21\u7cca\u5904\u7406)</p> <p>\u72b6\u6001\u7801201\u8868\u793a\u201c\u5df2\u521b\u5efa\u201d\u3002NestJS\u9ed8\u8ba4\u72b6\u6001\u7801\u662f200\uff0c\u4f46\u662f\u9ed8\u8ba4POST\u7684\u72b6\u6001\u7801\u662f201\u3002</p>","tags":["NestJS"]},{"location":"nestjs/mp-wx-http-status-code/#_2","title":"\u4fee\u590d","text":"<p>\u6211\u4eec\u5f3a\u5236\u8ba9nestjs\u8fd4\u56de\u72b6\u6001\u7801200 <pre><code>@HttpCode(200)\n@Post()\nasync onWxEvent(@Body('xml') xmlData: IWxMessageXmlData): Promise&lt;string&gt; {}\n</code></pre></p> <p>\u518d\u5c1d\u8bd5\u4e00\u4e0b\uff0c\u770b\u5230nginx\u7684log\uff0c\u8fd4\u56de\u72b6\u6001\u7801\u662f200\u4e86\u3002\u516c\u4f17\u53f7\u4e5f\u6b63\u5e38\u4e86\u3002 <pre><code>81.69.1.1 - - [03/Aug/2021:09:53:27 +0800] \"POST /mywxserve/?signature=rustfisher&amp;timestamp=1627955607&amp;nonce=1829147547&amp;openid=xxx0 HTTP/1.1\" 200 0 \"-\" \"Mozilla/4.0\"\n</code></pre></p> <p>\u7531\u6b64\u53ef\u89c1\uff0c\u63a5\u6536\u5fae\u4fe1\u516c\u4f17\u53f7\u6d88\u606f\u7684\u65f6\u5019\uff0c\u9664\u4e86\u8981\u8fd4\u56de\u7a7a\u5b57\u7b26\u4e32\u6216\u8005<code>success</code>\u6587\u672c\uff1b\u8fd4\u56de\u72b6\u6001\u7801\u5fc5\u987b\u662f200\u3002 \u7528\u5176\u4ed6\u7684\u540e\u53f0\u6846\u67b6\u53ef\u80fd\u4e0d\u4f1a\u9047\u5230\u72b6\u6001\u7801\u95ee\u9898\u3002</p>","tags":["NestJS"]},{"location":"nestjs/mp-wx-http-status-code/#_3","title":"\u53c2\u8003","text":"<ul> <li>wx\u57fa\u7840\u6d88\u606f\u80fd\u529b-\u88ab\u52a8\u56de\u590d\u7528\u6237\u6d88\u606f | \u5fae\u4fe1\u5f00\u53d1\u8005</li> <li>NestJS controller | docs.nestjs.com</li> <li>http\u72b6\u6001\u7801\u793a\u4f8b\uff0c\u56fe\u89e3</li> </ul>","tags":["NestJS"]},{"location":"nestjs/nest-devops/","title":"NestJS \u90e8\u7f72\u4e0e\u7ef4\u62a4","text":"\u66f4\u65b0\u65e5\u671f 2021-6-20 <ul> <li>2021-6-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u628anestjs\u7684\u5de5\u7a0b\u4f20\u5230\u670d\u52a1\u5668\u4e0a\uff0c\u7136\u540e\u76f4\u63a5\u8fdb\u884cnpm\u64cd\u4f5c\u3002 \u4e5f\u53ef\u4ee5\u5728\u672c\u5730\u6253\u5305\u51fanestjs\u7684\u5305\uff0c\u5c06<code>dist</code>\u76ee\u5f55\u4f20\u5230\u670d\u52a1\u5668\u4e0a\u3002</p> <p>\u5728\u8fd9\u91cc\u4e3a\u4e86\u65b9\u4fbf\u6f14\u793a\uff0c\u6211\u4eec\u63cf\u8ff0\u7684\u662f\u5c06\u5de5\u7a0b\u4f20\u5230\u670d\u52a1\u5668\u540e\u7684\u64cd\u4f5c\u3002 \u4f20\u5de5\u7a0b\u6587\u4ef6\uff0c\u53ef\u4ee5\u7528github/gitee\u5f53\u4f5c\u4e2d\u95f4\u6865\u6881\uff0c\u4e5f\u53ef\u4ee5\u7528vscode\u7684\u63d2\u4ef6\u4f20\u8f93\uff0c\u6216\u8005\u4f7f\u7528scp\u547d\u4ee4\u3002</p> <p>\u540c\u7406\uff0c<code>dist</code>\u76ee\u5f55\u4e5f\u53ef\u4ee5\u4f20\u5230github/gitee\u4e0a\uff0c\u670d\u52a1\u5668\u76f4\u63a5\u4f7f\u7528\u7f16\u8bd1\u597d\u7684\u6587\u4ef6\u3002</p>","tags":["NestJS"]},{"location":"nestjs/nest-devops/#_1","title":"\u76f4\u63a5\u542f\u52a8","text":"<p>\u542f\u52a8\u524d\uff0c\u8fdb\u5165\u5de5\u7a0b\u76ee\u5f55\uff0c\u5148\u5b89\u88c5\u4e00\u6b21\u3002 <pre><code>$ npm install\n</code></pre></p> <p>\u7528<code>npm run</code>\u547d\u4ee4\u542f\u52a8\u670d\u52a1 <pre><code># \u5f00\u53d1\u6a21\u5f0f\n$ npm run start\n\n# \u89c2\u5bdf\u6a21\u5f0f\n$ npm run start:dev\n</code></pre></p> <p>\u5728\u670d\u52a1\u5668\u4e0a\uff0c\u8fd0\u884c\u6b63\u5f0f\u73af\u5883\uff08\u751f\u4ea7\u73af\u5883 production\uff09 <pre><code># \u542f\u52a8\u751f\u4ea7\u73af\u5883\u524d \u5148start\n$ npm run start\n\n# \u751f\u4ea7\u73af\u5883\n$ npm run start:prod\n</code></pre> \u4f7f\u7528<code>npm run</code>\u8fd0\u884c\u7684\u7a0b\u5e8f\uff0c\u53ef\u4ee5<code>ctrl + c</code>\u505c\u6b62\u3002</p> <p>run\u8d77\u6765\u540e\uff0c\u7f16\u8bd1\u540e\u7684\u6587\u4ef6\u5728<code>dist</code>\u76ee\u5f55\u91cc\u3002</p>","tags":["NestJS"]},{"location":"nestjs/nest-devops/#pm2","title":"\u4f7f\u7528pm2\u7ba1\u7406","text":"<p>pm2\u662f\u5e38\u7528\u7684node\u8fdb\u7a0b\u7ba1\u7406\u5de5\u5177\uff0c\u5b83\u53ef\u4ee5\u63d0\u4f9bnode.js\u5e94\u7528\u7ba1\u7406\uff0c\u5982\u81ea\u52a8\u91cd\u8f7d\u3001\u6027\u80fd\u76d1\u63a7\u3001\u8d1f\u8f7d\u5747\u8861\u7b49\u3002</p> <p>\u5728\u670d\u52a1\u5668\u4e0a\uff0c\u6211\u4eec\u4f7f\u7528npm\u5b89\u88c5\u8fd9\u4e2a\u5de5\u5177 <pre><code>npm install pm2\n</code></pre></p> <p>\u5b89\u88c5\u5b8c\u6bd5\u540e\uff0c\u67e5\u770b\u4e00\u4e0b\u7248\u672c <pre><code>$ pm2 -v\n4.4.1\n</code></pre></p>","tags":["NestJS"]},{"location":"nestjs/nest-devops/#pm2_1","title":"pm2\u542f\u52a8\u670d\u52a1","text":"<p>\u6211\u4eec\u77e5\u9053\uff0cnestjs\u7f16\u8bd1\u540e\u7684\u6587\u4ef6\u5728<code>dist</code>\u76ee\u5f55\u91cc\uff0c\u5165\u53e3\u6587\u4ef6\u662f<code>dist/main.js</code></p> <p>\u7528pm2\u542f\u52a8\u670d\u52a1\u4e4b\u524d\uff0c\u5148\u628a\u8be5\u88c5\u7684\u5e93\u7528npm\u88c5\u597d\u3002\u8fd0\u884c<code>npm run start:prod</code>\uff0c\u7136\u540e<code>ctrl + c</code>\u505c\u6b62\u3002</p> <p>\u63a5\u4e0b\u6765\u7528pm2\u542f\u52a8 <pre><code>pm2 start dist/main.js --name=\"\u8fd9\u91cc\u662f\u81ea\u5b9a\u4e49\u7684\u540d\u5b57\"\n</code></pre></p>","tags":["NestJS"]},{"location":"nestjs/nest-devops/#_2","title":"\u67e5\u770b\u670d\u52a1","text":"<p>\u4f7f\u7528\u547d\u4ee4<code>pm2 list</code>\u67e5\u770b\u670d\u52a1</p> <p>\u4f8b\u5982\u5728\u67d0\u4e2a\u670d\u52a1\u5668\u4e0a <pre><code>$ pm2 list \n\u250c\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 id  \u2502 name              \u2502 namespace   \u2502 version \u2502 mode    \u2502 pid      \u2502 uptime \u2502 \u21ba    \u2502 status    \u2502 cpu      \u2502 mem      \u2502 user     \u2502 watching \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 3   \u2502 rustfisher-debug  \u2502 default     \u2502 1.0.0   \u2502 fork    \u2502 12260    \u2502 2M     \u2502 0    \u2502 online    \u2502 0%       \u2502 39.7mb   \u2502 ubuntu   \u2502 disabled \u2502\n\u2502 2   \u2502 rustfisher-release\u2502 default     \u2502 1.0.0   \u2502 fork    \u2502 12090    \u2502 2M     \u2502 46   \u2502 online    \u2502 0%       \u2502 44.6mb   \u2502 ubuntu   \u2502 disabled \u2502\n\u2502 0   \u2502 index             \u2502 default     \u2502 1.0.0   \u2502 fork    \u2502 0        \u2502 0      \u2502 68   \u2502 stopped   \u2502 0%       \u2502 0b       \u2502 ubuntu   \u2502 disabled \u2502\n\u2502 1   \u2502 index             \u2502 default     \u2502 1.0.0   \u2502 fork    \u2502 0        \u2502 0      \u2502 15   \u2502 stopped   \u2502 0%       \u2502 0b       \u2502 ubuntu   \u2502 disabled \u2502\n\u2502 4   \u2502 an.rustfisher     \u2502 default     \u2502 0.0.1   \u2502 fork    \u2502 32252    \u2502 74m    \u2502 0    \u2502 online    \u2502 0%       \u2502 51.5mb   \u2502 ubuntu   \u2502 disabled \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre></p>","tags":["NestJS"]},{"location":"nestjs/nest-devops/#_3","title":"\u505c\u6b62\u670d\u52a1","text":"<p>\u60f3\u8981\u505c\u6b62\u67d0\u4e2a\u670d\u52a1\uff0c\u4f7f\u7528<code>pm2 stop</code> + \u670d\u52a1\u540d\uff08name\uff09\u6216\u8005id</p> <p>\u4f8b\u5982 <pre><code>pm2 stop rustfisher-debug\n</code></pre> \u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u4f1a\u81ea\u52a8\u8fd0\u884c\u4e00\u6b21<code>pm2 list</code></p>","tags":["NestJS"]},{"location":"nestjs/nest-devops/#_4","title":"\u91cd\u542f\u670d\u52a1","text":"<p>\u7528<code>pm2 restart</code> + \u670d\u52a1\u540d\uff08name\uff09\u6216\u8005id <pre><code>pm2 restart rustfisher-debug\n</code></pre> \u6216\u8005 <pre><code>pm2 restart 3\n</code></pre></p>","tags":["NestJS"]},{"location":"nestjs/nest-devops/#_5","title":"\u65e5\u5fd7\u7ba1\u7406","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cpm2\u7684\u65e5\u5fd7\u5b58\u653e\u5728<code>~/.pm2/log</code>\u91cc\u3002\u6bcf\u4e2a\u542f\u52a8\u7684\u670d\u52a1\u6709\u5bf9\u5e94\u7684log\u6587\u4ef6\u3002</p> <p>\u4f8b\u5982\uff0c\u5728\u67d0\u4e2a\u670d\u52a1\u5668\u4e0a <pre><code>$ ls .pm2/logs/\napp-error.log  dr-debug-error.log  dr-release-error.log  index-error.log   www-error.log\napp-out.log    dr-debug-out.log    dr-release-out.log    index-out.log     www-out.log\n</code></pre></p>","tags":["NestJS"]},{"location":"nestjs/nest-devops/#nohup","title":"nohup\u540e\u53f0\u542f\u52a8","text":"<p>\u6211\u4eec\u4e5f\u53ef\u7528nohup\u540e\u53f0\u542f\u52a8\u3002</p> <p>\u8fdb\u5165\u5de5\u7a0b\u76ee\u5f55\uff0c\u8fd0\u884c <pre><code>nohup npm run start:prod &gt;&gt; nohup.log &amp;\n</code></pre></p> <p>\u67e5\u770b\u8fdb\u7a0b <pre><code>$ ps -aux | grep node\nubuntu   11826  0.0  1.2 674064 10988 ?        Ssl  Mar16   0:00 /usr/local/bin/node /usr/local/lib/node_modules/npm/node_modules/update-notifier/check.js {\"pkg\":{\"name\":\"npm\",\"version\":\"6.14.6\"}}\nubuntu   16478  0.0  0.0   4512   788 pts/3    S    11:49   0:00 sh -c node dist/main\nubuntu   16479  0.4  5.1 578840 45228 pts/3    Sl   11:49   0:00 node dist/main\nubuntu   16959  0.0  0.1  13232   928 pts/3    S+   11:52   0:00 grep --color=auto node\n</code></pre> \u53ef\u4ee5\u770b\u5230\u67092\u4e2a\u76f8\u5173\u7684\u8fdb\u7a0b16478\u548c16479</p> <p>\u67e5\u770b\u7aef\u53e3\u5360\u7528\u60c5\u51b5\u3002\u5047\u8bbe\u6211\u4eec\u5de5\u7a0b\u76d1\u542c\u7684\u662f8090\u7aef\u53e3\u3002 <pre><code>$ netstat -anp | grep 8090\n(Not all processes could be identified, non-owned process info\n will not be shown, you would have to be root to see it all.)\ntcp        0      0 127.0.0.1:52788         127.0.0.1:8090          TIME_WAIT   -               \ntcp6       0      0 :::8090                 :::*                    LISTEN      16479/node      \n</code></pre></p> <p>\u7ed3\u5408\u4e00\u770b\uff0c\u8fdb\u7a0b16479\u662f\u6211\u4eec\u540e\u53f0\u8fd0\u884c\u7684\u670d\u52a1\u6ca1\u9519\u4e86\u3002</p> <p>\u505c\u6b62\u540e\u53f0\u8fdb\u7a0b <pre><code>sudo kill 16479\n</code></pre> kill\u7136\u540e\u518d\u67e5\u8be2\u8fdb\u7a0b\u548c\u7aef\u53e3\u5360\u7528\u60c5\u51b5\uff0c\u5c31\u6ca1\u6709\u76f8\u5173\u7684\u8fdb\u7a0b\u4e86\u3002</p>","tags":["NestJS"]},{"location":"nestjs/nest-devops/#_6","title":"\u603b\u7ed3","text":"<p>\u53ef\u4ee5\u7528\u4e0d\u540c\u7684\u65b9\u5f0f\u540e\u53f0\u542f\u52a8\u670d\u52a1\u3002 \u542f\u52a8\u751f\u4ea7\u73af\u5883\u4e4b\u524d\uff0c\u8981\u5148\u540c\u6b65\u5e76\u7f16\u8bd1\u3002</p>","tags":["NestJS"]},{"location":"nestjs/nestjs-static-file/","title":"NestJS static res \u9759\u6001\u6587\u4ef6","text":"\u66f4\u65b0\u65e5\u671f 2021-7-10 <ul> <li>2021-7-10 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4e3a\u4e86\u63d0\u4f9b\u9759\u6001\u8d44\u6e90\uff0c\u6211\u4eec\u53ef\u4ee5\u7528<code>@nestjs/serve-static</code>\u5305\u91cc\u7684<code>ServeStaticModule</code>\u3002 \u670d\u52a1\u5668\u4e0a\u7684\u9759\u6001\u8d44\u6e90\uff0c\u4e00\u822c\u6307\u7684\u662f\u6587\u4ef6\uff0c\u6bd4\u5982\u56fe\u7247\u3001\u97f3\u9891\u3001\u89c6\u9891\u3001\u6587\u672c\u6587\u4ef6\u6216\u8005\u4e8c\u8fdb\u5236\u6587\u4ef6\u7b49\u7b49\u3002</p> <p>\u6216\u8005\u662f\u4e00\u4e9b\u5355\u9875\u9762\u5e94\u7528\u7a0b\u5e8f(Single Page Application, SPA)\u3002\u4ece\u670d\u52a1\u5668\u4e0a\u8bf7\u6c42\u5f97\u5230\u7f51\u9875\uff0c\u7136\u540e\u7f51\u9875\u518d\u6267\u884c\u81ea\u5df1\u7684\u4e1a\u52a1\u3002</p>","tags":["NestJS"]},{"location":"nestjs/nestjs-static-file/#_1","title":"\u5b89\u88c5","text":"<p>\u9996\u5148\u6211\u4eec\u9700\u8981\u5b89\u88c5<code>@nestjs/serve-static</code>\u5305\u3002 \u5728\u5de5\u7a0b\u8def\u5f84\u4e0b <pre><code>$ npm install --save @nestjs/serve-static\n</code></pre></p> <p>\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u5de5\u7a0b\u7684package.json\u91cc\u4f1a\u591a\u51fa <pre><code>\"dependencies\": {\n  \"@nestjs/serve-static\": \"^2.1.4\",\n}\n</code></pre></p>","tags":["NestJS"]},{"location":"nestjs/nestjs-static-file/#_2","title":"\u4f7f\u7528","text":"<p>\u5728root <code>AppModule</code>\u4e2d\uff0c\u5f15\u5165<code>ServeStaticModule</code>\u6a21\u5757\u3002</p> <p><pre><code>import { ServeStaticModule } from '@nestjs/serve-static';\n\n@Module({\n  imports: [\n  ServeStaticModule.forRoot({\n    rootPath: join(__dirname, '..', 'rustfisherData'),\n    exclude: ['/api*'],\n  }),],\n})\nexport class AppModule { }\n</code></pre> <code>imports</code>\u91cc\u6dfb\u52a0\u4e86<code>ServeStaticModule</code>\u6a21\u5757\u3002\u9700\u8981\u7528\u5230<code>ServeStaticModule.forRoot</code>\u65b9\u6cd5\u3002</p> <ul> <li><code>rootPath</code> \u6307\u5b9a\u4e86\u9759\u6001\u6587\u4ef6\u7684\u6839\u76ee\u5f55</li> <li><code>exclude</code> \u8868\u660e\u6392\u9664\u5728\u5916\u7684\u6587\u4ef6\u548c\u76ee\u5f55</li> </ul>","tags":["NestJS"]},{"location":"nestjs/nestjs-static-file/#_3","title":"\u8def\u5f84\u8bf4\u660e","text":"<p>\u6211\u4eec\u5173\u5fc3\u7684\u662f\uff0c\u670d\u52a1\u5668\u4e0a\u54ea\u4e2a\u76ee\u5f55\u53ef\u4ee5\u8ba9\u5ba2\u6237\u7aef\u8bbf\u95ee\uff0c\u54ea\u4e2a\u76ee\u5f55\u662f\u4e0d\u5f00\u653e\u7684\u3002</p> <p><code>__dirname</code> \u83b7\u53d6\u5230\u7684\u662f\u5f53\u524d\u76ee\u5f55\u7684\u8def\u5f84\u3002 \u4f7f\u7528<code>join()</code>\u65b9\u6cd5\uff0c\u62fc\u63a5\u51fa\u4e00\u4e2a\u65b0\u7684\u8def\u5f84\u3002</p> <p>\u5de5\u7a0b\u7f16\u8bd1\u51fa\u6765\u7684\u6587\u4ef6\u653e\u5728<code>dist</code>\u76ee\u5f55\u4e2d\u3002<code>app.module.js</code>\u6587\u4ef6\u4e5f\u5728\u91cc\u9762\u3002 \u6b64\u65f6<code>__dirname</code>\u8868\u793a\u7684\u662f<code>dist</code>\u76ee\u5f55\u7684\u8def\u5f84\u3002 \u90a3\u4e48<code>join(__dirname, '..', 'rustfisherData')</code>\u5f97\u5230\u7684\u8def\u5f84\u5c31\u662f\u4e0e<code>dist</code>\u76ee\u5f55\u540c\u7ea7\u7684<code>rustfisherData</code>\u3002</p> <p>\u5047\u8bbe\u6211\u4eec\u670d\u52a1\u5668\u4e0a\u8fd0\u884c\u76ee\u5f55\u662f<code>/home/rustfisher/server/rf-server-nest/dist</code> \u90a3\u4e48\u9759\u6001\u6587\u4ef6\u5b58\u653e\u7684\u76ee\u5f55\u5c31\u662f<code>/home/rustfisher/server/rf-server-nest/rustfisherData</code></p>","tags":["NestJS"]},{"location":"nestjs/nestjs-static-file/#_4","title":"\u914d\u7f6e","text":"<p><code>ServeStaticModule</code>\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u81ea\u5b9a\u4e49\u63a7\u5236\u3002\u5f00\u53d1\u8005\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5b83\u7684\u884c\u4e3a\u3002 \u6bd4\u5982\u50cf\u524d\u9762\u90a3\u6837\u8bbe\u7f6e\u9759\u6001\u6587\u4ef6\u6839\u76ee\u5f55<code>rootPath</code>\uff1b\u8bbe\u7f6e\u6392\u9664\u7684\u8def\u5f84<code>exclude</code>\u3002</p> <p>GitHub\u4e0a\u6709\u8be6\u7ec6\u914d\u7f6e</p> <p>\u6ce8\u610f \u8bbf\u95ee\u76ee\u5f55\u65f6\uff0c\u9ed8\u8ba4\u4f1a\u627e<code>index.html</code>\u6587\u4ef6\u53d1\u9001\u56de\u53bb\u3002\u540e\u6587\u4f1a\u6709\u66f4\u591a\u8bf4\u660e\u3002</p>","tags":["NestJS"]},{"location":"nestjs/nestjs-static-file/#_5","title":"\u5ba2\u6237\u7aef\u8bbf\u95ee","text":"<p>\u5047\u8bbe\u670d\u52a1\u90e8\u7f72\u597d\u4e86\uff08\u5e76\u4e0d\u662f\u771f\u5b9e\u9879\u76ee\uff09\uff0c\u7f51\u5740\u662f https://rustfisher.com \u3002\u90e8\u7f72\u597d\u670d\u52a1\u540e\uff0c\u6211\u4eec\u6d4b\u8bd5\u4e00\u4e0b\u3002</p> <p>\u6253\u5f00\u6d4f\u89c8\u5668\uff0c\u8bbf\u95eeurl\uff1a https://rustfisher.com/some/path/to/img/11.jpg \u53ef\u4ee5\u5728\u7f51\u9875\u4e0a\u770b\u5230\u56fe\u7247\uff08\u5e76\u4e0d\u662f\u771f\u5b9e\u9879\u76ee\uff09\u3002</p> <p>\u5982\u679c\u8bbf\u95ee\u4e00\u4e2a\u4e0d\u5b58\u5728\u7684\u8def\u5f84\uff08\u6587\u4ef6\uff09\uff0c\u5b83\u4f1a\u8fd4\u56de\u4e00\u4e2a\u9ed8\u8ba4\u7684<code>index.html</code>\u3002\u5982\u679c\u6ca1\u6709\u8fd9\u4e2a\u6587\u4ef6\uff0c\u5219\u4f1a\u62a5\u4e00\u4e2aENOENT\u9519\u8bef\u4fe1\u606f <pre><code>[Nest] 32378   - 07/10/2021, 8:15:00 PM   [ExceptionsHandler] ENOENT: no such file or directory, \nstat '/home/rustfisher/server/rf-server-nest/rustfisherData/index.html' +234539ms\n</code></pre></p> <p>\u4e0d\u60f3\u8ba9\u5b83\u62a5\u8fd9\u4e2a\u9519\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u5f04\u4e00\u4e2a<code>index.html</code>\u6587\u4ef6\u653e\u5230\u5bf9\u5e94\u8def\u5f84\u4e0a\u3002 \u8fd9\u6837\u505a\u7684\u8bdd\uff0c\u8bbf\u95ee\u76ee\u5f55\u6216\u8005\u4e0d\u5b58\u5728\u7684\u6587\u4ef6\u4f1a\u9ed8\u8ba4\u8fd4\u56de<code>index.html</code>\u6587\u4ef6\u3002</p>","tags":["NestJS"]},{"location":"nestjs/nestjs-static-file/#_6","title":"\u5c0f\u7ed3","text":"<p>\u63d0\u4f9b\u8bbf\u95ee\u9759\u6001\u6587\u4ef6\u7684\u529f\u80fd\u6bd4\u8f83\u5e38\u89c1\u3002\u5ba2\u6237\u7aef\u4f7f\u7528\u4e00\u4e2aurl\uff0c\u5c31\u80fd\u8bbf\u95ee\u670d\u52a1\u5668\u4e0a\u7684\u6587\u4ef6\u3002 \u73b0\u5728\u5f88\u5e38\u89c1\u7684\u505a\u6cd5\u662f\u628a\u6587\u4ef6\u653e\u5728CDN\u4e0a\uff0c\u51cf\u8f7b\u670d\u52a1\u5668\u7684io\u538b\u529b\u548c\u7f51\u7edc\u538b\u529b\u3002 \u5728Linux\u670d\u52a1\u5668\u4e0a\uff0cnginx\u548c\u540c\u7c7b\u7684\u670d\u52a1\u4e5f\u80fd\u8f7b\u677e\u5b9e\u73b0\u7c7b\u4f3c\u7684\u63d0\u4f9b\u9759\u6001\u6587\u4ef6\u7684\u529f\u80fd\u3002</p>","tags":["NestJS"]},{"location":"nestjs/nestjs-websocket-start/","title":"NestJS WebSocket \u5f00\u59cb\u4f7f\u7528","text":"\u66f4\u65b0\u65e5\u671f 2022-6-1 <ul> <li>2022-6-1 \u66f4\u65b0\u683c\u5f0f</li> <li>2022-5-6 \u66f4\u65b0\u683c\u5f0f</li> <li>2022-5-5 \u66f4\u65b0\u683c\u5f0f</li> <li>2021-7-22 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4f7f\u7528NestJs\u63d0\u4f9bWebSocket\u670d\u52a1\u3002 \u672c\u6587\u4f1a\u5728\u65b0\u5efa\u9879\u76ee\u7684\u57fa\u7840\u4e0a\u589e\u52a02\u4e2a\u7c7b</p> <ul> <li>Gateway \u5b9e\u73b0\u4e1a\u52a1\u903b\u8f91\u7684\u5730\u65b9</li> <li>WebSocketAdapter WebSocket\u9002\u914d\u5668</li> </ul>","tags":["NestJS","ws"]},{"location":"nestjs/nestjs-websocket-start/#_1","title":"\u65b0\u5efa\u9879\u76ee","text":"<p>\u65b0\u5efa\u4e00\u4e2a\u9879\u76ee\u6765\u6f14\u793a\uff0c\u7528npm\u6765\u7ba1\u7406\u9879\u76ee\u3002 <pre><code>nest new websocket-start\n</code></pre></p> <p>\u5f97\u5230\u4e00\u4e2a\u6709\u57fa\u7840\u529f\u80fd\u7684\u5de5\u7a0b\u3002</p> <p>\u8fdb\u5165\u9879\u76ee\u76ee\u5f55\uff0c\u5b89\u88c52\u4e2a\u5e93 <pre><code>npm i --save @nestjs/websockets @nestjs/platform-socket.io\n</code></pre></p>","tags":["NestJS","ws"]},{"location":"nestjs/nestjs-websocket-start/#_2","title":"\u542f\u52a8","text":"<p>\u4f7f\u7528\u7aef\u53e33001 <pre><code>await app.listen(3001);\n</code></pre> <code>npm run start</code>\u542f\u52a8\u6211\u4eec\u7684\u5de5\u7a0b\u3002\u7528postman\u6d4b\u4e00\u4e0b\uff0c\u529f\u80fdok\u3002</p>","tags":["NestJS","ws"]},{"location":"nestjs/nestjs-websocket-start/#gateway","title":"gateway\u4ecb\u7ecd","text":"<p>Nest\u91cc\u7684gateway(\u7f51\u5173)\u53ea\u662f\u4e00\u4e2a\u7528 <code>@WebSocketGateway()</code> \u88c5\u9970\u5668\u6ce8\u91ca\u7684\u7c7b\u3002\u4ece\u6280\u672f\u4e0a\u8bb2\uff0c\u7f51\u5173\u4e0e\u5e73\u53f0\u65e0\u5173\uff0c\u5728\u521b\u5efa\u9002\u914d\u5668\u540e\u5b83\u4eec\u4e0e\u4efb\u4f55 WebSockets \u5e93\u90fd\u517c\u5bb9\u3002</p>","tags":["NestJS","ws"]},{"location":"nestjs/nestjs-websocket-start/#gateway_1","title":"\u65b0\u5efaGateway","text":"<p>\u65b0\u5efaws.gateway.ts\u6587\u4ef6\u3002\u5728\u88c5\u9970\u5668<code>@WebSocketGateway()</code>\u91cc\u7aef\u53e3\u6307\u5b9a\u4e3a3002\u3002 <pre><code>import { ConnectedSocket, MessageBody, SubscribeMessage, WebSocketGateway } from \"@nestjs/websockets\";\nimport * as WebSocket from 'ws';\n\n@WebSocketGateway(3002)\nexport class WsStartGateway {\n\n  @SubscribeMessage('hello')\n  hello(@MessageBody() data: any): any {\n    return {\n      \"event\": \"hello\",\n      \"data\": data,\n      \"msg\": 'rustfisher.com'\n    };\n  }\n}\n</code></pre> \u91cc\u9762\u6709\u4e00\u4e2a<code>hello</code>\u65b9\u6cd5\uff0c\u8ba2\u9605\u7684\u6d88\u606f\u662f<code>'hello'</code>\u3002</p> <p>\u628a\u5b83\u653e\u8fdb<code>AppModule</code>\u7684<code>providers</code>\u91cc\u3002 <pre><code>providers: [WsStartGateway],\n</code></pre></p> <p>\u5982\u679cwebsockt\u548chttp\u7528\u4e86\u540c\u4e00\u4e2a\u63a5\u53e3(\u672c\u4f8b\u662f3001)\uff0c\u542f\u52a8\u65f6\u4f1a\u62a5\u9519 <pre><code>Error: listen EADDRINUSE: address already in use :::3001\n</code></pre> \u56e0\u6b64\u6211\u4eec\u8fd9\u91cc\u7ed9ws\u5206\u914d\u53e6\u4e00\u4e2a\u7aef\u53e3\u53f7\u3002</p>","tags":["NestJS","ws"]},{"location":"nestjs/nestjs-websocket-start/#websocket","title":"\u83b7\u53d6WebSocket\u5bf9\u8c61","text":"<p>\u5728<code>WsStartGateway</code>\u91cc\u65b0\u589e\u52a0\u4e00\u4e2a\u6d88\u606f\u8ba2\u9605\u65b9\u6cd5\u3002 \u65b9\u6cd5\u91cc\u63a5\u53d7<code>@ConnectedSocket() client: WebSocket</code>\uff0c\u8fd9\u4e2aclient\u5c31\u662f\u4e0e\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u5bf9\u8c61\u3002 \u6211\u4eec\u53ef\u4ee5\u7528\u5b83\u6765\u7ed9\u5ba2\u6237\u7aef\u53d1\u9001\u6d88\u606f\u3002 <pre><code>@SubscribeMessage('hello2')\nhello2(@MessageBody() data: any, @ConnectedSocket() client: WebSocket): any {\n    console.log('\u6536\u5230\u6d88\u606f client:', client);\n    client.send(JSON.stringify({ event: 'tmp', data: '\u8fd9\u91cc\u662f\u4e2a\u4e34\u65f6\u4fe1\u606f' }));\n    return { event: 'hello2', data: data };\n}\n</code></pre></p>","tags":["NestJS","ws"]},{"location":"nestjs/nestjs-websocket-start/#websocketadapter","title":"\u81ea\u5b9a\u4e49WebSocketAdapter","text":"<p>\u524d\u9762\u6211\u4eec\u5efa\u7acb\u597d\u4e86Gateway\uff0c\u8fd8\u9700\u8981\u4e00\u4e2a\u9002\u914d\u5668\u3002 \u65b0\u5efa\u6587\u4ef6ws.adapter.ts\uff0c\u7ee7\u627f<code>WebSocketAdapter</code> <pre><code>import * as WebSocket from 'ws';\nimport { WebSocketAdapter, INestApplicationContext } from '@nestjs/common';\nimport { MessageMappingProperties } from '@nestjs/websockets';\nimport { Observable, fromEvent, EMPTY } from 'rxjs';\nimport { mergeMap, filter } from 'rxjs/operators';\n\nexport class WsAdapter implements WebSocketAdapter {\n\n    constructor(private app: INestApplicationContext) { }\n\n    create(port: number, options: any = {}): any {\n        console.log('ws create')\n        return new WebSocket.Server({ port, ...options });\n    }\n\n    bindClientConnect(server, callback: Function) {\n        console.log('ws bindClientConnect, server:\\n', server);\n        server.on('connection', callback);\n    }\n\n    bindMessageHandlers(\n        client: WebSocket,\n        handlers: MessageMappingProperties[],\n        process: (data: any) =&gt; Observable&lt;any&gt;,\n    ) {\n        console.log('[waAdapter]\u6709\u65b0\u7684\u8fde\u63a5\u8fdb\u6765')\n        fromEvent(client, 'message')\n            .pipe(\n                mergeMap(data =&gt; this.bindMessageHandler(client, data, handlers, process)),\n                filter(result =&gt; result),\n            )\n            .subscribe(response =&gt; client.send(JSON.stringify(response)));\n    }\n\n    bindMessageHandler(\n        client: WebSocket,\n        buffer,\n        handlers: MessageMappingProperties[],\n        process: (data: any) =&gt; Observable&lt;any&gt;,\n    ): Observable&lt;any&gt; {\n        let message = null;\n        try {\n            message = JSON.parse(buffer.data);\n        } catch (error) {\n            console.log('ws\u89e3\u6790json\u51fa\u9519', error);\n            return EMPTY;\n        }\n\n        const messageHandler = handlers.find(\n            handler =&gt; handler.message === message.event,\n        );\n        if (!messageHandler) {\n            return EMPTY;\n        }\n        return process(messageHandler.callback(message.data));\n    }\n\n    close(server) {\n        console.log('ws server close');\n        server.close();\n    }\n}\n</code></pre> \u5728<code>bindMessageHandler</code>\u65b9\u6cd5\u4e2d\uff0c\u4f1a\u5c06\u4f20\u6765\u7684json\u6d88\u606f\u89e3\u6790\uff0c\u7136\u540e\u53d1\u9001\u5230\u5bf9\u5e94\u7684\u5904\u7406\u5668\u4e2d\u3002 \u8fd9\u91cc\u5c31\u662f\u53d1\u7ed9gateway\u8fdb\u884c\u5904\u7406\u3002 \u5224\u65ad\u4f9d\u636e\u662f<code>message.event</code>\uff0c\u5c31\u662f<code>event</code>\u5b57\u6bb5\u3002</p> <p>\u5728main.ts\u91cc\u4f7f\u7528\u8fd9\u4e2a\u9002\u914d\u5668\u3002 <pre><code>import { NestFactory } from '@nestjs/core';\nimport { AppModule } from './app.module';\nimport { WsAdapter } from './ws/ws.adapter';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n  app.useWebSocketAdapter(new WsAdapter(app)); // \u4f7f\u7528\u6211\u4eec\u7684\u9002\u914d\u5668\n  await app.listen(3001);\n}\nbootstrap();\n</code></pre></p> <p><code>npm run start</code>\u8fd0\u884c\u9879\u76ee\uff0c\u51c6\u5907\u8fdb\u4e00\u6b65\u6d4b\u8bd5\u3002</p>","tags":["NestJS","ws"]},{"location":"nestjs/nestjs-websocket-start/#postmanwebsocket","title":"\u7528Postman\u6765\u6d4b\u8bd5WebSocket","text":"<p>Postman8.8.0\u63d0\u4f9b\u4e86beta\u7248\u7684WebSocket\u6d4b\u8bd5\u529f\u80fd\u3002 <code>New -&gt; WebSocket Request beta</code>\u65b0\u5efa\u4e00\u4e2aWebSocket\u6d4b\u8bd5\u3002\u5f53\u524d\u7248\u672c\u8fd8\u4e0d\u652f\u6301\u4fdd\u5b58ws\u7684\u6d4b\u8bd5\u4f8b\u5b50\u3002 \u8f93\u5165\u76ee\u6807url <code>ws://localhost:3002</code>\uff0c\u70b9\u51fb\u8fde\u63a5 Connect \u6309\u94ae\u3002</p> postman\u6d4b\u8bd5\u8fde\u63a5 <p></p> postman9.17.1 <p>\u9700\u8981\u9009\u62e9<code>Raw</code>\u7c7b\u578b</p> <p></p> <p>\u53d1\u9001\u6d4b\u8bd5\u6d88\u606f\u3002\u5728\u6d88\u606f\u6846\u91cc\u586b\u5165\u4ee5\u4e0bjson\u6570\u636e\u3002 <pre><code>{\n    \"event\" : \"hello\",\n    \"data\" : \"\u6d4b\u8bd5\u6570\u636e\"\n}\n</code></pre></p> postman\u6d4b\u8bd5 <p></p> <p>\u53d1\u9001\u7684\u6570\u636e\u7ecf\u8fc7<code>WsAdapter</code>\u5206\u53d1\u7ed9<code>WsStartGateway</code>\uff0c\u5904\u7406\u540e\u8fd4\u56de\u6570\u636e\u3002</p> <p>\u53d1\u9001hello2\u6d4b\u8bd5\u6570\u636e <pre><code>{\n    \"event\" : \"hello2\",\n    \"data\" : \"\u6d4b\u8bd5\u6570\u636e\"\n}\n</code></pre></p> postman\u6d4b\u8bd5 <p></p> <p>\u53ef\u4ee5\u770b\u5230\u670d\u52a1\u8fd4\u56de\u4e862\u6761\u6570\u636e\u3002</p> <p>\u53d1\u9001\u4e00\u4e2a\u9519\u8bef\u683c\u5f0f\u7684\u6570\u636e <pre><code>{\n    \"event\" : \"hello2\n</code></pre></p> <p>\u670d\u52a1\u7aef\u63a5\u6536\u5230\u4e86\u6570\u636e\uff0c\u4f46\u662f\u89e3\u6790\u5931\u8d25 <pre><code>ws\u89e3\u6790json\u51fa\u9519 SyntaxError: Unexpected end of JSON input\n</code></pre></p>","tags":["NestJS","ws"]},{"location":"nestjs/nestjs-websocket-start/#_3","title":"\u5c0f\u7ed3","text":"<p>\u8981\u4f7f\u7528WebSocket\u529f\u80fd\uff0c\u9700\u8981\u589e\u52a0</p> <ul> <li>Gateway \u5b9e\u73b0\u4e1a\u52a1\u903b\u8f91\u7684\u5730\u65b9</li> <li>WebSocketAdapter WebSocket\u9002\u914d\u5668</li> </ul> <p>ws\u7684\u7aef\u53e3\u5efa\u8bae\u662f\u548chttp\u7684\u7aef\u53e3\u5206\u5f00\u3002</p>","tags":["NestJS","ws"]},{"location":"nestjs/nestjs-websocket-start/#_4","title":"\u53c2\u8003","text":"<p>NestJS WebSockets \u5b98\u65b9\u6587\u6863 \u793a\u4f8b\u5de5\u7a0bnest-sample - gitee</p>","tags":["NestJS","ws"]},{"location":"nestjs/wss-nginx-cfg/","title":"Ubuntu Nginx \u914d\u7f6e\u4f7f\u7528WSS","text":"\u66f4\u65b0\u65e5\u671f 2022-7-6 <ul> <li>2022-7-6 \u4fee\u590d\u94fe\u63a5</li> <li>2022-6-27 \u589e\u52a0nginx\u62d3\u5c55</li> <li>2022-5-7 \u8de8\u57df\u8bf4\u660e</li> <li>2022-5-6 \u66f4\u65b0\u8bf4\u660e</li> <li>2022-5-5 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u8fd0\u884c\u73af\u5883\u4e0e\u5de5\u5177</p> <ul> <li>Ubuntu 16.04.1 LTS</li> <li>nginx 1.10.3 (Ubuntu)</li> <li>pm2 4.4.1</li> </ul>","tags":["NestJS","Nginx"]},{"location":"nestjs/wss-nginx-cfg/#_1","title":"\u8bc1\u4e66\u4e0e\u57df\u540d","text":"<p>\u6211\u4eec\u7528NestJS\u6765\u5199\u4e00\u4e2awss\u670d\u52a1\uff0c\u90e8\u7f72\u5230\u670d\u52a1\u5668\u4e0a\u3002</p> <p>\u51c6\u5907\u4e00\u4e2a\u57df\u540d\uff0c\u4f8b\u5982 antalkws.rustfisher.com</p> <p>\u7533\u8bf7\u8fd9\u4e2a\u57df\u540d\u7684SSL\u8bc1\u4e66\uff0c\u5e76\u90e8\u7f72\u5230\u670d\u52a1\u5668\u4e0a</p>","tags":["NestJS","Nginx"]},{"location":"nestjs/wss-nginx-cfg/#nginx","title":"Nginx\u914d\u7f6e","text":"<p>\u670d\u52a1\u5668\u7684Ubuntu\u7528\u7684\u662fNginx\uff0c\u914d\u7f6e\u4e00\u4e0b <code>/etc/nginx/sites-enabled/</code> \u76ee\u5f55\u91cc\u7684\u6587\u4ef6 </p> <pre><code>map $http_upgrade $connection_upgrade {  \n    default upgrade;  \n    '' close;  \n}\n\nupstream talkwebsocket {  \n    server 127.0.0.1:9002;\n}\n\nserver {\n    listen 443;\n    server_name antalkws.rustfisher.com;\n    ssl on;\n    ssl_certificate /home/ubuntu/server/ssl/antalk/antalkws.rustfisher.com_bundle.crt;\n    ssl_certificate_key /home/ubuntu/server/ssl/antalk/antalkws.rustfisher.com.key;\n    ssl_session_timeout 20m;\n    ssl_verify_client off;\n    location / {\n        proxy_pass http://talkwebsocket;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"Upgrade\";\n        proxy_read_timeout 300s;\n    }  \n}\n</code></pre> <p>\u6307\u5b9a<code>talkwebsocket</code>\uff0c\u4f7f\u7528\u7684\u662f\u672c\u57309002\u7aef\u53e3</p> <p>\u76d1\u542c\u7aef\u53e3\u662f443\u3002\u5982\u679c\u542f\u7528\u4e86\u9632\u706b\u5899\uff0c\u8981\u8ba9\u9632\u706b\u5899\u5141\u8bb8\u8fd9\u4e2a\u7aef\u53e3\u3002 \u8f6c\u53d1\u5230\u4e0a\u9762\u5b9a\u4e49\u7684<code>talkwebsocket</code></p> <p><code>proxy_read_timeout 300s</code> \u8868\u793a\u8fde\u4e0a\u540e300\u79d2\u540e\u65e0\u6d88\u606f\u5219\u81ea\u52a8\u65ad\u5f00</p> <p>\u8d85\u65f6\u4f1a\u62a5 1006 Abnormal Closure</p> <p>\u8fd9\u6837Nginx\u914d\u7f6e\u5c31\u5f04\u597d\u4e86\u3002</p>","tags":["NestJS","Nginx"]},{"location":"nestjs/wss-nginx-cfg/#_2","title":"\u6d4b\u8bd5","text":"<p>\u7528postman\u6765\u6d4b\u8bd5\u9a8c\u8bc1</p> postman\u9a8c\u8bc1 <p>\u8bb0\u5f97\u8981\u9009\u62e9<code>Raw</code>\u7c7b\u578b</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u8fde\u63a5\u65f6\u95f4\u548c\u65ad\u5f00\u65f6\u95f4\uff0c\u76f8\u5dee300\u79d2</p> <p>\u6211\u4eec\u5e76\u6ca1\u6709\u914d\u7f6ews\u7684\u60c5\u51b5\uff0c\u5982\u679c\u7528postman\u5c1d\u8bd5\u8fde\u63a5ws\u5219\u4f1a\u62a5\u9519</p> postman \u8fde\u63a5ws\u60c5\u51b5 <p></p>","tags":["NestJS","Nginx"]},{"location":"nestjs/wss-nginx-cfg/#_3","title":"\u8de8\u57df\u95ee\u9898","text":"<p>\u5173\u4e8e\u8de8\u57df\u95ee\u9898\uff0c\u5982\u679c\u6211\u4eec\u5728\u670d\u52a1\u7684\u4ee3\u7801\u4e2d\u8fdb\u884c\u4e86\u914d\u7f6e\uff0cnginx\u8fd9\u8fb9\u662f\u4e0d\u9700\u8981\u989d\u5916\u914d\u7f6e\u7684\u3002</p> \u4e0d\u9700\u8981\u914d\u7f6e\u8de8\u57df\u4e86 <p>\u628a<code>add_header</code>\u76f8\u5173\u7684\u6ce8\u91ca\u6389</p> <pre><code>    location / {  \n        proxy_pass http://talkwebsocket;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"Upgrade\";\n        proxy_read_timeout 300s;\n\n#   add_header 'Access-Control-Allow-Origin' '*';\n#   add_header 'Access-Control-Allow-Credentials' 'true';\n#   add_header 'Access-Control-Allow-Methods' 'OPTION, POST, GET';\n#   add_header 'Access-Control-Allow-Headers' 'X-Requested-With, Content-Type';\n\n    }  \n</code></pre>","tags":["NestJS","Nginx"]},{"location":"nestjs/wss-nginx-cfg/#centos-nginx","title":"\u9644\u5f55 centos nginx","text":"<p>centos7\u4e0a\u914d\u7f6e\u4f7f\u7528nginx</p> <p>\u5148\u627e\u4e00\u4e0bnginx\u7684\u8def\u5f84 <pre><code>whereis nginx \n\nnginx: /usr/local/nginx\n</code></pre></p> <p>\u786e\u5b9anginx\u8def\u5f84\u4e3a<code>/usr/local/nginx/sbin</code></p> <p>\u7f16\u8f91 /etc/profile <pre><code>vim /etc/profile\n</code></pre></p> <p>\u6dfb\u52a0nginx\u7684\u8def\u5f84\u7ed9<code>PATH</code> <pre><code>export PATH=/usr/local/nginx/sbin:$PATH\n</code></pre></p>","tags":["NestJS","Nginx"]},{"location":"nestjs/simple-chat/create-nest-project/","title":"NestJS Simple Chat \u65b0\u5efa\u5de5\u7a0b","text":"\u66f4\u65b0\u65e5\u671f 2022-5-9 <ul> <li>2022-5-9 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u5f00\u53d1\u73af\u5883</p> <ul> <li>macOS 12.3.1</li> <li>nest 8.1.5</li> <li>postman 9.17.1</li> </ul> <p>\u672c\u6587\u76ee\u6807</p> <ul> <li>\u521b\u5efa\u4e00\u4e2a\u65b0\u7684nestjs\u5de5\u7a0b</li> <li>\u5efa\u7acbwebsocket\u670d\u52a1\u7aef</li> <li>\u638c\u63e1postman\u6d4b\u8bd5websocket\u7684\u65b9\u6cd5</li> </ul>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/create-nest-project/#_1","title":"\u521b\u5efa\u5de5\u7a0b","text":"<p>\u9996\u5148\u65b0\u5efa\u4e00\u4e2anest\u5de5\u7a0b<code>simple-chat</code>\uff0c\u9009\u62e9\u4f7f\u7528npm\u6765\u7ba1\u7406 <pre><code>nest new simple-chat\n</code></pre></p> <p>\u5de5\u7a0b\u9ed8\u8ba4\u76d1\u542c3000\u7aef\u53e3\uff0c\u6682\u65f6\u4e0d\u53bb\u4fee\u6539\u914d\u7f6e\u548c\u4ee3\u7801</p> <p>\u8fdb\u5165<code>simple-chat</code>\u76ee\u5f55\uff0c\u6267\u884c\u542f\u52a8\u547d\u4ee4 <pre><code>npm run start\n</code></pre></p> <p>\u670d\u52a1\u8fd0\u884c\u8d77\u6765\u4e86 <pre><code>&gt; simple-chat@0.0.1 start /Users/rustfisher/Desktop/ws/nest-sample/simple-chat\n&gt; nest start\n\nLOG [NestFactory] Starting Nest application...\nLOG [InstanceLoader] AppModule dependencies initialized +14ms\nLOG [RoutesResolver] AppController {/}: +29ms\nLOG [RouterExplorer] Mapped {/, GET} route +2ms\nLOG [NestApplication] Nest application successfully started +2ms\n</code></pre></p> <p>\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee http://localhost:3000/ \uff0c\u53ef\u4ee5\u770b\u5230 Hello World!</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/create-nest-project/#_2","title":"\u5b89\u88c5\u4f9d\u8d56","text":"<p>\u5b89\u88c5\u9700\u8981\u7684\u5305 <pre><code>npm i --save @nestjs/websockets @nestjs/platform-socket.io\n</code></pre></p> <p>\u5b89\u88c5\u5b8c\u6bd5 <pre><code>+ @nestjs/websockets@8.4.4\n+ @nestjs/platform-socket.io@8.4.4\n</code></pre></p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/create-nest-project/#gateway","title":"\u5efa\u7acbgateway","text":"<p>\u8f93\u5165<code>nest -h</code>\u67e5\u770b\u5e2e\u52a9\uff0c\u627e\u5230\u65b0\u5efagateway\u7684\u547d\u4ee4\uff0c\u6267\u884c\u547d\u4ee4\u65b0\u5efagateway <code>chat1</code> <pre><code>$ nest g gateway gateway/chat1\nCREATE src/gateway/chat1.gateway.spec.ts (453 bytes)\nCREATE src/gateway/chat1.gateway.ts (239 bytes)\nUPDATE src/app.module.ts (319 bytes)\n</code></pre></p> <p>\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u4f1a\u5728src/gateway\u76ee\u5f55\u4e0b\u5f97\u52302\u4e2a\u65b0\u6587\u4ef6 <pre><code>src/gateway/\n\u251c\u2500\u2500 chat1.gateway.spec.ts\n\u2514\u2500\u2500 chat1.gateway.ts\n</code></pre></p> <p>\u5e76\u4e14\u4f1a\u81ea\u52a8\u5728app.module.ts\u7684<code>providers</code>\u91cc\u6dfb\u52a0<code>Chat1Gateway</code> <pre><code>@Module({\n  imports: [],\n  controllers: [AppController],\n  providers: [AppService, Chat1Gateway],\n})\nexport class AppModule {}\n</code></pre></p> <p>\u4fee\u6539<code>Chat1Gateway</code>\u8ba9\u5b83\u8fd4\u56de\u4e00\u4e2a\u5bf9\u8c61 <pre><code>@WebSocketGateway()\nexport class Chat1Gateway {\n  @SubscribeMessage('message')\n  handleMessage(client: any, payload: any): any {\n    return {\n      event: 'message',\n      data: {\n        code: 1,\n        from: \"https://an.rustfisher.com\",\n        msg: \"\u670d\u52a1\u5668\u53d1\u56de\u6765\u7684\u6d88\u606f\"\n      }\n    };\n  }\n}\n</code></pre></p> <p>\u672c\u5730\u8fd0\u884c <pre><code>npm run start\n</code></pre></p> <p>\u670d\u52a1\u8fd0\u884c\u8d77\u6765\u4e86 <pre><code>[Nest] 3759  LOG [NestFactory] Starting Nest application...\n[Nest] 3759  LOG [InstanceLoader] AppModule dependencies initialized +39ms\n[Nest] 3759  LOG [WebSocketsController] Chat1Gateway subscribed to the \"message\" message +94ms\n[Nest] 3759  LOG [RoutesResolver] AppController {/}: +1ms\n[Nest] 3759  LOG [RouterExplorer] Mapped {/, GET} route +2ms\n[Nest] 3759  LOG [NestApplication] Nest application successfully started +1ms\n</code></pre> \u53ef\u4ee5\u770b\u5230\u91cc\u9762\u63d0\u5230<code>Chat1Gateway</code>\u6ce8\u518c\u4e86<code>\"message\"</code>\u6d88\u606f</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/create-nest-project/#3000websocket","title":"\u6d4b\u8bd5\u9a8c\u8bc13000\u7aef\u53e3\u7684websocket","text":"<p>\u6211\u4eec\u7528postman\u8fdb\u884c\u6d4b\u8bd5</p> <ul> <li>File - New - Websocket Request</li> <li>\u9009\u62e9Socket.IO</li> <li>\u8f93\u5165<code>localhost:3000</code>\uff0c\u70b9\u51fbconnect\u8fde\u63a5</li> <li>postman\u6dfb\u52a0\u6d88\u606f\u76d1\u542c\uff0c\u76d1\u542c<code>message</code></li> <li>\u7f16\u5199\u8981\u53d1\u9001\u7684\u4fe1\u606f\uff0c\u70b9\u51fb\u53d1\u9001</li> </ul> postman\u6d4b\u8bd5\u8fde\u63a5\u4e0e\u4f20\u8f93\u6d88\u606f <p></p> <p>\u6ce8\u610f\uff1a\u73b0\u5728\u8fd9\u4e2a\u7248\u672c\u7684postman\u9700\u8981\u624b\u52a8\u53bb\u6ce8\u518c\u76d1\u542c\u7684\u6d88\u606f</p> <p>Postman\u53d1\u9001\u7684\u6d88\u606f\u540d</p> <p>\u73b0\u5728\u8fd9\u4e2a\u7248\u672c\u7684postman\u9700\u8981\u624b\u52a8\u53bb\u6ce8\u518c\u76d1\u542c\u7684\u6d88\u606f</p> <p>event\u8981\u624b\u52a8\u5199\u5230\u53d1\u9001\u6309\u94ae\u300cSend\u300d\u5de6\u8fb9\u7684\u6846\u91cc\uff0c\u5426\u5219\u9ed8\u8ba4\u5c31\u662f\u300cmessage\u300d</p> <p>\u53d1\u9001\u6d88\u606f\u7ed9\u670d\u52a1\uff0c\u670d\u52a1\u4e5f\u8fd4\u56de\u4e86\u6d88\u606f\u3002</p> <p>\u6b64\u65f63000\u7aef\u53e3\u540c\u65f6\u63d0\u4f9b\u4e86http\u8bbf\u95ee\u548cwebsocket\u8bbf\u95ee</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/create-nest-project/#websocket","title":"\u6307\u5b9a\u7aef\u53e3websocket","text":"<p>\u8981\u6362\u4e00\u4e2awebsocket\u7684\u7aef\u53e3\uff0c\u53ef\u4ee5\u5728<code>@WebSocketGateway</code>\u4e2d\u6307\u5b9a <pre><code>@WebSocketGateway(3001)\nexport class Chat1Gateway {\n  @SubscribeMessage('message')\n  handleMessage(client: any, payload: any): any {\n    return {\n      event: 'message',\n      data: {\n        code: 1,\n        from: \"https://an.rustfisher.com\",\n        msg: \"\u670d\u52a1\u5668\u53d1\u56de\u6765\u7684\u6d88\u606f - 3001\"\n      }\n    };\n  }\n}\n</code></pre> \u4e0a\u9762\u5c31\u628a\u7aef\u53e3\u6307\u5b9a\u4e3a3001\u3002\u8fd0\u884c\u670d\u52a1\u518d\u8fdb\u884c\u8fde\u63a5\u6d4b\u8bd5\u5373\u53ef\u770b\u5230\u6548\u679c\u3002</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/create-nest-project/#websocket-path","title":"websocket path","text":"<p>\u524d\u9762\u6211\u4eec\u628awebsocket\u7684\u7aef\u53e3\u6307\u5b9a\u4e3a\u4e863001\uff0c\u73b0\u5728\u5220\u6389\u7aef\u53e3\u53f73001\uff0c\u7528\u9ed8\u8ba4\u7684\u3002</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/create-nest-project/#path","title":"\u914d\u7f6epath","text":"<p>\u518d\u5efa\u4e00\u4e2agateway <pre><code>nest g gateway gateway/chat2\n</code></pre> \u5f97\u5230chat2.gateway.ts</p> <p>\u4fee\u6539\u4e00\u4e0bchat2.gateway.ts <pre><code>@WebSocketGateway({ path: \"/chat2\" })\nexport class Chat2Gateway {\n  @SubscribeMessage('message')\n  handleMessage(client: any, payload: any): any {\n    return {\n      event: 'message',\n      data: {\n        code: 2,\n        from: \"https://rustfisher.com\",\n        msg: \"[chat2]\u670d\u52a1\u5668\u6d88\u606f\"\n      }\n    };\n  }\n}\n</code></pre> \u53ef\u4ee5\u770b\u5230\u6dfb\u52a0\u4e86\u4e00\u4e2a\u914d\u7f6e<code>path: \"/chat2\"</code></p> <p>\u518d\u4fee\u6539\u4e00\u4e0bchat1.gateway.ts <pre><code>@WebSocketGateway({ path: \"/chat1\" })\nexport class Chat1Gateway {\n  @SubscribeMessage('message')\n  handleMessage(client: any, payload: any): any {\n    return {\n      event: 'message',\n      data: {\n        code: 1,\n        from: \"https://an.rustfisher.com\",\n        msg: \"[chat1]\u670d\u52a1\u5668\u53d1\u56de\u6765\u7684\u6d88\u606f\"\n      }\n    };\n  }\n}\n</code></pre></p> <p>\u8fd92\u4e2agateway\u7528\u540c\u4e00\u4e2a\u7aef\u53e3\uff0c\u4f46\u662f\u6709\u4e0d\u540c\u7684path</p> <p>\u8fd0\u884c\u8d77\u6765 <pre><code>$ npm run start \n\n&gt; simple-chat@0.0.1 start /Users/rustfisher/Desktop/ws/nest-sample/simple-chat\n&gt; nest start\n\n[Nest] 6235  LOG [NestFactory] Starting Nest application...\n[Nest] 6235  LOG [InstanceLoader] AppModule dependencies initialized +17ms\n[Nest] 6235  LOG [WebSocketsController] Chat1Gateway subscribed to the \"message\" message +45ms\n[Nest] 6235  LOG [WebSocketsController] Chat2Gateway subscribed to the \"message\" message +1ms\n[Nest] 6235  LOG [RoutesResolver] AppController {/}: +1ms\n[Nest] 6235  LOG [RouterExplorer] Mapped {/, GET} route +2ms\n[Nest] 6235  LOG [NestApplication] Nest application successfully started +1ms\n</code></pre> \u53ef\u4ee5\u770b\u5230<code>Chat1Gateway</code>\u548c<code>Chat2Gateway</code>\u90fd\u6ce8\u518c\u4e86\u6d88\u606f</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/create-nest-project/#_3","title":"\u6d4b\u8bd5\u8fde\u63a5","text":"<p>\u540c\u6837\u7528postman\u8fdb\u884c\u6d4b\u8bd5</p> <p>postman\u9009\u7528\u300cSocket.IO\u300d\uff0c\u70b9\u51fb\u300cSetting\u300d\u9875\uff0c\u5c06Handshake path\u6539\u4e3a<code>/chat2</code></p> \u914d\u7f6epath\u4e3a/chat2 <p></p> <p>\u8fde\u63a5\u6d4b\u8bd5</p> chat2\u8fde\u63a5\u6d4b\u8bd5 <p></p> <p>\u540c\u7406\uff0c\u53ef\u4ee5\u53bb\u8fde\u63a5\u6d4b\u8bd5chat1</p> <p>\u8fd9\u4e2a\u914d\u7f6e\u9664\u4e86path\uff0c\u8fd8\u6709\u8de8\u57dfcors\u7b49\u7b49\uff0c\u540e\u9762\u6211\u4eec\u4f1a\u63a5\u89e6\u5230</p> <p>\u793a\u4f8b\u5de5\u7a0b nest-sample - gitee</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/deploy-on-server/","title":"SimpleChat \u90e8\u7f72NestJS\u670d\u52a1","text":"\u66f4\u65b0\u65e5\u671f 2022-8-19 <ul> <li>2022-8-19 \u66f4\u65b0\u8bf4\u660e</li> <li>2022-5-10 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u5f00\u53d1\u73af\u5883</p> <ul> <li>macOS 12.3.1</li> <li>Ubuntu 16.04</li> <li>nest 8.1.5</li> <li>pm2 4.4.1</li> </ul> <p>\u672c\u6587\u76ee\u6807</p> <p>\u5c06\u670d\u52a1\u90e8\u7f72\u5230\u670d\u52a1\u5668\u4e0a</p> <p>html\u4e2d\u8def\u5f84\u95ee\u9898</p> <p>\u5f53\u5fc3<code>/js/index.js</code>\u7684\u8def\u5f84\uff0c\u6700\u5f00\u5934\u90a3\u4e2a<code>/</code>\u4e0d\u80fd\u7701\u7565\u3002</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/deploy-on-server/#_1","title":"\u51c6\u5907","text":"<p>\u7533\u8bf7\u4e00\u4e2a\u57df\u540d\uff0c\u5e76\u4e14\u7533\u8bf7SSL\u8bc1\u4e66</p> <p>\u5c06\u5de5\u7a0b\u4f20\u5230\u670d\u52a1\u5668\u4e0a</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/deploy-on-server/#nginx","title":"Nginx","text":"<p>\u914d\u7f6enginx\uff0c\u5141\u8bb8wss</p> <pre><code>map $http_upgrade $connection_upgrade {\n    default upgrade;\n    '' close;\n}\n\nupstream chatws {\n    server 127.0.0.1:9010;\n}\n\nserver {\n    listen 443;\n    server_name antalkws.rustfisher.com;\n    ssl on;\n    ssl_certificate /home/ubuntu/server/ssl/antalk/antalkws.rustfisher.com_bundle.crt;\n    ssl_certificate_key /home/ubuntu/server/ssl/antalk/antalkws.rustfisher.com.key;\n    ssl_session_timeout 20m;\n    ssl_verify_client off;\n    location / {\n        root /home/ubuntu/server/wiki-site/an-rf-wiki;\n        index index.html index.htm;\n\n        proxy_pass http://127.0.0.1:9010;\n    }\n\n    location /chat1 {\n        proxy_pass http://chatws;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"Upgrade\";\n        proxy_read_timeout 300s;\n    }\n}\n</code></pre>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/deploy-on-server/#_2","title":"\u542f\u52a8","text":"<p>\u66f4\u65b0\u4ee3\u7801\u540e\uff0c\u5148install <pre><code>npm install\n</code></pre></p> <p>\u7136\u540e\u624b\u52a8\u542f\u52a8\uff0c\u6d4b\u8bd5\u4e00\u4e0b <pre><code>npm run start\n</code></pre></p> <p>\u6bcf\u6b21\u66f4\u65b0\u4ee3\u7801\u6700\u597d\u90fd\u8981\u5148<code>npm install</code></p> <p>\u8c03\u8bd5OK\u540e\uff0c\u4f7f\u7528pm2\u6765\u7ba1\u7406\u4efb\u52a1\u3002pm2 start\u542f\u52a8\u4efb\u52a1 <pre><code>pm2 start dist/main.js --name='simple-chat'\n</code></pre></p> <p>\u8bbf\u95ee https://antalkws.rustfisher.com/web/ \u53ef\u4ee5\u770b\u5230\u6548\u679c</p> <p>\u6ce8\uff1a\u670d\u52a1\u53ef\u80fd\u4e0d\u4f1a\u957f\u65f6\u95f4\u8fd0\u884c\uff0c\u4e0a\u9762\u94fe\u63a5\u6709\u53ef\u80fd\u5931\u6548</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/deploy-on-server/#_3","title":"\u7b80\u6613\u8fd0\u884c\u6548\u679c","text":"<p>\u672c\u9875\u9762\u5df2\u7ecf\u8fde\u63a5\u5230\u540e\u53f0\u670d\u52a1\uff0c\u53ef\u4ee5\u6253\u5f00\u591a\u4e2a\u6d4f\u89c8\u5668\u9875\u9762\u5c1d\u8bd5\u804a\u5929\u529f\u80fd\u3002</p> <p>\u70b9\u51fb<code>Connect</code>\u6309\u94ae\u53d1\u8d77\u8fde\u63a5\u3002</p> <p></p> Connect Leave Send","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/room-chat/","title":"NestJS Simple Chat - \u5206\u623f\uff08room\uff09\u53d1\u9001\u6d88\u606f","text":"\u66f4\u65b0\u65e5\u671f 2022-5-11 <ul> <li>2022-5-11 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883 <ul> <li>macOS 12.3.1</li> <li>Ubuntu 16.04</li> <li>nest 8.1.5</li> <li>pm2 4.4.1</li> </ul> <p>\u672c\u6587\u76ee\u7684</p> <ul> <li>NestJS\u63d0\u4f9bwss\u8fde\u63a5\u670d\u52a1</li> <li>\u5f15\u5165\u623f\u95f4\uff08room\uff09\u6982\u5ff5</li> <li>\u7528\u6237\u52a0\u5165\u623f\u95f4\u540e\uff0c\u6536\u53d1\u540c\u4e00\u4e2a\u623f\u95f4\u5185\u7684\u6d88\u606f</li> </ul> <p>\u4e3b\u8981\u4f7f\u7528\u7684\u8fd8\u662fsocketio\u7684\u529f\u80fd</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/room-chat/#gateway","title":"gateway","text":"<p>\u4f7f\u7528\u4e4b\u524d\u521b\u5efa\u7684\u6216\u8005\u518d\u65b0\u5efa\u4e00\u4e2a<code>Chat2Gateway</code> <pre><code>$ nest g gateway chat/chat2\n</code></pre></p> <p>\u8981\u52a0\u5165\u67d0\u4e2a\u623f\u95f4\uff08room\uff09\uff0c\u4f7f\u7528join\u65b9\u6cd5 <pre><code>socket.join(payload.room);\n</code></pre></p> <p>\u63a5\u6536\u6d88\u606f\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u62ff\u5230socket <pre><code>onJoin(socket: Socket, payload: any)\n</code></pre></p> <p>\u8fd9\u91cc\u7684socket\u7528\u7684\u662f<code>socket.io</code>\u91cc\u7684 <pre><code>import { Socket } from 'socket.io';\n</code></pre></p> <p>\u670d\u52a1\u5bf9\u67d0\u4e2aroom\u8fdb\u884c\u7fa4\u53d1\u6d88\u606f\uff0c\u53ef\u4ee5\u7528<code>to</code>\u6307\u5b9a\u623f\u95f4 <pre><code>this.server.to(payload.room).emit('allMsg', payload);\n</code></pre></p> <p><code>Chat2Gateway</code>\u5b8c\u6574\u4ee3\u7801 <pre><code>import { Logger } from '@nestjs/common';\nimport { OnGatewayInit, SubscribeMessage, WebSocketGateway, WebSocketServer } from '@nestjs/websockets';\nimport { Socket } from 'socket.io';\n\nconst opt2 = {\n  path: '/chat2',\n  allowEIO3: true,\n  cors: {\n    origin: /.*/,\n    credentials: true\n  }\n};\n\n@WebSocketGateway(opt2)\nexport class Chat2Gateway implements OnGatewayInit {\n  private logger: Logger = new Logger('Chat1Gateway');\n\n  @WebSocketServer()\n  server: any;\n\n  afterInit(server: any) {\n    this.server = server;\n  }\n\n  @SubscribeMessage('join')\n  onJoin(socket: Socket, payload: any): any {\n    socket.join(payload.room);\n    this.server.to(payload.room).emit('allMsg', payload);\n  }\n\n  @SubscribeMessage('message')\n  handleMessage(client: any, payload: any): any {\n    return {\n      event: 'message',\n      data: { code: 1, msg: \"[chat2]\u670d\u52a1 https://an.rustfisher.com\" }\n    };\n  }\n\n  @SubscribeMessage('m2s')\n  onChatMsg(client: any, payload: any): any {\n    this.logger.log(payload);\n    var uid: String = payload.uid;\n    var roomId = payload.room;\n    if (uid != null &amp;&amp; uid.length &gt; 0) {\n      this.server.to(roomId).emit('allMsg', payload);\n    } else {\n      this.logger.warn('[m2s] \u7528\u6237\u8f93\u5165uid\u65e0\u6548');\n    }\n  }\n}\n</code></pre></p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/room-chat/#_1","title":"\u5ba2\u6237\u7aef\uff08\u7f51\u9875\uff09","text":"","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/room-chat/#html","title":"html","text":"<p>\u5148\u6765\u8c03\u6574\u4e00\u4e0bhtml\uff0c\u589e\u52a0\u4e00\u4e9b\u63a7\u4ef6\u3002\u7528\u6237\u53ef\u4ee5\u8f93\u5165room\u7684id\u3002 <pre><code>&lt;!DOCTYPE html&gt;\n\n&lt;html&gt;\n\n&lt;head&gt;\n    &lt;meta charset=\"utf-8\" /&gt;\n    &lt;title&gt;Chat - an.rustfisher.com&lt;/title&gt;\n\n    &lt;link rel=\"stylesheet\" href=\"/css/md.css\" /&gt;\n    &lt;script src=\"https://lib.baomitu.com/socket.io/4.4.1/socket.io.min.js\"\n        crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n\n&lt;body&gt;\n\n    &lt;h1&gt;\u5206\u623f\u6d4b\u8bd5\u8fde\u63a5&lt;/h1&gt;\n    &lt;p&gt;\u8f93\u5165\u6635\u79f0\u548cRoom\u540e\u518d\u8fdb\u884c\u8fde\u63a5&lt;/p&gt;\n    &lt;div&gt;\n        &lt;label style=\"width: 200px;\"&gt;\u6635\u79f0&lt;/label&gt;\n        &lt;input id=\"user-nickname\"&gt;&lt;/input&gt;\n    &lt;/div&gt;\n    &lt;div&gt;\n        &lt;label&gt;Room&lt;/label&gt;\n        &lt;input id=\"room\"&gt;&lt;/input&gt;\n    &lt;/div&gt;\n    &lt;p&gt;\n        &lt;button class=\"btn\" id=\"connect\"&gt;Connect&lt;/button&gt;\n        &lt;button class=\"btn\" id=\"leave\"&gt;Leave&lt;/button&gt;\n    &lt;/p&gt;\n    &lt;div&gt;\n        &lt;input placeholder=\"\u8f93\u5165\u6d88\u606f\" id=\"user-input\"&gt;&lt;/input&gt;\n        &lt;button class=\"btn\" id=\"send\"&gt;Send&lt;/button&gt;\n    &lt;/div&gt;\n\n    &lt;ul id=\"msg-list\"&gt;\n\n    &lt;/ul&gt;\n\n    &lt;script src=\"/js/chatroom.js\"&gt;&lt;/script&gt;\n\n&lt;/body&gt;\n\n&lt;/html&gt;\n</code></pre> \u6ce8\u610f\uff0chtml\u662f\u7528\u9759\u6001\u6587\u4ef6\u7684\u65b9\u5f0f\u6765\u63d0\u4f9b\u7684\u3002</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/room-chat/#css","title":"css","text":"<p>\u589e\u52a0\u4e00\u4e9b\u6837\u5f0f</p> css <pre><code>.btn {\n    background-color: #225ece;\n    border: none;\n    border-radius: 2px;\n    color: white;\n    font-family: 'Roboto', sans-serif;\n    font-size: 0.8em;\n    margin: 0 0 1em 0;\n    padding: 0.5em 0.7em 0.6em 0.7em;\n}\n\n.btn:active {\n    background-color: #225ece;\n}\n\n.btn:hover {\n    background-color: #4372ca;\n}\n\n.btn[disabled] {\n    color: #ccc;\n}\n\n.btn[disabled]:hover {\n    background-color: #d84a38;\n}\n\nvideo {\n    background: #222;\n    margin: 0 0 20px 0;\n    --width: 100%;\n    width: var(--width);\n    height: calc(var(--width) * 0.75);\n}\n\ndiv#errorMsg p {\n    color: #F00;\n    font-size: small;\n}\n\ndiv#tipMsg p {\n    color: rgb(54, 54, 54);\n    font-size: small;\n}\n\ninput {\n    color: #4372ca;\n}\n\nul {\n    max-height: 200px;\n    overflow: auto;\n}\n\nli {\n    font-size: .3em;\n}\n</code></pre>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/room-chat/#js","title":"js","text":"<p>\u8fde\u63a5\u4e0a\u540e\uff0c\u628aroom\u4f20\u7ed9\u670d\u52a1\u5668\u3002 <pre><code>'use strict';\n\nvar btnConn = document.querySelector('button#connect');\nvar btnLeave = document.querySelector('button#leave');\nvar btnSend = document.querySelector('button#send');\nvar userNicknameInput = document.querySelector('input#user-nickname');\nvar userInput = document.querySelector('input#user-input');\nvar roomIdInput = document.querySelector('input#room');\nvar msgList = document.querySelector('ul#msg-list');\n\nvar socket = null; // \u8fde\u63a5\nvar uid = null;\nvar nickname = \"RustFisher\"; // \u6635\u79f0\nvar roomId = \"tmp-room1\";\n\nvar nameList = [\"\u4eba\u53c2\", \"\u535c\u82a5\", \"\u513f\u8336\", \"\u516b\u89d2\", \"\u4e01\u9999\", \"\u5200\u8c46\", \"\u4e09\u4e03\", \"\u5927\u84df\", \"\u5c71\u836f\", \"\u5ddd\u4e4c\", \"\u5929\u51ac\", \"\u5929\u9ebb\", \"\u5143\u80e1\"];\nvar nameIndex = Math.floor(Math.random() * nameList.length);\nnickname = nameList[nameIndex]; // \u968f\u673a\u6635\u79f0\nuserNicknameInput.value = nickname;\n\n// \u83b7\u53d6\u6d4f\u89c8\u5668\u6307\u7eb9\nconst fpPromise = import('https://openfpcdn.io/fingerprintjs/v3')\n    .then(FingerprintJS =&gt; FingerprintJS.load())\n\n// Get the visitor identifier when you need it.\nfpPromise\n    .then(fp =&gt; fp.get())\n    .then(result =&gt; {\n        // This is the visitor identifier:\n        uid = result.visitorId\n        const visitorId = result.visitorId\n        console.log(visitorId)\n    })\n\nfunction addMsgToList(type, msgBody) {\n    var li = document.createElement(\"li\");\n    li.setAttribute(\"id\", \"newli\");\n    if (type == 0) {\n        li.innerHTML = msgBody;\n    } else if (type == 1) {\n        li.innerHTML = msgBody.nickname + \": \" + msgBody.msg;\n    }\n    msgList.appendChild(li);\n}\n\n// \u53d1\u8d77\u8fde\u63a5\nfunction conn() {\n    if (uid == null) {\n        console.error('\u65e0\u6cd5\u8fde\u63a5\uff0c\u8fd8\u6ca1\u83b7\u53d6\u5230uid');\n        return;\n    }\n    console.log('try connect');\n\n    const wssUrl = \"wss://antalkws.rustfisher.com\" // release\n    socket = io(wssUrl, { path: '/chat2' });\n\n    socket.on('connect', function () {\n        console.log('\u8fde\u63a5\u6210\u529f');// \u8fde\u63a5\u72b6\u6001 \u8fde\u4e0a\n        addMsgToList(0, '\u8fde\u63a5\u6210\u529f');\n    });\n\n    socket.on('disconnect', (socket) =&gt; {\n        console.log('socket\u5df2\u65ad\u5f00', socket);// \u8fde\u63a5\u72b6\u6001 \u5df2\u65ad\u5f00\n        socket = null;\n    });\n\n    socket.on('debug', (data) =&gt; {\n        console.log('[\u670d\u52a1\u5668\u6d88\u606f][debug], ', data);\n    });\n\n    socket.on('allMsg', (data) =&gt; {\n        console.log('[\u670d\u52a1\u5668\u6d88\u606f][allMsg], ', data);\n        addMsgToList(1, data);\n    });\n\n    socket.emit('join', {\n        uid: uid, nickname: userNicknameInput.value, room: getLocalRoomId(),\n        msg: '\u52a0\u5165\u623f\u95f4'\n    });\n    return true;\n}\n\nfunction disconnect() {\n    if (socket) {\n        socket.disconnect();\n    }\n}\n\nfunction getLocalRoomId() {\n    roomId = roomIdInput.value;\n    if (roomId == null || roomId.length == 0) {\n        console.warn('\u8d70\u9ed8\u8ba4room');\n        roomId = 'tmp-room1';\n    }\n    return roomId;\n}\n\nfunction sendMsg() {\n    var input = userInput.value;\n    roomId = roomIdInput.value;\n    if (input == null || input.length == 0) {\n        console.warn('\u8bf7\u8f93\u5165\u6587\u672c');\n        return;\n    }\n    if (roomId == null || roomId.length == 0) {\n        console.warn('\u8d70\u9ed8\u8ba4room');\n        roomId = 'tmp-room1';\n    }\n    if (socket) {\n        socket.emit('m2s',\n            {\n                uid: uid,\n                nickname: userNicknameInput.value,\n                room: roomId,\n                msg: input\n            });\n    }\n}\n\nbtnConn.onclick = conn;\nbtnLeave.onclick = disconnect;\nbtnSend.onclick = sendMsg;\n</code></pre></p> <p>\u6700\u540e\u90e8\u7f72\u8fd0\u884c\u5230\u670d\u52a1\u5668\u4e0a</p> <p>\u793a\u4f8b\u5de5\u7a0b nest-sample - gitee</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/room-chat/#_2","title":"\u53c2\u8003","text":"<p>\u5efa\u8bae\u8be6\u7ec6\u8bfb\u4e00\u4e0bsocket.io\u7684\u6587\u6863 https://socket.io/docs/v4/emit-cheatsheet/ \uff0c\u91cd\u70b9\u770bEvents\u90e8\u5206</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/transfer-msg-local/","title":"\u672c\u5730\u670d\u52a1\u6d88\u606f\u7fa4\u53d1","text":"\u66f4\u65b0\u65e5\u671f 2022-5-19 <ul> <li>2022-5-19 \u66f4\u65b0\u683c\u5f0f</li> <li>2022-5-10 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u5f00\u53d1\u73af\u5883</p> <ul> <li>macOS 12.3.1</li> <li>nest 8.1.5</li> </ul> <p>\u672c\u6587\u76ee\u6807</p> <ul> <li> NestJS\u80fd\u505a\u5230\u7fa4\u53d1\u6d88\u606f</li> <li> \u7b80\u5355html\u754c\u9762\u63a7\u5236\u53d1\u9001\u548c\u663e\u793a\u63a5\u6536\u7684\u6d88\u606f</li> </ul> <p>\u5c06\u5ba2\u6237\u7aef\uff08\u7f51\u9875\uff09\u53d1\u6765\u7684\u6d88\u606f\u8f6c\u53d1\u5230\u5176\u5b83\u5df2\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u3002</p> <p>\u672c\u5730\u670d\u52a1\u6307\u7684\u662f\u5728\u672c\u673a\u4e0a\u8fd0\u884c\u670d\u52a1\u3002\u8fd8\u6ca1\u6709\u5c06\u670d\u52a1\u90e8\u7f72\u5230\u670d\u52a1\u5668\u4e0a\u3002</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/transfer-msg-local/#gateway","title":"gateway","text":"<p>\u6211\u4eec\u7ee7\u7eed\u6539\u9020<code>Chat1Gateway</code></p> <p>\u9996\u5148\u6dfb\u52a0\u5bf9\u72b6\u6001\u7684\u76d1\u542c\uff1a<code>OnGatewayInit</code>\uff0c <code>OnGatewayConnection</code>\uff0c <code>OnGatewayDisconnect</code></p> <p><pre><code>import { OnGatewayConnection, OnGatewayDisconnect, OnGatewayInit, SubscribeMessage, WebSocketGateway, WebSocketServer } from '@nestjs/websockets';\nimport { Logger } from '@nestjs/common';\n\n@WebSocketGateway(opt1)\nexport class Chat1Gateway implements OnGatewayInit, OnGatewayConnection, OnGatewayDisconnect {\n  private logger: Logger = new Logger('Chat1Gateway');\n  @WebSocketServer()\n  server: any;\n\n  afterInit(server: any) {\n    this.server = server;\n  }\n\n  handleConnection(client: any, ...args: any[]) {\n    this.logger.log('\u65b0\u8fde\u63a5', args);\n  }\n\n  handleDisconnect(client: any) {\n    this.logger.log('\u65ad\u5f00\u4e86\u8fde\u63a5', client);\n  }\n  // ...\n}\n</code></pre> \u5728<code>afterInit</code>\u4e2d\uff0c\u6211\u4eec\u83b7\u53d6<code>@WebSocketServer()</code>\u5bf9\u8c61\uff0c\u540e\u9762\u7528\u6765\u7fa4\u53d1\u6d88\u606f\u3002</p> <p>\u76d1\u542c<code>m2s</code>\u4e8b\u4ef6\uff0c\u7a0d\u5fae\u5224\u65ad\u4e00\u4e0b\u53d1\u6765\u7684\u6d88\u606f\uff0c\u7136\u540e\u5c06\u6d88\u606f\u7fa4\u53d1\u51fa\u53bb\u3002 <pre><code>  @SubscribeMessage('m2s')\n  onChatMsg(client: any, payload: any): any { // \u7528\u6237\u53d1\u6765\u7684\u6d88\u606f \u76f4\u63a5\u8f6c\u53d1\n    var uid: String = payload.uid;\n    if (uid != null &amp;&amp; uid.length &gt; 0) { // (1)\n      this.server.emit('allMsg', payload);\n    }\n  }\n</code></pre></p> <ol> <li>\u8fd9\u91cc\u5bf9uid\u8fdb\u884c\u4e00\u4e2a\u7b80\u5355\u5224\u65ad\uff0c\u5177\u4f53\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u6765\u6539</li> </ol> <p>\u7fa4\u53d1\u6d88\u606f\uff0c\u4f7f\u7528server\u7684<code>emit</code>\u65b9\u6cd5 <pre><code>this.server.emit('allMsg', payload);\n</code></pre></p> Chat1Gateway\u5b8c\u6574\u4ee3\u7801 <pre><code>import { OnGatewayConnection, OnGatewayDisconnect, OnGatewayInit, SubscribeMessage, WebSocketGateway, WebSocketServer } from '@nestjs/websockets';\nimport { Logger } from '@nestjs/common';\n\nconst opt1 = {\n    path: '/chat1',\n    allowEIO3: true,\n    cors: {\n        origin: /.*/,\n        credentials: true\n    }\n};\n\n@WebSocketGateway(opt1)\nexport class Chat1Gateway implements OnGatewayInit, OnGatewayConnection, OnGatewayDisconnect {\nprivate logger: Logger = new Logger('Chat1Gateway');\n\n@WebSocketServer()\nserver: any;\n\nafterInit(server: any) {\n    this.server = server;\n}\n\nhandleConnection(client: any, ...args: any[]) {\n    this.logger.log('\u65b0\u8fde\u63a5', args);\n}\n\nhandleDisconnect(client: any) {\n    this.logger.log('\u65ad\u5f00\u4e86\u8fde\u63a5', client);\n}\n\n@SubscribeMessage('debug')\nhandleMessage(client: any, payload: any): any { // \u7528\u6765\u6d4b\u8bd5\n    this.logger.log('[debug]', payload);\n    return {\n    event: 'debug an.rustfisher.com',\n    data: payload\n    };\n}\n\n@SubscribeMessage('m2s')\nonChatMsg(client: any, payload: any): any { // \u7528\u6237\u53d1\u6765\u7684\u6d88\u606f \u76f4\u63a5\u8f6c\u53d1\n        var uid: String = payload.uid;\n        if (uid != null &amp;&amp; uid.length &gt; 0) {\n        this.server.emit('allMsg', payload);\n        }\n    }\n}\n</code></pre>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/transfer-msg-local/#web","title":"web","text":"<p>\u4fee\u6539\u4e4b\u524d\u7684\u9875\u9762\uff0c\u589e\u52a0\u4e00\u4e9b\u63a7\u4ef6</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/transfer-msg-local/#html","title":"html","text":"<p>\u52a0\u51652\u4e2a<code>input</code>\uff0c\u7528\u6765\u8f93\u5165\u7528\u6237\u6635\u79f0\u548c\u6d88\u606f\u3002 \u6536\u5230\u7684\u6d88\u606f\u653e\u5728<code>msg-list</code>\u3002 <pre><code>&lt;!DOCTYPE html&gt;\n\n&lt;html&gt;\n\n&lt;head&gt;\n    &lt;meta charset=\"utf-8\" /&gt;\n    &lt;title&gt;Chat - an.rustfisher.com&lt;/title&gt;\n\n    &lt;link rel=\"stylesheet\" href=\"/css/main.css\" /&gt;\n    &lt;script src=\"https://cdn.socket.io/4.5.0/socket.io.min.js\"\n        integrity=\"sha384-7EyYLQZgWBi67fBtVxw60/OWl1kjsfrPFcaU0pp0nAh+i8FD068QogUvg85Ewy1k\"\n        crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n\n&lt;body&gt;\n\n    &lt;h1&gt;\u6d4b\u8bd5\u8fde\u63a5&lt;/h1&gt;\n\n    &lt;div&gt;\n        &lt;button id=\"connect\"&gt;Connect&lt;/button&gt;\n        &lt;button id=\"leave\"&gt;Leave&lt;/button&gt;\n    &lt;/div&gt;\n\n    &lt;div&gt;\n        &lt;input id=\"user-nickname\"&gt;&lt;/input&gt;\n        &lt;input id=\"user-input\"&gt;&lt;/input&gt;\n        &lt;button id=\"send\"&gt;Send&lt;/button&gt;\n    &lt;/div&gt;\n\n    &lt;ul id=\"msg-list\"&gt;\n\n    &lt;/ul&gt;\n\n\n    &lt;script src=\"/js/index.js\"&gt;&lt;/script&gt;\n\n&lt;/body&gt;\n\n&lt;/html&gt;\n</code></pre></p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/transfer-msg-local/#js","title":"js","text":"<p>index.js\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b</p> <pre><code>'use strict';\n\nvar btnConn = document.querySelector('button#connect');\nvar btnLeave = document.querySelector('button#leave');\nvar btnSend = document.querySelector('button#send');\nvar userNicknameInput = document.querySelector('input#user-nickname');\nvar userInput = document.querySelector('input#user-input');\nvar msgList = document.querySelector('ul#msg-list');\n\nvar socket = null; // \u8fde\u63a5\nvar uid = null;\nvar nickname = \"RustFisher\"; // \u6635\u79f0\n\nvar nameList = [\"\u4eba\u53c2\", \"\u535c\u82a5\", \"\u513f\u8336\", \"\u516b\u89d2\", \"\u4e01\u9999\", \"\u5200\u8c46\", \"\u4e09\u4e03\", \"\u5927\u84df\", \"\u5c71\u836f\", \"\u5ddd\u4e4c\", \"\u5929\u51ac\", \"\u5929\u9ebb\", \"\u5143\u80e1\"];\nvar nameIndex = Math.floor(Math.random() * nameList.length);\nnickname = nameList[nameIndex]; // \u968f\u673a\u6635\u79f0\nuserNicknameInput.value = nickname;\n\n// \u83b7\u53d6\u6d4f\u89c8\u5668\u6307\u7eb9\nconst fpPromise = import('https://openfpcdn.io/fingerprintjs/v3')\n    .then(FingerprintJS =&gt; FingerprintJS.load())\n\n// Get the visitor identifier when you need it.\nfpPromise\n    .then(fp =&gt; fp.get())\n    .then(result =&gt; {\n        // This is the visitor identifier:\n        uid = result.visitorId\n        const visitorId = result.visitorId\n        console.log(visitorId)\n    })\n\nfunction addMsgToList(type, msgBody) {\n    var li = document.createElement(\"li\");\n    li.setAttribute(\"id\", \"newli\");\n    if (type == 0) {\n        li.innerHTML = msgBody;\n    } else if (type == 1) {\n        li.innerHTML = msgBody.nickname + \": \" + msgBody.msg;\n    }\n    msgList.appendChild(li);\n}\n\n// \u53d1\u8d77\u8fde\u63a5\nfunction conn() {\n    if (uid == null) {\n        console.error('\u65e0\u6cd5\u8fde\u63a5\uff0c\u8fd8\u6ca1\u83b7\u53d6\u5230uid');\n        return;\n    }\n    console.log('try connect');\n\n    const wssUrl = \"http://localhost:3000\"; // localhost debug\n\n    socket = io(wssUrl, { path: '/chat1' });\n\n    socket.on('connect', function () {\n        console.log('\u8fde\u63a5\u6210\u529f');// \u8fde\u63a5\u72b6\u6001 \u8fde\u4e0a\n        addMsgToList(0, '\u8fde\u63a5\u6210\u529f');\n    });\n\n    socket.on('disconnect', (socket) =&gt; {\n        console.log('socket\u5df2\u65ad\u5f00', socket);// \u8fde\u63a5\u72b6\u6001 \u5df2\u65ad\u5f00\n        socket = null;\n    });\n\n    socket.on('debug', (data) =&gt; {\n        console.log('[\u670d\u52a1\u5668\u6d88\u606f][debug], ', data);\n    });\n\n    socket.on('allMsg', (data) =&gt; {\n        console.log('[\u670d\u52a1\u5668\u6d88\u606f][allMsg], ', data);\n        addMsgToList(1, data);\n    });\n\n    socket.emit('debug', { uid: uid, msg: \"web\u8fde\u63a5\" });\n    return true;\n}\n\nfunction disconnect() {\n    if (socket) {\n        socket.disconnect();\n    }\n}\n\nfunction sendMsg() {\n    var input = userInput.value;\n    if (input == null || input.length == 0) {\n        console.warn('\u8bf7\u8f93\u5165\u6587\u672c');\n        return;\n    }\n    if (socket) {\n        socket.emit('m2s',\n            {\n                uid: uid,\n                nickname: userNicknameInput.value,\n                msg: input\n            });\n    }\n}\n\nbtnConn.onclick = conn;\nbtnLeave.onclick = disconnect;\nbtnSend.onclick = sendMsg;\n</code></pre> <p>\u7528<code>FingerprintJS</code>\u6765\u83b7\u53d6\u6d4f\u89c8\u5668\u7684\u4fe1\u606f\u3002\u53ef\u968f\u673a\u4ea7\u751f\u4e00\u4e9b\u9ed8\u8ba4\u7684\u6635\u79f0\uff0c\u4e5f\u53ef\u4ee5\u7531\u7528\u6237\u6765\u8f93\u5165\u3002</p> <p>\u6536\u5230\u670d\u52a1\u5668\u6d88\u606f\u540e\uff0c\u7528<code>document.createElement</code>\u65b9\u5f0f\u6dfb\u52a0\u5230\u5217\u8868\u4e2d\u3002</p> <p>\u4e00\u4e9b\u8fde\u63a5\u72b6\u6001\u4fe1\u606f\u4e5f\u6dfb\u52a0\u5230\u4e86\u6d88\u606f\u5217\u8868\u4e2d\u3002</p> <p>\u53d1\u9001\u6d88\u606f\u65f6\uff0c\u7528<code>emit</code>\u65b9\u6cd5\uff0c\u628auid\uff0cnickname\uff0cmsg\u90fd\u4f20\u4e0a\u53bb\u3002</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/transfer-msg-local/#_2","title":"\u6d4b\u8bd5\u8fd0\u884c","text":"<p>\u8fd0\u884cNestJS\u670d\u52a1\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u75282\u4e2a\u6d4f\u89c8\u5668\u6216\u80052\u4e2a\u9875\u9762\uff0c\u76f4\u63a5\u6253\u5f00index.html\uff0c\u70b9\u51fbconnect\u8fde\u63a5\u3002</p> <p>\u7136\u540e\u8f93\u5165\u8981\u53d1\u9001\u7684\u6d88\u606f\uff0c\u5728\u5176\u4ed6\u9875\u9762\u4e0a\u53ef\u4ee5\u770b\u5230\u6548\u679c\u3002</p> <p>\u8425\u9020\u51fa\u4e00\u79cd\u7c7b\u4f3c\u591a\u4eba\u804a\u5929\u5ba4\u7684\u611f\u89c9\u3002</p> \u7f51\u9875\u6548\u679c <p></p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/transfer-msg-local/#_3","title":"\u53c2\u8003","text":"<ul> <li>nestjs gateway\u7ed9\u6240\u6709socket\u53d1\u9001\u6d88\u606f - stackoverflow</li> </ul> <p>\u793a\u4f8b\u5de5\u7a0b nest-sample - gitee</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/web-connect-local/","title":"\u65b0\u5efa\u9875\u9762\uff0c\u5efa\u7acbwebsocket\u8fde\u63a5","text":"\u66f4\u65b0\u65e5\u671f 2022-5-9 <ul> <li>2022-5-9 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u5f00\u53d1\u73af\u5883</p> <ul> <li>macOS 12.3.1</li> <li>nest 8.1.5</li> <li>postman 9.17.1</li> </ul> <p>\u672c\u6587\u76ee\u6807</p> <ul> <li>\u65b0\u5efa\u7f51\u9875\uff0cnestjs\u63d0\u4f9b\u9759\u6001\u8d44\u6e90\u652f\u6301</li> <li>Web\u5efa\u7acbwebsocket\u8fde\u63a5</li> <li>\u7b80\u5355\u5904\u7406\u8de8\u57df\u95ee\u9898</li> </ul>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/web-connect-local/#_1","title":"\u9759\u6001\u9875\u9762","text":"<p>\u9996\u5148\u6211\u4eec\u8ba9NestJS\u63d0\u4f9b\u9759\u6001\u9875\u9762\u652f\u6301</p> <p>\u5728\u5de5\u7a0b\u4e2d\u65b0\u5efa\u4e00\u4e2a<code>web/index.html</code> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n\n&lt;head&gt;\n    &lt;meta charset=\"utf-8\" /&gt;\n    &lt;title&gt;Chat - an.rustfisher.com&lt;/title&gt;\n\n    &lt;link rel=\"stylesheet\" href=\"/css/main.css\" /&gt;\n\n&lt;/head&gt;\n\n&lt;body&gt;\n\n    &lt;h1&gt;\u6d4b\u8bd5\u8fde\u63a5&lt;/h1&gt;\n\n    &lt;div&gt;\n        &lt;button id=\"connect\"&gt;Connect&lt;/button&gt;\n        &lt;button id=\"leave\"&gt;Leave&lt;/button&gt;\n        &lt;button id=\"send\"&gt;Send&lt;/button&gt;\n    &lt;/div&gt;\n\n    &lt;script src=\"https://cdn.socket.io/4.5.0/socket.io.min.js\"\n        integrity=\"sha384-7EyYLQZgWBi67fBtVxw60/OWl1kjsfrPFcaU0pp0nAh+i8FD068QogUvg85Ewy1k\"\n        crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n    &lt;script src=\"/js/index.js\"&gt;&lt;/script&gt;\n\n&lt;/body&gt;\n\n&lt;/html&gt;\n</code></pre> \u73b0\u5728\u7f51\u9875\u4e0a\u7684\u63a7\u4ef6\u90fd\u6ca1\u6709\u7528\u3002\u53ea\u662f\u5c55\u793a\u3002</p> <p>\u56de\u5230\u9879\u76ee\u4e2d\uff0c\u9996\u5148\u6211\u4eec\u9700\u8981\u5b89\u88c5<code>@nestjs/serve-static</code>\u5305\u3002</p> <p>\u5728\u5de5\u7a0b\u8def\u5f84\u4e0b <pre><code>$ npm install --save @nestjs/serve-static\n</code></pre></p> <p>\u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u5de5\u7a0b\u7684package.json\u91cc\u4f1a\u591a\u51fa <pre><code>\"dependencies\": {\n  \"@nestjs/serve-static\": \"^2.2.2\",\n}\n</code></pre></p> <p>app.module.ts\u91cc\uff0c\u7ed9<code>imports</code>\u52a0\u5165\u914d\u7f6e\uff0c\u6307\u5b9a\u7f51\u9875\u6240\u5728\u7684\u76ee\u5f55 <pre><code>// app.module.ts\nimport { Module } from '@nestjs/common';\nimport { ServeStaticModule } from '@nestjs/serve-static';\nimport { join } from 'path';\nimport { AppController } from './app.controller';\nimport { AppService } from './app.service';\nimport { Chat1Gateway } from './gateway/chat1.gateway';\nimport { Chat2Gateway } from './gateway/chat2.gateway';\n\n@Module({\n  imports: [ServeStaticModule.forRoot({\n    rootPath: join(__dirname, '..', 'web'),\n    exclude: ['/api*'],\n  }),],\n  controllers: [AppController],\n  providers: [AppService, Chat1Gateway, Chat2Gateway],\n})\nexport class AppModule { }\n</code></pre> \u5de5\u7a0b\u4f7f\u7528\u7684\u662f3000\u7aef\u53e3\u3002</p> <p>\u8fd0\u884c\u5de5\u7a0b\uff0c\u6d4f\u89c8\u5668\u6253\u5f00 http://localhost:3000/web \u53ef\u4ee5\u770b\u5230\u6211\u4eec\u65b0\u5efa\u7684\u9875\u9762</p> <p>\u81f3\u6b64\u6211\u4eec\u7684\u5de5\u7a0b\u53ef\u4ee5\u63d0\u4f9b\u9759\u6001\u8d44\u6e90\u3002</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/web-connect-local/#_2","title":"\u5efa\u7acb\u8fde\u63a5","text":"<p>\u5148\u6539\u9020\u4e00\u4e0b<code>Chat1Gateway</code>\uff0c\u8ba9\u5b83\u8fd4\u56de\u5ba2\u6237\u7aef\u53d1\u6765\u7684payload\uff0c\u539f\u5c01\u4e0d\u52a8\u4f20\u56de\u53bb <pre><code>@WebSocketGateway({ path: \"/chat1\" })\nexport class Chat1Gateway {\n  @SubscribeMessage('message')\n  handleMessage(client: any, payload: any): any {\n    return {\n      event: 'message',\n      data: {\n        code: 1,\n        from: \"https://an.rustfisher.com\",\n        msg: \"[chat1]\u670d\u52a1\u5668\u53d1\u56de\u6765\u7684\u6d88\u606f\",\n        p: payload\n      }\n    };\n  }\n}\n</code></pre></p> <p><code>index.html</code>\u91cc\u589e\u52a0socket.io <pre><code>    &lt;script src=\"https://cdn.socket.io/4.5.0/socket.io.min.js\"\n        integrity=\"sha384-7EyYLQZgWBi67fBtVxw60/OWl1kjsfrPFcaU0pp0nAh+i8FD068QogUvg85Ewy1k\"\n        crossorigin=\"anonymous\"&gt;&lt;/script&gt;\n    &lt;script src=\"js/index.js\"&gt;&lt;/script&gt;\n</code></pre></p> <p>\u65b0\u5efa\u6587\u4ef6<code>web/js/index.js</code> <pre><code>// index.js\n'use strict';\n\nvar btnConn = document.querySelector('button#connect');\nvar btnLeave = document.querySelector('button#leave');\nvar btnSend = document.querySelector('button#send');\n\nvar socket = null; // \u8fde\u63a5\n\n// \u53d1\u8d77\u8fde\u63a5\nfunction conn() {\n    console.log('try connect');\n\n    const wssUrl = \"http://localhost:3000\"; // localhost debug\n\n    socket = io(wssUrl, {path: '/chat1'});\n\n    socket.on('connect', function () {\n        console.log('\u94fe\u63a5\u6210\u529f');\n    });\n\n    socket.on('disconnect', (socket) =&gt; {\n        console.log('socket\u5df2\u65ad\u5f00', socket);\n    });\n\n    socket.on('message', (data) =&gt; {\n        console.log('[\u670d\u52a1\u5668\u6d88\u606f], ', data);\n    });\n\n    socket.emit('message', {msg: \"web\u8fde\u63a5\u6d4b\u8bd5\"});\n    return true;\n}\n\nfunction disconnect() {\n    if(socket) {\n        socket.disconnect();\n    }\n}\n\nfunction sendMsg() {\n    if(socket) {\n        socket.emit('message', '\u76ee\u524d\u662fweb\u7684\u6d4b\u8bd5\u6570\u636e');\n    }\n}\n\nbtnConn.onclick = conn;\nbtnLeave.onclick = disconnect;\nbtnSend.onclick = sendMsg;\n</code></pre></p> <p>\u5efa\u7acb\u8fde\u63a5 <code>socket = io(wssUrl, {path: '/chat1'});</code></p> <p>\u53d1\u9001\u6d88\u606f <code>socket.emit('message', '\u76ee\u524d\u662fweb\u7684\u6d4b\u8bd5\u6570\u636e');</code></p> <p>\u5728\u672c\u5730\u8fd0\u884c\u670d\u52a1\uff0c\u6253\u5f00\u6d4f\u89c8\u5668\u8bbf\u95ee http://localhost:3000/web \uff0c\u6253\u5f00console\u89c2\u5bdf\u53d1\u9001\u548c\u63a5\u6536\u7684\u6d88\u606f</p> <p>\u5982\u679c\u76f4\u63a5\u53cc\u51fb\u6253\u5f00html\u6587\u4ef6\uff0c\u8fde\u63a5\u65f6\u4f1a\u62a5\u8de8\u57df\u95ee\u9898</p> <p>\u8de8\u57df\u95ee\u9898</p> <pre><code>index.html:1 \nAccess to XMLHttpRequest at 'http://localhost:3000/chat1/?EIO=4&amp;transport=polling&amp;t=O2cxPNv' \nfrom origin 'null' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header \nis present on the requested resource.\n</code></pre>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/web-connect-local/#_3","title":"\u7b80\u5355\u5904\u7406\u8de8\u57df\u95ee\u9898","text":"<p>\u6211\u4eec\u6765\u7ed9<code>Chat1Gateway</code>\u6dfb\u52a0\u914d\u7f6e\uff0c\u8bbe\u7f6e<code>cors</code></p> <p><pre><code>// chat1.gateway.ts\nimport { SubscribeMessage, WebSocketGateway } from '@nestjs/websockets';\n\nconst opt1 = {\n  path: '/chat1',\n  allowEIO3: true,\n  cors: {\n      origin: /.*/,\n      credentials: true\n  }\n};\n\n@WebSocketGateway(opt1)\nexport class Chat1Gateway {\n  @SubscribeMessage('message')\n  handleMessage(client: any, payload: any): any {\n    return {\n      event: 'message',\n      data: {\n        code: 1,\n        from: \"https://an.rustfisher.com\",\n        msg: \"[chat1]\u670d\u52a1\u5668\u53d1\u56de\u6765\u7684\u6d88\u606f\",\n        p: payload\n      }\n    };\n  }\n}\n</code></pre> \u91cd\u65b0\u8fd0\u884c\u670d\u52a1\uff0c\u4ece\u78c1\u76d8\u4e0a\u6253\u5f00index.html\uff0c\u70b9\u51fb\u8fde\u63a5\u3002\u6b64\u65f6\u4f1a\u770b\u5230websocket\u8fde\u63a5\u6210\u529f\u3002</p>","tags":["NestJS","Simple Chat"]},{"location":"nestjs/simple-chat/web-connect-local/#_4","title":"\u53c2\u8003","text":"<ul> <li>Socket.io API - socket.io</li> <li>NestJS\u9759\u6001\u6587\u4ef6 - RF</li> </ul>","tags":["NestJS","Simple Chat"]},{"location":"nginx/nginx-conf-note/","title":"\u5e38\u89c1\u7684nginx\u914d\u7f6e","text":"\u66f4\u65b0\u65e5\u671f 2022-9-9 <ul> <li>2022-9-9 \u589e\u52a0\u8bf4\u660e</li> <li>2022-8-5 \u589e\u52a0\u4f8b\u5b50</li> <li>2022-7-26 \u589e\u52a0\u4f8b\u5b50</li> <li>2022-7-19 \u66f4\u65b0\u6587\u6863</li> <li>2022-7-11 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u5e38\u89c1\u7684nginx\u914d\u7f6e\u3002\u67e5\u770b\u7248\u672c\uff0c\u914d\u7f6e\u670d\u52a1\uff0c\u8d1f\u8f7d\u5747\u8861\u914d\u7f6e\u3002\u6536\u5f55\u4e00\u4e9b\u5e38\u7528\u7684\u914d\u7f6e\u3002\u914d\u7f6essl\u8bc1\u4e66\u3002</p> centos\u5b89\u88c5<pre><code>yum install nginx\n</code></pre> <p>\u67e5\u770bnginx\u7684\u7248\u672c <pre><code>nginx -v\nnginx version: nginx/1.20.1\n</code></pre></p> <p>centos\u91cc\uff0csystemctl\u67e5\u770bnginx\u7684\u72b6\u6001 <pre><code>systemctl status nginx\n</code></pre></p> <p>\u542f\u52a8nginx <pre><code>systemctl start nginx\n</code></pre></p> <p>\u914d\u7f6e\u6587\u4ef6\u4e00\u822c\u5728<code>/etc/nginx</code>\u76ee\u5f55\u4e0b\uff0c\u6587\u4ef6\u540d\u4e3a nginx.conf</p>","tags":["Nginx"]},{"location":"nginx/nginx-conf-note/#log","title":"log\u914d\u7f6e","text":"<p>\u5728<code>http</code>\u6807\u7b7e\u91cc</p> log\u5e38\u89c1\u914d\u7f6e<pre><code>    log_format json '{\"time_local\":\"$time_local\",\"remote_addr\":\"$remote_addr\",\"remote_user\":\"$remote_user\",\"http_host\":\"$http_host\",\"body_bytes_sent\":$body_bytes_sent,\"request_time\":$request_time,\"status\":\"$status\",\"request\":\"$request\",\"request_method\":\"$request_method\",\"uri\":\"$uri\",\"query_string\":\"$query_string\",\"http_referrer\":\"$http_referer\",\"http_x_forwarded_for\":\"$http_x_forwarded_for\",\"http_user_agent\":\"$http_user_agent\",\"upstream_status\":\"$upstream_status\",\"proxy_host\":\"$proxy_host\",\"upstream_addr\":\"$upstream_addr\",\"upstream_response_time\":$upstream_response_time,\"upstream_connect_time\":$upstream_connect_time,\"upstream_header_time\":$upstream_header_time,\"bytes_sent\":$bytes_sent,\"gzip_ratio\":\"$gzip_ratio\",\"connection_requests\":$connection_requests,\"msec\":$msec,\"pipe\":\"$pipe\",\"connection\":$connection,\"request_length\":$request_length,\"appkey\":\"$http_appkey\",\"ts\":\"$http_ts\",\"msgdgt\":\"$http_msgdgt\",\"region\":\"$http_region\",\"x-region-id\":\"$http_x_region_id\"}';\n\n    access_log /rustfisher/nginx/logs/access.log json;\n    error_log /rustfisher/nginx/logs/error.log warn;\n</code></pre>","tags":["Nginx"]},{"location":"nginx/nginx-conf-note/#_1","title":"\u914d\u7f6e\u670d\u52a1\u7684\u4f8b\u5b50","text":"<p>Ubuntu\u7684nginx.conf\u91cc\uff0c\u6709\u5305\u542b2\u4e2a\u76ee\u5f55\u4e0b\u7684\u914d\u7f6e <pre><code>http {\n    include /etc/nginx/conf.d/*.conf;\n    include /etc/nginx/sites-enabled/*;\n}\n</code></pre></p> <p>\u6211\u4eec\u53ef\u4ee5\u5c06\u914d\u7f6e\u65b0\u5efa\u5728<code>/etc/nginx/sites-enabled</code>\u91cc</p> \u65b0\u5efasimple-chat simple-chat<pre><code># simple chat \u7684 wss\n# Created: 20220507\n# Update: 20220510\n\nmap $http_upgrade $connection_upgrade {\n    default upgrade;\n    '' close;\n}\n\nupstream chatws {\n    server 127.0.0.1:9010;\n}\n\nupstream signalws {\n    server 127.0.0.1:9002;\n}\n\nserver {\n    listen 443;\n    server_name antalkws.rustfisher.com;\n    ssl on;\n    ssl_certificate /home/ubuntu/server/ssl/antalk/antalkws.rustfisher.com_bundle.crt;\n    ssl_certificate_key /home/ubuntu/server/ssl/antalk/antalkws.rustfisher.com.key;\n    ssl_session_timeout 20m;\n    ssl_verify_client off;\n    location / {\n        root /home/ubuntu/server/wiki-site/an-rf-wiki;\n        index index.html index.htm;\n\n        proxy_pass http://127.0.0.1:9010;\n    }\n\n    location /chat1 {\n        proxy_pass http://chatws;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"Upgrade\";\n        proxy_read_timeout 300s;\n    }\n\n    location /chat2 {\n        proxy_pass http://chatws;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"Upgrade\";\n        proxy_read_timeout 300s;\n    }\n\n    location /signal {\n        proxy_pass http://chatws;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"Upgrade\";\n        proxy_read_timeout 300s;\n    }\n}\n</code></pre> <p>\u914d\u7f6e\u597d\u540e\u6d4b\u8bd5\u4e00\u4e0b\uff0c\u7136\u540e\u91cd\u8f7d\u5373\u53ef <pre><code>nginx -t\nnginx -s reload\n</code></pre></p>","tags":["Nginx"]},{"location":"nginx/nginx-conf-note/#_2","title":"\u7b80\u5355\u8d1f\u8f7d\u5747\u8861\u7684\u4f8b\u5b50","text":"<p>\u4f8b\u5982\u6211\u4eec\u67092\u4e2a\u5e94\u7528\u670d\u52a1\u5668\uff0cnginx\u5c06\u8bbf\u95ee\u8f6c\u53d1\u7ed9\u8fd9\u4e24\u53f0\u673a\u5668\u3002\u5047\u8bbe\u4ed6\u4eec\u7684\u516c\u7f51ip\u4e3a</p> <ul> <li>x.x.x.1</li> <li>x.x.x.2</li> </ul> <p>\u4fee\u6539nginx\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5728<code>http</code>\u6807\u7b7e\u91cc\uff0c\u6216\u8005\u53e6\u5916\u7684\u914d\u7f6e\u6587\u4ef6 upstream\u914d\u7f6e\u90e8\u5206<pre><code>upstream rustfisher_server {\n    server x.x.x.1:8080 weight=2;\n    server x.x.x.2:8080 weight=1;\n}\n\nserver {\n    listen       8084;\n    server_name  rustfisher;\n    proxy_http_version 1.1;\n    proxy_set_header Connection \"\";\n\n    location ~ / {\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_buffering off;\n        proxy_pass http://rustfisher_server;\n    }\n}\n</code></pre></p> <p>NG\u673a\u5668\u76d1\u542c8084\u7aef\u53e3\uff0c\u7136\u540e\u6309\u7167\u6743\u91cd\u5206\u914d\u52301\u53f7\u548c2\u53f7\u5e94\u7528\u670d\u52a1\u5668\u4e0a\u3002</p> <p><code>location ~ /</code> \u91cc\u9762\u7684 <code>~</code>\u8868\u793a\u6b63\u5219\u5339\u914d\uff0c\u8868\u793a\u542b\u6709\uff0c\u5982\u679c\u6ca1\u6709<code>~</code>\u5219\u8868\u793a\u5b8c\u5168\u5339\u914d\uff0c\u8fd9\u65f6\u5019\u8def\u5f84\u8981\u5b8c\u5168\u76f8\u7b49\u624d\u80fd\u5339\u914d\u3002</p>","tags":["Nginx"]},{"location":"nginx/nginx-conf-note/#_3","title":"\u8f6c\u53d1\u8bf7\u6c42\u7684\u914d\u7f6e","text":"","tags":["Nginx"]},{"location":"nginx/nginx-conf-note/#_4","title":"\u8f6c\u53d1\u5230\u53e6\u4e00\u4e2a\u670d\u52a1\u5668\u4e0a","text":"<p>\u8bbf\u95ee1\u53f7\u670d\u52a1\u5668\uff0c\u628a\u8bf7\u6c42\u8f6c\u53d1\u5230\u53e6\u4e00\u4e2a\u670d\u52a1\u5668\u4e0a\u3002</p> <p>\u8bbf\u95ee1\u53f7\u670d\u52a1\u5668\u7684ip\u52a0\u7aef\u53e310070\uff0c\u4f1a\u8f6c\u52302\u53f7\u673a\u4e0a</p> \u5355\u72ec\u7684\u914d\u7f6e<pre><code>server {\n    listen 10070;\n    server_name x.x.x.1;\n    proxy_http_version 1.1;\n    proxy_set_header Connection \"\";\n\n    location / {\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_buffering off;\n            proxy_pass http://y.y.y.2:8986;\n    }\n\n    location /img {\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_buffering off;\n        proxy_pass http://y.y.y.2:8986/img;\n    }\n}\n</code></pre> <p>\u53ef\u4ee5\u7cbe\u786e\u5730\u5339\u914d <code>/img</code></p>","tags":["Nginx"]},{"location":"nginx/nginx-conf-note/#_5","title":"\u8f6c\u53d1\u5230\u672c\u673a\u53e6\u4e00\u4e2a\u7aef\u53e3","text":"<p>\u8f6c\u53d1\u7aef\u53e31999\u5230\u672c\u673a\u76842022\u4e0a\u3002</p> \u5355\u72ec\u7684\u914d\u7f6e<pre><code>server {\n    listen 1999;\n    server_name  rustfisher-test;\n    proxy_http_version 1.1;\n    proxy_set_header Connection \"\";\n\n    location / {\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_buffering off;\n        proxy_pass http://127.0.0.1:2022;\n    }\n}\n</code></pre>","tags":["Nginx"]},{"location":"nginx/nginx-conf-note/#ssl","title":"\u914d\u7f6eSSL","text":"<p>\u4e00\u79cd\u6bd4\u8f83\u5e38\u7528\u7684\u914d\u7f6e\u65b9\u5f0f</p> \u5355\u72ec\u7684\u914d\u7f6e<pre><code>server {\n    listen       443;\n    server_name  good.rustfisher.com;\n    proxy_http_version 1.1;\n    proxy_set_header Connection \"\";\n\n    ssl on;\n    ssl_certificate \"/root/rf/ssl/good.rustfisher.com_nginx/rf.pem\";\n    ssl_certificate_key \"/root/rf/ssl/good.rustfisher.com_nginx/rf.key\";\n    ssl_verify_client off;\n    ssl_session_timeout  10m;\n    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n    ssl_prefer_server_ciphers on;   \n\n    location / {\n        root /root/rustfisher/web;\n        index index.html index.htm;\n    }\n}\n</code></pre> <p>\u5982\u679c\u4f7f\u7528\u4e86<code>ssl on</code>\uff0cnginx\u4f1a\u8b66\u544a \u8b66\u544a<pre><code>nginx: [warn] the \"ssl\" directive is deprecated, use the \"listen ... ssl\" directive instead in /etc/nginx/conf.d/anrfdev.conf:10\n</code></pre></p>","tags":["Nginx"]},{"location":"pyqt/install-pyqt5/","title":"\u5b89\u88c5PyQt5","text":"\u66f4\u65b0\u65e5\u671f 2016-12-28 <ul> <li>2016-12-28 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u5728Windows\u548cUbuntu\u4e0b\u5b89\u88c5PyQt5</p> <p>\u9700\u8981\u5148\u5b89\u88c5\u5e76\u914d\u7f6e\u597dPython3\uff0cWindows\u4e0b\u9700\u8981\u914d\u7f6e\u73af\u5883\u53d8\u91cf\u3002PyQt\u9700\u8981\u5bf9\u5e94\u4e0aPython\u7248\u672c\u3002</p>","tags":["PyQt"]},{"location":"pyqt/install-pyqt5/#windows","title":"Windows\u73af\u5883","text":"","tags":["PyQt"]},{"location":"pyqt/install-pyqt5/#pip3pyqt5","title":"\u7528pip3\u5b89\u88c5PyQt5","text":"<p>\u5148\u786e\u8ba4Python\u76f8\u5173\u73af\u5883\u53d8\u91cf\u5df2\u7ecf\u914d\u7f6e\u597d\uff0c\u6bd4\u5982\uff1a <pre><code>D:\\python36;D:\\python36\\Scripts;D:\\python36\\libs;\n</code></pre> \u7136\u540e\u8fd0\u884cpip3\uff0c\u53c2\u8003 PyQt5 Download <pre><code>pip3 install PyQt5\n</code></pre> \u4ece\u7f51\u4e0a\u4e0b\u8f7d\u76f8\u5173\u6587\u4ef6\u5e76\u5b89\u88c5\uff0c\u7b49\u5f85\u8fc7\u7a0b\u6bd4\u8f83\u957f\u3002</p>","tags":["PyQt"]},{"location":"pyqt/install-pyqt5/#pyqt5-56-gpl-exe","title":"PyQt5-5.6-gpl exe \u5b89\u88c5\u65b9\u5f0f","text":"<p>Win7  Python3.5.1</p> <p>PyQt5-5.6-gpl-Py3.5-Qt5.6.0-x64-2.exe  \uff08\u6700\u65b0\u7248\u672c\u5df2\u7ecf\u4e0d\u518d\u63d0\u4f9bexe\u7248\u672c\uff09</p> <p>\u5148\u5b89\u88c5Python3.5.1\u5230 <code>E:\\Python351</code> \u518d\u53bb\u5b98\u7f51\u4e0b\u8f7dPyQt5\uff0c\u7ffb\u5899\u540e\u4e0b\u8f7d\u901f\u5ea6\u66f4\u5feb\u3002\u53cc\u51fb\u5b89\u88c5\uff0cPyQt5\u4f1a\u81ea\u52a8\u627e\u5230Python35\u7684\u76ee\u5f55\u3002 \u672c\u4f8b\u4e2dPyQt5\u5b89\u88c5\u5230 <code>E:\\Python351\\Lib\\site-packages\\PyQt5</code></p> <p>\u73b0\u5728\u5c31\u53ef\u4ee5\u4f7f\u7528PyQt5\u4e86\u3002</p> <p><code>&gt;&gt;&gt; from PyQt5.QtWidgets import *</code></p> <p>\u5728\u547d\u4ee4\u884c\u663e\u793a\u4e00\u4e2alabel\u8bd5\u4e00\u4e0b</p> <pre><code>&gt;&gt;&gt; import sys\n&gt;&gt;&gt; from PyQt5 import QtWidgets\n&gt;&gt;&gt; app = QtWidgets.QApplication(sys.argv)\n&gt;&gt;&gt; label = QtWidgets.QLabel('Label')\n&gt;&gt;&gt; label.resize(150,100)\n&gt;&gt;&gt; label.show()\n</code></pre>","tags":["PyQt"]},{"location":"pyqt/install-pyqt5/#ubuntu-1604","title":"Ubuntu 16.04","text":"<p>Python3.5 \u76f4\u63a5\u5b89\u88c5 <pre><code>sudo apt-get install python3-dev\nsudo apt-get install python3-pyqt5\nsudo apt-get install qt5-default qttools5-dev-tools\ndesigner # \u542f\u52a8designer\n</code></pre></p> <p>\u5b89\u88c5pyuic5 <pre><code>sudo apt-get install pyqt5-dev-tools\n</code></pre></p>","tags":["PyQt"]},{"location":"pyqt/pycharm-install-and-config/","title":"\u5b89\u88c5\u548c\u914d\u7f6ePyCharm","text":"\u66f4\u65b0\u65e5\u671f 2016-12-28 <ul> <li>2016-12-28 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883 <ul> <li>win7</li> <li>Python3.5.1</li> <li>PyQt5-5.6</li> <li>PyCharm Community Edition 2016.3.1(64)</li> </ul> <p>\u4fee\u6539\u9ed8\u8ba4\u914d\u7f6e\uff0c\u4fee\u6539config\u548csystem\u7684\u8def\u5f84\uff0c\u907f\u514d\u5360\u636eC\u76d8\u592a\u591a\u7684\u7a7a\u95f4  </p> <p>\u5c06PyQt\u4e2d\u7684\u5de5\u5177<code>PyUIC</code>\u5b89\u88c5\u5230PyCharm\u4e2d\uff0c\u4f7f\u7528\u66f4\u4fbf\u6377\uff08Windows\u548cUbuntu\u5e73\u53f0\uff09</p> <p>\u5b89\u88c5\u8def\u5f84\uff1a <code>E:\\IntelliJ IDEA Community Edition 2016.1.1</code></p>","tags":["PyQt"]},{"location":"pyqt/pycharm-install-and-config/#pycharm_1","title":"PyCharm\u9ed8\u8ba4\u914d\u7f6e","text":"<p>\u548cAndroid Studio\u7c7b\u4f3c\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49IDE\u7684\u914d\u7f6e</p> <p>\u5728\u7b2c\u4e00\u6b21\u542f\u52a8\u524d\uff0c\u627e\u5230<code>bin\\idea.properties</code>\uff0c\u4fee\u6539\u4e00\u4e0b\u8def\u5f84</p> <pre><code>idea.config.path=E:/IntelliJIDEAPath/config\n\nidea.system.path=E:/IntelliJIDEAPath/system\n</code></pre> <p>\u542f\u52a8\u540e\uff0c\u53ef\u4ee5\u53d1\u73b0config\u548csystem\u90fd\u5728<code>E:/IntelliJIDEAPath</code>\u4e0b \u6b64\u4e3e\u662f\u4e3a\u4e86\u907f\u514dC\u76d8\u6324\u7206</p>","tags":["PyQt"]},{"location":"pyqt/pycharm-install-and-config/#pycharm_2","title":"PyCharm\u5de5\u7a0b\u914d\u7f6e","text":"<p>\u6253\u5f00Settings</p> <pre><code>Build, Execution, Deployment\n    Console\n        Python Console\n            Python interpreter \u9009\u62e9 Python 3.5.1\n</code></pre> <p>\u5047\u8bbe\u6709\u4e00\u4e2a\u5de5\u7a0b<code>gui_app</code>\uff0c\u540c\u6837\u8981\u68c0\u67e5\u4e00\u4e0b\u8bbe\u7f6e <pre><code>Project: gui_app\n    Project interpreter\n        \u9009\u62e93.5.1  \u540e\u9762\u4f1a\u663e\u793a\u8def\u5f84\n</code></pre></p>","tags":["PyQt"]},{"location":"pyqt/pycharm-install-and-config/#_1","title":"\u5b89\u88c5\u6269\u5c55\u5de5\u5177","text":"<p>\u6253\u5f00Settings &gt; Tools &gt; External Tools</p> <p>\u9009\u62e9\u65b0\u5efa<code>+</code>\uff0c\u6216\u8005\u7f16\u8f91</p>","tags":["PyQt"]},{"location":"pyqt/pycharm-install-and-config/#qtdesigner","title":"\u5b89\u88c5QtDesigner","text":"<p>Name: QtDesigner <pre><code>Tool Settings\n    Program: E:\\Python351\\Lib\\site-packages\\PyQt5\\designer.exe\n    ## \u9009\u62e9\u5b89\u88c5\u597d\u7684PyQt5\\designer.exe\n\n    Working directory: $FileDir$\n</code></pre></p>","tags":["PyQt"]},{"location":"pyqt/pycharm-install-and-config/#pyuic","title":"\u5b89\u88c5PyUIC","text":"<p>\u5c06designer\u751f\u6210\u7684ui\u6587\u4ef6\u8f6c\u4e3apy\u6587\u4ef6\u7684\u5de5\u5177\uff1b\u8fd9\u662fPython\u81ea\u5e26\u7684\u5de5\u5177</p> <p>Name: PyUIC <pre><code>Tool Settings\n    Program: E:\\Python351\\python.exe\n    ## \u9009\u62e9\u5b89\u88c5\u597d\u7684python.exe\n\n    Parameters: -m PyQt5.uic.pyuic  $FileName$ -o $FileNameWithoutExtension$.py\n    Working directory: $FileDir$\n</code></pre></p>","tags":["PyQt"]},{"location":"pyqt/pycharm-install-and-config/#ubuntupycharm","title":"Ubuntu\u4e0bPyCharm\u914d\u7f6e","text":"<p>\u5c06designer\u751f\u6210\u7684ui\u6587\u4ef6\u8f6c\u4e3apy\u6587\u4ef6\u7684\u5de5\u5177  </p> <p>\u9700\u8981<code>sudo apt-get install pyqt5-dev-tools</code> </p> <p>\u914d\u7f6e\u5de5\u5177[Tool Settings]</p> <pre><code>Program: pyuic5\nParameters: -o $FileNameWithoutExtension$.py $FileNameWithoutExtension$.ui\nWorking directory: $FileDir$\n</code></pre>","tags":["PyQt"]},{"location":"pyqt/pyqt-QFileDialog-use/","title":"PyQt QFileDialog \u6587\u4ef6\u9009\u62e9\u5f39\u7a97","text":"\u66f4\u65b0\u65e5\u671f 2017-11-23 <ul> <li>2017-11-23 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u5f39\u51fa\u6587\u4ef6\u9009\u62e9\u6846\u3002\u53ef\u4ee5\u81ea\u5b9a\u4e49\u9009\u62e9\u6846\u7684\u6807\u9898\uff0c\u9ed8\u8ba4\u4f4d\u7f6e\uff0c\u76ee\u6807\u6587\u4ef6\u540e\u7f00</p> <p>\u9009\u62e9\u6846\u5f39\u51fa\u540e\uff0c\u4f1a\u963b\u585eUI\u7ebf\u7a0b\u3002</p>","tags":["PyQt"]},{"location":"pyqt/pyqt-QFileDialog-use/#pyqt5","title":"PyQt5\u6587\u4ef6\u9009\u62e9\u6846\u7684\u4f8b\u5b50","text":"<p>\u8fd9\u91cc\u53ea\u9009\u62e9\u4e00\u4e2abat\u6587\u4ef6\u3002\u5982\u679c\u9ed8\u8ba4\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c\u5219\u67e5\u627e\u5f53\u524d\u76ee\u5f55 <pre><code>def _click_tu_choose_file_path_btn1(self):\n    default_path = 'C:\\MY'\n    if not os.path.exists(default_path):\n        default_path = os.getcwd()\n    dlg = QFileDialog(None, \"choose_bat_file\", default_path, 'All Files(*.bat)')\n    dlg.setFileMode(QFileDialog.AnyFile)\n    if dlg.exec_():\n        selected_name = dlg.selectedFiles()[0]\n        if selected_name:\n            self.ma.tu_filePathTv1.setText(self.tr(selected_name))\n</code></pre></p>","tags":["PyQt"]},{"location":"pyqt/pyqt-QMainWindow-use1/","title":"PyQt QMainWindow \u7b80\u5355\u4f7f\u7528","text":"\u66f4\u65b0\u65e5\u671f 2016-12-28 <ul> <li>2016-12-28 \u521b\u5efa\u6587\u6863</li> </ul> <p>QMainWindow\u7ee7\u627f\u81eaQWidget\u3002QMainWindow\u76f8\u5f53\u4e8e\u7a0b\u5e8f\u7684\u4e3b\u754c\u9762\uff0c\u5185\u7f6e\u4e86menu\u548ctoolBar\u3002\u4f7f\u7528 Qt Designer \u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u6dfb\u52a0menu\u9009\u9879\u3002</p> <p>\u5bf9\u4e8e\u8f83\u5927\u578b\u7684\u754c\u9762\uff0c\u7528Qt Designer\u6bd4\u8f83\u65b9\u4fbf\u3002<code>.ui</code>\u6587\u4ef6\u5c31\u50cfAndroid\u4e2d\u4f7f\u7528xml\u4e00\u6837\u3002</p> <p>\u753b\u51fa\u7684ui\u6587\u4ef6\u53ef\u4ee5\u7528PyQt\u4e2d\u7684PyUIC\u8f6c\u6362\u6210py\u6587\u4ef6\u3002\u8f6c\u6362\u540e\u7684py\u6587\u4ef6\u4e2d\u6709\u4e00\u4e2aclass\u3002</p> <p>\u65b0\u5efa\u4e00\u4e2a\u7ee7\u627f\u81eaQMainWindow\u7684\u7c7b\uff0c\u6765\u8c03\u7528\u751f\u6210\u7684\u8fd9\u4e2a\u7c7b\u3002</p> <p>\u4e3b\u7a97\u53e3\u5173\u95ed\u65f6\uff0c\u4f1a\u8c03\u7528<code>closeEvent(self, *args, **kwargs)</code>\uff0c\u53ef\u590d\u5199\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u52a0\u4e0a\u4e00\u4e9b\u5173\u95ed\u65f6\u7684\u64cd\u4f5c\u3002</p> <p>\u6bd4\u5982\u7ec8\u6b62\u5b50\u7ebf\u7a0b\uff0c\u5173\u95ed\u6570\u636e\u5e93\u63a5\u53e3\uff0c\u91ca\u653e\u8d44\u6e90\u7b49\u7b49\u64cd\u4f5c\u3002</p>","tags":["PyQt"]},{"location":"pyqt/pyqt-QMainWindow-use1/#pyqt5-qmainwindow","title":"PyQt5 \u624b\u5199 QMainWindow \u793a\u4f8b","text":"<ul> <li>Win7</li> <li>PyCharm</li> <li>Python3.5.1</li> <li>PyQt5</li> </ul> <p>\u624b\u5199\u4e00\u4e2amain window\uff0c\u4e3b\u8981\u4f7f\u7528\u4e86\u83dc\u5355\u680f\u3001\u6587\u672c\u7f16\u8f91\u6846\u3001\u5de5\u5177\u680f\u548c\u72b6\u6001\u680f <pre><code>|-- main.py\n|-- res\n|   `-- sword.png\n`-- ui\n    `-- app_main_window.py\n</code></pre></p> <p><code>main.py</code>\u4e3b\u6587\u4ef6 <pre><code>import sys\n\nfrom PyQt5.QtWidgets import QApplication\nfrom ui.app_main_window import AppMainWindow\n\nif __name__ == '__main__':\n    app = QApplication(sys.argv)\n    window = AppMainWindow()\n    window.show()\n    sys.exit(app.exec_())\n</code></pre></p> <p><code>app_main_window.py</code>\u7a97\u53e3\u5b9e\u73b0\u6587\u4ef6 <pre><code>from PyQt5.QtCore import QCoreApplication\nfrom PyQt5.QtGui import QIcon\nfrom PyQt5.QtWidgets import QAction\nfrom PyQt5.QtWidgets import QMainWindow\nfrom PyQt5.QtWidgets import QTextEdit\n\n\nclass AppMainWindow(QMainWindow):\n    \"\"\"\n    \u83dc\u5355\u680f\u3001\u6587\u672c\u7f16\u8f91\u6846\u3001\u5de5\u5177\u680f\u548c\u72b6\u6001\u680f\n    \"\"\"\n\n    def __init__(self):\n        super().__init__()\n        self.init_ui()\n\n    def init_ui(self):\n        # \u83dc\u5355\u680f\n        self.statusBar().showMessage('Main window is ready')\n        self.setGeometry(500, 500, 450, 220)\n        self.setMinimumSize(150, 120)\n        self.setWindowTitle('MainWindow')\n\n        # \u6587\u672c\u7f16\u8f91\u6846\n        text_edit = QTextEdit()\n        self.setCentralWidget(text_edit)  # \u586b\u5145\u5269\u4e0b\u7684\u4f4d\u7f6e\n\n        # \u5b9a\u4e49\u9000\u51fa\u52a8\u4f5c\n        exit_action = QAction(QIcon('res/sword.png'), 'Exit', self)\n        exit_action.setShortcut('Ctrl+Q')\n        exit_action.setStatusTip('Exit App')  # \u9f20\u6807\u6307\u5411\u9009\u9879\u65f6\u5728\u7a97\u53e3\u72b6\u6001\u680f\u51fa\u73b0\u7684\u63d0\u793a\n        # exit_action.triggered.connect(QCoreApplication.instance().quit)\n        exit_action.triggered.connect(self.close)  # \u5173\u95edapp\n\n        # \u5b9a\u4e49\u83dc\u5355\u680f\uff0c\u6dfb\u52a0\u4e00\u4e2a\u9009\u9879\n        menu_bar = self.menuBar()\n        file_menu = menu_bar.addMenu('&amp;File')\n        file_menu.addAction(exit_action)\n\n        # \u5b9a\u4e49\u5de5\u5177\u680f\uff0c\u6dfb\u52a0\u4e00\u4e2a\u9000\u51fa\u52a8\u4f5c\n        toolbar = self.addToolBar('&amp;Exit')\n        toolbar.addAction(exit_action)\n</code></pre></p> <p>\u6709\u7684\u65f6\u5019PyCharm\u7ed9\u7684\u4ee3\u7801\u63d0\u793a\u4e0d\u5b8c\u5168\u3002\u7f51\u4e0a\u8bf4PyCharm\u914d\u5408vim\u63d2\u4ef6\u6765\u4f7f\u7528\u80fd\u5e26\u6765\u5f88\u597d\u7684\u4f53\u9a8c\u3002 \u751f\u6210\u7684\u754c\u9762\u4e2d\uff0c\u5de5\u5177\u680f\u53ef\u4ee5\u81ea\u7531\u7684\u62d6\u52a8\uff0c\u53ef\u4ee5\u653e\u5728\u4e0a\u4e0b\u5de6\u53f34\u4e2a\u5730\u65b9\u3002</p> <p>\u540c\u6837\u7684\u4ee3\u7801\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u79fb\u690d\u5230PyQt4\u4e2d\u3002</p>","tags":["PyQt"]},{"location":"pyqt/pyqt-QMainWindow-use1/#designer","title":"\u4f7f\u7528designer\u753b\u51fa\u6765\u7684\u754c\u9762","text":"<p>Ubuntu</p> <p>\u4f7f\u7528designer\u7ed8\u5236\u597d\u754c\u9762\u540e\uff0c\u8bb2ui\u6587\u4ef6\u8f6c\u6362\u6210py\u4ee3\u7801\u3002 <pre><code>import sys\nfrom PyQt5.QtWidgets import QMainWindow, QApplication\nfrom ui_main_window import Ui_UAppMainWindow\n\n\nclass RustMainWindow(QMainWindow):\n    \"\"\"\u4e3b\u754c\u9762\u7c7b\"\"\"\n\n    def __init__(self):\n        super(RustMainWindow, self).__init__()\n        self.ma = Ui_UAppMainWindow()  # designer\u753b\u7684\u754c\u9762\n        self.ma.setupUi(self)\n\n\nif __name__ == \"__main__\":\n    app = QApplication(sys.argv)\n    main_window = RustMainWindow()\n    main_window.show()\n    sys.exit(app.exec_())\n</code></pre></p> <p>\u590d\u5199<code>__init__</code>\u521d\u59cb\u5316\u65b9\u6cd5\u65f6\u9700\u8981\u8c03\u7528\u7236\u7c7b\u65b9\u6cd5</p>","tags":["PyQt"]},{"location":"pyqt/pyqt-QMainWindow-use1/#pyqt4","title":"PyQt4\u624b\u5199\u7a97\u53e3\u4ee3\u7801","text":"<p>\u548c\u4e0a\u9762\u90a3\u4e2a\u529f\u80fd\u7c7b\u4f3c\u3002</p> <p><pre><code>import sys\nfrom PyQt4.QtGui import QMainWindow, QTextEdit, QAction, QIcon, QApplication\n\n\nclass AppMainWindow(QMainWindow):\n    def __init__(self):\n        super(AppMainWindow, self).__init__()\n        self.init_ui()\n\n    def init_ui(self):\n        self.statusBar().showMessage('Main window is ready')\n        self.setGeometry(500, 500, 450, 220)\n        self.setMinimumSize(150, 120)\n        self.setWindowTitle('MainWindow')\n\n        text_edit = QTextEdit()\n        self.setCentralWidget(text_edit)\n\n        exit_action = QAction(QIcon('res/ic_s1.png'), 'Exit', self)\n        exit_action.setShortcut('Ctrl+Q')\n        exit_action.setStatusTip('Exit App')\n        exit_action.triggered.connect(self.close)\n\n        menu_bar = self.menuBar()\n        file_menu = menu_bar.addMenu('&amp;File')\n        file_menu.addAction(exit_action)\n\n        toolbar = self.addToolBar('&amp;Exit')\n        toolbar.addAction(exit_action)\n\n\nif __name__ == '__main__':\n    app = QApplication(sys.argv)\n    window = AppMainWindow()\n    window.show()\n    sys.exit(app.exec_())\n</code></pre> \u53ef\u4ee5\u770b\u51fa\uff0cPyQt4 \u548c 5 \u7684\u4ee3\u7801\u57fa\u672c\u4e0a\u662f\u901a\u7528\u7684\u3002\u590d\u5199<code>__init__</code>\u7684\u65b9\u6cd5\u4e0d\u540c\u3002</p>","tags":["PyQt"]},{"location":"pyqt/pyqt-QThread/","title":"PyQt \u7ebf\u7a0b\u7c7b QThread","text":"\u66f4\u65b0\u65e5\u671f 2017-07-11 <ul> <li>2017-07-11 \u521b\u5efa\u6587\u6863</li> </ul> <p>PyQt\u4e2d\u7684\u7ebf\u7a0b\u7c7b <code>QtCore.QThread</code>\uff0c\u4f7f\u7528\u65f6\u7ee7\u627fQThread\u7c7b</p> <p>\u542f\u52a8\u754c\u9762\u7684\u7ebf\u7a0b\u6682\u79f0\u4e3aUI\u7ebf\u7a0b\u3002\u754c\u9762\u6267\u884c\u547d\u4ee4\u65f6\u90fd\u5728\u81ea\u5df1\u7684UI\u7ebf\u7a0b\u4e2d\u3002 \u5982\u679c\u5728UI\u7ebf\u7a0b\u4e2d\u6267\u884c\u7f51\u7edc\u8fde\u63a5\u548c\u6570\u636e\u5e93\u64cd\u4f5c\u7b49\u8017\u65f6\u7684\u64cd\u4f5c\uff0c\u754c\u9762\u4f1a\u88ab\u5361\u4f4f\uff0cWindows\u4e0b\u6709\u53ef\u80fd\u4f1a\u51fa\u73b0\u201c\u65e0\u54cd\u5e94\u201d\u7684\u8b66\u544a\u3002 \u963b\u585eUI\u7ebf\u7a0b\u4f1a\u964d\u4f4e\u7528\u6237\u4f53\u9a8c\u548c\u5e94\u7528\u7a33\u5b9a\u6027\u3002\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u628a\u8017\u65f6\u64cd\u4f5c\u653e\u5728\u7ebf\u7a0b\u4e2d\u53bb\u6267\u884c\u3002</p> <p>QThread\u4ee3\u8868\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6211\u4eec\u53ef\u4ee5\u590d\u5199run\u51fd\u6570\u6765\u6267\u884c\u6211\u4eec\u8981\u7684\u64cd\u4f5c\u3002</p> <p>QThread\u53ef\u4ee5\u4f7f\u7528<code>QtCore.pyqtSignal</code>\u6765\u4e0e\u754c\u9762\u4ea4\u4e92\u548c\u4f20\u8f93\u6570\u636e\u3002</p>","tags":["PyQt"]},{"location":"pyqt/pyqt-QThread/#pyqt4-qthread","title":"PyQt4 QThread \u4ee3\u7801\u793a\u4f8b","text":"<ul> <li>Python2.7</li> </ul> <pre><code># -*- coding: utf-8 -*-\nimport sys\n\nfrom PyQt4 import QtCore\nfrom PyQt4.QtCore import QCoreApplication\nfrom PyQt4.QtGui import QWidget, QPushButton, QApplication, QTextBrowser\n\n\nclass TimeThread(QtCore.QThread):\n    signal_time = QtCore.pyqtSignal(str, int)  # \u4fe1\u53f7\n\n    def __init__(self, parent=None):\n        super(TimeThread, self).__init__(parent)\n        self.working = True\n        self.num = 0\n\n    def start_timer(self):\n        self.num = 0\n        self.start()\n\n    def run(self):\n        while self.working:\n            print \"Working\", self.thread()\n            self.signal_time.emit(\"Running time:\", self.num)  # \u53d1\u9001\u4fe1\u53f7\n            self.num += 1\n            self.sleep(1)\n\n\nclass TimeDialog(QWidget):\n    def __init__(self):\n        super(TimeDialog, self).__init__()\n        self.timer_tv = QTextBrowser(self)\n        self.init_ui()\n        self.timer_t = TimeThread()\n        self.timer_t.signal_time.connect(self.update_timer_tv)\n\n    def init_ui(self):\n        self.resize(300, 200)\n        self.setWindowTitle('TimeDialog')\n        self.timer_tv.setText(\"Wait\")\n        self.timer_tv.setGeometry(QtCore.QRect(10, 145, 198, 26))\n        self.timer_tv.move(0, 15)\n\n        btn1 = QPushButton('Quit', self)\n        btn1.setToolTip('Click to quit')\n        btn1.resize(btn1.sizeHint())\n        btn1.move(200, 150)\n        btn1.clicked.connect(QCoreApplication.instance().quit)\n\n        start_btn = QPushButton('Start', self)\n        start_btn.setToolTip(\"Click to start\")\n        start_btn.move(50, 150)\n        self.connect(start_btn, QtCore.SIGNAL(\"clicked()\"), self.click_start_btn)\n\n    def click_start_btn(self):\n        self.timer_t.start_timer()\n\n    def update_timer_tv(self, text, number):\n        self.timer_tv.setText(self.tr(text + \" \" + str(number)))\n\n\nif __name__ == '__main__':\n    app = QApplication(sys.argv)\n    time_dialog = TimeDialog()\n    time_dialog.show()\n\n    sys.exit(app.exec_())\n</code></pre> <p>QThread\u4e2d\u4f7f\u7528\u7684\u4fe1\u53f7<code>signal_time = QtCore.pyqtSignal(str, int)</code> \u6307\u5b9a\u4e86\u53c2\u6570str\u548cint</p> <p>\u53d1\u9001\u4fe1\u53f7<code>self.signal_time.emit(\"Running time:\", self.num)</code></p> <p>\u5916\u90e8\u63a5\u6536\u4fe1\u53f7<code>self.timer_t.signal_time.connect(self.update_timer_tv)</code></p> <p>\u4fe1\u53f7\u8fde\u63a5\u5230\u65b9\u6cd5<code>update_timer_tv(self, text, number)</code>\uff0c\u6ce8\u610f\u4fe1\u53f7\u4e0e\u65b9\u6cd5\u7684\u53c2\u6570\u8981\u4e00\u4e00\u5bf9\u5e94</p> <p>\u4f7f\u7528\u4e2d\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u591a\u79cd\u4e0d\u540c\u7684\u4fe1\u53f7<code>QtCore.pyqtSignal</code></p> <p>\u542f\u52a8\u7ebf\u7a0b\uff0c\u8c03\u7528<code>start()</code></p>","tags":["PyQt"]},{"location":"pyqt/pyqt-adjust-screen-resolution/","title":"PyQt \u9002\u914d\u4e0d\u540c\u5c4f\u5e55\u5206\u8fa8\u7387","text":"\u66f4\u65b0\u65e5\u671f 2017-09-26 <ul> <li>2017-09-26 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u5728\u5bbd\u9ad8\u4e3a<code>1366*768</code>\u4e0b\u8bbe\u8ba1\u5f00\u53d1\u7684\u754c\u9762\uff0c\u5230\u4e86<code>2860*1620</code>\u5c4f\u5e55\u4e0b\u4f1a\u663e\u793a\u4e0d\u6b63\u5e38\u3002  </p> <p>\u56e0\u4e3a\u50cf\u7d20\u5bc6\u5ea6\u4e0d\u540c\uff0c<code>2860*1620</code>\u5c4f\u5e55\u663e\u793a\u51fa\u6765\u7684\u63a7\u4ef6\u5f88\u5c0f\u3002</p>","tags":["PyQt"]},{"location":"pyqt/pyqt-adjust-screen-resolution/#-","title":"\u9002\u914d\u65b9\u6cd5 - \u6839\u636e\u5f53\u524d\u5c4f\u5e55\u8c03\u6574\u63a7\u4ef6\u5927\u5c0f\u548c\u4f4d\u7f6e","text":"<p>\u521d\u59cb\u5316\u65f6\u83b7\u53d6\u5230\u5f53\u524d\u5c4f\u5e55\u7684\u5bbd\u9ad8\u50cf\u7d20\u503c\u3002</p> <p>\u4e0e\u539f\u50cf\u7d20\u503c\u76f8\u6bd4\u6c42\u51fa\u6bd4\u4f8b<code>self.ratio_wid</code>\uff0c<code>self.ratio_height</code>\u3002</p> <p>\u627e\u51fa\u6240\u6709\u7684QWidget <code>self.findChildren(QWidget)</code>\uff0c\u904d\u5386\u6765\u6539\u53d8\u5927\u5c0f\u548c\u4f4d\u7f6e\u3002</p> <pre><code>from PyQt4.QtGui import QMainWindow, QApplication, QWidget\n\nclass ReMainWindow(QMainWindow):\n\n    def __init__(self, parent=None):\n        # ...........\n        self.app = QApplication.instance()  # Calculate the ratio. Design screen is [1366, 768]\n        screen_resolution = self.app.desktop().screenGeometry()\n        self.hw_ratio = 768 / 1366  # height / width\n        self.ratio_wid = screen_resolution.width() / 1366\n        if self.ratio_wid &lt; 1:\n            self.ratio_wid = 1\n        self.ratio_height = screen_resolution.height() / 768\n        if self.ratio_height &lt; 1:\n            self.ratio_height = 1\n\n    def _init_ui_size(self):\n        \"\"\" Travel all the widgets and resize according to the ratio \"\"\"\n        self._resize_with_ratio(self)\n        for q_widget in self.findChildren(QWidget):\n            # print q_widget.objectName()\n            self._resize_with_ratio(q_widget)\n            self._move_with_ratio(q_widget)\n\n            # Don't deal with the text browser\n            # for q_widget in self.findChildren(QAbstractScrollArea):\n            #     print q_widget.objectName()\n            #     self._resize_with_ratio(q_widget)\n            #     self._move_with_ratio(q_widget)\n\n    def _resize_with_ratio(self, input_ui):\n        input_ui.resize(input_ui.width() * self.ratio_wid, input_ui.height() * self.ratio_height)\n\n    def _move_with_ratio(self, input_ui):\n        input_ui.move(input_ui.x() * self.ratio_wid, input_ui.y() * self.ratio_height)\n</code></pre> <p>\u5b9e\u8df5\u53d1\u73b0\uff0c\u4e0d\u9700\u8981\u5bf9QTextBrowser\u6240\u5c5e\u7684<code>QAbstractScrollArea</code>\u5904\u7406\u3002</p>","tags":["PyQt"]},{"location":"pyqt/pyqt-drag-and-drop/","title":"PyQt \u62d6\u5165","text":"\u66f4\u65b0\u65e5\u671f 2017-09-19 <ul> <li>2017-09-19 \u521b\u5efa\u6587\u6863</li> </ul> <p>PyQt\u652f\u6301\u62d6\u5165\u529f\u80fd\u3002\u6bd4\u5982\u62d6\u5165\u6587\u4ef6\u6216\u8005\u4e00\u6bb5\u6587\u672c\u3002</p>","tags":["PyQt"]},{"location":"pyqt/pyqt-drag-and-drop/#_1","title":"\u62d6\u5165\u6587\u672c","text":"<p>\u5b9a\u4e49\u4e86\u4e00\u4e2alabel\u7ee7\u627f\u81ea<code>QLabel</code>\uff0c\u521d\u59cb\u5316\u65f6\u8bbe\u7f6e\u5141\u8bb8\u62d6\u5165\u3002</p> <p>\u53c2\u89c1pyqt5-drag-and-drop <pre><code>from PyQt5 import QtCore\nfrom PyQt5.QtWidgets import QMainWindow, QApplication, QListWidget, QAbstractItemView\n\nclass CustomLabel(QLabel):\n\n    def __init__(self, title, parent):\n        super().__init__(title, parent)\n        self.setAcceptDrops(True)\n\n    def dragEnterEvent(self, e):\n        if e.mimeData().hasFormat('text/plain'):\n            e.accept()\n        else:\n            e.ignore()\n\n    def dropEvent(self, e):\n        self.setText(e.mimeData().text())\n</code></pre> \u76f4\u63a5\u8c03\u7528\u8fd9\u4e2a\u7c7b\uff0c\u5c06\u5b83\u6dfb\u52a0\u5230\u754c\u9762\u4e0a\u53bb\u3002</p>","tags":["PyQt"]},{"location":"pyqt/pyqt-drag-and-drop/#_2","title":"\u62d6\u5165\u6587\u4ef6\uff0c\u8bfb\u53d6\u6587\u4ef6\u8def\u5f84","text":"<p>\u8fd9\u91cc\u7ee7\u627f\u4e86QLabel\u3002<code>Ui_MainWindow</code>\u662f\u7528designer\u753b\u51fa\u6765\u7684\u754c\u9762\u3002</p> <pre><code>from PyQt5 import QtCore\nfrom PyQt5.QtWidgets import QMainWindow, QApplication, QListWidget, QAbstractItemView\n\nclass LabMainWindow(QMainWindow):\n    def __init__(self):\n        super(LabMainWindow, self).__init__()\n        self.ma = Ui_MainWindow()\n        self.ma.setupUi(self)\n        self.drag_in_widget = DragInWidget(\"Drag in\", self)\n\n    def _init_ui(self):\n        self.drag_in_widget.move(0, 0)\n\n\nclass DragInWidget(QLabel):\n    def __init__(self, title, parent):\n        super().__init__(title, parent)\n        self.setAcceptDrops(True)\n\n    def dragEnterEvent(self, e):\n        if e.mimeData().hasUrls():\n            e.accept()\n        else:\n            e.ignore()\n\n    def dropEvent(self, e):\n        for url in e.mimeData().urls():\n            path = url.toLocalFile()\n            if os.path.isfile(path):\n                print(path)\n</code></pre>","tags":["PyQt"]},{"location":"pyqt/pyqt-drag-and-drop/#_3","title":"\u62d6\u5165\u4e8b\u4ef6\u76d1\u542c","text":"","tags":["PyQt"]},{"location":"pyqt/pyqt-drag-and-drop/#qtwidgetsqframe","title":"QtWidgets.QFrame\u76d1\u542c\u62d6\u5165\u4e8b\u4ef6","text":"<p>\u76d1\u542c\u5230\u6709\u6548\u62d6\u52a8\u4e8b\u4ef6\u540e\uff0c\u5229\u7528<code>QtCore.pyqtSignal</code>\u628a\u4fe1\u606f\u4f20\u9012\u51fa\u53bb</p> <pre><code>from PyQt5 import QtCore\nfrom PyQt5.QtWidgets import QMainWindow, QApplication, QListWidget, QAbstractItemView\n\nclass DragInWidget(QtWidgets.QFrame):\n    \"\"\" Drag files to this widget \"\"\"\n    s_content = QtCore.pyqtSignal(str)  # emit file path\n\n    def __init__(self, parent):\n        super(DragInWidget, self).__init__(parent)\n        self.setAcceptDrops(True)\n\n    def dragEnterEvent(self, e):\n        if e.mimeData().hasUrls():\n            e.accept()\n        else:\n            e.ignore()\n\n    def dropEvent(self, e):\n        for url in e.mimeData().urls():\n            path = url.toLocalFile()\n            if os.path.isfile(path):\n                self.s_content.emit(path)\n                print(path)\n</code></pre> <p>\u8fd9\u4e2aFrame\u53ef\u4ee5\u8986\u76d6\u5728\u5176\u4ed6\u63a7\u4ef6\u4e0a\u9762\u65f6\uff0c\u4f1a\u62e6\u622a\u64cd\u4f5c</p>","tags":["PyQt"]},{"location":"pyqt/pyqt-drag-and-drop/#qlistwidget","title":"QListWidget\u62d6\u5165\u4e8b\u4ef6","text":"<p>\u5411<code>QListWidget</code>\u62d6\u5165\u6587\u4ef6\uff0c\u83b7\u53d6\u6587\u4ef6\u8def\u5f84</p> <pre><code>from PyQt5 import QtCore\nfrom PyQt5.QtWidgets import QMainWindow, QApplication, QListWidget, QAbstractItemView\n\nclass DragInWidget(QListWidget):\n    \"\"\" Drag files to this widget \"\"\"\n    s_content = QtCore.pyqtSignal(str)  # emit file path\n\n    def __init__(self, parent):\n        super(DragInWidget, self).__init__(parent)\n        self.setAcceptDrops(True)\n        self.setDragDropMode(QAbstractItemView.InternalMove)\n\n    def dragEnterEvent(self, e):\n        if e.mimeData().hasUrls():\n            e.accept()\n        else:\n            e.ignore()\n\n    def dropEvent(self, e):\n        for url in e.mimeData().urls():\n            path = url.toLocalFile()\n            if os.path.isfile(path):\n                self.s_content.emit(path)\n                print(path)\n</code></pre>","tags":["PyQt"]},{"location":"pyqt/pyqt-locale/","title":"PyQt4 \u591a\u8bed\u8a00","text":"\u66f4\u65b0\u65e5\u671f 2017-09-20 <ul> <li>2017-09-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4f7f\u7528<code>pylupdate4</code>\u5c06\u754c\u9762\u7684py\u6587\u4ef6\u8f6c\u6210ts\u6587\u4ef6\u3002</p> <p>\u8fdb\u5165py\u6587\u4ef6\u6240\u5728\u76ee\u5f55\uff0c\u6267\u884c\u8f6c\u6362\u547d\u4ee4\u3002 <pre><code>/d/python27/Lib/site-packages/PyQt4/pylupdate4 ui_main.py -ts zh_CN.ts\n</code></pre></p> <p>\u5f97\u5230<code>zh_CN.ts</code>\u6587\u4ef6\u3002\u8fd9\u4e2a\u6587\u4ef6\u672c\u8d28\u4e0a\u662fxml\u6587\u4ef6\u3002</p> <p>\u5f53\u754c\u9762\u7684py\u6587\u4ef6\u4fee\u6539\u65f6\uff0c\u8fd0\u884c<code>pylupdate4</code>\u751f\u6210ts\u4e0d\u4f1a\u7834\u574f\u539fts\u7684\u7ffb\u8bd1\u3002</p> <p>\u7528Qt\u8bed\u8a00\u5bb6\uff08Linguist\uff09\u6253\u5f00<code>zh_CN.ts</code>\u6587\u4ef6\u3002\u53ef\u4ee5\u5bf9\u76f8\u5e94\u7684\u5b57\u7b26\u4e32\u8fdb\u884c\u7ffb\u8bd1\u3002</p> <p>\u70b9\u51fb\u201c\u53d1\u5e03\u201d\u53ef\u83b7\u5f97<code>zh_CN.qm</code>\u6587\u4ef6\u3002\u8fd9\u5c31\u662fqt\u7684\u8bed\u8a00\u8d44\u6e90\u6587\u4ef6\uff0c\u662f\u4e00\u4e2a\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002</p> <p>\u521b\u5efaapp\u65f6\uff0c\u5148\u52a0\u8f7d\u8bed\u8a00\u8d44\u6e90\u6587\u4ef6<code>zh_CN.qm</code> <pre><code>if __name__ == '__main__':\n    configs.init_configs()  # \u786e\u5b9a\u8bed\u8a00\u914d\u7f6e\n    app = QApplication(sys.argv)\n    trans = QTranslator()  # Setup locale, we need .qm files\n    if configs.g_locale_type == configs.LOCALE_ZH_CH:\n        trans.load(\"res/locale/zh_CN\")  # No need suffix .qm\n        app.installTranslator(trans)\n\n    main_d = FAMainWindow()\n    main_d.show()\n    sys.exit(app.exec_())\n</code></pre></p>","tags":["PyQt"]},{"location":"pyqt/pyqt-locale/#app","title":"App\u8fd0\u884c\u4e2d\u5207\u6362\u8bed\u8a00","text":"<p>\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u5f53\u524d\u663e\u793a\u7684\u8bed\u8a00\u3002\u4e0d\u9700\u8981\u91cd\u65b0\u542f\u52a8\u7a0b\u5e8f\u5373\u53ef\u5b8c\u6210\u5207\u6362\u3002</p>","tags":["PyQt"]},{"location":"pyqt/pyqt-locale/#_1","title":"\u51c6\u5907\u8bed\u8a00\u8d44\u6e90\u6587\u4ef6","text":"<p>\u4ee5\u82f1\u6587\u548c\u7b80\u4f53\u4e2d\u6587\u4e3a\u4f8b\uff0c\u60f3\u8981\u5207\u6362\u8bed\u8a00\uff0c\u9700\u8981\u8fd92\u79cd\u8bed\u8a00\u5305 <pre><code>$ /d/python27/Lib/site-packages/PyQt4/pylupdate4 ui_main.py -ts zh_CN.ts\n$ /d/python27/Lib/site-packages/PyQt4/pylupdate4 ui_main.py -ts en.ts\n</code></pre> \u501f\u52a9Qt\u8bed\u8a00\u5bb6\u53d1\u5e03\u5f97\u5230<code>en.qm</code>\u548c<code>zh_CN.qm</code>\u8fd92\u4e2a\u6587\u4ef6\uff0c\u653e\u5728<code>res/locale</code>\u76ee\u5f55\u91cc</p>","tags":["PyQt"]},{"location":"pyqt/pyqt-locale/#ui","title":"\u5728UI\u4e0a\u8bbe\u7f6e\u89e6\u53d1\u5207\u6362\u8bed\u8a00","text":"<p>\u754c\u9762\u4e0a\u9700\u8981\u6309\u94ae\u6216\u83dc\u5355\u680f\u7684action\uff1b\u9700\u8981\u6301\u6709<code>QTranslator</code>\uff1b</p> <pre><code>        self.trans = QTranslator()  # \u521d\u59cb\u5316\u65f6\u83b7\u53d6 QTranslator\n        self._init_trans()\n        # \u6dfb\u52a0\u4e86action\u6765\u89e6\u53d1\u5207\u6362\u52a8\u4f5c\n        self.connect(self.ma.actionEnglish, SIGNAL(\"triggered()\"), self._trigger_english)\n        self.ma.action_ZhCN.triggered.connect(self._trigger_zh_cn)\n\n    def _init_trans(self):\n        ctx.read_locale_config()  # \u81ea\u5b9a\u4e49\u7684\u65b9\u6cd5\uff0c\u7528\u6765\u8bfb\u53d6json\u6587\u4ef6\u4e2d\u7684\u914d\u7f6e\n        if ctx.g_locale_type == ctx.LOCALE_ZH_CH:\n            self._trigger_zh_cn()\n        elif ctx.g_locale_type == ctx.LOCALE_EN:\n            self._trigger_english()\n\n    def _trigger_english(self):\n        print \"[MainWindow] Change to English\"\n        self.trans.load(\"res/locale/en\")\n        _app = QApplication.instance()  # \u83b7\u53d6app\u5b9e\u4f8b\n        _app.installTranslator(self.trans)\n        self.ma.retranslateUi(self)\n        ctx.change_to_en()  # \u5c06\u65b0\u7684\u914d\u7f6e\u66f4\u65b0\u5165json\u6587\u4ef6\u4e2d\n\n    def _trigger_zh_cn(self):\n        print \"[MainWindow] Change to zh_CN\"\n        self.trans.load(\"res/locale/zh_CN\")\n        _app = QApplication.instance()\n        _app.installTranslator(self.trans)\n        self.ma.retranslateUi(self)\n        ctx.change_to_zh_cn()\n</code></pre>","tags":["PyQt"]},{"location":"pyqt/pyqt-pack-exe/","title":"PyQt \u6253\u5305\u6210exe\u6587\u4ef6","text":"\u66f4\u65b0\u65e5\u671f 2017-09-18 <ul> <li>2017-09-18 \u521b\u5efa\u6587\u6863</li> </ul>","tags":["PyQt"]},{"location":"pyqt/pyqt-pack-exe/#py2exe","title":"py2exe","text":"","tags":["PyQt"]},{"location":"pyqt/pyqt-pack-exe/#pyqt4-exe","title":"PyQt4 \u4e2d\u6253\u5305\u6210EXE\u6587\u4ef6","text":"<p>\u5c06\u67d0\u4e2aGUI\u7a0b\u5e8f\u6253\u5305\u6210EXE\u6587\u4ef6\u3002</p> <p>Python2.7\uff0c\u5728PyCharm\u4e2d\u76f4\u63a5\u6267\u884c\u8fd9\u4e2a\u6587\u4ef6\u3002</p> <pre><code># -*- coding: utf-8 -*-\n\nfrom distutils.core import setup\nimport py2exe\nimport sys\n\nimport main_window_re\n\n# this allows to run it with a simple double click.\nsys.argv.append('py2exe')\n\npy2exe_options = {\n    \"includes\": [\"sip\"],\n    \"dll_excludes\": [\"MSVCP90.dll\", ],\n    \"compressed\": 1,\n    \"optimize\": 2,\n    \"ascii\": 0,\n    \"bundle_files\": 1,\n}\n\nsetup(\n    name='Reliability_test',\n    version=main_window_re.VERSION_NAME,\n    windows=['main_window_re.py', ],\n    zipfile=None,\n    options={'py2exe': py2exe_options}\n)\n</code></pre> <p>\u5c1d\u8bd5\u8fc73.6\u548c3.5\u7248\u672c\uff0cpy2exe\u90fd\u4e0d\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002</p>","tags":["PyQt"]},{"location":"pyqt/pyqt-pack-exe/#pyinstaller","title":"pyinstaller","text":"<p>https://github.com/pyinstaller/pyinstaller/wiki/FAQ</p> <p>\u7531\u4e8e\u7535\u8111\u4e0a\u5b89\u88c5\u4e86\u591a\u4e2a\u7248\u672c\u7684Python\uff0c\u73af\u5883\u53d8\u91cf\u5236\u5b9a\u4e86Python2\u3002 \u8fd9\u91cc\u4f7f\u75283.5\u7248\u672c\u7684pyinstaller\u6765\u6253\u5305\u3002 \u6ce8\u610f<code>--paths</code>\u6307\u5b9a\u4e86\u8def\u5f84\u3002\u73af\u5883\u53d8\u91cf\u4e2d\u5e76\u6ca1\u6709\u8bbe\u7f6e\u8fd9\u4e2a\u8def\u5f84\u3002\u6211\u4eec\u6307\u5b9a\u53bb\u627ePyQt5\u7684\u4f9d\u8d56dll\u3002</p> <pre><code>  -p DIR, --paths DIR   A path to search for imports (like using PYTHONPATH).\n                        Multiple paths are allowed, separated by ';', or use\n                        this option multiple times\n</code></pre> <p>\u8def\u5f84\u6700\u597d\u662f\u52a0\u4e0a\u5f15\u53f7\uff0c\u6bd4\u5982\u8fd9\u91cc\u6307\u5b9aQt5\u548cPyQt5\u7684\u8def\u5f84 <pre><code>pyinstaller -p \"D:\\Qt\\Qt5\\5.6.3\\msvc2015\\bin\" -p \"D:\\Python27_qt5\\Lib\\site-packages\\PyQt5\" main_lab.py\n</code></pre></p> <pre><code>$ /d/python35/Scripts/pyinstaller --paths /d/python35/Lib/site-packages/PyQt5/Qt/bin --onefile main_lab.py\n106 INFO: PyInstaller: 3.2.1\n106 INFO: Python: 3.5.4rc1\n106 INFO: Platform: Windows-7-6.1.7601-SP1\n108 INFO: wrote E:\\ws\\eslab\\lab\\main_lab.spec\n109 INFO: UPX is not available.\n110 INFO: Extending PYTHONPATH with paths\n['E:\\\\ws\\\\eslab\\\\lab',\n 'D:\\\\python35\\\\Lib\\\\site-packages\\\\PyQt5\\\\Qt\\\\bin',\n 'E:\\\\ws\\\\eslab\\\\lab']\n......\n</code></pre> <p>\u751f\u6210\u5355\u4e2a\u7a97\u53e3EXE\u6587\u4ef6\u3002 <pre><code>$ /d/python35/Scripts/pyinstaller --paths /d/python35/Lib/site-packages/PyQt5/Qt/bin -F -w main_lab.py\n</code></pre></p> <p>\u751f\u6210exe\u6587\u4ef6\u540e\uff0c\u62a5\u4e86\u4e00\u4e2a\u627e\u4e0d\u5230<code>lab</code>\u6a21\u5757\u7684\u9519\u8bef\u3002 \u8fd9\u4e2a\u6a21\u5757\u521a\u597d\u5c31\u662f\u6211\u4eec\u4e3b\u754c\u9762\u6240\u5728\u7684\u6a21\u5757\u3002 \u5c06\u5f15\u7528\u7684\u6a21\u5757\u540d<code>lab</code>\u5220\u6389\u3002\u91cd\u65b0\u751f\u6210exe\u6587\u4ef6\u3002 <pre><code>from lab.file_utils import FileUtils\nfrom lab.mainwindow import Ui_MainWindow\n####################################\nfrom file_utils import FileUtils\nfrom mainwindow import Ui_MainWindow\n</code></pre></p>","tags":["PyQt"]},{"location":"pyqt/pyqt-pack-exe/#exe","title":"\u8fd0\u884cexe\u627e\u4e0d\u5230\u6a21\u5757\u62a5\u9519","text":"<p>\u4f7f\u7528\u9ed8\u8ba4\u65b9\u5f0f\u6253\u5305\uff0c\u5f97\u5230exe\u4e0e\u6587\u4ef6\u76ee\u5f55 <pre><code>pyinstaller main_lab.py\n</code></pre> \u5c06dist\u4e2d\u7684\u76ee\u5f55\u590d\u5236\u5230\u53e6\u4e00\u53f0\u7535\u8111\uff0c\u70b9\u51fb\u8fd0\u884cexe\u6587\u4ef6\uff1b\u63d0\u793a\u627e\u4e0d\u5230\u6a21\u5757 \u5728\u4e3bui\u6587\u4ef6\u4e2d\uff0c\u6dfb\u52a0\u8def\u5f84 <pre><code>import sys\nimport os\n\nsys.path.append(os.getcwd())  # Prepare path\n</code></pre></p> <p>\u627e\u4e0d\u5230\u6a21\u5757\uff0c\u4e00\u822c\u4f1a\u62a5 <code>ImportError: No module named 'xxx'</code> \u9519\u8bef \u6b64\u65f6\u4e00\u822c\u662f\u627e\u4e0d\u5230\u6211\u4eec\u81ea\u5df1\u5199\u7684\u6a21\u5757\u3002 <pre><code>from my_package.ui_main import Ui_MainWindow  # \u663e\u793a\u6307\u5b9a\u4e86my_package \u6253\u5305\u5f97\u5230\u7684exe\u4f1a\u627e\u4e0d\u5230\u8fd9\u4e2a\u5305\nfrom my_widget import DragInWidget  # \u4e0d\u663e\u793a\u6307\u5b9apackage  \u5426\u5219\u6253\u5305\u5f97\u5230\u7684exe\u4f1a\u627e\u4e0d\u5230\u5305\u800c\u65e0\u6cd5\u8fd0\u884c\n</code></pre></p>","tags":["PyQt"]},{"location":"pyqt/pyqt5-custom-QWidget-use/","title":"PyQt \u521b\u5efa\u81ea\u5b9a\u4e49QWidget","text":"\u66f4\u65b0\u65e5\u671f 2016-12-28 <ul> <li>2016-12-28 \u521b\u5efa\u6587\u6863</li> </ul>","tags":["PyQt"]},{"location":"pyqt/pyqt5-custom-QWidget-use/#pyqt5qtwidgets","title":"PyQt5.QtWidgets \u793a\u4f8b","text":"<p>Win7  PyCharm  Python3.5.1  PyQt5</p> <p>\u4e3b\u8981\u6587\u4ef6\uff1a <pre><code>|-- main.py\n|-- res\n|   `-- fish.jpg\n`-- ui\n    `-- app_widget.py\n</code></pre></p> <p><code>main.py</code> <pre><code>import sys\n\nfrom PyQt5.QtWidgets import QApplication\n\nfrom ui.app_widget import AppQWidget\n\nif __name__ == '__main__':\n    app = QApplication(sys.argv)\n    w = AppQWidget()\n    w.show()\n\n    sys.exit(app.exec_())\n</code></pre></p> <p><code>app_main_window.py</code>\u81ea\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5c45\u4e2d\u663e\u793a\u7684\u7a97\u53e3\uff0c\u5173\u95ed\u65f6\u5f39\u786e\u8ba4\u6846</p> <pre><code>from PyQt5.QtCore import QCoreApplication\nfrom PyQt5.QtGui import QIcon\nfrom PyQt5.QtWidgets import QWidget, QPushButton, QDesktopWidget, QMessageBox\n\n\nclass AppQWidget(QWidget):\n    \"\"\"\n    A custom QWidget by Rust Fisher\n    \"\"\"\n\n    def __init__(self):\n        super().__init__()\n        self.init_ui()\n\n    def init_ui(self):\n        # self.setGeometry(300, 300, 400, 200)  # \u76f8\u5f53\u4e8emove\u548cresize\n        self.resize(300, 200)\n        self.move_to_center()\n        self.setWindowTitle('Demo1')\n        self.setWindowIcon(QIcon('res/fish.jpg'))\n\n        btn1 = QPushButton('Quit', self)\n        btn1.setToolTip('Click to quit')\n        btn1.resize(btn1.sizeHint())\n        btn1.move(200, 150)\n        btn1.clicked.connect(QCoreApplication.instance().quit)  # cannot locate function connect\n\n    def closeEvent(self, event):\n        reply = QMessageBox.question(self, 'Message',\n                                     'Are you sure to quit now?',\n                                     QMessageBox.Yes | QMessageBox.No,\n                                     QMessageBox.No)\n        if reply == QMessageBox.Yes:\n            event.accept()\n        else:\n            event.ignore()\n\n    def move_to_center(self):\n        qr = self.frameGeometry()\n        cp = QDesktopWidget().availableGeometry().center()  # got center info here\n        qr.moveCenter(cp)\n        self.move(qr.topLeft())  # \u5e94\u7528\u7a97\u53e3\u7684\u5de6\u4e0a\u65b9\u7684\u70b9\u5230qr\u77e9\u5f62\u7684\u5de6\u4e0a\u65b9\u7684\u70b9\uff0c\u56e0\u6b64\u5c45\u4e2d\u663e\u793a\u5728\u6211\u4eec\u7684\u5c4f\u5e55\u4e0a\n</code></pre>","tags":["PyQt"]},{"location":"pyqt/pyqt5-custom-QWidget-use/#tips","title":"Tips","text":"","tags":["PyQt"]},{"location":"pyqt/pyqt5-custom-QWidget-use/#list","title":"\u591a\u63a7\u4ef6\u53ef\u4ee5\u5b58\u5728list\u4e2d","text":"<p>\u5b58\u5728\u4e00\u8d77\uff0c\u9700\u8981\u5bf9\u6574\u4f53\u64cd\u4f5c\u65f6\u76f4\u63a5\u904d\u5386\u5217\u8868</p> <pre><code>    # \u540c\u7ec4\u7684\u63a7\u4ef6\u53ef\u4ee5\u5b58\u5728\u540c\u4e00\u4e2alist\u4e2d\n    self.cb_list = [\n        self.ma.i2cCB,\n        self.ma.mipiCB,\n        self.ma.eepromCB,\n        self.ma.tem_sensorCB,\n        self.ma.lensCB,\n        self.ma.vcmCB,\n        self.ma.mirrorCB,\n        self.ma.mirrorCaliCB, ]\n\n    self.test_count_et_list = [\n        self.ma.i2cCountEt,\n        self.ma.mipiCountEt,\n        self.ma.eepromCountEt,\n        self.ma.tem_sensorCountEt,\n        self.ma.lensCountEt,\n        self.ma.vcmCountEt,\n        self.ma.mirrorCountEt,\n        self.ma.mirrorCaliCountEt,\n    ]\n\n# \u9700\u8981\u64cd\u4f5c\u67d0\u7ec4\u63a7\u4ef6\u65f6  \u76f4\u63a5\u904d\u5386\u5217\u8868\ndef _click_test_item_cb(self):\n    \"\"\" Update [choose all checkbox] by all test item state \"\"\"\n    choose_all = True\n    for cb in self.cb_list:\n        choose_all = choose_all &amp; cb.isChecked()\n    self.ma.selecteAllCB.setChecked(choose_all)\n</code></pre>","tags":["PyQt"]},{"location":"pyqt/pyqt5-custom-QWidget-use/#qapplicationqwidget","title":"<code>QApplication</code>\u4e0e<code>QWidget</code>","text":"<p><code>QApplication</code>\u662f\u4e00\u4e2a\u5355\u4f8b\uff0c\u5728<code>QWidget</code>\u4e2d\u53ef\u4ee5\u901a\u8fc7<code>QApplication.instance()</code>\u83b7\u53d6\u5230\u5bf9\u8c61</p> <p>\u5b9e\u9645\u4e0a\u5728\u5b9e\u4f8b\u5316QApplication\u524d\u5c31\u4f7f\u7528<code>QtGui.QWidget()</code>\u662f\u4f1a\u62a5\u9519\u7684 <pre><code>&gt;&gt;&gt; QtGui.QWidget()\nQWidget: Must construct a QApplication before a QPaintDevice\n</code></pre> \u53c2\u8003 How QApplication() and QWidget() objects are connected in PySide/PyQt?</p> <p>\u5728\u6211\u4eec\u81ea\u5b9a\u4e49\u7684<code>QMainWindow</code>\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u83b7\u53d6\u5230<code>QApplication</code>\u7684\u5b9e\u4f8b\u3002 <pre><code>class RustMainWindow(QMainWindow):\n    \"\"\" This is the main class \"\"\"\n\n    def _trigger_english(self):\n        print \"Change to English\", QApplication.instance()\n\n# Change to English &lt;PyQt4.QtGui.QApplication object at 0x02ABE3A0&gt;\n</code></pre></p>","tags":["PyQt"]},{"location":"pyqt/pyqt5-custom-QWidget-use/#widget","title":"\u6ce8\u610fwidget\u6301\u6709\u5916\u90e8\u5bf9\u8c61\u5f15\u7528\u7684\u95ee\u9898","text":"<p>\u5982\u679c\u5728\u7a0b\u5e8f\u542f\u52a8\u7684\u5730\u65b9\u5c06\u5f15\u7528\u4ea4\u7ed9widget\uff0c\u9000\u51fa\u65f6\u4f1a\u9020\u6210\u5e94\u7528\u65e0\u6cd5\u5173\u95ed\u7684\u95ee\u9898\uff08\u7c7b\u4f3c\u5185\u5b58\u6cc4\u6f0f\uff09\u3002 <pre><code>if __name__ == '__main__':\n    app = QApplication(sys.argv)\n    # \u8fd9\u91cc\u628aapp\u4ea4\u7ed9\u4e86MainWindow\uff0cMainWindow\u5173\u95ed\u65f6\u662f\u65e0\u6cd5\u6b63\u5e38\u9000\u51fa\u5e94\u7528\u7684\n    main_d = RustMainWindow(app)  # \u4e0d\u5efa\u8bae\u8fd9\u4e48\u505a\n    main_d.show()\n    sys.exit(app.exec_())\n</code></pre></p>","tags":["PyQt"]},{"location":"pyqt/pyqt5-install-license/","title":"PyQt5 \u5b89\u88c5\u5546\u4e1a\u7248","text":"\u66f4\u65b0\u65e5\u671f 2017-10-25 <ul> <li>2017-10-25 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u5bf9\u4e8eWindows7\u4e0a\u7684Python2\uff0c\u9700\u8981\u5982\u4e0b\u5de5\u5177\uff1a</p> <ul> <li>visual studio</li> <li>sip</li> <li>Qt(SDK)</li> </ul> <p>\u5982\u679c\u7535\u8111\u4e0a\u5df2\u7ecf\u88c5\u6709\u4e86PyQt4\uff0c\u5efa\u8bae\u518d\u88c5\u4e00\u4efdPython\u3002\u4e0e\u539f\u6765\u7684\u5206\u5f00\u3002</p>","tags":["PyQt"]},{"location":"pyqt/pyqt5-install-license/#win7visual-studio","title":"win7\u5b89\u88c5\u793e\u533a\u7248Visual Studio","text":"<p>\u4f7f\u7528Visual Studio\u662f\u4e3a\u4e86\u5b83\u7684\u7f16\u8bd1\u5de5\u5177\u548c\u76f8\u5173\u5e93\u3002\u5b89\u88c5\u65f6\u9009\u4e0aWindows SDK\u3002</p> <p>\u5bf9\u4e8eVS2017\u6765\u8bf4\uff0c\u4f7f\u7528\u7684\u662f\u8fd9\u4e2a\u5de5\u5177 \"D:\\Microsoft Visual Studio\\2017\\Community\\Common7\\Tools\\VsDevCmd.bat\" \u5f00\u59cb-\u6240\u6709\u7a0b\u5e8f-Visual Studio 2017-Visual Studio Tools</p> <p>vs\u5b89\u88c5\u8def\u5f84 <code>D:\\Microsoft Visual Studio</code></p> <p>\u73af\u5883\u53d8\u91cf <pre><code>D:\\Microsoft Visual Studio\\2017\\Community\\VC\\Tools\\MSVC\\14.11.25503\\bin\\Hostx64\\x64;\nD:\\Microsoft Visual Studio\\2017\\Community\\VC\\Tools\\MSVC\\14.11.25503\\lib;\n</code></pre></p>","tags":["PyQt"]},{"location":"pyqt/pyqt5-install-license/#python27sip","title":"Python2.7\u5b89\u88c5sip","text":"<p>win7 64\u4f4d\u7cfb\u7edf\uff0c\u4f46Python2.7\u662f32\u4f4d</p> <p>\u4e0b\u8f7dsip\u6e90\u7801\u5305\uff08\u4f8b\u5982sip-4.19.3\uff09\uff0c\u89e3\u538b\u5230\u4efb\u610f\u4f4d\u7f6e\u3002\u8fdb\u5165sip\u6e90\u7801\u5305\uff0c\u6267\u884c <pre><code>python configure.py\n</code></pre> \u8fd9\u91ccPython2.7\u5b89\u88c5\u5728<code>D:\\python27</code>\uff1b\u4e8e\u662fsip\u4f4d\u7f6e\u5728<code>D:\\python27\\Lib\\site-packages\\sip-4.19.3</code> \u6253\u5f00vs\u7684\u547d\u4ee4\u884c\uff0c\u8fdb\u5165sip\u5728Python\u4e2d\u7684\u76ee\u5f55\uff0c\u6267\u884c <pre><code>nmake\nnmake install\n</code></pre></p>","tags":["PyQt"]},{"location":"pyqt/pyqt5-install-license/#win7qt5","title":"win7\u5b89\u88c5Qt5","text":"<p>\u5230Qt\u5b98\u7f51\u4e0b\u8f7d\u5b89\u88c5\u5305\u3002\u4e3a\u4e86\u7167\u987e32\u4f4d\u7684Python2.7\uff0c\u8fd9\u91cc\u9009\u62e9Qt 5.6.3 for Windows 32-bit (VS 2015, 869 MB)</p> <p>\u6dfb\u52a0\u5230\u73af\u5883\u53d8\u91cf\u4e2d <pre><code>D:\\Qt\\Qt5\\5.6.3\\msvc2015\\bin;D:\\Qt\\Qt5\\Tools\\QtCreator\\bin\n</code></pre></p>","tags":["PyQt"]},{"location":"pyqt/pyqt5-install-license/#win7pyqt5","title":"win7\u7f16\u8bd1\u5b89\u88c5\u5546\u4e1a\u7248PyQt5","text":"<p>Python2.7</p> <pre><code>python configure.py --disable QtNfc\nnmake\nnmake install\n</code></pre> <p>\u53c2\u8003PyQt5\u7684README <pre><code>COMMERCIAL VERSION\n\nIf you have the Commercial version of PyQt5 then you should also have a\nlicense file that you downloaded separately.  The license file must be copied\nto the \"sip\" directory before starting to build PyQt5.\n</code></pre> \u6211\u4eec\u628a\u4e70\u6765\u7684license\u6587\u4ef6\u590d\u5236\u5230sip\u76ee\u5f55\u4e0b\u3002</p> <p>\u5728<code>E:\\ws\\doc\\PyQtCommercial\\PyQt5_commercial-5.9</code>\u4e2d\uff0c\u628a\u4ed8\u8d39\u540e\u5f97\u5230\u7684<code>pyqt-commercial.sip</code>\u590d\u5236\u5230sip\u76ee\u5f55\u4e0b</p> <p>\u4f7f\u7528vs2017\u7684\u547d\u4ee4\u884c\u5de5\u5177\uff01</p> <p><code>python configure.py</code>\u51fa\u73b0\u9519\u8bef <pre><code>Error: Use the --qmake argument to explicitly specify a working Qt qmake.\n</code></pre> \u7f51\u4e0a\u8bf4\u662f\u56e0\u4e3a\u6ca1\u6709\u914d\u7f6e\u597dQt SDK\u7684\u539f\u56e0 \u53ef\u53c2\u8003 PyQt setup for Qt 4.7.4 \u89e3\u51b3\u9519\u8bef\u540e\uff0c\u4f1a\u63d0\u793a\u662f\u5426\u63a5\u53d7license\u3002\u6839\u636e\u63d0\u793a\u8f93\u5165yes\u3002</p> <p>\u6267\u884c<code>python configure.py --disable QtNfc</code> <pre><code>Querying qmake about your Qt installation...\nDetermining the details of your Qt installation...\nThis is the commercial version of PyQt 5.9 (licensed under the PyQt Commercial\nLicense) for Python 2.7.13 on win32.\n</code></pre></p>","tags":["PyQt"]},{"location":"pyqt/pyqt5-install-license/#nmake-cannot-open-file-msvcprtlib","title":"nmake\u62a5\u9519 cannot open file \u201cmsvcprt.lib\u201d","text":"<p><pre><code>fatal error LNK1104: cannot open file \u201cmsvcprt.lib\u201d\n</code></pre> \u628alib\u8def\u5f84\u6dfb\u52a0\u5230\u73af\u5883\u53d8\u91cf <code>D:\\Microsoft Visual Studio\\2017\\Community\\VC\\Tools\\MSVC\\14.11.25503\\lib;</code></p>","tags":["PyQt"]},{"location":"pyqt/pyqt5-install-license/#nmake-qtnfcdll-fatal-error-lnk1169-one-or-more-multiply-defined-symbols-found","title":"nmake\u62a5\u9519 QtNfc.dll : fatal error LNK1169: one or more multiply defined symbols found","text":"<p><pre><code>release\\QtNfc.dll : fatal error LNK1169: \u627e\u5230\u4e00\u4e2a\u6216\u591a\u4e2a\u591a\u91cd\u5b9a\u4e49\u7684\u7b26\u53f7\nNMAKE : fatal error U1077: \u201c\"D:\\Microsoft Visual Studio\\2017\\Community\\VC\\Tools\n\\MSVC\\14.11.25503\\bin\\HostX86\\x86\\link.EXE\"\u201d: \u8fd4\u56de\u4ee3\u7801\u201c0x491\u201d\nStop.\nNMAKE : fatal error U1077: \u201c\"D:\\Microsoft Visual Studio\\2017\\Community\\VC\\Tools\n\\MSVC\\14.11.25503\\bin\\HostX86\\x86\\nmake.exe\"\u201d: \u8fd4\u56de\u4ee3\u7801\u201c0x2\u201d\nStop.\nNMAKE : fatal error U1077: \u201ccd\u201d: \u8fd4\u56de\u4ee3\u7801\u201c0x2\u201d\nStop.\n</code></pre> \u7f51\u4e0a\u6709\u76f8\u5173\u7684\u5efa\u8bae\uff0c\u628aQtNfc\u201c\u53d6\u6d88\u201d\u6389\uff0c\u5176\u5b9e\u5c31\u662f\u4e0d\u7f16\u8bd1QtNfc\u3002</p> <p><code>E:\\ws\\doc\\PyQtCommercial\\PyQt5_commercial-5.9&gt;python configure.py --disable QtNfc</code></p> <p>http://python.6.x6.nabble.com/error-building-QtNfc-td5185657.html</p> <p><code>nmake</code> \u9700\u8981\u4e00\u6bb5\u65f6\u95f4\u3002\u7535\u8111\u6bd4\u8f83\u5dee\u7684\u8bdd\uff0c\u5927\u6982\u89811\u4e2a\u5c0f\u65f6\u3002 <code>nmake install</code> \u8017\u65f6\u7ea65\u5206\u949f</p>","tags":["PyQt"]},{"location":"pyqt/pyqt5-install-license/#pyqt5_1","title":"\u8bd5\u8fd0\u884cPyQt5","text":"<p>\u5bfc\u5165PyQt5\u6a21\u5757\u8bd5\u4e00\u8bd5 <pre><code>from PyQt5.QtCore import QTranslator\nfrom PyQt5.QtGui import *\nfrom PyQt5.QtWidgets import *\n</code></pre></p> <p>\u5bf9\u4e8ePython2.7 PyQt5\uff0c\u4f7f\u7528pyinstaller\u6765\u6253\u5305\u6210exe\u6587\u4ef6 <pre><code>pyinstaller ui_main.py\n</code></pre> \u5f97\u5230\u76f8\u5e94\u7684\u6587\u4ef6\u76ee\u5f55</p>","tags":["PyQt"]},{"location":"pyqt/pyqt5-install-license/#exeqt-platform-plugin","title":"\u8fd0\u884cexe\u5f39\u7a97\u62a5\u9519<code>Qt platform plugin</code>","text":"<p><pre><code>this application failed to start because it could not find or load the Qt platform plugin \"windows\" in \"\"\nReinstalling the application may fix this problem.\n</code></pre> \u62a5\u9519\u539f\u56e0\u662f\u627e\u4e0d\u5230 <code>Qt platform plugin</code> \u5728Qt5\uff0c\u5728\u5b89\u88c5\u76ee\u5f55\u4e0b\u53ef\u627e\u5230 <code>D:\\Qt\\Qt5\\Tools\\QtCreator\\bin\\plugins\\platforms</code> \u5bf9\u4e8ePython3\uff0c\u5b89\u88c5\u4e86GPL\u7684PyQt5\uff0c\u53ef\u4ee5\u627e\u5230 <code>D:\\python35\\Lib\\site-packages\\PyQt5\\Qt\\plugins\\platforms</code></p> <p>\u5904\u7406\u65b9\u6cd5\uff1a \u4e0d\u6253\u5305\u6210\u4e00\u4e2a\u5355\u4e00\u7684exe\u6587\u4ef6\uff0c\u4f7f\u7528<code>pyinstaller ui_main.py</code>\u751f\u6210\u6587\u4ef6\u76ee\u5f55 \u5728dist\u4e2d\uff0c\u4e0eexe\u6587\u4ef6\u540c\u7ea7\u7684\u76ee\u5f55<code>PyQt5/qt/plugins</code>\u4e2d\uff0c\u6709platforms\u76ee\u5f55 \u628aplatforms\u6587\u4ef6\u5939\u590d\u5236\u5230\u4e0eexe\u6587\u4ef6\u540c\u7ea7\u7684\u4f4d\u7f6e\u5373\u53ef  </p>","tags":["PyQt"]},{"location":"pyqt/pyqt5-install-license/#_1","title":"\u53c2\u8003","text":"<p>How to install PyQt5 on Windows for Python 2?</p> <p>\u7f16\u8bd1\u5b89\u88c5PyQt5\u7684\u8fc7\u7a0b</p> <p>\u5b89\u88c5sip\u7684\u5efa\u8bae</p>","tags":["PyQt"]},{"location":"python/basic/dictionary-JSON-file/","title":"Python3 JSON\u4e0eDictionary\u7b80\u4ecb","text":"\u66f4\u65b0\u65e5\u671f 2017-05-05 <ul> <li>2017-05-05 \u521b\u5efa\u6587\u6863</li> </ul> <ul> <li>Python3</li> <li>PyCharm CE</li> </ul>","tags":["Python"]},{"location":"python/basic/dictionary-JSON-file/#json","title":"JSON\u7b80\u4ecb","text":"<p>JSON(JavaScript Object Notation)\u662f\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7684\u6570\u636e\u4ea4\u6362\u683c\u5f0f\u3002 \u5b83\u662f\u4e00\u79cd\u6587\u672c\u683c\u5f0f\u3002\u5b83\u7684\u7ed3\u6784\u4e3b\u8981\u7531\u952e\u503c\u5bf9\u6765\u6784\u6210\u3002 \u4e00\u4e2a\u952e\uff08key\uff09\u5bf9\u5e94\u4e00\u4e2a\u503c\uff08value\uff09\u3002\u6700\u5916\u56f4\u7528\u5927\u62ec\u53f7<code>{ }</code>\u5305\u56f4\u8d77\u6765\u3002</p> <p>\u4f8b\u5982 <pre><code>{\n    \"firstName\": \"Rust\",\n    \"lastName\": \"Fisher\"\n}\n</code></pre></p> <p>\u5927\u62ec\u53f7\u62ec\u8d77\u6765\u7684\u53eb\u505a\u5bf9\u8c61\u7ed3\u6784\u3002</p> <p>JSON\u91cc\u4e5f\u53ef\u4ee5\u653e\u6570\u7ec4\u3002\u7528\u4e2d\u62ec\u53f7<code>[ ]</code>\u62ec\u8d77\u6765\u3002\u53eb\u505a\u6570\u7ec4\u7ed3\u6784\u3002 <pre><code>{\n    \"desc\":\"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\",\n    \"userInfo\":{\n        \"firstName\":\"Rust\",\n        \"lastName\":\"Fisher\"\n    },\n    \"books\":[\n        \"Python\u5165\u95e8\",\n        \"Python\u8fdb\u9636\",\n        \"\u6570\u636e\u5206\u6790\",\n        \"\u53ef\u89c6\u5316\"\n    ]\n}\n</code></pre></p> <p>\u5bf9\u8c61\u7ed3\u6784\u548c\u6570\u7ec4\u7ed3\u6784\u53ef\u4ee5\u540c\u65f6\u5b58\u5728\uff0c\u53ea\u8981\u6ee1\u8db3\u952e\u503c\u5bf9\u7684\u8981\u6c42\u5373\u53ef\u3002</p> <p>\u6700\u5916\u5c42\u4e5f\u53ef\u4ee5\u662f\u4e2d\u62ec\u53f7\u62ec\u8d77\u6765\u7684\uff0c\u91cc\u9762\u5b58\u653e\u7740\u591a\u4e2a\u5bf9\u8c61\u3002 <pre><code>[\n    {\n        \"firstName\": \"Tom\",\n        \"lastName\": \"Hanks\",\n        \"movies\": [\"Cast Away\"]\n    },\n    {\n        \"userInfo\": {\n            \"firstName\": \"Rust\",\n            \"lastName\": \"Fisher\"\n        },\n        \"books\": [\"Python\u5165\u95e8\", \"Python\u8fdb\u9636\"],\n        \"desc\": \"\u53ef\u4ee5\u76f4\u63a5\u6dfb\u52a0\u4e00\u4e2akey-value\u8fdb\u53bb\"\n    }\n]\n</code></pre></p>","tags":["Python"]},{"location":"python/basic/dictionary-JSON-file/#pythondictionary","title":"Python\u7684Dictionary\uff08\u5b57\u5178\uff09\u7b80\u4ecb","text":"<p>Dictionary\uff08\u4ee5\u4e0b\u7b80\u79f0\u4e3adict\u6216\u5b57\u5178\uff09\u662f\u4e00\u79cd\u952e\u503c\u5bf9\u6570\u636e\u7ed3\u6784\u3002 \u6709\u70b9\u50cfJava\u91cc\u7684Map\u548cSet\u3002</p> <p>\u521d\u59cb\u5316\u4e00\u4e2adict\u53ef\u4ee5\u76f4\u63a5\u7528\u5927\u62ec\u53f7\u3002\u91cc\u9762\u5199\u4e0akey\u548cvalue\u3002 <pre><code>def use_dict():\n    user_info = {'firstName': 'Rust', 'lastName': 'Fisher'}\n    books = ['Python\u5165\u95e8']\n    books.append('Python\u8fdb\u9636')\n    result = {'userInfo': user_info, 'books': books}\n    result['desc'] = '\u53ef\u4ee5\u76f4\u63a5\u6dfb\u52a0\u4e00\u4e2akey-value\u8fdb\u53bb'\n    print(result)\n\n# \u8fd0\u884c\u7ed3\u679c\n# {'userInfo': {'firstName': 'Rust', 'lastName': 'Fisher'}, 'books': ['Python\u5165\u95e8', 'Python\u8fdb\u9636'], 'desc': '\u53ef\u4ee5\u76f4\u63a5\u6dfb\u52a0\u4e00\u4e2akey-value\u8fdb\u53bb'}\n</code></pre> \u53ef\u4ee5\u770b\u5230\uff0cdict\u548cJSON\u6709\u4e9b\u7c7b\u4f3c\u3002\u90fd\u662f\u952e\u503c\u5bf9\uff0c\u90fd\u6709\u6570\u7ec4\u7ed3\u6784\u3002 \u4ecePython\u8bed\u6cd5\u4e0a\u6765\u770b\uff0cdict\u64cd\u4f5c\u8d77\u6765\u4e5f\u6bd4\u8f83\u7b80\u5355\u3002\u627e\u5230\u786e\u5b9a\u7684key\u540e\uff0c\u53ef\u4ee5\u76f4\u63a5\u8d4b\u503c\u3002</p>","tags":["Python"]},{"location":"python/basic/dictionary-JSON-file/#dictionary-json","title":"Dictionary \u8f6c\u4e3aJSON","text":"<p>Python\u4e2d\u7684dict\u662f\u4e00\u79cd\u952e\u503c\u5bf9\u7684\u6570\u636e\u7ed3\u6784\u3002 JSON\u662f\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7684\u6570\u636e\u4ea4\u6362\u683c\u5f0f\uff0c\u5b83\u662f\u4e00\u79cd\u6587\u672c\u683c\u5f0f\u3002 \u5b83\u4eec\u90fd\u662f\u4ee5\u952e\u503c\u5bf9\u4e3a\u57fa\u7840\u3002\u90a3\u4e48\u5b83\u4eec\u5e94\u8be5\u80fd\u76f8\u4e92\u8f6c\u6362\u3002</p> <p>\u5c06dict\u8f6c\u4e3aJSON\uff0c\u8fd9\u91cc\u5229\u7528<code>json</code>\u5305\u91cc\u63d0\u4f9b\u7684<code>dumps</code>\u65b9\u6cd5\u3002</p> <p><code>dumps</code>\u65b9\u6cd5\u5c06\u4f20\u5165\u7684dict\u8f6c\u6362\u6210JSON\u683c\u5f0f\u7684\u6587\u672c\u3002</p> <p>\u5f15\u5165<code>json</code>\u5305 <pre><code>import json\n</code></pre></p> <p>\u6211\u4eec\u5199\u51fa\u4e86\u7b2c\u4e00\u4e2adict\u8f6cJSON\u7684\u65b9\u6cd5 <pre><code>def to_json1(input_dict):\n    print('input:', input_dict)\n    jsonTxt = json.dumps(input_dict)\n    print(jsonTxt)\n</code></pre></p> <p>\u8f93\u51fa\uff1a <pre><code>input: {'userInfo': {'firstName': 'Rust', 'lastName': 'Fisher'}, 'books': ['Python\u5165\u95e8', 'Python\u8fdb\u9636'], 'desc': '\u53ef\u4ee5\u76f4\u63a5\u6dfb\u52a0\u4e00\u4e2akey-value\u8fdb\u53bb'}\n{\"userInfo\": {\"firstName\": \"Rust\", \"lastName\": \"Fisher\"}, \"books\": [\"Python\\u5165\\u95e8\", \"Python\\u8fdb\\u9636\"], \"desc\": \"\\u53ef\\u4ee5\\u76f4\\u63a5\\u6dfb\\u52a0\\u4e00\\u4e2akey-value\\u8fdb\\u53bb\"}\n</code></pre></p> <p>\u4e2d\u6587\u5b57\u7b26\u90fd\u53d8\u6210\u4e86\u5b57\u6bcd\u548c\u6570\u5b57\u7b26\u53f7\u3002\u8fd9\u6709\u70b9\u51fa\u4e4e\u6211\u4eec\u610f\u6599\u3002</p> <p>\u6d89\u53ca\u5230\u4e2d\u6587\u5b57\u7b26\u7684\u65f6\u5019\uff0c\u9700\u8981<code>dumps</code>\u65b9\u6cd5\u91cc\u6307\u5b9a<code>ensure_ascii=False</code></p> <p><pre><code>def to_json2(input_dict):\n    print('input:', input_dict)\n    jsonTxt = json.dumps(input_dict, ensure_ascii=False)\n    print(jsonTxt)\n</code></pre> \u8f93\u51fa: <pre><code>input: {'userInfo': {'firstName': 'Rust', 'lastName': 'Fisher'}, 'books': ['Python\u5165\u95e8', 'Python\u8fdb\u9636'], 'desc': '\u53ef\u4ee5\u76f4\u63a5\u6dfb\u52a0\u4e00\u4e2akey-value\u8fdb\u53bb'}\n{\"userInfo\": {\"firstName\": \"Rust\", \"lastName\": \"Fisher\"}, \"books\": [\"Python\u5165\u95e8\", \"Python\u8fdb\u9636\"], \"desc\": \"\u53ef\u4ee5\u76f4\u63a5\u6dfb\u52a0\u4e00\u4e2akey-value\u8fdb\u53bb\"}\n</code></pre> \u8fd9\u6837\u4e2d\u6587\u5b57\u7b26\u5c31ok\u4e86\u3002</p>","tags":["Python"]},{"location":"python/basic/dictionary-JSON-file/#listjson","title":"list\u8f6c\u4e3aJSON","text":"<p>list\u4e2d\u5b58\u50a8\u7740\u591a\u4e2adict\u3002\u53ef\u4ee5\u76f4\u63a5\u628alist\u8f6c\u4e3aJSON\u3002</p> <p>\u63a5\u4e0a\u9762\u7684\u4ee3\u7801</p> <pre><code>def list_json_demo():\n    tom_hanks = {'firstName': 'Tom', 'lastName': 'Hanks', 'movies': ['Cast Away']}\n    info = use_dict()\n    list = [tom_hanks, info]\n    jsonTxt = json.dumps(list, ensure_ascii=False)\n    print(jsonTxt)\n    return jsonTxt\n</code></pre> <p>\u8f93\u51fa\u7684JSON\u90e8\u5206\uff1a <pre><code>[{\"firstName\": \"Tom\", \"lastName\": \"Hanks\", \"movies\": [\"Cast Away\"]}, {\"userInfo\": {\"firstName\": \"Rust\", \"lastName\": \"Fisher\"}, \"books\": [\"Python\u5165\u95e8\", \"Python\u8fdb\u9636\"], \"desc\": \"\u53ef\u4ee5\u76f4\u63a5\u6dfb\u52a0\u4e00\u4e2akey-value\u8fdb\u53bb\"}]\n</code></pre></p>","tags":["Python"]},{"location":"python/basic/dictionary-JSON-file/#json_1","title":"\u8bfb\u53d6JSON\u6587\u672c","text":"<p>\u7528<code>json.loads</code>\u65b9\u6cd5\u5c06\u8f93\u5165\u7684JSON\u6587\u672c\u8f6c\u4e3a\u5bf9\u8c61\u3002</p> <p><pre><code>def json_to_dict1(jsonTxt):\n    obj1 = json.loads(jsonTxt)\n    print(obj1)\n</code></pre> \u5f97\u5230\u7684\u5bf9\u8c61\u53ef\u80fd\u662f\u6570\u7ec4\u6216\u8005\u662fdict\u3002</p>","tags":["Python"]},{"location":"python/basic/dictionary-JSON-file/#json_2","title":"\u8bfb\u53d6JSON\u6587\u4ef6","text":"<p>\u5148\u6253\u5f00\u6587\u4ef6\uff0c\u7528<code>json.load</code>\u65b9\u6cd5\uff0c\u8bfb\u53d6JSON\u5185\u5bb9 <pre><code>with open(json_file_path) as json_file:\n    json_content = json.load(json_file) # \u8bfb\u53d6\u51fa\u6765\u7684\u662fdict\n    # ...\n</code></pre></p>","tags":["Python"]},{"location":"python/basic/get-path/","title":"Python2.7 \u4e2d\u83b7\u53d6\u8def\u5f84\u7684\u5404\u79cd\u65b9\u6cd5","text":"\u66f4\u65b0\u65e5\u671f 2017-07-31 <ul> <li>2017-07-31 \u521b\u5efa\u6587\u6863</li> </ul>","tags":["Python"]},{"location":"python/basic/get-path/#syspath","title":"<code>sys.path</code>","text":"<p>\u6a21\u5757\u641c\u7d22\u8def\u5f84\u7684\u5b57\u7b26\u4e32\u5217\u8868\u3002\u7531\u73af\u5883\u53d8\u91cfPYTHONPATH\u521d\u59cb\u5316\u5f97\u5230\u3002 sys.path[0]\u662f\u8c03\u7528Python\u89e3\u91ca\u5668\u7684\u5f53\u524d\u811a\u672c\u6240\u5728\u7684\u76ee\u5f55\u3002</p>","tags":["Python"]},{"location":"python/basic/get-path/#sysargv","title":"<code>sys.argv</code>","text":"<p>\u4e00\u4e2a\u4f20\u7ed9Python\u811a\u672c\u7684\u6307\u4ee4\u53c2\u6570\u5217\u8868\u3002 sys.argv[0]\u662f\u811a\u672c\u7684\u540d\u5b57\uff08\u7531\u7cfb\u7edf\u51b3\u5b9a\u662f\u5426\u662f\u5168\u540d\uff09 \u5047\u8bbe\u663e\u793a\u8c03\u7528python\u6307\u4ee4\uff0c\u5982<code>python demo.py</code>\uff0c\u4f1a\u5f97\u5230\u7edd\u5bf9\u8def\u5f84\uff1b \u82e5\u76f4\u63a5\u6267\u884c\u811a\u672c\uff0c\u5982<code>./demo.py</code>\uff0c\u4f1a\u5f97\u5230\u76f8\u5bf9\u8def\u5f84\u3002</p>","tags":["Python"]},{"location":"python/basic/get-path/#osgetcwd","title":"<code>os.getcwd()</code>","text":"<p>\u83b7\u53d6\u5f53\u524d\u5de5\u4f5c\u8def\u5f84\u3002\u5728\u8fd9\u91cc\u662f\u7edd\u5bf9\u8def\u5f84\u3002 https://docs.python.org/2/library/os.html#os.getcwd</p>","tags":["Python"]},{"location":"python/basic/get-path/#__file__","title":"<code>__file__</code>","text":"<p>\u83b7\u5f97\u6a21\u5757\u6240\u5728\u7684\u8def\u5f84\uff0c\u53ef\u80fd\u5f97\u5230\u76f8\u5bf9\u8def\u5f84\u3002 \u5982\u679c\u663e\u793a\u6267\u884cPython\uff0c\u4f1a\u5f97\u5230\u7edd\u5bf9\u8def\u5f84\u3002 \u82e5\u6309\u76f8\u5bf9\u8def\u5f84\u6765\u76f4\u63a5\u6267\u884c\u811a\u672c<code>./pyws/path_demo.py</code>\uff0c\u4f1a\u5f97\u5230\u76f8\u5bf9\u8def\u5f84\u3002 \u4e3a\u4e86\u83b7\u53d6\u7edd\u5bf9\u8def\u5f84\uff0c\u53ef\u8c03\u7528<code>os.path.abspath()</code></p>","tags":["Python"]},{"location":"python/basic/get-path/#ospath","title":"os.path \u4e2d\u7684\u4e00\u4e9b\u65b9\u6cd5","text":"","tags":["Python"]},{"location":"python/basic/get-path/#ospathsplitpath","title":"<code>os.path.split(path)</code>","text":"<p>\u5c06\u8def\u5f84\u540d\u79f0\u5206\u6210\u5934\u548c\u5c3e\u4e00\u5bf9\u3002\u5c3e\u90e8\u6c38\u8fdc\u4e0d\u4f1a\u5e26\u6709\u659c\u6760\u3002\u5982\u679c\u8f93\u5165\u7684\u8def\u5f84\u4ee5\u659c\u6760\u7ed3\u5c3e\uff0c\u90a3\u4e48\u5f97\u5230\u7684\u7a7a\u7684\u5c3e\u90e8\u3002 \u5982\u679c\u8f93\u5165\u8def\u5f84\u6ca1\u6709\u659c\u6760\uff0c\u90a3\u4e48\u5934\u90e8\u4f4d\u4e3a\u7a7a\u3002\u5982\u679c\u8f93\u5165\u8def\u5f84\u4e3a\u7a7a\uff0c\u90a3\u4e48\u5f97\u5230\u7684\u5934\u548c\u5c3e\u90fd\u662f\u7a7a\u3002 https://docs.python.org/2/library/os.path.html#os.path.split</p>","tags":["Python"]},{"location":"python/basic/get-path/#ospathrealpathpath","title":"<code>os.path.realpath(path)</code>","text":"<p>\u8fd4\u56de\u7279\u5b9a\u6587\u4ef6\u540d\u7684\u7edd\u5bf9\u8def\u5f84\u3002 https://docs.python.org/2/library/os.path.html#os.path.realpath</p>","tags":["Python"]},{"location":"python/basic/get-path/#_1","title":"\u4ee3\u7801\u793a\u4f8b","text":"<p>\u73af\u5883 Win7, Python2.7 \u4ee5<code>/e/pyws/path_demo.py</code>\u4e3a\u4f8b <pre><code>#!/usr/bin/env python\nimport os\nimport sys\n\nif __name__ == '__main__':\n    print \"sys.path[0] =\", sys.path[0]\n    print \"sys.argv[0] =\", sys.argv[0]\n    print \"__file__ =\", __file__\n    print \"os.path.abspath(__file__) =\", os.path.abspath(__file__)\n    print \"os.path.realpath(__file__) = \", os.path.realpath(__file__)\n    print \"os.path.dirname(os.path.realpath(__file__)) =\", os.path.dirname(os.path.realpath(__file__))\n    print \"os.path.split(os.path.realpath(__file__)) =\", os.path.split(os.path.realpath(__file__))\n    print \"os.getcwd() =\", os.getcwd()\n</code></pre></p> <p>\u5728<code>/d</code>\u4e2d\u8fd0\u884c\uff0c\u8f93\u51fa\u4e3a <pre><code>$ python /e/pyws/path_demo.py\nsys.path[0] = E:\\pyws\nsys.argv[0] = E:/pyws/path_demo.py\n__file__ = E:/pyws/path_demo.py\nos.path.abspath(__file__) = E:\\pyws\\path_demo.py\nos.path.realpath(__file__) =  E:\\pyws\\path_demo.py\nos.path.dirname(os.path.realpath(__file__)) = E:\\pyws\nos.path.split(os.path.realpath(__file__)) = ('E:\\\\pyws', 'path_demo.py')\nos.getcwd() = D:\\\n</code></pre></p> <p>\u5728e\u76d8\u4e2d\u7528\u547d\u4ee4\u884c\u76f4\u63a5\u6267\u884c\u811a\u672c <pre><code>$ ./pyws/path_demo.py\nsys.path[0] = E:\\pyws\nsys.argv[0] = ./pyws/path_demo.py\n__file__ = ./pyws/path_demo.py\nos.path.abspath(__file__) = E:\\pyws\\path_demo.py\nos.path.realpath(__file__) =  E:\\pyws\\path_demo.py\nos.path.dirname(os.path.realpath(__file__)) = E:\\pyws\nos.path.split(os.path.realpath(__file__)) = ('E:\\\\pyws', 'path_demo.py')\nos.getcwd() = E:\\\n</code></pre></p>","tags":["Python"]},{"location":"python/basic/pip-solution/","title":"pip\u76f8\u5173","text":"\u66f4\u65b0\u65e5\u671f 2017-07-31 <ul> <li>2017-07-31 \u521b\u5efa\u6587\u6863</li> </ul> <ul> <li>Ubuntu 14.04</li> </ul>","tags":["Python"]},{"location":"python/basic/pip-solution/#pip_1","title":"pip \u4f7f\u7528\u56fd\u5185\u955c\u50cf\u6e90","text":"<p>\u4f7f\u7528pip install \u7684\u65f6\u5019\u603b\u662f\u51fa\u73b0read timeout \u4e4b\u7c7b\u7684\u9519\u8bef</p> <p>\u4f7f\u7528\u56fd\u5185\u955c\u50cf  <code>https://pypi.tuna.tsinghua.edu.cn/simple</code> \u4f8b\u5982\u6211\u8981\u5b89\u88c5 scrapy <pre><code>pip install -i https://pypi.tuna.tsinghua.edu.cn/simple scrapy\n</code></pre></p> <p>\u6dfb\u52a0\u6e90\u7684\u914d\u7f6e</p> <p>Linux\u4e0b\uff0c\u4fee\u6539 ~/.pip/pip.conf (\u6ca1\u6709\u5c31\u521b\u5efa\u4e00\u4e2a)\uff0c \u4fee\u6539 index-url\u81f3tuna\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a <pre><code>[global]\nindex-url = https://pypi.tuna.tsinghua.edu.cn/simple\n</code></pre></p> <p>windows\u4e0b\uff0c\u76f4\u63a5\u5728user\u76ee\u5f55\u4e2d\u521b\u5efa\u4e00\u4e2apip\u76ee\u5f55\uff0c\u5982\uff1aC:\\Users\\xx\\pip\uff0c\u65b0\u5efa\u6587\u4ef6pip.ini\uff0c\u5185\u5bb9\u5982\u4e0b <pre><code>[global]\nindex-url = https://pypi.tuna.tsinghua.edu.cn/simple\n</code></pre></p>","tags":["Python"]},{"location":"python/basic/pip-solution/#pip-install","title":"<code>pip install</code> \u51fa\u9519","text":"<pre><code>$ pip install pycairo\nCollecting pycairo\n  Downloading https://files.pythonhosted.org/packages/e8/9d/c8be300fc6b1298559d37a071c3833b0b251e0fff334d2e4c408d5789162/pycairo-1.19.1.tar.gz (205kB)\n    100% |\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 215kB 644kB/s \nInstalling collected packages: pycairo\n  Running setup.py install for pycairo ... error\n    Complete output from command /Users/rustfisher/Desktop/intGo/studySR/venv/bin/python -u -c \"import setuptools, tokenize;__file__='/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-jhvl5plj/pycairo/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\\r\\n', '\\n');f.close();exec(compile(code, __file__, 'exec'))\" install --record /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-record-dqg8zbp0/install-record.txt --single-version-externally-managed --compile --install-headers /Users/rustfisher/Desktop/intGo/studySR/venv/include/site/python3.7/pycairo:\n    running install\n    running build\n    running build_py\n    creating build\n    creating build/lib.macosx-10.9-x86_64-3.7\n    creating build/lib.macosx-10.9-x86_64-3.7/cairo\n    copying cairo/__init__.py -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo\n    copying cairo/__init__.pyi -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo\n    copying cairo/py.typed -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo\n    running build_ext\n    [Errno 20] Not a directory: 'pkg-config'\n\n    ----------------------------------------\nCommand \"/Users/rustfisher/Desktop/intGo/studySR/venv/bin/python -u -c \"import setuptools, tokenize;__file__='/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-jhvl5plj/pycairo/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\\r\\n', '\\n');f.close();exec(compile(code, __file__, 'exec'))\" install --record /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-record-dqg8zbp0/install-record.txt --single-version-externally-managed --compile --install-headers /Users/rustfisher/Desktop/intGo/studySR/venv/include/site/python3.7/pycairo\" failed with error code 1 in /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-jhvl5plj/pycairo/\nYou are using pip version 10.0.1, however version 20.2.2 is available.\nYou should consider upgrading via the 'pip install --upgrade pip' command.\n</code></pre> <p>\u7528brew\u5b89\u88c5<code>pkg-config</code> <pre><code> $ brew install pkg-config\n==&gt; Downloading https://mirrors.ustc.edu.cn/homebrew-bottles/bottles/pkg-config-0.29.2_3.mojave.bottle.tar.g\n######################################################################## 100.0%\n==&gt; Pouring pkg-config-0.29.2_3.mojave.bottle.tar.gz\n\ud83c\udf7a  /usr/local/Cellar/pkg-config/0.29.2_3: 11 files, 623.6KB\n</code></pre></p> <p>\u7136\u540e\u518d\u8fd0\u884c<code>pip install pycairo</code>\u3002 \u51fa\u73b0\u9519\u8bef</p> <p>Collecting pycairo   Using cached pycairo-1.19.1.tar.gz (205 kB) Using legacy setup.py install for pycairo, since package 'wheel' is not installed. Installing collected packages: pycairo     Running setup.py install for pycairo ... error     ERROR: Command errored out with exit status 1:      command: /Library/Frameworks/Python.framework/Versions/3.7/bin/python3.7 -u -c 'import sys, setuptools, tokenize; sys.argv[0] = '\"'\"'/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-_fvz20yx/pycairo/setup.py'\"'\"'; file='\"'\"'/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-_fvz20yx/pycairo/setup.py'\"'\"';f=getattr(tokenize, '\"'\"'open'\"'\"', open)(file);code=f.read().replace('\"'\"'\\r\\n'\"'\"', '\"'\"'\\n'\"'\"');f.close();exec(compile(code, file, '\"'\"'exec'\"'\"'))' install --record /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-record-0xkj4in4/install-record.txt --single-version-externally-managed --compile --install-headers /Library/Frameworks/Python.framework/Versions/3.7/include/python3.7m/pycairo          cwd: /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-_fvz20yx/pycairo/     Complete output (15 lines):     running install     running build     running build_py     creating build     creating build/lib.macosx-10.9-x86_64-3.7     creating build/lib.macosx-10.9-x86_64-3.7/cairo     copying cairo/init.py -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo     copying cairo/init.pyi -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo     copying cairo/py.typed -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo     running build_ext     Package cairo was not found in the pkg-config search path.     Perhaps you should add the directory containing `cairo.pc'     to the PKG_CONFIG_PATH environment variable     No package 'cairo' found     Command '['pkg-config', '--print-errors', '--exists', 'cairo &gt;= 1.13.1']' returned non-zero exit status 1.     ---------------------------------------- ERROR: Command errored out with exit status 1: /Library/Frameworks/Python.framework/Versions/3.7/bin/python3.7 -u -c 'import sys, setuptools, tokenize; sys.argv[0] = '\"'\"'/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-_fvz20yx/pycairo/setup.py'\"'\"'; file='\"'\"'/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-_fvz20yx/pycairo/setup.py'\"'\"';f=getattr(tokenize, '\"'\"'open'\"'\"', open)(file);code=f.read().replace('\"'\"'\\r\\n'\"'\"', '\"'\"'\\n'\"'\"');f.close();exec(compile(code, file, '\"'\"'exec'\"'\"'))' install --record /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-record-0xkj4in4/install-record.txt --single-version-externally-managed --compile --install-headers /Library/Frameworks/Python.framework/Versions/3.7/include/python3.7m/pycairo Check the logs for full command output.</p> <p>\u6267\u884c<code>brew install cairo pkg-config freetype harfbuzz</code>\uff0c\u628a\u8fd9\u51e0\u4e2a\u5305\u5b89\u88c5\u4e00\u4e0b\u3002 \u7136\u540e\u518d<code>pip install pycairo</code>\uff0c\u5b89\u88c5\u6210\u529f\u3002</p>","tags":["Python"]},{"location":"python/io/read-write-csv/","title":"Python\u8bfb\u5199csv\u6587\u4ef6\u4e2d\u7684\u6570\u5b57","text":"\u66f4\u65b0\u65e5\u671f 2016-12-27 <ul> <li>2016-12-27 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u73af\u5883\u4e0e\u5de5\u5177</p> <ul> <li>Python3</li> <li>PyCharm CE</li> </ul>","tags":["Python"]},{"location":"python/io/read-write-csv/#csv","title":"csv\u7b80\u4ecb","text":"<p>\u4ec0\u4e48\u662fcsv\uff1fcsv\u662f\u9017\u53f7\u5206\u9694\u7684\u4e00\u79cd\u6587\u4ef6\u683c\u5f0f\u3002 \u4f8b\u5982\u4e0b\u9762\u8fd9\u4e2acsv\u683c\u5f0f\u7684\u6587\u672c\u3002 <pre><code>\u59d3\u540d,\u5e74\u9f84,\u6807\u7b7e\nRust Fisher,18,Python\nTom Hanks,29,Java\n</code></pre></p> <p>\u8fd9\u6837\u7684<code>.csv</code>\u6587\u4ef6\u53ef\u4ee5\u7528Excel\u6216\u8005WPS\u6253\u5f00\uff0c\u4f1a\u7ed9\u51fa\u8868\u683c\u7684\u5f62\u5f0f\u3002</p> <p></p> <p>\u8981\u6ce8\u610f\u7684\u662f\uff0ccsv\u662f\u6587\u672c\u683c\u5f0f\uff0c\u5e76\u4e0d\u662fExcel\u7684\u683c\u5f0f\u3002\u6211\u4eec\u7528\u6587\u672c\u7f16\u8f91\u5668\uff08\u4f8b\u5982xcode\uff0c\u8bb0\u4e8b\u672c\uff09\u662f\u53ef\u4ee5\u76f4\u63a5\u7f16\u8f91\u5b83\u7684\u3002</p>","tags":["Python"]},{"location":"python/io/read-write-csv/#csv_1","title":"\u8bfb\u5199csv\u6587\u4ef6","text":"<p>\u8bfb\u6587\u4ef6\u65f6\u5148\u4ea7\u751fstr\u7684\u5217\u8868\uff0c\u628a\u6700\u540e\u7684\u6362\u884c\u7b26\u5220\u6389\uff1b\u7136\u540e\u4e00\u4e2a\u4e2astr\u8f6c\u6362\u6210int <pre><code>## \u8bfb\u5199csv\u6587\u4ef6\ncsv_file = 'datas.csv'\n\ncsv = open(csv_file,'w')\nfor i in range(1,20):\n    csv.write(str(i) + ',')\n    if i % 10 == 0:\n        csv.write('\\n')\ncsv.close()\n\nresult = []\nwith open(csv_file,'r') as f:\n    for line in f:\n        linelist = line.split(',')\n        linelist.pop()# delete: \\n\n        for index, item in enumerate(linelist):\n            result.append(int(item))\nprint('\\nResult is \\n' , result)\n</code></pre></p> <p>\u8f93\u51fa\uff1a <pre><code>Result is\n [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]\n</code></pre></p>","tags":["Python"]},{"location":"python/io/read-write-csv/#_1","title":"\u68c0\u67e5\u76ee\u5f55\u662f\u5426\u5b58\u5728","text":"<p>\u82e5\u76ee\u6807\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c\u5219\u65b0\u5efa\u4e00\u4e2a\u76ee\u5f55 <pre><code>import os\njson_dir = \"../dir_json/2017-04/\"\nif not os.path.exists(json_dir):\n    print(\"json dir not found\")\n    os.makedirs(json_dir)\n    print(\"Create dir  \" + json_dir)\n</code></pre></p>","tags":["Python"]},{"location":"python/io/read-write-csv/#_2","title":"\u5199\u6587\u4ef6\u65f6\u6307\u5b9a\u683c\u5f0f","text":"<p>\u53c2\u8003\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u6253\u5f00\u6587\u4ef6\u65f6\u6307\u5b9autf8\uff0c\u8f6c\u6362\u6210json\u65f6\u6307\u5b9a<code>ensure_ascii=False</code> <pre><code>import json\njson_file = open(json_dir + id + '.json', 'w', encoding='utf8')\njson_file.write(json.dumps(data_dict, ensure_ascii=False))\n</code></pre> \u907f\u514d\u5199\u6210\u7684json\u6587\u4ef6\u4e71\u7801</p>","tags":["Python"]},{"location":"python/io/read-write-csv/#enumerateiterable-start0","title":"\u51fd\u6570 enumerate(iterable, start=0)","text":"<p>\u8fd4\u56de\u4e00\u4e2aenumerate\u5bf9\u8c61\u3002iterable\u5fc5\u987b\u662f\u4e00\u4e2a\u53e5\u5b50\uff0c\u8fed\u4ee3\u5668\u6216\u8005\u652f\u6301\u8fed\u4ee3\u7684\u5bf9\u8c61\u3002</p> <p>enumerate\u793a\u4f8b1\uff1a <pre><code>&gt;&gt;&gt; data = [1,2,3]\n&gt;&gt;&gt; for i, item in enumerate(data):\n    print(i,item)\n\n\n0 1\n1 2\n2 3\n</code></pre> \u793a\u4f8b2\uff1a <pre><code>&gt;&gt;&gt; line = 'one'\n&gt;&gt;&gt; for i, item in enumerate(line,4):\n    print(i,item)\n\n\n4 o\n5 n\n6 e\n</code></pre> \u53c2\u8003\uff1a https://docs.python.org/3/library/functions.html?highlight=enumerate#enumerate</p>","tags":["Python"]},{"location":"python/io/read-write-csv/#class-intx0","title":"class int(x=0)","text":"<p>class int(x, base=10) \u8fd4\u56de\u4e00\u4e2aInteger\u5bf9\u8c61\u3002\u5bf9\u4e8e\u6d6e\u70b9\u6570\uff0c\u4f1a\u622a\u53d6\u6210\u6574\u6570\u3002 <pre><code>&gt;&gt;&gt; print(int('-100'),int('0'),int('3'))\n-100 0 3\n&gt;&gt;&gt; int(7788)\n7788\n&gt;&gt;&gt; int(7.98)\n7\n&gt;&gt;&gt; int('2.33')\nTraceback (most recent call last):\n  File \"&lt;pyshell#27&gt;\", line 1, in &lt;module&gt;\n    int('2.33')\nValueError: invalid literal for int() with base 10: '2.33'\n</code></pre></p>","tags":["Python"]},{"location":"python/io/read-write-csv/#binary","title":"\u8bfb\u53d6binary\u6587\u4ef6","text":"<p>\u9010\u4e2abyte\u8bfb\u53d6\uff0c\u6ce8\u610f\u7528<code>b''</code>\u6765\u5224\u65ad\u662f\u5426\u8bfb\u5230\u6587\u4ef6\u5c3e\u90e8 <pre><code>    @staticmethod\n    def convert_bin_to_csv(bin_file_path, csv_file_path):\n        if not os.path.exists(bin_file_path):\n            print(\"Binary file is not exist! \" + bin_file_path)\n            return\n        with open(bin_file_path, \"rb\") as bin_f:\n            cur_byte = bin_f.read(1)\n            while cur_byte != b'':\n                # Do stuff with byte.\n                print(int.from_bytes(cur_byte, byteorder='big', signed=True))\n                cur_byte = bin_f.read(1)\n</code></pre></p> <p>\u8bfb\u53d6\u5230\u7684byte\u53ef\u4ee5\u8f6c\u6362\u4e3aint\uff0c\u53c2\u8003\u6587\u6863</p> <p>\u8fd9\u91cc <code>cur_byte</code> \u7c7b\u4f3c\u4e8e <code>b'\\x08'</code> <pre><code>print(int.from_bytes(cur_byte, byteorder='big', signed=True))\n</code></pre></p>","tags":["Python"]},{"location":"python/io/read-write-csv/#bincsv","title":"\u4ecebin\u4e2d\u8bfb\u53d6\u6570\u636e\u5e76\u5b58\u5165CSV\u6587\u4ef6\u4e2d","text":"<p>\u5148\u4ecebin\u4e2d\u8bfb\u53d6byte\uff0c\u89c4\u5b9a\u597d\u51e0\u4e2a\u5b57\u8282\u51d1\u62101\u4e2a\u6570\u5b57\u3002 \u6309\u6bcf\u884c\u4e00\u4e2a\u6570\u5b57\u7684\u683c\u5f0f\u5199\u5165CSV\u6587\u4ef6\u3002</p> <pre><code>    @staticmethod\n    def convert_bin_to_csv(bin_file_path, csv_file_path, byte_count=1, byte_order='big', digit_signed=True):\n        if not os.path.exists(bin_file_path):\n            print(\"Binary file is not exist! \" + bin_file_path)\n            return\n        with open(csv_file_path, \"w\") as csv_f:\n            with open(bin_file_path, \"rb\") as bin_f:\n                cur_byte = bin_f.read(byte_count)\n                while cur_byte != b'':\n                    csv_f.write(str(int.from_bytes(cur_byte, byteorder=byte_order, signed=digit_signed)) + \",\\n\")\n                    cur_byte = bin_f.read(byte_count)\n</code></pre> <p>bin\u5b58\u50a8\u7684\u6570\u636e\u683c\u5f0f\u4e00\u5b9a\u8981\u5546\u91cf\u597d\u3002</p>","tags":["Python"]},{"location":"python/io/scan-file-like-tree/","title":"Python \u67e5\u770b\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6","text":"\u66f4\u65b0\u65e5\u671f 2019-07-01 <ul> <li>2019-07-01 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u672c\u6587\u8981\u5b9e\u73b0\u7c7b\u4f3cLinux\u7684<code>tree</code>\u547d\u4ee4\u3002\u7edf\u8ba1\u76ee\u5f55\u4e0b\u6307\u5b9a\u540e\u7f00\u6587\u4ef6\u7684\u884c\u6570\u3002</p> <p>\u529f\u80fd\u662f\u5c06\u76ee\u5f55\u4e0b\u6240\u6709\u7684\u6587\u4ef6\u8def\u5f84\u5b58\u5165list\u4e2d\u3002</p> <p>\u53ef\u4ee5\u52a0\u5165\u540e\u7f00\u5224\u65ad\u529f\u80fd\uff0c\u641c\u7d22\u6307\u5b9a\u7684\u540e\u7f00\u540d\u6587\u4ef6\u3002</p> <p>\u4e3b\u8981\u5229\u7528\u9012\u5f52\u7684\u65b9\u6cd5\u6765\u68c0\u7d22\u6587\u4ef6\u3002</p>","tags":["Python"]},{"location":"python/io/scan-file-like-tree/#tree","title":"\u4eff\u9020 tree \u529f\u80fd\u793a\u4f8b\u4ee3\u7801","text":"<p>Python2.7 \u5217\u51fa\u76ee\u5f55\u4e0b\u6240\u6709\u6587\u4ef6</p> <p>\u9012\u5f52\u6cd5 <pre><code>import os\n\ndef tree_dir(path, c_path='', is_root=True):\n    \"\"\"\n    Get file list under path. Like 'tree'\n    :param path Root dir\n    :param c_path Child dir\n    :param is_root Current is root dir\n    \"\"\"\n    res = []\n    if not os.path.exists(path):\n        return res\n    for f in os.listdir(path):\n        if os.path.isfile(os.path.join(path, f)):\n            if is_root:\n                res.append(f)\n            else:\n                res.append(os.path.join(c_path, f))\n        else:\n            res.extend(tree_dir(os.path.join(path, f), f, is_root=False))\n    return res\n</code></pre></p> <p>\u4e0b\u9762\u662f\u52a0\u5165\u540e\u7f00\u5224\u65ad\u7684\u65b9\u6cd5\u3002\u5728\u627e\u5230\u6587\u4ef6\u540e\uff0c\u5224\u65ad\u4e00\u4e0b\u662f\u5426\u7b26\u5408\u540e\u7f00\u8981\u6c42\u3002\u4e0d\u7b26\u5408\u8981\u6c42\u7684\u6587\u4ef6\u5c31\u8df3\u8fc7\u3002 <pre><code>def tree_dir_sur(path, c_path='', is_root=True, suffix=''):\n    \"\"\" Get file list under path. Like 'tree'\n    :param path Root dir\n    :param c_path Child dir\n    :param is_root Current is root dir\n    :param suffix Suffix of file\n    \"\"\"\n    res = []\n    if not os.path.exists(path) or not os.path.isdir(path):\n        return res\n    for f in os.listdir(path):\n        if os.path.isfile(os.path.join(path, f)) and str(f).endswith(suffix):\n            if is_root:\n                res.append(f)\n            else:\n                res.append(os.path.join(c_path, f))\n        else:\n            res.extend(tree_dir_sur(os.path.join(path, f), f, is_root=False, suffix=suffix))\n    return res\n\nif __name__ == \"__main__\":\n    for p in tree_dir_sur(os.path.join('E:\\ws', 'rnote', 'Python_note'), suffix='md'):\n        print p\n</code></pre></p>","tags":["Python"]},{"location":"python/io/scan-file-like-tree/#_1","title":"\u7edf\u8ba1\u76ee\u5f55\u4e0b\u6307\u5b9a\u540e\u7f00\u6587\u4ef6\u7684\u884c\u6570","text":"<p>\u4ec5\u9002\u7528os\u4e2d\u7684\u65b9\u6cd5\uff0c\u4ec5\u68c0\u7d22\u76ee\u5f55\u4e2d\u56fa\u5b9a\u4f4d\u7f6e\u7684\u6587\u4ef6</p> <pre><code># -*- coding: utf-8 -*-\nimport os\n\n\ndef count_by_categories(path):\n    \"\"\" Find all target files and count the lines \"\"\"\n    if not os.path.exists(path):\n        return\n    c_l_dict = dict()  # e.g. {category: lines}\n    category_list = [cate for cate in os.listdir(path) if\n                     os.path.isdir(os.path.join(path, cate)) and not cate.startswith('.')]\n    for category_dir in category_list:\n        line_count = _sum_total_line(os.path.join(path, category_dir), '.md')\n        if line_count &gt; 0:\n            c_l_dict[category_dir] = line_count\n    return c_l_dict\n\n\ndef _sum_total_line(path, endswith='.md'):\n    \"\"\" Get the total lines of target files \"\"\"\n    if not os.path.exists(path) or not os.path.isdir(path):\n        return 0\n    total_lines = 0\n    for f in os.listdir(path):\n        if f.endswith(endswith):\n            with open(os.path.join(path, f)) as cur_f:\n                total_lines += len(cur_f.readlines())\n    return total_lines\n\n\nif __name__ == '__main__':\n    note_dir = 'E:/ws/rnote'\n    ca_l_dict = count_by_categories(note_dir)\n    all_lines = 0\n    for k in ca_l_dict.keys():\n        all_lines += ca_l_dict[k]\n\n    print 'all lines:', str(all_lines)\n    print ca_l_dict\n</code></pre> <p>\u4ee5\u7b14\u8bb0\u6587\u4ef6\u5939\u4e3a\u4f8b\uff0c\u5206\u522b\u7edf\u8ba1\u5206\u7c7b\u76ee\u5f55\u4e0b\u6587\u4ef6\u7684\u603b\u884c\u6570\uff0c\u6d4b\u8bd5\u8f93\u51fa <pre><code>all lines: 25433\n{'flash_compile_git_note': 334, 'Linux_note': 387, 'Algorithm_note': 3637, 'Comprehensive': 216, 'advice': 137, 'Java_note': 3013, 'Android_note': 11552, 'DesignPattern': 2646, 'Python_note': 787, 'kotlin': 184, 'cpp_note': 279, 'PyQt_note': 439, 'reading': 686, 'backend': 1136}\n</code></pre></p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro-parts/","title":"Python\u56fe\u8868\u5e93Matplotlib\u7ec4\u6210\u90e8\u5206\u4ecb\u7ecd","text":"\u66f4\u65b0\u65e5\u671f 2021-07-20 <ul> <li>2021-07-20 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u56fe\u8868\u6709\u5f88\u591a\u4e2a\u7ec4\u6210\u90e8\u5206\uff0c\u4f8b\u5982\u6807\u9898\u3001x/y\u8f74\u540d\u79f0\u3001\u5927\u523b\u5ea6\u5c0f\u523b\u5ea6\u3001\u7ebf\u6761\u3001\u6570\u636e\u70b9\u3001\u6ce8\u91ca\u8bf4\u660e\u7b49\u7b49\u3002</p> <p>\u6211\u4eec\u6765\u770b\u5b98\u65b9\u7ed9\u7684\u56fe\uff0c\u56fe\u4e2d\u6807\u51fa\u4e86\u5404\u4e2a\u90e8\u5206\u7684\u82f1\u6587\u540d\u79f0</p> <p></p> <p>Matplotlib\u63d0\u4f9b\u4e86\u5f88\u591aapi\uff0c\u5f00\u53d1\u8005\u53ef\u6839\u636e\u9700\u6c42\u5b9a\u5236\u56fe\u8868\u7684\u6837\u5f0f\u3002</p> <p>\u524d\u9762\u6211\u4eec\u8bbe\u7f6e\u4e86\u6807\u9898\u548cx/y\u8f74\u7684\u540d\u79f0\uff0c\u672c\u6587\u4ecb\u7ecd\u66f4\u591a\u8bbe\u7f6e\u5176\u4ed6\u90e8\u5206\u7684\u65b9\u6cd5\u3002</p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro-parts/#_1","title":"\u7ed8\u56fe","text":"<p>\u5148\u7ed8\u5236\u4e00\u4e2a\u4e8b\u4f8b\u56fe\u3002\u7136\u540e\u4ee5\u6b64\u4e3a\u57fa\u7840\u8fdb\u884c\u5b9a\u5236\u3002 <pre><code>def demo2():\n    x_list = []\n    y_list = []\n    for i in range(0, 365):\n        x_list.append(i)\n        y_list.append(math.sin(i * 0.1))\n    ax = plt.gca()\n    ax.set_title('rustfisher.com mapplotlib example')\n    ax.set_xlabel('x')\n    ax.set_ylabel('y = sin(x)')\n    ax.grid()\n    plt.plot(x_list, y_list)\n    plt.show()\n\n\nif __name__ == '__main__':\n    print('rustfisher \u56fe\u8868\u8bb2\u89e3')\n    demo2()\n</code></pre> \u8fd0\u884c\u5f97\u5230</p> <p></p> <p>\u7ea2\u8272\u6846\u6846\u91cc\u7684\u662ffigure\uff1b\u7eff\u8272\u6846\u6846\u91cc\u7684\u53eb\u505aax\u3002 \u4ee3\u7801\u4e2d<code>ax = plt.gca()</code>\u83b7\u53d6\u5230\u7684\u5c31\u662f\u7eff\u8272\u6846\u6846\u91cc\u7684\u90e8\u5206\uff08\u5bf9\u8c61\uff09\u3002</p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro-parts/#figure","title":"Figure \u5927\u56fe","text":"<p>Figure\u4ee3\u8868\u6574\u5f20\u56fe\uff0c\u6682\u65f6\u79f0\u4e3a\u201c\u5168\u56fe\u201d\u6216\u8005\u201c\u5927\u56fe\u201d\u3002\u4e00\u5f20\u56fe\u91cc\u53ef\u4ee5\u6709\u591a\u4e2a\u5b50\u56fe\u8868\u3002\u6700\u5c11\u5fc5\u987b\u8981\u6709\u4e00\u4e2a\u56fe\u8868\u3002\u50cf\u4e0a\u9762\u90a3\u6837\u3002</p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro-parts/#axes","title":"Axes \u6570\u636e\u56fe","text":"<p>\u4e00\u5f20\u5f20\u7684\u56fe\uff0c\u56fe\u91cc\u663e\u793a\u7740\u6570\u636e\uff0c\u6682\u79f0\u4e3a\u201c\u6570\u636e\u56fe\u201d\u3002\u4e00\u4e2a\u5927\u56fe\u91cc\u53ef\u4ee5\u6709\u591a\u4e2a\u6570\u636e\u56fe\u3002\u4f46\u5355\u4e2a\u6570\u636e\u56fe\u5bf9\u8c61\u53ea\u80fd\u57281\u4e2a\u5927\u56fe\u91cc\u3002</p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro-parts/#subplots","title":"\u591a\u5f20\u6570\u636e\u56fe subplots","text":"<p>\u4f8b\u5982\u540c\u65f6\u5b58\u57282\u4e2a\u6570\u636e\u56fe</p> <p></p> <pre><code>def demo_subplot():\n    x_list = []\n    y_list = []\n    y2_list = []\n    for i in range(0, 365):\n        x_list.append(i)\n        y_list.append(math.sin(i * 0.1))\n        y2_list.append(math.cos(i * 0.1))\n    fig, (ax1, ax2) = plt.subplots(2)\n    ax1.set_title('rustfisher.com 1')\n    ax2.set_title('rustfisher.com 2')\n    ax1.set_xlabel('x')\n    ax1.set_ylabel('y = sin(x)')\n    ax2.set_xlabel('x')\n    ax2.set_ylabel('y = cos(x)')\n    ax1.plot(x_list, y_list)\n    ax2.plot(x_list, y2_list)\n    plt.show()\n</code></pre> <p>\u8c03\u7528<code>subplots()</code>\u63a5\u53e3\uff0c\u4f20\u5165\u6570\u5b57\u6307\u5b9a\u8981\u591a\u5c11\u5f20\u6570\u636e\u56fe\u3002 \u8fd4\u56de\u7684\u591a\u5f20\u56fe\u8981\u7528\u62ec\u53f7\u62ec\u8d77\u6765\u3002\u6bcf\u4e2a\u6570\u636e\u56fe\u53ef\u4ee5\u7ed8\u5236(<code>plot</code>)\u4e0d\u540c\u7684\u6570\u636e\u3002 \u6807\u9898\u7528<code>set_title()</code>\u6765\u8bbe\u7f6e\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\u4e0a\u4e0b\u4e24\u5f20\u56fe\u592a\u6324\u4e86\uff0c\u6709\u91cd\u53e0\u90e8\u5206\u3002\u53ef\u4ee5\u5728<code>plt.show()</code>\u4e4b\u524d\u52a0\u4e00\u4e2a<code>fig.tight_layout()</code>\u8ba9\u5b83\u4eec\u62c9\u5f00\u4e00\u70b9\u8ddd\u79bb\u3002</p> <p></p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro-parts/#_2","title":"\u5750\u6807\u8f74","text":"<p>\u5bf9\u4e8e2\u7ef4\u6570\u636e\u56fe\uff0c\u5b83\u67092\u4e2a\u5750\u6807\uff0c\u6a2a\u5750\u6807\u548c\u7eb5\u5750\u6807\u3002\u6709\u4e00\u4e9b\u63a5\u53e3\u53ef\u4ee5\u8bbe\u7f6e\u53c2\u6570\u3002 \u4f8b\u5982\u63a7\u5236\u5750\u6807\u8f74\u7684\u540d\u5b57<code>set_xlabel()</code> <code>set_ylabel</code>\uff1b</p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro-parts/#_3","title":"\u663e\u793a\u6570\u636e\u8303\u56f4","text":"<p><code>set_xlim</code>\u65b9\u6cd5\u53ef\u4ee5\u63a7\u5236x\u8f74\u6570\u636e\u663e\u793a\u8303\u56f4\u3002\u540c\u7406y\u8f74\u7528<code>set_ylim</code>\u6765\u63a7\u5236\u3002 \u5bf9\u4e8e\u663e\u793a\u8303\u56f4\uff0c<code>set_xlim</code>\u65b9\u6cd5\u4e3b\u8981\u53c2\u6570\u4e3a<code>left</code>\u548c<code>right</code>\uff1b\u6216\u8005\u7528<code>xmin</code> <code>xmax</code>\u3002\u8fd9\u4e24\u5957\u4e0d\u80fd\u540c\u65f6\u4f7f\u7528\u3002 <code>set_ylim</code>\u4e3b\u8981\u53c2\u6570\u662f<code>top</code> <code>bottom</code>\uff1b\u6216\u8005<code>ymin</code> <code>ymax</code>\u3002\u8fd9\u4e24\u5957\u4e0d\u80fd\u540c\u65f6\u4f7f\u7528\u3002</p> <p>\u589e\u52a0\u663e\u793a\u8303\u56f4\u63a7\u5236\u7684\u4ee3\u7801 <pre><code>def demo3():\n    x_list = []\n    y_list = []\n    y2_list = []\n    for i in range(0, 365):\n        x_list.append(i)\n        y_list.append(math.sin(i * 0.1))\n        y2_list.append(math.cos(i * 0.1))\n    fig, (ax1, ax2) = plt.subplots(2)\n    ax1.set_title('rustfisher.com 1')\n    ax1.set_xlabel('x')\n    ax1.set_ylabel('y = sin(x)')\n    ax2.set_title('rustfisher.com 2')\n    ax2.set_xlabel('x')\n    ax2.set_ylabel('y = cos(x)')\n\n    ax1.set_xlim(left=50, right=200.6)  # \u63a7\u5236x\u8f74\u663e\u793a\u8303\u56f4\n    ax1.set_ylim(top=1, bottom=0.3)  # \u63a7\u5236y\u8f74\u663e\u793a\u8303\u56f4\n\n    ax2.set_xlim(xmin=1, xmax=156.6)  # \u63a7\u5236x\u8f74\u663e\u793a\u8303\u56f4\n    ax2.set_ylim(ymin=-0.3, ymax=0.3)  # \u63a7\u5236y\u8f74\u663e\u793a\u8303\u56f4\n\n    ax1.plot(x_list, y_list)\n    ax2.plot(x_list, y2_list)\n    fig.tight_layout()\n    plt.show()\n</code></pre></p> <p>\u8fd0\u884c\u7ed3\u679c</p> <p></p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro-parts/#_4","title":"\u523b\u5ea6","text":"<p>tick\u610f\u601d\u662f\u6807\u8bb0\u3002\u5728\u5750\u6807\u8f74\u4e0a\u7684\u662f\u523b\u5ea6\u3002Major tick\u6682\u79f0\u4e3a\u5927\u523b\u5ea6\uff0cminor tick\u6682\u79f0\u4e3a\u5c0f\u523b\u5ea6\u3002 \u4f7f\u7528<code>set_xticks</code>\u65b9\u6cd5\u63a7\u5236\u523b\u5ea6\u663e\u793a\u3002\u4f20\u5165\u7684\u5217\u8868\u662f\u6211\u4eec\u5e0c\u671b\u663e\u793a\u7684\u523b\u5ea6\u3002 <code>minor</code>\u53c2\u6570\u9ed8\u8ba4\u4e3aFalse\uff0c\u4e0d\u663e\u793a\u5c0f\u523b\u5ea6\u3002</p> <p>\u5173\u952e\u4ee3\u7801\u5982\u4e0b <pre><code>ax1.set_xticks([50, 60, 70, 150])\nax1.set_yticks([0.1, 0.2, 0.3, 0.7, 0.9])\nax1.grid()  # \u663e\u793a\u683c\u5b50\n\nax2.set_xticks([1, 60, 70, 150], minor=True)\nax2.set_yticks([-0.1, 0, 0.1, 0.3], minor=True)\nax2.grid()\n</code></pre></p> <p></p> <p>\u53ef\u89c1\u5f53<code>minor=True</code>\uff0c\u4f20\u5165\u7684\u523b\u5ea6\u5217\u8868\u6709\u53ef\u80fd\u4e0d\u663e\u793a\u3002</p> <p>\u4e5f\u53ef\u4ee5\u63a7\u5236\u5927\u523b\u5ea6\u4e0a\u7684\u6587\u5b57\u65cb\u8f6c <pre><code>    plt.setp(ax1.xaxis.get_majorticklabels(), rotation=-45)\n    plt.setp(ax2.xaxis.get_majorticklabels(), rotation=-60)\n</code></pre></p> <p></p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro-parts/#spine","title":"\u8fb9\u7ebf spine","text":"<p>spine\u662f\u810a\u67f1\u7684\u610f\u601d\uff0c\u8fd9\u91cc\u6211\u4eec\u5148\u79f0\u4e3a\u8fb9\u7ebf\u3002\u6709\u4e0a\u4e0b\u5de6\u53f34\u6761\u8fb9\u7ebf\u3002\u540d\u79f0\u662f<code>top</code> <code>bottom</code> <code>left</code> <code>right</code>  \u53ef\u4ee5\u76f4\u63a5\u4ece\u56fe\u8868\u5bf9\u8c61\u83b7\u53d6\u5b83\u7684\u8fb9\u7ebf\uff0c\u6bd4\u5982\u53f3\u8fb9\u7ebf<code>ax1.spines.right</code>\u3002</p> <p>\u4e00\u4e9b\u7b80\u5355\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982</p> <ul> <li><code>set_visible</code> \u663e\u793a\u548c\u9690\u85cf</li> <li><code>set_ticks_position</code> \u523b\u5ea6\u663e\u793a\u7684\u4f4d\u7f6e</li> <li><code>set_bounds</code> \u8fb9\u7ebf\u663e\u793a\u8303\u56f4</li> <li><code>set_linewidth</code> \u7ebf\u7684\u5bbd\u5ea6</li> </ul> <p>\u9690\u85cf\u53f3\u8fb9\u7ebf\u548c\u4e0a\u8fb9\u7ebf <pre><code>ax1.spines.right.set_visible(False)\nax1.spines.top.set_visible(False)\n</code></pre></p> <p>\u8ba9\u523b\u5ea6\u663e\u793a\u5728\u53f3\u8fb9\u548c\u4e0a\u65b9 <pre><code>ax2.yaxis.set_ticks_position('right')\nax2.xaxis.set_ticks_position('top')\n</code></pre></p> <p>\u8bbe\u7f6e\u8fb9\u7ebf\u663e\u793a\u8303\u56f4 <pre><code>ax3.spines.left.set_bounds(-0.5, 0.5)\nax3.spines.top.set_bounds(340, 400)\n</code></pre></p> <p>\u8bbe\u7f6e\u7ebf\u7684\u5bbd\u5ea6 <pre><code>ax3.spines.bottom.set_linewidth(2)\n</code></pre></p> <p>\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b <pre><code>import math\nimport matplotlib.pyplot as plt\n\ndef demo_spine():\n    x_list = []\n    y_list = []\n    for i in range(0, 365):\n        x_list.append(i)\n        y_list.append(math.sin(i * 0.1))\n\n    fig, (ax1, ax2, ax3) = plt.subplots(3)\n    ax_list = [ax1, ax2, ax3]\n    for i in range(0, 3):\n        cur_ax = ax_list[i]\n        cur_ax.set_title('rustfisher.com ' + str(i))\n        cur_ax.plot(x_list, y_list)\n        cur_ax.set_xlabel('x')\n        cur_ax.set_ylabel('y = sin(x)')\n\n    ax1.spines.right.set_visible(False)\n    ax1.spines.top.set_visible(False)\n\n    ax2.spines.bottom.set_visible(False)\n    ax2.spines.left.set_visible(False)\n    ax2.yaxis.set_ticks_position('right')\n    ax2.xaxis.set_ticks_position('top')\n\n    ax3.spines.left.set_bounds(-0.5, 0.5)\n    ax3.spines.top.set_bounds(340, 400)\n    ax3.spines.bottom.set_linewidth(2)\n\n    fig.tight_layout()\n    plt.show()\n</code></pre></p> <p>\u8fd0\u884c\u622a\u56fe</p> <p></p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro-parts/#_5","title":"\u6570\u636e\u70b9","text":"<p>\u63a7\u5236\u6570\u636e\u70b9\u7684\u6837\u5f0f\u3002\u4e0b\u9762\u6211\u4eec\u5728\u4e00\u5f20\u56fe\u8868\u91cc\u7ed8\u5236\u591a\u6761\u6570\u636e\u7ebf\u3002</p> <pre><code>def demo_line():\n    x_list = []\n    y_list = []\n    y2_list = []\n    y3_list = []\n    for i in range(0, 20):\n        x_list.append(i)\n        y_list.append(math.sin(i) * 2 - 4)\n        y2_list.append(math.sin(i) * 2)\n        y3_list.append(math.cos(i) * 1.3 + 3)\n\n    plt.plot(x_list, y_list, color='blue', linestyle='-.', linewidth=2, markersize=4)\n    plt.plot(x_list, y2_list, 'go', linewidth=1)\n    plt.plot(x_list, y3_list, 'r+')\n    plt.show()\n</code></pre> <p><code>plot()</code>\u65b9\u6cd5\u4e2d\uff0c\u652f\u6301\u591a\u79cd\u9009\u9879\u3002</p> <p><code>linestyle</code>\u652f\u6301\u7684\u9009\u9879 '-', '--', '-.', ':', 'None', ' ', '', 'solid', 'dashed', 'dashdot', 'dotted'</p> <p></p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro-parts/#legend","title":"\u6ce8\u91ca legend","text":"<p>\u6dfb\u52a0\u6ce8\u91ca\uff0c\u8c03\u7528<code>lengend()</code>\u65b9\u6cd5\u3002</p> <p>\u5728\u524d\u9762\u4ee3\u7801\u57fa\u7840\u4e0a\u6dfb\u52a0 <pre><code>    plt.plot(x_list, y_list, color='blue', linestyle='-.', linewidth=2, markersize=4)\n    plt.plot(x_list, y2_list, 'go', linewidth=1)\n    plt.plot(x_list, y3_list, 'r+')\n    plt.legend(['math.sin(i) * 2 - 4', 'math.sin(i) * 2', 'math.cos(i) * 1.3 + 3'])\n</code></pre></p> <p></p> <p>\u63a7\u5236\u6ce8\u91ca\u663e\u793a\u7684\u5730\u65b9\uff0c\u6dfb\u52a0<code>bbox_to_anchor</code>\u548c<code>bbox_transform</code>\u5c5e\u6027 <pre><code>plt.legend(['math.sin(i) * 2 - 4', 'math.sin(i) * 2', 'math.cos(i) * 1.3 + 3'], bbox_to_anchor=(1, 1),\n               bbox_transform=plt.gcf().transFigure)\n</code></pre></p> <p></p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro-parts/#_6","title":"\u4e2d\u6587\u4e71\u7801\u95ee\u9898","text":"<p>\u5728\u8bbe\u7f6e\u6807\u9898\u7528\u5230\u4e2d\u6587\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e71\u7801\u3002 \u53ef\u4ee5\u8bbe\u7f6e<code>rcParams</code>\u7684\u5b57\u4f53\uff0c\u89e3\u51b3\u4e71\u7801\u95ee\u9898\u3002 <pre><code>plt.rcParams['font.sans-serif'] = ['Arial Unicode MS']\n</code></pre></p> <p>\u81f3\u6b64\uff0c\u6211\u4eec\u628a\u56fe\u8868\u4e2d\u5404\u4e2a\u90e8\u5206\u90fd\u7b80\u8981\u4ecb\u7ecd\u4e86\u4e00\u4e0b\u3002</p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro-parts/#_7","title":"\u53c2\u8003","text":"<p>\u672c\u4f8b\u73af\u5883</p> <ul> <li>macOS</li> <li>PyCharm CE</li> <li>Python3</li> </ul>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro-parts/#_8","title":"\u53c2\u8003","text":"<ul> <li>\u7ed8\u5236\u56fe\u8868Matplotlib\u5feb\u901f\u5165\u95e8</li> <li>matplotlib https://matplotlib.org/</li> </ul>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro1/","title":"\u7ed8\u5236\u56fe\u8868Matplotlib\u5feb\u901f\u5165\u95e8","text":"\u66f4\u65b0\u65e5\u671f 2021-07-16 <ul> <li>2021-07-16 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u7ed8\u5236\u56fe\u8868\u662f\u8fd0\u8425\u5de5\u4f5c\u4e2d\u5e38\u89c1\u7684\u9700\u6c42\u3002</p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u5229\u7528<code>Matplotlib</code>\u6765\u7ed8\u5236\u56fe\u8868\u3002</p> <p>Matplotlib \u662f\u4e00\u4e2a\u7efc\u5408\u6027\u7684\u5e93\u3002\u5b83\u662f Python \u7684\u53ef\u89c6\u5316\u5de5\u5177\uff0c\u53ef\u521b\u5efa\u9759\u6001\u3001\u5e26\u52a8\u753b\u548c\u53ef\u4ea4\u4e92\u7684\u56fe\u8868 Matplotlib \u5b98\u7f51https://matplotlib.org/ \u5b98\u65b9\u4f7f\u7528\u624b\u518c</p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro1/#_1","title":"\u5b89\u88c5","text":"<p>\u5b98\u65b9\u7ed9\u51fa\u7684\u5b89\u88c5\u65b9\u6cd5\u662f\u4f7f\u7528pip <pre><code>python -m pip install -U pip\npython -m pip install -U matplotlib\n</code></pre></p> <p>\u6211\u4eec\u4f7f\u7528PyCharm\uff0c\u4e5f\u53ef\u4ee5\u5148\u6253 <pre><code>import matplotlib.pyplot as plt\n</code></pre> \u5176\u4e2d<code>matplotlib</code>\u4e0b\u9762\u6709\u7ea2\u7ebf\uff0c\u8ddf\u7740PyCharm\u7684\u63d0\u793a\uff0c\u628a\u7f3a\u5931\u7684\u5305\u88c5\u4e0a\u5c31\u597d\u3002</p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro1/#_2","title":"\u7ed8\u5236\u6298\u7ebf\u56fe\u793a\u4f8b","text":"<p>\u63a5\u4e0b\u6765\u4f7f\u7528<code>matplotlib</code>\u7ed8\u5236\u4e00\u4e2a\u7b80\u5355\u7684\u6298\u7ebf\u56fe\uff0c\u5148\u628a\u8fd9\u4e2a\u5e93\u7528\u8d77\u6765\u3002</p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro1/#_3","title":"\u51c6\u5907\u6570\u636e","text":"<p>\u6211\u4eec\u7528<code>math.sin</code>\u6765\u6a21\u62df\u3002x\u4ece0\u5230100\uff0cy=sin(x)\u3002\u4e00\u4e2a\u7b80\u5355\u7684sin\u51fd\u6570\u3002</p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro1/#_4","title":"\u7ed8\u5236","text":"<p>\u51c6\u5907\u6570\u636e\uff0c\u7136\u540e\u7ed8\u5236\u51fa\u56fe\u8868\u3002\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b <pre><code>import math\nimport matplotlib.pyplot as plt\n\ndef demo1():\n    x_list = []\n    y_list = []\n    for i in range(0, 100):\n        x_list.append(i)\n        y_list.append(math.sin(i * 0.1))\n    plt.plot(x_list, y_list)\n    plt.show()\n\n\nif __name__ == '__main__':\n    print('rustfisher \u7ed8\u5236\u6298\u7ebf\u56fe\u4e8b\u4f8b1')\n    demo1()\n</code></pre></p> <p>Mac\u7684PyCharm\u8fd0\u884c\u4e0b\u80fd\u5f97\u5230\u8fd9\u6837\u7684\u56fe</p> <p></p> <p>\u4ee3\u7801\u4e2d</p> <ul> <li><code>plt.plot(x_list, y_list)</code>\u6307\u5b9ax\uff0cy\u503c\uff0c\u90fd\u662f\u5217\u8868\u3002\u8fd92\u4e2a\u5217\u8868\u7684\u957f\u5ea6\u8981\u76f8\u7b49\u3002</li> <li><code>plt.show()</code>\u662f\u76f4\u63a5\u7ed8\u5236\u56fe\u8868\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\u56fe\u4e2d\u7f3a\u5c11\u5f88\u591a\u5143\u7d20\u3002\u56fe\u7684\u6807\u9898\u6ca1\u6709\u6307\u5b9a\uff0cx\u8f74\u548cy\u8f74\u90fd\u6ca1\u6709\u8bf4\u660e\u3002</p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro1/#_5","title":"\u589e\u52a0\u4e00\u4e9b\u7ec6\u8282","text":"<p>\u4e3a\u64cd\u4f5c\u56fe\u8868\uff0c\u6211\u4eec\u9700\u62ff\u5230\u56fe\u8868\u5bf9\u8c61<code>ax = plt.gca()</code> <pre><code>ax = plt.gca()\nax.set_title('rustfisher.com mapplotlib example')\nax.set_xlabel('x')\nax.set_ylabel('y = sin(x)')\nax.grid()\n</code></pre></p> <ul> <li><code>set_title</code> \u8bbe\u7f6e\u56fe\u8868\u6807\u9898</li> <li><code>set_xlabel</code> \u8bbe\u7f6ex\u8f74\u540d\u79f0</li> <li><code>set_ylabel</code> \u8bbe\u7f6ey\u8f74\u540d\u79f0</li> <li><code>grid()</code> \u663e\u793a\u683c\u5b50</li> </ul> <p>\u4fee\u6539\u540e\u7684\u4ee3\u7801\u5982\u4e0b <pre><code>def demo1():\n    x_list = []\n    y_list = []\n    for i in range(0, 100):\n        x_list.append(i)\n        y_list.append(math.sin(i * 0.1))\n    ax = plt.gca()\n    ax.set_title('rustfisher.com mapplotlib example')\n    ax.set_xlabel('x')\n    ax.set_ylabel('y = sin(x)')\n    ax.grid()\n    plt.plot(x_list, y_list)\n    plt.show()\n</code></pre></p> <p>\u8fd0\u884c\u7ed3\u679c </p>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro1/#_6","title":"\u64cd\u4f5c\u8bf4\u660e","text":"<p>\u4ece\u524d\u9762\u56fe\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u4e0b\u9762\u6709\u4e00\u6392\u6309\u94ae\u3002\u8fd9\u4e9b\u6309\u94ae\u63d0\u4f9b\u4e86\u4e00\u4e9b\u64cd\u4f5c\u56fe\u8868\u7684\u529f\u80fd\u3002 \u4ece\u5de6\u5230\u53f3\u6211\u4eec\u6392\u4e2a\u5e8f1\uff0c2\uff0c3\uff0c4..</p> <p></p> <ul> <li>\uff081\uff09\u8ba9\u56fe\u8868\u6062\u590d\u5230\u521d\u59cb\u72b6\u6001</li> <li>\uff082\uff09\u4e0a\u4e00\u4e2a\u56fe\u8868\u72b6\u6001</li> <li>\uff083\uff09\u4e0b\u4e00\u4e2a\u56fe\u8868\u72b6\u6001</li> <li>\uff084\uff09\u79fb\u52a8\u56fe\u8868</li> <li>\uff085\uff09\u7f29\u653e\u56fe\u8868</li> <li>\uff086\uff09\u8c03\u6574\u56fe\u8868\u663e\u793a\u7684\u4f4d\u7f6e<ul> <li>\uff081\uff09\u70b9\u51fb\u7f29\u653e\u6309\u94ae\u540e\uff0c\u9f20\u6807\u6309\u4f4f\u5de6\u952e\u53bb\u6846\u9009\u4e00\u4e2a\u533a\u57df\uff0c\u677e\u5f00\u5de6\u952e\u540e\u5c31\u662f\u653e\u5927\u90a3\u4e2a\u533a\u57df\u3002</li> <li>\uff082\uff09\u6309\u4f4f\u53f3\u952e\u518d\u6846\u9009\uff0c\u5219\u662f\u7f29\u5c0f\u663e\u793a\u533a\u57df\u3002</li> </ul> </li> <li>\uff087\uff09\u4fdd\u5b58\u56fe\u7247</li> </ul>","tags":["Python"]},{"location":"python/matplotlib/matplotlib-intro1/#_7","title":"\u76f4\u63a5\u4fdd\u5b58","text":"<p>\u5982\u679c\u6211\u4eec\u60f3\u76f4\u63a5\u4fdd\u5b58\u5f97\u5230\u7684\u56fe\u7247\uff0c\u53ef\u4ee5\u4e0d\u8c03\u7528<code>show</code>\u65b9\u6cd5\u3002\u800c\u662f\u8c03\u7528<code>savefig()</code>\u65b9\u6cd5\u3002</p> <pre><code># plt.show()\nplt.savefig('out.png')\n</code></pre>","tags":["Python"]},{"location":"python/mysql/use1/","title":"Python \u64cd\u4f5c MySQL","text":"\u66f4\u65b0\u65e5\u671f 2022-08-18 <ul> <li>2022-08-18 \u521b\u5efa\u6587\u6863</li> <li>2017-05-25 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u73af\u5883\u4e0e\u914d\u7f6e <ul> <li>win_x64</li> <li>Ubuntu14.04</li> <li>Python3.x</li> </ul>","tags":["Python","MySQL"]},{"location":"python/mysql/use1/#pippymysql","title":"pip\u5b89\u88c5pymysql\u6a21\u5757","text":"<p>\u76f4\u63a5\u4f7f\u7528pip\u5b89\u88c5 <code>pip install pymysql</code></p> <p>win64\u4e0a\u76f4\u63a5\u5728cmd\u4e2d\u6267\u884c</p>","tags":["Python","MySQL"]},{"location":"python/mysql/use1/#_1","title":"\u8fde\u63a5\u672c\u5730\u6570\u636e\u5e93","text":"<p>\u4f7f\u7528\u6a21\u5757<code>pymysql</code>\u8fde\u63a5\u6570\u636e\u5e93  </p> <pre><code>#!/usr/bin/python\n# coding=utf-8\nimport pymysql\n\n# \u8fde\u63a5\u672c\u5730\u6570\u636e\u5e93\nconn = pymysql.connect(host='localhost', port=3306, user='root', passwd='yourpwd', db='samp_db1', charset='utf8')\ncursor = conn.cursor()\ncursor.execute('select * from bigstu')\nfor row in cursor.fetchall():\n    print(row)\n\n# \u67e5\ncursor.execute('select id, name from bigstu where age &gt; 22')\nfor res in cursor.fetchall():\n    print(str(res[0]) + \", \" + res[1])\n\ncursor.close()\nprint('-- end --')\n</code></pre> <p>\u8f93\u51fa\uff1a <pre><code>(1, '\u5f20\u4e09', '\u7537', 24, datetime.date(2017, 3, 29), '13666665555')\n(6, '\u5c0f\u521a', '\u7537', 23, datetime.date(2017, 3, 11), '778899888')\n(8, '\u5c0f\u971e', '\u5973', 20, datetime.date(2017, 3, 13), '13712345678')\n(12, '\u5c0f\u667a', '\u7537', 21, datetime.date(2017, 3, 7), '13787654321')\n1, \u5f20\u4e09\n6, \u5c0f\u521a\n-- end --\n</code></pre></p> <p>\u53ef\u4ee5\u76f4\u63a5\u6267\u884csql\u8bed\u53e5\u3002\u83b7\u5f97\u7684\u7ed3\u679c\u662f\u5143\u7ec4\u3002</p> <p>sql\u76f8\u4f3c\u6761\u4ef6\u67e5\u8be2</p> <pre><code>SELECT * FROM anindex.subject_basic_table where season_id having '2018';\n</code></pre>","tags":["Python","MySQL"]},{"location":"python/mysql/use1/#_2","title":"\u589e","text":"","tags":["Python","MySQL"]},{"location":"python/mysql/use1/#_3","title":"\u63d2\u5165\u6570\u636e","text":"<p>\u63d2\u5165\u4e00\u6761\u6570\u636e\uff0c\u63a5\u4e0a\u9762\u7684\u4ee3\u7801</p> <pre><code>insertSql = \"insert into bigstu (name, sex, age,  mobile) values ('%s','%s',%d,'%s') \"\nxiuji = ('\u79c0\u5409', '\u7537', 15, '13400001111')\ncursor.execute(insertSql % xiuji)\nconn.commit() # \u522b\u5fd8\u4e86\u63d0\u4ea4\n</code></pre>","tags":["Python","MySQL"]},{"location":"python/mysql/use1/#_4","title":"\u6dfb\u52a0\u5217","text":"<p>\u5728mobile\u540e\u9762\u6dfb\u52a0\u4e00\u5217cash <pre><code>addCo = \"alter table bigstu add cash int after mobile\"\ncursor.execute(addCo)\n</code></pre></p> <p>\u5982\u679c\u8981\u8bbe\u7f6e\u9ed8\u8ba4\u503c <pre><code>addCo = \"alter table bigstu add cash int default 0 after mobile\"\ncursor.execute(addCo)\n</code></pre></p>","tags":["Python","MySQL"]},{"location":"python/mysql/use1/#_5","title":"\u5220","text":"","tags":["Python","MySQL"]},{"location":"python/mysql/use1/#_6","title":"\u5220\u9664\u6570\u636e","text":"<p>\u5220\u9664 name=\u79c0\u5409 \u7684\u6570\u636e <pre><code>deleteSql = \"delete from bigstu where name = '%s'\"\ncursor.execute(deleteSql % '\u79c0\u5409')\n</code></pre></p>","tags":["Python","MySQL"]},{"location":"python/mysql/use1/#_7","title":"\u5220\u9664\u5217","text":"<p>\u5220\u9664cash\u5217 <pre><code>dropCo = \"alter table bigstu drop cash\"\ncursor.execute(dropCo)\n</code></pre></p>","tags":["Python","MySQL"]},{"location":"python/mysql/use1/#_8","title":"\u6539","text":"","tags":["Python","MySQL"]},{"location":"python/mysql/use1/#_9","title":"\u4fee\u6539\u6570\u636e","text":"<p>\u66f4\u65b0\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e</p> <pre><code>updateSql = \"update bigstu set sex = '%s' where name = '%s'\"\nupdateXiuji = ('\u79c0\u5409', '\u79c0\u5409') # \u79c0\u5409\u7684\u6027\u522b\u662f\u79c0\u5409\ncursor.execute(updateSql % updateXiuji)\nconn.commit()\n</code></pre>","tags":["Python","MySQL"]},{"location":"python/mysql/use1/#_10","title":"\u4e8b\u7269\u5904\u7406","text":"<p>\u7ed9\u67d0\u4e2a\u8bb0\u5f55\u7684cash\u589e\u52a0 <pre><code>table = \"bigstu\"\naddCash = \"update \" + table + \" set cash = cash + '%d' where name = '%s'\"\nlucky = (1000, \"\u79c0\u5409\")\n\ntry:\n    cursor.execute(addCash % lucky)\nexcept Exception as e:\n    conn.rollback()\n    print(\"\u52a0\u94b1\u5931\u8d25\u4e86\")\nelse:\n    conn.commit()\n</code></pre></p> <p>\u76f4\u63a5\u6267\u884cSQL\u8bed\u53e5\uff0c\u5341\u5206\u65b9\u4fbf</p>","tags":["Python","MySQL"]},{"location":"python/mysql/use1/#_11","title":"\u4ee3\u7801\u7247\u6bb5","text":"","tags":["Python","MySQL"]},{"location":"python/mysql/use1/#_12","title":"\u7ed9\u6570\u636e\u5e93\u6dfb\u52a0\u5217","text":"<p>\u4ecejson\u4e2d\u8bfb\u53d6\u9700\u8981\u6dfb\u52a0\u7684\u5217\u540d\uff0c\u83b7\u53d6\u5f53\u524d2\u4e2a\u8868\u4e2d\u6240\u6709\u7684\u5217\u540d \u6574\u7406\u5f97\u51fa\u9700\u8981\u63d2\u5165\u7684\u5217\u540d\uff0c\u7136\u540e\u5c06\u5217\u63d2\u5165\u5230\u76f8\u5e94\u7684\u8868\u4e2d</p> <pre><code>import pymysql\nimport json\nimport os\nimport secureUtils\n\nmapping_keys = json.load(open(\"key_mapping_db.json\", \"r\"))\ndb_keys = []  # json\u4e2d\u6240\u6709\u7684key\n\nfor k in mapping_keys.values():\n    db_keys.append(k)\n\nconn = pymysql.connect(host='localhost', port=3306, user='root',\n                       passwd='*****', db='db_name', charset='utf8')\n\ncursor = conn.cursor()\ntable_main = \"table_main\"\nmain_table_keys = []  # \u4e3b\u8868\u7684\u5217\u540d\ncursor.execute(\"show columns from \" + table_main)\nfor row in cursor.fetchall():\n    main_table_keys.append(row[0])\n\nstaff_table_keys = []\ncursor.execute(\"show columns from table_second\")\nfor row in cursor.fetchall():\n    staff_table_keys.append(row[0])\n\nneed_to_insert_keys = []\nfor k in db_keys:\n    if k not in staff_table_keys and k not in main_table_keys and k not in need_to_insert_keys:\n        need_to_insert_keys.append(k)\n\nprint(\"need to insert \" + str(len(need_to_insert_keys)))\nprint(need_to_insert_keys)\nfor kn in need_to_insert_keys:\n    print(\"add key to db \" + kn)\n    cursor.execute(\"alter table staff_table add \" + kn +\" text\")\n\nconn.close()\n</code></pre>","tags":["Python","MySQL"]},{"location":"python/mysql/use1/#_13","title":"\u5c06\u5b57\u6bb5\u5b57\u7b26\u6539\u53d8","text":"<p>\u8fd9\u91cc\u5c06main_table_keys\u4e2d\u7684\u6240\u6709\u5b57\u6bb5\u6539\u4e3autf8 <pre><code># change column character set to utf8\nfor co in main_table_keys:\n    change_sql = \"alter table \" + table_main + \" modify \" + co + \" text character set utf8\"\n    print(change_sql)\n    cursor.execute(change_sql)\n</code></pre></p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>51CTO</p>","tags":["Python","MySQL"]},{"location":"python/openpyxl/op-draw-funnel-1/","title":"\u3010\u8fd0\u8425\u7684Python\u6307\u5357\u3011\u7ed8\u5236\u6f0f\u6597\u56fe","text":"\u66f4\u65b0\u65e5\u671f 2021-06-28 <ul> <li>2021-06-28 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u5199\u7ed9\u8fd0\u8425\u670b\u53cb\u7684Python\u6307\u5357\u3002</p> <p>\u6f0f\u6597\u56fe\u53ef\u5bf9\u4e1a\u52a1\u7684\u5404\u4e2a\u5173\u952e\u73af\u8282\u8fdb\u884c\u63cf\u8ff0\uff0c\u8861\u91cf\u5404\u4e2a\u73af\u8282\u7684\u4e1a\u52a1\u8868\u73b0\u3002\u53ef\u4ee5\u975e\u5e38\u76f4\u89c2\u5730\u770b\u5230\u5404\u4e2a\u4e1a\u52a1\u5730\u8f6c\u5316\u7a0b\u5ea6\u3002</p> <p>\u672c\u6587\u4ecb\u7ecd\u4f7f\u7528Python\u4eceExcel\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u4f7f\u7528pyecharts\u7ed8\u5236\u6f0f\u6597\u56fe\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/op-draw-funnel-1/#_1","title":"\u64cd\u4f5c\u6b65\u9aa4\u8bf4\u660e","text":"<p>\u4e0b\u9762\u662f\u64cd\u4f5c\u7684\u5177\u4f53\u6b65\u9aa4\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/op-draw-funnel-1/#1","title":"1.\u5f00\u53d1\u73af\u5883","text":"<p>\u793a\u4f8b\u4f7f\u7528\u7684IDE\u662fPyCharm\u793e\u533a\u7248\uff0c\u5f00\u53d1\u8bed\u8a00\u662fPython3.x\u3002</p> <p>\u5728\u5de5\u7a0b\u4e2d\uff0c\u65b0\u5efaPython\u6587\u4ef6<code>demo_data_funnel.py</code>\u3002\u7136\u540e\u5728\u540c\u7ea7\u7684\u4f4d\u7f6e\u65b0\u5efa\u4e00\u4e2a<code>res</code>\u6587\u4ef6\u5939\uff0c\u540e\u9762\u7528\u6765\u5b58\u653e\u6587\u4ef6\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/op-draw-funnel-1/#2","title":"2.\u51c6\u5907\u6570\u636e","text":"<p>\u521b\u5efa\u4e00\u4e2aExcel\u6587\u4ef6<code>\u4e8b\u4ef6demo.xlsx</code>\u3002\u5c06\u8868\u540d\u6539\u4e3a<code>data3</code>\u3002\u8fd9\u4e2a\u540d\u5b57\u5728\u4ee3\u7801\u4e2d\u4f1a\u7528\u5230\u3002</p> <p>\u5199\u5165\u4e24\u5217\u6570\u636e <pre><code>\u4e8b\u4ef6  \u6b21\u6570\ne1  10000\ne2  4695\ne3  2584\ne4  1295\ne5  954\n</code></pre> \u5f97\u5230\u5982\u4e0b\u7684\u8868\u683c\uff1a </p> <p>\u4e0e<code>demo_data_funnel.py</code>\u540c\u7ea7\u7684\u5730\u65b9\u65b0\u5efa\u4e86<code>res</code>\u6587\u4ef6\u5939\uff0c\u628aExcel\u6587\u4ef6\u653e\u8fdb\u53bb\u3002</p> <p></p> <p>\u8fd9\u91cc\u6211\u4eec\u6682\u65f6\u7528\u6d4b\u8bd5\u6570\u636e\u770b\u6548\u679c\u3002\u540e\u9762\u518d\u586b\u5165\u4f60\u7684\u771f\u5b9e\u6570\u636e\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/op-draw-funnel-1/#3","title":"3.\u7f16\u5199\u811a\u672c","text":"<p>\u73b0\u5728\u5f00\u59cb\u5199Python\u4ee3\u7801\u3002 <code>demo_data_funnel.py</code>\u5b8c\u6574\u7684\u4ee3\u7801\u5982\u4e0b <pre><code>from openpyxl import load_workbook\nfrom pyecharts.charts import Funnel\nimport pyecharts.options as opts\n\n\ndef read_in_data(file_path):\n    print('\u83b7\u53d6\u539f\u59cb\u6570\u636e &gt;&gt;&gt;')\n    wb = load_workbook(file_path)\n    st = wb['data3']\n    data_list = []\n    for row_index in range(2, st.max_row + 1):\n        event_name = st.cell(row=row_index, column=1).value\n        event_value = st.cell(row=row_index, column=2).value\n        data_list.append([event_name, event_value])\n    print(data_list)\n    return data_list\n\n\ndef draw_funnel_default(input_data):\n    print('\u7ed8\u5236\u6f0f\u6597\u56fe &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base')\n    (\n        Funnel(init_opts=opts.InitOpts(width=\"800px\", height=\"400px\"))\n            .add(series_name='\u6f0f\u65971', data_pair=input_data, )\n            .set_global_opts(title_opts=opts.TitleOpts(title=\"\u6f0f\u6597\u56fe1\", subtitle=\"\u9ed8\u8ba4\u6837\u5f0f\"))\n            .render(\"funnel_chart_1.html\")\n    )\n\n\ndef draw_funnel_2(input_data):\n    print('\u7ed8\u5236\u6f0f\u6597\u56fe1 &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base')\n    (\n        Funnel(init_opts=opts.InitOpts(width=\"1000px\", height=\"600px\"))\n            .add(series_name='\u6f0f\u65971', data_pair=input_data,\n                 label_opts=opts.LabelOpts(position=\"inside\", formatter='{b} \u6570\u91cf: {c}'),\n                 gap=2,\n                 tooltip_opts=opts.TooltipOpts(trigger=\"item\", formatter=\"{a} &lt;br/&gt;{b} \u6570\u91cf: {c}\"),\n                 )\n            .set_global_opts(title_opts=opts.TitleOpts(title=\"\u6f0f\u6597\u56fe1\", subtitle=\"\u6539\u53d8\u4e86label\"))\n            .render(\"funnel_chart_2.html\")\n    )\n\n\ndef draw_funnel_3(input_data):\n    print('\u7ed8\u5236\u6f0f\u6597\u56fe2 &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base')\n    data = input_data.copy()  # \u590d\u5236\u4e00\u4efd\u51fa\u6765\u5904\u7406\u6807\u9898\n    base_value = data[0][1]\n    for x in range(0, len(data)):\n        event_name = data[x][0]\n        value = data[x][1]  # \u62ff\u5230\u6570\u503c\n        ratio = value / base_value\n        event_name += '\\n\u603b\u4f53\u8f6c\u5316\u7387: {:.2f}%'.format(ratio * 100)\n        if x &gt; 0:\n            event_name += '\\n\u76f8\u5bf9\u8f6c\u5316\u7387: {:.2f}%'.format(100 * value / data[x - 1][1])\n        data[x][0] = event_name\n        print(event_name)\n\n    (\n        Funnel(init_opts=opts.InitOpts(width=\"1000px\", height=\"800px\"))\n            .add(series_name='\u6f0f\u65971', data_pair=data,\n                 label_opts=opts.LabelOpts(position=\"inside\", formatter='{b}\\n\u6570\u91cf: {c}'),\n                 gap=2,\n                 tooltip_opts=opts.TooltipOpts(trigger=\"item\", formatter=\"{a} &lt;br/&gt;{b} \u6570\u91cf: {c}\"),\n                 )\n            .set_global_opts(title_opts=opts.TitleOpts(title=\"\u6f0f\u6597\u56fe1\", subtitle=\"\u4fee\u6539\u4e86\u5404\u9879\u7684\u6807\u9898\"))\n            .render(\"funnel_chart_3.html\")\n    )\n\n\nif __name__ == '__main__':\n    src_data = read_in_data('res/\u4e8b\u4ef6demo.xlsx')\n    draw_funnel_default(src_data)\n    draw_funnel_2(src_data)\n    draw_funnel_3(src_data)\n</code></pre> \u628a\u4e0a\u9762\u7684\u4ee3\u7801\u590d\u5236\u8fdb\u4f60\u7684\u811a\u672c\u91cc\u3002 \u53ef\u80fd\u4f1a\u9700\u8981\u88c5\u4e0a<code>pyecharts</code>\u548c<code>openpyxl</code>\u3002\u7528PyCharm\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u70b9\u5230\u62a5\u7ea2\u7ebf\u7684\u5730\u65b9\uff0c\u6839\u636e\u5b83\u7684\u63d0\u793a\uff0c\u628a\u8fd92\u4e2a\u5e93\u88c5\u4e0a\u3002</p> <p>\u8fd0\u884c\u4ee3\u7801\uff0c\u4f1a\u5f97\u52303\u4e2ahtml\u6587\u4ef6</p> <p></p> <p>\u7528\u6d4f\u89c8\u5668\u6253\u5f00\u8fd93\u4e2ahtml\u5c31\u53ef\u4ee5\u770b\u5230\u6548\u679c\u4e86\u3002</p> <p>\u628a\u4f60\u7684\u6570\u636e\u586b\u5230\u90a3\u4e2aExcel\u91cc\uff0c\u4fdd\u5b58\u3002\u7136\u540e\u8fd0\u884c\u4ee3\u7801\u5373\u53ef\u3002</p> <p>\u6bd4\u5982\u8bf4\u628aExcel\u91cc\u7684\u4e8b\u4ef6\u6539\u4e00\u4e0b</p> <p></p> <p>\u8fd0\u884c\u4ee3\u7801\uff0c\u53ef\u4ee5\u5f97\u5230\u65b0\u7684\u7ed3\u679c</p> <p></p> <p>\u4ee5\u4e0a\u662f\u7b80\u5316\u6d41\u7a0b\uff0c\u8fd0\u8425\u670b\u53cb\u7167\u7740\u505a\uff0c\u4e00\u822c\u90fd\u53ef\u4ee5\u770b\u5230\u8fd0\u884c\u7ed3\u679c\u3002\u4e0b\u9762\u6211\u4eec\u6765\u770b\u4e00\u4e9b\u7ec6\u8282\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/op-draw-funnel-1/#_2","title":"\u8bfb\u53d6\u6570\u636e","text":"<p>\u6211\u4eec\u5148\u51c6\u5907\u4e00\u4e9b\u6d4b\u8bd5\u6570\u636e\u3002\u65b0\u5efa\u4e00\u4e2axlsx\u6587\u4ef6\uff0c\u586b\u5165\u6d4b\u8bd5\u6570\u636e\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6211\u4eec\u628a\u6570\u636e\u653e\u5728\u4e86<code>data3</code>\u91cc\u3002A\u5217\u662f\u4e8b\u4ef6\u540d\u79f0\uff0cB\u5217\u662f\u6b21\u6570\u3002\u540d\u79f0\u8fd9\u91cc\u53ef\u4ee5\u968f\u610f\u66ff\u6362\uff0c\u53ef\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u8fdb\u884c\u4fee\u6539\u3002 \u4e8b\u4ef6\u6d41\u7a0b\u6309\u7167\u5148\u540e\u987a\u5e8f\uff0c\u4ece\u4e0a\u5230\u4e0b\u6392\u5217\u597d\u3002</p> <p>\u9996\u5148\u9700\u8981\u628a\u6570\u636e\u4eceexcel\u4e2d\u8bfb\u53d6\u51fa\u6765\u3002\u6211\u4eec\u7528openpyxl\u6765\u64cd\u4f5c\u3002 <pre><code>from openpyxl import load_workbook\n\ndef read_in_data(file_path):\n    print('\u83b7\u53d6\u539f\u59cb\u6570\u636e &gt;&gt;&gt;')\n    wb = load_workbook(file_path)\n    st = wb['data3']\n    data_list = []\n    for row_index in range(2, st.max_row + 1):\n        event_name = st.cell(row=row_index, column=1).value\n        event_value = st.cell(row=row_index, column=2).value\n        data_list.append([event_name, event_value])\n    print(data_list)\n    return data_list\n</code></pre> \u5c06\u4e8b\u4ef6\u540d\u548c\u6570\u636e\u88c5\u5230\u4e00\u4e2a\u5c0f\u7684\u5217\u8868\u91cc<code>[event_name, event_value]</code>\u3002 \u6240\u6709\u7684\u4e8b\u4ef6\u653e\u8fdb\u4e00\u4e2a\u5927\u7684\u5217\u8868\uff0c\u5e76\u8fd4\u56de\u3002</p> <p>\u5f53\u7136\uff0c\u4ece\u522b\u7684\u9014\u5f84\u62ff\u5230\u6570\u636e\u4e5f\u662f\u53ef\u4ee5\u7684\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/op-draw-funnel-1/#_3","title":"\u7ed8\u5236\u6f0f\u6597\u56fe","text":"<p>\u6211\u4eec\u7528pyecharts\u6765\u7ed8\u5236\u6f0f\u6597\u56fe\u3002</p> <p>Echarts \u662f\u4e00\u4e2a\u7531\u767e\u5ea6\u5f00\u6e90\u7684\u6570\u636e\u53ef\u89c6\u5316\uff0c\u51ed\u501f\u7740\u826f\u597d\u7684\u4ea4\u4e92\u6027\uff0c\u7cbe\u5de7\u7684\u56fe\u8868\u8bbe\u8ba1\uff0c\u5f97\u5230\u4e86\u4f17\u591a\u5f00\u53d1\u8005\u7684\u8ba4\u53ef\u3002\u800c Python \u662f\u4e00\u95e8\u5bcc\u6709\u8868\u8fbe\u529b\u7684\u8bed\u8a00\uff0c\u5f88\u9002\u5408\u7528\u4e8e\u6570\u636e\u5904\u7406\u3002\u5f53\u6570\u636e\u5206\u6790\u9047\u4e0a\u6570\u636e\u53ef\u89c6\u5316\u65f6\uff0cpyecharts \u8bde\u751f\u4e86\u3002</p> <p>pyecharts\u4f1a\u8f93\u51fahtml\u6587\u4ef6\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/op-draw-funnel-1/#_4","title":"\u9ed8\u8ba4\u6837\u5f0f","text":"<p>\u62ff\u5230\u6570\u636e\u540e\uff0c\u6211\u4eec\u628a\u6570\u636e\u4f20\u7ed9Funnel\u3002</p> <pre><code>from pyecharts.charts import Funnel\nimport pyecharts.options as opts\n\ndef draw_funnel_default(input_data):\n    print('\u7ed8\u5236\u6f0f\u6597\u56fe &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base')\n    (\n        Funnel(init_opts=opts.InitOpts(width=\"800px\", height=\"400px\"))\n            .add(series_name='\u6f0f\u65971', data_pair=input_data, )\n            .set_global_opts(title_opts=opts.TitleOpts(title=\"\u6f0f\u6597\u56fe1\", subtitle=\"\u9ed8\u8ba4\u6837\u5f0f\"))\n            .render(\"funnel_chart_1.html\")\n    )\n\nif __name__ == '__main__':\n    src_data = read_in_data('res/\u4e8b\u4ef6demo.xlsx')\n    draw_funnel_default(src_data)\n</code></pre> <ul> <li>\u521d\u59cb\u914d\u7f6e\u91cc\u8bbe\u5b9a\u5bbd\u9ad8 <code>InitOpts(width=\"800px\", height=\"400px\")</code></li> <li><code>input_data</code>\u5c31\u662f\u6211\u4eec\u524d\u9762\u83b7\u53d6\u7684\u6570\u636e\u5217\u8868\uff1b\u5c06\u5b83\u4f20\u7ed9<code>data_pair</code>\uff0c\u5373<code>data_pair=input_data</code></li> <li>\u8f93\u51fa\u7684\u7f51\u9875\u6587\u4ef6\u540d\u4e3a<code>funnel_chart_1.html</code></li> <li><code>set_global_opts()</code>\u65b9\u6cd5\u8bbe\u7f6e\u5168\u5c40\u914d\u7f6e</li> <li>\u6807\u9898\u8bbe\u7f6e <code>title=\"\u6f0f\u6597\u56fe1\"</code></li> <li>\u526f\u6807\u9898\u8bbe\u7f6e <code>subtitle=\"\u9ed8\u8ba4\u6837\u5f0f\"</code></li> </ul> <p>\u8f93\u51fa\u7684html\u6587\u4ef6\uff0c\u7528\u6d4f\u89c8\u5668\u6253\u5f00\uff0c\u5982\u56fe\uff1a</p> <p></p> <p>\u9f20\u6807\u653e\u4e0a\u53bb\u4f1a\u6709\u5c0f\u5f39\u6846\u63d0\u793a\uff08tooltip\uff09</p> <p>\ud83d\udd17 \u9ed8\u8ba4\u6837\u5f0f\u7f51\u9875\u7684\u94fe\u63a5</p>","tags":["Python"]},{"location":"python/openpyxl/op-draw-funnel-1/#label","title":"\u4fee\u6539label","text":"<p>pyecharts\u5f00\u653e\u4e86\u5f88\u591a\u914d\u7f6e\u3002\u6211\u4eec\u53ef\u4ee5\u4fee\u6539\u4e00\u4e0b\u6bcf\u4e00\u9879\u7684\u6807\u9898\u3002 <pre><code>def draw_funnel_2(input_data):\n    print('\u7ed8\u5236\u6f0f\u6597\u56fe1 &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base')\n    (\n        Funnel(init_opts=opts.InitOpts(width=\"1000px\", height=\"600px\"))\n            .add(series_name='\u6f0f\u65971', data_pair=input_data,\n                 label_opts=opts.LabelOpts(position=\"inside\", formatter='{b} \u6570\u91cf: {c}'),\n                 gap=2,\n                 tooltip_opts=opts.TooltipOpts(trigger=\"item\", formatter=\"{a} &lt;br/&gt;{b} \u6570\u91cf: {c}\"),\n                 )\n            .set_global_opts(title_opts=opts.TitleOpts(title=\"\u6f0f\u6597\u56fe1\", subtitle=\"\u6539\u53d8\u4e86label\"))\n            .render(\"funnel_chart_2.html\")\n    )\n</code></pre></p>","tags":["Python"]},{"location":"python/openpyxl/op-draw-funnel-1/#formatter","title":"formatter","text":"<ul> <li><code>{a}</code>\u662f<code>series_name</code>\uff0c\u5728\u8fd9\u91cc\u662f\u56fe\u8868\u7684\u540d\u5b57</li> <li><code>{b}</code>\u662f\u8fd9\u4e00\u9879\u7684\u6807\u9898</li> <li><code>{c}</code>\u662f\u8fd9\u4e00\u9879\u7684\u6570\u91cf</li> </ul> <p><code>tooltip_opts</code>\u548c<code>label_opts</code>\u90fd\u4f1a\u7528\u5230<code>formatter</code>\u3002</p> <p></p> <p>\ud83d\udd17  \u6d4f\u89c8\u7f51\u9875</p>","tags":["Python"]},{"location":"python/openpyxl/op-draw-funnel-1/#_5","title":"\u81ea\u5df1\u8ba1\u7b97\u8f6c\u5316\u7387","text":"<p>\u4e3a\u4e86\u663e\u793a\u51fa\u76f8\u5bf9\u8f6c\u5316\u7387\u548c\u603b\u4f53\u8f6c\u5316\u7387\u3002\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u8ba1\u7b97\u3002</p> <pre><code>def draw_funnel_3(input_data):\n    print('\u7ed8\u5236\u6f0f\u6597\u56fe2 &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base')\n    data = input_data.copy()  # \u590d\u5236\u4e00\u4efd\u51fa\u6765\u5904\u7406\u6807\u9898\n    base_value = data[0][1]\n    for x in range(0, len(data)):\n        event_name = data[x][0]\n        value = data[x][1]  # \u62ff\u5230\u6570\u503c\n        ratio = value / base_value\n        event_name += '\\n\u603b\u4f53\u8f6c\u5316\u7387: {:.2f}%'.format(ratio * 100)\n        if x &gt; 0:\n            event_name += '\\n\u76f8\u5bf9\u8f6c\u5316\u7387: {:.2f}%'.format(100 * value / data[x - 1][1])\n        data[x][0] = event_name\n        print(event_name)\n\n    (\n        Funnel(init_opts=opts.InitOpts(width=\"1000px\", height=\"800px\"))\n            .add(series_name='\u6f0f\u65971', data_pair=data,\n                 label_opts=opts.LabelOpts(position=\"inside\", formatter='{b}\\n\u6570\u91cf: {c}'),\n                 gap=2,\n                 tooltip_opts=opts.TooltipOpts(trigger=\"item\", formatter=\"{a} &lt;br/&gt;{b} \u6570\u91cf: {c}\"),\n                 )\n            .set_global_opts(title_opts=opts.TitleOpts(title=\"\u6f0f\u6597\u56fe1\", subtitle=\"\u4fee\u6539\u4e86\u5404\u9879\u7684\u6807\u9898\"))\n            .render(\"funnel_chart_3.html\")\n    )\n</code></pre> <p>\u5728for\u5faa\u73af\u91cc\u8ba1\u7b97\u8f6c\u5316\u7387\uff0c\u5e76\u628a\u7ed3\u679c\u5199\u5230\u4e8b\u4ef6\u7684\u540d\u79f0\u91cc\u3002</p> <p></p> <p>\ud83d\udd17  \u6d4f\u89c8\u7f51\u9875</p>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-bar-column-chart/","title":"\u3010\u8fd0\u8425\u7684Python\u6307\u5357\u3011Python Excel \u7ed8\u5236\u67f1\u5f62\u56fe","text":"\u66f4\u65b0\u65e5\u671f 2019-11-19 <ul> <li>2019-11-19 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u8fd9\u662f\u4e00\u4efd\u5199\u7ed9\u8fd0\u8425\u4eba\u5458\u7684Python\u6307\u5357\u3002\u672c\u6587\u4e3b\u8981\u8bb2\u8ff0\u5982\u4f55\u4f7f\u7528Python\u64cd\u4f5cExcel\u7ed8\u5236\u67f1\u5f62\u56fe\u3002</p> <p>\u5f00\u53d1\u5de5\u5177\uff0c\u73af\u5883</p> <ul> <li>PyCharm</li> <li>Python3</li> <li>Office Excel</li> </ul> <p>\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u521b\u5efa\u597d\u4e86\u4e00\u5f20Excel\u8868\u3002 \u73b0\u5728\u6211\u4eec\u8981\u6839\u636e\u5df2\u6709\u7684\u6570\u636e\uff0c\u5f80\u91cc\u9762\u6dfb\u52a0\u67f1\u5f62\u56fe\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-bar-column-chart/#barchart","title":"\u67f1\u5f62\u56fe BarChart","text":"<p>\u53c2\u8003\u300aPython openpyxl Excel\u7ed8\u5236\u67f1\u5f62\u56fe\u300b\u5f97\u77e5\uff0c\u6211\u4eec\u4e3b\u8981\u4f7f\u7528<code>BarChart</code>\u4e0e<code>BarChart3D</code>\u7c7b\u3002 \u56fe\u8868\u4e2d\u8bb8\u591a\u7684\u7ec6\u8282\u7531BarChart\u5c5e\u6027\u63a7\u5236\u3002</p> <p>\u540e\u6587\u90fd\u4ee5chart1\u6765\u8868\u793a\u67f1\u5f62\u56fe\u5bf9\u8c61 <code>chart1 = BarChart()</code> \u3002</p>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-bar-column-chart/#reference","title":"\u6570\u636e\u6765\u6e90\u8303\u56f4 Reference","text":"<p>\u9996\u5148\u6211\u4eec\u5e94\u8be5\u786e\u5b9a\u6570\u636e\u7684\u8303\u56f4\u3002\u6709\u6570\u636e\u624d\u597d\u7ed8\u56fe\u3002\u8fd9\u91cc\u4f7f\u7528\u7684\u662f<code>Reference</code>\u7c7b\u6765\u8868\u793a\u6570\u636e\u201c\u5f15\u7528\u201d\u8303\u56f4\u3002 <pre><code>    data1 = Reference(st, min_col=2, min_row=1, max_row=7, max_col=3)\n    cats1 = Reference(st, min_col=1, min_row=2, max_row=7)\n</code></pre> \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8303\u56f4\u7684\u4e0b\u6807\u662f\u4ece1\u5f00\u59cb\u7684\u3002 \u8fd9\u91cc\u7684data1\u628a\u6807\u9898\u4e5f\u6846\u8fdb\u53bb\u4e86\u3002\u8bbe\u5b9a\u6570\u636e\u7684\u65f6\u5019\uff0c\u9700\u8981\u8bbe\u7f6e<code>titles_from_data=True</code> <pre><code>chart1.add_data(data1, titles_from_data=True)\n</code></pre></p> <p>\u8bbe\u7f6e\u79cd\u7c7b\u4f7f\u7528<code>set_categories</code>\u65b9\u6cd5\uff0c\u4e5f\u662f\u628a\u4e00\u4e2a\u8303\u56f4\uff08Reference\uff09\u7684\u6570\u636e\u4f20\u5165\u3002 <pre><code>chart1.set_categories(cats1)\n</code></pre></p>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-bar-column-chart/#type","title":"\u67f1\u5b50\u65b9\u5411\u63a7\u5236 type","text":"<p>\u65b9\u5411\u7531\u5c5e\u6027<code>type</code>\u6765\u63a7\u5236\uff0c\u67092\u4e2a\u53ef\u9009\u53c2\u6570\uff1a<code>bar</code>\u8868\u793a\u6a2a\u5411\uff0c<code>col</code>\u8868\u793a\u7ad6\u76f4\u3002</p> <pre><code>chart1.type = \"bar\" # \u6a2a\u5411\u67f1\u5f62\u56fe\nchart1.type = \"col\" # \u7eb5\u5411\u67f1\u5f62\u56fe\n</code></pre>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-bar-column-chart/#title","title":"\u6807\u9898 title","text":"<p>\u5c5e\u6027title\u63a7\u5236\u6807\u9898\u3002\u5982\u679c\u7f6e\u4e3aNone\u5219\u4e0d\u663e\u793a\u6807\u9898\u3002</p> <p>\u56fe\u8868\u7684\u6807\u9898 <code>chart1.title = \"\u65e5\u5747\u503c\u5bf9\u6bd4\"</code></p> <p>\u5750\u6807\u7684\u6807\u9898\uff0c\u9996\u5148\u9700\u8981\u62ff\u5230x\uff0cy\u7684\u5750\u6807\u3002 <pre><code>    chart1.y_axis.title = '\u6570\u503c'\n    chart1.x_axis.title = st.cell(column=1, row=1).value  # \u76f4\u63a5\u7528\u5355\u5143\u683c\u7684\u5185\u5bb9\u505a\u6807\u9898\n</code></pre></p>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-bar-column-chart/#_1","title":"\u6dfb\u52a0\u56fe\u8868","text":"<p>add_chart\u5c06\u56fe\u8868\u6dfb\u52a0\u5230sheet\u4e2d\u3002\u56fe\u8868\u7684\u5de6\u4e0a\u89d2\u5bf9\u9f50\u67d0\u4e2a\u5355\u5143\u683c\u3002\u4e0b\u9762\u662f\u5bf9\u9f50A8\u3002 <pre><code>st.add_chart(chart1, 'A8')\n</code></pre></p>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-bar-column-chart/#3d-barchart3d","title":"3D\u67f1\u5f62\u56fe BarChart3D","text":"","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-bar-column-chart/#shape","title":"\u67f1\u5b50\u7684\u5f62\u72b6 shape","text":"<p>\u9ed8\u8ba4\u662f\u7acb\u65b9\u4f53\uff0c\u4f46\u4e5f\u53ef\u4ee5\u4ece\u4e0b\u9762\u7684\u5f62\u72b6\u91cc\u9009\u4e00\u4e2a\u3002</p> <p><code>{'box', 'pyramid', 'pyramidToMax', 'coneToMax', 'cone', 'cylinder'}</code></p> <pre><code>chart1.type = 'cone'\n</code></pre> <p>box \u662f\u7acb\u65b9\u4f53\uff0c\u4e2d\u89c4\u4e2d\u77e9\u3002 pyramid \u662f\u91d1\u5b57\u5854\uff0c\u9876\u90e8\u4e5f\u662f\u5c16\u7684\u3002 cone \u662f\u5706\u9525\uff0c\u770b\u8d77\u6765\u5f88\u5c16\u9510\u3002 cylinder \u662f\u5706\u67f1\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-bar-column-chart/#style","title":"\u914d\u8272\u98ce\u683c style","text":"<p>style \u4f1a\u5f71\u54cd\u56fe\u8868\u7684\u914d\u8272\u98ce\u683c\uff0c\u4e00\u822c\u752810\u6bd4\u8f83\u591a\u5f69\u591a\u6837\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-bar-column-chart/#_2","title":"\u4ee3\u7801\u793a\u4f8b","text":"<p>\u7ed8\u5236\u56fe\u8868\u7528\u7684\u6570\u636e\u6765\u81ea\u8fd0\u8425\u7684Python\u6307\u5357 - Python \u64cd\u4f5cExcel\u3002 \u6211\u4eec\u5728\u5df2\u6709\u7684\u8868\u683c\u4e2d\u6dfb\u52a0\u67f1\u5f62\u56fe\u3002\u4ee3\u7801\u53c2\u8003python-playground - Github</p>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-bar-column-chart/#2d","title":"\u7ed8\u52362D\u67f1\u5f62\u56fe","text":"<pre><code>def create_bar_chart_1(file_path):\n    \"\"\"\n    \u63d2\u5165\u67f1\u5f62\u56fe\n    :param file_path: Excel \u6587\u4ef6\u8def\u5f84\n    :return: None\n    \"\"\"\n    wb = load_workbook(file_path)\n    st = wb.active\n\n    data1 = Reference(st, min_col=2, min_row=1, max_row=7, max_col=3)\n    cats1 = Reference(st, min_col=1, min_row=2, max_row=7)\n\n    chart1 = BarChart()\n    chart1.type = \"col\"\n    chart1.style = 9\n    chart1.title = \"\u65e5\u5747\u503c\u5bf9\u6bd4\"\n    # chart1.y_axis.title = '\u6570\u503c'\n    chart1.x_axis.title = st.cell(column=1, row=1).value\n\n    chart1.add_data(data1, titles_from_data=True)\n    chart1.set_categories(cats1)\n    chart1.shape = 0\n    st.add_chart(chart1, 'A8')\n    wb.save(file_path)\n</code></pre>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-bar-column-chart/#3d","title":"\u7ed8\u52363D\u67f1\u5f62\u56fe","text":"<pre><code>def create_bar_chart_2(file_path):\n    \"\"\"\n    \u63d2\u51653D\u67f1\u5f62\u56fe\n    :param file_path: Excel \u6587\u4ef6\u8def\u5f84\n    :return: None\n    \"\"\"\n    wb = load_workbook(file_path)\n    st = wb.active\n\n    data1 = Reference(st, min_col=2, min_row=1, max_row=7, max_col=3)\n    cats1 = Reference(st, min_col=1, min_row=2, max_row=7)\n\n    chart1 = BarChart3D()\n    chart1.type = \"bar\"\n    chart1.style = 10\n    chart1.title = \"\u65e5\u5747\u503c\u5bf9\u6bd4\"\n    chart1.x_axis.title = None\n    chart1.shape = 'cylinder'\n\n    chart1.add_data(data1, titles_from_data=True)\n    chart1.set_categories(cats1)\n    st.add_chart(chart1, 'A26')\n    wb.save(file_path)\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c\u793a\u4f8b\u56fe\u7247</p> <p></p> <p>\u76f8\u5173\u4ee3\u7801\u8bf7\u53c2\u8003python-playground - github</p>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-use/","title":"\u3010\u8fd0\u8425\u7684Python\u6307\u5357\u3011Python \u64cd\u4f5cExcel","text":"\u66f4\u65b0\u65e5\u671f 2022-8-18 <ul> <li>2022-8-18 \u66f4\u65b0\u683c\u5f0f</li> <li>2019-11-5 \u521b\u5efa\u6587\u6863</li> </ul> \u5f00\u53d1\u5de5\u5177\uff0c\u73af\u5883 <ul> <li>PyCharm</li> <li>Python3</li> </ul> <p>\u8fd9\u662f\u4e00\u4efd\u5199\u7ed9\u8fd0\u8425\u4eba\u5458\u7684Python\u6307\u5357\u3002\u672c\u6587\u4e3b\u8981\u8bb2\u8ff0\u5982\u4f55\u4f7f\u7528Python\u64cd\u4f5cExcel\u3002\u5b8c\u6210Excel\u7684\u521b\u5efa\uff0c\u67e5\u8be2\u548c\u4fee\u6539\u64cd\u4f5c\u3002</p> <p>\u76f8\u5173\u4ee3\u7801\u8bf7\u53c2\u8003 python-playground - Github</p> <p>\u8fd9\u91cc\u9ed8\u8ba4\u4f60\u7684\u7535\u8111\u4e0a\u5df2\u7ecf\u88c5\u6709python3.x\uff0c\u73af\u5883\u53d8\u91cf\u5df2\u7ecf\u914d\u7f6e\u597d\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-use/#openpyxl","title":"\u5f15\u5165openpyxl","text":"<p>\u8fd9\u91cc\u4f7f\u7528openpyxl\u5e93\u6765\u64cd\u4f5cExcel\u3002\u7c7b\u4f3c\u7684\u5e93\u8fd8\u6709xlrd\u3002</p> <p>penpyxl\u7684\u57fa\u7840\u4f7f\u7528\u65b9\u6cd5\u8bf7\u53c2\u89c1Python openpyxl \u5904\u7406Excel\u4f7f\u7528\u6307\u5357\u3002</p> <pre><code>pip install openpyxl\n</code></pre>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-use/#_1","title":"\u6570\u636e\u51c6\u5907","text":"<p>\u5047\u5b9a\u6570\u636e\u6765\u81ea\u767e\u5ea6\u6307\u6570\uff0c\u4ee5\u5e38\u89c1\u7684\u4e00\u4e9b\u641c\u7d22\u6307\u6570\u4e3a\u4f8b\u3002\u7ed9\u540e\u9762\u7684\u64cd\u4f5c\u51c6\u5907\u4e00\u4e9b\u6570\u636e\uff0c\u628a\u6570\u636e\u5199\u5165Excel\u4e2d\u3002</p> <p>\u521b\u5efaWorkbook\u5bf9\u8c61\uff0c\u83b7\u53d6\u5230\u5f53\u524d\u53ef\u7528\u7684\u8868\u683c\uff08sheet\uff09\u3002 \u76f4\u63a5\u4f7f\u7528<code>append</code>\u65b9\u6cd5\u628a\u4e00\u884c\u6570\u636e\u8ffd\u52a0\u5199\u5165\u3002\u6700\u540e\u8c03\u7528Workbook\u7684\u4fdd\u5b58\u65b9\u6cd5\uff0c\u5b58\u50a8\u6570\u636e\u3002</p> <pre><code>def create_excel_demo(file_path):\n    \"\"\"\n    \u521b\u5efaExcel\u6587\u4ef6\uff0c\u5e76\u5199\u5165\u6570\u636e\n    :param file_path: \u76ee\u6807\u6587\u4ef6\u8def\u5f84\n    :return none\n    \"\"\"\n    wb = Workbook()\n    ws = wb.active\n    ws.title = '\u641c\u7d22\u6307\u6570\u6982\u89c8'\n\n    ws.append(['\u5173\u952e\u8bcd', '\u6574\u4f53\u65e5\u5747\u503c', '\u79fb\u52a8\u65e5\u5747\u503c', '\u6574\u4f53\u540c\u6bd4', '\u6574\u4f53\u73af\u6bd4', '\u79fb\u52a8\u540c\u6bd4', '\u79fb\u52a8\u73af\u6bd4'])\n    ws.append(['excel', 27782, 18181, -0.11, -2, 0.21, 0.02])\n    ws.append(['python', 24267, 8204, 0.27, 0.06, 0.56, 0.01])\n    ws.append(['\u6587\u6848', 2411, 1690, 0.56, 0.33, 0.91, 0.46])\n    ws.append(['okr', 1928, 880, 0.38, 0.15, 0.29, 0.09])\n    ws.append(['kpi', 4212, 2784, 0.21, -0.19, 0.36, -0.22])\n    wb.save(file_path)\n</code></pre> <p>\u521b\u5efa\u51fa\u6765\u7684\u8868\u683c\uff0c\u793a\u4f8b\u6570\u636e\u5982\u4e0b</p> \u5173\u952e\u8bcd \u6574\u4f53\u65e5\u5747\u503c \u79fb\u52a8\u65e5\u5747\u503c \u6574\u4f53\u540c\u6bd4 \u6574\u4f53\u73af\u6bd4 \u79fb\u52a8\u540c\u6bd4 \u79fb\u52a8\u73af\u6bd4 excel 27782 18181 -0.11 -2 0.21 0.02 python 24267 8204 0.27 0.06 0.56 0.01 ... ... ... ... ... ... ...","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-use/#_2","title":"\u8bfb\u53d6\u6570\u636e","text":"","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-use/#_3","title":"\u8bbf\u95ee\u6574\u4e2a\u8868\u683c\u7684\u6570\u636e","text":"<p>\u8bbf\u95ee\u8868\u683c\u4e2d\u6240\u6709\u7684\u6570\u636e\uff0c\u5e76\u6253\u5370\u51fa\u6765\u3002 \u9996\u5148\u6211\u4eec\u8981\u77e5\u9053\u8868\u683c\u4e2d\u6709\u6570\u636e\u7684\u5355\u5143\u683c\u7684\u8303\u56f4\uff0c\u4f7f\u7528sheet.max_row\u4e0esheet.max_column\u83b7\u53d6\u8868\u683c\u7684\u884c\u5217\u6570\u91cf\u3002</p> <pre><code>def read_xlsx_basic(file_path):\n    \"\"\"\n    \u8bfb\u53d6Excel\u7684\u6570\u636e\u5e76\u6253\u5370\u51fa\u6765\n    \"\"\"\n    wb = load_workbook(file_path)\n    st = wb.active\n    end_row = st.max_row + 1\n    end_column = st.max_column + 1\n    print(st.title, '\u6709', end_row, '\u884c', end_column, '\u5217')\n    for row in range(1, end_row):\n        for col in range(1, end_column):\n            print('{:10}'.format(st.cell(row=row, column=col).value), end='')\n        print()\n</code></pre> <p>\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u5355\u5143\u683c\u4e0b\u6807\u662f\u4ece1\u5f00\u59cb\u7684\u3002\u5982\u679c\u4f7f\u7528\u4e86\u4e0d\u5f53\u7684\u4e0b\u6807\uff0c\u62a5\u9519\u4fe1\u606f</p> <p>ValueError: Row or column values must be at least 1</p> <p>\u53c2\u8003\uff1a https://stackoverflow.com/questions/34492322/how-to-scan-all-sheet-cells</p>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-use/#_4","title":"\u4fee\u6539\u8868\u683c","text":"<p>\u6709\u4e86Excel\u8868\u683c\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u4fee\u6539\u8868\u683c\u7684\u4e00\u4e9b\u683c\u5f0f\u548c\u6570\u636e\u3002</p> <p><code>st</code>\u8868\u793a\u5f53\u524d\u8868\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-use/#_5","title":"\u8c03\u6574\u5217\u7684\u5bbd\u5ea6","text":"<p>\u7528 column_dimensions \u6765\u83b7\u53d6\u5217\u3002\u4f8b\u5982column_dimensions['A']\u83b7\u53d6\u5230\u7684\u662f\u7b2cA\u5217\u3002 <code>ord</code>\u65b9\u6cd5\u662f\u5c06\u5b57\u7b26\u8f6c\u6362\u4e3aascii\u7801\u3002ord('A')\u5f97\u523065\u3002</p> <p>\u8fd9\u91cc\u8c03\u6574\u7684\u662fA\u5217\u5230G\u5217\u7684\u5bbd\u5ea6\u3002 <pre><code>    for col in range(ord('A'), ord('G') + 1):\n        st.column_dimensions[chr(col)].width = 15\n</code></pre></p>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-use/#_6","title":"\u8bbe\u7f6e\u5355\u5143\u683c\u683c\u5f0f","text":"<p>\u683c\u5f0f\uff0c\u6bd4\u5982\u5b57\u4f53\u5927\u5c0f\uff0c\u5bf9\u9f50\u6a21\u5f0f\uff0c\u7c97\u4f53\u659c\u4f53\u7b49\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-use/#_7","title":"\u5b57\u4f53","text":"<p>\u9996\u5148\u6211\u4eec\u8981\u62ff\u5230\u5355\u5143\u683ccell\uff0c\u8fd9\u91cc\u4f7f\u7528st.cell(row=1, column=col)\u6765\u83b7\u53d6\u67d0\u4e00\u4e2a\u683c\u5b50\u3002 Cell\u6301\u6709\u7684font\u662f\u4e0d\u53ef\u4fee\u6539\u7684\u3002\u4e0d\u80fd\u4f7f\u7528\u5982<code>cell.font.size = 13</code>\u8fd9\u6837\u7684\u64cd\u4f5c\uff0c\u4f1a\u62a5\u5f02\u5e38\u3002 copy\u65b9\u6cd5\u662f\u590d\u5236\u4e00\u4e2a\u5bf9\u8c61\u3002\u8fd9\u91cc\u590d\u5236\u7684\u662ffont\u3002</p> <pre><code>cell = st.cell(row=1, column=col)\nfont = copy(cell.font)\nfont.size = 13\nfont.bold = True\ncell.font = font\n</code></pre>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-use/#_8","title":"\u5bf9\u9f50","text":"<p>\u5bf9\u9f50\u6a21\u5f0f\u3002\u4f7f\u7528alignment\u5c5e\u6027\u3002 <pre><code>cell.alignment = Alignment(horizontal=\"center\", vertical=\"center\")\n</code></pre></p>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-use/#_9","title":"\u6570\u636e\u663e\u793a","text":"<p>\u64cd\u4f5cExcel\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e\u5355\u5143\u683c\u6570\u636e\u663e\u793a\u7684\u65b9\u5f0f\uff0c\u6bd4\u5982\u5e38\u89c4\uff0c\u6570\u503c\uff0c\u8d27\u5e01\uff0c\u767e\u5206\u6bd4\u7b49\u7b49\u3002 \u8fd9\u91cc\u4f7f\u7528\u7684\u662fnumber_format\u5c5e\u6027\u3002</p> <p>\u5982\u679c\u6570\u636e\uff08value\uff09\u662f0.02\uff0c\u7ecf\u8fc7\u4e0b\u9762\u7684\u8bbe\u7f6e\u540e\uff0cExcel\u4e2d\u663e\u793a\u7684\u662f2%\u3002 <pre><code>cell.number_format = '0%'\n</code></pre></p>","tags":["Python"]},{"location":"python/openpyxl/op-excel-openpyxl-use/#_10","title":"\u4fee\u6539\u6570\u636e","text":"<p>\u4fee\u6539\u5355\u5143\u683c\u7684\u6570\u503c\uff08value\uff09\u3002 \u4fee\u6539\u6570\u636e\u9996\u5148\u8981\u62ff\u5230\u90a3\u4e2a\u5355\u5143\u683ccell\uff0c\u7136\u540e\u5bf9\u5176value\u8d4b\u503c\u3002 <pre><code>st.cell(row=2, column=7).value = 0.42  # \u4fee\u6539\u6570\u503c\n</code></pre></p> <p>\u4fee\u6539\u4e86\u5355\u5143\u683c\u7684\u6837\u5f0f\u548c\u6570\u636e\u540e\uff0c\u53ef\u4ee5\u6253\u5f00\u8868\u683c\u770b\u770b\u6548\u679c\u3002</p> <p>\u53c2\u8003\uff1a</p> <ul> <li>https://stackoverflow.com/questions/12387212/openpyxl-setting-number-format</li> <li>https://stackoverflow.com/questions/30050716/how-to-put-two-decimals-in-cell-with-type-of-percent</li> </ul> <p>\u76f8\u5173\u4ee3\u7801\u8bf7\u53c2\u8003 python-playground - Github</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>51CTO</p>","tags":["Python"]},{"location":"python/openpyxl/openpyxl-charts-bar-column/","title":"Python openpyxl Excel\u7ed8\u5236\u67f1\u5f62\u56fe\u6307\u5357","text":"\u66f4\u65b0\u65e5\u671f 2019-11-14 <ul> <li>2019-11-14 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u8fd9\u662f\u4e00\u4efdopenpyxl\u7684\u4f7f\u7528\u6307\u5357\u3002</p> <p>\u5927\u4f53\u5185\u5bb9\u7ffb\u8bd1\u81ea\u5b98\u7f51 https://openpyxl.readthedocs.io/en/stable/charts/bar.html#vertical-horizontal-and-stacked-bar-charts</p> <p>\u672c\u6587\u5728\u5b98\u7f51\u57fa\u7840\u4e0a\u4f1a\u6709\u4e00\u4e9b\u6539\u52a8\u3002\u4ee3\u7801\u8bf7\u53c2\u8003 https://github.com/RustFisher/python-playground</p>","tags":["Python"]},{"location":"python/openpyxl/openpyxl-charts-bar-column/#_1","title":"\u67f1\u5f62\u56fe","text":"<p>\u6570\u636e\u4f1a\u88ab\u7ed8\u5236\u6210\u5782\u76f4\uff0c\u6c34\u5e73\u6216\u8005\u662f\u5c42\u53e0\u6548\u679c\u7684\u67f1\u5f62\u56fe\u3002</p> <p>\u6ce8\u610f\uff1a</p> <ul> <li>\u63a5\u4e0b\u6765\u7684\u8bbe\u7f6e\u4f1a\u5f71\u54cd\u5230\u4e0d\u540c\u7c7b\u578b\u7684\u56fe\u8868\u3002</li> <li>\u8bbe\u7f6e\u7c7b\u522b\u53ef\u4ee5\u63a7\u5236\u67f1\u5f62\u56fe\u662f\u5782\u76f4\u6216\u662f\u6c34\u5e73\u3002</li> <li>\u4f7f\u7528\u5c42\u53e0\u56fe\u5f62\u65f6\uff0c\u9700\u8981\u8bbe\u7f6eoverlap\u6210100\u3002</li> <li>\u5982\u679c\u67f1\u5f62\u662f\u6c34\u5e73\u7684\uff0cx\u548cy\u5750\u6807\u4f1a\u5bf9\u8c03\u8fc7\u6765\u3002</li> </ul>","tags":["Python"]},{"location":"python/openpyxl/openpyxl-charts-bar-column/#2d","title":"2D\u56fe\u8868","text":"<p>\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff0c\u6839\u636e\u7ed9\u5b9a\u7684\u6570\u636e\u7ed8\u5236\u4e864\u5f20\u56fe\u8868\u3002 <pre><code>from openpyxl import Workbook\nfrom openpyxl.chart import BarChart, Series, Reference\n\n\ndef bar_chart_demo():\n    wb = Workbook(write_only=True)\n    ws = wb.create_sheet()\n\n    rows = [\n        ('Number', 'Batch 1', 'Batch 2'),\n        (2, 10, 30),\n        (3, 40, 60),\n        (4, 50, 70),\n        (5, 20, 10),\n        (6, 10, 40),\n        (7, 50, 30),\n    ]\n\n    for row in rows:\n        ws.append(row)\n\n    chart1 = BarChart()\n    chart1.type = \"col\"\n    chart1.style = 10\n    chart1.title = \"Bar Chart\"\n    chart1.y_axis.title = 'Test number'\n    chart1.x_axis.title = 'Sample length (mm)'\n\n    data = Reference(ws, min_col=2, min_row=1, max_row=7, max_col=3)\n    cats = Reference(ws, min_col=1, min_row=2, max_row=7)\n    chart1.add_data(data, titles_from_data=True)\n    chart1.set_categories(cats)\n    chart1.shape = 4\n    ws.add_chart(chart1, \"A10\")\n\n    from copy import deepcopy\n\n    chart2 = deepcopy(chart1)\n    chart2.style = 11\n    chart2.type = \"bar\"\n    chart2.title = \"Horizontal Bar Chart\"\n\n    ws.add_chart(chart2, \"I10\")\n\n    chart3 = deepcopy(chart1)\n    chart3.type = \"col\"\n    chart3.style = 12\n    chart3.grouping = \"stacked\"\n    chart3.overlap = 100\n    chart3.title = 'Stacked Chart'\n\n    ws.add_chart(chart3, \"A27\")\n\n    chart4 = deepcopy(chart1)\n    chart4.type = \"bar\"\n    chart4.style = 13\n    chart4.grouping = \"percentStacked\"\n    chart4.overlap = 100\n    chart4.title = 'Percent Stacked Chart'\n\n    ws.add_chart(chart4, \"I27\")\n\n    wb.save(\"out/bar.xlsx\")\n\n\nif __name__ == '__main__':\n    bar_chart_demo()\n</code></pre></p> <p>\u8bd1\u8005\u6ce8\uff1a\u8fd9\u91cc\u8c03\u6574\u4e86\u56fe\u8868\u5728excel\u4e2d\u7684\u4f4d\u7f6e\uff0c\u539f\u6587\u662f\u5728<code>G</code>\u5217\uff0c\u5373<code>G10</code>\u548c<code>G27</code>\uff0c\u8fd9\u91cc\u6539\u4e3a\u4e86<code>I</code>\u5217\u3002\u4ee3\u7801\u683c\u5f0f\u4e5f\u6709\u5fae\u8c03\u3002</p> <p>\u6211\u4eec\u9700\u8981\u751f\u6210\u56fe\u8868\u7684\u65f6\u5019\uff0cExcel\u4f1a\u8981\u6211\u4eec\u5148\u9009\u5b9a\u6570\u636e\u8303\u56f4\uff08\u6765\u6e90\uff09\u3002\u5728\u4ee3\u7801\u4e2d\u7528<code>Reference</code>\u6765\u6307\u5b9a\u6570\u636e\u6765\u6e90\u8303\u56f4\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/openpyxl-charts-bar-column/#3d","title":"3D\u56fe\u8868","text":"<p>\u7ed8\u52363D\u56fe\u8868\uff0c\u4f7f\u7528<code>BarChart3D</code>\u3002 <pre><code>def bar_3d():\n    wb = Workbook()\n    ws = wb.active\n\n    rows = [\n        (None, 2013, 2014),\n        (\"Apples\", 5, 4),\n        (\"Oranges\", 6, 2),\n        (\"Pears\", 8, 3)\n    ]\n\n    for row in rows:\n        ws.append(row)\n\n    data = Reference(ws, min_col=2, min_row=1, max_col=3, max_row=4)\n    titles = Reference(ws, min_col=1, min_row=2, max_row=4)\n    chart = BarChart3D()\n    chart.title = \"3D Bar Chart\"\n    chart.add_data(data=data, titles_from_data=True)\n    chart.set_categories(titles)\n\n    ws.add_chart(chart, \"E5\")\n    wb.save(\"out/bar3d.xlsx\")\n</code></pre></p> <p>\u521b\u5efa\u597d\u7684\u56fe\u8868\u7528WPS\u6253\u5f00\u53d1\u73b0\u662f2D\u7684\u3002\u7528Office Excel\u6253\u5f00\u662f3D\u7684\u3002</p> <p></p> <p>\u4ee3\u7801\u8bf7\u53c2\u8003 https://github.com/RustFisher/python-playground</p>","tags":["Python"]},{"location":"python/openpyxl/openpyxl-tutorial/","title":"Python openpyxl \u5904\u7406Excel\u4f7f\u7528\u6307\u5357","text":"\u66f4\u65b0\u65e5\u671f 2019-11-03 <ul> <li>2019-11-03 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u8fd9\u662f\u4e00\u4efdopenpyxl\u7684\u4f7f\u7528\u6307\u5357\u3002</p> <p>\u7ffb\u8bd1\u81ea\u5b98\u7f51 https://openpyxl.readthedocs.io/en/stable/tutorial.html</p>","tags":["Python"]},{"location":"python/openpyxl/openpyxl-tutorial/#_1","title":"\u521b\u5efa\u5de5\u4f5c\u672c","text":"<p>workbook\u6307\u7684\u5c31\u662fExcel\u6587\u4ef6\u3002\u4f7f\u7528openpyxl\u5e76\u4e0d\u9700\u8981\u4f60\u5728\u7535\u8111\u4e0a\u81ea\u5df1\u521b\u5efa\u6587\u4ef6\u3002\u76f4\u63a5\u5f15\u5165Workbook\u7c7b\u5c31\u53ef\u4ee5\u5f00\u59cb\u5de5\u4f5c\u3002</p> <pre><code>&gt;&gt;&gt; from openpyxl import Workbook\n&gt;&gt;&gt; wb = Workbook()\n</code></pre> <p>\u81f3\u6b64\u4e00\u4e2a\u81f3\u5c11\u67091\u4e2a\u5de5\u4f5c\u8868\u7684\u5de5\u4f5c\u672c\u5df2\u7ecf\u88ab\u521b\u5efa\u4e86\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7Workbook.active\u5c5e\u6027\u6765\u83b7\u53d6\u5230\u5de5\u4f5c\u8868\u3002 <pre><code>&gt;&gt;&gt; ws = wb.active\n</code></pre></p> <p>\u6ce8\u610f\uff1a \u9ed8\u8ba4\u5de5\u4f5c\u8868\u5e8f\u53f7\u662f\u88ab\u8bbe\u7f6e\u62100\u7684\u3002\u9664\u975e\u4f60\u4fee\u6539\u4e86\u8fd9\u4e2a\u503c\uff0c\u5426\u5219\u7528\u8fd9\u4e2a\u65b9\u6cd5\u83b7\u53d6\u5230\u7684\u90fd\u662f\u7b2c\u4e00\u5f20\u8868\u3002</p> <p>\u53ef\u4ee5\u901a\u8fc7 Workbook.create_sheet() \u65b9\u6cd5\u6765\u521b\u5efa\u65b0\u7684\u5de5\u4f5c\u8868</p> <p><pre><code>&gt;&gt;&gt; ws1 = wb.create_sheet(\"Mysheet\") # \u9ed8\u8ba4\u5728\u540e\u9762\u63d2\u5165\u4e00\u5f20\u65b0\u8868\n# \u6216\u8005\n&gt;&gt;&gt; ws2 = wb.create_sheet(\"Mysheet\", 0) # \u5728\u7b2c\u4e00\u4f4d\u63d2\u5165\u65b0\u8868\n# \u6216\u8005\n&gt;&gt;&gt; ws3 = wb.create_sheet(\"Mysheet\", -1) # \u5728\u5012\u6570\u7b2c\u4e8c\u7684\u4f4d\u7f6e\u63d2\u5165\u8868\n</code></pre> \u5de5\u4f5c\u8868\u88ab\u521b\u5efa\u7684\u65f6\u5019\u4f1a\u81ea\u52a8\u547d\u540d\uff0c\u540d\u5b57\u662f\u4ee5\u6570\u5b57\u5e8f\u5217\u6765\u6392\u7684\uff08\u4f8b\u5982Sheet, Sheet1, Sheet2, \u2026\uff09\u3002 \u53ef\u4ee5\u4f7f\u7528 Worksheet.title \u6765\u4fee\u6539\u5de5\u4f5c\u8868\u7684\u540d\u5b57\u3002</p> <pre><code>ws.title = \"New Title\"\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5de5\u4f5c\u8868\u540d\u5b57\u7684\u6807\u9898\u989c\u8272\u662f\u767d\u8272\u7684\u3002 \u8d4b\u4e88RGB\u503c Worksheet.sheet_properties.tabColor \u6765\u4fee\u6539\u989c\u8272\u3002</p> <pre><code>ws.sheet_properties.tabColor = \"1072BA\"\n</code></pre> <p>\u5f53\u4f60\u547d\u540d\u4e86\u5de5\u4f5c\u8868\u540e\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u540d\u5b57\u6765\u83b7\u53d6\u5230\u8fd9\u5f20\u8868\u3002</p> <pre><code>&gt;&gt;&gt; ws3 = wb[\"New Title\"]\n</code></pre> <p>\u67e5\u770b\u5de5\u4f5c\u672c\u4e2d\u6240\u6709\u8868\u683c\u7684\u540d\u5b57\uff0c\u4f7f\u7528 Workbook.sheetname \u5c5e\u6027\u3002</p> <pre><code>&gt;&gt;&gt; print(wb.sheetnames)\n['Sheet2', 'New Title', 'Sheet1']\n</code></pre> <p>\u5faa\u73af\u6253\u5370\u540d\u5b57 <pre><code>&gt;&gt;&gt; for sheet in wb:\n...     print(sheet.title)\n</code></pre></p> <p>\u5728\u540c\u4e00\u4e2a\u5de5\u4f5c\u672c\uff08Excel\u6587\u4ef6\uff09\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528 Workbook.copy_worksheet() \u590d\u5236\u8868\u683c\u3002 <pre><code>&gt;&gt;&gt; source = wb.active\n&gt;&gt;&gt; target = wb.copy_worksheet(source)\n</code></pre></p> <p>\u6ce8\u610f \u53ea\u6709\u5355\u5143\u683c\uff08\u5305\u62ec\u6570\u503c\uff0c\u98ce\u683c\uff0c\u8d85\u94fe\u63a5\u548c\u6ce8\u91ca\uff09\u548c\u786e\u5b9a\u7684\u5de5\u4f5c\u8868\u5c5e\u6027\uff08\u5305\u62ec\u5c3a\u5bf8\uff0c\u683c\u5f0f\u548c\u5c5e\u6027\uff09\u53ef\u4ee5\u88ab\u590d\u5236\u3002 \u5de5\u4f5c\u8868\u5176\u4ed6\u7684\u5185\u5bb9\u662f\u4e0d\u80fd\u590d\u5236\u7684\uff0c\u6bd4\u5982\u56fe\u7247\uff0c\u56fe\u8868\u7b49\u3002</p> <p>\u4e5f\u53ef\u4ee5\u5728\u4e0d\u540c\u7684Excel\u6587\u4ef6\u4e2d\u590d\u5236\u8868\u683c\u3002\u5982\u679cExcel\u6587\u4ef6\u662f\u53ea\u8bfb\u6216\u53ea\u5199\u7684\uff0c\u5c31\u4e0d\u80fd\u590d\u5236\u8868\u683c\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/openpyxl-tutorial/#_2","title":"\u5904\u7406\u6570\u636e","text":"","tags":["Python"]},{"location":"python/openpyxl/openpyxl-tutorial/#_3","title":"\u5355\u5143\u683c","text":"<p>\u73b0\u5728\u6211\u4eec\u77e5\u9053\u6765\u5982\u4f55\u83b7\u53d6\u5230\u5de5\u4f5c\u8868\u3002\u6211\u4eec\u53ef\u4ee5\u5f00\u59cb\u4fee\u6539\u5355\u5143\u683c\u6570\u636e\u4e86\u3002 \u7528\u5355\u5143\u683c\u7684\u5750\u6807\u53ef\u4ee5\u83b7\u53d6\u5230\u5355\u5143\u683c\u3002 <pre><code>&gt;&gt;&gt; c = ws['A4']\n</code></pre> \u8fd4\u56de\u7684\u662fA4\u5355\u5143\u683c\u3002\u5982\u679c\u4e4b\u524dA4\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u521b\u5efaA4\u5355\u5143\u683c\u3002</p> <p>\u7ed9\u5355\u5143\u683c\u4f20\u5165\u6570\u636e\uff0c\u76f4\u63a5\u8d4b\u503c <pre><code>&gt;&gt;&gt; ws['A4'] = 4\n</code></pre></p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u7528 Worksheet.cell() \u65b9\u6cd5\uff0c\u901a\u8fc7\u884c\u5217\u5e8f\u53f7\u7684\u65b9\u5f0f\u6765\u62ff\u5230\u5355\u5143\u683c\u3002 <pre><code>&gt;&gt;&gt; d = ws.cell(row=4, column=2, value=10)\n</code></pre></p> <p>\u6ce8\u610f  \u5982\u679c\u5de5\u4f5c\u8868\u662f\u5728\u5185\u5b58\u4e2d\u521b\u5efa\u7684\uff0c\u5b83\u662f\u4e0d\u5305\u542b\u5355\u5143\u683c\u7684\u3002\u7b2c\u4e00\u6b21\u83b7\u53d6\u5355\u5143\u683c\u65f6\u4f1a\u5148\u521b\u5efa\u5355\u5143\u683c\u3002</p> <p>\u8b66\u544a\uff1a\u56e0\u4e3a\u8fd9\u4e2a\u7279\u6027\uff0c\u5c31\u7b97\u662f\u6ca1\u7ed9\u5355\u5143\u683c\u8d4b\u503c\uff0c\u904d\u5386\u7684\u65f6\u5019\u4f1a\u76f4\u63a5\u5728\u5185\u5b58\u4e2d\u521b\u5efa\u5b83\u4eec\u3002</p> <p>\u4f8b\u5982 <pre><code>&gt;&gt;&gt; for x in range(1,101):\n...        for y in range(1,101):\n...            ws.cell(row=x, column=y)\n</code></pre> \u4f1a\u5728\u5185\u5b58\u4e2d\u521b\u5efa 100x100 \u4e2a\u6ca1\u6709\u503c\u7684\u5355\u5143\u683c\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/openpyxl-tutorial/#_4","title":"\u5904\u7406\u591a\u4e2a\u5355\u5143\u683c","text":"<p>\u83b7\u53d6\u4e00\u4e2a\u8303\u56f4\u5185\u7684\u591a\u4e2a\u5355\u5143\u683c\u3002 <pre><code>&gt;&gt;&gt; cell_range = ws['A1':'C2']\n</code></pre></p> <p>\u83b7\u53d6\u884c\u6216\u5217\u7684\u5355\u5143\u683c <pre><code>&gt;&gt;&gt; colC = ws['C']\n&gt;&gt;&gt; col_range = ws['C:D']\n&gt;&gt;&gt; row10 = ws[10]\n&gt;&gt;&gt; row_range = ws[5:10]\n</code></pre></p> <p>\u4e5f\u53ef\u4ee5\u7528 Worksheet.iter_rows() \u65b9\u6cd5  <pre><code>&gt;&gt;&gt; for row in ws.iter_rows(min_row=1, max_col=3, max_row=2):\n...    for cell in row:\n...        print(cell)\n&lt;Cell Sheet1.A1&gt;\n&lt;Cell Sheet1.B1&gt;\n&lt;Cell Sheet1.C1&gt;\n&lt;Cell Sheet1.A2&gt;\n&lt;Cell Sheet1.B2&gt;\n&lt;Cell Sheet1.C2&gt;\n</code></pre></p> <p>\u7c7b\u4f3c\u7684 Worksheet.iter_cols() \u4e5f\u4f1a\u8fd4\u56de\u5217\u5355\u5143\u683c <pre><code>&gt;&gt;&gt; for col in ws.iter_cols(min_row=1, max_col=3, max_row=2):\n...     for cell in col:\n...         print(cell)\n&lt;Cell Sheet1.A1&gt;\n&lt;Cell Sheet1.A2&gt;\n&lt;Cell Sheet1.B1&gt;\n&lt;Cell Sheet1.B2&gt;\n&lt;Cell Sheet1.C1&gt;\n&lt;Cell Sheet1.C2&gt;\n</code></pre></p> <p>\u6ce8\u610f\uff1a\u6027\u80fd\u539f\u56e0 Worksheet.iter_cols() \u65b9\u6cd5\u5728\u53ea\u8bfb\u6a21\u5f0f\u4e0b\u4e0d\u80fd\u4f7f\u7528\u3002</p> <p>\u5982\u679c\u4f60\u9700\u8981\u904d\u5386\u6587\u4ef6\u4e2d\u7684\u6240\u6709\u884c\u5217\uff0c\u53ef\u4ee5\u4f7f\u7528Worksheet.rows <pre><code>&gt;&gt;&gt; ws = wb.active\n&gt;&gt;&gt; ws['C9'] = 'hello world'\n&gt;&gt;&gt; tuple(ws.rows)\n((&lt;Cell Sheet.A1&gt;, &lt;Cell Sheet.B1&gt;, &lt;Cell Sheet.C1&gt;),\n(&lt;Cell Sheet.A2&gt;, &lt;Cell Sheet.B2&gt;, &lt;Cell Sheet.C2&gt;),\n(&lt;Cell Sheet.A3&gt;, &lt;Cell Sheet.B3&gt;, &lt;Cell Sheet.C3&gt;),\n(&lt;Cell Sheet.A4&gt;, &lt;Cell Sheet.B4&gt;, &lt;Cell Sheet.C4&gt;),\n(&lt;Cell Sheet.A5&gt;, &lt;Cell Sheet.B5&gt;, &lt;Cell Sheet.C5&gt;),\n(&lt;Cell Sheet.A6&gt;, &lt;Cell Sheet.B6&gt;, &lt;Cell Sheet.C6&gt;),\n(&lt;Cell Sheet.A7&gt;, &lt;Cell Sheet.B7&gt;, &lt;Cell Sheet.C7&gt;),\n(&lt;Cell Sheet.A8&gt;, &lt;Cell Sheet.B8&gt;, &lt;Cell Sheet.C8&gt;),\n(&lt;Cell Sheet.A9&gt;, &lt;Cell Sheet.B9&gt;, &lt;Cell Sheet.C9&gt;))\n</code></pre></p> <p>\u6216\u8005\u662fWorksheet.columns\u5c5e\u6027 <pre><code>&gt;&gt;&gt; tuple(ws.columns)\n((&lt;Cell Sheet.A1&gt;,\n&lt;Cell Sheet.A2&gt;,\n&lt;Cell Sheet.A3&gt;,\n&lt;Cell Sheet.A4&gt;,\n&lt;Cell Sheet.A5&gt;,\n&lt;Cell Sheet.A6&gt;,\n...\n&lt;Cell Sheet.B7&gt;,\n&lt;Cell Sheet.B8&gt;,\n&lt;Cell Sheet.B9&gt;),\n(&lt;Cell Sheet.C1&gt;,\n&lt;Cell Sheet.C2&gt;,\n&lt;Cell Sheet.C3&gt;,\n&lt;Cell Sheet.C4&gt;,\n&lt;Cell Sheet.C5&gt;,\n&lt;Cell Sheet.C6&gt;,\n&lt;Cell Sheet.C7&gt;,\n&lt;Cell Sheet.C8&gt;,\n&lt;Cell Sheet.C9&gt;))\n</code></pre></p> <p>\u6ce8\u610f\uff1a\u57fa\u4e8e\u6027\u80fd\u65b9\u9762\u7684\u8003\u8651\uff0cWorksheet.columns\u5728\u53ea\u8bfb\u6a21\u5f0f\u4e2d\u4e0d\u80fd\u4f7f\u7528\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/openpyxl-tutorial/#_5","title":"\u8bfb\u53d6\u6570\u636e","text":"<p>\u5982\u679c\u53ea\u662f\u8981\u8bfb\u53d6\u8868\u4e2d\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528 Worksheet.values\u3002\u5b83\u4f1a\u8fd4\u56de\u8868\u4e2d\u6240\u6709\u884c\u7684\u5355\u5143\u683c\u7684\u503c\u3002</p> <pre><code>for row in ws.values:\n   for value in row:\n     print(value)\n</code></pre> <p>Worksheet.iter_rows() \u548c Worksheet.iter_cols() \u90fd\u53ef\u4ee5\u83b7\u53d6\u5230\u5355\u5143\u683c\u7684\u503c\u3002 <pre><code>&gt;&gt;&gt; for row in ws.iter_rows(min_row=1, max_col=3, max_row=2, values_only=True):\n...   print(row)\n\n(None, None, None)\n(None, None, None)\n</code></pre></p>","tags":["Python"]},{"location":"python/openpyxl/openpyxl-tutorial/#_6","title":"\u6570\u636e\u5b58\u50a8","text":"<p>\u5f53\u6211\u4eec\u6709\u4e86\u5355\u5143\u683c\u540e\uff0c\u53ef\u4ee5\u8d4b\u503c <pre><code>&gt;&gt;&gt; c.value = 'hello, world'\n&gt;&gt;&gt; print(c.value)\n'hello, world'\n\n&gt;&gt;&gt; d.value = 3.14\n&gt;&gt;&gt; print(d.value)\n3.14\n</code></pre></p>","tags":["Python"]},{"location":"python/openpyxl/openpyxl-tutorial/#_7","title":"\u4fdd\u5b58\u6587\u4ef6","text":"<p>\u6700\u7b80\u5355\u548c\u6700\u5b89\u5168\u7684\u4fdd\u5b58\u6587\u4ef6\u7684\u65b9\u6cd5\u5c31\u662f\u4f7f\u7528 Workbook.save()\u3002</p> <pre><code>wb = Workbook()\nwb.save('balances.xlsx')\n</code></pre> <p>\u6ce8\u610f\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u5728\u6ca1\u6709\u8b66\u544a\u7684\u60c5\u51b5\u4e0b\u8986\u76d6\u5df2\u6709\u7684\u6587\u4ef6\u3002</p> <p>\u6587\u4ef6\u6269\u5c55\u540d\u5e76\u6ca1\u6709\u88ab\u9650\u5236\u4e3axlsx\u6216xlsm\u3002</p>","tags":["Python"]},{"location":"python/openpyxl/openpyxl-tutorial/#stream","title":"\u5b58\u50a8\u6210\u4e3a\u6d41\uff08stream\uff09","text":"<p>\u5982\u679c\u8981\u628a\u6587\u4ef6\u5b58\u6210\u6d41\uff0c\u4f8b\u5982web\u5e94\u7528Pyramid, Flask \u6216\u8005Django\uff0c\u63d0\u4f9b\u4e00\u4e2aNamedTemporaryFile()\u5373\u53ef <pre><code>&gt;&gt;&gt; from tempfile import NamedTemporaryFile\n&gt;&gt;&gt; from openpyxl import Workbook\n&gt;&gt;&gt; wb = Workbook()\n&gt;&gt;&gt; with NamedTemporaryFile() as tmp:\n        wb.save(tmp.name)\n        tmp.seek(0)\n        stream = tmp.read()\n</code></pre></p> <p>\u628a\u5de5\u4f5c\u672c\u4fdd\u5b58\u6210\u4e3a\u6a21\u677f\uff0c\u9700\u8981\u6307\u5b9a\u5c5e\u6027 template=True <pre><code>&gt;&gt;&gt; wb = load_workbook('document.xlsx')\n&gt;&gt;&gt; wb.template = True\n&gt;&gt;&gt; wb.save('document_template.xltx')\n</code></pre></p> <p>\u8bbetemplate\u4e3aFalse\uff0c\u5373\u4fdd\u5b58\u4e3a\u6587\u6863\u3002 <pre><code>&gt;&gt;&gt; wb = load_workbook('document_template.xltx')\n&gt;&gt;&gt; wb.template = False\n&gt;&gt;&gt; wb.save('document.xlsx', as_template=False)\n</code></pre></p> <p>\u6ce8\u610f\uff1a\u5728\u4fdd\u5b58\u6587\u6863\u7684\u65f6\u5019\u5e94\u8be5\u6ce8\u610f\u6587\u4ef6\u6269\u5c55\u540d\uff0c\u6bd4\u5982.xltx\u548c.xlsx\u3002\u4ee5\u9632\u540e\u9762\u7528\u5176\u4ed6\u8f6f\u4ef6\u6253\u5f00\u7684\u65f6\u5019\u9047\u5230\u9ebb\u70e6\u3002</p> <p>\u63a5\u4e0b\u6765\u7684\u8fd9\u4e9b\u662f\u9519\u8bef\u64cd\u4f5c <pre><code>&gt;&gt;&gt; wb = load_workbook('document.xlsx')\n&gt;&gt;&gt; # \u9700\u8981\u5b58\u50a8\u6210*.xlsx\u6587\u4ef6\n&gt;&gt;&gt; wb.save('new_document.xlsm')\n&gt;&gt;&gt; # MS Excel \u5c06\u65e0\u6cd5\u6253\u5f00\u8fd9\u4e2a\u6587\u4ef6\n&gt;&gt;&gt;\n&gt;&gt;&gt; # \u6216\u8005\n&gt;&gt;&gt;\n&gt;&gt;&gt; # \u9700\u8981\u6307\u5b9a keep_vba=True\n&gt;&gt;&gt; wb = load_workbook('document.xlsm')\n&gt;&gt;&gt; wb.save('new_document.xlsm')\n&gt;&gt;&gt; # MS Excel \u5c06\u65e0\u6cd5\u6253\u5f00\u8fd9\u4e2a\u6587\u4ef6\n&gt;&gt;&gt;\n&gt;&gt;&gt; # \u6216\u8005\n&gt;&gt;&gt;\n&gt;&gt;&gt; wb = load_workbook('document.xltm', keep_vba=True)\n&gt;&gt;&gt; # \u5982\u679c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u6a21\u677f\u6587\u4ef6\uff0c\u6211\u4eec\u5fc5\u987b\u6307\u5b9a\u6269\u5c55\u540d\u4e3axltm\n&gt;&gt;&gt; wb.save('new_document.xlsm')\n&gt;&gt;&gt; # MS Excel \u5c06\u65e0\u6cd5\u6253\u5f00\u8fd9\u4e2a\u6587\u4ef6\n</code></pre></p>","tags":["Python"]},{"location":"python/openpyxl/openpyxl-tutorial/#_8","title":"\u8bfb\u53d6\u6587\u4ef6","text":"<p>\u548c\u5199\u6587\u4ef6\u7c7b\u4f3c\uff0c\u4f7f\u7528openpyxl.load_workbook()\u65b9\u6cd5\u53bb\u6253\u5f00\u4e00\u4e2a\u5df2\u6709\u6587\u4ef6\u3002 <pre><code>&gt;&gt;&gt; from openpyxl import load_workbook\n&gt;&gt;&gt; wb2 = load_workbook('test.xlsx')\n&gt;&gt;&gt; print wb2.sheetnames\n['Sheet2', 'New Title', 'Sheet1']\n</code></pre></p>","tags":["Python"]},{"location":"python/record/adb-use/","title":"Python \u8c03\u7528adb\u547d\u4ee4","text":"\u66f4\u65b0\u65e5\u671f 2017-07-05 <ul> <li>2017-07-05 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4f7f\u7528Python\u901a\u8fc7subprocess\u8c03\u7528adb\u547d\u4ee4\u3002</p> <p>subprocess\u5305\u4e3b\u8981\u529f\u80fd\u662f\u6267\u884c\u5916\u90e8\u547d\u4ee4\uff08\u76f8\u5bf9Python\u800c\u8a00\uff09\u3002\u548cshell\u7c7b\u4f3c\u3002</p> <p>\u6362\u8a00\u4e4b\u9664\u4e86adb\u547d\u4ee4\u5916\uff0c\u5229\u7528subprocess\u53ef\u4ee5\u6267\u884c\u5176\u4ed6\u7684\u547d\u4ee4\uff0c\u6bd4\u5982ls\uff0ccd\u7b49\u7b49\u3002</p> <p>subprocess \u53ef\u53c2\u8003\uff1a https://docs.python.org/2/library/subprocess.html</p> <p>\u5728\u7535\u8111\u4e0a\u88c5\u597dadb\u5de5\u5177\uff0c\u914d\u7f6e\u597dadb\u7684\u73af\u5883\u53d8\u91cf\uff0c\u5148\u786e\u4fddshell\u4e2d\u53ef\u4ee5\u8c03\u7528adb\u547d\u4ee4\u3002</p>","tags":["Python","adb"]},{"location":"python/record/adb-use/#_1","title":"\u4ee3\u7801\u793a\u4f8b","text":"<ul> <li>Python2.7</li> </ul> <p>\u7c7b <code>Adb</code>\uff0c\u5c01\u88c5\u4e86\u4e00\u4e9badb\u7684\u65b9\u6cd5</p> <p><pre><code>import os\nimport subprocess\n\n\nclass Adb(object):\n    \"\"\" Provides some adb methods \"\"\"\n\n    @staticmethod\n    def adb_devices():\n        \"\"\"\n        Do adb devices\n        :return The first connected device ID\n        \"\"\"\n        cmd = \"adb devices\"\n        c_line = subprocess.Popen(cmd, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE).communicate()[0]\n        if c_line.find(\"List of devices attached\") &lt; 0:  # adb is not working\n            return None\n        return c_line.split(\"\\t\")[0].split(\"\\r\\n\")[-1]  # This line may have different format\n\n    @staticmethod\n    def pull_sd_dcim(device, target_dir='E:/files'):\n        \"\"\" Pull DCIM files from device \"\"\"\n        print \"Pulling files\"\n        des_path = os.path.join(target_dir, device)\n        if not os.path.exists(des_path):\n            os.makedirs(des_path)\n        print des_path\n        cmd = \"adb pull /sdcard/DCIM/ \" + des_path\n        result = subprocess.Popen(cmd, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE).communicate()\n        print result\n        print \"Finish!\"\n        return des_path\n\n    @staticmethod\n    def some_adb_cmd():\n        p = subprocess.Popen('adb shell cd sdcard&amp;&amp;ls&amp;&amp;cd ../sys&amp;&amp;ls',\n                             stdout=subprocess.PIPE, stderr=subprocess.PIPE)\n        return_code = p.poll()\n        while return_code is None:\n            line = p.stdout.readline()\n            return_code = p.poll()\n            line = line.strip()\n            if line:\n                print line\n        print \"Done\"\n</code></pre> <code>some_adb_cmd</code>\u65b9\u6cd5\u6267\u884c\u4e00\u8fde\u4e32\u7684\u547d\u4ee4\u3002\u5404\u4e2a\u547d\u4ee4\u4e4b\u95f4\u7528<code>&amp;&amp;</code>\u8fde\u63a5\u3002 \u63a5\u7740\u662f\u4e00\u4e2a\u6b7b\u5faa\u73af\uff0c\u5c06\u6267\u884c\u7ed3\u679c\u6253\u5370\u51fa\u6765\u3002</p>","tags":["Python","adb"]},{"location":"python/record/adb-use/#subprocess","title":"subprocess \u8bf4\u660e","text":"<p><code>creationflags=CREATE_NEW_CONSOLE</code>\u5728\u6267\u884c\u6307\u4ee4\u65f6\u5f39\u51fa\u4e00\u4e2a\u65b0\u7684cmd\u7a97\u53e3</p> <p>\u53ef\u4ee5\u6267\u884c\u6307\u5b9a\u7684bat\u811a\u672c</p> <pre><code>from _subprocess import CREATE_NEW_CONSOLE\nfrom subprocess import Popen\n\n    def _click_new_cmd_window_btn(self):\n        self.log.info(\"click_new_cmd_window_btn\")\n        Popen('cmd', creationflags=CREATE_NEW_CONSOLE)\n\n    def _click_exe_bat_btn1(self):\n        self.log.info(\"run bat\")\n        Popen('C:\\MYDIR\\_debug.bat', creationflags=CREATE_NEW_CONSOLE)\n</code></pre>","tags":["Python","adb"]},{"location":"python/record/ffmpeg-extraction-mp4-use/","title":"Python \u4f7f\u7528FFmpeg\u64cd\u4f5cmp4","text":"\u66f4\u65b0\u65e5\u671f 2019-10-09 <ul> <li>2019-10-09 \u521b\u5efa\u6587\u6863</li> </ul>","tags":["Python","FFmpeg"]},{"location":"python/record/ffmpeg-extraction-mp4-use/#ffmpeg","title":"\u4f7f\u7528FFmpeg","text":"<p>FFmpeg\u662f\u4e00\u5957\u53ef\u4ee5\u7528\u6765\u8bb0\u5f55\u3001\u5904\u7406\u6570\u5b57\u97f3\u9891\u3001\u89c6\u9891\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u6d41\u7684\u5f00\u6e90\u6846\u67b6\uff0c\u91c7\u7528LPL\u6216GPL\u8bb8\u53ef\u8bc1\uff0c\u63d0\u4f9b\u4e86\u5f55\u5236\u3001\u8f6c\u6362\u4ee5\u53ca\u6d41\u5316\u97f3\u89c6\u9891\u7684\u5b8c\u6574\u89e3\u51b3\u65b9\u6848\u3002</p> <p>\u9996\u5148\u5f97\u4e86\u89e3FFmpeg\u7684\u7528\u6cd5\u3002</p> <pre><code>ffmpeg -i red.mkv -f flac -vn red.flac\n</code></pre> <p>\u5982\u679c\u97f3\u9891\uff08\u89c6\u9891\uff09\u6bd4\u5b57\u5e55\u5feb\uff08\u6216\u6162\uff09\uff0c\u5219\u5728\u88c1\u526a\u7684\u65f6\u5019\u7edf\u4e00\u52a0\u4e0a\u6216\u51cf\u53bb\u4e00\u4e2a\u65f6\u95f4\u5dee\u3002</p>","tags":["Python","FFmpeg"]},{"location":"python/record/ffmpeg-extraction-mp4-use/#ffmpeg_1","title":"FFmpeg","text":"<p>PyCharm \u62a5\u9519 'ffmpeg' \u4e0d\u662f\u5185\u90e8\u6216\u5916\u90e8\u547d\u4ee4\uff0c\u4e5f\u4e0d\u662f\u53ef\u8fd0\u884c\u7684\u7a0b\u5e8f</p> <p>\u865a\u62df\u73af\u5883\u4e2d\u9700\u8981\u627e\u5230FFmpeg\u7684\u7edd\u5bf9\u8def\u5f84</p> <pre><code>ffmpeg_bin = 'E:/ffmpeg-20191019-31aafda-win64-static/bin/ffmpeg'\n</code></pre> <pre><code>subprocess.call(get_mp3_cmd, shell=True)\n</code></pre>","tags":["Python","FFmpeg"]},{"location":"python/record/ffmpeg-extraction-mp4-use/#python","title":"Python","text":"","tags":["Python","FFmpeg"]},{"location":"python/record/ffmpeg-extraction-mp4-use/#python-unicodedecodeerror-gbk-codec-cant-decode","title":"python \u8bfb\u53d6\u6587\u4ef6\u65f6\u62a5\u9519 <code>UnicodeDecodeError: 'gbk' codec can't decode</code>","text":"<p>\u9519\u8bef<code>UnicodeEncodeError: \u2018gbk' codec can't encode character \u2018\\xa0' in position</code></p> <p>\u5728\u7f51\u4e0a\u4e00\u67e5\uff0c\u53d1\u73b0\u662f Windows \u7684\u63a7\u5236\u53f0\u7684\u95ee\u9898\u3002\u63a7\u5236\u53f0\u7684\u7f16\u7801\u662f GBK\uff0cPython \u662f UTF-8\uff0c\u9020\u6210\u4e86\u51b2\u7a81\u3002</p> <p>\u7b2c\u4e00\u79cd\u65b9\u6cd5\uff1a\u76f4\u63a5\u66ff\u6362\u51fa\u9519\u7684\u5185\u5bb9 <pre><code>import requests \nurl = 'https://blog.csdn.net/jianhong1990/article/details/17349537'\nprint(requests.get(url).text.replace('\\xa0', ' '))\n</code></pre></p> <p>\u7b2c\u4e8c\u79cd\u65b9\u6cd5\uff1a\u518d\u89e3\u7801</p> <p>\u5148\u7528 GBK \u7f16\u7801\uff0c\u52a0\u4e2a ignore \u4e22\u5f03\u9519\u8bef\u7684\u5b57\u7b26\uff0c\u7136\u540e\u518d\u89e3\u7801\u3002</p> <pre><code>import requests\nurl = 'https://blog.csdn.net/jianhong1990/article/details/17349537'\nprint(requests.get(url).text.encode('gbk', 'ignore').decode('gbk'))\n</code></pre>","tags":["Python","FFmpeg"]},{"location":"python/record/ffmpeg-extraction-mp4-use/#intstring","title":"int\u4e0estring\u4e4b\u95f4\u7684\u8f6c\u5316","text":"<p>str\u8f6c\u6210\u6570\u5b57 <pre><code>ms = int(ms)\n</code></pre></p>","tags":["Python","FFmpeg"]},{"location":"python/record/ffmpeg-extraction-mp4-use/#str","title":"\u6570\u5b57\u8f6c\u6210str","text":"<p>\u8865\u96f6 <pre><code>'{:0&gt;2d}'.format(1)  # output 01\n</code></pre></p>","tags":["Python","FFmpeg"]},{"location":"python/record/ffmpeg-extraction-mp4-use/#_1","title":"\u83b7\u53d6\u5f53\u524d\u65f6\u95f4","text":"<pre><code>import time\n\ntime.time() # \u683c\u5f0f\u5316\u65f6\u95f4\u6233\u4e3a\u6807\u51c6\u683c\u5f0f\nprint(time.strftime('%Y%m%d-%H%M%S', time.localtime(time.time())))\n\n# \u83b7\u53d630\u5929\u524d\u7684\u65f6\u95f4\uff08\u901a\u8fc7\u52a0\u51cf\u79d2\u6570\u6765\u83b7\u53d6\u73b0\u5728\u6216\u8005\u672a\u6765\u67d0\u4e2a\u65f6\u95f4\u70b9\uff09\nprint time.strftime('%Y.%m.%d',time.localtime(time.time()-2592000))\n</code></pre> <p>\u53c2\u8003</p> <ul> <li>http://www.zimuku.la/detail/123853.html</li> <li>http://assrt.net/</li> </ul>","tags":["Python","FFmpeg"]},{"location":"python/record/python3-send-email/","title":"Python3 \u53d1\u9001\u90ae\u4ef6\u529f\u80fd","text":"\u66f4\u65b0\u65e5\u671f 2018-11-14 <ul> <li>2018-11-14 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u53d1\u4fe1\u90ae\u7bb1\u662f\u817e\u8baf\u4f01\u4e1a\u90ae\u7bb1\u3002\u5f00\u53d1\u73af\u5883 Windows7\u3002</p> <p>\u4e3b\u8981\u4f7f\u7528smtplib\u6765\u5b9e\u73b0\u53d1\u90ae\u4ef6\u7684\u529f\u80fd\u3002</p>","tags":["Python"]},{"location":"python/record/python3-send-email/#_1","title":"\u7b80\u5355\u7684\u53d1\u9001\u90ae\u4ef6\u529f\u80fd","text":"<pre><code># \u53d1\u9001\u90ae\u4ef6\nimport smtplib\nfrom email.mime.multipart import MIMEMultipart\nfrom email.mime.text import MIMEText\n\n\ndef send_email():\n    fromaddr = \"from1@your_email.com\" # \u4f60\u7684\u53d1\u4ef6\u90ae\u7bb1\n    toaddr = \"to1@your_email.com\" # \u76ee\u6807\u90ae\u7bb1\n    msg = MIMEMultipart()\n    msg['From'] = fromaddr\n    msg['To'] = toaddr\n    msg['Subject'] = \"SUBJECT OF THE MAIL\"\n\n    body = \"YOUR MESSAGE HERE\"\n    msg.attach(MIMEText(body, 'plain'))\n\n    server = smtplib.SMTP('smtp.exmail.qq.com', 25) # \u9ed8\u8ba4\u7aef\u53e325\n    server.starttls()\n    server.login(fromaddr, \"xxxx\u5bc6\u7801\")\n    text = msg.as_string()\n    server.sendmail(fromaddr, toaddr, text)\n    server.quit()\n\n\nif __name__ == '__main__':\n    print('start sending email')\n    send_email()\n    print('end...')\n</code></pre>","tags":["Python"]},{"location":"python/record/python3-send-email/#_2","title":"\u90ae\u4ef6\u5e26\u4e0a\u9644\u4ef6","text":"<p>Windows\u4e0b\u6ce8\u610f\u6587\u4ef6\u8def\u5f84\u7684\u8868\u8fbe\u65b9\u5f0f\u3002</p> <pre><code># \u53d1\u9001\u90ae\u4ef6\nimport smtplib\nfrom email import encoders\nfrom email.mime.base import MIMEBase\nfrom email.mime.multipart import MIMEMultipart\nfrom email.mime.text import MIMEText\n\n\ndef send_email(from_email, pwd, target_email_list=[], attachment_file_list=[]):\n    \"\"\"\n    \u5355\u72ec\u53d1\u9001\u90ae\u4ef6\n    create on 2018-11-14\n    :param from_email: \u6e90\u90ae\u7bb1\n    :param pwd: \u6e90\u90ae\u7bb1\u5bc6\u7801\n    :param target_email_list:  \u76ee\u6807\u90ae\u4ef6\u5217\u8868\n    :param attachment_file_list:  \u9644\u4ef6\u8def\u5f84\u5217\u8868\n    :return: void\n    \"\"\"\n    if len(target_email_list) &lt;= 0:\n        print('ERR: \u76ee\u6807\u90ae\u4ef6\u5217\u8868\u4e3a\u7a7a -&gt; \u9000\u51fa')\n        return\n\n    for target_email in target_email_list:\n        print('sending to ' + target_email)\n        msg = MIMEMultipart()\n        msg['From'] = from_email\n        msg['To'] = target_email\n        msg['Subject'] = \"\u66f4\u65b0\"\n\n        body = '''\u5c0a\u656c\u7684\u5ba2\u6237\uff0c\n    \u4f60\u597d\uff0c\u8bf7\u67e5\u6536\u6587\u4ef6\u3002\n\u8c22\u8c22\uff01\n        '''\n        msg.attach(MIMEText(body, 'plain'))\n\n        for file_path in attachment_file_list:\n            filename = str(file_path).split('\\\\')[-1]\n            print(\"file_path \" + file_path + \" filename: \" + filename)\n            attachment = open(file_path, \"rb\")\n\n            part = MIMEBase('application', 'octet-stream')\n            part.set_payload(attachment.read())\n            encoders.encode_base64(part)\n            part.add_header('Content-Disposition', \"attachment; filename= %s\" % filename)\n\n            msg.attach(part)\n\n            server = smtplib.SMTP('smtp.exmail.qq.com', 25)\n            server.starttls()\n            server.login(from_email, pwd)\n            text = msg.as_string()\n            server.sendmail(from_email, target_email, text)\n            server.quit()\n\n\nif __name__ == '__main__':\n    print('start sending email')\n    send_email(from_email=\"your_email.com\",\n               pwd=\"\u5bc6\u7801\",\n               target_email_list=[\"target1@foxmail.com\", \"target2@qq.com\"],\n               attachment_file_list=[\n                   r\"E:\\your_path.rar\"])\n    print('end...')\n</code></pre>","tags":["Python"]},{"location":"python/record/python3-send-email/#_3","title":"\u53c2\u8003","text":"<ul> <li>https://blog.csdn.net/u011846143/article/details/78274911?locationNum=9&amp;fps=1</li> <li>http://naelshiab.com/tutorial-send-email-python/</li> </ul>","tags":["Python"]},{"location":"python/scrapy/scrapy-hw-blog-record/","title":"Python\u6293\u53d6\u535a\u5ba2\u8bb0\u5f55\uff0c\u83b7\u53d6\u6807\u9898\u4e0eurl","text":"\u66f4\u65b0\u65e5\u671f 2021-10-13 <ul> <li>2021-10-13 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u5728\u535a\u5ba2\u7f51\u7ad9\u53d1\u5e03\u4e86\u4e00\u4e9b\u535a\u5ba2\u3002\u603b\u5171\u6709\u56db\u5341\u591a\u7bc7\u3002\u73b0\u5728\u67e5\u770b\u8fd9\u4e9b\u535a\u5ba2\u9700\u8981\u7ffb\u9875\uff0c\u4e0d\u662f\u5f88\u65b9\u4fbf\u3002 \u60f3\u8981\u5f04\u51fa\u4e00\u4e2a\u5217\u8868\uff0c\u628a\u6807\u9898\u548c\u94fe\u63a5\u5c55\u793a\u51fa\u6765\u3002\u5982\u679c\u624b\u52a8\u53bb\u590d\u5236\u7c98\u8d34\uff0c\u8017\u65f6\u8017\u529b\uff0c\u4e5f\u4e0d\u591f\u81ea\u52a8\u5316\u3002 \u6709\u6ca1\u6709\u4ec0\u4e48\u81ea\u52a8\u5316\u7684\u65b9\u6cd5\u5462\uff1f\u60f3\u5230\u4ee5\u524d\u7528python\u505a\u8fc7\u6293\u53d6\u7684\u529f\u80fd\u3002</p> <p>\u5f00\u53d1\u73af\u5883\uff1a</p> <ul> <li>Python3.7</li> <li>PyCharm 2018.3.7 (Community Edition)</li> <li>macOS 11.4</li> </ul>","tags":["Python"]},{"location":"python/scrapy/scrapy-hw-blog-record/#scrapy","title":"\u5b89\u88c5scrapy","text":"<p>\u6211\u4eec\u4e3b\u8981\u4f7f\u7528\u7684\u6846\u67b6\u662fscrapy\uff0c\u5b98\u7f51 https://scrapy.org/ </p> <p>\u5982\u679c\u9700\u8981\u6362\u7528\u6e05\u534e\u7684pip\u6e90\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4 <pre><code>pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pip -U\npip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple\n</code></pre></p> <p>\u6839\u636e\u5b98\u7f51\u6587\u6863\u8fdb\u884c\u5b89\u88c5 <pre><code>pip3 install Scrapy\n</code></pre></p>","tags":["Python"]},{"location":"python/scrapy/scrapy-hw-blog-record/#_1","title":"\u5206\u6790\u76ee\u6807\u7f51\u9875","text":"<p>\u76ee\u6807\u7f51\u9875\u7684\u90e8\u5206html\u5982\u4e0b <pre><code>&lt;div class=\"blog-menu blog-menu-noImg\"&gt;\n    &lt;div class=\"blog-menu-header blog_no_attachment\"&gt;\n        &lt;a id=\"portal_usercenter_2_usernew_blog_title_cus_i_0\" href=\"/blogs/301790\" class=\"common-blog-title\" title=\"Kotlin\u534f\u7a0b\u53d6\u6d88\u4e0e\u8d85\u65f6\" target=\"_blank\" style=\"margin-left: 0px; color: rgb(51, 51, 51);\"&gt;&lt;span class=\"blog-title-wrap\" style=\"overflow-wrap: break-word;\"&gt;\n            Kotlin\u534f\u7a0b\u53d6\u6d88\u4e0e\u8d85\u65f6\n        &lt;/span&gt;&lt;/a&gt;&lt;/div&gt;\n</code></pre> \u9700\u8981\u63d0\u53d6\u7684\u662f\u6807\u9898\uff08title\uff09\u548c\u7f51\u5740\uff08url\uff09\u3002</p>","tags":["Python"]},{"location":"python/scrapy/scrapy-hw-blog-record/#shell","title":"shell\u5de5\u5177","text":"<p>\u4f7f\u7528<code>scrapy shell</code>\u5de5\u5177\u6765\u5206\u6790\u4e00\u4e0b\u76ee\u6807\u7f51\u9875 <pre><code>scrapy shell 'https://bbs.huaweicloud.com/community/usersnew/id_1606985929124732/page_1'\n</code></pre> windows\u4e0b\u7684url\u9700\u8981\u7528\u53cc\u5f15\u53f7</p> <p>\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u7684\u8fd0\u884c\u7ed3\u679c <pre><code>2021-10-13 09:46:47 [asyncio] DEBUG: Using selector: KqueueSelector\n[s] Available Scrapy objects:\n[s]   scrapy     scrapy module (contains scrapy.Request, scrapy.Selector, etc)\n[s]   crawler    &lt;scrapy.crawler.Crawler object at 0x7fd889766990&gt;\n[s]   item       {}\n[s]   request    &lt;GET https://bbs.huaweicloud.com/community/usersnew/id_1606985929124732/page_1&gt;\n[s]   response   &lt;200 https://bbs.huaweicloud.com/community/usersnew/id_1606985929124732/page_1&gt;\n[s]   settings   &lt;scrapy.settings.Settings object at 0x7fd88987bb50&gt;\n[s]   spider     &lt;DefaultSpider 'default' at 0x7fd889c7b710&gt;\n[s] Useful shortcuts:\n[s]   fetch(url[, redirect=True]) Fetch URL and update local objects (by default, redirects are followed)\n[s]   fetch(req)                  Fetch a scrapy.Request and update local objects \n[s]   shelp()           Shell help (print this help)\n[s]   view(response)    View response in a browser\n2021-10-13 09:46:48 [asyncio] DEBUG: Using selector: KqueueSelector\n</code></pre></p> <p>\u5c1d\u8bd5\u7528scrapy\u7684<code>css()</code>\u65b9\u6cd5\u6765\u63d0\u53d6\u5143\u7d20\uff0c\u64cd\u4f5c\u5b83\u7684<code>response</code>\u53d8\u91cf</p> <p>\u4f8b\u5982\u63d0\u53d6<code>div.blog-menu</code> <pre><code>In [2]: response.css('div.blog-menu')\nOut[2]: \n[&lt;Selector xpath=\"descendant-or-self::div[@class and contains(concat(' ', normalize-space(@class), ' '), ' blog-menu ')]\" data='&lt;div class=\"blog-menu blog-menu-noImg\"&gt;&lt;'&gt;,\n...\n</code></pre> \u53ef\u4ee5\u5f97\u5230\u9875\u9762\u4e0a\u6240\u6709\u6ee1\u8db3\u8981\u6c42\u7684\u5143\u7d20\u3002\u62ff\u5230\u7684\u5143\u7d20\u662fSelector\uff0c\u53ef\u4ee5\u518d\u8fdb\u884c\u4e0b\u4e00\u6b65\u7684\u64cd\u4f5c\u3002</p> <p>\u7528for\u5faa\u73af\u8bfb\u53d6\u63d0\u53d6\u5230\u7684\u5143\u7d20\uff0c\u5728\u6b64\u57fa\u7840\u4e0a\uff0c\u53bb\u6293\u53d6\u4e2d\u6587\u6807\u9898 <pre><code>In [6]: for item in response.css('div.blog-menu'):\n   ...:     print(item.css('a.common-blog-title::attr(title)').extract()[0])\n   ...: \nKotlin\u534f\u7a0b\u53d6\u6d88\u4e0e\u8d85\u65f6 - AnRFDev\nAndroid Kotlin\u534f\u7a0b\u5165\u95e8 - AnRFDev\nKotlin\u534f\u7a0b\u57fa\u7840 - AnRFDev\nKotlin\u534f\u7a0b\u5165\u95e8 - AnRFDev\nAndroid View post \u65b9\u6cd5 - AnRFDev\nAndroid Activity \u4f20\u9012Parcelable\u5bf9\u8c61 - AnRFDev\nAndroid Handler\uff0cLooper\u4e0eMessageQueue\u4f7f\u7528\u4e0e\u5206\u6790 - AnRFDev\nAndroid\u7ebf\u7a0b\u6c60\u4f7f\u7528\u4ecb\u7ecd - AnRFDev\nJava\u7ebf\u7a0b\u4ecb\u7ecd - AnRFDev\n\u4f7f\u7528ECharts\u7ed8\u5236\u7f51\u5740\u5f84\u5411\u6811\u72b6\u56fe - AnRFDev\n</code></pre></p> <p><code>a.common-blog-title::attr(title)</code>\u8868\u793a\u7684\u662f\u6211\u4eec\u8981\u67e5\u627e<code>&lt;a&gt;</code>\u91cc\u9762\u7684\u5185\u5bb9\uff0c\u6307\u5b9aclass\u4e3a<code>common-blog-title</code>\uff0c\u5e76\u4e14\u67e5\u627e<code>title</code>\u5c5e\u6027\u3002 <code>css().extract()</code>\u5c06\u7ed3\u679c\u5217\u8868\u63d0\u53d6\u51fa\u6765\u3002\u6700\u540e\u5f97\u5230\u6211\u4eec\u5173\u5fc3\u7684\u4fe1\u606f\u3002</p> <p>\u83b7\u53d6<code>url</code>\u540c\u7406\uff0c\u628a\u63d0\u53d6\u90e8\u5206\u4fee\u6539\u4e3a<code>::attr(href)</code></p>","tags":["Python"]},{"location":"python/scrapy/scrapy-hw-blog-record/#_2","title":"\u4ee3\u7801","text":"<p>\u524d\u9762\u7528shell\u5de5\u5177\u8fdb\u884c\u5206\u6790\uff0c\u6211\u4eec\u4e86\u89e3\u63d0\u53d6\u76ee\u6807\u4fe1\u606f\u7684\u65b9\u6cd5\u3002\u63a5\u4e0b\u6765\u5199Python\u4ee3\u7801\u3002</p> <p>\u5728\u5408\u9002\u7684\u5730\u65b9\u65b0\u5efa\u4e00\u4e2ascrapy\u5de5\u7a0b <pre><code>scrapy startproject blog\n</code></pre> \u53ef\u4ee5\u5f97\u5230\u4e00\u7cfb\u5217\u6587\u4ef6 <pre><code>blog\n    spiders\n        .gitignore\n        __init__.py\n    __init__.py\n    items.py\n    middlewares.py\n    pipelines.py\n    settings.py\n</code></pre></p> <p>\u5728<code>spiders</code>\u76ee\u5f55\u91cc\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6<code>Hw.py</code>\uff0c\u5b83\u5c31\u662f\u6211\u4eec\u7684\u201c\u8718\u86db\u201d\u3002\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b\u3002 <pre><code>import json\n\nimport scrapy\n\n\ndef cmp(item):\n    return item['page']\n\n\nclass HwBlog(scrapy.Spider):\n    \"\"\"\n    \u5728\u6700\u5916\u5c42\u7684blog\u76ee\u5f55\u8fdb\u884c\u64cd\u4f5c\n    scrapy crawl hw\n    \"\"\"\n    name = \"hw\"  # scrapy crawl hw\n    res_list = []\n    req_count = 0\n    total_url = 5\n\n    def start_requests(self):\n        self.res_list = []\n        urls = []\n        base_url = 'https://bbs.huaweicloud.com/community/usersnew/id_1606985929124732/page_'\n        for i in range(1, self.total_url + 1):\n            urls.append(base_url + str(i))\n\n        for url in urls:\n            yield scrapy.Request(url=url, callback=self.parse)\n\n    def parse(self, response):\n        self.req_count = self.req_count + 1\n        page = response.url.split(\"_\")[-1]\n\n        for item in response.css('div.blog-menu'):\n            title_se = item.css(\"a.common-blog-title\")\n            blog_url = 'https://bbs.huaweicloud.com' + (title_se.css(\"::attr(href)\").extract()[0])\n            blog_title = title_se.css(\"::attr(title)\").extract()[0]\n            self.res_list.append({\"title\": blog_title, \"url\": blog_url, \"page\": page})\n\n        json_res = json.dumps(self.res_list, ensure_ascii=False)\n        print(json_res)\n\n        res_file_path = 'raw/hw.json'\n        with open(res_file_path, 'w+') as f:\n            f.write(json_res)\n\n        if self.req_count &lt; self.total_url:\n            return\n        res_md = 'raw/hw.md'\n        self.res_list.sort(key=cmp)  # \u7528\u9875\u7801\u6765\u6392\u5e8f\n        with open(res_md, 'w+') as f:\n            f.writelines('## \u534e\u4e3a\u4e91\u793e\u533a')\n            f.write('\\n\u535a\u5ba2\u6570\u91cf:' + str(len(self.res_list)) + '\\n')\n            for d in self.res_list:\n                f.write('\\n')\n                f.write('- [' + d['title'] + '](' + d['url'] + ')')\n</code></pre></p> <p>\u8981\u542f\u52a8\u7684\u8bdd\uff0c\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4 <pre><code>scrapy crawl hw\n</code></pre></p> <p>\u63a5\u4e0b\u6765\u7b80\u5355\u770b\u4e00\u4e0b\u4ee3\u7801</p>","tags":["Python"]},{"location":"python/scrapy/scrapy-hw-blog-record/#_3","title":"\u53d8\u91cf","text":"<p><code>name</code>\u662f\u8718\u86db\u7684\u540d\u5b57\u3002\u6211\u4eec\u542f\u52a8\u7684\u65f6\u5019\u4f1a\u7528\u5230\u5b83\u3002\u8fd9\u4e2a\u540d\u5b57\u7531\u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\u3002</p> <p><code>res_list</code>\u662f\u6682\u5b58\u7ed3\u679c\u7684\u5217\u8868\u3002\u628a\u83b7\u53d6\u5230\u7684\u7ed3\u679c\u6682\u65f6\u5b58\u653e\u5728\u91cc\u9762\u3002</p> <p><code>total_url</code>\u8868\u793a\u4e00\u5171\u8981\u722c\u51e0\u4e2a\u9875\u9762</p> <p><code>req_count</code>\u8868\u793a\u8bf7\u6c42\u6b21\u6570</p>","tags":["Python"]},{"location":"python/scrapy/scrapy-hw-blog-record/#start_requestsself","title":"<code>start_requests(self)</code>","text":"<p>\u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u8fdb\u884c\u4e00\u4e9b\u914d\u7f6e\u5de5\u4f5c\u3002\u6bd4\u5982\u914d\u7f6e\u76ee\u6807url\u3002 \u6211\u4eec\u662f\u9884\u5148\u77e5\u9053\u67095\u4e2a\u9875\u9762\uff0c\u6240\u4ee5\u914d\u7f6e\u4e865\u4e2aurl\u3002</p> <p>\u7528<code>scrapy.Request(url=url, callback=self.parse)</code>\u6784\u5efa\u8bf7\u6c42</p> <p><code>parse</code>\u662f\u56de\u8c03\u51fd\u6570\uff0c\u8bf7\u6c42\u6210\u529f\u540e\u8d70\u8fd9\u4e2a\u65b9\u6cd5\u3002</p>","tags":["Python"]},{"location":"python/scrapy/scrapy-hw-blog-record/#parseself-response","title":"<code>parse(self, response)</code>","text":"<p>\u8bf7\u6c42\u6210\u529f\u540e\uff0c\u7ed3\u679c\u4fdd\u5b58\u5728<code>response</code>\u4e2d\u3002\u524d\u9762\u7528shell\u8fdb\u884c\u7684\u64cd\u4f5c\uff0c\u53ef\u4ee5\u76f4\u63a5\u5199\u6210python\u4ee3\u7801\u3002</p> <p>\u5f53\u8bf7\u6c42\u6b21\u6570\u8fbe\u5230\u76ee\u6807\u540e\uff0c\u5f00\u59cb\u5199\u6587\u4ef6\u3002</p>","tags":["Python"]},{"location":"python/scrapy/scrapy-hw-blog-record/#_4","title":"\u5c0f\u7ed3","text":"<p>\u8fd9\u662fPython scrapy\u7684\u4e00\u6b21\u7b80\u5355\u5e94\u7528\u3002</p> <p>\u5b89\u88c5scrapy\uff0c\u5206\u6790\u76ee\u6807\u7f51\u9875\u3002\u628a\u83b7\u53d6\u5230\u7684\u6570\u636e\u6574\u7406\u540e\u5199\u6210markdown\u6587\u4ef6\u3002</p> <p>\u8bb2\u89e3\u89c6\u9891</p> <p>\u5f00\u53d1\u95f2\u8c08 - bilibili</p>","tags":["Python"]},{"location":"redis/redis-docker-master-slave-sentinel-123/","title":"Redis docker \u4e3b\u4ece\u6a21\u5f0f\u4e0e\u54e8\u5175sentinel","text":"\u66f4\u65b0\u65e5\u671f 2022-06-29 <ul> <li>2022-06-29 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4e3a\u5b9e\u73b0redis\u7684\u9ad8\u53ef\u7528\uff0c\u6211\u4eec\u91c7\u7528\u4e3b\u4ece\u6a21\u5f0f\u52a0\u54e8\u5175\u7684\u65b9\u6cd5\u3002</p> <p>\u4e00\u4e3b\u4e8c\u4ece\u4e09\u54e8\u5175\uff0c\u5171\u542f\u52a86\u4e2aredis\u5bb9\u5668\u3002\u672c\u6587\u793a\u4f8b\u5728\u540c\u4e00\u4e2a\u670d\u52a1\u5668\u4e0a\u8fdb\u884c\u64cd\u4f5c\u3002</p>"},{"location":"redis/redis-docker-master-slave-sentinel-123/#_1","title":"\u5f00\u53d1\u73af\u5883","text":"<ul> <li>centos \u5047\u8bbeip\u5730\u5740\u4e3a x.x.x.1</li> <li>docker 1.13.1</li> <li>redis 7.0.2</li> </ul> <p>\u7cfb\u7edf\u4e3acentos <pre><code>cat /proc/version\nLinux version 3.10.0-693.el7.x86_64 (builder@kbuilder.dev.centos.org) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC) ) #1 SMP Tue Aug 22 21:09:27 UTC 2017\n</code></pre></p> <p>\u540e\u9762\u7684\u64cd\u4f5c\u5c06\u5728root\u6743\u9650\u4e0b\u8fdb\u884c</p>"},{"location":"redis/redis-docker-master-slave-sentinel-123/#docker","title":"docker\u7248\u672c","text":"<pre><code>docker -v \nDocker version 1.13.1, build 7d71120/1.13.1\n</code></pre>"},{"location":"redis/redis-docker-master-slave-sentinel-123/#redis","title":"redis\u7248\u672c","text":"<p>\u6211\u4eec\u4f7f\u75287.0.2\u7248\u672c\u3002\u7528\u5230\u7684\u670d\u52a1\u5668\u4e0a\u7684redis\u6700\u597d\u7edf\u4e00\u7248\u672c\u3002 <pre><code>docker pull redis:7.0.2\n</code></pre></p> <p>\u4e0d\u540c\u7248\u672c\u7684redis\u7684\u914d\u7f6e\u4e0d\u4e00\u5b9a\u76f8\u540c\u3002\u5982\u679c\u542f\u52a8\u5bb9\u5668\u51fa\u73b0\u4e00\u76f4\u5728<code>restarting</code>\u7684\u60c5\u51b5\uff0c\u53bb\u770b\u4e00\u4e0blog</p> <p>\u67e5\u770b\u5df2\u7ecf\u542f\u52a8\u7684redis\u5bb9\u5668\u4e2d\u7684redis\u7248\u672c <pre><code>docker exec -it [\u5bb9\u5668id] redis-server -v\n</code></pre></p> \u8f93\u51fa<pre><code>Redis server v=7.0.2 sha=00000000:0 malloc=jemalloc-5.2.1 bits=64 build=40f017f9608e455e\n</code></pre> <p>\u6765\u5b98\u7f51\u627e\u5bf9\u5e94\u7684\u5b89\u88c5\u5305 http://download.redis.io/releases/</p> <p>\u89e3\u538b\u540e\u53ef\u4ee5\u5f97\u5230redis.conf\u548csentinel.conf\u6587\u4ef6</p>"},{"location":"redis/redis-docker-master-slave-sentinel-123/#_2","title":"\u4e3b\u4ece\u7ed3\u6784","text":"<p>\u4e00\u4e2a\u4e3bredis\uff0c2\u4e2a\u4eceredis\u3002\u5b83\u4eec\u4f7f\u7528\u4e0d\u540c\u76843\u4e2a\u7aef\u53e3\uff0c\u6ce8\u610f\u68c0\u67e5\u9632\u706b\u5899\u7684\u8bbe\u7f6e\u3002</p> <p>\u672c\u6587\u5047\u8bbe\u670d\u52a1\u5668\u7684ip\u4e3a<code>x.x.x.1</code>\u3002</p>"},{"location":"redis/redis-docker-master-slave-sentinel-123/#redis_1","title":"\u542f\u52a8\u4e3bredis","text":"<p>\u4e3bredis\uff0c\u5373master\u3002</p> <p>\u542f\u52a8\u4e3bredis\u5bb9\u5668 <pre><code>docker run --restart=always -p 6400:6379 --name redis-CNT-MASTER \\\n-d redis:7.0.2 redis-server --requirepass 778899 --masterauth 778899\n</code></pre></p> <ul> <li><code>6400:6379</code> \u6307\u5b9a\u670d\u52a1\u5668\u76846400\u5bf9\u5e94redis\u5bb9\u5668\u91cc\u76846379\u7aef\u53e3</li> <li><code>--requirepass 778899</code> \u8bbe\u5b9a\u5bc6\u7801</li> <li><code>--masterauth 778899</code> \u4eceredis\u8fde\u4e0a\u6765\u9700\u8981\u7684\u5bc6\u7801</li> </ul> <p>\u8fdb\u5165\u5bb9\u5668\u67e5\u770b\u72b6\u6001 <pre><code>docker exec -it redis-CNT-MASTER redis-cli\n127.0.0.1:6379&gt; auth 778899\nOK\n127.0.0.1:6379&gt; info replication\n</code></pre></p>"},{"location":"redis/redis-docker-master-slave-sentinel-123/#1redis","title":"\u542f\u52a8<code>1\u53f7\u4eceredis</code>","text":"<p>\u4eceredis\u4f7f\u7528\u914d\u7f6e\u7684\u65b9\u5f0f</p> <p>\u6587\u4ef6\u7ed3\u6784 <code>/home/dapp/projects/rustfisher/redis-slave1</code> <pre><code>\u251c\u2500\u2500 data\n\u2514\u2500\u2500 redis.conf\n</code></pre></p> <p>1\u53f7\u4eceredis\u7684redis.conf\u9664\u6389\u6ce8\u91ca\u540e\u7684\u90e8\u5206</p> redis.conf redis.conf<pre><code>#bind 0.0.0.0 # \u4e0d\u7528bind\n\nslaveof x.x.x.1 6400 # \u8bb0\u5f97\u6539\u6210\u4f60\u7684\u670d\u52a1\u5668ip\nreplica-announce-ip x.x.x.1 # (1)\nreplica-announce-port 6401 # (2)\nprotected-mode no\nport 6379\nmasterauth 778899\nrequirepass 778899\n\ntcp-backlog 511\ntimeout 0\ntcp-keepalive 300\ndaemonize no\npidfile /var/run/redis_6379.pid\nloglevel notice\nlogfile \"\"\ndatabases 16\nalways-show-logo no\nset-proc-title yes\nproc-title-template \"{title} {listen-addr} {server-mode}\"\nstop-writes-on-bgsave-error yes\nrdbcompression yes\nrdbchecksum yes\ndbfilename dump.rdb\nrdb-del-sync-files no\ndir ./\nreplica-serve-stale-data yes\nreplica-read-only yes\nrepl-diskless-sync yes\nrepl-diskless-sync-delay 5\nrepl-diskless-sync-max-replicas 0\nrepl-diskless-load disabled\nrepl-disable-tcp-nodelay no\nreplica-priority 100\nacllog-max-len 128\nlazyfree-lazy-eviction no\nlazyfree-lazy-expire no\nlazyfree-lazy-server-del no\nreplica-lazy-flush no\nlazyfree-lazy-user-del no\nlazyfree-lazy-user-flush no\noom-score-adj no\noom-score-adj-values 0 200 800\ndisable-thp yes\nappendonly yes\nappendfilename \"appendonly.aof\"\nappenddirname \"appendonlydir\"\nappendfsync everysec\nno-appendfsync-on-rewrite no\nauto-aof-rewrite-percentage 100\nauto-aof-rewrite-min-size 64mb\naof-load-truncated yes\naof-use-rdb-preamble yes\naof-timestamp-enabled no\nslowlog-log-slower-than 10000\nslowlog-max-len 128\nlatency-monitor-threshold 0\nnotify-keyspace-events \"\"\nhash-max-listpack-entries 512\nhash-max-listpack-value 64\nlist-max-listpack-size -2\nlist-compress-depth 0\nset-max-intset-entries 512\nzset-max-listpack-entries 128\nzset-max-listpack-value 64\nhll-sparse-max-bytes 3000\nstream-node-max-bytes 4096\nstream-node-max-entries 100\nactiverehashing yes\nclient-output-buffer-limit normal 0 0 0\nclient-output-buffer-limit replica 256mb 64mb 60\nclient-output-buffer-limit pubsub 32mb 8mb 60\nhz 10\ndynamic-hz yes\naof-rewrite-incremental-fsync yes\nrdb-save-incremental-fsync yes\njemalloc-bg-thread yes\n</code></pre> <ol> <li>\u8bb0\u5f97\u6539\u6210\u4f60\u7684\u670d\u52a1\u5668ip</li> <li>\u4eceredis\u5bf9\u5916\u7684\u7aef\u53e3\uff0c\u540e\u9762\u542f\u52a8\u7684\u65f6\u5019\u4e5f\u8981\u914d\u7f6e\u7684</li> </ol> <p>\u542f\u52a81\u53f7\u4eceredis <pre><code>docker run --restart=always -p 6401:6379 --name redis-CNT-S1 \\\n-v /home/dapp/projects/rustfisher/redis-slave1/redis.conf:/etc/redis/redis.conf \\\n-v /home/dapp/projects/rustfisher/redis-slave1/data:/data \\\n-d redis:7.0.2 redis-server /etc/redis/redis.conf\n</code></pre></p> <ul> <li><code>6401:6379</code> 1\u53f7\u4eceredis\u5bf9\u5916\u7aef\u53e3\u662f6401</li> <li><code>redis-CNT-S1</code> \u5bb9\u5668\u540d\u5b57</li> </ul>"},{"location":"redis/redis-docker-master-slave-sentinel-123/#2redis","title":"\u542f\u52a8<code>2\u53f7\u4eceredis</code>","text":"<p>\u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u590d\u52361\u53f7\u7684\u3002\u7136\u540e\u8bb0\u5f97\u4fee\u6539\u5b83\u7684\u5ba3\u79f0ip\u548c\u7aef\u53e3 <pre><code>replica-announce-ip x.x.x.1\nreplica-announce-port 6402 # 2\u53f7\u7528\u7684\u7aef\u53e3\n</code></pre></p> <p>\u542f\u52a82\u53f7\u4eceredis\uff0c\u9700\u8981\u6ce8\u610f\u5bf9\u5e94\u7684\u8def\u5f84 <pre><code>docker run --restart=always -p 6402:6379 --name redis-CNT-S2 \\\n-v /home/dapp/projects/rustfisher/redis-slave2/redis.conf:/etc/redis/redis.conf \\\n-v /home/dapp/projects/rustfisher/redis-slave2/data:/data \\\n-d redis:latest redis-server /etc/redis/redis.conf\n</code></pre></p>"},{"location":"redis/redis-docker-master-slave-sentinel-123/#info-replication","title":"\u67e5\u770b\u4e3b\u4ece\u4fe1\u606f<code>info replication</code>","text":"<p>\u8fdb\u5165\u4e3bredis\u5bb9\u5668\uff0c\u8f93\u5165<code>redis-cli</code>\uff0c<code>auth</code>\u540e\uff0c\u68c0\u67e5\u60c5\u51b5<code>info replication</code></p> <p>\u4f8b\u5982\u8fdb\u5165\u4e3bredis\u5bb9\u5668\u67e5\u770b\u3002\u6b64\u65f6<code>connected_slaves:2</code>\u3002slave\u7684ip\u548cport\u5e94\u8be5\u548c\u5b83\u4eec\u5ba3\u79f0<code>replica-announce</code>\u7684\u4e00\u81f4\u3002</p> <p>\u5728\u4e3bredis\u4e2d<code>set a 123</code>\uff0c\u57281\u53f7\u548c2\u53f7\u4eceredis\u91cc<code>get a</code>\u53ef\u4ee5\u770b\u5230\u6548\u679c\u3002</p>"},{"location":"redis/redis-docker-master-slave-sentinel-123/#sentinel","title":"\u54e8\u5175 sentinel","text":"<p>\u6211\u4eec\u4f1a\u542f\u52a83\u4e2a\u65b0\u7684redis\u5bb9\u5668\uff0c\u53733\u4e2a\u54e8\u5175\u3002\u8fd93\u4e2a\u54e8\u5175\u90fd\u76d1\u542c\u4e3bredis\u3002</p>"},{"location":"redis/redis-docker-master-slave-sentinel-123/#1","title":"\u54e8\u51751\u53f7","text":"<p>\u65b0\u5efa\u4e00\u4e2a\u54e8\u51751\u53f7\u7528\u7684\u76ee\u5f55 <code>/home/dapp/projects/rustfisher/sentinel1</code> <pre><code>\u251c\u2500\u2500 conf\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 sentinel.conf\n\u2514\u2500\u2500 data\n</code></pre></p> <p>\u5148\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6 sentinel.conf 1\u53f7\u54e8\u5175\u7684 sentinel.conf<pre><code>port 6411\ndir \"/tmp\"\nsentinel monitor master001 x.x.x.1 6400 2 # (1)\nsentinel auth-pass master001 778899 # (2)\nsentinel down-after-milliseconds master001 30000\nsentinel parallel-syncs master001 1\nsentinel failover-timeout master001 180000\nsentinel deny-scripts-reconfig yes\n</code></pre></p> <ol> <li>\u8bb0\u5f97\u4fee\u6539\u6210\u4f60\u7684\u4e3bredis\u7684ip\u548c\u7aef\u53e3</li> <li> <p>\u5bc6\u7801\u662f\u524d\u9762\u5b9a\u7684</p> </li> <li> <p><code>port 6411</code> \u6307\u5b9a\u7684\u662f\u54e8\u5175\u5bb9\u5668\u91cc\u81ea\u5df1\u7684\u7aef\u53e3</p> </li> <li><code>sentinel monitor</code> \u6307\u5b9a\u4e86\u8981\u76d1\u542c\u7684\u4e3bmaster\u7684ip\u548c\u7aef\u53e3\uff0c\u6700\u540e\u90a3\u4e2a<code>2</code>\u8868\u793a\u9700\u89812\u4e2a\u54e8\u5175\u6295\u7968</li> <li><code>master001</code> \u662f\u6211\u4eec\u7ed9\u4e3bredis\u8d77\u7684\u540d\u5b57\uff0c\u540e\u9762\u90fd\u7528\u8fd9\u4e2a</li> </ol> <p>\u542f\u52a81\u53f7\u54e8\u5175 <pre><code>docker run --restart=always -p 6411:6411 --name redis-sentinel-CNT-1 --privileged=true \\\n-v /home/dapp/projects/rustfisher/sentinel1/conf:/usr/local/etc/redis/conf/ \\\n-d redis:7.0.2 redis-sentinel /usr/local/etc/redis/conf/sentinel.conf\n</code></pre></p> <p>\u6ce8\u610f\uff1a\u8fd9\u91cc\u9700\u8981\u6620\u5c04\u7684\u662f\u76ee\u5f55\u3002<code>-v</code>\u76ee\u5f55\u5bf9\u76ee\u5f55\u3002</p> <p>\u8fdb\u5165\u5bb9\u5668\u540e\uff0c\u53ef\u4ee5\u67e5\u770b\u76f8\u5173\u4fe1\u606f\u3002<code>redis-cli</code>\u9700\u8981\u6307\u5b9a\u7aef\u53e3<code>-p 6411</code> <pre><code>root@aa8d208546d1:/data# redis-cli -p 6411\n127.0.0.1:6411&gt; sentinel master master001\n</code></pre></p> <p>\u67e5\u770b\u670d\u52a1\u5668\u4e0a1\u53f7\u54e8\u5175\u7684 sentinel.conf \uff0c\u53d1\u73b0\u591a\u4e86\u4e00\u4e9b\u5185\u5bb9\uff0c\u662fredis\u54e8\u5175\u5199\u8fdb\u6765\u7684 \u81ea\u52a8\u65b0\u589e\u7684\u5185\u5bb9\u793a\u4f8b<pre><code>## Generated by CONFIG REWRITE\nlatency-tracking-info-percentiles 50 99 99.9\nuser default on nopass ~* &amp;* +@all\nsentinel myid b43e361ff80b8f9106cb1d4bb59421aa909ac370\nsentinel config-epoch master001 0\nsentinel leader-epoch master001 0\nsentinel current-epoch 0\n\nsentinel known-replica master001 x.x.x.1 6401\n\nsentinel known-replica master001 x.x.x.1 6402\n</code></pre></p>"},{"location":"redis/redis-docker-master-slave-sentinel-123/#2","title":"\u542f\u52a8<code>2\u53f7\u54e8\u5175</code>","text":"<p>\u914d\u7f6e2\u53f7\u7684\u8def\u5f84<code>/home/dapp/projects/rustfisher/sentinel2</code>\u3002</p> <p>sentinel.conf\u914d\u7f6e\u5185\u5bb9\u548c\u524d\u9762\u4e00\u6837\uff0c\u542f\u52a8\u65f6\u5019\u7aef\u53e3\u7528<code>-p 6412:6411</code> <pre><code>docker run --restart=always -p 6412:6411 --name redis-sentinel-CNT-2 --privileged=true \\\n-v /home/dapp/projects/rustfisher/sentinel2/conf:/usr/local/etc/redis/conf/ \\\n-d redis:7.0.2 redis-sentinel /usr/local/etc/redis/conf/sentinel.conf\n</code></pre></p>"},{"location":"redis/redis-docker-master-slave-sentinel-123/#3","title":"\u542f\u52a8<code>3\u53f7\u54e8\u5175</code>","text":"<p>\u540c\u7406\uff0c\u8def\u5f84\u75283\u53f7\u81ea\u5df1\u7684 <code>/home/dapp/projects/rustfisher/sentinel3/conf</code></p> <p>\u7aef\u53e3<code>-p 6413:6411</code> <pre><code>docker run --restart=always -p 6413:6411 --name redis-sentinel-CNT-3 --privileged=true \\\n-v /home/dapp/projects/rustfisher/sentinel3/conf:/usr/local/etc/redis/conf/ \\\n-d redis:7.0.2 redis-sentinel /usr/local/etc/redis/conf/sentinel.conf\n</code></pre></p>"},{"location":"redis/redis-docker-master-slave-sentinel-123/#_3","title":"\u67e5\u770b\u54e8\u5175\u60c5\u51b5","text":"<p>\u8fdb\u5165\u54e8\u5175redis\u5bb9\u5668\u67e5\u770b\u60c5\u51b5 \u8fdb\u5165\u54e8\u5175\u7684\u5bb9\u5668\u540e<pre><code>root@5dc0468fb71f:/data# redis-cli -p 6411\n127.0.0.1:6411&gt; sentinel master master001\n</code></pre></p> <ul> <li><code>num-slaves</code> \u8868\u793a\u4eceredis\u7684\u6570\u91cf</li> <li><code>num-other-sentinels</code> \u8868\u793a\u9664\u81ea\u5df1\u5916\u7684\u54e8\u5175\u6570\u91cf</li> </ul>"},{"location":"redis/redis-docker-master-slave-sentinel-123/#_4","title":"\u54e8\u5175\u6d4b\u8bd5","text":"<p>\u505c\u6389\u4e3bredis\u5bb9\u5668 <pre><code>docker stop [id]\n</code></pre></p> <p>\u4f8b\u5982 <pre><code>docker stop redis-CNT-MASTER\n</code></pre></p> <p>\u8fc7\u4e00\u4f1a\u7b49\u9009\u51fa\u65b0\u7684\u4e3bredis\u3002\u7136\u540e\u518d\u542f\u52a8\u521a\u624d\u505c\u6389\u7684\u5bb9\u5668<code>redis-CNT-MASTER</code>\u3002\u67e5\u770b\u4fe1\u606f\uff0c\u53d1\u73b0\u5b83\u662f<code>role:slave</code> <pre><code>[root@rustfisher_test01 redis-slave1]# docker exec -it redis-CNT-MASTER redis-cli -a 778899 info replication\nWarning: Using a password with '-a' or '-u' option on the command line interface may not be safe.\n## Replication\nrole:slave\nmaster_host:x.x.x.1\nmaster_port:6402\nmaster_link_status:up\nmaster_last_io_seconds_ago:0\nmaster_sync_in_progress:0\nslave_read_repl_offset:886622\nslave_repl_offset:886622\nslave_priority:100\nslave_read_only:1\nreplica_announced:1\nconnected_slaves:0\nmaster_failover_state:no-failover\nmaster_replid:6e8a8cb6c167abeb743e668b654e2f470a537742\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:886622\nsecond_repl_offset:-1\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:409622\nrepl_backlog_histlen:477001\n</code></pre> \u4ece\u4e0a\u9762\u770b\u51fa\uff0c\u73b0\u5728\u7684\u4e3bredis\u53d8\u6210<code>x.x.x.1:6402</code>\u4e86\u3002</p>"},{"location":"redis/redis-docker-master-slave-sentinel-123/#_5","title":"\u54e8\u5175\u5e38\u89c1\u95ee\u9898","text":""},{"location":"redis/redis-docker-master-slave-sentinel-123/#_6","title":"\u914d\u7f6e\u6587\u4ef6\u6620\u5c04","text":"<p>\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6sentinel.conf\u6620\u5c04\u5230\u5bb9\u5668\u5185\u65f6\uff0c\u76f4\u63a5\u4e86\u4f7f\u7528\u6587\u4ef6\u6620\u5c04\u3002 \u8fd9\u4e48\u505a\u6709\u53ef\u80fd\u5bfc\u81f4\u54e8\u5175\u6ca1\u6709\u5199\u5165\u914d\u7f6e\u6587\u4ef6\u7684\u6743\u9650, \u67e5\u770blog\u4f1a\u770b\u5230\uff1a</p> <p><code>WARNING: Sentinel was not able to save the new configuration on disk!!!: Device or resource busy.</code></p> <p>\u89e3\u51b3\u65b9\u6cd5\u662f\u4f7f\u7528\u76ee\u5f55\u6620\u5c04\u3002\u50cf\u4e0a\u9762\u90a3\u6837\uff1a <code>-v /home/dapp/projects/rustfisher/sentinel2/conf:/usr/local/etc/redis/conf/</code></p>"},{"location":"redis/redis-docker-master-slave-sentinel-123/#myid","title":"\u54e8\u5175myid","text":"<p>\u4e3b\u4ece\u4e0e\u54e8\u5175redis\u90fd\u542f\u52a8\u540e\uff0c\u770b\u8d77\u6765OK\u4e86\u3002\u4f46stop\u6389\u4e3bredis\u540e\uff0c\u54e8\u5175\u5e76\u6ca1\u6709\u9009\u51fa\u65b0\u7684\u4e3bredis\u3002</p> <p>\u6709\u4e00\u79cd\u53ef\u80fd\u662f\u54e8\u5175\u6539\u5199\u7684sentinel.conf\u91cc\u4f7f\u7528\u4e86\u76f8\u540c\u7684<code>myid</code>\u3002</p> \u67e5\u770bmyid\u6b63\u5e38\u60c5\u51b5<pre><code>grep -nr myid\nsentinel1/conf/sentinel.conf:11:sentinel myid b43e361ff80b8f9106cb1d4bb59421aa909ac370\nsentinel2/conf/sentinel.conf:11:sentinel myid e19342addbcdd8d034c1e91ed74ff94a7aec2e2a\nsentinel3/conf/sentinel.conf:11:sentinel myid d0393d72f69556f2047cf8c84cfa20f4df6ed4ff\n</code></pre> <p>\u89e3\u51b3\u65b9\u6cd5\u662fstop\u6389\u90a3\u4e2a\u54e8\u5175\uff0c\u5220\u6389<code>myid</code>\u90a3\u884c\uff0c\u7136\u540e\u91cd\u542f\u54e8\u5175\u3002\u5b83\u4f1a\u81ea\u52a8\u751f\u6210\u65b0\u7684<code>myid</code>\u3002</p>"},{"location":"redis/redis-docker-master-slave-sentinel-123/#_7","title":"\u53c2\u8003","text":"<ul> <li>Redis\u5b98\u7f51\u6587\u6863 redis.io</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog CSDN \u77e5\u4e4e \u534e\u4e3a\u4e91\u793e\u533a 51CTO</p>"},{"location":"ruankao/pm3/1-information-and-sys/","title":"\u7b2c\u4e00\u7ae0 \u4fe1\u606f\u5316\u548c\u4fe1\u606f\u7cfb\u7edf","text":"\u66f4\u65b0\u65e5\u671f: 2022-4-18 <ul> <li>2022-4-18 \u589e\u52a0\u5185\u5bb9</li> <li>2022-4-14 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u4fe1\u606f\u5c31\u662f\u80fd\u591f\u7528\u6765\u6d88\u9664\u4e0d\u786e\u5b9a\u6027\u7684\u4e1c\u897f\u3002</p>"},{"location":"ruankao/pm3/1-information-and-sys/#_2","title":"\u4fe1\u606f\u7684\u7279\u5f81","text":"<ul> <li>\uff081\uff09\u5ba2\u89c2\u6027\u3002\u4fe1\u606f\u662f\u5ba2\u89c2\u4e8b\u7269\u5728\u4eba\u8111\u4e2d\u7684\u53cd\u6620\uff0c\u800c\u53cd\u6620\u7684\u5bf9\u8c61\u5219\u6709\u4e3b\u89c2\u548c\u5ba2\u89c2\u7684\u533a\u522b\u3002</li> <li>\uff082\uff09\u666e\u904d\u6027\u3002\u7269\u8d28\u51b3\u5b9a\u7cbe\u795e\uff0c\u7269\u8d28\u7684\u666e\u904d\u6027\u51b3\u5b9a\u4e86\u4fe1\u606f\u7684\u666e\u904d\u5b58\u5728\u3002</li> <li>\uff083\uff09\u65e0\u9650\u6027\u3002\u5ba2\u89c2\u4e16\u754c\u662f\u65e0\u9650\u7684\uff0c\u53cd\u6620\u5ba2\u89c2\u4e16\u754c\u7684\u4fe1\u606f\u81ea\u7136\u4e5f\u662f\u65e0\u9650\u7684\u3002</li> <li>\uff084\uff09\u52a8\u6001\u6027</li> <li>\uff085\uff09\u76f8\u5bf9\u6027\u3002\u4e0d\u540c\u7684\u8ba4\u8bc6\u4e3b\u4f53\u4ece\u540c\u4e00\u4e8b\u7269\u4e2d\u83b7\u53d6\u7684\u4fe1\u606f\u53ca\u4fe1\u606f\u91cf\u53ef\u80fd\u662f\u4e0d\u540c\u7684\u3002</li> <li>\uff086\uff09\u4f9d\u9644\u6027\u3002</li> <li>\uff087\uff09\u53d8\u6362\u6027\u3002</li> <li>\uff088\uff09\u4f20\u9012\u6027\u3002\u4fe1\u606f\u5728\u65f6\u95f4\u4e0a\u7684\u4f20\u9012\u5c31\u662f\u5b58\u50a8\uff0c\u5728\u7a7a\u95f4\u4e0a\u7684\u4f20\u9012\u5c31\u662f\u8f6c\u79fb\u6216\u6269\u6563\u3002</li> <li>\uff089\uff09\u5c42\u6b21\u6027\u3002\u5ba2\u89c2\u4e16\u754c\u662f\u5206\u5c42\u6b21\u7684\uff0c\u53cd\u6620\u5b83\u7684\u4fe1\u606f\u4e5f\u662f\u5206\u5c42\u6b21\u7684\u3002</li> <li>\uff0810\uff09\u7cfb\u7edf\u6027\u3002\u4fe1\u606f\u53ef\u4ee5\u8868\u793a\u4e3a\u4e00\u79cd\u96c6\u5408\uff0c\u4e0d\u540c\u7c7b\u522b\u7684\u4fe1\u606f\u53ef\u4ee5\u5f62\u6210\u4e0d\u540c\u7684\u6574\u4f53\u3002\u56e0\u6b64\uff0c\u53ef\u4ee5\u5f62\u6210\u4e0e\u73b0\u5b9e\u4e16\u754c\u76f8\u5bf9\u5e94\u7684\u4fe1\u606f\u7cfb\u7edf\u3002</li> <li>\uff0811\uff09\u8f6c\u5316\u6027\u3002\u4fe1\u606f\u7684\u4ea7\u751f\u4e0d\u80fd\u6ca1\u6709\u7269\u8d28\uff0c\u4fe1\u606f\u7684\u4f20\u9012\u4e0d\u80fd\u6ca1\u6709\u80fd\u91cf\u3002</li> </ul>"},{"location":"ruankao/pm3/1-information-and-sys/#_3","title":"\u4fe1\u606f\u7684\u8d28\u91cf","text":"<ul> <li>\uff081\uff09\u7cbe\u786e\u6027\uff0c\u5bf9\u4e8b\u7269\u72b6\u6001\u63cf\u8ff0\u7684\u7cbe\u51c6\u7a0b\u5ea6\u3002</li> <li>\uff082\uff09\u5b8c\u6574\u6027\uff0c\u5bf9\u4e8b\u7269\u72b6\u6001\u63cf\u8ff0\u7684\u5168\u9762\u7a0b\u5ea6\uff0c\u5b8c\u6574\u4fe1\u606f\u5e94\u5305\u62ec\u6240\u6709\u91cd\u8981\u4e8b\u5b9e\u3002</li> <li>\uff083\uff09\u53ef\u9760\u6027\uff0c\u6307\u4fe1\u606f\u7684\u6765\u6e90\u3001\u91c7\u96c6\u65b9\u6cd5\u3001\u4f20\u8f93\u8fc7\u7a0b\u662f\u53ef\u4ee5\u4fe1\u4efb\u7684\uff0c\u7b26\u5408\u9884\u671f\u3002</li> <li>\uff084\uff09\u53ca\u65f6\u6027\uff0c\u6307\u83b7\u5f97\u4fe1\u606f\u7684\u65f6\u523b\u4e0e\u4e8b\u4ef6\u53d1\u751f\u65f6\u523b\u7684\u95ee\u9694\u957f\u77ed\u3002</li> <li>\uff085\uff09\u7ecf\u6d4e\u6027\uff0c\u6307\u4fe1\u606f\u83b7\u53d6\u3001\u4f20\u8f93\u5e26\u6765\u7684\u6210\u672c\u5728\u53ef\u4ee5\u63a5\u53d7\u7684\u8303\u56f4\u4e4b\u5185\u3002</li> <li>\uff086\uff09\u53ef\u9a8c\u8bc1\uff0c\u6307\u4fe1\u606f\u7684\u4e3b\u8981\u8d28\u91cf\u5c5e\u6027\u53ef\u4ee5\u88ab\u8bc1\u5b9e\u6216\u8005\u8bc1\u4f2a\u7684\u7a0b\u5ea6\u3002</li> <li>\uff087\uff09\u5b89\u5168\u6027\uff0c\u6307\u5728\u4fe1\u606f\u7684\u751f\u547d\u5468\u671f\u4e2d\uff0c\u4fe1\u606f\u53ef\u4ee5\u88ab\u975e\u6388\u6743\u8bbf\u95ee\u7684\u53ef\u80fd\u6027\uff0c\u53ef\u80fd\u6027\u8d8a\u4f4e\uff0c\u5b89\u5168\u6027\u8d8a\u9ad8\u3002</li> </ul> <p>\u4fe1\u606f\u4f20\u8f93\u6280\u672f\u662f\u4fe1\u606f\u6280\u672f\u7684\u6838\u5fc3</p> <p></p> <p>\u566a\u58f0\uff1a\u53ef\u4ee5\u7406\u89e3\u4e3a\u5e72\u6270</p>"},{"location":"ruankao/pm3/1-information-and-sys/#_4","title":"\u4fe1\u606f\u5316\u4ece\u201c\u5c0f\u201d\u5230\u201c\u5927\u201d\u53ef\u5206\u4e3a\u4ee5\u4e0b\u4e94\u4e2a\u5c42\u6b21","text":"<ul> <li>\uff081\uff09\u4ea7\u54c1\u4fe1\u606f\u5316\u3002\u4ea7\u54c1\u4fe1\u606f\u5316\u662f\u4fe1\u606f\u5316\u7684\u57fa\u7840\u3002</li> <li>\uff082\uff09\u4f01\u4e1a\u4fe1\u606f\u5316</li> <li>\uff083\uff09\u4ea7\u4e1a\u4fe1\u606f\u5316</li> <li>\uff084\uff09\u56fd\u6c11\u7ecf\u6d4e\u4fe1\u606f\u5316</li> <li>\uff085\uff09\u793e\u4f1a\u751f\u6d3b\u4fe1\u606f\u5316</li> </ul>"},{"location":"ruankao/pm3/1-information-and-sys/#_5","title":"\u4fe1\u606f\u5316\u4e3b\u4f53","text":"<p>\u4fe1\u606f\u5316\u7684\u4e3b\u4f53\u662f\u5168\u4f53\u793e\u4f1a\u6210\u5458\uff0c\u5305\u62ec\u653f\u5e9c\u3001\u4f01\u4e1a\u3001\u4e8b\u4e1a\u3001\u56e2\u4f53\u548c\u4e2a\u4eba\uff1b \u5b83\u7684\u65f6\u57df\u662f\u4e00\u4e2a\u957f\u671f\u7684\u8fc7\u7a0b\uff1b\u5b83\u7684\u7a7a\u57df\u662f\u653f\u6cbb\u3001\u7ecf\u6d4e\u3001\u6587\u5316\u3001\u519b\u4e8b\u548c\u793e\u4f1a\u7684\u4e00\u5207\u9886\u57df\uff1b \u5b83\u7684\u624b\u6bb5\u662f\u57fa\u4e8e\u73b0\u4ee3\u4fe1\u606f\u6280\u672f\u7684\u5148\u8fdb\u793e\u4f1a\u751f\u4ea7\u5de5\u5177\uff1b \u5b83\u7684\u9014\u5f84\u662f\u521b\u5efa\u4fe1\u606f\u65f6\u4ee3\u7684\u793e\u4f1a\u751f\u4ea7\u529b\uff0c\u63a8\u52a8\u793e\u4f1a\u751f\u4ea7\u5173\u7cfb\u53ca\u793e\u4f1a\u4e0a\u5c42\u5efa\u7b51\u7684\u6539\u9769\uff1b \u5b83\u7684\u76ee\u6807\u662f\u4f7f\u56fd\u5bb6\u7684\u7efc\u5408\u5b9e\u529b\u3001\u793e\u4f1a\u7684\u6587\u660e\u7d20\u8d28\u548c\u4eba\u6c11\u7684\u751f\u6d3b\u8d28\u91cf\u5168\u9762\u63d0\u5347\u3002</p>"},{"location":"ruankao/pm3/1-information-and-sys/#6","title":"\u56fd\u5bb6\u4fe1\u606f\u5316\u4f53\u7cfb6\u8981\u7d20","text":""},{"location":"ruankao/pm3/1-information-and-sys/#1","title":"\uff081\uff09\u4fe1\u606f\u8d44\u6e90","text":"<p>\u4fe1\u606f\u8d44\u6e90\u7684\u5f00\u53d1\u548c\u5229\u7528\u662f\u56fd\u5bb6\u4fe1\u606f\u5316\u7684\u6838\u5fc3\u4efb\u52a1\uff0c\u662f\u56fd\u5bb6\u4fe1\u606f\u5316\u5efa\u8bbe\u53d6\u5f97\u5b9e\u6548\u7684\u5173\u952e\uff0c\u4e5f\u662f\u6211\u56fd\u4fe1\u606f\u5316\u7684\u8584\u5f31\u73af\u8282\u3002 \u4fe1\u606f\u8d44\u6e90\u5f00\u53d1\u548c\u5229\u7528\u7684\u7a0b\u5ea6\u662f\u8861\u91cf\u56fd\u5bb6\u4fe1\u606f\u5316\u6c34\u5e73\u7684\u4e00\u4e2a\u91cd\u8981\u6807\u5fd7\u3002</p>"},{"location":"ruankao/pm3/1-information-and-sys/#2","title":"\uff082\uff09\u4fe1\u606f\u7f51\u7edc","text":"<p>\u4fe1\u606f\u7f51\u7edc\u662f\u4fe1\u606f\u8d44\u6e90\u5f00\u53d1\u548c\u5229\u7528\u7684\u57fa\u7840\u8bbe\u65bd\uff0c\u5305\u62ec\u7535\u4fe1\u7f51\u3001\u5e7f\u64ad\u7535\u89c6\u7f51\u548c\u8ba1\u7b97\u673a\u7f51\u7edc\u3002 \u8fd9\u4e09\u79cd\u7f51\u7edc\u6709\u5404\u81ea\u7684\u5f62\u6210\u8fc7\u7a0b\u3001 \u670d\u52a1\u5bf9\u8c61\u548c\u53d1\u5c55\u6a21\u5f0f\uff1f \u5b83\u4eec\u7684\u529f\u80fd\u6709\u6240\u4ea4\u53c9\uff0c\u53c8\u4e92\u4e3a\u8865\u5145\u3002 \u4fe1\u606f\u7f51\u7edc\u5728\u56fd\u5bb6\u4fe1\u606f\u5316\u7684\u8fc7\u7a0b\u4e2d\u5c06\u9010\u6b65\u5b9e\u73b0\u4e09\u7f51\u878d\u5408\uff0c\u5e76\u6700\u7ec8\u505a\u5230\u4e8c\u7f51\u5408\u4e00\u3002</p>"},{"location":"ruankao/pm3/1-information-and-sys/#3","title":"\uff083\uff09\u4fe1\u606f\u6280\u672f\u5e94\u7528","text":"<p>\u4fe1\u606f\u6280\u672f\u5e94\u7528\u662f\u6307\u628a\u4fe1\u606f\u6280\u672f\u5e7f\u6cdb\u5e94\u7528\u4e8e\u7ecf\u6d4e\u548c\u793e\u4f1a\u5404\u4e2a\u9886\u57df\u3002 \u5b83\u76f4\u63a5\u53cd\u6620\u4e86\u6548\u7387\u3001\u6548\u679c\u548c\u6548\u76ca\u3002\u4fe1\u606f\u6280\u672f\u5e94\u7528\u662f\u4fe1\u606f\u5316\u4f53\u7cfb\u516d\u8981\u7d20\u4e2d\u7684\u9f99\u5934\uff0c\u662f\u56fd\u5bb6\u4fe1\u606f\u5316\u5efa\u8bbe\u7684\u4e3b\u9635\u5730\uff0c\u96c6\u4e2d\u4f53\u73b0\u4e86\u56fd\u5bb6\u4fe1\u606f\u5316\u5efa\u8bbe\u7684\u9700\u6c42 \u548c\u6548\u76ca\u3002</p>"},{"location":"ruankao/pm3/1-information-and-sys/#4","title":"\uff084\uff09\u4fe1\u606f\u6280\u672f\u548c\u4ea7\u4e1a","text":"<p>\u4fe1\u606f\u4ea7\u4e1a\u662f\u4fe1\u606f\u5316\u7684\u7269\u8d28\u57fa\u7840\uff0c\u5305\u62ec\u5fae\u7535\u5b50\u3001\u8ba1\u7b97\u673a\u3001\u7535\u4fe1\u7b49\u4ea7\u54c1\u548c\u6280\u672f\u7684\u5f00\u53d1\u3001\u751f\u4ea7\u3001\u9500\u552e\uff0c\u4ee5\u53ca\u8f6f\u4ef6\u3001\u4fe1\u606f\u7cfb\u7edf\u5f00\u53d1\u548c\u7535\u5b50\u5546\u52a1\u7b49\u3002 \u4ece\u6839\u672c\u4e0a\u6765\u8bf4\uff0c\u56fd\u5bb6\u4fe1\u606f\u5316\u53ea\u6709\u5728\u4ea7\u54c1\u548c\u6280\u672f\u65b9\u9762\u62e5\u6709\u96c4\u539a\u7684\u81ea\u4e3b\u77e5\u8bc6\u4ea7\u6743\uff0c\u624d\u80fd\u63d0\u9ad8\u7efc\u5408\u56fd\u529b\u3002</p>"},{"location":"ruankao/pm3/1-information-and-sys/#5","title":"\uff085\uff09\u4fe1\u606f\u5316\u4eba\u624d","text":"<p>\u4eba\u624d\u662f\u4fe1\u606f\u5316\u7684\u6210\u529f\u4e4b\u672c\uff0c\u800c\u5408\u7406\u7684\u4eba\u624d\u7ed3\u6784\u66f4\u662f\u4fe1\u606f\u5316\u4eba\u624d\u7684\u6838\u5fc3\u548c\u5173\u952e\u3002 \u5408\u7406\u7684\u4fe1\u606f\u5316\u4eba\u624d\u7ed3\u6784\u8981\u6c42\u4e0d\u4ec5\u8981\u6709\u5404\u4e2a\u5c42\u6b21\u7684\u4fe1\u606f\u5316\u6280\u672f\u4eba\u624d\uff0c\u8fd8\u8981\u6709\u7cbe\u5e72\u7684\u4fe1\u606f\u5316\u7ba1\u7406\u4eba\u624d\u3001\u8425\u9500\u4eba\u624d\uff0c\u6cd5\u5f8b\u3001\u6cd5\u89c4\u548c\u60c5\u62a5\u4eba\u624d\u3002</p>"},{"location":"ruankao/pm3/1-information-and-sys/#6_1","title":"\uff086\uff09\u4fe1\u606f\u5316\u653f\u7b56\u6cd5\u89c4\u548c\u6807\u51c6\u89c4\u8303","text":"<p>\u4fe1\u606f\u5316\u653f\u7b56\u548c\u6cd5\u89c4\u3001\u6807\u51c6\u3001\u89c4\u8303\u7528\u4e8e\u89c4\u5e02\u548c\u534f\u8c03\u4fe1\u606f\u5316\u4f53\u7cfb\u5404\u8981\u7d20\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u662f\u56fd\u5bb6\u4fe1\u606f\u5316\u5feb\u901f\u3001\u6709\u5e8f\u3001\u5065\u5eb7\u548c\u6301\u7eed\u53d1\u5c55\u7684\u4fdd\u969c\u3002</p>"},{"location":"ruankao/pm3/1-information-and-sys/#_6","title":"\u4fe1\u606f\u7cfb\u7edf\u7684\u751f\u547d\u5468\u671f","text":"<p>\u4fe1\u606f\u7cfb\u7edf\u7684\u751f\u547d\u5468\u671f\u53ef\u4ee5\u7b80\u5316\u4e3a\u7cfb\u7edf\u89c4\u5212\uff08\u53ef\u884c\u6027\u5206\u6790 \u4e0e\u9879\u76ee\u5f00\u53d1\u8ba1\u5212\uff09\u3001 \u7cfb\u7edf\u5206\u6790\uff08\u9700\u6c42\u5206\u6790\uff09\u3001\u7cfb\u7edf\u8bbe\u8ba1\uff08\u6982\u8981\u8bbe\u8ba1\u3001\u8be6\u7ec6\u8bbe\u8ba1\uff09\u3001\u7cfb\u7edf\u5b9e\u65bd\uff08\u7f16\u7801\u3001 \u6d4b\u8bd5\uff09\u3001\u8fd0\u884c\u7ef4\u62a4\u7b49\u9636\u6bb5\u3002</p> <p>\u4e3a\u4e86\u4fbf\u4e8e\u8bba\u8ff0\u9488\u5bf9\u4fe1\u606f\u7cfb\u7edf\u7684\u9879\u76ee\u7ba1\u7406\uff0c\u4fe1\u606f\u7cfb\u7edf\u7684\u751f\u547d\u5468\u671f\u8fd8\u53ef\u4ee5\u7b80\u5316\u4e3a \u7acb\u9879\uff08\u7cfb\u7edf\u89c4\u5212\uff09\u3001\u5f00\u53d1 \uff08\u7cfb\u7edf\u5206\u6790\u3001\u7cfb\u7edf\u8bbe\u8ba1\u3001 \u7cfb\u7edf\u5b9e\u65bd\uff09\u3001\u8fd0\u7ef4\u53ca\u6d88\u4ea1\u56db\u4e2a\u9636\u6bb5.</p> <p>\u5728\u5f00\u53d1\u9636\u6bb5\u4e0d\u4ec5\u5305\u62ec\u7cfb\u7edf\u5206\u6790\u3001\u7cfb\u7edf\u8bbe\u8ba1\u3001\u7cfb\u7edf\u5b9e\u65bd\uff0c\u8fd8\u5305\u62ec\u7cfb\u7edf\u9a8c\u6536\u7b49\u5de5\u4f5c\u3002</p>"},{"location":"ruankao/pm3/1-information-and-sys/#_7","title":"\u4fe1\u606f\u7cfb\u7edf\u5f00\u53d1\u65b9\u6cd5","text":"<p>\u5e38\u7528\u7684\u5f00\u53d1\u65b9\u6cd5\u5305\u62ec\u7ed3\u6784\u5316\u65b9\u6cd5\u3001 \u9762\u5411\u5bf9\u8c61\u65b9\u6cd5\u3001\u539f\u578b\u5316\u65b9\u6cd5\u3001 \u9762\u5411\u670d\u52a1\u7684\u65b9\u6cd5\u7b49\u3002</p>"},{"location":"ruankao/pm3/2-info-sys-manage-basic/","title":"\u7b2c2\u7ae0 \u4fe1\u606f\u5316\u548c\u4fe1\u606f\u7cfb\u7edf","text":"\u66f4\u65b0\u65e5\u671f: 2022-4-21 <ul> <li>2022-4-21 \u521b\u5efa\u6587\u6863</li> </ul>"},{"location":"ruankao/pm3/2-info-sys-manage-basic/#_1","title":"\u9879\u76ee\u7684\u7279\u70b9","text":"<ul> <li>\u4e34\u65f6\u6027\uff08\u4e00\u6b21\u6027\uff09\uff1a\u4e34\u65f6\u6027\u662f\u6307\u6bcf\u4e00\u4e2a\u9879\u76ee\u90fd\u6709\u786e\u5b9a\u7684\u5f00\u59cb\u548c\u7ed3\u675f\u65e5\u671f</li> <li>\u72ec\u7279\u7684\u4ea7\u54c1\u3001\u670d\u52a1\u6216\u6210\u679c\uff1a\u9879\u76ee\u521b\u9020\u72ec\u7279\u7684\u53ef\u4ea4\u4ed8\u6210\u679c</li> <li>\u9010\u6b65\u5b8c\u5584\uff1a\u9010\u6b65\u5b8c\u5584\u610f\u5473\u7740\u5206\u6b65\u3001\u8fde\u7eed\u5730\u79ef\u7d2f</li> <li>\u8d44\u6e90\u7ea6\u675f\uff1a\u6bcf\u4e2a\u9879\u76ee\u90fd\u9700\u8981\u5177\u5907\u5404\u79cd\u8d44\u6e90\u6765\u4f5c\u4e3a\u5b9e\u65bd\u7684\u4fdd\u8bc1\uff0c\u800c\u8d44\u6e90\u662f\u6709\u9650\u7684</li> <li>\u76ee\u7684\u6027\uff1a\u9879\u76ee\u7684\u76ee\u7684\u5728\u4e8e\u5f97\u5230\u7279\u5b9a\u7684\u7ed3\u679c\uff0c\u5373\u9879\u76ee\u662f\u9762\u5411\u76ee\u6807\u7684</li> </ul> <p>\u6218\u7565\u7ba1\u7406\u5305\u62ec\u4ee5\u4e0b\u4e09\u4e2a\u8fc7\u7a0b\uff1a\u6218\u7565\u6307\u5b9a\uff1b\u6218\u7565\u5b9e\u65bd\uff1b\u6218\u7565\u8bc4\u4ef7</p>"},{"location":"ruankao/pm3/2-info-sys-manage-basic/#_2","title":"\u8f6f\u6280\u80fd","text":"<p>\u8f6f\u6280\u80fd\u5305\u62ec\u4eba\u673a\u5173\u7cfb\u7ba1\u7406\u3002\u5305\u542b\uff1a</p> <ul> <li>\u6709\u6548\u7684\u6c9f\u901a\uff1a\u4fe1\u606f\u4ea4\u6d41</li> <li>\u5f71\u54cd\u4e00\u4e2a\u7ec4\u7ec7\uff1a\u201c\u8ba9\u4e8b\u60c5\u529e\u6210\u201d\u7684\u80fd\u529b</li> <li>\u9886\u5bfc\u80fd\u529b\uff1a\u884c\u7a0b\u4e00\u4e2a\u524d\u666f\u548c\u6218\u7565\u5e76\u7ec4\u7ec7\u4eba\u5458\u8fbe\u5230\u5b83</li> <li>\u6fc0\u52b1\uff1a\u6fc0\u52b1\u4eba\u5458\u8fbe\u5230\u9ad8\u6c34\u5e73\u7684\u751f\u4ea7\u7387\u5e76\u514b\u670d\u53d8\u9769\u7684\u963b\u529b</li> <li>\u8c08\u5224\u548c\u51b2\u7a81\u7ba1\u7406\uff1a\u4e0e\u5176\u4ed6\u4eba\u8c08\u5224\u6216\u8fbe\u6210\u534f\u8bae</li> <li>\u95ee\u9898\u89e3\u51b3\uff1a\u95ee\u9898\u5b9a\u4e49\u548c\u505a\u51fa\u51b3\u7b56\u7684\u7ed3\u5408</li> </ul> <p>PRINCE2\u5305\u62ec4\u4e2a\u8981\u7d20\uff1a\u539f\u5219\uff0c\u6d41\u7a0b\u3001\u4e3b\u9898\u4ee5\u53ca\u9879\u76ee\u73af\u5883</p>"},{"location":"ruankao/pm3/2-info-sys-manage-basic/#_3","title":"\u9879\u76ee\u7279\u70b9\u548c\u7ec4\u7ec7\u7c7b\u578b\u8868","text":""},{"location":"ruankao/pm3/2-info-sys-manage-basic/#_4","title":"\u804c\u80fd\u578b\u7ec4\u7ec7","text":""},{"location":"ruankao/pm3/2-info-sys-manage-basic/#_5","title":"\u4f18\u70b9","text":"<ul> <li>\u5f3a\u5927\u7684\u6280\u672f\u652f\u6301\uff0c\u4fbf\u4e8e\u77e5\u8bc6\u3001\u6280\u80fd\u548c\u7ecf\u9a8c\u7684\u4ea4\u6d41</li> <li>\u6e05\u6670\u7684\u804c\u4e1a\u751f\u6daf\u664b\u5347\u8def\u7ebf</li> <li>\u76f4\u7ebf\u6c9f\u901a\u3001\u4ea4\u6d41\u7b80\u5355\u3001\u8d23\u4efb\u548c\u6743\u9650\u5f88\u6e05\u6670</li> <li>\u6709\u5229\u4e8e\u91cd\u590d\u6027\u5de5\u4f5c\u4e3a\u4e3b\u7684\u8fc7\u7a0b\u7ba1\u7406</li> </ul>"},{"location":"ruankao/pm3/2-info-sys-manage-basic/#_6","title":"\u7f3a\u70b9","text":"<p>\u804c\u80fd\u5229\u76ca\u4f18\u5148\u4e8e\u9879\u76ee\uff0c\u5177\u6709\u72ed\u9698\u6027\uff1b \u7ec4\u7ec7\u6a2a\u5411\u4e4b\u95f4\u7684\u8054\u7cfb\u8584\u5f31\u3001\u90e8\u95e8\u95f4\u6c9f\u901a\u3001\u534f\u8c03\u96be\u5ea6\u5927\uff1b \u9879\u76ee\u7ecf\u7406\u6781\u5c11\u6216\u8005\u7f3a\u5c11\u6743\u5229\u3001\u6743\u5a01\uff1b \u9879\u76ee\u7ba1\u7406\u53d1\u5c55\u65b9\u5411\u4e0d\u660e\uff0c\u7f3a\u5c11\u9879\u76ee\u57fa\u51c6\u7b49</p>"},{"location":"ruankao/pm3/2-info-sys-manage-basic/#_7","title":"\u9879\u76ee\u578b\u7ec4\u7ec7","text":""},{"location":"ruankao/pm3/2-info-sys-manage-basic/#_8","title":"\u4f18\u70b9","text":"<ul> <li>\u7ed3\u6784\u5355\u4e00\uff0c\u8d23\u6743\u5206\u660e\uff0c\u5229\u4e8e\u7edf\u4e00\u6307\u6325</li> <li>\u76ee\u6807\u660e\u786e\u5355\u4e00</li> <li>\u6c9f\u901a\u7b80\u6d01\u65b9\u4fbf</li> <li>\u51b3\u7b56\u5feb</li> </ul>"},{"location":"ruankao/pm3/2-info-sys-manage-basic/#_9","title":"\u7f3a\u70b9","text":"<p>\u7ba1\u7406\u6210\u672c\u8fc7\u9ad8\uff0c\u5982\u9879\u76ee\u7684\u5de5\u4f5c\u91cf\u4e0d\u8db3\u5219\u8d44\u6e90\u914d\u7f6e\u6548\u7387\u4f4e\uff1b \u9879\u76ee\u73af\u5883\u6bd4\u8f83\u5c01\u95ed\uff0c\u4e0d\u5229\u4e8e\u6c9f\u901a\u3001\u6280\u672f\u77e5\u8bc6\u7b49\u5171\u4eab\uff1b \u5458\u5de5\u7f3a\u4e4f\u4e8b\u4e1a\u4e0a\u7684\u8fde\u7eed\u6027\u548c\u4fdd\u969c\u7b49\u3002</p>"},{"location":"server/component/xxl-job/docker-run-xxl-job/","title":"XXL-JOB \u90e8\u7f72","text":"\u66f4\u65b0\u65e5\u671f 2022-8-17 <ul> <li>2022-08-17 \u521b\u5efa\u6587\u6863</li> </ul> <p>XXL-JOB \u662f\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u5206\u5e03\u5f0f\u4efb\u52a1\u8c03\u5ea6\u5e73\u53f0\uff0c\u5176\u6838\u5fc3\u8bbe\u8ba1\u76ee\u6807\u662f\u5f00\u53d1\u8fc5\u901f\u3001\u5b66\u4e60\u7b80\u5355\u3001\u8f7b\u91cf\u7ea7\u3001\u6613\u6269\u5c55\u3002\u73b0\u5df2\u5f00\u653e\u6e90\u4ee3\u7801\u5e76\u63a5\u5165\u591a\u5bb6\u516c\u53f8\u7ebf\u4e0a\u4ea7\u54c1\u7ebf\uff0c\u5f00\u7bb1\u5373\u7528\u3002</p> <p>xxl-job\u7684\u4ed3\u5e93\u548c\u76f8\u5173\u8bf4\u660e xxl-job - gitee</p>"},{"location":"server/component/xxl-job/docker-run-xxl-job/#_1","title":"\u521d\u59cb\u5316\u6570\u636e\u5e93","text":"<p>\u5148\u5230\u4ed3\u5e93\u91cc\u627e\u5230sql\u6587\u4ef6</p> <p>\u7528\u6765\u521d\u59cb\u5316\u6570\u636e\u5e93</p>"},{"location":"server/component/xxl-job/docker-run-xxl-job/#docker","title":"docker\u542f\u52a8","text":"<p>\u5047\u8bbe\u6211\u4eec\u914d\u7f6e\u7684\u7aef\u53e3\u662f10000</p> <p>docker\u542f\u52a8\uff0c\u5982\u4e0b\u547d\u4ee4</p> <pre><code>docker run -e PARAMS=\"--spring.datasource.url=jdbc:mysql://&lt;\u6570\u636e\u5e93\u5730\u5740&gt;:&lt;\u6570\u636e\u5e93\u7aef\u53e3&gt;/xxl_job?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;serverTimezone=Asia/Shanghai --spring.datasource.password=&lt;\u6570\u636e\u5e93\u5bc6\u7801RustFisher&gt; --xxl.job.accessToken=&lt;\u81ea\u5b9a\u4e49token&gt;\" -p 10000:8080  -v /tmp:/data/applogs --name xxl-job-admin-AnRFDev -d xuxueli/xxl-job-admin:2.3.1\n</code></pre>"},{"location":"sip/sip-and-sdp/","title":"SIP\u4e0eSDP","text":"2023-03-23 \u521b\u5efa\u6587\u6863 <ul> <li>2023-03-23 \u521b\u5efa\u6587\u6863</li> </ul> <p>SIP\uff08Session Initiation Protocol\uff09\u662f\u4e00\u79cd\u7528\u4e8e\u5efa\u7acb\u3001\u4fee\u6539\u548c\u7ec8\u6b62\u591a\u5a92\u4f53\u4f1a\u8bdd\u7684\u534f\u8bae\uff0c\u800cSDP\uff08Session Description Protocol\uff09\u5219\u662f\u4e00\u79cd\u7528\u4e8e\u63cf\u8ff0\u591a\u5a92\u4f53\u4f1a\u8bdd\u7684\u534f\u8bae\u3002\u5728SIP\u4e2d\uff0cSDP\u901a\u5e38\u88ab\u7528\u6765\u4f20\u9012\u5173\u4e8e\u5a92\u4f53\u6d41\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u7f16\u89e3\u7801\u5668\u7c7b\u578b\u3001\u4f20\u8f93\u534f\u8bae\u3001\u7aef\u53e3\u53f7\u7b49\u7b49\u3002\u5f53\u4e00\u4e2aSIP\u8bf7\u6c42\u6216\u54cd\u5e94\u9700\u8981\u643a\u5e26SDP\u4fe1\u606f\u65f6\uff0c\u5b83\u4eec\u901a\u5e38\u4f1a\u5c06SDP\u6570\u636e\u4f5c\u4e3a\u8d1f\u8f7d\u653e\u5728\u6d88\u606f\u4f53\u4e2d\uff0c\u4ee5\u4fbf\u8ba9\u5bf9\u65b9\u4e86\u89e3\u5173\u4e8e\u8be5\u4f1a\u8bdd\u7684\u5404\u79cd\u5a92\u4f53\u76f8\u5173\u7ec6\u8282\u3002\u56e0\u6b64\uff0c\u53ef\u4ee5\u8bf4SIP\u548cSDP\u662f\u5bc6\u5207\u76f8\u5173\u7684\u4e24\u4e2a\u534f\u8bae\uff0c\u5b83\u4eec\u5171\u540c\u7ec4\u6210\u4e86\u4e00\u5957\u5b8c\u6574\u7684\u591a\u5a92\u4f53\u4f1a\u8bdd\u5efa\u7acb\u548c\u4f20\u8f93\u673a\u5236\u3002</p>","tags":["sip"]},{"location":"sip/sip-and-sdp/#sdp","title":"SDP\u7684\u4f8b\u5b50","text":"<pre><code>v=0\uff1aSDP\u534f\u8bae\u7248\u672c\u53f7\u3002\no=- 1 1 IN IP4 172.20.91.230\uff1a\u4f1a\u8bdd\u539f\u70b9\uff08origin\uff09\u5305\u62ec\u4f1a\u8bddID\u3001\u4f1a\u8bdd\u7248\u672c\u53f7\u3001\u7f51\u7edc\u7c7b\u578b\u3001\u5730\u5740\u7c7b\u578b\u548cIP\u5730\u5740\u7b49\u4fe1\u606f\u3002\ns=-\uff1a\u4f1a\u8bdd\u540d\u79f0\u4e3a\u7a7a\u3002\nb=AS:136\uff1a\u4f1a\u8bdd\u5e26\u5bbd\u9650\u5236\u4e3a136kbps\u3002\nt=0 0\uff1a\u4f1a\u8bdd\u8d77\u59cb\u65f6\u95f4\u548c\u7ed3\u675f\u65f6\u95f4\u5747\u4e3a0\u3002\nm=audio 16032 UDP/TLS/RTP/SAVPF 8 126\uff1a\u63cf\u8ff0\u4e86\u5a92\u4f53\u6d41\u3002m=\u8868\u793a\u5a92\u4f53\u7c7b\u578b\u4e3a\u97f3\u9891\uff0c16032\u662f\u5a92\u4f53\u6d41\u4f7f\u7528\u7684\u7aef\u53e3\u53f7\uff0cUDP/TLS/RTP/SAVPF\u662f\u4f20\u8f93\u534f\u8bae\u548c\u6709\u6548\u8377\u8f7d\u683c\u5f0f\uff0c8\u548c126\u5206\u522b\u4ee3\u8868\u97f3\u9891\u7f16\u7801\u683c\u5f0f\u4e3aPCMA\u548c\u7535\u8bdd\u4e8b\u4ef6\u3002\nc=IN IP4 110.70.80.208\uff1a\u8fde\u63a5\u4fe1\u606f\uff0c\u5373\u5a92\u4f53\u6d41\u7684IP\u5730\u5740\u4e3a110.70.80.208\u3002\nb=AS:128\uff1a\u8be5\u5a92\u4f53\u6d41\u7684\u5e26\u5bbd\u9650\u5236\u4e3a128kbps\u3002\na=ice-ufrag:y7NNkDKB\uff1aICE\u534f\u8bae\u4e2d\u4f7f\u7528\u7684\u7528\u6237\u540d\u7247\u6bb5\u3002\na=ice-pwd:857ptMf7fbCuJ5XdCqDEBHDZCfAMJ/cF\uff1aICE\u534f\u8bae\u4e2d\u4f7f\u7528\u7684\u5bc6\u7801\u3002\na=candidate:1 1 UDP 2130706431 110.70.80.208 16032 typ host\uff1a\u63cf\u8ff0\u4e86\u7528\u4e8eICE\u534f\u5546\u7684\u5019\u9009\u5730\u5740\u3002\na=rtcp:9\uff1aRTCP\u534f\u8bae\u4f7f\u7528\u7684\u7aef\u53e3\u53f7\u4e3a9\u3002\na=rtcp-mux\uff1a\u542f\u7528RTCP\u590d\u7528\u3002\na=fingerprint:sha-256 57:F7:21:AC:50:1D:7D:B0:C2:CE:47:0D:A6:5F:1B:42:E9:E6:45:76:71:40:7D:0A:AA:FB:04:10:BC:19:A9:22\uff1a\u4f7f\u7528SHA-256\u7b97\u6cd5\u8ba1\u7b97\u7684\u6570\u5b57\u6307\u7eb9\u7528\u4e8e\u52a0\u5bc6\u4f20\u8f93\u3002\na=ssrc:448824499 cname:4XEWkjS+ILIS0SOk\uff1a\u540c\u6b65\u4fe1\u6e90\u6807\u8bc6\u7b26\uff08SSRC\uff09\u548c\u5b83\u7684CNAME\u3002\na=rtpmap:8 PCMA/8000\uff1a\u5b9a\u4e49\u4e86payload type\u4e3a8\u7684rtp\u6709\u6548\u8377\u8f7d\u683c\u5f0f\u3002\na=rtpmap:126 telephone-event/8000\uff1a\u5b9a\u4e49\u4e86payload type\u4e3a126\u7684rtp\u6709\u6548\u8377\u8f7d\u683c\u5f0f\u3002\na=sendrecv\uff1a\u8868\u793a\u8be5\u5a92\u4f53\u6d41\u53ef\u4ee5\u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\u3002\na=mid:audio\uff1a\u4e3a\u5a92\u4f53\u6d41\u8bbe\u7f6e\u552f\u4e00\u7684\u6807\u8bc6\u7b26\u3002\na=setup:active\uff1a\u8868\u793a\u5a92\u4f53\u6d41\u4f7f\u7528\u4e3b\u52a8\u6a21\u5f0f\u5efa\u7acb\u8fde\u63a5\u3002\n</code></pre>","tags":["sip"]},{"location":"sip/sip-err-code/","title":"SIP\u9519\u8bef\u7801\u53c2\u8003","text":"\u66f4\u65b0\u65e5\u671f: 2023-3-23 <ul> <li>2023-3-23 \u66f4\u65b0\u8bf4\u660e</li> <li>2022-10-12 \u521b\u5efa\u6587\u6863</li> </ul> <p>SIP\uff08Session Initiation Protocol\uff0c\u4f1a\u8bdd\u521d\u59cb\u534f\u8bae\uff09\u7684\u72b6\u6001\u7801\u5171\u67096\u7c7b\uff0c\u5206\u522b\u662f1xx\u30012xx\u30013xx\u30014xx\u30015xx\u548c6xx\u3002\u6bcf\u4e2a\u72b6\u6001\u7801\u8868\u793a\u4e86\u5bf9SIP\u8bf7\u6c42\u7684\u5904\u7406\u7ed3\u679c\u3002</p>","tags":["sip"]},{"location":"sip/sip-err-code/#sip_1","title":"SIP\u9519\u8bef\u7801\uff08\u4e2d\u6587\u89e3\u91ca\uff09","text":"<p>\u4e0b\u9762\u662f\u8fd9\u4e9b\u72b6\u6001\u7801\u7684\u7b80\u8981\u8bf4\u660e\uff1a</p> <ul> <li>1xx\uff1a\u4fe1\u606f\u54cd\u5e94\uff0c\u8868\u793a\u8bf7\u6c42\u5df2\u88ab\u63a5\u6536\u5e76\u6b63\u5728\u5904\u7406\u4e2d\u3002</li> <li>2xx\uff1a\u6210\u529f\u54cd\u5e94\uff0c\u8868\u793a\u8bf7\u6c42\u5df2\u88ab\u6210\u529f\u5904\u7406\u3002</li> <li>3xx\uff1a\u91cd\u5b9a\u5411\u54cd\u5e94\uff0c\u8868\u793a\u8bf7\u6c42\u9700\u8981\u8fdb\u4e00\u6b65\u64cd\u4f5c\u624d\u80fd\u5b8c\u6210\u3002</li> <li>4xx\uff1a\u5ba2\u6237\u7aef\u9519\u8bef\u54cd\u5e94\uff0c\u8868\u793a\u8bf7\u6c42\u5305\u542b\u8bed\u6cd5\u9519\u8bef\u6216\u65e0\u6cd5\u5b8c\u6210\u3002</li> <li>5xx\uff1a\u670d\u52a1\u5668\u9519\u8bef\u54cd\u5e94\uff0c\u8868\u793a\u670d\u52a1\u5668\u5728\u5904\u7406\u8bf7\u6c42\u65f6\u53d1\u751f\u9519\u8bef\u3002</li> <li>6xx\uff1a\u5168\u5c40\u6027\u9519\u8bef\u54cd\u5e94\uff0c\u8868\u793a\u5b58\u5728\u67d0\u79cd\u4e34\u65f6\u6027\u6216\u6c38\u4e45\u6027\u9519\u8bef\uff0c\u4f7f\u5f97\u65e0\u6cd5\u5904\u7406\u8bf7\u6c42\u3002</li> </ul> <p>\u6bcf\u4e2a\u72b6\u6001\u7801\u90fd\u6709\u4e00\u4e2a\u6570\u5b57\u4ee3\u7801\u548c\u5bf9\u5e94\u7684\u6587\u672c\u63cf\u8ff0\uff0c\u4f8b\u5982200 OK\u8868\u793a\u6210\u529f\u5904\u7406\u8bf7\u6c42\uff0c404 Not Found\u8868\u793a\u672a\u627e\u5230\u8bf7\u6c42\u7684\u8d44\u6e90\u7b49\u3002</p>","tags":["sip"]},{"location":"sip/sip-err-code/#1xx","title":"1xx","text":"<p>100 Trying   \u8bf4\u660ecaller\u6b63\u5728\u547c\u53eb\uff0c\u4f46\u8fd8\u6ca1\u8054\u7cfb\u4e0acallee\u3002 </p> <p>180 Ringing \u8bf4\u660ecallee\u5df2\u7ecf\u88ab\u8054\u7cfb\u4e0a,callee\u7684\u94c3\u6b63\u5728\u54cd.\u6536\u5230\u8fd9\u4e2a\u4fe1\u606f\u540e\uff0c\u7b49\u5f85200 OK  </p> <p>181 Call is being forwarded  \u8bf4\u660ecall\u88ab\u91cd\u65b0\u8def\u7531\u5230\u53e6\u5916\u4e00\u4e2a\u76ee\u7684\u5730  </p> <p>182 Queued   \u8bf4\u660ecallee\u5f53\u524d\u662f\u4e0d\u53ef\u83b7\u5f97\u7684\uff0c\u4f46\u662f\u5bf9\u65b9\u4e0d\u60f3\u76f4\u63a5\u62d2\u7edd\u547c\u53eb\uff0c\u800c\u662f\u9009\u62e9\u653e\u5728\u547c\u53eb\u961f\u5217\u4e2d  </p> <p>183 Session progress   \u7528\u6765\u8b66\u544acaller\u9891\u6bb5(inband)\u9519\u8bef\u3002\u5f53\u4ecePSTN\u6536\u5230\u4e00\u4e2aISDN\u6d88\u606f\uff0cSIP gateway \u4ea7\u751f183 Session progress \u3002  </p>","tags":["sip"]},{"location":"sip/sip-err-code/#2xx-successful-responses","title":"2xx successful Responses","text":"<p>200 OK   </p>","tags":["sip"]},{"location":"sip/sip-err-code/#3xx-redirection-responses","title":"3xx Redirection Responses","text":"<p>300 Multiple choices  \u8bf4\u660e\u547c\u53eb\u7684\u5730\u5740\u88ab\u89e3\u6790\u6210\u591a\u4e2a\u5730\u5740\uff0c\u6240\u6709\u7684\u5730\u5740\u90fd\u88ab\u63d0\u4f9b\u51fa\u6765\uff0c\u7528\u6237\u6216\u7528\u6237\u4ee3\u7406\u53ef\u4ee5\u4ece\u4e2d\u9009\u62e9\u8054\u7cfb\u54ea\u4e2a\u3002   </p> <p>301 Moved permanently   \u8bf4\u660e\u6307\u5b9a\u5730\u5740\u7684\u7528\u6237\u5df2\u7ecf\u6c38\u8fdc\u4e0d\u53ef\u7528\uff0c\u5728\u5934\u4e2d\u5df2\u7ecf\u7528\u53e6\u5916\u4e00\u4e2a\u5730\u5740\u66ff\u6362\u4e86.  </p> <p>302 Moved temporarily   \u8bf4\u660e\u6307\u5b9a\u5730\u5740\u7684\u7528\u6237\u4e34\u65f6\u4e0d\u53ef\u7528\uff0c\u5728\u5934\u4e2d\u5df2\u7ecf\u7528\u53e6\u5916\u4e00\u4e2a\u5730\u5740\u4ee3\u66ff\u4e86.  </p> <p>305 Use proxy   \u8bf4\u660ecaller\u5fc5\u987b\u7528\u4e00\u4e2aproxy\u6765\u8054\u7cfbcallee. </p> <p>380 Alternative service   \u8bf4\u660ecall\u4e0d\u6210\u529f\uff0c\u4f46\u662f\u53ef\u9009\u62e9\u5176\u4ed6\u7684\u670d\u52a1   </p>","tags":["sip"]},{"location":"sip/sip-err-code/#4xx-request-failure-responses","title":"4xx Request Failure Responses","text":"<p>400 Bad Request   \u8bf4\u660e\u7531\u4e8e\u975e\u6cd5\u683c\u5f0f\uff0c\u8bf7\u6c42\u4e0d\u80fd\u88ab\u7406\u89e3\u3002  </p> <p>401 Unauthorized \u8bf4\u660e\u8bf7\u6c42\u9700\u8981\u7528\u6237\u8ba4\u8bc1\u3002  </p> <p>402 Payment required  \u8bf4\u660e\u5b8c\u6210\u4f1a\u8bdd\u9700\u8981\u4ed8\u8d39.  </p> <p>403 Forbidden   \u8bf4\u660eserver\u5df2\u7ecf\u6536\u5230\u5e76\u80fd\u7406\u89e3\u8bf7\u6c42\u4f46\u4e0d\u63d0\u4f9b\u670d\u52a1\u3002  </p> <p>404 Not Found   \u8bf4\u660eserver\u6709\u660e\u786e\u7684\u4fe1\u606f\u5728\u6307\u5b9a\u7684\u57df\u4e2d\u7528\u6237\u4e0d\u5b58\u5728.  </p> <p>405 Method Not Allowed   \u8bf4\u660e\u8bf7\u6c42\u4e2d\u6307\u5b9a\u7684\u65b9\u6cd5\u662f\u4e0d\u88ab\u5141\u8bb8\u7684\u3002\u5c06\u8fd4\u56de\u4e00\u4e2a\u5141\u8bb8\u7684\u65b9\u6cd5\u5217\u8868\u3002  </p> <p>406 Not Acceptable \u8bf4\u660e\u88ab\u8bf7\u6c42\u7684\u8d44\u6e90\u53ea\u5bf9\u67d0\u4e9b\u7279\u6b8a\u7684\u8bf7\u6c42\u4f5c\u51fa\u54cd\u5e94\uff0c\u5bf9\u76ee\u524d\u5934(header)\u4e2d\u6307\u5b9a\u7684\u8bf7\u6c42\u4e0d\u63a5\u53d7.  </p> <p>407 Proxy authentication required   \u548c401 Unauthorized response\u76f8\u4f3c.\u4f46\u662f\uff0c\u5b83\u8bf4\u660eclient\u5fc5\u987b\u9996\u5148\u5728proxy\u4e0a\u8ba4\u8bc1\u81ea\u5df1\u3002  </p> <p>408 Request timeout   \u8bf4\u660e\u5728timeout\u65f6\u95f4\u8fc7\u671f\u524d\uff0cserver\u4e0d\u80fd\u4ea7\u751f\u54cd\u5e94.  </p> <p>409 Conflict   \u8bf4\u660e\u7531\u4e8e\u548c\u5f53\u524d\u8d44\u6e90\u72b6\u6001\u4ea7\u751f\u51b2\u7a81\uff0c\u8bf7\u6c42\u4e0d\u80fd\u88ab\u5904\u7406\u3002  </p> <p>410 Gone   \u8bf4\u660e\u8bf7\u6c42\u8d44\u6e90\u5728server\u4e0a\u6c38\u8fdc\u4e0d\u53ef\u7528\uff0c\u4e5f\u6ca1\u6709\u8f6c\u53d1\u7684\u5730\u5740\u3002  </p> <p>411 Length required  \u8bf4\u660e\u7528\u6237\u62d2\u7edd\u63a5\u53d7\u6ca1\u6709\u5b9a\u4e49content\u957f\u5ea6\u7684\u8bf7\u6c42\u3002  </p> <p>413 Request entity too large   \u8bf4\u660eserver\u62d2\u7edd\u5904\u7406\u8bf7\u6c42\uff0c\u56e0\u4e3a\u5b83\u592a\u5927\uff0c\u8d85\u8fc7\u4e86server\u80fd\u5904\u7406\u7684\u5927\u5c0f\u3002  </p> <p>414 Request-URI too long   \u8bf4\u660eserver\u62d2\u7edd\u5904\u7406\u8bf7\u6c42\uff0c\u56e0\u4e3a\u8bf7\u6c42\u7684URI\u592a\u957f\uff0cserver\u4e0d\u80fd\u89e3\u91ca\u5b83\u3002  </p> <p>415 Unsupported media   \u8bf4\u660eserver\u62d2\u7edd\u5904\u7406\u8bf7\u6c42\uff0c\u56e0\u4e3abody\u683c\u5f0f\u4e0d\u88ab\u76ee\u7684\u7ec8\u7aef\u652f\u6301  </p> <p>420 Bad extension   \u8bf4\u660eserver\u4e0d\u80fd\u7406\u89e3\u5728header\u4e2d\u6307\u51fa\u7684\u6269\u5c55\u534f\u8bae\u3002  </p> <p>480 Temporarily unavailable   \u8bf4\u660ecallee\u5df2\u7ecf\u88ab\u8054\u7cfb\u4e0a\uff0c\u4f46\u662f\u6682\u65f6\u4e0d\u53ef\u7528\u3002  </p> <p>481 Call leg/transaction does not exist  \u8bf4\u660eserver\u6b63\u5728\u5ffd\u7565\u8bf7\u6c42\uff0c\u7531\u4e8e\u5b83\u662f\u4e00\u4e2a\u6ca1\u6709\u5339\u914dlegID\u7684BYE\u6216     \u8005\u662f\u4e00\u4e2a\u6ca1\u6709\u5339\u914d\u4e8b\u52a1\u7684CANCEL\u3002   </p> <p>482 Loop detected   \u8bf4\u660eserver\u6536\u5230\u4e86\u4e00\u4e2a\u5305\u542b\u5b83\u81ea\u5df1\u8def\u5f84\u7684\u8bf7\u6c42.  </p> <p>483 Too many hops   \u8bf4\u660eserver\u6536\u5230\u4e86\u4e00\u4e2a\u8bf7\u6c42\uff0c\u5b83\u9700\u8981\u7684hop\u6570\u8d85\u8fc7\u4e86\u5728header\u4e2d\u5141\u8bb8\u7684\u6700\u5927hop\u6570.  </p> <p>484 Address incomplete   \u8bf4\u660eserver\u6536\u5230\u4e00\u4e2a\u5730\u5740\u4e0d\u5b8c\u6574\u7684\u8bf7\u6c42. </p> <p>485 Ambiguous   \u8bf4\u660eserver\u6536\u5230\u4e00\u4e2a\u8bf7\u6c42\uff0c\u5176\u4e2dcallee\u7684\u5730\u5740\u662f\u4e0d\u660e\u786e\u7684\uff0c\u4e5f\u6ca1\u6709\u53ef\u80fd\u5907\u7528\u7684\u5730\u5740\u4f9b\u9009\u62e9\u3002  </p> <p>486 Busy here   \u8bf4\u660ecallee\u5df2\u7ecf\u88ab\u8054\u7cfb\u4e0a\uff0c\u4f46\u662f\u5b83\u4eec\u7684\u7cfb\u7edf\u4e0d\u80fd\u627f\u53d7\u989d\u5916\u7684call. </p> <p>487 \u547c\u53eb\u88ab\u7ec8\u6b62</p> <p>488  \uff08\u6682\u65f6\u4e0d\u80fd\u8fdb\u884c\uff09\u3002  </p>","tags":["sip"]},{"location":"sip/sip-err-code/#5xx-server-failure-responses","title":"5xx Server Failure Responses","text":"<p>500 Server internal error   \u8bf4\u660eserver\u6216gateway\u53d1\u751f\u610f\u5916\u9519\u8bef\u4ece\u800c\u4e0d\u80fd\u5904\u7406\u8bf7\u6c42.  </p> <p>501 Not implemented   \u8bf4\u660eserver\u6216gateway\u4e0d\u652f\u6301\u5b8c\u6210\u8bf7\u6c42\u6240\u9700\u7684\u529f\u80fd.  </p> <p>502 Bad gateway   \u8bf4\u660eserver\u6216gateway\u4ece\u4e0b\u6e38server\u6536\u5230\u4e00\u4e2a\u975e\u6cd5\u54cd\u5e94.</p> <p>503 Service unavailable   \u8bf4\u660e\u7531\u4e8e\u8d85\u8d1f\u8f7d\u6216\u7ef4\u62a4\u95ee\u9898\uff0cserver\u6216gateway\u4e0d\u80fd\u5904\u7406\u8bf7\u6c42.  </p> <p>504 Gateway timeout  \u8bf4\u660eserver\u6216gateway\u6ca1\u6709\u4ece\u53e6\u5916\u4e00\u4e2aserver(\u5982location server)\u6536\u5230\u4e00\u4e2a\u53ca\u65f6\u7684\u54cd\u5e94.     </p> <p>505 Version not supported   \u8bf4\u660eserver\u6216gateway\u4e0d\u652f\u6301\u5728\u8bf7\u6c42\u4e2d\u7528\u5230\u7684SIP\u7248\u672c\u3002   </p>","tags":["sip"]},{"location":"sip/sip-err-code/#6xx-global-responses","title":"6xx Global Responses","text":"<p>600 Busy everywhere  \u8bf4\u660ecallee\u5df2\u7ecf\u88ab\u8054\u7cfb\u4e0a\uff0c\u4f46\u662f\u5904\u4e8e\u5fd9\u72b6\u6001\u4e2d\uff0c\u5728\u8fd9\u4e2a\u65f6\u95f4\u4e0d\u80fd\u63a5\u53d7call\u3002  </p> <p>603 Decline   \u8bf4\u660ecallee\u5df2\u7ecf\u88ab\u8054\u7cfb\u4e0a\uff0c\u4f46\u662f\u4e0d\u80fd\u6216\u4e0d\u60f3\u52a0\u5165call\u3002  </p> <p>604 Does not exist anywhere   \u8bf4\u660eserver\u6709\u6b63\u5f0f\u7684\u4fe1\u606f\u8bf4\u660ecallee\u4e0d\u5b58\u5728\u4e8e\u7f51\u7edc\u4e2d\u3002  </p> <p>606 Not acceptable   \u8bf4\u660ecallee\u5df2\u7ecf\u88ab\u8054\u7cfb\u4e0a\uff0c\u4f46\u662fsession\u63cf\u8ff0\u7684\u67d0\u4e9b\u65b9\u9762\u4e0d\u88ab\u63a5\u53d7\u3002</p>","tags":["sip"]},{"location":"sip/sip-err-code/#_1","title":"\u82f1\u6587\u5b8c\u6574\u7248","text":"<p>SIP responses are the codes used by Session Initiation Protocol for communication. We have put together a list of all the SIP responses known.</p>","tags":["sip"]},{"location":"sip/sip-err-code/#1xx-informational-sip-responses","title":"1xx = Informational SIP responses","text":"<p>100 Trying - Extended search is being performed so a forking proxy must send a 100 Trying response.</p> <p>180 Ringing - The Destination User Agent has received the INVITE message and is alerting the user of call.</p> <p>181 Call Is Being Forwarded - Optional, send by Server to indicate a call is being forwarded.</p> <p>182 Queued - Destination was temporarily unavailable, the server has queued the call until the destination is available.</p> <p>183 Session Progress - This response may be used to send extra information for a call which is still being set up.</p> <p>199 Early Dialog Terminated - Send by the User Agent Server to indicate that an early dialogue has been terminated.</p>","tags":["sip"]},{"location":"sip/sip-err-code/#2xx-success-responses","title":"2xx = Success responses","text":"<p>200 OK - Shows that the request was successful.</p> <p>202 Accepted - Indicates that the request has been accepted for processing, mainly used for referrals.</p> <p>204 No Notification - Indicates that the request was successful but no response will be received.</p>","tags":["sip"]},{"location":"sip/sip-err-code/#3xx-redirection-responses_1","title":"3xx = Redirection responses","text":"<p>300 Multiple Choices -  The address resolved to one of several options for the user or client to choose between.</p> <p>301 Moved Permanently - The original Request URI is no longer valid, the new address is given in the Contact header.</p> <p>302 Moved Temporarily - The client should try at the address in the Contact field.</p> <p>305 Use Proxy - The Contact field details a proxy that must be used to access the requested destination.</p> <p>380 Alternative Service - The call failed, but alternatives are detailed in the message body.</p>","tags":["sip"]},{"location":"sip/sip-err-code/#4xx-request-failures","title":"4xx = Request failures","text":"<p>400 Bad Request - The request could not be understood due to malformed syntax.</p> <p>401 Unauthorized - The request requires user authentication. This response is issued by UASs and registrars.</p> <p>402 Payment Required -  (Reserved for future use).</p> <p>403 Forbidden - The server understood the request, but is refusing to fulfil it.</p> <p>404 Not Found - The server has definitive information that the user does not exist at the (User not found).</p> <p>405 Method Not Allowed - The method specified in the Request-Line is understood, but not allowed.</p> <p>406 Not Acceptable - The resource is only capable of generating responses with unacceptable content.</p> <p>407 Proxy Authentication Required - The request requires user authentication.</p> <p>408 Request Timeout - Couldn't find the user in time.</p> <p>409 Conflict - User already registered (deprecated).</p> <p>410 Gone - The user existed once but is not available here any more.</p> <p>411 Length Required - The server will not accept the request without a valid content length (deprecated).</p> <p>412 Conditional Request Failed - The given precondition has not been met.</p> <p>413 Request Entity Too Large - Request body too large.</p> <p>414 Request URI Too Long - Server refuses to service the request, the Req-URI is longer than the server can interpret.</p> <p>415 Unsupported Media Type - Request body is in a non-supported format.</p> <p>416 Unsupported URI Scheme - Request-URI is unknown to the server.</p> <p>417 Uknown Resource-Priority - There was a resource-priority option tag, but no Resource-Priority header.</p> <p>420 Bad Extension - Bad SIP Protocol Extension used, not understood by the server.</p> <p>421 Extension Required - The server needs a specific extension not listed in the Supported header.</p> <p>422 Session Interval Too Small - The request contains a Session-Expires header field with a duration below the minimum.</p> <p>423 Interval Too Brief - Expiration time of the resource is too short.</p> <p>424 Bad Location Information - The request's location content was malformed or otherwise unsatisfactory.</p> <p>428 Use Identity Header - The server policy requires an Identity header, and one has not been provided.</p> <p>429 Provide Referrer Identity - The server did not receive a valid Referred-By token on the request.</p> <p>430 Flow Failed - A specific flow to a user agent has failed, although other flows may succeed.</p> <p>433 Anonymity Disallowed - The request has been rejected because it was anonymous.</p> <p>436 Bad Identity Info - The request has an Identity-Info header and the   URI scheme contained cannot be de-referenced.</p> <p>437 Unsupported Certificate - The server was unable to validate a certificate for the domain that signed the request.</p> <p>438 Invalid Identity Header - Server obtained a valid certificate used to sign a request, was unable to verify the signature.</p> <p>439 First Hop Lacks Outbound Support - The first outbound proxy doesn't support the \"outbound\" feature.</p> <p>440 Max-Breadth Exceeded - If a SIP proxy determined a response context had insufficient Incoming Max-Breadth to carry out a desired parallel fork, and the proxy  is unwilling/unable to compensate by forking serially or sending a redirect, that proxy MUST return a 440 response. A client receiving a 440 response can infer  that its request did not reach all possible destinations.</p> <p>469 Bad Info Package - If a SIP UA receives an INFO request associated with an Info Package that the UA has not indicated willingness to receive, the UA MUST send  a 469 response, which contains a Recv-Info header field with Info Packages for which UA is willing to receive INFO requests.</p> <p>470 Consent Needed - The source of the request did not have the permission of the recipient to make such a request.</p> <p>480 Temporarily Unavailable - Callee currently unavailable.</p> <p>481 Call/Transaction Does Not Exist - Server received a request that does not match any dialogue or transaction.</p> <p>482 Loop Detected - Server has detected a loop.</p> <p>483 Too Many Hops - Max-Forwards header has reached the value '0'.</p> <p>484 Address Incomplete - Request-URI incomplete.</p> <p>485 Ambiguous - Request-URI is ambiguous.</p> <p>486 Busy Here - Callee is busy.</p> <p>487 Request Terminated - Request has terminated by bye or cancel.</p> <p>488 Not Acceptable Here - Some aspects of the session description of the Request-URI are not acceptable.</p> <p>489 Bad Event - The server did not understand an event package specified in an Event header field.</p> <p>491 Request Pending - Server has some pending request from the same dialogue.</p> <p>493 Undecipherable - UndecipherableRequest contains an encrypted MIME body, which recipient can not decrypt.</p> <p>494 Security Agreement Required - The server has received a request that requires a negotiated security mechanism.</p>","tags":["sip"]},{"location":"sip/sip-err-code/#5xx-server-errors","title":"5xx = Server errors","text":"<p>500 Server Internal Error - The server could not fulfill the request due to some unexpected condition.</p> <p>501 Not Implemented - The SIP request method is not implemented here.</p> <p>502 Bad Gateway - The server, received an invalid response from a downstream server while trying to fulfill a request.</p> <p>503 Service Unavailable - The server is in maintenance or is temporarily overloaded and cannot process the request.</p> <p>504 Server Time-out - The server tried to access another server while trying to process a request, no timely response.</p> <p>505 Version Not Supported - The SIP protocol version in the request is not supported by the server.</p> <p>513 Message Too Large - The request message length is longer than the server can process.</p> <p>555 Push Notification Service Not Supported - The server does not support the push notification serviced specified in the pn-provider SIP URI parameter.</p> <p>580 Precondition Failure - The server is unable or unwilling to meet some constraints specified in the offer.</p>","tags":["sip"]},{"location":"sip/sip-err-code/#6xx-global-failures","title":"6xx = Global failures","text":"<p>600 Busy Everywhere - All possible destinations are busy.</p> <p>603 Decline - Destination cannot/doen't wish to participate in the call,  no alternative destinations.</p> <p>604 Does Not Exist Anywhere - The server has authoritative information that the requested user does not exist anywhere.</p> <p>606 Not Acceptable - The user's agent was contacted successfully but some aspects of the session description were not acceptable.</p> <p>607 Unwanted - The called party did not want his call from the calling party. Future attempts from the calling party are likely to be similarly rejected.</p>","tags":["sip"]},{"location":"webrtc/some-reference/","title":"\u5173\u4e8eWebRTC\u7684\u4e00\u4e9b\u53c2\u8003\u8d44\u6599","text":"\u66f4\u65b0\u65e5\u671f: 2023-3-17 <ul> <li>2023-3-17 \u589e\u52a0\u5f15\u7528\u8d44\u6599</li> <li>2022-8-2 \u589e\u52a0\u5f15\u7528\u8d44\u6599</li> <li>2022-5-16 \u589e\u52a0\u8bf4\u660e</li> <li>2022-5-12 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u6536\u96c6\u4e00\u4e9b\u5173\u4e8eWebRTC\u7684\u6587\u6863\u8d44\u6599\uff0c\u6559\u7a0b\uff0c\u793a\u4f8b\u5de5\u7a0b\u7b49\u7b49\u3002</p> <p>WebRTC\u4ecd\u5728\u53d1\u5c55\u4e2d\uff0c\u5982\u6709\u8d44\u6599\u9519\u8bef\u3001\u8fc7\u65f6\u7684\u60c5\u51b5\u8bf7\u8054\u7cfb rf.cs@foxmail.com</p>","tags":["WebRTC"]},{"location":"webrtc/some-reference/#webrtc-for-the-curious","title":"WebRTC for the Curious","text":"<p>\u7ed9\u5bf9WebRTC\u611f\u5230\u597d\u5947\u7684\u4eba - WebRTC for the Curious</p> <p>WebRTC\u662f\u4ec0\u4e48\uff1f\u4e3a\u4ec0\u4e48\u6211\u5e94\u8be5\u5b66\u4e60WebRTC\uff1f</p> <p>WebRTC\u534f\u8bae\u662f\u4e00\u7ec4\u5176\u4ed6\u6280\u672f\u7684\u96c6\u5408\u4f53\uff0cWebRTC\u662f\u4e00\u7cfb\u5217\u534f\u8bae\u7684\u96c6\u5408\u3002</p> <p>\u8fd9\u662f\u4e00\u4efd\u5f88\u597d\u7684\u5165\u95e8\u6750\u6599\u3002\u4ecb\u7ecdWebRTC\u662f\u4ec0\u4e48\uff0c\u4ecb\u7ecd\u4e3b\u8981\u7684\u5de5\u4f5c\u6d41\u7a0b\u3002</p> <p>\u6587\u6863\u6709\u591a\u79cd\u8bed\u8a00\u53ef\u4ee5\u9009\u62e9\uff0c\u652f\u6301\u4e2d\u6587\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/some-reference/#pion","title":"pion","text":"<p>go\u5b9e\u73b0\u7684turn\u670d\u52a1</p> <p>pion/turn - github</p>","tags":["WebRTC"]},{"location":"webrtc/some-reference/#coturn","title":"coturn","text":"<p>C\u5b9e\u73b0\u7684turn\u670d\u52a1</p> <p>coturn - github</p> <p>Ubuntu\u90e8\u7f72coturn\u7684\u53c2\u8003\u65b9\u6cd5 </p> <ul> <li>https://gabrieltanner.org/blog/turn-server</li> <li>Ubuntu\u4e0b\u8f7d\u5b89\u88c5coturn\uff0c\u542f\u52a8TURN\u670d\u52a1</li> </ul>","tags":["WebRTC"]},{"location":"webrtc/some-reference/#stun","title":"stun\u670d\u52a1","text":"<p>\u5bfb\u627e\u53ef\u7528stun\u670d\u52a1</p> <p>https://github.com/pradt2/always-online-stun</p>","tags":["WebRTC"]},{"location":"webrtc/some-reference/#webrtc-samples","title":"WebRTC Samples","text":"<p>WebRTC Samples - github.io \u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217web\u7aef\u5c0f\u6559\u7a0b\u548c\u793a\u4f8b</p> <p>\u6d4b\u8bd5\u670d\u52a1\u7684\u5de5\u5177WebRTC samples Trickle ICE</p> <p>WebRTC\u5b98\u65b9\u51fa\u7684\u793a\u4f8b\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/some-reference/#_1","title":"\u642d\u5efa\u7ecf\u9a8c\u603b\u7ed3","text":"<p>webrtc\u642d\u5efa\u89c6\u9891\u901a\u8bdd\u3001\u89c6\u9891\u4f1a\u8bae - \u96f6\u58f0\u97f3\u89c6\u9891\u5f00\u53d1\u7684\u6587\u7ae0 - \u77e5\u4e4e</p>","tags":["WebRTC"]},{"location":"webrtc/some-reference/#_2","title":"\u8d44\u6e90\u5c0f\u7ed3","text":"<ul> <li>Getting Started With WebRTC\uff1a\u8fd9\u662f\u4e00\u4e2a\u5173\u4e8eWebRTC\u7684\u5165\u95e8\u6559\u7a0b\uff0c\u4ecb\u7ecd\u4e86\u57fa\u672c\u6982\u5ff5\uff0cAPI\u548c\u793a\u4f8b\u3002</li> <li>WebRTC Tutorial\uff1a\u8fd9\u662f\u4e00\u4e2a\u8be6\u7ec6\u7684WebRTC\u6559\u7a0b\uff0c\u6db5\u76d6\u4e86\u4ece\u83b7\u53d6\u5a92\u4f53\u6d41\u5230\u5efa\u7acb\u8fde\u63a5\u548c\u4f20\u8f93\u6570\u636e\u7684\u5404\u4e2a\u65b9\u9762\u3002</li> <li>Real time communication with WebRTC\uff1a\u8fd9\u662f\u4e00\u4e2a\u7531Google\u63d0\u4f9b\u7684\u4ee3\u7801\u5b9e\u9a8c\u5ba4\uff0c\u5e26\u4f60\u4e00\u6b65\u6b65\u5730\u6784\u5efa\u4e00\u4e2a\u7b80\u5355\u7684\u89c6\u9891\u804a\u5929\u5e94\u7528\u3002</li> <li> <p>WebRTC Tutorials - 36 Essential Learning Resources\uff1a\u8fd9\u662f\u4e00\u4e2a\u6536\u96c6\u4e8636\u4e2a\u6709\u7528\u7684WebRTC\u5b66\u4e60\u8d44\u6e90\u7684\u6587\u7ae0\uff0c\u5305\u62ec\u535a\u5ba2\u3001\u4e66\u7c4d\u3001\u89c6\u9891\u548c\u8bfe\u7a0b\u3002</p> </li> <li> <p>Use Microsoft Teams on Azure Virtual Desktop - Azure\uff1a\u8fd9\u662f\u4e00\u4e2a\u5173\u4e8e\u5728Azure\u865a\u62df\u684c\u9762\u4e0a\u4f7f\u7528Microsoft Teams\uff08\u57fa\u4e8eWebRTC\uff09\u7684\u6559\u7a0b\uff0c\u4ecb\u7ecd\u4e86\u5982\u4f55\u51c6\u5907\u7f51\u7edc\u73af\u5883\uff0c\u5b89\u88c5\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7ec4\u4ef6\u7b49\u3002</p> </li> <li>Real time communication with WebRTC\uff1a\u8fd9\u662f\u4e00\u4e2a\u7531Google\u63d0\u4f9b\u7684\u4ee3\u7801\u5b9e\u9a8c\u5ba4\uff0c\u5e26\u4f60\u4e00\u6b65\u6b65\u5730\u6784\u5efa\u4e00\u4e2a\u7b80\u5355\u7684\u89c6\u9891\u804a\u5929\u5e94\u7528\uff0c\u5e76\u4ecb\u7ecd\u4e86\u5982\u4f55\u642d\u5efa\u4e00\u4e2a\u57fa\u4e8eNode.js\u548cSocket.IO\u7684\u4fe1\u4ee4\u670d\u52a1\u5668\u3002</li> <li>What's new in the Remote Desktop WebRTC Redirector Service\uff1a\u8fd9\u662f\u4e00\u4e2a\u5173\u4e8e\u8fdc\u7a0b\u684c\u9762WebRTC\u91cd\u5b9a\u5411\u670d\u52a1\uff08RD WebRTC Redirector Service\uff09\u7684\u6587\u6863\uff0c\u4ecb\u7ecd\u4e86\u8be5\u670d\u52a1\u7684\u6700\u65b0\u7248\u672c\u548c\u66f4\u65b0\u5185\u5bb9\u3002</li> </ul>","tags":["WebRTC"]},{"location":"webrtc/android/agc-ns-compile/","title":"WebRTC\u62bd\u53d6AGC\u589e\u76ca\u4e0eANS\u566a\u58f0\u6291\u5236\u6a21\u5757\u7ed9Android","text":"\u66f4\u65b0\u65e5\u671f 2022-9-30 <ul> <li>2022-9-30 \u66f4\u65b0\u8bf4\u660e</li> <li>2022-9-1 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u672c\u6587\u914d\u5408Android\u97f3\u9891PCM\u6570\u636e\u7684\u91c7\u96c6\u548c\u64ad\u653e\uff0c\u8bfb\u5199\u97f3\u9891wav\u6587\u4ef6\u4e00\u8d77\u4f7f\u7528</p> <p>WebRTC\u662f\u4e00\u4e2a\u5f88\u5927\u7684\u5de5\u7a0b\u3002\u5176\u4e2d\u5305\u542b\u4e86\u81ea\u52a8\u589e\u76ca\u6a21\u5757AGC\uff08Automatic Gain Control\uff09\uff0c\u566a\u58f0\u6291\u5236\u6a21\u5757ANS\uff08Automatic Noise Suppression\uff09\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u4eceWebRTC\u4e2d\u62bd\u53d6\u51faAGC\u548cANS\u6a21\u5757\uff0c\u653e\u8fdbAndroid\u5de5\u7a0b\u4e2d\u4f7f\u7528\u3002</p> <p>\u53c2\u8003</p> <ul> <li>\u5355\u72ec\u62bd\u53d6WebRTC\u7684AGC(\u589e\u76ca)\u6a21\u5757</li> <li>\u793a\u4f8b\u5de5\u7a0b WebRtcNsAgcModel</li> </ul> <p>\u53c2\u8003\u793a\u4f8b\u5de5\u7a0b WebRtcNsAgcModel\uff0c\u6211\u4eec\u62ff\u5230\u91cc\u9762\u7684c\u4ee3\u7801\u3002\u628a\u5b83\u4eec\u653e\u5230\u6211\u4eec\u7684\u5de5\u7a0b\u91cc\u3002</p> <p>\u91c7\u6837\u7387\u662f16000\uff0c\u6211\u4eec\u6bcf\u6b21\u53ea\u80fd\u5904\u740610ms\u7684\u6570\u636e\uff0c\u5373160\u4e2a\u70b9\u3002\u4e5f\u5c31\u662f320\u4e2abyte\u3002</p> WindEar AudioRecordThread \u90e8\u5206\u4ee3\u7801<pre><code>private boolean canWriteIn = false; // \u7528\u6765\u653e\u5f03\u524d\u9762\u4e00\u90e8\u5206\u6570\u636e\n\nprivate class AudioRecordThread extends Thread {\n    AudioRecord aRecord;\n    int bufferSize = 10240;\n    boolean createWav = false;\n\n    AutomaticGainControlUtils agcUtils = new AutomaticGainControlUtils();\n    NoiseSuppressorUtils nsUtils;\n    long nsxId = 0;\n    int nsxInit = 0;\n    int nexSetPolicy = 0;\n    long agcId = 0;\n    int agcInitResult = 0;\n    int agcSetConfigResult = 0;\n    byte[] tmpPcmArr = new byte[320];\n    short[] inputArr = new short[160];\n    short[] agcOutputArr = new short[160];\n    short[] nsOutputArr = new short[160];\n    ByteBuffer bufferCvt = ByteBuffer.allocate(2);\n\n    AudioRecordThread(boolean createWav) {\n        this.createWav = createWav;\n        bufferSize = AudioRecord.getMinBufferSize(AUDIO_FREQUENCY,\n                RECORD_CHANNEL_CONFIG, AUDIO_ENCODING) * RECORD_AUDIO_BUFFER_TIMES;\n        Log.d(TAG, \"record buffer size = \" + bufferSize); // e.g 1280\n        aRecord = new AudioRecord(MediaRecorder.AudioSource.VOICE_RECOGNITION, AUDIO_FREQUENCY,\n                RECORD_CHANNEL_CONFIG, AUDIO_ENCODING, bufferSize);\n\n        if (enableWebRTCAGC) {\n            bufferCvt.order(ByteOrder.LITTLE_ENDIAN);\n            nsUtils = new NoiseSuppressorUtils();\n            nsxId = nsUtils.nsxCreate();\n            nsxInit = nsUtils.nsxInit(nsxId, 16000);\n            nexSetPolicy = nsUtils.nsxSetPolicy(nsxId, 2);\n\n            agcUtils = new AutomaticGainControlUtils();\n            agcId = agcUtils.agcCreate();\n            agcInitResult = agcUtils.agcInit(agcId, 0, 255, 3, 16000);\n            agcSetConfigResult = agcUtils.agcSetConfig(agcId, (short) 3, (short) 20, true);\n            Log.d(TAG, \"[rec] agcInitResult: \" + agcInitResult + \", agcSetConfigResult: \" + agcSetConfigResult);\n        } else {\n            if (AutomaticGainControl.isAvailable()) {\n                AutomaticGainControl agc = AutomaticGainControl.create(\n                        aRecord.getAudioSessionId());\n                if (agc != null) {\n                    agc.setEnabled(true);\n                } else {\n                }\n            } else {\n                Log.w(TAG, \"AudioRecordThread: \u4e0d\u652f\u6301\u81ea\u52a8\u589e\u76caAutomaticGainControl\");\n            }\n        }\n    }\n\n    @Override\n    public void run() {\n        state = WindState.RECORDING;\n        notifyState(state);\n        Log.d(TAG, \"\u5f55\u5236\u5f00\u59cb\");\n        try {\n            FileOutputStream wavFos = new FileOutputStream(tmpWavFile);\n            if (createWav) {\n                byte[] zeroHeader = new byte[44]; // \u5360\u4f4d\u7f6e\n                wavFos.write(zeroHeader);\n            }\n            aRecord.startRecording();\n            byte[] byteBuffer = new byte[bufferSize];\n            while (state.equals(WindState.RECORDING) &amp;&amp; !isInterrupted()) {\n                int startOff = 0;\n                int end = aRecord.read(byteBuffer, 0, byteBuffer.length);\n\n                if (!canWriteIn) {\n                    continue;\n                }\n\n                if (enableWebRTCAGC &amp;&amp; byteBuffer.length &gt; 320) {\n                    for (int i = 0; i &lt; byteBuffer.length; i += 320) {\n                        System.arraycopy(byteBuffer, i, tmpPcmArr, 0, 320);\n                        ByteBuffer.wrap(tmpPcmArr).order(ByteOrder.LITTLE_ENDIAN).asShortBuffer().get(inputArr);\n                        nsUtils.nsxProcess(nsxId, inputArr, 1, nsOutputArr);\n                        agcUtils.agcProcess(\n                                agcId, nsOutputArr, 1, 160, agcOutputArr,\n                                0, 0, 0, false\n                        );\n                        for (int j = 0; j &lt; agcOutputArr.length; j++) {\n                            bufferCvt.clear();\n                            bufferCvt.putShort(agcOutputArr[j]);\n                            byteBuffer[i + j * 2] = bufferCvt.get(0);\n                            byteBuffer[i + j * 2 + 1] = bufferCvt.get(1);\n                        }\n                    }\n                }\n                if (createWav) {\n                    wavFos.write(byteBuffer, startOff, end - startOff);\n                    wavFos.flush();\n                }\n                float vol = calVolumeInByte(byteBuffer);\n                if (onVolListener != null) {\n                    onVolListener.onVol(vol);\n                }\n            }\n            aRecord.stop(); // \u5f55\u5236\u7ed3\u675f\n            try {\n                aRecord.release();\n            } catch (Exception e) {\n                Log.e(TAG, \"run: \", e);\n            }\n            wavFos.close();\n            if (createWav) {\n                // \u4fee\u6539header\n                RandomAccessFile wavRaf = new RandomAccessFile(tmpWavFile, \"rw\");\n                byte[] header = generateWavFileHeader(tmpWavFile.length() - 44, AUDIO_FREQUENCY, aRecord.getChannelCount());\n                wavRaf.seek(0);\n                wavRaf.write(header);\n                wavRaf.close();\n                Log.d(TAG, \"tmpWavFile.length: \" + tmpWavFile.length());\n            }\n        } catch (Exception e) {\n            Log.e(TAG, \"AudioRecordThread:\", e);\n            notifyState(WindState.ERROR);\n        }\n        notifyState(state);\n        state = WindState.IDLE;\n        notifyState(state);\n        Log.d(TAG, \"\u5f55\u5236\u7ed3\u675f\");\n    }\n}\n</code></pre> <p>agc\u548cns\u914d\u5408\u9632\u6b62\u566a\u58f0\u8fc7\u5927\u3002\u5148\u4f7f\u7528ns\uff08\u566a\u58f0\u6291\u5236\uff09\uff0c\u7136\u540e\u518d\u4f7f\u7528agc\uff08\u81ea\u52a8\u589e\u76ca\uff09\u3002</p>","tags":["WebRTC","Android Media"]},{"location":"webrtc/android/agc-ns-compile/#_1","title":"\u53c2\u8003","text":"<ul> <li>\u5355\u72ec\u62bd\u53d6WebRTC\u7684AGC(\u589e\u76ca)\u6a21\u5757</li> <li>https://github.com/inodevip/WebRtcNsAgcModel</li> </ul>","tags":["WebRTC","Android Media"]},{"location":"webrtc/capture/video-local-peer/","title":"WebRTC\u6a21\u62df\u4f20\u8f93\u89c6\u9891\u6d41\uff0cvideo\u901a\u8fc7\u672c\u5730\u8282\u70b9peer\u4f20\u8f93\u89c6\u9891\u6d41","text":"\u66f4\u65b0\u65e5\u671f: 2021-12-16 <ul> <li>2021-12-16 \u66f4\u65b0\u53c2\u8003</li> <li>2021-12-15 \u521b\u5efa\u6587\u6863</li> </ul>","tags":["WebRTC"]},{"location":"webrtc/capture/video-local-peer/#video-video","title":"video -&gt; video","text":"<p>\u5728\u7f51\u9875\u4e0a\uff0cvideo\u4f20\u8f93\u89c6\u9891\u5230\u53e6\u4e00\u4e2avideo\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/capture/video-local-peer/#html","title":"html","text":"<p><code>video</code>\u7528<code>source</code>\u8bbe\u5b9a\u89c6\u9891\u8def\u5f84 <pre><code>&lt;video id=\"fromVideo\" playsinline controls loop muted&gt;\n    &lt;source src=\"../../src/video/s1.mp4\" type=\"video/mp4\"&gt;\n    &lt;p&gt;\u5f53\u524d\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u89c6\u9891\u64ad\u653e&lt;/p&gt;\n&lt;/video&gt;\n\n&lt;video id=\"toVideo\" playsinline autoplay&gt;&lt;/video&gt;\n</code></pre> 2\u4e2avideo\u5143\u7d20\uff0c\u4e00\u4e2a\u9884\u8bbe\u89c6\u9891\u8def\u5f84\uff0c\u53e6\u4e00\u4e2a\u51c6\u5907\u63a5\u6536\u89c6\u9891\u6d41\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/capture/video-local-peer/#js","title":"js","text":"<p>\u9700\u8981\u76d1\u542c<code>canplay</code>\u4e8b\u4ef6\u3002</p> <pre><code>'use strict';\n\nconst srcVideo = document.getElementById('fromVideo');\nconst toVideo = document.getElementById('toVideo');\n\nsrcVideo.addEventListener('canplay', () =&gt; {\n  let stream;\n  const fps = 0;\n  if (srcVideo.captureStream) {\n    stream = srcVideo.captureStream(fps);\n  } else if (srcVideo.mozCaptureStream) {\n    stream = srcVideo.mozCaptureStream(fps);\n  } else {\n    console.error('rustfisher.com: \u4e0d\u652f\u6301captureStream\u65b9\u6cd5\uff01');\n    stream = null;\n  }\n  toVideo.srcObject = stream;\n});\n</code></pre> <p><code>captureStream</code>\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2aMediaStream\u5bf9\u8c61\uff0c\u62e5\u6709\u5b9e\u65f6\u6570\u636e\u6d41\u3002</p> <p>\u53c2\u8003HTMLMediaElement.captureStream()</p> <p>\u672c\u5730\u76f4\u63a5\u6253\u5f00html\uff0c<code>captureStream(fps)</code>\u65b9\u6cd5\u62a5\u9519 <pre><code>Uncaught DOMException: \n    Failed to execute 'captureStream' on 'HTMLMediaElement': \n        Cannot capture from element with cross-origin data\n        at HTMLVideoElement.&lt;anonymous&gt;\n</code></pre> \u9700\u8981\u5728HTTPS\u4e0b\u8fd0\u884c\u3002\u8c03\u8bd5\u7684\u65f6\u5019\u9700\u8981\u6ce8\u610f\u3002</p> <p>\u793a\u4f8b\u6548\u679c\u94fe\u63a5</p>","tags":["WebRTC"]},{"location":"webrtc/capture/video-local-peer/#_1","title":"\u6a21\u62df\u8fde\u63a5\u8282\u70b9","text":"<p>\u524d\u9762\u662f\u4ece\u4e00\u4e2avideo\u4f20\u5230\u53e6\u4e00\u4e2avideo\u3002\u73b0\u5728\u6211\u4eec\u6765\u6a21\u62df\u901a\u8fc7RTCPeerConnection\u6765\u4f20\u8f93\u89c6\u9891\u6d41\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/capture/video-local-peer/#_2","title":"\u51c6\u5907\u5de5\u4f5c","text":"<p>html\u4e0a\u6446\u653e2\u4e2avideo\uff0c\u7b2c\u4e00\u4e2a<code>fromVideo</code>\u4f5c\u4e3a\u6e90\uff0c<code>toVideo</code>\u663e\u793a\u63a5\u6536\u540e\u7684\u89c6\u9891 <pre><code>&lt;div id=\"container\"&gt;\n    &lt;video id=\"fromVideo\" playsinline controls muted&gt;\n        &lt;source src=\"../../src/video/v5_1.mp4\" type=\"video/mp4\"&gt;\n        &lt;p&gt;\u5f53\u524d\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u89c6\u9891\u64ad\u653e&lt;/p&gt;\n    &lt;/video&gt;\n\n    &lt;video id=\"toVideo\" playsinline autoplay controls&gt;&lt;/video&gt;\n    &lt;p&gt;\u53d7\u7f51\u901f\u5f71\u54cd\uff0c\u89c6\u9891\u52a0\u8f7d\u9700\u8981\u4e00\u4e9b\u65f6\u95f4&lt;/p&gt;\n&lt;/div&gt;\n\n&lt;script src=\"../../src/js/adapter-2021.js\"&gt;&lt;/script&gt;\n&lt;script src=\"js/pc.js\" async&gt;&lt;/script&gt;\n</code></pre></p> <p>\u7f51\u901f\u597d\u7684\u4e5f\u53ef\u4ee5\u7528<code>webrtc.github.io adapter</code> <pre><code>&lt;script src=\"https://webrtc.github.io/adapter/adapter-latest.js\"&gt;&lt;/script&gt;\n</code></pre></p> <p>js\u4e2d\u62ff\u5230\u8fd92\u4e2avideo\u5143\u7d20 <pre><code>'use strict';\n\nconst srcVideo = document.getElementById('fromVideo');\nconst toVideo = document.getElementById('toVideo');\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/capture/video-local-peer/#_3","title":"\u83b7\u53d6\u89c6\u9891\u6d41","text":"<p>\u6570\u636e\u6d41\u4ece\u4e00\u4e2a\u8282\u70b9\u4f20\u8f93\u5230\u53e6\u4e00\u4e2a\u8282\u70b9\uff0c\u5148\u5b9a\u4e49\u53d8\u91cf <pre><code>let stream; // \u6e90\u5934\u7684\u6570\u636e\u6d41\n\nlet pc1; // \u6e90\nlet pc2; // \u76ee\u6807\nconst offerOptions = {\n    offerToReceiveAudio: 1,\n    offerToReceiveVideo: 1\n};\n\nlet startTime; // \u8bb0\u5f55\u7684\u5f00\u59cb\u65f6\u95f4\n</code></pre></p> <p>\u4ece<code>srcVideo</code>\u62ff\u89c6\u9891\u6d41\u3002 <pre><code>function tryGetStream() {\n    if (stream) {\n        console.log('\u5df2\u7ecf\u6709\u89c6\u9891\u6d41\u4e86\uff0c\u8fd9\u91cc\u8df3\u8fc7');\n        return;\n    }\n    if (srcVideo.captureStream) {\n        stream = srcVideo.captureStream();\n        console.log('captureStream\u83b7\u53d6\u5230\u4e86\u89c6\u9891\u6d41', stream);\n        call();\n    } else if (srcVideo.mozCaptureStream) {\n        stream = srcVideo.mozCaptureStream();\n        console.log('mozCaptureStream()\u83b7\u53d6\u5230\u4e86\u89c6\u9891\u6d41', stream);\n        call();\n    } else {\n        console.log('\u4e0d\u652f\u6301 captureStream()');\n    }\n}\n\nsrcVideo.oncanplay = tryGetStream; // \u76d1\u542c\u64ad\u653e\u4e8b\u4ef6\n\nif (srcVideo.readyState &gt;= 3) {\n    console.log('\u5df2\u7ecf\u53ef\u4ee5\u64ad\u653e\u89c6\u9891\u4e86 \u76f4\u63a5\u53bb\u62ff\u89c6\u9891\u6d41');\n    tryGetStream();\n}\n\nsrcVideo.play(); // \u5f00\u59cb\u64ad\u653e\n</code></pre> \u548c\u524d\u9762\u7684\u4f8b\u5b50\u7c7b\u4f3c\uff0c\u5c1d\u8bd5\u7528<code>captureStream</code>\u65b9\u6cd5\u83b7\u53d6\u89c6\u9891\u6d41\u3002 <code>call()</code>\u65b9\u6cd5\u5728\u540e\u9762\u3002</p> <p>\u76d1\u542c<code>toVideo</code>\u7684\u4e00\u4e9b\u4e8b\u4ef6 <pre><code>toVideo.onloadedmetadata = () =&gt; {\n    console.log(`toVideo onloadedmetadata \u5bbd\u9ad8${toVideo.videoWidth}px, ${toVideo.videoHeight}`);\n};\n\ntoVideo.onresize = () =&gt; {\n    console.log(`toVideo onresize: ${toVideo.videoWidth}x${toVideo.videoHeight}`);\n    if (startTime) {\n        const elapsedTime = window.performance.now() - startTime;\n        console.log('resize\u8017\u65f6: ' + elapsedTime.toFixed(3) + 'ms');\n        startTime = null; // \u6d88\u8017\u6389\u8fd9\u4e2a\u5f00\u59cb\u65f6\u95f4\u6807\u5fd7\n    }\n};\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/capture/video-local-peer/#_4","title":"\u4f20\u8f93","text":"<p>\u65b0\u5efa2\u4e2aRTCPeerConnection\uff0c\u5f00\u59cb\u4f20\u8f93\u3002 <pre><code>function call() {\n    console.log('call \u5f00\u59cb.....');\n    startTime = window.performance.now();\n    const videoTracks = stream.getVideoTracks();\n    const audioTracks = stream.getAudioTracks();\n    if (videoTracks.length &gt; 0) {\n        console.log(`\u4f7f\u7528\u7684\u89c6\u9891\u8bbe\u5907: ${videoTracks[0].label}`);\n    }\n    if (audioTracks.length &gt; 0) {\n        console.log(`\u4f7f\u7528\u97f3\u9891\u8bbe\u5907: ${audioTracks[0].label}`);\n    }\n    const servers = null;\n    pc1 = new RTCPeerConnection(servers);\n    console.log('\u521b\u5efa\u672c\u5730\u8282\u70b9pc1');\n    pc1.onicecandidate = e =&gt; onIceCandidate(pc1, e);\n\n    pc2 = new RTCPeerConnection(servers);\n    console.log('\u521b\u5efa\u8fdc\u7aef\u8282\u70b9pc2');\n    pc2.onicecandidate = e =&gt; onIceCandidate(pc2, e);\n\n    pc1.oniceconnectionstatechange = e =&gt; onIceStateChange(pc1, e);\n    pc2.oniceconnectionstatechange = e =&gt; onIceStateChange(pc2, e);\n\n    pc2.ontrack = gotRemoteStream;\n\n    stream.getTracks().forEach(track =&gt; pc1.addTrack(track, stream));\n    console.log('pc1\u52a0\u8f7d\u89c6\u9891\u6d41');\n\n    console.log('pc1 \u521b\u5efaoffer');\n    pc1.createOffer(onCreateOfferSuccess, onCreateSessionDescriptionError, offerOptions);\n}\n\n\nfunction onCreateSessionDescriptionError(error) {\n    console.log(`\u521b\u5efa\u4f1a\u8bdd\u63cf\u8ff0\u51fa\u9519: ${error.toString()}`);\n}\n\nfunction onCreateOfferSuccess(desc) {\n    console.log(`Offer from pc1${desc.sdp}`);\n    console.log('pc1 setLocalDescription start');\n    pc1.setLocalDescription(desc, () =&gt; onSetLocalSuccess(pc1), onSetSessionDescriptionError);\n    console.log('pc2 setRemoteDescription start');\n    pc2.setRemoteDescription(desc, () =&gt; onSetRemoteSuccess(pc2), onSetSessionDescriptionError);\n    console.log('pc2 createAnswer start');\n    pc2.createAnswer(onCreateAnswerSuccess, onCreateSessionDescriptionError);\n}\n\nfunction onSetLocalSuccess(pc) {\n    console.log(`${getName(pc)} setLocalDescription complete`);\n}\n\nfunction onSetRemoteSuccess(pc) {\n    console.log(`${getName(pc)} setRemoteDescription complete`);\n}\n\nfunction onSetSessionDescriptionError(error) {\n    console.log(`Failed to set session description: ${error.toString()}`);\n}\n\nfunction gotRemoteStream(event) {\n    if (toVideo.srcObject !== event.streams[0]) {\n        toVideo.srcObject = event.streams[0];\n        console.log('pc2 \u6536\u5230\u8fdc\u7aef\u6570\u636e\u6d41', event);\n    }\n}\n\nfunction onCreateAnswerSuccess(desc) {\n    console.log(`Answer from pc2: ${desc.sdp}`);\n    console.log('pc2 setLocalDescription start');\n    pc2.setLocalDescription(desc, () =&gt; onSetLocalSuccess(pc2), onSetSessionDescriptionError);\n    console.log('pc1 setRemoteDescription start');\n    pc1.setRemoteDescription(desc, () =&gt; onSetRemoteSuccess(pc1), onSetSessionDescriptionError);\n}\n\nfunction onIceCandidate(pc, event) {\n    getOtherPc(pc).addIceCandidate(event.candidate)\n        .then(\n            () =&gt; onAddIceCandidateSuccess(pc),\n            err =&gt; onAddIceCandidateError(pc, err)\n        );\n    console.log(`${getName(pc)} ICE candidate: ${event.candidate ? event.candidate.candidate : '(null)'}`);\n}\n\nfunction onAddIceCandidateSuccess(pc) {\n    console.log(`${getName(pc)} addIceCandidate success`);\n}\n\nfunction onAddIceCandidateError(pc, error) {\n    console.log(`${getName(pc)} failed to add ICE Candidate: ${error.toString()}`);\n}\n\nfunction onIceStateChange(pc, event) {\n    if (pc) {\n        console.log(`${getName(pc)} ICE state: ${pc.iceConnectionState}`);\n        console.log('ICE state change event: ', event);\n    }\n}\n\nfunction getName(pc) {\n    return (pc === pc1) ? 'pc1' : 'pc2';\n}\n\nfunction getOtherPc(pc) {\n    return (pc === pc1) ? pc2 : pc1;\n}\n</code></pre></p> <p><code>call()</code>\u65b9\u6cd5\u53d1\u8d77\u6a21\u62df\u4f20\u8f93\u7684\u6d41\u7a0b\u3002\u65b0\u5efa\u8282\u70b9\u540e\uff0c\u8bbe\u7f6eICE\u76f8\u5173\u63a5\u542c\u3002\u76d1\u542cICE\u5019\u9009\u53d8\u5316\u548c\u8fde\u63a5\u72b6\u6001\u53d8\u5316\u3002 pc1\u521b\u5efaoffer\uff0cpc2\u5e94\u7b54\uff08answer\uff09\u3002pc2\u62ff\u5230\u89c6\u9891\u6d41\u540e\uff0c\u76f4\u63a5\u663e\u793a\u51fa\u6765\u3002</p> call\u4e0e\u76f8\u5173\u6d41\u7a0b\u56fe\u793a <p></p>","tags":["WebRTC"]},{"location":"webrtc/capture/video-local-peer/#_5","title":"\u6548\u679c","text":"<p>\u793a\u4f8b\u6548\u679c\u8bf7\u53c2\u8003\u94fe\u63a5https://www.an.rustfisher.com/webrtc/capture/video-local-peer/pc.html</p>","tags":["WebRTC"]},{"location":"webrtc/capture/video-local-peer/#_6","title":"\u5c0f\u7ed3","text":"<p>\u672c\u6587\u7684\u4e24\u4e2a\u4f8b\u5b50\u8fd8\u6ca1\u6709\u7528\u5230\u771f\u6b63\u7684\u4f20\u8f93\u670d\u52a1\uff0c\u56e0\u6b64\u662f\u6a21\u62df\u8fdb\u884c\u89c6\u9891\u6d41\u7684\u4f20\u8f93\u3002\u53ef\u4ee5\u719f\u6089\u4e00\u4e0b<code>video</code>\u5143\u7d20\u4ee5\u53ca<code>captureStream</code>\u7684\u7528\u6cd5\uff0c\u548c\u521b\u5efa\u8282\u70b9\u548c\u8bbe\u7f6eICE\u7684\u6d41\u7a0b\u3002</p> <p></p> <p>WebRTC\u7cfb\u5217</p>","tags":["WebRTC"]},{"location":"webrtc/capture/video-local-peer/#_7","title":"\u53c2\u8003","text":"<ul> <li>RTCPeerConnection() - mozilla.org</li> <li>RTCPeerConnection - mozilla.org</li> </ul> <p>\u672c\u6587\u94fe\u63a5</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a \u77e5\u4e4e</p>","tags":["WebRTC"]},{"location":"webrtc/intro/concept-intro/","title":"WebRTC\u6982\u5ff5\u7b80\u4ecb","text":"\u66f4\u65b0\u65e5\u671f: 2021-12-01 <ul> <li>2021-12-01 \u66f4\u65b0\u53c2\u8003</li> <li>2021-11-09 \u521b\u5efa\u6587\u6863</li> </ul>","tags":["WebRTC"]},{"location":"webrtc/intro/concept-intro/#_1","title":"\u7b80\u4ecb","text":"<p>WebRTC\uff08Web Real-Time Communication\uff09\u3002Real-Time Communication\uff0c\u5b9e\u65f6\u901a\u8baf\u3002</p> <p>WebRTC\u80fd\u8ba9web\u5e94\u7528\u548c\u7ad9\u70b9\u4e4b\u95f4\u9009\u62e9\u6027\u5730\u5206\u4eab\u97f3\u89c6\u9891\u6d41\u3002\u5728\u4e0d\u5b89\u88c5\u5176\u5b83\u5e94\u7528\u548c\u63d2\u4ef6\u7684\u60c5\u51b5\u4e0b\uff0c\u5b8c\u6210\u70b9\u5bf9\u70b9\u901a\u4fe1\u3002 WebRTC\u80cc\u540e\u7684\u6280\u672f\u88ab\u5b9e\u73b0\u4e3a\u4e00\u4e2a\u5f00\u653e\u7684Web\u6807\u51c6\uff0c\u5e76\u5728\u6240\u6709\u4e3b\u8981\u6d4f\u89c8\u5668\u4e2d\u5747\u4ee5\u5e38\u89c4JavaScript API\u7684\u5f62\u5f0f\u63d0\u4f9b\u3002\u5bf9\u4e8e\u5ba2\u6237\u7aef\uff08\u4f8b\u5982Android\u548ciOS\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528\u63d0\u4f9b\u76f8\u540c\u529f\u80fd\u7684\u5e93\u3002 WebRTC\u662f\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u5f97\u5230Google\uff0cApple\uff0cMicrosoft\u548cMozilla\u7b49\u7b49\u516c\u53f8\u7684\u652f\u6301\u30022011\u5e746\u67081\u65e5\u5f00\u6e90\u5e76\u5728Google\u3001Mozilla\u3001Opera\u652f\u6301\u4e0b\u88ab\u7eb3\u5165\u4e07\u7ef4\u7f51\u8054\u76df\u7684W3C\u63a8\u8350\u6807\u51c6\u3002</p> <p>WebRTC\u5305\u62ec\u4e00\u7cfb\u5217API\u548c\u76f8\u4e92\u5173\u8054\u7684\u534f\u8bae\u6765\u5b9e\u73b0\u901a\u4fe1\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/intro/concept-intro/#_2","title":"\u76f8\u5173\u6280\u672f","text":"","tags":["WebRTC"]},{"location":"webrtc/intro/concept-intro/#voip","title":"VoIP","text":"<p>Voice over Internet Protocol\uff0c\u5728\u7f51\u7edc\u4e0a\u4f20\u8f93\u58f0\u97f3\u6d88\u606f\u7684\u6280\u672f\u3002 \u4f8b\u5982\u7f51\u7edc\u97f3\u9891\u901a\u8bdd\u3002\u6216\u8005\u53eb\u505aIP\u7535\u8bdd\uff0c\u5bbd\u5e26\u7535\u8bdd\u3002\u4f7f\u7528VoIP\u6280\u672f\u7684\u4e00\u5927\u539f\u56e0\u662f\u8d39\u7528\u4f4e\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/intro/concept-intro/#_3","title":"\u76f8\u5173\u534f\u8bae","text":"","tags":["WebRTC"]},{"location":"webrtc/intro/concept-intro/#nat","title":"NAT","text":"<p>Network address translation\uff0c\u7f51\u7edc\u5730\u5740\u8f6c\u6362\u3002 NAT\u80fd\u7ed9\u4f60\u7684\u8bbe\u5907\u4e00\u4e2a\u516c\u5171IP\u5730\u5740\u3002\u4e00\u4e2a\u8def\u7531\u5668\uff08router\uff09\u6709\u4e00\u4e2a\u516c\u5171IP\u5730\u5740\uff0c\u6bcf\u4e2a\u8fde\u63a5\u5230\u8def\u7531\u7684\u8bbe\u5907\u6709\u4e00\u4e2a\u79c1\u6709\u7684IP\u5730\u5740\u3002 \u8bbe\u5907\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u4f1a\u4ece\u4e00\u4e2a\u7279\u5b9a\u7aef\u53e3\uff0c\u901a\u8fc7\u79c1\u6709IP\u53d1\u9001\u5230\u8def\u7531\u7684\u516c\u5171IP\u3002\u8fd9\u6837\u6bcf\u4e2a\u8bbe\u5907\u5728\u7f51\u4e0a\u4e0d\u9700\u8981\u90fd\u6709\u4e00\u4e2a\u516c\u5171IP\u5730\u5740\uff0c\u4f46\u4e5f\u80fd\u88ab\u5176\u5b83\u8bbe\u5907\u53d1\u73b0\u3002</p> <p>\u53c2\u8003 IP Network Address Translator (NAT) Terminology and Considerations</p>","tags":["WebRTC"]},{"location":"webrtc/intro/concept-intro/#ice","title":"ICE","text":"<p>Interactive Connectivity Establishment\uff0c\u4e92\u52a8\u5f0f\u8fde\u63a5\u5efa\u7acb\uff08\u4ea4\u4e92\u5f0f\u8fde\u901a\u6027\u5efa\u7acb\uff09\u3002 ICE\u662f\u4e00\u5957\u80fd\u8ba9web\u6d4f\u89c8\u5668\u4e4b\u95f4\u4e92\u76f8\u8fde\u63a5\u7684\u6846\u67b6\u3002\u901a\u5e38\u6765\u8bf4\uff0c\u8282\u70b9A\u5230B\u662f\u5f88\u96be\u76f4\u63a5\u76f8\u8fde\u7684\u3002\u9632\u706b\u5899\u4f1a\u963b\u6b62\u8fde\u63a5\uff0c\u8bbe\u5907\u6ca1\u6709\u516c\u5171IP\u5730\u5740\uff0c\u8def\u7531\u4e0d\u5141\u8bb8\u76f4\u63a5\u8fde\u63a5\u5176\u4ed6\u8282\u70b9\u3002 ICE\u4f7f\u7528STUN\u6216\u8005TURN\u670d\u52a1\uff08\u6216\u8005\u540c\u65f6\u4f7f\u7528\u4e24\u8005\uff09\u6765\u5efa\u7acb\u8fde\u63a5\u3002</p> <p>\u53c2\u8003 ICE | rfc8445</p>","tags":["WebRTC"]},{"location":"webrtc/intro/concept-intro/#stun","title":"STUN","text":"<p>Session Traversal Utilities for NAT (STUN) \uff0cNAT\u4f1a\u8bdd\u4f20\u8f93\u5de5\u5177\u3002 STUN\u534f\u8bae\u80fd\u53d1\u73b0\u5ba2\u6237\u7aef\uff08\u8282\u70b9\uff09\u7684\u516c\u5171\u5730\u5740\u3002\u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a\u8bf7\u6c42\u7ed9\u7f51\u4e0a\u7684STUN\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u8fd4\u56de\u5ba2\u6237\u7aef\u7684\u516c\u5171\u5730\u5740\u3002\u4e0d\u7ba1\u5ba2\u6237\u7aef\u5728\u8def\u7531\u5668\u7684NAT\u540e\u80fd\u5426\u53ef\u8fbe\u3002 STUN\u4e3a\u8bf7\u6c42\u8005\u63d0\u4f9b\u4e86\u53ef\u516c\u5f00\u8bbf\u95ee\u7684IP\u5730\u5740\uff0c\u5b83\u5c31\u4e0d\u518d\u53c2\u4e0e\u5bf9\u8bdd\u4e86\u3002</p> <p></p> <p>\u6709\u4e9b\u8def\u7531\u5668\u4f1a\u9650\u5236\u8bbe\u5907\u4e0e\u5916\u9762\u5176\u5b83\u8bbe\u5907\u7684\u8fde\u63a5\u3002\u8fd9\u610f\u5473\u7740\u5373\u4f7fSTUN\u670d\u52a1\u5668\u77e5\u9053\u4e86\u8def\u7531\u7684\u516c\u5171IP\u5730\u5740\uff0c\u4e5f\u6ca1\u6cd5\u5efa\u7acb\u8fde\u63a5\u3002 \u8fd9\u79cd\u60c5\u51b5\u4e0b\u6211\u4eec\u9700\u8981\u4f7f\u7528TURN\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/intro/concept-intro/#turn","title":"TURN","text":"<p>Traversal Using Relays around NAT\uff0c\u4f7f\u7528\u4e2d\u7ee7\u7ed5\u8fc7NAT\u4f20\u8f93\u3002 \u4e00\u4e9b\u8def\u7531\u5668\u4f7f\u7528\u4e00\u79cd\u53eb\u201cSymmetric NAT\u201d\uff08\u5bf9\u79f0\u578bNAT\uff09\u7684\u9650\u5236\u3002\u8fd9\u610f\u5473\u7740\u8def\u7531\u5668\u4ec5\u5141\u8bb8\u4e4b\u524d\u8fde\u63a5\u8fc7\u7684\u8282\u70b9\uff08peer\uff09\u6765\u5efa\u7acb\u8fde\u63a5\u3002</p> <p>STUN\u63d0\u4f9b\u4e86\u4e00\u4e2a\u80fd\u8ba9\u5e94\u7528\uff08\u7ec8\u7aef\uff0c\u8282\u70b9\uff09\u7a7f\u8fc7NAT\u7684\u65b9\u6cd5\u3002STUN\u5141\u8bb8\u5ba2\u6237\u7aef\u83b7\u5f97\u4e00\u4e2a\u4f20\u8f93\u5730\u5740\uff08\u4e00\u4e2aIP\u548c\u7aef\u53e3\uff09\u6765\u83b7\u53d6\u5176\u5b83\u8282\u70b9\u7684\u6570\u636e\u3002 \u7136\u800cSTUN\u83b7\u53d6\u5230\u7684\u5730\u5740\u4e0d\u4e00\u5b9a\u80fd\u88ab\u6240\u6709\u8282\u70b9\u4f7f\u7528\u3002\u8fd9\u4e9b\u5730\u5740\u662f\u5426\u53ef\u7528\u53d6\u51b3\u4e8e\u7f51\u7edc\u62d3\u6251\u7684\u60c5\u51b5\u3002\u6240\u4ee5\uff0c\u5355\u72ecSTUN\u65e0\u6cd5\u63d0\u4f9b\u5b8c\u6574\u7684\u7a7f\u8d8aNAT\u7684\u65b9\u6848\u3002</p> <p>TURN\u534f\u8bae\u5141\u8bb8\u4e24\u4e2a\u5904\u4e8eNAT\u73af\u5883\u7684\u4e3b\u673a\u5229\u7528\u4e2d\u7ee7\u8fdb\u884c\u901a\u8baf\u3002\u5ba2\u6237\u7aef\u80fd\u591f\u5728TURN\u670d\u52a1\u5668\u4e0a\u5206\u914d\u8d44\u6e90\uff0c\u4e0e\u5176\u5b83\u5ba2\u6237\u7aef\uff08peer\uff09\u8fdb\u884c\u901a\u8baf\u3002 \u5ba2\u6237\u7aef\u5173\u8054\u4e00\u4e2aTURN\u670d\u52a1\u5668\u7684\u5730\u5740\uff08relayed server address\uff09\u6765\u4f5c\u4e3a\u4e2d\u7ee7\u3002 \u5ba2\u6237\u7aef\u53d1\u9001\u62a5\u6587\u7ed9TURN\u670d\u52a1\uff0cTURN\u670d\u52a1\u4f7f\u7528relayed server address\u4f5c\u4e3a\u6e90\u5730\u5740\u5411\u5176\u4ed6\u5ba2\u6237\u7aef\u4e2d\u7ee7\u8f6c\u53d1\u62a5\u6587\u3002 \u7a7f\u8d8aNAT\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u50cf\u662f\u201c\u6253\u6d1e\u201d\u3002\u4e5f\u6709\u4eba\u79f0TURN\u670d\u52a1\u5668\u4e3a\u201c\u6253\u6d1e\u670d\u52a1\u5668\u201d\u3002</p> <p></p> <p>\u8fd9\u4e48\u770b\uff0cTURN\u670d\u52a1\u5668\u9700\u8981\u6709\u5927\u7684\u5e26\u5bbd\u3002\u56e0\u6b64\uff0cICE\u4f1a\u4f18\u5148\u8003\u8651\u76f4\u63a5\u901a\u8baf\uff0c\u65e0\u6cd5\u76f4\u63a5\u901a\u8baf\u60c5\u51b5\u4e0b\u4f1a\u4f7f\u7528TURN\u3002</p> <p>\u53c2\u8003 TURN rfc8656</p>","tags":["WebRTC"]},{"location":"webrtc/intro/concept-intro/#sdp","title":"SDP","text":"<p>Session Description Protocol\uff0c\u4f1a\u8bdd\u63cf\u8ff0\u534f\u8bae\u3002</p> <p>\u63cf\u8ff0\u591a\u5a92\u4f53\u8fde\u63a5\u5185\u5bb9\u7684\u534f\u8bae\u3002\u4f8b\u5982\u5206\u8fa8\u7387\uff0c\u683c\u5f0f\uff0c\u7f16\u7801\uff0c\u52a0\u5bc6\u7b97\u6cd5\u7b49\u7b49\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0cSDP\u4e0d\u662f\u4e2a\u771f\u6b63\u7684\u534f\u8bae\u3002\u5b83\u4e5f\u662f\u7528\u6765\u63cf\u8ff0\u8bbe\u5907\u4e4b\u95f4\u8fde\u63a5\u4e0e\u4f20\u8f93\u591a\u5a92\u4f53\u7684\u6570\u636e\u683c\u5f0f\u3002</p> <p>\u53c2\u8003 SDP: Session Description Protocol | rfc8866</p>","tags":["WebRTC"]},{"location":"webrtc/intro/concept-intro/#_4","title":"\u53c2\u8003","text":"<ul> <li>\u5a92\u4f53\u8bbe\u5907\u5165\u95e8 \uff5c webrtc.org</li> <li>2\u4e2a\u8282\u70b9\u5efa\u7acb\u8fde\u63a5\u65f6\u7684\u6c9f\u901a\u8fc7\u7a0b \uff5c MDN</li> <li>WebRTC \u534f\u8bae\u4ecb\u7ecd \uff5c developer.mozilla.org</li> <li>\u4fe1\u4ee4\u4e0e\u89c6\u9891\u901a\u8bdd \uff5c developer.mozilla.org</li> <li>WebRTC\u6982\u5ff5\u4ecb\u7ecd | rustfisher</li> </ul> \u4e00\u4e9b\u7f29\u5199 <ul> <li>ACK: Acknowledgment (\u786e\u8ba4\u62a5\u6587)</li> <li>AVP: Audio and Video profile (\u97f3\u9891\u89c6\u9891\u63cf\u8ff0)</li> <li>B-Frame: Bi-directional Predicted Frame. A partial picture, is a modification of previous and future pictures. - (\u53cc\u5411\u9884\u6d4b\u5e27\uff0c\u5b58\u50a8\u56fe\u7247\u7684\u90e8\u5206\u4fe1\u606f\uff0c\u5b58\u50a8\u7684\u662f\u76f8\u5bf9\u524d\u4e00\u5f20\u56fe\u7247\u548c\u540e\u4e00\u5f20\u56fe\u7247\u7684\u5dee\u5f02\u4fe1\u606f)</li> <li>DCEP: Data Channel Establishment Protocol defined in RFC 8832 (DataChannel\u5efa\u7acb\u534f\u8bae)</li> <li>DeMux: Demultiplexer (\u89e3\u590d\u7528\u5668)</li> <li>DLSR: delay since last sender report (\u4ece\u6700\u8fd1\u4e00\u4e2aSender Report\u5f00\u59cb\u7684\u65f6\u95f4\u5ef6\u8fdf)</li> <li>DTLS: Datagram Transport Layer Security defined in RFC 6347</li> <li>E2E: end-to-end</li> <li>FEC: Forward Error Correction (\u524d\u5411\u7ea0\u9519)</li> <li>FIR: Full INTRA-frame Request (\u5b8c\u6574I\u5e27\u8bf7\u6c42)</li> <li>G.711: A narrowband audio codec (\u4e00\u4e2a\u7a84\u5e26\u97f3\u9891\u7f16\u7801\u5668)</li> <li>H.264: Advanced video coding for generic audiovisual services (\u9762\u5411\u901a\u7528\u89c6\u542c\u670d\u52a1\u7684\u9ad8\u7ea7\u89c6\u9891\u7f16\u7801)</li> <li>H.265: Conformance specification for ITU-T H.265 high efficiency video coding. (ITU-T H.265\u9ad8\u6548\u89c6\u9891\u7f16\u7801\u7684\u4e00\u81f4\u6027\u89c4\u8303)</li> <li>HEVC: High Efficiency Video Coding (\u9ad8\u6548\u89c6\u9891\u7f16\u7801)</li> <li>HTTP: Hypertext Transfer Protocol (\u8d85\u6587\u672c\u4f20\u8f93\u534f\u8bae)</li> <li>HTTPS: HTTP Over TLS defined in RFC 2818 (\u57fa\u4e8eTLS\u7684HTTP)</li> <li>I-Frame: Intra-coded Frame. A complete picture, can be decoded without anything else. (\u5185\u90e8\u7f16\u7801\u5e27\uff0c\u4fdd\u5b58\u5b8c\u6574\u56fe\u7247\u4fe1\u606f\uff0c- \u81ea\u89e3\u7801\uff0c\u4e0d\u4f9d\u8d56\u5916\u90e8\u6570\u636e)</li> <li>ICE: Interactive Connectivity Establishment defined in RFC 8445 (\u4ea4\u4e92\u5f0f\u8fde\u63a5\u5efa\u7acb\u534f\u8bae)</li> <li>INIT: Initiate (\u521d\u59cb\u5316)</li> <li>IoT: Internet of Things (\u7269\u8054\u7f51)</li> <li>IPv4: Internet Protocol, Version 4 (\u7b2c\u56db\u4ee3\u56e0\u7279\u7f51\u534f\u8bae)</li> <li>IPv6: Internet Protocol, Version 6 (\u7b2c\u516d\u4ee3\u56e0\u7279\u7f51\u534f\u8bae)</li> <li>ITU-T: International Telecommunication Union Telecommunication Standardization Sector (\u56fd\u9645\u7535\u4fe1\u8054\u76df\u7535\u4fe1\u6807\u51c6\u5206\u5c40)</li> <li>JSEP: JavaScript Session Establishment Protocol defined in RFC 8829 (JavaScript\u4f1a\u8bdd\u5efa\u7acb\u534f\u8bae)</li> <li>MCU: Multi-point Conferencing Unit (\u591a\u70b9\u4f1a\u8bdd\u5355\u5143)</li> <li>mDNS: Multicast DNS defined in RFC 6762 (\u7ec4\u64ad DNS)</li> <li>MITM: Man-In-The-Middle</li> <li>MTU: Maximum Transmission Unit (\u6700\u5927\u4f20\u8f93\u5355\u5143)</li> <li>MUX: Multiplexing (\u590d\u7528\uff0c\u4e00\u822c\u6307\u628a\u4e0d\u540c\u683c\u5f0f\u7684\u6570\u636e\u5408\u5e76\u5b58\u50a8\u6216\u4f20\u8f93)</li> <li>NACK: Negative Acknowledgment (\u9006\u786e\u8ba4\u62a5\u6587\uff0cACK\u53cd\u9988\u6536\u5230\u62a5\u6587,NACK\u53cd\u9988\u672a\u6536\u5230\u62a5\u6587 )</li> <li>NAT: Network Address Translation defined in RFC 4787 (\u7f51\u7edc\u5730\u5740\u8f6c\u6362\uff0c\u57df\u540d\u5730\u5740\u8f6c\u6362\u6210IP\u5730\u5740)</li> <li>Opus: A totally open, royalty-free, highly versatile audio codec (\u4e00\u4e2a\u5b8c\u5168\u5f00\u653e\u3001\u514d\u7248\u7a0e\u3001\u9ad8\u5ea6\u901a\u7528\u7684\u97f3\u9891\u7f16\u89e3\u7801\u5668)</li> <li>P-Frame: Predicted Frame. A partial picture, containing only changes from the previous picture. (\u524d\u5411\u9884\u6d4b\u5e27\uff0c\u53ea\u4fdd\u5b58- \u76f8\u5bf9\u4e8e\u4e0a\u4e00\u5e27\u7684\u5dee\u5f02\u4fe1\u606f)</li> <li>P2P: peer-to-peer</li> <li>PLI: Picture Loss Indication (\u56fe\u7247\u4e22\u5931\u6307\u793a)</li> <li>PPID: Payload Protocol Identifier (Payload\u534f\u8bae\u6807\u8bc6)</li> <li>REMB: Receiver Estimated Maximum Bitrate (\u63a5\u6536\u7aef\u4f30\u8ba1\u7684\u6700\u5927\u6bd4\u7279\u7387)</li> <li>RFC: Request for Comments (\u5f81\u6c42\u610f\u89c1)</li> <li>RMCAT: RTP Media Congestion Avoidance Techniques (RTP\u5a92\u4f53\u62e5\u585e\u907f\u514d\u6280\u672f)</li> <li>RR: Receiver Report (RCTP\u63a5\u6536\u8005\u62a5\u544a)</li> <li>RTCP: RTP Control Protocol defined in RFC 3550 (RTP\u63a7\u5236\u534f\u8bae)</li> <li>RTP: Real-time transport protocol defined in RFC 3550 (\u5b9e\u65bd\u4f20\u8f93\u534f\u8bae)</li> <li>RTT: Round-trip time (\u5f80\u8fd4\u65f6\u95f4)</li> <li>SACK: Selective Acknowledgment (\u9009\u62e9\u6027\u786e\u8ba4)</li> <li>SCTP: Stream Control Transmission Protocol defined in RFC 4960 (\u6d41\u63a7\u4f20\u8f93\u534f\u8bae)</li> <li>SDP: Session Description Protocol defined in RFC 8866 (\u4f1a\u8bdd\u63cf\u8ff0\u534f\u8bae)</li> <li>SFU: Selective Forwarding Unit (\u9009\u62e9\u6027\u8f6c\u53d1\u5355\u5143)</li> <li>SR: Sender Report (RCTP\u53d1\u9001\u8005\u62a5\u544a)</li> <li>SRTP: Secure Real-time Transport Protocol defined in RFC 3711 (\u5b89\u5168\u7684RTP)</li> <li>SSRC: Synchronization Source (\u540c\u6b65\u6e90)</li> <li>STUN: Session Traversal Utilities for NAT defined in RFC 8489 (NAT\u4f1a\u8bdd\u7a7f\u900f)</li> <li>TCP: Transmission Control Protocol (\u4f20\u8f93\u63a7\u5236\u534f\u8bae)</li> <li>TLS: The Transport Layer Security defined in RFC 8446 (\u4f20\u8f93\u5c42\u5b89\u5168)</li> <li>TMMBN: Temporary Maximum Media Stream Bit Rate Notification (\u4e34\u65f6\u6700\u5927\u5a92\u4f53\u6d41\u6bd4\u7279\u7387\u901a\u77e5)</li> <li>TMMBR: Temporary Maximum Media Stream Bit Rate Request (\u4e34\u65f6\u6700\u5927\u5a92\u4f53\u6d41\u6bd4\u7279\u7387\u8bf7\u6c42)</li> <li>TSN: Transmission Sequence Number (\u4f20\u8f93\u5e8f\u5217\u53f7)</li> <li>TURN: Traversal Using Relays around NAT defined in RFC 8656 (\u57fa\u4e8e\u8f6c\u53d1\u7684NAT\u7a7f\u900f)</li> <li>TWCC: Transport Wide Congestion Control (\u4f20\u8f93\u62e5\u585e\u63a7\u5236)</li> <li>UDP: User Datagram Protocol (\u6570\u636e\u62a5\u534f\u8bae)</li> <li>VP8, VP9: Highly-efficient video compression technologies (video \u201ccodecs\u201d) developed by the WebM Project. - Anyone may use these codecs royalty-free. (WebM\u9879\u76ee\u5f00\u53d1\u7684\u9ad8\u6548\u89c6\u9891\u538b\u7f29\u6280\u672f(\u89c6\u9891\u7f16\u89e3\u7801)\uff0c\u5b8c\u5168\u514d\u8d39)</li> <li>WebM: An open media file format designed for the web. (\u4e00\u4e2a\u5f00\u653e\u7684Web\u5a92\u4f53\u6587\u4ef6\u683c\u5f0f)</li> <li>WebRTC: Web Real-Time Communications. W3C WebRTC 1.0: Real-Time Communication Between Browsers (Web\u5b9e\u65f6\u901a\u4fe1)</li> </ul> <p>WebRTC\u7cfb\u5217</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u77e5\u4e4e\u4e13\u680f \u7b80\u4e66 \u7a00\u571f\u6398\u91d1 \u4eca\u65e5\u5934\u6761 \u534e\u4e3a\u4e91\u793e\u533a csdn</p>","tags":["WebRTC"]},{"location":"webrtc/intro/sync-build/","title":"WebRTC\u4e0b\u8f7d\u4e0e\u7f16\u8bd1 Mac","text":"\u66f4\u65b0\u65e5\u671f: 2022-4-28 <ul> <li>2022-4-28 \u62a5\u9519\u8bb0\u5f55</li> <li>2022-4-24 \u7f16\u8bd1mac\u7248\u672c</li> <li>2022-4-18 \u589e\u52a0\u7f16\u8bd1\u8fc7\u7a0b</li> <li>2022-4-14 \u66f4\u65b0\u7248\u672c</li> <li>2022-4-13 \u521b\u5efa\u6587\u6863</li> </ul> <p>WebRTC\u80fd\u8ba9web\u5e94\u7528\u548c\u7ad9\u70b9\u4e4b\u95f4\u9009\u62e9\u6027\u5730\u5206\u4eab\u97f3\u89c6\u9891\u6d41\u3002\u5728\u4e0d\u5b89\u88c5\u5176\u5b83\u5e94\u7528\u548c\u63d2\u4ef6\u7684\u60c5\u51b5\u4e0b\uff0c\u5b8c\u6210\u70b9\u5bf9\u70b9\u901a\u4fe1\u3002 WebRTC\u80cc\u540e\u7684\u6280\u672f\u88ab\u5b9e\u73b0\u4e3a\u4e00\u4e2a\u5f00\u653e\u7684Web\u6807\u51c6\uff0c\u5e76\u5728\u6240\u6709\u4e3b\u8981\u6d4f\u89c8\u5668\u4e2d\u5747\u4ee5\u5e38\u89c4JavaScript API\u7684\u5f62\u5f0f\u63d0\u4f9b\u3002\u5bf9\u4e8e\u5ba2\u6237\u7aef\uff08\u4f8b\u5982Android\u548ciOS\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528\u63d0\u4f9b\u76f8\u540c\u529f\u80fd\u7684\u5e93\u3002 WebRTC\u662f\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u5f97\u5230Google\uff0cApple\uff0cMicrosoft\u548cMozilla\u7b49\u7b49\u516c\u53f8\u7684\u652f\u6301\u30022011\u5e746\u67081\u65e5\u5f00\u6e90\u5e76\u5728Google\u3001Mozilla\u3001Opera\u652f\u6301\u4e0b\u88ab\u7eb3\u5165\u4e07\u7ef4\u7f51\u8054\u76df\u7684W3C\u63a8\u8350\u6807\u51c6\u3002</p> <p>\u672c\u6587\u4ecb\u7ecd\u4e0b\u8f7d\u7f16\u8bd1WebRTC\u7684\u8fc7\u7a0b\u3002</p> <p>\u5f00\u53d1\u73af\u5883\uff1a</p> <ul> <li>macOS Big Sur 11.4</li> <li>Xcode 13.2.1</li> </ul>","tags":["WebRTC"]},{"location":"webrtc/intro/sync-build/#webrtc","title":"\u4e0b\u8f7dWebRTC","text":"<p>\u9996\u5148\u9700\u8981\u4e00\u4e2a\u826f\u597d\u7684\u7f51\u7edc\u73af\u5883\u3002\u6211\u4eec\u9700\u8981\u8fde\u63a5\u5230Google\uff0c\u4e00\u4e2a\u826f\u597d\u7a33\u5b9a\u7684\u7f51\u7edc\u73af\u5883\u80fd\u4e8b\u534a\u529f\u500d\u3002\u4e00\u65b9\u9762\u662f\u4e0b\u8f7d\u4ee3\u7801\uff0c\u53e6\u4e00\u65b9\u9762\u53ef\u80fd\u8981\u91cd\u88c5Xcode\u3002</p> <p>\u5176\u6b21\u78c1\u76d8\u4e0a\u7559\u51fa\u7ea625G\u7684\u7a7a\u95f4\u3002WebRTC\u4e0b\u8f7d\u5b8c\u6210\u540e\uff0c\u7ea6\u5360\u752816G\u3002\u7f16\u8bd1\u540e\u4f1a\u5360\u7528\u66f4\u591a\u7684\u7a7a\u95f4\uff0c\u5360\u7528\u8d85\u8fc720G\u3002</p> <p>\u4f7f\u7528\u7ec8\u7aef\uff0c\u521b\u5efa\u5e76\u8fdb\u5165\u76ee\u5f55 <code>~/ws/webrtc-proj</code></p>","tags":["WebRTC"]},{"location":"webrtc/intro/sync-build/#_1","title":"\u7f51\u7edc\u73af\u5883","text":"<p>\u51c6\u5907\u7f51\u7edc\u73af\u5883\u3002\u6253\u5f00\u5de5\u5177\uff0c\u7136\u540e\u914d\u7f6e\u7aef\u53e3\u3002\u7aef\u53e3\u56e0\u5de5\u5177\u800c\u5f02\u3002\u8bf7\u52a1\u5fc5\u4f7f\u7528\u4e00\u4e2a\u7a33\u5b9a\u7684\u5de5\u5177\u3002 <pre><code>export http_proxy=localhost:7890\nexport https_proxy=localhost:7890\n</code></pre></p> <p>\u5148\u6765\u51c6\u5907\u5de5\u5177depot_tools</p>","tags":["WebRTC"]},{"location":"webrtc/intro/sync-build/#depot_tools","title":"depot_tools","text":"<p>\u4ecegooglesource\u4e0b\u8f7ddepot_tools <pre><code>~/ws/webrtc-proj $ git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git\n</code></pre></p> <p>depot_tools\u5927\u7ea6\u5360\u7528500M\u7a7a\u95f4</p> <p>\u914d\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u6267\u884c <pre><code>~/ws/webrtc-proj $ export PATH=$(pwd)/depot_tools:$PATH\n</code></pre></p> <p>\u6216\u8005\u628a\u8def\u5f84\u6dfb\u52a0\u5230<code>.bashrc</code>\u91cc\u3002\u7136\u540e\u8981\u8bfb\u53d6\u4e00\u6b21\u914d\u7f6e\u6216\u8005\u65b0\u5efa\u7ec8\u7aef\u3002 <pre><code>export PATH=/Users/rustfisher/ws/webrtc/depot_tools:$PATH\n</code></pre></p> <p>\u8f93\u5165<code>ninja -h</code>\uff0c\u5982\u679c\u80fd\u6267\u884c\u8868\u660e\u73af\u5883\u53d8\u91cf\u8bbe\u7f6eOK <pre><code>ninja -h\nusage: ninja [options] [targets...]\n\nif targets are unspecified, builds the 'default' target (see manual).\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/intro/sync-build/#_2","title":"\u4e0b\u8f7d","text":"<p>depot_tools\u4e0b\u8f7d\u5e76\u4e14\u8bbe\u7f6e\u5b8c\u6bd5\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u4e0b\u8f7dWebRTC\u5de5\u7a0b\u3002\u9700\u8981\u7528\u5230fetch\u548cgclient\u547d\u4ee4\u3002</p> <p>\u9996\u5148\u65b0\u5efa\u4e00\u4e2a\u76ee\u5f55<code>webrtc</code>\uff0c\u8fdb\u5165\u8fd9\u4e2a\u76ee\u5f55 <pre><code>mkdir webrtc\ncd webrtc\n</code></pre></p> <p>\u7136\u540e\u83b7\u53d6\u4ee3\u7801\uff0c\u5f00\u59cb\u540c\u6b65 <pre><code>fetch --nohooks webrtc_ios\ngclient sync\n</code></pre></p> <p>\u5982\u679c\u7f51\u901f\u80fd\u8fbe\u523020M\uff0c2\u4e2a\u5c0f\u65f6\u5185\u4ee3\u7801\u53ef\u4ee5\u4e0b\u8f7d\u5b8c\u6210</p> <p>\u6211\u4eec\u9ed8\u8ba4\u4e0b\u8f7d\u7684\u662f\u6700\u65b0\u7684\u6e90\u7801\uff0c\u5982\u679c\u60f3\u8981\u5207\u6362\u5230\u6307\u5b9a\u5206\u652f\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a <pre><code># \u67e5\u770b\u53ef\u7528\u7248\u672c\u5206\u652f\ngit branch -r\n# \u5207\u6362\u5230main\u5206\u652f\ngit checkout origin/main\ngclient sync\n</code></pre></p> <p>\u6216\u8005\u5f3a\u5236\u5207\u6362\u5230\u6307\u5b9acommit <pre><code># \u6216\u8005\u5f3a\u5236\u5207\u6362\u5230\u6307\u5b9acommit\uff08b484ec0082948ae086c2ba4142b4d2bf8bc4dd4b\u662fm79\u6700\u540e\u4e00\u6b21\u63d0\u4ea4\u7684commit id\uff09\ngclient sync -r b484ec0082948ae086c2ba4142b4d2bf8bc4dd4b --force\n</code></pre></p> <p>\u4e0b\u8f7d\u5f97\u5230\u7684\u5de5\u7a0b\u5728<code>~/ws/webrtc-proj/webrtc/src</code></p> <p>\u5176\u4ed6\u955c\u50cf</p> <p>\u5982\u679c\u7528\u58f0\u7f51\u955c\u50cf\uff0c\u8fd8\u662fgitee\uff0cgitlab\u7684\u955c\u50cf\uff0c\u53ef\u80fd\u4f1a\u9047\u5230EOF\u4e4b\u7c7b\u7684\u95ee\u9898\u3002 \u5982\u679c\u6709\u826f\u597d\u7684\u4e0a\u7f51\u5de5\u5177\uff0c\u63a8\u8350\u8fd8\u662f\u4eceGoogle\u4e0b\u8f7d\u3002</p> <p>\u4f7f\u7528\u5176\u4ed6\u955c\u50cf\u65f6\uff0c\u9047\u5230\u8fc7\u5f88\u591a\u95ee\u9898\uff0c\u6bd4\u5982<code>remote error</code></p> remote error <pre><code>src/third_party/catapult (ERROR)\n----------------------------------------\n[0:00:39] Started.\n[0:00:39] Finished running: git config remote.origin.url\n[0:00:39] Finished running: git rev-list -n 1 HEAD\n[0:00:39] Finished running: git rev-parse --abbrev-ref=strict HEAD\nfatal: remote error: upload-pack: not our ref 5ff11ff500b8af289afe5f1f298bc0e4f7c454f4\n[0:00:46] fatal: remote error: upload-pack: not our ref 5ff11ff500b8af289afe5f1f298bc0e4f7c454f4\n[0:00:49] fatal: remote error: upload-pack: not our ref 5ff11ff500b8af289afe5f1f298bc0e4f7c454f4\n[0:00:54] fatal: remote error: upload-pack: not our ref 5ff11ff500b8af289afe5f1f298bc0e4f7c454f4\n----------------------------------------\nError: Command 'git -c core.deltaBaseCacheLimit=4g fetch origin 5ff11ff500b8af289afe5f1f298bc0e4f7c454f4 --no-tags' returned non-zero exit status 128 in /Users/rustfisher/Desktop/ws/webrtc-proj/webrtc/src/third_party/catapult\n</code></pre> <p>\u6216\u8005<code>usrsctp/usrsctplib</code>\u9047\u5230\u9519\u8bef</p> usrsctp/usrsctplib\u9047\u5230\u9519\u8bef <pre><code>Error: Command 'git -c core.deltaBaseCacheLimit=4g fetch origin 22ba62ffe79c3881581ab430368bf3764d9533eb --no-tags' returned non-zero exit status 128 in /Users/rustfisher/Desktop/ws/webrtc-proj/webrtc/src/third_party/usrsctp/usrsctplib\n</code></pre> <p>\u5f53\u65f6\u7684\u89e3\u51b3\u529e\u6cd5\u5c31\u662f\u4e0d\u65ad\u7684\u91cd\u65b0<code>gclient sync</code>\u3002\u4f46\u5e76\u4e0d\u80fd\u5b8c\u5168\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u7528\u4e00\u4e2a\u597d\u7684\u5de5\u5177\u53ef\u4ee5\u907f\u514d\u8fd9\u4e9b\u95ee\u9898\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/intro/sync-build/#_3","title":"\u7f16\u8bd1","text":"","tags":["WebRTC"]},{"location":"webrtc/intro/sync-build/#main","title":"main\u5206\u652f","text":"<p>\u7f16\u8bd1\u4e4b\u524d\uff0c\u5efa\u8bae\u5207\u6362\u5230main\u5206\u652f\u3002 <pre><code>$ git checkout remotes/origin/main\n\n$ git branch \n* \uff08\u5934\u6307\u9488\u5728 origin/main \u5206\u79bb\uff09\n  main\n\n$ gclient sync\n</code></pre></p> <p>Xcode\u76f8\u5f53\u4e8e\u6700\u65b0\u7248\u7684\uff0c\u6211\u4eec\u7684WebRTC\u4ee3\u7801\u4e5f\u9009\u62e9\u6bd4\u8f83\u65b0\u7684\u7248\u672c\u3002 \u5982\u679c\u9009\u62e9\u4ee5\u524d\u7684\u5206\u652f\uff0c\u4f1a\u51fa\u73b0\u5de5\u5177\u4e0e\u4ee3\u7801\u5bf9\u4e0d\u4e0a\u7684\u60c5\u51b5\uff0c\u4e0d\u505c\u7684\u62a5\u9519\u3002</p> \u7f16\u8bd1\u65e7\u5206\u652f\u62a5\u9519 <p>\u7f16\u8bd1\u65e7\u5206\u652f\u4e0d\u505c\u5730\u62a5\u9519 <code>ninja -C out/Default</code></p> <pre><code>../../third_party/llvm-build/Release+Asserts/bin/../include/c++/v1/math.h:769:12: error: no member named 'labs' in the global namespace; did you mean 'abs'?\nreturn ::labs(__x);\n        ~~^\n../../third_party/llvm-build/Release+Asserts/bin/../include/c++/v1/math.h:768:39: note: 'abs' declared here\ninline _LIBCPP_INLINE_VISIBILITY long abs(long __x) _NOEXCEPT {\n                                    ^\n../../third_party/llvm-build/Release+Asserts/bin/../include/c++/v1/math.h:773:12: error: no member named 'llabs' in the global namespace\nreturn ::llabs(__x);\n        ~~^\n../../third_party/llvm-build/Release+Asserts/bin/../include/c++/v1/math.h:781:12: error: no member named 'fabsf' in the global namespace\nreturn ::fabsf(__lcpp_x);\n</code></pre>","tags":["WebRTC"]},{"location":"webrtc/intro/sync-build/#ios","title":"\u7f16\u8bd1iOS\u7248\u672c","text":"<p>\u4f7f\u7528WebRTC\u63d0\u4f9b\u7684\u811a\u672c\u6765\u7f16\u8bd1</p> <pre><code>$ ./tools_webrtc/ios/build_ios_libs.sh\n</code></pre> <p>\u7f16\u8bd1\u7ed3\u679c\u5728<code>out_ios_libs</code>\u91cc</p>","tags":["WebRTC"]},{"location":"webrtc/intro/sync-build/#mac","title":"\u7f16\u8bd1mac\u7248\u672c","text":"<p>\u4f7f\u7528\u9ed8\u8ba4\u7684\u7f16\u8bd1\u65b9\u6cd5\u7f16\u8bd1mac\u7248\u672c</p> <pre><code>~/ws/webrtc-proj/webrtc/src $ gn gen out/Default\nDone. Made 1570 targets from 291 files in 1336ms\n\n~/ws/webrtc-proj/webrtc/src $ ninja -C out/Default\nninja: Entering directory `out/Default'\n</code></pre> <p>\u7f16\u8bd1\u5f97\u5230\u7684<code>Default</code>\u76ee\u5f55\u5360\u75287G\u4ee5\u4e0a\u7a7a\u95f4\u3002</p> <p>\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884cAppRTCMobile.app\u8d77\u6765\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/intro/sync-build/#_4","title":"\u53c2\u8003","text":"<ul> <li>Install Error - macOS Big Sur #904 - Github</li> <li>https://stackoverflow.com/questions/58628377/catalina-c-using-cmath-headers-yield-error-no-member-named-signbit-in-th</li> </ul>","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/","title":"Web\u524d\u7aefWebRTC\u653b\u7565-\u5a92\u4f53\u534f\u5546\u4e0eSDP\u7b80\u6790","text":"2022-4-27 \u4fee\u6539\u683c\u5f0f <ul> <li>2022-4-27 \u4fee\u6539\u683c\u5f0f</li> </ul> <p>\u539f\u6587\u4f5c\u8005\uff1a\u817e\u8bafIMWeb\u524d\u7aef\u56e2\u961f</p>","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/#1","title":"1. \u5a92\u4f53\u534f\u5546","text":"<p>\u5728\u97f3\u89c6\u9891\u901a\u8baf\u573a\u666f\u4e2d\uff0c\u7531\u4e8e\u4e24\u7aef\u4e4b\u95f4\u6240\u652f\u6301\u7684\u97f3\u89c6\u9891\u7f16\u89e3\u7801\u3001\u4f20\u8f93\u534f\u8bae\u3001\u4f20\u8f93\u7684\u901f\u7387\uff0c\u90fd\u9700\u8981\u8fdb\u884c\u5f7c\u6b64\u901a\u77e5\u5bf9\u65b9\u3002</p> <p></p> <p>\u6211\u4eec\u628a\u4e00\u4e2a 1 \u5bf9 1 \u7684\u97f3\u89c6\u9891\u901a\u8baf\uff0c\u6bd4\u55bb\u6210\u53cc\u65b9\u4e92\u9001\u5feb\u9012\u5305\u88f9\u7684\u8fc7\u7a0b\u3002</p> <p></p> <p>\u9996\u5148\u8fd9\u91cc\u6709\u5f88\u591a\u95ee\u9898\uff0c\u53cc\u65b9\u8981\u5f7c\u6b64\u544a\u77e5\u5bf9\u65b9\u540e\uff0c\u624d\u80fd\u5bc4\u9001\u5305\u88f9\u3002</p> <p>\u6bd4\u5982\uff1a</p> <ul> <li>\u6211\u4e0d\u77e5\u9053\u5305\u88f9\u8981\u5bc4\u7ed9\u8c01\uff1f\uff08\u6211\u8981\u548c\u8c01\u5efa\u7acb\u901a\u8baf\uff09</li> <li>\u5bf9\u65b9\u80fd\u5426\u4f7f\u7528\u6211\u7684\u5305\u88f9\uff1f\uff08\u6211\u7684\u5a92\u4f53\u683c\u5f0f\u5bf9\u65b9\u662f\u5426\u652f\u6301\uff09</li> <li>\u5bf9\u65b9\u5728\u54ea\u91cc\uff0c\u5730\u5740\u662f\u4ec0\u4e48\uff1f\uff08\u5bf9\u65b9\u6240\u5904\u7f51\u7edc\u7684\u4f4d\u7f6e\u5728\u54ea\uff09</li> <li>\u8d70\u90a3\u6761\u8def\u7ebf\u5bc4\u9001\u6700\u5feb\uff1f\uff08\u8d70\u54ea\u79cd\u7f51\u7edc\u4f20\u8f93\u6700\u6548\u7387\uff09</li> </ul> <p></p> <p>\u5b9e\u9645\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u8981\u6253\u7535\u8bdd\u4e92\u76f8\u544a\u8bc9\u5bf9\u65b9\u4e00\u4e9b\u4fe1\u606f\u3002\u800c\u5728\u97f3\u89c6\u9891\u901a\u8baf\u4e2d\uff0c\u4e5f\u9700\u8981\u8fd9\u4e2a\u201c\u6253\u7535\u8bdd\u201d\u6b65\u9aa4\uff0c\u5f62\u5f0f\u4e0a\u4e00\u822c\u662f\u901a\u8fc7\u5efa\u7acb\u201c\u4fe1\u4ee4\u901a\u9053\u201d\u6765\u4f20\u9001\u4fe1\u4ee4\u3002 \u5bf9\u4e8e Web \u524d\u7aef\u6765\u8bf4\u6700\u5e38\u89c1\u4ee5 WebSocket \u6765\u4f5c\u4e3a\u4fe1\u4ee4\u901a\u9053\uff0c\u901a\u8fc7\u5b83\u6765\u4ea4\u6362\u4fe1\u4ee4\u5e76\u8fdb\u884c\u534f\u5546\u3002\u771f\u6b63\u7684\u5a92\u4f53\u6570\u636e\uff0c\u5219\u662f\u901a\u8fc7 RTCPeerConnection \u8fdb\u884c\u4f20\u8f93\u3002</p> <p></p> <p>\u6bd4\u5982\u5305\u542b\u4ec0\u4e48\u5a92\u4f53\u6d41/\u8f68\uff0c\u6216\u8005\u662f\u6211\u7684\u7f16\u7801\u662f\u5426\u88ab\u5bf9\u65b9\u7684\u89e3\u7801\u5668\u6240\u652f\u6301\u7b49\u7b49\u8fd9\u4e9b\u95ee\u9898\uff0c\u5219\u901a\u8fc7 SDP \u4f5c\u4e3a\u8f7d\u4f53\u544a\u8bc9\u7ed9\u5bf9\u65b9\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/#11","title":"1.1 \u4ec0\u4e48\u662f\u5a92\u4f53\u534f\u5546\uff1f","text":"<p>\u5728\u6ca1\u6709\u5efa\u7acb WebRTC \u8fde\u63a5\u4f20\u8f93\u6570\u636e\u524d\uff0c\u9996\u5148\u9700\u8981\u8ba9\u672c\u5730\u7aef\u548c\u8fdc\u7aef\u786e\u8ba4\u5f7c\u6b64\u5171\u540c\u652f\u6301\u7684\u5a92\u4f53\u80fd\u529b\u3002\u5982\uff1a\u97f3\u89c6\u9891\u7f16\u89e3\u7801\u5668\u3001\u4f7f\u7528\u7684\u4f20\u8f93\u534f\u8bae\u3001IP \u7aef\u53e3\u548c\u4f20\u8f93\u901f\u7387\u7b49\u7b49\u3002\u800c\u8fd9\u4e9b\u4fe1\u606f\u9700\u8981\u901a\u8fc7\u524d\u6587\u6240\u8bf4\u7684 SDP \u6765\u4e92\u6362\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e4b\u4e3a\u5a92\u4f53\u534f\u5546\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/#12","title":"1.2 \u5a92\u4f53\u534f\u5546\u7684\u6d41\u7a0b","text":"<p>\u8fd9\u91cc\u4ee5\u5728\u4e24\u4e2a\u524d\u7aef\u6d4f\u89c8\u5668\u5efa\u7acb\u901a\u8baf\u6765\u8fdb\u884c\u8bf4\u660e\uff0c\u6211\u4eec\u6682\u4e14\u79f0\u201c\u53d1\u8d77\u7aef\u201d\u548c\u201c\u5e94\u7b54\u7aef\u201d\u3002</p> <p></p> <ol> <li>\u9996\u5148\u53cc\u65b9\u8fde\u63a5\u4fe1\u4ee4\u901a\u9053\uff0c\uff08\u4e00\u822c\u7531\u4e1a\u52a1\u51b3\u5b9a\u5982\u4f55\u5b9e\u73b0\uff09\uff0c\u5e76\u80fd\u4ea4\u6362\u4fe1\u4ee4\u3002</li> <li>\u53d1\u8d77\u7aef\u8c03\u7528 RTCPeerConnection.createOffer \u521b\u5efa\u4e00\u4e2aoffer\uff0c\u5e76\u8c03\u7528 setLocalDescription \u8bbe\u7f6e\u672c\u5730\u7684 SDP\u3002</li> <li>\u7136\u540e\u901a\u8fc7\u4fe1\u4ee4\u670d\u52a1\u5668 \u5c06\u542b\u6709 SDP \u7684 offer \u8bbe\u7f6e\u7ed9\u5e94\u7b54\u7aef\u3002</li> <li>\u5e94\u7b54\u7aef\u62ff\u5230\u6b64 offer \u4ee5\u540e\u8c03\u7528 setRemoteDescription \u5c06\u6b64 SDP \u4fe1\u606f\u4fdd\u5b58\u3002</li> <li>\u5e94\u7b54\u7aef\u8c03\u7528 RTCPeerConnection.createAnswer \u521b\u5efa\u4e00\u4e2a answer\uff0c\u5e76\u8c03\u7528 setLocalDescription \u8bbe\u7f6e\u672c\u5730\u7684 SDP\u3002</li> <li>\u901a\u8fc7\u4fe1\u4ee4\u670d\u52a1\u5668\u5c06\u542b\u6709 SDP \u7684 answer \u53d1\u9001\u7ed9\u53d1\u8d77\u7aef\u3002</li> <li>\u53d1\u8d77\u7aef\u8c03\u7528 setRemoteDescription \u5c06\u6b64 SDP \u4fe1\u606f\u4fdd\u5b58\u3002</li> </ol> <p>\u7b80\u5355\u6982\u62ec\u5c31\u662f\uff1a\u53d1\u8d77\u7aef\u548c\u5e94\u7b54\u7aef\u901a\u8fc7 creatOffer \u548c createAnswer \u521b\u5efa offer/answerSDP\uff0c\u7136\u540e\u901a\u8fc7\u4fe1\u4ee4\u670d\u52a1\u4e92\u6362\uff0c\u6700\u540e\u8c03\u7528 setLocalDescription/setRemoteDescription \u8fdb\u884c\u8bbe\u7f6e\u672c\u5730\u548c\u8fdc\u7aef\u7684 SDP \u4ee5\u5b8c\u6210\u534f\u5546\u3002</p> <p>\u5728\u53cc\u65b9\u90fd\u521b\u5efa RTCPeerConnection \u4e4b\u540e,\u5b83\u4eec\u5c31\u53ef\u4ee5\u5f00\u59cb\u8fdb\u884c\u5a92\u4f53\u534f\u5546\u4e86\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/#13","title":"1.3 \u5a92\u4f53\u534f\u5546\u7684\u524d\u7aef\u4ee3\u7801\u5b9e\u73b0","text":"","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/#131-offer","title":"1.3.1 \u547c\u53eb\u65b9\u521b\u5efa&amp;\u53d1\u9001 Offer","text":"<pre><code>//local\nvar pc_local = new RTCPeerConnection(otps1); \n\npc_local.createOffer((offer)=&gt;{    \n  pc_local.setLocalDescription(offer);  \n  singalChannel.send(offer)\n}, handleError);\n</code></pre>","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/#132-offer","title":"1.3.2 \u5e94\u7b54\u65b9\u6536\u5230 Offer","text":"<pre><code>//remote\nvar pc_remote = new RTCPeerConnection(otps2);\n\nsignalChannel.on('message', (message)=&gt;{  \n  if(message.type === 'offer'){    \n    pc_remote.setRemoteDescription(        \n        new RTCSessionDescription(message)\n    )\n  }\n})\n</code></pre>","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/#133-answer","title":"1.3.3 \u5e94\u7b54\u65b9\u521b\u5efa&amp;\u53d1\u9001 Answer","text":"<pre><code>//remote\npc_remote.createAnswer((answer)=&gt;{  \n  pc_remote.setLocalDescription(answer);  \n  singalChannel.send(answer);\n}, handleError );\n</code></pre>","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/#134-answer","title":"1.3.4 \u547c\u53eb\u65b9\u6536\u5230 Answer","text":"<pre><code>//local\nsignalChannel.on('message',(message)=&gt;{  \n  if(message.type==='answer'){    \n    pc_local.setRemoteDescription(        \n        new RTCSessionDescription(message)\n    )\n  }\n})\n</code></pre>","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/#2-sdp","title":"2 SDP","text":"","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/#21-sdp","title":"2.1 \u4ec0\u4e48\u662fSDP\uff1f","text":"<p>SDP \u5168\u79f0 SessionDescription Protocal\uff0c\u76f4\u8bd1\u5c31\u662f\u901a\u7528\u4f1a\u8bdd\u63cf\u8ff0\u534f\u8bae\u3002</p> <p>\u5149\u770b\u76f4\u9762\u610f\u601d\u53ef\u80fd\u4e0d\u592a\u597d\u7406\u89e3\uff0c\u5176\u5b9e\u5c31\u662f\u63cf\u8ff0\u53cc\u65b9\u7684\u4f1a\u8bdd\u4fe1\u606f\uff0c\u4ee5\u53ca\u5404\u7aef\u6240\u5177\u5907\u80fd\u529b\u7684\u901a\u7528\u534f\u8bae\u3002</p> <p>\u5728 WebRTC \u4e2d SDP \u6240\u63cf\u8ff0\u7684\u4fe1\u606f\u4e3b\u8981\u6709\uff1a</p> <ol> <li>\u5404\u7aef\u6240\u652f\u6301\u97f3\u89c6\u9891\u7f16\u89e3\u7801\u5668</li> <li>\u7f16\u89e3\u7801\u6240\u8bbe\u5b9a\u7684\u53c2\u6570</li> <li>\u6240\u4f7f\u7528\u7684\u7684\u4f20\u8f93\u534f\u8bae</li> <li>ICE \u8fde\u63a5\u5019\u9009\u9879\u7b49</li> </ol>","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/#22-sdp","title":"2.2 \u6807\u51c6SDP\u89c4\u8303","text":"<p>\u8981\u6ce8\u610f\u7684\u662f SDP \u5e76\u4e0d\u662f WebRTC \u72ec\u6709\u89c4\u8303\uff0c\u5173\u4e8e\u6807\u51c6\u7684 SDP \u89c4\u8303\u53ef\u4ee5\u67e5\u9605\uff1aIETFRFC4556\u89c4\u8303\u3002 \u6807\u51c6 SDP \u89c4\u8303\u4e3b\u8981\u5305\u62ec SDP \u63cf\u8ff0\u683c\u5f0f\u548c SDP \u7ed3\u6784\uff0c\u800c SDP \u7ed3\u6784\u7531\u4f1a\u8bdd\u63cf\u8ff0\u548c\u5a92\u4f53\u4fe1\u606f\u63cf\u8ff0\u4e24\u4e2a\u90e8\u5206\u7ec4\u6210\u3002</p> <p></p>","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/#23-sdp","title":"2.3 SDP\u7684\u683c\u5f0f","text":"<p>SDP \u662f\u7531\u591a\u4e2a = \u8fd9\u6837\u7684\u8868\u8fbe\u5f0f\u7ec4\u6210\u7684\u3002 <pre><code>v=0\no=- 7017624586836067756 2 IN IP4 127.0.0.1\ns=-\nt=0 0...\n</code></pre> <ul> <li>type \u53ea\u80fd\u4e3a\u4e00\u4e2a\u5b57\u7b26\uff0c\u4ee3\u8868\u5c5e\u6027\u3002</li> <li>value \u4e3a\u7ed3\u6784\u5316\u6587\u672c\uff0cUTF-8 \u7f16\u7801\uff0c\u4ee3\u8868\u5c5e\u6027\u503c\u3002</li> <li>= \u4e24\u8fb9\u4e0d\u80fd\u6709\u7a7a\u683c\u3002</li> </ul> <p>SDPLine \u6ca1\u6709\u7edf\u4e00\u7684 Schema \u63cf\u8ff0\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709\u4e00\u4e2a\u56fa\u5b9a\u7684\u89c4\u5219\u80fd\u89e3\u6790\u6240\u6709 Line\uff0cSDPGrammer \u53ea\u662f\u63cf\u8ff0\u4e86 SDP \u76f8\u5173\u7684\u5c5e\u6027\uff0c\u5177\u4f53\u6bcf\u4e2a\u5c5e\u6027\u7684\u8868\u8fbe\u9700\u8981\u6839\u636e\u5c5e\u6027\u5b9a\u4e49 IETFRFC4556\u3002 \u800c SDP \u7684\u7ed3\u6784\u6709\u4e00\u4e2a\u4f1a\u8bdd\u63cf\u8ff0\u548c\u96f6\u81f3\u591a\u4e2a\u5a92\u4f53\u4fe1\u606f\u63cf\u8ff0\u7ec4\u6210\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/#231","title":"2.3.1 \u4f1a\u8bdd\u63cf\u8ff0","text":"<p>\u5e38\u89c1\u5c5e\u6027\uff1a</p> <p>v=SDP \u534f\u8bae\u7248\u672c</p> <pre><code>  v=0\n</code></pre> <p>o=\u4f1a\u8bdd\u53d1\u8d77\u8005\u63cf\u8ff0</p> <pre><code>o=&lt;username&gt; &lt;sess-id&gt; &lt;sess-version&gt; &lt;nettype&gt; &lt;addrtype&gt; &lt;address&gt;\n</code></pre> <p>username\uff1a\u7528\u6237\u540d</p> <p>sess-id\uff1a\u4f1a\u8bddid\uff0c\u5728\u6574\u4e2a\u4f1a\u8bdd\u4e2d\u662f\u552f\u4e00\u7684\uff0c\u5efa\u8bae\u4f7f\u7528NTP\u65f6\u95f4\u6233\u3002</p> <p>sess-version\uff1a\u4f1a\u8bdd\u7248\u672c\uff0c\u6bcf\u6b21\u4f1a\u8bdd\u6570\u636e\u4fee\u6539\u540e\uff0c\u8be5\u7248\u672c\u503c\u4f1a\u9012\u589e\u3002</p> <p>nettype\uff1a\u7f51\u7edc\u7c7b\u578b\uff0c\u4e00\u822c\u4e3a\u201cIN\u201d\u3002</p> <p>addrtype\uff1a\u5730\u5740\u7c7b\u578b\uff0c\u4e00\u822c\u4e3aIP4\u3002</p> <p>address\uff1aIP\u5730\u5740\u3002</p> <p>s=\u4f1a\u8bdd\u540d <pre><code>  s=&lt;sessionname&gt;\n</code></pre> \u4e0d\u5173\u6ce8\u65f6\u53ef\u4e3a-</p> <p>t=\u4f1a\u8bdd\u6d3b\u52a8\u65f6\u95f4 <pre><code>  t=&lt;start-time&gt;&lt;stop-time&gt;\n</code></pre></p> <p>start-time\uff1a\u4f1a\u8bdd\u5f00\u59cb\u65f6\u95f4</p> <p>stop-time\uff1a\u7ed3\u675f\u65f6\u95f4</p> <p>\u5747\u4e3aNTP\u65f6\u95f4\uff0c\u5355\u4f4d\u662f\u79d2\uff0c\u5747\u4e3a0\u65f6\u8868\u793a\u6301\u4e45\u4f1a\u8bdd\u3002</p> <p>c=\u8fde\u63a5\u4fe1\u606f <pre><code>  c=&lt;nettype&gt;&lt;addrtype&gt;&lt;connection-address&gt;\n</code></pre></p> <p>nettype\uff1a\u7f51\u8def\u7c7b\u578b</p> <p>addrtype\uff1a\u5730\u5740\u7c7b\u578b</p> <p>connection-address\uff1a\u8fde\u63a5\u5730\u5740</p>","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/#232","title":"2.3.2 \u5a92\u4f53\u63cf\u8ff0","text":"<p>\u4f1a\u8bdd\u7ea7\u522b\u63cf\u8ff0\u5b8c\u6210\u540e\uff0c\u540e\u9762\u5c31\u662f\u96f6\u5230\u591a\u4e2a\u5a92\u4f53\u7ea7\u522b\u63cf\u8ff0\uff0c\u6bd4\u5982\uff1a</p> <p>\u5e38\u89c1\u5c5e\u6027\uff1a</p> <p>m=\u5a92\u4f53\u63cf\u8ff0 <pre><code>  m=&lt;media&gt;&lt;port&gt; &lt;transport&gt; &lt;fmt-list&gt;\n</code></pre></p> <p>media\uff1a\u5a92\u4f53\u7c7b\u578b\uff08audio / video\uff09</p> <p>port\uff1a\u7aef\u53e3\u53f7</p> <p>transport\uff1a\u4f20\u8f93\u534f\u8bae RTP/AVP\uff08RTP/SAVP\uff09\u6216 UDP</p> <p>fmt-list\uff1a\u5a92\u4f53\u683c\u5f0f\uff0c\u8868\u8ff0 RTP \u7684\u6570\u636e\u8d1f\u8f7d\u7c7b\u578b(PayloadType)\u7684\u5217\u8868\uff0c\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u3002\u5206\u522b\u4ee3\u8868\u97f3\u9891\u548c\u89c6\u9891\u7684\u7f16\u7801\u683c\u5f0f\uff0c\u540e\u9762\u4f1a\u8ddf\u7740 rtpmap\u3001rtcp-fb\u3001fmtp \u8fd9\u4e9b\u5c5e\u6027\u6765\u505a\u8fdb\u4e00\u6b65\u7684\u8be6\u7ec6\u7684\u63cf\u8ff0\u3002</p> <p>RTP\u7c7b\u578b\u53c2\u8003\uff1aRTPPayload</p> <p>a=\u9644\u52a0\u63cf\u8ff0 \u6709\u4ee5\u4e0b\u4e24\u79cd\u683c\u5f0f\uff1a</p> <p>a= <p>a=: <p>SDP \u89e3\u6790\u65f6\uff0c\u6bcf\u4e2a SDPLine \u90fd\u662f\u4ee5 key=... \u5f62\u5f0f\uff0c\u89e3\u6790\u51fa key \u662f a \u540e\uff0c\u53ef\u80fd\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u53ef\u53c2\u8003 RFC4566\uff1a</p> <p>\u5728 m= \u4e4b\u524d\uff0c\u4e3a\u4f1a\u8bdd\u9644\u52a0\u63cf\u8ff0\uff1b</p> <p>\u5728 m= \u4e4b\u540e\uff0c\u4e3a\u5a92\u4f53\u9644\u52a0\u63cf\u8ff0\u3002</p> <p>\u5176\u4e2d\u53ef\u4ee5\u5173\u6ce8 rtpmap \u548c fmtp\u3002</p> <p>a=rtpmap RTP\u53c2\u6570\u6620\u5c04\u8868 <pre><code>a=rtpmap:&lt;playload-type&gt;&lt;encoding-name&gt;/&lt;sample-rate&gt;/&lt;encodingparameters\u53ef\u9009&gt;\n</code></pre></p> <p>playload-type\uff1a\u6570\u636e\u8d1f\u8f7d\u7c7b\u578b</p> <p>encoding-name\uff1a\u7f16\u7801\u540d\u79f0</p> <p>sample-rate\uff1a\u91c7\u6837\u7387</p> <p>encodingparameters\uff1a\u7f16\u7801\u53c2\u6570</p> <p>a=fmtp \u683c\u5f0f\u53c2\u6570 <pre><code>  a=fmtp:&lt;playload-type&gt;&lt;specific-parameters&gt;\n</code></pre></p> <p>playload-type\uff1a\u6570\u636e\u8d1f\u8f7d\u7c7b\u578b</p> <p>specific-parameters\uff1a\u7f16\u7801\u53c2\u6570</p>","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/#24-sdp","title":"2.4 SDP\u5256\u6790\u7684\u793a\u4f8b\u7ed3\u6784\u4e0e\u8bf4\u660e","text":"<p>https://webrtchacks.com/sdp-anatomy/ \u8fd9\u4e2a\u7ad9\u70b9\u7ed9\u6211\u4eec\u5c55\u793a\u4e86\u4e00\u4e2a\u8be6\u7ec6\u7684 SDP \u4f8b\u5b50\u3002\u5de6\u4fa7\u4e3a SDP \u6587\u672c\uff0c\u53ef\u4ee5\u660e\u663e\u770b\u51fa SDP \u7684\u683c\u5f0f\u4e0e\u7ed3\u6784\uff0c\u53f3\u4fa7\u5219\u5bf9\u6bcf\u4e00\u884c\u63cf\u8ff0\u8fdb\u884c\u4e86\u8bf4\u660e\u3002\u5982\u679c\u4f60\u4e0d\u60f3\u770b\u5197\u957f\u7684\u89c4\u8303\u6587\u6863\uff0c\u8fd9\u4e2a\u4f8b\u5b50\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u5b66\u4e60\u6750\u6599\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/#25-webrtc-sdp","title":"2.5 WebRTC \u7684 SDP \u603b\u7ed3","text":"<p>\u5728 WebRTC \u4e2d\u7684 SDP \u76f8\u5bf9\u4e8e\u6807\u51c6 SDP \u89c4\u8303\u4e2d\u6709\u70b9\u4e0d\u4e00\u6837\uff0c\u5b83\u5bf9\u4e8e SDP \u5212\u5206\u4e86\u66f4\u591a\u90e8\u5206\uff0c\u8be6\u60c5\u53ef\u4ee5\u770b\u4e0b\u56fe\uff1a </p> <p>WebRTC \u6309\u529f\u80fd\u5c06 SDP \u5212\u5206\u6210\u4e86\u4e94\u90e8\u5206\uff0c\u5373\u4f1a\u8bdd\u5143\u6570\u636e\u3001\u7f51\u7edc\u63cf\u8ff0\u3001\u6d41\u63cf\u8ff0\u3001\u5b89\u5168\u63cf\u8ff0\u4ee5\u53ca\u670d\u52a1\u8d28\u91cf\u63cf\u8ff0\u3002WebRTCSDP \u4e2d\u7684\u4f1a\u8bdd\u5143\u6570\u636e\uff08SessionMetadata\uff09\u5176\u5b9e\u5c31\u662f SDP \u6807\u51c6\u89c4\u8303\u4e2d\u7684\u4f1a\u8bdd\u5c42\u63cf\u8ff0\uff1b\u6d41\u63cf\u8ff0\u3001\u7f51\u7edc\u63cf\u8ff0\u4e0e SDP \u6807\u51c6\u89c4\u8303\u4e2d\u7684\u5a92\u4f53\u5c42\u63cf\u8ff0\u662f\u4e00\u81f4\u7684\uff1b\u800c\u5b89\u5168\u63cf\u8ff0\u4e0e\u670d\u52a1\u8d28\u91cf\u63cf\u8ff0\u90fd\u662f\u65b0\u589e\u7684\u4e00\u4e9b\u5c5e\u6027\u63cf\u8ff0\u3002SDP \u4f5c\u4e3a WebRTC \u7684\u6838\u5fc3\u90e8\u5206\uff0c\u662f\u4f60\u6df1\u5165\u5b66\u4e60 WebRTC \u524d\u6240\u8981\u5fc5\u987b\u638c\u63e1\u7684\u57fa\u7840\u5185\u5bb9\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/media/media-consultation-sdp-intro/#3","title":"3 \u53c2\u8003\u6587\u7ae0","text":"<ul> <li>SDP: Session Description Protocol</li> <li>https://webrtchacks.com/ </li> </ul>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/change-codec/","title":"WebRTC\u672c\u5730\u9009\u62e9codec","text":"\u66f4\u65b0\u65e5\u671f: 2022-1-13 <ul> <li>2021-1-13 \u521b\u5efa\u6587\u6863</li> </ul> <p>codec\uff1a\u7f16\u7801\u8bd1\u7801\u5668\uff0c\u7f16\u89e3\u7801\u5668\u3002\u5b83\u662f\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u4e5f\u53ef\u4ee5\u662f\u7b97\u6cd5\uff0c\u6216\u8005\u8bbe\u5907\uff0c\u7528\u4e8e\u7f16\u7801\uff08encode\uff09\u548c\u89e3\u7801\uff08decode\uff09\u6570\u636e\u6d41\u3002</p> <p>WebRTC\u80fd\u8ba9\u4e24\u4e2aweb\u6216\u8005app\u4e4b\u95f4\u5efa\u7acb\u97f3\u89c6\u9891\u901a\u4fe1\u3002\u901a\u4fe1\u8fc7\u7a0b\u4e2d\uff0c\u6570\u636e\u6d41\u7684\u683c\u5f0f\u5fc5\u987b\u88ab\u4e24\u8fb9\u7684\u8bbe\u5907\u652f\u6301\u3002</p> <p>WebRTC\u63d0\u4f9b\u4e86\u63a5\u53e3\u67e5\u8be2\u652f\u6301\u7684codec\uff0c\u5e76\u4e14\u53ef\u4ee5\u8bbe\u7f6e\u8981\u4f7f\u7528\u7684codec\u3002\u672c\u6587\u6f14\u793a\u9009\u62e9\u89c6\u9891codec\u7684\u8fc7\u7a0b\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/change-codec/#_1","title":"\u793a\u4f8b","text":"<p>\u7528\u6237\u53ef\u4ee5\u5728\u53d1\u9001\u89c6\u9891\u6d41\u4e4b\u524d\u9009\u62e9codec\u3002\u628a\u652f\u6301\u7684codec\u7c7b\u578b\u5217\u51fa\u6765\uff0c\u7528\u6237\u81ea\u884c\u9009\u62e9\u3002</p> <p></p> <p>\u5f00\u542f\u89c6\u9891\u540e\uff0c\u5efa\u7acb\u8fde\u63a5\u524d\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u8bbe\u7f6ecodec\u3002\u5982\u4e0a\u56fe\u84dd\u8272\u533a\u57df\u6240\u793a\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/change-codec/#html","title":"html","text":"<p>\u5148\u6765\u51c6\u5907\u9875\u9762\u30022\u4e2avideo\u63a7\u4ef6\u5206\u522b\u663e\u793a\u6536\u53d1\u89c6\u9891\u3002 \u6309\u94ae\u5206\u522b\u63a7\u5236\u5f00\u59cb\uff0c\u547c\u53eb\uff08\u53d1\u8d77\u8fde\u63a5\uff09\u548c\u6302\u65ad\u3002</p> <p><code>select</code>\u7528\u6765\u9009\u62e9codec\u3002\u83b7\u53d6\u652f\u6301\u7684codec\u4fe1\u606f\uff0c\u653e\u5230\u4e0b\u62c9\u680f\u91cc\u8ba9\u7528\u6237\u9009\u62e9\u3002</p> <p>\u4ee5\u4e0b\u662findex.html\u4e3b\u8981\u5185\u5bb9 <pre><code>&lt;div id=\"container\"&gt;\n    &lt;h1&gt;&lt;a href=\"https://an.rustfisher.com/webrtc/peerconnection/change-codec/\" title=\"WebRTC\u793a\u4f8b\uff0c\u4fee\u6539codec\"&gt;WebRTC\u793a\u4f8b\uff0c\u4fee\u6539codec&lt;/a&gt;\n    &lt;/h1&gt;\n\n    &lt;video id=\"localVideo\" playsinline autoplay muted&gt;&lt;/video&gt;\n    &lt;video id=\"remoteVideo\" playsinline autoplay&gt;&lt;/video&gt;\n\n    &lt;div class=\"box\"&gt;\n        &lt;button id=\"startBtn\"&gt;\u5f00\u59cb&lt;/button&gt;\n        &lt;button id=\"callBtn\"&gt;\u547c\u53eb&lt;/button&gt;\n        &lt;button id=\"hangupBtn\"&gt;\u6302\u65ad&lt;/button&gt;\n    &lt;/div&gt;\n\n    &lt;div class=\"box\"&gt;\n        &lt;span&gt;\u9009\u62e9Codec:&lt;/span&gt;\n        &lt;select id=\"codecPreferences\" disabled&gt;\n            &lt;option selected value=\"\"&gt;Default&lt;/option&gt;\n        &lt;/select&gt;\n        &lt;div id=\"actualCodec\"&gt;&lt;/div&gt;\n    &lt;/div&gt;\n    &lt;p&gt;\u53ef\u4ee5\u5728\u63a7\u5236\u53f0\u89c2\u5bdf &lt;code&gt;MediaStream&lt;/code&gt;\uff0c &lt;code&gt;localStream&lt;/code&gt;\uff0c \u548c &lt;code&gt;RTCPeerConnection&lt;/code&gt;&lt;/p&gt;\n&lt;/div&gt;\n\n&lt;script src=\"../../src/js/adapter-2021.js\"&gt;&lt;/script&gt;\n&lt;script src=\"js/main.js\" async&gt;&lt;/script&gt;\n</code></pre></p> <p>adapter-2021.js\u662f\u5b58\u653e\u5728\u672c\u5730\u7684\u6587\u4ef6\u3002\u8981\u4f7f\u7528\u6700\u65b0\u7684adapter\uff0c\u6309\u4ee5\u4e0b\u5730\u5740\u5f15\u5165 <pre><code>&lt;script src=\"https://webrtc.github.io/adapter/adapter-latest.js\"&gt;&lt;/script&gt;\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/change-codec/#js","title":"js","text":"<p>main.js\u63a7\u5236\u4e3b\u8981\u903b\u8f91\u3002\u4ece\u5f00\u542f\u6444\u50cf\u5934\u5f00\u59cb\u3002\u5efa\u7acb\u8fde\u63a5\u524d\u53ef\u4ee5\u9009\u62e9codec\u3002</p> <p>\u5efa\u7acb\u8fde\u63a5\u7684\u6d41\u7a0b\u4e0e\u300cWebRTC\u6a21\u62df\u4f20\u8f93\u89c6\u9891\u6d41\uff0cvideo\u901a\u8fc7\u672c\u5730\u8282\u70b9peer\u4f20\u8f93\u89c6\u9891\u6d41\u300d\u7c7b\u4f3c\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/change-codec/#codec","title":"\u83b7\u53d6\u53ef\u7528codec","text":"<p>\u5148\u5224\u65ad\u6d4f\u89c8\u5668\u662f\u5426\u6709<code>RTCRtpTransceiver</code>\uff0c\u5e76\u4e14\u8981\u80fd\u652f\u6301<code>setCodecPreferences</code>\u65b9\u6cd5 <pre><code>const supportsSetCodecPreferences = window.RTCRtpTransceiver &amp;&amp;\n  'setCodecPreferences' in window.RTCRtpTransceiver.prototype;\n</code></pre></p> <p>\u901a\u8fc7<code>RTCRtpSender.getCapabilities('video')</code>\u83b7\u53d6\u53ef\u652f\u6301\u7684codec\u3002 \u7136\u540e\u628a\u5b83\u4eec\u653e\u8fdb\u5217\u8868<code>codecPreferences</code>\u91cc <pre><code>  if (supportsSetCodecPreferences) {\n    const { codecs } = RTCRtpSender.getCapabilities('video');\n\n    codecs.forEach(codec =&gt; {\n      if (['video/red', 'video/ulpfec', 'video/rtx'].includes(codec.mimeType)) {\n        return;\n      }\n      const option = document.createElement('option');\n      option.value = (codec.mimeType + ' ' + (codec.sdpFmtpLine || '')).trim();\n      option.innerText = option.value;\n      codecPreferences.appendChild(option);\n    });\n    codecPreferences.disabled = false;\n  }\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/change-codec/#codec_1","title":"\u914d\u7f6ecodec","text":"<p>\u547c\u53eb\u4e4b\u524d\uff0c\u627e\u5230\u7528\u6237\u9009\u62e9\u7684codec\u3002 \u8c03\u7528<code>transceiver.setCodecPreferences(codecs)</code>\uff0c\u628a\u9009\u4e2d\u7684codec\u4ea4\u7ed9<code>transceiver</code>\u3002 <pre><code>  if (supportsSetCodecPreferences) {\n    // \u83b7\u53d6\u9009\u62e9\u7684codec\n    const preferredCodec = codecPreferences.options[codecPreferences.selectedIndex];\n    if (preferredCodec.value !== '') {\n      const [mimeType, sdpFmtpLine] = preferredCodec.value.split(' ');\n      const { codecs } = RTCRtpSender.getCapabilities('video');\n      const selectedCodecIndex = codecs.findIndex(c =&gt; c.mimeType === mimeType &amp;&amp; c.sdpFmtpLine === sdpFmtpLine);\n      const selectedCodec = codecs[selectedCodecIndex];\n      codecs.splice(selectedCodecIndex, 1);\n      codecs.unshift(selectedCodec);\n      console.log(codecs);\n      const transceiver = pc1.getTransceivers().find(t =&gt; t.sender &amp;&amp; t.sender.track === localStream.getVideoTracks()[0]);\n      transceiver.setCodecPreferences(codecs);\n      console.log('\u9009\u62e9\u7684codec', selectedCodec);\n    }\n  }\n</code></pre></p> <p>main.js\u5b8c\u6574\u4ee3\u7801\u5982\u4e0b <pre><code>'use strict';\n\nconsole.log('WebRTC\u793a\u4f8b\uff0c\u9009\u62e9codec');\n\n// --------- ui\u51c6\u5907 ---------\nconst startBtn = document.getElementById('startBtn');\nconst callBtn = document.getElementById('callBtn');\nconst hangupBtn = document.getElementById('hangupBtn');\nconst localVideo = document.getElementById('localVideo');\nconst remoteVideo = document.getElementById('remoteVideo');\n\ncallBtn.disabled = true;\nhangupBtn.disabled = true;\nstartBtn.addEventListener('click', start);\ncallBtn.addEventListener('click', call);\nhangupBtn.addEventListener('click', hangup);\n// ---------------------------\n\n// -------- codec \u7684\u914d\u7f6e --------\nconst codecPreferences = document.querySelector('#codecPreferences');\nconst supportsSetCodecPreferences = window.RTCRtpTransceiver &amp;&amp;\n  'setCodecPreferences' in window.RTCRtpTransceiver.prototype;\n// -----------------------------\n\nlet startTime;\n\nremoteVideo.addEventListener('resize', () =&gt; {\n  console.log(`Remote video size changed to ${remoteVideo.videoWidth}x${remoteVideo.videoHeight}`);\n  if (startTime) {\n    const elapsedTime = window.performance.now() - startTime;\n    console.log('\u89c6\u9891\u6d41\u8fde\u63a5\u8017\u65f6: ' + elapsedTime.toFixed(3) + 'ms');\n    startTime = null;\n  }\n});\n\nlet localStream;\nlet pc1;\nlet pc2;\nconst offerOptions = {\n  offerToReceiveAudio: 1,\n  offerToReceiveVideo: 1\n};\n\nfunction getName(pc) {\n  return (pc === pc1) ? 'pc1' : 'pc2';\n}\n\nfunction getOtherPc(pc) {\n  return (pc === pc1) ? pc2 : pc1;\n}\n\n// \u542f\u52a8\u672c\u5730\u89c6\u9891\nasync function start() {\n  console.log('\u542f\u52a8\u672c\u5730\u89c6\u9891');\n  startBtn.disabled = true;\n  try {\n    const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: true });\n    console.log('\u83b7\u53d6\u5230\u672c\u5730\u89c6\u9891');\n    localVideo.srcObject = stream;\n    localStream = stream;\n    callBtn.disabled = false;\n  } catch (e) {\n    alert(`getUserMedia() error: ${e.name}`);\n  }\n  if (supportsSetCodecPreferences) {\n    const { codecs } = RTCRtpSender.getCapabilities('video');\n    console.log('RTCRtpSender.getCapabilities(video):\\n', codecs);\n    codecs.forEach(codec =&gt; {\n      if (['video/red', 'video/ulpfec', 'video/rtx'].includes(codec.mimeType)) {\n        return;\n      }\n      const option = document.createElement('option');\n      option.value = (codec.mimeType + ' ' + (codec.sdpFmtpLine || '')).trim();\n      option.innerText = option.value;\n      codecPreferences.appendChild(option);\n    });\n    codecPreferences.disabled = false;\n  } else {\n    console.warn('\u5f53\u524d\u4e0d\u652f\u6301\u66f4\u6362codec');\n  }\n}\n\n// \u547c\u53eb\u5e76\u5efa\u7acb\u8fde\u63a5\nasync function call() {\n  callBtn.disabled = true;\n  hangupBtn.disabled = false;\n  console.log('\u5f00\u59cb\u547c\u53eb');\n  startTime = window.performance.now();\n  const videoTracks = localStream.getVideoTracks();\n  const audioTracks = localStream.getAudioTracks();\n  if (videoTracks.length &gt; 0) {\n    console.log(`\u4f7f\u7528\u7684\u6444\u50cf\u5934: ${videoTracks[0].label}`);\n  }\n  if (audioTracks.length &gt; 0) {\n    console.log(`\u4f7f\u7528\u7684\u9ea6\u514b\u98ce: ${audioTracks[0].label}`);\n  }\n  const configuration = {};\n  pc1 = new RTCPeerConnection(configuration);\n  pc1.addEventListener('icecandidate', e =&gt; onIceCandidate(pc1, e));\n  pc2 = new RTCPeerConnection(configuration);\n  pc2.addEventListener('icecandidate', e =&gt; onIceCandidate(pc2, e));\n  pc2.addEventListener('track', gotRemoteStream);\n\n  localStream.getTracks().forEach(track =&gt; pc1.addTrack(track, localStream));\n  if (supportsSetCodecPreferences) {\n    // \u83b7\u53d6\u9009\u62e9\u7684codec\n    const preferredCodec = codecPreferences.options[codecPreferences.selectedIndex];\n    if (preferredCodec.value !== '') {\n      const [mimeType, sdpFmtpLine] = preferredCodec.value.split(' ');\n      const { codecs } = RTCRtpSender.getCapabilities('video');\n      const selectedCodecIndex = codecs.findIndex(c =&gt; c.mimeType === mimeType &amp;&amp; c.sdpFmtpLine === sdpFmtpLine);\n      const selectedCodec = codecs[selectedCodecIndex];\n      codecs.splice(selectedCodecIndex, 1);\n      codecs.unshift(selectedCodec);\n      console.log(codecs);\n      const transceiver = pc1.getTransceivers().find(t =&gt; t.sender &amp;&amp; t.sender.track === localStream.getVideoTracks()[0]);\n      transceiver.setCodecPreferences(codecs);\n      console.log('\u9009\u62e9\u7684codec', selectedCodec);\n    }\n  }\n  codecPreferences.disabled = true;\n\n  try {\n    const offer = await pc1.createOffer(offerOptions);\n    await onCreateOfferSuccess(offer);\n  } catch (e) {\n    console.log(`Failed, pc1 createOffer: ${e.toString()}`);\n  }\n}\n\nasync function onCreateOfferSuccess(desc) {\n  try {\n    await pc1.setLocalDescription(desc);\n    console.log('pc1 setLocalDescription \u6210\u529f');\n  } catch (e) {\n    console.error('pc1 setLocalDescription \u51fa\u9519', e);\n  }\n  try {\n    await pc2.setRemoteDescription(desc);\n    console.log('pc2 setRemoteDescription ok');\n  } catch (e) {\n    console.error('pc2 setRemoteDescription fail', e);\n  }\n  try {\n    const answer = await pc2.createAnswer();\n    await onCreateAnswerSuccess(answer);\n  } catch (e) {\n    console.log(`pc2 create answer fail: ${e.toString()}`);\n  }\n}\n\nfunction gotRemoteStream(e) {\n  if (remoteVideo.srcObject !== e.streams[0]) {\n    remoteVideo.srcObject = e.streams[0];\n    console.log('pc2 received remote stream');\n  }\n}\n\n// \u5e94\u7b54\uff08\u63a5\u6536\uff09\u6210\u529f\nasync function onCreateAnswerSuccess(desc) {\n  console.log(`Answer from pc2:\\n${desc.sdp}`);\n  console.log('pc2 setLocalDescription start');\n  try {\n    await pc2.setLocalDescription(desc);\n  } catch (e) {\n    console.error('pc2 set local d fail', e);\n  }\n  console.log('pc1 setRemoteDescription start');\n  try {\n    await pc1.setRemoteDescription(desc);\n\n    // Display the video codec that is actually used.\n    setTimeout(async () =&gt; {\n      const stats = await pc1.getStats();\n      stats.forEach(stat =&gt; {\n        if (!(stat.type === 'outbound-rtp' &amp;&amp; stat.kind === 'video')) {\n          return;\n        }\n        const codec = stats.get(stat.codecId);\n        document.getElementById('actualCodec').innerText = 'Using ' + codec.mimeType +\n          ' ' + (codec.sdpFmtpLine ? codec.sdpFmtpLine + ' ' : '') +\n          ', payloadType=' + codec.payloadType + '. Encoder: ' + stat.encoderImplementation;\n      });\n    }, 1000);\n  } catch (e) {\n    console.error(e);\n  }\n}\n\nasync function onIceCandidate(pc, event) {\n  try {\n    await (getOtherPc(pc).addIceCandidate(event.candidate));\n    onAddIceCandidateSuccess(pc);\n  } catch (e) {\n    onAddIceCandidateError(pc, e);\n  }\n  console.log(`${getName(pc)} ICE candidate:\\n${event.candidate ? event.candidate.candidate : '(null)'}`);\n}\n\nfunction onAddIceCandidateSuccess(pc) {\n  console.log(`${getName(pc)} addIceCandidate success`);\n}\n\nfunction onAddIceCandidateError(pc, error) {\n  console.log(`${getName(pc)} failed to add ICE Candidate: ${error.toString()}`);\n}\n\nlocalVideo.addEventListener('loadedmetadata', function () {\n  console.log(`Local video videoWidth: ${this.videoWidth}px,  videoHeight: ${this.videoHeight}px`);\n});\n\nremoteVideo.addEventListener('loadedmetadata', function () {\n  console.log(`Remote video videoWidth: ${this.videoWidth}px,  videoHeight: ${this.videoHeight}px`);\n});\n\n// \u6302\u65ad\nfunction hangup() {\n  console.log('\u6302\u65ad');\n  pc1.close();\n  pc2.close();\n  pc1 = null;\n  pc2 = null;\n  hangupBtn.disabled = true;\n  callBtn.disabled = false;\n  codecPreferences.disabled = false;\n}\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/change-codec/#codec_2","title":"codec\u4fe1\u606f\u8bf4\u660e","text":"<p>\u89c2\u5bdf\u63a7\u5236\u53f0\uff0c\u6253\u5370\u51fa\u4e86\u53ef\u7528codec\u4fe1\u606f\uff08Mac\uff0c97.0.4692.71\uff08\u6b63\u5f0f\u7248\u672c\uff09x86_64\uff09\u3002\u4e3b\u8981\u5173\u6ce8\u4e0b\u97623\u79cd <pre><code>{clockRate: 90000, mimeType: 'video/VP8'}\n{clockRate: 90000, mimeType: 'video/VP9', sdpFmtpLine: 'profile-id=0'}\n{clockRate: 90000, mimeType: 'video/H264', sdpFmtpLine: 'level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42001f'}\n</code></pre></p> <p><code>clockRate</code> \u662fcodec\u7684\u65f6\u949f\u9891\u7387\uff0c\u5355\u4f4dhz</p> <p><code>sdpFmtpLine</code> \u662fcodec\u7684SDP\u91cc<code>a=fmtp</code>\u7684\u53c2\u6570\u4fe1\u606f</p> <p><code>mimeType</code> \u91cc\u8bf4\u7684\u662f\u89c6\u9891\u7f16\u7801\u7c7b\u578b\uff0c\u5e38\u89c1\u7684\u6709VP8\u548cH264\u7b49\u7b49</p> <p>\u652f\u6301WebRTC\u7684\u6d4f\u89c8\u5668\uff0c\u5fc5\u987b\u8981\u652f\u6301\u89c6\u9891codec VP8\u548cH264</p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/change-codec/#vp8vp9","title":"VP8\u4e0eVP9","text":"<p>2010\u5e745\u6708Google\u6536\u8d2d\u4e86On2 Technologies\uff0c\u83b7\u5f97\u4e86VP8\u3002 Opera\uff0cFireFox\uff0cChrome\u548cChromium\u652f\u6301HTML5\u4e2d\u7684video\u64ad\u653eVP8\u89c6\u9891\u3002</p> <p>WebM\u4f5c\u4e3a\u4e00\u4e2a\u5bb9\u5668\u683c\u5f0f\uff0c\u56fe\u50cf\u90e8\u5206\u4f7f\u7528VP8\uff0c\u97f3\u9891\u4f7f\u7528Vorbis\u548cOpus\u3002</p> <p>VP9\u7531Google\u5f00\u53d1\uff0c\u4e00\u4e2a\u5f00\u653e\u7684\u65e0\u7248\u6743\u8d39\u7684\u89c6\u9891\u7f16\u7801\u6807\u51c6\u3002\u5f00\u53d1\u521d\u671f\u66fe\u7528\u540d\u201cNext Gen Open Video\u201d\u3002VP9\u4e5f\u88ab\u89c6\u4e3a\u662fVP8\u7684\u4e0b\u4e00\u4ee3\u89c6\u9891\u7f16\u7801\u6807\u51c6\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/change-codec/#h264","title":"H264","text":"<p>H.264\uff0c\u53c8\u79f0\u4e3aMPEG-4\u7b2c10\u90e8\u5206\uff0c\u9ad8\u7ea7\u89c6\u9891\u7f16\u7801\u662f\u4e00\u79cd\u9762\u5411\u5757\uff0c\u57fa\u4e8e\u8fd0\u52a8\u8865\u507f\u7684\u89c6\u9891\u7f16\u7801\u6807\u51c6\u3002 \u52302014\u5e74\uff0c\u5b83\u5df2\u7ecf\u6210\u4e3a\u9ad8\u7cbe\u5ea6\u89c6\u9891\u5f55\u5236\u3001\u538b\u7f29\u548c\u53d1\u5e03\u7684\u6700\u5e38\u7528\u683c\u5f0f\u4e4b\u4e00\u3002</p> <p>\u4f18\u52bf\uff1a</p> <ul> <li>1\uff09\u7f51\u7edc\u4eb2\u548c\u6027\uff0c\u5373\u53ef\u9002\u7528\u4e8e\u5404\u79cd\u4f20\u8f93\u7f51\u7edc</li> <li>2\uff09\u9ad8\u7684\u89c6\u9891\u538b\u7f29\u6bd4</li> </ul> <p>\u76ee\u524d\u6211\u4eec\u7528\u7684\u6bd4\u8f83\u591a\u7684\u8fd8\u662fH264\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/change-codec/#_2","title":"\u6548\u679c\u9884\u89c8","text":"<p>\u7f51\u9875\u6548\u679c\u8bf7\u53c2\u8003 \u9009\u62e9codec</p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/change-codec/#_3","title":"\u6269\u5c55\u9605\u8bfb","text":"<ul> <li>WebRTC\u6a21\u62df\u4f20\u8f93\u89c6\u9891\u6d41\uff0cvideo\u901a\u8fc7\u672c\u5730\u8282\u70b9peer\u4f20\u8f93\u89c6\u9891\u6d41</li> <li>H.264\u7b80\u4ecb</li> <li>Codecs used by WebRTC</li> <li>Audio_codecs</li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a cnblogs oschina \u6398\u91d1</p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/multi-relay/","title":"WebRTC\u672c\u5730\u63d2\u5165\u591a\u4e2a\u8f6c\u53d1\u8282\u70b9\uff0c\u6a21\u62df\u591a\u8282\u70b9\u8f6c\u53d1\uff0c\u9020\u6210\u5ef6\u8fdf","text":"\u66f4\u65b0\u65e5\u671f: 2021-12-21 <ul> <li>2021-12-21 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u7f51\u7edc\u5ef6\u8fdf\u662f\u4e00\u79cd\u6bd4\u8f83\u5e38\u89c1\u7684\u60c5\u51b5\u3002\u5728\u672c\u5730\u7f51\u9875\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u5efa\u7acb\u591a\u4e2aRTCPeerConnection\uff0c\u589e\u52a0\u8f6c\u53d1\u6b21\u6570\uff0c\u6765\u6a21\u62df\u51fa\u7f51\u7edc\u5ef6\u8fdf\u7684\u6548\u679c\u3002 \u5efa\u7acb\u901a\u8bdd\u540e\uff0c\u518d\u5f80\u540e\u9762\u589e\u52a0\u672c\u5730\u8f6c\u53d1\u8282\u70b9\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/multi-relay/#_1","title":"\u51c6\u5907","text":"<p>\u9875\u9762\u51c6\u5907\uff0c\u65b9\u4fbf\u6211\u4eec\u540e\u9762\u8c03\u8bd5 <pre><code>&lt;div id=\"container\"&gt;\n    &lt;h1&gt;&lt;a href=\"https://an.rustfisher.com/webrtc/peerconnection/upgrade-to-video\" title=\"\"&gt;WebRTC\u63d2\u5165\u591a\u4e2a\u8f6c\u53d1\u8282\u70b9&lt;/a&gt;&lt;/h1&gt;\n\n    &lt;div id=\"videos\"&gt;\n        &lt;video id=\"video1\" playsinline autoplay muted&gt;&lt;/video&gt;\n        &lt;video id=\"video2\" playsinline autoplay&gt;&lt;/video&gt;\n    &lt;/div&gt;\n\n    &lt;section&gt;&lt;input type=\"checkbox\" id=\"audio\"&gt;&lt;label for=\"audio\"&gt;\u5305\u542b\u97f3\u9891\uff08&gt;= Chrome 49\uff09&lt;/label&gt;&lt;/section&gt;\n\n    &lt;div id=\"buttons\"&gt;\n        &lt;button id=\"start\"&gt;\u5f00\u59cb&lt;/button&gt;\n        &lt;button id=\"call\" disabled&gt;\u547c\u53eb&lt;/button&gt;\n        &lt;button id=\"insertRelay\" disabled&gt;\u63d2\u5165\u8f6c\u53d1&lt;/button&gt;\n        &lt;button id=\"hangup\" disabled&gt;\u6302\u65ad&lt;/button&gt;\n    &lt;/div&gt;\n    &lt;div id=\"status\"&gt;&lt;/div&gt;\n&lt;/div&gt;\n\n&lt;script src=\"../../src/js/adapter-2021.js\"&gt;&lt;/script&gt;\n&lt;script src=\"js/connection2.js\"&gt;&lt;/script&gt;\n&lt;script src=\"js/main.js\"&gt;&lt;/script&gt;\n</code></pre> \u653e\u4e0a2\u4e2avideo\u548c\u51e0\u4e2abutton\u3002\u5f15\u5165WebRTC adapter\u548c\u63a7\u5236\u811a\u672c\u3002</p> <p>\u5982\u679c\u8981\u4f7f\u7528\u5b98\u65b9\u7684\u9002\u914d\u5668adapter\uff0c\u6309\u4e0b\u8fb9\u7684\u5730\u5740\u6765\u5f15\u5165 <pre><code>&lt;!-- &lt;script src=\"../../src/js/adapter-2021.js\"&gt;&lt;/script&gt; --&gt;\n&lt;script src=\"https://webrtc.github.io/adapter/adapter-latest.js\"&gt;&lt;/script&gt;\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/multi-relay/#_2","title":"\u63a7\u5236","text":"<p>\u5206\u4e3a<code>connection2.js</code>\u548c<code>main.js</code>\u3002</p> <p><code>connection2.js</code>\u5305\u542b\u65b0\u5efa\u8282\u70b9\u7684\u903b\u8f91\u3002<code>main.js</code>\u63a7\u5236\u4e3b\u6d41\u7a0b\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/multi-relay/#connection2js","title":"connection2.js","text":"<p>\u8fd9\u91cc\u80fd\u65b0\u5efa2\u4e2aRTCPeerConnection\uff0c\u5efa\u7acb\u65b0\u7684\u8fde\u63a5\u3002 <pre><code>function doNothing() { }\n\nfunction errFunc(context) {\n    return function (error) {\n        trace('\u62a5\u9519 ' + context + ': ' + error.toString);\n    };\n}\n\n// \u65b0\u5efa2\u4e2a\u8282\u70b9\u5e76\u5efa\u7acb\u8fde\u63a5\nfunction Connection2(stream, handler) {\n    let servers = null;\n    let pc1 = new RTCPeerConnection(servers);\n    let pc2 = new RTCPeerConnection(servers);\n\n    pc1.addStream(stream);\n    pc1.onicecandidate = function (event) {\n        if (event.candidate) {\n            pc2.addIceCandidate(new RTCIceCandidate(event.candidate),\n                doNothing, errFunc('AddIceCandidate'));\n        }\n    };\n    pc2.onicecandidate = function (event) {\n        if (event.candidate) {\n            pc1.addIceCandidate(new RTCIceCandidate(event.candidate),\n                doNothing, errFunc('AddIceCandidate'));\n        }\n    };\n    pc2.onaddstream = function (e) {\n        handler(e.stream);\n    };\n    pc1.createOffer(function (desc) {\n        pc1.setLocalDescription(desc);\n        pc2.setRemoteDescription(desc);\n        pc2.createAnswer(function (desc2) {\n            pc2.setLocalDescription(desc2);\n            pc1.setRemoteDescription(desc2);\n        }, errFunc('pc2.createAnswer'));\n    }, errFunc('pc1.createOffer'));\n    this.pc1 = pc1;\n    this.pc2 = pc2;\n}\n\nConnection2.prototype.close = function () {\n    this.pc1.close();\n    this.pc2.close();\n};\n</code></pre></p> <p><code>Connection2(stream, handler)</code>\u65b0\u5efapc1\u548cpc2\uff0c\u5c06\u4f20\u5165\u7684<code>stream</code>\u4f5c\u4e3a\u6570\u636e\u6e90\u4ea4\u7ed9pc1\u3002 \u968f\u540e\u5728pc1\u548cpc2\u4e4b\u95f4\u5efa\u7acb\u8fde\u63a5\u3002pc2\u63a5\u5230\u6570\u636e\u6d41\u540e\u518d\u4ea4\u56de\u7ed9<code>handler</code>\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/multi-relay/#mainjs","title":"main.js","text":"<p>\u5148\u62ff\u5230ui <pre><code>'use strict';\n\n// \u83b7\u53d6ui\nconst video1 = document.querySelector('video#video1');\nconst video2 = document.querySelector('video#video2');\nconst statusDiv = document.querySelector('div#status');\nconst audioCheckbox = document.querySelector('input#audio');\nconst startBtn = document.querySelector('button#start');\nconst callBtn = document.querySelector('button#call');\nconst insertRelayBtn = document.querySelector('button#insertRelay');\nconst hangupBtn = document.querySelector('button#hangup');\n</code></pre></p> <p>\u8bb0\u5f55\u4e00\u4e9b\u53d8\u91cf <pre><code>const connectionList = []; // \u8fde\u63a5\u70b9\nlet localStream;\nlet remoteStream;\n</code></pre></p> <p>\u542f\u52a8\uff0c\u83b7\u53d6\u6570\u636e\u6d41\u3002\u53ef\u4ee5\u9009\u62e9\u662f\u5426\u5e26\u97f3\u9891\u6d41\u3002\u62ff\u5230\u6570\u636e\u6d41\u540e\uff0c\u4ea4\u7ed9<code>video1</code>\u663e\u793a\uff0c\u5e76\u4e14\u8bb0\u5f55\u4e3a<code>localStream</code> <pre><code>function gotStream(stream) {\n    video1.srcObject = stream;\n    localStream = stream;\n    callBtn.disabled = false;\n}\n\nfunction start() {\n    startBtn.disabled = true;\n    const options = audioCheckbox.checked ? { audio: true, video: true } : { audio: false, video: true };\n    navigator.mediaDevices.getUserMedia(options)\n        .then(gotStream)\n        .catch(function (e) {\n            alert(`\u83b7\u53d6\u5a92\u4f53\u5931\u8d25 ${e}`);\n        });\n}\n</code></pre></p> <p>\u53d1\u8d77\u547c\u53eb <pre><code>function gotremoteStream(stream) {\n    remoteStream = stream;\n    video2.srcObject = stream;\n    console.log('\u63a5\u6536\u5230\u4e86\u4f20\u8f93\u540e\u7684\u6570\u636e\u6d41');\n    statusDiv.textContent = `\u5f53\u524d\u8282\u70b9\u6570: ${connectionList.length * 2}`;\n    insertRelayBtn.disabled = false;\n}\n\nfunction call() {\n    callBtn.disabled = true;\n    insertRelayBtn.disabled = false;\n    hangupBtn.disabled = false;\n    console.log('\u547c\u53eb!');\n    connectionList.push(new Connection2(localStream, gotremoteStream));\n}\n</code></pre> \u547c\u53eb\u7684\u65b9\u6cd5\u662f<code>call()</code>\uff0c\u4f7f\u7528Connection2\u6765\u5efa\u7acb\u7b2c\u4e00\u7ea7\u8fde\u63a5\u3002 \u8fde\u63a5\u7684\u8bb0\u5f55\u5b58\u653e\u5728<code>connectionList</code>\u3002</p> <p>\u63d2\u5165\u8f6c\u53d1\u548ccall\u6709\u70b9\u7c7b\u4f3c\uff0c\u90fd\u4f7f\u7528\u4e86Connection2\u3002\u4f46\u662f\u8f93\u5165\u7684\u662f<code>remoteStream</code>\u3002 <pre><code>function insertRelay() {\n    connectionList.push(new Connection2(remoteStream, gotremoteStream));\n    insertRelayBtn.disabled = true;\n}\n</code></pre></p> <p>\u591a\u6b21\u8c03\u7528<code>insertRelay()</code>\uff0c\u53ef\u4ee5\u6a21\u62df\u51fa\u591a\u5c42\u8f6c\u53d1\u7684\u60c5\u51b5\u3002\u8f6c\u53d1\u6b21\u6570\u591a\u4e86\uff0c\u89c6\u9891\u5ef6\u8fdf\u5f97\u4e5f\u5c31\u8d8a\u660e\u663e\u3002</p> <p></p> <p>\u6302\u65ad/\u7ed3\u675f\u65b9\u6cd5<code>hangup()</code> <pre><code>function hangup() {\n    console.log('\u6302\u65ad');\n    while (connectionList.length &gt; 0) {\n        const pipe = connectionList.pop();\n        pipe.close();\n    }\n    insertRelayBtn.disabled = true;\n    hangupBtn.disabled = true;\n    callBtn.disabled = false;\n}\n</code></pre> \u5c06<code>connectionList</code>\u91cc\u9762\u7684\u8fde\u63a5\u5168\u90e8\u62ff\u51fa\u6765\u7ed3\u675f\u6389\u3002 \u5982\u679c\u6570\u91cf\u6bd4\u8f83\u591a\uff0c\u7ed3\u675f\u8017\u65f6\u4e5f\u4f1a\u6bd4\u8f83\u957f\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/multi-relay/#_3","title":"\u6548\u679c\u9884\u89c8","text":"<p>\u6548\u679c\u9884\u89c8\u8bf7\u53c2\u8003WebRTC\u63d2\u5165\u591a\u4e2a\u8f6c\u53d1\u8282\u70b9</p> <p>\u53ef\u4ee5\u5c1d\u8bd5\u591a\u70b9\u51fb\u51e0\u6b21\u63d2\u5165\u8f6c\u53d1\u6309\u94ae\u3002\u89c2\u5bdf\u89c6\u9891\u7684\u5ef6\u8fdf\u60c5\u51b5\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/multi-relay/#_4","title":"\u5c0f\u7ed3","text":"<p>\u672c\u5730\u7f51\u9875\u53ef\u4ee5\u901a\u8fc7\u589e\u52a0\u8282\u70b9\u7684\u529e\u6cd5\uff0c\u6a21\u62df\u51fa\u89c6\u9891\u4f20\u8f93\u5ef6\u8fdf\u7684\u6548\u679c\u3002 <code>Connection2(stream, handler)</code>\u91cc\u7684\u4ee3\u7801\u5199\u7684\u975e\u5e38\u7b80\u6d01\uff0c\u4e5f\u5229\u4e8e\u4e86\u89e3WebRTC\u4f20\u8f93\u5efa\u7acb\u7684\u8fc7\u7a0b\u3002 \u4ece\u8fd9\u4e2a\u4f8b\u5b50\u6211\u4eec\u4e5f\u53ef\u4ee5\u770b\u51fa\uff0c\u5b9e\u9645\u5de5\u7a0b\u4e2d\u8981\u5c3d\u91cf\u51cf\u5c11\u4e2d\u95f4\u8282\u70b9\u3002\u5e76\u4e14\u8981\u4f18\u5148\u9009\u62e9\u8d28\u91cf\u9ad8\u7684\u8282\u70b9\u3002</p> <p></p> <p>WebRTC\u7cfb\u5217</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a cnblog</p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/upgrade-to-video/","title":"WebRTC\u97f3\u9891\u901a\u8bdd\u5347\u7ea7\u4e3a\u89c6\u9891\u901a\u8bdd","text":"\u66f4\u65b0\u65e5\u671f: 2021-12-17 <ul> <li>2021-12-17 \u521b\u5efa\u6587\u6863</li> </ul> <p>\u6211\u4eec\u6709\u65f6\u5019\u5728\u97f3\u9891\u901a\u8bdd\u8fc7\u7a0b\u4e2d\uff0c\u60f3\u8981\u6539\u6210\u89c6\u9891\u901a\u8bdd\u3002\u5982\u679c\u6302\u65ad\u5f53\u524d\u901a\u8bdd\u518d\u91cd\u65b0\u53d1\u8d77\u89c6\u9891\u901a\u8bdd\u5c31\u4f1a\u663e\u5f97\u6bd4\u8f83\u9ebb\u70e6\u3002 \u56e0\u6b64\u5f88\u591aapp\u63d0\u4f9b\u4e86\u5c06\u97f3\u9891\u901a\u8bdd\u5347\u7ea7\u6210\u89c6\u9891\u901a\u8bdd\u7684\u529f\u80fd\uff0c\u540c\u65f6\u4e5f\u6709\u5c06\u89c6\u9891\u901a\u8bdd\u964d\u4e3a\u97f3\u9891\u901a\u8bdd\u7684\u529f\u80fd\u3002</p> <p>\u672c\u6587\u6f14\u793a\u7684\u662f\u5728\u672c\u5730\u6a21\u62df\u97f3\u9891\u901a\u8bdd\uff0c\u5e76\u4e14\u5c06\u97f3\u9891\u901a\u8bdd\u5347\u7ea7\u4e3a\u89c6\u9891\u901a\u8bdd\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/upgrade-to-video/#_1","title":"\u51c6\u5907","text":"<p>\u754c\u9762\u5f88\u7b80\u5355\uff0c2\u4e2avideo\u52a0\u4e0a\u51e0\u4e2a\u6309\u94ae\u3002 <pre><code>&lt;video id=\"localVideo\" playsinline autoplay muted&gt;&lt;/video&gt;\n&lt;video id=\"remoteVideo\" playsinline autoplay&gt;&lt;/video&gt;\n\n&lt;div&gt;\n    &lt;button id=\"startBtn\"&gt;\u5f00\u59cb&lt;/button&gt;\n    &lt;button id=\"callBtn\"&gt;Call&lt;/button&gt;\n    &lt;button id=\"upgradeBtn\"&gt;\u5347\u7ea7\u4e3a\u89c6\u9891\u901a\u8bdd&lt;/button&gt;\n    &lt;button id=\"hangupBtn\"&gt;\u6302\u65ad&lt;/button&gt;\n&lt;/div&gt;\n</code></pre></p> <p>\u7528\u7684\u662f\u672c\u5730\u7684adapter <pre><code>&lt;script src=\"../../src/js/adapter-2021.js\"&gt;&lt;/script&gt;\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/upgrade-to-video/#js","title":"js","text":"<p>\u5148\u6765\u628a\u5143\u7d20\u62ff\u5230 <pre><code>const startBtn = document.getElementById('startBtn');\nconst callBtn = document.getElementById('callBtn');\nconst upgradeToVideoBtn = document.getElementById('upgradeBtn');\nconst hangupBtn = document.getElementById('hangupBtn');\nconst localVideo = document.getElementById('localVideo');   // \u672c\u5730\u9884\u89c8\nconst remoteVideo = document.getElementById('remoteVideo'); // \u63a5\u6536\u65b9\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/upgrade-to-video/#_2","title":"\u76d1\u542c\u5668","text":"<p>\u8bbe\u7f6e\u4e00\u4e9b\u76d1\u542c <pre><code>localVideo.addEventListener('loadedmetadata', function () {\n    console.log(`localVideo \u5bbd\u9ad8: ${this.videoWidth}px, ${this.videoHeight}px`);\n});\n\nremoteVideo.addEventListener('loadedmetadata', function () {\n    console.log(`remoteVideo \u5bbd\u9ad8: ${this.videoWidth}px, ${this.videoHeight}px`);\n});\n\nlet startTime;\nremoteVideo.onresize = () =&gt; {\n    console.log(`remoteVideo onresize \u5bbd\u9ad8: ${remoteVideo.videoWidth}x${remoteVideo.videoHeight}`);\n    if (startTime) {\n        const elapsedTime = window.performance.now() - startTime;\n        console.log(`\u5efa\u7acb\u8fde\u63a5\u8017\u65f6: ${elapsedTime.toFixed(3)}ms`);\n        startTime = null;\n    }\n};\n\nstartBtn.onclick = start;\ncallBtn.onclick = call;\nupgradeToVideoBtn.onclick = upgrade;\nhangupBtn.onclick = hangup;\n</code></pre></p> <p>\u6253\u4e00\u4e9b\u72b6\u6001\u53d8\u5316\u7684log <pre><code>function onCreateSessionDescriptionError(error) {\n    console.log(`rustfisher.com:\u521b\u5efa\u4f1a\u8bdd\u63cf\u8ff0\u5931\u8d25, session description err: ${error.toString()}`);\n}\n\nfunction onIceStateChange(pc, event) {\n    if (pc) {\n        console.log(`rustfisher.com:${getName(pc)} ICE\u72b6\u6001: ${pc.iceConnectionState}`);\n        console.log('rustfisher.com:ICE\u72b6\u6001\u53d8\u5316: ', event);\n    }\n}\n\nfunction onAddIceCandidateSuccess(pc) {\n    console.log(`rustfisher.com:${getName(pc)} addIceCandidate success \u6dfb\u52a0ICE\u5019\u9009\u6210\u529f`);\n}\n\nfunction onAddIceCandidateError(pc, error) {\n    console.log(`rustfisher.com:${getName(pc)} \u6dfb\u52a0ICE\u5019\u9009\u5931\u8d25 failed to add ICE Candidate: ${error.toString()}`);\n}\n\nfunction onSetLocalSuccess(pc) {\n    console.log(`rustfisher.com:${getName(pc)} setLocalDescription \u6210\u529f`);\n}\n\nfunction onSetSessionDescriptionError(error) {\n    console.log(`rustfisher.com:\u8bbe\u7f6e\u4f1a\u8bdd\u63cf\u8ff0\u5931\u8d25: ${error.toString()}`);\n}\n\nfunction onSetRemoteSuccess(pc) {\n    console.log(`rustfisher.com:${getName(pc)} \u8bbe\u7f6e\u8fdc\u7a0b\u63cf\u8ff0\u6210\u529f setRemoteDescription complete`);\n}\n\n// \u8f85\u52a9\u65b9\u6cd5\nfunction getName(pc) {\n    return (pc === pc1) ? 'pc1' : 'pc2';\n}\n\nfunction getOtherPc(pc) {\n    return (pc === pc1) ? pc2 : pc1;\n}\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/upgrade-to-video/#_3","title":"\u5f00\u59cb","text":"<p>\u83b7\u53d6\u672c\u5730\u7684\u97f3\u9891\u6570\u636e\u6d41\uff0c\u4ea4\u7ed9<code>localVideo</code> <pre><code>function gotStream(stream) {\n    console.log('\u83b7\u53d6\u5230\u4e86\u672c\u5730\u6570\u636e\u6d41');\n    localVideo.srcObject = stream;\n    localStream = stream;\n    callBtn.disabled = false;\n}\n\nfunction start() {\n    console.log('\u8bf7\u6c42\u672c\u5730\u6570\u636e\u6d41 \u7eaf\u97f3\u9891');\n    startBtn.disabled = true;\n    navigator.mediaDevices\n        .getUserMedia({ audio: true, video: false })\n        .then(gotStream)\n        .catch(e =&gt; alert(`getUserMedia() error: ${e.name}`));\n}\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/upgrade-to-video/#call","title":"call","text":"<p>\u53d1\u8d77\u97f3\u9891\u547c\u53eb <pre><code>function call() {\n    callBtn.disabled = true;\n    upgradeToVideoBtn.disabled = false;\n    hangupBtn.disabled = false;\n    console.log('\u5f00\u59cb\u547c\u53eb...');\n    startTime = window.performance.now();\n    const audioTracks = localStream.getAudioTracks();\n    if (audioTracks.length &gt; 0) {\n        console.log(`\u4f7f\u7528\u7684\u97f3\u9891\u8bbe\u5907: ${audioTracks[0].label}`);\n    }\n    const servers = null; // \u5c31\u5728\u672c\u5730\u6d4b\u8bd5\n    pc1 = new RTCPeerConnection(servers);\n    console.log('\u521b\u5efa\u672c\u5730\u8282\u70b9 pc1');\n    pc1.onicecandidate = e =&gt; onIceCandidate(pc1, e);\n    pc2 = new RTCPeerConnection(servers);\n    console.log('rustfisher.com:\u521b\u5efa\u6a21\u62df\u8fdc\u7aef\u8282\u70b9 pc2');\n    pc2.onicecandidate = e =&gt; onIceCandidate(pc2, e);\n    pc1.oniceconnectionstatechange = e =&gt; onIceStateChange(pc1, e);\n    pc2.oniceconnectionstatechange = e =&gt; onIceStateChange(pc2, e);\n    pc2.ontrack = gotRemoteStream;\n\n    localStream.getTracks().forEach(track =&gt; pc1.addTrack(track, localStream));\n    console.log('rustfisher.com:\u5c06\u672c\u5730\u6570\u636e\u6d41\u4ea4\u7ed9pc1');\n\n    console.log('rustfisher.com:pc1\u5f00\u59cb\u521b\u5efaoffer');\n    pc1.createOffer(offerOptions).then(onCreateOfferSuccess, onCreateSessionDescriptionError);\n}\n\nfunction gotRemoteStream(e) {\n    console.log('\u83b7\u53d6\u5230\u8fdc\u7a0b\u6570\u636e\u6d41', e.track, e.streams[0]);\n    remoteVideo.srcObject = null;\n    remoteVideo.srcObject = e.streams[0];\n}\n\nfunction onIceCandidate(pc, event) {\n    getOtherPc(pc)\n        .addIceCandidate(event.candidate)\n        .then(() =&gt; onAddIceCandidateSuccess(pc), err =&gt; onAddIceCandidateError(pc, err));\n    console.log(`${getName(pc)} ICE candidate:\\n${event.candidate ? event.candidate.candidate : '(null)'}`);\n}\n\nfunction onCreateOfferSuccess(desc) {\n    console.log(`pc1\u63d0\u4f9b\u4e86offer\\n${desc.sdp}`);\n    console.log('pc1 setLocalDescription start');\n    pc1.setLocalDescription(desc).then(() =&gt; onSetLocalSuccess(pc1), onSetSessionDescriptionError);\n    console.log('pc2 setRemoteDescription start');\n    pc2.setRemoteDescription(desc).then(() =&gt; onSetRemoteSuccess(pc2), onSetSessionDescriptionError);\n    console.log('pc2 createAnswer start');\n    pc2.createAnswer().then(onCreateAnswerSuccess, onCreateSessionDescriptionError);\n}\n\nfunction onCreateAnswerSuccess(desc) {\n    console.log(`rustfisher.com:pc2\u5e94\u7b54\u6210\u529f:  ${desc.sdp}`);\n    console.log('pc2 setLocalDescription start');\n    pc2.setLocalDescription(desc).then(() =&gt; onSetLocalSuccess(pc2), onSetSessionDescriptionError);\n    console.log('pc1 setRemoteDescription start');\n    pc1.setRemoteDescription(desc).then(() =&gt; onSetRemoteSuccess(pc1), onSetSessionDescriptionError);\n}\n</code></pre></p> <ul> <li>\u521b\u5efaRTCPeerConnection</li> <li>\u8bbe\u7f6e<code>onicecandidate</code>\u76d1\u542cICE\u5019\u9009</li> <li>\u8bbe\u7f6e<code>oniceconnectionstatechange</code>\u76d1\u542cICE\u8fde\u63a5\u72b6\u6001\u53d8\u5316</li> <li>\u63a5\u6536\u65b9\u76d1\u542c<code>ontrack</code></li> <li>\u53d1\u9001\u65b9pc1 <code>addTrack</code>\u5c06\u5f53\u524d\u6570\u636e\u6d41\u6dfb\u52a0\u8fdb\u53bb</li> <li>\u53d1\u9001\u65b9pc1\u521b\u5efaoffer <code>createOffer</code></li> <li>pc1\u521b\u5efa\u597doffer\u540e\uff0c\u63a5\u6536\u65b9pc2\u5e94\u7b54 <code>createAnswer</code></li> </ul>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/upgrade-to-video/#_4","title":"\u5347\u7ea7\u5230\u89c6\u9891\u901a\u8bdd","text":"<p><code>upgrade()</code>\u65b9\u6cd5\u5904\u7406\u5347\u7ea7\u64cd\u4f5c <pre><code>function upgrade() {\n    upgradeToVideoBtn.disabled = true;\n    navigator.mediaDevices\n        .getUserMedia({ video: true })\n        .then(stream =&gt; {\n            console.log('rustfisher.com:\u83b7\u53d6\u5230\u4e86\u89c6\u9891\u6d41');\n            const videoTracks = stream.getVideoTracks();\n            if (videoTracks.length &gt; 0) {\n                console.log(`video device: ${videoTracks[0].label}`);\n            }\n            localStream.addTrack(videoTracks[0]);\n            localVideo.srcObject = null; // \u91cd\u7f6e\u89c6\u9891\u6d41\n            localVideo.srcObject = localStream;\n            pc1.addTrack(videoTracks[0], localStream);\n            return pc1.createOffer();\n        })\n        .then(offer =&gt; pc1.setLocalDescription(offer))\n        .then(() =&gt; pc2.setRemoteDescription(pc1.localDescription))\n        .then(() =&gt; pc2.createAnswer())\n        .then(answer =&gt; pc2.setLocalDescription(answer))\n        .then(() =&gt; pc1.setRemoteDescription(pc2.localDescription));\n}\n</code></pre> \u53d1\u9001\u65b9\u53bb\u83b7\u53d6\u97f3\u9891\u6570\u636e\u6d41<code>getUserMedia</code>\u3002 \u5c06\u97f3\u9891\u8f68\u9053\u6dfb\u52a0\u8fdb<code>localStream</code>\uff0c\u5e76\u4e14\u53d1\u9001\u65b9\u4e5f\u8981\u6dfb\u52a0\u8f68\u9053 <code>pc1.addTrack</code>\u3002 \u521b\u5efaoffer <code>createOffer</code></p> <p>\u540e\u9762\u5c31\u662f\u63a5\u6536\u65b9pc2\u5e94\u7b54</p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/upgrade-to-video/#_5","title":"\u6302\u65ad","text":"<p>\u7b80\u5355\u7684\u6302\u65ad\u529f\u80fd\u5982\u4e0b <pre><code>function hangup() {\n    console.log('rustfisher.com:\u6302\u65ad');\n    pc1.close();\n    pc2.close();\n    pc1 = null;\n    pc2 = null;\n\n    const videoTracks = localStream.getVideoTracks();\n    videoTracks.forEach(videoTrack =&gt; {\n        videoTrack.stop();\n        localStream.removeTrack(videoTrack);\n    });\n\n    localVideo.srcObject = null;\n    localVideo.srcObject = localStream;\n\n    hangupBtn.disabled = true;\n    callBtn.disabled = false;\n}\n</code></pre> \u4e3b\u8981\u662f\u628a\u547c\u51fa\u65b9\u7684\u6d41\u5173\u95ed\u6389</p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/upgrade-to-video/#_6","title":"\u4ee3\u7801\u6d41\u7a0b\u63cf\u8ff0\u56fe","text":"<p>\u5c06\u7528\u6237\u7684\u64cd\u4f5c\uff08\u6309\u94ae\uff09\u548c\u4e3b\u8981\u4ee3\u7801\u5bf9\u5e94\u8d77\u6765</p> <p></p>","tags":["WebRTC"]},{"location":"webrtc/peerconnection/upgrade-to-video/#_7","title":"\u6548\u679c\u9884\u89c8","text":"<p>\u6548\u679c\u9884\u89c8\u8bf7\u53c2\u8003\u97f3\u9891\u901a\u8bdd\u5347\u7ea7\u5230\u89c6\u9891\u901a\u8bdd</p> <p></p> <p>WebRTC\u7cfb\u5217</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a cnblog</p>","tags":["WebRTC"]},{"location":"webrtc/turn/ubuntu-run-coturn/","title":"Ubuntu\u4e0b\u8f7d\u5b89\u88c5coturn\uff0c\u542f\u52a8TURN\u670d\u52a1","text":"\u66f4\u65b0\u65e5\u671f: 2022-7-20 <ul> <li>2022-7-20 \u66f4\u65b0\u683c\u5f0f</li> <li>2022-5-16 \u521b\u5efa\u6587\u6863</li> </ul> \u8fd0\u884c\u73af\u5883 <p>Ubuntu\uff08\u6216\u8005\u5176\u4ed6Linux\uff09\u670d\u52a1\u5668\uff0c\u6709\u516c\u7f51\u5730\u5740</p> <p>WebRTC\u4f7f\u7528\u70b9\u5bf9\u70b9\u8fde\u63a5\u6765\u4f20\u8f93\u6570\u636e\u3002\u5f532\u4e2a\u5ba2\u6237\u7aef\uff08\u4f8b\u5982PC\uff09\u4e0d\u5728\u540c\u4e00\u4e2a\u7f51\u7edc\uff0c\u6216\u662f\u88ab\u9632\u706b\u5899\u963b\u6b62\u65f6\uff0c\u76f4\u63a5\u8fde\u63a5\u4f1a\u9047\u5230\u95ee\u9898\u3002</p> <p>TURN\uff08Traversal Using Relays around NAT\uff09\u7528\u6765\u89e3\u51b3\u8282\u70b9\u4e0d\u80fd\u76f4\u63a5\u8fde\u63a5\u7684\u95ee\u9898\u3002</p> <p>\u672c\u6587\u8bb2\u8ff0\u5982\u4f55\u5728\u670d\u52a1\u5668\u4e0a\u5b89\u88c5\u548c\u4f7f\u7528TURN\u670d\u52a1\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/turn/ubuntu-run-coturn/#1","title":"1.\u5b89\u88c5\u4e0e\u542f\u52a8","text":"<p>\u9996\u5148\u5b89\u88c5<code>coturn</code> <pre><code>sudo apt-get update -y\n\nsudo apt-get install coturn\n</code></pre></p> <p>\u5b89\u88c5\u5b8c\u6bd5\u540e\uff0c\u5148\u67e5\u770b\u9ed8\u8ba4\u7684\u914d\u7f6e <pre><code>cat /etc/default/coturn \n</code></pre></p> <p>\u53ef\u4ee5\u770b\u5230\u9ed8\u8ba4\u7684TURN\u670d\u52a1\u662f\u4e0d\u542f\u52a8\u7684 <pre><code>#\n# Uncomment it if you want to have the turnserver running as \n# an automatic system service daemon\n#\n#TURNSERVER_ENABLED=1\n</code></pre></p> <p>\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\u53d6\u6d88\u6ce8\u91ca <pre><code>sudo vim /etc/default/coturn\n</code></pre></p> <pre><code>TURNSERVER_ENABLED=1\n</code></pre> <p>\u7528<code>systemctl</code>\u542f\u52a8coturn\u670d\u52a1 <pre><code>$ systemctl start coturn\n==== AUTHENTICATING FOR org.freedesktop.systemd1.manage-units ===\nAuthentication is required to start 'coturn.service'.\nAuthenticating as: ubuntu,,, (ubuntu)\nPassword: \n==== AUTHENTICATION COMPLETE ===\n</code></pre></p> <p>\u9632\u706b\u5899\u5141\u8bb8\u8fd9\u4e2a\u7aef\u53e3 <pre><code>$ sudo ufw allow 3478\nRule added\nRule added (v6)\n</code></pre></p> <p>\u81f3\u6b64<code>coturn</code>\u670d\u52a1\u5df2\u7ecf\u542f\u52a8\u5b8c\u6bd5</p>","tags":["WebRTC"]},{"location":"webrtc/turn/ubuntu-run-coturn/#2","title":"2.\u914d\u7f6e","text":"<p>\u63a5\u4e0b\u6765\u914d\u7f6e<code>coturn</code></p> <p>\u9996\u5148\u5907\u4efd\u4e00\u4e0b\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6 <pre><code>sudo cp /etc/turnserver.conf /etc/turnserver.conf.backup\n</code></pre> \u63a5\u4e0b\u6765\u7f16\u8f91<code>/etc/turnserver.conf</code></p> <p>\u8fd9\u91cc\u586b\u670d\u52a1\u57df\uff08realm\uff09\u548c\u540d\u5b57 <pre><code>realm=antalkws.rustfisher.com\nserver-name=turnantalk\n</code></pre></p> <p><code>external-ip</code>\u5199\u4f60\u7684\u670d\u52a1\u5668\u7684IP\u5730\u5740 <pre><code># IPs the TURN server listens to\nlistening-ip=0.0.0.0\n\n# External IP-Address of the TURN server\nexternal-ip=\u4f60\u7684\u670d\u52a1\u5668\u7684IP\u5730\u5740\n</code></pre></p> <p>\u4f7f\u7528\u7684\u7aef\u53e3\u6211\u4eec\u5199<code>3478</code> <pre><code># Main listening port\nlistening-port=3478\n\n# Further ports that are open for communication\nmin-port=10000\nmax-port=20000\n</code></pre></p> <p>\u6307\u5b9alog\u7684\u8def\u5f84\u3002log\u7b49\u7ea7\u8bbe\u7f6e\u4e3a<code>verbose</code> <pre><code># Use fingerprint in TURN message\nfingerprint\n\n# Log file path\nlog-file=/home/ubuntu/server/turn/turnserver.log\n\n# Enable verbose logging\nverbose\n</code></pre></p> <p>user\u90a3\u91cc\u914d\u7f6e\u8d26\u53f7\u5bc6\u7801\uff0c\u683c\u5f0f<code>account:pwd</code>\uff0c\u4e2d\u95f4\u662f\u5192\u53f7 <pre><code># Specify the user for the TURN authentification\nuser=\u81ea\u5df1\u60f3\u7684\u8d26\u53f7:\u81ea\u5df1\u60f3\u7684\u5bc6\u7801\n</code></pre></p> <p>\u5b8c\u6574\u7684\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b</p> \u5b8c\u6574turnserver.conf <pre><code>#Turn server name and realm\nrealm=antalkws.rustfisher.com\nserver-name=turnantalk\n\n# Use fingerprint in TURN message\nfingerprint\n\n# IPs the TURN server listens to\nlistening-ip=0.0.0.0\n\n# External IP-Address of the TURN server\nexternal-ip=xxx.xxx.xxx.xxx\n\n# Main listening port\nlistening-port=3478\n\n# Further ports that are open for communication\nmin-port=10000\nmax-port=20000\n\n# Log file path\nlog-file=/home/ubuntu/server/turn/turnserver.log\n\n# Enable verbose logging\nverbose\n\n# Specify the user for the TURN authentification\nuser=&lt;\u4f60\u7684\u7528\u6237\u540d:\u81ea\u5df1\u8bbe\u7684\u5bc6\u7801&gt;\n\n# Enable long-term credential mechanism\nlt-cred-mech\n\n# If running coturn version older than 4.5.2, uncomment these rules and ensure\n# that you have listening-ip set to ipv4 addresses only.\n# Prevent Loopback bypass https://github.com/coturn/coturn/security/advisories/GHSA-6g6j-r9rf-cm7p\n#denied-peer-ip=0.0.0.0-0.255.255.255\n#denied-peer-ip=127.0.0.0-127.255.255.255\n#denied-peer-ip=::1\n</code></pre> <p>\u4fdd\u5b58\u597d\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\u3002</p> <p>\u91cd\u542f\u670d\u52a1 <pre><code>sudo service coturn restart\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/turn/ubuntu-run-coturn/#3","title":"3.\u9a8c\u8bc1","text":"<p>\u6211\u4eec\u53ef\u4ee5\u53bbWebRTC Samples Trickle ICE\u9875\u9762\u9a8c\u8bc1\u6211\u4eec\u7684turn\u670d\u52a1\u662f\u5426\u53ef\u7528</p> <p>\u7f51\u7edc\u4e0d\u597d\u7684\u65f6\u5019\u53ef\u80fd\u9700\u8981\u5de5\u5177\u6253\u5f00 webrtc.github.io</p> <p>URI\u8f93\u5165 <code>turn:IP\u5730\u5740:3478</code>\uff0c\u4ee5\u53ca\u914d\u7f6e\u597d\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u3002\u7136\u540e\u300cAdd Server\u300d</p> <p></p> <p>\u7136\u540e\u70b9\u51fb\u300cGather candidates\u300d\u6309\u94ae\uff0c\u53ef\u4ee5\u770b\u5230\u7ed3\u679c</p> <p></p> <p>\u81f3\u6b64TURN\u670d\u52a1\u5df2\u7ecf\u8fd0\u884c\u8d77\u6765\u4e86\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/turn/ubuntu-run-coturn/#_1","title":"\u53c2\u8003","text":"<ul> <li>https://gabrieltanner.org/blog/turn-server</li> </ul>","tags":["WebRTC"]},{"location":"webrtc/web-samples/audio-collection/","title":"WebRTC\u97f3\u9891\u97f3\u91cf","text":"<p>WebRTC\u6253\u5f00\u9ea6\u514b\u98ce\uff0c\u83b7\u53d6\u97f3\u9891\uff0c\u5728\u7f51\u9875\u4e0a\u663e\u793a\u97f3\u91cf\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/audio-collection/#_1","title":"\u64ad\u653e\u793a\u4f8b\u97f3\u9891","text":"<p>\u5148\u4ece\u64ad\u653e\u97f3\u9891\u5165\u624b\u3002\u51c6\u5907\u4e00\u4e2a\u73b0\u6210\u7684\u97f3\u9891\u6587\u4ef6\u3002</p> <p>\u754c\u9762\u4e0a\u653e\u4e00\u4e2aaudio\u5143\u7d20\uff0c\u63d0\u524d\u51c6\u5907\u597d\u4e00\u4e2a\u97f3\u9891\u6587\u4ef6\uff0c\u8def\u5f84\u586b\u5165<code>src</code> <pre><code>&lt;audio id=\"sample-audio\" src=\"God_knows_01.mp3\" controls autoplay&gt;&lt;/audio&gt;\n</code></pre></p> <p>audio\u6709\u9ed8\u8ba4\u7684\u6837\u5f0f\u3002\u6253\u5f00\u7f51\u9875\u5c31\u53ef\u4ee5\u5229\u7528\u8fd9\u4e2a\u6765\u64ad\u653e\u793a\u4f8b\u97f3\u9891\u4e86\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/audio-collection/#webrtc_1","title":"WebRTC\u6253\u5f00\u9ea6\u514b\u98ce","text":"","tags":["WebRTC"]},{"location":"webrtc/web-samples/audio-collection/#_2","title":"\u51c6\u5907","text":"<p>html\u9875\u9762\u4e0a\u653eaudio\uff0cmeter\uff0cbutton\u7b49\u7b49 <pre><code>&lt;audio id=\"play-audio\" controls autoplay&gt;&lt;/audio&gt;\n\n&lt;div id=\"meters\"&gt;\n    &lt;div id=\"instant\"&gt;\n        &lt;div class=\"label\"&gt;\u5b9e\u65f6:&lt;/div&gt;\n        &lt;meter high=\"0.25\" max=\"1\" value=\"0\"&gt;&lt;/meter&gt;\n        &lt;div class=\"value\"&gt;&lt;/div&gt;\n    &lt;/div&gt;\n    &lt;div id=\"slow\"&gt;\n        &lt;div class=\"label\"&gt;\u79d2\u7ea7:&lt;/div&gt;\n        &lt;meter high=\"0.25\" max=\"1\" value=\"0\"&gt;&lt;/meter&gt;\n        &lt;div class=\"value\"&gt;&lt;/div&gt;\n    &lt;/div&gt;\n    &lt;div id=\"clip\"&gt;\n        &lt;div class=\"label\"&gt;Clip:&lt;/div&gt;\n        &lt;meter max=\"1\" value=\"0\"&gt;&lt;/meter&gt;\n        &lt;div class=\"value\"&gt;&lt;/div&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n\n&lt;div&gt;\n    &lt;button id=\"startBtn\"&gt;\u542f\u52a8&lt;/button&gt;\n    &lt;button id=\"stopBtn\" disabled&gt;\u505c\u6b62&lt;/button&gt;\n&lt;/div&gt;\n\n&lt;div id=\"msg\"&gt;&lt;/div&gt;\n</code></pre></p> <p>\u5f15\u5165js\u811a\u672c <pre><code>    &lt;!-- \u4f7f\u7528\u672c\u5730\u7684\u9002\u914d\u5668 --&gt;\n    &lt;script src=\"../js/adapter-latest.js\" async&gt;&lt;/script&gt;\n    &lt;script src=\"js/soundmeter.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"js/main.js\"&gt;&lt;/script&gt;\n</code></pre></p> <ul> <li>\u4f7f\u7528\u4e86\u672c\u5730\u7684\u9002\u914d\u5668</li> <li>main.js \u4e3b\u8981\u7684\u63a7\u5236\u903b\u8f91</li> <li>soundmeter.js \u8ba1\u7b97\u97f3\u9891\u97f3\u91cf\u7684\u65b9\u6cd5</li> </ul>","tags":["WebRTC"]},{"location":"webrtc/web-samples/audio-collection/#soundmeterjs","title":"soundmeter.js","text":"<p>\u5728\u4f7f\u7528WebRTC\u4e4b\u524d\uff0c\u5148\u6765\u770b\u97f3\u9891\u76f8\u5173\u7684\u65b9\u6cd5\u548c\u7c7b\u3002</p> <p>\u8981\u4f7f\u7528web\u7684\u97f3\u9891API\uff0c\u9700\u8981\u7528\u5230AudioContext</p> <pre><code>try {\n    window.AudioContext = window.AudioContext || window.webkitAudioContext;\n    window.audioContext = new AudioContext();\n} catch (e) {\n    alert('Web Audio API \u4e0d\u652f\u6301');\n}\n</code></pre>","tags":["WebRTC"]},{"location":"webrtc/web-samples/audio-collection/#audiocontextcreatescriptprocessorint-int-int","title":"AudioContext.createScriptProcessor(int, int, int)","text":"<p>\u521b\u5efajs\u5904\u7406\u97f3\u9891\u7684\u5de5\u5177\uff0c\u63a5\u53d73\u4e2a\u6570\u5b57\u53c2\u6570</p> <ul> <li>bufferSize<ul> <li>\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u4ee5\u6837\u672c\u5e27\u4e3a\u5355\u4f4d\u3002\u5177\u4f53\u6765\u8bb2\uff0c\u6570\u503c\u5fc5\u987b\u662f\u4ee5\u4e0b\u8fd9\u4e9b\u503c\u5f53\u4e2d\u7684\u67d0\u4e00\u4e2a: 256, 512, 1024, 2048, 4096, 8192, 16384. \u5982\u679c\u4e0d\u4f20\uff0c\u6216\u8005\u53c2\u6570\u4e3a0\uff0c\u5219\u53d6\u5f53\u524d\u73af\u5883\u6700\u5408\u9002\u7684\u7f13\u51b2\u533a\u5927\u5c0f, \u53d6\u503c\u4e3a2\u7684\u5e42\u6b21\u65b9\u7684\u4e00\u4e2a\u5e38\u6570\uff0c\u5728\u8be5node\u7684\u6574\u4e2a\u751f\u547d\u5468\u671f\u4e2d\u90fd\u4e0d\u53d8.</li> <li>\u8be5\u53d6\u503c\u63a7\u5236\u7740audioprocess\u4e8b\u4ef6\u88ab\u5206\u6d3e\u7684\u9891\u7387\uff0c\u4ee5\u53ca\u6bcf\u4e00\u6b21\u8c03\u7528\u591a\u5c11\u6837\u672c\u5e27\u88ab\u5904\u7406. \u8f83\u4f4ebufferSzie\u5c06\u5bfc\u81f4\u4e00\u5b9a\u7684\u5ef6\u8fdf\u3002\u8f83\u9ad8\u7684bufferSzie\u5c31\u8981\u6ce8\u610f\u907f\u514d\u97f3\u9891\u7684\u5d29\u6e83\u548c\u6545\u969c\u3002\u63a8\u8350\u4f5c\u8005\u4e0d\u8981\u7ed9\u5b9a\u5177\u4f53\u7684\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u8ba9\u7cfb\u7edf\u81ea\u5df1\u9009\u4e00\u4e2a\u597d\u7684\u503c\u6765\u5e73\u8861\u5ef6\u8fdf\u548c\u97f3\u9891\u8d28\u91cf\u3002</li> <li>\u91cd\u8981: Webkit (version 31)\u8981\u6c42\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u7684\u65f6\u5019\u5fc5\u987b\u4f20\u5165\u4e00\u4e2a\u6709\u6548\u7684bufferSize .</li> </ul> </li> <li>numberOfInputChannels<ul> <li>\u503c\u4e3a\u6574\u6570\uff0c\u7528\u4e8e\u6307\u5b9a\u8f93\u5165node\u7684\u58f0\u9053\u7684\u6570\u91cf\uff0c\u9ed8\u8ba4\u503c\u662f2\uff0c\u6700\u9ad8\u80fd\u53d632.</li> </ul> </li> <li>numberOfOutputChannels<ul> <li>\u503c\u4e3a\u6574\u6570\uff0c\u7528\u4e8e\u6307\u5b9a\u8f93\u51fanode\u7684\u58f0\u9053\u7684\u6570\u91cf\uff0c\u9ed8\u8ba4\u503c\u662f2\uff0c\u6700\u9ad8\u80fd\u53d632.</li> </ul> </li> </ul> <p>\u53c2\u8003\uff1ahttps://developer.mozilla.org/zh-CN/docs/Web/API/BaseAudioContext/createScriptProcessor</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/audio-collection/#audiocontextonaudioprocess","title":"AudioContext.onaudioprocess","text":"<p>\u76d1\u542c\u97f3\u9891\u6570\u636e</p> <p>\u57fa\u672c\u7528\u6cd5 <pre><code>var audioCtx = new AudioContext();\nvar scriptNode = audioCtx.createScriptProcessor(4096, 1, 1);\nscriptNode.onaudioprocess = function(event) { /* ... */ }\n</code></pre></p> <p>\u672c\u6587\u793a\u4f8b\u4f7f\u7528\u8fd9\u4e2a\u76d1\u542c\u3002\u4f46\u5b83\u76ee\u524d\u5df2\u7ecf\u4e0d\u63a8\u8350\u4f7f\u7528\uff08deprecated\uff09\u4e86\u3002</p> <p>\u53c2\u8003\uff1ahttps://developer.mozilla.org/en-US/docs/Web/API/ScriptProcessorNode/onaudioprocess#browser_compatibility</p> <p>\u5b8c\u6574soundmeter.js\u4ee3\u7801\u5982\u4e0b <pre><code>'use strict';\n\n// \u8fd9\u4e2a\u7c7b\u751f\u6210\u97f3\u9891\u97f3\u91cf\u76f8\u5173\u7684\u6570\u503c\nfunction SoundMeter(context) {\n  this.context = context;\n  this.instant = 0.0; // \u5b9e\u65f6\n  this.slow = 0.0; // \u79d2\u7ea7\n  this.clip = 0.0;\n  this.script = context.createScriptProcessor(2048, 1, 1);\n  const that = this;\n  this.script.onaudioprocess = function (event) {\n    const input = event.inputBuffer.getChannelData(0); // \u5f97\u5230\u4e00\u4e2a\u957f\u5ea6\u4e3a2048\u7684\u6570\u7ec4\n    let i;\n    let sum = 0.0;\n    let clipcount = 0;\n    for (i = 0; i &lt; input.length; ++i) {\n      sum += input[i] * input[i];\n      if (Math.abs(input[i]) &gt; 0.99) {\n        clipcount += 1;\n      }\n    }\n    console.log('clip count', clipcount);\n    that.instant = Math.sqrt(sum / input.length);\n    that.slow = 0.95 * that.slow + 0.05 * that.instant;\n    that.clip = clipcount / input.length;\n  };\n}\n\nSoundMeter.prototype.connectToSource = function (stream, callback) {\n  console.log('SoundMeter connecting');\n  try {\n    this.mic = this.context.createMediaStreamSource(stream);\n    this.mic.connect(this.script);\n    this.script.connect(this.context.destination);\n    if (typeof callback !== 'undefined') {\n      callback(null);\n    }\n  } catch (e) {\n    console.error(e);\n    if (typeof callback !== 'undefined') {\n      callback(e);\n    }\n  }\n};\n\nSoundMeter.prototype.stop = function () {\n  console.log('SoundMeter \u6b63\u5728\u505c\u6b62');\n  this.mic.disconnect();\n  this.script.disconnect();\n};\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/audio-collection/#js","title":"js","text":"<p>\u83b7\u53d6\u9875\u9762\u5143\u7d20 <pre><code>'use strict';\n\nconst instantMeter = document.querySelector('#instant meter');\nconst slowMeter = document.querySelector('#slow meter');\nconst clipMeter = document.querySelector('#clip meter');\n\nconst instantValueDisplay = document.querySelector('#instant .value');\nconst slowValueDisplay = document.querySelector('#slow .value');\nconst clipValueDisplay = document.querySelector('#clip .value');\n\nconst playAudio = document.querySelector('#play-audio');\nconst msgEle2 = document.querySelector(\"#msg\");\nconst startBtn = document.getElementById(\"startBtn\");\nconst stopBtn = document.getElementById('stopBtn');\n\nlet meterRefresh = null;\n\nconst constraints = window.constraints = {\n  audio: true,\n  video: false\n};\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/audio-collection/#_3","title":"\u5f00\u542f\u9ea6\u514b\u98ce","text":"<p>\u5f00\u542f\u9ea6\u514b\u98ce\uff0c\u548c\u4e4b\u524d\u6253\u5f00\u6444\u50cf\u5934\u7c7b\u4f3c\uff0c\u7528\u7684\u4e5f\u662f<code>getUserMedia</code>\u65b9\u6cd5\u3002</p> <pre><code>startBtn.onclick = function (e) {\n  startBtn.disabled = true;\n  stopBtn.disabled = false;\n  try {\n    window.AudioContext = window.AudioContext || window.webkitAudioContext;\n    window.audioContext = new AudioContext();\n  } catch (e) {\n    alert('Web Audio API \u4e0d\u652f\u6301.');\n  }\n  navigator.mediaDevices.getUserMedia(constraints).then(gotAudioStream).catch(onErr);\n};\n</code></pre>","tags":["WebRTC"]},{"location":"webrtc/web-samples/audio-collection/#_4","title":"\u5904\u7406\u97f3\u9891","text":"<p>\u6210\u529f\u6253\u5f00\u9ea6\u514b\u98ce\u540e\uff0c\u5904\u7406\u97f3\u9891\u6d41 <pre><code>function gotAudioStream(stream) {\n  stream.oninactive = function () {\n    console.log('\u97f3\u9891\u505c\u6b62');\n  };\n  window.stream = stream;\n  playAudio.srcObject = stream;\n\n  console.log('\u5bf9\u63a5\u9ea6\u514b\u98ce\u7684\u97f3\u9891');\n\n  const soundMeter = window.soundMeter = new SoundMeter(window.audioContext);\n  soundMeter.connectToSource(stream, function (e) {\n    if (e) {\n      alert(e);\n      return;\n    }\n    meterRefresh = setInterval(() =&gt; {\n      instantMeter.value = instantValueDisplay.innerText =\n        soundMeter.instant.toFixed(2);\n      slowMeter.value = slowValueDisplay.innerText =\n        soundMeter.slow.toFixed(2);\n      clipMeter.value = clipValueDisplay.innerText =\n        soundMeter.clip;\n    }, 100);\n  });\n}\n\nfunction onErr(error) {\n  const errorMessage = '\u62a5\u9519 navigator.MediaDevices.getUserMedia : ' + error.message + ' ' + error.name;\n  msgEle2.innerText = errorMessage;\n  console.error(errorMessage);\n}\n</code></pre></p> <p>\u521b\u5efa<code>soundMeter</code>\uff0c\u5bf9\u63a5\u5230\u97f3\u9891\u6d41<code>soundMeter.connectToSource(stream, function(e){});</code></p> <p>\u8bbe\u7f6e\u4e00\u4e2a\u5b9a\u65f6\u5668<code>setInterval</code>\uff0c\u5b9a\u65f6\u5237\u65b0\u97f3\u91cf\u6570\u636e</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/audio-collection/#_5","title":"\u505c\u6b62","text":"<p>\u628a\u97f3\u9891\u6d41\u505c\u4e0b <pre><code>stopBtn.onclick = function (e) {\n  console.log('\u505c\u6b62');\n  startBtn.disabled = false;\n  stopBtn.disabled = true;\n  window.stream.getTracks().forEach(track =&gt; track.stop());\n  window.soundMeter.stop();\n  clearInterval(meterRefresh);\n  instantMeter.value = instantValueDisplay.innerText = '';\n  slowMeter.value = slowValueDisplay.innerText = '';\n  clipMeter.value = clipValueDisplay.innerText = '';\n}\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/audio-collection/#_6","title":"\u8fd0\u884c\u6548\u679c","text":"<p>\u8fd0\u884c\u6548\u679c\u94fe\u63a5</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/audio-collection/#_7","title":"\u5c0f\u7ed3","text":"<p>\u7528<code>getUserMedia</code>\u6253\u5f00\u9ea6\u514b\u98ce\uff0c\u83b7\u53d6\u97f3\u9891\u6d41\u3002\u4f7f\u7528AudioContext\u7684\u529f\u80fd\uff0c\u5f97\u5230\u97f3\u9891\u97f3\u91cf\u7684\u6570\u503c\u3002</p> <p></p> <p>WebRTC\u7cfb\u5217</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u77e5\u4e4e\u4e13\u680f cnblog \u534e\u4e3a\u4e91\u793e\u533a</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/canvas1/","title":"WebRTC\u4ece\u6444\u50cf\u5934\u83b7\u53d6\u56fe\u7247\u4f20\u5165canvas","text":"\u66f4\u65b0\u65e5\u671f: 2021-11-25 <ul> <li>2021-11-25 \u65b0\u5efa\u6587\u6863</li> </ul> <p>\u524d\u9762\u6211\u4eec\u5df2\u7ecf\u80fd\u591f\u5229\u7528WebRTC\u7684\u529f\u80fd\uff0c\u901a\u8fc7\u6d4f\u89c8\u5668\u6253\u5f00\u6444\u50cf\u5934\uff0c\u5e76\u628a\u9884\u89c8\u7684\u56fe\u50cf\u663e\u793a\u5728video\u5143\u7d20\u4e2d\u3002 \u63a5\u4e0b\u6765\u6211\u4eec\u5c1d\u8bd5\u4ece\u89c6\u9891\u4e2d\u622a\u53d6\u67d0\u4e00\u5e27\uff0c\u663e\u793a\u5728\u754c\u9762\u4e0a\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/canvas1/#html","title":"html","text":"<p>\u5148\u51c6\u5907\u4e00\u4e0b\u754c\u9762\uff0c\u6446\u4e0a\u63a7\u4ef6\u3002\u4e0b\u9762\u662f\u5173\u952e\u90e8\u5206\u7684\u4ee3\u7801\u3002 <pre><code>&lt;video playsinline autoplay&gt;&lt;/video&gt;\n&lt;button id=\"showVideo\"&gt;\u6253\u5f00\u6444\u50cf\u5934&lt;/button&gt;\n&lt;button id=\"takeSnapshot\"&gt;\u622a\u53d6&lt;/button&gt;\n&lt;button id=\"clearList\"&gt;\u6e05\u9664\u8bb0\u5f55&lt;/button&gt;\n&lt;canvas id=\"mainCanvas\"&gt;&lt;/canvas&gt;\n&lt;div id=\"list\" style=\"display: grid; grid-template-columns: repeat(auto-fill, 100px);\n    column-gap: 20px; row-gap: 20px;\"&gt;&lt;/div&gt;\n</code></pre></p> <ul> <li>video \u7528\u6765\u9884\u89c8\u89c6\u9891</li> <li>3\u4e2abutton\uff0c\u5206\u522b\u62ff\u6765\u6253\u5f00\u6444\u50cf\u5934\uff0c\u622a\u53d6\u56fe\u7247\u548c\u6e05\u9664\u8bb0\u5f55</li> <li>canvas \u7528\u6765\u663e\u793a\u622a\u53d6\u7684\u56fe\u7247</li> <li>\u4e0b\u9762\u7684div\u662f\u62ff\u6765\u5b58\u653e\u591a\u4e2a\u622a\u53d6\u56fe\u7247\u8bb0\u5f55\u7684\u3002\u7ed9\u5b83\u6307\u5b9a\u4e86grid\uff0c\u663e\u793a\u591a\u4e2a\u56fe\u7247\u65f6\u5019\u6bd4\u8f83\u597d\u770b\u4e00\u4e9b</li> </ul> <p>\u7167\u4f8b\uff0c\u9700\u8981\u5f15\u5165<code>adapter-latest.js</code> <pre><code>&lt;script src=\"https://webrtc.github.io/adapter/adapter-latest.js\"&gt;&lt;/script&gt;\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/canvas1/#js","title":"js","text":"<p>\u51c6\u5907\u5b9e\u73b0\u529f\u80fd\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/canvas1/#_1","title":"\u6253\u5f00\u6444\u50cf\u5934\u5e76\u9884\u89c8","text":"<p>\u548c\u4e4b\u524d\u7684\u6253\u5f00\u6444\u50cf\u5934\u7c7b\u4f3c\uff0c\u8fd8\u662f\u8981\u7528\u5230<code>getUserMedia</code>\u65b9\u6cd5\u3002\u62ff\u5230\u89c6\u9891\u6d41\u540e\u4ea4\u7ed9video\u53bb\u64ad\u653e\u3002 <pre><code>const video = document.querySelector('video');\nconst constraints = {\n  audio: false,\n  video: true\n};\n// ....\n\nfunction openCamera(e) {\n  navigator.mediaDevices.getUserMedia(constraints).then(gotStream).catch(onError);\n}\n\nfunction gotStream(stream) {\n  window.stream = stream;\n  video.srcObject = stream;\n}\n\nfunction onError(error) {\n  console.log('navigator.MediaDevices.getUserMedia error: ', error.message, error.name);\n}\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/canvas1/#_2","title":"\u622a\u53d6\u56fe\u7247","text":"<p>\u62ff\u5230\u754c\u9762\u4e2d\u7684canvas\uff0c\u5148\u9884\u5b9a\u4e00\u4e2a\u5c3a\u5bf8\uff08\u4e0d\u9884\u5b9a\u4e5f\u884c\uff09\u3002 <pre><code>const mCanvas = window.canvas = document.querySelector('#mainCanvas');\nmCanvas.width = 480;\nmCanvas.height = 360;\n\n// \u5f00\u59cb\u622a\u53d6\n  mCanvas.width = video.videoWidth;\n  mCanvas.height = video.videoHeight;\n  mCanvas.getContext('2d').drawImage(video, 0, 0, mCanvas.width, mCanvas.height);\n</code></pre> \u53d1\u8d77\u622a\u53d6\u540e\uff0c\u4f7f\u7528<code>getContext</code>\u83b7\u53d6\u5230CanvasRenderingContext2D\u5bf9\u8c61\u3002\u7136\u540e\u8c03\u7528\u5b83\u7684<code>drawImage</code>\u65b9\u6cd5\u3002 \u628avideo\u4e2d\u7684\u89c6\u9891\u5e27\u7ed8\u5236\u8fdb\u53bb\u3002</p> <p>\u9664\u4e86\u7ed8\u5236\u8fd9\u4e00\u4e2acanvas\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6bcf\u6b21\u53d1\u8d77\uff08\u70b9\u51fb\u6309\u94ae\uff09\u7684\u65f6\u5019\u521b\u5efa\u65b0\u7684canvas\uff0c\u628a\u5b83\u4eec\u50cf\u76f8\u518c\u4e00\u6837\u5c55\u793a\u51fa\u6765\u3002</p> <p><pre><code>const list = document.querySelector('#list'); // \u62ff\u6765\u5b58\u653e\u591a\u4e2a\u5143\u7d20\n\n  // \u65b0\u589e1\u5f20\n  var divItem = document.createElement(\"div\");\n  divItem.style.display = \"block\";\n  divItem.width = 100;\n  divItem.height = divItem.width * video.videoHeight / video.videoWidth; // \u8ba1\u7b97\u4e00\u4e0b\u6bd4\u4f8b\n  divItem.style.width = divItem.width + \"px\";\n  divItem.style.height = divItem.height + \"px\";\n  console.log(\"div item size: \", divItem.width, divItem.height);\n\n  var c1 = document.createElement(\"canvas\");\n  c1.width = divItem.width;\n  c1.height = divItem.height;\n  c1.getContext('2d').drawImage(video, 0, 0, mCanvas.width, mCanvas.height, 0, 0, c1.width, c1.height);\n\n  divItem.appendChild(c1);\n  list.appendChild(divItem);\n</code></pre> \u5b50\u9879\u7684\u5b58\u653e\u65b9\u5f0f\u662fdiv\u5305\u88f9canvas\u3002\u5148\u7528<code>document.createElement(\"div\")</code>\u521b\u5efa<code>divItem</code>\u3002 \u6309\u7167\u89c6\u9891\u7684\u5bbd\u9ad8\uff0c\u8ba1\u7b97\u8c03\u6574<code>divItem</code>\u7684\u5927\u5c0f\uff0c\u5e76\u8bbe\u7f6estyle\u3002</p> <p><code>document.createElement(\"canvas\")</code>\u521b\u5efa<code>c1</code>\uff0c\u5b83\u7684\u5bbd\u9ad8\u8bbe\u7f6e\u4e3a\u524d\u9762<code>divItem</code>\u7684\u5bbd\u9ad8\u3002\u7136\u540e\u628a\u56fe\u7247\u7ed8\u5236\u8fdb\u53bb\u3002 <code>drawImage</code>\u65f6\uff0c\u524d\u9762\u4f20\u5165\u7684\u662f\u89c6\u9891\uff08\u6e90\uff09\u7684\u8303\u56f4\uff0c\u540e\u9762\u76844\u4e2a\u53c2\u6570\u662f\u81ea\u5df1\u7684\u7ed8\u5236\u8303\u56f4\u3002 \u8fd9\u6837\u4e00\u4e2a\u5b50\u9879\u5c31\u751f\u6210\u5b8c\u6bd5\u4e86\u3002\u6dfb\u52a0\u5230\u6211\u4eec\u51c6\u5907\u597d\u7684\u5217\u8868\uff08div\uff09\u4e2d\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/canvas1/#_3","title":"\u6e05\u9664\u8bb0\u5f55","text":"<p>\u6e05\u9664div\uff08<code>list</code>\uff09\u91cc\u7684\u5b50\u9879\u3002\u7528\u4e00\u4e2a\u5faa\u73af\u83b7\u53d6\u5e76\u79fb\u9664\u5b50\u9879\u3002 <pre><code>var child = list.lastElementChild;\nwhile (child) {\n    list.removeChild(child);\n    child = list.lastElementChild;\n}\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/canvas1/#_4","title":"\u5c0f\u7ed3","text":"<p>\u6253\u5f00\u6444\u50cf\u5934\uff0c\u663e\u793a\u89c6\u9891\u3002\u628a\u89c6\u9891\u7ed8\u5236\u5230canvas\u4e0a\u3002\u521b\u5efa\u591a\u4e2acanvas\uff0c\u505a\u6210\u5386\u53f2\u8bb0\u5f55\u7684\u6548\u679c\u3002 \u4e3b\u8981\u5229\u7528\u7684\u8fd8\u662fcanvas\u7684\u7ed8\u5236\u65b9\u6cd5\u3002\u7ed8\u5236\u7684\u65f6\u5019\u6ce8\u610f\u4f20\u5165\u7684\u53c2\u6570\uff0c\u80fd\u591f\u6307\u5b9a\u7ed8\u5236\u7684\u8fb9\u754c\u3002 \u4e5f\u5c31\u662f\u8bf4\u53ea\u7ed8\u5236\u89c6\u9891\u5927\u5c0f\u4e2d\u7684\u4e00\u90e8\u5206\u4e5f\u662f\u53ef\u884c\u7684\u3002</p> <p>\u793a\u4f8b\u4e2d\u7528\u5230\u7684\u5173\u952e\u65b9\u6cd5</p> <ul> <li><code>getUserMedia</code></li> <li><code>getContext</code></li> <li><code>drawImage</code></li> <li><code>createElement</code></li> </ul> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u6398\u91d1 cnblog \u77e5\u4e4e \u7b80\u4e66 \u534e\u4e3a\u4e91\u793e\u533a csdn</p> <p></p> <p>WebRTC\u7cfb\u5217</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/canvas1/#_5","title":"\u9884\u89c8","text":"<p>\u5b8c\u6574\u7684\u9884\u89c8\u94fe\u63a5</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/canvas1/#_6","title":"\u7b80\u6613\u9884\u89c8","text":"<p>\u4e0b\u9762\u662f\u7b80\u6613\u9884\u89c8</p> \u6253\u5f00\u6444\u50cf\u5934 \u622a\u53d6 \u6e05\u9664\u8bb0\u5f55","tags":["WebRTC"]},{"location":"webrtc/web-samples/css-filters/","title":"WebRTC\u4e0eCSS\u6ee4\u955c\uff08CSS filter\uff09","text":"\u66f4\u65b0\u65e5\u671f: 2021-11-29 <ul> <li>2021-11-29 \u65b0\u5efa\u6587\u6863</li> </ul> <p>\u6211\u4eec\u77e5\u9053\u4e86\u5982\u4f55\u4f7f\u7528WebRTC\u6253\u5f00\u6444\u50cf\u5934\uff0c\u53ef\u4ee5\u622a\u53d6\u89c6\u9891\u5e27\u5e76\u4e14\u7528canvas\u663e\u793a\u51fa\u6765\u3002</p> <p>\u672c\u6587\u5c06\u6ee4\u955c\u4e0e\u89c6\u9891\u7ed3\u5408\u3002\u7ed9\u89c6\u9891\u52a0\u4e0a\u4e00\u5c42\u6ee4\u955c\u3002\u4e3b\u8981\u4f7f\u7528\u5230\u7684\u662f<code>filter</code>\u5c5e\u6027\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/css-filters/#canvas","title":"canvas\u4e0e\u6ee4\u955c","text":"<p>\u5148\u6765\u770bfilter\u4e0ecanvas\u7684\u4f7f\u7528\u3002\u5148\u628acanvas\u653e\u597d\uff0c\u663e\u793a\u4e00\u5f20\u672c\u5730\u7684\u56fe\u7247\u3002</p> <pre><code>&lt;canvas id=\"sample-canvas\" style=\"width: 358px;height: 100%;\"&gt;&lt;/canvas&gt;\n</code></pre> <p>\u7528Image\u628a\u56fe\u7247\u8bfb\u8fdb\u6765\uff0c\u7136\u540e\u7ed9canvas\u6765\u663e\u793a\u3002\u4e3a\u4e86\u6f14\u793a\u65b9\u4fbf\uff0ccanvas\u7684\u5bbd\u9ad8\u548c\u56fe\u7247\u5bbd\u9ad8\u662f\u4e00\u81f4\u7684\u3002 <pre><code>const sampleCanvas = document.querySelector('#sample-canvas');\nvar img = new Image();\nimg.src = 'webrtc-fish.png'; // rustfisher.com pic\nimg.onload = function () {\n  sampleCanvas.getContext('2d').drawImage(img, 0, 0, sampleCanvas.width, sampleCanvas.height);\n}\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/css-filters/#slider","title":"slider","text":"<p>Android\u4e2d\u6709SeekBar\u3002\u5728\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u81ea\u5b9a\u4e49\u4e00\u4e2aslider\u3002\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u9700\u6c42\uff0c\u6216\u8005\u4f7f\u7528\u5df2\u6709\u7684\u6ed1\u52a8\u9009\u62e9\u5668\u3002 <pre><code>/* \u9009\u62e9\u8fdb\u5ea6 */\n.slider-container {\n    width: 100%;\n    display: flex;\n    justify-content: left;\n    align-items: center;\n}\n\n/* \u6ed1\u52a8\u9009\u62e9\u5668 */\n.slider {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 80%;\n    height: 100%;\n    background: #d3d3d3;\n    outline: none;\n    opacity: 0.7;\n    -webkit-transition: .2s;\n    transition: opacity .2s;\n}\n\n.slider:hover {\n    opacity: 1;\n}\n\n.slider::-webkit-slider-thumb {\n    -webkit-appearance: none;\n    appearance: none;\n    width: 20px;\n    height: 20px;\n    background: #0c23f7;\n    cursor: pointer;\n}\n\n.slider::-moz-range-thumb {\n    width: 20px;\n    height: 20px;\n    background: #044caa;\n    cursor: pointer;\n}\n</code></pre></p> <p>\u5b9a\u4e49\u51e0\u79cd\u6ee4\u955c\uff0c\u51c6\u5907\u4f7f\u7528\u3002</p> <ul> <li>Blur \u6548\u679c\u662f\u7cca\u5316</li> <li>Grayscale \u6548\u679c\u662f\u7070\u5ea6</li> <li>Invert \u6548\u679c\u662f\u53cd\u8f6c</li> <li>Sepia \u6548\u679c\u662f\u6df1\u8910\u8272</li> </ul> <p><pre><code>&lt;select id=\"filter\"&gt;\n    &lt;option value=\"none\"&gt;None&lt;/option&gt;\n    &lt;option value=\"blur\"&gt;Blur&lt;/option&gt;\n    &lt;option value=\"grayscale\"&gt;Grayscale&lt;/option&gt;\n    &lt;option value=\"invert\"&gt;Invert&lt;/option&gt;\n    &lt;option value=\"sepia\"&gt;Sepia&lt;/option&gt;\n&lt;/select&gt;\n&lt;div class=\"slider-container\"&gt;\n    &lt;p id=\"slide-value\" style=\"width: 10%; height: 100%;\"&gt;&lt;/p&gt;\n    &lt;input type=\"range\" min=\"1\" max=\"100\" value=\"10\" class=\"slider\" id=\"myRange\"&gt;\n&lt;/div&gt;\n</code></pre> \u9009\u62e9\u5668\u7528\u4e86<code>input</code>\u5143\u7d20\uff0c\u6570\u503c\u8303\u56f41\uff5e100\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/css-filters/#canvasfilter","title":"canvas+filter","text":"<p>\u4f7f\u7528\u6ee4\u955c\u65f6\uff0c\u9700\u8981\u6539\u53d8\u5143\u7d20style\u7684filter\u503c\u3002 <code>blur</code>\u7684\u5355\u4f4d\u662f<code>px</code>\u3002\u5176\u5b83\u53ef\u4ee5\u4f7f\u7528<code>%</code>\u3002\u628a\u79cd\u7c7b\u548c\u6570\u503c\u62fc\u63a5\u6210\u5b57\u7b26\u4e32\uff0c\u4f5c\u4e3afilter\u7684\u503c\u3002 <pre><code>const filterSelect = document.querySelector('select#filter');\nfilterSelect.onchange = function () {\n  changeFilter();\n};\n\n// \u6539\u53d8\u6ee4\u955c\u7684\u503c\nfunction changeFilter() {\n  var filterValue = \"\" + filterSelect.value + \"(\" + slider.value + \"%)\";\n  if (filterSelect.value == \"blur\") {\n    filterValue = \"\" + filterSelect.value + \"(\" + slider.value + \"px)\";\n  } else if (filterSelect.value == \"none\") {\n    filterValue = \"\";\n  }\n  sampleCanvas.style.filter = filterValue; // \u56fe\u7247\u7684\u6ee4\u955c\n}\n\nslider.oninput = function () {\n  sliderValue.innerHTML = this.value;\n  changeFilter();\n}\n</code></pre></p> <p>\u4e0d\u540c\u7684\u6548\u679c\u9884\u89c8\u5982\u4e0b</p> \u6548\u679c\u540d \u793a\u4f8b\u56fe \u539f\u56fe blur gray invert sepia <p>\u8c03\u6574\u8fdb\u5ea6\u9009\u62e9\u6570\u503c\uff0c\u53ef\u4ee5\u5f97\u5230\u770b\u5230\u6548\u679c\u52a0\u5f3a/\u51cf\u5f31\u7684\u6837\u5b50\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/css-filters/#_1","title":"\u7ed3\u5408\u89c6\u9891","text":"<p>\u6709\u4e86\u4e0a\u9762\u7684\u5c1d\u8bd5\uff0c\u6211\u4eec\u53ef\u4ee5\u628afilter\u52a0\u5230video\u4e0a\u8bd5\u8bd5\u3002</p> <p>\u9996\u5148\u8fd8\u662f\u5f15\u5165webrtc\u7684adapter\u3002 <pre><code>&lt;script src=\"https://webrtc.github.io/adapter/adapter-latest.js\"&gt;&lt;/script&gt;\n</code></pre></p> <p>\u7f51\u7edc\u4e0d\u597d\u7684\u540c\u5b66\uff0c\u4e5f\u53ef\u4ee5\u4e0b\u8f7d\u8fd9\u4e2a\u6587\u4ef6\u653e\u5728\u4f60\u7684\u672c\u5730\u670d\u52a1\u5668\u4e0a\u3002\u6bd4\u5982 <pre><code>&lt;script src=\"../js/adapter-latest.js\" async&gt;&lt;/script&gt;\n</code></pre></p> <p>\u653e\u7f6evideo\uff0cbutton\u548ccanvas\u3002video\u9884\u89c8\u6444\u50cf\u5934\uff0ccanvas\u7528\u6765\u663e\u793a\u622a\u53d6\u7684\u56fe\u50cf\u3002 <pre><code>&lt;video playsinline autoplay&gt;&lt;/video&gt;\n&lt;button id=\"start\"&gt;\u6253\u5f00\u6444\u50cf\u5934&lt;/button&gt;\n&lt;button id=\"snapshot\"&gt;\u622a\u53d6&lt;/button&gt;\n&lt;canvas id=\"main\"&gt;&lt;/canvas&gt;\n</code></pre></p> <p>\u548c\u524d\u9762\u7684\u4e24\u7bc7\u6587\u7ae0\u7c7b\u4f3c\uff0c\u5148\u6765\u6253\u5f00\u6444\u50cf\u5934\uff0c\u7136\u540e\u628a\u6444\u50cf\u5934\u7684\u6d41\u4ea4\u7ed9<code>video</code>\u3002 <pre><code>const snapshotButton = document.querySelector('button#snapshot');\nconst video = window.video = document.querySelector('video');\nconst canvas = window.canvas = document.querySelector('canvas#main');\ncanvas.width = 480;\ncanvas.height = 360;\n\nfunction startVideo() {\n  navigator.mediaDevices.getUserMedia(constraints).then(gotStream).catch(onError);\n}\n\nfunction gotStream(stream) {\n  window.stream = stream;\n  video.srcObject = stream;\n}\n</code></pre> \u5141\u8bb8\u6d4f\u89c8\u5668\u4f7f\u7528\u6444\u50cf\u5934\uff08mac\u53ef\u80fd\u8fd8\u9700\u8981\u591a\u5141\u8bb8\u4e00\u6b21\u6743\u9650\uff09\u3002</p> <p>\u8fd9\u6b21\u6211\u4eec\u8981\u66f4\u6539video\u7684filter\u3002\u6539\u53d8\u6ee4\u955c\u7684\u79cd\u7c7b\u65f6\uff0c\u628a\u6ee4\u955c\u8bbe\u7f6e\u7ed9canvas\u548cvideo\u7684style\u3002 <pre><code>function changeFilter() {\n  var filterValue = \"\" + filterSelect.value + \"(\" + slider.value + \"%)\";\n  if (filterSelect.value == \"blur\") {\n    filterValue = \"\" + filterSelect.value + \"(\" + slider.value + \"px)\";\n  } else if (filterSelect.value == \"none\") {\n    filterValue = \"\";\n  }\n  sampleCanvas.style.filter = filterValue; // \u56fe\u7247\u7684\u6ee4\u955c\n  canvas.style.filter = filterValue;       // \u56fe\u7247\u7684\u6ee4\u955c\n  video.style.filter = filterValue;        // \u89c6\u9891\u9884\u89c8\u7684\u6ee4\u955c\n}\n</code></pre></p> <p>\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u6211\u4eec\u7684\u6ee4\u955c\u662f\u52a0\u5728\u5143\u7d20\u4e0a\u7684\uff0c\u5e76\u6ca1\u6709\u5f71\u54cd\u89c6\u9891\u548c\u56fe\u7247\u3002\u4e5f\u5c31\u662f\u8bf4\u8fd9\u662f\u4e2a\u9644\u52a0\u7684\u6548\u679c\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/css-filters/#_2","title":"\u5c0f\u7ed3","text":"<p>\u672c\u6587\u5c06css\u6ee4\u955c\u7684\u6548\u679c\u5e94\u7528\u5728video\u548ccanvas\u4e0a\u3002\u7ed9\u89c6\u9891\u548c\u56fe\u7247\u589e\u52a0\u4e86\u4e30\u5bcc\u7684\u6548\u679c\u3002</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a \u6398\u91d1 cnblog \u77e5\u4e4e \u7b80\u4e66</p> <p></p> <p>WebRTC\u7cfb\u5217</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/css-filters/#_3","title":"\u7b80\u6613\u9884\u89c8","text":"<p>\u4e0b\u9762\u662f\u7b80\u6613\u9884\u89c8\u3002\u5b8c\u6574\u9884\u89c8\u8bf7\u53c2\u8003 webrtc\u4e0ecss\u6ee4\u955c\u793a\u4f8b</p> <p></p> <p>\u5148\u6765\u9009\u62e9\u6ee4\u955c\uff0c\u770b\u770b\u5de6\u8fb9\u56fe\u7247\u7684\u6548\u679c</p> \u6ee4\u955c\u9009\u62e9:  None Blur Grayscale Invert Sepia <p></p> \u6253\u5f00\u6444\u50cf\u5934 \u622a\u53d6","tags":["WebRTC"]},{"location":"webrtc/web-samples/getUserMedia-open-camera/","title":"WebRTC\u6253\u5f00\u672c\u5730\u6444\u50cf\u5934","text":"\u66f4\u65b0\u65e5\u671f: 2022-5-20 <ul> <li>2022-5-20 \u8c03\u6574\u89c6\u9891\u5927\u5c0f</li> <li>2022-5-17 \u66f4\u65b0js\u6e90</li> <li>2021-11-24 \u65b0\u5efa\u6587\u6863</li> </ul> <p>\u672c\u6587\u4f7f\u7528WebRTC\u7684\u529f\u80fd\uff0c\u6253\u5f00\u7535\u8111\u4e0a\u7684\u6444\u50cf\u5934\uff0c\u5e76\u4e14\u628a\u6444\u50cf\u5934\u9884\u89c8\u5230\u7684\u56fe\u50cf\u663e\u793a\u51fa\u6765\u3002 \u7eaf\u7f51\u9875\u5b9e\u73b0\uff0c\u80fd\u652f\u6301\u9664IE\u5916\u7684\u591a\u6570\u6d4f\u89c8\u5668\u3002\u624b\u673a\u6d4f\u89c8\u5668\u4e5f\u53ef\u7528\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getUserMedia-open-camera/#_1","title":"\u5f15\u5165\u4f9d\u8d56","text":"<p>\u6211\u4eec\u9700\u8981\u5f15\u5165<code>adapter-latest.js</code> <pre><code>&lt;script src=\"https://webrtc.github.io/adapter/adapter-latest.js\"&gt;&lt;/script&gt; &lt;!-- (1) --&gt;\n</code></pre></p> <ol> <li>\u6709\u53ef\u80fd\u56e0\u7f51\u7edc\u539f\u56e0\u8fde\u63a5\u4e0d\u5230GitHub\uff0c\u5f00\u53d1\u65f6\u5019\u8bf7\u6ce8\u610f\u8fd9\u70b9</li> </ol> <p>\u8fd9\u4e2aWebRTC adapter\u66fe\u662fWebRTC\u4e2d\u7684\u4e00\u90e8\u5206\uff0c\u4f46\u73b0\u5728\u88ab\u79fb\u51fa\u6765\u4e86\u3002 \u6211\u4eec\u4f1a\u7528\u5230\u5b83\u63d0\u4f9b\u7684\u529f\u80fd\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getUserMedia-open-camera/#html","title":"html","text":"<p>\u6211\u4eec\u5728\u754c\u9762\u4e0a\u5148\u6446\u653e\u4e00\u4e9b\u63a7\u4ef6\u3002 <pre><code>&lt;div id=\"container\"&gt;\n    &lt;video id=\"video-local\" autoplay playsinline&gt;&lt;/video&gt;\n    &lt;button id=\"showVideo\"&gt;\u6253\u5f00\u6444\u50cf\u5934&lt;/button&gt;\n    &lt;button id=\"stopVideo\"&gt;\u5173\u95ed\u6444\u50cf\u5934&lt;/button&gt;\n    &lt;p&gt;\u663e\u793a\u6444\u50cf\u5934\u9884\u89c8\u7684\u5185\u5bb9\uff0c\u7f51\u9875\u4e0a\u7531\u5143\u7d20video\u6765\u5448\u73b0\u3002&lt;/p&gt;\n    &lt;p&gt;\u70b9\u51fb\u6253\u5f00\u6444\u50cf\u5934\u6309\u94ae\u540e\uff0c\u6d4f\u89c8\u5668\u4f1a\u8be2\u95ee\u662f\u5426\u5141\u8bb8\uff0c\u8bf7\u70b9\u51fb\u201c\u5141\u8bb8\u201d\u3002&lt;/p&gt;\n    &lt;div id=\"errorMsg\"&gt;&lt;/div&gt;\n    &lt;div id=\"tipMsg\"&gt;&lt;/div&gt;\n&lt;/div&gt;\n</code></pre></p> <ul> <li>video \u7528\u6765\u663e\u793a\u9884\u89c8\u7684\u89c6\u9891</li> <li>\u4e24\u4e2abutton\u7528\u6765\u63a7\u5236\u5f00\u542f\u548c\u5173\u95ed</li> <li>\u518d\u653e\u51e0\u4e2a\u663e\u793a\u4fe1\u606f\u7684\u5730\u65b9</li> </ul>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getUserMedia-open-camera/#js","title":"js","text":"<p>\u5148\u8bbe\u7f6e\u4e00\u4e0b\uff0c\u6211\u4eec\u53ea\u4f7f\u7528\u89c6\u9891 <pre><code>const constraints = window.constraints = {\n  audio: false,\n  video: true\n};\n</code></pre></p> <p>\u5728\u7f51\u9875\u4e0a\u663e\u793a\u4e00\u4e9b\u4fe1\u606f\uff0c\u4fbf\u4e8e\u8c03\u8bd5\u3002 <pre><code>function showErrMsg(msg, error) {\n  const errorElement = document.querySelector('#errorMsg');\n  errorElement.innerHTML += `&lt;p&gt;${msg}&lt;/p&gt;`;\n  if (typeof error !== 'undefined') {\n    console.error(error);\n  }\n}\n\nfunction showMsg(msg) {\n    const msgEle = document.querySelector('#tipMsg');\n    msgEle.innerHTML += `&lt;p&gt;-&gt; ${msg}&lt;/p&gt;`;\n    console.log(msg);\n}\n</code></pre></p> <p>\u5b8c\u6574\u4ee3\u7801\u5728main.js\u4e2d\u3002css\u53ef\u81ea\u884c\u5b9a\u4e49\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getUserMedia-open-camera/#_2","title":"\u6253\u5f00\u6444\u50cf\u5934","text":"<p>\u8981\u6253\u5f00\u6444\u50cf\u5934\uff0c\u4f7f\u7528<code>MediaDevices.getUserMedia()</code>\u65b9\u6cd5 <pre><code>async function openCamera(e) {\n  try {\n    showMsg('\u6b63\u5728\u6253\u5f00\u6444\u50cf\u5934');\n    const stream = await navigator.mediaDevices.getUserMedia(constraints);\n    showMsg('\u83b7\u53d6\u5230\u4e86stream');\n    gotStream(stream);\n    e.target.disabled = true;\n  } catch (err) {\n    onErr(err);\n  }\n</code></pre> <code>MediaDevices.getUserMedia()</code>\u65b9\u6cd5\u5728\u7528\u6237\u5141\u8bb8\u540e\uff0c\u6309\u7167\u8bf7\u6c42\uff0c\u62ff\u5230stream\u3002 stream\u53ef\u4ee5\u5305\u542b\u89c6\u9891\u6216\u97f3\u9891\u3002\u524d\u9762\u7684\u8bbe\u5b9a\u91cc\uff0c\u6211\u4eec\u53ea\u4f7f\u7528\u89c6\u9891\u3002</p> <p>\u5982\u679c\u7528\u6237\u62d2\u7edd\u4e86\u4f7f\u7528\u6444\u50cf\u5934\u7533\u8bf7\uff0c\u6216\u8005\u7533\u8bf7\u7684\u5a92\u4f53\u4e0d\u53ef\u7528\uff0c\u5373\u8868\u73b0\u4e3a\u88ab\u62d2\u7edd\u3002 \u7528\u6237\u62d2\u7edd\u4f1a\u62a5NotAllowedError\uff0c\u627e\u4e0d\u5230\u7b26\u5408\u8981\u6c42\u7684\u8bbe\u5907\u4f1a\u62a5NotFoundError DOMException\u3002</p> <p>\u65b9\u6cd5\u7684\u6587\u6863MediaDevices.getUserMedia()</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getUserMedia-open-camera/#_3","title":"\u663e\u793a\u89c6\u9891","text":"<p>\u83b7\u53d6\u5230stream\u540e\uff0c\u8ba9video\u663e\u793a\u89c6\u9891 <pre><code>function gotStream(stream) {\n  const videoEle = document.querySelector('video');\n  const videoTracks = stream.getVideoTracks();\n  showMsg(`\u6b63\u5728\u4f7f\u7528\u7684\u8bbe\u5907: ${videoTracks[0].label}`);\n  window.stream = stream;\n  videoEle.srcObject = stream;\n}\n</code></pre> <code>document.querySelector('video')</code>\u76f4\u63a5\u83b7\u53d6html\u4e0a\u7684video\u63a7\u4ef6\u3002 \u628astream\u76f4\u63a5\u4ea4\u7ed9<code>videoEle.srcObject</code>\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getUserMedia-open-camera/#_4","title":"\u505c\u6b62\u89c6\u9891\u6d41","text":"<p>\u8981\u505c\u6b62\u89c6\u9891\uff0c\u6211\u4eec\u53ef\u4ee5\u4ecevideo\u5143\u7d20\u5165\u624b\uff0c\u62ff\u5230stream\uff0c\u7136\u540e\u628a\u91cc\u9762\u7684track\u505c\u6389\u3002 <pre><code>function stopVideo(e) {\n    showMsg(\"\u505c\u6b62\u89c6\u9891\");\n    const videoElem = document.querySelector('video');\n    const stream = videoElem.srcObject;\n\n    document.querySelector('#showVideo').disabled = false; // \u5141\u8bb8\u5f00\u542f\n\n    if(stream == null) {\n        return;\n    }\n    const tracks = stream.getTracks();\n\n    tracks.forEach(function(track) {\n      track.stop();\n    });\n    videoElem.srcObject = null;\n}\n</code></pre> <code>stream.getTracks()</code>\u65b9\u6cd5\u62ff\u5230\u6240\u6709\u7684\u8f68\u9053\uff08track\uff09\uff0c\u904d\u5386\u4e00\u904d\u5168\u90e8\u5173\u6389\u3002 \u6700\u540e\uff0c\u628a<code>videoElem.srcObject</code>\u8bbe\u7f6e\u4e3anull\uff0c\u5b83\u4e0e\u524d\u9762\u7684<code>stream</code>\u89e3\u9664\u5173\u8054\uff0c\u65b9\u4fbf\u5c06\u5b83\u91ca\u653e\u3002</p> <p>\u53c2\u8003 MediaStreamTrack-stop</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getUserMedia-open-camera/#_5","title":"\u5c0f\u7ed3","text":"<p>\u793a\u4f8b\u4f7f\u7528\u7684WebRTC\u7684\u529f\u80fd\u3002\u663e\u793a\u7684\u662f\u672c\u5730\u6444\u50cf\u5934\u7684\u89c6\u9891\uff0c\u4e0d\u6d89\u53ca\u4f20\u8f93\u3002\u62ff\u5230\u89c6\u9891\u6d41\u540e\u4ea4\u7ed9<code>video</code>\u6765\u663e\u793a\u3002 <code>getUserMedia</code>\u662f\u793a\u4f8b\u4e2d\u6700\u5173\u952e\u7684\u65b9\u6cd5\u3002\u4ee5\u540e\u7684\u793a\u4f8b\u90fd\u4f1a\u7528\u5230\u5b83\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getUserMedia-open-camera/#_6","title":"\u53c2\u8003","text":"<ul> <li>webrtc-adapter github</li> </ul> <p>\u672c\u6587\u94fe\u63a5 - WebRTC\u6253\u5f00\u672c\u5730\u6444\u50cf\u5934</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u6398\u91d1 \u534e\u4e3a\u4e91\u793e\u533a cnblog \u77e5\u4e4e \u7b80\u4e66 csdn \u5934\u6761</p> <p></p> <p>WebRTC\u7cfb\u5217</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getUserMedia-open-camera/#_7","title":"\u6548\u679c\u9884\u89c8","text":"<p>\u5b8c\u6574\u7684\u6548\u679c\u8bf7\u53c2\u8003  open-camera - an.rustfisher.com</p> <p>\u4ee5\u4e0b\u662f\u7b80\u6613\u6548\u679c\uff0c\u6253\u5f00\u6444\u50cf\u5934</p> \u6253\u5f00\u6444\u50cf\u5934 \u5173\u95ed\u6444\u50cf\u5934","tags":["WebRTC"]},{"location":"webrtc/web-samples/getdisplaymedia/","title":"WebRTC\u672c\u5730\u5206\u4eab\u5c4f\u5e55\uff0c\u5f55\u5236\u5c4f\u5e55","text":"\u66f4\u65b0\u65e5\u671f: 2021-12-10 <ul> <li>2021-12-10 webm\u8bf4\u660e</li> <li>2021-12-05 \u65b0\u5efa\u6587\u6863</li> </ul> <p>WebRTC\u6709\u5206\u4eab\u5c4f\u5e55\u7684\u529f\u80fd\u3002\u4f7f\u7528\u7684\u662f<code>getDisplayMedia</code>\u65b9\u6cd5\u3002\u7528\u6237\u540c\u610f\u5206\u4eab\u5c4f\u5e55\u540e\uff0c\u53ef\u4ee5\u62ff\u5230\u89c6\u9891\u6d41\u3002 \u518d\u7ed3\u5408MediaRecorder\u548cBlob\uff0c\u628a\u89c6\u9891\u6d41\u6570\u636e\u5b58\u4e0b\u6765\uff0c\u5c31\u80fd\u5f97\u5230\u5f55\u5236\u5c4f\u5e55\u7684\u89c6\u9891\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getdisplaymedia/#html","title":"html","text":"<p>\u7167\u4f8b\u5148\u6765\u6446\u653e\u4e00\u4e9b\u5143\u7d20\u5728\u754c\u9762\u4e0a <pre><code>&lt;div id=\"container\"&gt;\n&lt;h3&gt;WebRTC\u6355\u6349\u5c4f\u5e55\u793a\u4f8b getDisplayMedia&lt;/span&gt;&lt;/h1&gt;\n\n    &lt;video id=\"gum-local\" autoplay playsinline muted&gt;&lt;/video&gt;\n    &lt;button id=\"startBtn\" disabled&gt;\u5f00\u59cb\u9884\u89c8&lt;/button&gt;\n    &lt;button id=\"recordBtn\" disabled&gt;\u5f00\u59cb\u5f55\u5236&lt;/button&gt;\n    &lt;button id=\"downloadBtn\" disabled&gt;\u4e0b\u8f7d&lt;/button&gt;\n\n    &lt;div id=\"msg\"&gt;&lt;/div&gt;\n&lt;/div&gt;\n\n&lt;!-- \u4f7f\u7528\u672c\u5730\u7684\u9002\u914d\u5668 --&gt;\n&lt;script src=\"../js/adapter-latest.js\" async&gt;&lt;/script&gt;\n&lt;script src=\"js/main.js\"&gt;&lt;/script&gt;\n</code></pre></p> <p>\u56e0\u4e3a\u6211\u7684\u7f51\u901f\u4e0d\u662f\u5f88\u597d\uff0c\u628aadapter\u6587\u4ef6\u4e0b\u8f7d\u5230\u672c\u5730\u6765\u7528\u4e86\u3002 \u5982\u679c\u8981\u4f7f\u7528\u5b98\u65b9\u7684\u9002\u914d\u5668adapter\uff0c\u6309\u4e0b\u8fb9\u7684\u5730\u5740\u6765\u5f15\u5165 <pre><code>&lt;script src=\"https://webrtc.github.io/adapter/adapter-latest.js\"&gt;&lt;/script&gt;\n</code></pre></p> <ul> <li>video \u7528\u6765\u9884\u89c8\u89c6\u9891\u3002\u5f00\u59cb\u5206\u4eab\u89c6\u9891\u540e\uff0c\u628a\u89c6\u9891\u6d41\u4ea4\u7ed9\u5b83</li> <li>\u653e\u7f6e\u4e00\u4e9b\u6309\u94ae\uff0c\u5904\u7406\u4ea4\u4e92</li> <li>div#msg \u7528\u6765\u663e\u793a\u4fe1\u606f</li> </ul>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getdisplaymedia/#_1","title":"\u63a7\u5236","text":"<p>\u5728main.js\u6587\u4ef6\u91cc\u5199\u4e0a\u6211\u4eec\u7684\u63a7\u5236\u903b\u8f91</p> <p>\u5148\u628a\u83b7\u53d6\u5143\u7d20 <pre><code>'use strict';\n\nconst startBtn = document.getElementById('startBtn');\nconst recordBtn = document.getElementById('recordBtn');\nconst downloadBtn = document.getElementById('downloadBtn');\nconst video = document.querySelector('video'); // \u9884\u89c8\u7528\u7684\n\nlet mediaRecorder;\nlet isRecording = false;\nlet recordedBlobs = []; // \u6682\u5b58\u89c6\u9891\u6570\u636e\u7684\u5730\u65b9\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getdisplaymedia/#_2","title":"\u542f\u52a8\u5c4f\u5e55\u5206\u4eab","text":"<p>\u4e3b\u8981\u5229\u7528<code>getDisplayMedia</code>\u65b9\u6cd5\u3002\u6211\u4eec\u8fd9\u91cc\u53ea\u4f7f\u7528\u89c6\u9891<code>video: true</code> <pre><code>startBtn.addEventListener('click', () =&gt; {\n  navigator.mediaDevices.getDisplayMedia({video: true})\n      .then(gotDisplayStream, onErr);\n});\n\n// \u62ff\u5230\u5c4f\u5e55\u6570\u636e\u6d41\nfunction gotDisplayStream(stream) {\n  startBtn.disabled = true;\n  video.srcObject = stream; // \u663e\u793a\u51fa\u6765\n  window.stream = stream;   // \u7f13\u5b58\u4e00\u4e0b\n\n  stream.getVideoTracks()[0].addEventListener('ended', () =&gt; {\n    showMsg('\u7528\u6237\u505c\u6b62\u4e86\u5206\u4eab\u5c4f\u5e55');\n    startBtn.disabled = false;\n    recordBtn.disabled = true;\n  });\n  recordBtn.disabled = false;\n}\n\nfunction onErr(error) {\n  showMsg(`getDisplayMedia on err: ${error.name}`, error);\n}\n\nfunction showMsg(msg, error) {\n  const msgEle = document.querySelector('#msg');\n  msgEle.innerHTML += `&lt;p&gt;${msg}&lt;/p&gt;`;\n  if (typeof error !== 'undefined') {\n    console.error(error);\n  }\n}\n</code></pre> \u62ff\u5230\u89c6\u9891\u6d41\u540e\uff0c\u4ea4\u7ed9<code>video</code>\u663e\u793a\u3002 \u7ed9\u89c6\u9891\u6d41\u6dfb\u52a0\u4e8b\u4ef6\u76d1\u542c\u5668\uff0c\u5982\u679c\u505c\u6b62\u4e86\u5206\u4eab\uff0c\u6211\u4eec\u80fd\u83b7\u5f97\u4e8b\u4ef6\u3002</p> <p>\u5728\u8fd9\u4e00\u6b65\uff0c\u628a\u5176\u5b83ui\u5143\u7d20\u6ce8\u91ca\u6389\uff0c\u5df2\u7ecf\u53ef\u4ee5\u6d4b\u8bd5\u5206\u4eab\u5c4f\u5e55\u7684\u6548\u679c\u4e86\u3002 Chrome\u548cedge\u4f1a\u8be2\u95ee\u7528\u6237\u662f\u5426\u5206\u4eab\u5c4f\u5e55\uff0c\u5e76\u8ba9\u7528\u6237\u9009\u62e9\u8981\u5206\u4eab\u7684\u754c\u9762\u3002mac\u4f1a\u9700\u8981\u7528\u6237\u4fee\u6539\u9690\u79c1\u8bbe\u5b9a\u3002 \u540c\u610f\u540e\uff0c\u5c31\u80fd\u770b\u5230\u5206\u4eab\u5c4f\u5e55\u7684\u6548\u679c\u4e86\u3002</p> \u79fb\u52a8\u7aef <p>\u5728\u624b\u673achrome\u4e0a\u65e0\u6cd5\u5206\u4eab</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getdisplaymedia/#_3","title":"\u5f55\u5c4f","text":"<p>\u4e0a\u4e00\u6b65\u6211\u4eec\u62ff\u5230\u4e86\u89c6\u9891\u6d41\u3002\u53ef\u4ee5\u4eff\u7167\u4e4b\u524d\u7684\u65b9\u6cd5\u628a\u89c6\u9891\u6d41\u6570\u636e\u5b58\u4e0b\u6765\u3002</p> <p>\u5148\u6765\u627e\u5230\u6d4f\u89c8\u5668\u652f\u6301\u7684\u89c6\u9891\u683c\u5f0f\u3002\u4e3a\u4e86\u7b80\u5316\u64cd\u4f5c\uff0c\u540e\u9762\u6211\u4eec\u53ea\u9009\u7528\u7b2c\u4e00\u79cd\u652f\u6301\u7684\u683c\u5f0f\u3002 <pre><code>// \u627e\u5230\u652f\u6301\u7684\u683c\u5f0f\nfunction getSupportedMimeTypes() {\n  const possibleTypes = [\n    'video/webm;codecs=vp9,opus',\n    'video/webm;codecs=vp8,opus',\n    'video/webm;codecs=h264,opus',\n    'video/mp4;codecs=h264,aac',\n  ];\n  return possibleTypes.filter(mimeType =&gt; {\n    return MediaRecorder.isTypeSupported(mimeType);\n  });\n}\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getdisplaymedia/#_4","title":"\u5f00\u59cb\u5f55\u5236","text":"<p>\u628a\u89c6\u9891\u6d41\u6570\u636e\u63a8\u8fdb<code>recordedBlobs</code>\u3002</p> <p>\u5f53\u7136\u8fd9\u91cc\u53ea\u662f\u8bd5\u7528\uff0c\u5b9e\u9645\u4e0a\u8fd9\u4e48\u591a\u6570\u636e\u5b58\u5728\u5185\u5b58\u91cc\u4e0d\u59a5\u3002</p> <pre><code>function startRecording() {\n  recordedBlobs = [];\n  const mimeType = getSupportedMimeTypes()[0];\n  const options = { mimeType };\n\n  try {\n    mediaRecorder = new MediaRecorder(window.stream, options);\n  } catch (e) {\n    showMsg(`\u521b\u5efaMediaRecorder\u51fa\u9519: ${JSON.stringify(e)}`);\n    return;\n  }\n  recordBtn.textContent = '\u505c\u6b62\u5f55\u5236';\n  isRecording = true;\n  downloadBtn.disabled = true;\n  mediaRecorder.onstop = (event) =&gt; {\n    showMsg('\u5f55\u5236\u505c\u6b62\u4e86: ' + event);\n  };\n  mediaRecorder.ondataavailable = handleDataAvailable;\n  mediaRecorder.start();\n  showMsg('\u5f55\u5236\u5f00\u59cb mediaRecorder: ' + mediaRecorder);\n}\n\nfunction handleDataAvailable(event) {\n  console.log('handleDataAvailable', event);\n  if (event.data &amp;&amp; event.data.size &gt; 0) {\n    recordedBlobs.push(event.data);\n  }\n}\n</code></pre>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getdisplaymedia/#_5","title":"\u505c\u6b62\u5f55\u5236","text":"<p><code>mediaRecorder.stop()</code></p> <pre><code>function stopRecord() {\n  isRecording = false;\n  mediaRecorder.stop();\n  downloadBtn.disabled = false;\n  recordBtn.textContent = \"\u5f00\u59cb\u5f55\u5236\";\n}\n</code></pre>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getdisplaymedia/#_6","title":"\u4e0b\u8f7d","text":"<p>\u628a<code>recordedBlobs</code>\u91cc\u7684\u6570\u636e\u6253\u5305\u597d\u4e0b\u8f7d\u4e0b\u6765 <pre><code>downloadBtn.addEventListener('click', () =&gt; {\n  const blob = new Blob(recordedBlobs, { type: 'video/webm' });\n  const url = window.URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.style.display = 'none';\n  a.href = url;\n  a.download = '\u5f55\u5c4f_' + new Date().getTime() + '.webm';\n  document.body.appendChild(a);\n  a.click();\n  setTimeout(() =&gt; {\n    document.body.removeChild(a);\n    window.URL.revokeObjectURL(url);\n  }, 100);\n});\n</code></pre></p> WebM <p>\u6ce8\u610f\uff0c\u6211\u4eec\u4e0b\u8f7d\u5f97\u5230\u7684\u662fwebm\uff0c\u4e0d\u662fmp4\u6216\u8005mov\u3002</p> <p>WebM\u662f\u4e00\u79cd\u4e3aweb\u8bbe\u8ba1\u7684\u5a92\u4f53\u6587\u4ef6\u683c\u5f0f\u3002</p> <p>\u53c2\u8003 https://www.webmproject.org/about/</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getdisplaymedia/#_7","title":"\u5c0f\u7ed3","text":"<p>\u6211\u4eec\u4f7f\u7528\u4e86WebRTC\u7684<code>getDisplayMedia</code>\u65b9\u6cd5\u5206\u4eab\u5c4f\u5e55\u3002\u5e76\u7ed3\u5408\u4e4b\u524d\u4e86\u89e3\u7684\u4e0b\u8f7d\u89c6\u9891\u65b9\u6cd5\uff0c\u5b9e\u73b0\u4e86\u7b80\u6613\u7684\u5f55\u5c4f\u4e0b\u8f7d\u6548\u679c\u3002</p> <p></p> <p>WebRTC\u7cfb\u5217</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getdisplaymedia/#_8","title":"\u6548\u679c","text":"<p>\u6548\u679c\u9884\u89c8\u754c\u9762</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u77e5\u4e4e cnblog \u534e\u4e3a\u4e91\u793e\u533a \u6398\u91d1</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getusermedia-record/","title":"WebRTC\u7f51\u9875\u6253\u5f00\u6444\u50cf\u5934\u5e76\u5f55\u5236\u89c6\u9891","text":"\u66f4\u65b0\u65e5\u671f: 2021-12-03 <ul> <li>2021-12-03 \u65b0\u5efa\u6587\u6863</li> </ul> <p>\u524d\u9762\u6211\u4eec\u80fd\u6253\u5f00\u672c\u5730\u6444\u50cf\u5934\uff0c\u5e76\u4e14\u5728\u7f51\u9875\u4e0a\u770b\u5230\u6444\u50cf\u5934\u7684\u9884\u89c8\u56fe\u50cf\u3002 \u672c\u6587\u6211\u4eec\u4f7f\u7528MediaRecorder\u6765\u5f55\u5236\u89c6\u9891\u3002\u5728\u7f51\u9875\u4e0a\u64ad\u653e\u5f55\u5236\u597d\u7684\u89c6\u9891\uff0c\u5e76\u80fd\u63d0\u4f9b\u4e0b\u8f7d\u529f\u80fd\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getusermedia-record/#html","title":"html","text":"<p>\u9996\u5148\u521b\u5efa\u4e00\u4e2ahtml\u754c\u9762\uff0c\u653e\u4e0a\u4e00\u4e9b\u5143\u7d20 <pre><code>    &lt;video id=\"v1\" playsinline autoplay muted&gt;&lt;/video&gt;\n    &lt;video id=\"v2\" playsinline loop&gt;&lt;/video&gt;\n\n    &lt;div&gt;\n        &lt;button id=\"startCamera\"&gt;\u5f00\u542f\u6444\u50cf\u5934&lt;/button&gt;\n        &lt;button id=\"stopCamera\"&gt;\u505c\u6b62\u6444\u50cf\u5934&lt;/button&gt;\n        &lt;button id=\"record\" disabled&gt;\u5f55\u5236&lt;/button&gt;\n        &lt;button id=\"play\" disabled&gt;\u64ad\u653e&lt;/button&gt;\n        &lt;button id=\"download\" disabled&gt;\u4e0b\u8f7d\u89c6\u9891&lt;/button&gt;\n    &lt;/div&gt;\n    &lt;div&gt; \u5f55\u5236\u4f7f\u7528\u7684\u89c6\u9891\u683c\u5f0f: &lt;select id=\"codecSelect\" disabled&gt;&lt;/select&gt; &lt;/div&gt;\n    &lt;div&gt;\n        &lt;h4&gt;\u89c6\u9891\u8bbe\u7f6e&lt;/h4&gt;\n        &lt;p&gt;\u56de\u58f0\u6d88\u9664: &lt;input type=\"checkbox\" id=\"echoCancellation\"&gt;&lt;/p&gt;\n    &lt;/div&gt;\n    &lt;div&gt; &lt;span id=\"msg\" style=\"font-size:smaller\"&gt;&lt;/span&gt; &lt;/div&gt;\n\n    &lt;!-- \u4f7f\u7528\u672c\u5730\u7684\u9002\u914d\u5668 --&gt;\n    &lt;script src=\"../js/adapter-latest.js\" async&gt;&lt;/script&gt;\n</code></pre></p> <ul> <li><code>video</code> </li> <li>v1 \u7528\u6765\u9884\u89c8</li> <li>v2 \u7528\u6765\u64ad\u653e\u5f55\u5236\u597d\u7684\u89c6\u9891</li> <li><code>button</code> \u63a7\u5236\u6444\u50cf\u5934\u5f00\u542f\u3001\u5f55\u5236\uff0c\u4e0b\u8f7d\u7b49\u7b49</li> <li><code>select</code> \u9009\u62e9\u5f55\u5236\u7528\u7684\u89c6\u9891\u683c\u5f0f</li> <li><code>input</code> \u9009\u62e9\u56de\u58f0\u6d88\u9664</li> </ul>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getusermedia-record/#js","title":"js","text":"","tags":["WebRTC"]},{"location":"webrtc/web-samples/getusermedia-record/#_1","title":"\u51c6\u5907","text":"<p>\u5148\u628a\u754c\u9762\u4e0a\u7684\u5143\u7d20\u62ff\u5230 <pre><code>'use strict';\n\nlet mediaRecorder;\nlet recordedBlobs; // \u5f55\u5236\u4e0b\u6765\u7684\u5185\u5bb9\nlet isRecording = false;\n\n// \u5148\u628a\u9875\u9762\u5143\u7d20\u62ff\u5230\nconst startCameraBtn = document.querySelector('button#startCamera'); // \u542f\u52a8\u6444\u50cf\u5934\u6309\u94ae\nconst stopCameraBtn = document.querySelector('button#stopCamera');\nconst recordBtn = document.querySelector('button#record'); // \u5f00\u59cb\u5f55\u5236\u6309\u94ae\nconst playBtn = document.querySelector('button#play');     // \u64ad\u653e\u6309\u94ae\nconst downloadBtn = document.querySelector('button#download'); // \u4e0b\u8f7d\u89c6\u9891\u6309\u94ae\nconst codecSelector = document.querySelector('#codecSelect'); // \u9009\u62e9\u683c\u5f0f\nconst msgEle = document.querySelector('span#msg');         // \u663e\u793a\u6d88\u606f\nconst previewV1 = document.querySelector('video#v1'); // \u9884\u89c8\u7528\u7684\nconst recordedV2 = document.querySelector('video#v2');  // \u7528\u6765\u64ad\u653e\u5f55\u5236\u597d\u7684\u89c6\u9891\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getusermedia-record/#_2","title":"\u89c6\u9891\u652f\u6301\u7684\u683c\u5f0f","text":"<p>\u5148\u9884\u5b9a\u51e0\u4e2a\u53ef\u80fd\u7684\u683c\u5f0f\uff0c\u7136\u540e\u4e00\u4e2a\u4e2a\u6765\u5224\u65ad\u662f\u5426\u652f\u6301\u3002\u627e\u5230\u652f\u6301\u7684\u683c\u5f0f\u3002 <pre><code>function getSupportedMimeTypes() {\n  const possibleTypes = [\n    'video/webm;codecs=vp9,opus',\n    'video/webm;codecs=vp8,opus',\n    'video/webm;codecs=h264,opus',\n    'video/mp4;codecs=h264,aac',\n  ];\n  return possibleTypes.filter(mimeType =&gt; {\n    return MediaRecorder.isTypeSupported(mimeType);\n  });\n}\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getusermedia-record/#_3","title":"\u5f00\u542f\u6444\u50cf\u5934","text":"<p>\u540c\u6837\u8981\u4f7f\u7528<code>getUserMedia</code>\u65b9\u6cd5\u3002\u8fd9\u91cc\u7ed9\u89c6\u9891\u6307\u5b9a\u4e86\u5bbd\u9ad8\u3002\u56de\u58f0\u6d88\u9664\u662f\u53ef\u9009\u9879\u3002 <pre><code>// \u542f\u52a8\u6444\u50cf\u5934\nstartCameraBtn.addEventListener('click', async () =&gt; {\n  startCameraBtn.disabled = true;\n  const isEchoCancellation = document.querySelector('#echoCancellation').checked;\n  const constraints = {\n    audio: {\n      echoCancellation: { exact: isEchoCancellation }\n    },\n    video: {\n      width: 1280, height: 720\n    }\n  };\n  await init(constraints);\n});\n\nasync function init(constraints) {\n  try {\n    const stream = await navigator.mediaDevices.getUserMedia(constraints);\n    gotStream(stream);\n  } catch (e) {\n    showMsg(`navigator.getUserMedia error:${e.toString()}`);\n  }\n}\n\nfunction gotStream(stream) {\n  recordBtn.disabled = false;\n  showMsg('\u62ff\u5230\u4e86 stream:', stream);\n  window.stream = stream;\n  previewV1.srcObject = stream;\n\n  // \u91cd\u7f6e\n  var codecOption = codecSelector.lastChild;\n  while (codecOption != null) {\n    codecSelector.removeChild(codecOption);\n    codecOption = codecSelector.lastChild;\n  }\n\n  getSupportedMimeTypes().forEach(mimeType =&gt; {\n    const option = document.createElement('option');\n    option.value = mimeType;\n    option.innerText = option.value;\n    codecSelector.appendChild(option);\n  });\n  codecSelector.disabled = false; // \u53ef\u4ee5\u8fdb\u884c\u9009\u62e9\u4e86\n}\n</code></pre></p> <p>\u4e0b\u9762\u662f\u505c\u6b62\u6444\u50cf\u5934\u7684\u65b9\u6cd5 <pre><code>stopCameraBtn.addEventListener('click', () =&gt; {\n  var stream = previewV1.srcObject;\n  if (stream == null) {\n    return;\n  }\n  const tracks = stream.getTracks();\n  tracks.forEach(function (track) {\n    track.stop();\n  });\n  previewV1.srcObject = null;\n  window.stream = null;\n  codecSelector.disabled = true;\n  startCameraBtn.disabled = false;\n});\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getusermedia-record/#_4","title":"\u5f00\u59cb\u5f55\u5236","text":"<p>\u5f00\u59cb\u5f55\u5236\u89c6\u9891 <pre><code>function startRecording() {\n  recordedBlobs = [];\n  const mimeType = codecSelector.options[codecSelector.selectedIndex].value;\n  const options = { mimeType };\n\n  try {\n    mediaRecorder = new MediaRecorder(window.stream, options);\n  } catch (e) {\n    showMsg(`\u521b\u5efaMediaRecorder\u51fa\u9519: ${JSON.stringify(e)}`);\n    return;\n  }\n\n  showMsg('\u521b\u5efaMediaRecorder', mediaRecorder, ' -&gt; options', options);\n  recordBtn.textContent = '\u505c\u6b62\u5f55\u5236';\n  isRecording = true;\n  playBtn.disabled = true;\n  downloadBtn.disabled = true;\n  codecSelector.disabled = true;\n  mediaRecorder.onstop = (event) =&gt; {\n    showMsg('\u5f55\u5236\u505c\u6b62\u4e86: ' + event);\n    showMsg('\u5f55\u5236\u7684\u6570\u636eBlobs: ' + recordedBlobs);\n  };\n  mediaRecorder.ondataavailable = handleDataAvailable;\n  mediaRecorder.start();\n  showMsg('\u5f55\u5236\u5f00\u59cb mediaRecorder: ' + mediaRecorder);\n}\n\nfunction handleDataAvailable(event) {\n  if (event.data &amp;&amp; event.data.size &gt; 0) {\n    recordedBlobs.push(event.data);\n  }\n}\n\nrecordBtn.addEventListener('click', () =&gt; {\n  if (isRecording == false) {\n    startRecording();\n  } else {\n    stopRecording();\n    recordBtn.textContent = '\u5f00\u59cb\u5f55\u5236';\n    playBtn.disabled = false;\n    downloadBtn.disabled = false;\n    codecSelector.disabled = false;\n  }\n});\n</code></pre></p> <ul> <li>\u91cd\u7f6e\u5f55\u5236\u5185\u5bb9<code>recordedBlobs = []</code></li> <li>\u62ff\u5230\u9009\u5b9a\u7684\u89c6\u9891\u683c\u5f0f<code>mimeType</code></li> <li>\u65b0\u5efaMediaRecorder\u5bf9\u8c61\uff0c\u4f20\u5165\u524d\u9762\u83b7\u53d6\u5230\u7684\u6d41</li> <li>\u5904\u7406\u5404\u4e2a\u6309\u94ae\uff08ui\uff09\u7684\u72b6\u6001</li> <li>mediaRecorder<ul> <li>\u8bbe\u7f6e\u505c\u6b62\u76d1\u542c\u5668 <code>onstop</code></li> <li>\u76d1\u542c\u5f55\u5236\u6570\u636e <code>ondataavailable</code>\uff0c\u6709\u6570\u636e\u6765\u7684\u65f6\u5019\u5b58\u653e\u5728<code>recordedBlobs</code></li> <li>\u542f\u52a8\u5f55\u5236 <code>mediaRecorder.start()</code></li> </ul> </li> </ul>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getusermedia-record/#_5","title":"\u505c\u6b62\u5f55\u5236","text":"<pre><code>function stopRecording() {\n  mediaRecorder.stop();\n}\n</code></pre>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getusermedia-record/#_6","title":"\u64ad\u653e\u5f55\u5236\u597d\u7684\u89c6\u9891","text":"<p>\u5f55\u5236\u597d\u7684\u89c6\u9891\u5185\u5bb9\u5b58\u653e\u5728<code>recordedBlobs</code>\u3002\u65b0\u5efaBlob\uff0c\u4ea4\u7ed9video\uff08recordedV2\uff09\u6765\u64ad\u653e <pre><code>playBtn.addEventListener('click', () =&gt; {\n  const mimeType = codecSelector.options[codecSelector.selectedIndex].value.split(';', 1)[0];\n  const superBuffer = new Blob(recordedBlobs, { type: mimeType });\n  recordedV2.src = null;\n  recordedV2.srcObject = null;\n  recordedV2.src = window.URL.createObjectURL(superBuffer);\n  recordedV2.controls = true;\n  recordedV2.play();\n});\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getusermedia-record/#_7","title":"\u4e0b\u8f7d\u89c6\u9891","text":"<p>\u5f55\u5236\u597d\u7684\u89c6\u9891\u5185\u5bb9\u5b58\u653e\u5728<code>recordedBlobs</code>\u3002 <pre><code>downloadBtn.addEventListener('click', () =&gt; {\n  const blob = new Blob(recordedBlobs, { type: 'video/webm' });\n  const url = window.URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.style.display = 'none';\n  a.href = url;\n  a.download = '\u89c6\u9891_' + new Date().getTime() + '.webm';\n  document.body.appendChild(a);\n  a.click();\n  setTimeout(() =&gt; {\n    document.body.removeChild(a);\n    window.URL.revokeObjectURL(url);\n  }, 100);\n});\n</code></pre> \u65b0\u5efaBlob\u548c\u4e00\u4e2a<code>a</code>\u5143\u7d20\u3002\u6839\u636eblob\u521b\u5efaObjectURL\uff0c\u5e76\u4f20\u7ed9<code>a</code>\u5143\u7d20\u7684href\u3002 \u4fee\u6539\u4e0b\u8f7d\u6587\u4ef6\u7684\u9ed8\u8ba4\u540d\u5b57<code>a.download</code>\u3002 \u89e6\u53d1<code>a</code>\u5143\u7d20\u7684<code>click()</code>\uff0c\u5373\u80fd\u8ba9\u6d4f\u89c8\u5668\u4e0b\u8f7d\u8fd9\u4e2a\u6587\u4ef6\u3002</p> <p>\u5ef6\u8fdf\u628a\u8fd9\u4e2a<code>a</code>\u79fb\u9664\u6389\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/getusermedia-record/#_8","title":"\u5c0f\u7ed3","text":"<p><code>getUserMedia()</code>\u5f00\u542f\u89c6\u9891\u62ff\u5230\u89c6\u9891\u6d41\u3002MediaRecorder\u5f55\u5236\u89c6\u9891\u3002\u7528Blob\u6765\u64ad\u653e\u548c\u4e0b\u8f7d\u3002 \u5b9e\u73b0\u4e00\u4e2a\u5c0f\u7684\u5f55\u5236\u89c6\u9891\u6548\u679c\u3002\u89c6\u9891\u6570\u636e\u7f13\u5b58\u5728\u5bf9\u8c61\u91cc\u3002</p> <p>\u5b8c\u6574\u7684\u6548\u679c\u8bf7\u53c2\u8003 \u89c6\u9891\u5f55\u5236</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>cnblog \u534e\u4e3a\u4e91\u793e\u533a \u77e5\u4e4e</p> <p></p> <p>WebRTC\u7cfb\u5217</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/resolution/","title":"WebRTC\u89c6\u9891\u5206\u8fa8\u7387\u8bbe\u7f6e","text":"\u66f4\u65b0\u65e5\u671f: 2021-12-07 <ul> <li>2021-12-07 \u65b0\u5efa\u6587\u6863</li> </ul> <p>\u524d\u9762\u6211\u4eec\u80fd\u591f\u6253\u5f00\u6444\u50cf\u5934\u3002<code>getUserMedia()</code>\u65f6\u4f1a\u4f20\u5165\u53c2\u6570\uff0c\u5728\u53c2\u6570\u91cc\u6211\u4eec\u53ef\u4ee5\u6307\u5b9a\u5bbd\u9ad8\u4fe1\u606f\u3002\u901a\u8fc7\u5bbd\u9ad8\u53c2\u6570\u63a7\u5236\u8f93\u51fa\u7684\u89c6\u9891\u5206\u8fa8\u7387\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/resolution/#html","title":"html","text":"<p>\u5728\u9875\u9762\u4e0a\u6446\u653e\u4e00\u4e9b\u5143\u7d20\uff0c\u4e0b\u9762\u662f\u4e3b\u8981\u90e8\u5206 <pre><code>&lt;div id=\"container\"&gt;\n    &lt;div id=\"buttons\"&gt;\n        &lt;button id=\"stop\"&gt;\u505c\u6b62&lt;/button&gt;\n        &lt;button id=\"b320\"&gt;320x240&lt;/button&gt;\n        &lt;button id=\"b240-320\"&gt;240x320&lt;/button&gt;\n        &lt;button id=\"b640\"&gt;640x480&lt;/button&gt;\n        &lt;button id=\"b1280\"&gt;1280x720&lt;/button&gt;\n        &lt;button id=\"b1920\"&gt;1920x1080&lt;/button&gt;\n        &lt;button id=\"b2048\"&gt;2048x1152&lt;/button&gt;\n    &lt;/div&gt;\n    &lt;div id=\"videoblock\" style=\"display: none\"&gt;\n        &lt;p id=\"dimensions\" style=\"height: 1em;\"&gt;&lt;/p&gt;\n        &lt;video playsinline autoplay style=\"background: none;height: auto;width: auto;\"&gt;&lt;/video&gt;\n        &lt;div id=\"width\"&gt;\n            &lt;label&gt;Width &lt;span&gt;&lt;/span&gt;px:&lt;/label&gt;\n            &lt;input type=\"range\" min=\"0\" max=\"7680\" value=\"0\"&gt;\n        &lt;/div&gt;\n        &lt;input id=\"isFullWidth\" type=\"checkbox\"&gt;\u89c6\u9891\u5bbd\u5ea6100%&lt;br&gt;\n        &lt;input id=\"aspectlock\" type=\"checkbox\"&gt;\u9501\u5b9a\u5bbd\u9ad8\u6bd4&lt;br&gt;\n    &lt;/div&gt;\n    &lt;p id=\"msg\" style=\"display: none;\"&gt;&lt;/p&gt;\n&lt;/div&gt;\n\n&lt;script src=\"../js/adapter-latest.js\" async&gt;&lt;/script&gt; &lt;!-- \u4f7f\u7528\u672c\u5730\u7684\u9002\u914d\u5668 --&gt;\n&lt;script src=\"js/main.js\" async&gt;&lt;/script&gt;\n</code></pre></p> <ul> <li><code>button</code> \u4e00\u4e9b\u6309\u94ae\u7528\u6765\u9009\u62e9\u5206\u8fa8\u7387</li> <li><code>videoblock</code> \u7528\u6765\u663e\u793a\u89c6\u9891\uff0c\u9ed8\u8ba4\u9690\u85cf</li> <li><code>dimensions</code> \u7528\u6765\u73b0\u5b9e\u89c6\u9891\u7684\u4e00\u4e9b\u4fe1\u606f</li> <li><code>video</code> \u5bbd\u9ad8\u5148\u8bbe\u7f6e\u4e3aauto</li> <li><code>#width input</code> \u6ed1\u52a8\u9009\u62e9\u89c6\u9891\u7684\u5bbd\u5ea6</li> <li><code>isFullWidth</code> \u8ba9video\u5bbd\u5ea6\u4e3a100%</li> <li><code>msg</code> \u663e\u793a\u9519\u8bef\u4fe1\u606f</li> </ul>","tags":["WebRTC"]},{"location":"webrtc/web-samples/resolution/#js","title":"js","text":"<p>\u62ff\u5230\u4e00\u4e9b\u5143\u7d20 <pre><code>const dimensionsInfo = document.querySelector('#dimensions');\nconst video = document.querySelector('video');\nlet stream;\n\nconst videoblock = document.querySelector('#videoblock'); // \u89c6\u9891\u533a\u57df\nconst messagebox = document.querySelector('#msg');\n\nconst widthInput = document.querySelector('div#width input');\nconst widthOutput = document.querySelector('div#width span');\nconst aspectLock = document.querySelector('#aspectlock');\nconst fullWidSetting = document.querySelector('#isFullWidth');\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/resolution/#_1","title":"\u542f\u52a8\u89c6\u9891","text":"<p>\u5148\u628a\u62ff\u5230\u6d41\u7684\u5904\u7406\u65b9\u6cd5\u5199\u51fa\u6765 <pre><code>function gotStream(mediaStream) {\n  stream = window.stream = mediaStream; // \u7ed9\u63a7\u5236\u53f0\n  video.srcObject = mediaStream;\n  messagebox.style.display = 'none';\n  videoblock.style.display = 'block';\n  const track = mediaStream.getVideoTracks()[0];\n  const constraints = track.getConstraints();\n  console.log('\u5f53\u524dconstraints: ' + JSON.stringify(constraints));\n  if (constraints &amp;&amp; constraints.width &amp;&amp; constraints.width.exact) {\n    widthInput.value = constraints.width.exact;\n    widthOutput.textContent = constraints.width.exact;\n  } else if (constraints &amp;&amp; constraints.width &amp;&amp; constraints.width.min) {\n    widthInput.value = constraints.width.min;\n    widthOutput.textContent = constraints.width.min;\n  }\n}\n</code></pre> \u62ff\u5230\u89c6\u9891\u6d41\u540e\uff0c<code>track.getConstraints()</code>\u83b7\u53d6\u4fe1\u606f\uff0c\u663e\u793a\u51fa\u5f53\u524d\u4fe1\u606f\u5e76\u4fee\u6539ui\u3002</p> <p>\u4ee5\u6309\u94ae320\u4e3a\u4f8b <pre><code>document.querySelector('#b320').onclick = () =&gt; {\n  const c320 = {\n    video: { width: { exact: 320 }, height: { exact: 240 } }\n  };\n  startPlay(c320);\n};\n\nfunction startPlay(constraints) {\n  stopStream();\n  clearMsg();\n  videoblock.style.display = 'none';\n  navigator.mediaDevices.getUserMedia(constraints)\n    .then(gotStream)\n    .catch(e =&gt; {\n      showErrMsg('getUserMedia\u62a5\u9519 ' + e, JSON.stringify(constraints));\n    });\n}\n\nfunction stopStream() {\n  if (stream) {\n    stream.getTracks().forEach(track =&gt; {\n      track.stop();\n    });\n  }\n}\n</code></pre></p> <ul> <li>\u5b9a\u4e49\u914d\u7f6e<code>c320</code>\uff0c\u8bbe\u5b9a\u5bbd\u4e3a320\uff0c\u9ad8\u4f1f240</li> <li>\u5148\u628a\u89c6\u9891\u505c\u4e0b\u6765</li> <li>\u8c03\u7528<code>getUserMedia</code>\u5e76\u628a\u53c2\u6570\u914d\u7f6e\u4f20\u8fdb\u53bb</li> </ul> <p>\u8fd8\u53ef\u4ee5\u76d1\u542cvideo\u7684\u53d8\u5316 <pre><code>let currentWidth = 0;\nlet currentHeight = 0;\n\n// \u663e\u793a\u89c6\u9891\u5c3a\u5bf8\u4fe1\u606f\nfunction displayVideoDimensions(whereSeen) {\n  if (video.videoWidth) {\n    dimensionsInfo.innerText = '\u5b9e\u9645video\u5c3a\u5bf8: ' + video.videoWidth +\n      'x' + video.videoHeight + 'px.';\n    if (currentWidth !== video.videoWidth ||\n      currentHeight !== video.videoHeight) {\n      console.log(whereSeen + ': ' + dimensionsInfo.innerText);\n      currentWidth = video.videoWidth;\n      currentHeight = video.videoHeight;\n    }\n  } else {\n    dimensionsInfo.innerText = '\u62ff\u4e0d\u5230video\u7684\u5bbd\u5ea6';\n  }\n}\n\n// \u8f7d\u5165meta\u4fe1\u606f\nvideo.onloadedmetadata = () =&gt; {\n  displayVideoDimensions('loadedmetadata');\n};\n\n// \u4fee\u6539\u4e86\u5c3a\u5bf8\nvideo.onresize = () =&gt; {\n  displayVideoDimensions('resize');\n};\n</code></pre> \u8f7d\u5165\u4fe1\u606f\u6216\u8005\u5c3a\u5bf8\u6539\u53d8\u7684\u65f6\u5019\u663e\u793a\u51fa\u6765\u3002</p> <p>\u5b9a\u4e49\u4e86\u591a\u79cd\u5e38\u89c1\u7684\u5206\u8fa8\u7387 <pre><code>document.querySelector('#b640').onclick = () =&gt; {\n  const c640 = {\n    video: { width: { exact: 640 }, height: { exact: 480 } }\n  };\n  startPlay(c640);\n};\n\ndocument.querySelector('#b1280').onclick = () =&gt; {\n  const c1280 = {\n    video: { width: { exact: 1280 }, height: { exact: 720 } }\n  };\n  startPlay(c1280);\n};\n</code></pre></p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/resolution/#_2","title":"\u6ed1\u52a8\u8c03\u6574","text":"<p>\u6211\u4eec\u653e\u7f6e\u4e86\u4e00\u4e2a<code>input</code>\uff0c<code>type=\"range\"</code>\uff0c\u5b83\u53ef\u4ee5\u5de6\u53f3\u6ed1\u52a8\u3002\u6ed1\u52a8\u7684\u65f6\u5019\u6211\u4eec\u6539\u53d8\u89c6\u9891\u8bbe\u7f6e\u7684\u5bbd\u5ea6\u3002\u5bbd\u5ea6\u4fe1\u606f\u4e5f\u663e\u793a\u5728\u754c\u9762\u4e0a\u3002 <pre><code>widthInput.onchange = onConstraintChange;\n\nfunction onConstraintChange(e) {\n  widthOutput.textContent = e.target.value;\n  const track = window.stream.getVideoTracks()[0];\n  let constraints;\n  if (aspectLock.checked) {\n    constraints = {\n      width: { exact: e.target.value },\n      aspectRatio: {\n        exact: video.videoWidth / video.videoHeight\n      }\n    };\n  } else {\n    constraints = { width: { exact: e.target.value } };\n  }\n  clearMsg();\n  console.log('\u4f7f\u7528\u914d\u7f6e ' + JSON.stringify(constraints));\n  track.applyConstraints(constraints)\n    .then(() =&gt; {\n      console.log('\u914d\u7f6e\u6210\u529f');\n      displayVideoDimensions('applyConstraints');\n    })\n    .catch(err =&gt; {\n      showErrMsg('\u914d\u7f6e\u5931\u8d25 ', err.name);\n    });\n}\n</code></pre></p> <p>\u6539\u53d8\u7684\u5bbd\u5ea6\u5199\u5728<code>constraints</code>\u91cc\uff0c\u6ce8\u610f\u9700\u8981\u6307\u5b9a<code>exact</code>\u53c2\u6570\u3002 <code>window.stream.getVideoTracks()[0]</code>\u83b7\u53d6\u5230<code>track</code>\uff08\u89c6\u9891\u8f68\uff09\u3002 \u8c03\u7528<code>track.applyConstraints(constraints)</code>\u8ba9\u4fee\u6539\u540e\u7684\u53c2\u6570\u751f\u6548\u3002\u540c\u6837\u8fd9\u91cc\u53ef\u4ee5\u76d1\u542c\u914d\u7f6e\u662f\u5426\u6210\u529f\u3002</p> <p>\u70b9\u4e0d\u540c\u7684\u6309\u94ae\uff0c\u53ef\u4ee5\u770b\u5230\u89c6\u9891\u7684\u5c3a\u5bf8\u4e0d\u540c\u3002</p> <p>\u5728\u7535\u8111\u663e\u793a\u5668\u4e0a\u6d4b\u8bd5\uff0c\u9009\u62e9\u5c3a\u5bf8\u8fc7\u5927\u65f6\uff0c\u4f1a\u62a5\u9519OverconstrainedError\u3002</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/resolution/#_3","title":"\u5c0f\u7ed3","text":"<p>\u672c\u6b21\u793a\u4f8b\u4e5f\u662f<code>getUserMedia()</code>\u65b9\u6cd5\u7684\u4f7f\u7528\u3002\u524d\u9762\u6253\u5f00\u6444\u50cf\u5934\u6211\u4eec\u53ea\u6307\u5b9a\u4e86<code>video: true</code>\u3002\u5728\u8fd9\u4e2a\u793a\u4f8b\u91cc\u6211\u4eec\u6307\u5b9a\u4e86\u5bbd\u9ad8\u4fe1\u606f\u3002\u5e76\u4ee5\u6b64\u63a7\u5236\u8f93\u51fa\u7684\u89c6\u9891\u5206\u8fa8\u7387\u3002 \u89c6\u9891\u6b63\u5728\u663e\u793a\u7684\u65f6\u5019\uff0c\u4e5f\u53ef\u4ee5\u7528<code>track.applyConstraints</code>\u65b9\u6cd5\u6765\u4fee\u6539\u89c6\u9891\u7684\u5206\u8fa8\u7387\u3002</p> <p></p> <p>WebRTC\u7cfb\u5217</p>","tags":["WebRTC"]},{"location":"webrtc/web-samples/resolution/#_4","title":"\u6548\u679c","text":"<p>\u7f51\u9875\u6548\u679c\u9884\u89c8</p> \u672c\u6587\u4e5f\u53d1\u5e03\u5728 <p>\u534e\u4e3a\u4e91\u793e\u533a</p>","tags":["WebRTC"]},{"location":"tags/","title":"\u672c\u7ad9\u6807\u7b7e","text":""},{"location":"tags/#android-activity","title":"Android Activity","text":"<ul> <li>Android Activity \u751f\u547d\u5468\u671f\uff08Activity\u751f\u547d\u5468\u671f\uff09</li> <li>Android Activity Result Launcher \u8fd4\u56de\u65f6\u643a\u5e26\u53c2\u6570</li> <li>Android Activity\u8fc7\u573a\u52a8\u753b\u6548\u679c\uff08Activity\u8fc7\u573a\u52a8\u753b\uff09</li> <li>Android \u60ac\u6d6e\u7a97 Activity</li> <li>Android Activity \u542f\u52a8\u6a21\u5f0f\uff0c\u4efb\u52a1\u548c\u8fd4\u56de\u6808\uff08\u542f\u52a8\u6a21\u5f0f\u6709\u51e0\u79cd\uff1f\uff09</li> <li>Android Activity \u4f20\u9012Parcelable\u5bf9\u8c61</li> <li>Android Activity\u7efc\u8ff0</li> <li>Android Activity \u542f\u52a8\uff0c\u643a\u5e26\u53c2\u6570\u542f\u52a8</li> <li>Android Activity \u8fd4\u56de\u65f6\u643a\u5e26\u53c2\u6570</li> </ul>"},{"location":"tags/#android-camera","title":"Android Camera","text":"<ul> <li>Android Camera2 get size and fps info</li> <li>Android Camera2\u83b7\u53d6\u9884\u89c8\u5c3a\u5bf8\u548cfps\u8303\u56f4</li> </ul>"},{"location":"tags/#android-launcher","title":"Android Launcher","text":"<ul> <li>Android \u7b80\u6613launcher</li> </ul>"},{"location":"tags/#android-media","title":"Android Media","text":"<ul> <li>Android\u97f3\u9891PCM\u6570\u636e\u7684\u91c7\u96c6\u548c\u64ad\u653e\uff0c\u8bfb\u5199\u97f3\u9891wav\u6587\u4ef6</li> <li>Android\u4f7f\u7528SurfaceView\u548cTextureView\u9884\u89c8Camera\uff0c\u83b7\u53d6NV21\u6570\u636e</li> <li>Android \u4f7f\u7528 Android Camera API \u5b8c\u6210\u97f3\u89c6\u9891\u7684\u91c7\u96c6\u3001\u7f16\u7801\u3001\u5c01\u5305\u6210 mp4 \u8f93\u51fa</li> <li>Android MediaCodec \u7f16\u89e3\u7801\u4f7f\u7528\u65b9\u5f0f</li> <li>Android \u4f7f\u7528 MediaExtractor \u548c MediaMuxer \u89e3\u6790\u548c\u5c01\u88c5 mp4 \u6587\u4ef6</li> <li>Android MediaPlayer \u57fa\u7840\u7b80\u4ecb</li> <li>Android MediaPlayer \u64ad\u653e\u97f3\u9891</li> <li>Android MediaPlayer \u97f3\u9891\u500d\u901f\u64ad\u653e\uff0c\u8c03\u6574\u64ad\u653e\u901f\u5ea6</li> <li>WebRTC\u62bd\u53d6AGC\u589e\u76ca\u4e0eANS\u566a\u58f0\u6291\u5236\u6a21\u5757\u7ed9Android</li> </ul>"},{"location":"tags/#android-packagemanager","title":"Android PackageManager","text":"<ul> <li>Android \u5378\u8f7dapp</li> <li>Android \u81ea\u5b9a\u4e49 permission</li> <li>PackageManager\u7684\u4e00\u4e9b\u57fa\u7840\u7528\u6cd5</li> <li>Android \u4ee3\u7801\u91cd\u542fapp\u7684\u65b9\u6cd5</li> </ul>"},{"location":"tags/#android-studio","title":"Android Studio","text":"<ul> <li>Android Studio \u6a21\u5757\u7f16\u8bd1\u6253\u5305\u51fajar</li> </ul>"},{"location":"tags/#android-view","title":"Android View","text":"<ul> <li>Android addOnGlobalLayoutListener</li> </ul>"},{"location":"tags/#android","title":"Android\u52a8\u753b","text":"<ul> <li>Android Activity\u8fc7\u573a\u52a8\u753b\u6548\u679c\uff08Activity\u8fc7\u573a\u52a8\u753b\uff09</li> </ul>"},{"location":"tags/#cocos-creator","title":"Cocos Creator","text":"<ul> <li>Cocos Creator \u62d6\u52a8\u6548\u679c</li> <li>Cocos Creator \u62d6\u52a8\u53bb\u6307\u5b9a\u533a\u57df</li> <li>Cocos Creator \u5750\u6807\u4e0e\u8f6c\u6362</li> <li>Cocos Creator \u89e6\u6478\u4e8b\u4ef6\u7a7f\u900f</li> </ul>"},{"location":"tags/#ffmpeg","title":"FFmpeg","text":"<ul> <li>Python \u4f7f\u7528FFmpeg\u64cd\u4f5cmp4</li> </ul>"},{"location":"tags/#java","title":"Java","text":"<ul> <li>\u72b6\u6001\u6a21\u5f0f State Pattern</li> <li>\u7b56\u7565\u6a21\u5f0f Strategy Pattern</li> <li>\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f Template Method Pattern</li> <li>\u8bbf\u95ee\u8005\u6a21\u5f0f Visitor Pattern</li> </ul>"},{"location":"tags/#linux","title":"Linux","text":"<ul> <li>Shell for \u5faa\u73af\u8bed\u53e5</li> <li>Linux awk\u547d\u4ee4\u7684\u4f7f\u7528\uff0c\u9010\u884c\u5904\u7406\u6587\u672c\uff0c\u641c\u7d22\u7edf\u8ba1\u5355\u8bcd\u4e2a\u6570</li> <li>Linux curl \u4f7f\u7528</li> <li>find\u7684\u4f7f\u7528\uff0c\u5bfb\u627e\u7279\u5b9a\u6587\u4ef6</li> <li>grep \u641c\u7d22\u5b57\u7b26\u4e32</li> <li>ls \u547d\u4ee4</li> <li>Linux mkdir \u521b\u5efa\u76ee\u5f55</li> <li>Linux\u4f7f\u7528netstat\u67e5\u770b\u7f51\u7edc\u72b6\u6001</li> </ul>"},{"location":"tags/#lua","title":"Lua","text":"<ul> <li>Lua \u57fa\u7840\u64cd\u4f5c</li> <li>Lua Mac\u7f16\u8bd1\u5b89\u88c5</li> </ul>"},{"location":"tags/#mongodb","title":"MongoDB","text":"<ul> <li>MongoDB\u548cMySQL\u7684\u5bf9\u6bd4</li> </ul>"},{"location":"tags/#mysql","title":"MySQL","text":"<ul> <li>MongoDB\u548cMySQL\u7684\u5bf9\u6bd4</li> <li>docker MySQL \u4fee\u6539\u5bc6\u7801</li> <li>Python \u64cd\u4f5c MySQL</li> </ul>"},{"location":"tags/#nestjs","title":"NestJS","text":"<ul> <li>\u72b6\u6001\u7801\u9020\u6210\u5fae\u4fe1\u516c\u4f17\u53f7\u201c\u8be5\u516c\u4f17\u53f7\u63d0\u4f9b\u7684\u670d\u52a1\u51fa\u73b0\u6545\u969c\u201d</li> <li>NestJS \u90e8\u7f72\u4e0e\u7ef4\u62a4</li> <li>NestJS \u9759\u6001\u6587\u4ef6</li> <li>NestJS WebSocket \u5f00\u59cb\u4f7f\u7528</li> <li>Ubuntu Nginx \u914d\u7f6e\u4f7f\u7528WSS</li> <li>NestJS Simple Chat \u65b0\u5efa\u5de5\u7a0b</li> <li>NestJS Simple Chat - \u90e8\u7f72\u670d\u52a1</li> <li>NestJS Simple Chat - \u5206\u623f\u53d1\u9001\u6d88\u606f</li> <li>NestJS Simple Chat - \u672c\u5730\u670d\u52a1\u6d88\u606f\u8f6c\u53d1</li> <li>NestJS Simple Chat - Web\u5efa\u7acbwebsocket\u8fde\u63a5</li> </ul>"},{"location":"tags/#nginx","title":"Nginx","text":"<ul> <li>Ubuntu Nginx \u914d\u7f6e\u4f7f\u7528WSS</li> <li>\u5e38\u89c1\u7684nginx\u914d\u7f6e\uff0c\u670d\u52a1\u914d\u7f6e\uff0c\u8d1f\u8f7d\u5747\u8861\uff0cssl\uff1b\u8bb0\u5f55\u4e00\u4e9b\u5e38\u7528\u7684\u914d\u7f6e</li> </ul>"},{"location":"tags/#parcelable","title":"Parcelable","text":"<ul> <li>Android Activity \u4f20\u9012Parcelable\u5bf9\u8c61</li> </ul>"},{"location":"tags/#pyqt","title":"PyQt","text":"<ul> <li>\u5b89\u88c5PyQt5</li> <li>\u5b89\u88c5\u548c\u914d\u7f6ePyCharm</li> <li>PyQt QFileDialog \u6587\u4ef6\u9009\u62e9\u5f39\u7a97</li> <li>PyQt QMainWindow \u7b80\u5355\u4f7f\u7528</li> <li>PyQt \u7ebf\u7a0b\u7c7b QThread</li> <li>PyQt \u9002\u914d\u4e0d\u540c\u5c4f\u5e55\u5206\u8fa8\u7387</li> <li>PyQt \u62d6\u5165</li> <li>PyQt \u591a\u8bed\u8a00</li> <li>PyQt \u6253\u5305\u6210exe\u6587\u4ef6</li> <li>PyQt \u521b\u5efa\u81ea\u5b9a\u4e49QWidget</li> <li>PyQt5 \u5b89\u88c5\u5546\u4e1a\u7248</li> </ul>"},{"location":"tags/#python","title":"Python","text":"<ul> <li>Python3 Dictionary\u4e0eJSON</li> <li>Python \u83b7\u53d6\u5f53\u524d\u8def\u5f84\u7684\u65b9\u6cd5</li> <li>pip \u76f8\u5173</li> <li>Python \u8bfb\u5199csv\u6587\u4ef6\u4e2d\u7684\u6570\u5b57</li> <li>Python \u67e5\u770b\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6</li> <li>Python\u56fe\u8868\u5e93Matplotlib \u7ec4\u6210\u90e8\u5206\u4ecb\u7ecd</li> <li>\u7ed8\u5236\u56fe\u8868Matplotlib\u5feb\u901f\u5165\u95e8</li> <li>Python \u64cd\u4f5c MySQL</li> <li>\u3010\u8fd0\u8425\u7684Python\u6307\u5357\u3011\u7ed8\u5236\u6f0f\u6597\u56fe</li> <li>\u3010\u8fd0\u8425\u7684Python\u6307\u5357\u3011Python Excel \u7ed8\u5236\u67f1\u5f62\u56fe</li> <li>\u3010\u8fd0\u8425\u7684Python\u6307\u5357\u3011Python \u64cd\u4f5cExcel</li> <li>Python openpyxl Excel\u7ed8\u5236\u67f1\u5f62\u56fe</li> <li>Python openpyxl \u5904\u7406Excel\u4f7f\u7528\u6307\u5357</li> <li>Python \u8c03\u7528adb\u547d\u4ee4</li> <li>Python \u4f7f\u7528FFmpeg\u64cd\u4f5cmp4</li> <li>python3 \u53d1\u9001\u90ae\u4ef6\u529f\u80fd</li> <li>Python\u6293\u53d6\u535a\u5ba2\u8bb0\u5f55\uff0c\u83b7\u53d6\u6807\u9898\u4e0eurl</li> </ul>"},{"location":"tags/#simple-chat","title":"Simple Chat","text":"<ul> <li>NestJS Simple Chat \u65b0\u5efa\u5de5\u7a0b</li> <li>NestJS Simple Chat - \u90e8\u7f72\u670d\u52a1</li> <li>NestJS Simple Chat - \u5206\u623f\u53d1\u9001\u6d88\u606f</li> <li>NestJS Simple Chat - \u672c\u5730\u670d\u52a1\u6d88\u606f\u8f6c\u53d1</li> <li>NestJS Simple Chat - Web\u5efa\u7acbwebsocket\u8fde\u63a5</li> </ul>"},{"location":"tags/#webrtc","title":"WebRTC","text":"<ul> <li>WebRTC\u7684\u4e00\u4e9b\u53c2\u8003</li> <li>WebRTC\u62bd\u53d6AGC\u589e\u76ca\u4e0eANS\u566a\u58f0\u6291\u5236\u6a21\u5757\u7ed9Android</li> <li>WebRTC\u6a21\u62df\u4f20\u8f93\u89c6\u9891\u6d41\uff0cvideo\u901a\u8fc7\u672c\u5730\u8282\u70b9peer\u4f20\u8f93\u89c6\u9891\u6d41</li> <li>WebRTC\u6982\u5ff5\u7b80\u4ecb</li> <li>WebRTC\u4e0b\u8f7d\u4e0e\u7f16\u8bd1 Mac</li> <li>Web\u524d\u7aefWebRTC\u653b\u7565-\u5a92\u4f53\u534f\u5546\u4e0eSDP\u7b80\u6790</li> <li>WebRTC\u672c\u5730\u9009\u62e9codec</li> <li>WebRTC\u672c\u5730\u63d2\u5165\u591a\u4e2a\u8f6c\u53d1\u8282\u70b9\uff0c\u6a21\u62df\u591a\u8282\u70b9\u8f6c\u53d1\uff0c\u9020\u6210\u5ef6\u8fdf</li> <li>WebRTC\u97f3\u9891\u901a\u8bdd\u5347\u7ea7\u4e3a\u89c6\u9891\u901a\u8bdd</li> <li>Ubuntu\u4e0b\u8f7d\u5b89\u88c5coturn\uff0c\u542f\u52a8TURN\u670d\u52a1</li> <li>WebRTC\u97f3\u9891\u97f3\u91cf</li> <li>WebRTC\u4ece\u6444\u50cf\u5934\u83b7\u53d6\u56fe\u7247\u4f20\u5165canvas</li> <li>WebRTC\u4e0eCSS\u6ee4\u955c\uff08CSS filter\uff09</li> <li>WebRTC\u6253\u5f00\u672c\u5730\u6444\u50cf\u5934</li> <li>WebRTC\u672c\u5730\u5206\u4eab\u5c4f\u5e55\uff0c\u5f55\u5236\u5c4f\u5e55</li> <li>WebRTC\u7f51\u9875\u6253\u5f00\u6444\u50cf\u5934\u5e76\u5f55\u5236\u89c6\u9891</li> <li>WebRTC\u89c6\u9891\u5206\u8fa8\u7387\u8bbe\u7f6e</li> </ul>"},{"location":"tags/#xcode","title":"Xcode","text":"<ul> <li>Xcode \u57fa\u672c\u64cd\u4f5c</li> </ul>"},{"location":"tags/#adb","title":"adb","text":"<ul> <li>Python \u8c03\u7528adb\u547d\u4ee4</li> </ul>"},{"location":"tags/#fun","title":"fun","text":"<ul> <li>\u7f16\u7a0b\u7b11\u8bdd</li> <li>\u7a0b\u5e8f\u5458\u6bb5\u5b50</li> <li>\u7a0b\u5e8f\u5458\u6bb5\u5b503</li> <li>\u7a0b\u5e8f\u5458\u6bb5\u5b504</li> <li>\u7a0b\u5e8f\u7b11\u8bdd\uff0c\u6c99\u96d5\u56fe5</li> </ul>"},{"location":"tags/#http","title":"http","text":"<ul> <li>HTTP\u72b6\u6001\u7801</li> </ul>"},{"location":"tags/#ios","title":"iOS","text":"<ul> <li>\u9093\u767d\u6c0f\u7f16\u53f7\u7533\u8bf7 DUNS</li> <li>iOS\u9875\u9762\u8df3\u8f6c\u7684\u51e0\u79cd\u65b9\u5f0f</li> <li>.a is missing one or more architectures required by this target</li> <li>iOS TableView Storyboard\u793a\u4f8b \u663e\u793a\u5217\u8868</li> <li>iOS TableView \u663e\u793a\u8be6\u60c5\uff0c\u4f7f\u7528Storyboard</li> <li>iOS TableView Storyboard\u793a\u4f8b \u5217\u8868\u9875\u4f7f\u7528UITableViewDataSource</li> <li>iOS TableView Storyboard\u793a\u4f8b\uff0c\u8be6\u60c5\u9875DataSource</li> <li>iOS TableView Storyboard\u793a\u4f8b\uff0c\u7f16\u8f91\u8be6\u60c5</li> <li>Xcode \u57fa\u672c\u64cd\u4f5c</li> </ul>"},{"location":"tags/#sip","title":"sip","text":"<ul> <li>SIP\u4e0eSDP</li> <li>SIP\u9519\u8bef\u7801\u53c2\u8003</li> </ul>"},{"location":"tags/#ws","title":"ws","text":"<ul> <li>NestJS WebSocket \u5f00\u59cb\u4f7f\u7528</li> </ul>"},{"location":"tags/#_2","title":"\u5d4c\u5165\u5f0f","text":"<ul> <li>float\u7c7b\u578b\u4e2dNaN\u548cInf\u662f\u4ec0\u4e48\uff1f</li> <li>\u5d4c\u5165\u5f0f\u9879\u76ee\u4e2d\u6253\u9020\u81ea\u5df1\u7684utils\u5e93-\u4e8c\u8fdb\u5236\u8f6c\u6362</li> <li>\u5d4c\u5165\u5f0f\u9879\u76ee\u4e2d\u6253\u9020\u81ea\u5df1\u7684utils\u5e93-ENUM\u8f6c\u5b57\u7b26\u4e32</li> <li>\u5d4c\u5165\u5f0f\u9879\u76ee\u4e2d\u6253\u9020\u81ea\u5df1\u7684utils\u5e93-\u4e0d\u540c\u82af\u7247\u7684\u57fa\u7840\u65f6\u7a7a\u5f00\u9500\u8ba1\u7b97</li> <li>ESP8266 Bootloader\u5f00\u6e90\u4ee3\u7801\u89e3\u6790\u4e4brboot\uff08\u4e00\uff09</li> <li>ESP8266 Bootloader\u5f00\u6e90\u4ee3\u7801\u89e3\u6790\u4e4brboot\uff08\u4e8c\uff09</li> <li>ESP8266\u67b6\u6784\u63a2\u7d22-\u8fd0\u884c\u7684\u8d77\u59cb</li> </ul>"},{"location":"tags/#_3","title":"\u60ac\u6d6e\u7a97","text":"<ul> <li>Android \u60ac\u6d6e\u7a97 Activity</li> </ul>"},{"location":"tags/#_4","title":"\u8bbe\u8ba1\u6a21\u5f0f","text":"<ul> <li>\u9002\u914d\u5668\u6a21\u5f0f Adapter Pattern - Java\u5b9e\u73b0</li> <li>\u6865\u63a5\u6a21\u5f0f Bridge Pattern</li> <li>\u5efa\u9020\u8005\u6a21\u5f0f Builder Pattern</li> <li>\u547d\u4ee4\u6a21\u5f0f</li> <li>\u88c5\u9970\u8005\u6a21\u5f0f</li> <li>\u95e8\u9762\u6a21\u5f0f Facade Pattern</li> <li>\u5de5\u5382\u65b9\u6cd5 Java\u5b9e\u73b0</li> <li>\u4eab\u5143\u6a21\u5f0f Flyweight Pattern</li> <li>\u8fed\u4ee3\u5668 Iterator</li> <li>\u76d1\u542c\u8005\u6a21\u5f0f - \u5728Java\u4e0eAndroid\u4e2d\u7684\u4f7f\u7528</li> <li>\u4e2d\u4ecb\u8005\u6a21\u5f0f Mediator Pattern</li> <li>\u5907\u5fd8\u5f55\u6a21\u5f0f Memento Pattern</li> <li>\u539f\u578b\u6a21\u5f0f Prototype Pattern</li> <li>\u4ee3\u7406\u6a21\u5f0f Proxy Pattern</li> <li>\u8d23\u4efb\u94fe\u6a21\u5f0f Responsibility Chain Pattern</li> <li>\u72b6\u6001\u6a21\u5f0f State Pattern</li> <li>\u7b56\u7565\u6a21\u5f0f Strategy Pattern</li> <li>\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f Template Method Pattern</li> <li>\u8bbf\u95ee\u8005\u6a21\u5f0f Visitor Pattern</li> </ul>"},{"location":"tags/#_5","title":"\u97f3\u89c6\u9891","text":"<ul> <li>Android\u97f3\u9891PCM\u6570\u636e\u7684\u91c7\u96c6\u548c\u64ad\u653e\uff0c\u8bfb\u5199\u97f3\u9891wav\u6587\u4ef6</li> <li>Android\u4f7f\u7528SurfaceView\u548cTextureView\u9884\u89c8Camera\uff0c\u83b7\u53d6NV21\u6570\u636e</li> <li>Android \u4f7f\u7528 Android Camera API \u5b8c\u6210\u97f3\u89c6\u9891\u7684\u91c7\u96c6\u3001\u7f16\u7801\u3001\u5c01\u5305\u6210 mp4 \u8f93\u51fa</li> <li>Android MediaCodec \u7f16\u89e3\u7801\u4f7f\u7528\u65b9\u5f0f</li> <li>Android \u4f7f\u7528 MediaExtractor \u548c MediaMuxer \u89e3\u6790\u548c\u5c01\u88c5 mp4 \u6587\u4ef6</li> <li>\u5e38\u89c1\u97f3\u89c6\u9891\u7f16\u7801\u683c\u5f0f</li> <li>YUV\u7b80\u4ecb</li> <li>YUV\u5b58\u50a8\u65b9\u5f0f</li> </ul>"}]}